<html>
<head>
<title>Causal Machine Learning for Econometrics: Causal Forests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">计量经济学的因果机器学习:因果森林</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/causal-machine-learning-for-econometrics-causal-forests-5ab3aec825a7?source=collection_archive---------1-----------------------#2021-04-16">https://towardsdatascience.com/causal-machine-learning-for-econometrics-causal-forests-5ab3aec825a7?source=collection_archive---------1-----------------------#2021-04-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="e443" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/thoughts-and-theory" rel="noopener" target="_blank">思想和理论</a></h2><div class=""/><div class=""><h2 id="d661" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">计量经济学的因果机器学习介绍，包括使用EconML估计带有<strong class="ak">因果森林</strong>的<strong class="ak">美食</strong>的Python教程</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/cbd58bad97165c218f39cecf7f9e954c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TGquuC6uQE4UGQ5P"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">Lukasz Szmigiel 在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="7242" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">公平与平等不是同一个原则。在社会背景下，它们都与公平有关；平等意味着不管需求如何，对每个人都一视同仁，而公平意味着根据人们的需求区别对待。考虑疫苗接种，如果我们把公共卫生政策建立在平等的基础上，也许会有一个抽签系统来决定谁先接种疫苗，给每个人一个平等的机会。然而，在实践中，疫苗接种是基于公平的优先考虑，那些风险最大的人、前线医护人员和老年人理所当然地排在第一位。</p><p id="93ee" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">假设我们理解了治疗和结果之间的因果关系，那么问题是，我们如何识别经历最大平均因果效应的亚组，无论是积极的还是消极的。受我在世界银行的数据科学咨询工作的启发，我最近分享了一个<a class="ae lh" rel="noopener" target="_blank" href="/practical-python-causality-econometrics-for-data-science-ffc074e11a1d"> Python教程</a>，其中我讨论了因果关系作为计量经济学在数据科学中的应用。通过计算异质性治疗效果和确定受政策影响最大的亚组，因果关系可以帮助公平的政策分配。然而，计算治疗效果的异质性可能很复杂，也称为<strong class="lk jd">条件平均治疗效果(CATE) </strong>。方便的是，计量经济学提供了几种估计CATE的方法。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi me"><img src="../Images/c6fbb74f849dde4c60d72ac03210995e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vKNHsDLevjizZgRThbng-A.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">估算CAT-E！图片作者。</p></figure><p id="c1fb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，不幸的是，传统的计量经济学方法不适合当前的大数据现实，其中协变量和交互项的数量可能超过观察值。这一现实导致了经济学因果机器学习的发展；这是一个相对较新的领域，早在2014年就有贡献，最激动人心的发展出现在2018年前后。我将在一系列关于因果机器学习的以计量经济学为重点的文章中介绍其中的一些发展，所有这些文章都将包括这些技术的Python实现。</p><p id="9ed3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本文中，我将重点介绍一种特定的技术，<a class="ae lh" href="https://arxiv.org/abs/1902.07409" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd">因果森林</strong> </a>，这是一种由经济学家苏珊·艾希(Susan Athey)和斯特凡·韦杰(Stefan Wager)开发的因果机器学习方法。首先，我简要描述一下本教程中使用的经济学数据集，该数据集取自在摩洛哥进行的一项关于小额信贷影响的随机实验(<a class="ae lh" href="https://www.aeaweb.org/articles?id=10.1257/app.20130535" rel="noopener ugc nofollow" target="_blank"> Crépon et al .，2015 </a>)。接下来，我讨论因果推理和<a class="ae lh" href="https://en.wikipedia.org/wiki/Rubin_causal_model#Potential_outcomes" rel="noopener ugc nofollow" target="_blank">潜在结果框架</a>，这为讨论条件平均治疗效果(CATE)奠定了基础。随后是因果森林的介绍，概述了理论，实际上侧重于建立高层次的直觉。最后，我使用微软研究院的<a class="ae lh" href="https://github.com/microsoft/EconML" rel="noopener ugc nofollow" target="_blank"> EconML </a> Python库在摩洛哥案例研究数据上实现了一个因果森林来评估CATE。完整的Python演练包括使用<a class="ae lh" rel="noopener" target="_blank" href="/explain-your-model-with-the-shap-values-bc36aac4de3d"> SHAP值</a>进行可解释性测试的代码，并演示了如何绘制置信区间。</p><h2 id="4525" class="mf mg it bd mh mi mj dn mk ml mm dp mn lr mo mp mq lv mr ms mt lz mu mv mw iz bi translated"><strong class="ak">案例研究:摩洛哥的小额信贷</strong></h2><p id="9b1f" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">小额信贷和小额融资的研究可以追溯到诺贝尔和平奖得主穆罕默德·尤努斯，他在20世纪70年代发现给贫穷企业家的小额贷款可以极大地改善穷人的生活。尤努斯认为，信用是一项基本人权；小额信贷增加商业投资，导致商业活动和家庭收入增加，从而导致家庭储蓄可投资于教育等减贫努力。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nc"><img src="../Images/87f3054e9e0bcc704ee45ce045272ba8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vR7c9H0LS7R_fnbFe1E0Dw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">小额信贷理论。图片来自<a class="ae lh" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3816558" rel="noopener ugc nofollow" target="_blank">雅各布(2021 </a>)。</p></figure><p id="1b0b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">本教程使用了2006年在摩洛哥农村进行的随机实验的小额信贷计划数据集(<a class="ae lh" href="https://www.aeaweb.org/articles?id=10.1257/app.20130535" rel="noopener ugc nofollow" target="_blank"> Crépon等人，2015 </a>)。为了了解获得小额信贷的影响，某些村庄(治疗组)获得了小额信贷，并相对于对照组测量了家庭一级的贷款额，作为小额信贷需求的指标。每个家庭都有可观察到的特征，有可能以这些协变量为条件来发现小额信贷因果效应的异质性。</p><p id="b3dd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本月早些时候通过社会科学研究网络(SSRN)发布的<a class="ae lh" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3816558" rel="noopener ugc nofollow" target="_blank">预印本</a>中，Daniel Jacob调查了可用于估计CATE的机器学习方法，其中使用了摩洛哥小额信贷数据集作为例子。Jacob解释说，目标是找到基于协变量的亚组，在那里治疗效果会不同；然而，我们不知道应该关注哪些子群，并且有许多协变量，因此需要机器学习来估计CATE。下一节涵盖了因果推断和潜在结果框架，以解释CATE是如何计算的。</p><h1 id="e1e6" class="nd mg it bd mh ne nf ng mk nh ni nj mn ki nk kj mq kl nl km mt ko nm kp mw nn bi translated"><strong class="ak">因果推断和潜在结果</strong></h1><p id="24b6" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">因果效应被定义为治疗中单位水平的干预变化导致结果变量(Y)改变的幅度，换句话说，就是真实世界和<a class="ae lh" href="https://en.wikipedia.org/wiki/Counterfactual_conditional" rel="noopener ugc nofollow" target="_blank">反事实</a>世界的结果之间的差异。从优秀的<a class="ae lh" href="https://econml.azurewebsites.net/" rel="noopener ugc nofollow" target="_blank"> EconML文档</a>中截取的下图直观地展示了这种关系。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi no"><img src="../Images/13d3f41cbf7862e634ef4a63b4a7947a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pxqgUqzvLZZTqp8_ZzZhrw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">因果效应被衡量为现实世界和反现实世界之间的结果差异。<a class="ae lh" href="https://microsoft.github.io/dowhy/example_notebooks/tutorial-causalinference-machinelearning-using-dowhy-econml.html" rel="noopener ugc nofollow" target="_blank">来源。</a></p></figure><p id="69cb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了表明治疗引起结果，治疗的改变应该引起结果(Y)的改变，而所有其他协变量保持不变；这种类型的治疗变化被称为<a class="ae lh" href="https://en.wikipedia.org/wiki/Causal_model#Intervention" rel="noopener ugc nofollow" target="_blank">干预</a>。以下随机对照试验(RCT)的因果图显示了如何计算平均治疗效果(ATE)作为治疗对结果的影响，以及CATE是治疗对结果的影响，以协变量为条件。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi np"><img src="../Images/368f39ccf1e9a8fd0bce7f3c43b36e28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*j7ojD_J_hvDGXBJocUzc7w.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">随机对照试验(RCT)中平均治疗效果(ATE)和条件平均治疗效果(CATE)的因果图。图片来自<a class="ae lh" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3816558" rel="noopener ugc nofollow" target="_blank">雅各布(2021 </a>)。</p></figure><p id="d14a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果治疗效果是异质的，有可能以协变量为条件来计算CATE。这有助于识别治疗为阳性的个体，以及哪些个体将从治疗中受益最大；本质上是对最优政策分配的估计(<a class="ae lh" href="https://www.annualreviews.org/doi/abs/10.1146/annurev-economics-080217-053433" rel="noopener ugc nofollow" target="_blank"> Athey &amp; Imbens，2019 </a>)。然而，我们遇到了“<em class="nq">因果推理的基本问题</em>”(<a class="ae lh" href="https://www.jstor.org/stable/2289064?seq=1" rel="noopener ugc nofollow" target="_blank">Holland，1986 </a>)，其中CATE不能直接观察到一个单元，使得不可能观察到单元水平的因果效应。也就是说，我们永远无法直接观察到一个观察单位的反事实状态。</p><p id="9db6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，对于每个观察，我们可以从两个条件均值函数预测两个结果，一个对应于治疗，另一个对应于对照组，潜在结果之间的差异等于CATE。没有必要知道条件均值函数的基本结构形式，因为我们只关心得到条件均值的良好预测。这些条件均值函数的参数并不直接相关，因此这些函数可被称为<a class="ae lh" href="https://en.wikipedia.org/wiki/Nuisance_parameter" rel="noopener ugc nofollow" target="_blank">干扰函数</a>。</p><p id="db9e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在<a class="ae lh" href="https://medium.com/me/stats/post/ffc074e11a1d" rel="noopener">之前的一个教程</a>中，我简要讨论了与微软研究院的<a class="ae lh" href="https://microsoft.github.io/dowhy/" rel="noopener ugc nofollow" target="_blank">道伊</a> Python库相关的潜在成果框架(<a class="ae lh" href="https://www.cambridge.org/core/books/causal-inference-for-statistics-social-and-biomedical-sciences/71126BE90C58F1A431FE9B2DD07938AB" rel="noopener ugc nofollow" target="_blank">伊本斯&amp;鲁宾，2015 </a>)。下图摘自<a class="ae lh" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3816558" rel="noopener ugc nofollow" target="_blank"> Jacob (2021) </a>，详细描述了Rubin ( <a class="ae lh" href="https://www.jstor.org/stable/2287653?seq=1" rel="noopener ugc nofollow" target="_blank"> 1980 </a>)概述的这一框架(也称为<a class="ae lh" href="https://en.wikipedia.org/wiki/Rubin_causal_model" rel="noopener ugc nofollow" target="_blank"> Rubin因果模型</a>)的四个基本假设，这使我们能够推导出CATE。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nr"><img src="../Images/edc04a87468f574d4d0c734a9ba821bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fFDONxHTaJNolKELfbz7mw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">潜在结果框架的四个假设。图片来自<a class="ae lh" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3816558" rel="noopener ugc nofollow" target="_blank">雅各布(2021) </a>。</p></figure><p id="b551" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于每个观察，有两个潜在的结果，Y₀和Y₁，并且仅观察到一个结果。二进制治疗指标为D &gt; { 0；1}观察到的协变量是X &gt; ℝ <em class="nq"> ᵖ </em>，其中<em class="nq"> p </em>是协变量的个数，与协变量空间的维数有关。第一个和第四个假设，协变量的条件独立性和外生性，简单地陈述了治疗分配独立于两个潜在的结果，并且协变量不受治疗的影响。第二个假设，<a class="ae lh" href="https://en.wikipedia.org/wiki/Rubin_causal_model#Stable_unit_treatment_value_assumption_(SUTVA)" rel="noopener ugc nofollow" target="_blank">稳定单位治疗值假设(SUTVA) </a>，说明在治疗观察和对照观察之间没有干扰或隐藏的变化。第三个假设，重叠假设，是没有亚组完全位于治疗组或对照组内。因此，治疗概率必须远离零和一，从而产生<a class="ae lh" href="https://en.wikipedia.org/wiki/Propensity_score_matching" rel="noopener ugc nofollow" target="_blank">倾向得分</a>(上图中的等式(1))。</p><p id="d9de" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">按照上述符号，治疗组或对照组的结果的条件预期，𝜇𝒹( <em class="nq"> x </em>，定义为:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/6bc4641028444c5592606278291e19e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*5HWUnIovGz2_yfeKFiMjsQ.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">对结果的有条件的期望。图片来自<a class="ae lh" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3816558" rel="noopener ugc nofollow" target="_blank">雅各布(2021) </a>。</p></figure><p id="928c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">美食或𝜏( <em class="nq"> x </em>正式定义为:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/74f7e5c6db428882d5a63c24e6f382bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*0Q_VVIMByUv064yKnJNUqg.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">CATE或𝜏( <em class="nu"> x </em>是条件均值的差值:𝜇₁(<em class="nu">x</em>—𝜇₀(<em class="nu">x</em>。图片来自<a class="ae lh" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3816558" rel="noopener ugc nofollow" target="_blank">雅各布(2021) </a>。</p></figure><p id="963f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">𝜏( <em class="nq"> x </em>是潜在结果的差异，它等于条件期望x的差异:𝜇₁( <em class="nq"> x </em> ) — 𝜇₀( <em class="nq"> x </em>。更明确地说，来自<a class="ae lh" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3816558" rel="noopener ugc nofollow" target="_blank"> Jacob (2021) </a>的以下等式显示了两个条件均值函数如何能够表示两个潜在的结果，因此，取结果的差导致CATE。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/edfa90c45be9322fba37b085b4c5f531.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*Df7IHZal46ALacy-jAQJuA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">凯特或𝜏(是潜在结果的差异。图片来自<a class="ae lh" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3816558" rel="noopener ugc nofollow" target="_blank">雅各布(2021) </a>。</p></figure><h1 id="05d4" class="nd mg it bd mh ne nf ng mk nh ni nj mn ki nk kj mq kl nl km mt ko nm kp mw nn bi translated"><strong class="ak">因果森林</strong></h1><p id="89d0" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">因果森林是一种来自广义随机森林的方法(<a class="ae lh" href="https://arxiv.org/abs/1610.01271" rel="noopener ugc nofollow" target="_blank"> Athey et al .，2019 </a>)。类似于随机森林(<a class="ae lh" href="https://link.springer.com/article/10.1023/A:1010933404324" rel="noopener ugc nofollow" target="_blank"> Breiman，2001 </a>)，因果森林试图在协变量空间中寻找邻域，也称为递归划分。虽然随机森林是从<a class="ae lh" href="https://en.wikipedia.org/wiki/Decision_tree" rel="noopener ugc nofollow" target="_blank">决策树</a>构建的，但是因果森林是从因果树构建的，其中因果树学习治疗效果异质性的低维表示。重要的是，分割标准优化了寻找与治疗效果异质性相关的分割。假设CATE (𝜏( <em class="nq"> x </em>)在邻域<em class="nq"> N(x) </em>上是恒定的，那么使用残差对残差的方法使得有可能求解<em class="nq"> N(x) </em>上的部分线性模型来估计平均治疗效果(<a class="ae lh" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3816558" rel="noopener ugc nofollow" target="_blank"> Jacob，2021 </a>)。目标是找到处理效果恒定但不同于其他叶子的叶子。交叉验证用于修剪因果树，但性能评估的标准是基于治疗效果的异质性。</p><p id="eab1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因果森林只是大量因果树的平均值，其中树因子采样而不同(<a class="ae lh" href="https://www.annualreviews.org/doi/abs/10.1146/annurev-economics-080217-053433" rel="noopener ugc nofollow" target="_blank"> Athey &amp; Imbens，2019 </a>)。为了从因果树创建因果森林，有必要估计加权函数，并使用得到的权重来求解局部<a class="ae lh" href="https://en.wikipedia.org/wiki/Generalized_method_of_moments" rel="noopener ugc nofollow" target="_blank">广义矩量法(GMM) </a>模型，以估计CATE。为了处理过度拟合，因果森林使用诚实条件，由此树是诚实的，如果对于每个训练样本(<em class="nq"> i </em>)它仅使用响应(Y <em class="nq"> ᵢ </em>)来估计叶内处理效果或决定在哪里放置分裂，而不是两者都使用(<a class="ae lh" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3816558" rel="noopener ugc nofollow" target="_blank"> Jacob，2021 </a>)。样本分割用于创建真实树，其中一半数据用于估计树结构，即分割子样本，另一半数据用于估计每片叶子的处理效果，即估计子样本。处理效果的预测是末端叶中估计子样本的处理和对照观察之间的平均结果的差异。</p><p id="4960" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用诚实树允许用于估计估计量方差的估计器中的<a class="ae lh" href="https://en.wikipedia.org/wiki/Asymptotic_distribution" rel="noopener ugc nofollow" target="_blank">渐近正态性</a>，从而允许估计参数的可靠<a class="ae lh" href="https://en.wikipedia.org/wiki/Confidence_interval" rel="noopener ugc nofollow" target="_blank">置信区间</a>(<a class="ae lh" href="https://arxiv.org/abs/1702.02896" rel="noopener ugc nofollow" target="_blank">赌&amp;阿塞2017 </a>)。这一点很重要，因为为了获得准确的估计，偏差应该渐近地消失，从而使置信区间最小化。一个必要的步骤，由于不可能实际观察治疗效果，因此，传统的<a class="ae lh" href="https://en.wikipedia.org/wiki/Mean_squared_error" rel="noopener ugc nofollow" target="_blank">均方误差</a>不能用于评估性能和确定置信区间。由于偏差渐近消失，因果森林估计是一致的，并且渐近<a class="ae lh" href="https://en.wikipedia.org/wiki/Gaussian_function" rel="noopener ugc nofollow" target="_blank">高斯</a>，这意味着与渐近方差的估计器(诚实树)一起，确保了有效的置信区间。在本教程中，我利用微软研究院的<a class="ae lh" href="https://github.com/microsoft/EconML" rel="noopener ugc nofollow" target="_blank"> EconML </a> Python库来实现因果森林，<a class="ae lh" href="https://econml.azurewebsites.net/spec/estimation/forest.html#causalforest-aka-forest-double-machine-learning" rel="noopener ugc nofollow" target="_blank">文档概述了因果森林的<a class="ae lh" href="https://arxiv.org/abs/1608.00060" rel="noopener ugc nofollow" target="_blank">双机学习</a>实现背后的正式方法</a>。</p><h2 id="af71" class="mf mg it bd mh mi mj dn mk ml mm dp mn lr mo mp mq lv mr ms mt lz mu mv mw iz bi translated"><strong class="ak">建立因果森林</strong></h2><p id="a06b" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">首先，本教程的摩洛哥小额信贷数据集以Stata文件(.dta)在Jacob 共享的<a class="ae lh" href="https://github.com/QuantLet/Meta_learner-for-Causal-ML/tree/main/Microcredit-Example" rel="noopener ugc nofollow" target="_blank"> R Quantlet中。首先，我使用</a><a class="ae lh" href="https://microsoft.github.io/dowhy/" rel="noopener ugc nofollow" target="_blank"> DoWhy </a>创建因果图并明确假设，随后，使用<a class="ae lh" href="https://github.com/microsoft/EconML" rel="noopener ugc nofollow" target="_blank"> EconML </a>进行其余的因果分析。</p><p id="5080" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了可视化变量之间的关系，下面的代码片段显示了如何使用DoWhy快速构建因果模型。摩洛哥小额信贷数据集被载入数据框架，并定义了治疗变量(“治疗”)、结果变量(“loansamt_total”)和协变量的标签。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="b0db" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在上面的代码片段中，用DoWhy构建了一个因果模型，它创建了一个因果图，如下图所示。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ny"><img src="../Images/8cfb8f543f2ec8edc8ff434dbfd169ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IWHuVgJDeWOjE_x6mXbYFQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">摩洛哥小额信贷实验的因果图，显示了结果和治疗变量以及选择的协变量。图片作者。</p></figure><p id="9a29" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，我们删除所选变量中缺少值的行，并将数据集分为训练集和测试集。使用训练分割，设置结果(<em class="nq"> Y </em>)、处理(<em class="nq"> T </em>)和协变量(<em class="nq"> X </em>)，并将<em class="nq"> W </em>设置为“无”。测试集中的协变量被分配给<em class="nq"> X_test </em>。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="13a3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">从EconML的<a class="ae lh" href="https://arxiv.org/abs/1608.00060" rel="noopener ugc nofollow" target="_blank">双机学习</a>模块(dml)导入<em class="nq"> CausalForestDML </em>，从<a class="ae lh" href="https://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank"> Scikit-Learn </a>导入一个<a class="ae lh" href="https://en.wikipedia.org/wiki/Cross-validation_(statistics)" rel="noopener ugc nofollow" target="_blank">交叉验证</a>多任务<a class="ae lh" href="https://en.wikipedia.org/wiki/Lasso_(statistics)" rel="noopener ugc nofollow" target="_blank">套索</a>、<a class="ae lh" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.MultiTaskLassoCV.html" rel="noopener ugc nofollow" target="_blank"> <em class="nq">多任务套索</em> </a> <em class="nq">。</em> LASSO代表“最小绝对收缩和选择算子”，它是一种回归方法，包括<a class="ae lh" href="https://en.wikipedia.org/wiki/Regularization_(mathematics)" rel="noopener ugc nofollow" target="_blank">正则化</a>和变量选择，增加了所得模型的预测精度和可解释性。</p><p id="dd15" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下一步是在拟合模型之前设置因果森林的参数。在下面的代码片段中，对于异质处理效果，分裂准则设置为“het”，树的数量设置为“10，000”，对于10个<a class="ae lh" href="https://en.wikipedia.org/wiki/Cross-validation_(statistics)#k-fold_cross-validation" rel="noopener ugc nofollow" target="_blank"> K倍交叉验证</a>，交叉验证(cv)设置为“10”。此外，model_y对应于用于将结果(反应)拟合到协变量(特征)的估计量，model_t对应于用于将治疗拟合到协变量(特征)的估计量。<em class="nq">在两种情况下，multitaskslassocv</em>都被用作估计器，然而，也可以使用其他估计器。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="c33a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在上面代码片段的最后两行，我们用小额信贷数据拟合因果森林模型，并用测试集估计CATE。在Jacob的CATE调查中，运行了20组，平均CATE报告为1300左右。这里建立的因果森林将返回1200到1400之间的CATE值，这个范围与Jacob的平均CATE结果一致。</p><h2 id="f24a" class="mf mg it bd mh mi mj dn mk ml mm dp mn lr mo mp mq lv mr ms mt lz mu mv mw iz bi translated"><strong class="ak">可解释性和评估</strong></h2><p id="f7b0" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">像因果森林这样的基于树和森林的估计器的一个优势是可解释性测试的可用性，例如<a class="ae lh" href="https://en.wikipedia.org/wiki/Shapley_value" rel="noopener ugc nofollow" target="_blank">沙普利(SHAP)值</a>。经济学家劳埃德·沙普利(Lloyd Shapley)因提出了“沙普利加法解释值”的概念而获得了诺贝尔经济学奖，这一概念源于合作博弈论。对于这种可解释性测量的介绍，我建议这篇<a class="ae lh" rel="noopener" target="_blank" href="/explain-your-model-with-the-shap-values-bc36aac4de3d">中期文章</a>。</p><p id="d722" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面的代码片段显示了如何重置因果森林的参数，并随后再次拟合因果森林模型，以计算SHAP值。在改装模型之前，有必要将参数重置为默认值，因为使用上述用于估计CATE的参数，运行时间将接近两个小时。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="87d1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下图显示了SHAP汇总图的结果。在y轴上绘制了要素重要性，其中值用蓝色到红色的颜色条表示，蓝色表示低要素重要性，红色表示高要素重要性。沿着x轴，SHAP值以负到正的刻度显示。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nz"><img src="../Images/c19dc47fecc9d63339fa5994d4fe0d7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PJfbnM9kejGeSYqzCjJJng.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">摩洛哥小额信贷数据集的SHAP值汇总图。图片作者。</p></figure><p id="44a8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最重要的特征(协变量)是户主的年龄，其次是家庭中6至16岁儿童的数量。当平均因果效应为负时，家庭年龄似乎很重要。这有助于识别亚组，例如，特征重要性表明应该分别评估年长和年轻的家庭来估计CATE。这与Jacob的美食调查结果相符，如下图所示。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oa"><img src="../Images/737a08e6d240cb6f24c5ba1b70084404.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M-N58QInRUmxffjpFeQwuw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">摩洛哥小额信贷数据中年轻和年长家庭的食物差异。图片来自<a class="ae lh" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3816558" rel="noopener ugc nofollow" target="_blank">雅各布(2021) </a>。</p></figure><p id="d83c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因果森林的主要卖点是置信区间的可靠性，原因之前在因果森林的理论解释中讨论过。本质上，估计量的渐近正态性应该导致小的置信区间。使用数据集，下面的代码片段根据因果森林模型为治疗效果和置信区间的下限和上限生成数组。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="15bd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如上所述，下一步是将数组转换为数据帧，合并这些数据帧，并根据治疗效果进行排序。有必要计算滚动平均值，因为平滑有助于创建一个更清晰、更有帮助的图。下面的代码片段显示了如何用<a class="ae lh" href="https://matplotlib.org/" rel="noopener ugc nofollow" target="_blank"> matplotlib </a>绘制治疗效果和置信区间。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="23ef" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下图显示了由因果森林模型确定的摩洛哥小额信贷测试集的处理效果和置信区间图。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ob"><img src="../Images/32fe58b0044f6c9fc8b5f503ed2a8470.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q9wOn-TRg5h9w5siGkZ2Eg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">因果森林模型的CATE和置信区间图，符合摩洛哥小额信贷测试数据集。图片作者。</p></figure><h2 id="3a45" class="mf mg it bd mh mi mj dn mk ml mm dp mn lr mo mp mq lv mr ms mt lz mu mv mw iz bi translated"><strong class="ak">最后的想法</strong></h2><p id="f3ef" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">因果机器学习有可能对计量经济学的应用产生重大影响，无论是在传统还是新的环境中。在经济学中，因果问题的范围受到数据可用性的极大限制，无论是来自昂贵的随机对照试验还是观察性研究。技术的持续快速发展打破了之前对数据可能性的理解。在过去十年中，“大数据”的可用性不断增加，影响了机器学习和数据科学的方向，并因此在自然科学和社会科学等其他学科中产生了连锁反应。</p><p id="13d5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">与这一趋势保持一致，理论计量经济学迅速推进了机器学习的因果关系。一个突出的例子是因果森林，这是艾希和伊本在2016年探索的一个想法，然后由艾希和韦杰在2019年发表在<em class="nq">统计年鉴</em>上的论文“<a class="ae lh" href="https://www.gsb.stanford.edu/faculty-research/publications/generalized-random-forests" rel="noopener ugc nofollow" target="_blank">广义随机森林</a>中正式定义。最近，Athey和Wager一直在用观察数据调查<a class="ae lh" href="https://onlinelibrary.wiley.com/doi/abs/10.3982/ECTA15732?af=R" rel="noopener ugc nofollow" target="_blank">政策学习</a>，今年早些时候在<em class="nq">计量经济学</em>上发表了一篇论文。虽然这些理论进步利用了大数据和机器学习，但不幸的是，应用经济学和计量经济学尚未采用这些最先进的方法。目前，传统的计量经济学被用来问传统的经济问题，而因果机器学习的潜力被忽视了。</p><p id="5131" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">就我个人而言，我对因果机器学习能够实现的可能性感到兴奋；经济学家现在有方法研究的新问题。我的希望是，这一差距可以弥合；我乐观地认为，理论计量经济学中的因果机器学习进步可以应用于社会研究。在我的下一篇文章中，我将讨论对工具变量使用深度学习，并探索因果关系的哲学史。</p><p id="d7b4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我欢迎反馈和问题，所以请随时在<a class="ae lh" href="https://www.linkedin.com/in/haaya-naushan-a4b5b61a5/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>上与我联系。</p></div></div>    
</body>
</html>