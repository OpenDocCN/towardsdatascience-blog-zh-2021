<html>
<head>
<title>Remove personal information from a text with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python删除文本中的个人信息</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/remove-personal-information-from-text-with-python-232cb69cf074?source=collection_archive---------8-----------------------#2021-06-23">https://towardsdatascience.com/remove-personal-information-from-text-with-python-232cb69cf074?source=collection_archive---------8-----------------------#2021-06-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1204" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">实施Python privacy textfilter，通过删除<em class="ki">个人身份信息</em> (PII)来保护用户的隐私。</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/916b95df16a256483cbf377333079308.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BrkM1n6WporbuTTOoSzjZw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">来自<a class="ae kz" href="https://unsplash.com/@lazycreekimages" rel="noopener ugc nofollow" target="_blank">的照片在</a><a class="ae kz" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上</p></figure><p id="db56" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">GDPR是欧盟的<em class="lw">通用数据保护法规</em>。其目的是保护所有欧洲居民的数据。保护数据也是开发人员的内在价值。通过控制对列和行的访问，保护行/列数据结构中的数据相对容易。但是自由文本呢？</p><p id="b4bd" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了满足我们的隐私要求，我们可以修改自由文本字段的内容，用标签代替隐私相关信息。文本的含义没有改变，但不能通过匿名与个人联系起来。目标是翻译以下文本(日期为荷兰):</p><blockquote class="lx ly lz"><p id="dc37" class="la lb lw lc b ld le ju lf lg lh jx li ma lk ll lm mb lo lp lq mc ls lt lu lv im bi translated">自2014年以来，可能性增加了，特别是与2012年相比，hè Kees？该系统有不同的功能来处理数据。日期是2021年1月12日(或2021年1月12日或2021年1月12日)。你可以在nam@provider.com找到我，我住在鹿特丹。我的地址是马斯特拉大街13号，1234AB。我叫托马斯·德·弗里斯，我有痤疮。哦，我用雷尼替丁来做这个。</p></blockquote><p id="24ef" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">并替换为</p><blockquote class="lx ly lz"><p id="37a9" class="la lb lw lc b ld le ju lf lg lh jx li ma lk ll lm mb lo lp lq mc ls lt lu lv im bi translated">从<number>开始可能性就增加了，尤其是和<number>相比，hè <name>？该系统有不同的功能来处理数据。日期为<date>(或<date>或<date>)。你可以通过&lt;邮箱&gt;联系到我，我住在&lt;地方&gt;。我的地址是&lt;地址&gt; &lt;号码&gt;，&lt;邮政编码&gt;。我叫&lt;名字&gt;名字&lt;名字&gt;我有&lt;病&gt;。哦，我用&lt;药&gt;治这个。</date></date></date></name></number></number></p></blockquote><p id="fd1c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">本文描述了一个简单的隐私过滤器，它将执行以下操作:</p><ul class=""><li id="1e09" class="md me it lc b ld le lg lh lj mf ln mg lr mh lv mi mj mk ml bi translated">用标签<date>替换日期</date></li><li id="14a0" class="md me it lc b ld mm lg mn lj mo ln mp lr mq lv mi mj mk ml bi translated">用标签<url>替换一个URL</url></li><li id="2c5a" class="md me it lc b ld mm lg mn lj mo ln mp lr mq lv mi mj mk ml bi translated">用<email>替换电子邮件地址</email></li><li id="9c95" class="md me it lc b ld mm lg mn lj mo ln mp lr mq lv mi mj mk ml bi translated">用<postalcode>替换邮政编码</postalcode></li><li id="219a" class="md me it lc b ld mm lg mn lj mo ln mp lr mq lv mi mj mk ml bi translated">用<number>替换数字</number></li><li id="a22a" class="md me it lc b ld mm lg mn lj mo ln mp lr mq lv mi mj mk ml bi translated">用<place>替换城市和地区</place></li><li id="e4d6" class="md me it lc b ld mm lg mn lj mo ln mp lr mq lv mi mj mk ml bi translated">将街道名称替换为<street/></li><li id="99ff" class="md me it lc b ld mm lg mn lj mo ln mp lr mq lv mi mj mk ml bi translated">用<name>替换名字和姓氏</name></li><li id="e65e" class="md me it lc b ld mm lg mn lj mo ln mp lr mq lv mi mj mk ml bi translated">将疾病替换为<disease/></li><li id="8658" class="md me it lc b ld mm lg mn lj mo ln mp lr mq lv mi mj mk ml bi translated">将药品名称替换为<medicine/></li></ul><p id="1256" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">添加最后两个是因为医疗信息需要额外的关注。发生的次数很少，但是当这些信息泄露时，影响是巨大的。</p><p id="6c0b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">前四个动作将使用正则表达式执行，而后五个动作将由替换函数实现。我们的隐私过滤器类具有以下结构:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="39e0" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">PrivacyFilter 类实现了不同的过滤器。在创建和初始化之后，这个对象可以用来过滤文本。它与正则表达式和<a class="ae kz" href="https://github.com/vi3k6i5/flashtext" rel="noopener ugc nofollow" target="_blank"> FlashText文字处理器</a>一起工作。</p><h2 id="f68b" class="mt mu it bd mv mw mx dn my mz na dp nb lj nc nd ne ln nf ng nh lr ni nj nk nl bi translated">使用正则表达式过滤</h2><p id="d1c4" class="pw-post-body-paragraph la lb it lc b ld nm ju lf lg nn jx li lj no ll lm ln np lp lq lr nq lt lu lv im bi translated">前四个过滤器用正则表达式实现。替换数字是第一个也是最简单的替换:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="1e50" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这个正则表达式用标签<number>替换所有包含一个或多个数字的单词。这将取代文本中的银行账户、电话号码、身份证号码等。最后执行这个过滤，这样邮政编码和日期就可以被它们相应标记代替，而不是一系列数字标记。</number></p><p id="170a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">更高级一点的是删除邮政编码的功能。荷兰的邮政编码格式为0000AA，数字和字母之间有一个可选的空格。使用下面的正则表达式来替换它们:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="b357" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">添加了带标点符号的可选部分，以防止单词前两个字母的四个数字序列被替换，例如，我们不想用“订单<postcode> ems”替换“订单4000件”。</postcode></p><p id="ff63" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">由于电子邮件地址更复杂的性质，删除电子邮件地址变得有点棘手:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="0b4b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">正则表达式在网站上找到的<a class="ae kz" href="https://emailregex.com/" rel="noopener ugc nofollow" target="_blank">邮件正则表达式99.99%管用</a>。在那里可以找到用各种语言实现的电子邮件检查器。正则表达式的另一个好来源是<a class="ae kz" href="https://murani.nl/blog/2015-09-28/nederlandse-reguliere-expressies/" rel="noopener ugc nofollow" target="_blank"> Murani.nl </a>。</p><p id="7fe7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">用一个正则表达式删除日期是不可能的，因为月份可以写成数字、缩写和全名。要删除日期，我们需要三个正则表达式:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="011e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">第一个正则表达式匹配以数字形式写成的日期<em class="lw"> dd-mm-yyyy </em>。支持日期部分之间的不同分隔符。第二个和第三个匹配日期与文本中的月份名称。</p><h2 id="d611" class="mt mu it bd mv mw mx dn my mz na dp nb lj nc nd ne ln nf ng nh lr ni nj nk nl bi translated">使用关键字处理器过滤</h2><p id="2cb3" class="pw-post-body-paragraph la lb it lc b ld nm ju lf lg nn jx li lj no ll lm ln np lp lq lr nq lt lu lv im bi translated">如果像前面的替换集一样构建，对地点、街道、姓名、药物和疾病进行过滤需要数千个正则表达式。即使在一个正则表达式中组合一系列名称也是很昂贵的。</p><p id="03fa" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了解决这个问题，Alfred V. Aho实现了<a class="ae kz" href="https://en.wikipedia.org/wiki/Aho%E2%80%93Corasick_algorithm" rel="noopener ugc nofollow" target="_blank"> Aho-Corasick算法</a>，该算法定位存储在类似字典的结构中的字符串。从所有搜索词创建一个图，遍历该图以解析文本。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/de081c405bce7d6fa8e449b4b29c3dc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*SD7rpJpvPisbDfyTQ3YF8A.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">示例树(作者图片)</p></figure><p id="664c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">该图包含字符串“AB”、“ABEF”、“AC”和“BD”，因为只有蓝色节点是端节点。当第一个字母是“AB”时，它是一个结束节点，除非后面是字母“C”和“E”。为了在关键字处理器中使用，替换标签与图中的末端节点相关联。这样，所有不同的隐私元素都可以被添加到一个图中，并且仍然可以被适当的标签替换。</p><p id="645c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">该算法有几种实现方式，这里我们将使用Github的<a class="ae kz" href="https://github.com/vi3k6i5/flashtext" rel="noopener ugc nofollow" target="_blank"> Flashtext </a>实现。该算法在<a class="ae kz" href="https://arxiv.org/abs/1711.00046" rel="noopener ugc nofollow" target="_blank"> <em class="lw">中描述，在</em> </a> <em class="lw">中替换和检索文档中的关键字。</em>它包含一个<em class="lw"> KeywordProcessor </em>，其中添加了关键字及其替换:<em class="lw">keyword processor . add _ keyword(' keyword '，' replacement') </em>。端节点存储要放置到位的替换。</p><p id="f757" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在<em class="lw">数据集</em>文件夹中，有几个文件每行都有一个关键字，例如一个全部是名字的文件，或者至少有10.000个最常见的名字。我们可以将该文件中的所有元素添加到图中，替换标记为&lt;名称为&gt;，如下所示:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="4506" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在构造函数中，创建了一个区分大小写的关键字处理器。我们使用区分大小写的处理器，因为在荷兰语中有几个名字也是动词。这样，我们只在它们以输入文件中的大写字母开头时替换它们。如果想更安全，可以使用不区分大小写的处理器。</p><p id="87d0" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">输入文件被读入一个列表(第5行和第6行)，从这个列表中删除重复项(第7行)，并根据最小长度过滤列表。列表中的每个项目都被添加到处理器中(从而添加到图表中)，并带有适当的标签“<name>”。</name></p><p id="53d7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在<em class="lw">初始化</em>功能中，可以为街道名称、地点、姓氏、药品等添加更多数据文件。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="ea9c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">位置名称按大小进行过滤，因为数据是从OpenStreetMap中提取的，空字段、零长度字段和简短缩写位于获取的数据集中。最小尺寸可根据您的安全要求量身定制。</p><h2 id="fc15" class="mt mu it bd mv mw mx dn my mz na dp nb lj nc nd ne ln nf ng nh lr ni nj nk nl bi translated">过滤文本</h2><p id="1491" class="pw-post-body-paragraph la lb it lc b ld nm ju lf lg nn jx li lj no ll lm ln np lp lq lr nq lt lu lv im bi translated">所有函数就绪后，我们可以编写实际的过滤方法:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="2c05" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">调用基于正则表达式的方法，然后是区分大小写和不区分大小写的处理器。因为不同的数据集被集成在关键字处理器中，所以只需要执行一次。这将产生所需的输出。</p><p id="ca35" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">但是性能呢？替换textparts可能会变得非常昂贵，尤其是有大量的禁用词，在这种情况下大约。136.000 (!！！).在我的计算机上，类的初始化需要3.1秒，但是过滤前面给出的文本只需要0.5毫秒。太快了！这对于在实际用例中使用来说足够快了。</p><h2 id="f3e7" class="mt mu it bd mv mw mx dn my mz na dp nb lj nc nd ne ln nf ng nh lr ni nj nk nl bi translated">最后的想法</h2><p id="03aa" class="pw-post-body-paragraph la lb it lc b ld nm ju lf lg nn jx li lj no ll lm ln np lp lq lr nq lt lu lv im bi translated">本文介绍了一个简单但非常有效的自由文本隐私解析器。改进总是可能的，但这段代码是从文本中过滤隐私信息的最佳方法。</p><p id="8103" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">可以通过用记号化器替换算法来进行改进。这使得有可能引入<a class="ae kz" href="https://blog.paperspace.com/implementing-levenshtein-distance-word-autocomplete-autocorrect/" rel="noopener ugc nofollow" target="_blank"> Levenshtein函数</a>来测量单词之间的距离，从而支持删除有打字错误的单词。</p><p id="c613" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">完整的代码可以在Github上找到:【https://github.com/lmeulen/PrivacyFilter T2】</p><p id="c126" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">标签和例句是荷兰语，但源代码可以很容易地被其他语言采用。在知识库中，还有一个程序可以收集荷兰语的不同数据集。请注意，这些操作向数据文件添加了第一行数据名称。<em class="lw"> PrivacyFiler </em>类在读取数据文件时过滤第一行。</p><p id="c74b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我希望你喜欢这篇文章。要获得灵感，请查看我的其他文章:</p><ul class=""><li id="a14c" class="md me it lc b ld le lg lh lj mf ln mg lr mh lv mi mj mk ml bi translated"><a class="ae kz" rel="noopener" target="_blank" href="/parallel-web-requests-in-python-4d30cc7b8989">使用Python实现并行web请求</a></li><li id="ebb3" class="md me it lc b ld mm lg mn lj mo ln mp lr mq lv mi mj mk ml bi translated"><a class="ae kz" rel="noopener" target="_blank" href="/visualization-of-crowdedness-for-dutch-trains-with-kepler-f55057a3ba24">使用开放数据和开普勒</a>可视化荷兰火车的拥挤程度</li><li id="f9a1" class="md me it lc b ld mm lg mn lj mo ln mp lr mq lv mi mj mk ml bi translated"><a class="ae kz" rel="noopener" target="_blank" href="/visualization-of-travel-times-with-otp-and-qgis-3947d3698042">使用OTP和QGIS可视化行程时间</a></li><li id="4279" class="md me it lc b ld mm lg mn lj mo ln mp lr mq lv mi mj mk ml bi translated"><a class="ae kz" rel="noopener" target="_blank" href="/all-public-transport-leads-to-utrecht-not-rome-bb9674600e81">所有公共交通工具都通向乌得勒支，而不是罗马</a></li></ul><p id="3ccd" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><em class="lw">免责声明:本文包含的观点和看法仅归作者所有。</em></p></div></div>    
</body>
</html>