<html>
<head>
<title>Advanced Streamlit: Session State and Callbacks for Data Labelling Tool</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">高级Streamlit:数据标签工具的会话状态和回调</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/advanced-streamlit-session-state-and-callbacks-for-data-labelling-tool-1e4d9ad32a3f?source=collection_archive---------4-----------------------#2021-08-15">https://towardsdatascience.com/advanced-streamlit-session-state-and-callbacks-for-data-labelling-tool-1e4d9ad32a3f?source=collection_archive---------4-----------------------#2021-08-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="91f2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我制作的一个数据标签工具中的Streamlit会话状态和回调的例子。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0de79948e45bced5ad36917dc652b7f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yAr_4Nu61xuv-IHjKuzbLA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由作者提供。</p></figure><p id="20aa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如今，使用Streamlit<a class="ae lr" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank">创建一个web应用程序非常简单，但是在构建复杂的东西时会有一些限制。其中之一是缺乏有状态性，因为每次我们与小部件交互时，代码中的变量都会重新初始化。好消息是Streamlit现在在0.84版本中提供了对会话状态和回调函数的本地支持。我们现在可以跨重新运行存储变量，并在与小部件交互时定义我们的自定义事件处理程序。</a></p><h1 id="ffbb" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">会话状态</h1><p id="0644" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">自2019年10月以来，会话状态的黑客攻击就已经存在，但新的<code class="fe mp mq mr ms b">st.session_state</code>为我们提供了一个访问有状态变量的优雅解决方案。在我的数据标记工具中，会话状态的一个用例是能够保存所选的项目。该应用程序需要知道有哪些可用的项目，以及该项目正在进行中。这可以通过以下方式简单实现:</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="267d" class="mx lt iq ms b gy my mz l na nb">import streamlit as st</span><span id="5dc9" class="mx lt iq ms b gy nc mz l na nb"># set variables in session state<br/>st.session_state.projects = [<br/>    'Boring Project', 'Interesting Project'<br/>]<br/>st.session_state.current_project = st.radio(<br/>    'Select a project to work with:',<br/>    st.session_state.projects,<br/>)</span></pre><p id="781e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下一步是获取所选项目的数据。除了选定的项目，该应用程序还需要获取数据的行索引。为简单起见，我们假设有一个从数据库中提取数据的函数，如下所示:</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="f9aa" class="mx lt iq ms b gy my mz l na nb">def fetch_data(project_name: str, row_index: int):<br/>    """ A simple example function to fetch data. """<br/>    dbs = {<br/>        'Boring Project': [...],<br/>        'Interesting Project': [...],<br/>    }<br/>    return dbs[project_name][row_index]  # output can be any form</span><span id="7fb7" class="mx lt iq ms b gy nc mz l na nb">if 'current_project' in st.session_state:<br/>    row_index = st.session_state.get('row_index', 0)<br/>    data = fetch_data(st.session_state.current_project, row_index)</span></pre><p id="d747" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦用户单击下一个或上一个数据，会话状态中的<code class="fe mp mq mr ms b">row_index</code>变量可以设置为另一个数字，新数据将自动加载。</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="1797" class="mx lt iq ms b gy my mz l na nb"># examples to update row index<br/>if st.button('Next', key='next_data'):<br/>    st.session_state.row_index += 1</span><span id="85aa" class="mx lt iq ms b gy nc mz l na nb">if st.button('Previous', key='previous_data'):<br/>    st.session_state.row_index -= 1</span></pre><h1 id="498e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">复试</h1><p id="3651" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">回调是当输入小部件被触发时调用的函数。支持回调的Streamlit widgets有<code class="fe mp mq mr ms b">st.button()</code>、<code class="fe mp mq mr ms b">st.radio()</code>、<code class="fe mp mq mr ms b">st.text_input()</code>等。让我们看一个在提交按钮中添加新项目的回调例子。</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="7aa3" class="mx lt iq ms b gy my mz l na nb">def submit_add_project(project_name: str):<br/>    """ Callback function during adding a new project. """<br/>    # display a warning if the user entered an existing name<br/>    if project_name in st.session_state.projects:<br/>        st.warning(f'The name "{project_name}" is already exists.')<br/>    else:<br/>        st.session_state.projects.append(project_name)</span><span id="0ff5" class="mx lt iq ms b gy nc mz l na nb">new_project = st.text_input('New project name:',<br/>                            key='input_new_project_name')<br/>st.button('Add project', key='button_add_project',<br/>          on_click=submit_add_project, args=(new_project, ))</span></pre><p id="5aec" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">注意回调函数需要<code class="fe mp mq mr ms b">project_name</code>参数，因此我们需要使用<code class="fe mp mq mr ms b">args</code>传递参数。除了添加新项目之外，我们还应该允许用户通过以下方式删除项目:</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="cda7" class="mx lt iq ms b gy my mz l na nb">def submit_delete_project(project_name: str):<br/>    """ Callback function during deleting an existing project. """<br/>    st.session_state.projects.remove(project_name)</span><span id="b6ec" class="mx lt iq ms b gy nc mz l na nb">to_delete = st.selectbox('Project to be deleted:',<br/>                         st.session_state.projects)<br/>st.button('Delete project', key='button_delete_project',<br/>          on_click=submit_delete_project, args=(to_delete, ))</span></pre><h1 id="45b5" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="d842" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">本文展示了一些会话状态和回调的例子，这些例子使应用程序能够在重新运行和与小部件交互时保留变量。我建议您尝试与他们深入了解，并查看streamlit <a class="ae lr" href="https://blog.streamlit.io/session-state-for-streamlit/" rel="noopener ugc nofollow" target="_blank">博客帖子</a>。最后，您可以在<a class="ae lr" href="https://github.com/chiachong/cry-for-help" rel="noopener ugc nofollow" target="_blank"> Github </a>中找到数据标签工具的repo。</p><p id="dcd3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是我的第一篇媒体文章，我非常感谢你们成为我的读者。希望你喜欢这篇文章，并从中学到一些东西。谢谢你的时间。注意安全。</p></div></div>    
</body>
</html>