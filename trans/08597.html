<html>
<head>
<title>Python for Excel Users — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向Excel用户的Python第2部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-for-excel-users-part-2-2a85721560cd?source=collection_archive---------27-----------------------#2021-08-08">https://towardsdatascience.com/python-for-excel-users-part-2-2a85721560cd?source=collection_archive---------27-----------------------#2021-08-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b548" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">修改和操作Excel文件(更新销售报告)</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a63e1a91c10483f7345c7fa1c348a99a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*heriByHzRGSWkmnnfJGg-w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。来自Unsplash的背景图片。</p></figure><p id="efeb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本教程系列面向所有想开始使用python而不是Excel的人，例如，自动化任务或提高速度和可伸缩性。或者只是出于好奇。</p><p id="c3ce" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个博客文章系列是为你准备的，当:</p><ul class=""><li id="27c0" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">您可以使用Excel合并各种工作表或表格(使用诸如Index、Match、VLookup</li><li id="c3af" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">使用简单的数学运算，如求和与平均</li><li id="5b6c" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">使用条件聚合函数(例如，每个类别的交易总和)或数据透视表</li></ul><p id="6d82" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它不会涵盖您需要了解的转储Excel的所有内容，也不是本系列的目标。<a class="ae mi" rel="noopener" target="_blank" href="/python-for-excel-users-part-1-c44bacff4adc">第1部分</a>意在让你开始并改变你的思维模式，从Excel到Python/Pandas。第2部分将介绍如何通过python更新给定的Excel报表。</p><p id="aa87" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然Excel有它自己的位置，而且非常快速和方便，但我希望这个博客文章系列能够帮助您探索除Excel之外的其他数据处理方式。</p><p id="783f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以在Jupyter笔记本上找到这篇博文，以及我们在<a class="ae mi" href="https://github.com/HOSD-Mentoring/presentations/tree/main/From%20Excel%20to%20Python%20-%20Part%201" rel="noopener ugc nofollow" target="_blank"> HOSD指导GitHub repo </a>中使用的数据。</p><h2 id="3ce9" class="mj mk it bd ml mm mn dn mo mp mq dp mr lh ms mt mu ll mv mw mx lp my mz na nb bi translated">目标:</h2><p id="ce31" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">在这一部分中，我们面临的任务是用新数据更新某个Excel文件，即销售报告。我们将看到两种方法，其中一种是有意义的，我们将在笔记本的最后讨论进一步使用第二种方法的原因和动机。</p><h2 id="8a06" class="mj mk it bd ml mm mn dn mo mp mq dp mr lh ms mt mu ll mv mw mx lp my mz na nb bi translated">要求:</h2><p id="b4c3" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">虽然python的一些基本经验会有所帮助，但你不必成为一名程序员或数据科学家来遵循本教程。理想情况下，您应该听说过熊猫和jupyter notebook，并亲自花了一些时间使用python。</p><p id="a203" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是不要气馁。试着跟上并阅读我们没有涉及的内容。你可以随时回到这里或者重访其他地方。如果你需要一些个人指导，我们在www.hosd-mentoring.com<a class="ae mi" href="http://www.hosd-mentoring.com" rel="noopener ugc nofollow" target="_blank">的HOSD辅导公司提供免费的一对一数据辅导</a></p><h1 id="3185" class="nh mk it bd ml ni nj nk mo nl nm nn mr jz no ka mu kc np kd mx kf nq kg na nr bi translated">1.形势</h1><p id="9720" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">在第一部分中，我们假设你刚开始是一家大型在线零售商销售部门的数据分析师。在过去的几周里，你深入研究了企业产生的各种数据。当然，你还要负责制作定期的销售报告。</p><p id="53fb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">该公司以Excel模板的形式提供了这些报告的一般结构。最重要的报告之一是<strong class="la iu">月度销售报告</strong>。许多企业领导人喜欢这种一站式报告，因为它以数字和视觉的方式展示了企业的健康和发展。</p><p id="a1b9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为一名新员工，你发现这种报告已经过时。您与您的老板交谈，建议使用直接连接到数据源的报告和可视化工具，如PowerBI或Tableau。然而，在这一点上，由于一些奇怪的业务原因，这个选项是不可行的，所以我们被迫尽我们所能处理给定的Excel报告。</p><p id="1d3f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这就是报告的样子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/954d68ae6fb465535467303e22b7ed9b.png" data-original-src="https://miro.medium.com/v2/format:webp/1*EwV3oITevOFqc47__6RC9g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="47a9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然本教程不是关于做分析，而是关于更新和维护一个给定的Excel报表的过程，但是会出现一些策略问题，这些问题可能会导致当前报表的有用扩展。</p><p id="d43b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">几个战略问题:</strong></p><ul class=""><li id="53ed" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">随着时间的推移，某些品牌是如何发展的(绝对和相对)？</li><li id="9b10" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">产品类别的发展(绝对和相对)</li><li id="b489" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">5大增长和亏损产品</li></ul><p id="3571" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于现在是8月，公司要求我们用下面显示的7月数据更新报告。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/06c0381d66b950143e9324a4a4249b5e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*_VU4XbmuLsA7o9luuxjN3A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="e761" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以在Excel中完全做到这一点，例如通过创建数据透视表，一个用于品牌，一个用于类别，然后将汇总的销售数字复制到七月份的汇总表中。</p><p id="d3cf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，虽然这种只有四个品牌和类别以及不到20种产品的手工工作是可行的，但该公司预计将在未来几个月内大幅增加其产品。因此，开始建立一个更加可扩展和自动化的过程是合理的。</p><h1 id="fd03" class="nh mk it bd ml ni nj nk mo nl nm nn mr jz no ka mu kc np kd mx kf nq kg na nr bi translated">2.使用Python更新Excel报表</h1><p id="76f2" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">我们已经知道如何使用pandas通过pd.read_csv方法读取csv文件。幸运的是，熊猫也有读取Excel文件的方法:<a class="ae mi" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_excel.html" rel="noopener ugc nofollow" target="_blank"> pd.read_excel() </a>。</p><p id="5a01" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们看看它看起来怎么样。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="16c7" class="mj mk it nu b gy ny nz l oa ob">import pandas as pd<br/><br/># Read sales for july<br/>sales_july = pd.read_csv("data/sales_july_export.csv")<br/>sales_july.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/12cc0705c41d0f2f9fd7cc116a3d8a6c.png" data-original-src="https://miro.medium.com/v2/format:webp/1*iYUbmELd-_VmUnsnAUDu9Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="8778" class="mj mk it nu b gy ny nz l oa ob"># Read excel file with pandas<br/>monthly_sales_report = pd.read_excel("data/Monthly Sales Report.xlsx")<br/>monthly_sales_report</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/ecdeaf47838551262b97f03b342ac3e6.png" data-original-src="https://miro.medium.com/v2/format:webp/1*5NnmR4uYJxs6nz1-3K8kTw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a640" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">呃！这看起来很奇怪，一点也不像我们在Excel中打开的报告。</p><p id="13a7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">原因是pandas只是试图将每个单元格的内容显示为数据帧中的一个值。因此，格式以及合并和组合的单元格都会被忽略。曾经漂亮的视觉效果不再是有nan的空牢房。</p><p id="0435" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通常，在pandas中使用Excel数据需要清理数据框架，例如删除所有不必要的行和列(如标题)。这个过程被称为切片，你可以在熊猫官方文档<a class="ae mi" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html" rel="noopener ugc nofollow" target="_blank">中读到更多关于索引和选择数据的信息。</a></p><p id="34a4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，这是品牌表的样子。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="073e" class="mj mk it nu b gy ny nz l oa ob"># create copy of full report df to slice<br/>monthly_brand_df = monthly_sales_report.copy()<br/><br/># use first row as header (alternative: set header parameter when reading excel file)<br/>monthly_brand_df.columns = monthly_brand_df.iloc[5]<br/><br/># only keep relevant rows with data for brand sales<br/>monthly_brand_df = monthly_brand_df[6:11]<br/><br/># first column is always empty as it exists purely for formatting reasons; drop it<br/>monthly_brand_df = monthly_brand_df.iloc[:,1:]<br/><br/># reset index after slicing<br/>monthly_brand_df.reset_index(drop=True, inplace=True)<br/><br/># change column names<br/>monthly_brand_df.columns = ['Brand', 'January', 'February', 'March', 'April',<br/>                            'May', 'June', 'July', 'August', 'September',<br/>                            'October', 'November',  'December', 'Full Year']<br/><br/>monthly_brand_df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/a168e0b77cd0bf42932c7f0173b8ca03.png" data-original-src="https://miro.medium.com/v2/format:webp/1*OGJ_dHdLLIEyI212qfvKfg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="bdcb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，在这个场景中，我们感兴趣的不是仅仅处理数据，而是用新数据更新报告。事实上，我们只需要接触几个单元格，即对应于七月的单元格。</p><p id="f7db" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，假设报表的结构保持不变，我们正在寻找一种用指定值填充指定单元格的方法。</p><p id="8bd5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，我们的方法是:</p><ul class=""><li id="a847" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">步骤1:在品牌和产品类别级别上计算七月份的销售额(两个汇总表)</li><li id="c89b" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">步骤2:将数据写入Excel报表，并保存新的更新版本</li></ul><h2 id="6efe" class="mj mk it bd ml mm mn dn mo mp mq dp mr lh ms mt mu ll mv mw mx lp my mz na nb bi translated"><strong class="ak">第一步:计算7月份汇总表</strong></h2><p id="9587" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">本质上，我们将做与使用excel中的数据透视表相同的事情，在excel中，我们使用<em class="oc">品牌</em>作为一行来合计<em class="oc">销售额</em>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/6af6d9c310f216529e8bfe586bb88ecb.png" data-original-src="https://miro.medium.com/v2/format:webp/1*wa-Gl-1qNRals24LwvQQPQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="f483" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们使用<em class="oc">产品类别</em>而不是<em class="oc">销售</em>做同样的事情。这就是我们如何使用熊猫在python中实现的。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="7803" class="mj mk it nu b gy ny nz l oa ob">sales_july.head(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/93780a7ec59cea3dbcca180c491fa236.png" data-original-src="https://miro.medium.com/v2/format:webp/1*XoMmsSpPOdM4euEwfIf5Mw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="b539" class="mj mk it nu b gy ny nz l oa ob"># sales by brand<br/>sales_july_by_brand = sales_july.groupby(["Brand"], as_index=False).agg({"Sales":"sum"})<br/>sales_july_by_brand</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/a317f9189170475d6018dc8105fc9ca3.png" data-original-src="https://miro.medium.com/v2/format:webp/1*W81ddgGK6DXcmJtia4C6eQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="1c50" class="mj mk it nu b gy ny nz l oa ob"># sales by category<br/>sales_july_by_category = sales_july.groupby(["Product Category"], as_index=False).agg({"Sales":"sum"})<br/>sales_july_by_category</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/c20c641ee9ffb99f5bf38b5126d986e3.png" data-original-src="https://miro.medium.com/v2/format:webp/1*v1cuUJk02r0fi82Fm5svRw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="5e79" class="mj mk it bd ml mm mn dn mo mp mq dp mr lh ms mt mu ll mv mw mx lp my mz na nb bi translated">第2步:将数据写入Excel报表</h2><p id="160d" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">好了，现在我们已经计算了我们的小例子中需要的所有销售数字，我们可以更新Excel文件了。</p><p id="78c6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，我们知道我们需要用品牌a的七月销售数字更新第<strong class="la iu">行第6 </strong>和第<strong class="la iu">列未命名:8 </strong>中的单元格。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="fdb2" class="mj mk it nu b gy ny nz l oa ob"># helper functions to color certain cells green<br/>def highlight_cell(x):<br/>    df = x.copy() <br/>    df.loc[:,:] = '' <br/>    df.at[6,"Unnamed: 8"] = 'background-color: lightgreen'<br/>    return df <br/><br/>def highlight_cells(x):<br/>    df = x.copy() <br/>    df.loc[:,:] = '' <br/>    df.at[6,"Unnamed: 8"] = 'background-color: lightgreen'<br/>    df.at[7,"Unnamed: 8"] = 'background-color: lightgreen'<br/>    df.at[8,"Unnamed: 8"] = 'background-color: lightgreen'<br/>    df.at[9,"Unnamed: 8"] = 'background-color: lightgreen'<br/>    return df <br/><br/>def highlight_grandtotal(x):<br/>    df = x.copy() <br/>    df.loc[:,:] = '' <br/>    df.at[10,"Unnamed: 8"] = 'background-color: yellow'<br/>    return df</span><span id="0807" class="mj mk it nu b gy od nz l oa ob"># ugly imported excel file<br/>monthly_sales_report.head(15).style.apply(highlight_cell, axis=None)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/1427a96e4a83060188dec15e2ed68a78.png" data-original-src="https://miro.medium.com/v2/format:webp/1*z7xshtn788U6kiPxnLrWNQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="eef0" class="mj mk it nu b gy ny nz l oa ob"># take sales for Brand A from sales_july_by_brand and write to monthly_sales_report to a specified cell<br/>monthly_sales_report.at[6, "Unnamed: 8"] = sales_july_by_brand.at[0, "Sales"]<br/><br/># see updates<br/>monthly_sales_report.head(15).style.apply(highlight_cell, axis=None)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/8a4ad2907dad5d93cf63c38ff8acb0a3.png" data-original-src="https://miro.medium.com/v2/format:webp/1*DhgOVCWwNtAcmzN8ykF96Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4411" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以通过循环遍历这些行四次来更新其他品牌，并重复上面的操作。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="fb44" class="mj mk it nu b gy ny nz l oa ob"># update July sales for all brand<br/>for i in range(4):<br/>    monthly_sales_report.at[i+6, "Unnamed: 8"] = sales_july_by_brand.at[i, "Sales"]<br/>    <br/># see updates<br/>monthly_sales_report.head(15).style.apply(highlight_cells, axis=None)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/4f82e19f4f5835080bda9f41c50fa791.png" data-original-src="https://miro.medium.com/v2/format:webp/1*ByYFx7Y76AxnAD46KXnRcg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a798" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要更新所有品牌的总销售额，我们需要对所有品牌求和，并将结果写入单元格monthly_sales_report.at[10，" named: 8"]</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="6215" class="mj mk it nu b gy ny nz l oa ob">monthly_sales_report.head(15).style.apply(highlight_grandtotal, axis=None)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/8c9f8d042b3d58e24bc69a968b201257.png" data-original-src="https://miro.medium.com/v2/format:webp/1*2fRUsbTQbo-PKN9O_Ab0sQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="5680" class="mj mk it nu b gy ny nz l oa ob"># calculate sum over all brands for July<br/>total_sum = sum(sales_july_by_brand["Sales"])<br/>print(total_sum)<br/><br/># write total sum to table<br/>monthly_sales_report.at[10, "Unnamed: 8"] = total_sum<br/><br/># show updates<br/>monthly_sales_report.head(15).style.apply(highlight_grandtotal, axis=None)</span><span id="27d8" class="mj mk it nu b gy od nz l oa ob">11319</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/3109aace22cb37f8a3012004caf88d3b.png" data-original-src="https://miro.medium.com/v2/format:webp/1*cWDDxZg_QUmy26ROJda9IA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="3642" class="mj mk it nu b gy ny nz l oa ob"># Same approach for updating sales per category<br/>for i in range(4):<br/>    monthly_sales_report.at[i+29, "Unnamed: 8"] = sales_july_by_category.at[i, "Sales"]<br/>    <br/># see updates<br/>monthly_sales_report</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/283a7b27fc323c0b5a57c8003ea24c25.png" data-original-src="https://miro.medium.com/v2/format:webp/1*44phz8VYDW0PsIAwTRBXPQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="23a8" class="mj mk it nu b gy ny nz l oa ob"># save excel file<br/>monthly_sales_report.to_excel("monthly_sales_report_updated_1.xlsx")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/ba021a6fd0fccdf963cf4cda1519f5cf.png" data-original-src="https://miro.medium.com/v2/format:webp/1*aNgnBr8LNoqx4h1UfWQryw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="ca04" class="mj mk it bd ml mm mn dn mo mp mq dp mr lh ms mt mu ll mv mw mx lp my mz na nb bi translated">替代方案:将数据直接写入Excel报表(目前是真的)</h2><p id="d5fc" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">当你在阅读最后一节时翻了翻白眼，问自己为什么要用python来更新如此复杂的简单Excel文件时，我为你提供了另一个选择，而不是使用pandas。</p><p id="f4b4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面的方法有两个缺点。首先，它太复杂了。第二，从Excel加载数据，在数据框架中操作数据，并将其保存回Excel，这将删除所有格式设置和图形等非数据内容。上面的截图显示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/15eb94ab993ef8981547c2527e4ed39e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*FC12oeVrTAS3UKLH2r-p-w.png"/></div></figure><p id="9d00" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">或者，我们希望找到一种方法，不将报告数据作为数据帧导入，而是将数据直接写入Excel报告中的指定单元格。包装<a class="ae mi" href="https://www.xlwings.org" rel="noopener ugc nofollow" target="_blank"> xlwings </a>可用于此目的。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="1018" class="mj mk it nu b gy ny nz l oa ob">import xlwings as xw<br/><br/>excel_app = xw.App(visible=False)<br/>excel_book = excel_app.books.open("data/Monthly Sales Report.xlsx")<br/>sheet = excel_book.sheets[0]<br/><br/># Directly write July sales for Brand A to corresponding cell in Excel<br/>sheet.range("I8").value = sales_july_by_brand.at[0, "Sales"]<br/>excel_book.save()<br/><br/>#excel_book.close()<br/>#excel_app.quit()</span></pre><p id="7460" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当我们切换到Excel时，我们可以看到单元格I8不再是空的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/03621d64bc72decbb4a5f8a77c01bf64.png" data-original-src="https://miro.medium.com/v2/format:webp/1*bqOAwDoDjIObC0UR7CTUsQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0c9b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以使用这种方法将计算出的七月份品牌级别和类别级别的销售额写入相应的单元格。</p><p id="e9cf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为此，我们定义了单元格的范围，例如品牌级销售的I8:I11，并使用了转置选项。否则，数据将从左向右写入一行，而不是一列。</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="7705" class="mj mk it nu b gy ny nz l oa ob"># update a list of cells with a list of values (brand-level and category-level sales) caluclated above<br/>sheet.range('I8:I11').options(transpose=True).value = sales_july_by_brand["Sales"].values<br/>sheet.range('I31:I34').options(transpose=True).value = sales_july_by_category["Sales"].values</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/423e5d66973981d9ccb6aa2bc95c85cf.png" data-original-src="https://miro.medium.com/v2/format:webp/1*8-HdpGg3E2_pq3yIz6hRkw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="219a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请注意，与之前的方法不同，我们不需要再次计算总和，因为<strong class="la iu"> Excel公式仍然保持不变</strong>。</p><p id="cc20" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，<strong class="la iu">图会自动更新</strong>，因为它们是基于单元格值的。</p><p id="0f2e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，这种使用xlwings更新Excel报表的方法应该是首选方法。</p><h1 id="406f" class="nh mk it bd ml ni nj nk mo nl nm nn mr jz no ka mu kc np kd mx kf nq kg na nr bi translated">3.但是为什么不继续使用Excel呢？</h1><p id="095e" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">如果完全在Excel中完成，你可能会快得多——明白了。我之所以在这里使用这个简单的例子，是为了说明由于xlwings，使用Python向Excel中指定的单元格写入值是多么容易，所有的公式和连通图都保持不变。</p><p id="4c11" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，你为什么想用python向Excel写值呢？</p><p id="61bc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">比方说，你必须更新销售数据，不是每月，而是每天(频率)，不是四个品牌，而是数百个其他子类别(数据量)。</p><p id="4549" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">更新的<strong class="la iu">频率会使手工工作不是一个非常有吸引力的选择，而运行预定义的灵活脚本可以在几秒钟内处理更新过程。</strong></p><p id="7ec3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">子类别的<strong class="la iu">数量</strong>，您需要单独的数据透视表或更复杂的条件公式，只支持这一点。与Excel相比，Python在处理更大的数据集时表现更好，因此外包数据处理是有意义的。</p><p id="1003" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，Excel本身无法完成的计算类型怎么办？</p><p id="89e6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">假设您想要写入Excel文件的输出值不是简单的条件聚合的结果(例如品牌1在7月的销售额)，而是复杂的机器学习模型的<strong class="la iu">结果(例如使用神经网络预测的销售额)。</strong></p><p id="89e8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当然，您可以导出模型结果并将Excel文件连接到输出文件，但是不难想象，将结果直接写入Excel表格可能是更好的方式。</p><h2 id="379a" class="mj mk it bd ml mm mn dn mo mp mq dp mr lh ms mt mu ll mv mw mx lp my mz na nb bi translated">Python作为Excel的插件</h2><p id="45de" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">另一种方法是<a class="ae mi" href="https://docs.xlwings.org/en/stable/addin.html" rel="noopener ugc nofollow" target="_blank">使用xlwings插件</a>在Excel中使用python。我对这个选项不是很熟悉，但是对于一些必须尽可能多地在Excel中工作的人来说，这似乎是一个很好的工作流程，例如，对于那些向不能或不愿意使用jupyter笔记本或普通python脚本的客户交付数据产品的顾问来说。</p><p id="fbc9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您对此感兴趣，并且希望进一步了解xlwings的功能，这里有几篇文章可供跟进:</p><ul class=""><li id="ae59" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated"><a class="ae mi" rel="noopener" target="_blank" href="/python-excel-integration-with-xlwings-f9bf9d1332ea"> Python Excel与Xlwings的集成</a></li><li id="660d" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><a class="ae mi" rel="noopener" target="_blank" href="/how-to-supercharge-excel-with-python-726b0f8e22c2">如何用Python为Excel增压</a></li><li id="3c55" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><a class="ae mi" href="https://ernest-huang.medium.com/bridging-excel-with-python-xlwings-2e3f47cf4ac5" rel="noopener">用Python桥接Excel:XL wings</a></li></ul><p id="9af0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这一点上，我还想指出，xlwings的创始人Fleix Zumstein在2021年3月出版了一本O'Reilly的书<a class="ae mi" href="https://www.amazon.de/Python-Excel-Environment-Automation-Analysis/dp/1492081000/ref=sr_1_3?__mk_de_DE=%C3%85M%C3%85%C5%BD%C3%95%C3%91&amp;dchild=1&amp;keywords=python+for+excel&amp;qid=1628227423&amp;sr=8-3" rel="noopener ugc nofollow" target="_blank"> Python for Excel </a>。</p><p id="1254" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">他在这段YouTube视频中描述了他的书的内容。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ns"><img src="../Images/e48869b7295d5639dcda7d5de1d8ad51.png" data-original-src="https://miro.medium.com/v2/format:webp/1*8m7WqxlaV8LX6BPw65DQXg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自https://www.xlwings.org/book<a class="ae mi" href="https://www.xlwings.org/book" rel="noopener ugc nofollow" target="_blank"/></p></figure><p id="99fd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然我个人对此没有任何经验，但使用xlwings作为Excel中的插件来直接运行python脚本而不是复制输出，从而为客户端提供或多或少自包含的Excel解决方案的可能性对于某些用例来说可能是一种很大的可能性，因此值得探索。</p><h1 id="aec4" class="nh mk it bd ml ni nj nk mo nl nm nn mr jz no ka mu kc np kd mx kf nq kg na nr bi translated">4.摘要</h1><p id="168d" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">我们试图通过pandas使用我们在第1部分中学到的方法更新一个给定的Excel报表。然而，<strong class="la iu">导入和导出Excel文件会改变格式，删除公式和图表</strong>。</p><p id="43f3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">python包<strong class="la iu"> xlwings允许我们直接在指定的Excel单元格</strong>中编写输出，因此只在我们希望的地方更改文件，同时保持公式和连接图的完整性。</p><p id="9422" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这样一个简单的用例中，将数据处理外包给python可能没有必要。然而，假设品牌和产品的数量以及更新频率显著增加，这证明我们已经在考虑自动更新报告的<strong class="la iu">方法</strong>。</p><p id="cc0d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，一旦我们离开Excel的舒适环境，我们使用python的能力将是无穷无尽的。我们可以或多或少地使用机器学习模型的输出来扩展报告，而不需要手动导入它们。这些复杂的定制模型中有许多不能仅仅在Excel中定义和计算。</p><p id="dd09" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，这里概述的方法将是我们数据分析师工具箱中的一项好技能。</p><p id="0711" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我再次鼓励你考虑一下你在工作中的情况或者你的个人数据项目，像xlwings这样的工具可以帮助你，然后尝试一下。开始总是艰难的，但坚持下去，你会比任何Excel专业人员更有效、更快。</p><p id="cbb2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你需要一些关于数据分析和数据科学是否可以成为你的职业道路的一般性指导，我们<a class="ae mi" href="http://www.hosd-mentoring.com" rel="noopener ugc nofollow" target="_blank"> HOSD辅导提供免费的一对一辅导</a>。只需在我们的网站上点击一下，您就可以预约我们的导师。</p><p id="7fb2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不要害羞:)</p></div></div>    
</body>
</html>