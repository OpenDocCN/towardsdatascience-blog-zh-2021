<html>
<head>
<title>How To Build and Deploy a Serverless Machine Learning App on AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在AWS上构建和部署无服务器机器学习应用</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-build-and-deploy-a-serverless-machine-learning-app-on-aws-1468cf7ef5cb?source=collection_archive---------14-----------------------#2021-06-10">https://towardsdatascience.com/how-to-build-and-deploy-a-serverless-machine-learning-app-on-aws-1468cf7ef5cb?source=collection_archive---------14-----------------------#2021-06-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9787" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">即使预算很低也能扩展</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e399753a51815b701906f38119afb6a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KpB0LBuBVtdR_FVjaXj2jw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">建筑卡通化(图片由作者提供)</p></figure><p id="6fa9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你有没有想过构建一个机器学习应用程序，后端有一个沉重的模型，前端有一个React用户友好的界面，周围有一个无服务器的云架构，这样你的产品就可以扩展到数十、数百甚至数千个用户？</p><p id="23a7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这并不像听起来那么难，在本文中，我将展示如何构建这样的应用程序。为了让本教程更有趣，我将介绍构建Cartoonify的过程。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/68be158b5651eae1a7d35a5fa614a7ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/1*iiw0ENSHohCWNg_WPpiiNg.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">演示(作者GIF)</p></figure><p id="6f9e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Cartoonify是我从头开始做的一个玩具应用，把图片变成漫画。我知道这可能看起来有点滑稽，但相信我，这个应用程序背后有严肃的工作，你可以在其他地方利用。我会让你读这篇文章来相信我或者检查我的<a class="ae lv" href="https://github.com/ahmedbesbes/cartoonify" rel="noopener ugc nofollow" target="_blank"> GitHub </a> <em class="lw">上的代码。</em></p><h2 id="df32" class="lx ly it bd lz ma mb dn mc md me dp mf lh mg mh mi ll mj mk ml lp mm mn mo mp bi translated">这是我开始这个项目的动机</h2><ul class=""><li id="a6a8" class="mq mr it la b lb ms le mt lh mu ll mv lp mw lt mx my mz na bi translated">试试生成性对抗网络(GANs)。我最近被这些模型迷住了。尝试卡通模特把你的脸变成卡通看起来很有趣。</li><li id="6953" class="mq mr it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">了解如何使用AWS的不同服务(Lambda、API Gateway、S3等)在无服务器架构上部署应用程序。).</li><li id="7b7a" class="mq mr it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">练习我的反应能力。我习惯于策划、冲刺和精简，我想，这一次，建立一些自定义和不那么主流的东西。</li><li id="76d4" class="mq mr it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">使用Netlify部署此React应用程序。我看到了这个过程是多么简单的演示，我想试着说服自己。</li></ul><p id="a11a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">构建卡通化是如此有趣，我决定在一个视频系列中谈论它。这里有一个简短的介绍:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">第0部分—卡通化简介(作者制作的视频)</p></figure></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h1 id="0365" class="np ly it bd lz nq nr ns mc nt nu nv mf jz nw ka mi kc nx kd ml kf ny kg mo nz bi translated">0.构建和部署Cartoonify的先决条件</h1><p id="3dd6" class="pw-post-body-paragraph ky kz it la b lb ms ju ld le mt jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">如果您想要运行和部署Cartoonify，首先需要满足以下先决条件:</p><ul class=""><li id="32bc" class="mq mr it la b lb lc le lf lh od ll oe lp of lt mx my mz na bi translated">一个<a class="ae lv" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS </a>账户(别担心，部署这个应用几乎不会花你一分钱。)</li><li id="90d5" class="mq mr it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">在<a class="ae lv" href="https://www.netlify.com" rel="noopener ugc nofollow" target="_blank">网上的免费账户</a></li><li id="3d8a" class="mq mr it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated"><a class="ae lv" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank">安装在您机器上的Docker </a></li><li id="f08f" class="mq mr it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated"><a class="ae lv" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">节点</a>和<a class="ae lv" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a>(最好是最新版本)</li><li id="b8c7" class="mq mr it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated"><a class="ae lv" href="https://pytorch.org/get-started/locally/" rel="noopener ugc nofollow" target="_blank">火炬</a>和火炬视觉在本地测试卡通(可选)</li></ul><p id="8e33" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你已经准备好了一切，你现在就可以出发了。</p><p id="d793" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请遵循以下四个步骤。</p><h1 id="8d0f" class="np ly it bd lz nq og ns mc nt oh nv mf jz oi ka mi kc oj kd ml kf ok kg mo nz bi translated">1.cartongan——人工智能艺术家？</h1><p id="75c5" class="pw-post-body-paragraph ky kz it la b lb ms ju ld le mt jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">本节提供了关于该模型的一些细节。如果您对此不感兴趣，可以转到关于部署的下一部分。</p><h2 id="22f3" class="lx ly it bd lz ma mb dn mc md me dp mf lh mg mh mi ll mj mk ml lp mm mn mo mp bi translated">这个网络背后的主要思想</h2><p id="d2fa" class="pw-post-body-paragraph ky kz it la b lb ms ju ld le mt jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">在测试这个应用程序背后的模型CartoonGAN之前，让我们先来谈谈它，以了解底层架构以及它是如何被设计和训练来产生卡通风格的。</p><div class="kj kk kl km gt ab cb"><figure class="ol kn om on oo op oq paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/9057ecc731fa51a7ef1f92be4694a094.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*7NtBjjCB444lMVO0NT1hfg.jpeg"/></div></figure><figure class="ol kn om on oo op oq paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/27cb6b4502f8da675efec3bb4d5696ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Fa6Mi1a4KN_tZZqD8pXVNg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk or di os ot translated">🇸🇮·扬科·费里奇在Unsplash上拍摄的照片(左)——转换后的图像(右)</p></figure></div><p id="10b4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">CartoonGAN于2018年在这篇<a class="ae lv" href="https://openaccess.thecvf.com/content_cvpr_2018/papers/Chen_CartoonGAN_Generative_Adversarial_CVPR_2018_paper.pdf" rel="noopener ugc nofollow" target="_blank">论文</a>中推出，目标是将图像转换成不同日本漫画的风格。CartoonGAN所实现的被称为<em class="lw">风格转移</em>，这是一种图像转换技术，由于Leon A. Gatys关于神经风格转移的<a class="ae lv" href="https://arxiv.org/pdf/1508.06576.pdf" rel="noopener ugc nofollow" target="_blank">工作</a>，它在2015年首次与神经网络一起引入。风格转移后来在2017年通过CycleGAN架构得到了增强。CycleGAN通过将风格转换形式化为两个图像分布之间的转换问题来处理风格转换，而神经风格转换将其框定为优化问题。</p><p id="acbd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">CartoonGAN是神经类型转移和GANs的混合体。事实上，它使用了一个简单的GAN架构(不是循环架构)，并添加了一个受神经风格转移技术启发的语义损失，以强制生成器保留原始图像的内容。</p><p id="8db2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作者甚至进一步使CartoonGAN的结果尽可能具有视觉吸引力:为此，他们添加了第二个损失，迫使生成器创建平滑的边缘、低阴影颜色和纹理较少的区域，因为这些是卡通特有的视觉特征。</p><h2 id="58c6" class="lx ly it bd lz ma mb dn mc md me dp mf lh mg mh mi ll mj mk ml lp mm mn mo mp bi translated">从甘人到卡通人</h2><p id="4f95" class="pw-post-body-paragraph ky kz it la b lb ms ju ld le mt jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">要了解CaroonGAN是如何构建的，我们先来了解一个典型的GAN是如何被训练生成假图像的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/b7ca0d71f568cc340ebc5604f8445bf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*UxxxZvvsXw7pNxnqi9_s5g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">甘建筑—(图片经作者修改)</p></figure><p id="acfa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">GAN由两个网络组成:发生器和鉴别器。</p><p id="8b38" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">生成器的目标是获取一些输入数据(或噪声)并创建看起来像真实世界图像分布的样本，而鉴别器的目标是了解假样本和真实样本之间的边界。</p><p id="4c4b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这两个网络在一个受博弈论启发的最小-最大游戏中相互训练，其中生成器的目标是欺骗鉴别器，鉴别器的目标是更好地识别真实数据和虚假数据。</p><p id="9600" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">刚开始训练的时候，这两个网络在各自的任务中都很差，一旦训练下去，就越来越好。</p><p id="ed7f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当它们达到平衡时，发生器是如此强大，以至于它通过完全混淆来控制鉴别器。在这种情况下，我们可以扔掉鉴别器，将生成器用于生成任务。</p><h2 id="dfd2" class="lx ly it bd lz ma mb dn mc md me dp mf lh mg mh mi ll mj mk ml lp mm mn mo mp bi translated">而生成漫画呢？</h2><p id="e167" class="pw-post-body-paragraph ky kz it la b lb ms ju ld le mt jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">训练GAN从真实照片生成卡通数据是一个简单的问题，可以通过考虑以下因素来构建:</p><ul class=""><li id="e94a" class="mq mr it la b lb lc le lf lh od ll oe lp of lt mx my mz na bi translated">真实照片作为生成器的输入数据</li><li id="ea91" class="mq mr it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">卡通数据作为真实的数据分布，生成器会尽可能地伪造</li></ul><p id="b159" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这种设置的好处在于，你不需要在照片和漫画之间建立一对一的映射:这意味着在实践中，如果你想训练一个定制的卡通人物来生成你最喜欢的漫画(比如说辛普森一家)，那么你所要做的就是收集一些没有任何对应关系的辛普森图像和真实照片，然后开始训练。</p><p id="34e5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要了解更多关于CartoonGAN背后的训练程序，请看原始的<a class="ae lv" href="https://openaccess.thecvf.com/content_cvpr_2018/papers/Chen_CartoonGAN_Generative_Adversarial_CVPR_2018_paper.pdf" rel="noopener ugc nofollow" target="_blank">论文</a>。</p><p id="3b7b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在让我们转到一个更具动手能力的部分，在这里我们可以自己生成卡通效果。</p><h2 id="4f45" class="lx ly it bd lz ma mb dn mc md me dp mf lh mg mh mi ll mj mk ml lp mm mn mo mp bi translated">在本地测试卡通人物</h2><p id="ad74" class="pw-post-body-paragraph ky kz it la b lb ms ju ld le mt jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">首先克隆这个项目的<a class="ae lv" href="https://github.com/ahmedbesbes/cartoonify" rel="noopener ugc nofollow" target="_blank"> repo </a>。</p><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="eb42" class="lx ly it ow b gy pa pb l pc pd">git clone <a class="ae lv" href="https://github.com/ahmedbesbes/cartoonify.git" rel="noopener ugc nofollow" target="_blank">https://github.com/ahmedbesbes/cartoonify.git</a></span></pre><p id="1864" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">先下载四个预先训练好的模型。这些重量将加载到<code class="fe pe pf pg ow b">cartoongan/network/Transformer.py</code>中定义的发电机模型中</p><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="6ed4" class="lx ly it ow b gy pa pb l pc pd">cd cartoongan<br/>bash download_pth.sh</span></pre><p id="89cb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要测试四个模型中的一个，请将头伸到笔记本<code class="fe pe pf pg ow b">cartoongan/notebooks/CartoonGAN.ipynb</code>上，将输入图像路径更改为您的测试图像。这个笔记本调用<code class="fe pe pf pg ow b">cartoongan/test_from_code.py</code>脚本进行转换。</p><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="8b57" class="lx ly it ow b gy pa pb l pc pd">cd cartoongan/notebooks<br/>jupyter notebook</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/d2120f6c48ffcf18fb0ba6d6c127ef86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QNSCw1ktk7U5DPk3cVvrAA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在本地测试卡通——作者截图</p></figure><p id="df9e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">transform方法使用一个<code class="fe pe pf pg ow b">load_size</code>参数来调整输入图像的大小，以便加速转换。如果将其设置为较高的值，结果看起来会更好，但处理时间会更长。在整个项目中，我们将<code class="fe pe pf pg ow b">load_size</code>设为450。</p><p id="0777" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里是一些用800的<code class="fe pe pf pg ow b">load_size</code>得到的结果。</p><div class="kj kk kl km gt ab cb"><figure class="ol kn pi on oo op oq paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/c2360606e64f7e69acae607a2f6a84cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*sZlseQp-tg0mVujskwsIfA.jpeg"/></div></figure><figure class="ol kn pj on oo op oq paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/f9b290b982e34bddeb89bd2b07a7c9ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*CyZwN0dJqWFeFh4jVOLQtw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk pk di pl ot translated">Anthony DELANOIX在Unsplash上拍摄的照片(左)-转换后的图像(右)</p></figure></div><div class="ab cb"><figure class="ol kn pm on oo op oq paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/0b6307c62869d285fd983262aa5b432c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*abMNQjLH57Ur6h5Z3Lhskg.jpeg"/></div></figure><figure class="ol kn pn on oo op oq paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/4745aa3d5ff49645c35069eec1a89c1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*xj2dOz7KIQxu9_psXemTIg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk or di os ot translated">克里斯蒂安·加比在Unsplash上拍摄的照片(左)——转换后的图像(右)</p></figure></div><p id="eac0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以在YouTube上观看这一部分，了解更多关于GANs、CartoonGAN模型以及如何构建用于转换图像的脚本<code class="fe pe pf pg ow b">test_from_code.py</code>的信息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">第1部分—卡通人物模型(作者提供的视频)</p></figure><h1 id="5cb1" class="np ly it bd lz nq og ns mc nt oh nv mf jz oi ka mi kc oj kd ml kf ok kg mo nz bi translated">2.使用AWS Lambda在无服务器API上部署CartoonGAN</h1><p id="5567" class="pw-post-body-paragraph ky kz it la b lb ms ju ld le mt jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">本节的目标是在无服务器架构上部署CartoonGAN模型，以便可以通过API端点从互联网上的任何地方请求它。</p><h2 id="f144" class="lx ly it bd lz ma mb dn mc md me dp mf lh mg mh mi ll mj mk ml lp mm mn mo mp bi translated">为什么无服务器架构如此重要？</h2><p id="147d" class="pw-post-body-paragraph ky kz it la b lb ms ju ld le mt jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">例如，在使用Lambda函数的无服务器架构中，您不必自己提供服务器。大致来说，您只需编写将要执行的代码并列出其依赖项，AWS将自动为您管理服务器并负责基础设施。</p><p id="3b88" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这有很多好处:</p><ol class=""><li id="bbcb" class="mq mr it la b lb lc le lf lh od ll oe lp of lt po my mz na bi translated"><strong class="la iu">成本效率</strong>:你不用的时候不用花钱买无服务器架构。相反，当您有一台EC2机器正在运行并且不处理任何请求时，您仍然需要为此付费。</li><li id="e784" class="mq mr it la b lb nb le nc lh nd ll ne lp nf lt po my mz na bi translated"><strong class="la iu">可伸缩性</strong>:如果一个无服务器应用程序开始同时有大量请求，AWS将通过分配更多的能力来管理负载，从而对其进行扩展。如果您让自己使用EC2实例管理负载，您可以通过手动分配更多的机器并创建一个负载平衡器来做到这一点。</li></ol><p id="d0ba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当然，无服务器架构不可能完全适合任何用例。在某些情况下，它们根本不实用(需要实时或快速响应、使用WebSockets、繁重的处理等)。).</p><p id="e25c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于我经常构建机器学习模型并将它们集成到web应用程序中只是为了进行推理，所以我发现无服务器架构在这些特定的用例中很有趣。</p><h2 id="fd3f" class="lx ly it bd lz ma mb dn mc md me dp mf lh mg mh mi ll mj mk ml lp mm mn mo mp bi translated">卡通化工作流程</h2><p id="6fd1" class="pw-post-body-paragraph ky kz it la b lb ms ju ld le mt jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">在部署lambda函数之前，我们先来看看应用的架构:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/86958f328a5f649c3938b42c7b04c853.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kqXrvxRiDDCHWoLHXldLBQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">卡通化背后的建筑(作者图片)</p></figure><p id="b44f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在右侧，我们有一个内置在React中的客户端，在左侧，我们有一个部署在无服务器AWS架构上的后端。</p><p id="3d76" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">后端和前端通过HTTP请求相互通信。工作流程如下:</p><ul class=""><li id="96f8" class="mq mr it la b lb lc le lf lh od ll oe lp of lt mx my mz na bi translated">客户端通过POST请求发送图像。</li><li id="5289" class="mq mr it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">然后通过API网关接收图像。</li><li id="20e3" class="mq mr it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">API Gateway触发Lambda函数执行，并将图像传递给它。</li><li id="e3ef" class="mq mr it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">Lambda函数开始运行:它首先从S3获取预先训练好的模型，然后在接收到的图像上应用样式转换。</li><li id="268a" class="mq mr it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">一旦Lambda函数运行完毕，它会再次通过API Gateway将转换后的图像发送回客户端。</li></ul><h2 id="54a9" class="lx ly it bd lz ma mb dn mc md me dp mf lh mg mh mi ll mj mk ml lp mm mn mo mp bi translated">使用无服务器框架进行部署</h2><p id="98c3" class="pw-post-body-paragraph ky kz it la b lb ms ju ld le mt jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">我们将使用<a class="ae lv" href="https://www.serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器</a>框架，一个自动化部署到AWS、Azure、Google Cloud等的开源工具，通过将它编写为YAML文件来定义和部署这个架构。</p><p id="8ee7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将基础设施写成代码，这难道不酷吗？</p><p id="9734" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是要遵循的步骤:</p><p id="f1a2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">1.在您的计算机上安装无服务器框架。</p><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="be99" class="lx ly it ow b gy pa pb l pc pd">npm install -g serverless</span></pre><p id="c572" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2.在AWS上创建一个具有管理员权限的IAM用户，并将其命名为<code class="fe pe pf pg ow b">cartoonify</code>。然后用这个用户的凭证配置serverless(我就不给你看我的了——放你的吧，伙计)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pp nh l"/></div></figure><p id="8cbb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">3.引导一个无服务器项目，在这个项目的根目录下有一个Python模板。</p><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="6a67" class="lx ly it ow b gy pa pb l pc pd">serverless create --template aws-python --path backend</span></pre><p id="8728" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">4.安装两个无服务器插件来管理lambda依赖项并防止Lambda函数冷启动:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pp nh l"/></div></figure><p id="2727" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">5.在<code class="fe pe pf pg ow b">backend</code>中创建一个名为<code class="fe pe pf pg ow b">network</code>的文件夹，并将以下两个文件放入其中:</p><ul class=""><li id="aefb" class="mq mr it la b lb lc le lf lh od ll oe lp of lt mx my mz na bi translated"><code class="fe pe pf pg ow b">Transformer.py</code>:保存生成器模型架构的脚本。</li><li id="7878" class="mq mr it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">一片空白<code class="fe pe pf pg ow b">__init__.py</code></li></ul><p id="4523" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">6.用以下部分修改<code class="fe pe pf pg ow b">serverless.yml</code>文件:</p><ul class=""><li id="bc58" class="mq mr it la b lb lc le lf lh od ll oe lp of lt mx my mz na bi translated">provider部分，我们在这里设置提供者、运行时和访问bucket的权限。请注意，您必须指定自己的S3存储桶。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pp nh l"/></div></figure><ul class=""><li id="fbb2" class="mq mr it la b lb lc le lf lh od ll oe lp of lt mx my mz na bi translated">我们配置插件的自定义部分:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pp nh l"/></div></figure><ul class=""><li id="f4a1" class="mq mr it la b lb lc le lf lh od ll oe lp of lt mx my mz na bi translated">我们从生产中排除不必要的文件夹的包部分:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pp nh l"/></div></figure><ul class=""><li id="bad3" class="mq mr it la b lb lc le lf lh od ll oe lp of lt mx my mz na bi translated">functions部分，我们创建Lambda函数，配置它，并定义调用它的事件。在我们的例子中，lambda函数由路径<code class="fe pe pf pg ow b">transform</code>上的API Gateway上的post请求触发。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pp nh l"/></div></figure><ul class=""><li id="41d7" class="mq mr it la b lb lc le lf lh od ll oe lp of lt mx my mz na bi translated">列出外部插件的插件部分:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pp nh l"/></div></figure><p id="05fc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">7.列出<code class="fe pe pf pg ow b">requirements.txt</code>内部的依赖关系(与<code class="fe pe pf pg ow b">serverless.yml</code>同级)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pp nh l"/></div></figure><p id="5139" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">8.在<code class="fe pe pf pg ow b">backend</code>中创建一个<code class="fe pe pf pg ow b">src</code>文件夹，并将<code class="fe pe pf pg ow b">handler.py</code>放入其中以定义lambda函数。然后修改<code class="fe pe pf pg ow b">handler.py</code>。</p><p id="a345" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，添加导入:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pp nh l"/></div></figure><p id="9706" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe pe pf pg ow b">handler.py</code>中定义两个函数:</p><ul class=""><li id="36fa" class="mq mr it la b lb lc le lf lh od ll oe lp of lt mx my mz na bi translated"><code class="fe pe pf pg ow b">img_to_base64_str</code>将二进制图像转换为base64字符串</li><li id="0b9d" class="mq mr it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated"><code class="fe pe pf pg ow b">load_models</code>将四个预先训练好的模型载入字典，然后保存在内存中</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pp nh l"/></div></figure><p id="2a08" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，将由API网关触发的<code class="fe pe pf pg ow b">lambda_handler</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pp nh l"/></div></figure><p id="0075" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在你完成了。后端的文件结构现在应该如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/498fcb059850be185c4c506ce90968b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*U2mEzFTCPX4WFiool3Nr7A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">后端文件夹的文件结构(图片由作者提供)</p></figure><p id="b478" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">9.部署前启动Docker。</p><p id="beeb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">10.部署lambda函数。</p><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="2747" class="lx ly it ow b gy pa pb l pc pd">cd backend/<br/>sls deploy</span></pre><p id="be82" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">部署可能需要10分钟，所以去拿一个☕️.</p><p id="56fb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里发生的事情，除了其他事情之外，是Docker将构建Lambda部署包的映像，然后Serverless将在上传到S3之前提取这个环境的依赖项。</p><p id="5763" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦lambda函数部署完毕，系统会提示您输入可以请求的API <strong class="la iu"> </strong>的URL。</p><p id="489e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请访问Jupyter notebook，通过加载图像、将其转换为base64并将其放入有效载荷中进行测试。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pr"><img src="../Images/66334378b1aa246f275bd38d544407c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cVpRVj5WMdstWPbTM5xytA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">API演示—(作者截图)</p></figure><p id="4f4a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想按部就班地学习这一部分，这样你就不会错过任何东西，你可以在YouTube上观看。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">第2部分—在AWS Lambda上部署(作者提供的视频)</p></figure><h1 id="b0dd" class="np ly it bd lz nq og ns mc nt oh nv mf jz oi ka mi kc oj kd ml kf ok kg mo nz bi translated">3.构建一个React接口</h1><p id="6a76" class="pw-post-body-paragraph ky kz it la b lb ms ju ld le mt jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">本节将介绍如何构建一个简单的React接口来与模型进行交互。</p><p id="2d4d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望这个界面尽可能对用户友好，以一种非常简单的方式可视化样式转换。</p><p id="d496" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望找到这个漂亮的React组件，它允许你并排比较两张图片，并通过滑动光标从一张图片切换到另一张图片。</p><p id="015e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在运行React应用程序并构建它之前，您需要指定刚刚部署的模型的API URL。进入<code class="fe pe pf pg ow b">fontend/src/api.js</code>并更改<code class="fe pe pf pg ow b">baseUrl</code>的值。</p><ul class=""><li id="820c" class="mq mr it la b lb lc le lf lh od ll oe lp of lt mx my mz na bi translated">要在本地运行React应用程序:</li></ul><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="9cef" class="lx ly it ow b gy pa pb l pc pd">cd frontend/<br/>yarn install<br/>yarn start</span></pre><p id="4729" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将在<a class="ae lv" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>开始。</p><ul class=""><li id="67b8" class="mq mr it la b lb lc le lf lh od ll oe lp of lt mx my mz na bi translated">要在部署到Netlify之前构建应用程序:</li></ul><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="e298" class="lx ly it ow b gy pa pb l pc pd">yarn build</span></pre><p id="ddc5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将创建一个<code class="fe pe pf pg ow b">build/</code>文件夹，其中包含要在Netlify上提供的应用程序的构建版本。</p><p id="516c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以在YouTube上观看这一部分，以了解代码的结构以及正在使用的其他React组件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">第3部分——构建一个React接口(视频由作者提供)</p></figure><h1 id="1054" class="np ly it bd lz nq og ns mc nt oh nv mf jz oi ka mi kc oj kd ml kf ok kg mo nz bi translated">4.在Netlify上部署React应用程序</h1><p id="49cb" class="pw-post-body-paragraph ky kz it la b lb ms ju ld le mt jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">在最后一节中，我们将介绍前端接口的部署。</p><p id="1ffc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有许多方法可以部署React应用程序，以便它可以在互联网上运行，任何人都可以访问它。其中一个是使用<a class="ae lv" href="https://netlify.com" rel="noopener ugc nofollow" target="_blank"> Netlify </a>:一个伟大的平台，可以在许多框架(React、Vue、Gatsby等)中自动构建和部署应用程序。)</p><ul class=""><li id="211f" class="mq mr it la b lb lc le lf lh od ll oe lp of lt mx my mz na bi translated">为了能够在Netlify上部署，您需要一个帐户。这是免费的:前往<a class="ae lv" href="https://app.netlify.com/" rel="noopener ugc nofollow" target="_blank"> Netlify </a>注册。</li><li id="637f" class="mq mr it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">然后，您需要安装netlify-cli:</li></ul><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="3c6c" class="lx ly it ow b gy pa pb l pc pd">npm install netlify-cli -g</span></pre><ul class=""><li id="e2f4" class="mq mr it la b lb lc le lf lh od ll oe lp of lt mx my mz na bi translated">使用您的帐户验证Netlify客户端:</li></ul><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="2e75" class="lx ly it ow b gy pa pb l pc pd">netlify login</span></pre><ul class=""><li id="ce1a" class="mq mr it la b lb lc le lf lh od ll oe lp of lt mx my mz na bi translated">并部署:</li></ul><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="281a" class="lx ly it ow b gy pa pb l pc pd">cd app/<br/>netlify deploy</span></pre><p id="7de9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Netlify将要求您提供构建文件夹(输入“build”)和应用程序的自定义名称(这将显示为netlify.com的子域)。我已经选择了“卡通化”，<strong class="la iu"> </strong>但是你可以选择另一个。</p><p id="afe5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这应该就是了！现在您的应用程序已上线！</p><p id="92a4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是等等！这个网址有些问题:它的前缀是字母数字代码——我不想这样，对吗？</p><p id="3379" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">那是因为你部署了一个草稿URL！</p><p id="f3df" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要获得干净的URL，您必须通过指定prod选项来进行部署:</p><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="6c5f" class="lx ly it ow b gy pa pb l pc pd">netlify deploy --prod</span></pre><p id="9736" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以在YouTube上观看这一部分的现场演示，以了解在Netlify上部署有多容易。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">第4部分—在Netlify上部署React(视频由作者提供)</p></figure></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h1 id="5468" class="np ly it bd lz nq nr ns mc nt nu nv mf jz nw ka mi kc nx kd ml kf ny kg mo nz bi translated">5.下一个:想投稿？</h1><p id="b8e4" class="pw-post-body-paragraph ky kz it la b lb ms ju ld le mt jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">如果你已经做到这一步，我真诚地感谢你的时间！</p><p id="ca3d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你喜欢这个项目，想改善它，请自便:我随时欢迎拉式请求，这是<a class="ae lv" href="https://github.com/ahmedbesbes/cartoonify" rel="noopener ugc nofollow" target="_blank">项目</a>的回购。</p><p id="7ae0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你有一个机器学习项目，你需要在云上快速部署一个API，并通过一个定制的前端请求它，这个项目应该是一个样板文件来启动你的工作，所以请随意重用代码。</p><p id="7565" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">黑客快乐！</p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h1 id="9f81" class="np ly it bd lz nq nr ns mc nt nu nv mf jz nw ka mi kc nx kd ml kf ny kg mo nz bi translated">新到中？您可以每月订阅5美元，并解锁无限的文章— <a class="ae lv" href="https://ahmedbesbes.medium.com/membership" rel="noopener">点击此处。</a></h1></div></div>    
</body>
</html>