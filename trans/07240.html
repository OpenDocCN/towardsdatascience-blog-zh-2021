<html>
<head>
<title>Access Google Drive Using Google Colab Running an R Kernel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用运行R内核的Google Colab访问Google Drive</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/access-google-drive-using-google-colab-running-an-r-kernel-3736db7835?source=collection_archive---------15-----------------------#2021-07-01">https://towardsdatascience.com/access-google-drive-using-google-colab-running-an-r-kernel-3736db7835?source=collection_archive---------15-----------------------#2021-07-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="26ed" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a>，云计算</h2><div class=""/><div class=""><h2 id="646b" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">从Google Drive文件或直接从web URLs导入数据</h2></div><p id="8266" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">本文描述了将Google协同实验室与R内核结合使用的一步一步的方法。</p><p id="cec9" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">作为一名工程师和生物统计学家，我主要用python和r编写代码。在过去的六个月里，我决定，对于小型项目，通过Google Drive和Google Colaboratory与他人共享代码是最快的。对于小型的非正式项目来说，访问共享云存储的便利性是无与伦比的。避免共享服务器访问、工作目录更新和Git混乱等问题可以节省时间，特别是当合作者对数据科学和编程语言的熟悉程度/流畅性不同时。</p></div><div class="ab cl ln lo hx lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="im in io ip iq"><p id="de49" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">这种方法建立在之前的一篇媒体文章的基础上，在这里附上<a class="ae lu" rel="noopener" target="_blank" href="/how-to-use-r-in-google-colab-b6e02d736497"/>。它作为一个灵感和最初的指南；然而，对我来说，它抛出了错误，这似乎是Colab版本控制工件。在解决了一些小问题后，我能够通过R内核从Google协作笔记本文件成功访问我的Google Drive文件存储。完整的源代码被上传到<a class="ae lu" href="https://github.com/katewall/medium_tutorials/blob/main/210630_Medium_ColabwithR.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>。</p><p id="0b72" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">请记住，可以使用<em class="lv"> rmagic </em>函数在单个单元中运行R。因此，R内核并不是在Colab中使用R的唯一方式。但是，如果您希望笔记本适合以后的本地使用，或者确保其他人可以复制您的R代码，您可能希望将整个内核更改为R，但仍然使用基于浏览器的云实例。</p><p id="8b16" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">为什么要在Colab中使用R:</p><ol class=""><li id="76cd" class="lw lx it kt b ku kv kx ky la ly le lz li ma lm mb mc md me bi translated">许多专门的统计包都是用R而不是python构建的。</li><li id="a933" class="lw lx it kt b ku mf kx mg la mh le mi li mj lm mb mc md me bi translated">r有简单的语法来获得漂亮的视觉效果。</li><li id="30a6" class="lw lx it kt b ku mf kx mg la mh le mi li mj lm mb mc md me bi translated">对于许多数据科学角色，你需要既懂R又懂python。</li></ol><p id="b614" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在Colab中运行R时会出现什么问题:</p><ol class=""><li id="8429" class="lw lx it kt b ku kv kx ky la ly le lz li ma lm mb mc md me bi translated">挂载你的驱动器只能在python运行时下工作。</li><li id="05f0" class="lw lx it kt b ku mf kx mg la mh le mi li mj lm mb mc md me bi translated">安装驱动器是使用Google Colab的关键驱动因素之一。</li><li id="8f5b" class="lw lx it kt b ku mf kx mg la mh le mi li mj lm mb mc md me bi translated">安装的驱动器提供了无尽的功能，试图弄清楚这一点让我发疯。</li></ol><p id="e99a" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">使用默认设置和默认python内核，在Colab中挂载Google Drive没有问题。很简单。点击阅读几种方法<a class="ae lu" href="https://colab.research.google.com/notebooks/io.ipynb" rel="noopener ugc nofollow" target="_blank">。或者单程</a><a class="ae lu" rel="noopener" target="_blank" href="/downloading-datasets-into-google-drive-via-google-colab-bcb1b30b0166">这里</a>。或者只需点击我在下面截图中显示的按钮。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mk"><img src="../Images/0d259f2f36e72e6854459bc74554dcfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/0*Q4BuMqWPLbktiypG"/></div></div><p class="mw mx gj gh gi my mz bd b be z dk translated">Google Colab中最棒的功能。图片作者。</p></figure><p id="863d" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">但是，在您更改内核后，该功能将停止工作。因此，你可能会发现自己需要遵循我提出的三步计划来维护对你的Google Drive文件的访问。请注意，这需要一些欺骗和几分钟的运行时间。运行安装程序块会稍微慢一些，但是值得等待。幸运的是，他们只有三个人。</p><h1 id="2b88" class="na nb it bd nc nd ne nf ng nh ni nj nk ki nl kj nm kl nn km no ko np kp nq nr bi translated">步骤0。</h1><p id="1567" class="pw-post-body-paragraph kr ks it kt b ku ns kd kw kx nt kg kz la nu lc ld le nv lg lh li nw lk ll lm im bi translated">打开浏览器，进入<a class="ae lu" href="https://colab.to/r" rel="noopener ugc nofollow" target="_blank">https://colab.to/r</a>。你会看到通过运行时&gt;改变运行时类型，R内核已经被选中。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/d8632dd47d5258a5ec1cba33f982af69.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/0*wWeqYhEujnwlrR7C"/></div><p class="mw mx gj gh gi my mz bd b be z dk translated">如何检查你的运行时设置？图片作者。</p></figure><h1 id="a8e7" class="na nb it bd nc nd ne nf ng nh ni nj nk ki nl kj nm kl nn km no ko np kp nq nr bi translated">步骤一.初始化</h1><p id="20dc" class="pw-post-body-paragraph kr ks it kt b ku ns kd kw kx nt kg kz la nu lc ld le nv lg lh li nw lk ll lm im bi translated">安装<a class="ae lu" href="https://cran.r-project.org/web/packages/httpuv/httpuv.pdf" rel="noopener ugc nofollow" target="_blank"> Httpuv </a>库。它允许R代码与HTTP和WebSocket客户端交互，以服务来自R进程的web流量。</p><pre class="ml mm mn mo gt ny nz oa ob aw oc bi"><span id="e983" class="od nb it nz b gy oe of l og oh">install.packages(“googledrive”) <em class="lv">#only need to install occasionally</em> install.packages(“httpuv”) <br/>library(“googledrive”) <br/>library(“httpuv”)</span></pre><p id="5d0a" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">另外，更改本地路径。这在偶尔更新时会改变，所以这一行可能会过时。</p><pre class="ml mm mn mo gt ny nz oa ob aw oc bi"><span id="891f" class="od nb it nz b gy oe of l og oh"><strong class="nz jd">if</strong> (file.exists("/usr/local/lib/python3.7/dist-packages/google/colab/_ipython.py")) { <em class="lv">#may update python version  <br/>                                       #occasionally</em><br/>  install.packages("R.utils")<br/>  library("R.utils")<br/>  library("httr")<br/>  my_check &lt;- function() {<strong class="nz jd">return</strong>(TRUE)}<br/>  reassignInPackage("is_interactive", pkgName = "httr", my_check) <br/>  options(rlang_interactive=TRUE)<br/>}</span></pre><p id="e95b" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">单独运行这个程序块。不要与前面的块合并，因为，虽然看起来没问题，但是合并两个块会抛出你不相信的错误。</p><pre class="ml mm mn mo gt ny nz oa ob aw oc bi"><span id="92d7" class="od nb it nz b gy oe of l og oh">drive_auth(use_oob = TRUE, cache = FALSE)</span></pre><p id="7bce" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">现在，您已经初始化了Google Drive和Google Colab会话之间的连接。现在你有两个选择。</p><blockquote class="oi oj ok"><p id="f3ec" class="kr ks lv kt b ku kv kd kw kx ky kg kz ol lb lc ld om lf lg lh on lj lk ll lm im bi translated">如果您想从一个web URL直接下载一个文件到本地Google Colab会话，那么请转到第二步。</p><p id="c8d3" class="kr ks lv kt b ku kv kd kw kx ky kg kz ol lb lc ld om lf lg lh on lj lk ll lm im bi translated">如果您想从您的Google Drive文件夹下载一个文件到本地Colab会话，请转到步骤III。</p></blockquote><h1 id="a1ad" class="na nb it bd nc nd ne nf ng nh ni nj nk ki nl kj nm kl nn km no ko np kp nq nr bi translated">第二步。从Web直接下载到Colab会话的方法</h1><p id="811a" class="pw-post-body-paragraph kr ks it kt b ku ns kd kw kx nt kg kz la nu lc ld le nv lg lh li nw lk ll lm im bi translated">首先检查本地会话的工作目录。</p><pre class="ml mm mn mo gt ny nz oa ob aw oc bi"><span id="2a8e" class="od nb it nz b gy oe of l og oh">getwd()<br/>&gt;&gt;&gt;'/content'</span></pre><p id="a446" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">工作目录是内容文件夹。</p><p id="40b6" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">接下来，下载文件，并解压缩文件。这个特殊的例子是<a class="ae lu" href="https://www.cdc.gov/healthyyouth/data/yrbs/index.htm" rel="noopener ugc nofollow" target="_blank">美国疾病预防控制中心</a>关于健康相关行为的公共数据集，这些行为是导致美国青年和成年人死亡和残疾的主要原因。解压缩会产生一个警告消息，但是如果您检查文件目录列表，您下载的解压缩文件将会出现。</p><pre class="ml mm mn mo gt ny nz oa ob aw oc bi"><span id="8ed2" class="od nb it nz b gy oe of l og oh">download.file('https://data.cdc.gov/api/views/vba9-s8jp/rows.csv?<br/>           accessType=DOWNLOAD','/content/dnld_direct_from_web.csv')</span><span id="f169" class="od nb it nz b gy oo of l og oh">unzip(zipfile="/content/downloaded.zip", exdir=".")<br/>&gt;&gt;&gt;Warning message in unzip(zipfile = "/content/downloaded.zip", &gt;&gt;&gt;exdir = "."):<br/>&gt;&gt;&gt;“error 1 in extracting from zip file”</span></pre><p id="4a1c" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">既然它是本地的，您可以使用典型的R import函数读入csv或其他文件类型。</p><pre class="ml mm mn mo gt ny nz oa ob aw oc bi"><span id="c3ac" class="od nb it nz b gy oe of l og oh">library(readr) <br/>a &lt;- read.csv(‘/content/dnld_direct_from_web.csv’) <br/>head(a)</span></pre><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div class="gh gi op"><img src="../Images/5f36f80767dec42813f8ff4d15ab8098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/0*5TL_V6IoeGNuxJSo"/></div><p class="mw mx gj gh gi my mz bd b be z dk translated">产生R数据帧。图片作者。</p></figure><h1 id="3324" class="na nb it bd nc nd ne nf ng nh ni nj nk ki nl kj nm kl nn km no ko np kp nq nr bi translated">第三步。方法从您的Google Drive下载到Colab会话</h1><p id="304f" class="pw-post-body-paragraph kr ks it kt b ku ns kd kw kx nt kg kz la nu lc ld le nv lg lh li nw lk ll lm im bi translated">这使用了googledrive包。您可以使用drive_get函数获取该文件。接下来，您必须使用drive_download函数显式下载该文件。</p><pre class="ml mm mn mo gt ny nz oa ob aw oc bi"><span id="83df" class="od nb it nz b gy oe of l og oh">x &lt;- drive_get("~/Folder1/Folder2/Nutrition__Physical_Activity__<br/>              and_Obesity_-_Youth_Risk_Behavior_<br/>              Surveillance_System.csv")<br/>drive_download(x)<br/>z &lt;- read.csv("/content/Nutrition__Physical_Activity__and_Obesity_-<br/>              _Youth_Risk_Behavior_Surveillance_System.csv")<br/>head(z)</span></pre><p id="c146" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">类似地，这个文件现在已经到达您的文件目录。既然它是本地的，您可以使用典型的R import函数读入csv或其他文件类型。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div class="gh gi op"><img src="../Images/5f36f80767dec42813f8ff4d15ab8098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/0*5TL_V6IoeGNuxJSo"/></div><p class="mw mx gj gh gi my mz bd b be z dk translated">再次得到R数据帧！图片作者。</p></figure><p id="5e63" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">哒哒！我希望这篇教程能让你免去我所招致的头痛。请让我知道你是否找到了这个功能的更好的实现！源代码上传到<a class="ae lu" href="https://github.com/katewall/medium_tutorials/blob/main/210630_Medium_ColabwithR.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>。</p></div></div>    
</body>
</html>