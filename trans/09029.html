<html>
<head>
<title>To weigh or not to weigh — this is the Average question</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">称重还是不称重——这是一个普通的问题</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/to-weigh-or-not-to-weigh-this-is-the-average-question-ece33fad9180?source=collection_archive---------22-----------------------#2021-08-20">https://towardsdatascience.com/to-weigh-or-not-to-weigh-this-is-the-average-question-ece33fad9180?source=collection_archive---------22-----------------------#2021-08-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0d4e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">平均值是一个简单的计算。但有时，还有更多需要探索。让我们浏览一下这个主题，并在Power BI中实现这些计算。</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/2e87e507b6183f93c927c8a0efc0d646.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3XGMgE0QSXuhMr8Y"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated"><a class="ae kz" href="https://unsplash.com/@strivingblogger?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">奋斗博主</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="c4f0" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">介绍</h1><p id="bfc6" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">我在学校学会了如何计算平均值:取一串数字，对它们求和，然后用结果除以数字的个数，就大功告成了。</p><p id="2794" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这个计算听起来很简单。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mt"><img src="../Images/fcd4caa7745cad4068a8a0d17af38a68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qFrJ1bTaDm6Wp6u8"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">巴勃罗·阿罗约在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="53a4" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">几天前我发现，平均计算中可能有比预期多得多的东西。</p><p id="978f" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在本文中，我将向您展示平均值计算的一些变体。然后我切换到Power BI在DAX中执行这些计算。</p><h1 id="c60d" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">你介意做一些数学吗？</h1><p id="26c3" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">让我们看看下表中的虚拟销售数据:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mu"><img src="../Images/899cecb489100e37d16d315c535c30b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dwgh7C7Vyrn6T55GmqGGZg.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图1 —示例数据(图片由作者提供)</p></figure><p id="75c6" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我想按国家和年份计算订单的平均值。最后，我想计算一个总体平均值。</p><p id="48a7" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">好的，接下来让我们将“销售额”列中的值除以订单数:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mv"><img src="../Images/cbae40c0469e350a801108691ba4d0a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t8MHdV8jsz7uW4hcgLtwyA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图2 —每个国家和年份的平均值(图片由作者提供)</p></figure><p id="fea0" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在令人毛骨悚然的问题是:我应该如何计算总数？</p><h1 id="7ec1" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">计算平均值</h1><p id="1c43" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">原来有两种方式，导致了两种不同的结果。</p><p id="5a4c" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">为了缩短表格，我仅按照2019年来过滤表格:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mw"><img src="../Images/fa740775c778505881c05f6f80abf2ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jG7q7oqvYPIpuEXdnn0VqA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图3 —两个平均值(图片由作者提供)</p></figure><p id="24d1" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">第一个平均值(549.81)是“订单平均值”列中所有值的平均值。</p><p id="2a77" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">第二个平均值(550.81)的计算方法是将总销售额除以总订单数。</p><p id="a0aa" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">哪个是正确的？</p><p id="cf16" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">嗯，两个都是对的。<br/>看你想算什么了。</p><p id="4120" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">第一个平均值是四个值的简单平均值，第二个平均值由每个国家的订单数加权。一个国家的订单数量越多，这个国家对结果的影响就越大。</p><p id="b96b" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">让我们看看2020年加权平均的更好例子:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mx"><img src="../Images/a190bac66ef51cd6e67a47c3aaad095a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K5uVIiGrwM_GChYQQIprzQ.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图4—2020年的平均值(图片由作者提供)</p></figure><p id="44e5" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在这里，您可以看到第二个平均值比第一个平均值高，因为美国的订单数远远高于第一个平均值。因此，美国的高阶计数对结果的影响更大。</p><p id="8f05" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我将这个结果称为“加权平均”。</p><p id="2955" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">如果您想消除订单数量的权重，您必须使用第一个平均值。姑且称之为“未加权平均值”。</p><p id="b1bc" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">等等，我们还没说完。</p><h1 id="7dec" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">给平均值增加额外的权重</h1><p id="c1de" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">有时，您需要通过向数据添加权重或等级来操纵计算。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi my"><img src="../Images/6be4319035645ce0e65fbc93701e3084.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nuhCPph30O1HFWgwkZldnw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图5 —具有重要性的样本数据(图片由作者提供)</p></figure><p id="e179" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我引入了“重要性”列来操纵结果。</p><p id="641d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这一栏标明哪个国家最重要，必须影响结果。</p><p id="9834" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我们将使用以下公式来计算结果:</p><p id="cd83" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">总销售额=总和(销售额*重要性)</p><p id="e1d0" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">订单总数=总和(订单总数*重要性)</p><p id="f13f" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">之后，我们可以计算平均值来得到结果。</p><p id="a5a0" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">结果如下:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mz"><img src="../Images/e7ff284d2601ccba17e0007f60495d76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7uPud8_akpMFsqkdQOOTCQ.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图6-2019年重要性平均值(作者图片)</p></figure><p id="2d75" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">如您所见，加权平均结果比以前低得多，因为我们使用了“重要性”列来操纵每个国家的权重。由于法国和意大利的重要性最高，该值更接近其平均订单值。</p><p id="ee82" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">未加权平均值与销售额之间的关系相同，订单数保持不变。甚至在与重要性相乘之后。</p><p id="ca59" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">权重因子是强调数据部分与您选择的方面的重要性或相关性的适当方法。</p><p id="e397" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在我们可以切换到Power BI，在DAX中实现这些计算。</p><h1 id="7412" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">在Power BI中实现</h1><p id="ac39" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated"><strong class="lu iu">加权平均</strong></p><p id="90ce" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我们可以用一个简单的方法来实现加权平均:</p><pre class="kk kl km kn gt na nb nc nd aw ne bi"><span id="c9fa" class="nf lb it nb b gy ng nh l ni nj">Average Sales Amount per Order =<br/>DIVIDE( [Online Sales (By Customer)]<br/>      ,[Order Count (By Customer)]<br/>      )</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nk"><img src="../Images/1fcf6955de5e5186ec4d70845d7d03a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XOW7lLr_vFRsXEgDuWa5HA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图7 —功率BI的加权平均值(图片由作者提供)</p></figure><p id="34bb" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">过滤器上下文确保总平均值的计算是正确的:</p><p id="3929" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi">934'403'814.18 / 486'949 = 1'918.894</p><p id="8228" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated"><strong class="lu iu">未加权平均值</strong></p><p id="c2e8" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">然而，计算未加权平均值则是另一回事。</p><p id="beb8" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我的第一个想法是预先计算所有的平均值，然后根据它们计算平均值。</p><p id="39b0" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">该度量必须识别筛选器上下文是否包含国家/地区，如果包含，则必须将销售额除以订单计数。</p><p id="d395" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">一段时间后，我发现我们可以通过以下措施在DAX中解决这个问题:</p><pre class="kk kl km kn gt na nb nc nd aw ne bi"><span id="1971" class="nf lb it nb b gy ng nh l ni nj">Average per Country =<br/>    AVERAGEX(VALUES(‘Geography’[Region Country])<br/>        ,DIVIDE([Online Sales (By Customer)]<br/>               ,[Order Count (By Customer)] )<br/>        )</span></pre><p id="05ef" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">结果看起来像这样:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nl"><img src="../Images/72730b328ed783dcbf8e07ac521388c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ypecIam8T6A9BSN9PQQdFg.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图8 —每个国家的平均值(图片由作者提供)</p></figure><p id="6e80" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">当你把这个表导出到Excel中，就可以计算出每笔订单的平均销售额，你会得到14'183.83。</p><p id="2357" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">当您想要将状态添加到表中时，棘手的部分就来了:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nm"><img src="../Images/34c91562ebc49841716de0a0ec2b37bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RJLtO5RZFUVVpbtXlYLEsw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图9 —每个国家的平均水平(按作者分类的图片)</p></figure><p id="3683" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">当您现在导出表格时，平均结果将会不同。</p><p id="766c" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">为了得到正确的结果，我们必须向模型中添加一个新的度量:</p><pre class="kk kl km kn gt na nb nc nd aw ne bi"><span id="244d" class="nf lb it nb b gy ng nh l ni nj">Average per Country and State =<br/>    AVERAGEX(SUMMARIZE(‘Geography’<br/>                ,‘Geography’[Region Country]<br/>                ,‘Geography’[State Province])<br/>        ,DIVIDE([Online Sales (By Customer)]<br/>                ,[Order Count (By Customer)] )<br/>        )</span></pre><p id="4ccd" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">该方法将计算每个国家/地区和州的正确值，并且在总体水平上:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nn"><img src="../Images/8d833baeb4af08dc32123b53061e3807.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KUqak4so0Iv_1ttb2wXmwg.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图10 —每个国家和州的平均修正值(图片由作者提供)</p></figure><p id="490d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">同样，这两种方法都是正确的。这取决于你的用户期望什么样的结果。你必须事先和你的利益相关者谈清楚这个问题。</p><p id="1ef8" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated"><strong class="lu iu">加权平均列</strong></p><p id="8fb5" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在我想加一个排名来定义每个国家的重要性。排名越高，这个国家对结果的影响力就越高。</p><p id="cd46" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">为了这个计算，我给每个国家添加了一个任意的排名栏。每个国家的排名在1到6之间:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi no"><img src="../Images/b0a3fe2e1e5f42666c804e3cb012d3ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*hlUwxnh2Klg4YnBmnsD5Tg.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图11-国家排名(作者图片)</p></figure><p id="204c" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在我需要在计算中包括等级:</p><pre class="kk kl km kn gt na nb nc nd aw ne bi"><span id="0934" class="nf lb it nb b gy ng nh l ni nj">Average using Rank =<br/>VAR SalesAmount = SUMX(‘Online Sales’<br/>                        ,’Online Sales’[SalesAmount] *<br/>                        RELATED(‘Customer’[Country Rank])<br/>                        )</span><span id="8ee1" class="nf lb it nb b gy np nh l ni nj">VAR OrderCount = SUMX(‘Online Sales’<br/>                      ,’Online Sales’[First Order Line Count] *<br/>                      RELATED(‘Customer’[Country Rank])<br/>                      )</span><span id="9d63" class="nf lb it nb b gy np nh l ni nj">RETURN<br/>IF(HASONEVALUE(‘Customer’[Region Country])<br/>        ,[Average Sales Amount per Order]<br/>        ,DIVIDE(SalesAmount, OrderCount)<br/>        )</span></pre><p id="745b" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">让我们从这一措施的底部开始:</p><p id="6b14" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我使用IF(hasone value(' Customer '[Region Country])来检查当前的过滤器上下文是否包含一个或多个国家。</p><p id="7e7a" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">如果当前的过滤上下文只包含一个国家，我可以使用[每个订单的平均销售额]来计算每个国家的平均值。这个方法非常有效，并且每一行都提供了正确的值。在这种情况下，是否将州或城市添加到报告中并不重要。结果是一样的。</p><p id="a1f1" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">只要当前过滤上下文包含多个国家，我就需要使用每个国家的排名来计算加权平均值。</p><p id="522b" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我通过使用SUMX将在线销售表中每笔交易的销售额乘以国家排名来进行计算。</p><p id="24b1" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">下图显示了所有测量的结果:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nq"><img src="../Images/4d2dd7097a588723e8d9bfc1eea63aae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zm5VEpPmY1uw_r7O3bE2aw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">图12 —所有度量(作者图片)</p></figure><p id="3386" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">正如您所看到的，Total行上的所有结果都与预期的不同。</p><p id="fb25" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated"><strong class="lu iu">注意:</strong>这是一个可能方法的例子，并没有给出明确的解决方案。根据您的数据和要求，您的解决方案可能与我的不同。</p><h1 id="8e1f" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">其他可能的方法</h1><p id="d8b9" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">如果您需要为一个特定的场景准备度量，准备一个带有预先计算结果的DAX表可能是一个好主意。</p><p id="bff9" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我的示例中使用的Contoso数据模型在Online Sales表中包含1200万行，在Customer表中包含不到20，000行。本例中使用的矩阵计算结果不到一秒钟。</p><p id="337c" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">您的数据可以包含更多的数据，因此可能比我的例子慢。</p><p id="0605" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在这种情况下，DAX表是一个可行的解决方案。这种方法的缺点是其他表不能筛选结果，例如产品组。如果您需要这样做，您需要定义所需的关系，并相应地准备DAX表。</p><p id="8f58" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">注意添加这样的列可能会意外地改变结果。</p><h1 id="a11f" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">结论</h1><p id="d241" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">当我开始写这篇文章时，我已经想到了DAX表的解决方案，因为它看起来很容易准备。</p><p id="7e82" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">但是我不能说我喜欢它，因为这种方法在过滤结果的可能性方面增加了一些限制。</p><p id="f79d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">当我搜索计算加权平均值的可能方法时，我找到了这个网站:<a class="ae kz" href="https://www.wikihow.com/Calculate-Weighted-Average" rel="noopener ugc nofollow" target="_blank">如何在维基上计算加权平均值</a></p><p id="bda3" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">当将这种方法应用于Excel中的示例数据时，结果令我困惑。在与一位数学家同事交谈后，我们发现了计算平均值的不同方法。</p><p id="33ac" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">尽管我已经写到一半了，我还是用我的新知识重新开始写这篇文章。</p><p id="617d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">无论如何，我惊讶地发现，我可以通过不同的方式计算平均值来获得不同的含义。这个发现为我打开了一个新的世界，因为我也需要开始与我的客户讨论这个问题。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mt"><img src="../Images/901e7eddb4adc17be1bb208aff47a6d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OzK4Lr9eXH3b5gLO"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">约翰·巴克利在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="51f8" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">直到现在，我的生活还不够复杂。叹息…</p></div></div>    
</body>
</html>