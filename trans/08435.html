<html>
<head>
<title>How to detect, evaluate and visualize historical drifts in the data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何检测、评估和可视化数据中的历史漂移</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-detect-evaluate-and-visualize-historical-drifts-in-the-data-7b2903c6da4f?source=collection_archive---------28-----------------------#2021-08-03">https://towardsdatascience.com/how-to-detect-evaluate-and-visualize-historical-drifts-in-the-data-7b2903c6da4f?source=collection_archive---------28-----------------------#2021-08-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5dc7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">显然，阴谋和Mlflow</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/32b6169cee1cc7f0d0913eea5e2147e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NU_8JAdc5k5mWPw5.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。</p></figure><p id="1eee" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">TL；DR: </strong>您可以查看数据的历史漂移，以了解您的数据是如何变化的，并选择监控阈值。这里有一个例子，显然，Plotly，Mlflow和一些Python代码。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><p id="f748" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们经常谈论<a class="ae ly" href="https://evidentlyai.com/blog/machine-learning-monitoring-data-and-concept-drift" rel="noopener ugc nofollow" target="_blank">在实时数据上检测漂移</a>。</p><p id="a351" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">目标是检查当前分布是否偏离训练或过去的某个时期。当<a class="ae ly" href="https://evidentlyai.com/blog/evidently-001-open-source-tool-to-analyze-data-drift" rel="noopener ugc nofollow" target="_blank">漂移被检测到</a>时，你知道你的模型在一个相对未知的空间中运行。是时候做点什么了。</p><p id="a392" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是这里有很多细微的差别。漂移是多大的漂移？如果只有10%的特征漂移，我应该在意吗？应该按周看漂移还是按月看漂移？</p><p id="885a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">细节决定成败。答案在很大程度上取决于模型、用例、重新培训的容易程度(或可能性)以及性能下降给你带来的损失。</p><p id="2170" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这里有一个过程可以帮你想清楚。</p><p id="d708" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">再来看历史数据漂移！</p><h1 id="15e0" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">为什么要看过去的数据漂移？</h1><p id="d9af" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">我们的目标是学习漂移动力学。我们的数据过去发生了多大的变化？</p><p id="be1d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这很有用，原因有二:</p><p id="906c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">首先，我们可以了解模型的衰变纲图。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/5e51a72165ffb23ec764945f59438900.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3zcZABCSxMPUtR3KHdSl-g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。</p></figure><p id="3b0f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们分享了一个关于如何提前<a class="ae ly" href="https://evidentlyai.com/blog/retrain-or-not-retrain" rel="noopener ugc nofollow" target="_blank">检查模型再培训需求的类似想法</a>。在那里，我们观察了模型性能如何随时间变化。</p><p id="1d0a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">现在，我们来看看数据是如何变化的。你可以选择其中一个。如果我们知道我们将不得不在生产中等待地面真相标签，那么理解数据漂移就特别有帮助。</strong></p><p id="9650" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">假设数据以恒定的速度变化，我们可以使用这种分析来设定我们的预期。并准备适当的基础设施。</p><p id="efca" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">用例是高度动态的吗？是否应该做好频繁再培训的准备，建立自动流水线？</p><p id="c863" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">其次，这种分析可以帮助我们定义模型监控触发器。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/306cab449a818ccc17b11a1c659c6b63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ux6TJcgqAFSQoUIaDSUOXA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。</p></figure><p id="fbc9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">一旦模型投入生产，我们可能需要检查数据漂移。</strong>我们的触发器应该有多敏感？我们需要发生什么来应对漂移？</p><p id="b60d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要选择阈值和条件，我们需要了解我们的数据在过去是如何变化的。这是一种微妙的平衡！我们不希望有太多的假警报，但我们也希望对有意义的变化做出反应。</p><p id="3653" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以对过去的数据运行几次漂移检查(模拟不同的漂移阈值和监控窗口)并探索结果。</p><p id="bbe1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这里有一个例子来说明如何做到这一点。</p><h1 id="d5ec" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">定义漂移检测逻辑</h1><p id="41b1" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">让我们从Kaggle获取一个自行车共享数据集。我们将使用它来探索过去的数据漂移。你可以在这个<a class="ae ly" href="https://github.com/evidentlyai/evidently/blob/main/evidently/tutorials/historical_drift_visualization.ipynb" rel="noopener ugc nofollow" target="_blank">例子Jupyter笔记本</a>中跟随它。</p><p id="9b85" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在现实生活中，您可以对训练数据进行类似的处理。</p><p id="1244" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了决定我们的漂移检测逻辑，我们应该做一些假设。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/049edcbbec86f48a97cacfc807b8e83a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PDTazAKlKi4Ke3yqg-iw6g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。</p></figure><p id="7652" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">首先，我们要定义比较窗口。</strong></p><p id="957c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">例如，我们可以逐月查看数据。这个选择取决于你对数据的理解。数据是如何产生的？背后的真实世界过程是怎样的？你认为它变化的速度有多快？</p><p id="fe8e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这里有一些提示:</p><ul class=""><li id="a364" class="mx my iq kx b ky kz lb lc le mz li na lm nb lq nc nd ne nf bi translated">如果你的数据有已知的季节性，你可以考虑它。例如，进行一周一周的比较，而不是一天一天的比较，以避免对周末模式反应过度。或者相互比较不同年份的12月份数据。</li><li id="72f6" class="mx my iq kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated"><strong class="kx ir">如果你知道模型退化的速度，就以此为起点</strong>。我们在之前已经分享过<a class="ae ly" href="https://evidentlyai.com/blog/retrain-or-not-retrain" rel="noopener ugc nofollow" target="_blank">这种方法。如果你知道你的模型在一个月内降级，你可以看看周漂移，看看你能提前多长时间预测这种下降，以及它看起来如何。</a></li><li id="1e3a" class="mx my iq kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated"><strong class="kx ir">你可以建立几个漂移“视图”，设定不同的预期。</strong>比如同时看周线和月线漂移，设置不同的阈值。用例定义了它:你可以有多个季节或者其他已知的模式。</li></ul><p id="85a8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你总是可以测试一些假设，看看这会如何改变结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/1f3f26725c8b17aa99184568fcb795a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UN5hOmzpReDWurhHdMf_2Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="84b2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">我们的第二个假设是漂移检测阈值。</strong></p><p id="7be9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以使用统计测试来评估单个要素的漂移，并根据P值来判断结果。</p><p id="00cd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是为了对其进行操作或实现监控触发器，我们通常需要一些“是”或“否”的决定或整个数据集的聚合数。为此，我们可以在统计测试的结果之上实现一些定制的逻辑。</p><p id="663b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">例如，我们可以查看漂移特征的份额</strong>，并且仅当超过50%的漂移特征具有统计上的显著变化时才发出警报。</p><p id="5519" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们还可以操纵统计测试的置信水平。通常的默认值是0.95，但是您可能有理由将其设置为0.99或0.9，例如。</p><p id="fb3d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这里有一些提示:</p><ul class=""><li id="fe1f" class="mx my iq kx b ky kz lb lc le mz li na lm nb lq nc nd ne nf bi translated">您可以只关注关键特性。您可以根据重要性为特征分配不同的权重，或者仅对顶部特征运行漂移检测。并非所有的漂移都是一样的。次要特性的变化通常不会影响关键性能指标。</li><li id="407d" class="mx my iq kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated"><strong class="kx ir">如果你有很多弱项，你可以看看整体漂移。</strong>但是在这种情况下，您可以增加阈值来定义漂移已经发生(根据更高的置信水平和特征数量)。</li></ul><p id="f117" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我们的例子中，我们有几个月的数据。<strong class="kx ir">让我们定义一下我们的假设:</strong></p><ul class=""><li id="e034" class="mx my iq kx b ky kz lb lc le mz li na lm nb lq nc nd ne nf bi translated">我们用第一个月作为训练数据。</li><li id="176f" class="mx my iq kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated">我们逐月进行漂移比较。</li><li id="1056" class="mx my iq kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated">我们将测试单个要素和数据集的漂移。</li><li id="edea" class="mx my iq kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated">在数据集漂移的情况下，我们将统计测试的置信水平设置为0.95。我们将同等重视所有要素，如果超过50%的要素发生漂移，则认为我们的数据集发生了漂移。</li></ul><h1 id="de93" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">它在代码中的样子</h1><p id="8b22" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">要查看所有细节，请查看我们的<a class="ae ly" href="https://github.com/evidentlyai/evidently/blob/main/evidently/tutorials/historical_drift_visualization.ipynb" rel="noopener ugc nofollow" target="_blank">示例Jupyter笔记本</a>。</p><p id="3adc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了实现这种方法，我们将使用以下库:</p><ul class=""><li id="c4b4" class="mx my iq kx b ky kz lb lc le mz li na lm nb lq nc nd ne nf bi translated"><em class="nl"> JSON </em>、<em class="nl"> pandas </em>和<em class="nl"> NumPy </em>作为处理数据所需的标准库。</li><li id="2ab6" class="mx my iq kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated"><em class="nl"> Plotly </em>，来可视化我们的数据漂移。</li><li id="b4de" class="mx my iq kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated"><em class="nl">显然是</em>，使用统计测试计算漂移。</li><li id="f4e0" class="mx my iq kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated"><em class="nl"> Mlflow </em>，记录结果。</li></ul><p id="08b0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦我们导入了库，我们就加载了数据。看起来是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/03aaa83ae3cda902c5e275e49236ce5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rymrA4XK6Mid0_v2kh07lg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片，Jupyter笔记本中的数据集预览。</p></figure><p id="e8cc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们定义列映射来指定特征类型。这显然是执行正确的统计测试所需要的。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="d82b" class="ns ma iq no b gy nt nu l nv nw">data_columns = {}<br/>data_columns['numerical_features'] = ['weather', 'temp', 'atemp', 'humidity', 'windspeed']</span></pre><p id="05cc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们还定义了我们的参考数据(第一个月)和随后的时间段来评估漂移。我们将每个月的数据视为一次实验。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="b28d" class="ns ma iq no b gy nt nu l nv nw">reference_dates = ('2011-01-01 00:00:00','2011-01-28 23:00:00')</span><span id="f181" class="ns ma iq no b gy nx nu l nv nw">experiment_batches = [<br/>    ('2011-02-01 00:00:00','2011-02-28 23:00:00'),<br/>    ('2011-03-01 00:00:00','2011-03-31 23:00:00'),<br/>    ('2011-04-01 00:00:00','2011-04-30 23:00:00'),<br/>    ('2011-05-01 00:00:00','2011-05-31 23:00:00'),  <br/>    ('2011-06-01 00:00:00','2011-06-30 23:00:00'), <br/>    ('2011-07-01 00:00:00','2011-07-31 23:00:00'), <br/>]</span></pre><p id="3a9c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们实现了两个自定义函数。他们在显然由概要提供的统计测试结果之上引入逻辑。</p><p id="8d28" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">第一个帮助检测数据集漂移。</strong>它将返回关于整体漂移的单一真真或假响应。我们可以设置统计测试的置信水平，并选择漂移特征的阈值。我们也可以通过设置<em class="nl"> get_ratio </em>为TRUE来获得漂移特性的份额。</p><p id="4616" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">第二个有助于检测特征漂移。</strong>显然已经在JSON概要文件输出中返回了各个特性的P值。我们添加这个函数来获得每个特性的二进制响应:1表示漂移，0表示不漂移。我们可以设置统计测试的置信水平。并且，我们仍然可以通过将<em class="nl"> get_pvalues </em>设置为TRUE来获得每个特征的P值。</p><p id="9b53" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可以按照这个示例构建自己的定制逻辑。</p><h1 id="9020" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">可视化特征漂移</h1><p id="4590" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">先说特征漂移。</p><p id="17d8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们调用我们的函数来评估单个特征的漂移。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="adab" class="ns ma iq no b gy nt nu l nv nw">features_historical_drift = []</span><span id="2fa6" class="ns ma iq no b gy nx nu l nv nw"><strong class="no ir">for</strong> date <strong class="no ir">in</strong> experiment_batches:<br/>    drifts = detect_features_drift(raw_data.loc[reference_dates[0]:reference_dates[1]], <br/>                           raw_data.loc[date[0]:date[1]], <br/>                           column_mapping=data_columns, <br/>                           confidence=0.95,<br/>                           threshold=0.9)<br/>    <br/>    features_historical_drift.append([x[1] <strong class="no ir">for</strong> x <strong class="no ir">in</strong> drifts])<br/>    <br/>features_historical_drift_frame = pd.DataFrame(features_historical_drift, columns = data_columns['numerical_features'])</span></pre><p id="be93" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，我们使用Plotly将结果可视化在热图上。我们将检测到漂移的时间段标为红色。</p><p id="b147" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是我们得到的结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/dfa006d2956a7e8dfa84a5fa0f60004c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rT4756YAe9nKJ_JG7ADGeQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者形象，情节可视化。</p></figure><p id="82a1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">哎哟！一点都不稳定。</p><p id="4c7e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">事实是，我们采用了一个季节性很强的用例。我们的数据实际上与天气有关。温度、湿度、风速模式逐月变化很大。</p><p id="81b9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这给了我们一个非常明确的信号，我们需要考虑最新的数据，并经常更新模型。</p><p id="4740" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我们想以更精细的方式来看，我们可以绘制P值。我们将<em class="nl"> get_pvalues </em>设置为真，然后生成一个新的绘图。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/4ed6db96eb54569a40c21fc8ecc57f0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cqy3Fhzc5w3J2SLxmMNzlw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者形象，情节可视化。</p></figure><p id="3f11" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在更细微的变化的情况下，将P值视为梯度而不仅仅是漂移的布尔真/假可能会有所帮助。</p><h1 id="d7c7" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">可视化数据集漂移</h1><p id="7606" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">现在让我们调用一个函数来计算数据集漂移。</p><p id="8c8a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">知道了数据的不稳定性，我们将阈值设得很高。只有当90%的特征在分布上有统计变化时，我们才称之为漂移。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="e14a" class="ns ma iq no b gy nt nu l nv nw">dataset_historical_drift = []</span><span id="51a1" class="ns ma iq no b gy nx nu l nv nw"><strong class="no ir">for</strong> date <strong class="no ir">in</strong> experiment_batches:<br/>    dataset_historical_drift.append(detect_dataset_drift(raw_data.loc[reference_dates[0]:reference_dates[1]], <br/>                           raw_data.loc[date[0]:date[1]], <br/>                           column_mapping=data_columns, <br/>                           confidence=0.95))</span></pre><p id="adf4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这就是逐月统计的结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/f8686db90cf16e2275deb53fef67da13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UcIZUkhEzo8kS27Dq0n-Wg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者形象，情节可视化。</p></figure><p id="f767" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您还可以设置一个更细粒度的视图，并使用每个月内的漂移特征份额绘制一个图。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/43be3692ae5deb0298884dd957a35493.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rAGUjTOnUundTQ20mMWriA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者形象，情节可视化。</p></figure><p id="8476" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">根据不同的用例，您可以选择不同的方式来显示这些数据，比如条形图。</p><h1 id="4678" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">记录漂流物</h1><p id="6e76" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">当我们的目标是探索或分享信息时，可视化是很有帮助的。</p><p id="0071" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是我们可能还想简单地记录其他地方的特性和数据集漂移测试的数字结果。例如，我们想记录一个实验结果的漂移值。</p><p id="efc6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">或者，我们想为生产中的模型跟踪它。</strong></p><p id="21b5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦我们定义了漂移条件，我们就可以监控它们是否得到满足。我们希望得到一个布尔响应，无论生产中是否发生了漂移，或者基于某个阈值触发警报。</p><p id="b2eb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">要记录漂移结果，我们可以使用Mlflow跟踪。这是一个管理ML生命周期的流行库。在这种情况下，我们显然使用和我们的自定义函数来生成输出(数据集漂移度量)，然后用Mlflow记录它。</strong></p><p id="d372" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你可以按照我们在<a class="ae ly" href="https://github.com/evidentlyai/evidently/blob/main/evidently/tutorials/historical_drift_visualization.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本</a>中的例子来做。这很简单！</p><p id="72a9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下是Mlflow界面中的结果。我们记录了每次运行的数据集漂移指标。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/8deb5a3497fb8abd9db415d17e33d0a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D1RrVtHIX-S_eSlM-9k08g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由作者提供，Mlflow界面截图。</p></figure><p id="921e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">或者这是一个扩展视图:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/5b5bf6fec176723b830eebaabbe10d78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SyUlhXmkPT_0bJUg_xfVEw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由作者提供，Mlflow界面截图。</p></figure><h1 id="73d5" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">适应您的用例</h1><p id="eb3f" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">您可以将这个示例应用到您的用例中。</p><p id="b9d6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">例如，您可以修改漂移检测逻辑</strong>来更好地考虑手头的用例。您可以测试几种组合，并选择合适的窗口和漂移条件。</p><p id="d9ac" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">你也可以用其他的</strong> <a class="ae ly" href="https://docs.evidentlyai.com/reports" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir">报道</strong> </a> <strong class="kx ir">。</strong>例如，除了数据漂移之外，您还可以生成一个性能报告来记录模型质量指标。然后，您可以遵循类似的步骤，使用Plotly来分析您的<a class="ae ly" href="https://evidentlyai.com/blog/retrain-or-not-retrain" rel="noopener ugc nofollow" target="_blank">模型衰减测试</a>的结果，从而可视化历史模型性能。</p><p id="b306" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">当然，这种方法也适用于生产。</strong>尤其是当您有批量模型运行时。例如，您定期对数据和预测运行漂移检查，并使用Mlflow进行记录，或者简单地将其写入数据库。</p><p id="1b2d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你一直在看你的数据漂移吗？让我们知道！</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><p id="e43e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="nl">最初发表于</em><a class="ae ly" href="https://evidentlyai.com/blog/tutorial-3-historical-data-drift" rel="noopener ugc nofollow" target="_blank"><em class="nl">https://evidentlyai.com</em></a><em class="nl">并与</em> <a class="ae ly" href="https://www.linkedin.com/in/elenasamuylova/" rel="noopener ugc nofollow" target="_blank"> <em class="nl">埃琳娜·萨穆伊洛娃</em> </a> <em class="nl">合著。</em></p><p id="4bcd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在appeally AI，我们创建了开源工具来分析和监控机器学习模型。在GitHub   <em class="nl">上查看我们的</em> <a class="ae ly" href="https://github.com/evidentlyai/evidently" rel="noopener ugc nofollow" target="_blank"> <em class="nl">项目，喜欢就给它一颗星！</em></a></p><p id="9ce6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">想留在圈子里吗？</p><ul class=""><li id="dd1a" class="mx my iq kx b ky kz lb lc le mz li na lm nb lq nc nd ne nf bi translated"><a class="ae ly" href="https://evidentlyai.com/blog/retrain-or-not-retrain#signup" rel="noopener ugc nofollow" target="_blank"> <em class="nl">报名参加</em> </a> <em class="nl">我们的每月简讯。</em></li><li id="ff8c" class="mx my iq kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated"><em class="nl">关注</em> <a class="ae ly" href="https://twitter.com/EvidentlyAI" rel="noopener ugc nofollow" target="_blank"> <em class="nl">推特</em> </a> <em class="nl">和</em><a class="ae ly" href="https://www.linkedin.com/company/evidently-ai/" rel="noopener ugc nofollow" target="_blank"><em class="nl">Linkedin</em></a><em class="nl">。</em></li><li id="8256" class="mx my iq kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated"><em class="nl">加入我们的</em> <a class="ae ly" href="https://discord.gg/xZjKRaNp8b" rel="noopener ugc nofollow" target="_blank"> <em class="nl">不和谐社区</em> </a> <em class="nl">聊天连线。</em></li></ul></div></div>    
</body>
</html>