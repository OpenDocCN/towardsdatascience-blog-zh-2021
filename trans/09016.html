<html>
<head>
<title>Building a Sentiment Classifier using spaCy 3.0 Transformers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用spaCy 3.0转换器构建情感分类器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-sentiment-classifier-using-spacy-3-0-transformers-c744bfc767b?source=collection_archive---------9-----------------------#2021-08-20">https://towardsdatascience.com/building-sentiment-classifier-using-spacy-3-0-transformers-c744bfc767b?source=collection_archive---------9-----------------------#2021-08-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d150" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用spaCy 3.0构建文本分类模型</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a8bca59f180fad4817a548021def9124.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cXOPhDWBzVBS5k0V0zvu9A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1006031" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae ky" href="https://pixabay.com/users/chummels-698386/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1006031" rel="noopener ugc nofollow" target="_blank">卡洛琳·许梅尔斯</a></p></figure><p id="4fe0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我使用spaCy已经有一段时间了，因为它在生产中易于使用，而且API简洁、用户友好。该库由Matthew Honnibal和Ines Montani开发，他们是Explosion.ai公司的创始人。他们在2021年2月1日发布了spaCy 3.0版本，并添加了最先进的基于变压器的管道。此外，3.0版还提供了新的配置系统和培训工作流程。在本文中，我展示了使用spaCy version 3.0和Transformer模型，用很少的几行代码构建一个情感分类器是多么简单。</p><p id="4787" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我从<a class="ae ky" href="https://www.kaggle.com/ankurzing/sentiment-analysis-for-financial-news" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>获取了财经新闻数据集，构建了一个情感分类器，并使用了Google Colab。</p><h2 id="9e42" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">装置</h2><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="6bb3" class="lv lw it mp b gy mt mu l mv mw"><em class="mx"># Installing Spacy library</em><br/><br/>!pip install spacy==3.1.1<br/>!pip install spacy-transformers</span></pre><p id="5081" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，下载预先训练好的transformer模型。这里，模型是使用BERT-base架构的Roberta-base。更多详情，请查看<a class="ae ky" href="https://spacy.io/models/en" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="4186" class="lv lw it mp b gy mt mu l mv mw"><em class="mx"># Downloading the spaCy Transformer model "en_core_web_trf"</em><br/>!python -m spacy download en_core_web_trf</span></pre></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h2 id="5057" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">导入必要的库</h2><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="15f0" class="lv lw it mp b gy mt mu l mv mw"><em class="mx"># Importing libraries</em><br/><br/>import pandas as pd<br/>from datetime import datetime<br/>import spacy<br/>import spacy_transformers<br/><br/><em class="mx"># Storing docs in binary format</em><br/>from spacy.tokens import DocBin</span></pre><p id="993e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">读取数据集</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="52da" class="lv lw it mp b gy mt mu l mv mw"><em class="mx"># Reading the dataset</em><br/>df = pd.read_csv("Data1.csv", encoding='latin-1')<br/>df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/e882d5010039534256de5a8d6bd85b0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*0HCH6suaOhWCBQ0ugFq9hw.png"/></div></figure><p id="dea0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个数据集是关于金融新闻及其相应的情绪。数据有三个标签，正面，负面，中性。让我们读一些随机文本</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="4a99" class="lv lw it mp b gy mt mu l mv mw">df[‘Text’][2]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/7ddb5e5b020cfb9dcc6ecfa0a2c61c37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bUyeySbV5S4nTWX0u2ZmhQ.png"/></div></div></figure><p id="9cdf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述文字被归类为“负面”。让我们读一篇正面的课文</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="4d55" class="lv lw it mp b gy mt mu l mv mw">df['Text'][3]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/faba46ee1b4d6da1aad41486d8b348fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5bDJjqnSdQ0yz8wsiITFPg.png"/></div></div></figure><p id="f788" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以上文字归类为“正面”。</p><p id="63f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">检查数据集的形状</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="f0e5" class="lv lw it mp b gy mt mu l mv mw">df.shape</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/058cd3e4e7ff58cc09d1e6c864a5bac1.png" data-original-src="https://miro.medium.com/v2/resize:fit:434/format:webp/1*SarQyqE9WKJF0F1E_Q5clQ.png"/></div></figure><p id="b63e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该数据有4846个观察值。由于训练时间的原因，我在本文中选择了一个小数据集。</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h2 id="09a1" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">分割数据集</h2><p id="d2af" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">将数据集拆分为80:20比例的训练和测试</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="bfc5" class="lv lw it mp b gy mt mu l mv mw"><em class="mx">#Splitting the dataset into train and test</em></span><span id="dbce" class="lv lw it mp b gy no mu l mv mw">train = df.sample(frac = 0.8, random_state = 25)<br/>test = df.drop(train.index)</span></pre><p id="e651" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">检查形状</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="e5d7" class="lv lw it mp b gy mt mu l mv mw"><em class="mx"># Checking the shape</em><br/><br/>print(train.shape, test.shape)</span></pre><p id="471b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/f66795bb3086beae939f16816a760f02.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*N4vUC1simImoQDsMsheBDQ.png"/></div></figure><p id="be0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将变压器模型加载到空间管道</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="a1b3" class="lv lw it mp b gy mt mu l mv mw"><strong class="mp iu">import</strong> <strong class="mp iu">spacy</strong><br/>nlp=spacy.load("en_core_web_trf")<br/></span></pre></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h2 id="91ac" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">训练数据集</h2><p id="79b5" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">在3.0版中，我们需要创建二进制格式的训练数据集来训练模型。第一步是创建元组，元组是带有情感的文本对。为训练和测试数据集创建元组。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="f02f" class="lv lw it mp b gy mt mu l mv mw">#Creating tuples</span><span id="cb63" class="lv lw it mp b gy no mu l mv mw">train['tuples'] = train.apply(<strong class="mp iu">lambda</strong> row (row['Text'],row['Sentiment']), axis=1)</span><span id="3f43" class="lv lw it mp b gy no mu l mv mw">train = train['tuples'].tolist()</span><span id="388e" class="lv lw it mp b gy no mu l mv mw">test['tuples'] = test.apply(<strong class="mp iu">lambda</strong> row: (row['Text'],row['Sentiment']), axis=1)<br/>test = test['tuples'].tolist()</span><span id="de26" class="lv lw it mp b gy no mu l mv mw">train[0]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/83b4603275459ac403e4717d9edf8394.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LbD7LiDcitPw7XXDf6D_5A.png"/></div></div></figure><p id="db75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二步是在transformer模型<code class="fe nr ns nt mp b">(en_core_web_trf)</code>的帮助下，使用名为<code class="fe nr ns nt mp b">nlp</code>的空间管道为训练和测试数据集中的每个元组创建一个空间文档。每个元组只不过是文本和它的情感。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="3c2c" class="lv lw it mp b gy mt mu l mv mw"># User function for converting the train and test dataset into spaCy document</span><span id="c11d" class="lv lw it mp b gy no mu l mv mw"><strong class="mp iu">def</strong> document(data):<br/>#Creating empty list called "text"</span><span id="7ad4" class="lv lw it mp b gy no mu l mv mw">  text = []<br/>  <strong class="mp iu">for</strong> doc, label <strong class="mp iu">in</strong> nlp.pipe(data, as_tuples = <strong class="mp iu">True</strong>):<br/>    <strong class="mp iu">if</strong> (label=='positive'):<br/>      doc.cats['positive'] = 1<br/>      doc.cats['negative'] = 0<br/>      doc.cats['neutral']  = 0<br/>    <strong class="mp iu">elif</strong> (label=='negative'):<br/>      doc.cats['positive'] = 0<br/>      doc.cats['negative'] = 1<br/>      doc.cats['neutral']  = 0<br/>    <strong class="mp iu">else</strong>:<br/>      doc.cats['positive'] = 0<br/>      doc.cats['negative'] = 0<br/>      doc.cats['neutral']  = 1<br/>#Adding the doc into the list 'text'<br/>      text.append(doc)<br/>  <strong class="mp iu">return</strong>(text)</span></pre><p id="454e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建了上面这个名为<code class="fe nr ns nt mp b">document</code>的用户自定义函数。在这里，处理文本并添加到空间文档，并为每个情感添加类别。如果文本具有正面情感，那么它被分配为‘1’，并且对于中性和负面都是相同的。然后每个<code class="fe nr ns nt mp b">doc</code>被添加到名为<code class="fe nr ns nt mp b">text</code>的列表中。最后的<code class="fe nr ns nt mp b">text</code>是文本的内部空间表示。</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h2 id="e7c8" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">将训练和测试数据集转换为二进制格式</h2><p id="916a" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">将<code class="fe nr ns nt mp b">train</code>数据集传递给<code class="fe nr ns nt mp b">document</code>函数，并保存为<code class="fe nr ns nt mp b">train_docs</code>对象。然后使用<code class="fe nr ns nt mp b">DocBin</code> spaCy函数将文本转换成二进制对象，并将训练数据集二进制对象保存为<code class="fe nr ns nt mp b">train.spacy</code></p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="00d9" class="lv lw it mp b gy mt mu l mv mw"><em class="mx"># Calculate the time for converting into binary document for train dataset</em><br/><br/>start_time = datetime.now()<br/><br/><em class="mx">#passing the train dataset into function 'document'</em><br/>train_docs = document(train)<br/><br/><em class="mx">#Creating binary document using DocBin function in spaCy</em><br/>doc_bin = DocBin(docs = train_docs)<br/><br/><em class="mx">#Saving the binary document as train.spacy</em><br/>doc_bin.to_disk("train.spacy")<br/>end_time = datetime.now()<br/><br/><em class="mx">#Printing the time duration for train dataset</em><br/>print('Duration: <strong class="mp iu">{}</strong>'.format(end_time - start_time))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/3224c7d1d3f3e933941aa703f58a64c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/1*smXxAfcqZCBDSbiU0jBm9A.png"/></div></figure><p id="f07d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Google Colab中将训练数据集转换为二进制对象花费了将近7分钟。</p><p id="318d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们必须对测试数据集做同样的事情。将<code class="fe nr ns nt mp b">test</code>数据集传递给<code class="fe nr ns nt mp b">document</code>函数，并将其保存为<code class="fe nr ns nt mp b">test_docs</code>对象。然后使用<code class="fe nr ns nt mp b">DocBin</code> spaCy函数将文本转换成二进制对象，并将测试数据集二进制对象保存为<code class="fe nr ns nt mp b">test.spacy</code></p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="0ef3" class="lv lw it mp b gy mt mu l mv mw"><em class="mx"># Calculate the time for converting into binary document for test dataset</em><br/><br/>start_time = datetime.now()<br/><br/><em class="mx">#passing the test dataset into function 'document'</em><br/>test_docs = document(test)<br/>doc_bin = DocBin(docs = test_docs)<br/>doc_bin.to_disk("valid.spacy")<br/>end_time = datetime.now()<br/><br/><em class="mx">#Printing the time duration for test dataset</em><br/>print('Duration: <strong class="mp iu">{}</strong>'.format(end_time - start_time))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/e273573deaf2a309aa3a1f3b4ff03149.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*HNhNfnrHfqUg8PmFX5pnVw.png"/></div></figure><p id="f24e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Google Colab中将测试数据集转换成二进制对象需要1.40分钟。现在，我们已经按照所需的空间格式将数据输入到二进制对象中。</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h2 id="f006" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">训练模型</h2><p id="26e7" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">下一步，训练模型。在3.0版本中，spaCy提供了一个命令行界面来执行培训。为此，我们需要从这个<a class="ae ky" href="https://spacy.io/usage/training#quickstart" rel="noopener ugc nofollow" target="_blank">站点</a>下载基本配置文件。在下载之前，我们需要选择组件下的<code class="fe nr ns nt mp b">textcat</code>,因为这是一个分类问题。我选择了硬件<code class="fe nr ns nt mp b">GPU</code>，就像我使用google colab和选择<code class="fe nr ns nt mp b">accuracy</code>一样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/609d5cf3ccd188b2d1d6d3b760051598.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/1*QNNt00l7gffIOehmWqJQZw.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="42b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以在记事本中打开基本配置文件，并需要为配置文件的<code class="fe nr ns nt mp b">train = “train.spacy"</code>和<code class="fe nr ns nt mp b">dev = "test.spacy".</code>截图指定路径，如下所示</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/d27f6250f974367ba2da3a5763947578.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q4LrGufhjRT-a1ySj6J0hw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="e1df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是使用基本配置，并使用下面的代码将其转换为我们分类的完整配置。以下代码可从spaCy <a class="ae ky" href="https://spacy.io/usage/training#quickstart" rel="noopener ugc nofollow" target="_blank">网站</a>获得。完整的配置文件将作为<code class="fe nr ns nt mp b">config.cfg</code>保存在您的路径文件夹中</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="da6b" class="lv lw it mp b gy mt mu l mv mw"><em class="mx">#Converting base configuration into full config file</em><br/><br/>!python -m spacy init fill-config ./base_config.cfg ./config.cfg</span></pre><p id="b427" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">配置文件具有用于训练分类的所有模型参数。我在本文中使用了默认参数并训练了分类。现在，我们需要使用下面的代码来训练我们的模型。同样，代码也可以在spaCy <a class="ae ky" href="https://spacy.io/usage/training#quickstart" rel="noopener ugc nofollow" target="_blank">网站</a>上找到。我通过添加<code class="fe nr ns nt mp b">--gpu-id 0</code>启用了GPU，模型输出保存在一个名为<code class="fe nr ns nt mp b">output_updated.</code>的文件夹中</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="1c7f" class="lv lw it mp b gy mt mu l mv mw">#Calculating the time for training the model<br/>start_time = datetime.now()</span><span id="d6fe" class="lv lw it mp b gy no mu l mv mw"># To train the model. Enabled GPU and storing the model output in folder called output_updated<br/>!python -m spacy train config.cfg --verbose  --gpu-id 0 --output ./output_updated<br/><br/>end_time = datetime.now()</span><span id="843d" class="lv lw it mp b gy no mu l mv mw">#Printing the time taken for training the model<br/>print('Duration: <strong class="mp iu">{}</strong>'.format(end_time - start_time))</span></pre><h2 id="85d7" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">输出</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/7b3b60250ec4a0c6d34bc10e99a9442d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mfvDoH_0z_UhBqxGyjpgqQ.png"/></div></div></figure><p id="6b8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在GPU下的Google Colab中训练模型花了37分钟。上面的输出显示了每个训练步骤的损失和准确性。我可以看到这个模型的精确度是0.85。训练后，模型被保存在<code class="fe nr ns nt mp b">output_updated/model-last.</code>文件夹中</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h2 id="44e7" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">测试模型</h2><p id="c13b" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">现在我们的模型准备好了。让我们用一些随机文本进行测试</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="2a62" class="lv lw it mp b gy mt mu l mv mw">text = “Australia’s largest airline temporarily lays off 2,500 employees”</span><span id="2493" class="lv lw it mp b gy no mu l mv mw"><em class="mx"># Loading the best model from output_updated folder</em><br/>nlp = spacy.load("output_updated/model-best")<br/>demo = nlp(text)<br/>print(demo.cats)</span></pre><h2 id="5b9f" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">输出</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/e307edf2e1ca96d5d11e26f4e47f9dca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JphfEB1Y9HBUxwcz7sAfgQ.png"/></div></div></figure><p id="c6e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">负分很高，它被正确地归类为阴性。让我们试着用一些正面的文字</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="10e5" class="lv lw it mp b gy mt mu l mv mw">text1 = “Apple earnings: Huge iPhone 12 sales beat analyst expectations”<br/>demo = nlp(text1) <br/>print(demo.cats)</span></pre><h2 id="c375" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">输出</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/f749900e4cafe76c9ec6c69d066c75a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UrV388v8jZTocCFcCN09cw.png"/></div></div></figure><p id="bda8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，文本的情绪是积极的，因为积极的分数很高。型号分类正确。</p><p id="90c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文的目的是演示如何使用spaCy transformers 3.0进行文本分类。我们可以更改配置文件中的参数来提高模型性能。</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><p id="1070" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在我的<a class="ae ky" href="https://github.com/sdhilip200/Sentiment-Classifier-using-spaCy-3.0-Transformers" rel="noopener ugc nofollow" target="_blank"> GitHub repo中找到完整的代码和数据。</a></p><p id="5bff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能也喜欢我以前的文章<a class="ae ky" href="https://pub.towardsai.net/natural-language-processing-with-spacy-steps-and-examples-155618e84103" rel="noopener ugc nofollow" target="_blank"><em class="mx">spaCy自然语言处理——步骤和例子</em> </a></p><p id="69e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。</p></div></div>    
</body>
</html>