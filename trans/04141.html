<html>
<head>
<title>Spec2Vec: The Next Step in Mass Spectral Similarity Metrics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spec2Vec:质谱相似性度量的下一步</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/spec2vec-the-next-step-in-mass-spectral-similarity-metrics-b79c3db7511a?source=collection_archive---------37-----------------------#2021-04-07">https://towardsdatascience.com/spec2vec-the-next-step-in-mass-spectral-similarity-metrics-b79c3db7511a?source=collection_archive---------37-----------------------#2021-04-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c6ad" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Spec2Vec使用无监督的机器学习模型从MS/MS质谱预测结构相似性</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/26e0c908f01798fb7d5d99f911170393.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0toz9Ed67aT74a6xcE7cVw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:作者</p></figure><p id="b45e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">计算两个MS/MS质谱之间的相似性是大多数无目标代谢组学工作流程中的重要步骤。</p><p id="9274" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然而，人们早就知道余弦相似性——最流行的相似性度量——有明显的弱点。</p><p id="b867" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Justin van der Hooft和他的团队开发了一种计算光谱相似性的新方法:Spec2Vec。这对于分析生物标志物发现或天然产物研究中的非靶向代谢组学结果非常有帮助。</p><p id="217e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们看看Spec2Vec是如何工作的，以及为什么它是余弦相似性的一个很好的替代品。</p><h1 id="5993" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">为什么质谱相似性度量很重要</h1><p id="d38c" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">最初，非目标代谢组学数据集中的数据点只是一个被测量的实体。我们还不知道它可能是什么分子。因此，我们不能解释它的意义:它是新的东西吗？它的代谢功能是什么？</p><p id="f2c3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是如果你能把这个实体与一个数据库相匹配，比如人类代谢组数据库，那么你就可以给这个实体添加(注释)重要的信息。为了匹配你的测量和数据库中的条目，你需要<strong class="kx ir">一个相似性度量</strong>。</p><p id="75f0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这就是质谱相似性度量的主要用途:</p><ul class=""><li id="35ca" class="mo mp iq kx b ky kz lb lc le mq li mr lm ms lq mt mu mv mw bi translated"><strong class="kx ir">光谱库匹配</strong>:将化合物与光谱库(如HMDB)进行匹配。</li><li id="f204" class="mo mp iq kx b ky mx lb my le mz li na lm nb lq mt mu mv mw bi translated"><strong class="kx ir">模拟搜索</strong>:在一个大的光谱库中寻找最佳匹配，寻找结构相关的分子。</li><li id="35eb" class="mo mp iq kx b ky mx lb my le mz li na lm nb lq mt mu mv mw bi translated"><strong class="kx ir">质谱网络</strong>:在质谱网络中聚类相关化合物。</li></ul><p id="f8db" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">任何错误都可能代价高昂:如果你找不到匹配，那么你的化合物可能看起来是一个令人兴奋的新药候选物，而实际上，它是一个众所周知的分子；如果你只是在研究的后期才发现这一点，那么你就浪费了很多努力。</p><p id="4cdc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你的相似性度量越好，这样的错误就越少发生。</p><h1 id="4de1" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">余弦相似性的缺点</h1><p id="3fbb" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">余弦相似性测量一个质谱<strong class="kx ir">与另一个质谱</strong>重叠的程度。如果两个质谱有近乎完美的重叠，那么余弦相似性就很高——它们的分子结构很可能非常相似。</p><p id="cc09" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然而，有时你会有质谱不重叠的结构相似的分子——在这种情况下，余弦相似性可能会失败。这是如何发生的:</p><ol class=""><li id="0316" class="mo mp iq kx b ky kz lb lc le mq li mr lm ms lq nc mu mv mw bi translated"><strong class="kx ir">多处修饰的大分子:</strong>大分子——常见于植物和微生物中——可以很容易地对其分子结构进行几次小的修饰。</li><li id="dbd9" class="mo mp iq kx b ky mx lb my le mz li na lm nb lq nc mu mv mw bi translated"><strong class="kx ir">几个片段被移位:</strong>如果你将一个有几个修饰的分子片段化，那么不是一个，而是它的几个片段也保留一个修饰。结果，质谱上的几个碎片峰移动。</li><li id="da24" class="mo mp iq kx b ky mx lb my le mz li na lm nb lq nc mu mv mw bi translated"><strong class="kx ir">很少有峰完全重叠:</strong>如果大量片段发生位移，整个光谱就不再与未修饰的分子整齐重叠。</li><li id="936c" class="mo mp iq kx b ky mx lb my le mz li na lm nb lq nc mu mv mw bi translated"><strong class="kx ir">低余弦相似度:</strong>就余弦相似度(重叠)而言，两个分子因此看起来不相关，你会看到低余弦值。</li><li id="f851" class="mo mp iq kx b ky mx lb my le mz li na lm nb lq nc mu mv mw bi translated"><strong class="kx ir">错误结论:</strong>结果，你可能认为一个库没有与你的化合物相似的分子，而事实上它有。这可能会引发你发现了一种新分子的结论，尽管你所发现的只是一种描述良好的分子的轻微修改。</li></ol><p id="5f57" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是一个众所周知的问题，但在Spec2Vec之前，还没有提出根本上替代的质谱相似性度量作为解决方案。</p><h1 id="6033" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">Spec2Vec:光谱相似性的无监督学习</h1><p id="5281" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">Spec2Vec的基础是一个强大的新假设:如果两个碎片峰经常在数千个质谱中同时出现，那么这可能是因为它们来自同一个分子亚结构。</p><p id="ddb2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">所以这两个峰值在某种程度上是相关的。现在，如果你在一个分子中只看到这些峰中的一个，而在另一个分子中看到另一个，你可以猜测，同样的亚结构，可能有小的改变，在两个分子中都存在。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/13d0bad0f7994b797e843b75450d955f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*P1A-mMSJbIxj_moW.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">学习峰之间的关系允许Spec2Vec识别两个光谱是相似的——即使它们的光谱在几个地方没有重叠。来源:作者</p></figure><p id="f5fa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Spec2Vec恰恰实现了这一思想。但是在大规模上，Spec2Vec获取了成千上万质谱的数据集，并且<strong class="kx ir">从该数据集学习</strong>哪些峰是相关的。然后就可以用Spec2Vec学到的东西来计算任意两个质谱之间的光谱相似度。</p><p id="5713" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果这行得通，那么一个有一些小修饰的分子——就像前面的例子一样——应该不会骗过Spec2Vec。现在，这有用吗？</p><h1 id="05c3" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">比较Spec2Vec和余弦相似度</h1><p id="1949" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">我们来看两个测试的结果。为了测试，我们使用了来自GNPS的大型分子库，其中包含分子结构和它们的光谱。</p><h1 id="fd12" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">测试1:spec 2 vec分数与结构相似性的相关性如何？</h1><p id="fa70" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">首先，您需要一个基本事实来比较Spec2Vec和余弦相似性。贾斯汀和他的团队选取了12797种独特的化合物，利用它们已知的分子结构，直接计算出每对分子的结构相似性得分(Tanimoto score)。</p><p id="9331" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于每个相同的对(总共81，875，206对)，他们还计算了余弦、修正余弦和Spec2Vec得分，但这一次，只使用了库谱，而不是已知的结构。这是结果:</p><ul class=""><li id="9b2f" class="mo mp iq kx b ky kz lb lc le mq li mr lm ms lq mt mu mv mw bi translated"><strong class="kx ir"> Spec2Vec与结构相似性的相关性更好</strong>；</li><li id="a825" class="mo mp iq kx b ky mx lb my le mz li na lm nb lq mt mu mv mw bi translated">只有当光谱几乎完全重叠时，所有指标的表现才会相似。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/b8d8f5df1c9d2e9e0d04186d83812320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xXBuydesMQyXlNHo.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Spec2Vec在其得分最高的光谱对中发现了更多高度相似的结构(通过Tanimoto评分衡量)。来源:作者</p></figure><p id="e007" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Spec2Vec与结构相似性(Tanimoto得分)的高度相关性非常有希望，但这是否转化为更好的文库匹配？</p><h1 id="2e1d" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">测试2:spec 2 vec能在库搜索中找到正确的匹配吗？</h1><p id="9fce" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">在第二次测试中，贾斯汀的团队从光谱库中选择了1000个独特的分子，这些分子在库中也有至少四个平面结构等价物(这些在2D看起来相同)。这些近乎等价的分子留在了文库中。</p><p id="8d1a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来的任务是弄清楚具有相同2D结构的分子是否会得到最高的相似性分数。</p><p id="ed84" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">结果与第一个测试一致:同样，<strong class="kx ir"> Spec2Vec在所有分数范围内发现了比余弦相似度更可靠的匹配</strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/903851c5acdc7bcfa742bb53e2caff32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FePCLKHeFFBPRT1O.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在所有得分范围内，Spec2Vec的命中率比余弦相似性的命中率高得多。来源:作者</p></figure><p id="cad9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是Spec2Vec更有优势。</p><h1 id="a463" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">Spec2Vec要快得多</h1><p id="64f6" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">余弦相似性计算在质谱上非常昂贵，因为它们需要预处理。它们非常昂贵，以至于通常无法对整个大型数据库进行比较。</p><p id="14ef" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Spec2Vec模型一旦经过训练，速度极快:大约比余弦相似性评分快100倍。即使将训练Spec2Vec模型的时间包括在内，总的来说仍然快10倍左右(不考虑余弦相似性方面的任何可能的优化)。</p><p id="c8b6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这意味着使用Spec2Vec，您可以轻松地对大型库运行所有对所有的搜索，而没有任何限制。</p><p id="7023" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Spec2Vec并不难实现，尽管它是一种更高级的相似性评分方法。</p><h1 id="f67c" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">如何将Spec2Vec集成到您的工作流程中</h1><p id="3626" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">你可以用一个易于使用的Python开源包来实现Spec2Vec，这个包可以在Github:【https://github.com/iomega/spec2vec<a class="ae ne" href="https://github.com/iomega/spec2vec" rel="noopener ugc nofollow" target="_blank"/>上免费获得。您可以用Anaconda(推荐)或pip安装它。</p><p id="f154" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您甚至可以从Zenodo 下载用于上述测试的预训练Spec2Vec模型<a class="ae ne" href="https://zenodo.org/record/4173596#.YDRdT2puft0" rel="noopener ugc nofollow" target="_blank">。而且不用训练自己的模型也可以计算质谱相似度。</a></p><p id="6526" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> &gt; &gt;重要注意事项</strong> : Spec2Vec是一种无监督算法。这意味着你可以在任何一组MS/MS谱图上训练它，而不需要任何额外的信息。</p><h1 id="a260" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">这仅仅是开始</h1><p id="8f3a" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">Spec2Vec是一种很好的方法，可能很容易扩展:</p><ul class=""><li id="91b5" class="mo mp iq kx b ky kz lb lc le mq li mr lm ms lq mt mu mv mw bi translated"><strong class="kx ir"> GC-MS </strong>:到目前为止，Spec2Vec只在LC-MS数据上进行了测试。这对于GC-MS研究可能更有价值，因为在GC-MS测量中，您不能通过根据前体离子的相似性进行预过滤来限制库搜索。</li><li id="2826" class="mo mp iq kx b ky mx lb my le mz li na lm nb lq mt mu mv mw bi translated"><strong class="kx ir">有监督</strong>:spec 2 vec没有监督真是太好了。但是你也可以建立一个监督模型:例如，你可以训练一个模型，直接从光谱嵌入中预测Tanimoto分数。这可能会给你更精确的模型。</li><li id="792a" class="mo mp iq kx b ky mx lb my le mz li na lm nb lq mt mu mv mw bi translated"><strong class="kx ir">改进的Mass2Motifs </strong> : Spec2Vec矢量嵌入有可能被用来训练更强大的Mass2Motifs。</li><li id="f9f7" class="mo mp iq kx b ky mx lb my le mz li na lm nb lq mt mu mv mw bi translated"><strong class="kx ir">改进的网络注释传播(NAP) </strong>:相似性得分在构建质谱网络中至关重要，因此如果Spec2Vec产生更多有用的网络，它也可以改进您的注释并加快结构解析。</li></ul><p id="280d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">总的来说，目前使用余弦结构相似性的任何工具都可能受益于集成Spec2Vec作为替代的相似性度量。</p><h1 id="9db9" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">进一步阅读</h1><p id="f828" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">如果您想了解更多关于Spec2Vec的信息:</p><ul class=""><li id="4bcc" class="mo mp iq kx b ky kz lb lc le mq li mr lm ms lq mt mu mv mw bi translated"><strong class="kx ir">试试</strong> <a class="ae ne" href="https://github.com/iomega/spec2vec/tree/master/spec2vec" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir"> Spec2Vec python包</strong></a><strong class="kx ir">；</strong></li><li id="e6ce" class="mo mp iq kx b ky mx lb my le mz li na lm nb lq mt mu mv mw bi translated">在<a class="ae ne" href="https://gnps.ucsd.edu/" rel="noopener ugc nofollow" target="_blank"> GNPS </a>内试用Spec2Vec</li><li id="395f" class="mo mp iq kx b ky mx lb my le mz li na lm nb lq mt mu mv mw bi translated">阅读<a class="ae ne" href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1008724" rel="noopener ugc nofollow" target="_blank"> Spec2Vec论文</a>；和</li><li id="34e6" class="mo mp iq kx b ky mx lb my le mz li na lm nb lq mt mu mv mw bi translated">查看弗洛里安·胡伯的<a class="ae ne" href="https://blog.esciencecenter.nl/build-a-mass-spectrometry-analysis-pipeline-in-python-using-matchms-part-ii-spec2vec-8aa639571018" rel="noopener ugc nofollow" target="_blank"> Spec2Vec教程</a>。</li></ul><h1 id="6b28" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">将机器学习应用于组学研究需要帮助吗？</h1><p id="d152" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">我们可以帮助您的研究团队为可重复且易于部署的机器学习模型建立合适的基础设施。刚刚<a class="ae ne" href="https://datarevenue.com/en-contact" rel="noopener ugc nofollow" target="_blank">取得联系</a>。</p></div></div>    
</body>
</html>