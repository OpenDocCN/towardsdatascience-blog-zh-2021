<html>
<head>
<title>Building An App That Helps You Catch More Fish</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建一个帮助你钓更多鱼的应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-an-app-that-helps-you-catch-more-fish-b2eb76b885d4?source=collection_archive---------52-----------------------#2021-05-25">https://towardsdatascience.com/building-an-app-that-helps-you-catch-more-fish-b2eb76b885d4?source=collection_archive---------52-----------------------#2021-05-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="435f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个警报系统使用数据通知你何时何地捕鱼</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/661583b62446f831cbdd1b0f37b6ce48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5FNi6I6wzC2Ozaq9"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">凯利·西克玛在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="9bd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最近开始涉足淡水捕鱼。任何一直在钓鱼的人都知道，这可能是命中或错过，特别是如果你是这项运动的新手或在一个不熟悉的地方钓鱼。没有人想得到<em class="lv">【一败涂地】</em>。幸运的是，养鱼使得这种情况更容易避免。</p><p id="0b59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">鱼类放养是指在孵化场饲养鱼类，并将其放入水体，以帮助补充现有种群或在没有种群的地方创造新的种群。放养通常由国家部门完成，它们也有助于休闲渔业，提供更丰富的鱼类种群。</p><p id="3113" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在美国，州保护或环境部门经常在网上发布库存更新。通常，一旦人们看到他们已经被放养，他们就会聚集到这些地方，在接下来的几天里，这些地方会被大量捕捞。</p><p id="5554" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这让我开始思考。如果我开发一个应用程序，可以抓取网站，并在库存更新时提醒我，会怎么样？</p><p id="a13d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑到这一点，我决定构建一个Python脚本，并将其部署在Heroku上，以便在发现新的库存更新时通过电子邮件自动通知我。我的目标不一定是第一个尽快耗尽所有湖中的鱼，而只是意识到任何更新，而不是必须记住检查它。这样，如果我外出并得到通知，我可以顺便去钓鱼，享受一天中的时光！</p><p id="fd67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面，我将带您了解如何构建这个应用程序，以及它是如何工作的，以便您可以构建类似的应用程序。</p><h1 id="a06d" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">目标数据</h1><p id="9952" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我将收集的更新是康涅狄格州能源和环境保护部(DEEP)发布的康涅狄格州鳟鱼放养报告。该报告存储在PDF格式的表格中，并放在他们的网站上。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/cff773a4a2dcc324e2b1c6848f99b106.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QG86I-4m_ilrbYw0NbVXVg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">CT DEEP <a class="ae ky" href="https://portal.ct.gov/-/media/DEEP/fishing/weekly_reports/CurrentStockingReport.pdf" rel="noopener ugc nofollow" target="_blank">鳟鱼放养报告</a>第1页。<em class="mu">注:根据政策</em>提取数据允许CT政府网站</p></figure><p id="1958" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">报告顶部列出的日期将作为我们的指示器，指示自我们上次抓取PDF以来报告是否已更新。在此之下，每个页面都有一个长期运行的表，其中列出了所有特定的水体、它们的位置以及它们最后一次储存的详细信息。</p><h1 id="22b2" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">读入PDF数据</h1><p id="3869" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们要做的第一件事是创建一个单行文本文件<code class="fe mv mw mx my b">last_stocked_date.txt</code>,存储PDF的最后更新日期。首先，我们可以在文件中设置日期<code class="fe mv mw mx my b">5/1/2021</code>。这将允许我们读入数据，并将其存储到主程序的变量<code class="fe mv mw mx my b">LAST_STOCK_DATE</code>中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="c81b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们要从网站下载并存储当前的PDF。为了检查PDF文件是否已经更新，我们将使用<code class="fe mv mw mx my b">pdfplumber</code>打开文件，并仅从第一页提取所有文本。使用一些字符串操作，我们将基于子字符串“STOCKING UPDATE from”从该文本中提取日期。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><h1 id="bfdd" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">检查最近的更新</h1><p id="b06d" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在这里，我们将启动我们的主程序，并检查PDF中的日期是否与我们抓取并存储的上一个日期不同。如果是这样，程序将从前8页的表格中提取数据，并将其存储到数据帧中。我们只需要提取前8页，因为它们给出了库存的所有位置(任何超出的都是重复数据)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="d695" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将在dataframe <code class="fe mv mw mx my b">last_update</code>中创建一个新列，该列只提取某个特定位置的最后库存时间，并将其转换为<code class="fe mv mw mx my b">datetime</code>类型。例如，我们可以通过过去3天的库存位置来过滤数据框。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="853e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们希望记得更新存储上次库存日期的文本文件。这将确保我们的脚本下次运行时，只有在确定了新日期的情况下才会继续处理。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><h1 id="3602" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">发送电子邮件警报</h1><p id="d79b" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">接下来要做的是发送一封电子邮件来提醒我们鱼已经被放养了，以及它们被放养在哪里。</p><p id="2895" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们需要首先设置环境变量来收集我们的Gmail帐户、凭据和收件人详细信息。由于发送电子邮件需要提供凭证，我们不想直接在我们的脚本中存储这样的敏感数据。相反，我们将创建一个环境文件来存储这些数据。这对于在本地运行脚本是可行的，但是当使用Heroku这样的云解决方案进行实时部署时，我们还需要将这些环境变量定义为<code class="fe mv mw mx my b">Config Vars</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="c71d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们可以加载所需的环境变量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="45bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还希望将之前存储位置的过滤数据框转换为字符串，以便我们可以将它包含在电子邮件的消息或正文中。之后，我们可以把邮件的所有内容拼凑起来，选择我们想要的邮件主题。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="9ec0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了这个设置，我们应该能够运行脚本并收到类似这样的电子邮件！<em class="lv">注意——使用谷歌的Gmail时，您可能会在第一时间收到安全通知，并且可能需要并允许</em> <a class="ae ky" href="https://support.google.com/accounts/answer/6010255?hl=en" rel="noopener ugc nofollow" target="_blank"> <em class="lv">不太安全的应用</em> </a> <em class="lv">使用您的凭据发送电子邮件。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/c0af23e282e21bae877ec4c698d0a478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*onbu8iOdljUl8HF-L79wCg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">程序成功发送电子邮件提醒的示例(由作者提供)</p></figure><h1 id="c613" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">把所有东西放在一起</h1><p id="b25e" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们现在有一个完整的预警系统来跟踪鱼类资源的更新！完整的代码将包括错误处理，以及捕捉任何通知我们可能发生的任何潜在问题，如果PDF文件格式或数据以某种方式改变，不能再由程序的代码捕获。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><h1 id="ea57" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">自动化脚本</h1><p id="70b5" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">从这里开始，最后一步是自动运行警报系统。有许多方法可以做到这一点，但主要有两种方法:</p><ol class=""><li id="9728" class="nc nd it lb b lc ld lf lg li ne lm nf lq ng lu nh ni nj nk bi translated">在本地运行，通过<code class="fe mv mw mx my b">Task Scheduler</code> (Windows)或<code class="fe mv mw mx my b">cron</code> (Mac或Linux)等软件进行调度。</li><li id="e5c4" class="nc nd it lb b lc nl lf nm li nn lm no lq np lu nh ni nj nk bi translated">将程序部署到供应商的云平台，如<code class="fe mv mw mx my b">Heroku</code>或<code class="fe mv mw mx my b">AWS</code>，并使用他们的工具对其进行调度。</li></ol><p id="0eb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一种方法很容易设置，而且是免费的，但是需要启动机器才能运行脚本。第二种方法是托管在云中的服务器上，因此可以随时运行，但可能更复杂，并且可能需要花费资金来设置。</p><p id="54ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于我们的目的，我已经使用免费会员在Heroku上部署了该应用程序，并安排脚本每小时运行一次。这足够每月免费运行，不需要超过Heroku为其基本会员提供的免费时间或积分。在Heroku上部署将需要我们的主程序中一些额外的步骤，以及额外的文件，如<code class="fe mv mw mx my b">requirements.txt</code>和<code class="fe mv mw mx my b">runtime.txt</code>文件。</p><p id="4ea5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你更喜欢在本地运行程序，有很多很棒的教程教你如何使用像任务调度器这样的工具。</p><div class="nq nr gp gr ns nt"><a rel="noopener follow" target="_blank" href="/automate-your-python-scripts-with-task-scheduler-661d0a40b279"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd iu gy z fp ny fr fs nz fu fw is bi translated">使用任务调度器自动化您的Python脚本</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">Windows任务计划程序抓取替代数据</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">towardsdatascience.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh ks nt"/></div></div></a></div></div><div class="ab cl oi oj hx ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="im in io ip iq"><p id="f900" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你觉得这个教程是有用的，令人愉快的。如果您有任何问题或反馈，请联系我们。如果您对Heroku上更深入的部署指南感兴趣，请随时在下面发表评论！</p><p id="b46c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">这个项目的所有代码都可以在这个</em> <a class="ae ky" href="https://github.com/bicachu/fish-stocking-report-alert" rel="noopener ugc nofollow" target="_blank"> <em class="lv"> Github资源库</em> </a> <em class="lv">中找到，您可以下载并立即开始运行，无论是在本地还是在Heroku(如果您有帐户的话)。</em></p></div></div>    
</body>
</html>