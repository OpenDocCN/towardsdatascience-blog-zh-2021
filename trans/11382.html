<html>
<head>
<title>Scale-up your models development with MLflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 MLflow 扩展您的模型开发</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/scale-up-your-models-development-with-mlflow-4b78a5f22cb7?source=collection_archive---------27-----------------------#2021-11-08">https://towardsdatascience.com/scale-up-your-models-development-with-mlflow-4b78a5f22cb7?source=collection_archive---------27-----------------------#2021-11-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="8f33" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本文中，让我们看看您的数据科学团队如何👩‍💻👨‍💻可以通过 MLflow SDK 体验🧪的新模式。如果你对 MLflow 感兴趣，并且想更进一步，请跟我来，✋</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/60da8655770edc017acf08886299525f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EHSHG9Y2Zie9XpkyiZ5QiA.jpeg"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片由<a class="ae le" href="https://unsplash.com/@jorgedevs" rel="noopener ugc nofollow" target="_blank"> Jorge Ramirez </a>在<a class="ae le" href="https://unsplash.com/photos/nr3AmB4_B8g" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。用 MLflow 整理你的数据线！</p></figure><div class="lf lg gp gr lh li"><a href="https://medium.com/@stefanobosisio1/membership" rel="noopener follow" target="_blank"><div class="lj ab fo"><div class="lk ab ll cl cj lm"><h2 class="bd iu gy z fp ln fr fs lo fu fw is bi translated">通过我的推荐链接加入 Medium-Stefano Bosisio</h2><div class="lp l"><h3 class="bd b gy z fp ln fr fs lo fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="lq l"><p class="bd b dl z fp ln fr fs lo fu fw dk translated">medium.com</p></div></div><div class="lr l"><div class="ls l lt lu lv lr lw ky li"/></div></div></a></div><h2 id="92f4" class="lx ly it bd lz ma mb dn mc md me dp mf kb mg mh mi kf mj mk ml kj mm mn mo mp bi translated">目录</h2><p id="7a2d" class="pw-post-body-paragraph jq jr it js b jt mq jv jw jx mr jz ka kb ms kd ke kf mt kh ki kj mu kl km kn im bi translated">— <a class="ae le" href="#3572" rel="noopener ugc nofollow">什么是 MLflow？</a> <br/> — <a class="ae le" href="#9e26" rel="noopener ugc nofollow">十秒钟介绍 MLflow 环境</a> <br/> — <a class="ae le" href="#d1ba" rel="noopener ugc nofollow">帮助您的团队:迈向 MLflow SDK </a> <br/> — <a class="ae le" href="#8f2f" rel="noopener ugc nofollow">实现 MLflow 跟踪 SDK 类</a><br/>—<a class="ae le" href="#5984" rel="noopener ugc nofollow">对象构造器</a><br/>—<a class="ae le" href="#cc98" rel="noopener ugc nofollow">读取输入参数</a>—<br/>—<a class="ae le" href="#a808" rel="noopener ugc nofollow">设置器和获取器</a><br/>—<a class="ae le" href="#6cac" rel="noopener ugc nofollow">训练模型例程<br/></a></p><h1 id="3572" class="mv ly it bd lz mw mx my mc mz na nb mf nc nd ne mi nf ng nh ml ni nj nk mo nl bi translated">什么是 MLflow？</h1><p id="7fc9" class="pw-post-body-paragraph jq jr it js b jt mq jv jw jx mr jz ka kb ms kd ke kf mt kh ki kj mu kl km kn im bi translated"><a class="ae le" href="https://mlflow.org/" rel="noopener ugc nofollow" target="_blank"> MLflow </a>是一个机器学习的开源平台，覆盖整个 ML 模型周期，从开发到生产再到报废。MLflow 直接来自 Databricks，它可以与任何库、语言和框架一起工作，并且可以在云上运行，它是跨团队协作的关键产品。</p><p id="13c4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以定义四种 MLflow 产品:</p><ul class=""><li id="1cdc" class="nm nn it js b jt ju jx jy kb no kf np kj nq kn nr ns nt nu bi translated"><a class="ae le" href="https://mlflow.org/docs/latest/tracking.html" rel="noopener ugc nofollow" target="_blank">ml 流量跟踪</a>:该组件涵盖模型实验阶段。数据科学家可以研究和开发不同的数据和模型参数，收集 MLflow 中的所有相关信息，并选择哪个模型可以进入生产阶段</li><li id="dea2" class="nm nn it js b jt nv jx nw kb nx kf ny kj nz kn nr ns nt nu bi translated"><a class="ae le" href="https://mlflow.org/docs/latest/projects.html" rel="noopener ugc nofollow" target="_blank"> MLflow 项目</a>:在大型协作中，数据、API、代码需要共享的情况经常发生。合作者经常会遇到安装问题、模型中的问题、代码分段错误和其他类似的“威胁生命”的障碍。允许使用一种通用的格式来打包数据代码，使它们更具可复制性，并在团队间共享而不会引发心脏病</li><li id="8799" class="nm nn it js b jt nv jx nw kb nx kf ny kj nz kn nr ns nt nu bi translated"><a class="ae le" href="https://mlflow.org/docs/latest/models.html" rel="noopener ugc nofollow" target="_blank"> MLflow 模型</a>:一旦一个团队登陆生产地，下一步就是避免模型的混乱和混乱。模型允许以简单直观的方式在不同的环境中部署机器学习模型</li><li id="3c70" class="nm nn it js b jt nv jx nw kb nx kf ny kj nz kn nr ns nt nu bi translated"><a class="ae le" href="https://mlflow.org/docs/latest/model-registry.html" rel="noopener ugc nofollow" target="_blank"> MLflow Model Registry </a>:以及如何避免生产中最后的混乱？注册中心是一个解决方案，它跟踪所有模型的状态，无论它们是在生产中、在试运行中还是最终退役。</li></ul><p id="8219" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将写 3 篇关于物流的文章，涉及物流跟踪和物流模型。特别是，在这个故事中，我将向您展示如何通过思考一个 MLflow SDK 来帮助您的团队，以便数据科学家可以跳过编码 MLflow 中的一些繁琐部分。在第二个故事中，我们将扩展 SDK 来检索指标，并为数据科学家创建直观的 Plotly 图，以及一些示例。最后，我将向您展示如何创建一个 MLflow 插件，它可用于在<a class="ae le" href="https://cloud.google.com/ai-platform/docs" rel="noopener ugc nofollow" target="_blank"> GCP 人工智能平台</a>中部署模型</p><h1 id="9e26" class="mv ly it bd lz mw mx my mc mz na nb mf nc nd ne mi nf ng nh ml ni nj nk mo nl bi translated">十秒钟 MLflow 环境介绍</h1><p id="1472" class="pw-post-body-paragraph jq jr it js b jt mq jv jw jx mr jz ka kb ms kd ke kf mt kh ki kj mu kl km kn im bi translated">MLflow 开发人员已经整理了这份精彩而全面的指南，让每个人都可以安装 MLflow 并开始使用它:<a class="ae le" href="https://mlflow.org/docs/latest/quickstart.html" rel="noopener ugc nofollow" target="_blank">https://mlflow.org/docs/latest/quickstart.html</a></p><p id="0052" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里，我将让您快速浏览一下，在本地机器上运行。安装 MLflow 后，我们可以编写一个类似这样的小代码:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oe of l"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图 MLflow 的简单介绍代码</p></figure><p id="29ba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过运行<code class="fe oa ob oc od b">python name_of_your_file.py</code>执行这段代码，这将在 MLflow 中启动一个记录过程。这就是 MLflow 发挥作用的地方！在您的 CLI 中，只需键入<code class="fe oa ob oc od b">mlflow ui</code>即可启动 MLflow 图形界面。前往<code class="fe oa ob oc od b">http://localhost:5000</code>(或<code class="fe oa ob oc od b">http://127.0.0.1:5000)</code>，你将进入 MLflow 界面(图 2):</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi og"><img src="../Images/84f54553139973225d340aff872df316.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yo2WqnHC-JYiHLiOOUqKoA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图 2: MLflow 用户界面。左边是实验列表，中间是基本信息、参数和指标。</p></figure><p id="756d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你点击一个特定的运行，你会得到一个新的窗口，如图 3 所示。在这里你可以检索运行的参数(例如，这可能是层数，批量大小，初始学习率等)，运行的指标作为互动图(例如，准确性作为功能的步骤/时期)和所有保存的人工制品</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oh"><img src="../Images/c8b48fe826be5905d57b546baf7b8e51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ja-Xn9R0zdQ8W8uKvblSAQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图 3: MLflow 单次运行用户界面。在这个窗口中，您可以获得关于代码运行和检查工件的更多细节</p></figure><h1 id="d1ba" class="mv ly it bd lz mw mx my mc mz na nb mf nc nd ne mi nf ng nh ml ni nj nk mo nl bi translated">帮助您的团队:迈向 MLflow SDK</h1><p id="f0b2" class="pw-post-body-paragraph jq jr it js b jt mq jv jw jx mr jz ka kb ms kd ke kf mt kh ki kj mu kl km kn im bi translated">到目前为止一切顺利，但现在是时候扩大规模，帮助您的数据科学团队将 MLflow 集成到他们已经存在的模型中了。构建在 MLflow 包之上的 MLflow SDK 将是一个完美的解决方案，不仅可以降低团队消化新技术的难度，还可以在一个简单的 Python 类中满足数据科学家的请求。<br/>首先，我们需要了解我们的 MLflow 类应该做什么，以及我们想要走什么样的道路。图 4 显示了一个可能的路线图，从 MLflow SDK 的创建到 CI/CD 和通过 MLflow 插件的部署</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oi"><img src="../Images/55481265b758fef19fe7ed5139e7d8b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bf_qfe7TDwuH__26vWE5yQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图 4:路线图草图。MLflow SDK 应该照顾现有的数据科学家的模型，并保存人工制品。然后，MLflow 部署插件可以将最终结果推向生产</p></figure><h1 id="8f2f" class="mv ly it bd lz mw mx my mc mz na nb mf nc nd ne mi nf ng nh ml ni nj nk mo nl bi translated">实现 MLflow 跟踪 SDK 类</h1><p id="01ef" class="pw-post-body-paragraph jq jr it js b jt mq jv jw jx mr jz ka kb ms kd ke kf mt kh ki kj mu kl km kn im bi translated">因此，第一步是设计一个实现 MLflow 的类，它可以具有以下功能:</p><ul class=""><li id="7658" class="nm nn it js b jt ju jx jy kb no kf np kj nq kn nr ns nt nu bi translated"><code class="fe oa ob oc od b">read_params</code>此函数读取设置新 MLflow 实验所需的跟踪输入参数</li><li id="71ab" class="nm nn it js b jt nv jx nw kb nx kf ny kj nz kn nr ns nt nu bi translated"><code class="fe oa ob oc od b">set_tracking_uri</code>和<code class="fe oa ob oc od b">get_tracking_uri</code>:这两个函数分别设置 mlflow 跟踪 uri ( <code class="fe oa ob oc od b">mlflow.set_tracking_uri</code>)并返回当前跟踪 uri</li><li id="205b" class="nm nn it js b jt nv jx nw kb nx kf ny kj nz kn nr ns nt nu bi translated"><code class="fe oa ob oc od b">set_experiment_id</code>和<code class="fe oa ob oc od b">get_experiment_id</code>:set 函数检查是否已经给出了一个<code class="fe oa ob oc od b">experiment_name</code>，否则创建一个新的。</li><li id="b593" class="nm nn it js b jt nv jx nw kb nx kf ny kj nz kn nr ns nt nu bi translated"><code class="fe oa ob oc od b">run_training</code>:这是捕获模型参数和指标的主要函数(主要通过使用 Python 模块<code class="fe oa ob oc od b">inspect</code>)。模型的参数和指标由<code class="fe oa ob oc od b">mlflow</code>通过<code class="fe oa ob oc od b">mlflow.package.autolog</code>功能自动检索。</li><li id="d4dc" class="nm nn it js b jt nv jx nw kb nx kf ny kj nz kn nr ns nt nu bi translated"><code class="fe oa ob oc od b">log_any_model_file</code>:有时 MLflow 自动登录功能无法将保存的模型文件上传到 MLflow-server。在这些情况下，该功能可以帮助数据科学家。事实上，一旦训练完成，调用这个函数，就可以找到工作运行目录中的所有<code class="fe oa ob oc od b">.joblib</code>、<code class="fe oa ob oc od b">.h5</code>、<code class="fe oa ob oc od b">.pkl</code>、<code class="fe oa ob oc od b">.model</code>文件，以及<code class="fe oa ob oc od b">png</code>格式的度量和<code class="fe oa ob oc od b">json</code>元数据文件，并正确地报告给 MLflow-server。</li></ul><h2 id="5984" class="lx ly it bd lz ma mb dn mc md me dp mf kb mg mh mi kf mj mk ml kj mm mn mo mp bi translated">对象构造函数</h2><p id="1bcf" class="pw-post-body-paragraph jq jr it js b jt mq jv jw jx mr jz ka kb ms kd ke kf mt kh ki kj mu kl km kn im bi translated">现在让我们开始编写代码，设置一个类接口和协议以及它的构造函数。有一个云存储选项可能是有用的，所以你可以导入它(例如<code class="fe oa ob oc od b">from your_cloud_provider import storage_module</code>)并将工件直接保存在云上。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oe of l"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图 5:设置 MLflow SDK 接口和协议。SDK 将存在于这个主对象上</p></figure><h2 id="cc98" class="lx ly it bd lz ma mb dn mc md me dp mf kb mg mh mi kf mj mk ml kj mm mn mo mp bi translated">读取输入参数</h2><p id="6c84" class="pw-post-body-paragraph jq jr it js b jt mq jv jw jx mr jz ka kb ms kd ke kf mt kh ki kj mu kl km kn im bi translated">接下来，我们可以开始考虑解析并读取参数。数据科学家可以使用 Python 字典中给定的指令和参数解析<code class="fe oa ob oc od b">yaml</code>或<code class="fe oa ob oc od b">json</code>或<code class="fe oa ob oc od b">txt</code>输入文件，这些文件可以由类直接读取:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oe of l"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图 6:读取参数功能。数据科学家可以将输入文件解析到字典中，字典提供诸如跟踪 uri(例如，<a class="ae le" href="http://localhost:5000)," rel="noopener ugc nofollow" target="_blank"> http://localhost:5000)、</a>以及存储位置、运行名称和标签等指令</p></figure><p id="27d0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本例中，我添加了<code class="fe oa ob oc od b">self.caller</code>,稍后我们将看到这些信息是如何传递给 SDK 的，但是这个变量的目的是记录哪个脚本调用了 MLflow SDK，将 Python 脚本复制到工件中，并实现代码传承。代码沿袭在运行时很有用，因为可以发生许多修改，尽管数据科学家可以跟踪 Github 中的变化，但一些变化可能会丢失，导致令人困惑和神秘的结果。</p><h2 id="a808" class="lx ly it bd lz ma mb dn mc md me dp mf kb mg mh mi kf mj mk ml kj mm mn mo mp bi translated">Setters 和 getters</h2><p id="385e" class="pw-post-body-paragraph jq jr it js b jt mq jv jw jx mr jz ka kb ms kd ke kf mt kh ki kj mu kl km kn im bi translated">接下来，我们需要注意设置器和获取器(图 7)。这些函数听起来可能没什么用，但在执行大量长代码时，它们非常重要，可以挽救你的生命！</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oe of l"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图 7:主类的 Setters 和 getters。</p></figure><p id="3b8d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe oa ob oc od b">set_experiment_id</code>上花几秒钟来创建一个新实验是值得的<code class="fe oa ob oc od b">experiment_name</code>和<code class="fe oa ob oc od b">tracking_storage</code>被传递给<code class="fe oa ob oc od b">mlflow.create_experiment(experiment_name, tracking_bucket)</code>，从那里<code class="fe oa ob oc od b">experiment_id</code>被取回。<code class="fe oa ob oc od b">experiment_id</code>和<code class="fe oa ob oc od b">run_name</code>都是<strong class="js iu">强制</strong>在 MLflow 中开始新的运行，因此我们需要特别注意这些变量。</p><h2 id="6cac" class="lx ly it bd lz ma mb dn mc md me dp mf kb mg mh mi kf mj mk ml kj mm mn mo mp bi translated">训练模型例程</h2><p id="c328" class="pw-post-body-paragraph jq jr it js b jt mq jv jw jx mr jz ka kb ms kd ke kf mt kh ki kj mu kl km kn im bi translated">现在，我们已经准备好进行日常训练了。通常，MLflow 通过上下文管理器来跟踪模型训练作业，上下文管理器是一种 Python 协议，通常会简化一些资源管理模式:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oe of l"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图 8:来自 MLflow 教程(<a class="ae le" href="https://www.mlflow.org/docs/latest/tutorials-and-examples/tutorial.html" rel="noopener ugc nofollow" target="_blank">https://www . ml flow . org/docs/latest/tutorials-and-examples/tutorials . html</a>)的关于培训跟踪的示例</p></figure><p id="6877" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上下文管理器的问题是<code class="fe oa ob oc od b">with mlflow.start_run()</code>只有在训练 Python 代码中被直接调用时才能记录工件和训练会话。对于数据科学家来说，这可能是一项非常枯燥的重组任务，他们应该重新编写部分代码来适应这一功能。想要的解决方案应该是类似的:</p><pre class="kp kq kr ks gt oj od ok ol aw om bi"><span id="ff2e" class="lx ly it od b gy on oo l op oq">from your_mlflow_sdk import experiment_tracking<br/>...</span><span id="8ea1" class="lx ly it od b gy or oo l op oq">if tracking: # if you decide to track:<br/>    experiment_tracking.start_trianing_job(input_parameters)<br/>    history = model.fit(**fit_params)<br/>    <br/>    # report additional metrics (we'll see below) <br/>    experiment_tracking.end_training_job(input_parameters)<br/>else:<br/>    history = model.fit(**fit_params) # normal training</span></pre><p id="6c18" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe oa ob oc od b">run_training</code>函数应该可以处理这个问题，它可以监听用户正在做什么，而不会干扰已经编写好的代码:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oe of l"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图 9:主训练函数，可以被调用来记录所有的模型人工制品</p></figure><p id="8790" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该函数调用<code class="fe oa ob oc od b">mlflow.autlog()</code>函数，对监听<code class="fe oa ob oc od b">xgboost</code>、<code class="fe oa ob oc od b">sklearn</code>、<code class="fe oa ob oc od b">tensorflow</code>、<code class="fe oa ob oc od b">keras</code>和<code class="fe oa ob oc od b">lightgbm</code>模块提供了极好的支持，自动将所有模型参数报告给主界面。该函数的核心是<code class="fe oa ob oc od b">mlflow.start_run()</code>,它设置要记录的运行，正如我上面所说的，它将调用者 Python 脚本<code class="fe oa ob oc od b">self.caller</code>作为<code class="fe oa ob oc od b">mlflow.log_artifact(self.caller, artifact_path='code')</code>报告给 artefacts 文件夹<code class="fe oa ob oc od b">code </code></p><h2 id="a380" class="lx ly it bd lz ma mb dn mc md me dp mf kb mg mh mi kf mj mk ml kj mm mn mo mp bi translated">将任何模型文件/工件记录到 MLflow 中</h2><p id="67b3" class="pw-post-body-paragraph jq jr it js b jt mq jv jw jx mr jz ka kb ms kd ke kf mt kh ki kj mu kl km kn im bi translated">避免上下文管理器的一个问题是，并非所有生成的模型文件都会自动保存到 MLflow 服务器。例如，在我的例子中，许多模型文件保存在本地或云中，但是我希望它们也在 MLflow 服务器中报告。为了解决这个问题，图 10 中的<code class="fe oa ob oc od b">log_any_model_file</code>开始发挥作用。</p><p id="b5c6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该函数调用新运行的实验。它检查实验运行是否顺利。然后，它查看一个给定的存储位置，本地或云，以查看在那里保存和创建了哪些文件。接下来，扫描想要的格式列表，<code class="fe oa ob oc od b">local_file_to_upload</code>，运行一个 for 循环，用<code class="fe oa ob oc od b">client.log_artifact(run_id, file_to_upload, artifact_path='model')</code>将所有找到的文件记录到一个<code class="fe oa ob oc od b">model</code>文件夹中</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oe of l"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图 10:将任何元数据和模型文件记录到 MLflow 服务器。有时不是所有的文件都由 MLflow 直接保存，尤其是在使用混合模型时。因此，该功能在云上或本地寻找额外的工件，并将它们上传到 MLflow 服务器</p></figure><h1 id="b9d2" class="mv ly it bd lz mw mx my mc mz na nb mf nc nd ne mi nf ng nh ml ni nj nk mo nl bi translated">在一个模块中修补所有内容</h1><p id="e073" class="pw-post-body-paragraph jq jr it js b jt mq jv jw jx mr jz ka kb ms kd ke kf mt kh ki kj mu kl km kn im bi translated">现在，您已经创建了 MLflow SDK 的基础，我们可以继续实现一个培训模块，数据科学家可以将其用于他们的实验。模块名可以是实现功能<code class="fe oa ob oc od b">start_training_job</code>和<code class="fe oa ob oc od b">end_training_job</code>的<code class="fe oa ob oc od b">experiment_tracking_training.py</code>。</p><p id="f1bc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">前一个函数设置 MLflow 跟踪作业。它通过带有<code class="fe oa ob oc od b">caller = traceback.extract_stack()[-2][0]</code>的<code class="fe oa ob oc od b">traceback</code>模块检索调用者 Python 脚本代码，这将在工件中报告。然后，它初始化实验参数，最后开始训练运行<code class="fe oa ob oc od b">runner.run_training()</code></p><p id="6c09" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe oa ob oc od b">end_training_job</code>可在模型拟合后调用，通过<code class="fe oa ob oc od b">log_any_model_file()</code>检索任何其他可能的未保存文件</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oe of l"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图 11:使用 MLflow 开始和完成培训工作会话记录的模块。start_training_job 初始化实验跟踪协议，而 end_training_job 检查未保存到 MLflow 服务器的其他工件。</p></figure></div><div class="ab cl os ot hx ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="im in io ip iq"><p id="01fa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">今天就到这里吧！我们经历了很多事情，如果你不熟悉 MLflow，你会一步一步地消化一切。请继续关注我们的下一个故事，它将展示如何向我们的实验报告额外的指标，并且我们将看到一些如何使用我们的 MLflow SDK 的示例:)</p><p id="9192" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你有任何问题或好奇，请给我发电子邮件到 stefanobosisio1@gmail.com</p></div></div>    
</body>
</html>