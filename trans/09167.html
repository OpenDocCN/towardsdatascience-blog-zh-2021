<html>
<head>
<title>Designing Custom ggplot2 Themes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">设计自定义ggplot2主题</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/designing-custom-ggplot2-themes-65fb4b86d925?source=collection_archive---------25-----------------------#2021-08-24">https://towardsdatascience.com/designing-custom-ggplot2-themes-65fb4b86d925?source=collection_archive---------25-----------------------#2021-08-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="efd1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">给你的图表一种态度</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d6b7f1c8091dd488f364cd0324ec55b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DY7Q1uI194ur0-TQAZSSjg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者的原创艺术</p></figure><p id="27c3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi lu translated">R与Python的辩论是数据科学家最喜欢的话题。然而，当谈到数据可视化时，<em class="md">your truly</em>有一个非常明确的偏好:<code class="fe me mf mg mh b">ggplot2</code>in R all way。</p><p id="e898" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">除了数据处理和格式化的便利性，<code class="fe me mf mg mh b">ggplot2</code>在它的可定制性方面表现出色。默认设置看起来很棒，虽然非常独特，但是通过一点规划，你完全可以改变可视化效果，以适应任何可以想象的审美。在这篇文章中，我将介绍如何创建一个自定义的<code class="fe me mf mg mh b">ggplot2</code>主题，可以应用到你的图表中。</p><h1 id="3cc5" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">重要的事情先来</h1><p id="187b" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">打开一个新的R脚本，它将包含您的定制。为了使您的设置可用，您将在构建任何可视化之前运行该脚本。你也可以把它打包成一个库，尽管这不是绝对必要的。</p><p id="cb4a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">确保加载必要的库。这里没有什么令人惊讶的，只是确保<code class="fe me mf mg mh b">ggplot</code>和<code class="fe me mf mg mh b">scales</code>在你做任何其他事情之前被载入。</p><pre class="kj kk kl km gt ng mh nh ni aw nj bi"><span id="d529" class="nk mj it mh b gy nl nm l nn no">library("ggplot2")<br/>library("scales")</span></pre><h1 id="6955" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">字体</h1><p id="8bf4" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">新字体，新的你。对吗？在图形中使用自定义字体有几种选择。</p><p id="f96f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第一种选择是使用你机器上已经有的字体。要访问它们，加载<code class="fe me mf mg mh b">extrafont</code>库并将所有字体导入r。警告:这很慢。一旦你运行了<code class="fe me mf mg mh b">font_import()</code>，把它注释掉，不要管它。如果你不确定哪些字体是可能的，使用<code class="fe me mf mg mh b">system_fonts()</code>查看列表。</p><pre class="kj kk kl km gt ng mh nh ni aw nj bi"><span id="a002" class="nk mj it mh b gy nl nm l nn no">library("extrafont")<br/>font_import() # only run this once then comment out. It's slow!<br/>extrafont::loadfonts()</span><span id="474d" class="nk mj it mh b gy np nm l nn no">library("systemfonts")<br/>system_fonts() # shows you available fonts</span></pre><p id="7297" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第二个选择是添加谷歌字体。<code class="fe me mf mg mh b">showtext</code>库将允许您使用<code class="fe me mf mg mh b">font_add_google()</code>功能从谷歌字体页面导入字体。在这个例子中，我导入了<em class="md"> Reenie Beanie </em>字体以获得有趣的手写效果。</p><pre class="kj kk kl km gt ng mh nh ni aw nj bi"><span id="404f" class="nk mj it mh b gy nl nm l nn no">library("showtext")<br/>## Loading Google fonts (<a class="ae nf" href="https://fonts.google.com/" rel="noopener ugc nofollow" target="_blank">https://fonts.google.com/</a>)<br/>graphFont = "Reenie Beanie"<br/>font_add_google(graphFont)</span></pre><h1 id="28a8" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">主题</h1><p id="53eb" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">在正常情况下，您可能会使用<code class="fe me mf mg mh b">theme()</code>参数对默认设置进行小的更改。因为<code class="fe me mf mg mh b">ggplot2</code>是分层的，将<code class="fe me mf mg mh b">+theme()</code>添加到可视化的末尾将覆盖任何之前的设置。</p><p id="1450" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以通过定义一个定制的主题来利用这种行为，该主题可以添加到任何可视化的末尾。这意味着你甚至可以回到旧的工作，应用你的新主题来实现一个一致的投资组合。在这个例子中，我定义了一个简单的主题，将所有的文本变成黑色，指定各种背景填充，并设置字体。不带运行<code class="fe me mf mg mh b">theme</code><em class="md">R中的括号会显示所有可能的主题选项。</em></p><pre class="kj kk kl km gt ng mh nh ni aw nj bi"><span id="1fec" class="nk mj it mh b gy nl nm l nn no">theme_custom = function(){<br/>  theme(<br/>    panel.background = element_blank(),<br/>    panel.grid = element_blank(),<br/>    axis.ticks = element_blank(),<br/>    axis.text = element_text(color = "black"),<br/>    legend.box.background = element_blank(),<br/>    legend.key = element_rect(fill = NA),<br/>    text = element_text(graphFont),<br/>    plot.title = element_text(size = 16)<br/>  )<br/>}</span></pre><h1 id="ea71" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">色阶</h1><p id="0e66" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">设置颜色预先计划的色阶可以节省大量时间——告别猜测你上次使用的洋红色的阴影。我喜欢用<a class="ae nf" href="https://coolors.co/" rel="noopener ugc nofollow" target="_blank"> coolors </a> app创建调色板，然后创建一个十六进制代码的矢量。</p><p id="1430" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请记住，您需要为<code class="fe me mf mg mh b">scale_color_manual()</code>和<code class="fe me mf mg mh b">scale_fill_manual()</code>设置一个比例，以说明不同的几何图形。</p><pre class="kj kk kl km gt ng mh nh ni aw nj bi"><span id="9322" class="nk mj it mh b gy nl nm l nn no">pal_custom = c("#9e0a0a", "#115035", "#ff9e97", "#f6cb4c")</span><span id="6fe0" class="nk mj it mh b gy np nm l nn no">### Scales <br/>custom_color_manual = function(){<br/>  scale_color_manual(values = pal_custom)<br/>}<br/>custom_fill_manual = function(){<br/>  scale_fill_manual(values = pal_custom)</span></pre><h1 id="353e" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">自定义几何图形</h1><p id="92a3" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">如果您希望特定类型的图形具有特定的行为，那么定制geoms是一种不错的方法。<code class="fe me mf mg mh b">update_geom_defaults()</code>功能完成了这个任务。在这些例子中，我要求点的大小至少为3，条的轮廓为白色，线的大小为1。</p><pre class="kj kk kl km gt ng mh nh ni aw nj bi"><span id="d937" class="nk mj it mh b gy nl nm l nn no">update_geom_defaults("point", list(size = 3))<br/>update_geom_defaults("bar", list(color = "white"))<br/>update_geom_defaults("line", list(size = 1))</span></pre><h1 id="ee60" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">分层主题</h1><p id="0715" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">如果一个主题还不够，你可以将主题分层。例如，如果你只是对一个现有的 <code class="fe me mf mg mh b"><a class="ae nf" href="https://ggplot2.tidyverse.org/reference/ggtheme.html" rel="noopener ugc nofollow" target="_blank">ggplot</a></code> <a class="ae nf" href="https://ggplot2.tidyverse.org/reference/ggtheme.html" rel="noopener ugc nofollow" target="_blank">主题</a>做一些小的改动，你可以先运行原来的，然后再添加你的改动。</p><p id="ea81" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这个例子中，我使用了Emilio Torres-Manzanera的xkcd主题来实现轴的手绘外观，然后在最后应用了我的自定义主题。</p><pre class="kj kk kl km gt ng mh nh ni aw nj bi"><span id="19e9" class="nk mj it mh b gy nl nm l nn no">ggplot(data=iris, aes(x=Sepal.Width)) + <br/>  geom_histogram(binwidth=0.1, aes(fill=Species)) + <br/>  custom_fill_manual() + <br/>  xlab("X-axis title") +  <br/>  ylab("Y-axis title") + <br/>  ggtitle("Main chart title") + <br/>  theme_xkcd() +<br/>  xkcdaxis(range(iris$Sepal.Width),range(c(0, 30)))  + <br/>  theme_custom()</span></pre><h1 id="a413" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">之前和之后</h1><p id="dd95" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">这个特殊的主题可能不适合你，但它肯定不同于默认的外观:</p><div class="kj kk kl km gt ab cb"><figure class="nq kn nr ns nt nu nv paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/46a2ee7fe5818cbe7547131c7959a240.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*LuQbba01x9YEe4iJa5PJbQ.png"/></div></figure><figure class="nq kn nw ns nt nu nv paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/790b76e8bbd63f8e64e803d6bd7c11db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*ODAaGc9FKErNJAbXwa8wDA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk nx di ny nz translated">默认ggplot2主题(左)与自定义主题(右)的对比</p></figure></div><h1 id="0252" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">测试</h1><p id="1a3e" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">为你的可视化建立一个定制的美学需要一些迭代和测试。我建议构建一些测试视觉效果，可以在更新主题时运行——这将让您预览不同图表类型的效果。拥有少量的测试图也可以让你进行可访问性检查，并确保你的主题是用户友好的。我使用<a class="ae nf" href="https://apps.apple.com/us/app/sim-daltonism/id693112260?mt=12" rel="noopener ugc nofollow" target="_blank"> Sim Daltonism </a>应用来评估调色板，使用<a class="ae nf" href="https://accessibilityinsights.io/en/downloads/" rel="noopener ugc nofollow" target="_blank"> Accessibility Insights </a>扩展来检查网页元素。</p><p id="104f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">knitter(<code class="fe me mf mg mh b">.Rnw</code>)或R Markdown ( <code class="fe me mf mg mh b">.Rmd</code>)脚本非常适合测试，因为它可以很容易地重新编译以生成一个可共享的文档。像这样简单的事情就能达到目的:</p><pre class="kj kk kl km gt ng mh nh ni aw nj bi"><span id="3942" class="nk mj it mh b gy nl nm l nn no">\documentclass[a4paper]{article}<br/>\begin{document}</span><span id="20ef" class="nk mj it mh b gy np nm l nn no">&lt;&lt;projections, include=FALSE, cache=FALSE&gt;&gt;==<br/>source("branding.R")<br/>opts_chunk$set(dev='cairo_pdf')<br/>@</span><span id="8d2a" class="nk mj it mh b gy np nm l nn no">&lt;&lt;renderimage, echo = FALSE, fig.height = 3, fig.width = 5, fig.align='center'&gt;&gt;==</span><span id="1895" class="nk mj it mh b gy np nm l nn no">ggplot(data=iris, aes(x=Sepal.Width)) + <br/>  geom_histogram(binwidth=0.1, aes(fill=Species)) + <br/>  custom_fill_manual() + <br/>  xlab("X-axis title") +  <br/>  ylab("Y-axis title") + <br/>  ggtitle("Main chart title") + <br/>  theme_xkcd() +<br/>  xkcdaxis(range(iris$Sepal.Width),range(c(0, 30)))  + <br/>  theme_custom()</span><span id="be31" class="nk mj it mh b gy np nm l nn no">@</span><span id="1e55" class="nk mj it mh b gy np nm l nn no">\end{document}</span></pre></div><div class="ab cl oa ob hx oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="im in io ip iq"><p id="68dc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就是这样！我希望这能给你一些如何为自己的<code class="fe me mf mg mh b">ggplot2</code>作品创建自定义主题的想法。从小处着手，看看什么有效，然后在此基础上进行构建。你的图表很快就会引人注目。</p><p id="04f7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">思考数据可视化中的可访问性？太好了！以下是一些开始的方法:</p><div class="oh oi gp gr oj ok"><a rel="noopener follow" target="_blank" href="/an-incomplete-guide-to-accessible-data-visualization-33f15bfcc400"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">易访问数据可视化的不完整指南</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">做得更好的实用技巧。</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">towardsdatascience.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy ks ok"/></div></div></a></div></div></div>    
</body>
</html>