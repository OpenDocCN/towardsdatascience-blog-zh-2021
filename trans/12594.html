<html>
<head>
<title>Use Pipe Operations in Python for More Readable and Faster Coding</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Python 中使用管道操作以获得更好的可读性和更快的编码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pipe-operations-in-python-1e8f8debe26?source=collection_archive---------6-----------------------#2021-12-27">https://towardsdatascience.com/pipe-operations-in-python-1e8f8debe26?source=collection_archive---------6-----------------------#2021-12-27</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="19fd" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">一个方便的 Python 包，可以节省大量的编码时间，并提高 shell 风格管道操作的可读性</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/292985669ff97aba8eae39514cd03e19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lHk7fXxqnUjg8C2V2g4FcA.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">使用管道操作在单个语句中创建多个数据操作的链。照片由来自 Pexels 的 Joey Kyber 拍摄</p></figure><p id="85e5" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">Python 已经是一种优雅的编程语言。但不代表没有进步的空间。</p><p id="d11b" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">Pipe 是一个漂亮的包，它将 Python 处理数据的能力提升到了一个新的水平。它采用类似 SQL 的声明性方法来操作集合中的元素。它可以过滤、转换、排序、删除重复项、执行分组操作等等，而不需要编写大量代码。</p><p id="b429" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在这篇小文章中，让我们讨论如何用管道简化我们的 python 代码。最重要的是，我们将构建定制的可重用管道操作，以便在我们的项目中重用。</p><p id="e6d6" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">让我们从</p><ul class=""><li id="8afa" class="lv lw iu lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">一个励志的例子；</li><li id="c0be" class="lv lw iu lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">一些有用的开箱即用管道操作，以及；</li><li id="26e2" class="lv lw iu lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">构建我们自己的管道运营。</li></ul><p id="89dd" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">如果您想知道如何设置它，您可以很容易地用 PyPI 安装<a class="ae mj" href="https://github.com/JulienPalard/Pipe" rel="noopener ugc nofollow" target="_blank">管道</a>。这是你需要做的。</p><pre class="kk kl km kn gu mk ml mm mn aw mo bi"><span id="b725" class="mp mq iu ml b gz mr ms l mt mu">pip install pipe</span></pre></div><div class="ab cl mv mw hy mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="in io ip iq ir"><h1 id="1e40" class="nc mq iu bd nd ne nf ng nh ni nj nk nl ka nm kb nn kd no ke np kg nq kh nr ns bi translated">开始在 Python 中使用管道。</h1><p id="ecb2" class="pw-post-body-paragraph kz la iu lb b lc nt jv le lf nu jy lh li nv lk ll lm nw lo lp lq nx ls lt lu in bi translated">这里有一个使用管道的例子。假设我们有一个数字列表，我们想，</p><ul class=""><li id="0e06" class="lv lw iu lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">删除所有重复项；</li><li id="28f2" class="lv lw iu lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">仅过滤奇数；</li><li id="5ba8" class="lv lw iu lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">平方列表中的每个元素，以及；</li><li id="0bc6" class="lv lw iu lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">按升序对值进行排序；</li></ul><p id="325f" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这是我们在普通 Python 中通常会做的事情。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">一些使用基本 Python 的数据争论——由<a class="ae mj" href="https://thuwarakesh.medium.com" rel="noopener">作者</a>编写的代码片段。</p></figure><pre class="kk kl km kn gu mk ml mm mn aw mo bi"><span id="0cd3" class="mp mq iu ml b gz mr ms l mt mu">[1, 49, 169, 361, 441, 729]</span></pre><p id="36f5" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">上面的代码非常易读。但是这里有一个更好的使用管道的方法。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Pipe 如何提高 Python 中代码的可读性——作者<a class="ae mj" href="https://thuwarakesh.medium.com" rel="noopener">的代码片段</a>。</p></figure><pre class="kk kl km kn gu mk ml mm mn aw mo bi"><span id="e2c4" class="mp mq iu ml b gz mr ms l mt mu">[1, 49, 169, 361, 441, 729]</span></pre><p id="74f9" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">两种代码产生相同的结果。然而第二个比第一个更直观。显然，它的代码行也更少了。</p><p id="bb3c" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这就是 Pipe 帮助我们简化代码的方式。我们可以对集合进行链式操作，而无需编写单独的代码行。</p><div class="oa ob gq gs oc od"><a rel="noopener follow" target="_blank" href="/python-code-formatting-made-simple-with-git-pre-commit-hooks-9233268cdf64"><div class="oe ab fp"><div class="of ab og cl cj oh"><h2 class="bd iv gz z fq oi fs ft oj fv fx it bi translated">使用 Git 预提交挂钩简化 Python 代码格式化</h2><div class="ok l"><h3 class="bd b gz z fq oi fs ft oj fv fx dk translated">写大家都会爱上的代码。</h3></div><div class="ol l"><p class="bd b dl z fq oi fs ft oj fv fx dk translated">towardsdatascience.com</p></div></div><div class="om l"><div class="on l oo op oq om or kt od"/></div></div></a></div><p id="27ed" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">但是在 Pipe 中有更酷的操作，就像我们在上面的例子中使用的那样。此外，如果我们需要非常独特的东西，我们可以创建一个。我们先来探讨一些预置的操作。</p><h1 id="feb2" class="nc mq iu bd nd ne os ng nh ni ot nk nl ka ou kb nn kd ov ke np kg ow kh nr ns bi translated">最有用的管道操作</h1><p id="68a7" class="pw-post-body-paragraph kz la iu lb b lc nt jv le lf nu jy lh li nv lk ll lm nw lo lp lq nx ls lt lu in bi translated">我们已经看到了几个管道在工作。但是还有更多。在这一节中，让我们讨论一些其他有用的现成数据操作。</p><p id="f0f0" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这些并不是管道安装的完整操作列表。要获得详细的清单，请参考 GitHub 上的<a class="ae mj" href="https://github.com/JulienPalard/Pipe" rel="noopener ugc nofollow" target="_blank">管道库。</a></p><h2 id="0276" class="mp mq iu bd nd ox oy dn nh oz pa dp nl li pb pc nn lm pd pe np lq pf pg nr ph bi translated">分组依据</h2><p id="8817" class="pw-post-body-paragraph kz la iu lb b lc nt jv le lf nu jy lh li nv lk ll lm nw lo lp lq nx ls lt lu in bi translated">我相信这是对数据科学家最有用的管道。我们更喜欢在熊猫身上做，我仍然喜欢用它。但是将一个列表转换成一个数据集有时感觉有点矫枉过正。在所有这些情况下，我都可以随时使用这种按管道分组的操作。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">使用 group by pipe 操作—作者为<a class="ae mj" href="https://thuwarakesh.medium.com" rel="noopener">的代码片段</a>。</p></figure><p id="67fa" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">上面的代码将我们的数据集分组为奇数和偶数。它创建一个二元组列表。每个元组都有在 lambda 函数和分组对象中指定的名称。因此，上面的代码产生了下面的组。</p><pre class="kk kl km kn gu mk ml mm mn aw mo bi"><span id="1ed8" class="mp mq iu ml b gz mr ms l mt mu">[<br/>    ('Even', &lt;itertools._grouper object at 0x7fdc05ed0310&gt;),<br/>    ('Odd', &lt;itertools._grouper object at 0x7fdc05f88700&gt;),<br/>]</span></pre><p id="4f41" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我们现在可以为我们创建的每个组分别执行操作。这里有一个例子，它从每组中取出元素，然后将它们平方。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">将变换应用到组——由<a class="ae mj" href="https://thuwarakesh.medium.com" rel="noopener">作者</a>编写的代码片段。</p></figure><pre class="kk kl km kn gu mk ml mm mn aw mo bi"><span id="79d2" class="mp mq iu ml b gz mr ms l mt mu">[<br/>    {'Even': [16, 4, 36, 64, 100, 400, 324]}, <br/>    {'Odd': [1, 729, 49, 169, 361, 441, 49, 729]},<br/>]</span></pre><h2 id="05dd" class="mp mq iu bd nd ox oy dn nh oz pa dp nl li pb pc nn lm pd pe np lq pf pg nr ph bi translated">链条和导线</h2><p id="205b" class="pw-post-body-paragraph kz la iu lb b lc nt jv le lf nu jy lh li nv lk ll lm nw lo lp lq nx ls lt lu in bi translated">这两个操作使得展开一个嵌套列表变得很容易。该链一步一步地执行，递归地遍历，直到列表不再扩展。</p><p id="8cf4" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">下面是链条的工作原理。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">使用链式管道操作在 Python 中展开嵌套列表—代码片段由<a class="ae mj" href="https://thuwarakesh.medium.com" rel="noopener">作者</a>编写。</p></figure><pre class="kk kl km kn gu mk ml mm mn aw mo bi"><span id="ce08" class="mp mq iu ml b gz mr ms l mt mu">[1, 2, 3, 4, 5, 6, 7, [8, 9]]</span></pre><p id="f3f5" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">正如我们所看到的，chain 展开了列表的最外层。8 和 9 保留在嵌套列表中，因为它们已经向下嵌套了一层。</p><p id="d3d3" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">以下是使用 traverse 的结果。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">使用遍历管道操作递归展开多层嵌套列表——作者<a class="ae mj" href="https://thuwarakesh.medium.com" rel="noopener">的代码片段</a>。</p></figure><pre class="kk kl km kn gu mk ml mm mn aw mo bi"><span id="59b5" class="mp mq iu ml b gz mr ms l mt mu">[1, 2, 3, 4, 5, 6, 7, 8, 9]</span></pre><p id="8f7b" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">特拉弗斯展开了它能展开的一切。</p><p id="ad0f" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我主要用列表理解来展开列表。但是阅读和理解代码中发生的事情变得越来越困难。此外，当我们不知道有多少嵌套层时，很难像上面例子中的遍历操作那样递归扩展。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">我老派的展开嵌套列表的方式——作者<a class="ae mj" href="https://thuwarakesh.medium.com" rel="noopener">作者</a>的代码片段。</p></figure><h2 id="f310" class="mp mq iu bd nd ox oy dn nh oz pa dp nl li pb pc nn lm pd pe np lq pf pg nr ph bi translated">Take_while 和 Skip_while</h2><p id="fc6a" class="pw-post-body-paragraph kz la iu lb b lc nt jv le lf nu jy lh li nv lk ll lm nw lo lp lq nx ls lt lu in bi translated">这两个操作类似于我们前面使用的“where”操作。关键的区别在于，如果满足某些条件，take_while 和 skip_while 会停止查看集合中的其他元素。而另一方面，计算列表中的每个元素。</p><p id="fa19" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">下面是 take_while 和 where 在过滤小于 5 的值的简单任务中的工作方式。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">使用 take_while 管道操作在满足特定条件时停止执行—代码片段由<a class="ae mj" href="https://thuwarakesh.medium.com" rel="noopener">作者</a>编写。</p></figure><p id="9051" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">上述代码的结果如下:</p><pre class="kk kl km kn gu mk ml mm mn aw mo bi"><span id="fa3d" class="mp mq iu ml b gz mr ms l mt mu">take_while: [5, 3]<br/>where: [3, 4, 3]</span></pre><p id="b85e" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">请注意，take_while 操作跳过了最终的“3 ”,而“where”进程包含了它。</p><p id="ab0a" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">Skip_while 的工作方式很像 take_while，只是它只在满足某些条件时包含元素。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">满足特定条件时使用 skip_while 管道开始执行——作者<a class="ae mj" href="https://thuwarakesh.medium.com" rel="noopener">作者</a>的代码片段。</p></figure><pre class="kk kl km kn gu mk ml mm mn aw mo bi"><span id="b1da" class="mp mq iu ml b gz mr ms l mt mu">[5, 3]</span></pre><p id="a5e7" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">正如我前面提到的，这些并不是您可以使用管道库做的事情的完整列表。更多的内置函数和例子请查看资源库。</p><h1 id="e9cb" class="nc mq iu bd nd ne os ng nh ni ot nk nl ka ou kb nn kd ov ke np kg ow kh nr ns bi translated">创建新的管道操作</h1><p id="4255" class="pw-post-body-paragraph kz la iu lb b lc nt jv le lf nu jy lh li nv lk ll lm nw lo lp lq nx ls lt lu in bi translated">创建新的管道操作相对容易。我们所需要的就是用 Pipe 类来注释一个函数。</p><p id="3a12" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在下面的例子中，我们将一个常规的 Python 函数转换成一个管道操作。它接受一个整数作为输入，并返回它的平方值。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">用 Python 创建新的管道操作——作者<a class="ae mj" href="https://thuwarakesh.medium.com" rel="noopener">作者</a>的代码片段。</p></figure><p id="cde4" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">因为我们已经用<code class="fe pi pj pk ml b">@Pipe</code>类注释了这个函数，所以它变成了一个管道操作。在第 9 行，我们用它来计算一个数字的平方。</p><p id="5587" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">管道操作也可以接受额外的参数。第一个参数总是链中上一个操作的输出。我们可以有任何额外的参数，并在链中使用它们时指定它们。</p><p id="dcee" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">额外的参数甚至可以是一个函数。</p><p id="05e6" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在下面的示例中，我们创建了一个采用附加参数的管道操作。附加参数是一个函数。我们的管道操作是使用函数转换列表中的每个元素。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">使用额外参数创建管道操作——作者<a class="ae mj" href="https://thuwarakesh.medium.com" rel="noopener">的代码片段</a>。</p></figure><h1 id="3ccd" class="nc mq iu bd nd ne os ng nh ni ot nk nl ka ou kb nn kd ov ke np kg ow kh nr ns bi translated">最后的想法</h1><p id="335b" class="pw-post-body-paragraph kz la iu lb b lc nt jv le lf nu jy lh li nv lk ll lm nw lo lp lq nx ls lt lu in bi translated">看到 Python 如何进一步改进，令人印象深刻。</p><p id="fe2f" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">作为一名实践数据科学家，我发现 Pipe 在许多日常任务中非常有用。我们也可以用熊猫来完成这些任务。然而，管道在提高代码可读性方面表现出色。即使是编程新手也能理解这种转变。</p><p id="21fb" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这里需要注意的是，我还没有在大型项目中使用过 Pipe。我还没有探索它在大规模数据集和数据管道上的表现。但我确实相信这个包将在离线分析中发挥重要作用。</p><div class="oa ob gq gs oc od"><a rel="noopener follow" target="_blank" href="/python-project-structure-best-practices-d9d0b174ad5d"><div class="oe ab fp"><div class="of ab og cl cj oh"><h2 class="bd iv gz z fq oi fs ft oj fv fx it bi translated">让您的 Python 项目结构更优雅的 7 种方法</h2><div class="ok l"><h3 class="bd b gz z fq oi fs ft oj fv fx dk translated">以下是易于管理、可伸缩且易于理解的 python 项目结构的最佳实践。</h3></div><div class="ol l"><p class="bd b dl z fq oi fs ft oj fv fx dk translated">towardsdatascience.com</p></div></div><div class="om l"><div class="pl l oo op oq om or kt od"/></div></div></a></div></div><div class="ab cl mv mw hy mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="in io ip iq ir"><blockquote class="pm pn po"><p id="64a3" class="kz la pp lb b lc ld jv le lf lg jy lh pq lj lk ll pr ln lo lp ps lr ls lt lu in bi translated"><em class="iu">感谢阅读，朋友！跟我打招呼上</em><a class="ae mj" href="https://www.linkedin.com/in/thuwarakesh/" rel="noopener ugc nofollow" target="_blank"><strong class="lb iv"><em class="iu">LinkedIn</em></strong></a><em class="iu"/><a class="ae mj" href="https://twitter.com/Thuwarakesh" rel="noopener ugc nofollow" target="_blank"><strong class="lb iv"><em class="iu">Twitter</em></strong></a><em class="iu">，以及</em> <a class="ae mj" href="https://thuwarakesh.medium.com/" rel="noopener"> <strong class="lb iv"> <em class="iu">中</em> </strong> </a> <em class="iu">。</em></p><p id="687e" class="kz la pp lb b lc ld jv le lf lg jy lh pq lj lk ll pr ln lo lp ps lr ls lt lu in bi translated"><em class="iu">还不是中等会员？请使用此链接</em> <a class="ae mj" href="https://thuwarakesh.medium.com/membership" rel="noopener"> <strong class="lb iv"> <em class="iu">成为会员</em> </strong> </a> <em class="iu">因为，在不为你额外付费的情况下，我为你引荐赚取一小笔佣金。</em></p></blockquote></div></div>    
</body>
</html>