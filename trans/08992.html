<html>
<head>
<title>How Data Science Could Make Cybersecurity Troubleshooting Easier: Firewall Logs Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据科学如何使网络安全故障排除更容易:防火墙日志分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-data-science-could-make-cybersecurity-troubleshooting-easier-firewall-logs-analysis-591e4832f7e6?source=collection_archive---------14-----------------------#2021-08-19">https://towardsdatascience.com/how-data-science-could-make-cybersecurity-troubleshooting-easier-firewall-logs-analysis-591e4832f7e6?source=collection_archive---------14-----------------------#2021-08-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="2157" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/notes-from-industry" rel="noopener" target="_blank">行业笔记</a></h2><div class=""/><div class=""><h2 id="4de0" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">改善事件响应运营。使用数据分析技术和工具。</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/d40ad46df2c9706d42fd08ecb041d94b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5NujfDi9FxGat_-ps0XH-A.jpeg"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">照片由来自<a class="ae le" href="https://www.pexels.com/photo/backlit-breathing-apparatus-danger-dangerous-279979/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae le" href="https://www.pexels.com/@pixabay?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>拍摄</p></figure><p id="a2b8" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">毫无疑问，我们正处于信息时代，从来没有如此多的信息来源，在网络安全领域也是如此。</p><p id="79bd" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">当有人开始从事数据分析工作时，他经常听说在处理数据之前，大部分时间都花在处理、纠正和标准化数据上。如果不同的制造商使用标准化的日志，如果它们在不同的产品之间是一致的，或者即使日志格式很容易处理，这可能是一个微不足道的操作…那该多好啊…😍</p><p id="578e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在现实世界中，情况并非如此，在事件响应中，每个客户都是不同的，并且不得不与各种日志斗争是非常常见的。</p><p id="1078" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在大规模事件中，最有用的日志之一是防火墙日志，它提供了有关进出外部的网络连接、内部组织流量以及在某些情况下甚至用户的VPN访问的信息。</p><p id="290d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">以我的经验来看，我遇到的最常见的厂商之一就是Fortinet。这家公司的防火墙非常常见，并且有一种日志类型，虽然很常见，但处理起来很可怕。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/476808821af4a5cae6ef32bae47017ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*f3rNUDk9ZwVqeYA-kIVN7w.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">Fortinet日志示例</p></figure><p id="0f8e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这种日志是bash和awk爱好者的噩梦，对于我们这些喜欢更进一步的人来说，这是一个探索和理解数据分析工具重要性的机会😉。</p><p id="c7f1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在这种情况下，将分析一个中型组织的单个站点的VPN流量。一周内，产生了1400万个VPN流量事件。</p><h1 id="6d52" class="mc md iq bd me mf mg mh mi mj mk ml mm kf mn kg mo ki mp kj mq kl mr km ms mt bi translated">第一步—向CSV转型</h1><p id="a4ab" class="pw-post-body-paragraph lf lg iq lh b li mu ka lk ll mv kd ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">因为任务是用熊猫的日志来获取证据，我们需要熊猫能读懂的日志格式。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="a22f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">该函数允许我们提取文件每行的标题和字段，如下所示:</p><ul class=""><li id="4619" class="nb nc iq lh b li lj ll lm lo nd ls ne lw nf ma ng nh ni nj bi translated">通过分别捕获数据键、分隔符和数据来提取属性组。这样，对于每一行，我们将能够区分哪些是数据，哪些是键。</li><li id="52fc" class="nb nc iq lh b li nk ll nl lo nm ls nn lw no ma ng nh ni nj bi translated">为所有值分配相同的索引。</li><li id="2eec" class="nb nc iq lh b li nk ll nl lo nm ls nn lw no ma ng nh ni nj bi translated">因为有些字段有分隔符，所以生成了三个组。有必要将结果分组在一列中，以消除空结果。</li><li id="e88a" class="nb nc iq lh b li nk ll nl lo nm ls nn lw no ma ng nh ni nj bi translated">使用列0表示标题，使用列1表示值，生成包含数据的单行。</li></ul><p id="2932" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">以下函数可用于在整个文件夹的文件之间迭代，并逐行读取和创建Pandas数据帧:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="aa24" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这个函数没有做什么特别的事情，它只是在日志的第一行创建一个数据帧，并在处理后添加每一行。完成所有行后，它在指定的文件夹中生成一个CSV文件，并删除原始数据帧以释放内存。<br/>该功能可轻松修改，以便在所有文件的处理过程中维护生成的数据帧，并最终将数据保存在内存中。</p><p id="a8cd" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这最后两个功能可以并行执行，以实现更高的处理效率。为此，有必要将它们存储在一个单独的文件中，以便能够从Jupyter中正确地执行多进程库。<br/>之后，我们可以执行下面的代码，以并行的方式执行任务。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="e7ce" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">为了继续，主要有两个弊端。首先，每个文件的列数，因为根据日志的类型，有些文件包含不同的列；其次，处理所有记录所需的内存量。让我们一步一步来🏃🏻。</p><h2 id="6d7a" class="np md iq bd me nq nr dn mi ns nt dp mm lo nu nv mo ls nw nx mq lw ny nz ms iw bi translated">用<strong class="ak"> d6tstack </strong>调整立柱</h2><p id="e4ca" class="pw-post-body-paragraph lf lg iq lh b li mu ka lk ll mv kd ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">由于日志格式的类型，经常会发现文件中的列数不同，这与数据分析库不兼容。为了解决这个问题，有一个名为<strong class="lh ja"> d6tstack </strong>的库。<br/>该库对csv文件进行分析，并告诉我们每个文件中有哪些列，哪些没有。</p><pre class="kp kq kr ks gt oa ob oc od aw oe bi"><span id="b741" class="np md iq ob b gy of og l oh oi">import glob<br/>import d6tstack.combine_csv</span><span id="81c4" class="np md iq ob b gy oj og l oh oi">cfg_fnames = list(glob.glob(r'C:\logs_vpn_out\*.csv'))<br/>c = d6tstack.combine_csv.CombinerCSV(cfg_fnames)</span><span id="1bb3" class="np md iq ob b gy oj og l oh oi"># check columns<br/>print('all equal',c.is_all_equal())<br/>print('')<br/>d = c.is_column_present()</span></pre><p id="b906" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">输出会是这样的。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/627c6ffc3afbaafa781164891f61c063.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*XVY7gAbk9F_pOjFOHazTPg.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">Dask列检查</p></figure><p id="fc5f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">为了纠正它，库本身提供了用固定列重写新文件中的数据的可能性。</p><pre class="kp kq kr ks gt oa ob oc od aw oe bi"><span id="00bf" class="np md iq ob b gy of og l oh oi">fnames = d6tstack.combine_csv.CombinerCSV(cfg_fnames).to_csv_align(output_dir=r'C:\logs_vpn_out_fix')</span></pre><p id="559b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">一旦修复，我们可以进入下一个阶段，读取文件。</p><h2 id="ef95" class="np md iq bd me nq nr dn mi ns nt dp mm lo nu nv mo ls nw nx mq lw ny nz ms iw bi translated">对抗对记忆的需求💪💻</h2><p id="3fd8" class="pw-post-body-paragraph lf lg iq lh b li mu ka lk ll mv kd ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">这是数据分析中很常见的问题，我们有很多数据，没有足够的RAM来处理。<br/>当我们的任务是定期存储标准化信息时，我们通常会选择将信息存储在Spark、Elastic等数据库中……但是在事件响应的情况下，通常需要快速分析一类我们很可能再也不会看到的事件。</p><p id="dfad" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">为了处理这些情况，有Dask。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ok"><img src="../Images/4ae4783ea5610b53be97793ba69156ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6AN-9HfEJ39LHbh-EKDtuA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated"><a class="ae le" href="https://dask.org/" rel="noopener ugc nofollow" target="_blank">https://dask.org/</a></p></figure><p id="ac84" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这个数据分析库为我们提供了使用计算机资源以并行方式对日志文件执行查询的可能性。<br/>换句话说，它允许我们有效地处理大量数据，而不必将它们加载到内存中。</p><p id="f19c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">当你习惯和熊猫一起工作时，读取文件的过程很快，但很耗时，令人惊讶的是，当用Dask读取文件时，响应是瞬时的。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/fb9706613f303058300ab2f4107f2d05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*L275KtLNHzIp04o4eimhrA.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">Dask数据帧创建</p></figure><p id="44ea" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">重要的是，此时Dask还没有读取文件，它已经按索引划分了数据，并且将在需要时读取它们，这就是它在此阶段如此快速的原因。<br/><em class="ol">df</em>物体不是<em class="ol">熊猫。数据帧</em>是一个<em class="ol"> Dask。DataFrame </em>，重要的是不要忘记它。<br/>在创建数据帧的过程中，标记每一列的数据类型对于加快查询速度和避免问题非常有用。</p><p id="5c56" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">日志分析中最常见的用例之一是搜索事件期间的信息泄漏。为了做到这一点，我们将使用Dask执行一个查询，以获得一小部分可以在内存中轻松处理的数据。</p><pre class="kp kq kr ks gt oa ob oc od aw oe bi"><span id="1664" class="np md iq ob b gy of og l oh oi">df_exf = df[["remip", "tunnelid", "sentbyte"]].groupby(["remip","tunnelid"]).max().compute()</span></pre><p id="f5ac" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这个查询运行了1分28秒，这就是熊猫和Dask的最大区别所在。在Pandas中，如果数据适合内存，这个查询会快得多😅。<br/><strong class="lh ja">。compute() </strong>函数允许用Dask结果创建熊猫数据帧。</p><p id="710c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在1分28秒内，我们对1400万条日志进行了查询，我们对它们进行了分组，并将其放在数据框中，Dask太棒了！</p><p id="f7f9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果您不知道这些日志是如何记录的，这个查询就没有多大意义。每次用户通过VPN与另一个IP地址建立会话时，都会分配一个名为<em class="ol"> tunnelid </em>的唯一标识符。在<em class="ol"> sentbyte </em>字段中，记录了该会话期间离开组织的信息量，但不是记录每个连接中的字节数，而是累积反映，因此只考虑会话期间所有连接的最大值。</p><p id="35da" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">为了便于读取以字节为单位的信息，我将使用这段代码。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="28d8" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">前两个IP地址是合法的，与研究无关。这是要调查的前5个IP地址的图表。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mz na l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi om"><img src="../Images/463e16f53231542caa1f6a312ec261ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*509euad0QYBmr9yn5rJByQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">发送到外部IPs的信息</p></figure><p id="38da" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在这一点上，有必要充实我们现有的数据。为此，我们将使用几个免费服务，MaxMind GeoIP，MaxMind ASN，AbuseIPDB和Dan Tor List。</p><h2 id="9584" class="np md iq bd me nq nr dn mi ns nt dp mm lo nu nv mo ls nw nx mq lw ny nz ms iw bi translated">MaxMind ASN</h2><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi gj"><img src="../Images/34dbf775a920747daa8e3cfef1a813d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1sLrddfuwqY-FChROk7NsQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated"><a class="ae le" href="https://www.maxmind.com/en/home" rel="noopener ugc nofollow" target="_blank">https://www.maxmind.com</a></p></figure><p id="44c6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这项服务将允许我们获得我们需要的IP地址。MaxMind公司提供了一个数据库，我们可以快速下载并离线查阅。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mz na l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi on"><img src="../Images/e8b830f0d4d21391b90ea1369c677774.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*217Xj_1nclPy_e25xoSsFw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">IP地址ASN</p></figure><p id="7cb7" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">通过这个功能，我们将能够获得事件的IP地址所属公司的名称。</p><h2 id="60af" class="np md iq bd me nq nr dn mi ns nt dp mm lo nu nv mo ls nw nx mq lw ny nz ms iw bi translated">MaxMind GeoIP</h2><p id="ea10" class="pw-post-body-paragraph lf lg iq lh b li mu ka lk ll mv kd ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">同一家公司提供了一个IP地理定位数据库，使我们能够非常可靠地知道IP地址的位置。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="e3ed" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">同样，我们将能够知道我们连接的IP的位置。在地图上，你总能更好地看到一切😏。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/7261da44aa7b2d05b7c2fd8814ae38ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*Hfdx6yaqNmTmpBaFC3a6Hw.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">按国家分列的数据量</p></figure><h2 id="5920" class="np md iq bd me nq nr dn mi ns nt dp mm lo nu nv mo ls nw nx mq lw ny nz ms iw bi translated">危险节点列表</h2><p id="33fe" class="pw-post-body-paragraph lf lg iq lh b li mu ka lk ll mv kd ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">攻击者使用Tor网络节点来匿名化他们的通信是很常见的，有时这可以是一个快速检查，为我们提供了一个很好的线索。在网站<a class="ae le" href="https://www.dan.me.uk/torlist/" rel="noopener ugc nofollow" target="_blank"> dan.me.uk </a>上可以找到Tor节点的更新列表。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mz na l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi on"><img src="../Images/3b04f35efd06cbb90f50087e25ecdec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E755b1tNvDCdbHf7J3ha9w.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">Tor节点通信</p></figure><p id="a15f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">尽管它们与数据泄露无关，但它们是必须检查其合法性的连接。</p><h2 id="825c" class="np md iq bd me nq nr dn mi ns nt dp mm lo nu nv mo ls nw nx mq lw ny nz ms iw bi translated">AbuseIPDB</h2><p id="db21" class="pw-post-body-paragraph lf lg iq lh b li mu ka lk ll mv kd ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">AbuseIPDB是众所周知的域名和IP地址信誉服务。通过它的API，我们每天可以免费执行1000次查询。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mz na l"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">AbuseIPDB代码</p></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oo"><img src="../Images/80760b0d22f371c6b782449786d74e52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9-dTRGSzwidGvWN3IDWevg.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">AbuseIPDB IP地址</p></figure><p id="ff19" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在这种情况下，我们看到多个连接到声誉很差的IP地址，必须对其进行分析以验证其合法性。</p><p id="4316" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">此时，我们将进行新的查询，以便对数据进行新的可视化，从而尝试识别异常。</p><pre class="kp kq kr ks gt oa ob oc od aw oe bi"><span id="5ef2" class="np md iq ob b gy of og l oh oi">df = df_dask[~df_dask[“tunnelid”].isnull()][[“remip”, “duration”, “tunnelid”,”sentbyte”]].compute()</span></pre><p id="05bd" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这个查询将返回所有数据的子集，通过下面的代码我们将得到。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="36f8" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在，我们有4个变量来绘制图形，即创建到特定IP地址的隧道数量、到每个IP地址的总连接数、到每个IP地址的连接持续时间总和以及发送的字节数。<br/>首先，如果我们制作一个连接数量和总持续时间的关系图，结果图将是这个。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/273e62090a2c4c4029ed3ed21844e5c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*7L2_vIsbtCcPqa8pV44q7w.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">连接数与持续时间</p></figure><p id="684e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我用红色突出显示了数据泄露中使用的IP地址，这将是我们的目标之一。<br/>考虑到显示的数据，恶意IP已经隐藏在大多数其他连接中，但该图可以帮助我们检测网络安全中非常常见的两种异常。<br/>一方面，在左上部分，将会反映许多短时间连接的IP地址，例如钴击信标的情况，而在右下部分，将会出现长连接，例如SSH或RDP连接。</p><p id="9a18" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在下图中，我们将把发送的数据与连接的持续时间联系起来。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/485f769328649b92ef4493c4012f3585.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*zRzLT_xK3v01ipJbKVp7RQ.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">发送数据与持续时间</p></figure><p id="22f9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如您所见，这是检测大量信息泄漏的完美图表。在左上角，我们将显示已建立短连接但发送了大量信息的IP地址。<br/>最后，我们将可视化发送的信息和连接数量之间的比率。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/c7a6d1490187083e728aaa5079c59ba0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*Lm3u2Tp8lBewJM2Km3EgMw.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">发送的数据与连接</p></figure><p id="35a9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">该图可以帮助我们直观地看到少数连接中的数据泄漏，如将文件上传到云或通过SSH发送文件，以及隐蔽通道中的数据泄漏，如DNS或ICMP，因为我们会看到许多连接和发送的大量信息。<br/>为了结束本文，我们将执行更高级的分析，尝试同时使用四个变量来检测连接中的异常。</p><h2 id="9361" class="np md iq bd me nq nr dn mi ns nt dp mm lo nu nv mo ls nw nx mq lw ny nz ms iw bi translated">PCA —主成分分析</h2><p id="e327" class="pw-post-body-paragraph lf lg iq lh b li mu ka lk ll mv kd ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">简化它，这种机器学习技术将允许我们在不失去数据唯一性的情况下进行降维。我们将从四维发展到二维，这样我们就能够用图形来表示它，并试图将异常现象可视化。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="ed1a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">正如您在代码中看到的，执行了二维缩减，然后添加了remote IP列，以便更容易识别图中的数据，结果如下所示。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi op"><img src="../Images/202c4d82a675040e3cafb387cd94393e.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*NNlpaFbZb-S6vLhxBxGt5g.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">PCA结果</p></figure><p id="9038" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">一旦显示在图表上，我们就可以识别连接中的异常。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/3d272e4f34e1b0807a70c150701ea9db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*KiXIXDkaqRzi3W-pZfNDog.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">主成分分析数据图</p></figure><p id="cd0b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">通过这种方式，我们可以快速识别连接中的异常，这将为我们开始调查提供线索。</p><p id="7e4d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">尽管可以对这些数据进行大量的进一步分析，但现在是时候结束这篇文章并继续下一篇文章了。完整的笔记本可以在<a class="ae le" href="https://github.com/lucky-luk3/Infosec_Notebooks/blob/main/Forti_VPN_Logs_Analysis-Public.ipynb" rel="noopener ugc nofollow" target="_blank">此链接</a>获得。</p><p id="5d36" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">总而言之，很明显，数据分析是几乎每个行业未来的关键之一，但在网络安全方面，它现在是，将来也将是分析师的核心技能。<br/>在事故调查或监控过程中，知道如何使用我们所掌握的工具将会在时间和结果上有所不同。</p><p id="f403" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我将继续谈论在我的日常工作中有用的笔记本，希望你会发现它们有用。</p><p id="796b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">研究愉快！</p></div></div>    
</body>
</html>