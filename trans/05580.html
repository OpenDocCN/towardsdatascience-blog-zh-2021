<html>
<head>
<title>Stratified Random Sampling Using Python and Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python和Pandas进行分层随机抽样</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/stratified-random-sampling-using-python-and-pandas-1c84f0362ebc?source=collection_archive---------2-----------------------#2021-05-18">https://towardsdatascience.com/stratified-random-sampling-using-python-and-pandas-1c84f0362ebc?source=collection_archive---------2-----------------------#2021-05-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c80a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何对样本数据进行分层以匹配总体数据，从而提高机器学习算法的性能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4713b20a607a36cee426a620a552f887.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lFPXzXFdnJTretkN0kVSUA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">查尔斯·德鲁维奥在<a class="ae ky" href="https://unsplash.com/s/photos/computer-code?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="a95d" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="f1ee" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">有时，数据科学家得到的样本数据并不符合我们对更广泛的人口数据的了解。例如，假设数据科学团队收到了调查数据，我们注意到调查受访者中60%是男性，40%是女性。</p><p id="c2f7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在现实世界中，英国总人口中男性比例接近49.4%，女性比例接近50.6%(资料来源:https://tinyurl.com/43hpe5e4<a class="ae ky" href="https://tinyurl.com/43hpe5e4" rel="noopener ugc nofollow" target="_blank">)，当然不是60% / 40%。</a></p><p id="da63" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们60%的男性样本数据可能有很多解释。一种可能性是数据收集方法可能有缺陷。也许营销团队在他们的营销活动中意外地击中了更多的男性，导致了不平衡。</p><p id="935d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果我们可以确定样本数据应该更好地反映总体情况，那么我们就可以对数据进行“分层”。这将涉及对样本数据进行重新采样，以使比例与总体相匹配(更多信息，请参见<a class="ae ky" href="https://www.investopedia.com/ask/answers/041615/what-are-advantages-and-disadvantages-stratified-random-sampling.asp" rel="noopener ugc nofollow" target="_blank">https://www . investopedia . com/ask/answers/041615/what-are-advantage-and-missions-layered-random-sampling . ASP</a>)。</p><p id="a40c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">更复杂的是，可能涉及到多个特性列。本文中的示例显示了如下两个因素的组合</p><ul class=""><li id="cad9" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">男大学生=人口的45%</li><li id="0ba9" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">女大学生=人口的20%</li><li id="bf56" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">男性研究生=人口的20%</li><li id="01d7" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">女研究生=人口的15%</li></ul><p id="1762" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果我们的样本数据有70%的男大学生，它将不能代表人口。</p><p id="97c7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在机器学习算法中，这可能会导致问题。如果我们继续在样本数据上训练我们的模型，而样本数据具有错误的比例，那么模型很可能会过度拟合训练数据，并且当我们根据真实世界或测试数据以正确的比例运行模型时，它也很可能表现不佳。</p><p id="164d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">此示例显示了如何对样本数据进行重新采样，以使其反映有可能提高机器学习模型准确性的总体</p><h1 id="a08f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">入门指南</h1><p id="77d6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们首先导入所需的库并读入一些从<a class="ae ky" href="https://www.kaggle.com/c/credit-default-prediction-ai-big-data/overview" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/c/credit-default-prediction-ai-big-data/overview</a>下载的数据</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/9e68277c2f0ae1c6d6581010717fbf9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OusKmWVM3Xw6ix9T0ZZnTA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="760f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">设置测试数据</h1><p id="54e6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了使示例有意义，我将简化“房屋所有权”特性，使其具有两个最常见的值，并添加一个名为“性别”的新特性，其中约60%为“男性”,约40%为“女性”,然后快速查看结果…</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="b1c1" class="no la it nk b gy np nq l nr ns">(Home Mortgage    0.531647<br/> Rent             0.468353<br/> Name: Home Ownership, dtype: float64,<br/> Male      0.601813<br/> Female    0.398187<br/> Name: Gender, dtype: float64)</span></pre><h1 id="2394" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">准备分层</h1><p id="f38f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我们的示例中，我们希望对样本数据进行重新采样，以反映性别和房屋所有权的正确比例。</p><p id="b72b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们需要做的第一件事是创建一个包含我们想要分层的所有数据的单一要素，如下所示…</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="8fdc" class="no la it nk b gy np nq l nr ns">Male, Home Mortgage      0.321737<br/>Male, Rent               0.280076<br/>Female, Home Mortgage    0.209911<br/>Female, Rent             0.188277<br/>Name: Stratify, dtype: float64</span></pre><p id="cc53" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在我们有了，我们在样本数据中有一组比例，我们打算用它们来训练我们的模型。然而，我们与我们的营销团队核实，他们向我们保证人口比例如下…</p><ul class=""><li id="39b9" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">男性，住房抵押贷款=人口的45%</li><li id="9b80" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">男性，房租=人口的20%</li><li id="3260" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">女性，住房抵押贷款=人口的20%</li><li id="484b" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">女性，房租=人口的15%</li></ul><p id="533f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">…两个团队同意，他们必须对数据进行重新采样，以匹配这些比例，从而建立一个准确的模型，该模型将在未来的真实世界数据中很好地工作。</p><h1 id="9765" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">将数据分层</h1><p id="e69c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">下面是一个函数，它使用<code class="fe nt nu nv nk b">DataFrame.sample</code>从源数据中用正确的值精确地采样正确数量的行，这样结果将按照参数中指定的那样精确地分层...</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h1 id="610f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">测试</h1><p id="e3d0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">以下代码指定了根据所需比例对数据进行分层的值和比例，即-</p><ul class=""><li id="dd87" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">男性，住房抵押贷款=人口的45%</li><li id="17bb" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">男性，房租=人口的20%</li><li id="e8ec" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">女性，住房抵押贷款=人口的20%</li><li id="d970" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">女性，房租=人口的15%</li></ul><p id="30d4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">…并查看新分层的数据集…</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/d14363182e9a9065986e46e432a53eb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kvDlwJfQOHgvhq5__9tSjA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="bc57" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了确保我们得到了正确的结果，让我们来看看<code class="fe nt nu nv nk b">Stratify</code>专题专栏的整体比例...</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="5cb8" class="no la it nk b gy np nq l nr ns">((6841, 20), (6841, 20))</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="8aa1" class="no la it nk b gy np nq l nr ns">Male, Home Mortgage      0.449934<br/>Female, Home Mortgage    0.199971<br/>Male, Rent               0.199971<br/>Female, Rent             0.150124<br/>Name: Stratify, dtype: float64</span></pre><h1 id="3428" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="acac" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们首先指出，数据收集过程中的缺陷有时会导致样本数据与总体数据的已知比例不同，这可能会导致过度拟合的模型在遇到比例正确的测试或实时数据时表现不佳。</p><p id="da45" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们继续探索如何对训练数据进行分层和重新采样，使其达到正确的比例，从而解决问题并提高生产算法的性能。</p><p id="8c6a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然后，我们选择了一个对两个要素进行分层的复杂示例，要素将这两个要素设计到一个新列中，并定义了一个执行计算并返回分层数据集的函数。</p><p id="5772" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，我们检查了结果，以确保计算是正确的。</p><p id="2aa5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">完整的源代码可以在GitHub上找到:</p><div class="nx ny gp gr nz oa"><a href="https://github.com/grahamharrison68/Public-Github/blob/master/Resampling/Stratified%20Sampling.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">grahamharrison68/Public-Github</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">GH公共项目库。通过在…上创建帐户，为grahamharrison68/Public-Github开发做出贡献</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">github.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo ks oa"/></div></div></a></div><h1 id="4330" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">感谢您的阅读！</h1><p id="776b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果你喜欢读这篇文章，为什么不看看我在https://grahamharrison-86487.medium.com/的其他文章呢？</p><p id="805f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">此外，我很乐意听到您对这篇文章、我的任何其他文章或任何与数据科学和数据分析相关的内容的看法。</p><p id="cd1e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你想联系我讨论这些话题，请在LinkedIn上找我—【https://www.linkedin.com/in/grahamharrison1 T2】或者发电子邮件到<a class="ae ky" href="mailto:GHarrison@lincolncollege.ac.uk" rel="noopener ugc nofollow" target="_blank">ghar rison @ Lincoln college . AC . uk</a>。</p></div></div>    
</body>
</html>