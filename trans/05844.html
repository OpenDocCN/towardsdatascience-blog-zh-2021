<html>
<head>
<title>Color Swapping techniques in Image Processing.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">图像处理中的颜色交换技术。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/color-swapping-techniques-in-image-processing-fe594b3ca31a?source=collection_archive---------15-----------------------#2021-05-25">https://towardsdatascience.com/color-swapping-techniques-in-image-processing-fe594b3ca31a?source=collection_archive---------15-----------------------#2021-05-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9900" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">理解色彩空间并在Python中实现色彩交换。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ccf4e6d44b0fb147b11a904d0397e358.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YagzHTv1bekDpFKf"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@sonance" rel="noopener ugc nofollow" target="_blank"> <strong class="bd kw">维克多</strong> </a> <strong class="bd kw"> </strong>上<strong class="bd kw"> </strong> <a class="ae kv" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="bd kw">下</strong> </a></p></figure><p id="e8d0" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><em class="lt">在这篇文章中，我试图解释我的探索，即为什么需要交换图像中的颜色，以及我们如何使用简单的图像处理方法，通过在Python中实现来智能地交换图像中的颜色。</em></p><p id="f411" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"/></p><h2 id="2b2d" class="lu lv iq bd lw lx ly dn lz ma mb dp mc lg md me mf lk mg mh mi lo mj mk ml mm bi translated">为什么要换颜色？</h2><p id="e32d" class="pw-post-body-paragraph kx ky iq kz b la mn jr lc ld mo ju lf lg mp li lj lk mq lm ln lo mr lq lr ls ij bi translated">数据科学家对颜色交换感兴趣可能有几个原因:</p><ol class=""><li id="9c09" class="ms mt iq kz b la lb ld le lg mu lk mv lo mw ls mx my mz na bi translated">作为数据科学从业者，我们可能希望使用颜色交换方法作为数据增强策略，这有助于在处理深度学习算法的同时增加数据量。</li><li id="c0a3" class="ms mt iq kz b la nb ld nc lg nd lk ne lo nf ls mx my mz na bi translated">很多时候，找到一个真实的、开源的大型数据集来研究算法是很有挑战性的，在这种情况下，使用合成数据会变得非常有帮助。因此，当图像数据有限时，这些图像处理技术在生成高质量的合成图像时会非常方便。</li><li id="5744" class="ms mt iq kz b la nb ld nc lg nd lk ne lo nf ls mx my mz na bi translated">我们可能想尝试一些很酷的东西，比如在参加会议时交换背景色，调整衬衫的颜色等等。</li></ol></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="cb59" class="nn lv iq bd lw no np nq lz nr ns nt mc jw nu jx mf jz nv ka mi kc nw kd ml nx bi translated">色彩空间</h1><p id="969e" class="pw-post-body-paragraph kx ky iq kz b la mn jr lc ld mo ju lf lg mp li lj lk mq lm ln lo mr lq lr ls ij bi translated">类似于我们有不同类型的数字系统来表示一个数(例如:二进制、十进制、十六进制等。)，同样，在特定的显示/图像中，有不同的数字系统来表示颜色/颜色的关联。这些系统被称为<strong class="kz ir">色彩空间</strong>。</p><p id="8ae3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在开始实现智能色彩映射之前，首先，让我们试着理解一些在计算机视觉和图像处理领域广泛使用的色彩空间:</p><h2 id="dc0e" class="lu lv iq bd lw lx ly dn lz ma mb dp mc lg md me mf lk mg mh mi lo mj mk ml mm bi translated"><strong class="ak"> RGB颜色空间:</strong></h2><p id="d14b" class="pw-post-body-paragraph kx ky iq kz b la mn jr lc ld mo ju lf lg mp li lj lk mq lm ln lo mr lq lr ls ij bi translated">它是基于RGB颜色模型的三维空间。在这个模型中，任何颜色都是三原色分量(红色、蓝色和绿色)的不同强度的混合。这些分量可以被认为是色彩空间的数学坐标。借助于3D笛卡尔空间中的立方体，该模型被最佳可视化:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/2a6ec1dfcdce9b8a596e27ffbedef67c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t-Iw2gg0dlI4IJ5pOUP7vQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图3:一个单位边长的RGB颜色立方体.图片作者。</p></figure><p id="b3c9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">所有分量以全强度会聚，产生白色。默认情况下，OpenCV以BGR格式读取和存储图像。</p><h2 id="ddb5" class="lu lv iq bd lw lx ly dn lz ma mb dp mc lg md me mf lk mg mh mi lo mj mk ml mm bi translated"><strong class="ak"> HSV颜色空间:</strong></h2><p id="5f59" class="pw-post-body-paragraph kx ky iq kz b la mn jr lc ld mo ju lf lg mp li lj lk mq lm ln lo mr lq lr ls ij bi translated">它是基于HSV颜色模型的三维颜色空间。在这个模型中，我们用单独的组件来表示颜色和强度:<br/> <strong class="kz ir"> * Hue - </strong>表示颜色(蓝色、红色、绿色等。)，其取值范围为0到360*。<br/> <strong class="kz ir"> *饱和度- </strong>代表一种颜色的<strong class="kz ir">纯度</strong>或<strong class="kz ir">色彩度</strong>的多少。较低的饱和度值意味着褪色或变灰的颜色。<br/> * <strong class="kz ir"> Value - </strong>代表一个色调的明度或暗度。</p><p id="e5c5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这个模型最好在圆柱坐标系的帮助下可视化(虽然大多数文本使用3D圆锥体，但3D圆柱体实际上是更精确的数学表示)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/73c03ffa755a9b37f175f8581a1d3382.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZmrwpDAXG7ZFJGSz1XLMVw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图:HSV颜色模型，有单位半径和单位高度。<strong class="bd kw">？</strong>”表示该组件的值是多少并不重要。图片作者。</p></figure><p id="18a6" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在此模型中，方位角(0–360 *)指定色调分量，距中心的径向距离与饱和度分量相关，沿轴的距离代表图像的亮度。</p><h2 id="28b0" class="lu lv iq bd lw lx ly dn lz ma mb dp mc lg md me mf lk mg mh mi lo mj mk ml mm bi translated"><strong class="ak"> LAB色彩空间:</strong></h2><p id="25e1" class="pw-post-body-paragraph kx ky iq kz b la mn jr lc ld mo ju lf lg mp li lj lk mq lm ln lo mr lq lr ls ij bi translated">类似于HSV颜色空间如何从强度和亮度分量中分离颜色分量，LAB颜色空间使用2个分量来表示颜色，1个单独的分量来表示亮度值。<br/> * L:明度分量，<br/> * A:指定红/绿色组合的颜色分量，<strong class="kz ir"> </strong> <br/> * B:指定蓝/黄色组合的颜色分量。</p><p id="80f5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">借助于3-D空间中的球体，颜色模型被最好地可视化。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/96a24cfd09fe5ec9245aa4cbe3f1d66c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Ke0ikMBTlYPhlxDiZReMQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图:带单位半径的LAB颜色模型。图片作者。</p></figure><p id="30fe" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这些不同空间中的每一个都有其自身的优点和缺点，这取决于使用的应用。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="f423" class="nn lv iq bd lw no np nq lz nr ns nt mc jw nu jx mf jz nv ka mi kc nw kd ml nx bi translated">实验</h1><p id="cb20" class="pw-post-body-paragraph kx ky iq kz b la mn jr lc ld mo ju lf lg mp li lj lk mq lm ln lo mr lq lr ls ij bi translated">让我们进入实现部分。让我们考虑几种颜色交换的情况，我们将从一个简单的颜色交换图像开始(简单的意思是颜色分布变化不大),然后逐渐转到图像具有变化的颜色分布的例子，在这些例子中，交换选择的特定颜色是相当棘手的。</p><p id="0548" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们考虑下图。它看起来像一支绿色的塑料笔身，由金属笔尖和绿色的塑料笔帽组成，笔帽上有一些金属部分和黑色的设计。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/7fe36028e2a04dd876f7b9be5aa2573c.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*ZWpx-kz-k63PIpPbDnSRQw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图:钢笔的原始图像。图片作者。</p></figure><p id="2dd8" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">现在，我们想把笔身的颜色从绿色改为紫色，并希望生成的图像像原来一样逼真，并且需要在生成的图像中考虑所有的照明和阴影。我们能在RGB空间中实现吗？让我们试一试。注意:在Open-CV库的帮助下加载图像时，特定颜色空间中的组件范围通常是从0到255。<strong class="kz ir">对于HSV，OpenCV使用H:0–179，S:0–255，V:0–255。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/d934dc92389be927f293ef34c12a87f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VLV4F3S3JFeDGAH-.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图:x轴代表[0，180]中的<code class="fe oc od oe of b">Hue</code></p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/32fdd747271b346f7f041e0b94eee6cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*Wr2zk-OkYOpOxAXzi4Qlog.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图:将<strong class="bd kw">【B】</strong>分量的值增加一个固定的量，会导致颜色和强度值都发生变化。图片作者。</p></figure><p id="32ed" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这个奇怪的合成图像的原因是:</p><ul class=""><li id="2745" class="ms mt iq kz b la lb ld le lg mu lk mv lo mw ls oi my mz na bi translated">RGB空间借助所有三个分量(R、G和B)来指定颜色和亮度信息。</li><li id="bba5" class="ms mt iq kz b la nb ld nc lg nd lk ne lo nf ls oi my mz na bi translated">RGB图像中的每个像素都是这些成分的特定组合，我们无法解释一个成分需要改变多少才能获得所需的颜色。</li><li id="cdd5" class="ms mt iq kz b la nb ld nc lg nd lk ne lo nf ls oi my mz na bi translated">R、G、B分量中任何一个的任何变化都会引起像素的颜色和亮度值的变化。</li></ul><p id="0fae" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果有一个空间，其中颜色和亮度信息都在彼此独立的单独组件中指定，那么交换颜色将会非常容易。这就是像HSV和LAB这样的色彩空间出现的原因。现在让我们试着通过改变HSV颜色空间中的色调值来交换钢笔颜色。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/1efabde2a0fd69fc2943603e83bed165.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ScTI1SqZrFPam8h8Er5kqw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图:通过改变图像的<strong class="bd kw">色调</strong>分量得到的图像。亮度和饱和度值没有干扰。图像看起来很真实。图片作者。</p></figure><p id="6086" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">类似于改变色调值如何不影响图像的亮度分量，让我们检查我们是否可以改变图像的亮度而不干扰图像的颜色/色调分量。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/b95d44c03e788cca7a0cc7e4c17371a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*9y6qH_SU7bN4_AFjAP6POg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图:通过降低亮度分量获得的图像。图片作者。</p></figure><p id="b0ca" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">显然，在HSV颜色空间中使用不同的组件非常容易。我们看到了修改不同的组件如何帮助我们分别转换图像的颜色组件和亮度。</p><p id="ae42" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">将亮度通道乘以0.6(暗化效果)也会导致背景变暗。在早期的图像中，我们也看到改变色调值会导致背景颜色的变化。</p><p id="435c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们来研究一下，如何只改变钢笔的颜色或者只改变前景的亮度而不改变背景。注意，还有其他基于深度学习的技术，如GANs，也可以用来实现相同的目的，在本文中，我们只讨论解决该问题的简单图像处理技术。</p><p id="ce69" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这个想法是为背景或前景创建一个颜色范围二元蒙版，然后使用该蒙版有选择地将颜色变化应用于前景。但是，面具适合哪种颜色呢？为了回答这个问题，如果我们为我们的色调/颜色通道绘制直方图就好了。这是我们的色调通道和直方图的样子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/b195843e02f7b41ede2ff811711b27a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:462/format:webp/1*6wB0NlIFCNtYoJE6eTPyvQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图:原始笔图像的色调通道。图片作者。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/81282d61c26361756c478e2711fb41d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*-kbYpBqSdoxB5arz-brcRw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图:颜色分布直方图。图片作者。</p></figure><p id="b234" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">上面的直方图暗示峰值出现在~120，这是我们图像中的主要背景色和噪声。从上面的HSV颜色空间中，可以注意到绿色在55–65附近达到峰值，这也是为什么我们在上面的图中在相同的间隔附近看到一个小峰。因此，我们试图为相似的色调范围创建一个遮罩。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/6c28a204492d3884735448197f310a96.png" data-original-src="https://miro.medium.com/v2/resize:fit:462/format:webp/1*TAoVLVeR79Xijg5V8m6DfA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图:钢笔的颜色遮罩(前景)。图片作者。</p></figure><p id="71f3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">现在，让我们增加这个二元蒙版中非零像素的色调值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/e5ca8375e8349834f3c5272f9b58a978.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*SCVhH6PjWIn13yS437b0Uw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图5:我们改变了前景色，但没有改变背景。所有的照明都完好无损。图片作者。</p></figure><p id="4787" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这就是我们如何能够成功地交换图像的颜色，而不操纵背景颜色。</p><p id="f5d0" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">最后，我想提一下在电视和电影中非常流行的<a class="ae kv" href="https://en.wikipedia.org/wiki/Chroma_key" rel="noopener ugc nofollow" target="_blank"> <strong class="kz ir">色度键控</strong> </a> <strong class="kz ir"> </strong>方法。这种技术也可以用来交换图像中的颜色。这里的想法是从两个图像开始，一个是安装在绿色或黑色屏幕上的前景，第二个是需要叠加在背景上的图像。方法是首先提取图像中的所有绿色或黑色像素，使这些像素透明，这将使我们能够在背景中覆盖所需的图像。<strong class="kz ir"> <em class="lt">但是，这种方法要求表面非常光滑，只有很少的光照。</em>T9】</strong></p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><p id="48c2" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我希望你喜欢颜色交换的想法。我很乐意回答上述任何概念的问题。我想知道任何阅读这篇文章的人的反馈。你可以通过Linkedin联系我。</p><p id="ba0d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">谢谢大家！</p><p id="76cb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">特别感谢Apurva Gupta对博客的评论。</p></div></div>    
</body>
</html>