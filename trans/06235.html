<html>
<head>
<title>Topic Modeling and Sentiment Analysis on Twitter Data Using Spark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Spark的Twitter数据主题建模和情感分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/topic-modeling-and-sentiment-analysis-on-twitter-data-using-spark-a145bfcc433?source=collection_archive---------13-----------------------#2021-06-04">https://towardsdatascience.com/topic-modeling-and-sentiment-analysis-on-twitter-data-using-spark-a145bfcc433?source=collection_archive---------13-----------------------#2021-06-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="dea5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">某个地区的twitter用户关注什么，他们对某些问题的反应是什么？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9bc66a129010deeb0b06e803c2d37988.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cj_9o0vvt7hqXTXbLEs2Pg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">亚历山大·沙托夫在<a class="ae kv" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="1a01" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="60ac" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这是与队友一山、小静、贾尼斯和兰吉特完成的学校项目总结。Twitter情绪分析是一个面向大数据分析新手的hello world项目。</p><p id="dae3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在这个项目中，我们想知道新加坡用户在twitter上关注什么，以及人们对某个话题的反应。为了回答这个问题，我们使用Spark SQL、Spark MLlib和Spark streaming等Spark库设计了两条twitter数据分析管道。</p><h1 id="ce7b" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak">建筑</strong></h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/ae2f89ab25f5599bb0e51615c44bf625.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*goUygsRaQkTZ-wyZDP3ohQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h2 id="93a3" class="mq kx iq bd ky mr ms dn lc mt mu dp lg lx mv mw li mb mx my lk mf mz na lm nb bi translated">管道1:批处理和主题建模</h2><p id="6aa0" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在这一部分中，我们使用tweepy从完整的归档API中提取tweets并保存到hdfs中。然后，我们调用Spark SQL和Spark MLlib来处理tweets以进行主题建模，并用matplotlib或tableau保存结果以进行可视化。</p><h2 id="1dfe" class="mq kx iq bd ky mr ms dn lc mt mu dp lg lx mv mw li mb mx my lk mf mz na lm nb bi translated">管道2:流处理和情感分析</h2><p id="54f2" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在这一部分中，我们使用tweepy和主题建模中的关键字来过滤流媒体tweets。我们还在tweepy和Spark之间创建了一个TCP套接字。TCP套接字会将tweets发送到Spark流进行处理。然后，结果将被发送到使用Flask构建的仪表板。</p><h1 id="7a9c" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">批处理和主题建模</h1><h2 id="aa43" class="mq kx iq bd ky mr ms dn lc mt mu dp lg lx mv mw li mb mx my lk mf mz na lm nb bi translated">步骤1:从twitter API批量获取推文</h2><p id="3e97" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">Twitter刚刚将API从1.0版升级到2.0版。要使用2.0版API，我们需要使用tweepy v4.0版，该版本目前仍处于Github的开发阶段。使用twitter的原生API也可以。要使用完整的存档API，我们需要有一个学术帐户。我们为这个学校项目申请了一个学术帐户，该帐户每月授予我们1000万条推文配额和更多的查询API。</p><p id="a2a6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们为完整的存档推文设定了一些标准。推文的位置应该是新加坡，语言英语和转发被排除在外。可以调整返回的开始时间和结束时间以及其他字段，在本例中，时间设置为2021年4月。</p><p id="06a8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">对于4月份发布的推文，我们能够提取出大约4.8万条符合标准的推文。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h2 id="d6e6" class="mq kx iq bd ky mr ms dn lc mt mu dp lg lx mv mw li mb mx my lk mf mz na lm nb bi translated">第二步:批处理</h2><p id="dfd6" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在这一步中，我们需要在建模之前做一些预处理。我们探索了tweets的json结构。嵌套json结构被简化为每行一个记录，每列一个属性。展平后，执行一些常见的预处理步骤，如去除非文本、标记化、词条化和去除停用词。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h2 id="8743" class="mq kx iq bd ky mr ms dn lc mt mu dp lg lx mv mw li mb mx my lk mf mz na lm nb bi translated">步骤3:使用网格搜索的主题建模</h2><p id="a84b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在文本清洗和标记化之后，我们使用LDA进行主题建模。由于我们不确定主题的最佳数量，我们使用网格搜索来确定。通过简单的肘法，我们发现4月推文中有6个话题。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h2 id="57dd" class="mq kx iq bd ky mr ms dn lc mt mu dp lg lx mv mw li mb mx my lk mf mz na lm nb bi translated">步骤4:基于主题创建条形图竞赛</h2><p id="d88a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在主题建模之后，我们可以为每条推文分配主题，并将推文分配给一个主导主题。我们汇总了每天每个主题下的推文数量。然后我们用柱状图race包演示了四月份话题的动态变化。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nd l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者提供的视频</p></figure><h1 id="e8c9" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">流处理和情感分析</h1><h1 id="2147" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">步骤1:过滤后的tweets流并发送到TCP套接字</h1><p id="e6bb" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">从第一个管道，我们决定把重点放在缅甸政变的话题。我们使用缅甸作为流数据的关键字。在这一部分中，我们还创建了一个TCP套接字来接收流数据。这些数据最终会被火花流消耗掉。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h2 id="9601" class="mq kx iq bd ky mr ms dn lc mt mu dp lg lx mv mw li mb mx my lk mf mz na lm nb bi translated">第二步:使用Spark流进行推特情感分析</h2><p id="9104" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在这一部分中，我们使用spark流来处理实时数据。Spark streaming是一个较老的API，它使用最小批量方法。我们需要定义将流数据转换为离散流(名为d stream)的批处理间隔。我们将批处理间隔定义为2秒。我们会根据文本-blob包中的情绪极性将每条推文定义为积极、中立或消极。然后，我们统计了每个类别下的推文数量。我们还统计了最常用的词和标签，并显示了过去一周推文的地理位置。我们使用过去一周的推文而不是实时推文进行地理定位的原因是，只有1-2%的推文带有地理标签。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h2 id="9ed0" class="mq kx iq bd ky mr ms dn lc mt mu dp lg lx mv mw li mb mx my lk mf mz na lm nb bi translated">第三步:烧瓶仪表板</h2><p id="f0f0" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在这一部分，我们使用MVC(模型-视图-控制器)框架来设计仪表板。我们定义了如何在模板的每个部分显示数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h1 id="a561" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">实时仪表板</h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nd l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者提供的视频</p></figure></div></div>    
</body>
</html>