<html>
<head>
<title>Python Altair Combines Filtering, Grouping, and Merging into a Single Data Visualization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python Altair将过滤、分组和合并结合到一个数据可视化中</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-altair-combines-filtering-grouping-and-merging-into-a-single-data-visualization-13e7e8306b6c?source=collection_archive---------30-----------------------#2021-05-04">https://towardsdatascience.com/python-altair-combines-filtering-grouping-and-merging-into-a-single-data-visualization-13e7e8306b6c?source=collection_archive---------30-----------------------#2021-05-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="79b4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">探索性数据分析的完整工具</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/011eb484ab2da5e3a01c587679e65acd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4lw14GFzJmfuwytc.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@isaacmsmith?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">艾萨克·史密斯</a>在<a class="ae ky" href="https://unsplash.com/s/photos/chart?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="4adb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Altair是Python的统计数据可视化库。它为创建静态和交互式可视化提供了简单易懂的语法。</p><p id="c262" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我认为Altair与其他常见的数据可视化库的区别在于，它将数据分析组件无缝集成到可视化中。因此，它是一个非常实用的数据探索工具。</p><p id="3e98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将逐步了解如何创建包含过滤、分组和合并操作的可视化。最后，我们将创建一个信息丰富的图，可用作探索性数据分析过程的一部分。</p><p id="cdba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先生成由两个数据帧组成的模拟数据。第一个包含餐馆订单，另一个包含订单中商品的价格。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="16ad" class="ma mb it lw b gy mc md l me mf"># import libraries<br/>import numpy as np<br/>import pandas as pd<br/>import altair as alt<br/>import random</span><span id="310d" class="ma mb it lw b gy mg md l me mf"># mock data<br/>orders = pd.DataFrame({<br/>   "order_id": np.arange(1,101),<br/>   "item": np.random.randint(1, 50, size=100),<br/>   "qty": np.random.randint(1, 10, size=100),<br/>   "tip": (np.random.random(100) * 10).round(2)<br/>})</span><span id="a2d9" class="ma mb it lw b gy mg md l me mf">prices = pd.DataFrame({<br/>   "item": np.arange(1,51),<br/>   "price": (np.random.random(50) * 50).round(2)<br/>})</span><span id="a073" class="ma mb it lw b gy mg md l me mf">order_type = ["lunch", "dinner"] * 50<br/>random.shuffle(order_type)<br/>orders["order_type"] = order_type</span></pre><p id="eb10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些值使用numpy函数生成。然后，我们使用100个商品的列表添加订单类型。Python的random模块下的shuffle函数是用来随机化列表的。</p><p id="f6c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看一下刚刚创建的数据框。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/75b3bdc2cc6c1841c096b72f744f27ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*XgxXRmultWqo9DEx1W7Blg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">订单数据框架</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/7eaddfa094aebb2be1ea996a226bdd74.png" data-original-src="https://miro.medium.com/v2/resize:fit:494/format:webp/1*94O8ctDlJk2Yn1q3d5z5Vw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">价格数据框架</p></figure><p id="8845" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能会认为我们可以在订单表中输入商品价格。我们以这种方式设计数据帧，以便能够使用合并操作。此外，它稍微演示了关系数据库的概念。</p><p id="faa7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先创建一个简单的情节来介绍Altair语法的结构。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2311" class="ma mb it lw b gy mc md l me mf">alt.Chart(orders).mark_circle(size=50).encode(<br/>   x="qty", y="tip", color="order_type"<br/>).properties(<br/>   title = "Tip vs Quantity"<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/76db92f4464e3f566bb3b6ca2dfff4fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/1*eAVcknqHHaXLKZP663cgGw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="14cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先将数据传递给一个顶级图表对象。数据可以是Pandas数据框的形式，也可以是指向json或csv文件的URL字符串。然后，选择可视化的类型(例如<code class="fe mk ml mm lw b">mark_circle</code>、<code class="fe mk ml mm lw b">mark_line</code>等)。</p><p id="15d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mk ml mm lw b">encode</code>函数指定在给定的数据框中绘制什么。因此，我们在编码函数中写的任何东西都必须链接到数据帧。最后，我们使用properties函数指定绘图的某些属性。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="8f54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑这样一种情况，我们需要创建价格和小费值的散点图。它们在不同的数据帧中。一种方法是合并两个数据框，并在散点图中使用这两列数据。</p><p id="a522" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Altair提供了一种更实用的方法。它允许在不同的数据框中查找列。直觉和熊猫的合并功能一样。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="85b1" class="ma mb it lw b gy mc md l me mf">alt.Chart(orders).mark_circle(size=50).encode(<br/>   x="tip", y="price:Q", color="order_type"<br/>).transform_lookup(<br/>   lookup="item",<br/>   from_=alt.LookupData(data=prices, key="item", fields=["price"])<br/>).properties(<br/>   title = "Price vs Tip"<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/dd488433074b86311a178858b6ade050.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/1*ooW-91F-h-PPmQRaD-hYOw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="3e81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mk ml mm lw b">transform_lookup</code>功能类似熊猫的<code class="fe mk ml mm lw b">merge</code>功能。用于匹配观察值的列(即行)被传递给<code class="fe mk ml mm lw b">lookup</code>参数。<code class="fe mk ml mm lw b">fields</code>参数用于从其他数据框中选择所需的列。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="4770" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以将过滤组件集成到我们的绘图中。我们把价格超过10美元的数据点标出来。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="33f0" class="ma mb it lw b gy mc md l me mf">alt.Chart(orders).mark_circle(size=50).encode(<br/>   x="tip", y="price:Q", color="order_type"<br/>).transform_lookup(<br/>   lookup="item",<br/>   from_=alt.LookupData(data=prices, key="item", fields=["price"])<br/>).transform_filter(<br/>   alt.FieldGTPredicate(field='price', gt=10)<br/>).properties(<br/>   title = "Price vs Tip"<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/11a309c3a7c0d2f8a2b1b08388692646.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/1*L-5G9N0kEbfWpAvagy0LFA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="269e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mk ml mm lw b">transform_filter</code>功能用于过滤。<code class="fe mk ml mm lw b">FieldGTPredicate</code>处理“大于”条件。Altair还为“等于”、“小于”、“范围”等其他条件提供了谓词。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="3cd3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了过滤和合并，Altair还允许在绘图前对数据点进行分组。例如，我们可以创建一个条形图，显示每种订单类型的平均价格。此外，我们可以为价格低于20美元的商品执行此操作。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1fa9" class="ma mb it lw b gy mc md l me mf">alt.Chart(orders).mark_bar().encode(<br/>   y="order_type", x="avg_price:Q"<br/>).transform_lookup(<br/>   lookup="item",<br/>   from_=alt.LookupData(data=prices, key="item", fields=["price"])<br/>).transform_filter(<br/>   alt.FieldLTPredicate(field='price', lt=20)<br/>).transform_aggregate(<br/>   avg_price = "mean(price)", groupby = ["order_type"]<br/>).properties(<br/>   height=200, width=300<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/49e956c49e6195f5432a1a8af425f733.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*rQTwn5S3XH0DfUh3m9tiOQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="1134" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们详细说明每一步:</p><ul class=""><li id="f7cd" class="mv mw it lb b lc ld lf lg li mx lm my lq mz lu na nb nc nd bi translated"><code class="fe mk ml mm lw b">transform_lookup</code>:从价格数据框中查找价格。</li><li id="8c8e" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated"><code class="fe mk ml mm lw b">transform_filter</code>:过滤20美元以下的价格。</li><li id="5c35" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated"><code class="fe mk ml mm lw b">transform_aggregate</code>:按订单类型对价格进行分组，并计算平均值。</li></ul><p id="ea4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保将聚合列的名称传递给<code class="fe mk ml mm lw b">encode</code>函数。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="6040" class="ma mb it bd nj nk nl dn nm nn no dp np li nq nr ns lm nt nu nv lq nw nx ny nz bi translated">结论</h2><p id="6932" class="pw-post-body-paragraph kz la it lb b lc oa ju le lf ob jx lh li oc lk ll lm od lo lp lq oe ls lt lu im bi translated">筛选、合并和分组是探索性数据分析过程中必不可少的。Altair允许在创建数据可视化的同时执行所有这些操作。在这个意义上，Altair也可以被认为是一个数据分析工具。</p><p id="f548" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在文章中做的例子可能看起来不那么有用，但是它们清楚地解释了这些组件是如何在可视化中使用的。</p><p id="656c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>