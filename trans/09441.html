<html>
<head>
<title>How to Anonymise Places in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中匿名化地点</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-anonymise-places-in-python-55597d0ded24?source=collection_archive---------39-----------------------#2021-09-01">https://towardsdatascience.com/how-to-anonymise-places-in-python-55597d0ded24?source=collection_archive---------39-----------------------#2021-09-01</a></blockquote><div><div class="fc ik il im in io"/><div class="ip iq ir is it"><h2 id="3c68" class="iu iv iw bd b dl ix iy iz ja jb jc dk jd translated" aria-label="kicker paragraph">编码教程，文本分析</h2><div class=""/><div class=""><h2 id="7ee4" class="pw-subtitle-paragraph kc jf iw bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">一个现成的代码，根据地名数据库识别和隐藏地点</h2></div><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj ku"><img src="../Images/a9f8be3768a06fb9be0b5f5491293c03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ysUbFyD2bPFuKxNZ"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">Max陈在<a class="ae lk" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="c486" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">在本文中，我将展示如何在不使用NLP技术(如命名实体识别)的情况下，在Python，<strong class="ln jg">中识别和匿名化地点。</strong></p><blockquote class="mh"><p id="0bec" class="mi mj iw bd mk ml mm mn mo mp mq mg dk translated">地名识别基于地名录，地名录由<a class="ae lk" href="http://www.geonames.org/" rel="noopener ugc nofollow" target="_blank">地名数据库</a>构建。</p></blockquote><p id="8c1a" class="pw-post-body-paragraph ll lm iw ln b lo mr kg lq lr ms kj lt lu mt lw lx ly mu ma mb mc mv me mf mg ip bi translated">Geonames是一个网络服务，包含了(几乎)世界上所有的地方。Geonames数据库可通过<a class="ae lk" href="https://download.geonames.org/export/dump/" rel="noopener ugc nofollow" target="_blank">链接</a>免费下载。您可以下载完整的数据库，包括世界上所有国家，或只有一个特定的国家。</p><blockquote class="mw mx my"><p id="8add" class="ll lm mz ln b lo lp kg lq lr ls kj lt na lv lw lx nb lz ma mb nc md me mf mg ip bi translated">这篇文章背后的想法是从Geonames数据库中建立一个<strong class="ln jg">地名录</strong>，并利用它来识别句子中的地点。在实践中，<strong class="ln jg">所实现的算法搜索句子中的每个单词是否包含在词典中</strong>。为了搜索比一个单词更长的地方，考虑<strong class="ln jg">n grams</strong>。</p></blockquote><p id="5a19" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">文章组织如下:</p><ul class=""><li id="45ad" class="nd ne iw ln b lo lp lr ls lu nf ly ng mc nh mg ni nj nk nl bi translated">导入Geonames数据库</li><li id="99e6" class="nd ne iw ln b lo nm lr nn lu no ly np mc nq mg ni nj nk nl bi translated">识别句子中的位置</li><li id="75b7" class="nd ne iw ln b lo nm lr nn lu no ly np mc nq mg ni nj nk nl bi translated">句子中的匿名位置</li><li id="d797" class="nd ne iw ln b lo nm lr nn lu no ly np mc nq mg ni nj nk nl bi translated">扩展匿名功能</li></ul><h1 id="f10e" class="nr ns iw bd nt nu nv nw nx ny nz oa ob kl oc km od ko oe kp of kr og ks oh oi bi translated">导入Geonames数据库</h1><p id="1905" class="pw-post-body-paragraph ll lm iw ln b lo oj kg lq lr ok kj lt lu ol lw lx ly om ma mb mc on me mf mg ip bi translated">第一步是导入Geonames数据库，可以从<a class="ae lk" href="https://download.geonames.org/export/dump/" rel="noopener ugc nofollow" target="_blank">此链接</a>下载。您可以选择是导入完整的数据库(AllCountries.zip)还是特定的国家(如意大利的IT.zip)。每个国家都通过其识别码来识别。</p><blockquote class="mh"><p id="17dc" class="mi mj iw bd mk ml mm mn mo mp mq mg dk translated">完整的数据库更加完整，但比单一国家数据库需要更多的处理时间。</p></blockquote><p id="5f96" class="pw-post-body-paragraph ll lm iw ln b lo mr kg lq lr ms kj lt lu mt lw lx ly mu ma mb mc mv me mf mg ip bi translated">因此，您应该根据要处理的文本选择正确的数据库。在本教程中，我主要关注意大利数据库，但是同样的代码也可以被其他数据库所利用。</p><p id="de49" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">从<a class="ae lk" href="https://download.geonames.org/export/dump/" rel="noopener ugc nofollow" target="_blank"> Geonames链接</a>，我下载IT.zip文件，解压后放入我的工作目录:</p><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj oo"><img src="../Images/77e587b5c57dcbed8ece04a96a6b8de1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7QGHO0oIqLUJHW-IaG2poA.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="6f1f" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">然后我把它导入一个熊猫的数据框架:</p><pre class="kv kw kx ky gu op oq or os aw ot bi"><span id="6fcf" class="ou ns iw oq b gz ov ow l ox oy">import pandas as pd</span><span id="75c5" class="ou ns iw oq b gz oz ow l ox oy">df = pd.read_csv('source/IT.txt', sep=' ', header=None)</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj pa"><img src="../Images/12a883aad5050d780068e376ddc936ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FpgGNHv7ObARwxuHBnxXNQ.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="ec91" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">数据框架的第1列包含用于建立地名索引的地点列表:</p><pre class="kv kw kx ky gu op oq or os aw ot bi"><span id="1694" class="ou ns iw oq b gz ov ow l ox oy">gaz = df[1]<br/>gaz = gaz.tolist()</span></pre><p id="b91d" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">实施的地名索引包含119.539个地方。</p><h1 id="e630" class="nr ns iw bd nt nu nv nw nx ny nz oa ob kl oc km od ko oe kp of kr og ks oh oi bi translated">识别句子中的位置</h1><p id="9a63" class="pw-post-body-paragraph ll lm iw ln b lo oj kg lq lr ok kj lt lu ol lw lx ly om ma mb mc on me mf mg ip bi translated">现在我定义一个函数，它接收一个文本作为输入，然后返回文本中包含的所有位置。该函数执行以下操作:</p><ul class=""><li id="ef4f" class="nd ne iw ln b lo lp lr ls lu nf ly ng mc nh mg ni nj nk nl bi translated">删除文本中的所有标点符号</li><li id="5260" class="nd ne iw ln b lo nm lr nn lu no ly np mc nq mg ni nj nk nl bi translated">将句子分割成记号，用空格符隔开。这可以通过<code class="fe pb pc pd oq b">split()</code>功能来完成</li><li id="563e" class="nd ne iw ln b lo nm lr nn lu no ly np mc nq mg ni nj nk nl bi translated">从识别出的记号开始，构建所有可能的ngrams，n ≤ 5。我利用<code class="fe pb pc pd oq b">nltk</code>库的<code class="fe pb pc pd oq b">ngrams</code>函数将文本分割成ngrams。例如在句子<em class="mz"> Oggi sono andata a Parigi </em>中，n ≤ 5的ngrams包括:</li></ul><pre class="kv kw kx ky gu op oq or os aw ot bi"><span id="e4e1" class="ou ns iw oq b gz ov ow l ox oy">(‘Oggi’, ‘sono’, ‘andata’, ‘a’, ‘Parigi’)<br/>(‘Oggi’, ‘sono’, ‘andata’, ‘a’)<br/>(‘sono’, ‘andata’, ‘a’, ‘Parigi’)<br/>(‘Oggi’, ‘sono’, ‘andata’)<br/>(‘sono’, ‘andata’, ‘a’)<br/>(‘andata’, ‘a’, ‘Parigi’)<br/>(‘Oggi’, ‘sono’)<br/>(‘sono’, ‘andata’)<br/>(‘andata’, ‘a’)<br/>(‘a’, ‘Parigi’)<br/>(‘Oggi’,)<br/>(‘sono’,)<br/>(‘andata’,)<br/>(‘a’,)<br/>(‘Parigi’,)</span></pre><ul class=""><li id="9fd8" class="nd ne iw ln b lo lp lr ls lu nf ly ng mc nh mg ni nj nk nl bi translated">从最大的n元语法开始(n = 5)，搜索每个n元语法是否包含在地名录中。如果是，则找到一个位置，并且可以将其添加到找到的位置的列表中，并且从原始文本中移除该位置，否则，继续。注意</li></ul><p id="1c73" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">该函数的完整代码如下:</p><pre class="kv kw kx ky gu op oq or os aw ot bi"><span id="27be" class="ou ns iw oq b gz ov ow l ox oy">from nltk import ngrams<br/>import re</span><span id="8b3e" class="ou ns iw oq b gz oz ow l ox oy">def get_places(txt):<br/>    # remove punctuation<br/>    txt = re.sub(r"[^\w\d'\s]+",'',txt)<br/>    n = 5<br/>    places = []<br/>    <br/>    for i in range(n,0,-1):<br/>        tokens = ngrams(txt.split(), i)<br/>        for t in tokens:<br/>            token = " ".join(t)<br/>            try:<br/>                res = gaz.index(token)<br/>            except ValueError:<br/>                continue<br/>            if res:<br/>                places.append(token)<br/>                txt = txt.replace(token,"")<br/>    return places</span></pre><p id="e6d7" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">现在我可以用一个例子来测试这个函数:</p><pre class="kv kw kx ky gu op oq or os aw ot bi"><span id="90c3" class="ou ns iw oq b gz ov ow l ox oy">txt = 'Oggi sono andata a Roma e a Milano.'<br/>get_places(txt)</span></pre><p id="4559" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">它给出了以下输出:</p><pre class="kv kw kx ky gu op oq or os aw ot bi"><span id="f5a1" class="ou ns iw oq b gz ov ow l ox oy">['Roma', 'Milano']</span></pre><h1 id="edcf" class="nr ns iw bd nt nu nv nw nx ny nz oa ob kl oc km od ko oe kp of kr og ks oh oi bi translated">句子中的匿名位置</h1><p id="3025" class="pw-post-body-paragraph ll lm iw ln b lo oj kg lq lr ok kj lt lu ol lw lx ly om ma mb mc on me mf mg ip bi translated">现在，我准备利用前面定义的函数来匿名化函数。简单地说，我可以用符号字符替换找到的位置，例如x。所有的搜索操作都必须在原始文本的副本上进行，以便保留原始文本(即删除标点以便操作)。</p><p id="852c" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">这是匿名的完整功能:</p><pre class="kv kw kx ky gu op oq or os aw ot bi"><span id="08e0" class="ou ns iw oq b gz ov ow l ox oy">def anonymise_places(txt):<br/>    temp_txt = re.sub(r"[^\w\d'\s]+",'',txt)<br/>    n = 5<br/>    # remove punctuation<br/>    for i in range(n,0,-1):<br/>        tokens = ngrams(temp_txt.split(), i)<br/>        for t in tokens:<br/>            token = " ".join(t)<br/>            try:<br/>                res = gaz.index(token)<br/>            except ValueError:<br/>                continue<br/>            if res:<br/>                txt = txt.replace(token,"X")<br/>                temp_txt = temp_txt.replace(token,"")<br/>    return txt</span></pre><h1 id="4a14" class="nr ns iw bd nt nu nv nw nx ny nz oa ob kl oc km od ko oe kp of kr og ks oh oi bi translated">扩展匿名功能</h1><p id="de69" class="pw-post-body-paragraph ll lm iw ln b lo oj kg lq lr ok kj lt lu ol lw lx ly om ma mb mc on me mf mg ip bi translated">所实现的功能可以通过覆盖全世界的地名录来扩展。然而，全世界的地名数据库约为1.5 GB，因此难以管理。因此，您可以下载它，加载到Pandas中，然后只选择感兴趣的列(对应于列1 ),并将结果导出为一个新的csv文件，大约274 MB:</p><pre class="kv kw kx ky gu op oq or os aw ot bi"><span id="1dc4" class="ou ns iw oq b gz ov ow l ox oy">df_all = pd.read_csv('source/allCountries.txt', sep=' ', header=None)<br/>df_all[1].to_csv('source/places.csv')</span></pre><p id="403d" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">前面的操作可能需要一段时间，因为文件非常大。然后，您可以将这个新文件用作地名词典，而不是IT.txt。</p><h1 id="7cc3" class="nr ns iw bd nt nu nv nw nx ny nz oa ob kl oc km od ko oe kp of kr og ks oh oi bi translated">摘要</h1><p id="41b4" class="pw-post-body-paragraph ll lm iw ln b lo oj kg lq lr ok kj lt lu ol lw lx ly om ma mb mc on me mf mg ip bi translated">在本文中，我描述了如何在不使用NLP技术的情况下匿名化Python中的位置。拟议的方法是基于使用地名录，地名录是根据地名数据库建立的。</p><p id="ad4a" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">本教程的完整代码可以从我的<a class="ae lk" href="https://github.com/alod83/data-science/blob/master/TextAnalysis/Anonymise%20Places.ipynb" rel="noopener ugc nofollow" target="_blank"> Github库</a>下载。本教程还包含了一个在<code class="fe pb pc pd oq b">gradio</code>中的函数测试，这是一个非常强大的用于Web应用的Python库。请继续关注关于<code class="fe pb pc pd oq b">gradio</code>的教程</p><h1 id="d346" class="nr ns iw bd nt nu nv nw nx ny nz oa ob kl oc km od ko oe kp of kr og ks oh oi bi translated">相关文章</h1><div class="pe pf gq gs pg ph"><a href="https://medium.datadriveninvestor.com/how-to-restore-the-original-layout-of-a-text-document-after-a-manipulation-in-python-8f3de41e8e95" rel="noopener  ugc nofollow" target="_blank"><div class="pi ab fp"><div class="pj ab pk cl cj pl"><h2 class="bd jg gz z fq pm fs ft pn fv fx jf bi translated">如何在Python中操作后恢复文本文档的原始布局</h2><div class="po l"><h3 class="bd b gz z fq pm fs ft pn fv fx dk translated">少于10行的代码，用于在操作后保留文本文档的布局，例如文本…</h3></div><div class="pp l"><p class="bd b dl z fq pm fs ft pn fv fx dk translated">medium.datadriveninvestor.com</p></div></div><div class="pq l"><div class="pr l ps pt pu pq pv le ph"/></div></div></a></div><div class="pe pf gq gs pg ph"><a rel="noopener follow" target="_blank" href="/how-to-extract-structured-information-from-a-text-through-python-spacy-749b311161e"><div class="pi ab fp"><div class="pj ab pk cl cj pl"><h2 class="bd jg gz z fq pm fs ft pn fv fx jf bi translated">如何通过Python空间从文本中提取结构化信息</h2><div class="po l"><h3 class="bd b gz z fq pm fs ft pn fv fx dk translated">关于如何从文本构建结构化数据集的现成教程。</h3></div><div class="pp l"><p class="bd b dl z fq pm fs ft pn fv fx dk translated">towardsdatascience.com</p></div></div><div class="pq l"><div class="pw l ps pt pu pq pv le ph"/></div></div></a></div><div class="pe pf gq gs pg ph"><a href="https://medium.com/geekculture/the-top-25-python-libraries-for-data-science-71c0eb58723d" rel="noopener follow" target="_blank"><div class="pi ab fp"><div class="pj ab pk cl cj pl"><h2 class="bd jg gz z fq pm fs ft pn fv fx jf bi translated">面向数据科学的25大Python库</h2><div class="po l"><h3 class="bd b gz z fq pm fs ft pn fv fx dk translated">你一生中至少应该尝试一次的Python库列表。</h3></div><div class="pp l"><p class="bd b dl z fq pm fs ft pn fv fx dk translated">medium.com</p></div></div><div class="pq l"><div class="px l ps pt pu pq pv le ph"/></div></div></a></div></div></div>    
</body>
</html>