<html>
<head>
<title>Efficient Data Valuation with Exact Shapley Values</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">具有精确Shapley值的高效数据评估</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/efficient-data-valuation-with-exact-shapley-values-f0689ff708e?source=collection_archive---------21-----------------------#2021-09-06">https://towardsdatascience.com/efficient-data-valuation-with-exact-shapley-values-f0689ff708e?source=collection_archive---------21-----------------------#2021-09-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="02a3" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/thoughts-and-theory" rel="noopener" target="_blank">思想和理论</a></h2><div class=""/><div class=""><h2 id="d40a" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated"><strong class="ak">用更少的数据产生更好的模型。</strong></h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/175837c37379ab8bb09a466d271ff3f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fhyTGelktYEqxM_3"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@swimstaralex?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">拍摄的亚历山大·辛恩</a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="7fb9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这篇文章概述了论文中所做的工作— <strong class="lk jd">“最近邻算法的高效特定任务数据评估”</strong>。</p><p id="98ce" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">数据越多，结果越好吗？鉴于机器学习的趋势，你会有同样的期待。鉴于最近越来越多的具有优异性能的机器学习模型的兴起，更多的数据似乎是王道。</p><p id="9c21" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这种模式在机器学习的进步中得到了例证，如OpenAIs GPT-3模型，它在来自书籍和互联网的超过45tb的数据上进行训练，以支持其1750亿个参数。但这种模式与谷歌的新开关变压器架构相比实在是相形见绌，该架构拥有1.6万亿个参数。因此，似乎越来越大的模型和越来越多的数据是不可避免的。</p><blockquote class="me"><p id="0935" class="mf mg it bd mh mi mj mk ml mm mn md dk translated">“信息是21世纪的石油，而分析则是内燃机。”——Peter Sondergaard，Gartner高级副总裁</p></blockquote><p id="28c3" class="pw-post-body-paragraph li lj it lk b ll mo kd ln lo mp kg lq lr mq lt lu lv mr lx ly lz ms mb mc md im bi translated">如果数据如此有价值，我们应该收集更多吗？为什么我们不能拥有更多如此珍贵的东西？</p><p id="82fa" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">这种方法有一个问题</strong>。如果你收集的额外数据与你的问题无关呢？如果纯粹是噪音呢？那么任何额外的数据都会严重影响模型的性能。那么你能做些什么来缓解这个问题呢？</p><p id="3598" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，你可以仔细检查你的数据。这种方法可能是最有效的工具之一，但是当您拥有大量数据时，这种方法非常耗时。对于计算机视觉任务，有许多不同的技术可以使用。这篇文章展示了一些令人兴奋的技术。</p><div class="mt mu gp gr mv mw"><a rel="noopener follow" target="_blank" href="/explaining-how-i-reached-the-top-ranks-of-the-new-data-centric-competition-888fc8e86547"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd jd gy z fp nb fr fs nc fu fw jc bi translated">解释我如何在以数据为中心的新竞争中名列前茅</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">继吴君如本人代言(！)关于我的上一篇文章，很自然地分享了所有的技巧(与…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">towardsdatascience.com</p></div></div><div class="nf l"><div class="ng l nh ni nj nf nk lb mw"/></div></div></a></div><p id="db4d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在许多情况下，适用的数据相对容易识别。然而，对于其他人来说，这充其量是一个不明确的任务。通常问题的一部分是数据和结果之间的关系是我们试图建模的。<strong class="lk jd">然后确定什么数据最适用是一项艰巨的任务</strong>。</p><p id="6fd3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">幸运的是，有一种基于Shapley值的新方法非常适合这种情况。</p><h1 id="cd22" class="nl nm it bd nn no np nq nr ns nt nu nv ki nw kj nx kl ny km nz ko oa kp ob oc bi translated"><strong class="ak"> SHAP价值观</strong></h1><p id="6fc6" class="pw-post-body-paragraph li lj it lk b ll od kd ln lo oe kg lq lr of lt lu lv og lx ly lz oh mb mc md im bi translated"><strong class="lk jd">SH</strong>apley<strong class="lk jd">A</strong>additive ex<strong class="lk jd">P</strong>lanations(SHAP)是一种解释任何机器学习模型输出的博弈论方法。这种方法是众所周知的，但是属性仅仅基于特征。</p><p id="f261" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">该方法将来自特征的属性值提供给模型的输出。SHAP值基于沙普利值，沙普利值决定了如何在游戏中公平地在多个玩家之间分配报酬。对于SHAP价值观来说，玩家联盟是基于特征的。</p><div class="mt mu gp gr mv mw"><a href="https://github.com/slundberg/shap" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd jd gy z fp nb fr fs nc fu fw jc bi translated">GitHub - slundberg/shap:一种解释任何机器学习输出的博弈论方法…</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">SHAP是一种博弈论的方法来解释任何机器学习模型的输出…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">github.com</p></div></div><div class="nf l"><div class="oi l nh ni nj nf nk lb mw"/></div></div></a></div><p id="f3bf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">SHAP价值观非常灵活。例如，在计算机视觉任务中，SHAP值代表不同像素对模型输出的贡献。有许多不同的方法来计算SHAP值，包括与模型无关的KernelSHAP方法。</p><p id="4714" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于SHAP值的每一个变化，归因总是与模型的特征有关。然而，还有一个选择。将实例用作玩家，并计算每个实例的属性。</p><h1 id="0516" class="nl nm it bd nn no np nq nr ns nt nu nv ki nw kj nx kl ny km nz ko oa kp ob oc bi translated"><strong class="ak">数据估值</strong></h1><p id="5c01" class="pw-post-body-paragraph li lj it lk b ll od kd ln lo oe kg lq lr of lt lu lv og lx ly lz oh mb mc md im bi translated">“最近邻算法的有效的特定任务数据评估”是一篇最近的论文，提供了计算精确Shapley值的新算法。在本文的其余部分，我将为每个实例生成的Shapley值称为数据Shapley值。</p><p id="1e77" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">数据Shapley值是最近的一项创新，它利用Shapley值来确定不同数据实例的属性。这项研究的动机是通过优化从数据市场中选择的记录来保护隐私的机器学习。数据市场由许多不同的医疗记录组成。因此，数据购买者选择从数据市场购买记录的子集。由于数据成本，买方的目标是为他们的模型选择最佳的患者子集。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oj"><img src="../Images/ab3d9e25294d9f55a8f8891ec51aeea3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c0_oNovDMezFn7PrXdh9_A.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">数据市场问题<a class="ae lh" href="https://arxiv.org/pdf/1908.08619.pdf" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/pdf/1908.08619.pdf</a>(图片来自论文)</p></figure><p id="b0cb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">该问题配置中的Shapley值测量归因于每个数据点平均总体可能数据子集的效用的边际改善。</p><p id="6974" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">计算Shapley值的最重要的问题是高度的复杂性。一般来说，这是在O(2^N的水平)进行精确计算。</p><p id="dca2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，研究人员开发了一种使用KNN实用程序为K-NN分类器设计的精确Shapley值的新算法。该算法依赖于KNN效用满足分段效用差分性质的事实。</p><p id="7120" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我将把精确的数学公式留给论文和好奇的读者。但结果是这样的。该算法以O(N log N)复杂度执行精确计算。</p><div class="mt mu gp gr mv mw"><a href="https://github.com/AI-secure/KNN-PVLDB" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd jd gy z fp nb fr fs nc fu fw jc bi translated">GitHub - AI-secure/KNN-PVLDB:官方回购“高效的特定任务数据估值最近…</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">这个repo是PVLDB论文“最近邻的高效特定任务数据评估…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">github.com</p></div></div><div class="nf l"><div class="ok l nh ni nj nf nk lb mw"/></div></div></a></div></div><div class="ab cl ol om hx on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="im in io ip iq"><h1 id="2c4e" class="nl nm it bd nn no os nq nr ns ot nu nv ki ou kj nx kl ov km nz ko ow kp ob oc bi translated"><strong class="ak">实验</strong></h1><p id="8b42" class="pw-post-body-paragraph li lj it lk b ll od kd ln lo oe kg lq lr of lt lu lv og lx ly lz oh mb mc md im bi translated">实验的结构遵循简单的格式。首先，数据被分成训练集、验证集和测试集。然后，基于训练实例对验证实例的属性来计算精确的Shapley值。</p><p id="8e45" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后根据它们的Shapley值对训练实例进行排序。这种设置为用户提供了每个实例对验证集的属性。接下来，用户可以只选择那些具有最高Shapley值的实例，为用户提供更小的数据子集。</p><p id="3b03" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">由于该过程选择对验证集的性能贡献最大的数据，因此移除实例将降低Shapley值，这通常会移除数据中噪音最大的实例。同时，保留最有代表性的例子。</p><p id="f7d0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">实验使用了diamonds数据集。该数据集包含近54，000颗钻石。这些特征包括钻石属性，如钻石的克拉、切割、颜色和其他一些特征。一些特征是分类的，对于这些实验，我将这些特征转换成每个类别的布尔特征。</p><p id="3371" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">目标是钻石的价格。</p><div class="mt mu gp gr mv mw"><a href="https://www.kaggle.com/shivam2503/diamonds" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd jd gy z fp nb fr fs nc fu fw jc bi translated">钻石</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">通过切割、颜色、净度、价格和其他属性来分析钻石</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">www.kaggle.com</p></div></div><div class="nf l"><div class="ox l nh ni nj nf nk lb mw"/></div></div></a></div><p id="1c92" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我已经进行了5000次验证和测试。剩余的数据用于训练。</p><p id="1dae" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">目的是利用较少的数据建立一个预测钻石价格的模型。我用一个决策树回归器评估了性能。基于Shapley值对数据进行排序，并且使用R分数来测量性能。</p><pre class="ks kt ku kv gt oy oz pa pb aw pc bi"><span id="1fd0" class="pd nm it oz b gy pe pf l pg ph">import numpy as np<br/>from sklearn.utils import shuffle<br/>from sklearn.tree import DecisionTreeRegressor<br/>from exact_sp import get_true_KNN, compute_single_unweighted_knn_class_shapley<br/>import matplotlib.pyplot as plt<br/>import pandas as pd</span><span id="3fae" class="pd nm it oz b gy pi pf l pg ph">df = pd.read_csv('diamonds.csv', index_col='index').reset_index(drop=True)<br/>df = pd.get_dummies(df, columns = ['cut', 'color', 'clarity'])<br/>x_trn = df.drop(['price'], axis=1).to_numpy()<br/>y_trn = df['price'].astype(float).to_numpy()<br/>x_trn, y_trn = shuffle(x_trn, y_trn, random_state=10)<br/>x_tst, y_tst = x_trn[:5000], y_trn[:5000]<br/>x_val, y_val = x_trn[5000:10000], y_trn[5000:10000]<br/>x_trn, y_trn = x_trn[10000:], y_trn[10000:]<br/>K = 1</span></pre><p id="6b81" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，计算Shapley值进行验证。代码块也依次适合较小数据量的模型。该数据是根据递减的Shapley值考虑的。</p><p id="98d2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦在训练数据的子集上训练了模型，就在测试数据集上评估该模型。</p><pre class="ks kt ku kv gt oy oz pa pb aw pc bi"><span id="c3c2" class="pd nm it oz b gy pe pf l pg ph">x_val_knn_gt = get_true_KNN(x_trn, x_val)<br/>val_sp_gt = compute_single_unweighted_knn_class_shapley(x_trn, y_trn, x_val_knn_gt, y_val, K)</span><span id="d75e" class="pd nm it oz b gy pi pf l pg ph">g_values = np.mean(val_sp_gt, axis=0)<br/>count = int(len(x_trn)*4/5)<br/>interval = int(count*0.02)<br/>x = np.arange(0, count, interval)/len(x_trn)<br/>g_r2_scores = []<br/>g_r2_scores_val = []<br/>idxs = np.argsort(g_values)<br/>keep_idxs = idxs.tolist()</span><span id="487c" class="pd nm it oz b gy pi pf l pg ph">for j in range(0, count, interval):<br/>    if len(keep_idxs) == len(x_trn):<br/>        x_train_keep, y_train_keep = x_trn, y_trn<br/>    else:<br/>        x_train_keep, y_train_keep = x_trn[keep_idxs], y_trn[keep_idxs]<br/>    reg = DecisionTreeRegressor()<br/>    reg.fit(x_train_keep, y_train_keep)<br/>    r2_score = reg.score(x_tst, y_tst)<br/>    r2_score_val = reg.score(x_val, y_val)<br/>    g_r2_scores.append(r2_score)<br/>    g_r2_scores_val.append(r2_score_val)<br/>    keep_idxs = keep_idxs[interval:]</span><span id="0a02" class="pd nm it oz b gy pi pf l pg ph">plt.plot(x, g_r2_scores, '-', label='Test Performance', color='olive')<br/>plt.plot(x, g_r2_scores_val, '-', label='Validation Performance', color='blue')<br/>plt.ylabel('R2 Score')<br/>plt.xlabel('Percent of Data Removed')<br/>plt.legend(loc="lower left")<br/>plt.title('Data Validation with Exact Shapley Values')<br/>plt.show()</span></pre><p id="6d2e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">实验结果表明，该模型在较少数据的情况下，对测试数据的表现较好。当几乎50%的训练数据被删除时，测试性能达到峰值。</p><p id="1766" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">同样有趣的是，当超过60%的训练数据被删除时，验证集上的模型性能达到峰值。因为实例是根据验证集的Shapley值删除的，所以这种模式有一定的意义。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pj"><img src="../Images/655f41e2561234387b48d6f746023a9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*2wAaI_epKkBNevALYQHN1Q.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">删除数据后的性能变化(图片由作者提供)</p></figure><h1 id="6faf" class="nl nm it bd nn no np nq nr ns nt nu nv ki nw kj nx kl ny km nz ko oa kp ob oc bi translated"><strong class="ak">结论</strong></h1><p id="3b15" class="pw-post-body-paragraph li lj it lk b ll od kd ln lo oe kg lq lr of lt lu lv og lx ly lz oh mb mc md im bi translated">尽管海量数据的可用性不断增加，但数据的质量至关重要。在低质量的数据上构建模型会产生低质量的模型。</p><p id="383c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在实例上使用Shapley值提供了一种替代方法。您可以用更少的实例创建模型，从而提高性能。实验表明，即使数据子集非常小，较少的数据也可以提高模型性能。</p><p id="a553" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">数据是新的石油，但是石油的质量很重要。</p><p id="20c1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">考虑在下一个机器学习模型中使用数据Shapley值。</p></div><div class="ab cl ol om hx on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="im in io ip iq"><p id="e547" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你有兴趣阅读关于新颖的数据科学工具和理解机器学习算法的文章，可以考虑在medium上关注我。</p><p id="4f22" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="pk">如果你对我的写作感兴趣，想直接支持我，请通过以下链接订阅。这个链接确保我会收到你的会员费的一部分。</em></p><div class="mt mu gp gr mv mw"><a href="https://zjwarnes.medium.com/membership" rel="noopener follow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd jd gy z fp nb fr fs nc fu fw jc bi translated">通过我的推荐链接加入Medium-Zachary Warnes</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">阅读扎卡里·沃恩斯(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">zjwarnes.medium.com</p></div></div><div class="nf l"><div class="pl l nh ni nj nf nk lb mw"/></div></div></a></div></div></div>    
</body>
</html>