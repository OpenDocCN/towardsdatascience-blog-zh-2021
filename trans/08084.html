<html>
<head>
<title>Using an ActiveX Control in F#</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在F#中使用ActiveX控件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-an-activex-control-in-f-722e4d6614a1?source=collection_archive---------25-----------------------#2021-07-24">https://towardsdatascience.com/using-an-activex-control-in-f-722e4d6614a1?source=collection_archive---------25-----------------------#2021-07-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3dc9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">F#和COM</h2></div><p id="bd32" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我想在我的F#中添加一个对遗留ActiveX控件的引用。NET Framework)项目。问题是，当它添加引用时，它是以一种非常基本且无益的方式添加的。我在StackOverflow上发帖，看看是否有人有解决方案，但建议的东西都不起作用:</p><div class="lb lc gp gr ld le"><a href="https://stackoverflow.com/questions/67933379/how-to-access-com-variant-properties-with-f" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">如何用F#访问COM变量属性</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">我可以通过ActiveX控件访问一个遗留系统。我可以用这个控件的ProgID创建它的一个实例…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">stackoverflow.com</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls lt le"/></div></div></a></div><p id="66db" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我自己解决了这个问题，这篇文章是关于我是如何解决的。花了不少功夫，但是键用的是Visual Studio 2017(完全支持F#。NET Framework)并利用C#作为临时过渡。我写这篇文章是为了防止其他人发现自己处于同样的情况，并想知道如何解决它。对我来说也是个参考:)</p><h2 id="279b" class="lu lv iq bd lw lx ly dn lz ma mb dp mc ko md me mf ks mg mh mi kw mj mk ml mm bi translated">F#控制台应用程序</h2><p id="076b" class="pw-post-body-paragraph kf kg iq kh b ki mn jr kk kl mo ju kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">创建一个F#控制台应用程序。NET Framework)在Visual Studio 2017:</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi ms"><img src="../Images/fe59c05b8b5e92816a24b6da011e9c3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i6BRxhQbSFbXILZTilVtsw.png"/></div></div><p class="nd ne gj gh gi nf ng bd b be z dk translated">F#控制台应用程序(。NET框架)</p></figure><p id="ec1d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">添加一个C#类库(。NET Framework)添加到解决方案中，并将其命名为<strong class="kh ir"> DummyLib </strong>:</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nh"><img src="../Images/6ee749c4e2c370d2f0e3f7f8fe3d5ad0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kfOcRT2Ks8O9hd0r1--kXA.png"/></div></div><p class="nd ne gj gh gi nf ng bd b be z dk translated">C#类库(。NET框架)</p></figure><p id="8835" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">右键单击<strong class="kh ir"> DummyLib </strong>的引用，并选择添加一个引用。然后选择一个COM引用。您应该会看到一个包含ActiveX控件的COM对象列表。为了演示起见，请选择<strong class="kh ir">微软的ActiveMovie控件</strong>(在现实世界中，您可以添加您想要的ActiveX控件):</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi ni"><img src="../Images/d53e19042b8a00ee4e4245bdf2b39eef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bYG1Qk1YxRPe3NVzyT6Xeg.png"/></div></div><p class="nd ne gj gh gi nf ng bd b be z dk translated">添加对Microsoft ActiveMovie控件的引用</p></figure><p id="562b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦你点击“确定”按钮，它将添加COM引用，并且它将被列在“引用”树下。如果您现在双击引用中的一个视图，这将打开对象浏览器窗口。展开互操作。AMovie对象，您将看到AMovie名称空间。展开它，您会看到ActiveMovieClass。如果选择，您将看到所有方法、属性和事件:</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nj"><img src="../Images/1c682ae8b26031cf5b66a181f55cbc73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SmWKcrFtyh7DvbBLkILI3A.png"/></div></div><p class="nd ne gj gh gi nf ng bd b be z dk translated">对象浏览器中的ActiveMovieClass</p></figure><p id="a78e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您现在右键单击DummyLib项目并选择卸载该项目，那么您可以再次右键单击它并编辑它:</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/fef5ae055815bde0b419b8eed9b8c0cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*Bs75sHvJToJ5HC5kKebjzQ.png"/></div><p class="nd ne gj gh gi nf ng bd b be z dk translated">编辑DummLib.csproj文件</p></figure><p id="51c6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">向下滚动到定义COMReference的ItemGroup元素，并将其复制到安全的地方:</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/841bb55b233b2e8fdd92d9d8a5b4c92f.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*CZwFzQ1UgLZTenUg6v1FtA.png"/></div><p class="nd ne gj gh gi nf ng bd b be z dk translated">COMReference部分</p></figure><p id="7616" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在需要卸载AxLegacy控制台应用程序，然后以同样的方式编辑FSPROJ文件。向下滚动到文件底部，将复制的部分插入到最后一条注释的正上方:</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nm"><img src="../Images/484eed662ccc64c7605311474cac1103.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H0g3yy67GwT3nmBSkTbVyw.png"/></div></div><p class="nd ne gj gh gi nf ng bd b be z dk translated">AxLegacy.fsproj中插入的部分</p></figure><p id="9732" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">右键单击两个项目文件并重新加载它们。我们快到了！</p><h2 id="a2ac" class="lu lv iq bd lw lx ly dn lz ma mb dp mc ko md me mf ks mg mh mi kw mj mk ml mm bi translated">构建解决方案</h2><p id="560a" class="pw-post-body-paragraph kf kg iq kh b ki mn jr kk kl mo ju kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">如果你现在查看AxLegacy项目的Obj输出文件夹，你会看到<strong class="kh ir"> tlbimp </strong>工具已经创建了引用COM库的<strong class="kh ir">Interop.AMovie.dll</strong>文件。我们需要确保将它复制到我们的输出文件夹中，我们确保这一点的方法是将其添加为后期构建步骤:</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/d80c35150793a356e6f3f117caedfe76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*rDQan5Bv6LpAPb-Xk9rBeg.png"/></div><p class="nd ne gj gh gi nf ng bd b be z dk translated">构建后副本</p></figure><p id="f462" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那一行写着:</p><pre class="mt mu mv mw gt no np nq nr aw ns bi"><span id="2b2b" class="lu lv iq np b gy nt nu l nv nw">xcopy /Y /F $(ProjectDir)obj\*.dll $(TargetDir)</span></pre><p id="6a57" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这应该适用于以这种方式包含的任何COM对象。</p><p id="1d52" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在可以安全地从解决方案中移除<strong class="kh ir"> DummyLib </strong>了，请继续操作。</p><h2 id="db4d" class="lu lv iq bd lw lx ly dn lz ma mb dp mc ko md me mf ks mg mh mi kw mj mk ml mm bi translated">测试</h2><p id="8c54" class="pw-post-body-paragraph kf kg iq kh b ki mn jr kk kl mo ju kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">为了查看我们是否可以正确地访问我们的COM对象，我们将在控制台应用程序中执行如下操作:</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="nx ny l"/></div></figure><h2 id="fc9d" class="lu lv iq bd lw lx ly dn lz ma mb dp mc ko md me mf ks mg mh mi kw mj mk ml mm bi translated">结论</h2><p id="14af" class="pw-post-body-paragraph kf kg iq kh b ki mn jr kk kl mo ju kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">在Visual Studio 2019中，做一些本应开箱即用的事情需要做很多工作！我希望当我们得到Visual Studio 2022时，它也能支持F#。NET框架应用程序。</p><h2 id="2503" class="lu lv iq bd lw lx ly dn lz ma mb dp mc ko md me mf ks mg mh mi kw mj mk ml mm bi translated">资源</h2><p id="8fa0" class="pw-post-body-paragraph kf kg iq kh b ki mn jr kk kl mo ju kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">您可以从我的GitHub下载我在这里创建的示例应用程序:</p><div class="lb lc gp gr ld le"><a href="https://github.com/ianormy/AXLegacy" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">使用ActiveX控件的GitHub - ianormy/AXLegacy: F#控制台应用程序</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">使用ActiveX控件的F#控制台应用。通过在GitHub上创建帐户，为ianormy/AXLegacy开发做出贡献。</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">github.com</p></div></div><div class="ln l"><div class="nz l lp lq lr ln ls lt le"/></div></div></a></div></div></div>    
</body>
</html>