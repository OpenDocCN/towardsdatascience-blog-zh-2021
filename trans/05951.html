<html>
<head>
<title>Testing the Assumptions of Linear Regression</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">检验线性回归的假设</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/testing-the-assumptions-of-linear-regression-f38857abc08a?source=collection_archive---------7-----------------------#2021-05-28">https://towardsdatascience.com/testing-the-assumptions-of-linear-regression-f38857abc08a?source=collection_archive---------7-----------------------#2021-05-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a015" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">逐步建立线性回归模型来检验高斯-马尔可夫假设</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ac0647f34821d714dfeffcbc33718a90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JVLs593yhMmBM4OJU2fJZg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6edc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">似乎在每个人都如此热衷于各种花哨的机器学习算法的今天，很少有人仍然关心地问:<strong class="la iu">普通最小二乘(OLS)回归所需的关键假设是什么？我如何测试我的模型是否满足这些假设？</strong>然而，由于简单线性回归无疑是社会科学各个领域中最受欢迎的建模方法，我认为有必要快速回顾一下OLS的基本假设，并通过使用经典的波士顿住房数据构建线性回归模型来进行一些测试。</p><h1 id="9477" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">1.高斯-马尔可夫假设</h1><p id="6ff2" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">高斯-马尔可夫假设确保OLS回归系数是最佳线性无偏估计。</p><ol class=""><li id="83e0" class="mr ms it la b lb lc le lf lh mt ll mu lp mv lt mw mx my mz bi translated">参数中的<strong class="la iu">线性度</strong></li><li id="8e6d" class="mr ms it la b lb na le nb lh nc ll nd lp ne lt mw mx my mz bi translated"><strong class="la iu">随机抽样</strong>:观察数据代表从总体中随机抽取的样本</li><li id="e8d9" class="mr ms it la b lb na le nb lh nc ll nd lp ne lt mw mx my mz bi translated">协变量之间没有完美的共线性</li><li id="b48a" class="mr ms it la b lb na le nb lh nc ll nd lp ne lt mw mx my mz bi translated"><strong class="la iu">误差的零条件均值</strong>(即E( |X) = 0)(也常称为<strong class="la iu">外生性</strong>)</li><li id="0f97" class="mr ms it la b lb na le nb lh nc ll nd lp ne lt mw mx my mz bi translated"><strong class="la iu">误差的同方差</strong>(恒定方差)</li></ol><p id="4998" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">需要注意的是，当假设1-4满足时，OLS是无偏的(即(β*) = β)。异方差对OLS估计量的偏差或一致性没有影响，但它意味着OLS估计量不再是蓝色的，标准误差的OLS估计是不正确的。</p><h1 id="2a64" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">2.数据</h1><p id="10a0" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">波士顿房价数据集由14个属性的506个观察值组成:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="5310" class="nk lv it ng b gy nl nm l nn no"><strong class="ng iu"><em class="np">crim:</em></strong> per capita crime rate by town<br/><strong class="ng iu"><em class="np">zn:</em></strong> proportion of residential land zoned for lots over 25,000 sq.ft<br/><strong class="ng iu"><em class="np">indus:</em></strong> proportion of non-retail business acres per town <br/><strong class="ng iu"><em class="np">chas:</em></strong> Charles River dummy variable (= 1 if tract bounds river; 0 otherwise)<br/><strong class="ng iu"><em class="np">nox: </em></strong>nitric oxides concentration (parts per 10 million)<br/><strong class="ng iu"><em class="np">rm:</em></strong> average number of rooms per dwelling<br/><strong class="ng iu"><em class="np">age:</em></strong> proportion of owner-occupied units built prior to 1940<br/><strong class="ng iu"><em class="np">dis:</em></strong> weighted distances to five Boston employment centres<br/><strong class="ng iu"><em class="np">rad:</em></strong> index of accessibility to radial highways<br/><strong class="ng iu"><em class="np">tax:</em></strong> full-value property-tax rate per USD 10,000<br/><strong class="ng iu"><em class="np">ptratio:</em></strong> pupil-teacher ratio by town<br/><strong class="ng iu"><em class="np">black:</em></strong> 1000(B — 0.63)² where B is the proportion of blacks by town<br/><strong class="ng iu"><em class="np">lstat:</em></strong> percentage of the lower status of the population<br/><strong class="ng iu"><em class="np">medv:</em></strong> median value of owner-occupied homes in USD 1000's</span></pre><h1 id="f136" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">3.探索性分析</h1><p id="f77b" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">通过查看数据，人们很自然地会问这样一个问题:哪些因素可能会影响和预测房价。我从一些简单的散点图开始，直观地检查变量之间的关系(见下文)。下面的一组图表绘制了<em class="np"> medv </em>对<em class="np"> crim、rm、age、lstat </em>和<em class="np"> dis </em>的关系。这种关系似乎不是线性的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/8d18bf31350e1bdfece12102d8e8668c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GNtz3KtR5QgAuE6x8IhYFw.png"/></div></div></figure><p id="d9ae" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我还绘制直方图来检查单变量分布。我决定使用<em class="np"> log(medv) </em>而不是<em class="np"> medv </em>作为因变量，因为log变换减轻了偏斜。同样，我会用<em class="np"> log(crim) </em>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/4b0e55a65b3fb0ce547b16a95039fa20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YdlNfXkNBP7nTW6sjpnvcg.png"/></div></div></figure><h1 id="4020" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">4.运行线性回归</h1><p id="1927" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">即使我的直觉和探索性分析图告诉我，人口中较低地位的百分比、房间数量、犯罪率和到五个波士顿就业中心的距离可能是最重要的预测因素。在本文中，<strong class="la iu">我想从运行一个lass模型开始，以所有变量作为基线，也作为选择特性的一种方式</strong>。下面是R代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="d6d0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">lasso <em class="np"> reg_base </em>不返回任何零系数，但是我发现<em class="np"> log(cim) </em>和其他一些变量并不重要。我排除了<em class="np"> reg_1 </em>模型中那些无关紧要的变量，下面是系数:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/4a11945bf492a15774341bead66c3fa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-PBPWFO6CDM_x0i4t6Z1JA.png"/></div></div></figure><p id="e668" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">快速解释:中值房价每变化1个单位(1 %)下降3.3%，较低人口比例(lstat)增加，房间数量每变化1个单位房价增加10%。对我来说很有意义。</p><h1 id="0d4e" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">5.检验高斯-马尔可夫假设</h1><h2 id="7d82" class="nk lv it bd lw nu nv dn ma nw nx dp me lh ny nz mg ll oa ob mi lp oc od mk oe bi translated"><strong class="ak"> 1。使用残差图检查线性和同质性</strong></h2><ul class=""><li id="9180" class="mr ms it la b lb mm le mn lh of ll og lp oh lt oi mx my mz bi translated"><strong class="la iu">残差与拟合值:</strong>围绕水平线均匀分布的残差没有明显的模式，这很好地表明具有线性关系。如果残差图中有明确的趋势，或者该图看起来像一个漏斗，这些都是给定的线性模型不合适的明确指标。</li><li id="3f25" class="mr ms it la b lb na le nb lh nc ll nd lp ne lt oi mx my mz bi translated"><strong class="la iu">正态Q-Q </strong>显示残差是否正态分布。如果残差在直虚线上很好地排列，这是很好的。</li><li id="638b" class="mr ms it la b lb na le nb lh nc ll nd lp ne lt oi mx my mz bi translated"><strong class="la iu">刻度位置</strong>可用于检查等方差假设(同方差)。如果我们看到一条等(随机)分布点的水平线，这很好。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/7d69cc13e0af6bcac1d3e8b27f78bde6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f1pibupzeanhQrSDSRr0VQ.png"/></div></div></figure><p id="74dd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">残差与拟合图显示线性假设或多或少得到满足。对数变换处理非线性。然而，规模-位置图表明异方差。</p><h2 id="fba6" class="nk lv it bd lw nu nv dn ma nw nx dp me lh ny nz mg ll oa ob mi lp oc od mk oe bi translated"><strong class="ak"> 2。使用Breusch-Pagan测试进行同质性检验</strong></h2><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="55fc" class="nk lv it ng b gy nl nm l nn no">print(bptest(reg_1, data = Boston, studentize = TRUE))</span><span id="f9ae" class="nk lv it ng b gy oj nm l nn no">studentized Breusch-Pagan test<br/>data: reg_1<br/>BP = 64.991, df = 7, p-value = 1.51e-11</span></pre><p id="0857" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">拒绝Breusch-Pagan检验的同异方差的零假设表示异方差(HSK)。我们可以用加权最小二乘法(WLS)来校正HSK。因为HSK对OLS估计量的偏差或一致性没有影响，而且WLS的估计量与OLS的没有太大的不同。在这篇文章中，我将跳过对HSK的校正。</p><h2 id="f1f0" class="nk lv it bd lw nu nv dn ma nw nx dp me lh ny nz mg ll oa ob mi lp oc od mk oe bi translated"><strong class="ak"> 3。对多重共线性使用VIF检验</strong></h2><p id="aa38" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">VIF代表方差通货膨胀系数。一般的经验法则是，Vif超过4需要进一步调查，而Vif超过10是严重多重共线性的迹象，需要纠正。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="427f" class="nk lv it ng b gy nl nm l nn no">vif(reg_1)</span><span id="7146" class="nk lv it ng b gy oj nm l nn no">rm dis rad tax ptratio black lstat<br/>1.780895 1.559949 6.231127 6.610060 1.408964 1.314205 2.414288</span></pre><p id="152f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">VIF检验显示了rad和tax的共线性。来缓解这个问题。我做了一个新的回归去除了rad。系数变化不大。为了节省空间，我将不再展示它们。</p><h2 id="0993" class="nk lv it bd lw nu nv dn ma nw nx dp me lh ny nz mg ll oa ob mi lp oc od mk oe bi translated"><strong class="ak"> 4。检查零条件均值假设</strong></h2><p id="314a" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">没有简单的方法来检验这个假设。首先，检查残差的平均值是否为零是<strong class="la iu">而不是</strong>的方法。只要我们在关系式中包括截距，我们总是可以假设E ( ) = 0，因为的非零均值可以被截距项吸收。你可以在这里阅读数学证明<a class="ae ok" href="https://thestatsgeek.com/2020/03/23/the-mean-of-residuals-in-linear-regression-is-always-zero/" rel="noopener ugc nofollow" target="_blank"/>。检查它的一种方法是绘制残差与未分配因变量的行号的关系图。无论我们如何对行进行排序，残差都应该在行号上围绕零随机对称分布，这表明连续误差之间没有相关性。我还绘制了独立变量的残差图，以检查是否有明显的相关性。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/6e90f964338de37d8ded6b6fba8e73de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zRZCO4QAbmeZ1vF8zGksFQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">残差与独立变量</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/b412b61bd43077890ead2540e4e63ff6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vdJ0jaV_Squvegte9RNCeg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">残差与行数</p></figure><h2 id="72c7" class="nk lv it bd lw nu nv dn ma nw nx dp me lh ny nz mg ll oa ob mi lp oc od mk oe bi translated"><strong class="ak"> 5。检查遗漏的变量偏差</strong></h2><p id="dc23" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">最后，我认为经常思考和检查被忽略的变量偏差是一个好习惯。我想测试将犯罪率纳入回归的想法，因为我认为犯罪率会影响房价。我比较了在<em class="np"> reg_2 </em>模式中包含<em class="np"> crim </em>和在<em class="np"> reg_3 </em>模式中包含<em class="np"> log(crim) </em>的情况，使用了戴维森-麦金农检验。戴维森-麦金农测试的解释是拒绝<em class="np"> reg_3 </em>规格。</p><p id="58eb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">读取回归统计，包括<em class="np"> crim </em>如预期提高了R平方，并且<em class="np"> crim </em>系数显著。然而，鉴于<em class="np"> crim </em>的偏态分布以及<em class="np"> crim </em>和<em class="np"> log(medv) </em>之间看似非线性的关系，我并不完全确信使用<em class="np"> crim </em>作为预测指标之一是必要的。</p><p id="1d35" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了进一步检查，我决定将数据分为训练和测试数据，并运行一个简单的样本外测试，比较<em class="np"> reg_2 </em>和<em class="np"> reg_1 </em>。原来没有<em class="np"> crim </em>的原模型<em class="np"> reg_1 </em>在测试数据上返回较小的MSE。所以我认为可以有把握地断定<em class="np"> reg_1 </em>是正确的型号。</p><p id="6320" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是运行reg_base、reg_1、比较reg_2与reg_3以及随后比较reg_2与reg_1的完整代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure></div></div>    
</body>
</html>