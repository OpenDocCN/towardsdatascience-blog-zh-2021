<html>
<head>
<title>Random Effects in Linear Models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">线性模型中的随机效应</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/random-effects-in-linear-models-15845b2540ac?source=collection_archive---------8-----------------------#2021-08-26">https://towardsdatascience.com/random-effects-in-linear-models-15845b2540ac?source=collection_archive---------8-----------------------#2021-08-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="e384" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">线性模型的扩展</h2><div class=""/><div class=""><h2 id="12f4" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">R中关于在线性模型中使用随机效应的端到端分析示例。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/4501598df9e08165a04c2230483bc23a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_nxi0PEujhRSpzl1"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">蒂姆·莫斯霍尔德在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="3a01" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi me translated"><span class="l mf mg mh bm mi mj mk ml mm di"> T </span>简单的线性模型有一个重要的假设，即观测值的独立性。这一假设在大多数精心设计的实验中都成立，但在现实生活的数据集中却很少成立。</p><p id="766f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">将相关数据假设为独立数据的最大风险之一是，由于大量的“独立”观察值，您的线性模型将始终为您提供漂亮的p值。</p><p id="adad" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">观察值的“相关性”通常来自同一组内数据点的一些共享特征。例如，如果你对家庭收入如何影响孩子的考试成绩感兴趣，你需要考虑来自同一所学校或班级的学生的成绩比来自不同学校或班级的学生的成绩更相似。</p><p id="432e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这种情况下，使用随机效应是提高线性模型估计值的有效方法。一般来说，如果您在调查数据集中有一些与您要回答的问题不直接相关的分组结构，最好将它们作为随机效应包含在您的线性模型中。(注意，随机效果不能用于连续变量，最好超过5个级别。)</p><p id="0aaa" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本文中，我将通过一个小项目来展示如何在r的线性建模中使用随机效果。我将避免复杂的数学方程，并使想法和实现代码尽可能简单。希望你能从中学到一些东西！</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="0db6" class="mu mv it bd mw mx my dn mz na nb dp nc lr nd ne nf lv ng nh ni lz nj nk nl iz bi translated">这个问题</h2><p id="b77e" class="pw-post-body-paragraph li lj it lk b ll nm kd ln lo nn kg lq lr no lt lu lv np lx ly lz nq mb mc md im bi translated">我的项目问题是"<strong class="lk jd"> <em class="nr">投篮尝试次数如何影响投篮命中率？</em> </strong>”</p><p id="2e43" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">NBA比赛暂停期间，我们总能听到教练对着球员大喊，“<em class="nr">继续投篮！</em></p><p id="bdf5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">大多数NBA职业球员都相信，即使现在很冷，如果一个人坚持投篮，他最终会找到自己的节奏。实际上，潜在的假设是，投篮尝试次数的增加可以积极地影响投篮命中率(并最终增加投篮命中率)。</p><p id="5236" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一些球员甚至抱怨说，他们在投篮命中率方面表现不佳，只是因为他们不允许像超级明星在球场上那样投篮。</p><p id="7323" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这个小型项目的问题是用统计建模来解决上述现象。</p><h2 id="d6bf" class="mu mv it bd mw mx my dn mz na nb dp nc lr nd ne nf lv ng nh ni lz nj nk nl iz bi translated">数据集</h2><p id="a883" class="pw-post-body-paragraph li lj it lk b ll nm kd ln lo nn kg lq lr no lt lu lv np lx ly lz nq mb mc md im bi translated">数据集是2020–2021 NBA赛季NBA球员的场均数据，从网站<a class="ae lh" href="https://www.basketball-reference.com/leagues/NBA_2021_per_game.html" rel="noopener ugc nofollow" target="_blank"> basketball reference </a>下载。</p><p id="c5cf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">以下是R中用于数据清理的代码。</p><pre class="ks kt ku kv gt ns nt nu nv aw nw bi"><span id="e3eb" class="mu mv it nt b gy nx ny l nz oa">my_tab = read_excel("sportsref_download.xlsx")<br/>dup_players = my_tab[with(my_tab, Tm == "TOT"),]$Player<br/>my_tab_filtered = my_tab[with(my_tab,((Player %<strong class="nt jd">in</strong>% dup_players) &amp; Tm == "TOT")| !(Player %<strong class="nt jd">in</strong>% dup_players)),] %&gt;%<br/>  mutate(Pos = replace(Pos, Pos == "SG-PG", "SG"))%&gt;%<br/>  mutate(Pos = replace(Pos, Pos == "SF-SG", "SF"))%&gt;%<br/>  mutate(Pos = replace(Pos, Pos == "PF-SF", "PF"))%&gt;%<br/>  mutate(Pos = replace(Pos, Pos == "C-PF", "C"))%&gt;%<br/>  mutate(Pos = replace(Pos, Pos == "PG-SG", "PG"))%&gt;%<br/>  mutate(Pos = replace(Pos, Pos == "SG-SF", "SG"))%&gt;%<br/>  mutate(Pos = replace(Pos, Pos == "SF-PF", "SF"))%&gt;%<br/>  mutate(Pos = replace(Pos, Pos == "PF-C", "PF"))<br/>my_tab_filtered = my_tab_filtered[complete.cases(my_tab_filtered),]</span></pre><p id="1bf9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，我从数据中删除了赛季内球队之间交易的重复球员。然后，我修改了玩家的位置到他们的主要位置，如果他们可以打多个位置的话。最后，我从数据中删除了<em class="nr"> NA </em>值。</p><p id="ce6c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了检查球员名字在数据中是否唯一，我使用了下面的代码。</p><pre class="ks kt ku kv gt ns nt nu nv aw nw bi"><span id="48ee" class="mu mv it nt b gy nx ny l nz oa">length(unique(my_tab_filtered$Player)) == nrow(my_tab_filtered)</span></pre><p id="17a5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">它给了我“真”，这意味着球员是独一无二的。</p><p id="82d0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因为我试图评论投篮命中率对投篮命中率的影响，我在下面的散点图中绘制了它们之间的关系。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ob"><img src="../Images/fd4d1dcb3b6b4216547c9c507c4e1f4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ob4hmbsVi76zNL63JpN3A.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">散点图FG%与FGA(图片由作者提供)</p></figure><p id="61a7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">从图上看，投篮次数和投篮命中率之间似乎存在某种线性关系。接下来，我将使用统计方法来检查观察结果。</p><h2 id="5a29" class="mu mv it bd mw mx my dn mz na nb dp nc lr nd ne nf lv ng nh ni lz nj nk nl iz bi translated">建模</h2><p id="c140" class="pw-post-body-paragraph li lj it lk b ll nm kd ln lo nn kg lq lr no lt lu lv np lx ly lz nq mb mc md im bi translated">如果不考虑数据内部任何可能的分组结构，可以简单的对其应用线性回归模型，就是把所有东西都装进一个线性模型。</p><pre class="ks kt ku kv gt ns nt nu nv aw nw bi"><span id="a5e4" class="mu mv it nt b gy nx ny l nz oa">null.lm = lm(`FG%` ~ FGA, data = my_tab_filtered)<br/>summary(null.lm)</span></pre><p id="a97f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">它给了我们，</p><pre class="ks kt ku kv gt ns nt nu nv aw nw bi"><span id="6898" class="mu mv it nt b gy nx ny l nz oa">## <br/>## Call:<br/>## lm(formula = `FG%` ~ FGA, data = my_tab_filtered)<br/>## <br/>## Residuals:<br/>##      Min       1Q   Median       3Q      Max <br/>## -0.42711 -0.04531 -0.00926  0.03243  0.32324 <br/>## <br/>## Coefficients:<br/>##              Estimate Std. Error t value Pr(&gt;|t|)    <br/>## (Intercept) 0.4254855  0.0084259  50.497  &lt; 2e-16 ***<br/>## FGA         0.0032440  0.0009531   3.404 0.000741 ***<br/>## ---<br/>## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1<br/>## <br/>## Residual standard error: 0.08477 on 358 degrees of freedom<br/>## Multiple R-squared:  0.03134,    Adjusted R-squared:  0.02864 <br/>## F-statistic: 11.58 on 1 and 358 DF,  p-value: 0.0007406</span></pre><p id="36c5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">FGA的p值(投篮次数)看起来不错，不是吗？</p><p id="f089" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我也检查了残差，</p><pre class="ks kt ku kv gt ns nt nu nv aw nw bi"><span id="4d36" class="mu mv it nt b gy nx ny l nz oa">plot(null.lm, which = 1)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ob"><img src="../Images/05c108f4d5f58a264c2dab3a7a1605f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yhbY2WlWCycruT-EJABBgQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">零线性模型中的残差与拟合值(图片由作者提供)</p></figure><pre class="ks kt ku kv gt ns nt nu nv aw nw bi"><span id="a6be" class="mu mv it nt b gy nx ny l nz oa">plot(null.lm, which = 2)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ob"><img src="../Images/9a5d7995879b0ab1828624f0c9657c37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n1QqlvjVRJrGD-Zjf8CvPQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">零线性模型的Q-Q图(图片由作者提供)</p></figure><p id="f50f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这些诊断图确实显示了一些异常模式，但是大部分数据看起来是正常的。关于诊断线性模型的更多信息，请参见<a class="ae lh" rel="noopener" target="_blank" href="/diagnose-the-generalized-linear-models-66ad01128261">这篇文章</a>。</p><p id="ff74" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果我停在这里，我可以得出结论，投篮尝试确实对投篮命中率有显著的积极影响。但是，我在线性模型中假设了观测值之间的独立性，这是完全错误的。</p><p id="f1b5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们来看看球员在不同位置的FG%吧，</p><pre class="ks kt ku kv gt ns nt nu nv aw nw bi"><span id="ffc4" class="mu mv it nt b gy nx ny l nz oa">boxplot(`FG%` ~ Pos, data = my_tab_filtered, las=2,xlab = "")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ob"><img src="../Images/a0f721efee90306d761989b33b06a467.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LszslOYI4HcAIxgWXk5Akw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">五个位置的投篮命中率(图片由作者提供)</p></figure><p id="4fc2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以从箱线图中看到，不同的位置确实有不同水平的投篮命中率。例如，中锋比其他位置有更高的投篮命中率，这是有意义的，因为他们离篮筐更近。</p><p id="d13a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果我们再次用玩家的位置作为颜色绘制散点图，我们也可以看到分组(聚集)的模式，</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ob"><img src="../Images/d457af57d682455f931ba00978174ff3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2wRU8feU6W1i_ddDPrzIiQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">FG%对FGA进行颜色编码(图片由作者提供)</p></figure><p id="17cd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，我不能忽略“位置”变量，尽管这不是我对建模的兴趣。</p><p id="f7dc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这种情况下，有必要在线性模型中引入固定效应和随机效应的概念。简单来说，固定效应是我们试图从数据中估计的未知常数，而随机效应是我们试图估计(<em class="nr">farage，Julian J .，2016 </em>)分布参数的随机变量。</p><p id="c956" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于固定效应，我们的目标是在线性模型中估计它们的系数，以便评论与因变量的关系。但是，我们对随机效应变量中每个具体水平的效应不感兴趣，我们只想检验随机效应的变异是否大于零。</p><p id="6e80" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因为我感兴趣的是FGA对FG%的总体影响，而不是它在每个单独位置的表现，所以我在线性模型中使用位置作为随机影响，而不是固定影响。固定效果和随机效果之间更多的概念差异可以在<a class="ae lh" href="https://stats.stackexchange.com/questions/4700/what-is-the-difference-between-fixed-effect-random-effect-and-mixed-effect-mode" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="7524" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要在R中执行混合(固定效果+随机效果)线性模型，需要lme4包。</p><p id="21dc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，我扩展了前面的线性模型，把位置作为随机效应。</p><pre class="ks kt ku kv gt ns nt nu nv aw nw bi"><span id="9abe" class="mu mv it nt b gy nx ny l nz oa"><strong class="nt jd">library</strong>(lme4)<br/>mixed.lm = lmer(`FG%` ~ FGA + (1|Pos), data = my_tab_filtered)<br/>summary(mixed.lm)</span></pre><p id="7b65" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这给了我，</p><pre class="ks kt ku kv gt ns nt nu nv aw nw bi"><span id="7609" class="mu mv it nt b gy nx ny l nz oa">## Linear mixed model fit by REML ['lmerMod']<br/>## Formula: `FG%` ~ FGA + (1 | Pos)<br/>##    Data: my_tab_filtered<br/>## <br/>## REML criterion at convergence: -859.3<br/>## <br/>## Scaled residuals: <br/>##     Min      1Q  Median      3Q     Max <br/>## -5.2524 -0.5565  0.0096  0.5838  3.5555 <br/>## <br/>## Random effects:<br/>##  Groups   Name        Variance Std.Dev.<br/>##  Pos      (Intercept) 0.003318 0.05760 <br/>##  Residual             0.004878 0.06984 <br/>## Number of obs: 360, groups:  Pos, 5<br/>## <br/>## Fixed effects:<br/>##              Estimate Std. Error t value<br/>## (Intercept) 0.4178439  0.0266955   15.65<br/>## FGA         0.0048149  0.0007998    6.02<br/>## <br/>## Correlation of Fixed Effects:<br/>##     (Intr)<br/>## FGA -0.223</span></pre><p id="3e60" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在上面的报告中，随机效应部分告诉我们在分组因素(这里是玩家的位置)和剩余方差中发现了多少方差。</p><p id="1ab8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">固定效应部分与简单线性模型报告非常相似，它显示了系数的估计值以及系数的标准误差。</p><p id="7951" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果我们首先看上面报告的随机效应部分，我们可以看到来自“Pos”的方差与来自“Residual”的方差非常相似。计算完比例后，</p><pre class="ks kt ku kv gt ns nt nu nv aw nw bi"><span id="48b2" class="mu mv it nt b gy nx ny l nz oa">0.003318/(0.003318 + 0.004878)</span></pre><p id="9201" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我得到40.4%的方差不能用固定效应来解释。这些结果再次证实了将“位置”作为随机效应包括在内的必要性。</p><p id="4d65" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果我们看看固定效应部分的FGA系数的估计值和标准差，我们可以看到标准差比估计值小得多，这表明FGA系数不为零。</p><p id="f61e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可能已经注意到，lme4包的混合线性模型的报告中没有“p值”。</p><p id="2392" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">“没有提供p值”是在线性模型中使用随机效应的一个主要缺点。实际上有很多方法来计算近似的p值，但是理论上没有一种方法是那么精确的，因为自由度的计算很复杂。这个特定主题的讨论可能会非常复杂和冗长，因此我们在这里不讨论细节。</p><p id="4c75" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">计算随机效应的p值的一个实用方法是在bootstrap中使用似然比检验统计。似然比检验的基本思想是通过包含不同数量的变量来比较两个模型对观察数据的似然性。如果可能性比率明显不同于1，那么包含额外变量是有用的。</p><p id="eff7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">检验似然比是否显著不同于1与检验对数似然比之间的差是否不为零是一样的。</p><p id="c4be" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">测试统计量可以计算如下:</p><pre class="ks kt ku kv gt ns nt nu nv aw nw bi"><span id="e031" class="mu mv it nt b gy nx ny l nz oa">my_stat = 2*(logLik(mixed.lm) - logLik(null.lm,REML = TRUE))</span></pre><p id="4305" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，我们创建一个bootstrap方法来模拟零假设(简单线性模型)下的数据，然后生成大量的似然比检验统计量。</p><pre class="ks kt ku kv gt ns nt nu nv aw nw bi"><span id="6f00" class="mu mv it nt b gy nx ny l nz oa">LRT_stat = numeric(1000)<br/><strong class="nt jd">for</strong>(i <strong class="nt jd">in</strong> 1:1000){<br/>  y = simulate(null.lm)$sim_1<br/>  null_md = lm(y ~ FGA, data = my_tab_filtered)<br/>  mixed_md = lmer(y ~ FGA + (1|Pos), data = my_tab_filtered)<br/>  LRT_stat[i] = as.numeric(2*(logLik(mixed_md) - logLik(null_md,REML = TRUE)))<br/>}</span></pre><p id="b481" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，我们测试有多少模拟案例超出了我们数据中观察到的统计数据，</p><pre class="ks kt ku kv gt ns nt nu nv aw nw bi"><span id="3be6" class="mu mv it nt b gy nx ny l nz oa">sum(LRT_stat &gt; my_stat)</span></pre><p id="56ed" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我们的例子中，这个数字接近于零，这表明了随机效应的重要性。</p><p id="6ce2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">同样的似然比检验可以用来检验线性模型中的固定效应。我不会在本文中重复这个过程，因为它与随机效应的测试非常相似。唯一的区别是，在计算固定效应不同的两个模型之间的似然比统计时，将REML设置为FALSE。代码如下:</p><pre class="ks kt ku kv gt ns nt nu nv aw nw bi"><span id="2d60" class="mu mv it nt b gy nx ny l nz oa">my_stat = 2*(logLik(mixed.lm) - logLik(null.lm,REML = FALSE))<br/>LRT_stat = numeric(1000)<br/><strong class="nt jd">for</strong>(i <strong class="nt jd">in</strong> 1:1000){<br/>  y = simulate(null.lm)$sim_1<br/>  null_md = lmer(y ~ 1 + (1|Pos), data = my_tab_filtered, method = "ML")<br/>  mixed_md = lmer(y ~ FGA + (1|Pos), data = my_tab_filtered, method = "ML")<br/>  LRT_stat[i] = as.numeric(2*(logLik(mixed_md) - logLik(null_md,REML = FALSE)))<br/>}<br/>sum(LRT_stat &gt; my_stat)</span></pre><p id="9670" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">总之，我们发现，在考虑了球员位置的随机效应后，投篮尝试显著影响了球员的投篮命中率。</p><h2 id="c86a" class="mu mv it bd mw mx my dn mz na nb dp nc lr nd ne nf lv ng nh ni lz nj nk nl iz bi translated">讨论</h2><p id="0612" class="pw-post-body-paragraph li lj it lk b ll nm kd ln lo nn kg lq lr no lt lu lv np lx ly lz nq mb mc md im bi translated">现实生活中的问题可能比我上面提到的更复杂。例如，如果你的随机效果中有不止一个分组因子，你需要考虑随机效果的类型。随机效应主要有两种类型，交叉效应和嵌套效应。如果受试者在随机效应的一个水平上没有出现在任何其他水平上，那么它就是嵌套效应，否则，它就是交叉效应。</p><p id="ec8c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，在前面提到的关于家庭收入和学生成绩之间关系的问题中，你把学校和班级都作为随机效应。学校和班级变量是嵌套效果，因为一个班级只能属于一个特定的学校。这种情况下的sudo代码可以是:</p><pre class="ks kt ku kv gt ns nt nu nv aw nw bi"><span id="9169" class="mu mv it nt b gy nx ny l nz oa">nested_mod = <!-- -->lmer(grades ~ income + (1|school) + (1|school:class), data = school_grades)</span></pre><p id="9eea" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">或者，</p><pre class="ks kt ku kv gt ns nt nu nv aw nw bi"><span id="1a6b" class="mu mv it nt b gy nx ny l nz oa">nested_mod = <!-- -->lmer(grades ~ income + (1|school/class), data = school_grades)</span></pre><p id="76ca" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">再举一个例子，如果你试图在大范围的山区测量鸟类的体型和体重之间的关系，你可能需要考虑两个随机影响，季节和山区位置。</p><p id="34a5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">捕捉鸟类的季节和地点都会影响鸟类的体型和体重之间的关系。因为每座山都有四个季节，这两个随机效应是交叉效应。sudo代码就像是，</p><pre class="ks kt ku kv gt ns nt nu nv aw nw bi"><span id="2a92" class="mu mv it nt b gy nx ny l nz oa">crossed_mod = <!-- -->lmer(grades ~ income + (1|season) + (1|mountain_id), data = birds_data)</span></pre><p id="0035" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">线性模型中随机效应的上述用法已经涵盖了大多数可能的情况。希望这些对你有帮助。</p><p id="534d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你对什么时候使用随机效果感到困惑，关于这一点有很多争论和标准。有兴趣可以在这里 阅读更多<a class="ae lh" href="https://dynamicecology.wordpress.com/2015/11/04/is-it-a-fixed-or-random-effect/" rel="noopener ugc nofollow" target="_blank"> <em class="nr">。然而，我的建议是，只要你注意到数据集中任何分组因素的影响，就继续随机影响，这也是<em class="nr"> Gelman，Andrew (2005)所推荐的。</em></em></a></p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="32d2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">干杯！</strong></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oc"><img src="../Images/e5434fa961413a69eb93e306096d47b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XDJIA12O46HIJ-SV"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@kazuend?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> kazuend </a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h2 id="ca5a" class="mu mv it bd mw mx my dn mz na nb dp nc lr nd ne nf lv ng nh ni lz nj nk nl iz bi translated">参考</h2><div class="od oe gp gr of og"><a href="https://dynamicecology.wordpress.com/2015/11/04/is-it-a-fixed-or-random-effect/" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd jd gy z fp ol fr fs om fu fw jc bi translated">是固定效应还是随机效应？</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">在教一个研究生统计学课程的时候，我最终成为了一名统计顾问。我最常被问到的一个问题是…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">dynamicecology.wordpress.com</p></div></div></div></a></div><div class="od oe gp gr of og"><a href="https://stats.stackexchange.com/questions/4700/what-is-the-difference-between-fixed-effect-random-effect-and-mixed-effect-mode" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd jd gy z fp ol fr fs om fu fw jc bi translated">固定效果、随机效果、混合效果模型有什么区别？</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">有一些关于这方面的好书，如盖尔曼和希尔。接下来的内容基本上是他们的总结…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">stats.stackexchange.com</p></div></div><div class="op l"><div class="oq l or os ot op ou lb og"/></div></div></a></div><p id="0897" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="nr">farage，Julian J .用R扩展线性模型:广义线性、混合效应和非参数回归模型。CRC出版社，2016 </em></p><p id="554f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">安德鲁·盖尔曼。"方差分析——为什么它比以往任何时候都重要."统计年鉴33.1(2005):1–53。</p></div></div>    
</body>
</html>