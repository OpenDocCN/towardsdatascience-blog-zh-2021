<html>
<head>
<title>Building a Portable Data Science Environment using Docker (2021)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Docker (2021)构建可移植的数据科学环境</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-portable-data-science-environment-using-docker-2021-6d533fe2b86a?source=collection_archive---------19-----------------------#2021-08-18">https://towardsdatascience.com/building-a-portable-data-science-environment-using-docker-2021-6d533fe2b86a?source=collection_archive---------19-----------------------#2021-08-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e47a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一个Docker驱动的虚拟环境，供初学者随时随地使用</h2></div></div><div class="ab cl kg kh hu ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="ij ik il im in"><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/113cc4b1e49eaf82157f3c5c514a9800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-3y_H3MPa2TxAKAhxlDVHA.jpeg"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">图1 —对接过程(原始)</p></figure><p id="bb5e" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在过去的一年中，我不得不三次更换我的工作笔记本电脑，并且在错误的地方设置新的开发机器总是一件痛苦的事情。</p><p id="9179" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">我最终决定尝试一下Docker，并发现它非常有用。</p><p id="2578" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">然而，学习Docker是一个挑战，因为不完整的资源分散在互联网上。我不想成为Docker大师，我只需要知道足够多的信息来避免依赖性问题，并根据我的需要构建+复制我的工作环境。</p><p id="45ba" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">我使用Docker作为数据科学和分析工作的首选环境。我很少被要求制作我的作品，但是，如果你需要的话，Docker (+ Compose)是一个很好的方法。</p></div><div class="ab cl kg kh hu ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="ij ik il im in"><h1 id="f19d" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">目录(单击导航)</h1><p id="df3c" class="pw-post-body-paragraph ld le iq lf b lg mr jr li lj ms ju ll lm mt lo lp lq mu ls lt lu mv lw lx ly ij bi translated"><a class="ae mw" href="#02f6" rel="noopener ugc nofollow"> <strong class="lf ir">目标</strong> </a> <strong class="lf ir"> <br/> </strong> <a class="ae mw" href="#d3c8" rel="noopener ugc nofollow"> <strong class="lf ir">计划</strong> </a> <br/> 1/ Docker先决条件<br/> 2/项目需求<br/> <a class="ae mw" href="#b9df" rel="noopener ugc nofollow"> <strong class="lf ir">构建</strong> </a> <br/> 3/编写Dockerfile <br/> 4/从Dockerfile构建映像<br/> 5/从映像创建容器<br/> 6/在存储(卷)上<br/> <a class="ae mw" href="#385b" rel="noopener ugc nofollow"> <strong class="lf ir">使用</strong></a></p></div><div class="ab cl kg kh hu ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="ij ik il im in"><h1 id="02f6" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">&gt; &gt;目标</h1><p id="24ad" class="pw-post-body-paragraph ld le iq lf b lg mr jr li lj ms ju ll lm mt lo lp lq mu ls lt lu mv lw lx ly ij bi translated">在本演练结束时，您应该拥有一个设备齐全的数据科学/分析环境，它:</p><ul class=""><li id="e1c3" class="mx my iq lf b lg lh lj lk lm mz lq na lu nb ly nc nd ne nf bi translated"><strong class="lf ir">可移植的</strong>——通过简单的拉取请求(类似Git)可在任何机器上访问</li><li id="cee2" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly nc nd ne nf bi translated"><strong class="lf ir">隔离/受控</strong> -安装的依赖关系被冻结，没有更新/升级问题</li><li id="c301" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly nc nd ne nf bi translated"><strong class="lf ir">可复制的</strong> -通过简单的“docker运行”创建一个副本(或更改它)命令</li><li id="d785" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly nc nd ne nf bi translated">类似协作的Git(超出范围)</li></ul><p id="138f" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">这样的环境适合于原型开发、EDA和探索库等等。</p><p id="77a5" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated"><strong class="lf ir">注意:如果你不熟悉Docker的基础知识，可以参考我个人用过的资源:</strong></p><div class="nl nm gp gr nn no"><a rel="noopener follow" target="_blank" href="/how-docker-can-help-you-become-a-more-effective-data-scientist-7fc048ef91d5"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">Docker如何帮助您成为更高效的数据科学家</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">作者:哈默尔·侯赛因</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">towardsdatascience.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc kx no"/></div></div></a></div><div class="nl nm gp gr nn no"><a rel="noopener follow" target="_blank" href="/docker-for-data-science-a-step-by-step-guide-1e5f7f3baf8e"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">数据科学Docker逐步指南</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">通过Docker创建一个在你的机器上运行的ML工作空间，里面有你需要的ML库，VSCode，Jupyter和…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">towardsdatascience.com</p></div></div><div class="nx l"><div class="od l nz oa ob nx oc kx no"/></div></div></a></div></div><div class="ab cl kg kh hu ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="ij ik il im in"><h1 id="d3c8" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">&gt; &gt;计划</h1><h1 id="0fe3" class="lz ma iq bd mb mc oe me mf mg of mi mj jw og jx ml jz oh ka mn kc oi kd mp mq bi translated">1/ Docker先决条件</h1><p id="681f" class="pw-post-body-paragraph ld le iq lf b lg mr jr li lj ms ju ll lm mt lo lp lq mu ls lt lu mv lw lx ly ij bi translated">要构建Docker容器，您的机器上需要Docker。</p><p id="f23d" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">前往Docker网站下载Docker。按照这里<a class="ae mw" href="https://docs.docker.com/docker-for-mac/install/" rel="noopener ugc nofollow" target="_blank">的步骤</a>在Mac、Linux或Windows上设置它。这是一个简单的GUI步骤序列，应该不会给你带来任何问题。</p><p id="5b87" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在<a class="ae mw" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank"> DockerHub </a>上注册，就能把你的图片推送到你的存储库。这将允许您在任何机器上下载映像，并准备好您的便携环境。</p><p id="f738" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">新，登录您的DockerHub帐户:</p><ul class=""><li id="a0af" class="mx my iq lf b lg lh lj lk lm mz lq na lu nb ly nc nd ne nf bi translated">启动您的终端并输入以下命令。出现提示时，输入密码。</li></ul><pre class="ko kp kq kr gt oj ok ol om aw on bi"><span id="c632" class="oo ma iq ok b gy op oq l or os">docker login -u [USERNAME] <br/># Dockerhub username</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi ot"><img src="../Images/85aec7bccd134fcd19e059f9501609f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vrJ5mCQWD20idkZ9YdCj7Q.png"/></div></div></figure><ul class=""><li id="3cf0" class="mx my iq lf b lg lh lj lk lm mz lq na lu nb ly nc nd ne nf bi translated">通过运行官方的hello-world示例来测试Docker设置。</li></ul><pre class="ko kp kq kr gt oj ok ol om aw on bi"><span id="5545" class="oo ma iq ok b gy op oq l or os">% docker pull hello-world .       # pull the example image</span><span id="352e" class="oo ma iq ok b gy ou oq l or os">% docker images -a               # list all available images</span><span id="307a" class="oo ma iq ok b gy ou oq l or os">% docker run hello-world        # create a container from the image</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi ov"><img src="../Images/58c6e88f14b7e9f6255c7c885542442b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QT6RUgr8x_I8iEwGrBtz3g.png"/></div></div></figure><p id="56a9" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">如果能看到“Docker的你好！”在您的终端上，您已经有了一个正确安装的Docker。如果不能，再尝试安装Docker。</p><h1 id="d256" class="lz ma iq bd mb mc oe me mf mg of mi mj jw og jx ml jz oh ka mn kc oi kd mp mq bi translated">2/项目要求</h1><h1 id="c6c5" class="lz ma iq bd mb mc oe me mf mg of mi mj jw og jx ml jz oh ka mn kc oi kd mp mq bi translated">我们在建造什么？</h1><ol class=""><li id="d2aa" class="mx my iq lf b lg mr lj ms lm ow lq ox lu oy ly oz nd ne nf bi translated"><strong class="lf ir">一个Python环境</strong></li><li id="a66f" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly oz nd ne nf bi translated"><strong class="lf ir">常用软件包</strong> — Pandas、PySpark、TensorFlow、Plotly、Matplotlib、NumPy</li><li id="d371" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly oz nd ne nf bi translated"><strong class="lf ir">冻结</strong>包—避免依赖性问题</li><li id="8341" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly oz nd ne nf bi translated"><strong class="lf ir"> Jupyter笔记本</strong> —通过浏览器提供的首选IDE</li><li id="e5a3" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly oz nd ne nf bi translated"><strong class="lf ir">存储</strong> —虚拟存储应该是持久的，并且必须与我的本地存储绑定(以便于轻松添加新文件和数据库)</li></ol><h1 id="53a9" class="lz ma iq bd mb mc oe me mf mg of mi mj jw og jx ml jz oh ka mn kc oi kd mp mq bi translated">码头工作流程</h1><p id="eace" class="pw-post-body-paragraph ld le iq lf b lg mr jr li lj ms ju ll lm mt lo lp lq mu ls lt lu mv lw lx ly ij bi translated">Docker的工作原理，简而言之:</p><ol class=""><li id="148c" class="mx my iq lf b lg lh lj lk lm mz lq na lu nb ly oz nd ne nf bi translated"><strong class="lf ir">docker file</strong>——你为你想要的那种环境(容器)创建蓝图。</li><li id="dd87" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly oz nd ne nf bi translated"><strong class="lf ir">图像</strong>——你从Dockerfile文件中构建一个图像。</li><li id="8610" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly oz nd ne nf bi translated">容器 -你从图片中创建一个容器。你所有的工作都会在这里完成。您可以根据需要启动和停止这个“虚拟机”。</li><li id="002d" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly oz nd ne nf bi translated"><strong class="lf ir">上传(和下载)到云</strong>——把它推送到DockerHub，这样你就可以在任何地方下载和使用它。</li></ol><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/113cc4b1e49eaf82157f3c5c514a9800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-3y_H3MPa2TxAKAhxlDVHA.jpeg"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">集装箱化的过程</p></figure><h1 id="c971" class="lz ma iq bd mb mc oe me mf mg of mi mj jw og jx ml jz oh ka mn kc oi kd mp mq bi translated">项目结构</h1><ol class=""><li id="58b2" class="mx my iq lf b lg mr lj ms lm ow lq ox lu oy ly oz nd ne nf bi translated">我将创建一个名为“analytics_env”的任意文件/项目结构。</li><li id="b661" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly oz nd ne nf bi translated">添加一个“数据”文件夹。您可以将数据添加到系统上的这个文件夹中，并在您的容器中访问它，反之亦然。</li><li id="e35e" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly oz nd ne nf bi translated">将创建一个没有扩展名的“Dockerfile”。我们将在这里书写我们的虚拟环境蓝图。</li><li id="3776" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly oz nd ne nf bi translated">存储任何上下文信息的“readme.txt”。</li></ol><p id="2fc6" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">注意:不要浪费时间在本地系统上寻找Docker映像和容器。Docker的UI仪表板(在步骤1中安装)在访问和管理它方面更加方便。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi pa"><img src="../Images/655ecd1bfd6bacc08b92aa5600702ce5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7pi8VL-BH_xkNB0aqlVqRQ.png"/></div></div><p class="kz la gj gh gi lb lc bd b be z dk translated">项目文件夹结构</p></figure><p id="d41b" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">您可以手动创建它，或者使用您的终端/IDE来创建它。</p></div><div class="ab cl kg kh hu ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="ij ik il im in"><h1 id="b9df" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">&gt; &gt;构建</h1><h1 id="23ab" class="lz ma iq bd mb mc oe me mf mg of mi mj jw og jx ml jz oh ka mn kc oi kd mp mq bi translated">3/编写Dockerfile文件</h1><p id="bf41" class="pw-post-body-paragraph ld le iq lf b lg mr jr li lj ms ju ll lm mt lo lp lq mu ls lt lu mv lw lx ly ij bi translated">一旦创建了项目结构“analytics_env ”,就可以打开IDE并导航到它的目录。接下来，我们可以打开“Dockerfile”并定义虚拟环境的蓝图。</p><pre class="ko kp kq kr gt oj ok ol om aw on bi"><span id="ff9c" class="oo ma iq ok b gy op oq l or os">FROM python </span><span id="71c2" class="oo ma iq ok b gy ou oq l or os">LABEL maintainer="jaethalal" <br/>LABEL version="1.0" <br/>LABEL description="docker image for data science development env"  </span><span id="9395" class="oo ma iq ok b gy ou oq l or os">RUN pip install jupyter numpy pandas matplotlib plotly dash  </span><span id="7cc3" class="oo ma iq ok b gy ou oq l or os">EXPOSE 8888  <br/>CMD [ "jupyter", "notebook", "--ip=0.0.0.0", "--port=8888", "--no-browser", "--allow-root" ]</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi pb"><img src="../Images/28dfc0d6246dc277bcb06ccac4a2c0dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1-P2RUCvXTD26r-PVEH6EQ.png"/></div></div></figure><p id="9ee4" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">让我们将docker文件分解成它的组件:</p><ol class=""><li id="daf7" class="mx my iq lf b lg lh lj lk lm mz lq na lu nb ly oz nd ne nf bi translated"><strong class="lf ir"> FROM python- </strong> Dockerhub有一个准备好的带有基本环境的映像的注册表(比如我们的例子中的‘OS+Python’)。映像是分层构建的，基础层是一个操作系统发行版。您可以使用这些图像，并通过添加更多组件来修改它们。在这一步中，我们采用了基本的Python图像。</li><li id="54ad" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly oz nd ne nf bi translated"><strong class="lf ir">标签维护者，版本，描述- </strong>添加标签进行识别。这是一个可选但强烈推荐的步骤。</li><li id="9e75" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly oz nd ne nf bi translated"><strong class="lf ir">运行pip inst…- </strong>一旦基本python映像被检索到，您运行一个pip命令在它上面安装所有的包。这个pip命令被附加到运行指令上。“运行”在映像构建时执行。因此，每当从这个Dockerfile文件构建映像时，所有列出的包都将被安装到Python env。</li><li id="1e3d" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly oz nd ne nf bi translated"><strong class="lf ir"> EXPOSE 8888- </strong>因为Jupyter笔记本是通过浏览器访问的，所以你需要从你的容器向外界，也就是主机，公开一个端口(比如8888)。</li><li id="2297" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly oz nd ne nf bi translated"><strong class="lf ir">CMD[“jupyter”..- </strong>如果在运行容器时没有指定命令，默认情况下会执行CMD命令。如果你这样做，CMD将失去优先权。因此，CMD是设置默认指令的好方法。<br/>在这里，我们在localhost:8888上默认启动和服务Jupyter笔记本，只要容器运行。</li></ol><p id="8047" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">我们完了！继续保存Dockerfile文件。</p><p id="eb69" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">蓝图已经准备好了，现在唯一剩下要做的就是“造”。</p><h1 id="898e" class="lz ma iq bd mb mc oe me mf mg of mi mj jw og jx ml jz oh ka mn kc oi kd mp mq bi translated">4/从Dockerfile文件构建映像</h1><p id="1a65" class="pw-post-body-paragraph ld le iq lf b lg mr jr li lj ms ju ll lm mt lo lp lq mu ls lt lu mv lw lx ly ij bi translated">我们将使用以下命令从Dockerfile文件构建一个映像:</p><pre class="ko kp kq kr gt oj ok ol om aw on bi"><span id="ab98" class="oo ma iq ok b gy op oq l or os">% docker build -t prototype_env_image .    </span><span id="ed6e" class="oo ma iq ok b gy ou oq l or os"># 'prototype_envm_image' is the name I've given to the image.                       # You can give it any name                      <br/># Do not miss the period(.) at the end of the command, it specifies the directory where your dockerfile is located</span></pre><p id="8e3f" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">当您运行该命令时，需要一分钟时间。python映像将被下载，docker文件中列出的包将被安装在它上面。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi pa"><img src="../Images/f9021f010b7ee2855fe5b14d6037b4fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wUecTr6Hp1uURE1JDz_rgg.png"/></div></div></figure><p id="9b21" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">让我们看看该命令的各个组成部分:</p><p id="3655" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated"><strong class="lf ir"> docker- </strong>所有docker命令前面都有关键字“docker”<br/><strong class="lf ir">build-</strong>表示您正在从docker文件<br/><strong class="lf ir">prototype _ env _ image-</strong>中构建一个图像；用户自定义<br/> <strong class="lf ir">。- </strong>表示您正在从当前目录中的Dockerfile文件构建一个映像</p><p id="8c48" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">要查看所有已构建图像的列表，您可以:</p><pre class="ko kp kq kr gt oj ok ol om aw on bi"><span id="6699" class="oo ma iq ok b gy op oq l or os">docker images -a                  # list all available docker images</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi pc"><img src="../Images/78253687f609a8993506dd5de16cf47b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*94zEMzQeMaL9Z0G0tj59Qw.png"/></div></div></figure><p id="4a74" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">这是我手头所有Docker图片的列表。您可以在列表顶部找到我们的“analytics_env_image”。</p><p id="83b1" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">现在让我们进入最后一步。我们将从刚刚构建的Docker映像“analytics_env_image”中旋转出一个容器。</p><h1 id="a77d" class="lz ma iq bd mb mc oe me mf mg of mi mj jw og jx ml jz oh ka mn kc oi kd mp mq bi translated">5/从图像创建容器</h1><p id="2fc3" class="pw-post-body-paragraph ld le iq lf b lg mr jr li lj ms ju ll lm mt lo lp lq mu ls lt lu mv lw lx ly ij bi translated">我们将把我们的容器命名为“analytics_env_c1”。</p><p id="e896" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">要从图像创建容器，请使用:</p><pre class="ko kp kq kr gt oj ok ol om aw on bi"><span id="0c40" class="oo ma iq ok b gy op oq l or os">docker run \<br/>--name analytics_env_c1 \<br/>-v /Users/apple/analytics_env:/analytics_env \<br/>-w /analytics_env \<br/>-p 8888:8888 \<br/>analytics_env_image</span></pre><p id="d99a" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">这是一个单独的命令，为了清楚起见，使用了“\”操作符将其分成多行。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi pd"><img src="../Images/a9b22cfc7374599d869c0813e6a2db12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TsGq6PY12ZvRb24eb1rGiA.png"/></div></div></figure><p id="2e01" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">当您运行该命令时，您会看到类似这样的内容。底部的URL表示您的容器已经创建并且正在运行。您也可以在命令中用“create”替换“run ”,它只会创建一个容器，而不会运行它。然后您可以使用“docker start”在以后运行它。</p><p id="809a" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated"><strong class="lf ir">有效，运行=创建+启动</strong></p><p id="e3c9" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">您只需在默认浏览器中“按住ctrl键并单击”最后一个链接，就可以重定向到Jupyter笔记本，也可以复制并粘贴它。</p><p id="9783" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">但是首先，让我们一步一步地构建这个命令的最后一个庞然大物:</p><pre class="ko kp kq kr gt oj ok ol om aw on bi"><span id="2d86" class="oo ma iq ok b gy op oq l or os"># create a container from the image "analytics_env_image" <br/><strong class="ok ir">docker run analytics_env_image   </strong></span><span id="20d7" class="oo ma iq ok b gy ou oq l or os"># use --name to give the container a name= "analytics_env_c1" <br/><strong class="ok ir">docker run \<br/>--name analytics_env_c1 \<br/>analytics_env_image</strong>   </span><span id="9753" class="oo ma iq ok b gy ou oq l or os"># use -v to bind your local directory "/Users/apple/analytics_env" with a directory inside the container "/analytics_env" <br/><strong class="ok ir">docker run \</strong><br/><strong class="ok ir">--name analytics_env_c1 \<br/>-v /Users/apple/analytics_env:/analytics_env \<br/>analytics_env_image </strong> </span><span id="4759" class="oo ma iq ok b gy ou oq l or os"># use -w to set the "/analytics_env" inside the container as the working directory <br/><strong class="ok ir">docker run \<br/>--name analytics_env_c1 \<br/>-v /Users/apple/analytics_env:/analytics_env \<br/>-w /analytics_env \<br/>analytics_env_image </strong> </span><span id="2e38" class="oo ma iq ok b gy ou oq l or os"># use -p to assign the local machine port 8888 (unassigned; user-defined) to the container port 8888 (assigned to Jupyter Notebook) <strong class="ok ir">docker run \</strong><br/><strong class="ok ir">--name analytics_env_c1 \<br/>-v /Users/apple/analytics_env:/analytics_env \<br/>-w /analytics_env \<br/>-p 8888:8888 \<br/>analytics_env_image</strong></span></pre><p id="3db2" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">注意:每当需要使用冒号(:)操作符时，请记住它会将'<strong class="lf ir"> left:right </strong>映射为'<strong class="lf ir"> host_machine:docker' </strong>。</p><h1 id="525e" class="lz ma iq bd mb mc oe me mf mg of mi mj jw og jx ml jz oh ka mn kc oi kd mp mq bi translated">6/侧栏:存储上</h1><p id="e29c" class="pw-post-body-paragraph ld le iq lf b lg mr jr li lj ms ju ll lm mt lo lp lq mu ls lt lu mv lw lx ly ij bi translated">我们有两种存储选项—卷和绑定装载。卷由Docker隐式管理，与主机的物理存储无关。绑定装载使共享存储成为可能。它使docker使用指定的目录作为其主要存储。</p><p id="f75e" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">正如我们在需求部分讨论的那样，我们的存储需要:</p><ol class=""><li id="247d" class="mx my iq lf b lg lh lj lk lm mz lq na lu nb ly oz nd ne nf bi translated"><strong class="lf ir">持久</strong> —当容器关闭时，数据不会消失</li><li id="77d9" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly oz nd ne nf bi translated"><strong class="lf ir">绑定</strong> —添加到主机存储的文件应该反映在容器内部，写入容器存储的数据应该可以被本地主机访问</li></ol><p id="1dfa" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">绑定安装是提供给我们2。这就是我们在“docker run …”命令中使用“-v”(—volume)标记来装载主机存储并将其与“analytics_env_c1”的存储绑定的原因。</p></div><div class="ab cl kg kh hu ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="ij ik il im in"><h1 id="385b" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">&gt; &gt;使用</h1><h1 id="984d" class="lz ma iq bd mb mc oe me mf mg of mi mj jw og jx ml jz oh ka mn kc oi kd mp mq bi translated">7/从容器运行Jupyter笔记本</h1><p id="496a" class="pw-post-body-paragraph ld le iq lf b lg mr jr li lj ms ju ll lm mt lo lp lq mu ls lt lu mv lw lx ly ij bi translated">当你点击链接或访问“localhost:8888”时，你会发现你的Jupyter笔记本正在运行。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi pe"><img src="../Images/f3e633c69890a669adb8e2a4b9338e8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2fAFIQIl0gMfvjSV9Q8yGA.png"/></div></div></figure><p id="16a3" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">然而，有一个复杂的问题。下次您尝试运行容器并访问此Jupyter笔记本时，您将无法登录，除非您使用以下任一方法为笔记本设置密码:</p><ol class=""><li id="c297" class="mx my iq lf b lg lh lj lk lm mz lq na lu nb ly oz nd ne nf bi translated">Jupyter配置文件</li><li id="cac2" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly oz nd ne nf bi translated">一次性密码设置</li></ol><p id="9aa3" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">我们将采用第二种更简单的解决方案——“一次性密码设置”。遵循以下步骤:</p><ol class=""><li id="f6ed" class="mx my iq lf b lg lh lj lk lm mz lq na lu nb ly oz nd ne nf bi translated">在Jupyter笔记本的右上角，点击“注销”</li><li id="21f5" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly oz nd ne nf bi translated">在下一页，点击“登录页面”</li><li id="3012" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly oz nd ne nf bi translated">这里，你会看到这一页</li></ol><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi pf"><img src="../Images/05ca0457f6a025f5e095e4d3b244b2b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pp_Sd5ZuWuYk6KlMySQqRQ.png"/></div></div></figure><ul class=""><li id="6e85" class="mx my iq lf b lg lh lj lk lm mz lq na lu nb ly nc nd ne nf bi translated">回到您的终端/IDE，从Jupyter笔记本重定向链接复制令牌</li></ul><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi pg"><img src="../Images/8193d89676568d4741cce9041be2059f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-1hOoxwnA2LadtRKoGaCyQ.png"/></div></div></figure><ul class=""><li id="7b3e" class="mx my iq lf b lg lh lj lk lm mz lq na lu nb ly nc nd ne nf bi translated">粘贴令牌并输入您喜欢的任何密码。我先说“赛克”。</li></ul><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi ph"><img src="../Images/844ece6d2aa3fb54c404f2a601d4e324.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PdJjNLrXMWFNUXhgQbu67A.png"/></div></div></figure><ul class=""><li id="3deb" class="mx my iq lf b lg lh lj lk lm mz lq na lu nb ly nc nd ne nf bi translated">点击“登录并设置新密码”。您将登录。下次运行该容器并访问该笔记本时，屏幕顶部会要求您输入密码(检查步骤3中的图像)。</li><li id="e53f" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly nc nd ne nf bi translated">继续创建一个随机数据帧，并将其作为CSV导出到“/data”文件夹中，以测试您的存储设置。</li></ul><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi pi"><img src="../Images/30459785bec330ceb05ad0e4ec91eeda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Bg99cXx33ABu0Fyc4CKGg.png"/></div></div></figure><ul class=""><li id="6d34" class="mx my iq lf b lg lh lj lk lm mz lq na lu nb ly nc nd ne nf bi translated">即使您是在容器中完成的，您也可以在本地系统中看到它。</li></ul><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi pj"><img src="../Images/fc2261c463ecbbaa671ff23131685082.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OJ2HwuG-N2kT6nNo-XDLrg.png"/></div></div></figure><h1 id="c5c4" class="lz ma iq bd mb mc oe me mf mg of mi mj jw og jx ml jz oh ka mn kc oi kd mp mq bi translated">8/在Docker中移动</h1><ul class=""><li id="9833" class="mx my iq lf b lg mr lj ms lm ow lq ox lu oy ly nc nd ne nf bi translated"><strong class="lf ir">停止运行容器</strong>:说你累了，今天的工作做完了。你想关掉这个容器然后去睡一觉。有两种方法可以做到:</li></ul><ol class=""><li id="d49e" class="mx my iq lf b lg lh lj lk lm mz lq na lu nb ly oz nd ne nf bi translated">只需回到终端/IDE，然后按“ctrl+c”。</li><li id="6c24" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly oz nd ne nf bi translated">您可以打开一个新的终端并键入</li></ol><pre class="ko kp kq kr gt oj ok ol om aw on bi"><span id="61fc" class="oo ma iq ok b gy op oq l or os">docker stop analytics_env_c1</span></pre><ul class=""><li id="0327" class="mx my iq lf b lg lh lj lk lm mz lq na lu nb ly nc nd ne nf bi translated"><strong class="lf ir">(重新)启动一个容器</strong>:下次您决定参与这个项目时，打开您的终端并键入:</li></ul><pre class="ko kp kq kr gt oj ok ol om aw on bi"><span id="0a10" class="oo ma iq ok b gy op oq l or os">docker start analytics_env_c1 </span><span id="1a19" class="oo ma iq ok b gy ou oq l or os"># or </span><span id="770e" class="oo ma iq ok b gy ou oq l or os">docker restart analytics_env_c1<br/> <br/># These commands will not spit out the link for jupyter nb like the last time <br/># but you can still visit localhost:8888 and you'll find it running</span></pre><ul class=""><li id="1e81" class="mx my iq lf b lg lh lj lk lm mz lq na lu nb ly nc nd ne nf bi translated"><strong class="lf ir">列出所有的容器和图片</strong>:你可能会忘记你工作过的容器的名字。因此，您可以使用以下命令列出所有容器:</li></ul><pre class="ko kp kq kr gt oj ok ol om aw on bi"><span id="aef1" class="oo ma iq ok b gy op oq l or os"># list all containers<br/>docker ps -a</span><span id="3d59" class="oo ma iq ok b gy ou oq l or os"># list active containers<br/>docker ps</span><span id="dd63" class="oo ma iq ok b gy ou oq l or os"># list all images<br/>docker images -a</span></pre><ul class=""><li id="e7ba" class="mx my iq lf b lg lh lj lk lm mz lq na lu nb ly nc nd ne nf bi translated"><strong class="lf ir">删除容器和图像</strong>:您可能想要删除容器或图像。您可以使用:</li></ul><pre class="ko kp kq kr gt oj ok ol om aw on bi"><span id="398a" class="oo ma iq ok b gy op oq l or os"># delete all dangling containers (dangling - containers without a base image)<br/>docker container prune</span><span id="8237" class="oo ma iq ok b gy ou oq l or os"># delete all dangling images (dangling - no containers related to the image)<br/>docker image prune</span><span id="6dba" class="oo ma iq ok b gy ou oq l or os"># To avoid caching RUN command while installing packages in the Dockerfile<br/># Caches prevent docker from fetching updated packages<br/>RUN pip install pandas, numpy --no-cache</span><span id="d639" class="oo ma iq ok b gy ou oq l or os"># To avoid loading previous cache while building images<br/>docker build --no-cache -t helloapp:v2 .</span></pre><ul class=""><li id="8f0e" class="mx my iq lf b lg lh lj lk lm mz lq na lu nb ly nc nd ne nf bi translated">检查容器/图像:如果你觉得勇敢，你可以使用下面的命令来检查容器或图像。它将向您显示所有的配置细节和有问题的映像/容器的状态。</li></ul><pre class="ko kp kq kr gt oj ok ol om aw on bi"><span id="40d1" class="oo ma iq ok b gy op oq l or os"># inspect the image<br/>% docker inspect analytics_env_image</span><span id="b331" class="oo ma iq ok b gy ou oq l or os">#Inspect the container<br/>% docker inspect analytics_env_c1</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi pk"><img src="../Images/2c5e44239711ba7f946efd3f16728a18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TDvf749aTsXaJRubvzPMUw.png"/></div></div></figure><h1 id="0ebf" class="lz ma iq bd mb mc oe me mf mg of mi mj jw og jx ml jz oh ka mn kc oi kd mp mq bi translated">9/将Docker映像推送到云存储库— DockerHub</h1><p id="5263" class="pw-post-body-paragraph ld le iq lf b lg mr jr li lj ms ju ll lm mt lo lp lq mu ls lt lu mv lw lx ly ij bi translated">像GitHub一样，你可以在DockerHub上保存你的Docker图片，并在你需要的时候调用它。我们把“analytics_env_image”推送到DockerHub。</p><ul class=""><li id="4d2e" class="mx my iq lf b lg lh lj lk lm mz lq na lu nb ly nc nd ne nf bi translated">登录DockerHub</li><li id="dc67" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly nc nd ne nf bi translated">创建一个存储库“portable_analytics_env”</li><li id="0708" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly nc nd ne nf bi translated">打开你的终端</li><li id="d60b" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly nc nd ne nf bi translated">导航到项目根位置(docker文件所在的位置)</li><li id="4d27" class="mx my iq lf b lg ng lj nh lm ni lq nj lu nk ly nc nd ne nf bi translated">使用标记username/repo_name构建Dockerfile文件(再次是)</li></ul><pre class="ko kp kq kr gt oj ok ol om aw on bi"><span id="398d" class="oo ma iq ok b gy op oq l or os"># build the image with the tag 'username/repo_name'<br/>docker build -t jeathalal/portable_analytics_env .</span><span id="b6d1" class="oo ma iq ok b gy ou oq l or os"># push the image to dockerhub<br/>docker push jeathalal/portable_analytics_env</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi pg"><img src="../Images/70c055a411cde2caa18fcc2713814bbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B-HmRkxf93n-xLdeuS8Bnw.png"/></div></div></figure><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi pl"><img src="../Images/1254828ada5575ada02916d60601ca3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iWb8cAiuxdPpfjBlNtJXlg.png"/></div></div></figure><h1 id="d334" class="lz ma iq bd mb mc oe me mf mg of mi mj jw og jx ml jz oh ka mn kc oi kd mp mq bi translated">10/在新系统上使用Docker</h1><p id="25fa" class="pw-post-body-paragraph ld le iq lf b lg mr jr li lj ms ju ll lm mt lo lp lq mu ls lt lu mv lw lx ly ij bi translated">比方说，你的MacBook在一个晴朗的日子停止工作，你不得不买一台新的。理想情况下，您希望能够访问您在早期机器上拥有的相同环境。你花了几周时间配置和设计它。</p><p id="14f4" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">还好你推给了DockerHub。我们将从我的存储库中提取之前推送的图像。</p><p id="0f76" class="pw-post-body-paragraph ld le iq lf b lg lh jr li lj lk ju ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">安装Docker并登录到您的DockerHub帐户，如上面的<a class="ae mw" href="#0fe3" rel="noopener ugc nofollow">第1节</a>所示。就像我们在hello-world示例中所做的那样，简单地提取先前上传的文件。</p><pre class="ko kp kq kr gt oj ok ol om aw on bi"><span id="a04e" class="oo ma iq ok b gy op oq l or os">% docker pull jaethalal/ds_env</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi pm"><img src="../Images/d68761c8dadcc49e200d5a491dbab84f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3FgLBzwv5JrOrZxHPbVo3Q.png"/></div></div></figure></div><div class="ab cl kg kh hu ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="ij ik il im in"><h1 id="d59f" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated"><strong class="ak">大概就是这样！如果你愿意，请在评论中留下任何问题或反馈！</strong></h1></div></div>    
</body>
</html>