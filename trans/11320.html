<html>
<head>
<title>A powerful, easy, and enjoyable python profiler</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个强大、简单、有趣的 python 分析器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-powerful-easy-and-enjoyable-python-profiler-12b792bc91d6?source=collection_archive---------12-----------------------#2021-11-06">https://towardsdatascience.com/a-powerful-easy-and-enjoyable-python-profiler-12b792bc91d6?source=collection_archive---------12-----------------------#2021-11-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="03c1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用 VizTracer 和 Perfetto 轻松浏览代码执行时间表</h2></div><p id="1c77" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在为训练模型处理数据或试图提高推理速度时，我经常面临需要修复的缓慢代码。我尝试了大多数 python 分析器，我真的很喜欢<a class="ae lb" href="https://github.com/gaogaotiantian/viztracer" rel="noopener ugc nofollow" target="_blank"> VizTracer </a>，因为它非常容易使用，而且非常强大，因为你可以在代码执行时间线上放大和缩小。</p><p id="71de" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要使用它，您只需导入一个“追踪器”并使用启动、停止和保存方法，如下所示:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/45ed17eddb2dc12856bcbe9dc8a0eef8.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*JZZy2gPOewzHvp8s3w7KMw.png"/></div></figure><p id="3db7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它将保存一个包含代码执行时间线的 profile.json 文件。然后，您必须运行该命令(安装 viztracer 时会安装 vizviewer)</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/d6837c4e1a9c8f13baaaaf6572688a4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*SgfWgs-qMKu32py5cxE_1w.png"/></div></figure><p id="c15a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用 AWSD 键可以在代码执行时间线中进行缩放/导航，这非常简单快捷。你也可以用鼠标。下面的视频展示了如何浏览我们创建的 profile.json 的示例。它由<a class="ae lb" href="https://perfetto.dev/" rel="noopener ugc nofollow" target="_blank"> Perfetto </a>(由谷歌制造)提供支持，经过优化，甚至可以处理巨大的跟踪文件(多个 GB)。</p><p id="1974" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我用 W 放大，用 S 缩小，用 A/D 向左/右移动，你可以看到主函数(outer_function)在顶部，然后是它正下方的 inner_function，然后是 time.sleep 调用。通过点击这些矩形中的一个，你可以看到关于这个函数调用的更多细节(持续时间，开始/结束时间，等等。).</p><p id="8948" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过单击并按住，您可以选择代码执行时间线的一部分并获得摘要。你将得到最长的函数，它被调用了多少次，等等。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="ll lm l"/></div></figure><h1 id="0cd8" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">跟踪变量</h1><p id="8f63" class="pw-post-body-paragraph kf kg iq kh b ki mf jr kk kl mg ju kn ko mh kq kr ks mi ku kv kw mj ky kz la ij bi translated">您还可以使用 VizCounter 类跟踪变量(假设您正在调试)。例如，我们将投掷一枚硬币，并使用以下代码跟踪正面、反面的数量以及正面的比例:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/f752f5236e6462cc48f5d82d03d9d918.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MBIyJIsz5l4qX3TUhBFTOw.png"/></div></div></figure><p id="d211" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它通过“vizviewer profile2.json”命令生成:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mp"><img src="../Images/6108fba1dda883a47b1cb548ac8523da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JRkvrUlKrE60IzWN117DGA.png"/></div></div></figure><p id="40cb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我只展示了<a class="ae lb" href="https://github.com/gaogaotiantian/viztracer" rel="noopener ugc nofollow" target="_blank"> VizTracer </a>的一小部分特性。你可以跟踪变量，分析多重处理/多线程程序，函数的入口，等等。更多信息见<a class="ae lb" href="https://github.com/gaogaotiantian/viztracer" rel="noopener ugc nofollow" target="_blank"> VizTracer </a>。作者也在中等<a class="ae lb" href="https://gaogaotiantian.medium.com/" rel="noopener">https://gaogaotiantian.medium.com/</a></p></div></div>    
</body>
</html>