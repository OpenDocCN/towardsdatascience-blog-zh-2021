<html>
<head>
<title>IEEE-CIS Fraud Detection - Top 5% Solution</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">IEEE-CIS欺诈检测-排名前5%的解决方案</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/ieee-cis-fraud-detection-top-5-solution-5488fc66e95f?source=collection_archive---------10-----------------------#2021-04-06">https://towardsdatascience.com/ieee-cis-fraud-detection-top-5-solution-5488fc66e95f?source=collection_archive---------10-----------------------#2021-04-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="80ab" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Kaggle竞赛IEEE-CIS欺诈检测的前5%解决方案</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/769054bd1d80af74b23d7af5a4b4ba97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cH9PICLbjc63jcfn"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae kv" href="https://unsplash.com/@paxtechnology?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">标志拍摄</a></p></figure><p id="e0c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我知道您或您身边的任何人都是一些欺诈活动的受害者。我们无法直接控制人们通过欺诈活动轻松赚钱。在线交易是可能发生欺诈交易并导致金钱损失的领域之一。</p><p id="f0f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这场比赛中，我们将使用机器学习技术来检测在线欺诈交易。我们的目标是实施一个在Kaggle排行榜上排名前5%的解决方案，这并不是一件容易的事情。IEEE-CIS欺诈检测是由IEEE计算智能学会组织的Kaggle竞赛。Vesta Corporation是担保电子商务支付解决方案的先行者之一，它为本次比赛提供了数据集。</p><p id="d98d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇博客中，我将很好地概述我是如何达到前5%的结果的。我不会解释每一行代码。相反，我将给出我的解决方案的一个很好的概述。你可以随时在这里查阅我的<a class="ae kv" href="https://github.com/arunm8489/IEE-CIS-Fraud-detection" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">代号</strong> </a> <strong class="ky ir"> </strong>。</p><h1 id="967e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">关于数据集</h1><p id="0fee" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">数据被分成两个文件identity和transaction，这两个文件通过TransactionID连接，分别用于训练和测试。因此，我们有4个文件—训练事务、训练身份、测试事务和测试身份。需要注意的是，并非所有交易都有相应的身份信息。</p><p id="f981" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们熟悉一下目前的各种栏目:</p><p id="18dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">交易数据</strong></p><ul class=""><li id="b9a6" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated"><strong class="ky ir"> <em class="my">交易id: </em> </strong> <em class="my">与交易相关的Id</em></li><li id="d516" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated"><strong class="ky ir"><em class="my">TransactionDT:</em></strong><em class="my">给定参考日期时间的时间增量(不是实际时间戳)</em></li><li id="a321" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated"><strong class="ky ir"> <em class="my">交易金额:</em> </strong> <em class="my">以美元计的交易支付金额</em></li><li id="73a9" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated"><strong class="ky ir"><em class="my">product CD</em></strong><em class="my">【分类】:产品代码(每笔交易的产品)</em></li><li id="b38a" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated"><strong class="ky ir"><em class="my">card 1–6</em></strong><em class="my">【分类】:支付卡相关信息，如卡种、国家等</em></li><li id="a0b6" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated"><strong class="ky ir"> <em class="my"> addr1，addr2 </em> </strong> <em class="my">【分类】:地址信息</em></li><li id="b8fd" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated"><strong class="ky ir"> <em class="my"> dist1，dist2: </em> </strong> <em class="my">一些距离信息</em></li><li id="b0f6" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated"><strong class="ky ir"><em class="my">P _ email domain</em></strong><em class="my">【分类】:购买者的邮箱域。</em></li><li id="bad9" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated"><strong class="ky ir"><em class="my">R _ email domain</em></strong><em class="my">【分类】:收件人的邮件域。</em></li><li id="919a" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated"><strong class="ky ir"> <em class="my"> C1-C14: </em> </strong> <em class="my">计数，比如找到多少个地址与支付卡相关联等。实际意义被掩盖了。</em></li><li id="22dc" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated"><strong class="ky ir"><em class="my">-D15:时间差</em> </strong> <em class="my">，如前几笔交易之间的天数等。</em></li><li id="1923" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated"><strong class="ky ir"> <em class="my"> M1-M9 </em> </strong> <em class="my">【分类】:匹配，如名片上的姓名和地址等。</em></li><li id="08d9" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated"><strong class="ky ir"><em class="my">vxxxx:</em></strong><em class="my">Vesta设计了丰富的功能，包括排名、计数和其他实体关系。</em></li></ul><p id="d081" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">身份数据</strong></p><ul class=""><li id="dd70" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated"><strong class="ky ir"> <em class="my">交易id: </em> </strong> <em class="my">与交易相关的Id</em></li><li id="f818" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated"><strong class="ky ir"> <em class="my">设备类型</em> </strong> <em class="my">【分类】:用于交易的设备类型</em></li><li id="e594" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated"><strong class="ky ir"> <em class="my">设备信息</em> </strong> <em class="my">【分类】:关于所用设备的更多信息</em></li><li id="73bd" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated"><strong class="ky ir"><em class="my">id1–38</em></strong><em class="my">【分类+数字】:网络连接信息、浏览器信息等(id12–38为分类信息)</em></li></ul><p id="b246" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="my">注意:实际上我们无法获得关于列的确切信息。主要是因为我们在处理交易数据时的安全考虑。</em></p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="6b35" class="ls lt iq bd lu lv nl lx ly lz nm mb mc jw nn jx me jz no ka mg kc np kd mi mj bi translated">商业目标</h1><p id="8e6e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">发现欺诈交易的主要业务目标如下:</p><ol class=""><li id="f916" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr nq mv mw mx bi translated">如果发现欺诈交易，公司应立即封锁该卡。</li><li id="5460" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr nq mv mw mx bi translated">我们应该能够预测欺诈交易的概率</li><li id="6213" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr nq mv mw mx bi translated">我们不应将欺诈交易预测为非欺诈交易。反之亦然。所以应该注意精确度和召回率。</li></ol></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="01d1" class="ls lt iq bd lu lv nl lx ly lz nm mb mc jw nn jx me jz no ka mg kc np kd mi mj bi translated">我的方法</h1><ol class=""><li id="5a1f" class="mp mq iq ky b kz mk lc ml lf nr lj ns ln nt lr nq mv mw mx bi translated">对每一列进行探索性的数据分析，了解每个特性的影响。</li><li id="0cfd" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr nq mv mw mx bi translated">建立一个基线模型。</li><li id="4694" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr nq mv mw mx bi translated">创建新特征，并查看这些特征是否能提高模型的性能。如果是，保留这些功能，否则放弃这些功能。为此，我使用了正向特征选择。</li><li id="bc7c" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr nq mv mw mx bi translated">迭代地继续这个方法，直到我们得到一个好的分数。</li></ol></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="55f2" class="ls lt iq bd lu lv nl lx ly lz nm mb mc jw nn jx me jz no ka mg kc np kd mi mj bi translated">电子设计自动化(Electronic Design Automation)</h1><p id="1e42" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在这里解释每一个特性的分析并不理想。我将解释我的一些有趣的观察。您可以从我的存储库中找到其余的分析。</p><p id="a019" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们先加载数据</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="d082" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们加载保存的文件</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/78269a7fabd6c873fe7b9d409987dbf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:258/format:webp/1*AE9Qmg7ioXMOEVgfDqUIOA.png"/></div></figure><p id="d2bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们有形状的训练数据(590540，434)和形状的测试数据(590540，434)。让我们看看在训练和测试数据中丢失了多少值</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="91bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将看到90 %以上的值缺失的列。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/588c29c8d8b9b3ed60164deb38356277.png" data-original-src="https://miro.medium.com/v2/resize:fit:1094/format:webp/1*QSGinZU9a8zB7MC1GDK9Sg.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/63b4c33e12dcc4da2fcd79fe792867d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*Tz0w3WMUFt3TERVK-tBAsw.png"/></div></figure><p id="2c75" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到像id_21、id_22、id_23、id_24、id_25、id_26、id_27、id_01、id_07、id_08这样的列有超过99%的缺失值。我们最好放弃这些功能。</p><p id="f0a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">Is _诈骗(目标特征)</strong></p><p id="81ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我们需要预测的目标变量。让我们看看它是如何分布的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/bded80dbeee29f3fc11fa5b66db06145.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YzqkmLW_UaGr01Dues6YMQ.png"/></div></div></figure><p id="24ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">观察结果:</p><p id="16bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不出所料，我们可以看到这个阶层严重失衡。这里96.5%的交易不是欺诈，其余3.5%的交易是欺诈。我们将选择ROC曲线下面积(AUC)作为ML问题的度量。</p><blockquote class="oa ob oc"><p id="a75b" class="kw kx my ky b kz la jr lb lc ld ju le od lg lh li oe lk ll lm of lo lp lq lr ij bi translated"><em class="iq">为什么不平衡数据集的准确性不行？</em></p></blockquote><p id="adaa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">考虑这样一个场景，我们有一个不平衡的数据集。例如，考虑信用卡欺诈检测的情况，其中98%的点数为非欺诈(1)，其余2%的点数为欺诈(1)。在这种情况下，即使我们预测所有的点都是非欺诈的，我们也将获得98%的准确性。但实际上，情况并非如此。所以我们不能用准确性作为衡量标准。</p><blockquote class="oa ob oc"><p id="aa5c" class="kw kx my ky b kz la jr lb lc ld ju le od lg lh li oe lk ll lm of lo lp lq lr ij bi translated"><em class="iq">什么是AUC ROC？</em></p></blockquote><p id="fb8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">AUC是ROC曲线下的面积。它告诉我们这个模型在多大程度上能够区分不同的类。AUC越高，模型预测0为0和1为1的能力越强。用TPR对FPR绘制ROC曲线，其中TPR在y轴上，FPR在x轴上。</p><p id="3f52" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">经过分析，我发现的另一件事是，在大多数情况下，如果客户的一笔交易是欺诈，他/她之前的所有交易都会被标记为欺诈。但并不是所有的情况都是如此。这里面也有例外。这使得我们的预测更加困难。</p><p id="1333" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="my">注意:我可以通过创建自己的uid来识别客户。当我们继续进行的时候我会解释的。</em></p><p id="27e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">交易日期</strong></p><p id="3bfc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这表示与给定参考日期时间的时间差异。例如，86400可以是特定时间的86400秒，例如:从2010年2月12日12:05:09 pm开始。在这里，我们必须检查在训练中获得的数据，并且测试是随时间连续的。这对于训练测试分割是重要的。这意味着训练数据应该来自较早的时期，而测试数据应该来自较晚的时期。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/de99231e32656c9137efb60140ad17c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Btxwi3iaSFMnmlF8Jq0ZlA.png"/></div></div></figure><p id="71f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">观察结果:</p><ul class=""><li id="5cbf" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">两者之间略有差距，但除此之外，定型集来自早期，测试数据来自后期。这可能会影响列车验证，应使用分割或交叉验证技术。</li><li id="91fb" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated">另一个观察结果是，在某些日子里，事务的数量超过10000</li></ul><p id="0bbe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们看看一周中不同的日子以及不同时间的欺诈交易。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/8f9a28c1a198c5fae86e6e67db6c6c0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nWq3BxVMFzRo5nSZAynI6A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">欺诈交易vs天数</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/c2ec9c0484082dfc576bf882e29e19f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iy84f-7SbWKnf427UtLeRw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">欺诈交易vs小时</p></figure><p id="8132" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到，在第3天，欺诈性交易非常少，同样，在第7个小时，欺诈性交易的百分比比其他时间高。</p><p id="77d5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">交易金额</strong></p><p id="98bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是与每笔交易相关的金额。让我们看看交易金额是如何分布的。(我还记录了交易金额，以便更好地解释)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/3c6f3f55863ceb2169e5601ac556fd9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zWzbdNdr1yy-J0UgN6OIMg.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/45879653f3fe962e9d93d37e728b9fab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_FcLR4TTHXhd6pautETiRg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">交易金额分布</p></figure><p id="ce73" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">观察结果:</p><ul class=""><li id="b5a4" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">我们可以看到，在训练数据中有一个点的数量&gt; 30000。我们最好移除离群值，因为它会影响我们的模型(尤其是基于距离的算法，如逻辑回归、knn等)。)在预测。</li><li id="956a" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated">此外，像这样的异常值会导致过度拟合问题。例如，基于树的模型可以将这些离群值放在叶节点中，这些节点是噪声，不是一般模式的一部分。因此，我决定删除训练集中大于30，000的值。</li><li id="1ce0" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated">“LogTransactionAmt”大于5.5 (244美元)且小于3.3 (27美元)的交易似乎具有更高的欺诈频率和概率密度。另一方面，那些“LogTransactionAmt”从3.3到5.5的人更有可能是合法的。</li></ul><p id="7831" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">产品光盘</strong></p><p id="43a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是与每笔交易相关的产品代码。让我们看看在不同的产品代码中有多少百分比的交易是欺诈。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/5c2d3c21fc6877ab1a9d624e4806da0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SzeKkSTwOArzcGa-IdvbNA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">乘积码</p></figure><p id="ad93" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到，在与产品代码C相关的交易中，大约有12%是欺诈交易。类似地，近6%的交易是产品代码欺诈。</p><p id="700b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">维列斯</strong></p><p id="0fa2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们有从D1到D15的D列。这些表示时间差，例如前一次交易和当前交易之间的天数、当前交易和第一次交易之间的天数等。尽管他们没有给出关于D cols的清晰的理解，但是我们在很好的分析之后得到了一些见解。</p><ul class=""><li id="7fae" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">我们假设D1是开始使用信用卡的那一天。从交易日中减去这一数字将得出每个客户的内容价值。</li></ul><pre class="kg kh ki kj gt om on oo op aw oq bi"><span id="5e47" class="or lt iq on b gy os ot l ou ov">df_train['D1n'] =  df_train['D1'] -   df_train.TransactionDT/np.float32(24*60*60)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/e271ee4c731e93240777b5ccf0389639.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zIX64cKc2K8WPhoUUOnrQw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">正常化前</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/99a6c83555952a09e462228f58419cc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DQsBBYJFBhuZLAt0AWRdJQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">标准化后</p></figure><p id="08eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们对所有的D列进行了标准化，并允许模型决定哪些是重要的，哪些是不重要的。</p><p id="0e51" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">卡1-卡6 </strong></p><p id="0c88" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些列表示与卡相关的支付信息。从这些特性中可以观察到一些有趣的现象:</p><ul class=""><li id="f550" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">card1中的值范围很广。如果我们看到分布有重叠。仅card1无法区分欺诈性交易和非欺诈性交易。card1中没有缺失值。</li><li id="02f2" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated">card2中丢失了一小部分数据。与card1相似，card2中也有许多唯一的值。card3与其他卡列的相关性较低。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/b585a17db5bdbf5b40de971d120d3ad6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yr-Hww7hZjae2AzW1IzktA.png"/></div></div></figure><ul class=""><li id="1b3d" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">卡4表示客户使用哪种卡，visa、Mastercard、American Express还是discover。类似地，card6表示卡的类型——借记卡或信用卡。</li></ul><p id="c972" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">P-邮箱域和R-邮箱域:</strong>分别是购买者和接收者的邮箱域。大约76%的值在R-email域中丢失。在购买者的电子邮件域名中，大多数邮件来自gmail.com。在这些欺诈交易中，超过90%的交易来自域名protonmail.com，这是一个严重的问题。</p><p id="07a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> addr1和addr2: </strong>这是一些与客户端相关的地址相关信息。addr1和addr2都丢失了大约11%的数据。addr1中大约有332个唯一值，addr2中有74个唯一值。</p><p id="2e2a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> dist1和dist2: </strong>这可能表示交易地点和持卡人地址之间的距离。这只是我的假设。dist2中大约有93%的值缺失。dist1和dist2之间没有相关性。而dist2与所有其他属性的相关性非常弱。</p><p id="5298" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">C1-C14: 这些是计数之类的信息。C3与Cxx的其他功能有些不同。对于来自box pot的c3，很明显，在欺诈交易的训练数据中没有超过3的值。对于无欺诈交易，该值的范围为0到26。此外，C3与其他Cxx列的相关性很弱。</p><p id="489f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> M1-M9: </strong>超过50%的值在M列中缺失。这些特征不能清楚地区分欺诈交易和非欺诈交易。</p><p id="3b82" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> V1-V399: </strong>这些是灶神星设计的特征。这些是被屏蔽的信息，可以是排名、计数或其他实体关系。许多特征之间存在强相关性(&gt; 0.9)。如果可能的话，我们最好减少这些特征的数量，因为这样可以降低模型的计算复杂度。</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="5956" class="ls lt iq bd lu lv nl lx ly lz nm mb mc jw nn jx me jz no ka mg kc np kd mi mj bi translated">基线模型</h1><p id="c649" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">作为基线，我们创建了3个模型。—逻辑回归、随机森林和XG Boost。在小的超参数调整之后，我们获得了以下结果。</p><p id="7059" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">逻辑回归:</strong> 0.84018(训练AUC)，0.84245(测试AUC)</p><p id="ffe5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">随机森林:</strong> 0.9030(训练AUC)，0.8600(测试AUC)</p><p id="045d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> Xgboost: </strong> 0.994(训练AUC)，<strong class="ky ir"> </strong> 0.9234(测试AUC)</p><p id="bbc4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于Xgboost提供了更好的性能，我们决定坚持使用它。我们还绘制了特性重要性图，以获得各种特性影响的基本概念。对于Xgboost，我们得到了0.9004的公共排行榜分数和0.9238的私人LB分数。</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="6413" class="ls lt iq bd lu lv nl lx ly lz nm mb mc jw nn jx me jz no ka mg kc np kd mi mj bi translated">更多功能工程</h1><h2 id="bbc7" class="or lt iq bd lu oz pa dn ly pb pc dp mc lf pd pe me lj pf pg mg ln ph pi mi pj bi translated">TransactionDT和TransactionID</h2><p id="4348" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">两列都是唯一的。一个是时间相关信息，另一个是唯一id。把这个加到模型里没有太大意义。所以我们去掉了这些特征。</p><h2 id="a654" class="or lt iq bd lu oz pa dn ly pb pc dp mc lf pd pe me lj pf pg mg ln ph pi mi pj bi translated">减少V-Cols</h2><p id="3008" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">从我们的Xgboost模型中，在绘制了特性重要性之后，我们知道所有的V列对模型没有太大的贡献。同样通过分析，我们发现在几个“Vxx”列之间存在很强的相关性。所以我们决定通过相关性分析来减少列数。</p><p id="79dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">如何根据NaN值减少列？</strong></p><ul class=""><li id="20e3" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">根据缺失值的数量对列进行分组，例如，如果有4列v1、v2、v3和v4。如果v1和v3有56个缺失值，v2有21个缺失值，v4有5个缺失值，则我们有3个组['v1 '，' v3']，['v2']和['v4']</li><li id="cfa0" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated">在每个组中，对于该组中的每一列，找出与其他列的相关性，并且只取相关系数&gt; 0.75的列。将具有公共元素的最大列表作为子组。每个组包含几个子组。例如:如果我们有[[v1，v2]，[v6]，[v1，v4，v2，v5]，[v5，v4]]，我们的输出将是[[v1，v2，v4，v5]，[v6]]。现在从每个子组中选择具有最多唯一值的列。例如，在子组[v1，v2，v4，v5]中，让v2具有最唯一的值。所以out输出变成[v2，v6]。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pk"><img src="../Images/1202de8c003e9e16ebea1262845973e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ml56CB9mZqauOOE77OyQ6A.png"/></div></div></figure><p id="1544" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上图显示了我们产出的一部分。我们将对每个组进行相关性分析，以减少列数。</p><p id="e0f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此处的列“V35”、“V40”、“V41”、“V39”、“V38”、“V51”、“V37”、“V52”、“V36”、“V50”、“V48”、“V42”、“V43”、“V44”、“V46”、“V47”、“V45”、“V49”缺少值。所以他们组成一个团体。现在我们将绘制一个相关矩阵。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/368d2b12190ac1f509b1bfbc25eafcf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*5GTKhbvK6UbeYOrW86CbhA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">相关图</p></figure><p id="5d14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们将根据相关性对它们进行分组。我们将相关性&gt; 0.75的列视为同一组。</p><p id="4e51" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[['V35 '，' V36']，['V37 '，' V38']，['V39 '，' V40 '，' V42 '，' V43 '，' V50 '，' V51 '，' V52']，['V41']，['V44 '，' V45']，['V46 '，' V47']，['V48 '，' V49']]</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="b0d0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用上面的函数来减少这种情况，并以下列结束:</p><p id="4b29" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">['V36 '，' V37 '，' V40 '，' V41 '，' V44 '，' V47 '，' V48']。</p><p id="2913" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">类似地，我们将对所有组都这样做，最后得到下面的V列。</p><pre class="kg kh ki kj gt om on oo op aw oq bi"><span id="c431" class="or lt iq on b gy os ot l ou ov">['V1', 'V3', 'V4', 'V6', 'V8', 'V11', 'V13', 'V14', 'V17', 'V20','V23', 'V26', 'V27', 'V30', 'V36', 'V37', 'V40', 'V41', 'V44', 'V47', 'V48', 'V54', 'V56', 'V59','V62', 'V65', 'V67', 'V68', 'V70', 'V76', 'V78', 'V80', 'V82', 'V86', 'V88', 'V89', 'V91', 'V96','V98', 'V99', 'V104', 'V107', 'V108', 'V111', 'V115', 'V117', 'V120', 'V121', 'V123', 'V124', 'V127','V129', 'V130', 'V136', 'V138', 'V139', 'V142', 'V147', 'V156', 'V162', 'V165', 'V160', 'V166', 'V178','V176', 'V173', 'V182', 'V187', 'V203', 'V205', 'V207', 'V215', 'V169', 'V171', 'V175', 'V180', 'V185','V188', 'V198', 'V210', 'V209', 'V218', 'V223', 'V224', 'V226', 'V228', 'V229', 'V235', 'V240', 'V258','V257', 'V253', 'V252', 'V260', 'V261', 'V264', 'V266', 'V267', 'V274', 'V277', 'V220', 'V221', 'V234','V238', 'V250', 'V271', 'V294', 'V284', 'V285', 'V286', 'V291','V297', 'V303', 'V305', 'V307', 'V309', 'V310', 'V320', 'V281', 'V283', 'V289', 'V296', 'V301', 'V314', 'V332', 'V325', 'V335', 'V338']</span></pre><p id="ed9e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">减少V列不会降低局部验证的分数。我们在训练数据上得到0.993 AUC，在cv数据上得到0.9231。即使它将私有LB分数减少了0.001，我们也能够减少211列，从而提高了模型的计算复杂性。因此，放弃这些特性是一个更好的方法。</p><h2 id="8c21" class="or lt iq bd lu oz pa dn ly pb pc dp mc lf pd pe me lj pf pg mg ln ph pi mi pj bi translated">减少C列和M列</h2><p id="de9f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我也试图以类似的方式减少C和M列。但是它降低了超过0.002 AUC的分数。所以到现在为止，我还留着。</p><h2 id="2217" class="or lt iq bd lu oz pa dn ly pb pc dp mc lf pd pe me lj pf pg mg ln ph pi mi pj bi translated">工程D类</h2><p id="0f45" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">从卡格尔的讨论中，我了解到D1是信用卡开始使用的日子。从交易日中减去这一数字将使每个客户的价值几乎保持不变。我对所有的D级都采用了同样的方法。为了检查新创建的功能是否有用，我选择了一个向前的功能。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/d2b3bd318ac0749a7a00820440c84100.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*bzKg4aCp5QzmrsBJYbVxbA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在外</p></figure><p id="4d59" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">如何选择要修改的D列？</strong></p><ul class=""><li id="3953" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">我们知道我们的基线提供了0.923的AUC。这将是我们最初的基本分数</li><li id="46d0" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated">在第一次迭代中，我添加了归一化的D1，删除了原始的D1，并创建了一个模型，并记录了测试的AUC。现在，对从D1到D15的所有Dcols重复这一过程。每次记录AUC，并选择从基线(0.923)进一步改善AUC的Dcol。这个AUC成为我们最好的分数。</li><li id="820f" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated">在下一次迭代中，包括较早的D列，并且对所有剩余的列以及D1重复步骤1。</li><li id="611f" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated">重复迭代，直到AUC没有改善。</li></ul><p id="f5e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们以规范化“D15”、“D4”、“D2”、“D 11”和“D10”结束。我们当地的AUC变成了0.934。</p><h2 id="3037" class="or lt iq bd lu oz pa dn ly pb pc dp mc lf pd pe me lj pf pg mg ln ph pi mi pj bi translated">编码功能等</h2><p id="692b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">接下来，我创建了以下特征:</p><ul class=""><li id="b904" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">星期几:交易发生的星期几</li><li id="3c9e" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated">小时:交易发生的小时</li><li id="620a" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated">美分:与交易金额相关的美分</li><li id="1978" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated">LogTransactionAmt:交易金额的日志</li><li id="5ea3" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated">P _ email _ company:P _ email _ domain所属的公司。它是从互联网上获得的。</li><li id="72da" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated">Device_corp:我根据设备信息创建了这个专栏。它基本上是从设备信息中获得的母公司详细信息。</li><li id="fc30" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated">小时欺诈状态:从我们在进行EDA时获得的图表中，我们知道每小时欺诈交易的百分比。在此基础上，我创建了4个类别非常低，低，中，高，这样每个小时都属于这些类别。</li></ul><p id="dbb1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后我使用FFS，看看哪些功能可以改善结果。但是只有小时栏把分数提高到了0.9338。正向特征选择的功能如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="1184" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我创建了一些编码特性。在此之前，让我们熟悉以下功能。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="6104" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基于这些，我创造了大约45个特征。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="1062" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我做了一个前向特征选择，并选择了那些提高模型性能的特征。结果，我得到了以下6个新特性</p><pre class="kg kh ki kj gt om on oo op aw oq bi"><span id="540e" class="or lt iq on b gy os ot l ou ov">card4_addr1_R_emaildomain', 'card2_FE','card1_FE', 'card1_addr1_R_emaildomain', 'card3_addr1_P_emaildomain', 'card1_addr1','card4_addr1_P_emaildomain_FE'</span></pre><p id="f006" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些提高了我的本地验证分数到0.9634。</p><h2 id="a310" class="or lt iq bd lu oz pa dn ly pb pc dp mc lf pd pe me lj pf pg mg ln ph pi mi pj bi translated">基于UID的功能</h2><p id="96a1" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><strong class="ky ir">为什么基于UID(识别客户)的功能会起作用？</strong></p><p id="a9ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设我们有以下数据:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/3287bcf38a216362ede2270103ebbd3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*B0XtbjsAnZzt22rwLj9QbQ.png"/></div></figure><p id="4375" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里，如果我们构建一个决策树，它可能如下所示</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi po"><img src="../Images/cfcdf49a68b5f8bb4ef68fc497c2202d.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*4o3T2pcDqYasqsTHtkbvOQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">没有UID的决策树</p></figure><p id="699c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这种情况下，我们可以看到，在11分中，有8分被正确分类。假设我们可以识别个别客户。我将向你解释我如何能找到它。如果我能找到这样的uid，我们的数据如下。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/7680f66898884ea3a84822a3c0a0a87c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*pEU6tdJjOsBLYcrdVvf-rw.png"/></div></figure><p id="819b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们从这个uid创建一个新的组聚合。让我们在此基础上构建一个决策树。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/c9d318655c3709d764bc01502a9a79d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*KPczgJYd9Wi-ovoZTi4Uvg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">基于uid的决策树</p></figure><p id="6354" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到，在这种情况下，所有11个点都被正确分类。即使在真实情况下这不会是准确的，但它肯定可以提高模型的性能。所以找到uid是提高我们分数的关键。</p><p id="59cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">经过分析，我了解到<strong class="ky ir"> <em class="my"> card1、d1和addr1 </em> </strong>将帮助我识别客户。所以我把这三列组合起来，作为uid。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="5780" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我用这个uid创建了几个平均值、标准偏差和几个特征的计数聚合。我使用下面的函数进行聚合。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="ca7b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我基于uid创建了大约100个聚合特性。但是在不同子集上进行正向特征选择之后，我最终得到了9个新特征。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><pre class="kg kh ki kj gt om on oo op aw oq bi"><span id="ab1a" class="or lt iq on b gy os ot l ou ov">'M9_uid_mean' ,  'M5_uid_mean' ,  'D2_uid_mean' ,  'D15_uid_mean' ,  'C13_uid_mean' ,  'C9_uid_mean' ,  'C1_uid_mean' ,  'C11_uid_mean' ,  'TransactionAmt_uid_std'</span></pre><p id="41e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这使我的本地简历得分提高到0.9470。来自私有leader板和公共leader板的结果分别是0.9158和0.9423。</p><p id="40cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从分析来看，很明显没有一个uid是完美的。所以我试图通过将card1和addr1结合起来创建一个新的uid。然后，我使用新的uid创建了类似的聚合，并查看哪些新特性改进了正向特性选择的结果。我总结了以下4个新特性:</p><pre class="kg kh ki kj gt om on oo op aw oq bi"><span id="d1fe" class="or lt iq on b gy os ot l ou ov">'M4_uid2_mean' ,  'M1_uid2_mean' ,  'M7_uid2_mean' ,  'M8_uid2_std' </span></pre><p id="84b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这让我的本地CV提高到了0.9481。此外，新的私立和公立LB分数分别为0.917和0.940。因此，基于UID的特性确实有助于我们提高模型的性能。</p><h2 id="675c" class="or lt iq bd lu oz pa dn ly pb pc dp mc lf pd pe me lj pf pg mg ln ph pi mi pj bi translated">超参数调整和交叉验证</h2><p id="4e86" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这是两个重要的技术，确实提高了我的算法的性能。正如你所知道的，我们的模型在早些时候进行了调整，但是目前，已经引入了许多新功能。让我们找出符合模型的最佳参数。为此，我使用了Sklearn的随机搜索简历。</p><p id="e6e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">经过随机搜索后，我们得到了以下参数</p><pre class="kg kh ki kj gt om on oo op aw oq bi"><span id="6834" class="or lt iq on b gy os ot l ou ov">n_estimators=5000,max_depth=12,learning_rate=0.002,<br/>subsample=0.8, colsample_bytree=0.4</span></pre><h2 id="6f95" class="or lt iq bd lu oz pa dn ly pb pc dp mc lf pd pe me lj pf pg mg ln ph pi mi pj bi translated">如何做交叉验证？</h2><p id="5271" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">首先，我们创建了一个新列来指示交易的月份。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="79db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用以月为组的GroupKFold来预测test.csv。训练数据为2017年12月、2018年1月、2018年2月、2018年3月、2018年4月、2018年5月这几个月。我们把这些月份称为12月、13月、14月、15月、16月、17月。Fold将在第13个月到第17个月进行训练，并预测第12个月。请注意，第12个月的唯一目的是告诉XGB何时提前停止，我们实际上并不关心向后的时间预测。在第13到17个月训练的模型也将预测在时间上向前的test.csv。</p><p id="2f3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的代码如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="4199" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们交叉验证后的本地CV分数变成了0.951265。新的私有和公共LB分数分别变为0.928873和0.954825。在6351家公司中，它大约排在第226位。(前3.5%)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pr"><img src="../Images/b62d516292c04c25a10c150cfdfd0710.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YQ64HgCfuuVtVByYgFu3_Q.png"/></div></div></figure><p id="ecff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在整个项目中的进展如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/fe14e6977af93c3ab08908c879da7b14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*ewPYqO5_ixbAVljbHFK8ZA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">进步</p></figure><p id="db9b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在https://github.com/arunm8489/IEE-CIS-Fraud-detection查看我的全部代码。这不是结束。尽管如此，还是有一些进步。一些我没有尝试过的方法:</p><ul class=""><li id="ba46" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">我的全部工作都围绕着XgBoost算法。你可以尝试其他算法，如Lightgbm、cat boost等。</li><li id="3972" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated">我已经根据NaN值的数量和皮尔逊相关系数减少了v列。您还可以在每个NaN组中尝试PCA，看看它是否能提高性能</li><li id="de48" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated">我已经应用了前向特征选择来选择重要的特征。我把它应用于不同的子集。在不同的子集上尝试会产生不同的结果。</li></ul><h1 id="acee" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">参考</h1><ul class=""><li id="9b99" class="mp mq iq ky b kz mk lc ml lf nr lj ns ln nt lr mu mv mw mx bi translated"><a class="ae kv" href="https://www.kaggle.com/cdeotte/xgb-fraud-with-magic-0-9600" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/cdeotte/xgb-fraud-with-magic-0-9600</a></li><li id="6cfc" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated">https://www.kaggle.com/artgor/eda-and-models<a class="ae kv" href="https://www.kaggle.com/artgor/eda-and-models" rel="noopener ugc nofollow" target="_blank"/></li><li id="0ada" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated"><a class="ae kv" href="https://www.kaggle.com/ysjf13/cis-fraud-detection-visualize-feature-engineering" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/ysjf 13/cis-欺诈-检测-可视化-特征-工程</a></li><li id="46e2" class="mp mq iq ky b kz mz lc na lf nb lj nc ln nd lr mu mv mw mx bi translated"><a class="ae kv" href="https://www.kaggle.com/xhlulu/ieee-fraud-xgboost-with-gpu-fit-in-40s" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/xh lulu/IEEE-fraud-XG boost-with-GPU-fit-in-40s</a></li></ul></div></div>    
</body>
</html>