<html>
<head>
<title>Hurricane Henri: A Data Story</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">亨利飓风:一个数据故事</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/hurricane-henri-a-data-story-5a3bee2840fc?source=collection_archive---------29-----------------------#2021-09-28">https://towardsdatascience.com/hurricane-henri-a-data-story-5a3bee2840fc?source=collection_archive---------29-----------------------#2021-09-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="4ffb" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="5434" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">分析因东海岸亨利飓风影响而产生的游客数据波动</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/e2804fcd5f977da50e33f90e77993793.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S9gpB9OURQx8ciPheNaFuQ.jpeg"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">由<a class="ae le" href="https://unsplash.com/@nasa?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> NASA </a>在<a class="ae le" href="https://unsplash.com/s/photos/hurricane?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="382e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">亨利飓风是一种1级飓风，在2021年8月造成了东海岸的严重破坏。这场飓风于8月16日在罗德岛州登陆，并于8月24日消散。亨利达到了每小时70英里的峰值强度，并导致了从大规模财产损失到纽约、新泽西和宾夕法尼亚等州的暴雨和洪水的破坏。这篇特别的文章旨在分析这场飓风对纽约州、新泽西州和宾夕法尼亚州的旅游景点的游客指标的影响。</p><p id="5702" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">为了执行此分析，我将使用位于纽约州、新泽西州和宾夕法尼亚州的POI的<a class="ae le" href="https://www.safegraph.com/" rel="noopener ugc nofollow" target="_blank"> SafeGraph </a>每周模式数据。SafeGraph是一家数据提供商，为数百家企业和类别提供POI数据。它向学术界免费提供数据。SafeGraph每周模式数据在结构上类似于每月模式数据(每月模式的文档可在<a class="ae le" href="https://docs.safegraph.com/docs/monthly-patterns" rel="noopener ugc nofollow" target="_blank">此处</a>找到)，但提供的数据是每周和每天的，而不是每月的。这个更加具体和细致入微的数据集的文档可以在<a class="ae le" href="https://docs.safegraph.com/docs/weekly-patterns" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="bf3d" class="mi mj iq bd mk ml mm mn mo mp mq mr ms kf mt kg mu ki mv kj mw kl mx km my mz bi translated">分析:</h1><p id="c624" class="pw-post-body-paragraph lf lg iq lh b li na ka lk ll nb kd ln lo nc lq lr ls nd lu lv lw ne ly lz ma ij bi translated">分析的第一步是加载数据并执行一些基本的数据预处理，以提取我们需要的数据。这个分析涉及到几个压缩为JSON字符串和数组的列的扩展，比如关于分时段平均停留时间和每日访问者数据的列。为了执行这个扩展，我们可以在Spark中使用from_json命令。对于此分析，使用了从2021年8月2日到2021年8月30日的数据，并将这些数据分成位于不同文件中的每周间隔。由于预处理阶段在所有四周都是相同的，我们可以使用08/02这一周作为我们分析的基线，并假设对所有文件执行相同的分析。该过程的第一步是加载数据:</p><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="b795" class="nk mj iq ng b gy nl nm l nn no">path0802 = '/content/drive/MyDrive/UpWork/safeGraph/Data Projects/Project 6/patterns0802.csv'</span><span id="4857" class="nk mj iq ng b gy np nm l nn no">df0802 = pd.read_csv(path0802)</span><span id="ae24" class="nk mj iq ng b gy np nm l nn no">df0802 = df0802[(df0802['region'] == 'NY') | (df0802['region'] == 'PA') | (df0802['region'] == 'NJ')]</span><span id="a0a6" class="nk mj iq ng b gy np nm l nn no">df0802 = df0802.drop(['parent_placekey','iso_country_code','safegraph_brand_ids','visitor_country_of_origin','related_same_day_brand','related_same_week_brand','device_type','brands','visitor_daytime_cbgs','visitor_home_aggregation','visitor_home_cbgs'], axis = 1)</span><span id="cc7e" class="nk mj iq ng b gy np nm l nn no">df0802['postal_code'] = pd.to_numeric(df0802['postal_code'], errors='coerce')</span><span id="2a45" class="nk mj iq ng b gy np nm l nn no">df0802['raw_visit_counts'] = pd.to_numeric(df0802['raw_visit_counts'], errors='coerce')</span><span id="7ac7" class="nk mj iq ng b gy np nm l nn no">df0802['raw_visitor_counts'] = pd.to_numeric(df0802['raw_visitor_counts'], errors='coerce')</span><span id="9eef" class="nk mj iq ng b gy np nm l nn no">df0802['poi_cbg'] = pd.to_numeric(df0802['poi_cbg'], errors='coerce')</span><span id="60f9" class="nk mj iq ng b gy np nm l nn no">df0802['distance_from_home'] = pd.to_numeric(df0802['distance_from_home'], errors='coerce')</span><span id="8009" class="nk mj iq ng b gy np nm l nn no">df0802['median_dwell'] = pd.to_numeric(df0802['median_dwell'], errors='coerce')</span><span id="b24f" class="nk mj iq ng b gy np nm l nn no">df0802 = spark.createDataFrame(df0802)</span><span id="ac92" class="nk mj iq ng b gy np nm l nn no">df0802.show(2)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nq"><img src="../Images/afd912219a1756a1d0b5da5553c00fa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JFUabUde9RZ9OiTOda5IFQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><p id="49af" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">从这里我们可以展开JSON字符串列:</p><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="7537" class="nk mj iq ng b gy nl nm l nn no">#Horizontal Explosion of JSON columns using Pyspark</span><span id="e947" class="nk mj iq ng b gy np nm l nn no">from pyspark.sql.functions import from_json,expr</span><span id="2452" class="nk mj iq ng b gy np nm l nn no">from pyspark.sql.types import StructType, StructField, StringType, ArrayType, IntegerType</span><span id="858a" class="nk mj iq ng b gy np nm l nn no">bucketedDT_schema = StructType(</span><span id="9d30" class="nk mj iq ng b gy np nm l nn no">[</span><span id="8ea0" class="nk mj iq ng b gy np nm l nn no">StructField('&lt;5',IntegerType(),True),</span><span id="0fcb" class="nk mj iq ng b gy np nm l nn no">StructField('5-10',IntegerType(),True),</span><span id="f59c" class="nk mj iq ng b gy np nm l nn no">StructField('11-20',IntegerType(),True),</span><span id="7417" class="nk mj iq ng b gy np nm l nn no">StructField('21-60',IntegerType(),True),</span><span id="7584" class="nk mj iq ng b gy np nm l nn no">StructField('61-120',IntegerType(),True),</span><span id="c68a" class="nk mj iq ng b gy np nm l nn no">StructField('121-240',IntegerType(),True),</span><span id="6868" class="nk mj iq ng b gy np nm l nn no">StructField('&gt;240',IntegerType(),True)</span><span id="c75d" class="nk mj iq ng b gy np nm l nn no">]</span><span id="264f" class="nk mj iq ng b gy np nm l nn no">)</span><span id="faa6" class="nk mj iq ng b gy np nm l nn no">df0802 = df0802.withColumn('bucketed_dwell_times',from_json('bucketed_dwell_times',bucketedDT_schema)).select('placekey','location_name','street_address','city','region','postal_code','date_range_start','date_range_end','raw_visit_counts','raw_visitor_counts','visits_by_day',</span><span id="0650" class="nk mj iq ng b gy np nm l nn no">'distance_from_home','median_dwell',</span><span id="099d" class="nk mj iq ng b gy np nm l nn no">'bucketed_dwell_times.*')</span><span id="40d3" class="nk mj iq ng b gy np nm l nn no">df0802 = df0802.toPandas()</span><span id="d5a6" class="nk mj iq ng b gy np nm l nn no">df0802.head(3)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nr"><img src="../Images/7436ca217541db445af3401dc85f31bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mNOdoHiNGHNJCA678YIdxw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><p id="6301" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">下一步是扩展数组列:</p><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="7d2c" class="nk mj iq ng b gy nl nm l nn no">from ast import literal_eval</span><span id="6ae0" class="nk mj iq ng b gy np nm l nn no">df0802['visits_by_day'] = df0802['visits_by_day'].transform(lambda x: literal_eval(x))</span><span id="72f4" class="nk mj iq ng b gy np nm l nn no">pops = ['visit_' + str(i) for i in range(1,8)]</span><span id="3716" class="nk mj iq ng b gy np nm l nn no">df0802[pops] = pd.DataFrame(df0802.visits_by_day.to_list(), index=df0802.index)</span><span id="71f6" class="nk mj iq ng b gy np nm l nn no">df0802 = df0802.drop(['visits_by_day'], axis = 1)</span><span id="799b" class="nk mj iq ng b gy np nm l nn no">df0802 = df0802.reindex()</span><span id="15e7" class="nk mj iq ng b gy np nm l nn no">df0802.head(3)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ns"><img src="../Images/6446dd5b368f05ac4071069664e83b3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vixaTcSABjSPE-dYdZLcSQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><p id="d73f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">既然数据集中的列已经展开，我们可以执行一些基本的分析:</p><p id="f7f6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">08/02访问数据的趋势分析</p><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="79dd" class="nk mj iq ng b gy nl nm l nn no">px.bar(df0802, 'location_name','raw_visitor_counts',color = 'region', width= 10000000, height= 1000, barmode= 'group')</span></pre><p id="4326" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">由于该条形图涵盖了纽约、新泽西和宾夕法尼亚的所有poi，其可视化程度太大，无法显示所有poi。相反，我们可以关注单个POI:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nt"><img src="../Images/ed1f24b1474779aae33fbe4037195838.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OpfohHBMCQW9FT3OASu7LA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><p id="051a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在这个特定的图中，蓝色条代表Wendy在纽约的位置，红色条代表Wendy在宾夕法尼亚州的位置，蓝绿色条代表Wendy在新泽西州的位置。各个条形之间的分隔用来显示每个状态中的不同位置，访问者数据被分组在彼此之上。</p><p id="31df" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">考虑到这些兴趣点，我们如何通过查看访客指标对平均停留时间的影响来进一步分析，并尝试确定一些模式</p><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="4ac1" class="nk mj iq ng b gy nl nm l nn no">px.scatter(df0802, x = 'raw_visitor_counts', y = 'median_dwell', color= 'region')</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nu"><img src="../Images/baf29406636c901a584b0b73cb639185.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zAjEU8qxK2yMhGyG8nM_aQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><p id="e52d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">通过对第一周的分析，我们能够确定，对于给定的POI，平均停留时间和游客数量之间的相关性似乎很小。同样的趋势在分析的所有周中重复出现。如果您希望更深入地研究这一分析，您可以在笔记本文件<a class="ae le" href="https://colab.research.google.com/drive/1KLQ_L5bTn5ubxPBY7OfkkWwXwE6Uunxi?usp=sharing" rel="noopener ugc nofollow" target="_blank">中看到这些可视化效果。</a></p><p id="72b6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">从该分析中变得非常明显的一个因素是数据中存在的poi的绝对数量。如果我们想了解飓风亨利在8月份所有四周的影响，那么对所有POI进行分析可能会很麻烦，并使分析变得比必要的更复杂。为了简化流程并大幅减少考虑的兴趣点数量，我们可以应用随机抽样来选择所有4周分析的相同兴趣点，并查看飓风对每日访客指标的影响。</p><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="df82" class="nk mj iq ng b gy nl nm l nn no">df0802_sample = df0802.sample(10)</span><span id="a6f8" class="nk mj iq ng b gy np nm l nn no">df0802_sample['id'] = np.array(['Week 0']*10)</span><span id="019f" class="nk mj iq ng b gy np nm l nn no">df0802_sample.head(2)</span><span id="7476" class="nk mj iq ng b gy np nm l nn no">placekey_arr = np.array(df0802_sample['placekey'])</span><span id="105c" class="nk mj iq ng b gy np nm l nn no">df0809_sample = df0809[(df0809['placekey'] == placekey_arr[0]) | (df0809['placekey'] == placekey_arr[1]) | (df0809['placekey'] == placekey_arr[2])</span><span id="9faa" class="nk mj iq ng b gy np nm l nn no">| (df0809['placekey'] == placekey_arr[3]) | (df0809['placekey'] == placekey_arr[4]) | (df0809['placekey'] == placekey_arr[5])</span><span id="cdc3" class="nk mj iq ng b gy np nm l nn no">| (df0809['placekey'] == placekey_arr[6]) | (df0809['placekey'] == placekey_arr[7]) | (df0809['placekey'] == placekey_arr[8])</span><span id="f574" class="nk mj iq ng b gy np nm l nn no">| (df0809['placekey'] == placekey_arr[9]) ]</span><span id="c028" class="nk mj iq ng b gy np nm l nn no">df0809_sample['id'] = np.array(['Week 1']*10)</span><span id="baef" class="nk mj iq ng b gy np nm l nn no">df0816_sample = df0816[(df0816['placekey'] == placekey_arr[0]) | (df0816['placekey'] == placekey_arr[1]) | (df0816['placekey'] == placekey_arr[2])</span><span id="3392" class="nk mj iq ng b gy np nm l nn no">| (df0816['placekey'] == placekey_arr[3]) | (df0816['placekey'] == placekey_arr[4]) | (df0816['placekey'] == placekey_arr[5])</span><span id="7c4c" class="nk mj iq ng b gy np nm l nn no">| (df0816['placekey'] == placekey_arr[6]) | (df0816['placekey'] == placekey_arr[7]) | (df0816['placekey'] == placekey_arr[8])</span><span id="2917" class="nk mj iq ng b gy np nm l nn no">| (df0816['placekey'] == placekey_arr[9]) ]</span><span id="825f" class="nk mj iq ng b gy np nm l nn no">df0816_sample['id'] = np.array(['Week 2']*10)</span><span id="87db" class="nk mj iq ng b gy np nm l nn no">df0823_sample = df0823[(df0823['placekey'] == placekey_arr[0]) | (df0823['placekey'] == placekey_arr[1]) | (df0823['placekey'] == placekey_arr[2])</span><span id="0059" class="nk mj iq ng b gy np nm l nn no">| (df0823['placekey'] == placekey_arr[3]) | (df0823['placekey'] == placekey_arr[4]) | (df0823['placekey'] == placekey_arr[5])</span><span id="3a14" class="nk mj iq ng b gy np nm l nn no">| (df0823['placekey'] == placekey_arr[6]) | (df0823['placekey'] == placekey_arr[7]) | (df0823['placekey'] == placekey_arr[8])</span><span id="aa65" class="nk mj iq ng b gy np nm l nn no">| (df0823['placekey'] == placekey_arr[9]) ]</span><span id="0c58" class="nk mj iq ng b gy np nm l nn no">df0823_sample['id'] = np.array(['Week 3']*10)</span><span id="63a0" class="nk mj iq ng b gy np nm l nn no">df0823_sample.head(2)</span><span id="d6fa" class="nk mj iq ng b gy np nm l nn no">frames = [df0802_sample, df0809_sample,df0816_sample, df0823_sample]</span><span id="333e" class="nk mj iq ng b gy np nm l nn no">sample = pd.concat(frames)</span><span id="27f5" class="nk mj iq ng b gy np nm l nn no">sample.head(50)</span></pre><p id="36cc" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">上面的代码片段从第一周的数据中随机抽取兴趣点样本，并将它们的placekey值映射到剩余3周的数据中，以确保随机抽样在所有四周中选取相同的兴趣点。当绘制这几周的访客数据时，我们得到以下结果</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nv"><img src="../Images/84cf51edd1938e0e98e7a10a0205ef91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JZREuUSFC_l4orFhvtVxCg.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><p id="c959" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">从该图中，我们可以看到随机选择的兴趣点有一些明显的趋势。为了充分理解这些趋势的重要性并理解飓风Henri对这些poi的影响，我们需要首先了解飓风在八月的第三周影响了这些地区。考虑到这一信息，我们可以看到一些地点在第三周的游客中看到香料的趋势(MTA科尔特尤路站)。这些可能是人们在飓风期间寻求庇护或获取货物的地点的例子。在这种情况下，MTA Cortelyou路站是一个纽约市地铁站，游客的涌入可归因于该地区的暴雨造成的交通问题。在许多情况下，在第三周游客数量下降后，第四周的游客数量会有所增加(Franklin Towne Chs、Kathleen's closet等)。).这些可能是风暴过后游客增加的例子。然而，在某些情况下，访客指标中没有可辨别的趋势可归因于飓风的存在。游客数量没有波动与两个原因有关。首先，这些特定的POI可能根本没有受到风暴的影响，因为数据包含位于所选三个州的所有POI，而位于内陆的位置受风暴的影响可能较小。第二，我们可能无法真正看到游客指标的波动，因为每周游客人数是一周中各天的总和，飓风当天游客人数的减少可能会被当天之前在POI发生的事件所抵消，因为在地震发生前，人们可能会增加访问该地区的供应和其他材料的数量。为了解决第一个问题，采取了以下步骤:</p><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="3cc6" class="nk mj iq ng b gy nl nm l nn no">NJ_arr = ['Cranbury', 'Jamesburg','Concordia']</span><span id="6c39" class="nk mj iq ng b gy np nm l nn no">NY_arr = ['New York']</span><span id="97f8" class="nk mj iq ng b gy np nm l nn no">PA_arr = ['Albrightsville', 'Gouldsboro', 'Jim Thorpe']</span><span id="3739" class="nk mj iq ng b gy np nm l nn no">df0802_sel = df0802[(df0802['city'] == NJ_arr[0]) | (df0802['city'] == NJ_arr[1]) | (df0802['city'] == NJ_arr[2]) |</span><span id="0bcc" class="nk mj iq ng b gy np nm l nn no">(df0802['city'] == NY_arr[0]) | (df0802['city'] == PA_arr[0]) | (df0802['city'] == PA_arr[1]) |</span><span id="45eb" class="nk mj iq ng b gy np nm l nn no">(df0802['city'] == PA_arr[2])]</span><span id="ad47" class="nk mj iq ng b gy np nm l nn no">df0802_sel['id'] = np.array(['Week 0']*2439)<br/></span><span id="5738" class="nk mj iq ng b gy np nm l nn no">df0809_sel = df0809[(df0809['city'] == NJ_arr[0]) | (df0809['city'] == NJ_arr[1]) | (df0809['city'] == NJ_arr[2]) |</span><span id="51a3" class="nk mj iq ng b gy np nm l nn no">(df0809['city'] == NY_arr[0]) | (df0809['city'] == PA_arr[0]) | (df0809['city'] == PA_arr[1]) |</span><span id="bf2c" class="nk mj iq ng b gy np nm l nn no">(df0809['city'] == PA_arr[2])]</span><span id="b4f1" class="nk mj iq ng b gy np nm l nn no">df0809_sel['id'] = np.array(['Week 1']*2436)</span><span id="5899" class="nk mj iq ng b gy np nm l nn no">df0816_sel = df0816[(df0816['city'] == NJ_arr[0]) | (df0816['city'] == NJ_arr[1]) | (df0816['city'] == NJ_arr[2]) |</span><span id="5c5d" class="nk mj iq ng b gy np nm l nn no">(df0816['city'] == NY_arr[0]) | (df0816['city'] == PA_arr[0]) | (df0816['city'] == PA_arr[1]) |</span><span id="fdb2" class="nk mj iq ng b gy np nm l nn no">(df0816['city'] == PA_arr[2])]</span><span id="0f5a" class="nk mj iq ng b gy np nm l nn no">df0816_sel['id'] = np.array(['Week 2']*2405)</span><span id="9133" class="nk mj iq ng b gy np nm l nn no">df0823_sel = df0823[(df0823['city'] == NJ_arr[0]) | (df0823['city'] == NJ_arr[1]) | (df0823['city'] == NJ_arr[2]) |</span><span id="e534" class="nk mj iq ng b gy np nm l nn no">(df0823['city'] == NY_arr[0]) | (df0823['city'] == PA_arr[0]) | (df0823['city'] == PA_arr[1]) |</span><span id="6468" class="nk mj iq ng b gy np nm l nn no">(df0823['city'] == PA_arr[2])]</span><span id="b8f7" class="nk mj iq ng b gy np nm l nn no">df0823_sel['id'] = np.array(['Week 3']*2411)</span><span id="b224" class="nk mj iq ng b gy np nm l nn no">df0823_sel.head(2)</span><span id="6b8d" class="nk mj iq ng b gy np nm l nn no">frames = [df0802_sel, df0809_sel,df0816_sel, df0823_sel]</span><span id="be35" class="nk mj iq ng b gy np nm l nn no">select = pd.concat(frames)</span><span id="1cbc" class="nk mj iq ng b gy np nm l nn no">select.head()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nw"><img src="../Images/ca56f06b5a07c21295b9d91df9479d1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cubIA2ANzB8gon8MEUPBOg.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><p id="1c0f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">根据维基百科，为了解决POI不靠近飓风位置的问题，我们决定查看游客波动对每个州受影响最大的位置的影响。现在可视化这个特定的数据集，我们可以看到以下内容</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nx"><img src="../Images/e211ef7b0e19624f4a1e4b901fb74c68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dCi0DzPjB7Eh9Fm5s5rRjw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><p id="b778" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">上图显示了每周访问者数据中更清晰、更符合预期的模式。飓风亨利于8月16日在大西洋形成，并于8月24日左右在新英格兰地区消散。因此，我们预计8月前两周的游客模式基本上作为给定兴趣点的控制组，第三周的游客数据有所下降，第四周略有恢复。这种模式在这些受亨利飓风影响最严重的城镇的许多兴趣点都可以看到。poi显示，前两周游客数量停滞或略有波动，随后随着飓风开始影响该地区，第三周游客数据出现下降。当飓风在第三周末消散时，这些兴趣点的游客数据如预期的那样再次增加</p><p id="23fb" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">为了解决第二个问题，即一周的游客总数抵消了飓风当天的波动，我们进行了以下分析</p><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="0082" class="nk mj iq ng b gy nl nm l nn no">df0802_1 = pd.read_csv(path0802)</span><span id="b53c" class="nk mj iq ng b gy np nm l nn no">df0809_1 = pd.read_csv(path0809)</span><span id="045d" class="nk mj iq ng b gy np nm l nn no">df0816_1 = pd.read_csv(path0816)</span><span id="d7c4" class="nk mj iq ng b gy np nm l nn no">df0823_1 = pd.read_csv(path0823)</span><span id="2842" class="nk mj iq ng b gy np nm l nn no">BPC02 = df0802_1[df0802_1['location_name']== 'Battery Park City']</span><span id="89e1" class="nk mj iq ng b gy np nm l nn no">BPC02['visits_by_day'] = BPC02['visits_by_day'].transform(lambda x: literal_eval(x))</span><span id="85e9" class="nk mj iq ng b gy np nm l nn no">BPC02 = BPC02.explode('visits_by_day')</span><span id="4a2a" class="nk mj iq ng b gy np nm l nn no">name_02 = np.array(BPC02['location_name'])</span><span id="a5f5" class="nk mj iq ng b gy np nm l nn no">for i in range(len(name_02)):</span><span id="abd6" class="nk mj iq ng b gy np nm l nn no">name_02[i] = name_02[i] + str(i)</span><span id="8531" class="nk mj iq ng b gy np nm l nn no">BPC02['location_name'] = name_02</span><span id="8a8a" class="nk mj iq ng b gy np nm l nn no">BPC02['id'] = np.array('week 0')</span><span id="709d" class="nk mj iq ng b gy np nm l nn no">BPC09 = df0809_1[df0809_1['location_name']== 'Battery Park City']</span><span id="5777" class="nk mj iq ng b gy np nm l nn no">BPC09['visits_by_day'] = BPC09['visits_by_day'].transform(lambda x: literal_eval(x))</span><span id="0f7c" class="nk mj iq ng b gy np nm l nn no">BPC09 = BPC09.explode('visits_by_day')</span><span id="33e4" class="nk mj iq ng b gy np nm l nn no">name_09 = np.array(BPC09['location_name'])</span><span id="2cf0" class="nk mj iq ng b gy np nm l nn no">for i in range(len(name_09)):</span><span id="3b3e" class="nk mj iq ng b gy np nm l nn no">name_09[i] = name_09[i] + str(i)</span><span id="3db9" class="nk mj iq ng b gy np nm l nn no">BPC09['location_name'] = name_09</span><span id="a127" class="nk mj iq ng b gy np nm l nn no">BPC09['id'] = np.array('week 1')</span><span id="99e1" class="nk mj iq ng b gy np nm l nn no">BPC16 = df0816_1[df0816_1['location_name']== 'Battery Park City']</span><span id="1922" class="nk mj iq ng b gy np nm l nn no">BPC16['visits_by_day'] = BPC16['visits_by_day'].transform(lambda x: literal_eval(x))</span><span id="c8a0" class="nk mj iq ng b gy np nm l nn no">BPC16 = BPC16.explode('visits_by_day')</span><span id="2a6d" class="nk mj iq ng b gy np nm l nn no">name_16 = np.array(BPC16['location_name'])</span><span id="c5fc" class="nk mj iq ng b gy np nm l nn no">for i in range(len(name_16)):</span><span id="92f4" class="nk mj iq ng b gy np nm l nn no">name_16[i] = name_16[i] + str(i)</span><span id="e4f1" class="nk mj iq ng b gy np nm l nn no">BPC16['location_name'] = name_16</span><span id="bd1a" class="nk mj iq ng b gy np nm l nn no">BPC16['id'] = np.array('week 2')</span><span id="cb03" class="nk mj iq ng b gy np nm l nn no">BPC23 = df0823_1[df0823_1['location_name']== 'Battery Park City']</span><span id="825a" class="nk mj iq ng b gy np nm l nn no">BPC23['visits_by_day'] = BPC23['visits_by_day'].transform(lambda x: literal_eval(x))</span><span id="13c0" class="nk mj iq ng b gy np nm l nn no">BPC23 = BPC23.explode('visits_by_day')</span><span id="4764" class="nk mj iq ng b gy np nm l nn no">name_23 = np.array(BPC23['location_name'])</span><span id="b4e8" class="nk mj iq ng b gy np nm l nn no">for i in range(len(name_23)):</span><span id="f9aa" class="nk mj iq ng b gy np nm l nn no">name_23[i] = name_23[i] + str(i)</span><span id="96b2" class="nk mj iq ng b gy np nm l nn no">BPC23['location_name'] = name_23</span><span id="008a" class="nk mj iq ng b gy np nm l nn no">BPC23['id'] = np.array('week 3')</span><span id="cb6b" class="nk mj iq ng b gy np nm l nn no">frames = [BPC02, BPC09, BPC16, BPC23]</span><span id="edb8" class="nk mj iq ng b gy np nm l nn no">BPC = pd.concat(frames)</span><span id="62fb" class="nk mj iq ng b gy np nm l nn no">BPC['visits_by_day'] = pd.to_numeric(BPC['visits_by_day'])</span><span id="8494" class="nk mj iq ng b gy np nm l nn no">BPC.head()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ny"><img src="../Images/e2bf3312695080c045550cedf8705e77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NiwyNrHAWDWh6j1vTbPjJg.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><p id="12a4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">使用之前来自纽约、新泽西和宾夕法尼亚受影响最严重地区的数据，我们继续按照记录对应的一周中的某一天对记录进行拆分，以消除求和导致的任何潜在偏差。我们选择了三个地点:炮台公园城、沃格林和温迪。绘制Battery Park City的结果时，我们可以看到以下可视化效果</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nz"><img src="../Images/5f6646d023bfb720d3b0df6143e6ee88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MLZZTaNCs3uWcR1mjZVGzw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><p id="3c36" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">看一下巴特利公园市的日常生活，特别是过去四周的生活，可以提供一种基本的标准来看待许多原因。第一个原因可以归因于这样一个事实，即该位置只是一个高档公寓住宅，这意味着没有理由在暴风雨前后大量游客前来寻求临时住所和食物等物品。这使得该位置可以作为飓风影响游客数据的一种地面实况。从上面的视觉化图像中，我们可以看到，在第三周的中期，该地区的游客数量明显下降，这可能与该地区在这一特定时间内经历的暴雨有关。我们还可以看到，随着风暴在本周末的消退，游客人数将会激增，人们可以返回旅游景点。另一个值得注意的趋势是，接近第二周结束时，到该地点的游客有所增加，这可能是因为在风暴来临之前，大量的人来到该地点寻求安全。为了更好地阐明这种可视化，我们决定绘制几周内访问者指标的差异，并看到这些结果，这些结果以更容易理解的方式给出了相同的分析</p><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="49d9" class="nk mj iq ng b gy nl nm l nn no">week0 = BPC[BPC['id']== 'week 0']</span><span id="8406" class="nk mj iq ng b gy np nm l nn no">week1 = BPC[BPC['id']== 'week 1']</span><span id="cc3b" class="nk mj iq ng b gy np nm l nn no">week2 = BPC[BPC['id']== 'week 2']</span><span id="04ad" class="nk mj iq ng b gy np nm l nn no">week3 = BPC[BPC['id']== 'week 3']</span><span id="33ab" class="nk mj iq ng b gy np nm l nn no">diff1 = list(np.array(pd.to_numeric(week1['visits_by_day'])) - np.array(pd.to_numeric(week0['visits_by_day'])))</span><span id="5081" class="nk mj iq ng b gy np nm l nn no">diff2 = list(np.array(pd.to_numeric(week2['visits_by_day'])) - np.array(pd.to_numeric(week1['visits_by_day'])))</span><span id="f3a4" class="nk mj iq ng b gy np nm l nn no">diff3 = list(np.array(pd.to_numeric(week2['visits_by_day'])) - np.array(pd.to_numeric(week3['visits_by_day'])))</span><span id="631f" class="nk mj iq ng b gy np nm l nn no">combineddiff = list(diff1) + list(diff2) + list(diff3)</span><span id="03dd" class="nk mj iq ng b gy np nm l nn no">location = np.array(BPC['location_name'])</span><span id="94c6" class="nk mj iq ng b gy np nm l nn no">data= {</span><span id="ea42" class="nk mj iq ng b gy np nm l nn no">'Name': list(location[0:21]),</span><span id="02c0" class="nk mj iq ng b gy np nm l nn no">'visitor diff': combineddiff,</span><span id="fbfc" class="nk mj iq ng b gy np nm l nn no">'week': list(np.array(["Week 1 - Week 0"] * 7))+  list(np.array(["Week 2 - Week 1"] * 7))+ list(np.array(["Week 3 - Week 2"] * 7))</span><span id="fe2e" class="nk mj iq ng b gy np nm l nn no">}</span><span id="16ac" class="nk mj iq ng b gy np nm l nn no">diffdf = pd.DataFrame(data = data)</span><span id="1646" class="nk mj iq ng b gy np nm l nn no">diffdf.head()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oa"><img src="../Images/ce7fac8467daa14abe33e8a2e83e0ca6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JL1DdtnqcSKNZoGUZ1_ecA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><p id="c40d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">下一步是对Walgreens进行同样的分析，结果看起来如下</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ob"><img src="../Images/a652cfe66ea1acf9b731676c42306fbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1CbVSnHgzPXQ6cCBK5RaYw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nv"><img src="../Images/b5ed49a349bdca6ed7048ba6d5d3bc23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i-2c_RAVrghnkZZfdncM-A.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><p id="cd1b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">对于本节的第二个分析，我选择了像Walgreens这样的便利店，看看风暴的存在如何影响访问量。通过这个特殊的数据显示几天没有访客的数据，我们可以看到两个趋势。我们首先可以看到，在风暴到来的前一天，游客数量激增。本周随后的几天显示，由于风暴的存在，游客数量急剧下降。另一个可以看到的趋势是，在风暴过去后，商店的访客会出现巨大的高峰，因为人们试图在风暴过去后找到材料。</p><p id="49d2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">该分析的第三部分是在圣卡洛斯酒店进行的，结果可以通过以下可视化效果看到:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oc"><img src="../Images/88fc6fed29026a75eedff642a1420e24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zMaAxkueZF4KG8XnnxLJbQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nx"><img src="../Images/bd439446bfec1b115173ede88c75b2d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dtORiuTfufs5IectaZktjQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><p id="3555" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">作为本项目中可以探索的POI类型的最后一个示例，我们可以看看纽约市的圣卡洛斯酒店。从这个特殊的POI中，我们可以看到人们在酒店临时避难的需求如何在风暴前几周推高游客指标，以及如何在风暴后几周影响游客指标。从上面的图像中我们可以看到，酒店的游客数量在八月的第一周达到高峰，然后在接下来的几周，当风暴接近城市时，游客数量会显著下降。我们可以看到，在第3周，风暴实际到达该城市，游客指标出现显著下降，从而表明人们如何在风暴前在酒店避难，并在暴雨期间没有离开参观POI。在风暴平息后的一周，我们可以看到该地点的游客数量仍然低于前几周，表明风暴对POI游客数量的负面影响</p><h1 id="9a18" class="mi mj iq bd mk ml od mn mo mp oe mr ms kf of kg mu ki og kj mw kl oh km my mz bi translated">结论:</h1><p id="aeed" class="pw-post-body-paragraph lf lg iq lh b li na ka lk ll nb kd ln lo nc lq lr ls nd lu lv lw ne ly lz ma ij bi translated">从这一分析中，我们能够看到访客指标随着飓风亨利的到来而波动的方式，并显示出SafeGraph每周模式数据在协助此类分析方面的潜力。在本系列的下一部分，我们将再次使用每周模式数据来探索飓风Ida在受灾严重的州(如路易斯安那州)的影响。</p><p id="ebe4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja"> <em class="oi">提问？</em>T3】</strong></p><p id="4a83" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我邀请你在<a class="ae le" href="https://www.safegraph.com/academics" rel="noopener ugc nofollow" target="_blank"> SafeGraph社区</a>的<strong class="lh ja"> #help </strong>频道问他们，这是一个为数据爱好者提供的免费Slack社区。获得支持、共享您的工作或与GIS社区中的其他人联系。通过SafeGraph社区，学者们可以免费访问美国、英国和加拿大700多万家企业的数据。</p></div></div>    
</body>
</html>