<html>
<head>
<title>Unleash The Power of Databricks CLI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">释放Databricks CLI的威力</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/unleash-the-power-of-databricks-cli-59480868eb0e?source=collection_archive---------26-----------------------#2021-07-04">https://towardsdatascience.com/unleash-the-power-of-databricks-cli-59480868eb0e?source=collection_archive---------26-----------------------#2021-07-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1038" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从您的控制台舒适地管理您的Databricks工作区！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bbcd06756af05bf15b22fe00f805524b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uoKyAHjqKi4kFEPpByoTSA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@laundemrl?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的</a>Launde Morel拍摄</p></figure><p id="2522" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">如果我告诉您，您可以从一个命令行控制台控制所有数据块资产，会怎么样？</em></p><p id="a58b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Databricks已经是数据工程师武库中一个非常强大的工具。它在分析方面的成就令人印象深刻，有些人甚至可以说是革命性的。</p><p id="b1b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个<strong class="lb iu">数据块工作空间</strong>本质上是一个管理所有数据块资产的环境。工作区允许您组织笔记本、表格、群集，并帮助管理作业。</p><p id="77db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然界面非常光滑和用户友好，但像导出/导入笔记本、启动集群、尝试将每个笔记本链接到您的git repo这样的事情感觉更像是痛苦的体力劳动。</p><p id="f1c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这变得令人毛骨悚然，尤其是如果你必须在你的平台上管理多个工作区，并且很难跟踪你的浏览器中打开的所有小标签。</p><p id="70f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">要是有办法从一个地方管理您所有的工作空间就好了。值得庆幸的是有，并且像所有的好东西一样，这个是以python包的形式出现的。</strong></p><h1 id="8be3" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">如何配置Databricks CLI</h1><p id="4083" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Databricks-CLI是一个开源库，可以使用pip命令安装。</p><p id="840d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用适合您的python版本的pip版本运行<code class="fe mt mu mv mw b">pip install databricks-cli</code>。</p><p id="4ca5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你安装了库，你可以使用<code class="fe mt mu mv mw b">databricks -- version</code>列出版本</p><p id="a15b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要开始编写CLI命令，您必须首先设置要管理的Databricks工作区的身份验证。这必须只做一次。</p><p id="332e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将以<strong class="lb iu"> Azure Databricks </strong>为例展示以下步骤，但这些步骤在任何托管Databricks服务上都非常相似。</p><p id="9de2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以使用<strong class="lb iu"> Databricks个人访问令牌</strong>设置身份验证。这个令牌可以直接从工作区生成。</p><ol class=""><li id="46d7" class="mx my it lb b lc ld lf lg li mz lm na lq nb lu nc nd ne nf bi translated">点击工作区中的用户资料图标，并选择<strong class="lb iu">用户设置</strong></li><li id="3e3f" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">您将看到一个选项<strong class="lb iu">生成新令牌</strong></li><li id="2992" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">设置生存期并生成令牌。记得复制令牌。</li><li id="206b" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">从浏览器中获取工作区的URL，格式为<code class="fe mt mu mv mw b">https://&lt;instance-name&gt;.cloud.databricks.com</code></li></ol><p id="14ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以通过在cmd行上运行<code class="fe mt mu mv mw b">databricks configure --token</code>在本地机器上配置认证。系统会提示您输入<code class="fe mt mu mv mw b">Databricks Host</code>粘贴工作区的URL。接下来，系统会提示您输入<code class="fe mt mu mv mw b">Token</code>，粘贴您生成的令牌。</p><p id="698d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要快速检查认证是否有效，运行命令<code class="fe mt mu mv mw b">databricks workspace list</code>，如果一切正常，您必须能够在控制台上列出您的数据块工作区中的所有目录。</p><p id="a84d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果您希望管理属于不同环境的多个工作区，或者您为多个客户端工作，并且每个客户端都有自己的专用工作区，那么这将使您只能管理单个工作区。</p><p id="36a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过设置<strong class="lb iu">连接配置文件</strong>在控制台上进行配置。要添加连接配置文件，请设置唯一的名称来标识特定的工作区。例如开发或UAT工作区。</p><ol class=""><li id="e0d8" class="mx my it lb b lc ld lf lg li mz lm na lq nb lu nc nd ne nf bi translated">运行<code class="fe mt mu mv mw b">databricks configure --token --profile &lt;&lt;profile_name&gt;&gt;</code>这就像为你的每个工作区创建一个别名，这样CLI就能记住哪个是哪个。</li><li id="c7d6" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">像之前一样输入主机名和令牌。</li><li id="9f7c" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">要使用此连接配置文件，您只需用<code class="fe mt mu mv mw b">--profile &lt;&lt;profile_name&gt;&gt;</code>来补充您想要运行的每个CLI命令</li><li id="512e" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">要确认只需运行<code class="fe mt mu mv mw b">databricks workspace list --profile &lt;&lt;profile_name&gt;&gt;</code></li><li id="7166" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">要切换到另一个工作空间，只需更改配置文件</li></ol><p id="12cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是它在游戏机上的样子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/66958e6b75ce0d131fb67922d687ddcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9IK20WOR91GyQ9taHIMluw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如何配置Databricks CLI(图片由作者提供)</p></figure><p id="c307" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只需对所有工作区重复相同的配置步骤，并记住给每个工作区取一个唯一的名称，以便于识别。</p><p id="c7c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">提示:</strong>CLI将此配置作为<code class="fe mt mu mv mw b">.databrickscfg</code>存储在您机器中的一个文件中。如果您想通过控制台为每个工作区配置身份验证，只需手动编辑这个文件。文件看起来像这样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/befae3dbc7223c3fdad78d8afee9adc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DE-0BldIWcVIdjZH2eonXw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">的内容。databrickscfg文件(图片由作者提供)</p></figure><h1 id="57f9" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">如何使用CLI管理笔记本电脑</h1><p id="a292" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">CLI命令组合在一起，代表您可以管理的不同资产。您可以使用<code class="fe mt mu mv mw b">databricks &lt;&lt;group&gt;&gt; --help</code>列出特定组的子命令。组可以是<code class="fe mt mu mv mw b">fs</code>、<code class="fe mt mu mv mw b">clusters</code>、<code class="fe mt mu mv mw b">workspaces </code>等等。要列出文件系统的子命令，只需运行<code class="fe mt mu mv mw b">databricks fs --help</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/8c2414cc1d7f682bf67102eee2dedc22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*1Mgo7c4FOp-2isa8YMNneA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据块文件系统子命令(图片由作者提供)</p></figure><p id="7cf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您最想做的一件事是列出您工作区中的所有笔记本，并可能将它们导出到您的本地机器中，然后您可以轻松地将其与git存储库集成。</p><ol class=""><li id="68d6" class="mx my it lb b lc ld lf lg li mz lm na lq nb lu nc nd ne nf bi translated"><strong class="lb iu">使用<code class="fe mt mu mv mw b">databricks workspace list --profile &lt;&lt;profile_name&gt;&gt;</code>列出你工作区中的所有文件夹</strong></li><li id="c2d0" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated"><strong class="lb iu">使用<code class="fe mt mu mv mw b">databricks workspace export_dir /&lt;&lt;directory_in_databricks&gt;&gt; &lt;&lt;Target_path&gt;&gt; --profile &lt;&lt;profile_name&gt;&gt;</code>递归导出工作区目录中的所有笔记本</strong>这会将所选目录中的所有笔记本导出到您机器上的目标路径中。</li></ol><p id="0d3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，您可以导出单个笔记本，也可以轻松地将笔记本或目录导入工作区。这里有一个与工作空间相关的命令<a class="ae ky" href="https://docs.databricks.com/dev-tools/cli/workspace-cli.html" rel="noopener ugc nofollow" target="_blank">的详尽列表，您可以尝试一下。</a></p><h1 id="17ef" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">如何使用CLI管理集群</h1><p id="fcfb" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">数据工程师通常会花大量时间管理集群，通常一天中，我必须在许多不同的工作区启动集群，它们需要时间预热。过了一会儿，事情变得如此混乱，以至于你不记得你最初打算做什么。</p><p id="1494" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Databricks CLI允许您从控制台管理所有集群，而不必访问每个工作区。这无疑为你节省了大量宝贵的时间，并清理了你的浏览器标签。</p><ol class=""><li id="091b" class="mx my it lb b lc ld lf lg li mz lm na lq nb lu nc nd ne nf bi translated">您可以做的最简单的事情就是<strong class="lb iu">使用<code class="fe mt mu mv mw b">databricks clusters list --profile &lt;&lt;profile_name&gt;&gt;</code>列出工作区</strong>中的所有集群。它列出了工作区中的所有集群及其唯一的集群id和当前状态。</li><li id="dca6" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">一旦您有了集群id并知道了您的集群的状态，您就可以使用<code class="fe mt mu mv mw b">databricks clusters start --cluster-id &lt;&lt;id&gt;&gt; --profile &lt;&lt;profile_name&gt;&gt;</code>轻松地<strong class="lb iu">启动这些集群中的任何一个</strong>几分钟后，您的集群将全部预热完毕。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/94fc8be33ffd116f2a043bb4aee2f6f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SI_ZYT12_3qDBKtLl3FFlA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在CLI中管理集群(图片由作者提供)</p></figure><p id="ceec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用集群组命令，您可以做许多更有趣的事情，这里是与<a class="ae ky" href="https://docs.databricks.com/dev-tools/cli/clusters-cli.html" rel="noopener ugc nofollow" target="_blank">集群相关的</a> CLI命令的详尽列表。</p></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><h1 id="820f" class="lw lx it bd ly lz nw mb mc md nx mf mg jz ny ka mi kc nz kd mk kf oa kg mm mn bi translated">外卖食品</h1><p id="d648" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Databricks CLI是一种将一些乐趣引入管理Databricks的好方法，也是一种帮助我节省宝贵时间的工具，我可以将这些时间花在喝咖啡休息上。</p><p id="6bea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的收获:</p><ol class=""><li id="5e98" class="mx my it lb b lc ld lf lg li mz lm na lq nb lu nc nd ne nf bi translated">您可以在舒适的控制台上控制所有数据块资产。</li><li id="2802" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">您可以随时关注您的集群。</li><li id="3e81" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">您可以使用简单的命令创建、删除、启动集群并调整其大小，而无需导航到工作区。</li></ol><p id="59d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇博客中列出的命令只是日常任务中微不足道的几个。您可以深入研究Databricks文档，尝试一些新的东西，或者用它构建一个完整的应用程序。</p><p id="b6c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您是一名数据工程师，请将Databricks CLI添加到您已经令人印象深刻且详尽的工具列表中，我保证您不会后悔。</p><p id="b652" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请随意问我关于这篇文章的任何问题，我很想知道你对Databricks CLI的看法。</p></div></div>    
</body>
</html>