<html>
<head>
<title>Cleaning and Preparing Marketing Data in R Prior to Modelling or Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在建模或分析之前，清理和准备R中的营销数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/cleaning-and-preparing-marketing-data-in-r-prior-to-machine-learning-or-analysis-ec1a12079f1?source=collection_archive---------11-----------------------#2021-11-17">https://towardsdatascience.com/cleaning-and-preparing-marketing-data-in-r-prior-to-machine-learning-or-analysis-ec1a12079f1?source=collection_archive---------11-----------------------#2021-11-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="35b1" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="5bac" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated"><em class="ko">一个基本的、循序渐进的指南，帮助你清理R </em>中典型的杂乱营销数据</h2></div><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/c1ed158ebb55e869c43fa415e0f5d461.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sYGPar_sFFV7y8XkPUnOKw.jpeg"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">照片由<a class="ae lf" href="https://unsplash.com/@alexander_tsang?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">亚历山大·曾</a>在<a class="ae lf" href="https://unsplash.com/collections/1920918/minimal-architecture?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="192a" class="lg lh iq bd li lj lk ll lm ln lo lp lq kf lr kg ls ki lt kj lu kl lv km lw lx bi translated"><strong class="ak"> TLDR </strong></h1><p id="0cf4" class="pw-post-body-paragraph ly lz iq ma b mb mc ka md me mf kd mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">本文着眼于在分析或输入ML模型之前处理R中杂乱数据的基本工作流程。具体来说，它将讨论:</p><ul class=""><li id="8c56" class="mu mv iq ma b mb mw me mx mh my ml mz mp na mt nb nc nd ne bi translated">正确导入csv数据</li><li id="f4c9" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated">添加、删除和重命名列</li><li id="1818" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated">识别独特性，处理重复的价值和NAs</li><li id="cc32" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated">一致的大小写和格式</li><li id="bb08" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated">查找和替换字符串</li><li id="c140" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated">处理不同的日期格式🙀！</li><li id="b32a" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated">将不同的数据集合并成一个</li><li id="7f84" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated">将每日数据转换为每周数据</li><li id="e898" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated">将长数据转换为宽格式</li></ul><p id="92a9" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">我一直深入到基础，一步一步地帮助新的R用户一行一行地掌握R。如果时间允许的话，我希望很快能把这变成一个关于营销组合建模的系列🤗！</p><h1 id="165f" class="lg lh iq bd li lj lk ll lm ln lo lp lq kf lr kg ls ki lt kj lu kl lv km lw lx bi translated"><strong class="ak">挑战</strong></h1><p id="14c3" class="pw-post-body-paragraph ly lz iq ma b mb mc ka md me mf kd mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">在本练习中，我特意设置了以下挑战:</p><ul class=""><li id="e480" class="mu mv iq ma b mb mw me mx mh my ml mz mp na mt nb nc nd ne bi translated">使用两个不同的数据集，这两个数据集都被认为是混乱的</li><li id="fb0e" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated">尽可能坚持使用<strong class="ma ja">底座/默认R </strong></li><li id="3e5b" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated">尽可能多地注释代码</li></ul></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="baf6" class="lg lh iq bd li lj nu ll lm ln nv lp lq kf nw kg ls ki nx kj lu kl ny km lw lx bi translated">让我们先解决这个问题:营销数据总是混乱的。</h1><p id="a1a1" class="pw-post-body-paragraph ly lz iq ma b mb mc ka md me mf kd mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">为什么？这是因为这些数据通常存放在多个平台上，有些在线，有些离线，全部由不同的团队、外部合作伙伴等管理。简直是<em class="nz">遍地</em>。</p><p id="bf98" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">让我们举例说明:如果你是一名负责衡量数字营销活动有效性的分析师，你可能需要从Google Analytics收集网站表现数据，从Search Ads 360或Tradedesk收集广告表现数据，然后从CRM或SQL数据库检索客户数据及其订单。</p><p id="869a" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">接受会有不完整的数据。将会有NAs或许多丢失的值。将会有格式和结构问题。有些数据甚至可能不是你所想的那样(嘘！看到那个叫做“转换”的专栏了吗这不是收到的查询总数，实际上是衡量用户点击<em class="nz">提交查询按钮的次数——查询是否成功是另一回事🙄。)</em></p><p id="8ca9" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">在我们可以在任何建模或分析中可行地使用这些数据之前，我们需要擦洗、清理和整理这些数据。我们开始吧！💪</p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="ee4c" class="lg lh iq bd li lj nu ll lm ln nv lp lq kf nw kg ls ki nx kj lu kl ny km lw lx bi translated">与R中混乱的数据争论</h1><h2 id="2e89" class="oa lh iq bd li ob oc dn lm od oe dp lq mh of og ls ml oh oi lu mp oj ok lw iw bi translated"><strong class="ak">数据集</strong></h2><p id="831c" class="pw-post-body-paragraph ly lz iq ma b mb mc ka md me mf kd mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">在本练习中，我们将查看两个数据集:</p><ul class=""><li id="9a96" class="mu mv iq ma b mb mw me mx mh my ml mz mp na mt nb nc nd ne bi translated">一个是每日营销绩效数据，具有典型的指标，如日期、渠道、每日支出、展示、转化、点击等。我们可以假设这来自一个分析平台。</li><li id="7f70" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated">另一个是日常销售数据(订单id、收入、税收、运输等)。我们可以假设这来自一个客户关系管理系统。</li><li id="3178" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated">这两个数据集都可以被认为是杂乱的(你马上就会明白为什么！🤭)</li></ul><blockquote class="ol om on"><p id="1338" class="ly lz nz ma b mb mw ka md me mx kd mg oo nk mj mk op nl mn mo oq nm mr ms mt ij bi translated">👉你可以在这里访问Kaggle <a class="ae lf" href="https://www.kaggle.com/fehmifratpolat/marketing-report" rel="noopener ugc nofollow" target="_blank">上的数据集。感谢Firat，数据集所有者，感谢他让我在帖子中使用它！</a></p></blockquote><h2 id="1cb6" class="oa lh iq bd li ob oc dn lm od oe dp lq mh of og ls ml oh oi lu mp oj ok lw iw bi translated"><strong class="ak">使用基本/默认R </strong></h2><p id="1a2c" class="pw-post-body-paragraph ly lz iq ma b mb mc ka md me mf kd mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">我已经决定尽可能地坚持使用<strong class="ma ja">基地R </strong>。为什么？因为在使用尽可能少的R包时，我的目标是尽可能减少依赖。当你加载一个R包时，它有时也会在后台加载额外的库。这没有错，使用R的好处之一是我们可以在他人的工作基础上进行构建，并为社区做出贡献。然而，使用base R，这里讨论的许多任务都可以简单地(有时同样快速地)完成。</p><p id="31a6" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">也就是说，一些像View()、str()、aggregate()、merge()这样的函数在技术上不是base R，它们来自于已经默认加载的包(例如{utils}、{stats}等)。从这个意义上说，我们将把它们视为默认函数，并可以在这个挑战中使用它们。</p><p id="6f98" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">另外，我真诚地认为，如果这是您第一次尝试使用R，那么在直接进入tidyverse之前，学习R基础是很重要的。根据经验，我发现有R基础的基础非常有用。</p><h2 id="e674" class="oa lh iq bd li ob oc dn lm od oe dp lq mh of og ls ml oh oi lu mp oj ok lw iw bi translated"><strong class="ak">尽可能多的评论</strong></h2><p id="b14b" class="pw-post-body-paragraph ly lz iq ma b mb mc ka md me mf kd mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">我将尽可能地对我的代码进行注释，一行一行地注释，以帮助新的R用户更容易了解这一点。<strong class="ma ja">注释代码也应该是很好的练习btw！因为如果你要和你的团队共享代码模板，这有助于他们理解每个代码块或代码行的作用。</strong></p><h2 id="4af3" class="oa lh iq bd li ob oc dn lm od oe dp lq mh of og ls ml oh oi lu mp oj ok lw iw bi translated">加载数据</h2><p id="a71a" class="pw-post-body-paragraph ly lz iq ma b mb mc ka md me mf kd mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">我们有<a class="ae lf" href="https://www.kaggle.com/fehmifratpolat/marketing-report" rel="noopener ugc nofollow" target="_blank"> 2个数据集</a>。让我们下载这些CSV，在R中加载它们，看看它们是什么样子的:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="58cc" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">第一行主要使用read.csv()函数读取文件，然后将其保存到名为<strong class="ma ja"> marketing_df </strong>的数据帧中。</p><p id="d273" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">下一行中的<a class="ae lf" href="https://www.rdocumentation.org/packages/utils/versions/3.6.2/topics/View" rel="noopener ugc nofollow" target="_blank"> View() </a>函数(注意大写字母“V”)应该会打开R中的文件，这样您就可以查看它了:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ot"><img src="../Images/00c9b4924331534d78b007d2e74bfacc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O-TkuK1BHDhWTEktLvo5CA.png"/></div></div></figure><p id="cbce" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">呸！数据看起来乱糟糟的！CSV文件可以用不同的分隔符保存。默认情况下，CSV以逗号分隔(因此缩写为😉)但是这个是用分号隔开的，就像截图中的分号可以看到的。让我们再次加载数据，这次指定分隔符，如下所示:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="or os l"/></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ou"><img src="../Images/d5921f1a9027d9542920e55587fc4a08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9-96y5V-b6-2ma-_vRBW9w.png"/></div></div></figure><p id="571b" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">好多了！我们现在可以看到每个值在各自的列中！</p><p id="bac8" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">现在我们已经处理了营销数据，让我们获取订单数据并将其保存到名为<strong class="ma ja"> orders_df: </strong>的数据帧中</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="or os l"/></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ov"><img src="../Images/bb3c7b644c5c5a23ce5a519e91ec681a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*23MYdyif15K-GR0ELfMoag.png"/></div></div></figure><p id="f7a8" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">很好，我们已经加载了两个数据集。显然，我们可以看到有工作要做，以清理他们。让我们首先处理营销数据集，然后我们将处理订单数据集。</p><h2 id="5f96" class="oa lh iq bd li ob oc dn lm od oe dp lq mh of og ls ml oh oi lu mp oj ok lw iw bi translated">清理营销数据</h2><p id="7576" class="pw-post-body-paragraph ly lz iq ma b mb mc ka md me mf kd mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated"><strong class="ma ja"> marketing_df </strong>数据框架有许多有用的列。为了便于说明，假设我们只关心以下3列:</p><ul class=""><li id="acad" class="mu mv iq ma b mb mw me mx mh my ml mz mp na mt nb nc nd ne bi translated">周期代码(第一列)</li><li id="3247" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated">平台代码(第4列)</li><li id="24e7" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated">营销投资(第7列)。</li></ul><p id="fc80" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">我们将抓取这些列，并将它们保存到一个名为<strong class="ma ja"> marketing_df_clean </strong>的新数据框架中。我们还想用更容易理解的名称来重命名这些列。</p><p id="34dc" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">我们走吧:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="c66b" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">所以我们把数据框从这里转了过来:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ou"><img src="../Images/d5921f1a9027d9542920e55587fc4a08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9-96y5V-b6-2ma-_vRBW9w.png"/></div></div></figure><p id="5acc" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">对此👇</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/bede7d2a6a32c1c0b9c1a47f9f4b9d3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*meRrPfN5M-MSeRv-L92t8Q.png"/></div></figure><p id="5e14" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">我们将它保存到一个更小的数据框架中，名为<strong class="ma ja"> marketing_df_clean </strong>，只有3列。查看数据，滚动并注意这些值是如何显示的。你会注意到几件事:</p><ul class=""><li id="6a8b" class="mu mv iq ma b mb mw me mx mh my ml mz mp na mt nb nc nd ne bi translated">日期很奇怪。我的意思是，我们当然认识到它们是日期，但它们也可能被R解读为其他任何东西。我们需要将它们标准化成合适的日期格式。</li><li id="1f21" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated">通道列中的值有各种大小写。让我们将它们都强制转换为小写，以保持一致。<br/>还有一些价值需要更新，这就是<strong class="ma ja">领域知识派上用场的地方:</strong>由于付费媒体已经被定义(如脸书、Adwords)，那么“非付费”可以被视为“有机的”。“未跟踪”可能意味着“直接”，而“silverpop”是一个电子邮件平台，因此可以重命名为“电子邮件”。</li><li id="bf54" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated">如果您仔细查看支出列，您还会注意到值是用逗号分隔的。例如20，29。</li></ul><p id="a512" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">您可以通过运行以下代码行来检查R是如何读取这些值的:</p><pre class="kq kr ks kt gt ox oy oz pa aw pb bi"><span id="290e" class="oa lh iq oy b gy pc pd l pe pf">str(marketing_df_clean)</span></pre><p id="a23a" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">这个<a class="ae lf" href="https://www.rdocumentation.org/packages/utils/versions/3.6.2/topics/str" rel="noopener ugc nofollow" target="_blank"> str() </a>函数向您展示了R如何查看R对象的内部结构，在本例中是一个包含3列的数据帧:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi pg"><img src="../Images/e12c07211546529d5b0d68675f68abeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TnQXVyfKF6igYEB4f-oqBg.png"/></div></div></figure><p id="0d51" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">这个输出显示，R错误地将日期列读取为整数，而不是格式日期。花被读作文字是不正确的！花费应该是数字。这可能是因为数字之间的逗号导致它被读为文本。</p><p id="60a1" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">基于以上所述，我们知道我们需要做以下工作:</p><ol class=""><li id="58a7" class="mu mv iq ma b mb mw me mx mh my ml mz mp na mt ph nc nd ne bi translated">设置日期列的格式，以便将其正确识别为日期。不幸的是，日期格式化真的很麻烦😡。因此对于这一部分，我将使用奇妙的{lubridate}包将这些日期强制转换成正确的格式。公平地说，我认为这是我在这个练习中使用的唯一一个非基本/非默认包。我们将最后安排日期。</li><li id="1809" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt ph nc nd ne bi translated">强制频道列中的所有文本值小写</li><li id="cb31" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt ph nc nd ne bi translated">一旦小写，检查通道列，查看所有可能的唯一值</li><li id="445b" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt ph nc nd ne bi translated">选择我们想要重命名的频道</li><li id="8187" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt ph nc nd ne bi translated">最后，确保花费一栏被识别为数字。</li></ol><p id="b836" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">这是:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="or os l"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="ak">注意</strong>:是的，我经常使用str()、View()和head()，我建议你也这样做。它帮助我检查我没有在争论中损坏我的数据。</p></figure><p id="e388" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">然后，用StatQuest的<a class="ae lf" href="https://www.youtube.com/user/joshstarmer" rel="noopener ugc nofollow" target="_blank">乔希·斯塔默</a>的睿智的话来说:</p><blockquote class="pi"><p id="e8cb" class="pj pk iq bd pl pm pn po pp pq pr mt dk translated">嘭！！！💥</p></blockquote><figure class="pt pu pv pw px ku gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/eb99a74a9b013cf679e9ee31300c7ea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*JY6MyWb61bl5PnyEOBbppg.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">你可以在r中点击来排序你的表，你也可以过滤和搜索。</p></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi py"><img src="../Images/a023208e42df854724d183b6cbb8811d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F0eF5kKCO0cqmCZ_jQTMhg.png"/></div></div></figure><p id="168c" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">日期现在可以正确格式化并被识别。花费现在被正确地识别为数字。我们在做生意！！</p><p id="97d7" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">呃，实际上不完全是。再次查看数据-似乎有重复的行(例如，同一个频道，同一天)。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi pz"><img src="../Images/c5c8c340e849617e8f74a4328cf7c65c.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*_wANB_8dx_jy2tHhrawKAQ.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">还没有脱离险境</p></figure><p id="36f9" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">我们要确保每天只有一个渠道，支出是该渠道在这一天的总支出。回想一下，我们之前已经删除了不需要的其他列。这些列用于进一步细分数据(例如，按桌面或移动设备)。当我们删除这些列时，我们需要记住按渠道合计当天的支出。</p><p id="2132" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated"><a class="ae lf" href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/aggregate" rel="noopener ugc nofollow" target="_blank"> aggregate() </a>函数很好地完成了这一任务:</p><pre class="kq kr ks kt gt ox oy oz pa aw pb bi"><span id="d84a" class="oa lh iq oy b gy pc pd l pe pf">marketing_df_clean &lt;- aggregate(spend ~ date + channel, data = marketing_df_clean, sum)</span></pre><p id="7d98" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">这给了我们一张漂亮的桌子，像这样:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi qa"><img src="../Images/bb5c68406292594d71aa79714f1ae099.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*4B-Ur838jaziiAFYSfu8CQ.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">每天按渠道列出的总支出。没有重复。</p></figure><p id="cbc3" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">耶！我们现在已经获得了每个频道每天花费的清晰数据集。</p><h2 id="f405" class="oa lh iq bd li ob oc dn lm od oe dp lq mh of og ls ml oh oi lu mp oj ok lw iw bi translated">清除订单数据</h2><p id="1de6" class="pw-post-body-paragraph ly lz iq ma b mb mc ka md me mf kd mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">现在，让我们执行与上面相同的步骤，但是这次使用的是订单数据。为了提醒我们自己，<strong class="ma ja"> orders_df </strong> dataframe看起来像这样:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi qb"><img src="../Images/0fd792f3c615df517827952a61541cd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3jdT68v2cKDUrxb9ZWS-kg.png"/></div></div></figure><p id="0b98" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">在本练习中，我们只关心createdAt(第2)、platformCode(第4)和revenue(第18)列。</p><p id="cd18" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">还要注意，日期后面附加了这些时间戳。在使用{lubridate}将日期格式化为我们之前使用的一致的年-月-日格式之前，我们需要先去掉这些内容。</p><p id="db9b" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">除此之外，我们可以对订单数据使用与营销数据相同的工作流程，如下所示:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="4ade" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">这应该会产生这个干净的表:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi qc"><img src="../Images/195dfbb3fe1bcd8b6dfaf3a4dca48f05.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*Nqw0uyXtf5PXqbB5x3h2YA.png"/></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi qd"><img src="../Images/ac11e5120a01d4ca40e56e557abe6412.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nyY-s5xLeEb7NBwat5fX2g.png"/></div></div></figure><p id="1d5c" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">r还将日期列识别为日期格式，收入是数字。订单数据现在完成了！对营销和订单数据进行排序后，我们现在可以将它们转换成每周数据集。</p><h2 id="4d15" class="oa lh iq bd li ob oc dn lm od oe dp lq mh of og ls ml oh oi lu mp oj ok lw iw bi translated"><strong class="ak">将每日数据转换为每周数据</strong></h2><p id="743b" class="pw-post-body-paragraph ly lz iq ma b mb mc ka md me mf kd mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">将每日数据集转换为每周数据集有很多原因。在<strong class="ma ja">营销组合建模</strong>和数字营销的一般预测中，通常使用每周数据，因为并非所有渠道都能在同一天对销售产生直接影响，转化可能发生在最初印象后的第二、第三或第四天。</p><p id="851e" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">我们可以在r中很容易地做到这一点</p><ol class=""><li id="8344" class="mu mv iq ma b mb mw me mx mh my ml mz mp na mt ph nc nd ne bi translated">首先，我们将创建一个名为“week”的新列。这将表示日期所在的一年中的第几周。例如，2020年3月15日是2020年的第11周。(我发现<a class="ae lf" href="https://www.timeanddate.com/date/weeknumber.html" rel="noopener ugc nofollow" target="_blank">这个网站</a>真的很有助于快速查周。)</li><li id="016b" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt ph nc nd ne bi translated">然后我们将创建一个名为“monthyear”的新列。对于日期2020–03–15，month year将输出“03–2020”。</li><li id="4d5b" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt ph nc nd ne bi translated">我们将对营销和订单数据都这样做👇</li></ol><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="3ae3" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">你现在应该有2个新的数据帧。</p><p id="49ba" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated"><strong class="ma ja">市场营销_ df _周刊</strong>:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi qe"><img src="../Images/c38983f67e5d642352f704785999a3cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wvtzheO1wtr2C_GGkFMEXA.png"/></div></div></figure><p id="12b8" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">和<strong class="ma ja"> orders_df_weekly: </strong></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi qf"><img src="../Images/34e13b240d82c497952d9d9f961135e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JFwPNhzNgPU8CSUVlLtQ9g.png"/></div></div></figure><p id="9b16" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">如您所见，这些值还没有按周进行聚合和求和。我们只是在每个数据帧中引入了2个新列来告诉我们每个特定日期属于哪一周。</p><p id="6baf" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">接下来，我们将把营销和订单数据连接到一个数据框架中，我们称之为<strong class="ma ja"> weekly_df </strong>。我们使用<a class="ae lf" href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/merge" rel="noopener ugc nofollow" target="_blank"> merge() </a>函数来实现这一点:</p><pre class="kq kr ks kt gt ox oy oz pa aw pb bi"><span id="6b66" class="oa lh iq oy b gy pc pd l pe pf">weekly_df &lt;- merge(marketing_df_weekly, orders_df_weekly)<br/>View(weekly_df)</span></pre><p id="f768" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">使用上面的代码行应该会得到这个结果👇—每天按渠道列出支出和收入的表格。“星期”和“月份”列显示了日期所属的星期数和月份。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi qg"><img src="../Images/200dc10d1ced40d5ec1e5140f1e9558b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cxs_3LAKscb3u4s95m1fIQ.png"/></div></div></figure><p id="4525" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">现在，我们可以按周汇总支出和收入，如下所示:</p><ol class=""><li id="ab2f" class="mu mv iq ma b mb mw me mx mh my ml mz mp na mt ph nc nd ne bi translated">按渠道合计每周所有支出。将其保存到名为<strong class="ma ja"> weekly_spend_df </strong>的数据帧中</li><li id="8e60" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt ph nc nd ne bi translated">按渠道汇总每周所有收入。将其保存到名为<strong class="ma ja"> weekly_rev_df </strong>的数据帧中</li><li id="81e8" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt ph nc nd ne bi translated">获取每周的第一天，将该列称为“weekdatestart”并保存到名为<strong class="ma ja"> weekly_df_dates </strong>的数据帧中。移除任何重复的行。</li><li id="353c" class="mu mv iq ma b mb nf me ng mh nh ml ni mp nj mt ph nc nd ne bi translated">将这3个数据帧合并成一个干净的每周聚合数据帧，称为<strong class="ma ja"> weekly_df_updated </strong>。</li></ol><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="84b8" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">太棒了。您现在应该会得到如下所示的数据帧:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi qh"><img src="../Images/6b8b572adcfdd4431bd56b37b0d5bdac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DXP1ovaleR5sAc6e7VjZvA.png"/></div></div></figure><p id="44af" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">坚持住！你注意到这有什么奇怪的吗🤔？</p><p id="1909" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">顾名思义，totalrevenuefortheweek 是该周的总收入，定义如下:</p><pre class="kq kr ks kt gt ox oy oz pa aw pb bi"><span id="79c8" class="oa lh iq oy b gy pc pd l pe pf">weekly_rev_df &lt;- aggregate(revenue ~ week, data = weekly_df, sum)</span></pre><p id="8f39" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">然而，<strong class="ma ja"> weeklyspend </strong>指的是给定一周特定渠道的总支出<em class="nz">，定义如下:</em></p><pre class="kq kr ks kt gt ox oy oz pa aw pb bi"><span id="ab8f" class="oa lh iq oy b gy pc pd l pe pf">weekly_spend_df &lt;- aggregate(spend ~ week + channel, data = weekly_df, sum)</span></pre><p id="a590" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">从上表可以看出，从2020年1月2日开始的一周，在“adwords”上花费70，326.29英镑产生了1，513，643英镑的收入。在同一周内，在“heurekacz”频道上花费262.32英镑获得了另外1，513，643英镑的收入！诸如此类。</p><p id="a031" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">👎这当然是不正确的！</p><p id="ddc0" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">我们想要展示的是，在给定的一周内，在adwords、电子邮件、rtbhouse和其他渠道上的支出的综合表现，<em class="nz"/>在该周总共产生了1，513，643英镑的收入。</p><p id="bbda" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">为了正确理解这一点，我们需要将这种长数据格式转换为宽数据格式。</p><h2 id="2773" class="oa lh iq bd li ob oc dn lm od oe dp lq mh of og ls ml oh oi lu mp oj ok lw iw bi translated">将长数据转换为宽数据</h2><p id="baa6" class="pw-post-body-paragraph ly lz iq ma b mb mc ka md me mf kd mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">将长数据转换成宽数据非常简单，反之亦然！基本的<a class="ae lf" href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/reshape" rel="noopener ugc nofollow" target="_blank"> reshape() </a>函数让你在一行代码中就能做到，就像这样:</p><pre class="kq kr ks kt gt ox oy oz pa aw pb bi"><span id="238c" class="oa lh iq oy b gy pc pd l pe pf">weekly_reshaped_channel &lt;- reshape(weekly_df_updated, idvar = c("weekdatestart","totalrevenueforweek"), timevar = "channel", direction = "wide")</span></pre><p id="cc16" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">当您查看(<strong class="ma ja">weekly _ reshaved _ channel</strong>)时，您应该会看到下表:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi qi"><img src="../Images/2bea76167bbaf321561006cce6a6431e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dzLS-7tjQ719ywEjq2Tc8A.png"/></div></div></figure><p id="8abd" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">这更有意义，因为您可以看到每周实现的总收入和该周每个渠道的支出！</p><h2 id="e150" class="oa lh iq bd li ob oc dn lm od oe dp lq mh of og ls ml oh oi lu mp oj ok lw iw bi translated"><strong class="ak">处理NAs </strong></h2><p id="ded3" class="pw-post-body-paragraph ly lz iq ma b mb mc ka md me mf kd mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">您可以使用<a class="ae lf" href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/print" rel="noopener ugc nofollow" target="_blank"> print() </a>查看控制台中的数据并检查NA值。或者，如果您喜欢像我们在本练习中所做的那样，以电子表格的方式查看它，只需使用View()即可:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ot"><img src="../Images/ea75bfe8a207293b55d21e0a19d9536e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6IQMK0HY986nucHYweHzPg.png"/></div></div></figure><p id="3a46" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">如果检测到NAs，您可以使用<a class="ae lf" href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/NA" rel="noopener ugc nofollow" target="_blank"> is.na() </a>将NA值替换为0，如下所示:</p><pre class="kq kr ks kt gt ox oy oz pa aw pb bi"><span id="5450" class="oa lh iq oy b gy pc pd l pe pf">#view the data and check for NA or missing values<br/>print(weekly_reshaped_channel)</span><span id="e323" class="oa lh iq oy b gy qj pd l pe pf">#if found, replace any NA with 0<br/>weekly_reshaped_channel[is.na(weekly_reshaped_channel)] &lt;- 0</span><span id="1595" class="oa lh iq oy b gy qj pd l pe pf">#check<br/>str(weekly_reshaped_channel)<br/>View(weekly_reshaped_channel)</span></pre><h2 id="577e" class="oa lh iq bd li ob oc dn lm od oe dp lq mh of og ls ml oh oi lu mp oj ok lw iw bi translated">结束了</h2><p id="e8f2" class="pw-post-body-paragraph ly lz iq ma b mb mc ka md me mf kd mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">👏干得好，一直到最后！我们终于得到了我们需要的数据集，我们可以用它来执行以后的建模。</p><h2 id="60af" class="oa lh iq bd li ob oc dn lm od oe dp lq mh of og ls ml oh oi lu mp oj ok lw iw bi translated">完整的R代码</h2><p id="d0bb" class="pw-post-body-paragraph ly lz iq ma b mb mc ka md me mf kd mg mh mi mj mk ml mm mn mo mp mq mr ms mt ij bi translated">👉从我的Github repo <a class="ae lf" href="https://github.com/Practical-ML/marketing-mix-modelling/blob/32f6a7a92626ee1e5a747f7a9bec398b7cfa258b/wrangling-messy-data-full-code.R" rel="noopener ugc nofollow" target="_blank">这里</a>获取完整的R代码。</p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><p id="d667" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">我希望这篇文章对你有所帮助。毫无疑问，有更快更好的方法来达到同样的最终结果，但这篇文章的目的是深入基础，帮助新的R用户掌握R。如果你做过类似的练习，并找到了更好的方法，请在评论中分享🤗！</p><p id="aa27" class="pw-post-body-paragraph ly lz iq ma b mb mw ka md me mx kd mg mh nk mj mk ml nl mn mo mp nm mr ms mt ij bi translated">我还想在下一篇文章中继续使用同样的数据来制作<strong class="ma ja">营销组合模型</strong>。我们会看到的。TTFN！</p></div></div>    
</body>
</html>