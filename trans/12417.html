<html>
<head>
<title>Image Enhancement Using GFPGAN</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 GFPGAN 的图像增强</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/image-enhancement-using-gfpgan-4210d6815055?source=collection_archive---------7-----------------------#2021-12-18">https://towardsdatascience.com/image-enhancement-using-gfpgan-4210d6815055?source=collection_archive---------7-----------------------#2021-12-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e6a4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用 GFPGAN 恢复模糊图像</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0f22e3a43262548416e57ee7c3027816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j4WP3I6_HWrqDJjdw60Xpw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:作者</p></figure><p id="5c7e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">随着使用深度学习的图像处理的出现，我们已经看到了 N 个预训练模型，它们不仅处理图像，还增强了它们的属性，你可能已经看到了多个为图像带来生命的深度赝品视频。</p><p id="0caa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">深度学习领域的主要进步之一，神经网络是生成性对抗网络的引入，它是深度假货和所有主要图像处理背后的大脑，增强了功能。</p><p id="8735" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">GAN 是一类机器学习框架，有助于生成与训练数据具有相同统计属性的新数据。监督学习模型由两个子模型组成，生成器模型用于生成新数据，鉴别器模型用于从训练数据中鉴别新数据。</p><p id="9358" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如今，GAN 因其增强图像、创建新图像或视频等功能而广受欢迎。有多个预先训练好的 GAN 模型，任何人都可以直接使用。有多种基于 GAN 的图像增强应用非常受欢迎。</p><p id="9380" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我们将讨论一个这样的预训练 GAN 模型，即生成面部先验生成对抗网络，它有助于恢复面部图像并在图像模糊时对其进行增强。它很容易使用，因为它是一个预先训练的模型，我们不需要再次训练它。我们将使用这个模型，并增强模糊的图像。</p><p id="57b7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们开始吧…</p><h1 id="8725" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">安装所需的库</h1><p id="aaf0" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我们将从使用 pip 安装安装依赖项和克隆 Github 存储库 GFPGAN 开始。下面给出的命令可以做到这一点。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="37b3" class="mw lv it ms b gy mx my l mz na"># Clone GFPGAN and enter the GFPGAN folder<br/>%cd /content<br/>!rm -rf GFPGAN<br/>!git clone <a class="ae nb" href="https://github.com/TencentARC/GFPGAN.git" rel="noopener ugc nofollow" target="_blank">https://github.com/TencentARC/GFPGAN.git</a><br/>%cd GFPGAN</span><span id="54d9" class="mw lv it ms b gy nc my l mz na"># Set up the environment<br/># Install basicsr - <a class="ae nb" href="https://github.com/xinntao/BasicSR" rel="noopener ugc nofollow" target="_blank">https://github.com/xinntao/BasicSR</a><br/># We use BasicSR for both training and inference<br/>!pip install basicsr<br/># Install facexlib - <a class="ae nb" href="https://github.com/xinntao/facexlib" rel="noopener ugc nofollow" target="_blank">https://github.com/xinntao/facexlib</a><br/># We use face detection and face restoration helper in the facexlib package<br/>!pip install facexlib<br/># Install other depencencies<br/>!pip install -r requirements.txt<br/>!python setup.py develop<br/>!pip install realesrgan  # used for enhancing the background (non-face) regions<br/># Download the pre-trained model<br/>!wget <a class="ae nb" href="https://github.com/TencentARC/GFPGAN/releases/download/v0.2.0/GFPGANCleanv1-NoCE-C2.pth" rel="noopener ugc nofollow" target="_blank">https://github.com/TencentARC/GFPGAN/releases/download/v0.2.0/GFPGANCleanv1-NoCE-C2.pth</a> -P experiments/pretrained_models</span></pre><h1 id="84d4" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">导入所需的库</h1><p id="445c" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在这一步中，我们将导入 GFPGAN 和映像恢复所需的所有库。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="4655" class="mw lv it ms b gy mx my l mz na">import os<br/>from google.colab import files<br/>import shutil</span></pre><h1 id="cb1d" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">上传图像</h1><p id="2bb4" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">现在，我们将从读取用户的图像开始。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="a46c" class="mw lv it ms b gy mx my l mz na"># upload your own images<br/>upload_folder = 'inputs/upload'</span><span id="a993" class="mw lv it ms b gy nc my l mz na">if os.path.isdir(upload_folder):<br/>    shutil.rmtree(upload_folder)<br/>os.mkdir(upload_folder)</span><span id="5bd4" class="mw lv it ms b gy nc my l mz na"># upload images<br/>uploaded = files.upload()<br/>for filename in uploaded.keys():<br/>  <br/>  dst_path = os.path.join(upload_folder, filename)<br/>  print(f'move {filename} to {dst_path}')<br/>  shutil.move(filename, dst_path)</span></pre><h1 id="dbd1" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">图像恢复</h1><p id="c6f5" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">上传图像后，让我们使用 GFPGAN 来恢复模糊的图像并增强它。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="08c9" class="mw lv it ms b gy mx my l mz na"># Now we use the GFPGAN to restore the above low-quality images<br/>!rm -rf results<br/>!python inference_gfpgan.py --upscale 2 --test_path inputs/upload --save_root results --model_path experiments/pretrained_models/GFPGANCleanv1-NoCE-C2.pth --bg_upsampler realesrgan</span><span id="ddec" class="mw lv it ms b gy nc my l mz na">!ls results/cmp</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0f22e3a43262548416e57ee7c3027816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j4WP3I6_HWrqDJjdw60Xpw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:作者</p></figure><h1 id="59bd" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">可视化增强的图像</h1><p id="f8bf" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">现在最后一步是可视化增强的图像，为了可视化我们将使用 cv2 和 matplotlib。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="1900" class="mw lv it ms b gy mx my l mz na"># Now we use the GFPGAN to restore the above low-quality images<br/># We use [Real-ESRGAN](<a class="ae nb" href="https://github.com/xinntao/Real-ESRGAN" rel="noopener ugc nofollow" target="_blank">https://github.com/xinntao/Real-ESRGAN</a>) for enhancing the background (non-face) regions<br/>!rm -rf results# We first visualize the cropped faces<br/># The left are the inputs images; the right are the results of GFPGAN</span><span id="5a41" class="mw lv it ms b gy nc my l mz na">import cv2<br/>import matplotlib.pyplot as plt<br/>def display(img1, img2):<br/>  fig = plt.figure(figsize=(25, 10))<br/>  ax1 = fig.add_subplot(1, 2, 1) <br/>  plt.title('Input image', fontsize=16)<br/>  ax1.axis('off')<br/>  ax2 = fig.add_subplot(1, 2, 2)<br/>  plt.title('GFPGAN output', fontsize=16)<br/>  ax2.axis('off')<br/>  ax1.imshow(img1)<br/>  ax2.imshow(img2)<br/>def imread(img_path):<br/>  img = cv2.imread(img_path)<br/>  img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)<br/>  return img</span><span id="5751" class="mw lv it ms b gy nc my l mz na"># display each image in the upload folder<br/>import os<br/>import glob</span><span id="b4b2" class="mw lv it ms b gy nc my l mz na">input_folder = 'results/cropped_faces'<br/>result_folder = 'results/restored_faces'<br/>input_list = sorted(glob.glob(os.path.join(input_folder, '*')))<br/>output_list = sorted(glob.glob(os.path.join(result_folder, '*')))<br/>for input_path, output_path in zip(input_list, output_list):<br/>  img_input = imread(input_path)<br/>  img_output = imread(output_path)<br/>  display(img_input, img_output)</span><span id="620f" class="mw lv it ms b gy nc my l mz na">!python inference_gfpgan.py --upscale 2 --test_path inputs/upload --save_root results --model_path experiments/pretrained_models/GFPGANCleanv1-NoCE-C2.pth --bg_upsampler realesrgan</span><span id="4d8c" class="mw lv it ms b gy nc my l mz na">!ls results/cmp</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/260dd1877061909816920bc3d1e51de0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VabGAOIjGgDaEC0Ne7M6OQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">复原图像(来源:作者)</p></figure><p id="e08b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里你可以看到我们使用 GFPGAN 恢复模糊图像是多么容易。</p><p id="cc45" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">用不同的图片试试，让我知道你在回复部分的评论。</p><p id="1fc6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本文是与<a class="ne nf ep" href="https://medium.com/u/40808d551f5a?source=post_page-----4210d6815055--------------------------------" rel="noopener" target="_blank"> Piyush Ingale </a>合作完成的。</p><h1 id="9232" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">在你走之前</h1><p id="ffb7" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated"><strong class="la iu"> <em class="ng">感谢</em> </strong> <em class="ng">的阅读！如果你想与我取得联系，请随时通过 hmix13@gmail.com 联系我或我的</em> <a class="ae nb" href="http://www.linkedin.com/in/himanshusharmads" rel="noopener ugc nofollow" target="_blank"> <strong class="la iu"> <em class="ng"> LinkedIn 个人资料</em> </strong> </a> <em class="ng">。可以查看我的</em><a class="ae nb" href="https://github.com/hmix13" rel="noopener ugc nofollow" target="_blank"><strong class="la iu"><em class="ng">Github</em></strong><em class="ng"/></a><em class="ng">简介针对不同的数据科学项目和包教程。还有，随意探索</em> <a class="ae nb" href="https://medium.com/@hmix13" rel="noopener"> <strong class="la iu"> <em class="ng">我的简介</em> </strong> </a> <em class="ng">，阅读我写过的与数据科学相关的不同文章。</em></p></div></div>    
</body>
</html>