<html>
<head>
<title>Getting Started with Weaviate Python Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Weaviate Python库入门</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/getting-started-with-weaviate-python-client-e85d14f19e4f?source=collection_archive---------14-----------------------#2021-04-07">https://towardsdatascience.com/getting-started-with-weaviate-python-client-e85d14f19e4f?source=collection_archive---------14-----------------------#2021-04-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3e96" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">关于新的基于机器学习的矢量搜索引擎的完整教程</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d677ed6e8a8a45e493925de6b9412ad4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*akHYKaEdaOUazZBmdoNlzg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由<a class="ae kv" href="https://pixabay.com/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=3501528" rel="noopener ugc nofollow" target="_blank">皮克斯拜</a>的<a class="ae kv" href="https://pixabay.com/users/ahmedgad-9403351/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=3501528" rel="noopener ugc nofollow" target="_blank">艾哈迈德·加德</a>拍摄</p></figure><p id="e1de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">0.新的更新。</p><ol class=""><li id="9ead" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">什么是Weaviate？</li><li id="30b2" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">可以用在哪里？</li><li id="648a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">有什么优势？</li><li id="fb03" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">什么是Weaviate Python客户端？</li><li id="a91b" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">如何在Weaviate集群中使用Weaviate Python客户端？</li></ol><ul class=""><li id="9498" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated">5.0.创建一个弱实例/集群。</li><li id="5cd1" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">5.1.连接到集群。</li><li id="49ba" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">5.2.获取数据并进行分析。</li><li id="49ac" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">5.3.创建适当的数据类型。</li><li id="7da6" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">5.4.加载数据。</li><li id="5308" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">5.5.查询数据。</li></ul></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h2 id="1b5d" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">0.新的更新。</h2><p id="2796" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">Weaviate-client版本3.0.0带来了一些新的变化，查看官方文档了解所有信息<a class="ae kv" href="https://weaviate-python-client.readthedocs.io/en/latest/changelog.html#version-3-0-0" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="b653" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">整篇文章现在包含了旧版本和新版本的例子(只有那些被改变的)。</p><h2 id="021a" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">1.什么是Weaviate？</h2><p id="e4b0" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">Weaviate是一个开源、云原生、模块化的实时矢量搜索引擎。它是为扩展你的机器学习模型而构建的。因为Weaviate是模块化的，所以你可以将其用于任何进行数据编码的机器学习模型。Weaviate带有可选的文本、图像和其他媒体类型的模块，可以根据您的任务和数据进行选择。此外，根据数据的种类，可以使用多个模块。更多信息<a class="ae kv" href="https://www.semi.technology/developers/weaviate/current/" rel="noopener ugc nofollow" target="_blank">点击这里</a>。</p><p id="63f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将使用<em class="nm">文本</em>模块来了解Weaviate最重要的功能和能力。文本模块，也称为<em class="nm"> text2vec-contextionary </em>，捕捉文本对象的语义，并将其置于一个概念超空间中。这允许进行语义搜索，与其他搜索引擎的“单词匹配搜索”形成对比。</p><p id="1d01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">欲了解更多关于Weaviate和SeMI技术公司的信息，请访问官方<a class="ae kv" href="https://www.semi.technology/" rel="noopener ugc nofollow" target="_blank">网站</a>。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h2 id="6ee0" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">2.可以用在哪里？</h2><p id="2a82" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">目前，Weaviate用于以下情况:</p><ul class=""><li id="75e8" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated">语义搜索，</li><li id="d5e1" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">相似性搜索，</li><li id="e9bb" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">图片搜索，</li><li id="e3db" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">电力推荐引擎，</li><li id="b4bc" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">电商搜索，</li><li id="5276" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">网络安全威胁分析，</li><li id="1be6" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">自动化数据协调，</li><li id="010a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">异常检测，</li><li id="540a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">ERP系统中的数据分类，</li></ul><p id="141b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以及更多的案例。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h2 id="f006" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">3.有什么优势？</h2><p id="49c8" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">要了解什么是我们的优势，你应该问自己这些问题:</p><ul class=""><li id="00a6" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated">你目前的搜索引擎给你的搜索结果质量够好吗？</li><li id="0172" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">让你的机器学习模型规模化是不是工作量太大了？</li><li id="674a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">您是否需要快速且近乎实时地对大型数据集进行分类？</li><li id="1b99" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">你需要将你的机器学习模型扩展到生产规模吗？</li></ul><p id="8be4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以解决所有这些问题。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h2 id="0b84" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">4.什么是Weaviate Python客户端？</h2><p id="f52e" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">Weaviate Python客户端是一个Python包，允许您与Weaviate实例进行连接和交互。python客户端不是一个Weaviate实例，但是你可以用它在<a class="ae kv" href="https://console.semi.technology/" rel="noopener ugc nofollow" target="_blank"> Weaviate云服务</a>上创建一个。它提供了用于导入数据、创建模式、进行分类、查询数据的API我们将浏览其中的大部分，并解释如何以及何时可以使用它们。</p><p id="e020" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个包被发布到PyPI ( <a class="ae kv" href="https://pypi.org/project/weaviate-client/" rel="noopener ugc nofollow" target="_blank">链接</a>)。另外，PyPI上有一个CLI工具(<a class="ae kv" href="https://pypi.org/project/weaviate-cli/" rel="noopener ugc nofollow" target="_blank">链接</a>)。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h2 id="b445" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">5.如何在一个脆弱的集群中使用python-client？</h2><p id="e9f6" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">在这一节中，我们将经历创建一个Weaviate实例的过程，连接到它并探索一些功能。</p><p id="8585" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">(jupyter-notebook可以在这里找到<a class="ae kv" href="https://github.com/semi-technologies/Getting-Started-With-Weaviate-Python-Client/blob/main/Getting-Started-With-Weaviate-Python-Client.ipynb" rel="noopener ugc nofollow" target="_blank">。)</a></p><h2 id="b00d" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">5.0.创建一个弱实例/集群。</h2><p id="a599" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">创建一个Weaviate实例有多种方式。这可以通过使用一个<code class="fe nn no np nq b">docker-compose.yaml</code>文件来完成，该文件可以在这里<a class="ae kv" href="https://www.semi.technology/developers/weaviate/current/getting-started/installation.html#customize-your-weaviate-setup" rel="noopener ugc nofollow" target="_blank">生成</a>。对于此选项，您必须安装<code class="fe nn no np nq b">docker</code>和<code class="fe nn no np nq b">docker-compose</code>，并在您的驱动器上留出空间。</p><p id="9025" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一个选择是在<a class="ae kv" href="https://console.semi.technology/" rel="noopener ugc nofollow" target="_blank"> Weaviate云服务控制台</a> (WCS控制台)上创建一个帐户，并在那里创建一个集群。有不同的集群选项可供选择。如果您没有帐户，请创建一个。</p><p id="495a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本教程中，我们将直接从python在WCS上创建一个集群(您只需要您的WCS凭证)。</p><p id="9788" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在要做的第一件事是安装Weaviate Python客户端。这可以使用pip命令来完成。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="8c1d" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; import sys<br/>&gt;&gt;&gt; !{sys.executable} -m pip install weaviate-client==2.5.0</span></pre><p id="05ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">为版本<strong class="ky ir"> 3.0.0 </strong>更新</strong>。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="7988" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; import sys<br/>&gt;&gt;&gt; !{sys.executable} -m pip install weaviate-client==3.0.0</span></pre><p id="e0a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，让我们导入软件包，并在WCS上创建一个集群。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="392a" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; from getpass import getpass # hide password<br/>&gt;&gt;&gt; import weaviate # to communicate to the Weaviate instance<br/>&gt;&gt;&gt; from weaviate.tools import WCS</span></pre><p id="28e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">将</strong>更新为<strong class="ky ir"> 3.0.0 </strong>版本。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="8773" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; from getpass import getpass # hide password<br/>&gt;&gt;&gt; import weaviate # to communicate to the Weaviate instance<br/>&gt;&gt;&gt; from weaviate.wcs import WCS</span></pre><p id="88fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了对WCS或Weaviate实例进行身份验证(如果Weaviate实例启用了身份验证)，我们需要创建一个身份验证对象。目前，它支持两种类型的认证凭证:</p><ul class=""><li id="ee08" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated">密码凭证:<code class="fe nn no np nq b">weaviate.auth.AuthClientPassword(username='WCS_ACCOUNT_EMAIL', password='WCS_ACCOUNT_PASSWORD')</code></li><li id="abeb" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">令牌凭证<code class="fe nn no np nq b">weaviate.auth.AuthClientCredentials(client_secret=YOUR_SECRET_TOKEN)</code></li></ul><p id="8142" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于WCS，我们将使用密码凭据。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="8284" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; my_credentials = weaviate.auth.AuthClientPassword(username=input("User name: "), password=getpass('Password: '))</span><span id="4c8c" class="mo mp iq nq b gy nz nw l nx ny">User name: WCS_ACCOUNT_EMAIL<br/>Password: ········</span></pre><p id="04cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nn no np nq b">my_credentials</code>对象包含你的凭证，所以小心不要公开它。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="cef1" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; my_wcs = WCS(my_credentials)</span></pre><p id="2618" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经连接到WCS，我们可以使用<code class="fe nn no np nq b">create</code>、<code class="fe nn no np nq b">delete</code>、<code class="fe nn no np nq b">get_clusters</code>、<code class="fe nn no np nq b">get_cluster_config</code>和<code class="fe nn no np nq b">is_ready</code>方法检查集群的状态。</p><p id="0824" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是<code class="fe nn no np nq b">create</code>方法的原型:</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="68e9" class="mo mp iq nq b gy nv nw l nx ny">my_wcs.create(cluster_name:str=None, <br/>    cluster_type:str='sandbox',<br/>    config:dict=None,<br/>    wait_for_completion:bool=True) -&gt; str</span></pre><p id="34a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">返回值是创建的集群的URL。</p><p id="657b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong> <em class="nm"> WCS名称必须是全局唯一的，因为它们用于创建公共URL，以便以后访问实例。因此，请确保为</em> <code class="fe nn no np nq b"><em class="nm">cluster_name</em></code> <em class="nm">选择一个唯一的名称。</em></p><p id="0154" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nm">如果你想检查笔记本中任何方法的原型和docstring，运行这个命令:</em> <code class="fe nn no np nq b"><em class="nm">object.method?</em></code> <em class="nm">。您也可以使用</em> <code class="fe nn no np nq b"><em class="nm">help()</em></code> <em class="nm">功能。</em> <br/>例如:<code class="fe nn no np nq b">WCS.is_ready?</code>或<code class="fe nn no np nq b">my_wcs.is_ready?</code>或<code class="fe nn no np nq b">help(WCS.is_ready)</code>。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="a9ff" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; cluster_name = 'my-first-weaviate-instance'<br/>&gt;&gt;&gt; weaviate_url = my_wcs.create(cluster_name=cluster_name)<br/>&gt;&gt;&gt; weaviate_url</span><span id="06b2" class="mo mp iq nq b gy nz nw l nx ny">100%|██████████| 100.0/100 [00:56&lt;00:00,  1.78it/s]            <br/>'https://my-first-weaviate-instance.semi.network'</span><span id="f3cf" class="mo mp iq nq b gy nz nw l nx ny">&gt;&gt;&gt; my_wcs.is_ready(cluster_name)</span><span id="9f0b" class="mo mp iq nq b gy nz nw l nx ny">True</span></pre><h2 id="dc5e" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">5.1.连接到集群。</h2><p id="5a65" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">现在我们可以用<code class="fe nn no np nq b">Client</code>对象连接到创建的weaviate实例。构造函数如下所示:</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="8adb" class="mo mp iq nq b gy nv nw l nx ny">weaviate.Client(<br/>    url:str,<br/>    auth_client_secret:weaviate.auth.AuthCredentials=None,<br/>    timeout_config:Union[Tuple[int, int], NoneType]=None,<br/>)</span></pre><p id="321a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">构造函数只有一个必需的参数<code class="fe nn no np nq b">url</code>，和两个可选的参数:<code class="fe nn no np nq b">auth_client_secret</code>——如果weaviate实例启用了身份验证，则使用<code class="fe nn no np nq b">timeout_config</code>——设置REST超时配置，并且是一个元组(重试次数，超时秒数)。有关参数的更多信息，请查看docstring。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="8483" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; client = weaviate.Client(weaviate_url)</span></pre><p id="1a49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们连接到了Weavite，但这并不意味着它已经设置好了。它可能仍会在后台执行一些设置过程。我们可以通过调用<code class="fe nn no np nq b">.is_live</code>方法来检查Weaviate实例的健康状况，并通过调用<code class="fe nn no np nq b">.is_ready</code>来检查Weaviate是否为请求做好了准备。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="30d4" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; client.is_ready()</span><span id="b17a" class="mo mp iq nq b gy nz nw l nx ny">True</span></pre><h2 id="17dc" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">5.2.获取数据并进行分析。</h2><p id="2551" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">我们设置了Weaviate实例，连接到它并为请求做好准备，现在我们可以后退一步，获取一些数据并对其进行分析。</p><p id="3159" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这一步，对于所有的机器学习模型来说，是最重要的一步。在这里，我们必须决定什么是相关的，什么是重要的，以及使用什么数据结构/类型。</p><p id="c563" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个例子中，我们将使用新闻文章来构建数据。为此，我们需要<code class="fe nn no np nq b">newspaper3k</code>包。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="5d90" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; !{sys.executable} -m pip install newspaper3k</span></pre><p id="505b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:如果没有下载任何文章，可能是因为没有下载<em class="nm"> nltk punkt </em>工具。要修复它，请运行下面的单元格。</strong></p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="2f34" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; import nltk <em class="nm"># it is a dependency of newspaper3k</em><br/>&gt;&gt;&gt; nltk.download('punkt')</span></pre><blockquote class="oa ob oc"><p id="6599" class="kw kx nm ky b kz la jr lb lc ld ju le od lg lh li oe lk ll lm of lo lp lq lr ij bi translated">感谢GitHub用户@gosha1128在下面的<code class="fe nn no np nq b">get_articles_from_newspaper</code>函数中发现了这个被抑制在<code class="fe nn no np nq b">try/except</code>块中的bug。</p></blockquote><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="daff" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; import newspaper<br/>&gt;&gt;&gt; import uuid<br/>&gt;&gt;&gt; import json<br/>&gt;&gt;&gt; from tqdm import tqdm<br/><br/>&gt;&gt;&gt; def get_articles_from_newspaper(<br/>...         news_url: str, <br/>...         max_articles: int=100<br/>...     ) -&gt; None:<br/>...     """<br/>...     Download and save newspaper articles as weaviate schemas.<br/>...     Parameters<br/>...     ----------<br/>...     newspaper_url : str<br/>...         Newspaper title.<br/>...     """<br/>...     <br/>...     objects = []<br/>...     <br/>...     # Build the actual newspaper    <br/>...     news_builder = newspaper.build(news_url, memoize_articles=False)<br/>...     <br/>...     if max_articles &gt; news_builder.size():<br/>...         max_articles = news_builder.size()<br/>...     pbar = tqdm(total=max_articles)<br/>...     pbar.set_description(f"{news_url}")<br/>...     i = 0<br/>...     while len(objects) &lt; max_articles and i &lt; news_builder.size():<br/>...         article = news_builder.articles[i]<br/>...         try:<br/>...             article.download()<br/>...             article.parse()<br/>...             article.nlp()<br/><br/>...             if (article.title != '' and \<br/>...                 article.title is not None and \<br/>...                 article.summary != '' and \<br/>...                 article.summary is not None and\<br/>...                 article.authors):<br/>... <br/>...                 # create an UUID for the article using its URL<br/>...                 article_id = uuid.uuid3(uuid.NAMESPACE_DNS, article.url)<br/>... <br/>...                 # create the object<br/>...                 objects.append({<br/>...                     'id': str(article_id),<br/>...                     'title': article.title,<br/>...                     'summary': article.summary,<br/>...                     'authors': article.authors<br/>...                 })<br/>...                 <br/>...                 pbar.update(1)<br/>... <br/>...         except:<br/>...             # something went wrong with getting the article, ignore it<br/>...             pass<br/>...         i += 1<br/>...     pbar.close()<br/>...     return objects</span><span id="fe4a" class="mo mp iq nq b gy nz nw l nx ny">&gt;&gt;&gt; data = []<br/>&gt;&gt;&gt; data += get_articles_from_newspaper('https://www.theguardian.com/international')<br/>&gt;&gt;&gt; data += get_articles_from_newspaper('http://cnn.com')</span><span id="8d76" class="mo mp iq nq b gy nz nw l nx ny">https://www.theguardian.com/international: 100%|██████████| 100/100 [00:34&lt;00:00,  2.90it/s]<br/>http://cnn.com: 100%|██████████| 100/100 [02:11&lt;00:00,  1.32s/it]</span></pre><h2 id="9cda" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">5.3.创建适当的数据类型。</h2><p id="ce67" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">在函数<code class="fe nn no np nq b">get_articles_from_newspaper</code>中，我们保留文章的<em class="nm">标题、摘要</em>和<em class="nm">作者</em>。我们还为每篇文章计算一个UUID(通用唯一标识符)。所有这些字段都可以在上面的单元格中看到。</p><p id="b86f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有了这些信息，我们就可以定义一个模式，即每种对象类型的数据结构以及它们之间的关系。该模式是一个嵌套字典。</p><p id="1afc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以让我们创建<code class="fe nn no np nq b">Article</code>类模式。我们知道文章有<strong class="ky ir"> <em class="nm">标题，摘要有</em></strong><strong class="ky ir"><em class="nm">作者有</em> </strong>。</p><p id="4f4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于模式以及如何创建它们的更多信息可以在<a class="ae kv" href="https://www.semi.technology/developers/weaviate/current/data-schema/schema-configuration.html" rel="noopener ugc nofollow" target="_blank">这里</a>和<a class="ae kv" href="https://www.semi.technology/developers/weaviate/current/restful-api-references/schema.html#parameters" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="4b61" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; article_class_schema = {<br/>...     # name of the class<br/>...     "class": "Article",<br/>...     # a description of what this class represents<br/>...     "description": "An Article class to store the article summary and its authors",<br/>...     # class properties<br/>...     "properties": [<br/>...         {<br/>...             "name": "title",<br/>...             "dataType": ["string"],<br/>...             "description": "The title of the article", <br/>...         },<br/>...         {<br/>...             "name": "summary",<br/>...             "dataType": ["text"],<br/>...             "description": "The summary of the article",<br/>...         },<br/>...         {<br/>...             "name": "hasAuthors",<br/>...             "dataType": ["Author"],<br/>...             "description": "The authors this article has",<br/>...         }<br/>...     ]<br/>... }</span></pre><p id="4c74" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的类模式中，我们创建了一个名为<code class="fe nn no np nq b">Article</code>的类，描述为<code class="fe nn no np nq b">An Article class to store the article summary and its authors</code>。描述是为了向用户解释这个类是关于什么的。</p><p id="291f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还定义了3个属性:<code class="fe nn no np nq b">title</code> -文章的标题，类型为<code class="fe nn no np nq b">string</code>(区分大小写)，<code class="fe nn no np nq b">summary</code> -文章的摘要，数据类型为<code class="fe nn no np nq b">text</code>(不区分大小写)，<code class="fe nn no np nq b">hasAuthor</code> -文章的作者，数据类型为<code class="fe nn no np nq b">Author</code>。<code class="fe nn no np nq b">Author</code>不是原始数据类型，它是我们应该定义的另一个类。原始数据类型的列表可以在这里找到<a class="ae kv" href="https://www.semi.technology/developers/weaviate/current/data-schema/datatypes.html" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="84ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注1: </strong>属性应该总是cameCase格式，并且以小写字母开头。<br/> <strong class="ky ir">注2: </strong>属性数据类型始终是列表，因为它可以接受多种数据类型。</p><p id="bcfb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将另一个类指定为数据类型称为交叉引用。这样，您可以将数据对象链接在它们之间，并创建一个关系图。</p><p id="1db5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们以同样的方式创建<code class="fe nn no np nq b">Author</code>类模式，但是使用属性<code class="fe nn no np nq b">name</code>和<code class="fe nn no np nq b">wroteArticles</code>。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="0c1e" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; author_class_schema = {<br/>...     "class": "Author",<br/>...     "description": "An Author class to store the author information",<br/>...     "properties": [<br/>...         {<br/>...             "name": "name",<br/>...             "dataType": ["string"],<br/>...             "description": "The name of the author", <br/>...         },<br/>...         {<br/>...             "name": "wroteArticles",<br/>...             "dataType": ["Article"],<br/>...             "description": "The articles of the author", <br/>...         }<br/>...     ]<br/>... }</span></pre><p id="2d27" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">既然我们决定了数据结构，我们可以告诉Weaviate我们将导入什么类型的数据。这可以通过访问客户端的<code class="fe nn no np nq b">schema</code>属性来完成。</p><p id="9e8d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可以通过两种不同的方式创建模式:</p><ol class=""><li id="e990" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">使用<code class="fe nn no np nq b">.create_class()</code>方法，这个选项每次调用只创建一个类。</li><li id="1c31" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">使用<code class="fe nn no np nq b">.create()</code>方法，这个选项一次创建多个类(如果您有完整的模式，这很有用)</li></ol><p id="6cc9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还可以用<code class="fe nn no np nq b">.contains()</code>方法检查模式是否存在，或者特定的类模式是否存在。</p><p id="ce3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更多关于模式方法的信息，点击<a class="ae kv" href="https://www.semi.technology/developers/weaviate/current/restful-api-references/schema.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="9d5d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为我们分别定义了每个类，所以我们应该使用<code class="fe nn no np nq b">.create_class()</code>方法。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="6224" class="mo mp iq nq b gy nv nw l nx ny">client.schema.create_class(schema_class:Union[dict, str]) -&gt; None</span></pre><p id="b903" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它还接受指向类定义文件的文件路径或URL。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="ce5b" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; client.schema.create_class(article_class_schema)</span><span id="a094" class="mo mp iq nq b gy nz nw l nx ny">---------------------------------------------------------------------------<br/><br/>UnexpectedStatusCodeException             Traceback (most recent call last)<br/><br/>&lt;ipython-input-12-6d56a74d9293&gt; in &lt;module&gt;<br/>----&gt; 1 client.schema.create_class(article_class_schema)<br/><br/><br/>~/miniconda3/envs/test/lib/python3.6/site-packages/weaviate/schema/crud_schema.py in create_class(self, schema_class)<br/>    138         check_class(loaded_schema_class)<br/>    139         self._create_class_with_premitives(loaded_schema_class)<br/>--&gt; 140         self._create_complex_properties_from_class(loaded_schema_class)<br/>    141 <br/>    142     def delete_class(self, class_name: str) -&gt; None:<br/><br/><br/>~/miniconda3/envs/test/lib/python3.6/site-packages/weaviate/schema/crud_schema.py in _create_complex_properties_from_class(self, schema_class)<br/>    352                 raise type(conn_err)(message).with_traceback(sys.exc_info()[2])<br/>    353             if response.status_code != 200:<br/>--&gt; 354                 raise UnexpectedStatusCodeException("Add properties to classes", response)<br/>    355 <br/>    356     def _create_complex_properties_from_classes(self, schema_classes_list: list) -&gt; None:<br/><br/><br/>UnexpectedStatusCodeException: Add properties to classes! Unexpected status code: 422, with response body: {'error': [{'message': "Data type of property 'hasAuthors' is invalid; SingleRef class name 'Author' does not exist"}]}</span></pre><p id="74b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们所看到的，我们不能创建引用不存在的数据类型的class属性。这并不意味着根本没有创建类<code class="fe nn no np nq b">Article</code>。让我们从weaviate获取模式，看看创建了什么。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="7c91" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; # helper function<br/>&gt;&gt;&gt; def prettify(json_dict): <br/>...     print(json.dumps(json_dict, indent=2))</span><span id="6989" class="mo mp iq nq b gy nz nw l nx ny">&gt;&gt;&gt; prettify(client.schema.get())</span><span id="0f5c" class="mo mp iq nq b gy nz nw l nx ny">{<br/>  "classes": [<br/>    {<br/>      "class": "Article",<br/>      "description": "An Article class to store the article summary and its authors",<br/>      "invertedIndexConfig": {<br/>        "cleanupIntervalSeconds": 60<br/>      },<br/>      "properties": [<br/>        {<br/>          "dataType": [<br/>            "string"<br/>          ],<br/>          "description": "The title of the article",<br/>          "name": "title"<br/>        },<br/>        {<br/>          "dataType": [<br/>            "text"<br/>          ],<br/>          "description": "The summary of the article",<br/>          "name": "summary"<br/>        }<br/>      ],<br/>      "vectorIndexConfig": {<br/>        "cleanupIntervalSeconds": 300,<br/>        "maxConnections": 64,<br/>        "efConstruction": 128,<br/>        "vectorCacheMaxObjects": 500000<br/>      },<br/>      "vectorIndexType": "hnsw",<br/>      "vectorizer": "text2vec-contextionary"<br/>    }<br/>  ]<br/>}</span></pre><p id="b8f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们没有指定的配置不是强制性的，而是被设置为默认值。</p><p id="d314" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们所看到的，只有<code class="fe nn no np nq b">hasAuthor</code>属性没有被创建。所以让我们创建<code class="fe nn no np nq b">Author</code>类。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="baee" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; client.schema.create_class(author_class_schema)<br/>&gt;&gt;&gt; prettify(client.schema.get())</span><span id="00c6" class="mo mp iq nq b gy nz nw l nx ny">{<br/>  "classes": [<br/>    {<br/>      "class": "Article",<br/>      "description": "An Article class to store the article summary and its authors",<br/>      "invertedIndexConfig": {<br/>        "cleanupIntervalSeconds": 60<br/>      },<br/>      "properties": [<br/>        {<br/>          "dataType": [<br/>            "string"<br/>          ],<br/>          "description": "The title of the article",<br/>          "name": "title"<br/>        },<br/>        {<br/>          "dataType": [<br/>            "text"<br/>          ],<br/>          "description": "The summary of the article",<br/>          "name": "summary"<br/>        }<br/>      ],<br/>      "vectorIndexConfig": {<br/>        "cleanupIntervalSeconds": 300,<br/>        "maxConnections": 64,<br/>        "efConstruction": 128,<br/>        "vectorCacheMaxObjects": 500000<br/>      },<br/>      "vectorIndexType": "hnsw",<br/>      "vectorizer": "text2vec-contextionary"<br/>    },<br/>    {<br/>      "class": "Author",<br/>      "description": "An Author class to store the author information",<br/>      "invertedIndexConfig": {<br/>        "cleanupIntervalSeconds": 60<br/>      },<br/>      "properties": [<br/>        {<br/>          "dataType": [<br/>            "string"<br/>          ],<br/>          "description": "The name of the author",<br/>          "name": "name"<br/>        },<br/>        {<br/>          "dataType": [<br/>            "Article"<br/>          ],<br/>          "description": "The articles of the author",<br/>          "name": "wroteArticles"<br/>        }<br/>      ],<br/>      "vectorIndexConfig": {<br/>        "cleanupIntervalSeconds": 300,<br/>        "maxConnections": 64,<br/>        "efConstruction": 128,<br/>        "vectorCacheMaxObjects": 500000<br/>      },<br/>      "vectorIndexType": "hnsw",<br/>      "vectorizer": "text2vec-contextionary"<br/>    }<br/>  ]<br/>}</span></pre><p id="3f87" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经创建了两个类，但是我们仍然没有<code class="fe nn no np nq b">hasAuthor</code>属性。不用担心，它可以在任何时候创建，使用模式的属性<code class="fe nn no np nq b">property</code>和方法<code class="fe nn no np nq b">create</code>。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="76bb" class="mo mp iq nq b gy nv nw l nx ny">client.schema.property.create(schema_class_name:str, schema_property:dict) -&gt; None</span><span id="0fde" class="mo mp iq nq b gy nz nw l nx ny">&gt;&gt;&gt; client.schema.property.create('Article', article_class_schema['properties'][2])</span></pre><p id="66cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们得到模式，看看它是否是我们所期望的。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="f36f" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; prettify(client.schema.get())</span><span id="f6c2" class="mo mp iq nq b gy nz nw l nx ny">{<br/>  "classes": [<br/>    {<br/>      "class": "Article",<br/>      "description": "An Article class to store the article summary and its authors",<br/>      "invertedIndexConfig": {<br/>        "cleanupIntervalSeconds": 60<br/>      },<br/>      "properties": [<br/>        {<br/>          "dataType": [<br/>            "string"<br/>          ],<br/>          "description": "The title of the article",<br/>          "name": "title"<br/>        },<br/>        {<br/>          "dataType": [<br/>            "text"<br/>          ],<br/>          "description": "The summary of the article",<br/>          "name": "summary"<br/>        },<br/>        {<br/>          "dataType": [<br/>            "Author"<br/>          ],<br/>          "description": "The authors this article has",<br/>          "name": "hasAuthors"<br/>        }<br/>      ],<br/>      "vectorIndexConfig": {<br/>        "cleanupIntervalSeconds": 300,<br/>        "maxConnections": 64,<br/>        "efConstruction": 128,<br/>        "vectorCacheMaxObjects": 500000<br/>      },<br/>      "vectorIndexType": "hnsw",<br/>      "vectorizer": "text2vec-contextionary"<br/>    },<br/>    {<br/>      "class": "Author",<br/>      "description": "An Author class to store the author information",<br/>      "invertedIndexConfig": {<br/>        "cleanupIntervalSeconds": 60<br/>      },<br/>      "properties": [<br/>        {<br/>          "dataType": [<br/>            "string"<br/>          ],<br/>          "description": "The name of the author",<br/>          "name": "name"<br/>        },<br/>        {<br/>          "dataType": [<br/>            "Article"<br/>          ],<br/>          "description": "The articles of the author",<br/>          "name": "wroteArticles"<br/>        }<br/>      ],<br/>      "vectorIndexConfig": {<br/>        "cleanupIntervalSeconds": 300,<br/>        "maxConnections": 64,<br/>        "efConstruction": 128,<br/>        "vectorCacheMaxObjects": 500000<br/>      },<br/>      "vectorIndexType": "hnsw",<br/>      "vectorizer": "text2vec-contextionary"<br/>    }<br/>  ]<br/>}</span></pre><p id="1e51" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一切都如我们所愿。</p><p id="7302" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您不想考虑哪个类是在何时创建的，以及哪些属性可能失败或不失败(由于尚不存在的类)，有一个解决方案。解决方案是用<code class="fe nn no np nq b">create</code>方法创建整个模式。所以让我们从weaviate中删除这个模式，看看它是如何工作的。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="c216" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; schema = client.schema.get() # save schema<br/>&gt;&gt;&gt; client.schema.delete_all() # delete all classes<br/>&gt;&gt;&gt; prettify(client.schema.get())</span><span id="b9ec" class="mo mp iq nq b gy nz nw l nx ny">{<br/>  "classes": []<br/>}</span></pre><p id="6381" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nm">注意，如果我们删除一个模式或一个类，我们会删除与之相关的所有对象。</em></p><p id="41c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们从保存的模式中创建它。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="0a0f" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; client.schema.create(schema)<br/>&gt;&gt;&gt; prettify(client.schema.get())</span><span id="b3e2" class="mo mp iq nq b gy nz nw l nx ny">{<br/>  "classes": [<br/>    {<br/>      "class": "Article",<br/>      "description": "An Article class to store the article summary and its authors",<br/>      "invertedIndexConfig": {<br/>        "cleanupIntervalSeconds": 60<br/>      },<br/>      "properties": [<br/>        {<br/>          "dataType": [<br/>            "string"<br/>          ],<br/>          "description": "The title of the article",<br/>          "name": "title"<br/>        },<br/>        {<br/>          "dataType": [<br/>            "text"<br/>          ],<br/>          "description": "The summary of the article",<br/>          "name": "summary"<br/>        },<br/>        {<br/>          "dataType": [<br/>            "Author"<br/>          ],<br/>          "description": "The authors this article has",<br/>          "name": "hasAuthors"<br/>        }<br/>      ],<br/>      "vectorIndexConfig": {<br/>        "cleanupIntervalSeconds": 300,<br/>        "maxConnections": 64,<br/>        "efConstruction": 128,<br/>        "vectorCacheMaxObjects": 500000<br/>      },<br/>      "vectorIndexType": "hnsw",<br/>      "vectorizer": "text2vec-contextionary"<br/>    },<br/>    {<br/>      "class": "Author",<br/>      "description": "An Author class to store the author information",<br/>      "invertedIndexConfig": {<br/>        "cleanupIntervalSeconds": 60<br/>      },<br/>      "properties": [<br/>        {<br/>          "dataType": [<br/>            "string"<br/>          ],<br/>          "description": "The name of the author",<br/>          "name": "name"<br/>        },<br/>        {<br/>          "dataType": [<br/>            "Article"<br/>          ],<br/>          "description": "The articles of the author",<br/>          "name": "wroteArticles"<br/>        }<br/>      ],<br/>      "vectorIndexConfig": {<br/>        "cleanupIntervalSeconds": 300,<br/>        "maxConnections": 64,<br/>        "efConstruction": 128,<br/>        "vectorCacheMaxObjects": 500000<br/>      },<br/>      "vectorIndexType": "hnsw",<br/>      "vectorizer": "text2vec-contextionary"<br/>    }<br/>  ]<br/>}</span></pre><p id="476a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这看起来和我们一个类一个类一个属性地创建的模式一模一样。这样，我们现在可以将模式保存在一个文件中，并在下一个会话中通过提供文件路径直接导入它。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="b2df" class="mo mp iq nq b gy nv nw l nx ny"># save schema to file<br/>with open('schema.json', 'w') as outfile: <br/>    json.dump(schema, outfile)<br/># remove current schema from Weaviate, removes all the data too<br/>client.schema.delete_all()<br/># import schema using file path<br/>client.schema.create('schema.json')<br/># print schema<br/>print(json.dumps(client.schema.get(), indent=2))</span></pre><h2 id="7725" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">5.4.加载数据。</h2><p id="82c1" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">现在我们已经准备好了数据，Weaviate也知道我们拥有什么样的数据，我们可以将<code class="fe nn no np nq b">Articles</code>和<code class="fe nn no np nq b">Authors</code>添加到Weaviate实例中。</p><p id="d1b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可以通过三种不同的方式导入数据。</p><ol class=""><li id="6795" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">逐个对象地迭代添加对象。这可以使用客户端的<code class="fe nn no np nq b">data_object</code>对象属性来完成。</li><li id="172e" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">分批。这可以通过创建一个适当的批处理请求对象并使用客户机的<code class="fe nn no np nq b">batch</code>对象属性提交它来完成。(<strong class="ky ir">仅在</strong> <code class="fe nn no np nq b">weaviate-client</code> <strong class="ky ir">版本&lt; 3.0.0中。</strong></li><li id="488f" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">使用来自<code class="fe nn no np nq b">weaviate.tools</code>模块的<code class="fe nn no np nq b">Batcher</code>对象。(<strong class="ky ir">仅在</strong> <code class="fe nn no np nq b">weaviate-client</code> <strong class="ky ir">版本&lt; 3.0.0中出现。</strong>)</li><li id="af51" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">新的</strong> <code class="fe nn no np nq b">Batch</code> <strong class="ky ir">类在weaviate-client版本3.0.0中引入。</strong></li></ol><p id="8820" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将看到它们的实际应用，但首先让我们强调一下它们之间的区别。</p><ul class=""><li id="2937" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated">备选方案1。是添加数据对象和创建引用的最安全的方法，因为它在创建对象之前进行对象验证，而批量导入数据会跳过大部分验证以提高速度。这个选项要求每个对象有一个REST请求，因此比成批导入数据要慢。如果您不确定您的数据是否有效，建议使用此选项。</li><li id="bad7" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">选项2。如上所述，跳过了大部分数据验证，每批只需要一个REST请求。对于这种方法，您只需向一个批处理请求中添加尽可能多的数据(有两种类型:<code class="fe nn no np nq b">ReferenceBatchRequest</code>和<code class="fe nn no np nq b">ObjectsBatchRequest</code>)，然后使用客户端的<code class="fe nn no np nq b">batch</code>对象属性提交它。此选项要求您首先导入数据对象，然后导入引用(确保引用中使用的对象在创建引用之前已经导入)。(<strong class="ky ir">仅在</strong> <code class="fe nn no np nq b">weaviate-client</code> <strong class="ky ir">版本&lt; 3.0.0中。</strong>)</li><li id="aeab" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">选项3。依赖于来自2的批处理请求。但是对于一个<code class="fe nn no np nq b">Batcher</code>，你不需要提交任何批量请求，当它满了的时候，它会自动为你做。(<strong class="ky ir">只出现在</strong> <code class="fe nn no np nq b">weaviate-client</code> <strong class="ky ir">版本&lt; 3.0.0中。</strong>)</li><li id="3acb" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">选项4: <strong class="ky ir">新的</strong> <code class="fe nn no np nq b">Batch</code> <strong class="ky ir">类在weaviate-client版本3.0.0中引入。</strong>新的<code class="fe nn no np nq b">Batch</code>对象不需要来自2的<code class="fe nn no np nq b">BatchRequests</code>。而是在内部使用。新类还支持3种不同的批量加载数据的情况:a)手动——用户可以完全控制何时以及如何添加和创建批量；b)满时自动创建批次；c)使用动态批处理自动创建批次，即每次创建批次时调整批次大小，以避免任何<code class="fe nn no np nq b">Timeout</code>错误。</li></ul><h2 id="8a3b" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">5.4.1使用<code class="fe nn no np nq b">data_object</code>属性加载数据</h2><p id="7a31" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">在这种情况下，我们只取一篇文章(<code class="fe nn no np nq b">data[0]</code>)并使用<code class="fe nn no np nq b">data_object</code>属性将其导入Weaviate。</p><p id="f158" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">方法是首先创建对象，然后创建链接它们的引用。</p><p id="198a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在笔记本中运行<code class="fe nn no np nq b">client.data_object.create?</code>以获得关于该方法的更多信息。或<code class="fe nn no np nq b">help(client.data_object.create)</code>处于空转状态。</p><p id="eb6e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每个数据对象都应该具有模式中定义的相同格式。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="aaa6" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; prettify(data[0])</span><span id="ecdf" class="mo mp iq nq b gy nz nw l nx ny">{<br/>  "id": "df2a2d1c-9c87-3b4b-9df3-d7aed6bb6a27",<br/>  "title": "Coronavirus live news: Pfizer says jab 100% effective in 12- to 15-year-olds; Macron could announce lockdown tonight",<br/>  "summary": "11:08Surge testing is being deployed in Bolton, Greater Manchester after one case of the South African variant of coronavirus has been identified.\nDr Helen Lowey, Bolton\u2019s director of public health, said that \u201cthe risk of any onward spread is low\u201d and there was no evidence that the variant caused more severe illness.\nPublic Health England identified the case in the area of Wingates Industrial Estate.\nDr Matthieu Pegorie from Public Health England North West said that there was no link to international travel, therefore suggesting that there are some cases in the community.\nThe Department of Health says that enhanced contact tracing will be deployed where a positive case of a variant is found.",<br/>  "authors": [<br/>    "Helen Sullivan",<br/>    "Yohannes Lowe",<br/>    "Martin Belam",<br/>    "Maya Wolfe-Robinson",<br/>    "Melissa Davey",<br/>    "Jessica Glenza",<br/>    "Jon Henley",<br/>    "Peter Beaumont"<br/>  ]<br/>}</span><span id="7e61" class="mo mp iq nq b gy nz nw l nx ny">&gt;&gt;&gt; article_object = {<br/>...     'title': data[0]['title'],<br/>...     'summary': data[0]['summary'].replace('\n', '') # remove newline character<br/>...     # we leave out the `hasAuthors` because it is a reference and will be created after we create the Authors<br/>... }<br/>&gt;&gt;&gt; article_id = data[0]['id']<br/><br/>&gt;&gt;&gt; # validated the object<br/>&gt;&gt;&gt; result = client.data_object.validate(<br/>...     data_object=article_object,<br/>...     class_name='Article',<br/>...     uuid=article_id<br/>... )<br/><br/>&gt;&gt;&gt; prettify(result)</span><span id="ad0f" class="mo mp iq nq b gy nz nw l nx ny">{<br/>  "error": null,<br/>  "valid": true<br/>}</span></pre><p id="f28e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对象通过了验证测试，现在可以安全地创建/导入它了。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="5f68" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; # create the object<br/>&gt;&gt;&gt; client.data_object.create(<br/>...     data_object=article_object,<br/>...     class_name='Article',<br/>...     uuid=article_id # if not specified, weaviate is going to create an UUID for you.<br/>...)</span><span id="1205" class="mo mp iq nq b gy nz nw l nx ny">'df2a2d1c-9c87-3b4b-9df3-d7aed6bb6a27'</span></pre><p id="3d4b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nn no np nq b">client.data_object.create</code>返回对象的UUID，如果你指定了一个，它也将被返回。如果你没有指定，Weaviate会为你生成一个并返回。</p><p id="37f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">恭喜我们已经添加了第一个weaviate对象！！！</p><p id="adb3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们实际上可以使用<code class="fe nn no np nq b">get_by_id</code>或<code class="fe nn no np nq b">get</code>方法通过UUID从Weaviate中“获取”这个对象。(<code class="fe nn no np nq b">get</code>未指定和UUID返回前100个对象)</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="f712" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; prettify(client.data_object.get(article_id, with_vector=False))</span><span id="cbda" class="mo mp iq nq b gy nz nw l nx ny">{<br/>  "additional": {},<br/>  "class": "Article",<br/>  "creationTimeUnix": 1617191563170,<br/>  "id": "df2a2d1c-9c87-3b4b-9df3-d7aed6bb6a27",<br/>  "lastUpdateTimeUnix": 1617191563170,<br/>  "properties": {<br/>    "summary": "11:08Surge testing is being deployed in Bolton, Greater Manchester after one case of the South African variant of coronavirus has been identified.Dr Helen Lowey, Bolton\u2019s director of public health, said that \u201cthe risk of any onward spread is low\u201d and there was no evidence that the variant caused more severe illness.Public Health England identified the case in the area of Wingates Industrial Estate.Dr Matthieu Pegorie from Public Health England North West said that there was no link to international travel, therefore suggesting that there are some cases in the community.The Department of Health says that enhanced contact tracing will be deployed where a positive case of a variant is found.",<br/>    "title": "Coronavirus live news: Pfizer says jab 100% effective in 12- to 15-year-olds; Macron could announce lockdown tonight"<br/>  },<br/>  "vectorWeights": null<br/>}</span></pre><p id="aac2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们创建作者以及<code class="fe nn no np nq b">Article</code>和<code class="fe nn no np nq b">Authors</code>之间的交叉引用。</p><p id="f538" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加参考的方式相同，但添加参考时使用<code class="fe nn no np nq b">client.data_object.reference.add</code>方法。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="6135" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; # keep track of the authors already imported/created and their respective UUID<br/>&gt;&gt;&gt; # because same author can write more than one paper.<br/>&gt;&gt;&gt; created_authors = {}<br/><br/>&gt;&gt;&gt; for author in data[0]['authors']:<br/>...     # create Author<br/>...     author_object = {<br/>...         'name': author,<br/>...         # we leave out the `wroteArticles` because it is a reference and will be created after we create the Author<br/>...     }<br/>...     author_id = client.data_object.create(<br/>...         data_object=author_object,<br/>...         class_name='Author'<br/>...     )<br/>...     <br/>...     # add author to the created_authors<br/>...     created_authors[author] = author_id<br/>...     <br/>...     # add references<br/>...     ## Author -&gt; Article<br/>...     client.data_object.reference.add(<br/>...         from_uuid=author_id,<br/>...         from_property_name='wroteArticles',<br/>...         to_uuid=article_id<br/>...     )<br/>...     ## Article -&gt; Author <br/>...     client.data_object.reference.add(<br/>...         from_uuid=article_id,<br/>...         from_property_name='hasAuthors',<br/>...         to_uuid=author_id<br/>...     )</span></pre><p id="8758" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的单元格中，我们遍历了文章的所有作者。对于每次迭代，我们首先创建<code class="fe nn no np nq b">Author</code>，然后添加引用:从<code class="fe nn no np nq b">Author</code>到<code class="fe nn no np nq b">Article</code>的引用——通过<code class="fe nn no np nq b">Author</code>的<code class="fe nn no np nq b">wroteArticles</code>属性链接，以及从<code class="fe nn no np nq b">Article</code>到<code class="fe nn no np nq b">Author</code>的引用——通过<code class="fe nn no np nq b">Article</code>的<code class="fe nn no np nq b">hasAuthors</code>属性。</p><p id="0121" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，双向引用不是必需的。</p><p id="0218" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们得到这个物体，并看看它。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="9bbe" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; prettify(client.data_object.get(article_id, with_vector=False))</span><span id="e63a" class="mo mp iq nq b gy nz nw l nx ny">{<br/>  "additional": {},<br/>  "class": "Article",<br/>  "creationTimeUnix": 1617191563170,<br/>  "id": "df2a2d1c-9c87-3b4b-9df3-d7aed6bb6a27",<br/>  "lastUpdateTimeUnix": 1617191563170,<br/>  "properties": {<br/>    "hasAuthors": [<br/>      {<br/>        "beacon": "weaviate://localhost/1d0d3242-1fc2-4bba-adbe-ab9ef9a97dfe",<br/>        "href": "/v1/objects/1d0d3242-1fc2-4bba-adbe-ab9ef9a97dfe"<br/>      },<br/>      {<br/>        "beacon": "weaviate://localhost/c1c8afce-adb6-4b3c-bbe0-2414d55b0c8e",<br/>        "href": "/v1/objects/c1c8afce-adb6-4b3c-bbe0-2414d55b0c8e"<br/>      },<br/>      {<br/>        "beacon": "weaviate://localhost/b851f6fc-a02b-4a63-9b53-c3a8764c82c1",<br/>        "href": "/v1/objects/b851f6fc-a02b-4a63-9b53-c3a8764c82c1"<br/>      },<br/>      {<br/>        "beacon": "weaviate://localhost/e6b6c991-5d7a-447f-89c8-e6e01730f88f",<br/>        "href": "/v1/objects/e6b6c991-5d7a-447f-89c8-e6e01730f88f"<br/>      },<br/>      {<br/>        "beacon": "weaviate://localhost/d03f9353-d4fc-465d-babe-f116a29ccaf5",<br/>        "href": "/v1/objects/d03f9353-d4fc-465d-babe-f116a29ccaf5"<br/>      },<br/>      {<br/>        "beacon": "weaviate://localhost/8ab84df5-c92b-49ac-95dd-bf65f53a38cc",<br/>        "href": "/v1/objects/8ab84df5-c92b-49ac-95dd-bf65f53a38cc"<br/>      },<br/>      {<br/>        "beacon": "weaviate://localhost/e667d7c9-0c9b-48fe-b671-864cbfc84962",<br/>        "href": "/v1/objects/e667d7c9-0c9b-48fe-b671-864cbfc84962"<br/>      },<br/>      {<br/>        "beacon": "weaviate://localhost/9d094f60-3f58-46dc-b7fd-40495be2dd69",<br/>        "href": "/v1/objects/9d094f60-3f58-46dc-b7fd-40495be2dd69"<br/>      }<br/>    ],<br/>    "summary": "11:08Surge testing is being deployed in Bolton, Greater Manchester after one case of the South African variant of coronavirus has been identified.Dr Helen Lowey, Bolton\u2019s director of public health, said that \u201cthe risk of any onward spread is low\u201d and there was no evidence that the variant caused more severe illness.Public Health England identified the case in the area of Wingates Industrial Estate.Dr Matthieu Pegorie from Public Health England North West said that there was no link to international travel, therefore suggesting that there are some cases in the community.The Department of Health says that enhanced contact tracing will be deployed where a positive case of a variant is found.",<br/>    "title": "Coronavirus live news: Pfizer says jab 100% effective in 12- to 15-year-olds; Macron could announce lockdown tonight"<br/>  },<br/>  "vectorWeights": null<br/>}</span></pre><p id="9428" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如我们所见，我们将参考设置为<code class="fe nn no np nq b">beacon</code>和<code class="fe nn no np nq b">href</code>。我们无法通过从weaviate获取对象来查看数据。我们可以通过<em class="nm">查询</em>数据来完成(参见<strong class="ky ir"> 5.5节查询数据)。</strong>)或通过UUID(或<code class="fe nn no np nq b">beacon</code>，或<code class="fe nn no np nq b">href</code>)获取对象。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="a8f4" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt; from weaviate.util import get_valid_uuid # extract UUID from URL (beacon or href)<br/><br/>&gt;&gt;&gt; # extract authors references, lets take only the first one as an example (the article might have only one)<br/>&gt;&gt;&gt; author = client.data_object.get(article_id, with_vector=False)['properties']['hasAuthors'][0]<br/><br/>&gt;&gt;&gt; # get and print data object by providing the 'beacon'<br/>&gt;&gt;&gt; author_uuid = get_valid_uuid(author['beacon']) # can be 'href' too<br/>&gt;&gt;&gt; prettify(client.data_object.get(author_uuid, with_vector=False))</span><span id="c921" class="mo mp iq nq b gy nz nw l nx ny">{<br/>  "additional": {},<br/>  "class": "Author",<br/>  "creationTimeUnix": 1617191569894,<br/>  "id": "1d0d3242-1fc2-4bba-adbe-ab9ef9a97dfe",<br/>  "lastUpdateTimeUnix": 1617191569894,<br/>  "properties": {<br/>    "name": "Helen Sullivan",<br/>    "wroteArticles": [<br/>      {<br/>        "beacon": "weaviate://localhost/df2a2d1c-9c87-3b4b-9df3-d7aed6bb6a27",<br/>        "href": "/v1/objects/df2a2d1c-9c87-3b4b-9df3-d7aed6bb6a27"<br/>      }<br/>    ]<br/>  },<br/>  "vectorWeights": null<br/>}</span></pre><p id="9a7e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到目前为止，还不错(…那又怎样！)</p><p id="0847" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据对象(<code class="fe nn no np nq b">client.data_object</code>)的方法更多:<code class="fe nn no np nq b">.delete</code>、<code class="fe nn no np nq b">.exists</code>、<code class="fe nn no np nq b">.replace</code>、<code class="fe nn no np nq b">.update</code>。</p><p id="9ca9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也有一些引用的方法(<code class="fe nn no np nq b">client.data_object.reference</code> ): <code class="fe nn no np nq b">.add</code>、<code class="fe nn no np nq b">.delete</code>、<code class="fe nn no np nq b">.update</code>。</p><h2 id="b2af" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">5.4.2使用批处理加载数据</h2><p id="198d" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">(<strong class="ky ir">只在</strong> <code class="fe nn no np nq b">weaviate-client</code> <strong class="ky ir">版本&lt; 3.0.0中。</strong>)</p><p id="c376" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">批量导入数据与逐个对象添加非常相似。</p><p id="28ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们要做的第一件事是为每个对象类型创建一个<code class="fe nn no np nq b">BatchRequest</code>对象:<code class="fe nn no np nq b">DataObject</code>和<code class="fe nn no np nq b">Reference</code>。它们被相应地命名为:<code class="fe nn no np nq b">ObjectsBatchRequest</code>和<code class="fe nn no np nq b">ReferenceBatchRequest</code>。</p><p id="9a83" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们为每一批创建一个对象，并导入接下来的99篇文章。</p><p id="5542" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong>我想再次提醒您，批量导入/创建数据会跳过一些验证步骤，可能会导致图形损坏。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="a329" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; from weaviate import ObjectsBatchRequest, ReferenceBatchRequest</span></pre><p id="2304" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们创建一个向批处理请求添加单个文章的函数。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="c2e3" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; def add_article(batch: ObjectsBatchRequest, article_data: dict) -&gt; str:<br/>...     <br/>...     article_object = {<br/>...         'title': article_data['title'],<br/>...         'summary': article_data['summary'].replace('\n', '') # remove newline character<br/>...     }<br/>...     article_id = article_data['id']<br/>...     <br/>...     # add article to the object batch request<br/>...     batch.add(<br/>...         data_object=article_object,<br/>...         class_name='Article',<br/>...         uuid=article_id<br/>...     )<br/>...     <br/>...     return article_id</span></pre><p id="079b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们创建一个函数，向批处理请求添加一个作者，如果还没有创建作者的话。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="b987" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; def add_author(batch: ObjectsBatchRequest, author_name: str, created_authors: dict) -&gt; str:<br/>...     <br/>...     if author_name in created_authors:<br/>...         # return author UUID<br/>...         return created_authors[author_name]<br/>...     <br/>...     # generate an UUID for the Author<br/>...     author_id = generate_uuid(author)<br/>...     <br/>...     # add author to the object batch request<br/>...     batch.add(<br/>...         data_object={'name': author_name},<br/>...         class_name='Author',<br/>...         uuid=author_id<br/>...     )<br/>...     <br/>...     created_authors[author_name] = author_id<br/>...     return author_id</span></pre><p id="2986" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后一个功能是添加交叉引用。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="9a48" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; def add_references(batch: ReferenceBatchRequest, article_id: str, author_id: str)-&gt; None:<br/>...     # add references to the reference batch request<br/>...     ## Author -&gt; Article<br/>...     batch.add(<br/>...         from_object_uuid=author_id,<br/>...         from_object_class_name='Author',<br/>...         from_property_name='wroteArticles',<br/>...         to_object_uuid=article_id<br/>...     )<br/>...     <br/>...     ## Article -&gt; Author <br/>...     batch.add(<br/>...         from_object_uuid=article_id,<br/>...         from_object_class_name='Article',<br/>...         from_property_name='hasAuthors',<br/>...         to_object_uuid=author_id<br/>...     )</span></pre><p id="c7bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们可以遍历数据并使用批处理导入数据。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="ddd5" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; from weaviate.tools import generate_uuid<br/>&gt;&gt;&gt; from tqdm import trange<br/><br/>&gt;&gt;&gt; objects_batch = ObjectsBatchRequest()<br/>&gt;&gt;&gt; reference_batch = ReferenceBatchRequest()<br/><br/>&gt;&gt;&gt; for i in trange(1, 100):<br/>...    <br/>...     # add article to batch request<br/>...     article_id = add_article(objects_batch, data[i])<br/>...     <br/>...     for author in data[i]['authors']:<br/>...         <br/>...         # add author to batch request<br/>...         author_id = add_author(objects_batch, author, created_authors)<br/>...         <br/>...         # add cross references to the reference batch<br/>...         add_references(reference_batch, article_id=article_id, author_id=author_id)<br/>...     <br/>...     if i % 20 == 0:<br/>...         # submit the object batch request to weaviate, can be done with method '.create_objects'<br/>...         client.batch.create(objects_batch)<br/>...        <br/>...         # submit the reference batch request to weaviate, can be done with method '.create_references'<br/>...         client.batch.create(reference_batch)<br/>...        <br/>...         # batch requests are not reusable, so we create new ones<br/>...         objects_batch = ObjectsBatchRequest()<br/>...         reference_batch = ReferenceBatchRequest()<br/><br/><br/>&gt;&gt;&gt; # submit the any object that are left<br/>&gt;&gt;&gt; status_objects = client.batch.create(objects_batch)<br/>&gt;&gt;&gt; status_references = client.batch.create(reference_batch)</span><span id="15e1" class="mo mp iq nq b gy nz nw l nx ny">0%|          | 0/99 [00:00&lt;?, ?it/s]</span></pre><p id="3d32" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了批量导入数据，我们应该为想要导入的数据对象类型创建一个<code class="fe nn no np nq b">BatchRequest</code>对象。批处理请求对象没有大小限制，因此您应该在需要多少对象时提交它。(请记住，如果您将使用包含太多对象的批处理，可能会导致超时错误，因此请将它保持在合理的大小，以便您的Weaviate实例可以处理它。)此外，我们会跟踪已经创建的作者，这样我们就不会一遍又一遍地创建同一个作者。</p><p id="c917" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对<code class="fe nn no np nq b">client.batch.create</code>的调用返回每个被创建对象的状态。如果你想确定一切正常，就检查一下。另外<strong class="ky ir">注意</strong>即使Weaviate未能创建对象，也不意味着批量提交也失败，更多信息请阅读<code class="fe nn no np nq b">client.batch.create</code>的文档。</p><h2 id="3271" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">5.4.3使用批处理程序对象加载数据。</h2><p id="0fbf" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">(<strong class="ky ir">仅在</strong> <code class="fe nn no np nq b">weaviate-client</code> <strong class="ky ir">版本&lt; 3.0.0中出现。</strong>)</p><p id="1303" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nn no np nq b">Batcher</code>是一个自动提交对象weaviate的类，包括<code class="fe nn no np nq b">DataObject</code>和<code class="fe nn no np nq b">Reference</code>s。<code class="fe nn no np nq b">Batcher</code>可以在<code class="fe nn no np nq b">weaviate.tools</code>模块中找到，它有以下构造器原型:</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="b130" class="mo mp iq nq b gy nv nw l nx ny">Batcher(<br/>    client : weaviate.client.Client,<br/>    batch_size : int=512,<br/>    verbose : bool=False,<br/>    auto_commit_timeout : float=-1.0,<br/>    max_backoff_time : int=300,<br/>    max_request_retries : int=4,<br/>    return_values_callback : Callable=None,<br/>)</span></pre><p id="c0dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有关每个参数的解释，请参见文档。</p><p id="ce59" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看它是如何对我们从<code class="fe nn no np nq b">data</code>中提取的其余对象起作用的。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="6d40" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; from weaviate.tools import Batcher</span></pre><p id="fc99" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于a <code class="fe nn no np nq b">Batcher</code>,我们只需要将我们想要导入的对象添加到Weaviate。<code class="fe nn no np nq b">Batcher</code>有添加<code class="fe nn no np nq b">objects</code> ( <code class="fe nn no np nq b">batcher.add_data_object</code>)和添加<code class="fe nn no np nq b">references</code> ( <code class="fe nn no np nq b">batcher.add_reference</code>)的特殊方法。此外，它还提供了一个带有关键字参数的<code class="fe nn no np nq b">batcher.add</code>方法，该方法可以检测您试图添加的数据类型。<code class="fe nn no np nq b">batcher.add</code>方法使得重用我们上面定义的<code class="fe nn no np nq b">add_article</code>、<code class="fe nn no np nq b">add_author</code>和<code class="fe nn no np nq b">add_references</code>函数成为可能。</p><p id="28e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注:</strong><code class="fe nn no np nq b">Batcher.add</code>是在<code class="fe nn no np nq b">weaviate-client</code>版本2.3.0中引入的。</p><p id="cc6d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们使用批处理程序添加来自<code class="fe nn no np nq b">data</code>的剩余文章和作者。因为<code class="fe nn no np nq b">Batcher</code>自动提交对象进行weaviate，所以我们需要在我们完成之后总是<code class="fe nn no np nq b">.close()</code>它，以确保我们提交的是<code class="fe nn no np nq b">Batcher</code>中剩余的内容。</p><p id="a133" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你像我一样，有时忘记关闭对象，<code class="fe nn no np nq b">Bather</code>可以在上下文管理器中使用，即与<code class="fe nn no np nq b">with</code>一起使用。让我们看看它是如何与上下文管理器一起工作的。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="00a0" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; # we still need the 'created_authors' so we do not add the same author twice<br/>&gt;&gt;&gt; with Batcher(client, 30, True) as batcher:<br/>...     for i in trange(100, 200):<br/>...         <br/>...         # add article to batcher<br/>...         article_id = add_article(batcher, data[i]) # NOTE the 'bather' object instead of 'objects_batch'<br/>... <br/>...         for author in data[i]['authors']:<br/>...<br/>...             # add author to batcher<br/>...             author_id = add_author(batcher, author, created_authors) # NOTE the 'bather' object instead of 'objects_batch'<br/>...<br/>...             # add cross references to the batcher<br/>...             add_references(batcher, article_id=article_id, author_id=author_id) # NOTE the 'bather' object instead of 'reference_batch'</span><span id="dc47" class="mo mp iq nq b gy nz nw l nx ny">Batcher object created!<br/><br/><br/><br/>  0%|          | 0/100 [00:00&lt;?, ?it/s]<br/><br/><br/>Updated object batch successfully<br/>Updated reference batch successfully<br/>Updated object batch successfully<br/>Updated reference batch successfully<br/>Updated object batch successfully<br/>Updated reference batch successfully<br/>Updated object batch successfully<br/>Updated reference batch successfully<br/>Updated object batch successfully<br/>Updated reference batch successfully<br/>Updated object batch successfully<br/>Updated reference batch successfully<br/>Updated object batch successfully<br/>Updated reference batch successfully<br/>Updated object batch successfully<br/>Updated reference batch successfully<br/>Updated object batch successfully<br/>Updated reference batch successfully<br/>Updated object batch successfully<br/>Updated reference batch successfully<br/>Updated object batch successfully<br/>Updated reference batch successfully<br/>Updated object batch successfully<br/>Updated reference batch successfully<br/>Updated object batch successfully<br/>Updated reference batch successfully<br/>Updated object batch successfully<br/>Updated reference batch successfully<br/>Updated object batch successfully<br/>Updated reference batch successfully<br/>Updated object batch successfully<br/>Updated reference batch successfully<br/>Updated object batch successfully<br/>Updated reference batch successfully<br/>Updated object batch successfully<br/>Updated reference batch successfully<br/>Updated object batch successfully<br/>Updated reference batch successfully<br/>Batcher object closed!</span></pre><p id="31fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是分批配料器。</p><p id="4774" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是导入数据的三种方式。选择一个适合你和你的项目。</p><h2 id="efdd" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">5.4.4新增<code class="fe nn no np nq b">Batch</code>对象</h2><p id="8dc8" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">(<strong class="ky ir">只在</strong> <code class="fe nn no np nq b">weaviate-client</code> <strong class="ky ir">版本&gt; =3.0.0。</strong>)</p><p id="baca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">新的<code class="fe nn no np nq b">Batch</code>对象可以用同样的方式访问:<code class="fe nn no np nq b">client.batch</code>。如5.4节所述，这个类有3种不同的用法，所以让我们来看看我们到底是怎么做的，以及它们之间的区别。</p><p id="349c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们首先要做的是重新定义以下函数:<code class="fe nn no np nq b">add_article</code>、<code class="fe nn no np nq b">add_author</code>和<code class="fe nn no np nq b">add_references</code>。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="6d24" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; from weaviate.batch import Batch # for the typing purposes<br/>&gt;&gt;&gt; from weaviate.util import generate_uuid5 # old way was from weaviate.tools import generate_uuid</span><span id="b419" class="mo mp iq nq b gy nz nw l nx ny">&gt;&gt;&gt; def add_article(batch: Batch, article_data: dict) -&gt; str:<br/>...    <br/>...     article_object = {<br/>...         'title': article_data['title'],<br/>...         'summary': article_data['summary'].replace('\n', '') # remove newline character<br/>...     }<br/>...     article_id = article_data['id']<br/>...    <br/>...    # add article to the object batch request<br/>...   batch.add_data_object(  # old way was batch.add(...)<br/>...        data_object=article_object,<br/>...        class_name='Article',<br/>...        uuid=article_id<br/>...    )<br/>...    <br/>...    return article_id</span><span id="87e4" class="mo mp iq nq b gy nz nw l nx ny">&gt;&gt;&gt; def add_author(batch: Batch, author_name: str, created_authors: dict) -&gt; str:<br/>...    <br/>...    if author_name in created_authors:<br/>...        # return author UUID<br/>...        return created_authors[author_name]<br/>...    <br/>...    # generate an UUID for the Author<br/>...    author_id = generate_uuid5(author)<br/>...    <br/>...    # add author to the object batch request<br/>...    batch.add_data_object(  # old way was batch.add(...)<br/>...        data_object={'name': author_name},<br/>...        class_name='Author',<br/>...        uuid=author_id<br/>...    )<br/>...    <br/>...    created_authors[author_name] = author_id<br/>...    return author_id</span><span id="c08e" class="mo mp iq nq b gy nz nw l nx ny">&gt;&gt;&gt; def add_references(batch: Batch, article_id: str, author_id: str)-&gt; None:<br/>...    # add references to the reference batch request<br/>...    ## Author -&gt; Article<br/>...    batch.add_reference(  # old way was batch.add(...)<br/>...        from_object_uuid=author_id,<br/>...        from_object_class_name='Author',<br/>...        from_property_name='wroteArticles',<br/>...        to_object_uuid=article_id<br/>...    )<br/>...    <br/>...    ## Article -&gt; Author <br/>...    batch.add_reference(  # old way was batch.add(...)<br/>...        from_object_uuid=article_id,<br/>...        from_object_class_name='Article',<br/>...        from_property_name='hasAuthors',<br/>...        to_object_uuid=author_id<br/>...    )</span></pre><p id="b2a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经修改了上面的函数，使之与新的<code class="fe nn no np nq b">Batch</code>对象兼容，让我们来看看它们的运行情况。</p><h2 id="8981" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">a)手动</h2><p id="fe68" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">这种方法使用户可以完全控制何时以及如何添加和创建批处理。它非常类似于<code class="fe nn no np nq b">weaviate-client</code>版本&lt; 3.0.0的<code class="fe nn no np nq b">BatchRequests</code>方法，所以让我们来看看我们到底如何使用它(或者从旧版本迁移到它)。</p><p id="0573" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">参见下面代码单元中相同方法的上下文管理器方式。(<strong class="ky ir">不要同时运行两个单元！</strong></p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="72f7" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; from tqdm import trange</span><span id="b7a5" class="mo mp iq nq b gy nz nw l nx ny">&gt;&gt;&gt; for i in trange(1, 100):<br/>...     <br/>...    # add article to the batch<br/>...    article_id = add_article(client.batch, data[i])<br/>...    <br/>...    for author in data[i]['authors']:<br/>...        <br/>...        # add author to the batch<br/>...        author_id = add_author(client.batch, author, created_authors)<br/>...        <br/>...        # add cross references to the batch<br/>...        add_references(client.batch, article_id=article_id, author_id=author_id)<br/>...    <br/>...    if i % 20 == 0:<br/>...        # submit the objects from the batch to weaviate<br/>...        client.batch.create_objects()<br/>...        <br/>...        # submit the references from the batch to weaviate<br/>...        client.batch.create_references()</span><span id="a1f0" class="mo mp iq nq b gy nz nw l nx ny">&gt;&gt;&gt; # submit any objects that are left<br/>&gt;&gt;&gt; status_objects = client.batch.create_objects()<br/>&gt;&gt;&gt; status_references = client.batch.create_references()<br/>&gt;&gt;&gt; # if there is no need for the output from batch creation, one could flush both<br/>&gt;&gt;&gt; # object and references with one call<br/>&gt;&gt;&gt; client.batch.flush()</span></pre><p id="b014" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">或者，我们可以使用带有上下文管理器的<code class="fe nn no np nq b">Batch</code>实例，当它存在于上下文中时，就会调用<code class="fe nn no np nq b">flush()</code>方法。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="b1c1" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; from tqdm import trange</span><span id="1c84" class="mo mp iq nq b gy nz nw l nx ny">&gt;&gt;&gt; with client.batch as batch:<br/>...     for i in trange(1, 100):<br/>...        <br/>...        # add article to the batch<br/>...        article_id = add_article(batch, data[i])<br/>...        <br/>...        for author in data[i]['authors']:<br/>...            <br/>...            # add author to the batch<br/>...            author_id = add_author(batch, author, created_authors)<br/>...            <br/>...            # add cross references to the batch<br/>...            add_references(batch, article_id=article_id, author_id=author_id)<br/>...        <br/>...        if i % 20 == 0:<br/>...            # submit the objects from the batch to weaviate<br/>...            batch.create_objects()<br/>...            <br/>...            # submit the reference from the batch to weaviate<br/>...            batch.create_references()</span></pre><h2 id="aad1" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">b)满时自动创建批次</h2><p id="949f" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">该方法类似于<code class="fe nn no np nq b">weaviate-client</code>版本&lt; 3.0.0的<code class="fe nn no np nq b">Batcher</code>对象。让我们看看它是如何工作的。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="b998" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; # we still need the 'created_authors' so we do not add the same author twice<br/>&gt;&gt;&gt; client.batch.configure(<br/>...     batch_size=30,<br/>...    callback=None, # use this argument to set a callback function on the batch creation results<br/>...)<br/>&gt;&gt;&gt; for i in trange(100, 200):<br/>...    <br/>...    # add article to the batch<br/>...    article_id = add_article(client.batch, data[i])</span><span id="416e" class="mo mp iq nq b gy nz nw l nx ny">...    for author in data[i]['authors']:</span><span id="9cab" class="mo mp iq nq b gy nz nw l nx ny">...        # add author to the batch<br/>...        author_id = add_author(client.batch, author,                             created_authors)</span><span id="50c3" class="mo mp iq nq b gy nz nw l nx ny">...        # add cross references to the batch<br/>...        add_references(client.batch, article_id=article_id, author_id=author_id)<br/>&gt;&gt;&gt; client.batch.flush()</span></pre><p id="b36f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当然，我们也可以在这里使用上下文管理器。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="ba82" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; # we still need the 'created_authors' so we do not add the same author twice<br/>&gt;&gt;&gt; client.batch.configure(<br/>...     batch_size=30,<br/>...    callback=None, # use this argument to set a callback function on the batch creation results<br/>... )<br/>&gt;&gt;&gt; with client.batch(batch_size=30) as batch: # the client.batch(batch_size=30) is the same as client.batch.configure(batch_size=30)<br/>...     for i in trange(100, 200):</span><span id="46f8" class="mo mp iq nq b gy nz nw l nx ny">...        # add article to the batch<br/>...        article_id = add_article(batch, data[i])</span><span id="0e8d" class="mo mp iq nq b gy nz nw l nx ny">...        for author in data[i]['authors']:</span><span id="ec41" class="mo mp iq nq b gy nz nw l nx ny">...            # add author to the batch<br/>...            author_id = add_author(batch, author, created_authors)</span><span id="94a6" class="mo mp iq nq b gy nz nw l nx ny">...            # add cross references to the batch<br/>...            add_references(batch, article_id=article_id, author_id=author_id)</span></pre><h2 id="6c31" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">c)使用动态批处理自动创建批次，即每次创建批次时都会调整批次大小，以避免任何<code class="fe nn no np nq b">Timeout</code>错误。</h2><p id="b30a" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">该方法的工作方式与b)中描述的方法相同。我们不会用它来运行任何单元格，但是我要提到的是，要启用动态批处理，我们需要做的就是为<code class="fe nn no np nq b">configure</code> / <code class="fe nn no np nq b">__call__</code>方法提供另一个参数。</p><p id="ad82" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">示例:</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="69c5" class="mo mp iq nq b gy nv nw l nx ny">client.batch.configure(<br/>    batch_size<strong class="nq ir">=</strong>30,<br/>    dynamic<strong class="nq ir">=True</strong><br/>)</span></pre><p id="7767" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要查看这个新的<code class="fe nn no np nq b">Batch</code>对象的全部功能，请参见完整的文档<a class="ae kv" href="https://weaviate-python-client.readthedocs.io/en/latest/weaviate.batch.html#weaviate.batch.Batch" rel="noopener ugc nofollow" target="_blank">这里的</a>或者对<code class="fe nn no np nq b">Batch</code>或/和任何<code class="fe nn no np nq b">Batch</code>方法执行<code class="fe nn no np nq b">help</code>功能，就像这样:<code class="fe nn no np nq b">help(Batch)</code></p><h2 id="ebc8" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">5.5.查询数据。</h2><p id="34ae" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">现在我们已经导入了数据，并准备好进行查询。可以使用客户端对象的<code class="fe nn no np nq b">query</code>属性(<code class="fe nn no np nq b">client.query</code>)来查询数据。</p><p id="471b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用GraphQL语法查询数据，可以通过三种不同的方式完成:</p><ul class=""><li id="2a0b" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated"><strong class="ky ir"> GET </strong>:从Weaviate获取对象的查询。更多信息<a class="ae kv" href="https://www.semi.technology/developers/weaviate/current/graphql-references/get.html" rel="noopener ugc nofollow" target="_blank">此处</a>T25】使用<code class="fe nn no np nq b">client.query.get(class_name, properties).OTHER_OPTIONAL_FILTERS.do()</code></li><li id="fecb" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><strong class="ky ir">聚合</strong>:聚合数据的查询。更多信息<a class="ae kv" href="https://www.semi.technology/developers/weaviate/current/graphql-references/aggregate.html" rel="noopener ugc nofollow" target="_blank">此处</a>T29】使用<code class="fe nn no np nq b">client.query.aggregate(class_name, properties).OTHER_OPTIONAL_FILTERS.do()</code></li><li id="8830" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated">或者使用表示为<code class="fe nn no np nq b">str</code>的GraphQL查询。<br/>使用<code class="fe nn no np nq b">client.query.raw()</code></li></ul><p id="63fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong><code class="fe nn no np nq b">.get</code>和<code class="fe nn no np nq b">.aggregate</code>都需要调用<code class="fe nn no np nq b">.do()</code>方法来运行查询。<code class="fe nn no np nq b">.raw()</code>不会。</p><p id="dc2e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们只获取文章对象及其相应的标题。</p><h2 id="8318" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">获得</h2><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="d6f0" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; result = client.query.get(class_name='Article', properties="title")\<br/>...     .do()<br/>&gt;&gt;&gt; print(f"Number of articles returned: {len(result['data']['Get']['Article'])}")<br/>&gt;&gt;&gt; result</span><span id="4597" class="mo mp iq nq b gy nz nw l nx ny">Number of articles returned: 100<br/><br/><br/><br/><br/><br/>{'data': {'Get': {'Article': [{'title': "The soft power impact of Ruth Bader Ginsburg's decorative collars"},<br/>    {'title': 'After centuries in the ground, these French oaks will soon form part of the new spire at Notre Dame'},<br/>    {'title': 'With tradition and new tech, these Japanese designers are crafting more sustainably made clothing'},<br/>    {'title': "LEGO won't make modern war machines, but others are picking up the pieces"},<br/>    {'title': 'Remember when Jane Fonda revolutionized exercise in a leotard and leg warmers?'},<br/>    {'title': 'Be brave, Taylor tells Manchester City Women before Barcelona return leg'},<br/>    {'title': "'In the middle of a war zone': thousands flee as Venezuela troops and Colombia rebels clash"},<br/>    {'title': "Destruction of world's forests increased sharply in 2020"},<br/>    {'title': "Climate crisis 'likely cause' of early cherry blossom in Japan"},<br/>    {'title': "What's in a vaccine and what does it do to your body?"},<br/>    {'title': 'Zunar and Fahmi Reza: the cartoonists who helped take down Najib Razak'},<br/>    {'title': 'Downing Street suggests UK should be seen as model of racial equality'},<br/>    {'title': "'It's hard, we're neighbours': the coalmine polluting friendships on Poland's borders"},<br/>    {'title': 'Why we are all attracted to conspiracy theories – video'},<br/>    {'title': 'UK criticised for ignoring Paris climate goals in infrastructure decisions'},<br/>    {'title': 'GameStop raids Amazon for another heavy-hitter exec'},<br/>    {'title': 'The World Economic Forum says it will take an extra 36 years to close the gender gap'},<br/>    {'title': 'Share a story with the Guardian'},<br/>    {'title': "Paddleboarding and a released alligator: Tuesday's best photos"},<br/>    {'title': "Ballerina Chloé Lopes Gomes alleged racism at her company. Now she says it's time for change"},<br/>    {'title': 'How ancient Egyptian cosmetics influenced our beauty rituals'},<br/>    {'title': 'Why is Australia trying to regulate Google and Facebook – video explainer'},<br/>    {'title': 'Back in the swing and the swim: England returns to outdoor sport – in pictures'},<br/>    {'title': "Biden's tariffs threat shows how far Brexit Britain is from controlling its own destiny"},<br/>    {'title': 'Our cities may never look the same again after the pandemic'},<br/>    {'title': "World's first digital NFT house sells for $500,000"},<br/>    {'title': "The untold story of Ann Lowe, the Black designer behind Jackie Kennedy's wedding dress"},<br/>    {'title': 'Deliveroo shares slump on stock market debut'},<br/>    {'title': 'Hundreds of people missing after fire in Rohingya refugee camp in Bangladesh – video'},<br/>    {'title': "Why Beijing's Serpentine Pavilion signals a new age for Chinese architecture"},<br/>    {'title': 'My Brother’s Keeper: a former Guantánamo detainee, his guard and their unlikely friendship - video'},<br/>    {'title': 'Has your family been affected by the Brazilian or South African variants of Covid-19?'},<br/>    {'title': 'New Zealand raises minimum wage and increases taxes on the rich'},<br/>    {'title': 'Deliveroo shares plunge on market debut - business live'},<br/>    {'title': "Seoul's burgeoning drag scene confronts conservative attitudes"},<br/>    {'title': "David Hockney at 80: An encounter with the world's most popular artist"},<br/>    {'title': 'Una avanzada licuadora Nutribullet al mejor precio'},<br/>    {'title': "The 'fox eye' beauty trend continues to spread online. But critics insist it's racist"},<br/>    {'title': 'Lupita: the indigenous activist leading a new generation of Mexican women – video'},<br/>    {'title': "Hong Kong's vast $3.8 billion rain-tunnel network"},<br/>    {'title': 'See how tattoo art has changed since the 18th century'},<br/>    {'title': "Hong Kong Disneyland's new castle is an architectural vision of diversity"},<br/>    {'title': 'Rosamund Pike in "I Care a Lot" and six more recommendations if you love an antiheroine'},<br/>    {'title': 'How NFTs are fueling a digital art boom'},<br/>    {'title': "'We’re not little kids': leading agents ready for war with Fifa over new rules"},<br/>    {'title': 'A photographic history of men in love'},<br/>    {'title': "Hedge fund meltdown: Elizabeth Warren suggests regulators should've seen it coming"},<br/>    {'title': 'Palau to welcome first tourists in a year with presidential escort'},<br/>    {'title': 'Coronavirus: how wealthy nations are creating a ‘vaccine apartheid’'},<br/>    {'title': 'UK economy poised to recover after Covid-19 second wave'},<br/>    {'title': 'Missed it by that much: Australia falls 3.4m doses short of 4m vaccination target by end of March'},<br/>    {'title': "Meet North Korea's art dealer to the West"},<br/>    {'title': 'Why Australia remains confident in AstraZeneca vaccine as two countries put rollout on ice'},<br/>    {'title': 'Exclusive: Jamie Dimon speaks out on voting rights even as many CEOs remain silent'},<br/>    {'title': "Green investing 'is definitely not going to work’, says ex-BlackRock executive"},<br/>    {'title': 'European commission says AstraZeneca not obliged to prioritise vaccines for UK'},<br/>    {'title': '‘Honey, I forgot to duck’: the attempt to assassinate Ronald Reagan, 40 years on'},<br/>    {'title': 'Graba tus próximas aventuras con esta GoPro de oferta'},<br/>    {'title': "Europe’s 'baby bust': can paying for pregnancies save Greece? - video"},<br/>    {'title': "After the deluge: NSW's flood disaster victims begin cleanup – in pictures"},<br/>    {'title': "Wolfsburg v Chelsea: Women's Champions League quarter-final – live!"},<br/>    {'title': "'A parallel universe': the rickety pleasures of America's backroads - in pictures"},<br/>    {'title': "'Nomadland': Chloé Zhao and crew reveal how they made one of the year's best films"},<br/>    {'title': 'Seaspiracy: Netflix documentary accused of misrepresentation by participants'},<br/>    {'title': 'Unblocking the Suez canal – podcast'},<br/>    {'title': 'About half of people in UK now have antibodies against coronavirus'},<br/>    {'title': 'Top 10 books about New York | Craig Taylor'},<br/>    {'title': 'Is Moldova ready to embrace an unmarried, childfree president? | Europe’s baby bust – video'},<br/>    {'title': 'This woman left North Korea 70 years ago. Now virtual reality has helped her return'},<br/>    {'title': "'Immediate and drastic.' The climate crisis is seriously spooking economists"},<br/>    {'title': "Under Xi's rule, what is China's image of the 'ideal' man?"},<br/>    {'title': "'Hamlet' in the skies? The story behind Taiwan's newest airline, STARLUX"},<br/>    {'title': 'Pokémon at 25: How 151 fictional species took over the world'},<br/>    {'title': '‘Similar to having a baby, the euphoria’: rediscovery of rare gecko delights experts'},<br/>    {'title': 'How Budapest became a fine dining force to be reckoned with'},<br/>    {'title': "Teen who filmed killing tells court George Floyd was 'begging for his life'"},<br/>    {'title': 'Empowering, alluring, degenerate? The evolution of red lipstick'},<br/>    {'title': 'Real-world locations straight out of a Wes Anderson movie'},<br/>    {'title': 'The club kid designer dressing the most powerful women in US politics'},<br/>    {'title': "Fashion gaffes are a reflection of the industry's diversity problem"},<br/>    {'title': 'Our colorful clothes are killing the environment'},<br/>    {'title': 'Hazte con un Roku SE a mitad de precio'},<br/>    {'title': 'Why does Bollywood use the offensive practice of brownface in movies?'},<br/>    {'title': "Why Washington Football Team may stick with their 'so bad it’s good' name"},<br/>    {'title': "Graphic novel on the Tiananmen Massacre shows medium's power to capture history"},<br/>    {'title': 'Could a Norway boycott of the Qatar World Cup change the future of football?'},<br/>    {'title': 'Las 5 cosas que debes saber este 31 de marzo: Así es una instalación que alberga a menores migrantes'},<br/>    {'title': 'Multiplica el alcance de tu Wi-Fi con este repetidor rebajado un 50%'},<br/>    {'title': "'Lack of perspective': why Ursula von der Leyen's EU vaccine strategy is failing"},<br/>    {'title': 'Redder Days by Sue Rainsford review – waiting for the end of the world'},<br/>    {'title': 'Dita Von Teese and Winnie Harlow star in a star-studded fashion film'},<br/>    {'title': 'The Suez fiasco shows why ever bigger container ships are a problem'},<br/>    {'title': 'The most anticipated buildings set to shape the world in 2020'},<br/>    {'title': "Elite minority of frequent flyers 'cause most of aviation's climate damage'"},<br/>    {'title': "I love my boyfriend – but I really don't want to have sex with him"},<br/>    {'title': 'Amazon-backed Deliveroo crashes in London IPO'},<br/>    {'title': 'People are calling for museums to be abolished. Can whitewashed American history be rewritten?'},<br/>    {'title': 'Ruby Rose on gender, bullying and breaking free: ‘I had a problem with authority’'},<br/>    {'title': 'Merkel, Macron and Putin in talks on using Sputnik V jab in Europe, says Kremlin'},<br/>    {'title': 'After fighting cancer, Tracey Emin returns to the art world with raw, emotional works'}]}},<br/> 'errors': None}</span></pre><p id="f7e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此我们可以看到<code class="fe nn no np nq b">result</code>只包含100篇文章，这是由于默认的限制100。让我们改变它。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="3da0" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; result = client.query.get(class_name='Article', properties="title")\<br/>...     .with_limit(200)\<br/>...     .do()<br/>&gt;&gt;&gt; print(f"Number of articles returned: {len(result['data']['Get']['Article'])}")</span><span id="9e57" class="mo mp iq nq b gy nz nw l nx ny">Number of articles returned: 200</span></pre><p id="2811" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过堆叠多种方法，我们可以做得更多。<code class="fe nn no np nq b">.get</code>可用的方法有:</p><ul class=""><li id="3130" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated"><code class="fe nn no np nq b">.with_limit</code> -设置返回对象的另一个限制。</li><li id="d39c" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><code class="fe nn no np nq b">.with_near_object</code> -获取与传递给该方法的对象相似的对象。</li><li id="311a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><code class="fe nn no np nq b">.with_near_text</code> -获取与传递给该方法的文本相似的对象。</li><li id="b899" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><code class="fe nn no np nq b">.with_near_vector</code> -获取与传递给该方法的vector相似的对象。</li><li id="3a1e" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><code class="fe nn no np nq b">.with_where</code> -获取使用<code class="fe nn no np nq b">Where</code>过滤器过滤的对象，参见此<a class="ae kv" href="https://www.semi.technology/developers/weaviate/current/graphql-references/filters.html#where-filter" rel="noopener ugc nofollow" target="_blank">链接</a>获取示例和解释。</li></ul><p id="a7cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，可以使用将GraphQL查询作为字符串返回的<code class="fe nn no np nq b">.build()</code>方法来代替<code class="fe nn no np nq b">.do()</code>。这个字符串可以传递给<code class="fe nn no np nq b">.raw()</code>方法。</p><p id="bd19" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong>每个查询只能使用一个<code class="fe nn no np nq b">.with_near_*</code>。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="7545" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; client.query.get(class_name='Article', properties="title")\<br/>...     .with_limit(5)\<br/>...     .with_near_text({'concepts': ['Fashion']})\<br/>...     .do()</span><span id="2fd7" class="mo mp iq nq b gy nz nw l nx ny">{'data': {'Get': {'Article': [{'title': 'Dita Von Teese and Winnie Harlow star in a star-studded fashion film'},<br/>    {'title': "Fashion gaffes are a reflection of the industry's diversity problem"},<br/>    {'title': "Bottega Veneta ditches Instagram to set up 'digital journal'"},<br/>    {'title': 'Heir to O? Drew Barrymore launches lifestyle magazine'},<br/>    {'title': 'Our colorful clothes are killing the environment'}]}},<br/> 'errors': None}</span></pre><p id="7b30" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<code class="fe nn no np nq b">Get</code>我们可以看到每个对象的交叉引用。我们将为此使用<code class="fe nn no np nq b">.raw()</code>方法，因为用任何现有的<code class="fe nn no np nq b">.with_*</code>方法都不可能。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="e170" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; query = """<br/>... {<br/>...   Get {<br/>...     Article(limit: 2) {<br/>...       title<br/>... <br/>...       hasAuthors {         # the reference<br/>...         ... on Author {    # you always set the destination class<br/>...           name             # the property related to target class<br/>...         }<br/>...       }<br/>...     }<br/>...   }<br/>... }<br/>... """<br/><br/>&gt;&gt;&gt; prettify(client.query.raw(query)['data']['Get']['Article'])</span><span id="5564" class="mo mp iq nq b gy nz nw l nx ny">[<br/>  {<br/>    "hasAuthors": [<br/>      {<br/>        "name": "Rhonda Garelick"<br/>      }<br/>    ],<br/>    "title": "The soft power impact of Ruth Bader Ginsburg's decorative collars"<br/>  },<br/>  {<br/>    "hasAuthors": [<br/>      {<br/>        "name": "Saskya Vandoorne"<br/>      }<br/>    ],<br/>    "title": "After centuries in the ground, these French oaks will soon form part of the new spire at Notre Dame"<br/>  }<br/>]</span></pre><h2 id="c9d6" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">骨料</h2><p id="7c26" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">我们可以使用<code class="fe nn no np nq b">.aggregate</code>来计算满足特定条件的对象数量。</p><pre class="kg kh ki kj gt nr nq ns nt aw nu bi"><span id="8149" class="mo mp iq nq b gy nv nw l nx ny">&gt;&gt;&gt; # no filter, count all objects of class Article<br/>&gt;&gt;&gt; client.query.aggregate(class_name='Article')\<br/>...     .with_meta_count()\<br/>...     .do()</span><span id="ba21" class="mo mp iq nq b gy nz nw l nx ny">{'data': {'Aggregate': {'Article': [{'meta': {'count': 200}}]}},<br/> 'errors': None}</span><span id="2341" class="mo mp iq nq b gy nz nw l nx ny">&gt;&gt;&gt; # no filter, count all objects of class Author<br/>&gt;&gt;&gt; client.query.aggregate(class_name='Author')\<br/>...     .with_meta_count()\<br/>...     .do()</span><span id="bf3f" class="mo mp iq nq b gy nz nw l nx ny">{'data': {'Aggregate': {'Author': [{'meta': {'count': 258}}]}}, 'errors': None}</span></pre><p id="02c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是<code class="fe nn no np nq b">.aggregate</code>支持的方法。</p><ul class=""><li id="e583" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mg ly lz ma bi translated"><code class="fe nn no np nq b">.with_meta_count</code>将元计数设置为真。用于计算每个过滤组的对象数。</li><li id="0958" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><code class="fe nn no np nq b">.with_fields</code> -聚合查询返回的字段。</li><li id="bcf8" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><code class="fe nn no np nq b">.with_group_by_filter</code> -设置一个<code class="fe nn no np nq b">GroupBy</code>滤镜。查看此<a class="ae kv" href="https://www.semi.technology/developers/weaviate/current/graphql-references/aggregate.html#groupby-filter" rel="noopener ugc nofollow" target="_blank">链接</a>了解更多关于过滤器的信息。</li><li id="1d89" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mg ly lz ma bi translated"><code class="fe nn no np nq b">.with_where</code> -使用<code class="fe nn no np nq b">Where</code>过滤器聚集物体。参见此<a class="ae kv" href="https://www.semi.technology/developers/weaviate/current/graphql-references/filters.html#where-filter" rel="noopener ugc nofollow" target="_blank">链接</a>获取示例和解释。</li></ul><p id="2bb8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当然，在查询数据时，可能性是无穷无尽的。体验这些功能的乐趣。</p><p id="8c66" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">(jupyter-notebook可以在这里找到<a class="ae kv" href="https://github.com/semi-technologies/Getting-Started-With-Weaviate-Python-Client/blob/main/Getting-Started-With-Weaviate-Python-Client.ipynb" rel="noopener ugc nofollow" target="_blank">。)</a></p><p id="692a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请随时在<a class="ae kv" href="https://github.com/semi-technologies/weaviate-python-client" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上查看并为weaviate-client投稿。</p></div></div>    
</body>
</html>