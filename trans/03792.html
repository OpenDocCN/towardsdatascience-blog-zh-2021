<html>
<head>
<title>Minimum Viable Streaming Dashboard in Power BI: Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Power BI中的最小可行流仪表板:第2部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/minimum-viable-streaming-dashboard-in-power-bi-part-2-b902cd25c8?source=collection_archive---------25-----------------------#2021-03-29">https://towardsdatascience.com/minimum-viable-streaming-dashboard-in-power-bi-part-2-b902cd25c8?source=collection_archive---------25-----------------------#2021-03-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="736e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">具有推送数据集和Power BI REST API</h2></div><p id="4612" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">欢迎回到最小可行流仪表板系列的第2部分，在这里我们继续讨论实时仪表板以及如何在Power BI中配置它们。</p><p id="2444" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">回到<a class="ae lb" rel="noopener" target="_blank" href="/minimum-viable-streaming-dashboard-in-power-bi-part-1-56e00a82c22f">第1部分</a>，我们讨论了流数据集以及它们如何利用临时缓存来存储数据。数据过期快，导致历史数据分析无法进行。</p><p id="0bef" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，在本帖中，我们将探讨如何配置推送数据集。您将会看到更多的功能可供我们使用，包括过滤、工具提示、穿透钻取等等。</p><h1 id="5b7b" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">将数据推送到Power BI REST API</h1><h2 id="6057" class="lu ld iq bd le lv lw dn li lx ly dp lm ko lz ma lo ks mb mc lq kw md me ls mf bi translated">Power BI Rest API</h2><p id="5824" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">使用<a class="ae lb" href="https://docs.microsoft.com/en-us/rest/api/power-bi/" rel="noopener ugc nofollow" target="_blank"> Power BI REST API </a>将数据推送到Power BI数据集。</p><p id="d692" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">API包含一组服务端点，使开发人员和Azure服务能够在其上构建应用程序。尽管我们今天不会明确地调用这些端点，但有必要理解，您可以利用这个特定的<a class="ae lb" href="https://docs.microsoft.com/en-us/rest/api/power-bi/pushdatasets" rel="noopener ugc nofollow" target="_blank">操作集</a>在Power BI中创建您自己的推送/流数据集。</p><p id="3528" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就是Azure服务(如Azure Stream Analytics)与Power BI数据集交互的方式。</p><h2 id="d563" class="lu ld iq bd le lv lw dn li lx ly dp lm ko lz ma lo ks mb mc lq kw md me ls mf bi translated">推送数据的配置方法</h2><p id="d586" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated"><strong class="kh ir"> 1。API </strong></p><p id="989b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有两种方法可以将数据从数据源推送到BI的REST API。</p><p id="9465" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一种是使用Power BI服务中提供的<strong class="kh ir"> API选项。</strong></p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ml"><img src="../Images/b0cb1023f9364029cfe81d08fa4f880d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*An0SPbZCUbbKLTUwYVoHWw.png"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">Power BI服务中的API选项。图片由<a class="ae lb" href="https://nathancheng-data.medium.com/" rel="noopener">作者</a>提供。</p></figure><p id="7416" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当您单击API时，您将看到一个屏幕，您可以在其中命名Power BI数据集，并设计它的JSON模式。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/6d3a1171640e14558c315702307f7b5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*YmjtSte6ClSFnn0aF2ZaFQ.jpeg"/></div><p class="mx my gj gh gi mz na bd b be z dk translated">设计数据集。图片由<a class="ae lb" href="https://nathancheng-data.medium.com/" rel="noopener">作者</a>提供。</p></figure><p id="09ab" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意<strong class="kh ir">历史数据分析</strong> <strong class="kh ir">默认为</strong> <strong class="kh ir">关</strong>。</p><p id="2a94" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一个开关，您可以使用它在创建流数据集和利用两种模式下提供的功能的<strong class="kh ir">推送+流数据集</strong>之间切换。</p><p id="4822" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关闭切换只会创建一个流数据集，其工作方式类似于我们在<a class="ae lb" rel="noopener" target="_blank" href="/minimum-viable-streaming-dashboard-in-power-bi-part-1-56e00a82c22f">第1部分</a>中读取数据的PubNub流。</p><p id="2639" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">唯一的区别是，对于PubNub来说，Power BI仅仅是从PubNub的API中读取一个数据流。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/7796aca169158809c113c623bef3c18b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*F9S4qG2FOFgLgGQNvijsXw.jpeg"/></div><p class="mx my gj gh gi mz na bd b be z dk translated">Power BI创建的推送URL端点。图片由<a class="ae lb" href="https://nathancheng-data.medium.com/" rel="noopener">作者</a>提供。</p></figure><p id="b341" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以将数据推送到REST API，而无需通过Power BI服务的UI。但是请记住，您必须<strong class="kh ir">授权您的应用程序使用权限</strong>来对您想要创建数据集的Power BI工作区进行更改。</p><p id="9190" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一个值得专门撰写博客的话题。</p><p id="1ba6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">今天，我们将主要关注将数据推送到Power BI REST API的第二种方法，使用Azure Stream Analytics。</p><p id="08f7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 2。Azure流分析(ASA) </strong></p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/e8be97f991b84f38c6f6dca6997534d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*rWj82pgfuKda5s4CqCKtIg.png"/></div><p class="mx my gj gh gi mz na bd b be z dk translated">Azure Stream Analytics徽标。图片由<a class="ae lb" href="https://azure.microsoft.com/en-us/services/stream-analytics/" rel="noopener ugc nofollow" target="_blank">微软</a>提供。</p></figure><p id="dada" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Azure Stream Analytics是一个托管的PaaS服务，运行在微软的Azure平台上。如果你以前使用过Spark的结构化流媒体引擎，那么ASA引擎非常相似。</p><p id="3ee2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ASA作业是用类似SQL的查询语言编写的，这是任何使用过数据库的开发人员都能理解的通用语言。</p><p id="5483" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该服务的设计理念与<a class="ae lb" href="https://www.youtube.com/watch?v=wQfm4P23Hew&amp;ab_channel=DataCouncil" rel="noopener ugc nofollow" target="_blank"> Spark的结构化流项目</a>高度相似，即作为服务的消费者，您不必担心事件流处理的复杂性，即延迟数据到达时间、数据无序、事件交付保证。</p><p id="5efe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您应该能够告诉ASA您想要的输出，用SQL编写您的查询，就像您正在运行一个批处理查询一样，服务会计算出如何将该查询转换成可以在流上运行的版本。</p><h1 id="dcd6" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">演示:事件流</h1><p id="afec" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">这是我们今天要构建的应用程序的示意图。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ne"><img src="../Images/5557752b07201945b34139ff8521c101.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ycy6eX9Vjc093vAmb1OPtw.jpeg"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">演示应用程序架构图。图片由<a class="ae lb" href="https://nathancheng-data.medium.com/" rel="noopener"> <em class="nf">作者</em> </a>提供。</p></figure><p id="3062" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于我们的事件数据源，我们将使用一个简单的Python脚本向事件中心发送事件。</p><p id="cc5c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以，废话不多说，让我们从Event Hub开始，创建我们的应用程序所需的资源。</p><h2 id="8494" class="lu ld iq bd le lv lw dn li lx ly dp lm ko lz ma lo ks mb mc lq kw md me ls mf bi translated">为事件摄取创建事件中心名称空间</h2><p id="26ac" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我们必须创建的第一个资源是一个事件中心名称空间，用于接收所有事件。</p><p id="1b60" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在此之前，请前往Azure并注册一个免费试用版。你可以获得200美元的免费信用点数，在30天内探索Azure服务。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ng"><img src="../Images/a544098a6776580623766d0ec3d51a6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G2N0ipMO_W8wJhC2zix8uA.png"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">Azure免费试用注册屏幕。图片来自<a class="ae lb" href="https://nathancheng-data.medium.com/" rel="noopener">作者</a>。</p></figure><p id="596b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你目前是学生，你可以获得价值100美元的额外Azure点数。</p><p id="635a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 1。创建事件中心名称空间</strong></p><p id="7e5c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注册完成后，在门户的搜索栏中搜索事件中心，单击事件中心，并填写以下属性:</p><ul class=""><li id="852d" class="nh ni iq kh b ki kj kl km ko nj ks nk kw nl la nm nn no np bi translated">订阅:选择您的默认订阅</li><li id="3e53" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la nm nn no np bi translated">资源组:<strong class="kh ir">创建新的</strong>，并为资源组选择一个名称</li><li id="55eb" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la nm nn no np bi translated">名称空间名称:为事件中心名称空间选择一个名称</li><li id="93a2" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la nm nn no np bi translated">位置:选择离你最近的地区</li><li id="59c0" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la nm nn no np bi translated">定价层级:<strong class="kh ir">标准</strong></li><li id="9249" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la nm nn no np bi translated">吞吐量单位:<strong class="kh ir"> 1 </strong></li><li id="c530" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la nm nn no np bi translated">启用可用性区域:<strong class="kh ir">未选中</strong></li><li id="7865" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la nm nn no np bi translated">启用自动充气:<strong class="kh ir">未选中</strong></li></ul><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nv"><img src="../Images/87d30d341ecaf54f158ac93186309759.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g-uFR4nfOznAeD8i45gMug.jpeg"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">创建事件中心命名空间。图片由<a class="ae lb" href="https://nathancheng-data.medium.com/" rel="noopener">作者</a>提供。</p></figure><p id="0ce9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">事件中心名称空间充当多个事件中心实例或Kafka术语中的主题的管理容器。</p><p id="4e66" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">事件发布者可以使用基于Azure Active Directory的身份验证和授权，或者使用共享访问签名(SAS)将事件推送到每个主题。</p><p id="7905" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 2。添加SAS策略</strong></p><p id="5745" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要一个SAS令牌来授权我们的Python应用程序向Event Hub发送事件。</p><p id="f0af" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，转到Event Hub名称空间中的Shared Access Policies窗格，添加一个包含以下详细信息的新策略:</p><ul class=""><li id="8365" class="nh ni iq kh b ki kj kl km ko nj ks nk kw nl la nm nn no np bi translated">策略名称:选择策略名称</li><li id="4ac3" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la nm nn no np bi translated">管理:<strong class="kh ir">勾选</strong></li></ul><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/62217b9547d3d8580022a246b360707b.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*AKPSxGlTdlZTJY3eUqWRKw.jpeg"/></div><p class="mx my gj gh gi mz na bd b be z dk translated">添加事件中心命名空间SAS策略。图片由<a class="ae lb" href="https://nathancheng-data.medium.com/" rel="noopener">作者</a>提供。</p></figure><p id="ee26" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">复制为您创建的<strong class="kh ir">连接字符串-主键</strong>，并将其保存在方便的地方，我们将在稍后的Python脚本中使用它来向事件中心发送web事件。</p><p id="b7ee" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 3。创建一个活动中心</strong></p><p id="82db" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将鼠标悬停在“事件中心”窗格上，并使用以下属性创建一个事件中心实例:</p><ul class=""><li id="aec4" class="nh ni iq kh b ki kj kl km ko nj ks nk kw nl la nm nn no np bi translated">名称:为事件中心实例选择一个名称</li><li id="951b" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la nm nn no np bi translated">分区计数:<strong class="kh ir"> 1 </strong></li><li id="7e8c" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la nm nn no np bi translated">消息保留:<strong class="kh ir"> 1 </strong>(如果您需要一天以上的时间来完成本文中的步骤，请随意设置一个更长的保留期)</li><li id="3253" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la nm nn no np bi translated">捕捉:<strong class="kh ir">关</strong></li></ul><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nx"><img src="../Images/1adca4cdc7b92e736564ee533665ff16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NcUN6wBo2w88rGYqhOOxsg.jpeg"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">创建事件中心实例。图片由<a class="ae lb" href="https://nathancheng-data.medium.com/" rel="noopener">作者</a>提供。</p></figure><h2 id="91ab" class="lu ld iq bd le lv lw dn li lx ly dp lm ko lz ma lo ks mb mc lq kw md me ls mf bi translated">用Python编写事件生成器</h2><p id="e116" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我们今天要使用的代码可以在这个<a class="ae lb" href="https://github.com/natworkeffects/power-bi-streaming" rel="noopener ugc nofollow" target="_blank"> Github repo </a>中找到。</p><p id="7049" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 1。安装Python 3 </strong></p><p id="1486" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在你的系统上安装<a class="ae lb" href="https://www.python.org/downloads/release/python-379/" rel="noopener ugc nofollow" target="_blank"> Python 3 </a>。确保您使用的版本至少为3.6及以上。我用的是3.7.9版本。</p><p id="5cd7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 2。安装Visual Studio (VS)代码编辑器</strong></p><p id="fd48" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装您的Linux / Windows / MacOS版本的<a class="ae lb" href="https://code.visualstudio.com/download" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a>。</p><p id="577d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，在您的目录中创建一个项目文件夹。我把我的命名为<strong class="kh ir"> <em class="ny">事件流</em> </strong>，但是你可以随意命名你的。</p><p id="069a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 3。列出所需的Python包</strong></p><p id="fa23" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">继续，打开刚才在VS代码中创建的文件夹。创建一个<strong class="kh ir"><em class="ny">requirements . txt</em></strong>文件。将Github repo中的代码复制并粘贴到您的文件中。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/b536712d5fcaa710bc260e62e04764ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*kX3K4SvxpXQluz38PT5yUQ.jpeg"/></div><p class="mx my gj gh gi mz na bd b be z dk translated">必需的Python包。图片由<a class="ae lb" href="https://nathancheng-data.medium.com/" rel="noopener">作者</a>提供。</p></figure><p id="e9d0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 4。编写模拟随机网络事件的Python代码</strong></p><p id="1cc1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完成后，创建一个<strong class="kh ir"><em class="ny">send _ events . py</em></strong>文件。将repo中的代码复制并粘贴到文件中。</p><p id="36f8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在您的终端中，运行以下命令:</p><pre class="mm mn mo mp gt oa ob oc od aw oe bi"><span id="bca6" class="lu ld iq ob b gy of og l oh oi">pip3 install -r requirements.txt</span></pre><p id="51a7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将安装包我们指定在<strong class="kh ir"><em class="ny">requirements . txt</em></strong>文件前面。</p><p id="a4e6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果pip3命令失败，<strong class="kh ir"> <em class="ny"> cd </em> </strong>到VS代码终端中您电脑上<strong class="kh ir"><em class="ny">Python/Python 37/Scripts</em></strong>文件夹中的确切pip3文件路径。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi oj"><img src="../Images/c894244edd66fb119f341f4f8bbc3ad6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ysLNfheuG_76czE3DJoLA.jpeg"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">Python脚本模拟随机网络事件。图片由<a class="ae lb" href="https://nathancheng-data.medium.com/" rel="noopener">作者</a>提供。</p></figure><p id="eff3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 5。运行Python文件将事件发送到事件中枢</strong></p><p id="53cb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在运行文件将事件推送到事件中心之前，将<strong class="kh ir">连接字符串-主键</strong>粘贴到<strong class="kh ir"> <em class="ny"> &lt;连接字符串&gt; </em> </strong>参数中。</p><p id="a280" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，在<strong class="kh ir"> <em class="ny"> &lt;事件中枢&gt; </em> </strong>参数中填写您的事件中枢主题名称。</p><p id="bc65" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完成这些步骤后，右键单击代码编辑器中的任意位置，并选择<strong class="kh ir">在终端</strong>中运行Python文件。</p><h2 id="4521" class="lu ld iq bd le lv lw dn li lx ly dp lm ko lz ma lo ks mb mc lq kw md me ls mf bi translated">从VS代码编辑器创建Azure流分析作业</h2><p id="978a" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated"><strong class="kh ir"> 1。安装Azure流分析工具扩展</strong></p><p id="f30a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在VS代码中，点击<strong class="kh ir">扩展</strong>标签，搜索<strong class="kh ir"> Azure Stream Analytics </strong>。</p><p id="9e9e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装<strong class="kh ir"> Azure流分析工具</strong>扩展。</p><p id="20c2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">作为依赖，还为我们安装了<strong class="kh ir"> Azure账号</strong>扩展。这个扩展使我们能够从Azure Portal中检索数据，并将我们的ASA作业发布到门户。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ok"><img src="../Images/8793665d7bc6534098fac2200715d6c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HY7W5AeMq47w3WvJNSJxCg.jpeg"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">在VS代码中安装Azure流分析扩展。图片由<a class="ae lb" href="https://nathancheng-data.medium.com/" rel="noopener">作者</a>提供。</p></figure><p id="8718" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 2。创建新的流分析项目</strong></p><p id="ebcc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Visual Studio代码中，导航回<strong class="kh ir">资源管理器</strong>选项卡。</p><p id="c7d6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用<strong class="kh ir"> Ctrl+Shift+P / Cmd+Shift+P </strong>打开命令面板。</p><p id="60c4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，在搜索栏中输入ASA。</p><p id="82f4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">选择<strong class="kh ir"> ASA:创建新项目</strong>，输入您的项目名称。我把我的矿命名为<strong class="kh ir"><em class="ny"/></strong>。</p><p id="6468" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 3。定义输入数据</strong></p><p id="2797" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">展开<strong class="kh ir">输入</strong>文件夹，打开<strong class="kh ir"> <em class="ny"> input.json </em> </strong>文件。我们将使用这个文件来指定一个输入数据流，我们的ASA作业可以从中读取数据。</p><p id="86e4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在编辑器窗口的左上角，点击<strong class="kh ir">添加实时输入</strong>按钮。选择<strong class="kh ir">活动中心</strong>，然后<strong class="kh ir">从您的Azure订阅中选择</strong>。</p><p id="03c3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">给你的输入流起个名字，我命名为mine<strong class="kh ir">T23】event-hub-streamT25】。</strong></p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ol"><img src="../Images/138a2b04beb84670d46614436c617d17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*--djZ_c4kCvWnfgMZ-_BQQ.jpeg"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">将实时输入流添加到流分析作业。图片由<a class="ae lb" href="https://nathancheng-data.medium.com/" rel="noopener">作者</a>提供。</p></figure><p id="97d5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后你可以使用新的<strong class="kh ir">和<em class="ny">。在<strong class="kh ir">输入</strong>文件夹中为您创建的json </em>文件填充您的事件中枢连接设置，通过点击交互按钮。</strong></p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi om"><img src="../Images/24460fbf0e7ca4ba91ec727b22ca3ba8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j1MEJEIGlOn3bhmBmON0bQ.jpeg"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">配置事件中心实时输入流。图片由<a class="ae lb" href="https://nathancheng-data.medium.com/" rel="noopener">作者</a>提供。</p></figure><p id="ba95" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">点击<strong class="kh ir">预览数据</strong>位于<strong class="kh ir">左上角<em class="ny">。json </em> </strong>文件，以便了解我们之前使用Python脚本发送到Event Hub的数据。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi on"><img src="../Images/9d1ae8c406aaf1babda3523a96d30abb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zxBIM67G7KM8KQRNCwuyvg.jpeg"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">预览事件中心数据。图片由<a class="ae lb" href="https://nathancheng-data.medium.com/" rel="noopener">作者</a>提供。</p></figure><p id="860f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，输入流中的所有数据都被视为字符串。对于其中的一些列，例如<strong class="kh ir"><em class="ny">event _ timestamp</em></strong>，我们将在下一步中使用ASA查询将它们的数据类型更改为<strong class="kh ir"> <em class="ny"> datetime </em> </strong>。</p><p id="e8df" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 4。编写流分析查询</strong></p><p id="d795" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">中的<em class="ny">。asaql </em> </strong>文件，插入来自Github repo的SQL查询。</p><p id="97e1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您希望修改查询，可以在<a class="ae lb" href="https://docs.microsoft.com/en-us/stream-analytics-query/stream-analytics-query-language-reference" rel="noopener ugc nofollow" target="_blank">这里</a>找到流分析查询语言提供的功能的综合参考。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi oo"><img src="../Images/3b8e9b317fabab4441eb0c89a555511f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yENEVDEp-JbsDr6BF2j6yA.jpeg"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">流分析SQL查询。图片由<a class="ae lb" href="https://nathancheng-data.medium.com/" rel="noopener">作者</a>提供。</p></figure><p id="10d1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 5。定义输出接收器</strong></p><p id="df25" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">执行与步骤3中相同的过程，为ASA作业创建要写入的输出接收器。</p><p id="123c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">展开<strong class="kh ir">输出</strong>文件夹，打开<strong class="kh ir"> <em class="ny"> output.json </em> </strong>文件。</p><p id="5b47" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">点击<strong class="kh ir">添加输出，</strong>选择<strong class="kh ir"> Power BI </strong>，然后<strong class="kh ir">从你的Azure订阅中选择</strong>。</p><p id="ec2d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">给你的输出起个名字，我的是<strong class="kh ir"> <em class="ny">事件-中枢-数据集</em> </strong>。</p><p id="57f2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后你可以使用新的<strong class="kh ir"> <em class="ny">。在<strong class="kh ir"> Outputs </strong>文件夹中为您创建的json </em>和</strong>文件，用于填充您的Power BI工作空间和数据集信息。</p><p id="49ee" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">记下<strong class="kh ir"> <em class="ny"> GroupId </em> </strong> uuid值。该值唯一标识您选择的Power BI工作空间。我们稍后将使用它向ASA作业授予写入该工作区的权限。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi op"><img src="../Images/a3f0c99e0c407247a24b19e3ca3eabe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CkzfX4PNTZMOsMBG9CE6HQ.jpeg"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">为流分析作业配置Power BI输出数据集。图片来自<a class="ae lb" href="https://nathancheng-data.medium.com/" rel="noopener">作者</a>。</p></figure><p id="1d46" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意<strong class="kh ir">我的工作空间</strong>选项在VS代码中不可用(虽然在Azure Portal中创建Power BI输出接收器时可用)。</p><p id="5bf6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，您必须首先在Power BI服务中创建一个工作区，然后在VS代码的下拉列表中选择工作区。</p><p id="0a81" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这需要你有一个<strong class="kh ir">专业版账号</strong>，或者免费试用专业版。</p><p id="c2f0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您没有Pro许可证，您必须将输出数据集工作空间设置在<strong class="kh ir">我的工作空间</strong>中，这是通过在Azure Portal中编辑您的ASA作业来完成的。</p><p id="4146" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">6。编辑您的SQL查询以引用您新创建的输入流和输出接收器</p><p id="00db" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">回到你的<strong class="kh ir"> <em class="ny">。asaql </em> </strong>文件，并更改<strong class="kh ir">输出</strong>来反映你的Power BI输出sink，更改<strong class="kh ir">输入</strong>来反映你的Event Hub流。</p><p id="48a5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">他们将各自的名字命名为<strong class="kh ir"> <em class="ny">。被创建的json </em> </strong>文件。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi oq"><img src="../Images/779dfdfce3fc82c1188ff7b362d46acc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wXkhVG8NyU2tY-s0_2AHmQ.jpeg"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">指定SQL查询以事件中心输入流为目标，并将数据写入Power BI数据集。图片由<a class="ae lb" href="https://nathancheng-data.medium.com/" rel="noopener">作者</a>提供。</p></figure><h2 id="106e" class="lu ld iq bd le lv lw dn li lx ly dp lm ko lz ma lo ks mb mc lq kw md me ls mf bi translated">将ASA作业发布到Azure门户</h2><p id="54cd" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated"><strong class="kh ir"> 1。提交ASA作业并创建服务主体</strong></p><p id="4ecd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在你的<strong class="kh ir">中<em class="ny">。asaql </em> </strong>文件，并通过点击左上角的<strong class="kh ir">提交到Azure </strong>将您的作业提交到Azure门户。</p><p id="8bdd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">给Azure几分钟时间来完成作业的部署。</p><p id="5662" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以在<strong class="kh ir"> Azure Stream Analytics </strong>终端窗口中监控ASA部署日志。</p><p id="fe57" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">部署完成后，转到Azure Portal查看您的新ASA作业。</p><p id="6bfb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">点击管理身份面板，确保<strong class="kh ir">使用系统分配的管理身份</strong>在上设置为<strong class="kh ir">。</strong></p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi or"><img src="../Images/da82a246221f87b656530440d5dbd1aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o_0-GVcqUsJLvz7_ufFQYQ.jpeg"/></div></div><p class="mx my gj gh gi mz na bd b be z dk translated">流分析应用程序的服务主体ID。图片由<a class="ae lb" href="https://nathancheng-data.medium.com/" rel="noopener">作者</a>提供。</p></figure><p id="644b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Azure已经为您的ASA应用程序自动创建了一个服务主体，以及一个与<strong class="kh ir">相关联的主体ID </strong>，用于在将数据写入Power BI工作区时进行身份验证。</p><p id="7ece" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">复制主体ID，我们将在下一步中使用它。</p><p id="d3f6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 2。授予ASA工作贡献者对您的Power BI工作区的访问权限。</strong></p><p id="5930" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们要做的就是授予ASA作业对Power BI工作区的写访问权限。</p><p id="890f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过使用<strong class="kh ir"><em class="ny">MicrosoftPowerBIMgmt</em></strong>PowerShell cmdlet来做到这一点。</p><p id="c2ae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在您的计算机上打开Windows PowerShell，并键入以下命令来安装cmdlet:</p><pre class="mm mn mo mp gt oa ob oc od aw oe bi"><span id="4bb2" class="lu ld iq ob b gy of og l oh oi">Install-Module -Name MicrosoftPowerBIMgmt</span></pre><p id="1f85" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，继续使用您的凭据登录Power BI:</p><pre class="mm mn mo mp gt oa ob oc od aw oe bi"><span id="1343" class="lu ld iq ob b gy of og l oh oi">Login-PowerBI</span></pre><p id="23eb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">输入以下命令，授予ASA服务主体<strong class="kh ir"> Contributor </strong>对您指定的输出工作空间的访问权限。</p><p id="732a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将<strong class="kh ir"><em class="ny">&lt;group-ID&gt;</em></strong>替换为您从<strong class="kh ir"><em class="ny"/></strong>your<strong class="kh ir"><em class="ny">output . JSON</em></strong>文件中复制的<strong class="kh ir"> <em class="ny"> GroupId </em> </strong>，将<strong class="kh ir"><em class="ny">&lt;Principal-ID&gt;</em></strong>替换为ASA作业的<strong class="kh ir"> <em class="ny"> Principal ID </em> </strong>。</p><pre class="mm mn mo mp gt oa ob oc od aw oe bi"><span id="cf8f" class="lu ld iq ob b gy of og l oh oi">Add-PowerBIWorkspaceUser -WorkspaceId &lt;group-id&gt; -PrincipalId &lt;principal-id&gt; -PrincipalType App -AccessRight Contributor</span></pre><p id="316c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 3。启动作业，并在Power BI工作空间中检查您的输出数据集</strong></p><p id="b1e2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Azure门户中，在ASA作业的概览窗格上，按<strong class="kh ir"> Start </strong>运行作业。</p><p id="ab80" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">导航到Power BI工作区，并验证数据集是否已成功创建。</p><p id="949b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果没有创建数据集，您的事件可能已经过期，因为我们只将事件中心中事件的保留期设置为1天。</p><p id="a2f3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这种情况下，再次使用<strong class="kh ir"><em class="ny">send _ events . py</em></strong>文件发送web事件，然后验证事件是否已经写入Power BI数据集。</p><h1 id="1897" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">结论</h1><p id="8ee6" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">在本文中，我们探讨了如何在Power BI中创建推送数据集。</p><p id="4585" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从将web事件从一个简单的Python脚本接收到一个事件中心开始。然后，使用Azure Stream Analytics作为处理引擎，对数据输入流进行转换。</p><p id="df9e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<a class="ae lb" rel="noopener" target="_blank" href="/minimum-viable-streaming-dashboard-in-power-bi-part-3-9d0b29f4f6a2">第3部分</a>中，我们将通过更多地谈论流分析及其成本模型来结束这一系列，并发布我们的第一份Power BI报告，其中包含我们在本帖中构建的数据集。</p><p id="58d6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在结束之前，我想简单介绍一下当今架构中使用的服务组件。</p><h2 id="096e" class="lu ld iq bd le lv lw dn li lx ly dp lm ko lz ma lo ks mb mc lq kw md me ls mf bi translated">事件交付保证</h2><p id="2e0c" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">在使用流技术时，您应该注意一些警告，其中最重要的是事件交付保证。</p><p id="e60b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ASA保证至少向输出接收器传递一次，这保证了所有记录都被传递到Power BI，但是数据集中可能会出现重复的记录。</p><p id="e1ff" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在需要一次性交付记录的情况下，修改流分析查询，使用唯一标识符/主键来处理记录的重复数据删除。</p><h2 id="eb48" class="lu ld iq bd le lv lw dn li lx ly dp lm ko lz ma lo ks mb mc lq kw md me ls mf bi translated">流分析创建的Power BI数据集中的默认参数</h2><p id="844b" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">ASA使用<a class="ae lb" href="https://docs.microsoft.com/en-us/rest/api/power-bi/pushdatasets/datasets_postdatasetingroup" rel="noopener ugc nofollow" target="_blank">推送数据集服务端点</a>创建一个Power BI推送数据集，其<strong class="kh ir"> <em class="ny">默认模式</em> </strong>参数设置为<strong class="kh ir"> <em class="ny">推送流</em> </strong>，从而产生一个数据集，该数据集可以利用我们在<a class="ae lb" rel="noopener" target="_blank" href="/minimum-viable-streaming-dashboard-in-power-bi-part-1-56e00a82c22f">第1部分</a>中看到的报告功能和平滑动画流切片。</p><p id="2418" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ASA还自动将数据集的<strong class="kh ir"><em class="ny">retention policy</em></strong>参数设置为<strong class="kh ir"> <em class="ny"> basicFIFO </em> </strong>。有了这个设置，Power BI中支持Push dataset的数据库存储了200，000行，这些行以先进先出(FIFO)的方式被删除。</p><p id="4d84" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，即使使用推送数据集，我们也无法分析跨越太远的业务历史数据。然而，这是对仅利用临时缓存来存储数据的流数据集的改进。</p><h1 id="9cee" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">资源</h1><p id="ed0b" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我要感谢微软的贡献者，他们为我们在这篇博文中使用的技术写了很棒的文档。</p><p id="487d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您需要更多信息，请从下面列出的文章开始研究:</p><ol class=""><li id="79ab" class="nh ni iq kh b ki kj kl km ko nj ks nk kw nl la os nn no np bi translated"><a class="ae lb" href="https://docs.microsoft.com/en-us/power-bi/connect-data/service-real-time-streaming" rel="noopener ugc nofollow" target="_blank">电力BI中的实时流</a></li><li id="104b" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la os nn no np bi translated"><a class="ae lb" href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-python-get-started-send" rel="noopener ugc nofollow" target="_blank">使用Python从Azure事件中心发送或接收事件</a></li><li id="2b8e" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la os nn no np bi translated"><a class="ae lb" href="https://docs.microsoft.com/en-us/stream-analytics-query/stream-analytics-query-language-reference" rel="noopener ugc nofollow" target="_blank">流分析查询语言参考</a></li><li id="997c" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la os nn no np bi translated"><a class="ae lb" href="https://docs.microsoft.com/en-us/stream-analytics-query/event-delivery-guarantees-azure-stream-analytics" rel="noopener ugc nofollow" target="_blank">事件交付保证(Azure流分析)</a></li><li id="76a4" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la os nn no np bi translated"><a class="ae lb" href="https://docs.microsoft.com/en-us/rest/api/power-bi/" rel="noopener ugc nofollow" target="_blank"> Power BI REST API </a></li><li id="6d7e" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la os nn no np bi translated"><a class="ae lb" href="https://docs.microsoft.com/en-us/azure/stream-analytics/powerbi-output-managed-identity" rel="noopener ugc nofollow" target="_blank">使用托管身份认证您的Azure流分析作业，以支持BI输出</a></li><li id="55ad" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la os nn no np bi translated"><a class="ae lb" href="https://pypi.org/project/fake-web-events/" rel="noopener ugc nofollow" target="_blank">假网络事件| PyPI </a></li></ol><p id="4bbc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，我们今天使用的所有代码片段都可以在提供的Github资源库中找到。在那之前，我们在<a class="ae lb" rel="noopener" target="_blank" href="/minimum-viable-streaming-dashboard-in-power-bi-part-3-9d0b29f4f6a2">第三部</a>再见。</p><div class="ot ou gp gr ov ow"><a href="https://github.com/natworkeffects/power-bi-streaming" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd ir gy z fp pb fr fs pc fu fw ip bi translated">GitHub-natworkeffects/power-bi-streaming</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">github.com</p></div></div><div class="pf l"><div class="pg l ph pi pj pf pk mv ow"/></div></div></a></div></div></div>    
</body>
</html>