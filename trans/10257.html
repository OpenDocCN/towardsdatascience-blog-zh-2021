<html>
<head>
<title>Binning Records on a Continuous Variable with Pandas Cut and QCut</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">宁滨用熊猫切和QCut记录了一个连续变量</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/binning-records-on-a-continuous-variable-with-pandas-cut-and-qcut-5d7c8e11d7b0?source=collection_archive---------11-----------------------#2021-09-29">https://towardsdatascience.com/binning-records-on-a-continuous-variable-with-pandas-cut-and-qcut-5d7c8e11d7b0?source=collection_archive---------11-----------------------#2021-09-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="7442" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/getting-started" rel="noopener" target="_blank">入门</a></h2><div class=""/><div class=""><h2 id="a4dc" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">何时、为何以及如何将数字特征转换为分类特征</h2></div><p id="1a12" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">今天，我将使用“西雅图市工资:按性别比较-工资增长职位”数据集来探索宁滨-也称为分组记录-以及单个数字变量。在西雅图开放数据门户的这里找到数据<a class="ae ln" href="https://data.seattle.gov/City-Business/City-of-Seattle-Wages-Comparison-by-Gender-Wage-Pr/k9m8-nhz3" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="849a" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">给binners一个警告:宁滨降低了粒度，并不总是有用的。宁滨通常不用于机器学习模型。</p><p id="5e35" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">对分箱数据消费者的一个警告:分箱边缘的选择会有很大的影响，特别是在小样本中。当心有人利用宁滨来欺骗或误导你。就推理和其他宁滨选项的结果提问。</p><h1 id="6b37" class="lo lp it bd lq lr ls lt lu lv lw lx ly ki lz kj ma kl mb km mc ko md kp me mf bi translated">何时以及为什么要装箱</h1><p id="9629" class="pw-post-body-paragraph kr ks it kt b ku mg kd kw kx mh kg kz la mi lc ld le mj lg lh li mk lk ll lm im bi translated">我使用宁滨将连续数据分组进行比较。例如，我可以把人们分成不同的年龄组。这允许统计比较和流线型视觉的创造。</p><p id="f47b" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">同时，这种划分可能有些武断:如果我们以10岁为增量分组，30岁的人可能比21岁的人更接近31岁的人。</p><p id="651f" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我喜欢在两种情况下绑定:</p><ol class=""><li id="629d" class="ml mm it kt b ku kv kx ky la mn le mo li mp lm mq mr ms mt bi translated">当存在现实生活或商业门槛时。例如，在航空里程方面，当你达到某个阈值时，福利和激励就会改变，从而形成逻辑分组。对于联合航空公司:MileagePlus、卓越银牌、卓越金牌、卓越白金、卓越1k。</li><li id="b988" class="ml mm it kt b ku mu kx mv la mw le mx li my lm mq mr ms mt bi translated">确定模式后，当创建适合我的观众的可视化效果时。在今天的例子中，我绘制了每种工作的女性百分比(在城市报告中，具有该职位的员工中有多少百分比被确定为女性)与该职位的平均时薪(在该职位级别的所有员工中):</li></ol><figure class="na nb nc nd gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi mz"><img src="../Images/ae5bf2a2f6dc7b7fe8f9ba384c9c812e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ltoo9knIb4CsZv8o8uRldw.png"/></div></div><p class="nl nm gj gh gi nn no bd b be z dk translated">西雅图市女性工作百分比与平均时薪散点图。趋势线随着平均时薪的增加而减小。</p></figure><p id="5957" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">通过最佳拟合线，我们可以看到，随着平均时薪的增加，女性的比例通常会以平均时薪每增加1美元女性减少0.9%的速度下降。我们有一个3.6倍10^-11的p值，因此这种趋势不太可能是由于抽样。这对一些观众来说太难了。</p><p id="6273" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">此外，如此多的职位只有很少的雇员，我们得到的这些水平线分别是0%、50%和100%的女性。这些突出的方式分散了外卖的注意力。我想把这个有点抽象的散点图转化成一个快速可消化的可视化。我决定去垃圾箱。</p><h1 id="691e" class="lo lp it bd lq lr ls lt lu lv lw lx ly ki lz kj ma kl mb km mc ko md kp me mf bi translated">如何装箱</h1><p id="dcc6" class="pw-post-body-paragraph kr ks it kt b ku mg kd kw kx mh kg kz la mi lc ld le mj lg lh li mk lk ll lm im bi translated">有三个主要的宁滨决策:垃圾箱的数量、垃圾箱的类型和标签。我将逐一介绍这些决策的一些考虑因素:</p><p id="e05e" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">垃圾箱数量:在网上快速搜索可以找到各种各样的经验法则，帮助你决定垃圾箱的数量。(试试这篇维基百科<a class="ae ln" href="https://en.wikipedia.org/wiki/Histogram#Number_of_bins_and_width" rel="noopener ugc nofollow" target="_blank">的文章</a>。)</p><p id="cd4f" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">箱柜类型:</strong></p><ol class=""><li id="b01a" class="ml mm it kt b ku kv kx ky la mn le mo li mp lm mq mr ms mt bi translated">您的数据有自然的、有意义的间断吗？例如，您可能想要调查在设定的航空里程范围内不同常旅客类别的行为差异。也许你想用联邦退休年龄和典型的高中毕业来将人们分为“青年”、“工作年龄”、“符合退休条件”。</li><li id="63ba" class="ml mm it kt b ku mu kx mv la mw le mx li my lm mq mr ms mt bi translated">您是否希望根据记录的相对定位来拆分记录？例如，你可能想比较收入最高的1%的人和收入最低的10%或50%的人，而不是考虑特定的收入水平。</li></ol><p id="805a" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">标签:还是由你决定——你想给你的小组起什么名字？您也可以给它们加上范围标签或整数标签。</p><p id="4311" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">一旦你决定了这三件事(或者把这些决定记在心里)，你就可以使用cut(如果你想根据你的自变量进行分割的话)或者qcut(qcut)进行样本百分比分割。</p><h2 id="576b" class="np lp it bd lq nq nr dn lu ns nt dp ly la nu nv ma le nw nx mc li ny nz me iz bi translated">对连续变量进行拆分，然后用cut对记录进行分类</h2><p id="a0d6" class="pw-post-body-paragraph kr ks it kt b ku mg kd kw kx mh kg kz la mi lc ld le mj lg lh li mk lk ll lm im bi translated">要根据小时工资率将职称分成五组，并使用相等的x轴大小的框:</p><pre class="na nb nc nd gt oa ob oc od aw oe bi"><span id="fad5" class="np lp it ob b gy of og l oh oi">df['pay_grp_cut_n'] = pd.cut(df['total_avg_hrly_rate'], 5)</span></pre><p id="2dcc" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">这将向df添加一个列“pay_grp_cut_n ”,其中每个值都是一个记录所在的bin范围。</p><p id="a6d9" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在y轴上显示职称数量会创建一个直方图:</p><figure class="na nb nc nd gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi mz"><img src="../Images/68793a1233680b87def811f1a8b69d63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o6S2ybh2D9Mlk9OZsM2qpQ.png"/></div></div></figure><p id="03d2" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我们可以看到时薪组分为五个16美元/小时的区间，从最低平均时薪(5美元)到最高平均时薪(86美元)。这种划分导致绝大多数的职位都属于中心和中心以下的群体。</p><p id="766c" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我可以画出这些群体中女性的平均百分比，来说明不同时薪群体中女性百分比的变化:</p><figure class="na nb nc nd gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi mz"><img src="../Images/a6766b4e51cb64cfe6c443e4ef452b28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kQlgwamBadSfYzQsC72RpA.png"/></div></div></figure><pre class="na nb nc nd gt oa ob oc od aw oe bi"><span id="f7d0" class="np lp it ob b gy of og l oh oi"># get sums within group - esp for employee counts<br/>grouped = df.groupby(df['pay_grp_cut_n'], as_index=False).sum()</span><span id="6831" class="np lp it ob b gy oj og l oh oi"># set x and y<br/>x = grouped['pay_grp_cut_n'].astype(str)<br/>y = grouped['no_female_empl'] / grouped['total_no_empl'] *100</span><span id="027c" class="np lp it ob b gy oj og l oh oi"># create visual<br/>fig, ax = plt.subplots(figsize=(12,8))<br/>plt.xlabel('Average Hourly Rate')<br/>plt.ylabel('Percent Female')<br/>plt.title('Percent Female vs. Average Hourly Rate for Seattle City Jobs')<br/>plt.ylim(0,100)<br/>plt.bar(x, y, alpha=.5)</span></pre><p id="732e" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">这种形象化将观众的注意力集中在女性代表人数的下降上，因为职称工资增加了。我可以使用这些分类来确定每个分组的统计显著性和/或根据上下文添加误差线。</p><p id="a823" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">根据您的需求优化cut的一些其他选项(一如既往，在<a class="ae ln" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.cut.html" rel="noopener ugc nofollow" target="_blank">文档</a>中了解更多):</p><figure class="na nb nc nd gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi mz"><img src="../Images/9d86e1e46a78266eaea3258ee7b8858a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QsxbkYk_pz2yMZ5Z_cy1dQ.png"/></div></div></figure><ul class=""><li id="7d03" class="ml mm it kt b ku kv kx ky la mn le mo li mp lm ok mr ms mt bi translated">调整标签</li></ul><pre class="na nb nc nd gt oa ob oc od aw oe bi"><span id="12d9" class="np lp it ob b gy of og l oh oi">df[‘pay_grp_cut_l’] = pd.cut(df[‘total_avg_hrly_rate’]<br/>                             ,5<br/>                             ,labels=[‘Very Low’, ‘Low’, ‘Medium’<br/>                                       ,‘High’, ‘Very High’])</span></pre><ul class=""><li id="1aa3" class="ml mm it kt b ku kv kx ky la mn le mo li mp lm ok mr ms mt bi translated">设置容器边界。你可以这样做，为航空公司奖励水平，或获得整数斌休息。</li></ul><pre class="na nb nc nd gt oa ob oc od aw oe bi"><span id="9ada" class="np lp it ob b gy of og l oh oi">df['pay_grp_cut_set_boundaries'] = pd.cut(df['total_avg_hrly_rate']<br/>                                          ,[5,20,35,50,65,80])</span></pre><h2 id="1b0c" class="np lp it bd lq nq nr dn lu ns nt dp ly la nu nv ma le nw nx mc li ny nz me iz bi translated">使用qcut将记录分组到基于卷的组中</h2><p id="45c4" class="pw-post-body-paragraph kr ks it kt b ku mg kd kw kx mh kg kz la mi lc ld le mj lg lh li mk lk ll lm im bi translated"><code class="fe ol om on ob b">QCut</code>或“分位数切割”不是基于标量值进行分割，而是基于落入每个桶中的样本数进行分割。</p><p id="5337" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">如果你想要五个大小相等的组，按小时工资排序，你可以使用类似于<code class="fe ol om on ob b">cut</code>的<code class="fe ol om on ob b">qcut </code>。</p><pre class="na nb nc nd gt oa ob oc od aw oe bi"><span id="108e" class="np lp it ob b gy of og l oh oi">df['pay_grp_qcut_n'] = pd.qcut(df['total_avg_hrly_rate'], 5)</span></pre><figure class="na nb nc nd gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi mz"><img src="../Images/37e87b5b9475f6e8cb26dc30c6a9b7af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zt8RL_JzuMe8iVU6H821iA.png"/></div></div></figure><p id="04dc" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">使用<code class="fe ol om on ob b">qcut</code>偶数大小的分组，您会看到现在我们的bin大小从大约5变化到大约43。每个框代表大致相同数量的职位。</p><p id="0a73" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">比较<code class="fe ol om on ob b">cut </code>和<code class="fe ol om on ob b">qcut </code>在每个时段中的职位数量可以看出这一差异:</p><figure class="na nb nc nd gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi mz"><img src="../Images/d6583f2b107c7a17dce6c4256854896a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tgMjUVezqdYwq3HZoDj3CA.png"/></div></div></figure><p id="89e9" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">使用<code class="fe ol om on ob b">qcut</code>，您可以像设置<code class="fe ol om on ob b">cut</code>一样设置标签。<code class="fe ol om on ob b">df[‘pay_grp_qcut_l’] = pd.qcut(df[‘total_avg_hrly_rate’], 5, labels=[‘Very Low’, ‘Low’, ‘Medium’, ‘High’, ‘Very High’])</code></p><p id="acfa" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">您可以设置每个桶中的体积百分比来创建不同大小的分组，而不是显式设置边界。例如，如果你在一条曲线上打分，那么你可能想把学生分成(对我来说，任意的):10% F，20% D，20% C，40% B，10% A。你可以使用qcut给学生打分:</p><pre class="na nb nc nd gt oa ob oc od aw oe bi"><span id="ae94" class="np lp it ob b gy of og l oh oi">df['letter_grade'] = pd.qcut(df, <br/>                             [.1, .2, .2, .4, .1], <br/>                             labels=['F', 'D', 'C', 'B', 'A']) </span></pre><h2 id="f880" class="np lp it bd lq nq nr dn lu ns nt dp ly la nu nv ma le nw nx mc li ny nz me iz bi translated">何时使用Cut与QCut</h2><p id="e135" class="pw-post-body-paragraph kr ks it kt b ku mg kd kw kx mh kg kz la mi lc ld le mj lg lh li mk lk ll lm im bi translated">这个选择真的取决于你的用例。你有没有很强的商业逻辑或者现有的分类是你想要匹配的或者是你的受众习惯思考的？这将是一个主要的原因削减！其他时候，考虑类似规模的分组或客户的百分比可能更有意义。</p><p id="ba98" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">无论您决定在您的环境中哪一个有意义，您都可能想要考虑未选择的路径的影响。使用cut时，小组规模可能会有很大不同——强调这种变化的幅度(为您自己和/或您的观众)。使用qcut，铲斗大小可能会有很大的变化——忘记这一点，后果自负。</p><h2 id="b652" class="np lp it bd lq nq nr dn lu ns nt dp ly la nu nv ma le nw nx mc li ny nz me iz bi translated">确定容器边界的另一种方法</h2><p id="4069" class="pw-post-body-paragraph kr ks it kt b ku mg kd kw kx mh kg kz la mi lc ld le mj lg lh li mk lk ll lm im bi translated">Fisher-Jenks算法在一维数据中找到自然边界，像k-means，但是1D。查看<code class="fe ol om on ob b">jenkspy</code>获得一个不错的实现。您仍然需要仔细考虑要寻找的条柱/间隔的数量，但是可能会得到更多的逻辑分组，尤其是当您的数据集具有不同的间隔时。例如，在一个4岁孩子的生日聚会上，身高可以自然地分为“成年人”、“4岁儿童”、“6岁儿童”、“2岁儿童”，尽管偶数或qcuts的划分可能与这些分组相去甚远。</p></div><div class="ab cl oo op hx oq" role="separator"><span class="or bw bk os ot ou"/><span class="or bw bk os ot ou"/><span class="or bw bk os ot"/></div><div class="im in io ip iq"><p id="be33" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">编码快乐！你可以在这里找到回购<a class="ae ln" href="https://github.com/allisoncstafford/cut_qcut_blog" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="na nb nc nd gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ov"><img src="../Images/edb720e1d064496fc46716df7e6323ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tHVh41rSmiIsYc8Y"/></div></div><p class="nl nm gj gh gi nn no bd b be z dk translated">照片由<a class="ae ln" href="https://unsplash.com/@lucistan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Luca Upper </a>在<a class="ae ln" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div></div>    
</body>
</html>