<html>
<head>
<title>Data pipelines: What, why and which ones</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据管道:什么，为什么，哪些</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-pipelines-what-why-and-which-ones-1f674ba49946?source=collection_archive---------9-----------------------#2021-09-08">https://towardsdatascience.com/data-pipelines-what-why-and-which-ones-1f674ba49946?source=collection_archive---------9-----------------------#2021-09-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="de73" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">不同管道框架如何相互关联的示例和解释</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/bd3e5b3ed905eeac67f9186c251fa19e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LZqkjm1Mhdvos-LO"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">克林特·王茂林在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="c1d0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您在数据科学领域工作，您可能会在各种文章和教程中不断看到术语“数据管道”。您可能还注意到，术语“管道”可以指代许多不同的事物！有跨越IT堆栈不同部分的管道，特定工具的管道，以及特定代码库中的管道。例如，我工作的公司UbiOps也提供自己的管道形式。</p><p id="39a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">跟踪所有这些不同的管道是什么，以及它们彼此之间有什么不同，可能会非常令人困惑。在本文中，我们将列出并比较一些常见的管道，并阐明UbiOps管道在总体情况中的位置。</p><h1 id="6fbe" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">什么是数据管道？</h1><p id="6539" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们从头开始，什么是数据管道？总的来说，数据流水线就是简单的<strong class="ky ir">对数据执行的自动化操作链</strong>。它可以将数据从A点带到B点，它可以是从多个来源聚合数据并将其发送到某个数据仓库的流程，或者它可以对检索到的数据执行某种类型的分析。基本上，数据管道有多种形状和大小。但是它们都有三个共同点:它们是自动化的，它们引入了可重复性，并且有助于将复杂的任务分解成更小的、可重用的组件。</p><p id="c7f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可能熟悉<strong class="ky ir"> ETL </strong>，或者它的现代对应物<strong class="ky ir"> ELT </strong>，它们是常见的数据管道类型。ETL代表<em class="mp">提取、转换、加载</em>，它就是这样做的。ELT管道提取、加载，然后才进行转换。它们是许多处理数据的公司使用的通用管道模式。尤其是当他们处理需要存储在数据仓库中的来自不同来源的数据时。ETL或ELT管道是数据管道的子集。换句话说，每个ETL/ELT管道都是数据管道，但不是每个数据管道都是ETL或ELT管道。</p><p id="a825" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在数据管道的另一端，我们有更侧重于分析的管道。这些通常出现在数据科学项目中。它们是处理传入数据的管道，这些数据通常已经以某种方式进行了清理，以提取洞察力。它不仅仅是加载和转换数据，而是对数据进行分析。</p><p id="05e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据管道不局限于这种或那种类型，它更像一个光谱。一些管道完全专注于ETL端，另一些专注于分析端，还有一些两者兼而有之。建立数据管道有许多不同的方法，但最终最重要的是它要符合你的项目需求。</p><h1 id="aeb0" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">为什么需要数据管道？</h1><p id="d270" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">好了，我们已经讨论了什么是数据管道，但是也许你仍然想知道它们的额外好处是什么。毕竟建立管道需要时间。出于几个原因，我可以保证这段时间花得很值。</p><p id="4714" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，自动化管道最终会节省您的时间，因为您不必手动地一遍又一遍地做同样的事情。它允许您在可重复的任务上节省时间，因此您可以将更多的时间分配给项目的其他部分。</p><p id="2d20" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不过，使用自动化管道最重要的原因可能是，您需要思考、计划并在某个地方写下您计划放入管道的整个流程。换句话说:它迫使你预先做一个设计，并考虑必需品。反思过程并记录下来对于防止错误和允许多人使用管道非常有用。</p><p id="0ca2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，管道允许您将一个大的任务分成更小的步骤。这提高了效率、可扩展性和可重用性。这有助于针对他们必须做的事情优化不同的步骤。例如，有时不同的框架或语言更适合管道的不同步骤。如果它是一个大的脚本，你将不得不坚持一个，但是使用大多数管道工具，你可以为管道的每个单独部分选择最好的框架或语言。</p><p id="43f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，管道引入了再现性，这意味着几乎任何人、几乎任何地方都可以再现结果(当然，如果他们可以访问数据的话)。这不仅引入了安全性和可追溯性，还使调试变得更加容易。每次运行管道的过程都是相同的，所以每当出现错误时，您可以轻松地追溯步骤，并找出错误出在哪里。</p><h1 id="9db7" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">UbiOps管道在这幅图中是怎样的？</h1><p id="6dd9" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果你熟悉<a class="ae kv" href="https://ubiops.com/product/" rel="noopener ugc nofollow" target="_blank"> UbiOps </a>，你会知道ubi ops<a class="ae kv" href="https://ubiops.com/docs/pipelines/" rel="noopener ugc nofollow" target="_blank">也有流水线功能</a>。UbiOps管道是模块化工作流，由称为<strong class="ky ir">部署</strong>的对象组成。每个部署都为UbiOps中的一段Python或R代码提供服务。每个部署都有自己的API端点，并根据使用情况进行动态扩展。通过管道，您可以将部署连接在一起，以创建更大的工作流。这种设置有助于模块化，允许您将应用程序分成小的独立部分，以便随着时间的推移构建更强大的软件。UbiOps将负责这些部署之间的数据路由，整个管道将通过自己的API端点公开，供您使用。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/2279c79bc41561bb05f508913c6bd5ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*h35FUEiBz1WsyHa2"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">UbiOps中的管道截图，图片由作者提供</p></figure><p id="6021" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们回顾我之前讨论的管道频谱时，UbiOps更多地是在分析方面。最终，无论您在代码中指定什么，您都可以使用UbiOps管道，但它更多地意味着数据处理和分析，而不是在其他技术之间路由数据。</p><h1 id="3b25" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">不同管道框架的比较</h1><p id="4377" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">正如我前面提到的，有很多不同的管道框架，都有各自的优点和用例。在数据科学领域不断出现的几个例子是:Luigi、Airflow、scikit-learn管道和Pandas管道。让我们看看它们的异同，并检查它们与UbiOps管道的关系。</p><p id="f74c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Luigi是Spotify为其数据科学团队打造的，用于构建数千个任务的长期运行管道，这些任务跨越数天或数周。它旨在帮助将任务整合到流畅的工作流程中。这是一个基于Apache 的开源许可的<a class="ae kv" href="https://github.com/spotify/luigi" rel="noopener ugc nofollow" target="_blank"> Python包。</a></p><p id="29ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Luigi的目的是解决通常与长时间运行的批处理相关的所有问题，其中许多任务需要链接在一起。这些任务可以是任何事情，但通常是长时间运行的事情，如Hadoop作业、向/从数据库转储数据或运行机器学习算法。</p><p id="a5e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Luigi有3个步骤来构建管道:</p><ul class=""><li id="ac5e" class="mr ms iq ky b kz la lc ld lf mt lj mu ln mv lr mw mx my mz bi translated"><code class="fe na nb nc nd b">requires()</code>定义任务之间的依赖关系</li><li id="6f92" class="mr ms iq ky b kz ne lc nf lf ng lj nh ln ni lr mw mx my mz bi translated"><code class="fe na nb nc nd b">output()</code>定义了任务的目标</li><li id="9221" class="mr ms iq ky b kz ne lc nf lf ng lj nh ln ni lr mw mx my mz bi translated"><code class="fe na nb nc nd b">run()</code>定义每个任务执行的计算</li></ul><p id="1a76" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Luigi中，任务与提供给它们的数据错综复杂地联系在一起，这使得创建和测试一个新任务变得困难，而不仅仅是将它们串在一起。由于这种设置，也很难更改任务，因为您还必须单独更改每个相关任务。</p><p id="2551" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">air flow<br/></strong><a class="ae kv" href="https://airflow.apache.org/" rel="noopener ugc nofollow" target="_blank">air flow</a>最初是由AirBnB创建的，旨在帮助他们的数据工程师、数据科学家和分析师掌握建设、监控和改造数据管道的任务。气流是一个非常通用的系统，能够处理各种工具的气流。Airflow将工作流定义为有向无环图(Dag)，任务是动态实例化的。</p><p id="96fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">气流围绕着:</p><ul class=""><li id="ad43" class="mr ms iq ky b kz la lc ld lf mt lj mu ln mv lr mw mx my mz bi translated"><strong class="ky ir">钩子</strong>，是连接外部平台的高级接口(如<a class="ae kv" href="https://airflow.apache.org/docs/apache-airflow/1.10.6/_api/airflow/hooks/postgres_hook/index.html" rel="noopener ugc nofollow" target="_blank"> Postgres钩子</a>)</li><li id="8e69" class="mr ms iq ky b kz ne lc nf lf ng lj nh ln ni lr mw mx my mz bi translated"><strong class="ky ir">操作符</strong>，它们是成为DAG节点的预定义任务</li><li id="196f" class="mr ms iq ky b kz ne lc nf lf ng lj nh ln ni lr mw mx my mz bi translated"><strong class="ky ir">执行者</strong>(通常是<a class="ae kv" href="https://docs.celeryproject.org/en/stable/" rel="noopener ugc nofollow" target="_blank">芹菜</a>)远程运行作业，处理消息队列，并决定哪个工人将执行每个任务</li><li id="7d03" class="mr ms iq ky b kz ne lc nf lf ng lj nh ln ni lr mw mx my mz bi translated"><strong class="ky ir">调度器</strong>，负责触发预定的工作流，以及将任务提交给执行器运行。</li></ul><p id="f91d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有了气流，就有可能创建高度复杂的管道，这是很好的编排和监测。对于Airflow来说，最重要的因素是它与其他系统(如数据库、Spark或Kubernetes)良好连接的能力。</p><p id="7bcc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，气流的一个大缺点是它陡峭的学习曲线。要很好地利用气流，你需要DevOps知识。一切都是高度可定制和可扩展的，但是以简单性为代价。</p><p id="f8ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> scikit-learn管道<br/> </strong> <a class="ae kv" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html" rel="noopener ugc nofollow" target="_blank"> scikit-learn管道</a>与Airflow和Luigi有很大不同。它们不是编排不同服务的大型任务的管道，而是一个可以让您的数据科学代码更加清晰、更具可重复性的管道。scikit-learn管道是scikit-learn Python包的一部分，该包在数据科学领域非常流行。</p><p id="6913" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">scikit-learn管道允许您连接一系列转换器，后跟一个最终估计器。通过这种方式，您可以将模型训练或数据处理等特定步骤连接在一起。借助scikit-learn pipelines，您的工作流程变得更加易于阅读和理解。正因为如此，发现数据泄露这样的事情也变得容易多了。</p><p id="0092" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是请记住，scikit-learn管道只能与scikit-learn库中的转换器和估算器一起工作，并且它们需要在相同的运行时中运行。因此，这些管道与您在Airflow或Luigi中创建的编排管道非常不同。例如，使用Airflow或Luigi，您可以在不同的工作节点上运行管道的不同部分，同时保持一个控制点。</p><p id="fd32" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">熊猫管道<br/>  <a class="ae kv" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.pipe.html" rel="noopener ugc nofollow" target="_blank">熊猫管道</a>是特定Python包管道的另一个例子，在本例中是熊猫。Pandas是一个流行的数据分析和操作库。你的数据分析变得越大，你的代码也会变得越乱。Pandas管道提供了一种清理代码的方法，允许您在一个函数中连接多个任务，类似于scikit-learn管道。</p><p id="dd4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Pandas pipes有一个标准:所有的步骤都应该是一个函数，一个数据框作为参数，一个数据框作为输出。只要遵循这个标准，您可以根据需要添加任意多的步骤。您的函数可以在数据帧后面带额外的参数，这些参数也可以传递给管道。</p><p id="d40f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">按照数据帧进，数据帧出的原则，Pandas管道非常多样化。就用例而言，它们与scikit-learn管道相当，因此也与Airflow和Luigi有很大不同。它们也可能是管道，但类型完全不同。</p><p id="1977" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">对比<br/> </strong>很明显，所有这些不同的管道都适合不同类型的用例，甚至可以很好地结合使用。例如，完全有可能在UbiOps管道的部署中使用Pandas管道，以这种方式结合它们的优势。让我们把前面提到的管道并排放在一起，勾勒出更大的图景。</p><p id="91f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在管道频谱中，Luigi和Airflow位于更高级别的软件编排端，而Pandas管道和scikit-learn管道位于特定分析的代码级别，UbiOps位于两者之间。Luigi和Airflow是创建跨堆栈中多个服务的工作流或在不同节点上调度任务的绝佳工具。Pandas管道和scikit-learn管道对于更好的代码可读性和更具重现性的分析来说是非常棒的。UbiOps非常适合在Python或r中创建分析工作流。</p><p id="a928" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">UbiOps、Airflow和Luigi之间有一些重叠，但它们都面向不同的用例。UbiOps面向数据科学团队，他们需要以最少的开发运维麻烦将其分析流程投入生产。Luigi面向长时间运行的批处理过程，其中许多任务需要链接在一起，这些任务可能持续几天或几周。最后，气流是三者中最通用的，允许您监控和协调复杂的工作流，但以简单性为代价。随着其多功能性和功能的增加，也带来了很多复杂性和陡峭的学习曲线。</p><p id="0534" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">scikit-learn和Pandas管道实际上无法与UbiOps、Airflow或Luigi相提并论，因为它们是专门为这些库设计的。scikit-learn和Pandas管道实际上可以与UbiOps、Airflow或Luigi结合使用，只需将它们包含在这些管道中各个步骤的代码运行中即可！</p><h1 id="ba61" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="0a8f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">数据管道是将自动化、可再现性和结构化引入项目的一个很好的方式。有许多不同类型的管道，每一种都有自己的优点和缺点。希望这篇文章有助于理解所有这些不同的管道是如何相互关联的。</p></div></div>    
</body>
</html>