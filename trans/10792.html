<html>
<head>
<title>100% stacked charts in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的100%堆积图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/100-stacked-charts-in-python-6ca3e1962d2b?source=collection_archive---------1-----------------------#2021-10-19">https://towardsdatascience.com/100-stacked-charts-in-python-6ca3e1962d2b?source=collection_archive---------1-----------------------#2021-10-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a3ca" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Matplotlib绘制百分比堆积条形图和柱形图</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b1b5c32a412b7caca399c91ce8167df2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-MSLBij5vknV5Tm-G0Rxfw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="3705" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本文中，我们将讨论如何使用Matplotlib在Python中绘制100%堆积条形图和柱形图。我们将使用从<strong class="kx ir"> Tableau公共样本数据集(</strong><a class="ae lr" href="https://public.tableau.com/en-us/s/resources" rel="noopener ugc nofollow" target="_blank"/>并转到样本数据<strong class="kx ir">)下载的<strong class="kx ir">网飞电影和电视节目</strong>数据集。</strong>该数据集由截至2019年网飞可用的电视节目和电影组成，由Tableau从<a class="ae lr" href="https://www.kaggle.com/shivamb/netflix-shows" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir"> Kaggle </strong> </a>获取，数据集的更新版本可在Kaggle上找到。然而，对于本文，我们将使用在<strong class="kx ir"> Tableau样本数据集</strong>中可用的旧版本。下面是数据集的快照(为了更好地显示，进行了调换)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/08eec7b375d4d8c3c36fb73f122087e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sxXfHCQbTleV2KGJmEnIyg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">转置数据集的快照(图片由作者提供)</p></figure><p id="6baa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本文中，我们将绘制堆积条形图和柱形图，显示2016年至2019年各<strong class="kx ir"> <em class="lt"> release_year </em> </strong>上映的<strong class="kx ir"><em class="lt"/></strong>类型剧集的比例。<strong class="kx ir"> <em class="lt"> </em> </strong>在下面的代码中，我们将选择2016年到2019年之间带有<strong class="kx ir"> <em class="lt"> release_year </em> </strong>的记录/行，并对数据进行预处理。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lu lv l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/dcacf3f25948ab1c1f562b2e58be1f70.png" data-original-src="https://miro.medium.com/v2/resize:fit:460/format:webp/1*lfmmqc8iquZC97QKh0EuVg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="77bd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将创建一个交叉表格，显示每年<strong class="kx ir"> <em class="lt">类型</em> </strong>节目的比例。我们将在索引中包含<strong class="kx ir"> <em class="lt">发布_年份</em> </strong>和在列中显示<strong class="kx ir"> <em class="lt">类型</em> </strong>。使用<strong class="kx ir"> normalize=True </strong>参数给出了数据的索引比例。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lu lv l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/3614b7034a3c96e1933fc720a552450f.png" data-original-src="https://miro.medium.com/v2/resize:fit:522/format:webp/1*JXRGU-posuMgQJrL67U5Ig.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">节目类型的年度比例(作者图片)</p></figure><p id="d556" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将创建一个与上面类似的交叉列表，但这次我们将保留计数，而不将它们转换成比例。这个交叉制表用于显示图上的数据标签，我们将在本文后面看到。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lu lv l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/1140e326e4011d5a944bd4fa016be0d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:482/format:webp/1*8MMY1ChFUuGBlS0PN0z3uQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">节目类型的年度统计(按作者分类的图片)</p></figure><h1 id="cf77" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">百分比堆积柱形图</h1><p id="d3d5" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">现在，我们将创建一个堆积柱形图，显示每年节目类型的比例。我们将使用具有比例的交叉列表(我们之前创建的)来绘制图表。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lu lv l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/c17801b646c4621a31d48b03accdad5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q9x3gRc8HaLCJpyzvlWMUw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="e710" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们将比例数据标签添加到我们的绘图中。我们将创建一个嵌套循环，其中第一个循环遍历具有比例的交叉列表的索引。第二个循环遍历每个索引的值。在深入研究之前，我们将查看代码及其输出。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lu lv l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/a7c9e04cf4e517a9fdd4fe9e37014af0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dw4CEfelU5Zk3nEcipaReA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="0233" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在上面的代码中，第一个循环枚举并遍历具有比例的交叉列表的索引。我们将使用枚举的值(0，1，2，3)作为数据标签的x位置。让我们看看第一个循环返回了什么。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lu lv l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi my"><img src="../Images/bb6f58c82788f1c9885a3dd3469deacf.png" data-original-src="https://miro.medium.com/v2/resize:fit:280/format:webp/1*AlMGbe1JOsdJ7MTAmFV1xw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="ea0a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在第二个循环中，我们将遍历交叉列表中每个有比例的索引值。让我们看看第二个循环返回了什么。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lu lv l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/444d719460bc226c0f0b3b57a6f26d68.png" data-original-src="https://miro.medium.com/v2/resize:fit:870/format:webp/1*1AiglnE72bmyF7loCsW5xQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="3642" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以看到内循环逐个迭代每个指标的比例。变量<strong class="kx ir"> <em class="lt">比例</em> </strong>是我们之前创建的交叉制表中的比例。我们还将它用作数据标签的y轴位置(这在绘制计数时很好，但在绘制比例时不正确)。</p><p id="3a80" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在上图中，我们看到数据标签没有对齐，没有显示在正确的位置。我们可以通过从x位置减去一个值(在本例中为0.17)来修正标签的x位置，这样标签就会向左移动。我们将在内循环中添加一个<strong class="kx ir"> <em class="lt"> y_loc </em> </strong>变量，它只不过是一个指数中比例的累积和。这充当数据标签的正确y位置，并将标签放置在其各自条的最顶端。我们将在下面看到代码和输出。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lu lv l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/c5e72a2d9ab2486d5ed4143ac7966e76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PwiALKDRwO0XipzEkQCrfg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="6967" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以通过在plt.text()函数中修改数据标签的y位置来对齐数据标签，使它们出现在每个条形的中心，如下面的代码所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lu lv l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/99cd07c2e3b5408d4ba695f6e5f0281c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w8zkHm98pXssYlEXfNv0_Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="947b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们还可以通过将每个条形的计数包含在内循环中并修改plt.text()函数中的字符串参数(<strong class="kx ir"> <em class="lt"> s </em> </strong>)来添加它们，如下所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lu lv l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/14c6a2723e859f0041487e998aa59950.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v-iNGqFm6uAoNwFu8kmiEw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="f04d" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">百分比堆积条形图</h1><p id="3023" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">通过稍微修改我们之前创建的代码，我们可以创建一个100%堆积条形图。我们必须将剧情类型从<strong class="kx ir"> <em class="lt">【条形】</em> </strong>改为<strong class="kx ir"> <em class="lt">【条形】</em> </strong>。然后交换x和y标签，在plt.text()函数中交换数据标签的x和y位置。其他一切保持不变。我们来看看下面的代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lu lv l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/1fb1299be13f9fc56c4d35ec0561d801.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UYF1oHEj4OkYcy5aP3fC-A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="ea20" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">文章到此结束。我们已经讨论了如何创建100%堆积条形图和柱形图，添加数据标签，正确对齐和格式化这些数据标签。由于数据以比例/相对频率的形式表示，而不仅仅是计数/频率(这有时可能会产生误导)，100%堆积图提供了更可靠的数据视图，尤其是在进行组间比较时。</p></div></div>    
</body>
</html>