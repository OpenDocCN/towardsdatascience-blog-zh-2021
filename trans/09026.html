<html>
<head>
<title>Build a Smarter Chatbot with Semantic Search</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用语义搜索构建更智能的聊天机器人</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-a-smarter-chatbot-with-semantic-search-323c9a77a31d?source=collection_archive---------19-----------------------#2021-08-20">https://towardsdatascience.com/build-a-smarter-chatbot-with-semantic-search-323c9a77a31d?source=collection_archive---------19-----------------------#2021-08-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/9a5c24e94afdf883441b1aea32566c6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zs7RNO4X5iiQh1_Ygpl30g.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">来源:<a class="ae jd" href="https://www.vectorstock.com/" rel="noopener ugc nofollow" target="_blank"> VectorStock </a></p></figure><div class=""/><div class=""><h2 id="afb1" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated"><em class="kv">使用语义搜索引擎，你可以不费吹灰之力扩大聊天机器人的覆盖范围。</em></h2></div><p id="f252" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不太久以前，聊天机器人和助手并不好用。像亚马逊Alexa这样的公司是由拥有大量R&amp;D预算和专业ML和NLP团队的公司开发的。</p><p id="56fd" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但由于2017年推出变压器后NLP系统性能的飞跃，加上许多这些模型的开源性质，前景正在迅速改变。像Rasa这样的公司使得组织可以轻松地构建复杂的代理，这些代理不仅比早期的代理工作得更好，而且只需要很少的时间和金钱来开发，并且不需要专家来设计。</p><p id="bd05" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，尽管最近取得了一些进步，但仍有很大的改进空间。在本文中，我们将展示如何通过将客户助手聊天机器人附加到语义搜索后端来扩展它，以处理更广泛的查询。</p><h2 id="ddee" class="ls lt jg bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">亚特兰蒂斯迪拜的基本聊天机器人</h2><p id="6748" class="pw-post-body-paragraph kw kx jg ky b kz ml kh lb lc mm kk le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">当迪拜的亚特兰蒂斯酒店于2008年开业时，它的水下套房迅速获得了全世界的关注。今天，他们的网站为潜在访问者列出了一百多个常见问题。出于我们的目的，我们将使用Rasa构建一个聊天机器人来处理关于这些主题的查询。</p><p id="2623" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可能想知道Rasa聊天机器人提供了什么优势，而不是简单地访问网站的FAQ页面。第一个主要优点是，它对查询给出了直接的回答，而不是要求客户浏览一大串问题。</p><figure class="mr ms mt mu gt is gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/fc3e364818dcc3ce8dfd1e8c548b19ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/format:webp/1*ycg00tcsgUPNga8M7U00FQ.jpeg"/></div></figure><p id="a692" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其次，与Ctrl-F搜索相比，Rasa可以更智能地找到内容。凭借NLP模型的支持，它可以优雅地处理拼写错误和释义错误。例如，如果我问“允许我的狗吗”，Rasa给我下面的结果，而Ctrl-F搜索“狗”将不会返回任何结果，因为常见问题是<em class="mv">你允许在迪拜亚特兰蒂斯养宠物吗？</em></p><figure class="mr ms mt mu gt is gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/dead026047e4e5bb23330035851a8e50.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/format:webp/1*g0axKH5hSuOHzcYsIKFZ1g.jpeg"/></div></figure><p id="2d3f" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的机器人的源代码可以在<a class="ae jd" href="https://github.com/amin3141/zir-rasabot" rel="noopener ugc nofollow" target="_blank">github.com/amin3141/zir-rasabot</a>获得，最终版本部署在我们的<a class="ae jd" href="https://zir-ai.com/demo#chatbot" rel="noopener ugc nofollow" target="_blank">演示页面</a>。下面的文件提供了使用Rasa创作语法的核心知识库实现。</p><ul class=""><li id="b02d" class="mw mx jg ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated"><a class="ae jd" href="https://github.com/amin3141/zir-rasabot/blob/main/data/nlu.yml" rel="noopener ugc nofollow" target="_blank"> nlu.yml </a>，包含常见问题及其变体。</li><li id="2a36" class="mw mx jg ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><a class="ae jd" href="https://github.com/amin3141/zir-rasabot/blob/main/domain.yml" rel="noopener ugc nofollow" target="_blank"> domain.yml </a>，包含意图的响应和声明。</li><li id="1734" class="mw mx jg ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><a class="ae jd" href="https://github.com/amin3141/zir-rasabot/blob/main/data/rules.yml" rel="noopener ugc nofollow" target="_blank"> rules.yml </a>，将nlu.yml中定义的意图映射到domain.yml中定义的响应。</li></ul><h2 id="4c87" class="ls lt jg bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">顾客评论:一个未开发的信息源</h2><p id="7219" class="pw-post-body-paragraph kw kx jg ky b kz ml kh lb lc mm kk le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">随着互联网和在线电子商务的兴起，客户评论是在线景观的普遍元素。评论包含各种各样的信息，但因为它们是以自由形式的文本编写的，并且是用客户自己的话来表达的，所以要访问其中的知识并不容易。</p><p id="d931" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">亚特兰蒂斯酒店有数千条评论，其中326条包含在<a class="ae jd" href="https://archive.ics.uci.edu/ml/datasets/opinrank+review+dataset" rel="noopener ugc nofollow" target="_blank"> OpinRank评论数据集</a>中。<a class="ae jd" href="https://blog.zir-ai.com/the-high-cost-of-keyword-search" rel="noopener ugc nofollow" target="_blank">在其他地方</a>我们展示了语义搜索平台，如<a class="ae jd" href="https://vectara.com/" rel="noopener ugc nofollow" target="_blank"> Vectara Neural Search </a>，如何让组织利用存储为非结构化文本的信息——大规模释放这些数据集中的价值。</p><p id="9a5b" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Rasa包含一个称为后备处理器的便利特性，我们将使用它来扩展我们的语义搜索机器人。当机器人没有足够的信心直接处理请求时，它会将请求交给后备处理程序来处理。在这种情况下，我们将针对客户评论语料库运行用户查询，如果结果得分足够高，将显示最多两个匹配项。回退处理程序的源代码可以在<a class="ae jd" href="https://github.com/amin3141/zir-rasabot/blob/main/actions/actions.py" rel="noopener ugc nofollow" target="_blank"> main/actions/actions.py </a>中找到。第<a class="ae jd" href="https://github.com/amin3141/zir-rasabot/blob/main/actions/actions.py#L41-L79" rel="noopener ugc nofollow" target="_blank">41–79</a>行显示了如何准备语义搜索请求、提交请求以及处理结果。</p><p id="eef3" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们如何确定机器人不够自信？为了本文的目的，我们作弊了:我们直接根据评估数据计算了我们的选择指标F1得分，并选择了一个最大化它的阈值。虽然这并不妨碍我们从评估结果中得出结论，但我们必须记住，基线聊天机器人被赋予了不切实际的优势。</p><p id="bb42" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还使用阈值0.3来确定语义搜索回退结果是否足以显示。至关重要的是，这个阈值是从一个不相关的数据集获得的。因此，我们希望我们的指标能够准确反映现实世界的表现。</p><h2 id="fe85" class="ls lt jg bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">比较机器人</h2><p id="5052" class="pw-post-body-paragraph kw kx jg ky b kz ml kh lb lc mm kk le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">复杂系统的性能必须进行概率分析，NLP驱动的聊天机器人也不例外。缺乏严格的评估将会使你很难确信当你扩展你的系统时你正在取得进步。本节的其余部分描述了我们评估聊天机器人的方法。</p><p id="fff4" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们构建了一个包含63个问题的评估集。在预订房间之前，我们询问了五位以前住过酒店的人，他们可能有兴趣了解迪拜亚特兰蒂斯酒店的哪些问题。提示中有几个要点需要注意:首先，它介绍了迪拜酒店的位置，以考虑到地理上相关的问题，如<em class="mv">它离海滩有多远？</em>其次，它还设定了一个目标，这个目标首先符合构建这样一个机器人的现实商业动机，也就是说，帮助潜在客户决定这是否是他们愿意呆的地方。</p><p id="69fd" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了表征机器人的性能，我们从标准的四类答案分类开始，这对于以前使用过ML系统的人来说是熟悉的:</p><ol class=""><li id="733e" class="mw mx jg ky b kz la lc ld lf my lj mz ln na lr nk nc nd ne bi translated">正确答案:聊天机器人正确回答了这个问题。在我们的评估中，单个评估员做出了决定，尽管如果您的预算允许，使用多个评估员更可靠。</li><li id="fcf5" class="mw mx jg ky b kz nf lc ng lf nh lj ni ln nj lr nk nc nd ne bi translated">误报:聊天机器人回答问题不正确。</li><li id="f181" class="mw mx jg ky b kz nf lc ng lf nh lj ni ln nj lr nk nc nd ne bi translated">假阴性:聊天机器人拒绝回答一个合法的问题。当系统回复<em class="mv">很抱歉，我没有这方面的任何信息时，这种情况就会出现。</em></li><li id="0c5f" class="mw mx jg ky b kz nf lc ng lf nh lj ni ln nj lr nk nc nd ne bi translated">真否定:描述聊天机器人避免回答不合理问题的情况，例如，<em class="mv">马里纳拉海沟有多深？然而，真正的否定在我们的数据集中并不存在，因为所有的问题都是切题的。</em></li></ol><p id="3244" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用这些类，我们将计算<em class="mv">精度</em>，这是正确回答的已回答问题的比例，以及<em class="mv">真实肯定率</em>，也称为<em class="mv">召回率</em>，这是可以正确回答的有效问题的百分比。以下公式表达了这一点:</p><figure class="mr ms mt mu gt is gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/d3addb5103a19e22c7051fac51846d8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:546/format:webp/1*wDTO-ej_Or3iMiXZQQzAhQ.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">精确度和真阳性率公式。</p></figure><p id="35a1" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了用一个数字来描述系统的性能，我们将转向F值。下面等式中的系数β表示真实阳性率被认为比精度重要β倍。应选择β，以准确反映与假阳性和假阴性结果相关的相对成本。</p><figure class="mr ms mt mu gt is gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/88c00be17f067a814d34e48c20fe809e.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*DKbK8SbSKp78N_yMkfvK3A.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">F分数的公式</p></figure><h2 id="84e3" class="ls lt jg bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">总结和分析</h2><p id="3079" class="pw-post-body-paragraph kw kx jg ky b kz ml kh lb lc mm kk le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">来自默认聊天机器人和启用了回退的聊天机器人的回答被评估并分类如下:</p><ul class=""><li id="58bb" class="mw mx jg ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated">默认值:(TP=7，FP=7，TN=0，FN=49)</li><li id="973e" class="mw mx jg ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">回退:(TP=29，FP=24，TN=0，FN=10)</li></ul><p id="c5d7" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下图显示了他们在上述指标上的相对表现。</p><figure class="mr ms mt mu gt is"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="8afa" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最大的改进是聊天机器人的真实阳性率。在现实问题的评估集上，聊天机器人的正确回答率从13%上升到了74%。这也使F1得分从20%提高到63%。最重要的是，这种改进是通过语义搜索访问现有评论轻松实现的。</p><p id="262f" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">精度呢？令人惊讶的是，它似乎也有所改善，从50%上升到55%。然而，90%的置信区间清楚地表明，这种差异完全在误差范围内，无法得出任何结论。需要产生更多真阳性和假阳性的更大的问题集。如果没有这个时间间隔，就很难得出这个结论。一个很好的经验法则是，对没有置信区间的统计数据要非常怀疑。</p><p id="fd46" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们已经走到路的尽头了吗？我们能像一位前美国总统曾经做过的那样，宣布“任务完成了吗！”在我们的例子中，就像在他的例子中一样，答案是，<em class="mv">没那么快</em>！在本文的最后一部分，我们将讨论在聊天机器人中添加语义搜索时应该考虑的其他一些事情。</p><h2 id="3a69" class="ls lt jg bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">总结挑战</h2><p id="2b5e" class="pw-post-body-paragraph kw kx jg ky b kz ml kh lb lc mm kk le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">顾客评论可能会提到与官方政策不一致的事实。例如，如果顾客询问结账时间，信息性评论可能会说<em class="mv">的结账时间是上午10点，但我下午1点就离开了，这不是问题</em>。因此，机器人需要弄清楚什么时候它在权威地回答，什么时候它在第二手资料中寻找答案。一种方法是以这样的陈述开始搜索结果，比如<em class="mv">下面是其他客户不得不说的:</em></p><p id="9066" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果顾客问亚特兰蒂斯酒店的房间是否干净呢？管理层会希望机器人成为志愿者吗<em class="mv">地毯发臭，墙上有蟑螂在跑！很难想象，即使评论是准确的。定期检查回退处理程序产生的响应是确保这些情况不会发生的一种方法。另一个是从语料库中过滤出负面评论。</em></p><h2 id="b6cb" class="ls lt jg bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">注释者之间的协议</h2><p id="9334" class="pw-post-body-paragraph kw kx jg ky b kz ml kh lb lc mm kk le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">当我们评估我们的聊天机器人时，我们将每一个回答分为真或假、肯定或否定。这个任务被称为注释，在我们的例子中，它是由团队中的一个软件工程师执行的。几乎可以肯定的是，如果你让另一个人来注释这些回答，结果将是相似的，但不完全相同。</p><p id="79db" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">出于这个原因，包含多个注释者并跟踪它们之间的一致程度是一个好的实践。注释者的分歧也应该反映在我们度量的置信区间中，但是这是另一篇文章的主题。</p><h1 id="93fa" class="np lt jg bd lu nq nr ns lx nt nu nv ma km nw kn md kp nx kq mg ks ny kt mj nz bi translated">资源和引用</h1><ul class=""><li id="4b85" class="mw mx jg ky b kz ml lc mm lf oa lj ob ln oc lr nb nc nd ne bi translated">启用了回退功能的<a class="ae jd" href="https://zir-ai.com/demo#chatbot" rel="noopener ugc nofollow" target="_blank"> Hotel Atlantis聊天机器人</a>。</li><li id="2ef9" class="mw mx jg ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><a class="ae jd" href="https://docs.google.com/spreadsheets/d/1QyETsefGYKF52i2ZX4-Q8skd6FedGXZfUEgRfj9pj6c/edit?usp=sharing" rel="noopener ugc nofollow" target="_blank">所有63个问题的评估结果</a></li><li id="0cb9" class="mw mx jg ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><a class="ae jd" href="https://blog.zir-ai.com/the-high-cost-of-keyword-search" rel="noopener ugc nofollow" target="_blank">关键词搜索的高成本</a>包括一个教程，展示如何将客户评论上传到Vectara Neural Search。</li><li id="11f4" class="mw mx jg ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><a class="ae jd" href="https://rasa.com/" rel="noopener ugc nofollow" target="_blank"> Rasa </a>利用最新的语言理解技术构建对话系统。</li><li id="1cf9" class="mw mx jg ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">甘乃山，K. A .和翟春祥，“基于观点的实体排名”，信息检索，2011年。</li></ul><p id="2f56" class="pw-post-body-paragraph kw kx jg ky b kz la kh lb lc ld kk le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mv">阿明·艾哈迈德是Vectara的联合创始人。聊天机器人是由Basit Anwer开发的。</em></p></div></div>    
</body>
</html>