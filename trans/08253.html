<html>
<head>
<title>How to Run Animations in Altair and Streamlit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Altair和Streamlit中运行动画</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-run-animations-in-altair-and-streamlit-2a0624789ad?source=collection_archive---------17-----------------------#2021-07-29">https://towardsdatascience.com/how-to-run-animations-in-altair-and-streamlit-2a0624789ad?source=collection_archive---------17-----------------------#2021-07-29</a></blockquote><div><div class="fc ik il im in io"/><div class="ip iq ir is it"><h2 id="e0fa" class="iu iv iw bd b dl ix iy iz ja jb jc dk jd translated" aria-label="kicker paragraph">数据可视化</h2><div class=""/><div class=""><h2 id="c93d" class="pw-subtitle-paragraph kc jf iw bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">一个现成的教程，描述了如何使用Altair和Streamlit构建动画折线图。</h2></div><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj ku"><img src="../Images/93a2a53d35eabc4210918cca36adc806.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k3q0qR89H1vFxmxBc8sEMg.jpeg"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="dae1" class="pw-post-body-paragraph lk ll iw lm b ln lo kg lp lq lr kj ls lt lu lv lw lx ly lz ma mb mc md me mf ip bi translated">Altair是一个非常流行的用于数据可视化的Python库。通过Altair，您可以用几行代码构建非常复杂的图表，因为该库遵循<a class="ae mg" href="https://vega.github.io/vega-lite/" rel="noopener ugc nofollow" target="_blank"> Vega-lite </a>语法提供的指导原则。</p><p id="e83b" class="pw-post-body-paragraph lk ll iw lm b ln lo kg lp lq lr kj ls lt lu lv lw lx ly lz ma mb mc md me mf ip bi translated"><strong class="lm jg">不幸的是，Altair不支持本地动画</strong>，因为通过Vega-lite渲染它们很复杂。</p><p id="7671" class="pw-post-body-paragraph lk ll iw lm b ln lo kg lp lq lr kj ls lt lu lv lw lx ly lz ma mb mc md me mf ip bi translated">在本教程中，我演示了一种将Streamlit的功能与Altair相结合的机制，以呈现动画折线图。</p><p id="46c0" class="pw-post-body-paragraph lk ll iw lm b ln lo kg lp lq lr kj ls lt lu lv lw lx ly lz ma mb mc md me mf ip bi translated">Streamlit是一个非常强大的Python库，它允许用很少的代码行用Python构建Web应用程序。</p><h1 id="e2fd" class="mh mi iw bd mj mk ml mm mn mo mp mq mr kl ms km mt ko mu kp mv kr mw ks mx my bi translated">设置</h1><p id="97ca" class="pw-post-body-paragraph lk ll iw lm b ln mz kg lp lq na kj ls lt nb lv lw lx nc lz ma mb nd md me mf ip bi translated">首先，我安装所需的库:</p><pre class="kv kw kx ky gu ne nf ng nh aw ni bi"><span id="83a6" class="nj mi iw nf b gz nk nl l nm nn">pip install streamlit<br/>pip install altair</span></pre><p id="76c7" class="pw-post-body-paragraph lk ll iw lm b ln lo kg lp lq lr kj ls lt lu lv lw lx ly lz ma mb mc md me mf ip bi translated">为了构建一个Streamlit应用程序，我可以编写一个Python脚本，它不能是Jupyter笔记本的形式，因为目前<strong class="lm jg"> Streamlit不支持Jupyter </strong>。</p><p id="448c" class="pw-post-body-paragraph lk ll iw lm b ln lo kg lp lq lr kj ls lt lu lv lw lx ly lz ma mb mc md me mf ip bi translated">因此，我创建了一个名为<code class="fe no np nq nf b">AltairAnimation.py</code>的脚本，我将所有需要的库导入到我的脚本中:</p><pre class="kv kw kx ky gu ne nf ng nh aw ni bi"><span id="5e55" class="nj mi iw nf b gz nk nl l nm nn">import pandas as pd<br/>import altair as alt<br/>import streamlit as st<br/>import time</span></pre><p id="5235" class="pw-post-body-paragraph lk ll iw lm b ln lo kg lp lq lr kj ls lt lu lv lw lx ly lz ma mb mc md me mf ip bi translated">然后，我加载数据集。例如，我利用了欧盟统计局数据库发布的2012年至2020年的意大利游客数量。我利用Pandas库来加载数据集:</p><pre class="kv kw kx ky gu ne nf ng nh aw ni bi"><span id="bc2a" class="nj mi iw nf b gz nk nl l nm nn">df = pd.read_csv('../sources/tourist_arrivals.csv')</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj nr"><img src="../Images/8da99b0bdb40393f0cad1bf4d4b09529.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*r_WH-MrgIq5pWf0hdcUqCw.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="e769" class="pw-post-body-paragraph lk ll iw lm b ln lo kg lp lq lr kj ls lt lu lv lw lx ly lz ma mb mc md me mf ip bi translated">该数据集包含每月到达的游客人数。我将日期转换成一个<code class="fe no np nq nf b">datetime</code>类型:</p><pre class="kv kw kx ky gu ne nf ng nh aw ni bi"><span id="9a91" class="nj mi iw nf b gz nk nl l nm nn">df['date'] = pd.to_datetime(df['date'])</span></pre><h1 id="68dc" class="mh mi iw bd mj mk ml mm mn mo mp mq mr kl ms km mt ko mu kp mv kr mw ks mx my bi translated">构建基本图表</h1><p id="1346" class="pw-post-body-paragraph lk ll iw lm b ln mz kg lp lq na kj ls lt nb lv lw lx nc lz ma mb nd md me mf ip bi translated">我通过<code class="fe no np nq nf b">Chart()</code>类在Altair中构建了一个空图。具体来说，我指定我想通过<code class="fe no np nq nf b">mark_line()</code>函数画一条线。然后，我设置图表的轴(<code class="fe no np nq nf b">x</code>和<code class="fe no np nq nf b">y</code>)以及<code class="fe no np nq nf b">width</code>和<code class="fe no np nq nf b">height</code>。作为<code class="fe no np nq nf b">x</code>轴的默认值，我设置了<code class="fe no np nq nf b">1:T</code>，其中<code class="fe no np nq nf b">T</code>表示一个时间变量。相反，对于y轴，我将默认值设置为<code class="fe no np nq nf b">0:Q</code>，其中Q表示一个量，即一个数字。</p><pre class="kv kw kx ky gu ne nf ng nh aw ni bi"><span id="bf50" class="nj mi iw nf b gz nk nl l nm nn">lines = alt.Chart(df).mark_line().encode(<br/>     x=alt.X('1:T',axis=alt.Axis(title='date')),<br/>     y=alt.Y('0:Q',axis=alt.Axis(title='value'))<br/>).properties(<br/>    width=600,<br/>    height=300<br/>)</span></pre><p id="1808" class="pw-post-body-paragraph lk ll iw lm b ln lo kg lp lq lr kj ls lt lu lv lw lx ly lz ma mb mc md me mf ip bi translated">我还定义了一个函数，用作为参数传递的数据帧更新图表:</p><pre class="kv kw kx ky gu ne nf ng nh aw ni bi"><span id="1fbd" class="nj mi iw nf b gz nk nl l nm nn">def plot_animation(df):<br/>    lines = alt.Chart(df).mark_line().encode(<br/>       x=alt.X('date:T', axis=alt.Axis(title='date')),<br/>       y=alt.Y('value:Q',axis=alt.Axis(title='value')),<br/>     ).properties(<br/>       width=600,<br/>       height=300<br/>     ) <br/>     return lines</span></pre><h1 id="25fc" class="mh mi iw bd mj mk ml mm mn mo mp mq mr kl ms km mt ko mu kp mv kr mw ks mx my bi translated">构建动画</h1><p id="82c2" class="pw-post-body-paragraph lk ll iw lm b ln mz kg lp lq na kj ls lt nb lv lw lx nc lz ma mb nd md me mf ip bi translated">我想建立一个如下的动画:</p><figure class="kv kw kx ky gu kz"><div class="bz fq l di"><div class="ns nt l"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者制作的动画</p></figure><p id="70cc" class="pw-post-body-paragraph lk ll iw lm b ln lo kg lp lq lr kj ls lt lu lv lw lx ly lz ma mb mc md me mf ip bi translated">当用户点击开始按钮时，动画开始，并且最初它仅绘制数据帧的前6个月。然后，将另外6个月添加到图中，以此类推，直到数据框的大小。</p><p id="e0c6" class="pw-post-body-paragraph lk ll iw lm b ln lo kg lp lq lr kj ls lt lu lv lw lx ly lz ma mb mc md me mf ip bi translated">这可以通过以下方式实现。首先，我定义了一些辅助变量:</p><pre class="kv kw kx ky gu ne nf ng nh aw ni bi"><span id="4d6d" class="nj mi iw nf b gz nk nl l nm nn">N = df.shape[0] # number of elements in the dataframe<br/>burst = 6       # number of elements (months) to add to the plot<br/>size = burst     # size of the current dataset</span></pre><p id="6f18" class="pw-post-body-paragraph lk ll iw lm b ln lo kg lp lq lr kj ls lt lu lv lw lx ly lz ma mb mc md me mf ip bi translated">现在我可以构建Streamlit接口了。我画了一个图表和一个按钮:</p><pre class="kv kw kx ky gu ne nf ng nh aw ni bi"><span id="54db" class="nj mi iw nf b gz nk nl l nm nn">line_plot = st.altair_chart(lines)<br/>start_btn = st.button('Start')</span></pre><p id="7bf3" class="pw-post-body-paragraph lk ll iw lm b ln lo kg lp lq lr kj ls lt lu lv lw lx ly lz ma mb mc md me mf ip bi translated">最后，我可以制作动画:</p><pre class="kv kw kx ky gu ne nf ng nh aw ni bi"><span id="5e64" class="nj mi iw nf b gz nk nl l nm nn">if start_btn:<br/>   for i in range(1,N):<br/>      step_df = df.iloc[0:size]<br/>      lines = plot_animation(step_df)<br/>      line_plot = line_plot.altair_chart(lines)<br/>      size = i + burst<br/>      if size &gt;= N: <br/>         size = N - 1<br/>      time.sleep(0.1)</span></pre><p id="7e07" class="pw-post-body-paragraph lk ll iw lm b ln lo kg lp lq lr kj ls lt lu lv lw lx ly lz ma mb mc md me mf ip bi translated">如果用户点击开始按钮(<code class="fe no np nq nf b">if start_btn:</code>)，则循环开始，直到元素数量<code class="fe no np nq nf b">N-1</code>。构建了部分数据帧，包括第一个<code class="fe no np nq nf b">size</code>元素。然后，在该部分数据帧上构建图表，并更新变量<code class="fe no np nq nf b">size</code>。</p><h1 id="21d8" class="mh mi iw bd mj mk ml mm mn mo mp mq mr kl ms km mt ko mu kp mv kr mw ks mx my bi translated">运行Web应用程序</h1><p id="9fcb" class="pw-post-body-paragraph lk ll iw lm b ln mz kg lp lq na kj ls lt nb lv lw lx nc lz ma mb nd md me mf ip bi translated">最终，我准备好运行Web应用程序了。从命令行，我可以运行以下命令:</p><pre class="kv kw kx ky gu ne nf ng nh aw ni bi"><span id="9ba9" class="nj mi iw nf b gz nk nl l nm nn">streamlit run AltairAnimation.py</span></pre><p id="a1dc" class="pw-post-body-paragraph lk ll iw lm b ln lo kg lp lq lr kj ls lt lu lv lw lx ly lz ma mb mc md me mf ip bi translated">该Web应用程序将在以下URL提供:</p><pre class="kv kw kx ky gu ne nf ng nh aw ni bi"><span id="a515" class="nj mi iw nf b gz nk nl l nm nn"><strong class="nf jg">http://localhost:8501</strong></span></pre><h1 id="3ba1" class="mh mi iw bd mj mk ml mm mn mo mp mq mr kl ms km mt ko mu kp mv kr mw ks mx my bi translated">摘要</h1><p id="fc42" class="pw-post-body-paragraph lk ll iw lm b ln mz kg lp lq na kj ls lt nb lv lw lx nc lz ma mb nd md me mf ip bi translated">在本教程中，我展示了如何在Altair中利用非常强大的Streamlit库构建动画。</p><p id="87b7" class="pw-post-body-paragraph lk ll iw lm b ln lo kg lp lq lr kj ls lt lu lv lw lx ly lz ma mb mc md me mf ip bi translated">在<a class="ae mg" href="https://github.com/alod83/data-science/blob/master/DataVisualization/Altair/AltairAnimation.py" rel="noopener ugc nofollow" target="_blank">我的Github库</a>中可以找到实现的Web应用的完整代码。</p><p id="5714" class="pw-post-body-paragraph lk ll iw lm b ln lo kg lp lq lr kj ls lt lu lv lw lx ly lz ma mb mc md me mf ip bi translated">我真的要感谢<a class="nu nv ep" href="https://medium.com/u/c5b77fc1811c?source=post_page-----2a0624789ad--------------------------------" rel="noopener" target="_blank"> A B </a>，他写了<a class="ae mg" rel="noopener" target="_blank" href="/add-animated-charts-to-your-dashboards-with-streamlit-python-f41863f1ef7c">这篇文章</a>，这篇文章激发了我的灵感。</p><p id="d6a8" class="pw-post-body-paragraph lk ll iw lm b ln lo kg lp lq lr kj ls lt lu lv lw lx ly lz ma mb mc md me mf ip bi translated">如果你想了解我的研究和其他活动的最新情况，你可以在<a class="ae mg" href="https://twitter.com/alod83" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae mg" href="https://www.youtube.com/channel/UC4O8-FtQqGIsgDW_ytXIWOg?view_as=subscriber" rel="noopener ugc nofollow" target="_blank"> Youtube </a>和<a class="ae mg" href="https://github.com/alod83" rel="noopener ugc nofollow" target="_blank"> Github </a>上关注我。</p><h1 id="3a4a" class="mh mi iw bd mj mk ml mm mn mo mp mq mr kl ms km mt ko mu kp mv kr mw ks mx my bi translated">相关文章</h1><div class="nw nx gq gs ny nz"><a rel="noopener follow" target="_blank" href="/some-interesting-articles-and-resources-on-data-visualisation-that-i-discovered-in-june-c00b58d15946"><div class="oa ab fp"><div class="ob ab oc cl cj od"><h2 class="bd jg gz z fq oe fs ft of fv fx jf bi translated">我在六月份发现的一些关于数据可视化的有趣文章和资源</h2><div class="og l"><h3 class="bd b gz z fq oe fs ft of fv fx dk translated">从网上收集的一些关于数据可视化的最新有趣文章和资源的摘要。</h3></div><div class="oh l"><p class="bd b dl z fq oe fs ft of fv fx dk translated">towardsdatascience.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on le nz"/></div></div></a></div><div class="nw nx gq gs ny nz"><a rel="noopener follow" target="_blank" href="/data-visualisation-principles-part-1-white-space-text-and-colour-13f520f90ce9"><div class="oa ab fp"><div class="ob ab oc cl cj od"><h2 class="bd jg gz z fq oe fs ft of fv fx jf bi translated">数据可视化原理第1部分:空白、文本和颜色</h2><div class="og l"><h3 class="bd b gz z fq oe fs ft of fv fx dk translated">基本图形设计原则入门。</h3></div><div class="oh l"><p class="bd b dl z fq oe fs ft of fv fx dk translated">towardsdatascience.com</p></div></div><div class="oi l"><div class="oo l ok ol om oi on le nz"/></div></div></a></div><div class="nw nx gq gs ny nz"><a rel="noopener follow" target="_blank" href="/plotly-vs-matplotlib-what-is-the-best-library-for-data-visualization-in-python-89a8b64a9471"><div class="oa ab fp"><div class="ob ab oc cl cj od"><h2 class="bd jg gz z fq oe fs ft of fv fx jf bi translated">plotly VS matplotlib:Python中数据可视化最好的库是什么？</h2><div class="og l"><h3 class="bd b gz z fq oe fs ft of fv fx dk translated">在这个简短的教程中，我将向您展示如何使用plotly和matplotlib库快速构建一个基本的折线图…</h3></div><div class="oh l"><p class="bd b dl z fq oe fs ft of fv fx dk translated">towardsdatascience.com</p></div></div><div class="oi l"><div class="op l ok ol om oi on le nz"/></div></div></a></div></div></div>    
</body>
</html>