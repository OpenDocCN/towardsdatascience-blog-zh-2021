<html>
<head>
<title>PyTest for Machine Learning — a simple example-based tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于机器学习的PyTest一个简单的基于示例的教程</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pytest-for-machine-learning-a-simple-example-based-tutorial-a3df3c58cf8?source=collection_archive---------3-----------------------#2021-04-24">https://towardsdatascience.com/pytest-for-machine-learning-a-simple-example-based-tutorial-a3df3c58cf8?source=collection_archive---------3-----------------------#2021-04-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5cbc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我们展示了如何使用PyTest为一个简单的机器学习模块编写有效的测试函数</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4854dbf17a8e916d9b482528c8a5cc61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Or7VSfksvubesFw4SjHPJw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:作者来自Pixabay <a class="ae ky" href="https://pixabay.com/vectors/check-mark-check-ok-approved-done-42622/" rel="noopener ugc nofollow" target="_blank"> source-1 </a>和<a class="ae ky" href="https://pixabay.com/vectors/chemistry-test-tube-laboratory-4209556/" rel="noopener ugc nofollow" target="_blank"> source-2 </a></p></figure><h1 id="d214" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="b782" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为什么数据科学和机器学习需要软件测试？</p><p id="86da" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这篇文章中有许多精彩的观点，说明了为什么测试可以提高所有商业和行业的任何软件产品/服务的交付、性能和长期盈利能力。</p><div class="ms mt gp gr mu mv"><a href="https://www.westagilelabs.com/blog/why-is-software-testing-and-qa-important-for-any-business/" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">为什么软件测试和QA对任何企业都很重要</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">如今，随着社会数字化程度的提高，软件的影响力越来越大。它有助于…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">www.westagilelabs.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj ks mv"/></div></div></a></div><p id="f42f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">今天，站在2021年，我们看到数据科学和机器学习工具、平台和服务越来越多地嵌入到几乎所有行业中，包括医疗保健、金融、制造、零售、娱乐、运输…</p><p id="fe8e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">机器学习正在触及或将要触及我们生活的几乎所有方面。自然，我们应该期待这些服务背后有一个高质量和健壮的软件框架，它可以预测我最喜欢的餐馆，或者当我在一个新城市迷路时为我提供可靠的指导。<strong class="lt iu">只有当我知道幕后的软件是用成熟可靠的方法测试过的，我才会对这些看起来神奇的服务产生信任</strong>。</p><p id="fd0b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在许多情况下，这些新型服务的发展速度甚至高于传统软件产品。加速产品的开发往往是以牺牲质量为代价的。一个好的软件测试策略可以帮助抵消这种权衡。</p><p id="0a32" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">因此，确保这些新工具经过测试，以获得它们向最终客户承诺的重要特性和功能——可伸缩性、准确性、适应性等，这一点极其重要。</p><blockquote class="nk"><p id="33e6" class="nl nm it bd nn no np nq nr ns nt mm dk translated">只有当我知道幕后的软件是用一种经过验证的、健壮的方法测试过的时候，我才会对这些服务产生信任，这些服务看起来很神奇</p></blockquote><h1 id="6a96" class="kz la it bd lb lc ld le lf lg lh li lj jz nu ka ll kc nv kd ln kf nw kg lp lq bi translated">PyTest——什么和为什么？</h1><p id="6db9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">PyTest是什么？</p><p id="c413" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">据其<a class="ae ky" href="https://docs.pytest.org/en/6.2.x/" rel="noopener ugc nofollow" target="_blank">网站</a>介绍，“<em class="nx"> pytest是一款成熟的全功能Python测试工具，可以帮助你编写更好的程序。</em>”</p><p id="0b6b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Python在其安装中提供了一个名为<code class="fe ny nz oa ob b">unittest</code>的内置测试模块，但是它有一些缺点。这个GitHub repo以一种漂亮而直观的方式总结了这两者之间的一些测试场景，</p><div class="ms mt gp gr mu mv"><a href="https://github.com/renzon/pytest-vs-unittest" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">renzon/pytest-vs-unittest</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">pytest和unittes测试框架之间的比较</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">github.com</p></div></div></div></a></div><p id="e314" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">互联网上有很多方便的学习和练习Pytest的资源。这里是入门教程，</p><div class="ms mt gp gr mu mv"><a href="https://semaphoreci.com/community/tutorials/testing-python-applications-with-pytest" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">使用Pytest测试Python应用程序-信号量教程</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">今天，测试应用程序已经成为任何有能力的开发人员都需要的标准技能。Python社区…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">semaphoreci.com</p></div></div><div class="ne l"><div class="oc l ng nh ni ne nj ks mv"/></div></div></a></div><p id="86df" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">而更全面稍微高级一点(处理设计模式)的是下面这个，</p><div class="ms mt gp gr mu mv"><a href="https://realpython.com/pytest-python-testing/" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">用Pytest - Real Python进行有效的Python测试</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">在本教程中，您将学习如何使用pytest将您的测试提升到一个新的水平。你将负责中级和…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">realpython.com</p></div></div><div class="ne l"><div class="od l ng nh ni ne nj ks mv"/></div></div></a></div><p id="5839" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然而，<strong class="lt iu">我觉得缺乏高度专注于使用PyTest进行机器学习模块的专用教程，并带有清晰的示例</strong>。这是我第一次尝试解决这个问题。</p><p id="f3c3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我建议读者在深入研究本文之前，先用简单的Python程序和函数复习一下PyTest的基本用法，因为本文假设您已经基本熟悉了PyTest。</p><p id="ff63" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">那我们就开始吧。</p><h1 id="b60b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">Scikit-learn模型培训功能的Pytest模块</h1><p id="f13c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这是一篇基于示例的文章，我能想到的最典型的例子是用Pytest测试一个基于scikit-learn的ML训练函数。这是任何Python ML从业者迟早都极有可能遇到的场景。</p><p id="5471" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这个例子的GitHub repo在这里:<a class="ae ky" href="https://github.com/tirthajyoti/Machine-Learning-with-Python/tree/master/Pytest" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> PyTest ML repo </strong> </a>。</p><p id="449a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是我们将要探索的想法，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/2cdaaf7c5fe6c8c9aed3968eb8722e8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2SYweCRRh6bJPPx8ofgyTQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:作者自制(自带)。Scikit-learn logo来源:<a class="ae ky" href="https://commons.wikimedia.org/wiki/File:Scikit_learn_logo_small.svg" rel="noopener ugc nofollow" target="_blank">维基百科(BSD) </a>，Pytest <a class="ae ky" href="https://docs.pytest.org/en/stable/license.html" rel="noopener ugc nofollow" target="_blank">版权来源</a></p></figure><h2 id="2c75" class="of la it bd lb og oh dn lf oi oj dp lj ma ok ol ll me om on ln mi oo op lp oq bi translated">如何基于此回购运行Pytest</h2><ul class=""><li id="3426" class="or os it lt b lu lv lx ly ma ot me ou mi ov mm ow ox oy oz bi translated">安装pytest <code class="fe ny nz oa ob b">pip install pytest</code></li><li id="6e18" class="or os it lt b lu pa lx pb ma pc me pd mi pe mm ow ox oy oz bi translated">从<a class="ae ky" href="https://github.com/tirthajyoti/Machine-Learning-with-Python/tree/master/Pytest" rel="noopener ugc nofollow" target="_blank"> Github repo </a>中复制/克隆两个Python脚本</li><li id="aeaa" class="or os it lt b lu pa lx pb ma pc me pd mi pe mm ow ox oy oz bi translated"><code class="fe ny nz oa ob b">linear_model.py</code>有一个使用scikit-learn训练简单线性回归模型的函数。注意，它有基本的断言测试和<code class="fe ny nz oa ob b">try-except</code>构造来处理潜在的输入错误。</li><li id="ed60" class="or os it lt b lu pa lx pb ma pc me pd mi pe mm ow ox oy oz bi translated"><code class="fe ny nz oa ob b">test_linear_model.py</code>文件是测试模块，作为Pytest程序的输入。</li><li id="4b54" class="or os it lt b lu pa lx pb ma pc me pd mi pe mm ow ox oy oz bi translated">在你的终端上运行<code class="fe ny nz oa ob b">pytest test_linear_model.py -v</code>来运行测试。您应该会看到如下所示的内容，</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/d8dae9e4d51c70e548ff3cc913291946.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NhHf2Ay2bYBCCDBC0RRoYQ.png"/></div></div></figure><h2 id="a190" class="of la it bd lb og oh dn lf oi oj dp lj ma ok ol ll me om on ln mi oo op lp oq bi translated">这是什么意思？</h2><ul class=""><li id="49ee" class="or os it lt b lu lv lx ly ma ot me ou mi ov mm ow ox oy oz bi translated">终端消息(如上)表明运行了9个测试(对应于<code class="fe ny nz oa ob b">test_linear_model.py</code>模块中的9个函数),并且全部通过。</li><li id="fd0d" class="or os it lt b lu pa lx pb ma pc me pd mi pe mm ow ox oy oz bi translated">它还显示了测试运行的顺序(这是因为您在运行<code class="fe ny nz oa ob b">pytest</code>命令时在命令行中包含了<code class="fe ny nz oa ob b">- v</code>参数)。Pytest允许您随机化测试序列，但是这个讨论将在另一天进行。</li></ul><h2 id="01ee" class="of la it bd lb og oh dn lf oi oj dp lj ma ok ol ll me om on ln mi oo op lp oq bi translated">我的主ML函数看起来怎么样？</h2><p id="62a2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们看看我们正在测试的核心ML函数。这是一个简单的函数，用scikit-learn库训练一个线性回归模型，并返回R分数。它还将训练好的模型保存在本地文件系统上。</p><p id="a33d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我将分两部分向您展示该功能，因为我希望您注意第一部分中的许多<code class="fe ny nz oa ob b">assert</code>语句。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/f7587861ed72e308da8f677be7571737.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lCwIcp-jzSr2s6PA6YeAEQ.png"/></div></div></figure><p id="4447" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你盯着代码看足够长的时间，你会很容易意识到<strong class="lt iu">函数已经内置了许多类型检查和错误捕捉代码</strong>。</p><p id="3446" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果函数已经在测试它的传入数据类型和范围，那么我们用Pytest检查什么呢？</p><p id="7a2b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> PyTest不检查你的数据。它检查你的代码/程序</strong>。</p><p id="9ebf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您仍然必须在主函数中编写各种数据和输入检查代码，以确保数据完整性，并处理ML函数部署在实际生产系统中的奇怪情况。</p><p id="6f8f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最重要的是，在开发过程中，您希望编写Pytest模块来查看您编写的函数是否按预期运行。这包括它自身的错误检查行为。</p><p id="3dd1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这个例子中，我们在原来的<code class="fe ny nz oa ob b">train_linear_model</code>函数中写了一串<code class="fe ny nz oa ob b">assert</code>语句，并将它们包装在一个完整的<code class="fe ny nz oa ob b">try...except</code>块中。<strong class="lt iu">测试代码仅检查我们是否为那些错误的输入情况返回了</strong> <code class="fe ny nz oa ob b"><strong class="lt iu">AssertionType</strong></code> <strong class="lt iu">错误</strong>，以及是否为最终用户打印了正确的错误消息。</p><p id="1ea1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了强调这一点，让我以局部的方式重复上面的总体方案，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/fb81b1886a278c2d37786c18d62836e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qc2HIOuQs7EO7I0Qc9qaCA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:作者制作(自有)</p></figure><p id="6081" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">所以，像<strong class="lt iu"> <em class="nx">错误处理</em> </strong>或<strong class="lt iu"> <em class="nx">矢量形状检查</em> </strong>这样的事情只是你的函数的整体设计模式的一部分。Pytest将它们视为与其他ML特定模式相同，如<strong class="lt iu"> <em class="nx">数据预处理</em> </strong>或<strong class="lt iu"> <em class="nx">模型拟合</em> </strong>。</p><p id="b803" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这种情况下，这里是函数的其余部分——这里没有太多断言，只是常规的ML内容。您可以在此函数中使用两个Numpy数组，它将进行内部测试/训练分割，用训练集拟合模型，在测试集上评估模型并返回分数。</p><blockquote class="nk"><p id="2493" class="nl nm it bd nn no np nq nr ns nt mm dk translated">PyTest不会检查您的数据。它检查你的代码/程序。你仍然必须在主函数中编写各种数据和输入检查代码，以确保数据完整性和处理奇怪的情况…</p></blockquote><figure class="pi pj pk pl pm kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/9ad9aa0fdee1c5fd1085e19dc6121be5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rkSSz3OsxqLaty8OnJjw5w.png"/></div></div></figure><h2 id="97cb" class="of la it bd lb og oh dn lf oi oj dp lj ma ok ol ll me om on ln mi oo op lp oq bi translated">ML函数捕捉错误的例子</h2><p id="8a61" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">尽管这不是一个直接的Pytest主题，但是看到这些断言语句在运行中捕捉错误会很有帮助。这里是一些数据和一个正常的执行，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/933215fd6c31719efbc1fb7756a4692a.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*j7PJcBgsGa5T3haB9orXHg.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi po"><img src="../Images/c8469be14b0a798ebbc91069d5b91ae1.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*IKR7LBppyMYQvrTQs9c-hw.png"/></div></figure><p id="a40d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这里有几个在生产系统中出现的例子，可以用这个函数来处理。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/0623dade0ce31847f5d319d09d1f3cf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bdmJ2xc0aEvA0yez6poNkg.png"/></div></div></figure><h1 id="cc51" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">现在，让我们看看Pytest模块</h1><p id="fb9b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果你看一下<a class="ae ky" href="https://github.com/tirthajyoti/Machine-Learning-with-Python/blob/master/Pytest/test_linear_model.py" rel="noopener ugc nofollow" target="_blank"> Pytest模块</a>，首先映入你眼帘的是庞大的代码！<strong class="lt iu">为了测试一个42行的模块，我们必须编写将近300行代码！</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pq"><img src="../Images/295fffeb8af214104d07c9b234c47f09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8HnAnFIVCypecOHatdUB0Q.png"/></div></div></figure><p id="1539" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这很正常。您想要测试的特性和功能越多，您的测试套件就会越长。这同样适用于测试更多的<em class="nx">情况</em>或<em class="nx">拐角情况</em>。</p><p id="1473" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">可以详细过一下<a class="ae ky" href="https://github.com/tirthajyoti/Machine-Learning-with-Python/blob/master/Pytest/test_linear_model.py" rel="noopener ugc nofollow" target="_blank">码</a>。我将只提到一些突出的特点，</p><ul class=""><li id="a72e" class="or os it lt b lu mn lx mo ma pr me ps mi pt mm ow ox oy oz bi translated">注意，<code class="fe ny nz oa ob b">test_linear_model.py</code>是如何包含9个名字以 <code class="fe ny nz oa ob b"><strong class="lt iu">test...</strong></code>开头的<strong class="lt iu">函数的。那些包含实际的测试代码。</strong></li><li id="b5d6" class="or os it lt b lu pa lx pb ma pc me pd mi pe mm ow ox oy oz bi translated">它还有几个<strong class="lt iu">数据构造函数</strong>，它们的名字不是以<code class="fe ny nz oa ob b">test...</code>开头，它们被Pytest忽略了。但是我们间接需要它们来进行测试。<code class="fe ny nz oa ob b">random_data_constructor</code>甚至使用一个<code class="fe ny nz oa ob b">noise_mag</code>参数来控制噪声的大小，以测试线性回归算法的预期行为。请参考<code class="fe ny nz oa ob b">test_noise_impact</code>功能。</li></ul><div class="kj kk kl km gt ab cb"><figure class="pu kn pv pw px py pz paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/1c9b793660d5300ed3ccb6a86c06e312.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*J8V1Ke2gaeE6Nj0l5SxP6w.png"/></div></figure><figure class="pu kn qa pw px py pz paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/6b21eead3701982cf2f421d6d64830ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*g-9Ru4E-iGf8waz82eteDA.png"/></div></figure></div><ul class=""><li id="f629" class="or os it lt b lu mn lx mo ma pr me ps mi pt mm ow ox oy oz bi translated">注意，我们<strong class="lt iu">需要导入各种库来测试各种东西</strong>，例如，我们导入了像<code class="fe ny nz oa ob b">joblib</code>、<code class="fe ny nz oa ob b">os</code>、<code class="fe ny nz oa ob b">sklearn</code>、<code class="fe ny nz oa ob b">numpy</code>这样的库，当然，还有来自<code class="fe ny nz oa ob b">linear_model</code>模块的<code class="fe ny nz oa ob b">train_linear_model</code>函数。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qb"><img src="../Images/75b41ca0b65d974f031a51b6f9c37cb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jRfZbaRGH7YWCkc3WxlwQw.png"/></div></div></figure><ul class=""><li id="1fcb" class="or os it lt b lu mn lx mo ma pr me ps mi pt mm ow ox oy oz bi translated">请注意测试函数的<strong class="lt iu">清晰而独特的名称，例如<code class="fe ny nz oa ob b">test_model_return_object()</code>只检查从<code class="fe ny nz oa ob b">train_linear_model</code>函数返回的对象，或者<code class="fe ny nz oa ob b">test_model_save_load()</code>检查保存的模型是否可以正确加载(但不尝试做出预测或任何事情)。总是写简短明了的测试函数，并且只关注一个焦点</strong>。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qc"><img src="../Images/473324743c712f8ddccc25637e9eade4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_PH25dpCr72sLIB-SDDgXA.png"/></div></div></figure><ul class=""><li id="53d3" class="or os it lt b lu mn lx mo ma pr me ps mi pt mm ow ox oy oz bi translated">为了检查预测，即训练的模型是否真的工作，我们有<code class="fe ny nz oa ob b">test_loaded_model_works()</code>功能，其中<strong class="lt iu">使用无噪声的固定数据发生器</strong>(与其他情况相比，我们可以使用有随机噪声的随机数据发生器)。它传递固定的<code class="fe ny nz oa ob b">X</code>和<code class="fe ny nz oa ob b">y</code>数据，加载训练好的模型，检查R ( <a class="ae ky" href="https://www.geeksforgeeks.org/python-coefficient-of-determination-r2-score/" rel="noopener ugc nofollow" target="_blank">回归系数</a>)分数是否完全等于1.0(对于没有噪声的固定数据集为真)，然后将模型预测与原始地面真实值<code class="fe ny nz oa ob b">y</code>向量进行比较。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qd"><img src="../Images/aaa2e6f0de8179c2e8cb4354b3bbc026.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hE8UrSET-BNw1BLf7Snx6A.png"/></div></div></figure><ul class=""><li id="7672" class="or os it lt b lu mn lx mo ma pr me ps mi pt mm ow ox oy oz bi translated">注意，前面提到的测试函数<strong class="lt iu">是如何使用一个特殊的Numpy测试函数</strong> <code class="fe ny nz oa ob b"><strong class="lt iu">np.testing.assert_allclose</strong></code> <strong class="lt iu">代替常规的</strong> <code class="fe ny nz oa ob b"><strong class="lt iu">assert</strong></code> <strong class="lt iu">语句</strong>。这是为了避免与模型数据(即Numpy数组和涉及线性代数运算的预测算法)相关的任何潜在的数值精度问题。</li><li id="30f1" class="or os it lt b lu pa lx pb ma pc me pd mi pe mm ow ox oy oz bi translated"><code class="fe ny nz oa ob b">test_model_works_data_range_sign_change</code>函数<strong class="lt iu">测试线性回归估计器</strong>的预期行为，即无论数据范围如何，回归分数仍将为1.0(按10e-9或10e+9缩放数据)。如果数据以某种方式改变符号，它也会改变预期的行为。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qe"><img src="../Images/6bfc7751baa6de0ecc73093835c43f77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3VVKEDVw_PMPEifqm-JyfA.png"/></div></div></figure><ul class=""><li id="9596" class="or os it lt b lu mn lx mo ma pr me ps mi pt mm ow ox oy oz bi translated"><code class="fe ny nz oa ob b">test_additive_invariance</code>函数测试线性回归估计量的加性不变性。类似地，<strong class="lt iu">你应该考虑你的最大似然估计器的特殊属性，并为它们编写定制的测试</strong>。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qf"><img src="../Images/60291f692cf5cf8c8b222c0299f9fea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u22MlAoaQO1lyXdkKdwI5w.png"/></div></div></figure><ul class=""><li id="c625" class="or os it lt b lu mn lx mo ma pr me ps mi pt mm ow ox oy oz bi translated">看一下<code class="fe ny nz oa ob b">test_wrong_input_raises_assertion</code>函数，当输入各种类型的错误输入参数时，<strong class="lt iu">测试原始建模函数是否产生正确的异常和消息。</strong></li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qg"><img src="../Images/5f3b7ae330ab1816618f64a3d2b92784.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*91aMjk4DcZS7r75A2ylHow.png"/></div></div></figure><ul class=""><li id="53bc" class="or os it lt b lu mn lx mo ma pr me ps mi pt mm ow ox oy oz bi translated">最后，<code class="fe ny nz oa ob b">test_raised_exception</code>函数<strong class="lt iu">使用一个特殊的Pytest特性-<a class="ae ky" href="https://docs.pytest.org/en/reorganize-docs/new-docs/user/pytest_raises.html" rel="noopener ugc nofollow" target="_blank"/><code class="fe ny nz oa ob b"><a class="ae ky" href="https://docs.pytest.org/en/reorganize-docs/new-docs/user/pytest_raises.html" rel="noopener ugc nofollow" target="_blank">pytest.raises</a></code><a class="ae ky" href="https://docs.pytest.org/en/reorganize-docs/new-docs/user/pytest_raises.html" rel="noopener ugc nofollow" target="_blank">上下文管理器</a>在运行时测试其他异常类型的出现(即不同于</strong> <code class="fe ny nz oa ob b"><strong class="lt iu">AssertionError</strong></code> <strong class="lt iu">可能由函数模块</strong>中的 <code class="fe ny nz oa ob b"><strong class="lt iu">assert</strong></code> <strong class="lt iu">语句引发)。</strong></li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qh"><img src="../Images/e321dbee373607b8593020bbd10273eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JrAAxXCFvSDPhMn0jv1OKA.png"/></div></div></figure><blockquote class="nk"><p id="1627" class="nl nm it bd nn no qi qj qk ql qm mm dk translated">您想要测试的特性和功能越多，您的测试套件就会越长。这同样适用于测试更多的<em class="qn">情况</em>或<em class="qn">角落情况</em>。</p></blockquote><h1 id="100b" class="kz la it bd lb lc ld le lf lg lh li lj jz nu ka ll kc nv kd ln kf nw kg lp lq bi translated">摘要</h1><p id="d9ec" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在本文中，我们展示了如何为简单的线性回归函数模块编写PyTest模块/测试套件。我们谈到了编写测试的一些一般原则，如数据类型和输入向量形状检查，以及机器学习任务的特定方面，如线性回归估计器在数据规模变化下应如何表现。</p><p id="0972" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Pytest是一个轻量级且易于使用的实用程序，但它提供了足够的灵活性来在测试套件中构建强大的设计模式。您可以利用这一点，使您的数据科学和机器学习包更加健壮和高效。</p></div><div class="ab cl qo qp hx qq" role="separator"><span class="qr bw bk qs qt qu"/><span class="qr bw bk qs qt qu"/><span class="qr bw bk qs qt"/></div><div class="im in io ip iq"><p id="7cb2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><em class="nx">喜欢这篇文章吗？成为</em> <a class="ae ky" href="https://medium.com/@tirthajyoti/membership" rel="noopener"> <strong class="lt iu"> <em class="nx">中等会员</em> </strong> </a> <em class="nx">继续</em> <strong class="lt iu"> <em class="nx">无限制学习</em> </strong> <em class="nx">。如果你使用下面的链接，</em> <strong class="lt iu"> <em class="nx">我会收到你的一部分会员费，而不会给你带来额外的费用</em> </strong> <em class="nx">。</em></p><div class="ms mt gp gr mu mv"><a href="https://medium.com/@tirthajyoti/membership" rel="noopener follow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">通过我的推荐链接加入媒体</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">medium.com</p></div></div><div class="ne l"><div class="qv l ng nh ni ne nj ks mv"/></div></div></a></div></div></div>    
</body>
</html>