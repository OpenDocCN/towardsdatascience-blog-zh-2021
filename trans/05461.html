<html>
<head>
<title>Making Interactive Line Plots with Python Pandas and Altair</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python熊猫和牛郎星制作交互式线条图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/making-interactive-line-plots-with-python-pandas-and-altair-7ee1d109e3dd?source=collection_archive---------21-----------------------#2021-05-14">https://towardsdatascience.com/making-interactive-line-plots-with-python-pandas-and-altair-7ee1d109e3dd?source=collection_archive---------21-----------------------#2021-05-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c0c5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将增强你的EDA过程的图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4c2b1b12483a9ea9c8084a1689809815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u5C-NUdjVB6MRlLa4vrOpg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@nevenkrcmarek?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Neven Krcmarek </a>在<a class="ae ky" href="https://unsplash.com/s/photos/stock-price?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="83db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">线图是数据分析的重要部分。它让我们了解了一个量在连续测量中是如何变化的。在处理时间序列的情况下，线图的重要性变得至关重要。</p><p id="5bd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">趋势、季节性和相关性是可以在精心生成的线图上观察到的一些特征。在本文中，我们将使用两个Python库创建交互式线图:Pandas和Altair。</p><p id="6167" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas提供数据，Altair制作美丽且信息丰富的线图。虽然Pandas也能够绘制数据，但它不是一个显式的数据可视化库。此外，我们将使情节互动，这是熊猫无法做到的。</p><p id="e063" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从生成数据开始。折线图的一个典型用例是分析股票价格。获取股价数据最简单的方法之一就是<code class="fe lv lw lx ly b">pandas-datareader</code>库。我们首先需要将它与Pandas一起导入(已经安装在Google Colab中)。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="d4c5" class="md me it ly b gy mf mg l mh mi">import pandas as pd<br/>from pandas_datareader import data</span></pre><p id="bee6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将得到3种不同股票在1年内的价格。需要指定开始日期、结束日期和来源。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="6046" class="md me it ly b gy mf mg l mh mi">start = '2020-1-1'<br/>end = '2020-12-31'<br/>source = 'yahoo'</span></pre><p id="c2df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有一个必需的信息是股票的名称。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="8f16" class="md me it ly b gy mf mg l mh mi">apple = data.DataReader("AAPL", start=start ,end=end, data_source=source).reset_index()[["Date", "Close"]]</span><span id="4dc4" class="md me it ly b gy mj mg l mh mi">ibm = data.DataReader("IBM", start=start ,end=end, data_source=source).reset_index()[["Date", "Close"]]</span><span id="6cb2" class="md me it ly b gy mj mg l mh mi">microsoft = data.DataReader("MSFT", start=start ,end=end, data_source=source).reset_index()[["Date", "Close"]]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/94de32bf96f34d50e1a3b1601b7a15c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*t03-jFmwiCilyECw-kcgGw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="7838" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在有苹果、IBM和微软在2020年的股价。最好将它们放在一个数据框中。在合并之前，我们需要添加一个列来指示特定价格属于哪只股票。</p><p id="d274" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码块添加相关的列，然后使用<code class="fe lv lw lx ly b">concat</code>函数组合数据帧。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="dd5d" class="md me it ly b gy mf mg l mh mi">apple["Stock"] = "apple"<br/>ibm["Stock"] = "ibm"<br/>microsoft["Stock"] = "msft"</span><span id="59c7" class="md me it ly b gy mj mg l mh mi">stocks["Month"] = stocks.Date.dt.month</span><span id="4385" class="md me it ly b gy mj mg l mh mi">stocks = pd.concat([apple, ibm, microsoft])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/21279ddbcd37031d7216d64ab05c7e86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*6iQqgyoO8Pz4CpfqOlePpA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="eb59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还添加了可能对分析有用的月份信息。我们现在可以开始创建情节。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h2 id="9ec5" class="md me it bd mt mu mv dn mw mx my dp mz li na nb nc lm nd ne nf lq ng nh ni nj bi translated">阿尔泰尔</h2><p id="73b4" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">Altair是Python的统计可视化库。它的语法清晰易懂，我们将在示例中看到。用Altair创建交互式可视化也非常简单。</p><p id="72e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将简要说明牵牛星的结构，然后重点介绍如何创建交互式线条图。如果你是牛郎星的新手，这里有一个牛郎星的4部分系列教程:</p><ul class=""><li id="dd6d" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated">第一部分:<a class="ae ky" rel="noopener" target="_blank" href="/altair-statistical-visualization-library-for-python-cfb63847c0c0">简介</a></li><li id="e7a1" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">第2部分:<a class="ae ky" rel="noopener" target="_blank" href="/altair-statistical-visualization-library-for-python-part-2-4c8ce134e743">过滤和转换数据</a></li><li id="a6a3" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">第3部分:<a class="ae ky" rel="noopener" target="_blank" href="/altair-statistical-visualization-library-for-python-part-3-c1e650a8411e">互动情节和动态过滤</a></li><li id="aa72" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">第4部分:<a class="ae ky" rel="noopener" target="_blank" href="/altair-statistical-visualization-library-for-python-part-4-9ec970fb12e8">定制可视化</a></li></ul></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="e2fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个简单的线图，不具备任何交互性。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="f1cf" class="md me it ly b gy mf mg l mh mi">alt.Chart(stocks).mark_line().encode(<br/>   x="Date",<br/>   y="Close",<br/>   color="Stock"<br/>).properties(<br/>   height=300, width=500<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/d513ce85266519f7e7a72fc327c248d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*Vd76y24BPCyaKoMyi66S4Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="def5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基本结构从顶级图表对象开始。数据可以是Pandas数据框的形式，也可以是指向json或csv文件的URL字符串。然后指定可视化的类型(例如，<code class="fe lv lw lx ly b">mark_circle</code>、<code class="fe lv lw lx ly b">mark_line</code>等等)。</p><p id="0ac7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">encode</code>函数告诉Altair在给定的数据帧中绘制什么。因此，我们在<code class="fe lv lw lx ly b">encode</code>函数中写的任何东西都必须链接到数据。<code class="fe lv lw lx ly b">color</code>参数区分不同的股票名称。与Seaborn的<code class="fe lv lw lx ly b">hue</code>参数相同。最后，我们使用<code class="fe lv lw lx ly b">properties</code>函数指定绘图的某些属性。</p><p id="a0e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为情节增加交互性的一种方法是通过选择。Altair中的一个选择捕获了用户的交互。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="d705" class="md me it ly b gy mf mg l mh mi">selection = alt.selection_multi(fields=["Stock"], bind="legend")</span><span id="f061" class="md me it ly b gy mj mg l mh mi">alt.Chart(stocks).mark_line().encode(<br/>   x="Date",<br/>   y="Close",<br/>   color="Stock",<br/>   opacity=alt.condition(selection, alt.value(1), alt.value(0.1))<br/>).properties(<br/>   height=300, width=500<br/>).add_selection(<br/>   selection<br/>)</span></pre><p id="2476" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的选择对象基于包含股票名称的股票列。它必然与传说有关。我们将其传递给<code class="fe lv lw lx ly b">opacity</code>参数，这样线条的不透明度会根据所选股票名称而变化。</p><p id="7db6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还需要使用<code class="fe lv lw lx ly b">add_selection</code>函数将选择添加到绘图中。下面两幅图像演示了选择是如何工作的。我们只需要点击图例中的股票名称。然后，相应地更新绘图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/d513ce85266519f7e7a72fc327c248d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*Vd76y24BPCyaKoMyi66S4Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/1ceb17667bef90e8edd29f7f1611afed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*D5HUGSWNbVTYbEv6T9cBBw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="4992" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Altair提供了其他选项来捕捉用户交互。例如，我们可以创建一个交互式的线图，将鼠标悬停在图上就可以更新。</p><p id="4ffa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码创建了一个selection对象，它执行我们刚刚描述的选择。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="4036" class="md me it ly b gy mf mg l mh mi">hover = alt.selection(<br/>   type="single", on="mouseover", fields=["Stock"], nearest=True<br/>)</span></pre><p id="144d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用选择对象来捕捉图上最近的点，然后突出显示该点所属的线。</p><p id="d6dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码中有3个组件。第一个创建线形图。第二个是绘制在线图上的散点图，用于识别最近点。我们调整不透明度，使散点图不可见。</p><p id="8290" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第三个负责突出显示第二个图中包含捕获点的线。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="a61c" class="md me it ly b gy mf mg l mh mi"># line plot<br/>lineplot = alt.Chart(stocks).mark_line().encode(<br/>   x="Date:T",<br/>   y="Close:Q",<br/>   color="Stock:N",<br/>)</span><span id="6de0" class="md me it ly b gy mj mg l mh mi"># nearest point<br/>point = lineplot.mark_circle().encode(<br/>   opacity=alt.value(0)<br/>).add_selection(hover)</span><span id="ee8f" class="md me it ly b gy mj mg l mh mi"># highlight<br/>singleline = lineplot.mark_line().encode(<br/>   size=alt.condition(~hover, alt.value(0.5), alt.value(3))<br/>)</span></pre><p id="7307" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在可以通过合并第二个和第三个图来生成交互式线图。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="8d90" class="md me it ly b gy mf mg l mh mi">point + singleline</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/f2e32f3514950b7497edf43fae43536a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*CNuX3tuxLqA5h_Od4eIuPg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/ee20c2eb5480d3e286a3b748af8e6282.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*h9zKKu99xsz9J1ZkkrDwNw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="51bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个图像显示了原始或原始的情节。第二张图显示了我悬停在图上时的更新版本。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h2 id="a1a9" class="md me it bd mt mu mv dn mw mx my dp mz li na nb nc lm nd ne nf lq ng nh ni nj bi translated">结论</h2><p id="7865" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">Altair在向可视化添加交互式组件方面非常灵活。一旦你对交互性的元素有了全面的理解，你就可以丰富你的可视化。</p><p id="0053" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>