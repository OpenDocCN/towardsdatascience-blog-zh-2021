<html>
<head>
<title>NHL Equivalency and Prospect Projection Models: Building the NHL Equivalency Model (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NHL等效性和前景预测模型:建立NHL等效性模型(第2部分)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/nhl-equivalency-and-prospect-projection-models-building-the-nhl-equivalency-model-part-2-6f275a45e22?source=collection_archive---------4-----------------------#2021-06-26">https://towardsdatascience.com/nhl-equivalency-and-prospect-projection-models-building-the-nhl-equivalency-model-part-2-6f275a45e22?source=collection_archive---------4-----------------------#2021-06-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b35b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">对已建立的框架进行一些小的更新</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/f107406694ef3c8ba105427d6041f9b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:718/format:webp/1*_6vQm70CZruMSOH_NO7jaw.png"/></div></figure><p id="7992" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在NHL等效性和前景预测模型的第1部分中，我提到了一些NHL之外的评分。如果所有的潜在客户都在同一个联盟，这将是一件容易衡量的事情。如果他们都在为数不多的几个联盟中打球，并且这些联盟足够相似，可以比较他们中的球员，比如组成CHL的3个联盟，那就更好了。我之前提到的分析比较了所有3个CHL联赛中防守球员的得分，并将这些得分率视为相等，我对此没有太大的问题，因为它们都相当相似。</p><p id="8cce" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">然而，并不是所有的前景都来自CHL或直接可比的联盟。以先于米尔科·穆勒一年的圣何塞首轮选秀权托马斯·赫特尔为例:赫特尔在捷克顶级男足联赛捷克Extraliga度过了整个选秀年，38场比赛得到25分(0.66 P/GP)。一个前锋如果在选秀之年的任何一个CHL联赛中以这样的速度得分，可能会在选秀中被完全忽略，或者至少要等到下一轮才能听到自己的名字被叫到。但是赫特尔被选为第17名。与穆勒不同的是，选择赫特尔让圣何塞看起来非常聪明；他在NHL职业生涯中的表现在战争中排名第二，在选秀班中排名第三，在重新选秀中他肯定会比第17名高得多。</p><p id="66fa" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">赫特的高选举人和随后在NHL级别的成功不应该让任何人感到惊讶，因为<strong class="kp ir">他在选秀年的得分率实际上比他的选秀队友中的任何人都好。</strong>他的原始得分率并没有反映出来，因为他在一个很难得分的联盟中打球。</p><p id="1bc4" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我怎么知道赫塔尔在一个更难得分的联赛中打球？仅仅是他和成年人而不是青少年比赛的事实还不足以证实这一点。毕竟，我的啤酒联盟里都是成年人，但一支由OHL最糟糕的青少年组成的球队，如果他们正面交锋，仍然会击败我们最好的球队。虽然常识可能足以告诉我们，捷克的Extraliga比任何CHL联赛都更好<em class="lk"/>，并且Hertl的选秀年得分比CHL前锋的得分更好，但在没有衡量捷克Extraliga和其他联赛有多好的情况下，我们无法准确地说它有多好，或者与其他联赛中得分不同的球员相比。</p><p id="101f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这强调了需要一个等价模型:一个决定世界上任何一个特定联赛中一分的价值的模型。我建立了一个NHL等值(NHLe)模型，以1个NHL点为尺度，这意味着如果一个联盟的NHLe值为0.5，那么该联盟中的一个点相当于0.5个NHL点。</p><p id="5bea" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">“经典”NHLe模型通过直接比较一组球员在一个联盟中的得分与这些球员在NHL中的得分来计算一个联盟中的分数，通常是在同一年或紧接着的一年。在关于这一主题的最早出版作品之一的“<a class="ae lj" href="http://hockeyanalytics.com/Research_files/League_Equivalencies.pdf" rel="noopener ugc nofollow" target="_blank">联赛等值</a>”中，Gabriel Desjardins阐述了他的方法:</p><blockquote class="ll lm ln"><p id="2c33" class="kn ko lk kp b kq kr jr ks kt ku ju kv lo kx ky kz lp lb lc ld lq lf lg lh li ij bi translated">为了确定AHL(或任何其他联盟)的质量，我们可以简单地看看第一年在小联盟和第二年在NHL的每个球员，并比较他们的PPG平均水平。换句话说，相对于NHL的联赛质量是:</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/1caf8e1c70595705db6229a76a5e3f30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*njoz_WD9e073IjXxnloMbA.png"/></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">图片来自Gabriel Desjardins的等效联赛</p></figure><p id="2613" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这种方法本身非常有效，但是有三个问题:</p><ol class=""><li id="ad4c" class="lw lx iq kp b kq kr kt ku kw ly la lz le ma li mb mc md me bi translated">球员在第一年和第二年之间经历的发展被有效地“固化”到模型中，这有利于有更年轻球员的联盟。如果甲A在各方面与乙B完全相同，只是甲A充满了更年轻的球员，那么从甲A引进的NHL在第1年和第2年之间将比乙B经历更多的发展，因此，在第2年得分更多。这将导致该模型错误地指出，甲A联赛更难得分，而实际上只有年轻球员在他们看到NHL之前发展得更好。</li><li id="8d62" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mb mc md me bi translated">使用每个联盟中每场比赛的平均得分会使数据更容易受到极端值的影响，并且没有考虑样本大小。一个只在甲A和NHL打一场比赛的球员和一个在两个联赛都打了82场比赛的球员拥有相同的体重。</li><li id="09c0" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mb mc md me bi translated">这个方法只对下赛季直接产生NHLers的联赛有效。使用这种方法来计算像GTHL U16这样的联赛的NHLe值是不可能的，因为在接下来的赛季中，球员实际上不能参加NHL。此外，虽然少数联盟在接下来的赛季中确实生产NHLers，但其中许多联盟生产的数量如此之少，以至于任何一个方向上的一个异常值都可能严重影响最终的估计。</li></ol><p id="d61f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">当CJ·图尔托罗发表了<a class="ae lj" href="https://cj-turtoro.shinyapps.io/NNHLe-writeup/" rel="noopener ugc nofollow" target="_blank">网络NHLe </a>时，所有这三个问题都在一个地方得到了补救，这是一篇优秀的文章，我推荐你阅读。(<strong class="kp ir">顺便说一句，我对CJ为出版他的第一部作品所付出的努力以及他为我的作品提供的帮助感激不尽。像CJ这样的人不仅拥有帮助他人的智慧和领域知识，还拥有这样做所需的善良和真诚的热情，这使得曲棍球分析社区成为一个不可阻挡的书呆子大军，减少了犯错的频率。)</strong></p><p id="7bca" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">CJ处理第一个问题的方法是只使用同一年在两个联盟打球的球员之间的转换。(我也是这么做的，从来没有认真考虑过使用多年过渡。)</p><p id="2163" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">他处理第二个问题的方法是用联赛总积分除以比赛总积分。</p><p id="c341" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">第三个问题——我认为是三个问题中最大的一个——他用网络方法处理，使用联盟之间的间接路径来确定每个联盟的相对实力。以下示例使用带有精确整数的虚构数据来解释如何计算间接路径:</p><ul class=""><li id="a55e" class="lw lx iq kp b kq kr kt ku kw ly la lz le ma li mk mc md me bi translated">100名球员在同一年参加过甲B联赛。他们在甲A的1000场比赛中共得1000分(1.0 P/GP)，在乙A的1000场比赛中共得500分(0.5 P/GP)。为了确定甲A的“乙B等值”，我们将乙B的场均积分除以甲A的场均积分，算出来就是<code class="fe ml mm mn mo b">0.5/1.0 = 0.5</code>。</li><li id="1dec" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">500名球员在同一年参加过B联赛和NHL联赛。他们在乙级联赛的1000场比赛中共得1000分(1.0 P/GP)，在NHL的1000场比赛中共得200分(0.2 P/GP)。我们遵循上述相同的方法来计算B联赛的NHL当量:<code class="fe ml mm mn mo b">0.2/1.0 = 0.2</code>。</li><li id="bb9e" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">我们知道甲A的“乙B等效值”为0.5，乙B的NHL等效值为0.2。为了确定甲A联赛的NHL等值，我们简单地将这两个数值相乘:<code class="fe ml mm mn mo b">0.5*0.2 = 0.1</code>。<strong class="kp ir">这条路径写明了甲A一分抵0.1 NHL分。</strong></li></ul><p id="8b85" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">没有球员需要在同一个赛季参加过甲A联赛和NHL联赛，这种方法才能奏效。只要在两者之间有一个连接联盟，就可以为联盟a计算NHLe值。</p><p id="e7f8" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">以下是一个真实路径的示例，该路径从KHL开始，并使用AHL作为连接符:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mp"><img src="../Images/4eef443867fe66f0290913dfb2fa80c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4trEfNCi9N32yeOzLTsFrA.png"/></div></div></figure><p id="f38b" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在这种情况下，同一年在KHL和AHL打球的球员在AHL的总得分是在KHL的1.63倍。这意味着KHL的“AHL当量”系数为1.63。与此同时，同年参加NHL的AHL球员在NHL的得分率是他们在AHL得分率的0.38倍。将这两个值相乘得到值0.63，这是该特定路径的KHL的“NHLe”。</p><p id="840a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">然而，并不是所有的道路都只有一个连接联盟。有些路径没有任何功能，但仍然完全有效，例如KHL直接到NHL的路径:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mp"><img src="../Images/1bc1c16ea823348c9f0bf1a9808c550a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b1yUDglfD-6nQ-yZteTr4A.png"/></div></div></figure><p id="d814" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">有些，像从J18 Allsvenskan到NHL的道路，有不止一个连接联盟:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mu"><img src="../Images/7be986b51bf90017e4b8086eb23ed7cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VVYx16T8lLQ2vAIeEoyZnw.png"/></div></div></figure><p id="a58b" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">具有多个连接器的联盟的方法保持不变:计算每个联盟到下一个联盟的转换因子，然后将这些值彼此相乘。在这种情况下，J18 Allsvenskan和Division-1(现在称为HockeyEttan)之间的换算系数为0.34，Division-1和SHL之间的换算系数为0.1，SHL和NHL之间的换算系数为0.33。通过执行<code class="fe ml mm mn mo b">0.34*0.1*0.33 = 0.012</code>将这3个值相乘，结果表明J18 Allsvenskan中一个点的值在NHL中约为0.012点。(请注意，这些值是四舍五入的，如果您用四舍五入的值手动执行这些计算，您将得到稍微不同的结果。)</p><p id="29df" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我到目前为止展示的只是计算<em class="lk">一个</em> <strong class="kp ir"> </strong>路径的方法论。但是与经典NHLe不同，在经典NHLe中，唯一的路径是一条没有连接器的路径，而网络NHLe可以有几十条甚至几百条路径！这引发了更多的问题:</p><ul class=""><li id="6c3d" class="lw lx iq kp b kq kr kt ku kw ly la lz le ma li mk mc md me bi translated">我们如何确定要使用的最佳路径？</li><li id="e70c" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">一旦我们确定了最佳路径，我们应该只使用那一条，还是应该使用多条？如果更多，那么有多少？</li><li id="5c37" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">所有的路径都是有效的吗，或者我们应该排除过渡玩家的样本量很小的路径？</li><li id="6ef9" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">我们是对从每条路径获得的不同等价分数赋予不同的权重，还是对它们进行平均？</li></ul><p id="88b1" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这些问题的答案是我的NHLe与Turtoro不同的地方，tur toro对每个问题都提供了以下答案:</p><ul class=""><li id="f212" class="lw lx iq kp b kq kr kt ku kw ly la lz le ma li mk mc md me bi translated">最上面的路径是连接最少的联盟(他称之为边)。</li><li id="b8bc" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">大约会使用前5条路径。</li><li id="5d1c" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">一条路径必须包含至少10个过渡玩家的实例才有效。</li><li id="1ed6" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">路径按以下公式加权:</li></ul><pre class="kg kh ki kj gt mv mo mw mx aw my bi"><span id="e502" class="mz na iq mo b gy nb nc l nd ne">Weight = 1/2^(Connections) * MinimumInstances</span></pre><p id="3efc" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">其中<strong class="kp ir">连接数</strong>是组成路径的连接数(包括到NHL的最终连接),而<strong class="kp ir">最小实例数</strong>是组成路径中实例的最小转换玩家数。</p><p id="ed11" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这可能看起来有点棘手，因此这里有一个为KHL加权的三条路径的示例:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nf"><img src="../Images/e8bfc993e9e203fde15d963575e154a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wL1pb26qsXFNmPtdEkEhfA.png"/></div></div></figure><ol class=""><li id="d89f" class="lw lx iq kp b kq kr kt ku kw ly la lz le ma li mb mc md me bi translated">这里的第一条路径是KHL-&gt;AHL-&gt;NHL。此路径有两个连接。KHL-&gt;AHL连接有65个转换实例，而AHL-&gt;NHL连接有2，876个。这意味着该路径的任何连接中的最少实例是65，并且该路径的权重的计算是<code class="fe ml mm mn mo b">1/2^(2) * 65 = 16.25</code>。</li><li id="546b" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mb mc md me bi translated">第二条道路是KHL-&gt; NHL。这个路径有一个与26个转换实例的连接，计算是<code class="fe ml mm mn mo b">1/2^(1) * 26 = 13</code>。</li><li id="5675" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mb mc md me bi translated">第三条路径是KHL-&gt;白俄罗斯-&gt;WJC-20-&gt;NHL。这条路有三个连接点。KHL-&gt;白俄罗斯连接有130个实例，白俄罗斯-&gt;WJC-20连接有75个，WJC-20-&gt;NHL连接有56个，这意味着此路径的最小实例是56个。这条路径的权重的计算是<code class="fe ml mm mn mo b">1/2^(3) * 56 = 7</code>。</li></ol><p id="4eef" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">有了每条路径的NHLe值和权重，计算联盟最终值的过程就变得非常简单:将每个NHLe值乘以其路径的权重，取这些输出的总和，然后除以权重的总和。在这种情况下，计算是<code class="fe ml mm mn mo b">((0.63*16.25)+(0.83*13)+(0.85*7))/(16.25 + 13 + 7) = 26.98/36.25 = 0.74</code>。如果我们只使用这三条路径，KHL的最终NHLe将是0.74。</p><p id="77f9" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我认为CJ对这些问题的每一个回答都有坚实的理论基础。如果我是从零开始，我可能会以不同的方式回答这些问题，但我在这里的目标不仅仅是复制CJ的流程，并做出一些武断的决定来改变我不喜欢的东西。我的目标是将这些对我来说都有意义的问题的一组潜在答案放在一起，然后将这些答案中的每一个与另一个和CJ的答案进行测试，希望为建立网络NHLe模型确定一组最佳的建模参数。以下是我决定测试的不同参数集，作为每个问题的答案:</p><h2 id="d6e0" class="mz na iq bd ng nh ni dn nj nk nl dp nm kw nn no np la nq nr ns le nt nu nv nw bi translated">用于确定最佳路径:</h2><ul class=""><li id="12ff" class="lw lx iq kp b kq nx kt ny kw nz la oa le ob li mk mc md me bi translated">根据上面列出的加权等式，选择具有最高权重的路径。</li><li id="0f41" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">选择具有最少连接联盟的路径，根据加权等式使用最高权重作为平局决胜。</li><li id="6e2c" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">在所有连接中选择实例数量最少的路径。</li></ul><h2 id="801a" class="mz na iq bd ng nh ni dn nj nk nl dp nm kw nn no np la nq nr ns le nt nu nv nw bi translated">要确定要使用的路径数量:</h2><ul class=""><li id="0f6c" class="lw lx iq kp b kq nx kt ny kw nz la oa le ob li mk mc md me bi translated">通过选择最多前15条最佳路径，测试仅选择一条最佳路径。</li></ul><h2 id="6a3d" class="mz na iq bd ng nh ni dn nj nk nl dp nm kw nn no np la nq nr ns le nt nu nv nw bi translated">根据样本大小排除路径:</h2><ul class=""><li id="a7f2" class="lw lx iq kp b kq nx kt ny kw nz la oa le ob li mk mc md me bi translated">通过选择至少15个实例的路径，测试选择至少1个实例的路径。</li></ul><h2 id="a849" class="mz na iq bd ng nh ni dn nj nk nl dp nm kw nn no np la nq nr ns le nt nu nv nw bi translated">为了对每条路径进行加权:</h2><ul class=""><li id="a4db" class="lw lx iq kp b kq nx kt ny kw nz la oa le ob li mk mc md me bi translated">我只是坚持使用CJ的加权公式。我简单地尝试了几种不同的方法，但是他的方法在初步测试中表现得更好，而且太有意义了。</li></ul><p id="bae7" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">此外，我选择测试3个其他参数:</p><ol class=""><li id="9cfa" class="lw lx iq kp b kq kr kt ku kw ly la lz le ma li mb mc md me bi translated">包括U20和U18世界青年锦标赛。</li><li id="376b" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mb mc md me bi translated">改变两个联赛之间转换系数的计算方法。我测试了CJ使用各联赛得分全额总和的方法，Desjardins使用各联赛场均分均值的方法，以及我自己使用各联赛场均分中位数的方法(CJ建议)。</li><li id="5dd2" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mb mc md me bi translated">在为一个联盟创建新路径之前，删除该联盟中的第一个连接联盟。例如，如果使用了KHL-&gt;AHL-&gt;NHL路径，则从该点开始，KHL的所有其他路径都不能使用AHL作为第一个连接。(这条规则的最初实施实际上是由于我误解了CJ的方法论而造成的意外，但我最终将它作为一个测试参数，因为我认为对于一个给定的联盟来说，不要过于看重任何一种直接关系可能更好。)</li></ol><p id="d778" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">有了一组我认为适合构建最终模型的参数，是时候测试每一个参数并确定最佳参数了。我决定我的测试的目标将是最小化所有转换联盟的玩家的每场预测点数和每场实际点数之间的平均绝对误差。基于每个联盟的NHLe值和两个联盟的第一个中的每场比赛的点数来计算每场比赛的预测点数，其中NHLe值是在用给定的一组参数建立模型之后获得的那些。</p><p id="d65d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我知道我只是向你扔了一个单词沙拉，但是测试过程其实挺简单的；我将使用Melker Karlsson在2010年的例子来分解它:</p><ul class=""><li id="f9e2" class="lw lx iq kp b kq kr kt ku kw ly la lz le ma li mk mc md me bi translated">本赛季，梅尔克在superelit的27场比赛得到35分(1.3 P/GP)，在SHL的36场比赛得到2分(0.06 P/GP)。</li><li id="43ab" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">如果从一组给定的试验参数中获得的NHLe模型表明SHL的NHLe值为0.53，superelit的值为0.08，那么我们可以通过执行<code class="fe ml mm mn mo b">0.08/0.53 = 0.15</code>获得从superelit到SHL的转换系数。</li><li id="3ab2" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">然后，我们将转换系数乘以他在superelit中的得分率，并执行<code class="fe ml mm mn mo b">0.15*1.3 = 0.2</code>，这将给出他在SHL中的预计得分率。他在SHL中的实际得分率是0.06，0.06和他的预计得分率0.2之间的差的绝对值是0.14，这将是该特定过渡获得的误差。</li><li id="d968" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">然后，我们将使用他在SHL中的得分重复这一过程，以预测他在super lit中的得分，执行<code class="fe ml mm mn mo b">0.53/0.08 = 6.625</code>以获得从SHL到super lit的转换系数，然后执行<code class="fe ml mm mn mo b">6.625 * 0.06 = 0.4</code>以获得他在super lit中的预测得分率。</li><li id="44c8" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">由于他在superelit的实际得分率是1.3 P/GP，这个值和他预测的得分率0.4之间的误差将是0.9。总之，这一个转换会给我们两个误差值:0.14和0.9。</li><li id="34cc" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">给定NHLe模型的平均绝对误差是从过渡联盟的玩家获得的每个误差值的平均值。</li></ul><p id="7062" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我用来运行这些测试和建立我的模型的数据集是所有在我从2005-2006年到2019-2020年的任何一个赛季中使用的124个联赛中的任何两个或更多个联赛中至少打了5场比赛的运动员，2012-2013年除外。(2012-2013年被完全删除，因为NHL停摆导致全球竞争质量发生了变化。)我不能简单地在我的整个数据集上使用这些参数集训练我的NHLe模型一次，然后在相同的数据上测试它，但是，因为我的目标不是找到能够最好地预测已经发生的事情的确切参数集；我的目标是建立一个模型，它能最好地预测样本外的得分。训练它这样做的方法是“练习”预测样本外得分。我通过将我的数据集随机分成五份并进行五重交叉验证来做到这一点。</p></div><div class="ab cl oc od hu oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="ij ik il im in"><p id="116c" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">五重交叉验证可能听起来令人生畏，但也没那么可怕。首先，训练集由数据集中4/5的联盟对组成，测试集包含另外1/5的球员对。对于输入的每一组参数，NHLe模型都是在训练集上建立的，然后在测试集上进行测试。然后，使用其他组的训练集和测试集再重复这个过程四次，从而为每组参数产生五个不同的测试值。(注意，测试/训练集没有重叠；每个单个玩家配对在一个测试集中出现一次，而在其他四个测试集中没有出现，并且相同的玩家配对在其他四个训练集中出现一次，而在相应的测试集中没有出现。)下面是一个有五个假玩家的交叉折叠验证的例子，其中红色突出显示引用测试集，绿色突出显示引用训练集:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/c42c3a4a4518096c9649507a3f5221de.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*cy9K09ggkD1V4OdwYVkXWw.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/60f7c28428037f3cf3b5b1ffa4d8f7d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*mFMDOr7nwnWiIOZg-hIGXQ.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/a5f1217ba3bb98a09a9c2c9f81018cc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*H3Ury-P4hAJCpzOh2QtVYA.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/267c6f417c883b10646910567c92521f.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*Vg55lyup3M8R5XkCmEa4UQ.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/d8f194f6df5fc66c3a8f3461d57ba819.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*XmRc97euSMilSytn8F8dsg.png"/></div></figure><p id="18ea" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">使用每一组可能的参数对每个折叠进行交叉验证，以在训练集上建立模型，并在测试集上对其进行测试。在完成所有5个折叠的交叉验证后，获得每组参数的平均测试值。具有最佳平均测试值(在这种情况下，最低平均绝对误差)的参数集被认为是构建NHLe模型的最佳参数集。</p><p id="b4a5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我的5重交叉验证的结果确定了以下一组最佳参数:</p><ul class=""><li id="a329" class="lw lx iq kp b kq kr kt ku kw ly la lz le ma li mk mc md me bi translated">可用的顶部路径将是具有最少边的路径，如果两条路径具有相同数量的边，则总权重被用作平局决胜符。</li><li id="e126" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">联盟将使用最多前11条路径。</li><li id="4c46" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">至少有8个过渡玩家实例的路径是有效的；所有其他的都将被丢弃。</li><li id="6415" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">世界青年队(U18和U20)都将被使用。</li><li id="5ac5" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">积分总和将除以每个联赛的比赛总和，以确定两个联赛之间的转换系数。</li><li id="9765" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">在创建任何进一步的路径之前，第一个连接联盟将被永久删除。</li></ul><p id="f7da" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这五次折叠的平均绝对误差的平均值为0.33。(我也计算了R，也是0.33，但选择不将其作为训练的目标参数。)</p><p id="66af" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">设置好这些参数后，这一次是时候使用整个数据集构建模型了。以下是最终NHLe模型的每个联赛的同等分数:</p><pre class="kg kh ki kj gt mv mo mw mx aw my bi"><span id="16e1" class="mz na iq mo b gy nb nc l nd ne">╔══════════════════╦═══════╗<br/>║      League      ║ NHLe  ║<br/>╠══════════════════╬═══════╣<br/>║ NHL              ║     1 ║<br/>║ KHL              ║ 0.772 ║<br/>║ Czech            ║ 0.583 ║<br/>║ SHL              ║ 0.566 ║<br/>║ NLA              ║ 0.459 ║<br/>║ Liiga            ║ 0.441 ║<br/>║ AHL              ║ 0.389 ║<br/>║ DEL              ║ 0.352 ║<br/>║ Allsvenskan      ║ 0.351 ║<br/>║ VHL              ║ 0.328 ║<br/>║ Slovakia         ║ 0.295 ║<br/>║ EBEL             ║ 0.269 ║<br/>║ WJC-20           ║ 0.269 ║<br/>║ France           ║ 0.250 ║<br/>║ Belarus          ║ 0.242 ║<br/>║ Czech2           ║ 0.240 ║<br/>║ EIHL             ║ 0.235 ║<br/>║ LNAH             ║ 0.232 ║<br/>║ DEL2             ║ 0.205 ║<br/>║ Kazakhstan       ║ 0.201 ║<br/>║ NCAA             ║ 0.194 ║<br/>║ Denmark          ║ 0.190 ║<br/>║ Mestis           ║ 0.178 ║<br/>║ NLB              ║ 0.176 ║<br/>║ Italy            ║ 0.176 ║<br/>║ Norway           ║ 0.173 ║<br/>║ ECHL             ║ 0.147 ║<br/>║ OHL              ║ 0.144 ║<br/>║ MHL              ║ 0.143 ║<br/>║ USHL             ║ 0.143 ║<br/>║ WHL              ║ 0.141 ║<br/>║ Poland           ║ 0.135 ║<br/>║ WJC-18           ║ 0.135 ║<br/>║ Russia3          ║ 0.135 ║<br/>║ Usports          ║ 0.125 ║<br/>║ USDP             ║ 0.121 ║<br/>║ QMJHL            ║ 0.113 ║<br/>║ Division-1       ║ 0.109 ║<br/>║ Czech3           ║ 0.104 ║<br/>║ Erste-Liga       ║ 0.103 ║<br/>║ Slovakia2        ║ 0.102 ║<br/>║ Romania          ║ 0.099 ║<br/>║ Superelit        ║ 0.091 ║<br/>║ NAHL             ║ 0.087 ║<br/>║ Germany3         ║ 0.085 ║<br/>║ ALPSHL           ║ 0.084 ║<br/>║ U20 SM-Liiga     ║ 0.083 ║<br/>║ BCHL             ║ 0.080 ║<br/>║ NMHL             ║ 0.076 ║<br/>║ Czech-U20        ║ 0.074 ║<br/>║ AJHL             ║ 0.062 ║<br/>║ EJHL             ║ 0.060 ║<br/>║ Czech U19        ║ 0.059 ║<br/>║ SwissDiv1        ║ 0.054 ║<br/>║ Belarus-Vysshaya ║ 0.052 ║<br/>║ SJHL             ║ 0.052 ║<br/>║ U20-Elit         ║ 0.049 ║<br/>║ CCHL             ║ 0.048 ║<br/>║ MJHL             ║ 0.046 ║<br/>║ USPHL-Premier    ║ 0.046 ║<br/>║ Slovakia-U20     ║ 0.044 ║<br/>║ Russia-U17       ║ 0.044 ║<br/>║ USPHL-18U        ║ 0.041 ║<br/>║ U18 SM-Sarja     ║ 0.040 ║<br/>║ NAPHL-18U        ║ 0.039 ║<br/>║ Czech U18        ║ 0.038 ║<br/>║ J18 Allsvenskan  ║ 0.038 ║<br/>║ Division-2       ║ 0.038 ║<br/>║ MJAHL            ║ 0.037 ║<br/>║ QJAAAHL          ║ 0.036 ║<br/>║ MPHL             ║ 0.035 ║<br/>║ OJHL             ║ 0.034 ║<br/>║ HPHL-16U         ║ 0.034 ║<br/>║ Slovenia         ║ 0.033 ║<br/>║ Russia-U18       ║ 0.032 ║<br/>║ 16U-AAA          ║ 0.031 ║<br/>║ J18-Elit         ║ 0.029 ║<br/>║ USHS-Prep        ║ 0.028 ║<br/>║ QMAAA            ║ 0.028 ║<br/>║ CISAA            ║ 0.027 ║<br/>║ Norway2          ║ 0.027 ║<br/>║ USPHL-16U        ║ 0.027 ║<br/>║ GOJHL            ║ 0.027 ║<br/>║ AYHL-16U         ║ 0.026 ║<br/>║ Russia-U16       ║ 0.025 ║<br/>║ J20-Elit         ║ 0.024 ║<br/>║ USHS-MN          ║ 0.024 ║<br/>║ DNL              ║ 0.024 ║<br/>║ Denmark2         ║ 0.023 ║<br/>║ VIJHL            ║ 0.021 ║<br/>║ NOJHL            ║ 0.021 ║<br/>║ Slovakia-U18     ║ 0.020 ║<br/>║ CAHS             ║ 0.020 ║<br/>║ AMHL             ║ 0.020 ║<br/>║ PIJHL            ║ 0.020 ║<br/>║ KIJHL            ║ 0.020 ║<br/>║ U17-Elit         ║ 0.018 ║<br/>║ II-DivisioonA    ║ 0.018 ║<br/>║ U20-Top          ║ 0.017 ║<br/>║ BCMML            ║ 0.016 ║<br/>║ U16 SM-Sarja     ║ 0.015 ║<br/>║ NSMMHL           ║ 0.015 ║<br/>║ Czech U16        ║ 0.014 ║<br/>║ Denmark-U20      ║ 0.013 ║<br/>║ MMHL             ║ 0.013 ║<br/>║ U16 SM-Sarja-Q   ║ 0.012 ║<br/>║ GTHL-U16         ║ 0.012 ║<br/>║ J20-Div.1        ║ 0.011 ║<br/>║ U16-SM           ║ 0.011 ║<br/>║ U16-ELIT         ║ 0.010 ║<br/>║ Alliance-U16     ║ 0.009 ║<br/>║ GTHL-U18         ║ 0.008 ║<br/>║ J18-Div.1        ║ 0.008 ║<br/>║ Division-4       ║ 0.008 ║<br/>║ QMEAA            ║ 0.007 ║<br/>║ J20-Div.2        ║ 0.007 ║<br/>║ Denmark-U17      ║ 0.006 ║<br/>║ U16-Div.1        ║ 0.005 ║<br/>║ J18-Div.2        ║ 0.005 ║<br/>║ ETAHL U18        ║ 0.005 ║<br/>║ AMMHL            ║ 0.005 ║<br/>║ QBAAA            ║ 0.004 ║<br/>║ AMBHL            ║ 0.002 ║<br/>║ U16-Div.2        ║ 0.002 ║<br/>╚══════════════════╩═══════╝</span></pre><p id="1195" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">请注意，其中一些联盟与其他联盟合并。例如，在KHL出现之前，在EliteProspects数据库中有一个名为“俄国”的联盟，实际上就是KHL；我只是把这两个合并成了KHL。“俄罗斯2”和VHL以及另外一两个联赛也是如此。</p></div><div class="ab cl oc od hu oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="ij ik il im in"><p id="308b" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">当我提到2013年鲨鱼队选中米尔科·穆勒时，我从未看过他打球时，我暗示了这一点，但让我非常明确地说:<strong class="kp ir">我是</strong> <strong class="kp ir">而不是一个有前景的人</strong>。我一生都是鲨鱼队的球迷，十多年来我一直密切关注NHL，但我从来没有密切关注过任何其他联盟，这意味着我不太清楚T4应该是什么样子。我缺乏潜在客户领域的专业知识，这带来了一些好处和坏处:</p><ul class=""><li id="8501" class="lw lx iq kp b kq kr kt ku kw ly la lz le ma li mk mc md me bi translated">我对某些联赛没有任何先入为主的想法，所以在建立模型的时候我不会去确认任何偏见。</li><li id="65d1" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated">不利因素:如果不知道事情应该是怎样的，我就很难识别代码中的bug和错误，然后在我成功的时候排除并修复它们。这个问题主要与我花费的时间有关，因为据我所知，最终的模型是没有错误的。</li><li id="c62b" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated"><strong class="kp ir">赞成:</strong>我知道这个模型不仅可能非常糟糕，而且如果是这样的话，我将无法用肉眼识别，这促使我采取高度稳健的数学方法来确保这个模型是合理的好模型。</li><li id="618b" class="lw lx iq kp b kq mf kt mg kw mh la mi le mj li mk mc md me bi translated"><strong class="kp ir">反对意见:</strong>我很难理解和表达我工作的局限性，尤其是从实践的角度来看。例如，我可以查看我的战争模型的输出，并说“这高估了米科·兰塔宁，低估了内森·麦金农，因为它通常高估了像这样的双人组的终结者，我已经看了足够多的比赛，知道麦金农远远更胜一筹。”我很难表达(甚至理解)为什么我的NHLe模型高估了欧洲男子联赛，低估了青年联赛，尽管这是我的总体印象。</li></ul><p id="ab08" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">最后，我在这里做了大量的工作，只是对CJ的NHLe模型做了一些我认为是微不足道的升级，他自己说“比原始版本(经典NHLe)精确得可以忽略不计。”我对此很满意，因为我在这个过程中学到了很多，在确认CJ已经做了几乎所有正确的事情后，我现在对这个模型更有信心了。虽然还可以做更多的事情来改进这项工作，并建立一个更好的模型，但我认为公平地说，我们很可能已经达到了收益递减的点。</p><p id="1b3f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我对以后重新访问NHLe框架持开放态度，我建议任何对如何改进我的工作有想法的人都来试试。但现在，我对我建立的模型很满意，我有信心用它来比较不同联盟的两个潜在客户的得分率。</p><p id="7d72" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">下一步，我将在第3部分中介绍，使用这些得分率来预测未来在NHL级别的成功。</p></div></div>    
</body>
</html>