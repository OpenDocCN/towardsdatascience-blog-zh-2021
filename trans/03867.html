<html>
<head>
<title>Why ML should be written as pipelines from the get-go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么ML应该从一开始就写成管道</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/why-ml-should-be-written-as-pipelines-from-the-get-go-b2d95003f998?source=collection_archive---------14-----------------------#2021-03-31">https://towardsdatascience.com/why-ml-should-be-written-as-pipelines-from-the-get-go-b2d95003f998?source=collection_archive---------14-----------------------#2021-03-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="05bb" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">MLOps</h2><div class=""/><div class=""><h2 id="26d0" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">通过迭代、可复制的管道消除技术债务</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/f49121fa5be0d9af1930cbb27d4486a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rwwyYm2y5W16LFC5"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@xoforoct?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">EJ·斯特拉特</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="18e5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">今天，机器学习为世界上最有价值的1%的组织(FB、ALPH、AMZ等)提供动力。然而，99%的企业努力生产ML，即使拥有超特定数据集和卓越的数据科学部门。</p><p id="0fd5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">更深入地研究ML如何在组织中传播会更深入地揭示这个问题。下图显示了机器学习的典型设置的公认简化表示:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mb"><img src="../Images/40f8d1b67f9f07294b11f0c7328d5cf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0lWL-rCF5yQnwsWJrlWgGQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图1:为什么很难复制ML模型</p></figure><p id="ba5c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">上述过程有三个阶段:</p><h2 id="42f7" class="mc md iq bd me mf mg dn mh mi mj dp mk lo ml mm mn ls mo mp mq lw mr ms mt iw bi translated">实验和概念验证:</h2><ul class=""><li id="6e26" class="mu mv iq lh b li mw ll mx lo my ls mz lw na ma nb nc nd ne bi translated"><strong class="lh ja">技术</strong> : Jupyter笔记本、Python脚本、实验跟踪工具、数据探索工具</li><li id="321a" class="mu mv iq lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated"><strong class="lh ja">角色</strong>:数据科学家</li><li id="4b80" class="mu mv iq lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated"><strong class="lh ja">描述</strong>:快速科学的实验定义了这个阶段。该团队希望尽快增加他们对数据和机器学习目标的理解。</li></ul><h2 id="8ea2" class="mc md iq bd me mf mg dn mh mi mj dp mk lo ml mm mn ls mo mp mq lw mr ms mt iw bi translated">转换:</h2><ul class=""><li id="f720" class="mu mv iq lh b li mw ll mx lo my ls mz lw na ma nb nc nd ne bi translated"><strong class="lh ja">技术</strong> : ETL流水线工具，如Airflow</li><li id="2424" class="mu mv iq lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated"><strong class="lh ja">角色</strong>:数据工程师</li><li id="0aee" class="mu mv iq lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated"><strong class="lh ja">描述</strong>:将最终实验转化为自动化的、可重复的过程是本规范的目的。有时这在下一阶段之前开始，有时在下一阶段之后，但本质是相同的——从数据科学家那里获取代码，并尝试将它们放入某种形式的自动化框架中。</li></ul><h2 id="d04a" class="mc md iq bd me mf mg dn mh mi mj dp mk lo ml mm mn ls mo mp mq lw mr ms mt iw bi translated">生产和维护:</h2><ul class=""><li id="8850" class="mu mv iq lh b li mw ll mx lo my ls mz lw na ma nb nc nd ne bi translated"><strong class="lh ja">技术</strong> : Flask/FastAPI，Kubernetes，Docker，<a class="ae le" href="http://cortex.dev/" rel="noopener ugc nofollow" target="_blank"> Cortex </a>，<a class="ae le" href="https://www.seldon.io/" rel="noopener ugc nofollow" target="_blank"> Seldon </a></li><li id="b2fc" class="mu mv iq lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated"><strong class="lh ja">角色</strong> : ML工程师/运营</li><li id="891d" class="mu mv iq lh b li nf ll ng lo nh ls ni lw nj ma nb nc nd ne bi translated"><strong class="lh ja">描述</strong>:这是从模型部署开始的阶段，跨越监控、再培训和维护。这一阶段的核心重点是保持模型健康，并在任何规模下提供服务，同时考虑漂移。</li></ul><p id="856c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">每个阶段都需要不同的技能、工具和组织。所以，一个组织一路走来能碰到的坑坑洼洼也是理所当然的。不可避免的是，下游重要的东西在早期阶段没有被考虑。例如，如果培训与部署策略相分离，那么这在生产场景中就永远不会有好的表现——导致不一致、无声的失败以及最终失败的模型部署。</p><h1 id="0089" class="nk md iq bd me nl nm nn mh no np nq mk kf nr kg mn ki ns kj mq kl nt km mt nu bi translated">解决方案</h1><p id="0024" class="pw-post-body-paragraph lf lg iq lh b li mw ka lk ll mx kd ln lo nv lq lr ls nw lu lv lw nx ly lz ma ij bi translated">查看上面图1中的多阶段过程，简单地减少所涉及的步骤并因此消除它们之间存在的摩擦似乎是显而易见的。然而，考虑到每个步骤的不同需求和技能，这说起来容易做起来难。数据科学家没有被训练或装备来勤奋地关心生产概念，如再现性——他们被训练来迭代和实验。他们并不真正关心代码质量，考虑到速度和开销之间的权衡，在早期过分努力地执行这些标准可能不符合公司的最佳利益。</p><p id="f641" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">因此，我们需要的是一个框架的实现，它是<strong class="lh ja">灵活的，但是从一开始就执行生产标准</strong>。实现这一点的一种非常自然的方式是通过某种形式的管道框架，该框架公开了一种在受控环境中运行ML实验的自动化、标准化的方式。ML本质上是一个过程，可以分解为单独的具体步骤(如预处理、训练、评估等)，因此管道是一个很好的解决方案。至关重要的是，通过在早期阶段标准化这些管道的开发，组织可以通过多种工具和步骤减少ML模型的破坏/重建周期，并加快从研究到部署的速度。</p><p id="e067" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果一个组织能够激励他们的数据科学家购买这样一个框架，<strong class="lh ja">，那么他们就已经赢得了生产化之战的一半。然而，真正的问题在于细节——如何在一个足够健壮的框架中为数据科学家提供他们进行实验所需的灵活性，以便一直应用到生产中？</strong></p><h1 id="78c5" class="nk md iq bd me nl nm nn mh no np nq mk kf nr kg mn ki ns kj mq kl nt km mt nu bi translated">寻找正确抽象的练习</h1><p id="ca42" class="pw-post-body-paragraph lf lg iq lh b li mw ka lk ll mx kd ln lo nv lq lr ls nw lu lv lw nx ly lz ma ij bi translated">从一开始就有了在管道中写作的动机，公平地说，我给出了关于如何实现这一点的框架的更具体的例子。然而，在我看来，目前的工具领域被分割成了许多框架，这些框架要么是为ML人员设计的ML工具，要么是为Ops人员设计的Ops工具，并没有真正满足我在上一节提到的所有要求。缺少的是一个面向ML人员的Ops(读取管道)工具，带有适合数据科学家的高阶抽象。</p><p id="422d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">为了理解这一点的重要性，我们可以看看web开发是如何从基于PHP/JQuery的原始脚本(web开发的Jupyter笔记本)和LAMP堆栈发展到今天强大的基于React/Angular/Vue的现代web开发堆栈的。看看这些现代框架，它们的成功是由提供更高阶的抽象决定的，这些抽象更容易被更多的受众消费和消化。它们没有改变底层web技术工作的基本原理。他们只是以一种更容易被更多的观众理解和接受的方式改变了它的用途。具体来说，通过将<em class="ny">组件</em>作为一等公民提供，这些框架引入了一种分解、利用和重新共享为现代网络提供动力的HTML和Javascript的新机制。然而，ML(Ops)并没有相应的动作来找出正确的抽象顺序，以达到类似的效果。</p><p id="1028" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">为了展示我上面更抽象的想法的一个更具体的例子，我将使用<a class="ae le" href="https://github.com/maiot-io/zenml" rel="noopener ugc nofollow" target="_blank"> ZenML </a>，一个开源的MLOps框架来创建迭代的、可复制的管道。</p><blockquote class="nz oa ob"><p id="b38f" class="lf lg ny lh b li lj ka lk ll lm kd ln oc lp lq lr od lt lu lv oe lx ly lz ma ij bi translated">声明:我是ZenML的核心维护者之一。</p></blockquote><p id="62da" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">ZenML是一个为ML寻找正确抽象层的练习。在这里，我们将<em class="ny">管道视为一等公民。</em>这意味着数据科学家直接接触框架中的管道，但与来自ETL空间的数据管道的方式不同(<a class="ae le" href="https://www.prefect.io/" rel="noopener ugc nofollow" target="_blank"> Prefect </a>、<a class="ae le" href="https://airflow.apache.org/" rel="noopener ugc nofollow" target="_blank"> Airflow </a>等)。管道被视为<em class="ny">实验— </em>意味着它们可以被直接比较和分析。只有到了转向生产化的时候，它们才能转换成经典的数据管道。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mb"><img src="../Images/353954e9cf08478d250dea366aa69a82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NGiwUYBznCQXQw1g"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图2: ZenML用熟悉的语言抽象管道来增加模型部署的所有权。</p></figure><p id="923c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">管道中有步骤，这些步骤是用数据科学家熟悉的ML语言抽象出来的。例如有<code class="fe of og oh oi b">TokenizerStep</code>、<code class="fe of og oh oi b">TrainerStep</code>、<code class="fe of og oh oi b">EvaluatorStep</code>等等。比将脚本插入某种形式的orchestrator包装器更容易理解的范例。</p><p id="1ac1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">每个管道运行都会跟踪元数据和参数，并且可以与其他运行进行比较。每个管道的数据在流经时都会自动进行版本控制和跟踪。每次运行都链接到git提交，并编译成一个易于阅读的YAML文件，该文件可以选择性地编译成其他DSL，例如Airflow或Kubeflow管道。这对于满足价值链中的数据工程师和ML工程师等其他利益相关者是必要的。</p><p id="ea17" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">此外，为各个步骤公开的接口大多是以一种易于以幂等方式扩展的方式设置的，因此也是一种分布式方式。因此，当数据科学家处理更大的数据集时，他们可以使用不同的处理后端(如数据流/火花)进行横向扩展。</p><p id="059a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">总而言之，ZenML试图达到以下场景:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mb"><img src="../Images/c7685ca47b6de0a4a849722daea5df28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WfjO5QzcLLyD2g4HifhkBg.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图3: ZenML统一了ML过程。</p></figure><p id="0779" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">当然，ZenML并不是实现上述目标的唯一机制——许多公司构建了自己的抽象框架来解决他们的特定需求。通常这些都是建立在我上面提到的一些其他工具之上的。不管如何实现，目标应该是明确的:让数据科学家<strong class="lh ja">尽可能接近生产</strong>并尽可能减少摩擦，激励他们在部署后增加对模型的所有权。</p><p id="8e44" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这是一个双赢的局面，对于任何一个将ML作为业务增长核心驱动力的组织来说都是一个巨大的胜利。</p><h1 id="ab62" class="nk md iq bd me nl nm nn mh no np nq mk kf nr kg mn ki ns kj mq kl nt km mt nu bi translated">插头</h1><p id="b9b3" class="pw-post-body-paragraph lf lg iq lh b li mw ka lk ll mx kd ln lo nv lq lr ls nw lu lv lw nx ly lz ma ij bi translated">如果你喜欢这里的想法，我们很乐意听到你对ZenML的反馈。这是<a class="ae le" href="https://github.com/maiot-io/zenml" rel="noopener ugc nofollow" target="_blank">开源</a>，我们正在寻找早期采用者和<a class="ae le" href="https://github.com/maiot-io/zenml" rel="noopener ugc nofollow" target="_blank">贡献者</a>！如果您发现这是适合您/您的数据科学家的抽象顺序，那么也请通过我们的<a class="ae le" href="http://zenml.io/slack-invite" rel="noopener ugc nofollow" target="_blank"> Slack </a>告诉我们，期待您的回复！</p></div></div>    
</body>
</html>