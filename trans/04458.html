<html>
<head>
<title>How to analyse A/B experiments using bayesian “expected loss”</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用贝叶斯“期望损失”分析A/B实验</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-analyse-a-b-experiments-using-bayesian-expected-loss-b959e21a77ce?source=collection_archive---------10-----------------------#2021-04-16">https://towardsdatascience.com/how-to-analyse-a-b-experiments-using-bayesian-expected-loss-b959e21a77ce?source=collection_archive---------10-----------------------#2021-04-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8eb3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何为你的实验计算贝叶斯预期损失指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cb18ada47795ee5bbe1ce21a15935315.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iqUZbnRlkDqS7E7TV6mbFg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由<a class="ae kv" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2860753" rel="noopener ugc nofollow" target="_blank">皮克斯拜</a>的<a class="ae kv" href="https://pixabay.com/users/6689062-6689062/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2860753" rel="noopener ugc nofollow" target="_blank">大卫·施瓦森伯格</a>拍摄</p></figure><p id="37e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们想象一下，我们已经进行了<strong class="ky ir"> A/B实验</strong>四周了。我们现在要做一个决定:变异是赢家还是输家？我们对这个决定有多大把握？</p><p id="0737" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了帮助回答这个问题，下面是我们假想实验的结果。它比较了一段时间内累积跟踪的两个变异组的转换率:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/b486b474791eac96f319b9925ce79124.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eZ_Km1UIU1PQcc3t39Z-7A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。奖励的故事。随时间绘制的累积“转换率”。越高越好。</p></figure><p id="f119" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的线形图显示了我们两个变量的累积转换率。对照组的转化率稍高。这是过去三周的情况。</p><p id="87bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个结果的总体<strong class="ky ir"> <em class="lt">贝叶斯概率</em> </strong>为<em class="lt"> 89.9%。</em>这刚好低于我们公司通常接受的阈值(~90%)。如果你用频率主义者的术语来说，你可以认为这是统计学意义的水平。</p><p id="1205" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">实验本身的一些背景:我们使用这个测试来<strong class="ky ir">降低一个重要特性</strong>发布的风险。这里的“赢”是可取的，但不是必要的。同时，一个“平坦”的结果是可以接受的。“损失”是我们最想避免的。</p><p id="8365" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">总的来说，基于以上观点，我们可以看出这个实验有<em class="lt">可能</em>会“失败”，但我们不能完全确定。</p><p id="d73f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是许多实验中常见的情况。需要做一个决定，但是结果还不清楚，所以要满怀信心地去做。在这种情况下通常会发生的是，实验继续运行，希望通过更多的流量获得更大的确定性。</p><p id="ea62" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所有这一切的发生是因为上面的视图是我们实验的一个不完整的图片。上面的视图代表运行这个测试的<strong class="ky ir">奖励</strong>(或者在这个例子中没有奖励)。这里缺少的是帮助我们做决定的<strong class="ky ir">风险</strong>的观点。</p><p id="1258" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我在之前的一篇文章中写过<a class="ae kv" rel="noopener" target="_blank" href="/what-comics-can-teach-us-a-b-experiment-analysis-c1ba70e50d0c">预期损失。由</a><a class="ae kv" href="https://vwo.com/downloads/VWO_SmartStats_technical_whitepaper.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">克里斯·斯图基奥</strong> </a> <strong class="ky ir">为VWO开发的预期损失</strong>代表了选择一个实验变量而非另一个的风险。你可以在他的白皮书中找到更多相关信息。</p><p id="75b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但本质上，风险越低越好。如果我们绘制选择一个变量而不是另一个变量的累积预期损失，我们的实验看起来像这样:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lu"><img src="../Images/4ba578c39d1489ce73a906418da9c00a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QvXbhjpjlcHaRTuW93-VCQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。风险的故事。随着时间的推移绘制的累积“预期损失”。越低越好。</p></figure><p id="e5a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到，选择变体的相对“成本”是0.75%。这在财务上意味着什么取决于被测试的流量和段。这也将因公司而异。</p><p id="6408" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lt">例如，0.75%对于一些高流量的大公司来说可能是一个决定性因素。</em></p><p id="1b84" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在回顾这个线图，我们可以看到这些线看起来足够稳定，可以接受这个“风险”的观点。所以现在，出现了一个商业决策:推出这个特性的需要是否超过了风险？</p><p id="886a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们已经给了决策者足够的信息来做决定。我们也可以根据紧急程度在第三周做出这个决定。在显示<strong class="ky ir">风险</strong>的同时显示<strong class="ky ir">回报</strong>是讲述我们实验的数据故事的一种非常强大的方式。</p><h1 id="eb8e" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">计算预期损失</h1><p id="8ba3" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf mp lh li lj mq ll lm ln mr lp lq lr ij bi translated">那么，我们如何计算预期损失呢？让我们更深入地看看，使用一个可信赖的<a class="ae kv" href="https://jupyter.org/" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本</a>并测试我们的<a class="ae kv" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> Python 3 </a>技能！</p><h2 id="f7dc" class="ms lw iq bd lx mt mu dn mb mv mw dp mf lf mx my mh lj mz na mj ln nb nc ml nd bi translated">我们将使用什么</h2><p id="98a1" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf mp lh li lj mq ll lm ln mr lp lq lr ij bi translated">如果您想继续学习，我假设您已经安装了Jupyter Notebook和Python 3。</p><p id="6e58" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另外，我们将使用<a class="ae kv" href="https://pypi.org/project/numpy/" rel="noopener ugc nofollow" target="_blank"> numpy </a>和<a class="ae kv" href="https://pypi.org/project/scipy/" rel="noopener ugc nofollow" target="_blank"> scipy </a>，所以你也需要安装它们。我们应该已经有了<a class="ae kv" href="https://pymotw.com/2/functools/" rel="noopener ugc nofollow" target="_blank"> functools </a>，因为我们使用的是Python 3。</p><p id="05e1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们笔记本中的第一个单元格看起来像这样:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="a10a" class="ms lw iq nf b gy nj nk l nl nm"><strong class="nf ir">import</strong> <strong class="nf ir">numpy</strong> <strong class="nf ir">as</strong> <strong class="nf ir">np</strong><br/><strong class="nf ir">from</strong> <strong class="nf ir">scipy.stats</strong> <strong class="nf ir">import</strong> beta<br/><strong class="nf ir">from</strong> <strong class="nf ir">functools</strong> <strong class="nf ir">import</strong> reduce</span></pre><p id="c0d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将加载我们需要的所有库。</p><h2 id="cc38" class="ms lw iq bd lx mt mu dn mb mv mw dp mf lf mx my mh lj mz na mj ln nb nc ml nd bi translated">加载一些示例数据</h2><p id="9876" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf mp lh li lj mq ll lm ln mr lp lq lr ij bi translated">接下来，我们添加数据。这意味着增加每个变体的访问量(或用户数，如果你喜欢的话)以及转化率。</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="a8f9" class="ms lw iq nf b gy nj nk l nl nm"><strong class="nf ir">visits_control</strong> =  5625348<br/><strong class="nf ir">orders_control</strong> =  219197</span><span id="327f" class="ms lw iq nf b gy nn nk l nl nm"><strong class="nf ir">visits_variation</strong> = 5613277<br/><strong class="nf ir">orders_variation</strong> = 221100</span></pre><p id="0b1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lt">我只是编造了这些数字，但如果真的这么做，我们将从我们选择的分析工具中获得这些数据。</em></p><h2 id="d775" class="ms lw iq bd lx mt mu dn mb mv mw dp mf lf mx my mh lj mz na mj ln nb nc ml nd bi translated">计算转化率</h2><p id="7065" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf mp lh li lj mq ll lm ln mr lp lq lr ij bi translated">我们需要知道每个变体的转换率是多少。</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="43ee" class="ms lw iq nf b gy nj nk l nl nm">conversion_control = orders_control / visits_control<br/>conversion_variation = orders_variation / visits_variation</span><span id="e55d" class="ms lw iq nf b gy nn nk l nl nm">print("Control:", conversion_control)<br/>print("Variation:", conversion_variation)</span></pre><p id="512f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个的输出:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="5ed3" class="ms lw iq nf b gy nj nk l nl nm">Control: 0.0389659448624334<br/>Variation: 0.03938875633609387</span></pre><p id="e3bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lt">小数点后两位分别为3.90%和3.94%。</em></p><h2 id="a9b7" class="ms lw iq bd lx mt mu dn mb mv mw dp mf lf mx my mh lj mz na mj ln nb nc ml nd bi translated">正态分布的随机样本</h2><p id="624e" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf mp lh li lj mq ll lm ln mr lp lq lr ij bi translated">让我们进入一些基本的统计概念。我们可以假设转换率为<em class="lt">正态分布</em>，因此根据<a class="ae kv" href="https://en.wikipedia.org/wiki/Central_limit_theorem" rel="noopener ugc nofollow" target="_blank">中心极限定理</a>为每个转换率创建一条<a class="ae kv" href="https://www.simplypsychology.org/normal-distribution.html" rel="noopener ugc nofollow" target="_blank">正态分布曲线</a>。</p><p id="5c55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是正态分布曲线的样子:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/445c65c86e3d07d65ebfb9bd3d19934f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bFGL6bnqLr2H36QvhuEcqQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。正态分布曲线。</p></figure><p id="76be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lt">横轴</em>定义转化率，粉线是我们“观察到的”转化率。所以，对于对照组，这是0.038965或3.90%。对于变化，这是0.039389或3.94%。</p><p id="2da2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些值就是我们的<strong class="ky ir"> </strong>或我们每条分布曲线的“平均值”。</p><p id="5dfe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lt">垂直</em>轴<em class="lt">轴</em>定义了“观察”的体积。曲线下的形状是这些观测值的概率分布。离我们的<strong class="ky ir"> </strong>左边或者右边越远，我们的“观察”就越少。</p><p id="d539" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以为标准差<strong class="ky ir"> σ </strong>画一些线:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/a356fcf7506e33aa9e20dea5c70d2e92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1fX1HvTxnYAevXzD4pIaRg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。有标准偏差的正态分布曲线</p></figure><p id="cb09" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">想象一下，我们从对照组样本中随机抽取一些样本。这些随机样本的转换率是多少？嗯，有一个<strong class="ky ir"> <em class="lt"> 68.26% </em> </strong>我们的随机样本会来自上面的粉色阴影区域(34.13% + 34.13%):</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/e8380c00c746ad1f258fdf37b0759424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GZLhwUfD6MMi6UuOuStJog.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。正态分布曲线突出显示-平均值的1/+1标准偏差</p></figure><p id="0bff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">离平均值越远，意味着这些值出现的几率越小。</p><p id="d907" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果这还不清楚，不要担心。随着我们继续下去，事情有希望变得更加清楚。让我们继续使用python的魔力从我们的正态分布曲线中抽取一些随机样本。</p><p id="f301" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编辑:更正一下，我们实际上是要从<strong class="ky ir"> beta </strong>发行版中抽取样本。</p><p id="6845" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们定义需要多少个随机样本:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="4657" class="ms lw iq nf b gy nj nk l nl nm"><strong class="nf ir">N_MC</strong> = 10</span></pre><p id="b496" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尽管我们通常会使用类似于<em class="lt"> 10，000 </em>或<em class="lt"> 100，000 </em>这样的数字，但使用一个更小的数字来演示要容易得多。</p><p id="524c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了获得随机样本，我们需要将“成功”和“失败”传递到python函数中。这个函数调用如下所示:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="221c" class="ms lw iq nf b gy nj nk l nl nm">beta.rvs(successes, failures, size=N_MC)</span></pre><p id="4f48" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们使用这些值来生成随机样本:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="9553" class="ms lw iq nf b gy nj nk l nl nm">control_successes = orders_control<br/>control_failures = visits_control-orders_control</span><span id="eb42" class="ms lw iq nf b gy nn nk l nl nm">control_sample = beta.rvs(control_successes, control_failures, size=N_MC)</span></pre><p id="384b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们打印出<code class="fe nq nr ns nf b">control_sample</code>的值，我们会得到:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="e31c" class="ms lw iq nf b gy nj nk l nl nm">[0.03903641 0.0389794  0.03905511 0.0390165  0.03891369 0.03899223<br/> 0.03884811 0.03901279 0.03884893 0.03901625]</span></pre><p id="e3f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基于我们观察到的“平均值”的十个样本转换率列表。它们看起来非常接近我们的控制转换率<strong class="ky ir"> 0.038965。这正是我们所期待的。</strong></p><p id="b9fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要为变体组做同样的事情:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="15b0" class="ms lw iq nf b gy nj nk l nl nm">var_successes = orders_variation<br/>var_failures = visits_variation-orders_variation</span><span id="260c" class="ms lw iq nf b gy nn nk l nl nm">variation_sample = beta.rvs(var_successes, var_failures, size=N_MC)</span></pre><p id="f38e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nq nr ns nf b">variation_sample</code>的打印输出:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="3c64" class="ms lw iq nf b gy nj nk l nl nm">[0.0393568  0.03934686 0.03950938 0.03935167 0.03929198 0.0393716<br/> 0.03940077 0.03934958 0.03939534 0.03936369]</span></pre><p id="fc00" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它们看起来非常接近我们的变异转换率<strong class="ky ir"> 0.039389。这也是我们所期待的。</strong></p><h2 id="a1ed" class="ms lw iq bd lx mt mu dn mb mv mw dp mf lf mx my mh lj mz na mj ln nb nc ml nd bi translated">计算预期损失</h2><p id="2641" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf mp lh li lj mq ll lm ln mr lp lq lr ij bi translated">所以，现在我们有了:</p><ol class=""><li id="afb6" class="nt nu iq ky b kz la lc ld lf nv lj nw ln nx lr ny nz oa ob bi translated"><strong class="ky ir"> control_sample: </strong>根据我们观察到的<em class="lt">对照组</em>的转化率，列出10个随机转化率</li><li id="b06c" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated"><strong class="ky ir">变异_样本:</strong>基于我们对<em class="lt">变异组</em>观察到的转化率的10个随机转化率列表</li></ol><p id="1b4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们要比较两组样本。如果我们将它们压缩成一个由<em class="lt">元组组成的列表，就很容易做到——</em>元组是由两个值组成的列表。所以，如果我们这样做…</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="e693" class="ms lw iq nf b gy nj nk l nl nm">samples = list(zip(variation_sample, control_sample))</span></pre><p id="18b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">…并打印<code class="fe nq nr ns nf b">samples</code>的输出，我们将得到:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="8f8d" class="ms lw iq nf b gy nj nk l nl nm">[(0.03935680021728885, 0.03903640775019114), (0.039346863185651795, 0.03897940249438995), , (0.039351671006072196, 0.0390165049777375), (0.03929198308373445, 0.03891368745047992), (0.03937159635366056, 0.038992234526441655), (0.03940077430481381, 0.0388481084116417), (0.03934958290885752, 0.039012789327513016), (0.039395339750152525, 0.03884893384273168), (0.039363691751648874, 0.03901625035958206)]</span></pre><p id="d0b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是对此的另一种观点:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/dc28aef8bb4655e1aaedf22be84bdcf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DXYf1NQxqWS8UQ_EVMIF7w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。可视化元组列表</p></figure><p id="9839" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">拥有一个元组列表可以更容易地比较我们的两个值。为了计算出对照组的预期损失，我们需要对列表中的每个样本执行以下操作:</p><ol class=""><li id="485e" class="nt nu iq ky b kz la lc ld lf nv lj nw ln nx lr ny nz oa ob bi translated"><code class="fe nq nr ns nf b">variation_sample - control_sample</code></li><li id="f68c" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated">将任何负的结果基线到<code class="fe nq nr ns nf b">0</code> <em class="lt">(因为预期损失要么是0要么是正数，永远不会是负值)</em></li><li id="7f5d" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated">返回列表的平均值</li></ol><p id="bf98" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了在python中做到这一点，我们创建了一个差异列表，如<code class="fe nq nr ns nf b">diff_list</code>:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="a036" class="ms lw iq nf b gy nj nk l nl nm">diff_list = map(<strong class="nf ir">lambda</strong> sample: np.max([sample[0]-sample[1], 0]), samples)</span></pre><p id="5618" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将<code class="fe nq nr ns nf b">diff_list</code>中的每一项相加…</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="763c" class="ms lw iq nf b gy nj nk l nl nm">sum_diff = reduce(<strong class="nf ir">lambda</strong> x,y:x+y, diff_list)</span></pre><p id="43fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">..然后返回百分比形式的平均值。</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="399a" class="ms lw iq nf b gy nj nk l nl nm">EL_CONTROL = sum_diff/N_MC * 100.</span></pre><p id="80f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对照组的最终预期损失为:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="4a41" class="ms lw iq nf b gy nj nk l nl nm">0.04018252880723959</span></pre><p id="e4c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">换句话说，如果我们选择对照组，我们预计损失为0.04018%。</p><p id="8301" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们需要为变体组做同样的事情:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="0c21" class="ms lw iq nf b gy nj nk l nl nm">diff_list = map(<strong class="nf ir">lambda</strong> sample: np.max([sample[1]-sample[0], 0]), samples)<br/>sum_diff = reduce(<strong class="nf ir">lambda</strong> x,y:x+y, diff_list)</span><span id="8c03" class="ms lw iq nf b gy nn nk l nl nm">EL_VAR = sum_diff/N_MC * 100.</span></pre><p id="ad8f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">印刷<code class="fe nq nr ns nf b">EL_VAR</code>给了我们:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="ae2d" class="ms lw iq nf b gy nj nk l nl nm">0.0</span></pre><p id="c836" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">换句话说，我们期望通过选择变化不会损失什么(<strong class="ky ir"> 0% </strong>)。所以，总的来说，变异组的风险最小。</p><p id="59d0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">需要注意的是，我们在这里使用了10个样本。如果我们真的这样做，我们会使用更多的样本。但本质上是相同的过程。简单吧？</p><p id="ac6c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，这些对预期损失的计算可能有用，也可能没用。我们还需要知道这个结果是否“显著”。</p><p id="457a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，我们需要绘制一段时间内的累积结果。你可以将预期的损失数字输入Excel，并在那里绘制图表，或者你可以创建一个Jupyter笔记本。</p><p id="932f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最终的视图类似于这样:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/3cb935e6a0409c14ef0762048098d51c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ajx7rKTpD-fEx4tZ8fgTxw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。预期损失示例。</p></figure><p id="6a7d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以应用一些规则来验证一个测试是否足够稳定。我在与我合作过的团队中使用的规则是:</p><ol class=""><li id="aa91" class="nt nu iq ky b kz la lc ld lf nv lj nw ln nx lr ny nz oa ob bi translated">七天没有预期损失线交叉</li><li id="2181" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated">预期损失线的一致性</li><li id="4a59" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated">最好的概率应该是90%或更高</li></ol><p id="5c9c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lt">注意:概率最好使用转换率，而不是预期损失，因为我们删除了低于0的值。</em></p><p id="a0ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尽管示例折线图有几周的数据，但您可以更早地读取数据(可能在第3周)。这个想法是企业在决定测试结果之前就意识到了风险。</p><p id="6465" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以这种方式利用预期损失视图有助于减少我运行的许多实验的运行时间，尤其是那些主要目标是对某个功能或首次展示进行风险评估的实验。</p><p id="2f7c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我真的相信从<strong class="ky ir">风险</strong>和<strong class="ky ir">回报</strong>的双重视角来看待实验是非常强大的。不仅仅是在分析实验时，在与利益相关者交流结果时也是如此，因为这会使决策变得更加容易。</p><p id="dee9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">很想听听你的想法。有没有其他视图可以让最终用户更清楚地了解实验结果？</p><h1 id="a4f2" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">关于我</h1><p id="fe6c" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf mp lh li lj mq ll lm ln mr lp lq lr ij bi translated">我是<strong class="ky ir">伊克巴尔·阿里</strong>，<a class="ae kv" href="https://iqbala.com/" rel="noopener ugc nofollow" target="_blank">漫画作家</a> <strong class="ky ir"> </strong>，前Trainline优化主管。</p><p id="543b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我通过培训、建立流程和讲述实验的数据故事来帮助公司开展实验项目！</p><p id="a93f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我的<a class="ae kv" href="https://www.linkedin.com/in/iqbalhussainali/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> LinkedIn </strong> </a>如果你想联系。或者跟随我来到这里。</p></div></div>    
</body>
</html>