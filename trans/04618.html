<html>
<head>
<title>Build and Run a Docker Container for your Machine Learning Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为你的机器学习模型构建并运行一个Docker容器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-and-run-a-docker-container-for-your-machine-learning-model-60209c2d7a7f?source=collection_archive---------0-----------------------#2021-04-21">https://towardsdatascience.com/build-and-run-a-docker-container-for-your-machine-learning-model-60209c2d7a7f?source=collection_archive---------0-----------------------#2021-04-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e4b9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用简单的机器学习模型快速简单地构建Docker容器</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c13585d593daeef3cf60e88cab0626bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HAJ4zZRQJPlAVM2W06V3cQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Annamária Borsos摄影</p></figure><p id="6744" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本文的想法是用一个简单的机器学习模型快速简单地构建一个Docker容器并运行它。在阅读本文之前，请务必阅读<a class="ae lr" href="https://xaviervasques.medium.com/why-using-docker-for-machine-learning-74c927ceb6c4" rel="noopener">为什么使用Docker进行机器学习</a>和<a class="ae lr" href="https://xaviervasques.medium.com/quick-install-and-first-use-of-docker-327e88ef88c7" rel="noopener">Docker的快速安装和首次使用</a>。</p><p id="2bc8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了开始为机器学习模型构建Docker容器，让我们考虑三个文件:<strong class="kx ir"> Dockerfile、train.py、inference.py. </strong></p><p id="61ef" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你可以在<a class="ae lr" href="https://github.com/xaviervasques/EEG-letters" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到所有文件。</p><p id="93fb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> train.py </strong>是一个python脚本，它接收并规范化csv文件(train.csv)中的EEG数据，并训练两个模型对数据进行分类(使用scikit-learn)。该脚本保存了两个模型:线性判别分析(clf_lda)和神经网络多层感知器(clf_NN)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="2a27" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">将调用<strong class="kx ir"> inference.py </strong>通过加载之前创建的两个模型进行批量推理。该应用程序将对来自csv文件(test.csv)的新EEG数据进行标准化，对数据集进行推理，并打印分类准确性和预测。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="7112" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们创建一个简单的<strong class="kx ir"> Dockerfile </strong>，使用<strong class="kx ir"> jupyter/scipy-notebook </strong>图像作为我们的基本图像。我们需要安装<strong class="kx ir"> joblib </strong>来允许我们的训练模型的序列化和反序列化。我们将train.csv、test.csv、train.py和inference.py文件复制到映像中。然后，我们运行<strong class="kx ir"> train.py </strong>，它将拟合和序列化机器学习模型，作为我们映像构建过程的一部分，这提供了几个优势，例如在过程开始时进行调试的能力，使用Docker映像ID进行跟踪或使用不同的版本。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="537e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了构建映像，我们在终端中运行以下命令:</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="5b05" class="lz ma iq lv b gy mb mc l md me">docker build -t docker-ml-model -f Dockerfile .</span></pre><p id="7f55" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">输出如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mf"><img src="../Images/8ec57f1034feab8f0fa1d5f5f1919ad8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WNwg1a5Uk8X9pChk47lQRw.png"/></div></div></figure><p id="3b3b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">是时候对新数据执行推断了(test.csv):</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="55dd" class="lz ma iq lv b gy mb mc l md me">docker run docker-ml-model python3 inference.py</span></pre><p id="882d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">输出如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mf"><img src="../Images/0b611d112d01c18b0a94111bb6fa4d08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UtKhhi4rinYuuVV18e8Axg.png"/></div></div></figure><p id="978b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以做一些事情来改善我们的集装箱化体验。例如，我们可以使用docker文件中的WORKDIR绑定容器中的主机目录:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="e1e7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<strong class="kx ir">推论. py </strong>中，我们可以决定保存一个<strong class="kx ir">输出. csv </strong>文件，其中包含<strong class="kx ir"> X_test </strong>数据:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="3f7c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当您构建并运行它时，您应该能够在<strong class="kx ir"> /mydata </strong>中看到<strong class="kx ir"> output.csv </strong>文件:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mg"><img src="../Images/0679a9c99873263a8a4a19c2f7f63b50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Ei3RLqfAqcljlMvlaZgJA.png"/></div></div></figure><p id="7269" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们还可以在Dockerfile文件中添加<strong class="kx ir"> VOLUME </strong>指令，生成一个将创建新挂载点的映像:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="986e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用我们指定的名称，<strong class="kx ir"> VOLUME </strong>指令创建一个挂载点，该挂载点被标记为保存从本地主机或其他容器外部挂载的卷，我们在这些容器中找到我们想要处理的数据。</p><p id="932b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于未来的开发，可能有必要从一开始就设置环境变量，只需在构建时设置一次，以便持久化训练好的模型，并可能向特定位置添加额外的数据或元数据。设置环境变量的好处是避免在代码中到处都是必要路径的硬代码，并且在一个商定的目录结构上更好地与他人共享您的工作。</p><p id="d897" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们再举一个例子，用一个新的docker文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="7a0c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们需要给<strong class="kx ir"> train.py </strong>添加环境变量:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="a75b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">和<strong class="kx ir">推论. py </strong>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><h1 id="d7ab" class="mh ma iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">下一步是什么？</h1><p id="45c5" class="pw-post-body-paragraph kv kw iq kx b ky my jr la lb mz ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">我们的目标是通过简单的机器学习模型，产生快速简单的步骤来构建Docker容器。构建就像做一个<strong class="kx ir">docker build-t my-docker-image一样简单。</strong>。</p><p id="db56" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从这一步开始，我们可以开始部署我们的模型，这将更加简单，并消除发布和扩展您的机器学习模型的恐惧。下一步是用一个CI/CD工具(持续集成/持续交付)产生一个工作流，比如Jenkins。得益于这种方法，可以在任何地方构建和服务docker容器，并公开REST API，以便外部利益相关者可以使用它。如果您正在训练一个需要高计算需求的深度学习模型，您可以将容器移动到高性能计算服务器或您选择的任何平台，如内部、私有或公共云。这个想法是，您可以扩展您的模型，但也可以创建弹性部署，因为您可以跨区域/可用性区域扩展容器。</p><p id="69a5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我希望您能看到容器提供的极大的简单性和灵活性。通过容器化你的机器/深度学习应用，你可以让它对世界可见。下一步是在云中部署它并公开它。在某些时候，您需要借助Red Hat open shift(Kubernetes发行版)等技术来协调、监控和扩展您的容器，以便为数百万用户提供服务。</p><p id="21a4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">来源</strong></p><p id="cef1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae lr" href="https://docs.docker.com/engine/reference/builder/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/engine/reference/builder/</a></p><p id="d9ca" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae lr" href="https://mlinproduction.com/docker-for-ml-part-3/" rel="noopener ugc nofollow" target="_blank">https://mlinproduction.com/docker-for-ml-part-3/</a></p><p id="7d41" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae lr" href="https://theaisummer.com/docker/" rel="noopener ugc nofollow" target="_blank">https://theaisummer.com/docker/</a></p></div></div>    
</body>
</html>