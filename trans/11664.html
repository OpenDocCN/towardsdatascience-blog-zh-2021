<html>
<head>
<title>PyQt and Relational Databases: Data Format 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PyQt和关系数据库:数据格式2</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pyqt-relational-databases-data-format-2-2203505f778?source=collection_archive---------21-----------------------#2021-11-18">https://towardsdatascience.com/pyqt-relational-databases-data-format-2-2203505f778?source=collection_archive---------21-----------------------#2021-11-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="e223" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">数据</h2><div class=""/><div class=""><h2 id="a416" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">用PyQt轻松呈现关系数据库数据。不需要SQL查询。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/8b84665ce165842869c1e07b6d685688.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zfXSlG3P5qaflANlpH0eWQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者和Unsplash提供的图像</p></figure><p id="4035" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">今天，我们将深入探讨数据格式化。</p><p id="c697" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们将讨论视图使用的条目数据角色，以向模型表明它需要哪种类型的数据。</p><p id="d59d" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">再举几个数据格式的例子，并在最后给你一点奖励，这将有助于你理解表格数据格式。</p><h2 id="2fee" class="md me it bd mf mg mh dn mi mj mk dp ml lq mm mn mo lu mp mq mr ly ms mt mu iz bi translated">本文是PyQt &amp;关系数据库系列的一部分:</h2><div class="mv mw gp gr mx"><div role="button" tabindex="0" class="ab bv gv cb fp my mz bn na lb ex"><div class="nb l"><div class="ab q"><div class="l di"><img alt="Stefan Melo" class="l de bw nc nd fe" src="../Images/b28b9ceb41c488532f34fbb9b4e5b485.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*ulugY22Ollx0QvWgTOPQSg.jpeg"/><div class="fb bw l nc nd fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated">斯特凡·梅洛</p></div></div><div class="ng nh gw l"><h2 class="bd jd uu uv fp uw fr fs qc fu fw jc bi translated">PyQt &amp;关系数据库系列</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi ux au uy uz va rl vb an eh ei vc vd ve el em eo de bk ep" href="https://melo-stefan.medium.com/list/pyqt-relational-databases-series-9ded67b27631?source=post_page-----2203505f778--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="vf l fo"><span class="bd b dl z dk">6 stories</span></div></div></div><div class="nt dh nu fp ab nv fo di"><div class="di nl bv nm nn"><div class="dh l"><img alt="" class="dh" src="../Images/edba3e23850732675eaf821bf15d8dfe.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*-lqsR31ZIk0x2h0I"/></div></div><div class="di nl bv no np nq"><div class="dh l"><img alt="" class="dh" src="../Images/dac62b021212cceabb22d8eb8de637ba.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*hGqwpPX6N-yLYsC4"/></div></div><div class="di bv nr ns nq"><div class="dh l"><img alt="" class="dh" src="../Images/f544d0802f13c5585dbcd029343af724.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*s6zoQDf6AOkb-_ET"/></div></div></div></div></div></div><div class="ab cl oa ob hx oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="im in io ip iq"><h2 id="fa05" class="md me it bd mf mg mh dn mi mj mk dp ml lq mm mn mo lu mp mq mr ly ms mt mu iz bi translated">表格演示</h2><p id="5d88" class="pw-post-body-paragraph lh li it lj b lk oh kd lm ln oi kg lp lq oj ls lt lu ok lw lx ly ol ma mb mc im bi translated">到目前为止我们学到了什么？很多。</p><p id="3378" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">然而，它可能看起来有点像，因为我们编写了相对较少的代码行。它适合于开发人员，因为它表明生产力的快速增长。</p><p id="205f" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">现在，你知道如何通过避免SQL查询知识来使你的生活变得更容易。没有编译任何SQL查询，您可以用关系数据库(在本例中是SQLite数据库)中的数据填充您的表。</p><p id="d918" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">并且您理解了<em class="om">模型-视图-控制器</em>设计模式，并且您能够通过PyQt有效地使用它。</p><p id="6d5b" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这些技能都是通过<code class="fe on oo op oq b">QAbstractTableModel</code>进行模型定制支持的。</p><blockquote class="or"><p id="41ad" class="os ot it bd ou ov ow ox oy oz pa mc dk translated">控制数据表示模型提供了使数据可读的无限可能性。</p></blockquote><p id="1ca1" class="pw-post-body-paragraph lh li it lj b lk pb kd lm ln pc kg lp lq pd ls lt lu pe lw lx ly pf ma mb mc im bi translated">例如，我们已经指出了货币和精度，这是定价数据的两个基本属性。</p><h2 id="ea7c" class="md me it bd mf mg mh dn mi mj mk dp ml lq mm mn mo lu mp mq mr ly ms mt mu iz bi translated">项目数据角色</h2><blockquote class="or"><p id="65c4" class="os ot it bd ou ov ow ox oy oz pa mc dk translated">演示模型还能为我们做什么？</p></blockquote><p id="770c" class="pw-post-body-paragraph lh li it lj b lk pb kd lm ln pc kg lp lq pd ls lt lu pe lw lx ly pf ma mb mc im bi translated">强烈推荐玩玩。你会学到很多，你会发现可能性是无穷无尽的。</p><p id="94c1" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">最好的方法是从角色开始。角色代表一个<code class="fe on oo op oq b">Qt.ItemDataRole</code>枚举。</p><p id="b97f" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">模型中的每一项都有一组与之相关联的数据元素，每一项都有自己的角色。自定义模型应该返回这些类型的数据。</p><p id="2a30" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">可以把它们想象成物品特征，基于这些特征，系统理解我们想要对物品做什么。</p><p id="7253" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">根据角色效果，有通用角色、描述外观和元数据的角色、可访问性角色和可用的用户角色。</p><p id="9141" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">今天我们将使用<code class="fe on oo op oq b">DisplayRole</code>和<code class="fe on oo op oq b">DecorationRole</code>。然而，当我们需要他们的时候，我们会再回来的。</p><h2 id="1812" class="md me it bd mf mg mh dn mi mj mk dp ml lq mm mn mo lu mp mq mr ly ms mt mu iz bi translated">更改“ID”和“日期”格式</h2><p id="6501" class="pw-post-body-paragraph lh li it lj b lk oh kd lm ln oi kg lp lq oj ls lt lu ok lw lx ly ol ma mb mc im bi translated">让我们多学一点。</p><p id="c2a9" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这个<code class="fe on oo op oq b">DisplayRole</code>很有用。</p><p id="5815" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在我们的示例中，我们将格式化ID号列并更改日期格式。我们开始吧！</p><p id="9b77" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">很直白。我们将在子类<code class="fe on oo op oq b">QAbstractTableModel</code>的<code class="fe on oo op oq b">data()</code>方法中添加几行代码。</p><pre class="ks kt ku kv gt pg oq ph pi aw nz bi"><span id="9c80" class="md me it oq b gy pj pk l pl pm">def data(self, index, role):<br/>    value = self._model.record(index.row()).value(index.column())<br/>    if role == Qt.ItemDataRole.DisplayRole:<br/><strong class="oq jd">        if isinstance(value, int) and index.column() == 0:<br/>            return f'# {value}'<br/></strong>        if isinstance(value, int) and index.column() == 1:<br/>            return "${: ,.2f}".format(value)<br/><strong class="oq jd">        if isinstance(value, str) and index.column() == 4:<br/>            date_object = date.fromisoformat(value)<br/>            return date_object.strftime('%x')<br/></strong>        return value</span></pre><p id="b23e" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们在上面添加了几行粗体字。在第一列中，我们添加了“#”符号。</p><p id="4f55" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">对于日期列，我们需要一些导入:</p><pre class="ks kt ku kv gt pg oq ph pi aw nz bi"><span id="fc70" class="md me it oq b gy pj pk l pl pm"><strong class="oq jd">from datetime import date<br/>from time import strftime</strong></span></pre><p id="43a0" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">因为我们的<code class="fe on oo op oq b">value</code>只是一个纯文本(ISO格式)，所以我们创建了<code class="fe on oo op oq b">date_object</code>。</p><p id="71ec" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们需要它来方便格式转换。下面一行返回转换为本地格式的日期中的纯文本。</p><p id="cfd2" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">只添加了7行代码，表就变了，结果就在这里。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pn"><img src="../Images/0d1ba7d072701c148ef1755a3aaf06a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hoKupVb6bAobIP8PgcUWPw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</p></figure><h2 id="f027" class="md me it bd mf mg mh dn mi mj mk dp ml lq mm mn mo lu mp mq mr ly ms mt mu iz bi translated">装饰</h2><p id="432b" class="pw-post-body-paragraph lh li it lj b lk oh kd lm ln oi kg lp lq oj ls lt lu ok lw lx ly ol ma mb mc im bi translated">正如承诺的，这是最后的一点奖金。</p><p id="21bd" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">它展示了一种<code class="fe on oo op oq b">DecorationRole</code>的力量。</p><p id="4a32" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">有时候，用一些装饰让桌子看起来更有吸引力是很有用的。它显示了两种不同的情况。</p><p id="5a8c" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果您查看第一列，您会注意到我们在一个整数订单号前面添加了一个标签“#”符号。</p><blockquote class="po pp pq"><p id="7ed3" class="lh li om lj b lk ll kd lm ln lo kg lp pr lr ls lt ps lv lw lx pt lz ma mb mc im bi translated">在将数据写入模型的情况下，我们会将项目转换为字符串，这在将数据写入数据库时可能会出现问题。</p></blockquote><p id="2a19" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">为了避免这种不必要的转换，最好使用装饰。我们必须删除<code class="fe on oo op oq b">DisplayRole</code>部分中第0列的整个<code class="fe on oo op oq b">if</code>语句。</p><pre class="ks kt ku kv gt pg oq ph pi aw nz bi"><span id="9d98" class="md me it oq b gy pj pk l pl pm">def data(self, index, role):<br/>    value = self._model.record(index.row()).value(index.column())<br/>    if role == Qt.ItemDataRole.DisplayRole:<strong class="oq jd"><br/></strong>        if isinstance(value, int) and index.column() == 1:<br/>            return "${: ,.2f}".format(value)<br/>        if isinstance(value, str) and index.column() == 4:<br/>            date_object = date.fromisoformat(value)<br/>            return date_object.strftime('%x')<strong class="oq jd"><br/></strong>        return value</span><span id="277e" class="md me it oq b gy pu pk l pl pm">    <strong class="oq jd">if role == Qt.ItemDataRole.DecorationRole:<br/>        if isinstance(value, int) and index.column() == 0:<br/>            return QtGui.QIcon('data/icons/hashtag_icon.png')<br/>        if isinstance(value, str) and index.column() == 4:<br/>            return QtGui.QIcon('data/icons/calendar.png')</strong></span></pre><p id="ee32" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">然后我们只在<code class="fe on oo op oq b">DecorationRole</code>部分实现两个<code class="fe on oo op oq b">if</code>语句。</p><p id="8358" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">第一个用于第0列，添加hashtag符号装饰，另一个用于第4列，添加日历图标装饰。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pv"><img src="../Images/841d9ce396047d80bfe291bf8bfb501d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K_Y7JvL8nitl3y4ZaJXvhQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</p></figure><h2 id="31d9" class="md me it bd mf mg mh dn mi mj mk dp ml lq mm mn mo lu mp mq mr ly ms mt mu iz bi translated">关系数据库数据表示</h2><p id="8150" class="pw-post-body-paragraph lh li it lj b lk oh kd lm ln oi kg lp lq oj ls lt lu ok lw lx ly ol ma mb mc im bi translated">关注数据呈现总是很重要的。</p><p id="8373" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">PyQt使得保持数据库源不变变变得容易，并且仍然提供了很多机会来使数据呈现对用户具有吸引力。</p></div><div class="ab cl oa ob hx oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="im in io ip iq"><p id="b6b5" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj jd"> <em class="om">如果你想阅读更多这样的内容，成为会员:</em> </strong></p><div class="mv mw gp gr mx pw"><a href="https://melo-stefan.medium.com/membership" rel="noopener follow" target="_blank"><div class="px ab fo"><div class="py ab pz cl cj qa"><h2 class="bd jd gy z fp qb fr fs qc fu fw jc bi translated">通过我的推荐链接加入Medium-Stefan Melo</h2><div class="qd l"><h3 class="bd b gy z fp qb fr fs qc fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="qe l"><p class="bd b dl z fp qb fr fs qc fu fw dk translated">melo-stefan.medium.com</p></div></div><div class="qf l"><div class="qg l qh qi qj qf qk lb pw"/></div></div></a></div><p id="99f8" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj jd"> <em class="om">或者你可以订阅我下面的简讯。谢谢你。</em> </strong></p></div></div>    
</body>
</html>