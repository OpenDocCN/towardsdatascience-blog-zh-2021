<html>
<head>
<title>How to Use Microsoft’s Graph API to Query, Create and Analyze Data from OneDrive, Outlook and more</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用微软的Graph API从OneDrive、Outlook等中查询、创建和分析数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/what-microsoft-knows-about-you-and-how-you-can-use-it-to-generate-your-own-insights-1bd0aa0881ed?source=collection_archive---------10-----------------------#2021-03-24">https://towardsdatascience.com/what-microsoft-knows-about-you-and-how-you-can-use-it-to-generate-your-own-insights-1bd0aa0881ed?source=collection_archive---------10-----------------------#2021-03-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7f4f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用来自10多个不同微软应用的数据构建你自己的Django仪表板</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8848f91987be0dd48e0fe783c8fbfe38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y-hzWYlDH3bQpMtrFPXsmA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="646e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从我的电子邮件、日历条目、云存储中的文件到团队中的工作组，我在电脑和手机上的很大一部分日常活动都是通过微软应用程序完成的。所有这些数据都存储在微软的云端，不管我喜不喜欢。好在微软提供了一个API，允许它访问和控制大部分数据，所以为什么不用它来产生你自己的见解呢。</p><p id="5404" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面的截图应该让你知道我想用这篇文章传达什么。我想让你看看:</p><ul class=""><li id="70f9" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">我对API本身的体验是什么，以及如何<strong class="la iu">构建访问数据所需的查询</strong></li><li id="a00d" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><strong class="la iu">认证过程</strong>是如何工作的，它给你的应用程序必要的权限</li><li id="7998" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">你如何<strong class="la iu">处理和可视化</strong>Django中的数据</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl mi"><img src="../Images/d2153edfc21ca2e6c0f30333db8bf676.png" data-original-src="https://miro.medium.com/v2/format:webp/1*HDmi29s_AZLXFokZNfuTmQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带有Django的简单仪表板应用程序—图片由作者提供</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="1717" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">目录</h1><ul class=""><li id="ca65" class="lu lv it la b lb ni le nj lh nk ll nl lp nm lt lz ma mb mc bi translated"><a class="ae nn" href="#6ce1" rel="noopener ugc nofollow">Graph Quick Start——快速使用微软的Graph API </a></li><li id="b33b" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><a class="ae nn" href="#a7b2" rel="noopener ugc nofollow"> OAuth 2.0 —登录流程如何工作</a></li><li id="14c0" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><a class="ae nn" href="#bf97" rel="noopener ugc nofollow">使用图形API查询数据</a></li><li id="4625" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><a class="ae nn" href="#c889" rel="noopener ugc nofollow">用plottly</a>分析并可视化数据</li><li id="c976" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><a class="ae nn" href="#1ed7" rel="noopener ugc nofollow">总结</a></li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="6ce1" class="no mr it bd ms np nq dn mw nr ns dp na lh nt nu nc ll nv nw ne lp nx ny ng nz bi translated">Graph Quick Start —快速启动Graph API的方法</h2><p id="dfe9" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">几年前，微软从Live SDK转到了Microsoft Graph。Microsoft Graph现在是访问Microsoft 365中所有数据和见解的API。[1][2]</p><p id="724c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有几种方法可以开始使用Microsoft Graph API。最快的方法是使用<a class="ae nn" href="https://developer.microsoft.com/en-us/graph/quick-start" rel="noopener ugc nofollow" target="_blank">图形快速启动</a>，它为认证过程创建一个新的应用ID和应用密码，并且已经为您提供了第一个示例项目。</p><p id="817d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">(1)第一步，你需要定义你想要用来构建你的应用的语言。因为我更喜欢Python，所以示例应用程序将是一个简单的Django应用程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/eb969cefa3c4727449df9bd1fe55539d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TnzM2nmgfbnB12CyzaXypA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">选择作者的语言-图像</p></figure><p id="8120" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你对Django不熟悉，可以看一下我之前的一篇文章，里面尽可能简单的解释了Django的原理，包括了最重要的几点。如果你喜欢从头开始构建自己的应用程序，你也可以在微软文档中找到一个<a class="ae nn" href="https://docs.microsoft.com/en-us/graph/tutorials/python" rel="noopener ugc nofollow" target="_blank">教程。</a></p><div class="oe of gp gr og oh"><a rel="noopener follow" target="_blank" href="/a-beginners-guide-to-using-djangos-impressive-data-management-abilities-9e94efe3bd6e"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">使用Django令人印象深刻的数据管理能力的初学者指南</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">使用Django ORM完成数据管理任务。甚至不需要启动任何web服务器。</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">towardsdatascience.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov ks oh"/></div></div></a></div><p id="af71" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">(2)选择语言后，<a class="ae nn" href="https://developer.microsoft.com/en-us/graph/quick-start" rel="noopener ugc nofollow" target="_blank">快速启动</a>会让您选择直接创建一个带有App Secret的新App ID，稍后您会在授权过程中用到它。</p><p id="a924" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要获得已注册应用的概览，您可以在Azure Active Directory下的<a class="ae nn" href="https://portal.azure.com/" rel="noopener ugc nofollow" target="_blank"> Azure门户</a>中完成。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/566a5abb03dee409545f01eff4c3c273.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*twOryEeWBdH4kS1YQ3VNwg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Azure门户——作者图片</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="91e2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">(3)快速入门为您提供了第一个示例应用程序，其中已经包含了基本结构和身份验证流程。下载代码示例并将其保存在项目字典中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/6f128aaebad6ef636e763f694721657d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rQRHz2MNsMzPcDeQYzHb7w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Django代码示例—图片由作者提供</p></figure><p id="0012" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">代码示例的结构看起来像任何普通的Django应用程序。此外，YAML文件<code class="fe oy oz pa pb b">oauth_settings.yml</code>包括用于认证的设置，例如所需的端点、应用ID和应用秘密。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/12eac0ec1614b02c48ea87c923467671.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_BkTdF5Wfk0gLehVfuZ9uw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">项目结构—作者图片</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="2e8b" class="no mr it bd ms np nq dn mw nr ns dp na lh nt nu nc ll nv nw ne lp nx ny ng nz bi translated">安装要求</h2><p id="6f4f" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">(4)为了能够第一次启动应用程序，您必须安装必要的Python包。</p><p id="68fb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe oy oz pa pb b">requirements.txt</code>提供了一种安装整个环境的简单方法。[3]由于应用程序有时需要特定版本的库，因此建立一个虚拟环境是有意义的。[4]为此，导航到您的项目目录并执行以下命令，这将创建虚拟环境<code class="fe oy oz pa pb b">virtualenv_graph</code>。</p><pre class="kj kk kl km gt pd pb pe pf aw pg bi"><span id="89af" class="no mr it pb b gy ph pi l pj pk">python -m venv virtualenv_graph</span></pre><p id="b485" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您将在项目文件夹中找到一个新目录<code class="fe oy oz pa pb b">virtualenv_graph</code>，其中包含Python解释器的副本。为了实际使用刚刚创建的环境<code class="fe oy oz pa pb b">graph-tutorial</code>，您必须通过执行批处理文件<code class="fe oy oz pa pb b">activate</code>来激活它，如下所示:</p><pre class="kj kk kl km gt pd pb pe pf aw pg bi"><span id="ac80" class="no mr it pb b gy ph pi l pj pk">graph-tutorial\Scripts\activate.bat</span></pre><p id="efc8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">激活后，您将在CMD输入行开头的括号中看到您的虚拟环境的名称。这表明您的环境当前已被激活。使用以下命令，您现在可以将所有必需的Python包安装到您的环境中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/af3e6e02a0b6de0e4c7022ccf12ad33a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*kscAPN4qb9_RPh59tYLDFA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="83be" class="no mr it bd ms np nq dn mw nr ns dp na lh nt nu nc ll nv nw ne lp nx ny ng nz bi translated">迁移—将更改传播到数据库</h2><p id="d52b" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">(5)以下命令将应用程序中使用的模型结构映射到数据库:</p><pre class="kj kk kl km gt pd pb pe pf aw pg bi"><span id="4648" class="no mr it pb b gy ph pi l pj pk">python manage.py migrate</span></pre><p id="dd4f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将为使用的Django应用程序<code class="fe oy oz pa pb b">django.contrib.auth</code>和<code class="fe oy oz pa pb b">django.contrib.session</code>创建一些默认表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/acb0a565cc8284fa4f706fca827ac9e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:742/format:webp/1*yigBESf6Emp2mJ3fscKOdw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Django默认表格-图片由作者提供</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="9983" class="no mr it bd ms np nq dn mw nr ns dp na lh nt nu nc ll nv nw ne lp nx ny ng nz bi translated">启动一个轻量级web服务器</h2><p id="2cda" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">(6)命令<code class="fe oy oz pa pb b">python manage.py runserver</code>在我们的本地主机上启动一个轻量级web服务器。除非另有说明，否则本地web服务器运行在端口8000和地址127.0.0.1上。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/ea6a4591c725aa9dc4359f15d64f44e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ogI3zUk5TuLi5OX9t8bYeA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">示例应用起始页—作者提供的图片</p></figure><p id="90d0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，您可以使用Office365帐户的登录数据登录。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="51e7" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated"><strong class="ak">OAuth 2.0—登录过程如何工作</strong></h1><p id="d100" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">在下文中，我将简要概述OAuth 2.0的功能，解释给定示例代码的作用。</p><p id="b073" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">OAuth 2.0是一种行业标准的身份验证协议，允许用户授予第三方应用程序对用户资源的访问权限，而无需向应用程序提供您的长期凭据。[5][6]</p><p id="be7f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是可能的，因为OAuth授权层将客户机的角色与资源所有者分开。为了更好地理解这一点，我将尝试简要地解释哪些角色是OAuth工作流的一部分，以及它们是如何相互关联的。[5]</p><ul class=""><li id="5a0f" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated"><strong class="la iu">资源所有者:</strong>授权访问资源的实体。在这种情况下，是你，最终用户，授权应用程序访问与你的Microsoft 365帐户相关的Microsoft云中的数据。</li><li id="7500" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><strong class="la iu">资源服务器:</strong>受保护资源所在的位置。</li><li id="5486" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><strong class="la iu">客户端:</strong>客户端是请求访问资源的应用程序，在这里是我们刚刚下载的Django应用程序。</li><li id="43ff" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><strong class="la iu">授权服务器:</strong>该服务器为最终用户(资源所有者)提供了认证他/她自己的可能性。正确授权后，授权服务器向应用程序发布访问令牌。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi po"><img src="../Images/e8b0c62157062568f62ef4643ad55b66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CwV-RRDp7tIdDZT12SjSSw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用于Web服务器应用程序的OAuth 2.0图片由作者提供(灵感来自[7][8])</p></figure><p id="e10c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在下文中，我将向您展示如何使用模板应用程序通过Python启动授权工作流。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="a7b2" class="no mr it bd ms np nq dn mw nr ns dp na lh nt nu nc ll nv nw ne lp nx ny ng nz bi translated">从Microsoft Identity Platform请求访问令牌</h2><p id="8a3d" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">如前所述，应用程序首先需要向认证服务器发送请求。因此，我们正在使用OAuth 2.0的<strong class="la iu">微软身份平台</strong>实现。[7]</p><p id="ad1b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">单击Sign-in按钮调用<code class="fe oy oz pa pb b">tutorial.views.py</code>中的sign_in函数，该函数又使用<code class="fe oy oz pa pb b">get_sign_in_url</code>函数形成请求URL。</p><p id="1acd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在授权流程的第一步，客户端应用程序将用户指引到<code class="fe oy oz pa pb b">/authorize</code>端点。<strong class="la iu">请求</strong>包含了【7】:</p><ul class=""><li id="93ee" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated"><code class="fe oy oz pa pb b">Application ID</code>，在注册时分配给你的应用</li><li id="66dd" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><code class="fe oy oz pa pb b">Scope</code>，定义应用向用户请求的权限。</li><li id="75f4" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><code class="fe oy oz pa pb b">Redirect URI</code>，可通过您的应用程序发送和接收认证响应。</li></ul><p id="d5a0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">授权过程中需要的所有参数都存储在YAML文件<code class="fe oy oz pa pb b">oauth_settings.yml</code>中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/86ac7b30a22b5c5679c00d19d6f40e3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6odwcAWhXmBfRZEdMru0Hw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Django中的OAuth 2.0工作流—图片由作者提供</p></figure><p id="78b0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">(3)在用户对他/她自己进行身份验证并因此授予应用程序访问权限后，身份验证服务器将使用授权码进行响应，并将用户重定向到您指定的重定向URI。(4)连同您的<code class="fe oy oz pa pb b">App ID</code>和<code class="fe oy oz pa pb b">App Secret</code>，您可以向授权服务器请求一个<code class="fe oy oz pa pb b">Access Token</code>和<code class="fe oy oz pa pb b">Refresh Token</code>。(5)然后访问令牌给你访问API的能力，至少在<code class="fe oy oz pa pb b">scope</code>中定义了所需的权限。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/1c955db52fd9017c1a09eb143f810dad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lFnwk8nACdDb85OabYhQiw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Django中的OAuth 2.0工作流—图片由作者提供</p></figure><p id="fc24" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们可以访问所请求的资源。在接下来的内容中，我将向您展示如何检索您正在寻找的数据。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="bf97" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">使用图形API查询数据</h1><p id="cbb5" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">为了找到正确的数据端点，我们可以使用<a class="ae nn" href="https://developer.microsoft.com/en-us/graph/graph-explorer" rel="noopener ugc nofollow" target="_blank">图形浏览器</a>。它已经给了你一些关于你的帐户和各种微软应用程序的请求。如果您正在寻找给定查询没有提供的信息，那么看一下文档是值得的。(例如用于<a class="ae nn" href="https://docs.microsoft.com/en-us/onedrive/developer/rest-api/?view=odsp-graph-online" rel="noopener ugc nofollow" target="_blank"> OneDrive </a></p><p id="0809" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我对我的单驱动器存储中的数据特别感兴趣。然而，这个概念对于SharePoint、OneNote、Outlook、工作组等等是相同的。</p><p id="aed8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可能需要为<code class="fe oy oz pa pb b">oauth_settings.yml</code>中的scope变量添加适当的权限。你会在文档中找到<a class="ae nn" href="https://docs.microsoft.com/en-us/graph/permissions-reference" rel="noopener ugc nofollow" target="_blank">权限的概述。为了在一个驱动器中读写文件，将<code class="fe oy oz pa pb b">Files.ReadWrite.All</code>添加到<code class="fe oy oz pa pb b">scope</code>中。例如，我想检索文件夹<code class="fe oy oz pa pb b">/Bilder/Eigene Aufnahmen</code>中所有文件的信息。连同刚刚生成的访问令牌，我向<code class="fe oy oz pa pb b">/drive/root:/&lt;path&gt;:/children</code>发送一个GET请求，将数据发送到指定路径中的所有文件。</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pq pr l"/></div></figure><p id="fa9b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">视图函数<code class="fe oy oz pa pb b">one_drive</code>的最后一行是呈现HTML <code class="fe oy oz pa pb b">one_drive.html</code>，我现在创建它来打印我刚刚从API获得的数据。HTML <code class="fe oy oz pa pb b">one_drive.html</code>类似于<code class="fe oy oz pa pb b">calendar.html</code>，它已经是示例应用程序的一部分。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pq pr l"/></div></figure><p id="db3a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们只需要给路由器<code class="fe oy oz pa pb b">urls.py</code>添加查看功能<code class="fe oy oz pa pb b">one_drive</code>。</p><pre class="kj kk kl km gt pd pb pe pf aw pg bi"><span id="569e" class="no mr it pb b gy ph pi l pj pk"># &lt;tutorial.urls.py&gt;</span><span id="74b3" class="no mr it pb b gy ps pi l pj pk">from django.urls import path<br/>from . import views<br/><br/>urlpatterns = [<br/>  ...<br/>  path('calendar', views.calendar, name='calendar'),<br/>  path('one_drive', views.one_drive, name='one_drive'),<br/>]</span></pre><p id="9a6e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在<code class="fe oy oz pa pb b">http://localhost:8000/one_drive</code>向我展示了一个HTML表格，其中包含文件夹<code class="fe oy oz pa pb b">/Bilder/Eigene Aufnahme</code>中的所有文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pt"><img src="../Images/35f548ae1782ee8719f696b96fd9e1e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*40eIEU4NtNWfGQaIaDzehg.png"/></div></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="c889" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">用Plotly分析和可视化数据</h1><p id="b470" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">对于数据的可视化，我使用Plotly。如果还没有这样做，用pip按如下方式安装<a class="ae nn" href="https://plotly.com/" rel="noopener ugc nofollow" target="_blank">和</a>:</p><pre class="kj kk kl km gt pd pb pe pf aw pg bi"><span id="9474" class="no mr it pb b gy ph pi l pj pk">pip install plotly</span></pre><p id="8477" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面我感兴趣的是照片拍摄的时间。<br/>为了清晰起见，我按照拍摄的日历周总结了这些照片。</p><p id="4a45" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，我在字典<code class="fe oy oz pa pb b">files['values']</code>中添加了一个新的键-值对，它被定义为创建日期的日历周。之后，我将字典的值转移到熊猫数据框中。Pandas为我提供了许多操作数据框的方法，其中一种我将在下面使用。操作<code class="fe oy oz pa pb b">groupby </code>基于属性<code class="fe oy oz pa pb b">CreationWeek</code>对所有条目进行分组，方法<code class="fe oy oz pa pb b">.count()</code>对条目的出现次数进行计数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pq pr l"/></div></figure><p id="8293" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">想象成柱状图，整个事情看起来是这样的。这是一个简单的例子，展示了如何逐步构建自己的dashboard应用程序，向您展示您的Microsoft服务的最重要的关键数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl mi"><img src="../Images/d2153edfc21ca2e6c0f30333db8bf676.png" data-original-src="https://miro.medium.com/v2/format:webp/1*HDmi29s_AZLXFokZNfuTmQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者用plottly-Image将数据可视化</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="1ed7" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated"><strong class="ak">总结</strong></h1><p id="befb" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">在这篇文章中，我试图分享我使用Microsoft Graph API的经验:</p><ol class=""><li id="434d" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt pu ma mb mc bi translated">使用<strong class="la iu">微软身份平台</strong>的认证流程</li><li id="bd9a" class="lu lv it la b lb md le me lh mf ll mg lp mh lt pu ma mb mc bi translated">通过<strong class="la iu">图形API </strong>查询数据</li><li id="1c8d" class="lu lv it la b lb md le me lh mf ll mg lp mh lt pu ma mb mc bi translated">使用<strong class="la iu"> Plotly </strong>可视化数据</li></ol><p id="3cf0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">除了检索数据，图形界面还提供了广泛的POST选项。可以通过HTTP请求添加日历条目、上传文件或创建新的微软团队频道。这可以帮助你自动化你的过程。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="ec32" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">参考</h1><p id="e953" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh oa lj lk ll ob ln lo lp oc lr ls lt im bi translated">[1]微软图形概述，<a class="ae nn" href="https://docs.microsoft.com/en-us/graph/overview" rel="noopener ugc nofollow" target="_blank">https://docs.microsoft.com/en-us/graph/overview</a></p><p id="38e3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">[2]从Live SDK迁移到Microsoft Graph，<a class="ae nn" href="https://docs.microsoft.com/en-us/onedrive/developer/rest-api/concepts/migrating-from-live-sdk?view=odsp-graph-online" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/one drive/developer/rest-API/concepts/Migrating-from-Live-SDK？view=odsp-graph-online </a></p><p id="95f0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">[3]皮普安装，【https://pip.pypa.io/en/stable/reference/pip_install/】T21</p><p id="d7f3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">[4]虚拟环境和包，<a class="ae nn" href="https://docs.python.org/3/tutorial/venv.html" rel="noopener ugc nofollow" target="_blank">https://docs.python.org/3/tutorial/venv.html</a></p><p id="264b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">[5] OAuth 2.0授权框架，<a class="ae nn" href="https://auth0.com/docs/protocols/protocol-oauth2" rel="noopener ugc nofollow" target="_blank">https://auth0.com/docs/protocols/protocol-oauth2</a></p><p id="401b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">[6] OAuth 2.0 Workflow，<a class="ae nn" href="https://www.ibm.com/support/knowledgecenter/en/SS4J57_6.2.2.6/com.ibm.tivoli.fim.doc_6226/config/concept/OAuth20Workflow.html" rel="noopener ugc nofollow" target="_blank">https://www . IBM . com/support/knowledge center/en/ss4j 57 _ 6 . 2 . 2 . 6/com . IBM . Tivoli . FIM . doc _ 6226/config/concept/OAuth 20 Workflow . html</a></p><p id="2e17" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">[7]微软身份平台和OAuth 2.0授权代码流，<a class="ae nn" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-auth-code-flow" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/active-directory/developer/v2-OAuth 2-授权代码流</a></p><p id="d176" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">[8]从web服务器应用程序调用安全API，<a class="ae nn" href="https://oauth.vlaanderen.be/authorization/Help/Api/AuthorizationCodeGrant" rel="noopener ugc nofollow" target="_blank">https://oauth . vlaanderen . be/authorization/Help/API/AuthorizationCodeGrant</a></p></div></div>    
</body>
</html>