<html>
<head>
<title>Why Is Everyone at Kaggle Obsessed with Optuna For Hyperparameter Tuning?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么Kaggle的所有人都痴迷于Optuna进行超参数调优？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/why-is-everyone-at-kaggle-obsessed-with-optuna-for-hyperparameter-tuning-7608fdca337c?source=collection_archive---------1-----------------------#2021-08-01">https://towardsdatascience.com/why-is-everyone-at-kaggle-obsessed-with-optuna-for-hyperparameter-tuning-7608fdca337c?source=collection_archive---------1-----------------------#2021-08-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1499" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们通过试用来了解一下…</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cf9cf3a72bb18cab1965b03ed09b3596.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zvONsmZNnZHIlwjhJqgu5Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ky">照片由</strong> <a class="ae kz" href="https://pixabay.com/users/bomei615-2623913/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1751855" rel="noopener ugc nofollow" target="_blank"> <strong class="bd ky">博美</strong> </a> <strong class="bd ky">上</strong> <a class="ae kz" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1751855" rel="noopener ugc nofollow" target="_blank"> <strong class="bd ky"> Pixabay。</strong> </a> <strong class="bd ky">除特别注明外，所有图片均为作者所有。</strong></p></figure><h1 id="5231" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">介绍</h1><p id="2f87" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">原来我一直生活在岩石下。</p><p id="723d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">虽然每一个MOOC都教我使用GridSearch进行超参数调整，但Kagglers几乎已经专门使用Optuna两年了。这甚至早于我开始学习数据科学的时间。</p><p id="c984" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">Kaggle社区以其残酷的竞争而闻名，对于一个达到这种统治水平的包来说，它需要<strong class="lu iu">该死的好</strong>。在平台上活跃了一个月之后(并且<a class="ae kz" href="https://www.kaggle.com/bextuychiev" rel="noopener ugc nofollow" target="_blank">获得了两级专家资格</a>，我看到Optuna几乎在任何地方都被每个人使用。</p><p id="3d1f" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">那么，是什么让Optuna被最大的机器学习社区如此广泛地接受呢？在本帖中，我们将通过动手操作这个框架来回答这个问题。我们将了解它是如何工作的，以及它如何从任何模型中挤出每一点性能，包括神经网络。</p><div class="mt mu gp gr mv mw"><a href="https://ibexorigin.medium.com/membership" rel="noopener follow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd iu gy z fp nb fr fs nc fu fw is bi translated">通过我的推荐链接加入Medium-BEXGBoost</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">获得独家访问我的所有⚡premium⚡内容和所有媒体没有限制。支持我的工作，给我买一个…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">ibexorigin.medium.com</p></div></div><div class="nf l"><div class="ng l nh ni nj nf nk ks mw"/></div></div></a></div><p id="cac1" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">获得由强大的AI-Alpha信号选择和总结的最佳和最新的ML和AI论文:</p><div class="mt mu gp gr mv mw"><a href="https://alphasignal.ai/?referrer=Bex" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd iu gy z fp nb fr fs nc fu fw is bi translated">阿尔法信号|机器学习的极品。艾总结的。</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">留在循环中，不用花无数时间浏览下一个突破；我们的算法识别…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">alphasignal.ai</p></div></div><div class="nf l"><div class="nl l nh ni nj nf nk ks mw"/></div></div></a></div></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="7b06" class="la lb it bd lc ld nt lf lg lh nu lj lk jz nv ka lm kc nw kd lo kf nx kg lq lr bi translated">什么是Optuna？</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/fc0ea765d289556f60a7aeb4e33f47d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IBkpkOCS0anhUHWp.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ky"> Optuna标志</strong></p></figure><p id="97a2" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">Optuna是完全用Python编写的下一代自动超参数调优框架。</p><p id="1ae4" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">它最突出的特点是:</p><ul class=""><li id="ac6f" class="nz oa it lu b lv mo ly mp mb ob mf oc mj od mn oe of og oh bi translated">使用循环和条件来定义Pythonic搜索空间的能力。</li><li id="815f" class="nz oa it lu b lv oi ly oj mb ok mf ol mj om mn oe of og oh bi translated">与平台无关的API——您可以调优几乎任何ML、DL包/框架的估算器，包括Sklearn、PyTorch、TensorFlow、Keras、XGBoost、LightGBM、CatBoost等。</li><li id="cad9" class="nz oa it lu b lv oi ly oj mb ok mf ol mj om mn oe of og oh bi translated">内置了大量具有提前停止和修剪功能的优化算法。</li><li id="905c" class="nz oa it lu b lv oi ly oj mb ok mf ol mj om mn oe of og oh bi translated">简单的并行化，只需很少或不需要修改代码。</li><li id="fb91" class="nz oa it lu b lv oi ly oj mb ok mf ol mj om mn oe of og oh bi translated">内置对搜索结果可视化探索的支持。</li></ul><p id="d3f6" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在接下来的章节中，我们将尝试验证Optuna文档<a class="ae kz" href="https://optuna.readthedocs.io/en/stable/index.html" rel="noopener ugc nofollow" target="_blank">中的这些过于乐观的说法。</a></p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="8128" class="la lb it bd lc ld nt lf lg lh nu lj lk jz nv ka lm kc nw kd lo kf nx kg lq lr bi translated">Optuna基础</h1><p id="95a1" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">让我们通过调优一个类似<strong class="lu iu"> (x-1) + (y+3) </strong>的简单函数来熟悉Optuna API。我们知道该函数在<strong class="lu iu"> x=1 </strong>和<strong class="lu iu"> y=-3 </strong>时达到最小值。</p><blockquote class="on oo op"><p id="9a99" class="ls lt oq lu b lv mo ju lx ly mp jx ma or mq md me os mr mh mi ot ms ml mm mn im bi translated">你可以在这里找到这篇文章的笔记本。</p></blockquote><p id="36b9" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">让我们看看Optuna是否能找到这些:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="9ee2" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">导入<code class="fe ow ox oy oz b">optuna</code>后，我们定义一个目标，返回我们想要最小化的函数。</p><p id="6f29" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在目标的主体中，我们定义了要优化的参数，在本例中，是简单的<code class="fe ow ox oy oz b">x</code>和<code class="fe ow ox oy oz b">y</code>。参数<code class="fe ow ox oy oz b">trial</code>是optuna的一个特殊的试验对象，它为每个超参数做优化。</p><p id="d5c2" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">其中，它有一个<code class="fe ow ox oy oz b">suggest_float</code>方法，采用超参数的名称和范围来寻找其最佳值。换句话说，</p><pre class="kj kk kl km gt pa oz pb pc aw pd bi"><span id="9e89" class="pe lb it oz b gy pf pg l ph pi">x = trial.suggest_float("x", -7, 7)</span></pre><p id="cc16" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">和做GridSearch时的<code class="fe ow ox oy oz b">{"x": np.arange(-7, 7)}</code>差不多。</p><p id="0afa" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">为了开始优化，我们从Optuna创建一个<code class="fe ow ox oy oz b">study</code>对象，并将<code class="fe ow ox oy oz b">objective</code>函数传递给它的<code class="fe ow ox oy oz b">optimize</code>方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="cca0" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">相当接近，但没有你想要的那么接近。这里，我们只做了100次试验，可以看到:</p><pre class="kj kk kl km gt pa oz pb pc aw pd bi"><span id="9d77" class="pe lb it oz b gy pf pg l ph pi">&gt;&gt;&gt; len(study.trials)</span><span id="e46f" class="pe lb it oz b gy pj pg l ph pi">100</span></pre><p id="c59b" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在，我将介绍Optuna附带的第一个魔法。如果我们对结果不满意，我们可以在优化完成后继续优化！</p><p id="ed09" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">与其他类似工具相比，这是一个明显的优势，因为搜索完成后，他们会完全忘记之前的试验历史。Optuna没有！</p><p id="0de7" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">要继续搜索，用所需参数再次调用<code class="fe ow ox oy oz b">optimize</code>。在这里，我们将再运行100次试验:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="a439" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这一次，结果更接近最佳参数。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="c326" class="pe lb it bd lc pk pl dn lg pm pn dp lk mb po pp lm mf pq pr lo mj ps pt lq pu bi translated">关于Optuna术语和约定的说明</h2><p id="6e3b" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">在Optuna中，整个优化过程被称为<em class="oq">研究</em>。例如，以日志损失为度量来调优XGBoost参数是一项研究:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="5223" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">研究需要一个可以优化的函数。通常，该函数由用户定义，应命名为<code class="fe ow ox oy oz b">objective</code>，并应具有以下签名:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="38cc" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">它应该接受一个<code class="fe ow ox oy oz b">optuna.Trial</code>对象作为参数，并返回我们想要优化的指标。</p><p id="e129" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">正如我们在第一个例子中看到的，研究是一组<em class="oq">试验</em>的集合，其中每个试验，我们使用来自给定搜索空间的一组超参数来评估目标函数。</p><p id="7862" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">研究中的每个试验都被表示为<code class="fe ow ox oy oz b">optuna.Trial</code>类。这个类是Optuna如何找到参数的最佳值的关键。</p><p id="f187" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">为了开始一项研究，我们用<code class="fe ow ox oy oz b">direction</code>创建一个研究对象:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="7906" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">如果我们想要优化的指标是像ROC AUC或准确性这样的绩效分数，我们将方向设置为<code class="fe ow ox oy oz b">maximize</code>。否则，我们最小化损失函数，如RMSE、RMSLE、对数损失等。通过将方向设置为<code class="fe ow ox oy oz b">minimize</code>。</p><p id="4550" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">然后，我们将调用研究的<code class="fe ow ox oy oz b">optimize</code>方法，传递目标函数名称和我们想要的试验次数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="1ea7" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">接下来，我们将进一步研究如何创建这些目标函数。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="0300" class="la lb it bd lc ld nt lf lg lh nu lj lk jz nv ka lm kc nw kd lo kf nx kg lq lr bi translated">定义搜索空间</h1><p id="4fcb" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">通常，您在目标函数中做的第一件事是使用内置的Optuna方法创建搜索空间:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="729c" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在上面的目标函数中，我们创建了一个随机森林超参数的小搜索空间。</p><p id="a77e" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">搜索空间是一本普通的字典。要创建可能的值进行搜索，您必须使用试验对象的<code class="fe ow ox oy oz b">suggest_*</code>函数。</p><p id="40a8" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这些函数至少需要超参数名称、最小和最大范围，以搜索分类超参数的可能类别。</p><p id="a229" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">为了使空间更小，<code class="fe ow ox oy oz b">suggest_float</code>和<code class="fe ow ox oy oz b">suggest_int</code>有额外的<code class="fe ow ox oy oz b">step</code>或<code class="fe ow ox oy oz b">log</code>参数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="d507" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">上图中，我们将<code class="fe ow ox oy oz b">n_estimators</code>的分布宁滨了200个区间，使其更加稀疏。另外，<code class="fe ow ox oy oz b">learning_rate</code>是以对数标度定义的。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="f66c" class="la lb it bd lc ld nt lf lg lh nu lj lk jz nv ka lm kc nw kd lo kf nx kg lq lr bi translated">如何对可能的参数进行采样？</h1><p id="6f46" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">在底层，Optuna有几个负责参数采样的类。这些是:</p><ul class=""><li id="067a" class="nz oa it lu b lv mo ly mp mb ob mf oc mj od mn oe of og oh bi translated"><code class="fe ow ox oy oz b">GridSampler</code>:同Sklearn的<code class="fe ow ox oy oz b">GridSearch</code>。不要用于大搜索空间！</li><li id="9c73" class="nz oa it lu b lv oi ly oj mb ok mf ol mj om mn oe of og oh bi translated"><code class="fe ow ox oy oz b">RandomSampler</code>:同Sklearn的<code class="fe ow ox oy oz b">RandomizedGridSearch</code>。</li><li id="26e7" class="nz oa it lu b lv oi ly oj mb ok mf ol mj om mn oe of og oh bi translated"><code class="fe ow ox oy oz b">TPESampler</code>:树形结构Parzen估计器采样器——使用核拟合的贝叶斯优化</li><li id="db60" class="nz oa it lu b lv oi ly oj mb ok mf ol mj om mn oe of og oh bi translated"><code class="fe ow ox oy oz b">CmaEsSampler</code>:基于CMA ES算法的采样器(不允许分类超参数)。</li></ul><blockquote class="on oo op"><p id="1415" class="ls lt oq lu b lv mo ju lx ly mp jx ma or mq md me os mr mh mi ot ms ml mm mn im bi translated">我不知道最后两个采样器是如何工作的，我不希望这会影响我与Optuna的任何交互。</p></blockquote><p id="a475" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">默认情况下使用TPE采样器——它试图通过提高上一次试验的分数来对超参数候选者进行采样。换句话说，您可以期待使用这个采样器从一次试验到另一次试验的增量(也许是边际)改进。</p><p id="75a8" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">如果你想切换采样器，你可以这样做:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="5910" class="la lb it bd lc ld nt lf lg lh nu lj lk jz nv ka lm kc nw kd lo kf nx kg lq lr bi translated">使用梯度推进回归器的端到端示例</h1><p id="8fe3" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">让我们把学到的一切都变成有形的东西。我们将使用一些数字和分类特征来预测企鹅的体重。</p><p id="41e6" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我们将使用Sklearn <code class="fe ow ox oy oz b">GradientBoostingRegressor</code>建立一个基本分数，并通过使用Optuna进行调整来提高它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="5515" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在，我们将创建<code class="fe ow ox oy oz b">objective</code>函数并定义搜索空间:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="f595" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我们构建了一个包含5个不同范围的超参数和一些静态超参数的网格，用于随机种子和早期停止。</p><p id="50d2" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">上面的目标函数略有不同——它接受数据集、得分和<code class="fe ow ox oy oz b">cv</code>的附加参数。这就是为什么我们必须将它包装在另一个函数中。一般来说，您可以使用如下的<code class="fe ow ox oy oz b">lambda</code>函数来实现:</p><blockquote class="on oo op"><p id="1023" class="ls lt oq lu b lv mo ju lx ly mp jx ma or mq md me os mr mh mi ot ms ml mm mn im bi translated">如果您想传递接受多个参数的<code class="fe ow ox oy oz b">objective</code>函数，这是推荐的语法。</p></blockquote><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="336d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在不到一分钟的时间里，我们实现了显著的分数提升(就日志错误而言，0.004是相当不错的)。我们只做了100次试验。让我们大胆地再跑200圈，看看会发生什么:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="ab41" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">分数<em class="oq">确实</em>提高了，但幅度不大。看起来我们在第一次运行中达到了最大值！</p><p id="3cdc" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">最重要的是，我们使用常规网格搜索可能需要几个小时的搜索空间，仅用了2分多钟就获得了这个分数。</p><p id="34a7" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我不知道你怎么想，但是我被说服了！</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="0612" class="la lb it bd lc ld nt lf lg lh nu lj lk jz nv ka lm kc nw kd lo kf nx kg lq lr bi translated">使用视觉效果获得更多见解和更智能的调整</h1><p id="fe5a" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">Optuna在其<code class="fe ow ox oy oz b">visualization</code>子包下提供了广泛的地块。这里我们只讨论2个，我认为是最有用的。</p><p id="9752" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">首先，让我们绘制最后一个<code class="fe ow ox oy oz b">study</code>的优化历史:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pv"><img src="../Images/2409483b687def1027e3a502fdc57b24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hThJoesQgvkkeHRsfswYvw.png"/></div></div></figure><p id="4343" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这个剧情告诉我们，Optuna只经过几次尝试就让分数收敛到了最小值。</p><p id="15fe" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">接下来，让我们绘制超参数重要性:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pw"><img src="../Images/da72175521ed130de0956b3cc8e7b871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lTIRw2ZpjvLJOyqCIh0knQ.png"/></div></div></figure><p id="6514" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这个情节非常有用！它告诉我们几件事，包括:</p><ul class=""><li id="0524" class="nz oa it lu b lv mo ly mp mb ob mf oc mj od mn oe of og oh bi translated"><code class="fe ow ox oy oz b">max_depth</code>和<code class="fe ow ox oy oz b">learning_rate</code>最重要</li><li id="12a9" class="nz oa it lu b lv oi ly oj mb ok mf ol mj om mn oe of og oh bi translated"><code class="fe ow ox oy oz b">subsample</code>和<code class="fe ow ox oy oz b">max_features</code>对最小化损失没有用</li></ul><p id="ca45" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">当调整具有许多超参数的模型时，这样的图很方便。例如，您可以进行40–50次试验，并绘制参数重要性。</p><p id="31e6" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">根据情节，您可能会决定丢弃一些不太重要的参数，并为其他参数提供更大的搜索空间，这可能会减少搜索时间和空间。</p><p id="0113" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">有关Optuna支持的绘图类型的更多信息，您可以查看文档的本页。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="b495" class="la lb it bd lc ld nt lf lg lh nu lj lk jz nv ka lm kc nw kd lo kf nx kg lq lr bi translated">摘要</h1><p id="64a3" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">我想我们都同意Optuna没有辜负我在介绍中对T2的大肆宣传。太棒了。</p><p id="7674" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">本文只给出了使用Optuna可以做的基本工作。事实上，Optuna有更大的能力。我们今天没有谈到的一些关键话题:</p><ul class=""><li id="ddd8" class="nz oa it lu b lv mo ly mp mb ob mf oc mj od mn oe of og oh bi translated"><a class="ae kz" href="https://github.com/optuna/optuna-examples/" rel="noopener ugc nofollow" target="_blank">Optuna与其他ML/DL框架的用例</a></li><li id="e768" class="nz oa it lu b lv oi ly oj mb ok mf ol mj om mn oe of og oh bi translated"><a class="ae kz" href="https://optuna.readthedocs.io/en/stable/tutorial/10_key_features/003_efficient_optimization_algorithms.html#activating-pruners" rel="noopener ugc nofollow" target="_blank">选择剪枝算法，立即剔除没有希望的试验</a></li><li id="4813" class="nz oa it lu b lv oi ly oj mb ok mf ol mj om mn oe of og oh bi translated"><a class="ae kz" href="https://optuna.readthedocs.io/en/stable/tutorial/10_key_features/004_distributed.html" rel="noopener ugc nofollow" target="_blank">并行化</a></li></ul><p id="e10d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">最酷的是:</p><ul class=""><li id="1726" class="nz oa it lu b lv mo ly mp mb ob mf oc mj od mn oe of og oh bi translated"><a class="ae kz" href="https://optuna.readthedocs.io/en/stable/tutorial/20_recipes/001_rdb.html#sphx-glr-tutorial-20-recipes-001-rdb-py" rel="noopener ugc nofollow" target="_blank">使用SQLite或其他数据库(本地或远程)运行具有恢复/暂停功能的大规模优化</a></li></ul><p id="ebc3" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">请务必查看相关文档页面的链接。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi px"><img src="../Images/f91b8a21f12d3c3b7d428e0f8d5f48be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*KeMS7gxVGsgx8KC36rSTcg.gif"/></div></div></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="57b8" class="la lb it bd lc ld nt lf lg lh nu lj lk jz nv ka lm kc nw kd lo kf nx kg lq lr bi translated">您可能也会感兴趣…</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="https://towardsdatascience.com/how-to-work-with-million-row-datasets-like-a-pro-76fb5c381cdd"><div class="gh gi py"><img src="../Images/7298beea947c51a0a98ab476c112f601.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b9H_XNEVk6gg4kES6oBuOg.png"/></div></a></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="https://towardsdatascience.com/how-to-beat-the-heck-out-of-xgboost-with-lightgbm-comprehensive-tutorial-5eba52195997"><div class="gh gi pz"><img src="../Images/98badd48ca7a7a93719ec7b1e2bdfc09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7uKp-P-Q5I4HlRXH3iuZtA.png"/></div></a></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="https://towardsdatascience.com/love-3blue1brown-animations-learn-how-to-create-your-own-in-python-in-10-minutes-8e0430cf3a6d"><div class="gh gi qa"><img src="../Images/735b0439c5891f3beeb750ed5f4fa895.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*fy66XTy9i3DtrwRu0C4GQQ.png"/></div></a></figure><ul class=""><li id="29d5" class="nz oa it lu b lv mo ly mp mb ob mf oc mj od mn oe of og oh bi translated"><a class="ae kz" rel="noopener" target="_blank" href="/automatic-hyperparameter-tuning-with-sklearn-gridsearchcv-and-randomizedsearchcv-e94f53a518ee?source=your_stories_page-------------------------------------">使用Sklearn GridSearchCV和RandomizedSearchCV进行自动超参数调整</a></li><li id="b4b3" class="nz oa it lu b lv oi ly oj mb ok mf ol mj om mn oe of og oh bi translated">【HalvingGridSearch使超参数调谐速度提高了11倍</li><li id="c5e3" class="nz oa it lu b lv oi ly oj mb ok mf ol mj om mn oe of og oh bi translated"><a class="ae kz" rel="noopener" target="_blank" href="/20-burning-xgboost-faqs-answered-to-use-the-library-like-a-pro-f8013b8df3e4?source=your_stories_page-------------------------------------"> 20烧XGBoost常见问题解答像专业人士一样使用库</a></li></ul></div></div>    
</body>
</html>