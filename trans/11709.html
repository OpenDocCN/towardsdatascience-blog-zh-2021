<html>
<head>
<title>How to Build a Knowledge Graph with Neo4J and Transformers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Neo4J 和变形金刚搭建知识图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-build-a-knowledge-graph-with-neo4j-and-transformers-72b9471d6969?source=collection_archive---------2-----------------------#2021-11-21">https://towardsdatascience.com/how-to-build-a-knowledge-graph-with-neo4j-and-transformers-72b9471d6969?source=collection_archive---------2-----------------------#2021-11-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1bd9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用自定义命名实体识别和关系提取模型</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/235a98063c514344a5cb0643db2d0ece.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*WeVWx0L55N859fwYQXZaQQ.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">图片作者:Neo4j 中的知识图谱</p></figure><h1 id="e2ab" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">介绍</h1><p id="a1d5" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在我的上一篇文章“使用 BERT Transformer 构建求职知识图”中，我们探讨了如何使用定制 Transformer 模型提取的实体和关系，从职位描述中创建知识图。虽然我们能够使用 Python 库<a class="ae mi" href="https://networkx.org/" rel="noopener ugc nofollow" target="_blank"> networkX </a>获得节点和关系的良好视觉效果，但实际的图形存在于 Python 内存中，而不是存储在数据库中。当试图创建一个可伸缩的应用程序时，这可能会有问题，因为您必须存储一个不断增长的知识图。这就是 Neo4j 的优势所在，它使您能够将图表存储在一个功能齐全的数据库中，从而允许您管理大量数据。此外，Neo4j 的 Cypher 语言丰富，易于使用，非常直观。</p><p id="9c2b" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">在本文中，我将展示如何使用基于转换器的命名实体识别(NER)和 spacy 的关系提取模型，从工作描述中构建知识图。这里描述的方法可以用于任何不同的领域，例如生物医学、金融、保健等。</p><p id="03e5" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">以下是我们将要采取的步骤:</p><ul class=""><li id="9159" class="mo mp it lo b lp mj ls mk lv mq lz mr md ms mh mt mu mv mw bi translated">在 google colab 中加载我们微调过的变压器 NER 和空间关系提取模型</li><li id="2e57" class="mo mp it lo b lp mx ls my lv mz lz na md nb mh mt mu mv mw bi translated">创建一个 Neo4j 沙箱并添加我们的实体和关系</li><li id="f6d9" class="mo mp it lo b lp mx ls my lv mz lz na md nb mh mt mu mv mw bi translated">查询我们的图表，找到与目标简历最匹配的工作，找到三个最受欢迎的技能和最高技能的共现</li></ul><p id="f41d" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">有关如何使用<a class="ae mi" href="https://ubiai.tools" rel="noopener ugc nofollow" target="_blank">ubai</a>生成训练数据以及微调 NER 和关系提取模型的更多信息，请查看以下文章:</p><ul class=""><li id="73c1" class="mo mp it lo b lp mj ls mk lv mq lz mr md ms mh mt mu mv mw bi translated">【UBIAI 简介:面向自然语言处理应用的易用文本注释</li><li id="3ff3" class="mo mp it lo b lp mx ls my lv mz lz na md nb mh mt mu mv mw bi translated"><a class="ae mi" href="https://ubiai.tools/blog/article/How-to-Train-a-Joint-Entities-and-Relation-Extraction-Classifier-using-BERT-Transformer-with-spaCy3" rel="noopener ugc nofollow" target="_blank">如何使用具有空间 3 的 BERT 变换器训练联合实体和关系提取分类器</a></li><li id="820e" class="mo mp it lo b lp mx ls my lv mz lz na md nb mh mt mu mv mw bi translated"><a class="ae mi" href="https://ubiai.tools/blog/article/how-to-fine-tune-bert-transformer-with-spacy3" rel="noopener ugc nofollow" target="_blank">如何用空间 3 微调 BERT 变压器</a></li></ul><p id="babb" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">工作描述数据集在<a class="ae mi" href="https://www.kaggle.com/airiddha/trainrev1" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>中公开。</p><p id="bf0e" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">在本教程结束时，我们将能够创建如下所示的知识图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/e4232b55843204c2885345969c17e483.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UHhyNpgj2cfqrA2KflYIWg.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片:职位描述知识图</p></figure><h1 id="a828" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">命名实体和关系抽取</h1><ul class=""><li id="f988" class="mo mp it lo b lp lq ls lt lv nh lz ni md nj mh mt mu mv mw bi translated">首先，我们加载 NER 和关系模型的依赖关系以及 NER 模型本身，该模型之前已经过微调，可以提取技能、文凭、文凭专业和多年经验:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><ul class=""><li id="9c1b" class="mo mp it lo b lp mj ls mk lv mq lz mr md ms mh mt mu mv mw bi translated">加载我们要从中提取实体和关系的作业数据集:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><ul class=""><li id="a880" class="mo mp it lo b lp mj ls mk lv mq lz mr md ms mh mt mu mv mw bi translated">从作业数据集中提取实体:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="d426" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">在将提取的实体输入到关系提取模型之前，我们可以先看一下这些实体:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="16c8" class="nr kv it nn b gy ns nt l nu nv">[('stock market analysis', 'SKILLS'),<br/> ('private investor', 'SKILLS'),<br/> ('C++', 'SKILLS'),<br/> ('Investment Software', 'SKILLS'),<br/> ('MS Windows', 'SKILLS'),<br/> ('web development', 'SKILLS'),<br/> ('Computer Science', 'DIPLOMA_MAJOR'),<br/> ('AI', 'SKILLS'),<br/> ('software development', 'SKILLS'),<br/> ('coding', 'SKILLS'),<br/> ('C', 'SKILLS'),<br/> ('C++', 'SKILLS'),<br/> ('Visual Studio', 'SKILLS'),<br/> ('2 years', 'EXPERIENCE'),<br/> ('C/C++ development', 'SKILLS'),<br/> ('data compression', 'SKILLS'),<br/> ('financial markets', 'SKILLS'),<br/> ('financial calculation', 'SKILLS'),<br/> ('GUI design', 'SKILLS'),<br/> ('Windows development', 'SKILLS'),<br/> ('MFC', 'SKILLS'),<br/> ('Win', 'SKILLS'),<br/> ('HTTP', 'SKILLS'),<br/> ('TCP/IP', 'SKILLS'),<br/> ('sockets', 'SKILLS'),<br/> ('network programming', 'SKILLS'),<br/> ('System administration', 'SKILLS')]</span></pre><p id="9482" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">我们现在准备预测关系；首先加载关系提取模型，确保将目录更改为 rel_component/scripts，以访问关系模型所需的所有脚本。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="48f1" class="nr kv it nn b gy ns nt l nu nv">cd rel_component/</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="1830" class="nr kv it nn b gy ns nt l nu nv">Predicted relations:  entities: ('5+ years', 'software engineering') --&gt; predicted relation: {'DEGREE_IN': 9.5471655e-08, 'EXPERIENCE_IN': 0.9967771}  entities: ('5+ years', 'technical management') --&gt; predicted relation: {'DEGREE_IN': 1.1285037e-07, 'EXPERIENCE_IN': 0.9961034}  entities: ('5+ years', 'designing') --&gt; predicted relation: {'DEGREE_IN': 1.3603304e-08, 'EXPERIENCE_IN': 0.9989103}  entities: ('4+ years', 'performance management') --&gt; predicted relation: {'DEGREE_IN': 6.748373e-08, 'EXPERIENCE_IN': 0.92884386}</span></pre><h1 id="59f4" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">Neo4J</h1><p id="1d88" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我们现在准备将我们的作业数据集和提取的数据加载到 neo4j 数据库中。</p><ul class=""><li id="4957" class="mo mp it lo b lp mj ls mk lv mq lz mr md ms mh mt mu mv mw bi translated">首先，启动一个<a class="ae mi" href="https://sandbox.neo4j.com/?usecase=blank-sandbox" rel="noopener ugc nofollow" target="_blank"> neo4j 空白沙箱</a>并添加您的连接细节，如下所示:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><ul class=""><li id="8e87" class="mo mp it lo b lp mj ls mk lv mq lz mr md ms mh mt mu mv mw bi translated">接下来，我们将文档、实体和关系添加到知识图中。请注意，我们需要从实体 EXPERIENCE 的名称中提取整数年数，并将其存储为一个属性。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="78c5" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">现在开始有趣的部分。我们准备启动知识图并运行查询。让我们运行一个查询来查找与目标概要文件最匹配的职务:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="a0ba" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">以表格形式显示常见实体的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nw"><img src="../Images/4f39737a1df13ab557be81c2ff2ddc75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8_vfbLZtxlPNKXXaPhWXSw.png"/></div></div></figure><p id="7537" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">在图形可视化中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/235a98063c514344a5cb0643db2d0ece.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*WeVWx0L55N859fwYQXZaQQ.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片:基于最佳工作匹配</p></figure><p id="c064" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">虽然该数据集仅由 29 个职位描述组成，但是这里描述的方法可以应用于具有数千个职位的大规模数据集。只需几行代码，我们就可以立即提取与目标概要文件最匹配的职务。</p><p id="9d26" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">让我们找出最受欢迎的技能:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="e1ec" class="nr kv it nn b gy ns nt l nu nv">query = """</span><span id="eabb" class="nr kv it nn b gy nx nt l nu nv">MATCH (s:SKILLS)&lt;-[:MENTIONS]-(o:Offer)</span><span id="c7ef" class="nr kv it nn b gy nx nt l nu nv">RETURN s.name as skill, count(o) as freq</span><span id="b0bb" class="nr kv it nn b gy nx nt l nu nv">ORDER BY freq DESC</span><span id="3636" class="nr kv it nn b gy nx nt l nu nv">LIMIT 10</span><span id="ee17" class="nr kv it nn b gy nx nt l nu nv">"""</span><span id="af16" class="nr kv it nn b gy nx nt l nu nv">res = neo4j_query(query)</span><span id="044e" class="nr kv it nn b gy nx nt l nu nv">res</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ny"><img src="../Images/417c0818dd1cc4e775bc1336cf36e73c.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*_lPE_4-Y-hIn7qDVjFGang.png"/></div></div></figure><p id="7069" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">和需要最高年经验的技能:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="d775" class="nr kv it nn b gy ns nt l nu nv">query = """</span><span id="8335" class="nr kv it nn b gy nx nt l nu nv">MATCH (s:SKILLS)--(r:Relation)--(e:EXPERIENCE) where r.type = "EXPERIENCE_IN"</span><span id="2294" class="nr kv it nn b gy nx nt l nu nv">return s.name as skill,e.years as years</span><span id="33b6" class="nr kv it nn b gy nx nt l nu nv">ORDER BY years DESC</span><span id="f4e4" class="nr kv it nn b gy nx nt l nu nv">LIMIT 10</span><span id="692c" class="nr kv it nn b gy nx nt l nu nv">"""</span><span id="173c" class="nr kv it nn b gy nx nt l nu nv">res = neo4j_query(query)</span><span id="c521" class="nr kv it nn b gy nx nt l nu nv">res</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/836486d9431fbfb8abf1faf59307baee.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*0eAaXNaRK6IbR7-bHWVyxg.png"/></div></figure><p id="87fb" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">网站开发和支持需要最高年的经验，其次是安全设置。</p><p id="7ea5" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">最后，让我们检查一下最常出现的一对技能:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="7cee" class="nr kv it nn b gy ns nt l nu nv">neo4j_query("""</span><span id="3f4a" class="nr kv it nn b gy nx nt l nu nv">MATCH (s1:SKILLS)&lt;-[:MENTIONS]-(:Offer)-[:MENTIONS]-&gt;(s2:SKILLS)</span><span id="6f9a" class="nr kv it nn b gy nx nt l nu nv">WHERE id(s1) &lt; id(s2)</span><span id="bdc3" class="nr kv it nn b gy nx nt l nu nv">RETURN s1.name as skill1, s2.name as skill2, count(*) as cooccurrence</span><span id="db67" class="nr kv it nn b gy nx nt l nu nv">ORDER BY cooccurrence</span><span id="0f6e" class="nr kv it nn b gy nx nt l nu nv">DESC LIMIT 5</span><span id="74c7" class="nr kv it nn b gy nx nt l nu nv">""")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oa"><img src="../Images/09963c37b204cf46ac1dcd696298480b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SY2Vm0UgTds7TR-CRo_m1w.png"/></div></div></figure><h1 id="dbbe" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">结论:</h1><p id="17fb" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在这篇文章中，我们描述了如何利用基于变形金刚的 NER 和斯帕西的关系提取模型，用 Neo4j 创建知识图。除了信息提取之外，图拓扑可以用作另一个机器学习模型的输入。</p><p id="d2a7" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">将 NLP 与 Neo4j 的 graph DB 结合起来，将会加速许多领域的信息发现，在医疗保健和生物医学领域有更显著的应用。</p><p id="4a31" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">如果您有任何问题或想要为您的特定案例创建定制模型，请在下面留言或发送电子邮件至 admin@ubiai.tools。</p><p id="1623" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">在推特上关注我们<a class="ae mi" href="https://twitter.com/UBIAI5" rel="noopener ugc nofollow" target="_blank"> @UBIAI5 </a></p></div></div>    
</body>
</html>