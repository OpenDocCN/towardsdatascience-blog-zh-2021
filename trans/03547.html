<html>
<head>
<title>Introduction to Google’s Compact Language Detector v3 in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中Google的Compact Language Detector v3简介</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introduction-to-googles-compact-language-detector-v3-in-python-b6887101ae47?source=collection_archive---------27-----------------------#2021-03-22">https://towardsdatascience.com/introduction-to-googles-compact-language-detector-v3-in-python-b6887101ae47?source=collection_archive---------27-----------------------#2021-03-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8bda" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一种用于语言识别的神经网络模型</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/86c0bfdca912a8d2df5e0036a5c88953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rumbfw6oca_lblNuRH3xng.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">汉娜·赖特在<a class="ae ky" href="/s/photos/language?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2c17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过阅读这篇文章，你将学会使用Google CLD 3的Python绑定来检测和识别文本中使用的语言。供您参考，Compact Language Detector v3 (CLD3)是Google发布的一个语言识别包。在撰写本文时，它已经对大多数通用语言提供了巨大的支持。您可以在以下链接中找到<a class="ae ky" href="https://github.com/google/cld3#supported-languages" rel="noopener ugc nofollow" target="_blank">完整列表。</a></p><p id="192c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它包含基于C++的训练模型和推理代码。根据官方文档</p><blockquote class="lv lw lx"><p id="a16c" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">“…推理代码从输入文本中提取字符ngrams，并计算每个字符出现的时间。</p><p id="77be" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">该模型根据分数平均对应于每个ngram类型的嵌入，并且平均的嵌入被连接以产生嵌入层。网络的其余组件是一个隐藏(校正线性)层和一个softmax层。"</p></blockquote><p id="8e81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CLD3的基本架构如下，使用<code class="fe mc md me mf b">banana</code>作为输入文本:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mg"><img src="../Images/e9b24d57f1bb2cf48908f6e56822e1c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xeWGzsTK6b-D12pe.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片取自<a class="ae ky" href="https://github.com/google/cld3" rel="noopener ugc nofollow" target="_blank"> CLD3的Github </a>页面</p></figure><p id="2d4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">自2020年8月底以来，他们发布了一个官方的Python包，其中带有Python推理代码。从官方库中查看下面的<a class="ae ky" href="https://github.com/google/cld3/blob/master/gcld3/pybind_ext.cc" rel="noopener ugc nofollow" target="_blank">代码，了解基于<code class="fe mc md me mf b">pybind</code>包的实际实现。</a></p><p id="b09d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们继续下一部分，开始安装必要的模块。</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="3012" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">设置</h1><p id="d29c" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">为了从PyPI安装CLD3，您需要在本地计算机上安装以下附加软件包:</p><ul class=""><li id="950e" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated">Protobuf编译器是<code class="fe mc md me mf b">protoc</code>的可执行文件</li><li id="8519" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">Protobuf开发头文件和<code class="fe mc md me mf b">libprotoc</code>库</li><li id="6ed0" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">一个编译器，最好是<code class="fe mc md me mf b">g++</code></li></ul><h2 id="aa72" class="nz mp it bd mq oa ob dn mu oc od dp my li oe of na lm og oh nc lq oi oj ne ok bi translated">原蟾蜍</h2><p id="4572" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">如果您使用的是Debian/Ubuntu操作系统，请运行以下命令:</p><pre class="kj kk kl km gt ol mf om on aw oo bi"><span id="f76e" class="nz mp it mf b gy op oq l or os">sudo apt-get install -y --no-install-recommends g++ protobuf-compiler libprotobuf-dev</span></pre><p id="27b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关其他操作系统安装过程的更多信息，请查看自述文件中的<a class="ae ky" href="https://github.com/protocolbuffers/protobuf/tree/master/src" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="1e6d" class="nz mp it bd mq oa ob dn mu oc od dp my li oe of na lm og oh nc lq oi oj ne ok bi translated">CLD3</h2><p id="5342" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">强烈建议您在继续安装之前创建一个虚拟环境。激活它并在您的终端中运行以下命令来安装CLD3的官方Python绑定:</p><pre class="kj kk kl km gt ol mf om on aw oo bi"><span id="d225" class="nz mp it mf b gy op oq l or os">pip install gcld3</span></pre></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="ac07" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">履行</h1><p id="636c" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">一旦安装了所有必需的包，就可以直接在Python脚本中使用它。创建一个名为<code class="fe mc md me mf b">test.py</code>的新Python脚本。</p><h2 id="2b32" class="nz mp it bd mq oa ob dn mu oc od dp my li oe of na lm og oh nc lq oi oj ne ok bi translated">导入</h2><p id="d3d0" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">在文件顶部添加以下import语句。</p><pre class="kj kk kl km gt ol mf om on aw oo bi"><span id="64b1" class="nz mp it mf b gy op oq l or os">import gcld3</span></pre><h2 id="0d64" class="nz mp it bd mq oa ob dn mu oc od dp my li oe of na lm og oh nc lq oi oj ne ok bi translated">语言标识符对象</h2><p id="47fe" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">接下来，初始化一个新的<code class="fe mc md me mf b">NNetLanguageIdentifier</code>对象。</p><pre class="kj kk kl km gt ol mf om on aw oo bi"><span id="1745" class="nz mp it mf b gy op oq l or os">detector = gcld3.NNetLanguageIdentifier(min_num_bytes=0, max_num_bytes=1000)</span></pre><p id="15b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它接受以下参数:</p><ul class=""><li id="7958" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated"><code class="fe mc md me mf b">min_num_bytes</code>:推断时要考虑的最小字节数。将此项设置为大于0的值将返回空字符串的<code class="fe mc md me mf b">und</code>。</li><li id="1fe1" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated"><code class="fe mc md me mf b">max_num_bytes</code>:推断时要考虑的最大字节数。如果输入文本超过了设置的值，它将截断多余的字节。</li></ul><p id="0bd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想过滤掉空字符串和短字符串，可以按如下方式初始化实例:</p><pre class="kj kk kl km gt ol mf om on aw oo bi"><span id="1bc9" class="nz mp it mf b gy op oq l or os">detector = gcld3.NNetLanguageIdentifier(min_num_bytes=10, max_num_bytes=1000)</span></pre><h2 id="0fc3" class="nz mp it bd mq oa ob dn mu oc od dp my li oe of na lm og oh nc lq oi oj ne ok bi translated">检测单一语言</h2><p id="558e" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">CDL3附带了两个推理函数。第一个是用于单一语言推理的<code class="fe mc md me mf b">FindLanguage</code>函数。它接受代表样本文本的单个<code class="fe mc md me mf b">text</code>参数。</p><pre class="kj kk kl km gt ol mf om on aw oo bi"><span id="5938" class="nz mp it mf b gy op oq l or os">sample = "Welcome to Medium."<br/>result = detector.FindLanguage(text=sample)</span></pre><p id="2d8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它返回一个包含以下字段的<code class="fe mc md me mf b">Result</code>对象:</p><ul class=""><li id="23d0" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated"><code class="fe mc md me mf b">language</code>:BCP 47式表示的语言代码。</li><li id="cab9" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated"><code class="fe mc md me mf b">is_reliable</code>:反映检测可靠性的布尔值。</li><li id="4a0a" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated"><code class="fe mc md me mf b">proportion</code>:float，表示样本文本中预测语言的比例和权重。范围从0到1。该字段在多语言检测过程中很有用。</li><li id="dcbe" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated"><code class="fe mc md me mf b">probability</code>:预测的置信度。范围从0到1。</li></ul><p id="0d2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只需如下调用每个字段即可获得相应的值:</p><pre class="kj kk kl km gt ol mf om on aw oo bi"><span id="2cd9" class="nz mp it mf b gy op oq l or os">result.language</span><span id="f012" class="nz mp it mf b gy ot oq l or os">result.is_reliable</span><span id="f13b" class="nz mp it mf b gy ot oq l or os">result.proportion</span><span id="0dbf" class="nz mp it mf b gy ot oq l or os">result.probability</span></pre><h2 id="3710" class="nz mp it bd mq oa ob dn mu oc od dp my li oe of na lm og oh nc lq oi oj ne ok bi translated">检测多种语言</h2><p id="e282" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">您应该使用<code class="fe mc md me mf b">FindTopNMostFreqLangs</code>来检测多种语言。除了<code class="fe mc md me mf b">text</code>参数，它还接受另一个名为<code class="fe mc md me mf b">num_langs</code>的整数参数。</p><pre class="kj kk kl km gt ol mf om on aw oo bi"><span id="b405" class="nz mp it mf b gy op oq l or os">sample = ("Welcome to Medium. Bienvenido a Medium.")<br/>results = detector.FindTopNMostFreqLangs(text=sample, num_langs=2)</span></pre><p id="bb52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mc md me mf b">FindTopNMostFreqLangs</code>返回一个<code class="fe mc md me mf b">Result</code>对象列表。只需在一个循环中调用相应的字段，就可以获得所需的输出。</p><pre class="kj kk kl km gt ol mf om on aw oo bi"><span id="aeba" class="nz mp it mf b gy op oq l or os">for i in results:<br/>    print(i.language)</span></pre><p id="2ba7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，列表长度基于<code class="fe mc md me mf b">num_langs</code>。如果将它的值设置为5，它将返回列表中的5个<code class="fe mc md me mf b">Result</code>对象。</p><p id="0774" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在<a class="ae ky" href="https://gist.github.com/wfng92/509f8c83d366b3d7ef35f71caeaf751b" rel="noopener ugc nofollow" target="_blank">下面的要点</a>中找到完整的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="dfeb" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">结论</h1><p id="d2e9" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">让我们回顾一下你今天所学的内容。</p><p id="97bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文首先简要介绍了Google的Compact Language Detector v3背后的基本架构和概念。</p><p id="765a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，它讲述了基于您所拥有的操作系统的安装过程。CLD3的Python包通过<code class="fe mc md me mf b">pip install</code>安装。</p><p id="cb1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在实现部分，以<code class="fe mc md me mf b">FindLanguage</code>和<code class="fe mc md me mf b">FindTopNMostFreqLangs</code>函数为基础进行说明。这两个函数都返回<code class="fe mc md me mf b">a single</code>或一个包含一些有用参数的<code class="fe mc md me mf b">Result</code>对象列表，如<code class="fe mc md me mf b">language</code>和<code class="fe mc md me mf b">probability</code>。</p><p id="0cc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢你阅读这篇文章。希望你会回来看我的其他文章！</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="e3c1" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">参考</h1><ol class=""><li id="2b9f" class="nl nm it lb b lc ng lf nh li ow lm ox lq oy lu oz nr ns nt bi translated"><a class="ae ky" href="https://github.com/google/cld3" rel="noopener ugc nofollow" target="_blank"> Github — CLD3 </a></li><li id="2ea4" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu oz nr ns nt bi translated"><a class="ae ky" href="https://pypi.org/project/gcld3/" rel="noopener ugc nofollow" target="_blank"> PyPI — gcld3 </a></li></ol></div></div>    
</body>
</html>