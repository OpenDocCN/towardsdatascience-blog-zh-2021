<html>
<head>
<title>Online Learning with LakeFS and AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用LakeFS和AWS进行在线学习</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/online-learning-with-lakefs-and-aws-926d8ce04a9b?source=collection_archive---------30-----------------------#2021-06-17">https://towardsdatascience.com/online-learning-with-lakefs-and-aws-926d8ce04a9b?source=collection_archive---------30-----------------------#2021-06-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c27e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用版本控制系统和Amazon Web Services从头开始构建在线机器学习系统</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8b6a12115248b4a480cb392f69d81c26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QwAomd43Hm91oUJ8"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">克里斯·利维拉尼在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h2 id="18cc" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">在线学习简介</h2><p id="8107" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">大多数教程/文章通常专注于论文评论和实验室中机器学习模型的性能。然而，一个明显被忽视的领域是将模型投入生产并监控其性能，这被称为<a class="ae ky" href="https://medium.com/value-stream-design/online-machine-learning-515556ff72c5" rel="noopener">在线机器学习</a>或在线学习，模型不断地从新数据中学习。概念很简单。但是，在实施时会遇到一些挑战，例如:</p><ul class=""><li id="32b5" class="mo mp it lx b ly mq mb mr li ms lm mt lq mu mn mv mw mx my bi translated">需要将数据结构化地存储在易于使用和访问的存储平台中。</li><li id="e408" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn mv mw mx my bi translated">不断地标记新数据(如果你的模型被监督的话)。</li><li id="77cb" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn mv mw mx my bi translated">优化新的超参数，比如新数据的数量，之后应该开始新的训练迭代。</li><li id="74f5" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn mv mw mx my bi translated">在“动态”(在线)获取的数据中加入强大的数据过滤技术，更有可能出现大量不规则数据，这与实验室中为机器学习模型准备的数据不同。例如，假设我们正在讨论一个对微观病理切片进行分类的模型。一些载玻片可能比其他载玻片含有更多的灰尘，或者更糟，无法使用。这样的挑战通常会被忽视，直到很晚才被发现。它们可能看起来微不足道，但它们会破坏模型的性能。</li></ul><p id="b905" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">在线学习的主要优势在于它可以防止数据变得“陈旧”。有时，数据的性质和分布可能会随着时间的推移而改变。如果你的模型没有持续改进，它的性能会持续下降。监控可以帮助决定这一点:它与在线培训一起进行，因为它将表明模型的性能是否正在下降。它还将帮助您选择重新培训模型的频率。</p><h1 id="5508" class="nh la it bd lb ni nj nk le nl nm nn lh jz no ka ll kc np kd lp kf nq kg lt nr bi translated">在线学习系统和LakeFS</h1><p id="e568" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">一个典型的在线学习系统将由许多步骤组成。例如，假设您有一个机器学习web应用程序，它将上传的图像分类为“肿瘤性”和“非肿瘤性”。您的基础架构通常需要执行以下操作:</p><ol class=""><li id="8b15" class="mo mp it lx b ly mq mb mr li ms lm mt lq mu mn ns mw mx my bi translated"><strong class="lx iu">保存</strong>每个预测到存储器(如亚马逊S3)。定义预测的模式可能有点棘手，但是您通常会包括实际的图像、预测、置信度和日期。</li><li id="a08d" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn ns mw mx my bi translated"><strong class="lx iu">保存</strong>每个培训周期的模型性能指标。</li><li id="e218" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn ns mw mx my bi translated"><strong class="lx iu">将</strong>存储设备连接到模型服务器。这个连接管道可能包含一个过滤步骤，以保证数据的质量。</li><li id="482a" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn ns mw mx my bi translated"><strong class="lx iu">版本</strong>数据。这意味着您必须将新数据与旧数据一致地合并，然后重新训练。</li><li id="74d0" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn ns mw mx my bi translated"><strong class="lx iu">日志</strong>实验和监控。</li></ol><p id="ee71" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">在实际的场景中，您会不时地对模型进行多次训练，很可能会出现性能下降的迭代。发生这种情况有多种原因，例如迭代中使用的数据质量差。在这种情况下，您需要一个工具来帮助您快速撤销这种更改，检查导致性能下降的数据，等等。这里选择的数据版本控制工具是<a class="ae ky" href="https://lakefs.io/" rel="noopener ugc nofollow" target="_blank"> LakeFS </a>。</p><p id="5042" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">LakeFS将允许我们增强我们的存储系统，使其类似于一个<a class="ae ky" href="https://git-scm.com/book/en/v2/Getting-Started-What-is-Git%3F" rel="noopener ugc nofollow" target="_blank"> git </a>存储库。这意味着我们可以推送新的变更、删除旧的提交、检查版本控制日志等等。此外，这将允许我们创建并行的CI/CD管道，这将使实验过程更加自动化和容易。此外，如果这些实验中的任何一个在生产流水线上失败了，我们可以简单地恢复它们。LakeFS应该与灵活且可伸缩的数据存储机制相结合，比如S3对象存储。</p><p id="9462" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">LakeFS的好处之一是它可以很容易地与AWS S3对象存储一起使用。事不宜迟，我们开始吧。</p><h1 id="3b07" class="nh la it bd lb ni nj nk le nl nm nn lh jz no ka ll kc np kd lp kf nq kg lt nr bi translated">步骤1:在AWS RDS上创建PostgreSQL数据库</h1><p id="4ca7" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">有许多方法可以设置一个数据库并在LakeFS中使用它，但是在本教程中，我们将在AWS RDS上使用一个<a class="ae ky" href="https://www.postgresql.org/about/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL数据库</a>。你首先需要的是一个AWS账户。</p><p id="e603" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">登录后，转到<a class="ae ky" href="https://console.aws.amazon.com/rds/" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/rds/</a>并点击“创建数据库”，然后您应该会看到一个如下所示的窗口:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8a48e981e7e844bd989f517fcd3407e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xxDPpNEKEZM4p4Ie"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><p id="8b68" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">您可以将所有选项保留为默认选项，并使用Easy create创建数据库。就是这样！你很快就创建了一个数据库。现在，您只需要等待几分钟，它就会被创建。</p><h1 id="2e9a" class="nh la it bd lb ni nj nk le nl nm nn lh jz no ka ll kc np kd lp kf nq kg lt nr bi translated">步骤2:为存储库配置S3存储桶</h1><p id="1a59" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">现在我们有了PostgreSQL数据库，我们还需要一个S3对象存储桶。首先在顶部搜索栏搜索S3桶，然后点击第一个“S3”结果。之后，单击橙色的“创建存储桶”按钮，为您的存储桶添加一个名称并创建它。然后，您应该会看到类似这样的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b16e0f7bbb848e207476af67ed2f8658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vHc8juVg03j782ex"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><p id="5de7" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">之后，单击存储桶，转到“Permissions”选项卡，向下滚动到“Bucket Policy”，然后将此内容粘贴到:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="5b5c" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">你应该用你的帐号ID替换<account_id>(当你点击顶部的用户名时，它是你名字旁边的12位数字)。同样，用存储段名称替换<bucket_name>,用正确的角色(管理员)替换<iam_role>。</iam_role></bucket_name></account_id></p><h1 id="0b5c" class="nh la it bd lb ni nj nk le nl nm nn lh jz no ka ll kc np kd lp kf nq kg lt nr bi translated">步骤3:安装LakeFS</h1><p id="12ca" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">你需要做的第一件事是安装<a class="ae ky" href="https://docs.docker.com/compose/install/" rel="noopener ugc nofollow" target="_blank">docker-compose</a>；这将需要运行LakeFS的本地实例。接下来要做的是运行这个命令:</p><pre class="kj kk kl km gt nv nw nx ny aw nz bi"><span id="9eb6" class="kz la it nw b gy oa ob l oc od">curl <a class="ae ky" href="https://compose.lakefs.io" rel="noopener ugc nofollow" target="_blank">https://compose.lakefs.io</a> | docker-compose -f — up</span></pre><p id="d995" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">要运行lakeFS，请使用以下命令:</p><pre class="kj kk kl km gt nv nw nx ny aw nz bi"><span id="9a37" class="kz la it nw b gy oa ob l oc od">docker run — name lakefs -p 8000:8000</span><span id="285a" class="kz la it nw b gy oe ob l oc od">-e LAKEFS_DATABASE_CONNECTION_STRING=”&lt;postgres-connection-str&gt;”</span><span id="0abe" class="kz la it nw b gy oe ob l oc od">-e LAKEFS_AUTH_ENCRYPT_SECRET_KEY=”&lt;lakefs-secret-key&gt;”</span><span id="2648" class="kz la it nw b gy oe ob l oc od">-e LAKEFS_BLOCKSTORE_TYPE=”s3"</span><span id="5716" class="kz la it nw b gy oe ob l oc od">-e LAKEFS_GATEWAYS_S3_DOMAIN_NAME=”s3.local.lakefs.io”</span><span id="ab61" class="kz la it nw b gy oe ob l oc od">-e LAKEFS_BLOCKSTORE_S3_CREDENTIALS_ACCESS_SECRET_KEY=”&lt;s3-secret-key&gt;”</span><span id="f7a9" class="kz la it nw b gy oe ob l oc od">-e LAKEFS_BLOCKSTORE_S3_CREDENTIALS_ACCESS_KEY_ID=”&lt;s3-access-key&gt;” -e LAKEFS_BLOCKSTORE_S3_REGION=”&lt;s3-region&gt;” treeverse/lakefs:latest run</span></pre><p id="235c" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">您需要填写环境变量；您可以在此处找到连接字符串:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1d37c327676c43a27cdffe4fdc7fc83d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*quxdwU9bYU-Mr478"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><p id="70f5" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">s3区域是bucket区域，lakeFS密钥可以是您选择的任何字符串。如果一切正常，您应该能够看到lakeFS实例在<strong class="lx iu"> localhost:8000 </strong>上运行</p><p id="0a4f" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">这应该是它；这是您需要的大部分初始设置和配置。接下来的几个步骤将不再是教学形式，而是理论结构。</p><h1 id="0c46" class="nh la it bd lb ni nj nk le nl nm nn lh jz no ka ll kc np kd lp kf nq kg lt nr bi translated">使用Python设置存储库和分支</h1><p id="f094" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">使用LakeFS类似于使用Git。准备好设置后，您需要为数据集创建一个初始分支。我们将使用python来完成这项工作。</p><p id="2344" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">首先要做的是实例化一个客户端:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="bada" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">然后创建一个存储库和一个分支:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="47e2" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">仅此而已。现在您的s3存储桶应该连接到您的LakeFS存储库了。</p></div></div>    
</body>
</html>