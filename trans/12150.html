<html>
<head>
<title>Coarsened Exact Matching in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R 中的粗化精确匹配</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/coarsened-exact-matching-in-r-a36ae7ef6849?source=collection_archive---------11-----------------------#2021-12-08">https://towardsdatascience.com/coarsened-exact-matching-in-r-a36ae7ef6849?source=collection_archive---------11-----------------------#2021-12-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/afd5a34baf2f9cc55d83b811dde39a72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XQ0BgS7yzs1gzUHu"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">由<a class="ae jg" href="https://unsplash.com/@gerandeklerk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Geran de Klerk </a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><h2 id="3685" class="jh ji jj bd b dl jk jl jm jn jo jp dk jq translated" aria-label="kicker paragraph">数据科学基础</h2><div class=""/><div class=""><h2 id="6482" class="pw-subtitle-paragraph kp js jj bd b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dk translated">匹配的因果推理</h2></div><p id="ac84" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们不是都听过“相关性并不意味着因果关系”这句话，并想知道“那么，什么意味着因果关系”？嗯，因果推断。因果推理使我们能够得出关于因果影响的结论，从而做出重要的决策，并提供有价值的数据驱动的见解。因此，了解因果推断的基础知识对于数据科学家和分析师来说是一项巨大的投资。粗化精确匹配(CEM)是一种从观察数据进行因果推断的简单而直观的方法。这篇文章通过一个在 r 中使用<code class="fe md me mf mg b">MatchIt</code>库的例子展示了 CEM 背后的基本直觉。</p><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mh"><img src="../Images/69529172220254a3d39ea45c126d8ef0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m5NcirCD07e8eapd"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://unsplash.com/@redcharlie?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> redcharlie </a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="b185" class="mt mu jj bd mv mw mx my mz na nb nc nd ky ne kz nf lb ng lc nh le ni lf nj nk bi translated">🔍 1.关于 CEM 的一点点</h1><p id="fa20" class="pw-post-body-paragraph lh li jj lj b lk nl kt lm ln nm kw lp lq nn ls lt lu no lw lx ly np ma mb mc im bi translated">想象一下，我们想要了解治疗对感兴趣的结果的因果影响。我们能做的最简单的事情就是比较治疗组和未治疗组的平均结果。然而，这种比较可能不能给我们一个准确的估计，因为即使在没有治疗的情况下，治疗组和未治疗组的数据也不具有可比性。解决这个问题的一个方法是尝试将这两个组进行比较。这就是 CEM 等匹配技术的用武之地。</p><p id="085d" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在我们开始讨论 CEM 之前，让我们从一种叫做<em class="nq">精确匹配(EM) </em>的匹配技术开始。对于 EM，我们匹配处理过的和未处理的记录，这些记录在其协变量中具有完全相同的值。换句话说，这些匹配的记录将具有相同的特征，除了它们的治疗状态。一旦我们完成了所有可能的匹配并丢弃了不匹配的记录，那么匹配数据中的治疗组与未治疗组现在将更具可比性，我们可以分析组均值的差异来推断因果影响。</p><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nr"><img src="../Images/7bc23220c25b47b435c1226efdf0f226.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_6FzoAqHkS0r39M_"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">Neil 和 Zulma Scott 在 Unsplash 上的照片</p></figure><p id="02a0" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">然而，由于在进行 EM 时没有匹配，许多记录可能被排除在分析之外。例如，如果有许多数字协变量，就很难找到精确的匹配。在这方面，CEM 提供了一个很好的选择。做 CEM 时，有三个主要步骤:</p><ol class=""><li id="9ec3" class="ns nt jj lj b lk ll ln lo lq nu lu nv ly nw mc nx ny nz oa bi translated">粗化数据以降低粒度级别。这意味着宁滨数值和/或分组类别值。</li><li id="6481" class="ns nt jj lj b lk ob ln oc lq od lu oe ly of mc nx ny nz oa bi translated">对粗化的数据应用精确匹配，以找到可比较的对照组和治疗组。这意味着找到至少有一个对照和一个处理记录的协变量的所有组合，并保留属于这些组合的记录，丢弃其余的记录。每个组合被称为<em class="nq">地层</em>。</li><li id="2fd2" class="ns nt jj lj b lk ob ln oc lq od lu oe ly of mc nx ny nz oa bi translated">使用匹配的数据估计因果影响。</li></ol><p id="e752" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">了解了 CEM 背后的基本直觉后，我们可以看到它的名字是多么有信息量。让我们看一个简单的例子来更好地理解这项技术。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="c558" class="mt mu jj bd mv mw mx my mz na nb nc nd ky ne kz nf lb ng lc nh le ni lf nj nk bi translated">📍 2.R 中带有 MatchIt 的 CEM 示例</h1><p id="d056" class="pw-post-body-paragraph lh li jj lj b lk nl kt lm ln nm kw lp lq nn ls lt lu no lw lx ly np ma mb mc im bi translated">让我们导入必要的库并加载数据集。我们将使用<a class="ae jg" href="http://sekhon.berkeley.edu/matching/lalonde.html" rel="noopener ugc nofollow" target="_blank"> Lalonde 数据集</a>的一个小子集来保持事情的易管理性和易监控性。</p><pre class="mi mj mk ml gt og mg oh oi aw oj bi"><span id="49ca" class="ok mu jj mg b gy ol om l on oo">library("dplyr")<br/>library("MatchIt")<br/>library("lmtest")<br/>library("sandwich")<br/>options(scipen = 100, digits=4)</span><span id="b910" class="ok mu jj mg b gy op om l on oo"># Prepare sample data --------------------<br/>data("lalonde")<br/>set.seed(42)<br/>(df &lt;- lalonde %&gt;% <br/>    select(treat, educ, race, re78) %&gt;% <br/>    sample_n(30))</span></pre><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/f8a66a625ba6a45ed55871c6e52af975.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*mIEqX6Tswc5JZ4COXOTDIQ.png"/></div></figure><p id="fef2" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">对于 30 个随机选择的记录，我们有以下变量:<br/> ◼️ <strong class="lj jt">协变量:</strong> <code class="fe md me mf mg b">educ</code>受教育年限和<code class="fe md me mf mg b">race<br/></code> ◼️ <strong class="lj jt">治疗:</strong> <code class="fe md me mf mg b">treat</code>治疗状态<br/> ◼️ <strong class="lj jt">结果:</strong><code class="fe md me mf mg b">re78</code>1978 年实际收入<br/>让我们假设我们想要理解<code class="fe md me mf mg b">treat</code>对<code class="fe md me mf mg b">re78</code>的因果影响。</p><p id="c82e" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们可以通过指定<code class="fe md me mf mg b">method = 'cem’</code>来用<code class="fe md me mf mg b">matchit</code>执行 CEM:</p><pre class="mi mj mk ml gt og mg oh oi aw oj bi"><span id="6184" class="ok mu jj mg b gy ol om l on oo"># Perform CEM --------------------<br/>matching1 &lt;- matchit(treat ~ educ + race, data = df, <br/>                     method = 'cem', estimand = 'ATE')<br/>summary(matching1, un=FALSE)</span></pre><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi or"><img src="../Images/a1a4804b759765334992e94e9130d9ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/format:webp/1*7p2eK1_wY1oJ_rsDrLTZTg.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">仅部分输出</p></figure><p id="b018" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们可以看到，有 22 条质控记录可用，但只有 5 条匹配，其余 17 条不匹配，将从分析中删除。对照组匹配记录的有效样本量(<code class="fe md me mf mg b">Matched (ESS)</code>)为 4.91。治疗组也有相同的总结。</p><p id="1a4b" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">现在，让我们看看 12 条匹配记录的匹配数据:</p><pre class="mi mj mk ml gt og mg oh oi aw oj bi"><span id="949a" class="ok mu jj mg b gy ol om l on oo"># Extract matched data --------------------<br/>(matched_df1 &lt;- match.data(matching1) %&gt;% arrange(subclass, treat))</span></pre><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi os"><img src="../Images/3456dc99486aa25c1a0b7980a811c765.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*LcUi-IzFTl1SZnrsrPJA9w.png"/></div></figure><p id="a9b1" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><code class="fe md me mf mg b">subclass</code>显示了 3 个地层。虽然我们在这里看不到粗化的数据，但我们可以从原始值中大致猜出粗化的程度。例如，<code class="fe md me mf mg b">subclass</code> 3 似乎包含有<code class="fe md me mf mg b">9–10</code>年教育和<code class="fe md me mf mg b">black</code>种族的记录。我们可以看到每条记录都增加了权重。我们先来了解一下这些权重是怎么算出来的。</p><h2 id="08e8" class="ok mu jj bd mv ot ou dn mz ov ow dp nd lq ox oy nf lu oz pa nh ly pb pc nj jp bi translated">📍 2.1.CEM 重量</h2><p id="fa21" class="pw-post-body-paragraph lh li jj lj b lk nl kt lm ln nm kw lp lq nn ls lt lu no lw lx ly np ma mb mc im bi translated">每个层有两个权重:一个权重用于层中的处理记录，另一个用于控制记录。当计算权重时，我们要确保两件事:<br/> ◼️在加权后，治疗组和对照组的比例在总体水平上保持在每个阶层内:</p><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/d0df0071a423820f997ded37fc9db6ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*nsC2aTvI4sBTnJhu6aRXLg.png"/></div></figure><p id="5561" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">◼️加权数等于阶层内未加权数；</p><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/d41024c9cc6ca8ad2610d7b5dcef0f7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:422/format:webp/1*sDe1uznOr13b_NMidkXjaw.png"/></div></figure><p id="6010" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">根据我们感兴趣的<code class="fe md me mf mg b">estimand</code>的类型，该公式可以重新排列并简化为以下形式:</p><p id="1265" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">🔷<strong class="lj jt">对被治疗者的平均治疗效果(ATT)——</strong>治疗记录不加权(即权重为 1)，对照记录加权:</p><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/d28ac07b1bdafe180f75fef68a5bf08e.png" data-original-src="https://miro.medium.com/v2/resize:fit:326/format:webp/1*p4jkEJg6zZ1se44UawU1uw.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">ATT 公式</p></figure><p id="2448" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">🔷<strong class="lj jt">对对照的平均处理效果(ATC)——</strong>ATC 也是如此。质控记录不加权，治疗记录加权:</p><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/55e5177e8af823aa271786bea13504fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:288/format:webp/1*WAPkHidL4gp5XwVIU9LCFw.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">ATC 公式</p></figure><p id="9b80" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">🔷<strong class="lj jt">平均治疗效果(ATE)——</strong>两组均加权:</p><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/c99375bf05262df29e918a620b7db07d.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*LsR9omYzNFkjWa7rWuq3ZA.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">ATE 公式</p></figure><p id="4154" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><em class="nq">如果你想了解 ATT，ATC，ATE，查看本帖</em>  <em class="nq">中</em> <a class="ae jg" rel="noopener" target="_blank" href="/propensity-score-matching-a0d373863eec"> <em class="nq">的 1.5 节。</em></a></p><p id="f770" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">之前我们明确表示我们有兴趣了解<code class="fe md me mf mg b">ATE</code>。使用公式，让我们以子类 1 的重量为例:</p><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/22c9242f69644b8c205ad5d6a7ee61df.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/format:webp/1*Ywh5l2IKbs5El38-MHqv4g.png"/></div></figure><p id="2f71" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们自己计算了记录<code class="fe md me mf mg b">PSID376</code>和<code class="fe md me mf mg b">NSW153</code>的权重，以获得与函数返回的权重相同的权重。如果你很热衷，为其他两个类计算权重，巩固你的理解。</p><p id="d997" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们前面已经看过<code class="fe md me mf mg b">Matched (ESS)</code>。如果你想知道它是如何计算的，这里有一个公式:</p><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/685455c23a95b9c03f4e5b6856b570cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:282/format:webp/1*kdttTggT8FW5olwp01JNVw.png"/></div></figure><p id="d060" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">例如，让我们计算匹配对照组的 ESS:</p><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/05346c6d3598e8aa2671198fa631680a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*ntCPXmy_tJ1fNLJvdnSjfA.png"/></div></figure><h2 id="cfe6" class="ok mu jj bd mv ot ou dn mz ov ow dp nd lq ox oy nf lu oz pa nh ly pb pc nj jp bi translated">📍 2.2.估计因果影响</h2><p id="e000" class="pw-post-body-paragraph lh li jj lj b lk nl kt lm ln nm kw lp lq nn ls lt lu no lw lx ly np ma mb mc im bi translated">匹配完记录，就该看看预估的<code class="fe md me mf mg b">ATE</code>:</p><pre class="mi mj mk ml gt og mg oh oi aw oj bi"><span id="853f" class="ok mu jj mg b gy ol om l on oo"># Estimate causal impact - look at ATE --------------------<br/>model1 &lt;- lm(re78 ~ treat, data = matched_df1, weights = weights)<br/>coeftest(model1, vcov. = vcovCL, cluster = ~subclass)</span></pre><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/4c1c284ef6f21f8358e041dd5a037622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*q9J7Z_lSjz2FJUOG20MBCw.png"/></div></figure><p id="6ffc" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这里可以看到<code class="fe md me mf mg b">4907</code>的估计值及其统计意义。该估计值是各组加权平均值之间的差值:</p><pre class="mi mj mk ml gt og mg oh oi aw oj bi"><span id="172b" class="ok mu jj mg b gy ol om l on oo">matched_df1 %&gt;% group_by(treat) %&gt;%<br/>  summarise(w_mean = weighted.mean(re78, weights))</span></pre><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/70d3130f4f2affec76fc6b3af02b857a.png" data-original-src="https://miro.medium.com/v2/resize:fit:318/format:webp/1*aGj9UvhekipBX2v3UX0IrA.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk">8255–3348 = 4907</p></figure><p id="1436" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们还可以检查估计值的置信区间:</p><pre class="mi mj mk ml gt og mg oh oi aw oj bi"><span id="2122" class="ok mu jj mg b gy ol om l on oo">coefci(model1, vcov. = vcovCL, cluster = ~subclass)</span></pre><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/7dfa4445562dd8bc6823063ffe80989c.png" data-original-src="https://miro.medium.com/v2/resize:fit:466/format:webp/1*7tg4qzBJOAWBdGjcHvEzLQ.png"/></div></figure><p id="b83e" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">95%置信区间为<code class="fe md me mf mg b">-1073</code>至<code class="fe md me mf mg b">10887</code>。这些输出表明，处理对输出没有统计学上的显著影响。这并不奇怪，因为我们使用的是非常小的玩具数据集。</p><h2 id="4731" class="ok mu jj bd mv ot ou dn mz ov ow dp nd lq ox oy nf lu oz pa nh ly pb pc nj jp bi translated">📍 2.3.控制粗化的级别</h2><p id="38b4" class="pw-post-body-paragraph lh li jj lj b lk nl kt lm ln nm kw lp lq nn ls lt lu no lw lx ly np ma mb mc im bi translated">到目前为止，我们让函数使用其默认的粗化级别:宁滨数值变量使用<a class="ae jg" href="https://rdrr.io/r/grDevices/nclass.html" rel="noopener ugc nofollow" target="_blank">斯特奇斯方法</a>并保持分类变量不变。然而，在实践中，如果我们能够控制粗化的水平，这将是有用的。我们现在将学习对数字变量使用自定义切割点，对分类变量使用自定义分组。</p><p id="0362" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在应用 CEM 时，为了实现平衡(即，使组具有可比性)，删除一些记录，但是删除太多记录是不可取的。在我们的第一次匹配中，超过一半的记录(即 30 个中的 18 个)被遗漏。让我们尝试减少被排除的记录的数量，同时尝试在每个层中映射相似的记录。</p><pre class="mi mj mk ml gt og mg oh oi aw oj bi"><span id="1027" class="ok mu jj mg b gy ol om l on oo"># Perform CEM with custom coarsening --------------------<br/>cutpoints &lt;- list(educ = c(8.5, 10.5))<br/>grouping &lt;- list(race = list(c("white", "black"), c("hispan")))<br/>matching2 &lt;- matchit(treat ~ educ + race, data = df, <br/>                     method = 'cem', estimand = 'ATE',<br/>                     cutpoints=cutpoints, grouping=grouping)<br/>summary(matching2, un=FALSE)</span></pre><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi po"><img src="../Images/4b85949a93b993304a0bbebd3b12a776.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*8L7_LOSmKmFIlV3fd3dQKg.png"/></div></figure><p id="2c79" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们使用了两个分界点为<code class="fe md me mf mg b">educ</code>创建了三个箱，并将非西班牙裔种族分组在一起。通过使数据更加粗糙，我们将不匹配记录的数量从 18 个减少到了 3 个。然而，这样做的风险是，在观测值不太可比的同一地层中，包含不太相似的观测值。这意味着我们需要在不排除太多记录和不在层中包含太多不同记录之间找到微妙的平衡。让我们看看匹配的数据，以评估每个地层中的记录有多相似:</p><pre class="mi mj mk ml gt og mg oh oi aw oj bi"><span id="318f" class="ok mu jj mg b gy ol om l on oo"># Extract matched data<br/>(matched_df2 &lt;- match.data(matching2) %&gt;% arrange(subclass, treat))</span></pre><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/31bc056ec81cd559d92ec58a411bdda6.png" data-original-src="https://miro.medium.com/v2/resize:fit:858/format:webp/1*pjwdokTqTnEqxWbDxsG2Ag.png"/></div></figure><p id="4540" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">子类中的记录看起来相互之间有可比性吗？这是我们需要评估和必要时重申的，直到我们满意为止。让我们假设我们是快乐的，我们可以继续检查估计:</p><pre class="mi mj mk ml gt og mg oh oi aw oj bi"><span id="bf73" class="ok mu jj mg b gy ol om l on oo"># Estimate causal impact - look at ATE --------------------<br/>model2 &lt;- lm(re78 ~ treat, data = matched_df2, weights = weights)<br/>coeftest(model2, vcov. = vcovCL, cluster = ~subclass)</span></pre><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/7a677d15e63b7eb29fe994fe285ba89d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*8pRbZfgeFrjLkFsuTBm4Gw.png"/></div></figure><pre class="mi mj mk ml gt og mg oh oi aw oj bi"><span id="9182" class="ok mu jj mg b gy ol om l on oo">coefci(model2, vcov. = vcovCL, cluster = ~subclass)</span></pre><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi pr"><img src="../Images/36bba19d519515c8f11989dcaf1a9b5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:436/format:webp/1*1Vzc_OA5kdv7-lErEvj7PA.png"/></div></figure><p id="08e6" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">查看该输出后，前面分析的结论保持不变。</p><p id="04dd" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在这篇介绍性的文章中，我们学习了 CEM 的基础知识:算法如何工作，如何控制粗化的程度，以及如何分析因果影响。对于热衷于学习的人来说，<a class="ae jg" href="https://gking.harvard.edu/files/political_analysis-2011-iacus-pan_mpr013.pdf" rel="noopener ugc nofollow" target="_blank">这个</a>和<a class="ae jg" href="https://kosukeimai.github.io/MatchIt/reference/method_cem.html" rel="noopener ugc nofollow" target="_blank">这个</a>是非常棒的额外资源。我希望您能够使用这种技术为您的利益相关者提供有价值的见解。✨</p><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ps"><img src="../Images/20f38a61a133ff95273aa7b10ef5fa0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oeNHnBZ1LyVVUMT4"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@gerandeklerk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Geran de Klerk </a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="7bb9" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><em class="nq">您想访问更多这样的内容吗？媒体会员可以无限制地访问媒体上的任何文章。如果您使用</em> <a class="ae jg" href="https://zluvsand.medium.com/membership" rel="noopener"> <em class="nq">我的推荐链接</em></a><em class="nq">成为会员，您的一部分会费将直接用于支持我。</em></p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="b716" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">感谢您阅读这篇文章。如果你感兴趣，这里有我其他一些帖子的链接:</p><p id="df8d" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">◼️ <a class="ae jg" rel="noopener" target="_blank" href="/propensity-score-matching-a0d373863eec">倾向得分匹配</a> <em class="nq">(因果推断)</em> <br/> ◼️ <a class="ae jg" rel="noopener" target="_blank" href="/explaining-scikit-learn-models-with-shap-61daff21b12a">解释 Scikit-learn 模型与 SHAP </a> <br/> ◼️️ <a class="ae jg" rel="noopener" target="_blank" href="/k-nearest-neighbours-explained-52c910c035c5"> K 近邻解释</a> <br/> ◼️️ <a class="ae jg" rel="noopener" target="_blank" href="/logistic-regression-explained-7695f15d1b8b">逻辑回归解释</a> <br/> ◼️️ <a class="ae jg" rel="noopener" target="_blank" href="/comparing-random-forest-and-gradient-boosting-d7236b429c15">比较随机森林与梯度推进</a> <br/> ◼️️ <a class="ae jg" rel="noopener" target="_blank" href="/how-are-decision-trees-built-a8e5af57ce8?source=your_stories_page-------------------------------------">决策树是如何建立的？</a> <br/> ◼️️ <a class="ae jg" rel="noopener" target="_blank" href="/pipeline-columntransformer-and-featureunion-explained-f5491f815f?source=your_stories_page-------------------------------------">管道、柱变压器及特性 Union 说明</a></p><p id="929a" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">再见🏃 💨</p></div></div>    
</body>
</html>