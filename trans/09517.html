<html>
<head>
<title>SQL — insert values with joined IDs from another table</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL从另一个表中插入具有关联id的值</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/sql-insert-values-with-joined-ids-from-another-table-83ff7f149296?source=collection_archive---------0-----------------------#2021-09-04">https://towardsdatascience.com/sql-insert-values-with-joined-ids-from-another-table-83ff7f149296?source=collection_archive---------0-----------------------#2021-09-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="22e5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在表中有id的值。一次性插入id！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9a5580e9e92856697cb2da11e1b14c0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4sZKdfmK3FUw_w2d"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">搜索一些身份证(图片由<a class="ae ky" href="https://www.pexels.com/photo/sky-filled-with-stars-at-night-2106759/" rel="noopener ugc nofollow" target="_blank">像素</a>上的<a class="ae ky" href="https://www.pexels.com/@lucaspezeta" rel="noopener ugc nofollow" target="_blank">卢卡斯·佩泽塔</a>提供)</p></figure><p id="3c3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们的表需要id，但我们只有字符串时，该怎么办？假设我们是一家餐馆。我们将每一个菜单项及其成分存储到我们的数据库中，以便我们可以跟踪各种统计数据；多久点一道菜，哪些配料最受欢迎，例如</p><p id="803a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们想在recipes表中存储一个新的食谱，但是有一个问题:这个表需要一个ingredient_id，而不是我们当前拥有的ingredient_name。当我们只有名字时，如何将这些id插入到食谱表中呢？</p><p id="72ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文重点介绍如何通过使用独特的配料表，以最明智的方式存储这些食谱和配料。阅读本文后，您将:</p><ul class=""><li id="8cb9" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">了解独特的表</li><li id="8bb4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">了解如何使用直通表</li><li id="a826" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">能够在唯一表中只插入唯一值</li><li id="2b11" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">能够在从唯一表中检索id时插入到表中</li></ul><p id="c165" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们将设置一些表，然后进入查询。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="4f39" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">设置</h1><p id="efae" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">在这一节中，我们将定义数据库结构并创建所有的表。然后我们将在其中插入一些测试数据。在这之后，我们将进入如何插入连接的id。注意，本文使用Postgres，但是同样的技术适用于所有关系数据库</p><h2 id="1eab" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">数据库结构</h2><p id="ac67" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我们将定义3个表:一个保存配料，一个保存食谱，第三个表将这两个表连接在一起:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/b391f6059dd7c03bcc5bfe668f9e787b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*vXbb2CfFrLVO6gMzkFmNsA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们餐厅的数据库结构(图片由作者提供)</p></figure><h2 id="8383" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">配料表</h2><p id="fa6f" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">首先，我们将创建配料表并插入一些数据。查看<a class="ae ky" href="https://mikehuls.medium.com/sql-inserting-only-unique-values-in-a-unique-table-af2eb3b9890a" rel="noopener"> <strong class="lb iu">这篇文章</strong> </a> <strong class="lb iu"> </strong>中的查询只能插入表中不存在的配料，确保我们永远不会出错。在本例中，我们将使用下面的“普通”插页:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="9877" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以我们的桌子看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/2cd754cd37a7e0772e62f2e71831fbce.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/format:webp/1*2ZPpTS3wDH1iNljlwmtFDQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们新加入的配料</p></figure><h2 id="b23a" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">食谱表</h2><p id="fa39" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">该表将存储具有唯一id和名称的配方:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/5112271d9e6d9313533267c2a26d8132.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*FifxIeDB3U-J6eiOIp9OiA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的食谱表</p></figure><h2 id="8312" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">食谱配料表</h2><p id="50c4" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">该表将一个或多个配方与一种或多种配料联系起来。这种类型的表称为“直通表”；它充当具有多对多关系的两个表之间的中介。一个配方可以有多种配料，一种配料可以是多个配方的一部分。</p><p id="42ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将用recipe_id和ingredient_id将它们连接在一起:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="5056" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">T</p><p id="b7df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们所有的表都创建好了，让我们开始插入吧！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/9d0877a89bc9e30d708ae29fea65cab2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jPj76kQRQJ7M0y2V"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的桌子准备好了，让我们开始做饭吧！(图片由<a class="ae ky" href="https://www.pexels.com/@mvdheuvel" rel="noopener ugc nofollow" target="_blank">马腾·范·登·霍维尔</a>在<a class="ae ky" href="https://www.pexels.com/photo/person-holding-sliced-vegetable-2284166/" rel="noopener ugc nofollow" target="_blank">派克斯</a>拍摄)</p></figure><h1 id="1548" class="mq mr it bd ms mt of mv mw mx og mz na jz oh ka nc kc oi kd ne kf oj kg ng nh bi translated">插入到我们的食谱配料表中</h1><p id="3a88" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">让我们着手处理手头的问题。我们希望创建一些记录，将recipe-table中的记录与配料表中的一些记录连接起来。我们需要配方标识和一些配料标识。问题是我们没有配料id，只有配料名称。我们如何将数据插入配方配料表？现在我们假设我们知道recipe _ id值1。下面的查询解决了这个问题:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="48d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看一看并浏览一下查询。</p><ul class=""><li id="c7de" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">1号线到8号线；这里我们定义了我们想要插入的数据集。我们知道成分的名称和数量。</li><li id="dfe0" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在第9行，我们说我们想要将recipe_id、ingredient_id和数量插入recipe_ingredients表中。这是我们的目标</li><li id="7675" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">从我们定义为<code class="fe ok ol om on b">d</code>的输入值(第1行到第8行)中选择数据。我们在配料表上连接这个数据集，匹配配料名称。</li><li id="b6d6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">这就是神奇之处:正如您所看到的，我们为recipe_id选择值1，id来自连接的配料表，数量来自输入数据集。</li></ul><h2 id="6d24" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">考虑配方id</h2><p id="f9a0" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">诀窍是将我们的输入数据定义为一个数据集，将它与所需的表连接起来，然后只插入id。很简单，对吧？让我们用一个更难的例子来尝试一下，在这个例子中，我们不仅要连接配料id，还要连接配方id。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="6668" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将前一个查询中的技巧执行了两次:我们将recipes表中recipe列上的inputvalues中的recipe连接起来。然后，我们从该表中提取配方id，并将其插入到recipe_ingredients中。查看以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/e725c35679199b632f06c3a16522e4a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*ZPvb-gu_RG3_7NLyDqqCVw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们已经插入了与正确配方标识相对应的配料标识。完美！</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="2e62" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">结论</h1><p id="0b71" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">在本文中，我们已经学习了一些非常巧妙的技术:一个唯一的表、一个直通表和插入连接值。我希望能给他们一些启发。如果你有建议/澄清，请评论，以便我可以改进这篇文章。同时，看看我的其他关于各种编程相关主题的文章,比如:</p><ul class=""><li id="b1ab" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/sql-delete-into-another-table-b5b946a42299" rel="noopener">删除到另一个表中</a></li><li id="e269" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/sql-update-into-another-table-bfc3dff79a66" rel="noopener">更新到另一个标签页</a> le</li><li id="afdc" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/sql-insert-delete-and-update-in-one-statement-sync-your-tables-with-merge-14814215d32c" rel="noopener">在一条语句中插入、删除和更新</a></li><li id="b4b6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/sql-update-select-in-one-query-b067a7e60136" rel="noopener">更新选择一批记录</a></li><li id="4ae5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/python-to-sql-upsert-safely-easily-and-fast-17a854d4ec5a" rel="noopener">保存上插</a></li><li id="c8eb" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/sql-inserting-only-unique-values-in-a-unique-table-af2eb3b9890a" rel="noopener">插入唯一表格</a></li></ul><p id="1449" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！</p><p id="303e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">—迈克</p><p id="2aec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">页（page的缩写）学生:比如我正在做的事情？<a class="ae ky" href="https://github.com/mike-huls" rel="noopener ugc nofollow" target="_blank">跟我来</a>！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure></div></div>    
</body>
</html>