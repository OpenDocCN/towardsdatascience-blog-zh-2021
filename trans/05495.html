<html>
<head>
<title>Terraform + SageMaker Part 1b: Terraform Initialization with Terraform Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Terraform + SageMaker第1b部分:使用Terraform云初始化Terraform</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/terraform-sagemaker-part-1b-terraform-initialization-with-terraform-cloud-954c85ee83cd?source=collection_archive---------17-----------------------#2021-05-15">https://towardsdatascience.com/terraform-sagemaker-part-1b-terraform-initialization-with-terraform-cloud-954c85ee83cd?source=collection_archive---------17-----------------------#2021-05-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/436a4df90b7f7124d1bcef185205c11d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bYwreZP8q24eEVhEg3s47w.png"/></div></div></figure><h2 id="0cde" class="jc jd je bd b dl jf jg jh ji jj jk dk jl translated" aria-label="kicker paragraph">Terraform + SageMaker</h2><div class=""/><div class=""><h2 id="b940" class="pw-subtitle-paragraph kk jn je bd b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dk translated">帮助您开始使用Terraform在AWS SageMaker上创建资源(现在使用Terraform Cloud！)</h2></div><p id="324d" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">大家好！我们又回来了，这是一篇不可否认的意料之外的帖子，有一点有趣的背景故事。你可能还记得我们最初的帖子中的<a class="ae ly" rel="noopener" target="_blank" href="/terraform-sagemaker-part-1-terraform-initialization-a6470611ea92">，我们通过直接在你的本地机器上运行Terraform命令，并将<code class="fe lz ma mb mc b">.tfstate</code>文件存储在AWS S3后端，得到了对Terraform的介绍。这篇文章中的所有内容仍然是100%有效的，因为它解释了很多关于Terraform的概念，如果你是Terraform的新手，我肯定会鼓励你回去看看。</a></p><p id="9fbd" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我为什么利用Terraform Cloud写这篇新文章背后的真相与我的两个小女孩有关。你可能知道，我有一个有趣的个人开发设置，我使用iPad Pro作为我的主要机器，并且知道iPad在软件开发方面有其局限性，我使用Raspberry Pi作为“计算附件”来安装或运行任何不能在iPad上运行的软件包。下面是一张普通设置的图片，我已经写了一个<a class="ae ly" href="https://towardsdatascience.com/tagged/ipad-raspberry-pi" rel="noopener" target="_blank">完整的独立系列文章</a>，告诉你如果你愿意，你可以如何模仿同样的设置。</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi md"><img src="../Images/bb07de09e04600682ec476814704ddf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ux_VqfZzKiA2Op_jJQqaNQ.jpeg"/></div></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者捕获的图像</p></figure><p id="06ca" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我3岁和4岁的女儿喜欢我的覆盆子酱。我说的爱，是指他们只是觉得看起来很酷。😂他们还太小，不明白我用它做什么，但他们好奇的小心灵仍然喜欢玩它。愚蠢的是，我买的保护树莓皮的盒子没有用螺丝固定在一起。这一切都很好地扣到位，所以如果你曾经需要得到的Pi板很快，那么这种情况下是完美的设计。</p><p id="8d3c" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">嗯……那个无螺丝的盒子设计对儿童来说并不安全。众所周知，我的女儿们会拿着我的覆盆子酱在家里跑来跑去，当然，她们也会把它掉在地上。上周，他们摔得很重，以至于弯曲并损坏了容纳Pi操作系统和数据的microSD卡，这基本上使我的Raspberry Pi变得毫无用处，直到我可以获得一个新的microSD卡并将其正确加载。谢天谢地，树莓派本身完全没问题，我也吸取了教训:一个带螺丝的树莓派盒子今天被送到了我家！</p><p id="ff6d" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">总之，这篇文章是对以下问题的直接回答:<strong class="le jo">如果我的本地机器上没有Terraform工具，我该如何运行Terraform？</strong>(或者，更具体地说，在我的情况下，当我的女儿们“破坏”我的树莓派时，我如何继续使用Terraform？)你可能从这篇文章的标题就能猜到，答案是Terraform Cloud！在本帖中，我们将介绍如何使用Terraform云而不是本地Terraform，但我认为有必要重申，本帖并不是对我们在原帖中所介绍内容的直接替代。如果你喜欢在本地运行Terraform命令，欢迎你跳过这篇文章，继续使用这个模式。</p><p id="28ed" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">在我们的Terraform + SageMaker系列的其余部分，您将能够互换使用本地Terraform或Terraform云。如果你更喜欢使用Terraform Cloud，我会再次鼓励你查看我们的原始帖子<a class="ae ly" rel="noopener" target="_blank" href="/terraform-sagemaker-part-1-terraform-initialization-a6470611ea92">，因为它为那些刚刚开始使用Terraform的人提供了很多一般知识。这篇文章假设你熟悉原始文章的内容。</a></p><p id="6784" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">好了，在我们进入如何设置Terraform Cloud之前，让我们简单地谈谈使用Terraform Cloud的一些好处。</p><h1 id="2226" class="mm mn je bd mo mp mq mr ms mt mu mv mw kt mx ku my kw mz kx na kz nb la nc nd bi translated">为什么选择Terraform Cloud？</h1><p id="421f" class="pw-post-body-paragraph lc ld je le b lf ne ko lh li nf kr lk ll ng ln lo lp nh lr ls lt ni lv lw lx im bi translated">尽管在本地机器上使用Terraform很棒，但如果管理不当，还是有一些可伸缩性问题需要特别小心。这些问题包括以下内容:</p><ul class=""><li id="c1d3" class="nj nk je le b lf lg li lj ll nl lp nm lt nn lx no np nq nr bi translated"><strong class="le jo">TF state文件</strong>的后端位置:Terraform允许跨多种选项灵活地存储<code class="fe lz ma mb mc b">tfstate</code>文件，这既是一件好事，也是一件坏事。好处是选项的灵活性，但坏处是如果您的团队决定使用不同的后端存储选项，您的组织可能会到处都是<code class="fe lz ma mb mc b">tfstate</code>文件。</li><li id="6e3a" class="nj nk je le b lf ns li nt ll nu lp nv lt nw lx no np nq nr bi translated"><strong class="le jo">不小心覆盖了tfstate文件</strong>:我要举手承认这是我从亲身经历中学到的，谢天谢地只是在沙盒环境下！在Terraform配置中手动设置后台，如果使用相同的后台选项，你必须确保你的<code class="fe lz ma mb mc b">tfstate</code>键是不同的。例如，如果你和一个朋友都使用同一个AWS S3桶作为后端，并且都将<code class="fe lz ma mb mc b">tfstate</code>键设置为<code class="fe lz ma mb mc b">my-terraform-backend.tfstate</code>，那么你将覆盖彼此的工作。这也意味着您可能会意外破坏其他人的基础设施。这是一个巨大的风险！</li><li id="d199" class="nj nk je le b lf ns li nt ll nu lp nv lt nw lx no np nq nr bi translated"><strong class="le jo">跟踪你的Terraform模块</strong>:我知道我们还没有涉及到模块，但是正如你可能猜到的，拥有可重用的Terraform模块对以快速、一致的方式建立和运行类似的基础设施大有帮助。将我们所有的Terraform模块放在本地是完全可能的，但同样，如果您的开发团队没有一致地管理这些模块的位置，您将面临蔓延问题的风险。</li></ul><p id="6ccd" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">这些只是几个问题中的几个。作为缓解所有这些问题的手段，HashiCorp开发了Terraform Cloud和更高级别的Terraform Enterprise。其中一些功能包括:</p><ul class=""><li id="eb6d" class="nj nk je le b lf lg li lj ll nl lp nm lt nn lx no np nq nr bi translated">直接VCS(如GitHub、GitLab等。)整合</li><li id="8425" class="nj nk je le b lf ns li nt ll nu lp nv lt nw lx no np nq nr bi translated">远程地形运行</li><li id="b11c" class="nj nk je le b lf ns li nt ll nu lp nv lt nw lx no np nq nr bi translated">在Terraform Cloud中安全存储<code class="fe lz ma mb mc b">tfstate</code>文件</li><li id="159a" class="nj nk je le b lf ns li nt ll nu lp nv lt nw lx no np nq nr bi translated">公共或私有模块注册表</li><li id="740c" class="nj nk je le b lf ns li nt ll nu lp nv lt nw lx no np nq nr bi translated">前哨政策</li></ul><p id="953f" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">Terraform Cloud有不同的产品，根据成本的不同，其功能越来越多。(你可以在这里阅读所有这些产品<a class="ae ly" href="https://www.hashicorp.com/products/terraform/pricing" rel="noopener ugc nofollow" target="_blank">。)出于我们的目的，我们将坚持基础级别的自由选项，因为这个Terraform + SageMaker系列假设你是一个单独的演员，因此不必担心团队成员。需要注意的是，如果您打算在您的组织中扩展Terraform，我强烈建议您考虑Terraform Cloud或Terraform Enterprise的更高层产品。</a></p><p id="b22b" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">现在让我们开始实际使用Terraform云吧！😃</p><h1 id="e682" class="mm mn je bd mo mp mq mr ms mt mu mv mw kt mx ku my kw mz kx na kz nb la nc nd bi translated">设置您的Terraform云帐户</h1><p id="190d" class="pw-post-body-paragraph lc ld je le b lf ne ko lh li nf kr lk ll ng ln lo lp nh lr ls lt ni lv lw lx im bi translated">自然，我们使用Terraform Cloud的第一步是建立一个Terraform Cloud帐户。您可以通过导航到<a class="ae ly" href="https://www.terraform.io/cloud" rel="noopener ugc nofollow" target="_blank">主Terraform云网站</a>并点击“创建帐户”按钮来完成此操作。由于Terraform Cloud帐户注册非常直观，所以我不打算在这里详细介绍这些步骤。它会问你一些事情，比如你的电子邮件和你想给你的组织取什么名字，你可以填写任何适合你的东西。我个人将我的组织命名为<code class="fe lz ma mb mc b">dkhundley</code>,因为这是一个很好的品牌！😂</p><p id="4b8b" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">完成注册后，您应该会看到如下所示的屏幕:</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nx"><img src="../Images/1d94a1aa3500f4ca708e2ecf75a1e84e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D7CcRIEHROOz1uZ0rH3wew.jpeg"/></div></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者截图</p></figure><p id="bb6d" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">让我们继续连接您的VCS提供商。</p><h2 id="e243" class="ny mn je bd mo nz oa dn ms ob oc dp mw ll od oe my lp of og na lt oh oi nc jk bi translated">连接您的VCS提供商</h2><p id="8529" class="pw-post-body-paragraph lc ld je le b lf ne ko lh li nf kr lk ll ng ln lo lp nh lr ls lt ni lv lw lx im bi translated">正如上面简要提到的，Terraform Cloud的一个巨大优势是与GitHub或GitLab等VCS提供商直接集成。它允许Terraform Cloud查看您的VCS存储库，以便在对存储库进行某些更改时采取适当的措施。例如，您可以这样设置，当您将新的Terraform代码推送到<code class="fe lz ma mb mc b">main</code>分支时，Terraform Cloud可以自动检测这些新的更改，并以自动化的方式将这些更改应用到您的基础架构中。非常酷！</p><p id="d8ad" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">为了使用此功能，我们首先必须确保您的VCS提供商已正确连接到您的Terraform Cloud帐户。出于我们的目的，我将使用GitHub来完成这项工作，但是当然也欢迎您使用您选择的VCS提供商！</p><p id="4a75" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">为了简洁起见，我不打算在这里复制所有这些步骤，而是将你引向HashiCorp关于这个主题的官方文档。如果您已经成功设置了您的VCS提供商，您现在应该会看到您的提供商如下所示:</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nx"><img src="../Images/31246a0ded2fc48afc15d26b719a9b67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QV8_nzMXhwP3gqMa3cdmxg.jpeg"/></div></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者截图</p></figure><p id="ed6d" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">好吧！现在让我们开始创建您的第一个连接到您的源代码库的Terraform Cloud workspace！</p><h1 id="dd1e" class="mm mn je bd mo mp mq mr ms mt mu mv mw kt mx ku my kw mz kx na kz nb la nc nd bi translated">创建Terraform云工作空间</h1><p id="74fc" class="pw-post-body-paragraph lc ld je le b lf ne ko lh li nf kr lk ll ng ln lo lp nh lr ls lt ni lv lw lx im bi translated">(在进入本节之前请注意:具有讽刺意味的是，当在移动浏览器上工作时，这在UI中不起作用，包括我心爱的iPad上的浏览器。有某种错误阻止了UI正确创建工作区。我已经通知了哈希公司，他们正在积极调查此事。谢谢你，哈希公司！我使用了一种叫做<code class="fe lz ma mb mc b">terrasnek</code>的Python客户端形式的解决方法，虽然它很好地创建了我的工作空间，但是我们不打算在这里讨论它，因为UI要简单得多。)</p><p id="4e9e" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">好了，连接了您的VCS提供商后，我们现在可以开始创建我们的第一个工作区了！在工作区，我们将让Terraform Cloud监听我们的存储库中的特定更改，并相应地发布更改。为了简单起见，我们将监听主<code class="fe lz ma mb mc b">main</code>分支，并手动启动等效的<code class="fe lz ma mb mc b">plan</code>和<code class="fe lz ma mb mc b">apply</code>命令。</p><p id="d73b" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">要实际创建您的工作空间，请使用用户界面步骤…</p><ul class=""><li id="baae" class="nj nk je le b lf lg li lj ll nl lp nm lt nn lx no np nq nr bi translated">选择你的工作流程(在我们的例子中是VCS)</li><li id="27a8" class="nj nk je le b lf ns li nt ll nu lp nv lt nw lx no np nq nr bi translated">连接到您的VCS，它提供了一个非常灵活的UI，可以从您在上一节中创建的VCS提供商那里选择精确的存储库</li><li id="e490" class="nj nk je le b lf ns li nt ll nu lp nv lt nw lx no np nq nr bi translated">配置您的设置</li><li id="3fbf" class="nj nk je le b lf ns li nt ll nu lp nv lt nw lx no np nq nr bi translated">创建工作空间！</li></ul><p id="1b75" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">如果这些步骤看起来有点…简短，我道歉。如上所述，我无法让UI正常工作，因为我用的是iPad，但我以前在普通电脑上做过，记得UI非常直观。</p><p id="5031" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">无论如何，一旦你创建了你的工作空间，你至少还需要做一件事。您可能还记得在最初的帖子中，您需要确保Terraform拥有适当的凭证，以便适当地执行基础设施创建。这意味着使用我们与IAM角色一起生成的相同的<code class="fe lz ma mb mc b">AWS_ACCESS_KEY_ID</code>和<code class="fe lz ma mb mc b">AWS_SECRET_ACCESS_KEY</code>。如果你需要复习如何做到这一点，<a class="ae ly" href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/setup-credentials.html" rel="noopener ugc nofollow" target="_blank">点击这里查看官方AWS文档</a>。</p><p id="bd36" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">有了这些AWS IDs，就可以在workspace overview UI中的“Variables”选项卡上导航。在这个UI中，您可以选择输入两种变量:“地形变量”和“环境变量”我们将跳过“地形变量”部分，因为我们将在未来的帖子中使用一个实际的<code class="fe lz ma mb mc b">.tfvars</code>文件，而“环境变量”部分是你放置各自的<code class="fe lz ma mb mc b">AWS_ACCESS_KEY_ID</code>和<code class="fe lz ma mb mc b">AWS_SECRET_KEY_ID</code>的地方。当你点击“敏感”复选框时，千万不要害羞！这是我的屏幕在这一步之后的样子:</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nx"><img src="../Images/6d2da36d91730d6baabf856d2f3c5830.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bukWhHJ20rz_Fcs97J39bg.png"/></div></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者截图</p></figure><h1 id="9500" class="mm mn je bd mo mp mq mr ms mt mu mv mw kt mx ku my kw mz kx na kz nb la nc nd bi translated">快速地形代码审查</h1><p id="f090" class="pw-post-body-paragraph lc ld je le b lf ne ko lh li nf kr lk ll ng ln lo lp nh lr ls lt ni lv lw lx im bi translated">您可能还记得最初的帖子，我们测试了一些基本的Terraform命令，创建了一个非常简单的IAM，访问权限非常有限。我们将使用同样的代码，只做了两处小的改动。有两个Terraform配置文件:一个用于后端，另一个用于IAM角色。下面是<code class="fe lz ma mb mc b">iam.tf</code>的代码:</p><pre class="me mf mg mh gt oj mc ok ol aw om bi"><span id="1ebe" class="ny mn je mc b gy on oo l op oq">## DATA BLOCKS<br/>## ----------------------------------------------------------------</span><span id="9fd1" class="ny mn je mc b gy or oo l op oq"># Creating the data that will be used by the IAM policy<br/>data "aws_iam_policy_document" "s3_ls_policy_data" {<br/>  statement {<br/>    actions = [<br/>      "s3:ListAllMyBuckets"<br/>    ]</span><span id="b2dd" class="ny mn je mc b gy or oo l op oq">resources = [<br/>      "arn:aws:s3:::*"<br/>    ]<br/>  }<br/>}</span><span id="1690" class="ny mn je mc b gy or oo l op oq"># Creating the assume role policy data<br/>data "aws_iam_policy_document" "s3_ls_assume_role_data" {<br/>  statement {<br/>    actions = ["sts:AssumeRole"]</span><span id="65cd" class="ny mn je mc b gy or oo l op oq">principals {<br/>      type        = "Service"<br/>      identifiers = ["s3.amazonaws.com"]<br/>    }<br/>  }<br/>}</span><span id="9260" class="ny mn je mc b gy or oo l op oq">## RESOURCE BLOCKS<br/>## ----------------------------------------------------------------</span><span id="a299" class="ny mn je mc b gy or oo l op oq"># Creating the IAM policy using the data block from above<br/>resource "aws_iam_role_policy" "s3_ls_policy" {<br/>  name   = "s3_ls_iam_policy"<br/>  policy = data.aws_iam_policy_document.s3_ls_policy_data.json<br/>  role   = aws_iam_role.s3_ls_role.id<br/>}</span><span id="107d" class="ny mn je mc b gy or oo l op oq"># Creating the IAM role associated to the resources above<br/>resource "aws_iam_role" "s3_ls_role" {<br/>  name               = "s3_ls_iam_role_tfcloud"<br/>  description        = "This role allows for all S3 buckets to be listed."<br/>  assume_role_policy = data.aws_iam_policy_document.s3_ls_assume_role_data.json<br/>}</span></pre><p id="962d" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">和<code class="fe lz ma mb mc b">backend.tf</code>代码:</p><pre class="me mf mg mh gt oj mc ok ol aw om bi"><span id="8b3f" class="ny mn je mc b gy on oo l op oq"># terraform {<br/>#   backend "s3" {<br/>#     bucket = "dkhundley-terraform-test"<br/>#     key    = "terraform-sagemaker-tutorial.tfstate"<br/>#     region = "us-east-1"<br/>#   }<br/># }</span><span id="416b" class="ny mn je mc b gy or oo l op oq">provider "aws" {<br/>  region = "us-east-1"<br/>}</span></pre><p id="6385" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">跟原帖有两个变化:一大一小。小的改动是将IAM角色名称从<code class="fe lz ma mb mc b">s3_ls_iam_role</code>改为<code class="fe lz ma mb mc b">s3_ls_iam_tfcloud</code>，这只是为了保证我们的输出来自这个“新的”Terraform代码。最大的变化是我注释掉了包含S3后端的<code class="fe lz ma mb mc b">terraform</code>块。请记住，Terraform Cloud提供了一个功能，它会以一种安全的方式为您存储<code class="fe lz ma mb mc b">tfstate</code>文件。如果没有后端，默认情况下会这样做。然而，如果我把S3后端块留在那里，那么后端就会去那里。(这并不是一件坏事，但如果你更喜欢让Terraform Cloud存储你的<code class="fe lz ma mb mc b">tfstate</code>文件，这并不可取。)</p><p id="1de1" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我向前跳了一点，但只是为了向您展示我的<code class="fe lz ma mb mc b">tfstate</code>文件现在确实在Terraform Cloud中，请查看我在让Terraform Cloud创建我的资源后拍摄的这张截图:</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nx"><img src="../Images/13281a09a95b31f44aba929488f60e44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IuldpUn8OANXpT49QiINlA.png"/></div></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者截图</p></figure><p id="f211" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">好了，现在让我们继续使用Terraform Cloud在AWS中构建这些东西吧！</p><h1 id="87a9" class="mm mn je bd mo mp mq mr ms mt mu mv mw kt mx ku my kw mz kx na kz nb la nc nd bi translated">使用手动UI命令创建资源</h1><p id="d59f" class="pw-post-body-paragraph lc ld je le b lf ne ko lh li nf kr lk ll ng ln lo lp nh lr ls lt ni lv lw lx im bi translated">这是有趣的开始，主要是因为它很容易做，看起来非常光滑。在您的工作区内，您会看到屏幕右上方有一个按钮，上面写着“手动排队计划”如果你点击它，它会打开一个子用户界面，如下所示:</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nx"><img src="../Images/9e0b7a29dbf7a667e5e1436c736abe47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NLSyVNTG9QIA_HqHaOX3CQ.jpeg"/></div></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者截图</p></figure><p id="5b2b" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">为了启动计划阶段(或者如果您还记得CLI中的<code class="fe lz ma mb mc b">terraform plan</code>，您需要做的就是填写可选的“原因”字段，然后单击紫色的“队列计划”按钮。这将开始计划阶段，您应该会看到一个屏幕，其中提供了计划输出以及一个UI选项，用于批准实际部署的计划。(也就是CLI中的<code class="fe lz ma mb mc b">terraform apply</code>)</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nx"><img src="../Images/47629faa4380a4c6a630240bf80b2193.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OYc83Hz8A-uYq2_w07rjlg.png"/></div></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者截图</p></figure><p id="2707" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">一旦Terraform Cloud在AWS上创建了您的资源，您将会看到一个屏幕，上面有令人非常满意的绿色，表明您成功了！</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nx"><img src="../Images/13ccec4a0592d93a1360aa4fbb2d6a2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GDummvaZYthOKUZerMxxOQ.png"/></div></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者截图</p></figure><h1 id="309d" class="mm mn je bd mo mp mq mr ms mt mu mv mw kt mx ku my kw mz kx na kz nb la nc nd bi translated">用用户界面破坏资源</h1><p id="a74a" class="pw-post-body-paragraph lc ld je le b lf ne ko lh li nf kr lk ll ng ln lo lp nh lr ls lt ni lv lw lx im bi translated">这通常不是人们想要做的事情，因为在生产环境中这是一个非常危险的举动，所以destroy命令(您可能还记得CLI中的<code class="fe lz ma mb mc b">terraform destroy</code>)不像plan / apply命令那样明显。在您的工作区用户界面中，切换“设置”下拉菜单并选择“销毁和删除”选项。这将打开一个如下所示的用户界面:</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nx"><img src="../Images/f084dd39e72083d42f6f597904e0ccc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xbw9vwxtUEt_T3_R9a-3wQ.png"/></div></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者截图</p></figure><p id="87f5" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">对于一般不熟悉Terraform的人来说，这些术语可能会有点混乱，所以请允许我在这里快速阐述一下区别:</p><ul class=""><li id="04dc" class="nj nk je le b lf lg li lj ll nl lp nm lt nn lx no np nq nr bi translated"><strong class="le jo">摧毁基础设施</strong>:这相当于CLI中的<code class="fe lz ma mb mc b">terraform destroy</code>命令。这个命令查看在<code class="fe lz ma mb mc b">tfstate</code>文件中记录的所有资源，并执行一个计划来删除AWS上的那些资源。在我们的具体示例中，这意味着我们在上面创建的IAM角色消失了。</li><li id="20c0" class="nj nk je le b lf ns li nt ll nu lp nv lt nw lx no np nq nr bi translated"><strong class="le jo">删除工作区</strong>:这是Terraform cloud独有的，基本上相当于从S3后端删除你的<code class="fe lz ma mb mc b">tfstate</code>文件。(显然，Terraform Cloud上需要删除的内容更多，因为它有变量、设置和其他小设置。)虽然删除您的工作区将会删除您的<code class="fe lz ma mb mc b">tfstate</code>文件，但是它不会删除您用那个<code class="fe lz ma mb mc b">tfstate</code>文件构建的资源。对我们来说，这意味着在前面部分创建的IAM角色即使在<code class="fe lz ma mb mc b">tfstate</code>文件消失后仍然有效。</li></ul><p id="5a58" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">自然，我们希望前一个选项，因为它会像我们期望的那样删除IAM角色和策略。通过点击“队列销毁”计划按钮来切换销毁，这将为您提供一个类似于您之前看到的屏幕:</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nx"><img src="../Images/c1c71b1a7c33c4a5a34cd735a562d7a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9LytBI97Ntp0mDcgXGR-4g.png"/></div></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者截图</p></figure><p id="f3e3" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">是的，这与我们最初想要创建资源时的屏幕非常相似。同样，触发这些资源的正式删除是通过单击“确认并应用”按钮来执行的。Terraform将应用这些删除，然后噗！你的IAM角色没了。</p><h1 id="7ab0" class="mm mn je bd mo mp mq mr ms mt mu mv mw kt mx ku my kw mz kx na kz nb la nc nd bi translated">包扎</h1><p id="9f43" class="pw-post-body-paragraph lc ld je le b lf ne ko lh li nf kr lk ll ng ln lo lp nh lr ls lt ni lv lw lx im bi translated">这基本上总结了我想用Terraform Cloud展示的所有内容。同样，非常欢迎您继续使用带有S3后端的Terraform CLI的本地命令。这只是为您提供了如何以另一种方式实现的见解，更不用说我们只是触及了Terraform Cloud通过CLI提供的所有功能的表面。这些功能包括…</p><ul class=""><li id="abcf" class="nj nk je le b lf lg li lj ll nl lp nm lt nn lx no np nq nr bi translated">前哨政策</li><li id="d35b" class="nj nk je le b lf ns li nt ll nu lp nv lt nw lx no np nq nr bi translated">自动应用</li><li id="abe4" class="nj nk je le b lf ns li nt ll nu lp nv lt nw lx no np nq nr bi translated">团队和组管理</li><li id="88a3" class="nj nk je le b lf ns li nt ll nu lp nv lt nw lx no np nq nr bi translated">团队成员的自动通知选项</li><li id="9609" class="nj nk je le b lf ns li nt ll nu lp nv lt nw lx no np nq nr bi translated">还有更多！</li></ul><p id="9507" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">(我现在感觉自己就像是Terraform Cloud / Enterprise的推销员，所以我要说:不，我没有得到HashiCorp的认可。😂)</p><p id="a71d" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">感谢你查看这个帖子！在下一部中，我们将开始应用这些新的地形技能，让我们的手在SageMaker中变脏。期待到时候见到你。</p></div></div>    
</body>
</html>