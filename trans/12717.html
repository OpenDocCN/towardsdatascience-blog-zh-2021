<html>
<head>
<title>Quick start on deploying your Dash application using Heroku on a custom domain</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Heroku 在自定义域上快速部署 Dash 应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/quick-start-on-deploying-your-dash-application-using-heroku-on-a-custom-domain-123f25a4bff1?source=collection_archive---------21-----------------------#2021-12-31">https://towardsdatascience.com/quick-start-on-deploying-your-dash-application-using-heroku-on-a-custom-domain-123f25a4bff1?source=collection_archive---------21-----------------------#2021-12-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7604" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">这是一个教程，介绍了如何使用 Heroku 在自定义域上部署带有身份验证的 python Dash 应用程序。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5b1cebc8946479f7fb7de6afdb0e842e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qbQxii5BBzg657YU"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@kmuza?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卡洛斯·穆扎</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="12a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">平台即服务(Paas)和身份验证平台使得应用程序部署比以前更容易。我们没有将 python Dash 应用程序打包并在本地运行，而是展示了如何使用 Heroku 将 Dash 应用程序部署到自定义域的快速入门指南。</p><p id="318e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">设置 Heroku </strong></p><p id="200d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先设置一个免费的 Heroku 账户，下载 CLI 工具。在本地终端中，通过以下命令登录，</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="9e92" class="lx ly iq lt b gy lz ma l mb mc">heroku login</span></pre><p id="294e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">设置本地 Dash 应用</strong></p><p id="74e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本地机器上，我们可以创建一个简单的 Dash 应用程序，包含以下文件:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="61f1" class="lx ly iq lt b gy lz ma l mb mc">.gitignore<br/>app.py<br/>Procfile<br/>requirements.txt<br/>runtime.txt</span></pre><p id="132c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是基于关于<a class="ae kv" href="https://dash.plotly.com/deployment" rel="noopener ugc nofollow" target="_blank">https://dash.plotly.com/deployment</a>的教程，所以请参考那里的文档了解这个简单例子中的文件内容。唯一增加的是 runtime.txt，这个文件包含一行文本<code class="fe md me mf lt b">python-3.7.12</code>。这将指示 Heroku 使用指定的 python 版本来用于应用程序-这可以是其他值，有关支持的 python 运行时，请参见<a class="ae kv" href="https://devcenter.heroku.com/articles/python-support#supported-runtimes" rel="noopener ugc nofollow" target="_blank">https://dev center . Heroku . com/articles/python-support # supported-runtimes</a>。否则，默认情况下，它将使用最新版本(在撰写本文时，python-3.9.9)。如果未指定，如果本地创建和测试的 venv 使用一个版本，而应用程序的运行时使用另一个版本，这可能会导致兼容性问题。</p><p id="5362" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">requirements.txt 文件是用<code class="fe md me mf lt b">pip freeze</code>创建的。见下文，</p><p id="e332" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mg">设置 python 虚拟环境</em></p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="ef54" class="lx ly iq lt b gy lz ma l mb mc">pip install dash plotly gunicorn<br/>virtualenv venv --python=python3.7<br/>pip freeze &gt; requirements.txt</span></pre><p id="ca2f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">部署应用程序</strong></p><p id="caaf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将应用程序部署到 Heroku 就像提交 git 并将提交推送到远程存储库一样简单(下面使用一个 Heroku 远程存储库)。</p><p id="067c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了首次设置 Heroku 应用程序，我们将为该应用程序创建一个唯一的名称。<code class="fe md me mf lt b">heroku create [name]</code>有效地创建了一个新的 Heroku 应用程序，并执行了一个<em class="mg"> git remote add </em>来将 Heroku 远程存储库连接到本地 git 存储库。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="6df3" class="lx ly iq lt b gy lz ma l mb mc">heroku create testapp  # <em class="mg">testapp</em> is a unique name of app<br/>git add .<br/>git commit -m "initial commit"<br/>git push heroku master</span></pre><p id="6ac9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了更新代码和重新部署，我们可以简单地提交新的更改并推送到 Heroku 远程存储库。这将自动触发全新的构建和部署。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="ad9d" class="lx ly iq lt b gy lz ma l mb mc">git add .<br/>git commit -m "new changes"<br/>git push keroku master</span></pre><p id="53b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果之前已经创建了 app，可以手动将远程 Heroku 资源库与<code class="fe md me mf lt b">heroku git:remote -a [name of app]</code>连接。</p><p id="984f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">设置认证</strong></p><p id="0f94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还可以为我们的应用程序设置身份验证。最快的方法是在应用程序中实现这一点。查看 https://dash.plotly.com/authentication 的<a class="ae kv" href="https://dash.plotly.com/authentication" rel="noopener ugc nofollow" target="_blank"/>，通过基本认证找到一种方法。简而言之，这涉及到<code class="fe md me mf lt b">pip install dash-auth</code>和在 app 中添加额外的 BasicAuth。有关完整的详细信息，请参见 dash 的认证文档。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="5e80" class="lx ly iq lt b gy lz ma l mb mc">auth = dash_auth.BasicAuth( <br/>         app,<br/>         VALID_USERNAME_PASSWORD_PAIRS<br/>)</span></pre><p id="0486" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这样，当我们访问应用程序时，我们将看到以下屏幕，要求登录。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mh"><img src="../Images/75b06ba7e0023c9911d49e78aa7c176a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PqqJw0-76vcW7BOpmKJq2g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用基本身份验证的登录弹出窗口。作者截图</p></figure><p id="a140" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">或者，您可以使用 Auth0。这可以作为附件安装。更多信息可以在<a class="ae kv" href="https://devcenter.heroku.com/articles/auth0" rel="noopener ugc nofollow" target="_blank">https://devcenter.heroku.com/articles/auth0</a>找到。</p><p id="c813" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">添加自定义子域</strong></p><p id="3025" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到目前为止，该应用程序被托管在 testapp.heroku.com。相反，我们可以很容易地将它链接到我们自己的定制域。首先，我们需要一个域名提供商(如谷歌域名)——确保你选择一个可以编辑 DNS 记录的提供商。</p><p id="c8e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在 Heroku 中，转到应用程序的仪表板，在<em class="mg">设置下，</em>向下滚动到域并点击<em class="mg">添加域。</em>我们输入域名(如<em class="mg">customdomain.com</em>；或者我们也可以做子域，<em class="mg">testapp.customdomain.com</em>)。添加后，我们看到以下内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mi"><img src="../Images/9015024985895e2959ea913c9e75d0fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sRCZXOBOEqLqtwodjvULGg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">添加新域后的 Heroku 域视图。图片为作者截图。</p></figure><p id="6bed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">记下 DNS 目标值，现在转到 DNS 提供商创建一个新的 CNAME 记录，该记录被路由到 DNS 目标。下面是创建一个<em class="mg"> testapp </em>子域的例子。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mj"><img src="../Images/fc4fefc7895bbcea090c1e5cdbca640f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hYnJiDvuF3IjCWMxyz9QIQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">示例 DNS 记录(使用 Google 域名)将子域路由到 Heroku。作者截图</p></figure><p id="fe55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有了这个，我们就可以在我们的客户领域快速发展了！</p></div></div>    
</body>
</html>