<html>
<head>
<title>Integrating your data analysis with Google Workspace and Google Cloud Storage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将您的数据分析与Google Workspace和Google云存储相集成</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/integrating-your-data-analysis-with-google-workspace-and-google-cloud-storage-f80649404bb0?source=collection_archive---------27-----------------------#2021-11-29">https://towardsdatascience.com/integrating-your-data-analysis-with-google-workspace-and-google-cloud-storage-f80649404bb0?source=collection_archive---------27-----------------------#2021-11-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d272" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用Python从云中加载文件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d33c36600035ce11f6d484e5596cb1c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1vYYISPY_AB3Ae83"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马文·迈耶在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="f78c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">1.介绍</h1><p id="879a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">协作是当今成功的数据团队的关键因素之一。您的团队交流和共享信息的方式会对您公司的生产力产生重大影响。</p><blockquote class="mn"><p id="87d3" class="mo mp it bd mq mr ms mt mu mv mw mm dk translated">不幸的是，大多数公司仍然依赖于通过电子邮件和其他通信平台共享CSV和Excel文件，这种做法损害了数据的一致性和安全性。</p></blockquote><p id="58fb" class="pw-post-body-paragraph lr ls it lt b lu mx ju lw lx my jx lz ma mz mc md me na mg mh mi nb mk ml mm im bi translated">因此，使用正确的工具共享数据文件可以提高您的分析重现性，并帮助您的团队提高生产率。</p><p id="0d6a" class="pw-post-body-paragraph lr ls it lt b lu nc ju lw lx nd jx lz ma ne mc md me nf mg mh mi ng mk ml mm im bi translated"><strong class="lt iu">本文的目标是介绍几种使用</strong><a class="ae ky" href="https://workspace.google.com/" rel="noopener ugc nofollow" target="_blank"><strong class="lt iu">Google Workspace</strong></a><strong class="lt iu">和</strong> <a class="ae ky" href="https://cloud.google.com/storage" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> Google云存储</strong> </a> <strong class="lt iu">的数据共享替代方案。</strong></p><p id="5f28" class="pw-post-body-paragraph lr ls it lt b lu nc ju lw lx nd jx lz ma ne mc md me nf mg mh mi ng mk ml mm im bi translated">下面介绍的每个函数的教程和代码可以在我的<a class="ae ky" href="https://github.com/GabrielSGoncalves/integrating_data_analysis_with_gcloud" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>中找到。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="9ac8" class="kz la it bd lb lc no le lf lg np li lj jz nq ka ll kc nr kd ln kf ns kg lp lq bi translated">2.谷歌云环境</h1><p id="307c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">谷歌是云资源和存储的主要提供商之一，也是面向各种终端用户的可访问解决方案。<strong class="lt iu"> Google Drive和Sheets是Google Workspace(前身为GSuite) </strong>的热门服务部分，也是处理表格数据和存储文件的主要工具之一。谷歌还通过其谷歌云平台(GCP)为企业提供云服务。<strong class="lt iu">云存储是一种用于存储文件的GCP服务</strong>(类似于AWS S3)。</p><p id="2c43" class="pw-post-body-paragraph lr ls it lt b lu nc ju lw lx nd jx lz ma ne mc md me nf mg mh mi ng mk ml mm im bi translated">这些服务允许用户在涉及数据产品、分析和数据科学的项目中进行协作。因此，学习如何使用每个工具的正确特性可以帮助您的团队开发涉及数据共享的最佳实践。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="235a" class="kz la it bd lb lc no le lf lg np li lj jz nq ka ll kc nr kd ln kf ns kg lp lq bi translated">3.加载公共文件</h1><p id="72f7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">一些涉及数据的项目可能要求您公开您的数据集，以便其他人可以访问它。科学期刊、政府、非政府组织和许多其他机构可能需要提供对数据的开放访问，因此下面描述的工具是访问存储在Google Sheets或Drive中的开放数据的替代方法。</p><h2 id="00d3" class="nt la it bd lb nu nv dn lf nw nx dp lj ma ny nz ll me oa ob ln mi oc od lp oe bi translated">3.1.谷歌工作表</h2><p id="2a1c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Google Sheets是一个在线电子表格编辑器(类似于Microsoft Excel ),允许用户处理表格数据。由于我们处理的大部分数据都是以表格的形式组织的，所以使用表格来组织和存储基本分析会非常方便。</p><p id="7904" class="pw-post-body-paragraph lr ls it lt b lu nc ju lw lx nd jx lz ma ne mc md me nf mg mh mi ng mk ml mm im bi translated">要公开您的工作表文档，您需要点击<strong class="lt iu">共享&gt;发布到web </strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/384b49988a29ff670429117e7c9fa351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_272cnWDOnd8LucOZC4nQg.png"/></div></div></figure><p id="1b69" class="pw-post-body-paragraph lr ls it lt b lu nc ju lw lx nd jx lz ma ne mc md me nf mg mh mi ng mk ml mm im bi translated">接下来，<strong class="lt iu">选择一个工作表</strong>和文档类型为<strong class="lt iu">逗号分隔值(。csv)，</strong>并复制创建的链接。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/f6a09297f5808539cf8faf5cf75103af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SnENgHqTi9FMw88V-p8sQQ.png"/></div></div></figure><p id="6bed" class="pw-post-body-paragraph lr ls it lt b lu nc ju lw lx nd jx lz ma ne mc md me nf mg mh mi ng mk ml mm im bi translated">函数<code class="fe oh oi oj ok b">read_public_sheets</code>接收您刚刚创建的链接，并返回一个Pandas数据帧，这是将表格直接加载到Jupyter笔记本的一个很好的选择。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><pre class="kj kk kl km gt on ok oo op aw oq bi"><span id="ae22" class="nt la it ok b gy or os l ot ou"># Loading a Public Google Sheets as a Pandas Dataframe<br/>sheet_url = '&lt;url to a Google Sheets&gt;'</span><span id="ee4f" class="nt la it ok b gy ov os l ot ou">df_sheet_public = read_public_sheets(sheet_url)</span></pre><h2 id="4551" class="nt la it bd lb nu nv dn lf nw nx dp lj ma ny nz ll me oa ob ln mi oc od lp oe bi translated">3.2.Google Drive</h2><p id="35b3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Google Drive是存储任何文件格式的绝佳存储解决方案。公开可用的数据集可以以不同的格式找到，如csv、xlsx、json或parquet。要访问文件，请打开Google Drive文件夹，右键单击所需文件，单击<strong class="lt iu">获取链接</strong>，选择选项<strong class="lt iu">任何有链接的人</strong>，然后复制创建的链接。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/881f645c9ed22f8b2f810ef55dfadf62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2YZ_E0lDt0V91Yd0RulLuQ.png"/></div></div></figure><p id="47d5" class="pw-post-body-paragraph lr ls it lt b lu nc ju lw lx nd jx lz ma ne mc md me nf mg mh mi ng mk ml mm im bi translated">函数<code class="fe oh oi oj ok b">read_public_file_from_gdrive</code>接收存储在Google Drive中的文件的复制URL，并返回一个Pandas Daframe(对于csv或xlsx文件)或一个字典(对于json文件)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><pre class="kj kk kl km gt on ok oo op aw oq bi"><span id="4e5d" class="nt la it ok b gy or os l ot ou"># Example on how to load a CSV file from Google Drive<br/>link_to_csv = '&lt;url to a Google Drive file&gt;'</span><span id="e1ae" class="nt la it ok b gy ov os l ot ou">df_public_csv = read_public_file_from_gdrive(<br/>    link_to_csv,<br/>    "csv"<br/>)</span></pre></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="c548" class="kz la it bd lb lc no le lf lg np li lj jz nq ka ll kc nr kd ln kf ns kg lp lq bi translated">4.加载私有文件</h1><p id="5b33" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">由于公司内部共享的大多数数据文件都是私有的，为了防止数据泄露，您还需要使用某种身份验证来访问这些文件。</p><p id="a45a" class="pw-post-body-paragraph lr ls it lt b lu nc ju lw lx nd jx lz ma ne mc md me nf mg mh mi ng mk ml mm im bi translated">在本节课中，我们将了解如何访问谷歌云服务来获取不公开的文件。</p><h2 id="1411" class="nt la it bd lb nu nv dn lf nw nx dp lj ma ny nz ll me oa ob ln mi oc od lp oe bi translated">4.1.谷歌工作表</h2><p id="0a43" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们将使用<a class="ae ky" href="https://github.com/burnash/gspread" rel="noopener ugc nofollow" target="_blank"><strong class="lt iu">gspread</strong></a>Python模块与Google Sheets进行交互。为了访问私人文件，首先，你需要定义你的凭证。<a class="ae ky" href="https://docs.gspread.org/en/latest/oauth2.html#" rel="noopener ugc nofollow" target="_blank">请遵循官方文件上的说明</a>。使用您的服务凭证下载JSON文件后，您还需要将<strong class="lt iu">服务帐户电子邮件添加到Sheets权限电子邮件列表</strong> ( <strong class="lt iu">共享&gt;添加人员和组</strong>)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="81ab" class="pw-post-body-paragraph lr ls it lt b lu nc ju lw lx nd jx lz ma ne mc md me nf mg mh mi ng mk ml mm im bi translated">要运行函数<code class="fe oh oi oj ok b">read_private_sheets</code>，您需要将路径传递给您的<code class="fe oh oi oj ok b">credentials_json</code>、您的<code class="fe oh oi oj ok b">sheet_url</code>和目标<code class="fe oh oi oj ok b">worksheet</code>(名称或索引)。</p><pre class="kj kk kl km gt on ok oo op aw oq bi"><span id="5e6e" class="nt la it ok b gy or os l ot ou"># Loading a private Google Sheets<br/>gcloud_credentials = '&lt;path to service credentials JSON&gt;'<br/>sheet_url = '&lt;url to a Google Sheets&gt;'</span><span id="384e" class="nt la it ok b gy ov os l ot ou">df_private_sheet = read_private_sheets(gcloud_credentials, sheet_url, 0)</span></pre><h2 id="3f2a" class="nt la it bd lb nu nv dn lf nw nx dp lj ma ny nz ll me oa ob ln mi oc od lp oe bi translated">4.2.Google Drive</h2><p id="60cf" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要从Google Drive访问私有文件，我们可以使用<a class="ae ky" href="https://github.com/iterative/PyDrive2" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> PyDrive2 </strong> </a>，这是一个Python库，它简化了与Google Drive API V2的交互。函数<code class="fe oh oi oj ok b">read_private_file_from_gdrive</code>能够读取5种不同的文件格式(csv、xlsx、parquet、json或txt)，您只需提供到它的链接(<code class="fe oh oi oj ok b">file_url</code>，与会话3.2中描述的链接相同。)、<code class="fe oh oi oj ok b">file_format</code>和<code class="fe oh oi oj ok b">google_auth</code>(凭证)。要生成访问Google Drive上私人文件所需的凭证，请遵循<a class="ae ky" href="https://docs.iterative.ai/PyDrive2/quickstart/" rel="noopener ugc nofollow" target="_blank"> Pydrive2文档</a>中描述的步骤。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><pre class="kj kk kl km gt on ok oo op aw oq bi"><span id="7ecb" class="nt la it ok b gy or os l ot ou">from pydrive2.auth import GoogleAuth<br/>from gcloud_data_analysis_functions import read_private_file_from_gdrive</span><span id="9926" class="nt la it ok b gy ov os l ot ou"># 1. Authenticate using OAuth2.0<br/>gauth = GoogleAuth()<br/>gauth.LocalWebserverAuth()</span><span id="d524" class="nt la it ok b gy ov os l ot ou"># 2. Access a private parquet from a Google Drive<br/>file_url_parquet = '&lt;url to a Google Drive Parquet&gt;'<br/>df_parquet_gdrive = read_private_file_from_gdrive(file_url_parquet, "parquet", gauth)</span></pre><p id="07d3" class="pw-post-body-paragraph lr ls it lt b lu nc ju lw lx nd jx lz ma ne mc md me nf mg mh mi ng mk ml mm im bi translated">当你在<code class="fe oh oi oj ok b">#1</code>上运行代码时，如果成功生成了凭证，就会显示一个指向谷歌账户认证的链接。选择您的帐户并允许其访问服务。</p><p id="5b9e" class="pw-post-body-paragraph lr ls it lt b lu nc ju lw lx nd jx lz ma ne mc md me nf mg mh mi ng mk ml mm im bi translated">在<code class="fe oh oi oj ok b">#2</code>上，你只需要通过<code class="fe oh oi oj ok b">gauth</code> (Google Auth Object)，带着文件链接和格式，就可以加载想要的内容了。</p><h2 id="d100" class="nt la it bd lb nu nv dn lf nw nx dp lj ma ny nz ll me oa ob ln mi oc od lp oe bi translated">4.3.谷歌云存储</h2><p id="fe89" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">云存储是在企业环境中存储/共享数据的一个很好的解决方案，因为它提供了一种安全的方式来定义用户对文件的访问。因此，尽管您可能将文件夹定义为公共文件夹，但下面的示例将描述如何使用GCP凭证加载私有文件。<a class="ae ky" href="https://developers.google.com/identity/protocols/oauth2?hl=en" rel="noopener ugc nofollow" target="_blank">要创建一个</a> <code class="fe oh oi oj ok b"><a class="ae ky" href="https://developers.google.com/identity/protocols/oauth2?hl=en" rel="noopener ugc nofollow" target="_blank">gcp_credentials</a></code> <a class="ae ky" href="https://developers.google.com/identity/protocols/oauth2?hl=en" rel="noopener ugc nofollow" target="_blank"> json，请跟随官方页面。</a></p><p id="1247" class="pw-post-body-paragraph lr ls it lt b lu nc ju lw lx nd jx lz ma ne mc md me nf mg mh mi ng mk ml mm im bi translated">函数<code class="fe oh oi oj ok b">read_file_from_gcloud_storage</code>能够读取5种类型的<code class="fe oh oi oj ok b">file_format</code> : csv、xlsx、parquet、json或txt。要定义要加载的特定文件，您需要提供<code class="fe oh oi oj ok b">file_name</code>、<code class="fe oh oi oj ok b">gcp_bucket</code>和<code class="fe oh oi oj ok b">gcp_project</code>作为参数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><pre class="kj kk kl km gt on ok oo op aw oq bi"><span id="2a3b" class="nt la it ok b gy or os l ot ou">df_from_storage = read_file_from_gcloud_storage(<br/>    "&lt;file name&gt;",<br/>    "&lt;file format&gt;",<br/>    "&lt;bucket name&gt;",<br/>    "&lt;GCP project name&gt;",<br/>    "&lt;path to GCP credentials json&gt;",<br/>)</span></pre></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="5142" class="kz la it bd lb lc no le lf lg np li lj jz nq ka ll kc nr kd ln kf ns kg lp lq bi translated">5.一锤定音</h1><p id="6552" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我希望您和您的团队都能从本文介绍的功能中受益，避免通过电子邮件或视频聊天软件共享数据文件。通过使用Google云服务共享您的文件，您可以提高跨团队的数据一致性，并帮助在您的公司内部创建数据安全性和意识。</p><p id="96ec" class="pw-post-body-paragraph lr ls it lt b lu nc ju lw lx nd jx lz ma ne mc md me nf mg mh mi ng mk ml mm im bi translated">如简介中所述，你可以在我的<a class="ae ky" href="https://github.com/GabrielSGoncalves/integrating_data_analysis_with_gcloud" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> GitHub资源库中找到<strong class="lt iu">代码</strong>和一本Jupyter笔记本<strong class="lt iu">教程</strong>。</strong> </a></p><p id="6daa" class="pw-post-body-paragraph lr ls it lt b lu nc ju lw lx nd jx lz ma ne mc md me nf mg mh mi ng mk ml mm im bi translated">如果您对所展示的主题有任何建议，请随时写信给我😉！</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="e152" class="kz la it bd lb lc no le lf lg np li lj jz nq ka ll kc nr kd ln kf ns kg lp lq bi translated">非常感谢你阅读我的文章！</h1><ul class=""><li id="9418" class="ox oy it lt b lu lv lx ly ma oz me pa mi pb mm pc pd pe pf bi translated">你可以在我的<a class="ae ky" href="https://medium.com/@gabrielsgoncalves" rel="noopener">个人资料页面</a> <strong class="lt iu">找到我的其他文章🔬</strong></li><li id="e79a" class="ox oy it lt b lu pg lx ph ma pi me pj mi pk mm pc pd pe pf bi translated">如果你喜欢它并且<strong class="lt iu">想成为中级会员</strong>，你可以通过我的<a class="ae ky" href="https://medium.com/@gabrielsgoncalves/membership" rel="noopener"> <strong class="lt iu">推荐链接</strong> </a>来支持我👍</li></ul></div></div>    
</body>
</html>