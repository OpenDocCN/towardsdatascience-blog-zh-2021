<html>
<head>
<title>The Current State of COVID-19 From 3 Different Perspectives</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从三个不同的角度看新冠肺炎的现状</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-current-state-of-covid-19-from-3-different-perspectives-3fbaabcd0348?source=collection_archive---------25-----------------------#2021-03-19">https://towardsdatascience.com/the-current-state-of-covid-19-from-3-different-perspectives-3fbaabcd0348?source=collection_archive---------25-----------------------#2021-03-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0441" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><strong class="ak">让数据和图像说话——一个简化的网络应用</strong></h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/09ebc76d5481d2e17536685ed8cab66e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HAbK2tIfreJqyVDQJlyoXg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="7e20" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你是否曾经想在几个小时内而不是几周内与世界上的任何人分享你的项目？如果是这样，那么你来对地方了。本文将带您了解我是如何使用Streamlit创建自己的新冠肺炎仪表板的。Streamlit允许您以简单的方式为机器学习和数据科学创建定制的web应用程序。以下是我的应用程序的链接:</p><p id="3fe8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae lr" href="https://share.streamlit.io/navido89/covid19-dashboard-dataviz/app.py" rel="noopener ugc nofollow" target="_blank">https://share . streamlit . io/navido 89/covid 19-dashboard-dataviz/app . py</a></p><h1 id="d99a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">目标:</h1><p id="2a2d" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">首先，为了更好地理解我的项目，我将带你经历我试图完成的事情。这个项目的目的是从三个不同的角度看新冠肺炎的现状。这些图是通过使用数据可视化工具(如Plotly和Folium)创建的。这个项目分为三个部分。</p><p id="c556" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> 1。全球新冠肺炎情况</strong>:我显示了一个叶子地图，上面显示了总病例数、总死亡数、每10万人的总病例数和每10万人的总死亡数。除此之外，我还展示了各种时间序列图，以便更好地理解这种疾病是如何随着时间在全球传播的。</p><p id="4f36" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> 2。世界卫生组织区域(世卫组织)的新冠肺炎情况</strong>:在下面的部分，我从世界卫生组织的区域角度来看这种疾病。我根据不同地区的总病例数、总死亡数、每1亿人的总病例数和每1亿人的总死亡数对它们进行了比较。</p><p id="2781" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> 3。美国的新冠肺炎局势</strong>:最后但同样重要的是，我调查了美国，并根据病例、死亡人数(有和没有人均)、疫苗状况以及不同变种在各州传播的状况，探讨了美国的现状。</p><p id="4702" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这些数据来自各种资源，每天都会更新。请<a class="ae lr" href="https://github.com/navido89/covid19-dashboard-dataviz" rel="noopener ugc nofollow" target="_blank">点击这里</a>进入我的回购，你就可以拉数据了。</p><h1 id="51ad" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">方法:</h1><p id="4fd0" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">在进入Streamlit之前，我为每个图创建了一个函数。如上所述，我使用Plotly和Folium进行可视化。这样做的原因是因为我希望我所有的图形都是交互式的，Plotly和lyum在这方面做得很好。一旦我为每个图创建了函数，我就创建了一个主函数。主函数是我为我的Streamlit应用程序编写代码并调用每个plots函数的地方。在我进入Streamlit部分之前，我将首先向您介绍我必须实现的方法，以准备好这些图。</p><h2 id="7b59" class="mp lt iq bd lu mq mr dn ly ms mt dp mc le mu mv me li mw mx mg lm my mz mi na bi translated"><strong class="ak">数据清理</strong>:</h2><p id="005a" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">正如你们中的许多人所知，当涉及到数据科学项目时，我们将大部分时间花在数据清理上。我的网络应用也是如此。清理所有不同的数据，我拉进创建图花了我最多的时间。我不打算详细说明我是如何清理每个图的数据的，但是它们中的许多都有一个共同的模式。我必须采取的为图表准备数据的步骤包括:</p><ul class=""><li id="9eec" class="nb nc iq kx b ky kz lb lc le nd li ne lm nf lq ng nh ni nj bi translated">读入数据</li><li id="d6af" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">移除列和行</li><li id="5fb1" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">用新的字符串值替换字符串</li><li id="a36d" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">按功能分组</li><li id="cddf" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">合并数据集</li></ul><h2 id="74a3" class="mp lt iq bd lu mq mr dn ly ms mt dp mc le mu mv me li mw mx mg lm my mz mi na bi translated"><strong class="ak">特色工程</strong>:</h2><p id="4ebf" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">同样，我不会详细讨论特性工程，但是现在我将强调一些常见的模式。例如，在时间序列图中，我必须将类型从object更改为DateTime。除此之外，我还创建了显示人均病例或死亡总数的列。对于这些特定的列，我必须通过使用特定位置的人口、总病例数和死亡人数来进行计算。获得人均数字的目的是为了更好地了解不同地点之间的情况。</p><h2 id="f192" class="mp lt iq bd lu mq mr dn ly ms mt dp mc le mu mv me li mw mx mg lm my mz mi na bi translated"><strong class="ak">数据可视化</strong>:</h2><p id="8568" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">正如本文前面提到的，我使用Plotly和Folium进行可视化。对于Plotly绘图，Streamlit有一个名为plotly_chart()的函数，对于follow，可以导入以下库:</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="1eb1" class="mp lt iq nq b gy nu nv l nw nx">from streamlit_folium import folium_static</span></pre><p id="ddd3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">foloum_static是一个函数，它允许您将一个叶子地图作为参数传入，以便它可以在您的应用程序中呈现。</p><p id="aac5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我的项目中有两个高级的情节，我将更详细地讨论，以便您能够在自己的项目中创建它们。其他情节相当简单，我强烈建议仔细阅读Plotly文档。请查看下面的链接:</p><div class="ny nz gp gr oa ob"><a href="https://plotly.com/python/" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd ir gy z fp og fr fs oh fu fw ip bi translated">Plotly Python图形库</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">Plotly的Python图形库制作出交互式的、出版物质量的图形。如何制作线图的示例…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">plotly.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op kp ob"/></div></div></a></div><p id="e552" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，我们来谈谈app中的follo pleth地图。我之前写过一篇关于如何绘制更高级的多层Choropleth地图的教程。如果你不熟悉leav，请查看这篇文章来学习你的leav技能。</p><div class="ny nz gp gr oa ob"><a rel="noopener follow" target="_blank" href="/how-to-step-up-your-folium-choropleth-map-skills-17cf6de7c6fe"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd ir gy z fp og fr fs oh fu fw ip bi translated">如何提高你的Choropleth地图技能</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">将你的Choropleth地图带到下一关</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="oq l om on oo ok op kp ob"/></div></div></a></div><p id="0203" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在上面的文章中，我正在查看一个例子，在这个例子中我实现了一个更高级的map。当我写这篇文章时，我无法解决的一个问题是，我们如何删除choropleth的图例并为每个图层创建一个图例，因为默认情况下，每个列的所有图例都将显示在图上。在我的教程中，除了图层之外，每个图例都有一个单独的按钮。然而，我的最终目标是用一个图例绑定每一层。换句话说，当我点击层控制器和一个特定的列，层将自动出现其相关的图例。下面我将带您了解如何在我的应用程序中创建地图的步骤。</p><p id="5987" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在下图中，您可以在我的应用程序中看到其中一个Choropleth地图的数据框。在清理和特征工程之后，我们得到以下结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/e52d2b32763717e789f3ef09bc433e98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YLAUy42K7wGCuV2Q6UBmHw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="fc6e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将实现一个JavaScript函数。首先，我们创建一个BindColormap类，它将一个定制的色彩映射表绑定到一个给定的层。要使它工作，您需要导入宏元素和模板，如下所示。</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="9ce9" class="mp lt iq nq b gy nu nv l nw nx">from branca.element import MacroElement</span><span id="0e22" class="mp lt iq nq b gy os nv l nw nx">from jinja2 import Template</span><span id="3edc" class="mp lt iq nq b gy os nv l nw nx">class BindColormap(MacroElement):<br/>    """Binds a colormap to a given layer.</span><span id="d753" class="mp lt iq nq b gy os nv l nw nx">Parameters<br/>    ----------<br/>    colormap : branca.colormap.ColorMap<br/>        The colormap to bind.<br/>    """<br/>    def __init__(self, layer, colormap):<br/>        super(BindColormap, self).__init__()<br/>        self.layer = layer<br/>        self.colormap = colormap<br/>        self._template = Template(u"""<br/>        {% macro script(this, kwargs) %}<br/>            {{this.colormap.get_name()}}.svg[0][0].style.display = 'block';<br/>            {{this._parent.get_name()}}.on('overlayadd', function (eventLayer) {<br/>                if (eventLayer.layer == {{this.layer.get_name()}}) {<br/>                    {{this.colormap.get_name()}}.svg[0][0].style.display = 'block';<br/>                }});<br/>            {{this._parent.get_name()}}.on('overlayremove', function (eventLayer) {<br/>                if (eventLayer.layer == {{this.layer.get_name()}}) {<br/>                    {{this.colormap.get_name()}}.svg[0][0].style.display = 'none';<br/>                }});<br/>        {% endmacro %}<br/>        """)  </span></pre><p id="335d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦我们有了上面的函数，现在是时候为每一列创建定制的图例了。</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="401a" class="mp lt iq nq b gy nu nv l nw nx"># We create the colors for the custom legends<br/>    colors = ["YlGn","OrRd","BuPu","GnBu"]</span><span id="9388" class="mp lt iq nq b gy os nv l nw nx"># Create a custom legend using branca for each column<br/>cmap1 = branca.colormap.StepColormap(<br/>        colors=['#ffffcc','#d9f0a3','#addd8e','#78c679','#238443'],<br/>        vmin=0,<br/>        vmax=df_global_folium['covid_total'].max(),  <br/>        caption='Covid Total')</span><span id="a086" class="mp lt iq nq b gy os nv l nw nx">cmap2 = branca.colormap.StepColormap(<br/>        colors=["#fef0d9",'#fdcc8a','#fc8d59','#d7301f'],<br/>        vmin=0,<br/>        vmax=df_global_folium['covid_deaths'].max(),  <br/>        caption='Covid Deaths')<br/>        <br/>cmap3 = branca.colormap.StepColormap(<br/>        colors=branca.colormap.step.BuPu_09.colors,<br/>        vmin=0,<br/>        vmax=df_global_folium['covid_cases_per_100k'].max(),  <br/>        caption='covid_cases_per_100k')<br/>        <br/>cmap4 = branca.colormap.StepColormap(<br/>        colors=branca.colormap.step.GnBu_09.colors,<br/>        vmin=0,<br/>        vmax=df_global_folium['covid_deaths_per_100k'].max(),  <br/>        caption='covid_deaths_per_100k')</span><span id="299a" class="mp lt iq nq b gy os nv l nw nx">cmaps = [cmap1, cmap2,cmap3,cmap4]</span></pre><p id="a001" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">正如你在上面看到的，我们使用Branca库来使用StepColormap功能。在这里，我们从上述数据框中为以下各列创建了4个单独的图例:</p><ul class=""><li id="bd58" class="nb nc iq kx b ky kz lb lc le nd li ne lm nf lq ng nh ni nj bi translated"><strong class="kx ir"> covid_total </strong></li><li id="770a" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated"><strong class="kx ir">covid _死亡人数</strong></li><li id="11dc" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated"><strong class="kx ir"> covid_cases_per_100k </strong></li><li id="f7c9" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated"><strong class="kx ir"> covid_deaths_per_100k </strong></li></ul><p id="be91" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了更好地理解StepColormap函数的属性，请查阅下面的文档:</p><div class="ny nz gp gr oa ob"><a href="https://python-visualization.github.io/branca/colormap.html" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd ir gy z fp og fr fs oh fu fw ip bi translated">布兰卡</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">用于处理色彩映射表的实用模块。一个创建色彩映射表的通用类…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">python-visualization.github.io</p></div></div></div></a></div><p id="add8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们关注上面代码中的cmap4，它是covid_deaths_per_100k的图例。其他列的过程是相同的，但是我想让您看看代码实际输出了什么。在最后一个代码片段的顶部，我创建了一个颜色列表来表示每个图例的颜色。首先，我使用调色板GnBu_09将colors属性设置为Branca步骤颜色。然后，我设置vmin值，这是一个允许我们在leged中设置最小数量的属性。另一方面，vmax允许我们设置最大数量。最后一个属性标题允许我们为图例设置一个名称。我们在cmap4中创建的图例如下所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/3baf076bee3a3f6fbd66388945dc27d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*QJKwcNoq5UVBRYfW4A9Pog.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="4788" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在代码的最后一行，我创建了一个名为cmaps的列表，其中包含了我为上述四列创建的所有图例。</p><p id="4eb9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下一步是创建叶子地图，并将各个图例与每个图层绑定。</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="18d4" class="mp lt iq nq b gy nu nv l nw nx">columns_list_global_map = ["covid_total","covid_deaths","covid_cases_per_100k","covid_deaths_per_100k"]</span><span id="025b" class="mp lt iq nq b gy os nv l nw nx">sample_map = folium.Map(location=[51,10], zoom_start=2)</span><span id="c692" class="mp lt iq nq b gy os nv l nw nx"># Set up Choropleth map<br/>for color, cmap, i in zip(colors, cmaps, columns_list_global_map):<br/>        <br/>        choropleth = folium.Choropleth(<br/>        geo_data=df_global_folium,<br/>        data=df_global_folium,<br/>        name=i,<br/>        columns=['name',i],<br/>        key_on="feature.properties.name",<br/>        fill_color=color,<br/>        colormap= cmap,<br/>        fill_opacity=1,<br/>        line_opacity=0.2,<br/>        show=False<br/>        )<br/>        <br/>        # this deletes the legend for each choropleth you add<br/>        for child in choropleth._children:<br/>            if child.startswith("color_map"):<br/>                del choropleth._children[child]</span><span id="22ee" class="mp lt iq nq b gy os nv l nw nx">        style_function1 = lambda x: {'fillColor': '#ffffff', <br/>                            'color':'#000000', <br/>                            'fillOpacity': 0.1, <br/>                            'weight': 0.1}<br/>        highlight_function1 = lambda x: {'fillColor': '#000000', <br/>                                'color':'#000000', <br/>                                'fillOpacity': 0.50, <br/>                                'weight': 0.1}</span><span id="2a96" class="mp lt iq nq b gy os nv l nw nx">        NIL1 = folium.features.GeoJson(<br/>            data = df_global_folium,<br/>            style_function=style_function1, <br/>            control=False,<br/>            highlight_function=highlight_function1, <br/>            tooltip=folium.features.GeoJsonTooltip(<br/>            fields= ['name',"covid_total","covid_deaths",<br/>                    "covid_cases_per_100k",<br/>                    "covid_deaths_per_100k"],<br/>            aliases= ['name',"covid_total","covid_deaths",  <br/>                    "covid_cases_per_100k",<br/>                    "covid_deaths_per_100k"],<br/>            style=("background-color: white; color: #333333; font- <br/>            family: arial; font-size: 12px; padding: 10px;") <br/>            )<br/>        )<br/>        sample_map.add_child(NIL1)<br/>        sample_map.keep_in_front(NIL1)</span><span id="632e" class="mp lt iq nq b gy os nv l nw nx">        # add cmap to `sample_map`<br/>        sample_map.add_child(cmap)<br/>                <br/>        # add choropleth to `sample_map`<br/>        sample_map.add_child(choropleth)<br/>        <br/>        # bind choropleth and cmap<br/>        bc = BindColormap(choropleth, cmap)<br/>        <br/>        # add binding to `m`<br/>        sample_map.add_child(bc)<br/>    <br/># Add dark and light mode. <br/>folium.TileLayer('cartodbdark_matter',name="dark mode",control=True).add_to(sample_map)<br/>    <br/>folium.TileLayer('cartodbpositron',name="light mode",control=True).add_to(sample_map)</span><span id="fbbc" class="mp lt iq nq b gy os nv l nw nx">sample_map.add_child(folium.LayerControl())</span><span id="1d28" class="mp lt iq nq b gy os nv l nw nx">sample_map</span></pre><p id="5dc7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，我们为想要迭代的每一列创建一个列表。接下来，我们建立了我们的叶子地图，并将其命名为smaple _ map。之后，我们对一个zip对象进行迭代，这个对象是由colors、cmaps、country_lists_global_map组成的元组的迭代器。我们循环的第一个zip对象是-&gt; ("YlGn，" cmap1，covid_total)。第二个zip对象将是(" OrRd，" cmap2，covid_deaths)等等。接下来，我们创建一个choropleth变量，并将其设置为folium.choropleth()函数。在函数内部，我们将属性设置为您可以在下面的数据框中看到的值。<strong class="kx ir">注意df_global_folium是上面的数据帧。再看下面:</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/e52d2b32763717e789f3ef09bc433e98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YLAUy42K7wGCuV2Q6UBmHw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="30b2" class="mp lt iq nq b gy nu nv l nw nx">        geo_data=df_global_folium,<br/>        data=df_global_folium,<br/>        name=i,<br/>        columns=['name',i],<br/>        key_on="feature.properties.name",<br/>        fill_color=color,<br/>        colormap= cmap,<br/>        fill_opacity=1,<br/>        line_opacity=0.2,<br/>        show=False</span></pre><p id="5849" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">创建图层后，我们会立即删除默认显示的图例。删除图例的原因是为了避免在一个图上出现多个图例。请参见下面删除图例的代码。</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="b7d6" class="mp lt iq nq b gy nu nv l nw nx"># this deletes the legend for each choropleth you add<br/>        for child in choropleth._children:<br/>            if child.startswith("color_map"):<br/>                del choropleth._children[child]</span></pre><p id="ac7c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">删除图例后，我们实现悬停功能以在地图上显示数据。</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="ec0d" class="mp lt iq nq b gy nu nv l nw nx">style_function1 = lambda x: {'fillColor': '#ffffff', <br/>                            'color':'#000000', <br/>                            'fillOpacity': 0.1, <br/>                            'weight': 0.1}<br/>highlight_function1 = lambda x: {'fillColor': '#000000', <br/>                                'color':'#000000', <br/>                                'fillOpacity': 0.50, <br/>                                'weight': 0.1}</span><span id="1d73" class="mp lt iq nq b gy os nv l nw nx">NIL1 = folium.features.GeoJson(<br/>            data = df_global_folium,<br/>            style_function=style_function1, <br/>            control=False,<br/>            highlight_function=highlight_function1, <br/>            tooltip=folium.features.GeoJsonTooltip(<br/>            fields= ['name',"covid_total","covid_deaths",<br/>                    "covid_cases_per_100k",<br/>                    "covid_deaths_per_100k"],<br/>            aliases= ['name',"covid_total","covid_deaths",  <br/>                    "covid_cases_per_100k",<br/>                    "covid_deaths_per_100k"],<br/>            style=("background-color: white; color: #333333; font- <br/>            family: arial; font-size: 12px; padding: 10px;") <br/>            )<br/>        )<br/>sample_map.add_child(NIL1)<br/>sample_map.keep_in_front(NIL1)</span></pre><p id="9bf3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们创建一个样式函数和一个高亮函数，我们将在folio . features . geo JSON()函数中使用它们。我们将style_function和highlight_function分别设置为style_function1和highlight_function1。这些属性设置了我们悬停在某个位置时的视觉外观。在tooltip变量中，我们指定当鼠标悬停在某个位置时，数据框中显示的数据。然后，我们将NIL1变量作为子变量添加到地图中，并将其放在地图的前面。</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="64f5" class="mp lt iq nq b gy nu nv l nw nx">        # add cmap to `sample_map`<br/>        sample_map.add_child(cmap)<br/>                <br/>        # add choropleth to `sample_map`<br/>        sample_map.add_child(choropleth)<br/>        <br/>        # bind choropleth and cmap<br/>        bc = BindColormap(choropleth, cmap)<br/>        <br/>        # add binding to `m`<br/>        sample_map.add_child(bc)<br/>    <br/>    # Add dark and light mode. <br/>    folium.TileLayer('cartodbdark_matter',name="dark mode",control=True).add_to(sample_map)<br/>    folium.TileLayer('cartodbpositron',name="light mode",control=True).add_to(sample_map)</span><span id="60c9" class="mp lt iq nq b gy os nv l nw nx">sample_map.add_child(folium.LayerControl())</span><span id="e2ba" class="mp lt iq nq b gy os nv l nw nx">sample_map</span></pre><p id="9df4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">正如您在上面看到的，我们然后将单个图例(“cmap”)添加到绘图，将choropleth添加到地图，绑定choropleth和图例，并将其作为子元素添加到地图。注意，上面的步骤只是针对一次迭代。一旦循环结束，代码继续下一行。最后，我们添加黑暗模式，光明模式，和层控制器到地图。这就是了。下面是最终的Choropleth叶地图。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/5908166370a08499a5004cef6db1baf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*5MC91M0Z4cTbIoGrsBfeFA.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者Gif</p></figure><p id="76be" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我将更详细介绍的第二个图是关于Plotly图，其中我向一个图形添加了两个下拉菜单。使用两个下拉菜单的目的是选择不同的州，并比较记录的不同新冠肺炎变异体的总病例情况。首先，让我们看看情节，然后我们将深入代码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/282a32d9d61f3aa5d012295799bb59ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*a7LOWPaFA3Enp9abRfdGjw.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者Gif</p></figure><p id="2bec" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">正如你在上面看到的，我们可以通过不同的变异体引起的新冠肺炎病例来比较不同的州。在深入研究代码之前，让我们先看看数据框架。下面可以看到上面Plotly图的数据框，叫做cdc_variants_data。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/355796e9873d2ba383ef406df41d86fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iQZXNnqBffneLhvl-O47Lw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="739e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">该索引由三个不同的变量组成，其他列都是不同的状态。绘制上图的代码如下:</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="2fc6" class="mp lt iq nq b gy nu nv l nw nx">df = cdc_variants_data</span><span id="4bfa" class="mp lt iq nq b gy os nv l nw nx"># plotly figure setup<br/>    fig = go.Figure()</span><span id="4095" class="mp lt iq nq b gy os nv l nw nx"># one trace for each df column<br/>    fig.add_trace(go.Bar(name="Selection 1",x=df.index, y=df["Alabama"].values))</span><span id="676f" class="mp lt iq nq b gy os nv l nw nx"># one trace for each df column<br/>    fig.add_trace(go.Bar(name="Selection 2",x=df.index, y=df["Alabama"].values))</span><span id="0c21" class="mp lt iq nq b gy os nv l nw nx"># one button for each df column<br/>    updatemenu= []<br/>    buttons=[]</span><span id="445e" class="mp lt iq nq b gy os nv l nw nx"># add second buttons<br/>    buttons2 = []</span><span id="c735" class="mp lt iq nq b gy os nv l nw nx">for i in list(df.columns):<br/>        buttons.append(dict(method='restyle',label = str(i),args=[{'x':[df.index],'y':[df[i].values]},[0]])<br/>                    )<br/>    <br/>for i in list(df.columns):<br/>        buttons2.append(dict(method='restyle',label = str(i),args=[{'x':[df.index],'y':[df[i].values]},[1]])<br/>                    )</span><span id="a68a" class="mp lt iq nq b gy os nv l nw nx"># some adjustments to the updatemenus<br/>button_layer_1_height = 1.23<br/>    updatemenu = list([dict(<br/>        buttons = buttons,<br/>        direction="down",<br/>        pad={"r":10,"t":10},<br/>        showactive=True,<br/>        x= 0.1,<br/>        xanchor="left",<br/>        y= button_layer_1_height,<br/>        yanchor="top",<br/>        font = dict(color = "blue")<br/>    ),dict(<br/>        buttons = buttons2,<br/>        direction="down",<br/>        pad={"r":10,"t":10},<br/>        showactive=True,<br/>        x= 0.37,<br/>        xanchor="left",<br/>        y=button_layer_1_height,<br/>        yanchor="top",font = dict(color = "red"))])</span><span id="feec" class="mp lt iq nq b gy os nv l nw nx">fig.update_layout(showlegend=True, updatemenus=updatemenu)<br/>fig</span></pre><p id="636d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们使用Plotly的图形对象。我们首先创建一个名为df的变量，并将其设置为数据帧cdc_variants_data。然后，我们添加两条轨迹，使同一图形上有两条不同的线条。我们使用Bar函数，将x值设置为索引，将y轴设置为Alabama列。之后，我们创建三个空列表。第一个是更新名为updatemenu的菜单。另外两个叫做按钮1和按钮2。之后，我们有两个单独的for循环，在这里我们遍历所有的列(状态)并将它们添加到每个按钮中。args属性很重要，因为我们将数据框的索引添加到x，并将每个状态的列值添加到y。此外，[0]和[1]分别表示第一个和第二个按钮。除此之外，我们还创建了一个名为updatemenu的字典列表。在每个字典中，我们将buttons属性设置为在两个for循环之前创建的button变量。最后，我们调用Plotly update_layout()函数，并将updatemenus属性设置为updatemenu变量。我强烈建议您获取上面的代码，并获取一个示例数据框，然后使用它进行试验，这样您就可以更好地理解如何绘制它。</p><p id="6343" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">既然我们已经介绍了不同的方法(数据清理、要素工程和数据可视化)，现在我们可以将注意力转移到如何创建应用程序上。</p><h1 id="c183" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">创建Web应用程序:</h1><p id="9ce1" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">为了理解我是如何在Streamlit中创建我的应用程序的，我将首先带您看一个简单的例子。首先，您需要在您的环境中安装库。请查看下面关于如何安装Streamlit的文档。</p><div class="ny nz gp gr oa ob"><a href="https://docs.streamlit.io/en/stable/troubleshooting/clean-install.html" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd ir gy z fp og fr fs oh fu fw ip bi translated">如何全新安装Streamlit - Streamlit 0.79.0文档</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">如果您在安装Streamlit时遇到任何问题，或者如果您想进行全新安装，请不要担心，我们会帮助您…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">docs.streamlit.io</p></div></div><div class="ok l"><div class="ov l om on oo ok op kp ob"/></div></div></a></div><p id="9890" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，打开一个新的python脚本并复制粘贴以下内容:</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="e807" class="mp lt iq nq b gy nu nv l nw nx">import streamlit as st</span><span id="8181" class="mp lt iq nq b gy os nv l nw nx">def main():<br/>    st.title("Deploy me to Heroku")<br/>    st.subheader("Welcome to my app.")</span><span id="1cf8" class="mp lt iq nq b gy os nv l nw nx">if __name__ == '__main__':<br/>    main()</span></pre><p id="7dba" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">正如您在上面看到的，我们首先导入streamlit库。之后，我创建了一个主函数。在里面，主要功能是我开始在我的应用程序的前端工作的地方。我调用st.title()为我的应用程序添加一个标题，后面跟着一个我用st.subheader()调用的子标题。接下来，保存文件，在命令行界面(CLI)中，转到保存python脚本的位置。接下来，要查看上面的代码输出了什么，只需运行下面的代码:</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="6840" class="mp lt iq nq b gy nu nv l nw nx">streamlit run app.py</span></pre><p id="68ed" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">浏览器中会自动弹出一个窗口，您会看到以下内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/747ecb75b007950860979f6a98983bca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*u5ie7AyMh_csDG9m-TPl8A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="308b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">瞧，这就是你的应用程序。上面的输出将在您的本地机器上运行。完成应用程序后，如果您想要部署它，您可以使用Streamlit共享。您需要在这里请求邀请<a class="ae lr" href="https://streamlit.io/sharing" rel="noopener ugc nofollow" target="_blank">。根据文档，Streamlit共享只能通过邀请获得。一旦你提出请求，需要几天时间才能收到邀请。如果您迫不及待，想要立即将您的应用程序托管到Heroku，请查看我下面的文章，这是如何将您的Streamlit应用程序部署到Heroku的分步指南。</a></p><div class="ny nz gp gr oa ob"><a rel="noopener follow" target="_blank" href="/a-quick-tutorial-on-how-to-deploy-your-streamlit-app-to-heroku-874e1250dadd"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd ir gy z fp og fr fs oh fu fw ip bi translated">关于如何将您的Streamlit应用程序部署到Heroku的快速教程。</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">欢迎学习如何将您的Streamlit应用程序部署到Heroku的分步教程。在过去的两周里，我一直…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="ox l om on oo ok op kp ob"/></div></div></a></div><p id="130d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在您已经有了更好的理解，我将带您看一下我自己的应用程序。如上例，我的main()函数由我的Streamlit应用程序的代码组成。我的应用程序由一个侧边栏组成，允许用户在应用程序和以下页面中导航:</p><ul class=""><li id="6a9c" class="nb nc iq kx b ky kz lb lc le nd li ne lm nf lq ng nh ni nj bi translated">主页</li><li id="cfba" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">全球形势</li><li id="3c55" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">世卫组织地区的情况</li><li id="607e" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">美国的情况</li></ul><p id="fe49" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我在应用程序中使用的组件如下:</p><ul class=""><li id="1198" class="nb nc iq kx b ky kz lb lc le nd li ne lm nf lq ng nh ni nj bi translated">圣题</li><li id="bdbd" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">st.subheader</li><li id="a366" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">圣马克当</li><li id="6387" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">圣侧边栏电台</li><li id="f1a6" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">st.sidebar.markdown</li><li id="5505" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">st.info</li><li id="d5d4" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">圣映像</li><li id="f2ad" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">st.table</li><li id="83bb" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">圣普罗特利图表</li><li id="4813" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">叶子_静电</li></ul><p id="d2dd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了更好地理解每个功能，我强烈推荐文档。点击<a class="ae lr" href="https://docs.streamlit.io/en/stable/getting_started.html" rel="noopener ugc nofollow" target="_blank">此处</a>获取文档。我花了几天时间才找到创建应用程序的窍门。添加一个侧边栏、图片、gif和不同种类的情节真的很简单。如前所述，对于我的Plotly和folium图，我使用了st.plotly_chart()和folium_static()函数。要完全访问我创建Streamlit应用程序的主函数，请单击下面的链接并向下滚动到main()函数。</p><div class="ny nz gp gr oa ob"><a href="https://github.com/navido89/covid19-dashboard-dataviz/blob/master/app.py" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd ir gy z fp og fr fs oh fu fw ip bi translated">navido 89/covid 19-仪表板-数据</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">github.com</p></div></div><div class="ok l"><div class="oy l om on oo ok op kp ob"/></div></div></a></div><p id="664f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">总体而言，Streamlit的性能令人印象深刻。为了提高应用程序的性能，我强烈建议利用缓存机制。点击<a class="ae lr" href="https://docs.streamlit.io/en/stable/caching.html" rel="noopener ugc nofollow" target="_blank">此处</a>查看如何在你的应用中实现缓存机制的文档。</p><h1 id="8e9d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论:</h1><p id="93fa" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">总的来说，我对使用Streamlit的简单性印象深刻。更让我印象深刻的是它在数据加载时间和图形渲染时间方面的性能。当我今天(2021年3月18日)写这篇文章时，Strimlit宣布了它的自定义主题。你现在可以在你的应用中打开黑暗模式和光明模式。除此之外，你可以自定义你的应用程序的风格。当我看到它的新更新的消息时，我抓住了这个机会，给我的应用程序添加了一些样式。请参见下文，了解如何在不同主题之间切换。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/4e3d44f3698e04f81c9700bfee36fb83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*BbJSsTfnUCeDU_lRc51o6w.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者Gif</p></figure><p id="4207" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我希望你喜欢这篇文章，并从中获得灵感来创建自己的Streamlit应用程序。如果你对这个话题有任何问题或者对我的应用有任何反馈，请告诉我。总有改进的余地。如果你喜欢这篇文章，如果你能在任何社交媒体平台上分享它，我将非常感激。直到下一个time️！✌️</p><div class="ny nz gp gr oa ob"><a href="https://www.navidma.com/" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd ir gy z fp og fr fs oh fu fw ip bi translated">纳维德·马辛奇作品集</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">我是Navid Mashinchi，是加利福尼亚州萨克拉门托的一名数据科学家。我一直在分析领域工作…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">www.navidma.com</p></div></div><div class="ok l"><div class="oz l om on oo ok op kp ob"/></div></div></a></div></div></div>    
</body>
</html>