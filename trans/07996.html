<html>
<head>
<title>How to Query Your Pandas Dataframe</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何查询你的熊猫数据框架</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-query-your-pandas-dataframe-c6f7d64164bc?source=collection_archive---------19-----------------------#2021-07-22">https://towardsdatascience.com/how-to-query-your-pandas-dataframe-c6f7d64164bc?source=collection_archive---------19-----------------------#2021-07-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3979" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">数据科学家对类似SQL的Python函数的看法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/614c2748e898595603e2faad28b5267e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4QGDnoH-DNhWoUKyCOUypw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@hongqi?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">布鲁斯洪</a>在<a class="ae ky" href="https://unsplash.com/s/photos/pandas?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a>【1】上拍照。</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="3f8a" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">目录</h1><ol class=""><li id="4e9a" class="ly lz it ma b mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">介绍</li><li id="1208" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated">多重条件</li><li id="c7e5" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated">在多个特定列上合并</li><li id="66ec" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated">摘要</li><li id="d954" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated">参考</li></ol><h1 id="d5a0" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">介绍</h1><p id="d160" class="pw-post-body-paragraph na nb it ma b mb mc ju nc md me jx nd mf ne nf ng mh nh ni nj mj nk nl nm ml im bi translated">无论您是从数据工程师/数据分析师转型，还是想成为更高效的数据科学家，查询数据框架都是返回所需特定行的非常有用的方法。需要注意的是，熊猫有一个特定的查询函数，名为<code class="fe nn no np nq b">query</code>。然而，我将讨论模拟查询、过滤和合并数据的其他方法。我们将介绍一些常见的场景或问题，您可能会对您的数据提出这些问题，而不是SQL，我们将用Python来完成。在下面的段落中，我将概述一些使用Python编程语言为pandas数据帧查询行的简单方法。</p><h1 id="3904" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">多重条件</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/11de85bef230572190a3588d0393ee75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*9Ots13i7jPp-KWSMpkcJuw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">样本数据。截图来自作者[2]。</p></figure><p id="b465" class="pw-post-body-paragraph na nb it ma b mb ns ju nc md nt jx nd mf nu nf ng mh nv ni nj mj nw nl nm ml im bi translated">作为数据科学家或数据分析师，我们希望返回特定的数据行。其中一个场景是您希望在同一行代码中应用多个条件。为了展示我的例子，我创建了一些名和姓的假样本数据，以及它们各自的性别和出生日期。这个数据显示在上面的截图中。</p><p id="488f" class="pw-post-body-paragraph na nb it ma b mb ns ju nc md nt jx nd mf nu nf ng mh nv ni nj mj nw nl nm ml im bi translated">多个条件的例子本质上回答了一个特定的问题，就像使用SQL一样。问题是，在我们的数据中，出生于2010年至2021年间的人有百分之多少是男性。</p><blockquote class="nx ny nz"><p id="16af" class="na nb oa ma b mb ns ju nc md nt jx nd ob nu nf ng oc nv ni nj od nw nl nm ml im bi translated">下面是解决这个问题的代码(<em class="it">回答这个问题有几种方法，但这里是我的具体做法</em>):</p></blockquote><pre class="kj kk kl km gt oe nq of og aw oh bi"><span id="90fa" class="oi lh it nq b gy oj ok l ol om">print(“Percent of data who are Males OR were born between 2010 and 2021:”,<br/> 100*round(df[(df[‘Gender’] == ‘M’) | (df[‘Birthdate’] &gt;= ‘2010–01–01’) &amp; <br/> (df[‘Birthdate’] &lt;= ‘2021–01–01’)][‘Gender’].count()/df.shape<br/> [0],4), “%”)</span></pre><p id="359f" class="pw-post-body-paragraph na nb it ma b mb ns ju nc md nt jx nd mf nu nf ng mh nv ni nj mj nw nl nm ml im bi translated">为了更好地形象化这段代码，我还附上了上面这段代码的截图，以及输出/结果。您还可以应用这些条件来返回实际的行，而不是从全部行中获取行的分数或百分比。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/1f0272c26788970aa0be55b0918817d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CHezsJv9i4e6LsGQ_cBYfQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">条件代码。作者截图[3]。</p></figure><blockquote class="nx ny nz"><p id="0eff" class="na nb oa ma b mb ns ju nc md nt jx nd ob nu nf ng oc nv ni nj od nw nl nm ml im bi translated">以下是我们执行命令的顺序:</p></blockquote><ul class=""><li id="3b39" class="ly lz it ma b mb ns md nt mf oo mh op mj oq ml or mn mo mp bi translated">返回带有男性<code class="fe nn no np nq b">Gender</code>的行</li><li id="1978" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml or mn mo mp bi translated">包括<strong class="ma iu">或</strong>功能<code class="fe nn no np nq b">|</code></li><li id="a180" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml or mn mo mp bi translated">返回<code class="fe nn no np nq b">Birthdate</code> &gt; 2010和2021的行</li><li id="36af" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml or mn mo mp bi translated">将所有这些组合起来，然后除以总行数</li></ul><p id="0bb3" class="pw-post-body-paragraph na nb it ma b mb ns ju nc md nt jx nd mf nu nf ng mh nv ni nj mj nw nl nm ml im bi translated">如您所见，这段代码类似于您在SQL中看到的内容。我个人认为这在pandas中更容易，因为它可以减少代码，同时还可以在一个容易的地方直观地看到所有代码，而不必上下滚动(<em class="oa">但这种格式只是我的偏好</em>)。</p><h1 id="7797" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">在多个特定列上合并</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/e46238889bc558e137d91571d8fe835b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vab2Gy79e5ffh5PWvO4Vww.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">合并数据帧结果。作者截图[4]。</p></figure><p id="24be" class="pw-post-body-paragraph na nb it ma b mb ns ju nc md nt jx nd mf nu nf ng mh nv ni nj mj nw nl nm ml im bi translated">我们可能已经在其他教程中看到了如何将数据帧合并在一起，所以我想添加一种我还没有真正看到过的独特方法，即对多个特定列进行合并。在这个场景中，我们希望连接两个数据帧，其中两个字段在它们之间共享。可以看出，如果有更多的列，这种方法可能会更有用。</p><blockquote class="nx ny nz"><p id="6b8c" class="na nb oa ma b mb ns ju nc md nt jx nd ob nu nf ng oc nv ni nj od nw nl nm ml im bi translated">我们有了第一个数据帧df，然后我们在第二个数据帧df2上合并我们的列。下面是实现我们预期结果代码:</p></blockquote><pre class="kj kk kl km gt oe nq of og aw oh bi"><span id="77db" class="oi lh it nq b gy oj ok l ol om">merged_df = df.merge(df2, how=’inner’, <br/> left_on=cols, <br/> right_on=cols<br/> )</span></pre><p id="8950" class="pw-post-body-paragraph na nb it ma b mb ns ju nc md nt jx nd mf nu nf ng mh nv ni nj mj nw nl nm ml im bi translated">为了更好地可视化这种合并和编码，我展示了下面的截图。您可以看到下面第二个数据帧的样子，带有名称<code class="fe nn no np nq b">First</code>和<code class="fe nn no np nq b">Last</code>，就像它们在第一个数据帧中一样，但是有一个新的列<code class="fe nn no np nq b">Numeric</code>。然后，我们列出了想要合并的特定列，同时返回列<code class="fe nn no np nq b">Gender</code>、<code class="fe nn no np nq b">Birthdate</code>，以及新的<code class="fe nn no np nq b">Numeric</code>列。列是列的列表，命名为<code class="fe nn no np nq b">cols</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/8b29c35d41ac1613e875bf5bc378314c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*63FYHEkNKTGkibCAbEBUNg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">正在合并数据帧。作者截图[5]。</p></figure><p id="7195" class="pw-post-body-paragraph na nb it ma b mb ns ju nc md nt jx nd mf nu nf ng mh nv ni nj mj nw nl nm ml im bi translated">如您所见，这种合并数据帧的方式是一种简单的方法，可以获得与SQL查询相同的结果。</p><h1 id="4cc1" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">摘要</h1><p id="626d" class="pw-post-body-paragraph na nb it ma b mb mc ju nc md me jx nd mf ne nf ng mh nh ni nj mj nk nl nm ml im bi translated">在本教程中，我们看到了两个您将在SQL中执行的常见问题或查询，但它们是用Python中的pandas数据帧来执行的。</p><blockquote class="nx ny nz"><p id="9445" class="na nb oa ma b mb ns ju nc md nt jx nd ob nu nf ng oc nv ni nj od nw nl nm ml im bi translated"><em class="it">总结一下，下面是我们处理过的两个场景:</em></p></blockquote><pre class="kj kk kl km gt oe nq of og aw oh bi"><span id="318c" class="oi lh it nq b gy oj ok l ol om">* Returning the percent of rows out of the total dataset from multiple conditions</span><span id="df12" class="oi lh it nq b gy ou ok l ol om">* Merging on multiple, specific columns to return a final datafarme with a new column</span></pre><p id="b588" class="pw-post-body-paragraph na nb it ma b mb ns ju nc md nt jx nd mf nu nf ng mh nv ni nj mj nw nl nm ml im bi translated">我希望你觉得我的文章既有趣又有用。如果你同意或不同意这些方法，请在下面随意评论。为什么或为什么不？这些当然可以进一步澄清，但我希望我能够阐明一些使用pandas和Python代替SQL的方法。感谢您的阅读！</p><p id="c28a" class="pw-post-body-paragraph na nb it ma b mb ns ju nc md nt jx nd mf nu nf ng mh nv ni nj mj nw nl nm ml im bi translated"><em class="oa">请随时查看我的个人资料、</em> <a class="ov ow ep" href="https://medium.com/u/abe5272eafd9?source=post_page-----c6f7d64164bc--------------------------------" rel="noopener" target="_blank"> Matt Przybyla </a> <em class="oa">和其他文章，也可以在LinkedIn上联系我。</em></p><p id="7998" class="pw-post-body-paragraph na nb it ma b mb ns ju nc md nt jx nd mf nu nf ng mh nv ni nj mj nw nl nm ml im bi translated">我与这些公司没有关系。</p><h1 id="d863" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">参考</h1><p id="49e9" class="pw-post-body-paragraph na nb it ma b mb mc ju nc md me jx nd mf ne nf ng mh nh ni nj mj nk nl nm ml im bi translated">[1]图片由<a class="ae ky" href="https://unsplash.com/@hongqi?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Bruce Hong </a>在<a class="ae ky" href="https://unsplash.com/s/photos/pandas?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a>(2018)上拍摄</p><p id="f476" class="pw-post-body-paragraph na nb it ma b mb ns ju nc md nt jx nd mf nu nf ng mh nv ni nj mj nw nl nm ml im bi translated">[2] M. Przybyla，样本数据截图，(2021年)</p><p id="f54d" class="pw-post-body-paragraph na nb it ma b mb ns ju nc md nt jx nd mf nu nf ng mh nv ni nj mj nw nl nm ml im bi translated">[3] M. Przybyla，条件代码截图，(2021年)</p><p id="3590" class="pw-post-body-paragraph na nb it ma b mb ns ju nc md nt jx nd mf nu nf ng mh nv ni nj mj nw nl nm ml im bi translated">[4] M. Przybyla，合并数据框架结果截图，(2021年)</p><p id="7064" class="pw-post-body-paragraph na nb it ma b mb ns ju nc md nt jx nd mf nu nf ng mh nv ni nj mj nw nl nm ml im bi translated">[5] M. Przybyla，合并数据框架截图，(2021年)</p></div></div>    
</body>
</html>