<html>
<head>
<title>Fast &amp; Easy Python APIs Using FastAPI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用FastAPI的快速简单的Python APIs</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/fast-easy-python-apis-using-fastapi-83c3115d1045?source=collection_archive---------15-----------------------#2021-07-08">https://towardsdatascience.com/fast-easy-python-apis-using-fastapi-83c3115d1045?source=collection_archive---------15-----------------------#2021-07-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="547b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">最好的python框架之一！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/2abfb00163ff1fc8dceae7877fd27d2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*c5rFruvzo6YTywUi.jpg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">Solaiman Hossen 在<a class="ae ku" href="https://unsplash.com/s/photos/fast?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div><div class="ab cl kv kw hx kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="im in io ip iq"><p id="e0eb" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><a class="ae ku" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank"> FastAPI </a>是一个现代的、基于python的高性能web框架，用于创建Rest APIs。它的主要特点是速度快，编码速度提高了300%，bug少，易于使用，对生产友好。</p><p id="33bf" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">关于Fast API的唯一缺点是它相对较新，它的社区不像其他框架如<a class="ae ku" href="https://predictivehacks.com/python-rest-api-example/" rel="noopener ugc nofollow" target="_blank"> Flask </a>那么大，但我认为它会快速增长，因为许多公司如微软、网飞和优步已经在使用它。</p><p id="11d7" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">在这篇文章中，我将向您展示如何使用Fast API创建一些简单的GET和POST APIs。</p><h1 id="edd5" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">装置</h1><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="1414" class="mv lz it mr b gy mw mx l my mz">pip install fastapi</span></pre><p id="015b" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们还需要一个ASGI服务器，用于像<a class="ae ku" href="https://www.uvicorn.org/" rel="noopener ugc nofollow" target="_blank">uvicon</a>这样的产品。</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="9b32" class="mv lz it mr b gy mw mx l my mz">pip install uvicorn</span></pre><h1 id="bc8e" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">你好世界</h1><p id="8d01" class="pw-post-body-paragraph lc ld it le b lf na ju lh li nb jx lk ll nc ln lo lp nd lr ls lt ne lv lw lx im bi translated">让我们从创建最简单的API开始。它将返回一个JSON消息“Hello World”。</p><p id="7ec1" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">用下面的代码创建一个“main.py”文件。</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="29af" class="mv lz it mr b gy mw mx l my mz">#import FastAPI<br/>from fastapi import FastAPI<br/> <br/>#create a FastAPI instance<br/>app = FastAPI()<br/> <br/>#create a path operation<br/>@app.get(“/”)<br/>#define the path operation function<br/>def root():<br/> return {“message”: “Hello World”}</span></pre><p id="81e7" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">如您所见，使用FastAPI创建API有4个主要步骤。第一步是导入它，然后创建一个FastAPI实例(在我们的例子中称为app)。</p><p id="ce68" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">之后，我们必须创建一个路径操作。这意味着我们必须设置URL路径(在我们的例子中是'/'，但我们可以设置任何类似'/helloworld ')及其操作。我们所说的操作是指HTTP方法，如GET、POST、PUT和DELETE(在我们的例子中，操作是<strong class="le iu"> get </strong>)。</p><p id="9a2e" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">最后，我们必须定义路径操作函数。换句话说，一个函数返回我们想从我们的API中得到的东西(在我们的例子中是一个带有Hello World消息的JSON。</p><p id="7645" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">现在，通过终端导航到main.py文件夹，并运行以下命令:</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="850c" class="mv lz it mr b gy mw mx l my mz">uvicorn main:app --reload</span></pre><p id="f97e" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">您应该会看到以下输出。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nf"><img src="../Images/6e508e1f6e15dac0ec155f135c5302fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8trgoSkIanA0pOXn.png"/></div></div></figure><p id="f13e" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">这意味着我们的API运行在<a class="ae ku" href="http://127.0.0.1:8000." rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:8000。让我们看看我们得到了什么。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/a0353a4d23a9c4995268332ab0b3559a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/0*mBtPJmJr4T9pR_Qz.png"/></div></figure><h1 id="47b4" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">路径参数</h1><p id="2e59" class="pw-post-body-paragraph lc ld it le b lf na ju lh li nb jx lk ll nc ln lo lp nd lr ls lt ne lv lw lx im bi translated">假设我们想要创建一个GET API，它接受两个数字作为输入，并返回它们的和。要添加参数你只需要把它们作为路径操作函数的参数。</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="0198" class="mv lz it mr b gy mw mx l my mz">from fastapi import FastAPI<br/> <br/>app = FastAPI()<br/> <br/><a class="ae ku" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.get("/addition")<br/>def sum(a, b):<br/>    return {"Result": a+b}</span></pre><p id="f042" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">可以通过添加符号“<strong class="le iu">”向URL传递参数？</strong>"然后参数之间用符号“&amp;”隔开。让我们试试下面的方法:</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="10ed" class="mv lz it mr b gy mw mx l my mz"><a class="ae ku" href="http://127.0.0.1:8000/addition?a=12&amp;b=13" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/addition?a=12&amp;b=13</a></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nl"><img src="../Images/8111c97dc9cb8a3905813d1304174d9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WQz3XDZ3qSAiOKKR.png"/></div></div></figure><p id="2843" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">就这么简单。您还可以设置参数的类型，如整数或字符串，这样，如果用户输入不同的类型，它将返回一个警告。</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="14d6" class="mv lz it mr b gy mw mx l my mz">@app.get("/addition")</span><span id="5397" class="mv lz it mr b gy nm mx l my mz"><strong class="mr iu">def</strong> <!-- -->sum(a:int, b:int):<br/>    <strong class="mr iu">return</strong> <!-- -->{"Result": a<strong class="mr iu">+</strong>b}</span></pre><p id="274b" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">让我们抽出一根绳子，看看我们会得到什么。</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="f867" class="mv lz it mr b gy mw mx l my mz"><a class="ae ku" href="http://127.0.0.1:8000/addition?a=12&amp;b=aa" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/addition?a=12&amp;b=aa</a></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nn"><img src="../Images/e19f527dfa74e0bd7d4c11b6f69c1025.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2Bfak76Q35lBQota.png"/></div></div></figure><h1 id="94d0" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">发布API</h1><p id="d23c" class="pw-post-body-paragraph lc ld it le b lf na ju lh li nb jx lk ll nc ln lo lp nd lr ls lt ne lv lw lx im bi translated">我将向您展示如何创建一个POST API，它将JSON文件作为输入。让我们看一个简单的例子。</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="5967" class="mv lz it mr b gy mw mx l my mz">from fastapi import FastAPI<br/>from pydantic import BaseModel<br/> <br/>app = FastAPI()<br/> <br/> <br/>class inputs(BaseModel):<br/>    a:int<br/>    b:int<br/>    c:int<br/>    d:int<br/>         <br/>         <br/><a class="ae ku" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.post('/show_data')<br/>def show_data(data: inputs):<br/>    return({"data":[data.a,data.b,data.c,data.d]})</span></pre><p id="eead" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们必须导入<strong class="le iu"> BaseModel </strong>并创建一个BaseModel类，它包含JSON文件的变量(在我们的例子中是a，b，c，d)。然后，我们必须将该类设置为操作函数中的一个变量(在我们的例子中，<strong class="le iu">数据:输入</strong>)。现在，我们可以使用类变量的名称和它的变量名称(如data.a)来访问函数内部的变量，以访问变量a、data.b等。</p><p id="1890" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">FastAPI自动为我们提供了<a class="ae ku" href="https://swagger.io/tools/swagger-ui/" rel="noopener ugc nofollow" target="_blank"> <strong class="le iu"> SwaggerUI </strong> </a>，这是一个天才且非常有用的UI，允许我们可视化API的资源并与之交互。它还可以用于测试，甚至是像上面这样的POST APIs。您可以通过在APIs URL中添加<strong class="le iu"> /docs </strong>来访问它。</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="e8f6" class="mv lz it mr b gy mw mx l my mz"><a class="ae ku" href="http://127.0.0.1:8000/docs" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/docs</a></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/1b33b318e820e1c6fc978dc2d1e6f111.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*x8IDR10Bi5N6lVHV.gif"/></div></figure><p id="c93d" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">正如你在上面的视频中看到的，我们已经测试了我们的API，它运行得很完美。</p><h1 id="91a8" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">案例研究:通过REST API服务于机器学习模型</h1><p id="b21d" class="pw-post-body-paragraph lc ld it le b lf na ju lh li nb jx lk ll nc ln lo lp nd lr ls lt ne lv lw lx im bi translated">对于这个例子，我们将使用著名的虹膜数据集训练一个简单的ML模型来预测虹膜的类型(Setosa、Versicolour和Virginica)。然后，我们将使用FastAPI创建一个POST API，它将输入特性并返回预测。</p><p id="df64" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">首先，让我们训练我们的模型并将其保存到pickle文件中。</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="824c" class="mv lz it mr b gy mw mx l my mz">from sklearn import datasets<br/>from sklearn.linear_model import LogisticRegression<br/>import pandas as pd<br/>iris = datasets.load_iris()<br/>features=pd.DataFrame(iris['data'])<br/>target=iris['target']<br/>model=LogisticRegression(max_iter=1000)<br/>model.fit(features,target)<br/> <br/>import pickle<br/>pickle.dump(model, open('model_iris', 'wb'))</span></pre><p id="252d" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">现在，我们准备创建我们的API。</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="a17c" class="mv lz it mr b gy mw mx l my mz">from fastapi import FastAPI<br/>from pydantic import BaseModel<br/> <br/>app = FastAPI()<br/> <br/> <br/>class iris(BaseModel):<br/>    a:float<br/>    b:float<br/>    c:float<br/>    d:float<br/>         <br/>from sklearn.linear_model import LogisticRegression<br/>import pandas as pd<br/>import pickle<br/>#we are loading the model using pickle<br/>model = pickle.load(open('model_iris', 'rb'))<br/> <br/>         <br/>     <br/><a class="ae ku" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.post('/make_predictions')<br/>async def make_predictions(features: iris):<br/>    return({"prediction":str(model.predict([[features.a,features.b,features.c,features.d]])[0])})</span></pre><p id="4600" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">现在，如果你用下面的JSON输入上面的API，你会得到一个预测。</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="8213" class="mv lz it mr b gy mw mx l my mz">{<br/>  "a": 1.1,<br/>  "b": 3.3,<br/>  "c": 5,<br/>  "d": 1<br/>}</span><span id="b8c4" class="mv lz it mr b gy nm mx l my mz">{<br/>  "prediction": "2"<br/>}</span></pre><h1 id="2f92" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">总结一下</h1><p id="6532" class="pw-post-body-paragraph lc ld it le b lf na ju lh li nb jx lk ll nc ln lo lp nd lr ls lt ne lv lw lx im bi translated">FastAPI是Rest APIs的最佳Python框架之一，因为它快速、简单且对生产友好。它的社区将会快速发展，因为像网飞、优步和微软这样的公司已经在使用它了。你不需要任何比我们在这篇文章中提到的更多的东西，所以开始尝试吧！</p><p id="111b" class="pw-post-body-paragraph lc ld it le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><em class="np">最初发表于https://predictivehacks.com</em><a class="ae ku" href="https://predictivehacks.com/fast-easy-python-apis-using-fastapi/" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>