<html>
<head>
<title>Data Imbalance in Regression</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">回归中的数据不平衡</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-imbalance-in-regression-e5c98e20a807?source=collection_archive---------10-----------------------#2021-06-01">https://towardsdatascience.com/data-imbalance-in-regression-e5c98e20a807?source=collection_archive---------10-----------------------#2021-06-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="719e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">回归分析中数据不平衡的调查及对策</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0156c8627d2bdc1b9c31676c61c4ad3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*L4Y8uH3EjQkNf-C6"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@imgix?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> imgix </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="d678" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="4b01" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">数据不平衡是现实世界数据集的一个典型问题。通过查看二元分类任务，可以最好地描述数据不平衡。在二元分类中，如果0类和1类之间的样本数量不均匀，则数据集是不平衡的。机器学习模型倾向于更好地预测具有更多样本的类(多数类)而不是具有较少样本的类(少数类)。这种不平衡越大，模型对多数阶级的偏向就越高。在回归分析中，数据不平衡不太明显，但可能存在并导致问题。本文给出了一个回归任务中数据不平衡的例子和一些对策。每个对策用于训练一个线性回归模型，并相互比较结果。可以看出，使用对策提高了R平方得分和均方误差(MSE)。这些对策可以直接用于其他不平衡回归任务，以提高性能。使用的数据集是Boston Housing数据集，可以在<a class="ae ky" href="https://scikit-learn.org/stable/datasets/toy_dataset.html" rel="noopener ugc nofollow" target="_blank"> scikit-learn </a>上找到。完整的jupyter笔记本可以在我的github页面上找到。</p><h1 id="5d62" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">数据输入</h1><p id="e6b7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">本章介绍如何加载数据。使用scikit-learn库和pandas加载数据。图1显示了将数据集加载到pandas数据框中的python代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1:将波士顿住房数据加载到pandas数据框中的代码(由作者编写)。</p></figure><p id="51ac" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">该数据集已经只包含浮点型要素，没有缺失值，因此无需进一步预处理。</p><h1 id="6021" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">目标变量的分布</h1><p id="2ffb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">该数据集的目标变量是“以1000美元为单位的自有住房的中值”(MEDV)，如数据集说明中所述。图2显示了目标变量的直方图。在最佳情况下，目标变量的分布将是正态分布。但是，可以看出，波士顿住房数据集的目标变量显然不是这种情况。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/b562cae7d8716b7250f45d5932bb414b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*Jhi8ykW4KceUn30do0jv4w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2:波士顿住房目标变量直方图(图片由作者提供)。</p></figure><p id="cac3" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">平均值在20左右，第一部分看起来已经很像正态分布了。但是有一个较高MEDV值的大右尾。这可能会导致一个问题，即该模型可以更好地预测平均值周围的MEDV值，但在预测右尾的MEDV值时却非常糟糕。这是因为在大多数情况下，模型会看到平均值附近的值，因此偏向于这些MEDV值。</p><p id="03a5" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">还可以执行统计测试，以验证该分布不是正态分布。图3显示了计算这个分布是正态分布的零假设的p值的代码。实际上，小于0.05的p值意味着可以拒绝零假设。因此，p值为0.05或更大意味着该分布是正态分布。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3:执行统计测试以检查数据分布是否为正态分布的代码(由作者编写)。</p></figure><p id="7631" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">该统计测试的p值为1.76e-20，因此远小于0.05。</p><h1 id="1cc4" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">目标变量的变换</h1><p id="ed27" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如前一章所示，目标变量是高度倾斜的。本章的目标是介绍可应用于目标变量的不同变换。这些转换的目标是使目标变量的分布更接近正态分布，从而消除不平衡。</p><h2 id="61d3" class="mv la it bd lb mw mx dn lf my mz dp lj ma na nb ll me nc nd ln mi ne nf lp ng bi translated">平方根变换</h2><p id="da59" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">第一个变换是平方根变换。这个转换只是计算目标变量的每个条目的平方根(等式1)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/7777209287dce0087d346b35d628fc41.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*VEsUfJi-GuoFZ2dcO4lKHQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">等式1:应用于输入目标变量的平方根变换(图片由作者提供)。</p></figure><p id="a05f" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">图4显示了应用这个转换后目标变量的直方图。新的分布看起来已经不那么偏斜了，但仍然不像正态分布。新分布的p值为3.56e-5，因此仍低于0.05。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/0617d7b7943b8d45ade97c7a5255e8fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*JrJkmWtJHoWTlWxiXtw0uQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4:应用平方根变换后的波士顿住房目标变量直方图(图片由作者提供)。</p></figure><h2 id="0a66" class="mv la it bd lb mw mx dn lf my mz dp lj ma na nb ll me nc nd ln mi ne nf lp ng bi translated">对数变换</h2><p id="ff0d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">另一个有用的转换是计算输入目标变量的每个条目的自然对数(等式2)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/c7184c512f494eec4ab006121829a039.png" data-original-src="https://miro.medium.com/v2/resize:fit:518/format:webp/1*LvwjE4j_vXNXJEmbDnsWAA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">等式2:应用于输入目标变量的对数变换(图片由作者提供)。</p></figure><p id="647c" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">图5显示了应用对数变换后的直方图。这个分布看起来比原来的好，但仍然不像正态分布。这个分布的p值在1.82e-4，仍然低于0.05。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/b8d6fb310736876afa2a0227c754a1aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*_uB_ilePtgJgMPxC613eOA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图5:应用对数变换后的波士顿住房目标变量直方图(图片由作者提供)。</p></figure><h2 id="3cd5" class="mv la it bd lb mw mx dn lf my mz dp lj ma na nb ll me nc nd ln mi ne nf lp ng bi translated">Box Cox变换</h2><p id="5248" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">最后介绍的变换是Box Cox变换。等式3示出了如何计算Box Cox变换，其中λ被确定为使得分布最佳地接近正态分布。图6显示了如何使用SciPy库计算Box Cox转换，而图7显示了转换后的目标变量的分布。这种分布已经看起来非常类似于正态分布，并且达到了大于0.05的p值0.1。因此，我们可以说该分布等于正态分布。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/0fc1eab98d170163404eff35432e319e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9h7ilqKJ7lyrznh98udrwQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">等式3:应用于输入目标变量的Box Cox变换(图片由作者提供)。</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图6:计算Box Cox变换的代码(作者代码)。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/9ea92117e59260d5c2331ceddf56f7e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*xR_8k7VdsI656A_N5SCk3Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图7:应用Box Cox变换后的波士顿住房目标变量直方图(图片由作者提供)。</p></figure><h1 id="499f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">训练线性回归模型</h1><p id="89c5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这一章中，为每个转换以及没有应用转换时训练线性回归模型。这有助于检查哪种转换最适合当前数据集，以及转换是否有助于提高性能。为了应用转换，创建了一个Transformer类。该类还能够应用逆变换，从而可以将变换后的模型的预测转换回来，并且可以将预测与原始测试数据进行比较。图8显示了Transformer类的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图8:用于应用转换和逆转换的Transformer类的代码(由作者编写)。</p></figure><p id="7935" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">下一步，为每个转换和原始的、未转换的案例训练一个线性回归模型(图9)。使用scikit-learn中的StandardScaler类对训练数据进行缩放。这里，重要的是仅在训练数据上训练定标器，以避免数据泄漏到测试集中，从而得到过于乐观的结果。然后，为每个转换训练一个线性回归模型，并使用Transformer类转换目标数据。在训练之后，执行对拒绝测试数据的预测，并且使用当前应用的变换的逆变换将预测转换回来。最后，计算R平方得分和MSE，并将其存储在数据帧中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图9:为每个转换训练线性回归模型的代码，并在保留测试集上获取结果。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/a7928f29e09ad8b74a40b222ceeafb6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:530/format:webp/1*URv_Da_oFNFL-t_qDJVkOQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图10:测试集的最终结果。</p></figure><p id="0674" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma mr mc md me ms mg mh mi mt mk ml mm im bi translated">图10显示了最终的数据帧。正如你所看到的，所有的转换都会导致两个分数的提高。Box Cox变换和log变换的性能最好。</p><h1 id="a32f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="274e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">数据不平衡不仅是分类任务中的问题，也是回归任务中的问题。回归模型的性能可能受到目标变量的分布不是正态分布和偏斜的事实的影响。对目标变量应用转换可以提高性能。</p></div></div>    
</body>
</html>