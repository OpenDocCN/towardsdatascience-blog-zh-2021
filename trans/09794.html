<html>
<head>
<title>Data Analysis with Scala</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Scala进行数据分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-analysis-using-scala-f3846602fb0d?source=collection_archive---------33-----------------------#2021-09-13">https://towardsdatascience.com/data-analysis-using-scala-f3846602fb0d?source=collection_archive---------33-----------------------#2021-09-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="df34" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用最大信息系数和RScala库进行可视化的示例学习</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a2f6a90037a5b33dfc7d47975ff798e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0d19fZ-u4CtNFdNG"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">马库斯·斯皮斯克在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="02da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">选择合适的工具进行数据分析非常重要。在举办国际数据科学竞赛的Kaggle.com<a class="ae kv" href="http://kaggle.com/" rel="noopener ugc nofollow" target="_blank">论坛上，人们经常会问哪个工具更好。r和Python排在最前面。在这篇文章中，我们将告诉你另一套数据分析技术，基于Scala编程语言和</a><a class="ae kv" href="http://spark.apache.org/" rel="noopener ugc nofollow" target="_blank"> Spark </a>分布式计算平台。</p><h1 id="7eea" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">我们是怎么想出来的？</h1><p id="6db0" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在Retail Rocket，我们对非常大的数据集进行了大量的机器学习。我们以前用一堆IPython+pyh S2(Python的hive驱动)+ Pandas + Sklearn开发原型。在2014年夏末，我们做出了一个根本性的决定，转而使用Spark，因为实验表明，在相同的服务器上，我们将获得3到4倍的性能提升。</p><p id="ed98" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一个优点是，我们可以使用一种编程语言来建模和编写将在生产服务器上运行的代码。这对我们来说是一个巨大的好处，因为之前我们同时使用4种语言:Hive，Pig，Java，Python。这是一个小工程师团队的问题。</p><p id="88ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Spark很好地支持通过API与Python/Scala/Java协同工作。我们决定选择Scala，因为它是编写Spark的语言，这意味着我们可以分析它的源代码，并在需要时修复bug。它也是运行Hadoop的JVM。</p><p id="50fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我必须说这个选择并不容易，因为当时团队中没有人了解Scala。众所周知，要学会用一种语言很好地交流，你需要让自己沉浸在这种语言中，并尽可能多地使用它。所以我们放弃了Python栈，转而使用Scala进行建模和快速数据分析。</p><p id="0538" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一步是找到IPython笔记本的替代品。这些选择如下:</p><ol class=""><li id="31b7" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated"><a class="ae kv" href="https://zeppelin.apache.org/" rel="noopener ugc nofollow" target="_blank">Zeppelin</a>—Spark的IPython式笔记本；</li><li id="b335" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><a class="ae kv" href="https://github.com/tribbloid/ISpark" rel="noopener ugc nofollow" target="_blank">ISpark</a>；</li><li id="16a9" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">火花笔记本；</li><li id="944e" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">IBM的Spark IPython笔记本。</li><li id="2e2d" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">阿帕奇T <a class="ae kv" href="https://toree.apache.org/" rel="noopener ugc nofollow" target="_blank"> oree </a></li></ol><p id="9874" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到目前为止，选择ISpark是因为它很简单——它是Scala/Spark的IPython。附加高图表和R图形相对容易。我们可以毫不费力地把它连接到纱线束上。</p><h1 id="710a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">工作</h1><p id="9800" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们试着回答这个问题:</p><p id="b55f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">您在线商店的平均订单价值(AOV)是否取决于静态客户参数，包括结算、浏览器类型(移动/桌面)、操作系统和浏览器版本？</strong></p><p id="cd4a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以用<a class="ae kv" href="http://en.wikipedia.org/wiki/Mutual_information" rel="noopener ugc nofollow" target="_blank">交互信息</a>做到这一点。我们在推荐算法和分析中大量使用熵:经典的香农公式、Kullback-Leibler散度、互信息。我们甚至提交了一份关于这个主题的论文。在Murphy关于机器学习的著名教科书[5]中，有一个单独的，尽管很小的章节专门讨论这些措施。</p><p id="1b49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面就以我自己真实的零售火箭数据来分析一下。在进行分析之前，所有数据都是完全匿名的。事先，我将样本从我们的集群复制到我的计算机上，作为一个csv文件。</p><h1 id="e099" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">数据</h1><p id="4850" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这里我们使用ISpark和Spark在本地模式下运行，这意味着所有计算都在本地执行，并分布在处理器内核中。一切都在代码的注释中描述。最重要的是，在输出中我们得到了RDD (Spark数据结构)，它是Row类型的case类的集合，这是在代码中定义的。这将允许您通过“.”引用字段例如_.categoryId。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/2d4c423b460261ed372eaf744dd396c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mAFuSu8JoBnH59DX.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">资料截图，图片作者</p></figure><p id="a1e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的行使用了在1.3.0版本中添加到Spark的新DataFrame数据类型，它与Python中pandas库中的类似结构非常相似。toDf选择了我们的行case类，所以我们可以通过名称来引用这个字段。</p><p id="7c65" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了进一步分析，我们需要选择单个类别，最好是有大量数据的类别。为此，我们需要获得最流行类别的列表。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="65b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了进一步的工作，我决定选择第128类。</p><p id="4b15" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们准备数据:让我们过滤必要类型的操作系统，以避免在图表中添加噪声。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="736c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">想要可视化，让我们在HighCharts中实现它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/f723c6e4f426d29b3a4d9b1efe8eb102.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ovwNbB5P68lKKpiHmJwDhA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">操作系统的AOV，作者的图像</p></figure><p id="b56b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以使用任何HighCharts图形，只要Wisp支持它们。所有图表都是交互式的。</p><p id="a54c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们尝试做同样的事情，但是使用R. <br/>运行R客户端并绘制一个char:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/d74b39c0cfa6e79178c5a713fbb50a10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Kfc6XjrLC-0u09C7.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">操作系统的AOV，作者的图像</p></figure><h1 id="5709" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">交互信息</h1><p id="afc3" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">图表显示了这种关系，但是指标能为我们证实这个结论吗？有很多方法可以做到这一点。在我们的例子中，我们使用表中值之间的互信息。它测量两个随机(离散)变量分布之间的相互依赖性。</p><p id="b000" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于离散分布，使用以下公式计算:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/cd0324eb3d898864032c38d2548829e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2x676nN-f5Rt8_e8NRjkyA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="e835" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是我们对一个更实用的度量标准感兴趣——最大信息系数(MIC ),它需要对连续变量进行一些复杂的计算。下面是这个参数的定义。</p><p id="a96c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">设D = (x，Y)是随机变量X和Y的n个有序元素对的集合，这个二维空间由X和Y网格划分，将X和Y值分别分组到X和Y分区中(还记得直方图吗！).</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/83bd5e2406f2065c6a655b91392b7c8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tVXuO7pqq6eZQu01s1YSFg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="ab49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其中B(n)是网格大小，I∫(D，X，Y)是X和Y分区的互信息。分母指定对数，用于将MIC归一化为段[0，1]的值。MIC取区间[0，1]内的连续值:对于极值，有依赖关系为1，没有依赖关系为0。关于这个主题还有什么可以阅读的，列在文章末尾的参考书目中。</p><p id="d02a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">《T2》一书(机器学习:概率视角)称MIC(互信息)为21世纪的相关性。原因如下！来自[1]和[4]的<a class="ae kv" href="https://www.cs.ubc.ca/~murphyk/MLbook/figReport-16-Aug-2012/pdfFigures/MICfig4.pdf" rel="noopener ugc nofollow" target="_blank">图</a>显示了6个相关性(C到H图)。已经为它们计算了皮尔逊相关和MIC，并在左边的图表上用相应的字母标出。正如我们所看到的，皮尔逊相关性几乎为零，而MIC显示了相关性(图F、G、E)。根据[1]，MIC可以很好地检测非线性相关性。</p><p id="4609" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的例子中，我们正在处理一个MIC计算，其中我们有一个连续的变量AOV，所有其他的都是离散的无序值，如浏览器类型。为了正确计算MIC，我们需要离散化AOV变量。我们将使用来自exploredata.net的现成解决方案。这种解决方案有一个问题:它假设两个变量都是连续的，并且用浮点值表示。因此，我们必须通过将离散变量的值编码成Float并随机改变这些变量的顺序来欺骗代码。为此，我们将不得不以随机顺序(100)进行多次迭代，我们将取最大MIC值作为结果。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="8a26" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于这个实验，我添加了一个均匀分布的随机变量和AOV(平均购买价值)本身。正如我们所见，几乎所有MIC都低于随机MIC，这可以被认为是一个“有条件的”决策阈值。AOV麦克风几乎是统一的，这是自然的，因为它本身的相关性等于1。</p><p id="e506" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个有趣的问题出现了:为什么我们在图中看到了相关性，但MIC为零？我们可以提出很多假设，但最有可能的是，对于操作系统家族来说，这很简单Windows机器的数量远远高于其他机器的数量。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/8f5f1b38a79e345ad495f848c63896ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kVnjP_F-21-6qc3imnJBCA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Windows机器的数量远远高于其他机器，图片由作者提供</p></figure><p id="e5cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">结论</strong> <br/>我希望Scala在数据分析师(数据科学家)中得到普及。它非常方便，因为它可以使用标准的IPython笔记本+获得Spark的所有功能。这段代码可以安全地处理万亿字节的数据，您只需要更改ISpark中的配置行，指定集群的URI。</p><p id="a91b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Roman Zykov是Retail Rocket的联合创始人，也是《Roman ' s Data Science:How to money your Data》一书的作者。</p><p id="8dd4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">参考文献</strong></p><p id="92ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[1] Reshef，D. N .，Y. A. Reshef，H. K. Finucane，S. R. Grossman，G. McVean，P. J. Turnbaugh，E. S. Lander，M. Mitzenmacher和P. C. Sabeti，“<a class="ae kv" href="https://www.researchgate.net/publication/51884204_Detecting_Novel_Associations_in_Large_Data_Sets" rel="noopener ugc nofollow" target="_blank">检测大型数据集中的新关联。</a>(2011)<br/>【2】<a class="ae kv" href="https://minepy.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">Minepy库</a> —基于最大信息量的非参数探索。<br/>【3】<a class="ae kv" href="http://www.exploredata.net/Downloads" rel="noopener ugc nofollow" target="_blank">用数据集挖掘Java库</a>。<br/>【4】凯文·帕特里克·墨菲，<a class="ae kv" href="https://probml.github.io/pml-book/book0.html" rel="noopener ugc nofollow" target="_blank">《机器学习:一种概率视角》</a>，2012<br/>【5】<a class="ae kv" href="https://gist.github.com/rzykov/2c66b2bfffad3136837ab9dc0c22000c" rel="noopener ugc nofollow" target="_blank">以上代码要点</a></p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><p id="7aef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">【https://topdatalab.com】原载于<a class="ae kv" href="https://topdatalab.com/blog/tpost/1p3lt20od1-data-analysis-using-scala" rel="noopener ugc nofollow" target="_blank"><em class="nr"/></a><em class="nr">。</em></p></div></div>    
</body>
</html>