<html>
<head>
<title>Safely Test and Apply Changes to Your Database: Getting Started with Alembic</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">安全地测试并应用对数据库的更改:Alembic入门</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-database-migrations-for-beginners-getting-started-with-alembic-84e4a73a2cca?source=collection_archive---------6-----------------------#2021-11-08">https://towardsdatascience.com/python-database-migrations-for-beginners-getting-started-with-alembic-84e4a73a2cca?source=collection_archive---------6-----------------------#2021-11-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0825" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用这个简单的Python工具对数据库进行版本控制</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8006047bad3c68ffb2ce63f60cf8b294.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*o6pve3cDWpD7Uan4"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">迁移就像蓝图；它们是建立你的数据库的说明(图片由<a class="ae ky" href="https://www.pexels.com/@jeshoots-com-147458" rel="noopener ugc nofollow" target="_blank">jeshouts</a>在<a class="ae ky" href="https://www.pexels.com/photo/floor-plan-on-table-834892/" rel="noopener ugc nofollow" target="_blank">像素</a>上提供)</p></figure><p id="370e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您没有在数据库中处理迁移，那么您就错过了。数据库迁移在代码中建立了数据库的结构和变更历史，并为我们提供了安全地应用和恢复数据库变更的能力。</p><p id="b68c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将看看一个Alembic一个Python工具，使迁移工作变得非常简单。有了它，我们将创建与数据库无关的迁移(这意味着您可以在任何数据库上执行它们。这些迁移是用代码定义的，这意味着我们可以应用类似Git的版本控制；跟踪变更，拥有单一的事实来源，以及与多个开发人员协作的能力。当您阅读完本文后，您将能够:</p><ul class=""><li id="afee" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">用代码定义对数据库结构的更改</li><li id="d82c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">版本控制变更</li><li id="52cb" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">应用和恢复迁移</li><li id="bf4b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">将迁移应用到多个数据库(例如，在开发数据库上进行测试，然后将最终结构迁移到生产数据库)</li><li id="531c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">不仅要创建所需的表，还要添加索引和关联</li></ul><p id="c679" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了向你展示给同事留下深刻印象所需的所有特征，我定义了5个步骤:</p><ol class=""><li id="42d9" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu mj mb mc md bi translated">安装和设置</li><li id="f9fb" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">创建迁移</li><li id="9e51" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">执行和撤消迁移</li><li id="006f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">将更改应用到现有数据库</li><li id="be38" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu mj mb mc md bi translated">将新的迁移应用到不同的数据库</li></ol></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="7b6e" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">1.安装和设置</h1><p id="f636" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">我们将使用一个名为Alembic的Python包。这个包使得创建数据库迁移变得很容易。</p><h2 id="6e67" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">装置</h2><p id="5a79" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">安装很简单。打开一个终端，导航到您的项目目录并执行下面的代码。这将安装并初始化Alembic。注意，在根目录下创建了一个名为<code class="fe oa ob oc od b">/alembic</code>的文件夹。</p><p id="e344" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="oe">不熟悉使用终端？查看</em> <strong class="lb iu"> <em class="oe">下面的文章</em> </strong></p><div class="of og gp gr oh oi"><a rel="noopener follow" target="_blank" href="/terminals-consoles-command-line-for-absolute-beginners-de7853c7f5e8"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd iu gy z fp on fr fs oo fu fw is bi translated">面向绝对初学者的终端/控制台/命令行</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">命令行使用简介</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">towardsdatascience.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow ks oi"/></div></div></a></div><pre class="kj kk kl km gt ox od oy oz aw pa bi"><span id="90c2" class="no ms it od b gy pb pc l pd pe">pip install alembic<br/>alembic init alembic</span></pre><p id="fc32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将建立一个数据库连接。Alembic必须知道要连接到哪个数据库。通常我们会通过调整sqlalchemy.url在<code class="fe oa ob oc od b">/alembic.ini</code>中指定这个值，但是最好覆盖这个值。打开<code class="fe oa ob oc od b">/alembic/env.py</code>，找到<code class="fe oa ob oc od b">config = context.config</code>。在此下方插入以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pf pg l"/></div></figure><p id="79e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="oe">保护您的凭证安全:建议从环境变量中加载连接字符串。</em> </strong> <em class="oe">如果您将此项目上传到公共存储库，任何人都可以看到您的凭据。使用环境变量，您可以通过将所有机密信息(如密码和连接字符串)放在一个文件中来保护您的凭证安全，我们可以</em> <code class="fe oa ob oc od b"><em class="oe">.gitignore</em></code> <em class="oe">。在下面的文章中看看这是如何工作的:</em></p><div class="of og gp gr oh oi"><a rel="noopener follow" target="_blank" href="/keep-your-code-secure-by-using-environment-variables-and-env-files-4688a70ea286"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd iu gy z fp on fr fs oo fu fw is bi translated">通过使用环境变量和env文件来保证代码的安全</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">安全地加载一个文件，其中包含我们的应用程序所需的所有机密数据，如密码、令牌等</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">towardsdatascience.com</p></div></div><div class="or l"><div class="ph l ot ou ov or ow ks oi"/></div></div></a></div><p id="ec51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们通过在终端中运行<code class="fe oa ob oc od b">alembic current</code>来测试我们与的连接。这显示了我们的数据库目前的状态。如果您看到类似下面的文字，说明您已经成功连接到数据库。</p><pre class="kj kk kl km gt ox od oy oz aw pa bi"><span id="2d54" class="no ms it od b gy pb pc l pd pe">INFO [alembic.runtime.migration] Context impl PostgresqlImpl.<br/>INFO [alembic.runtime.migration] Will assume transactional DDL.</span></pre></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="a54e" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">2.创建迁移</h1><p id="d4b8" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">执行下面的代码来创建您的第一个迁移:<br/> <code class="fe oa ob oc od b">alembic revison -m "create test schema"</code> <br/>这将在<code class="fe oa ob oc od b">/alembic/versions</code>中创建一个新文件。这个文件是我们实际的迁移，它包含两个函数:<br/> 1。升级<br/> 2。使降低</p><p id="45d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第一个函数中，我们将放入想要执行的代码，例如创建一个模式。在第二个函数中，我们将在第一个函数中放置撤销操作的代码，例如删除模式:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pf pg l"/></div></figure><p id="43a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在升级中，我们告诉alembic执行一些SQL来创建一个模式。<br/>在降级中，我们放置指令来撤销这一点，删除模式。</p><p id="74b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很清楚，对吧？让我们创建一些表格！我们将创建三个表:学生、班级和学生_班级。显然，学生和班级将是存储学生和班级信息的表。Student_classes将一个或多个学生id连接到一个或多个班级id。这是因为一个学生可以有多个班级，而一个班级可以有多个学生:</p><p id="91af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">学生表</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pf pg l"/></div></figure><p id="5295" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你所看到的，我们使用了<code class="fe oa ob oc od b">op.create_table</code>函数来创建一个表格。首先我们将指定表名，然后指定所有列。最后，我们指定模式名。如果您只想使用默认模式，可以省略。还要注意，我们添加了像主键和“可空”这样的约束。降级功能再次撤销升级。</p><p id="9deb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">阶级表<br/> </strong>这里我们只看升级功能:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pf pg l"/></div></figure><p id="e21d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">student_classes表 <br/>在这个表中我们需要做一些花哨的东西。因为该表的存在只是为了将学生绑定到班级，反之亦然，所以我们可以定义更多的功能:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pf pg l"/></div></figure><p id="09af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以看到，在上面的代码中，我们用ondelete="CASCADE "标志定义了foreignKeys。这意味着如果一个班级或一个学生从他们的表中被删除(一个学生毕业或一个班级被终止)，那么这些删除会级联到student_class表中；删除相关记录。这使我们的数据保持整洁。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/962a4f506651b4abf3cc887603505d98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2tN-__QwJ4B6t__p"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的数据库正在建设中(图片由<a class="ae ky" href="https://unsplash.com/@sunburned_surveyor" rel="noopener ugc nofollow" target="_blank">斯科特·布莱克</a>在<a class="ae ky" href="https://unsplash.com/photos/x-ghf9LjrVg" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上提供)</p></figure><h1 id="6d68" class="mr ms it bd mt mu pj mw mx my pk na nb jz pl ka nd kc pm kd nf kf pn kg nh ni bi translated">3.执行和撤消迁移</h1><p id="5d09" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">现在我们已经定义了所有的表和关系，是时候将它们反映到数据库中了。在您的终端中只需执行:<br/> <code class="fe oa ob oc od b">alembic upgrade head</code></p><p id="a7ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这告诉alembic升级所有脚本，直到像Git中的head。<br/>之后，我们可以调用<code class="fe oa ob oc od b">alembic history</code>来显示如下内容:</p><pre class="kj kk kl km gt ox od oy oz aw pa bi"><span id="7085" class="no ms it od b gy pb pc l pd pe">(venv) C:\rnd\med_alembic&gt;alembic history<br/>a3e1bb14f43b -&gt; a46099cad4d5 (head), student_classes<br/>058a1e623c60 -&gt; a3e1bb14f43b, create classes table<br/>73d31032477a -&gt; 058a1e623c60, create students table<br/>Revision ID: 058a1e623c60<br/>Revises: 73d31032477a<br/>Create Date: 2021–10–22 12:58:23.303590<br/>&lt;base&gt; -&gt; 73d31032477a, create test schema</span></pre><p id="a4b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这显示了我们执行的所有迁移，前面有一个代码。我们可以用这个代码来降级像:<br/> <code class="fe oa ob oc od b">alembic downgrade 058a1e623c60</code></p><p id="4310" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将撤消所有迁移，直到创建“创建学生表”迁移。<br/>返回一个迁移:<code class="fe oa ob oc od b">alembic downgrade -1</code>(数字，不是L) <br/>恢复所有迁移:<code class="fe oa ob oc od b">alembic downgrade base</code></p><h2 id="a117" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">重置数据库</h2><p id="a9e1" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">如果你仍然在测试和开发数据库，你可以很容易地重置。假设您插入了一些数据，并在一次迁移中发现了一个错误；可能是错误的列名。只需调整升级函数中的错误并调用:<br/> <code class="fe oa ob oc od b">alembic downgrade base &amp;&amp; alembic upgrade head</code> <br/>这将在一条语句中重置您的整个数据库！虽然这对您的开发数据库非常方便，但我不建议在您的生产数据库上执行此命令，因为所有数据都将丢失</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="650e" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">4.将更改应用到现有表格</h1><p id="88f1" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">有时您需要对现有的表格进行调整；重命名列、调整数据类型或添加索引或约束。使用Alembic，您可以通过首先在开发数据库上开发它们来设计、测试和验证这些更改。一旦您对一切都满意了，您就可以插入一个不同的<code class="fe oa ob oc od b">.env</code>文件，并将所有新的更改迁移到生产数据库！下面是一些如何做到这一点的例子。</p><h2 id="17e3" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">添加约束</h2><p id="c0b8" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">假设这些表已经投入生产，但是缺少了一些东西。首先，我们要向classes表中的name列添加一个惟一约束；我们不能有多个同名的类。我们用<br/> <code class="fe oa ob oc od b">alembic revision -m “create unique constraint classes.name”</code>创建一个新的迁移</p><p id="5032" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后添加以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pf pg l"/></div></figure><p id="9438" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这么简单！</p><h2 id="519f" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">添加索引</h2><p id="8987" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">下一个问题:我们的学生表增长了很多。我们来加个索引吧！<br/> <code class="fe oa ob oc od b">alembic revision -m “add index on students.name</code> <br/>下面的代码将创建索引。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pf pg l"/></div></figure><h2 id="df1e" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">重命名列和更改数据类型</h2><p id="ea8c" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">使用alter_column函数可以更改重命名列、更改数据类型和调整某些约束(可为null等):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pf pg l"/></div></figure><p id="631d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这会将列名从“name”更改为“student_name ”,并将从字符串()更改为最大长度为100个字符的字符串。<br/>请注意，降级再次撤销了我们所有的更改。</p><p id="30d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">别忘了检查一下<code class="fe oa ob oc od b">alembic upgrade head</code>前后的区别！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/e28d110d16e42d2ee000eb5af3775159.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9FaPfN3TblA2An_h"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的数据库被迁移了！(图片由<a class="ae ky" href="https://unsplash.com/@ubay732" rel="noopener ugc nofollow" target="_blank"> Ubay Seid </a>在<a class="ae ky" href="https://unsplash.com/photos/XV9pLr_tat4" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄)</p></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="f6ea" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">5.将新的迁移应用到不同的数据库</h1><p id="d360" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">不，我们已经在Postgres dev数据库上测试了所有迁移，现在是时候将所有更改迁移到我们的生产数据库了。为此，我们只需连接到生产数据库并执行迁移。最好的方法是使用一个安全保存所有连接信息的文件。</p><p id="b3df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还记得第1部分的<code class="fe oa ob oc od b">/alembic/env.py</code>文件吗？这是我们定义数据库连接字符串的地方。我们所要做的就是将不同的<code class="fe oa ob oc od b">.env</code>文件插入到Alembic中。然后，我们可以从环境中加载连接字符串的各个部分。在这种情况下，我将使用<code class="fe oa ob oc od b">python-dotenv</code>包来加载<code class="fe oa ob oc od b">.env</code>文件，并创建如下所示的连接字符串。<a class="ae ky" href="https://mikehuls.medium.com/keep-your-code-secure-by-using-environment-variables-and-env-files-4688a70ea286" rel="noopener">更多关于<strong class="lb iu">如何使用env文件这里</strong> </a>。</p><pre class="kj kk kl km gt ox od oy oz aw pa bi"><span id="8a93" class="no ms it od b gy pb pc l pd pe">db_user = os.environ.get("DB_USER")<br/>db_pass = os.environ.get("DB_PASS")<br/>db_host = os.environ.get("DB_HOST")<br/>db_name = os.environ.get("DB_NAME")<br/>db_type = os.environ.get("DB_TYPE")<br/>config.set_main_option('sqlalchemy.url', f'{db_type}://{db_user}:{db_pass}@{db_host}/{db_name}')</span></pre></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="a65c" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">结论</h1><p id="fb21" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">数据库迁移为我们提供了安全测试和应用数据库更改的能力。因为我们写出了代码中的所有更改，所以我们可以将它们包含到我们的版本控制中，这提供了更多的安全性。总而言之，使用Alembic简单、安全，是设计、测试和更改数据库的好主意。我希望已经阐明了这些迁移是如何工作的，以及如何使用Alembic。</p><p id="725f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有建议/澄清，请评论，以便我可以改进这篇文章。同时，看看我的其他关于各种编程相关主题的文章:</p><ul class=""><li id="0e43" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/create-a-fast-auto-documented-maintainable-and-easy-to-use-python-api-in-5-lines-of-code-with-4e574c00f70e" rel="noopener">用FastAPI用5行代码创建一个快速自动记录、可维护且易于使用的Python API</a></li><li id="a650" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/python-to-sql-upsert-safely-easily-and-fast-17a854d4ec5a" rel="noopener">从Python到SQL——安全、轻松、快速地升级</a></li><li id="1b75" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/create-and-publish-your-own-python-package-ea45bee41cdc" rel="noopener">创建并发布你自己的Python包</a></li><li id="1aea" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/create-your-custom-python-package-that-you-can-pip-install-from-your-git-repository-f90465867893" rel="noopener">创建您的定制私有Python包，您可以从您的Git库PIP安装该包</a></li><li id="92b7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/virtual-environments-for-absolute-beginners-what-is-it-and-how-to-create-one-examples-a48da8982d4b" rel="noopener">面向绝对初学者的虚拟环境——什么是虚拟环境以及如何创建虚拟环境(+示例)</a></li><li id="2b41" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/dramatically-improve-your-database-inserts-with-a-simple-upgrade-6dfa672f1424" rel="noopener">通过简单升级，显著提高数据库插入速度</a></li></ul><p id="22ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！</p><p id="9de4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">—迈克</p><p id="4670" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">页（page的缩写）学生:比如我正在做的事情？<a class="ae ky" href="https://mikehuls.medium.com/membership" rel="noopener">跟着我！</a></p></div></div>    
</body>
</html>