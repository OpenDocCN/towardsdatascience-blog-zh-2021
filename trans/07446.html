<html>
<head>
<title>Python Tricks: How to Check Table Merging with Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python技巧:如何检查与熊猫的表合并</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-tricks-how-to-check-table-merging-with-pandas-cae6b9b1d540?source=collection_archive---------13-----------------------#2021-07-07">https://towardsdatascience.com/python-tricks-how-to-check-table-merging-with-pandas-cae6b9b1d540?source=collection_archive---------13-----------------------#2021-07-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/cfe2a975422334b0c879e9ca4dfa7536.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*B1WJ6enbgk6pRXg7"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@mbaumi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">米卡·鲍梅斯特</a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><div class=""/><div class=""><h2 id="9d29" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">一个让你免受挫折的关键词</h2></div><p id="fbd9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">欢迎阅读一系列短文，每篇短文都有方便的Python技巧，可以帮助你成为更好的Python程序员。在这篇博客中，我们将探讨检查熊猫的连接。</p><h2 id="2280" class="lu lv jj bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">情况</h2><p id="6c21" class="pw-post-body-paragraph ky kz jj la b lb mn kk ld le mo kn lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">当我们在Python中处理数据集集合时，知道如何将表连接在一起是至关重要的。我们都知道SQL中的<code class="fe ms mt mu mv b">INNER JOIN</code>、<code class="fe ms mt mu mv b">LEFT JOIN</code>、<code class="fe ms mt mu mv b">RIGHT JOIN</code>、<code class="fe ms mt mu mv b">FULL OUTER JOIN</code>以及在熊猫中是如何做到的，但你知道还有一个不太为人知的关键字参数叫<code class="fe ms mt mu mv b">indicator</code>吗？</p><p id="c650" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">出于说明的目的，我们将使用下面的表格，其中<code class="fe ms mt mu mv b">ID</code>将被用作本博客剩余部分的表格之间的公共键:</p><pre class="mw mx my mz gt na mv nb nc aw nd bi"><span id="c4a3" class="lu lv jj mv b gy ne nf l ng nh">import pandas as pd</span><span id="d02b" class="lu lv jj mv b gy ni nf l ng nh">df_left = pd.DataFrame({<br/>    "ID": [0, 1, 2],<br/>    "first_name": ["Dave", "Henry", "Alex"],<br/>    "last_name": ["Smith", "Adams", "Brown"],<br/>})</span><span id="e026" class="lu lv jj mv b gy ni nf l ng nh">df_right = pd.DataFrame({<br/>    "ID": [1, 2, 3],<br/>    "location": ["London", "Berlin", "Paris"],<br/>    "age": [25, 34, 18],<br/>})</span></pre><figure class="mw mx my mz gt iv gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/55d4a1dfa92dc68cc37a6106f553eb30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*TWcnBcPf4MzzyuXMC4oIcg.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">说明性虚拟表格—作者图片</p></figure><h2 id="50e5" class="lu lv jj bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">Pandas中类似SQL的连接操作的快速修改</h2><pre class="mw mx my mz gt na mv nb nc aw nd bi"><span id="46ef" class="lu lv jj mv b gy ne nf l ng nh"><strong class="mv jk"># Inner Join</strong><br/>df_results = df_left.merge(<br/>    df_right, <br/>    on=["ID"], <br/>    how="left"<br/>)</span><span id="cd1c" class="lu lv jj mv b gy ni nf l ng nh"><strong class="mv jk"># Left Join</strong><br/>df_results = df_left.merge(<br/>    df_right, <br/>    on=["ID"], <br/>    how="left"<br/>)</span><span id="7815" class="lu lv jj mv b gy ni nf l ng nh"><strong class="mv jk"># Right Join</strong><br/>df_results = df_left.merge(<br/>    df_right, <br/>    on=["ID"], <br/>    how="right"<br/>)</span><span id="ed44" class="lu lv jj mv b gy ni nf l ng nh"><strong class="mv jk"># Outer Join</strong><br/>df_results = df_left.merge(<br/>    df_right, <br/>    on=["ID"], <br/>    how="outer"<br/>)</span></pre><figure class="mw mx my mz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nk"><img src="../Images/f202b484063a0b0d768859426b20b04b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kIa43cRWG0kVFMt3OEBNsw.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">加入插图-作者图片</p></figure><p id="0dc1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意，我们使用了一个列表作为关键字参数<code class="fe ms mt mu mv b">on</code>的输入，以展示放入多个键列是可能的。如果<code class="fe ms mt mu mv b">ID</code>是唯一的键列，请随意使用<code class="fe ms mt mu mv b">"ID"</code>而不是<code class="fe ms mt mu mv b">["ID"]</code>。</p><h2 id="bb6c" class="lu lv jj bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">检查合并结果</h2><p id="d525" class="pw-post-body-paragraph ky kz jj la b lb mn kk ld le mo kn lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">每当连接两个表时，检查结果表。无数个夜晚，我试图合并表，并认为连接是正确的(双关语😉)意识到它应该被留下。您最不想做的事情就是重新访问您几个月前完成的连接，这就是为什么当您进行合并时，传递<code class="fe ms mt mu mv b">indicator=True</code>以获得有关合并结果的更多信息:</p><pre class="mw mx my mz gt na mv nb nc aw nd bi"><span id="d591" class="lu lv jj mv b gy ne nf l ng nh"><strong class="mv jk"># Outer Join</strong><br/>df_results = df_left.merge(<br/>    df_right, <br/>    on=["ID"], <br/>    how="outer",<br/>    indicator=True,<br/>)</span><span id="40d4" class="lu lv jj mv b gy ni nf l ng nh">   ID first_name last_name location   age      _merge<br/>0   0       Dave     Smith      NaN   NaN   left_only<br/>1   1      Henry     Adams   London  25.0        both<br/>2   2       Alex     Brown   Berlin  34.0        both<br/>3   3        NaN       NaN    Paris  18.0  right_only</span></pre><p id="1321" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用<code class="fe ms mt mu mv b">_merge</code>列，我们不仅可以检查任意一个表中存在的行数，还可以提取精确的行以进行进一步的质量检查。这在很多情况下有助于理解数据处理流程中的问题。</p><h2 id="dafb" class="lu lv jj bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">排除合并/反合并</h2><p id="ac1d" class="pw-post-body-paragraph ky kz jj la b lb mn kk ld le mo kn lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">使用<code class="fe ms mt mu mv b">_merge</code>列，我们还可以很容易地实现所谓的左/右合并，不包括连接和反合并。left excluding join生成的表只包含第一个表中的记录，这些记录在第二个表中没有匹配项；右排除连接是它的镜像。反合并本质上是排除连接的左和右的组合。</p><pre class="mw mx my mz gt na mv nb nc aw nd bi"><span id="81cc" class="lu lv jj mv b gy ne nf l ng nh"><strong class="mv jk"># LEFT EXCLUDING JOIN</strong><br/>df_results = df_left.merge(<br/>    <!-- -->df_right, <br/>    on=["ID"], <br/>    how="left",<br/>    indicator=True,<br/>)<br/>df_results = df_results[df_results["_merge"] == "left_only"]</span><span id="455a" class="lu lv jj mv b gy ni nf l ng nh">   ID first_name last_name location  age     _merge<br/>0   0       Dave     Smith      NaN  NaN  left_only</span></pre><p id="1dc4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不用在选择<code class="fe ms mt mu mv b">_merge == "left_only"</code>之前分配中间结果，我们实际上可以使用Pandas DataFrame的<code class="fe ms mt mu mv b">query</code>方法来实现，然后删除<code class="fe ms mt mu mv b">_merge</code>列:</p><pre class="mw mx my mz gt na mv nb nc aw nd bi"><span id="192c" class="lu lv jj mv b gy ne nf l ng nh"><strong class="mv jk"># LEFT EXCLUDING JOIN</strong><br/>df_results = (df_left.merge(<!-- -->df_right, <br/>                            on=["ID"], <br/>                            how="left",<br/>                            indicator=True<!-- -->)<br/>                     .query("_merge != 'both'")<br/>                     .drop("_merge", 1))</span><span id="52fc" class="lu lv jj mv b gy ni nf l ng nh">   ID first_name last_name location  age<br/>0   0       Dave     Smith      NaN  NaN</span><span id="4dd5" class="lu lv jj mv b gy ni nf l ng nh"><strong class="mv jk"># RIGHT EXCLUDING JOIN</strong><br/>df_results = (df_left.merge(<!-- -->df_right, <br/>                            on="ID", <br/>                            how="right",<br/>                            indicator=True<!-- -->)<br/>                     .query("_merge != 'both'")<br/>                     .drop("merge", 1))</span><span id="b577" class="lu lv jj mv b gy ni nf l ng nh">   ID first_name last_name location  age<br/>2   3        NaN       NaN    Paris   18</span><span id="8d0a" class="lu lv jj mv b gy ni nf l ng nh"><strong class="mv jk"># ANTI MERGE</strong><br/>df_results = (df_left.merge(<!-- -->df_right, <br/>                            on=["ID"], <br/>                            how="outer",<br/>                            indicator=True<!-- -->)<br/>                     .query("_merge != 'both'")<br/>                     .drop("_merge", 1))</span><span id="3c74" class="lu lv jj mv b gy ni nf l ng nh">   ID first_name last_name location   age<br/>0   0       Dave     Smith      NaN   NaN<br/>3   3        NaN       NaN    Paris  18.0</span></pre><figure class="mw mx my mz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nk"><img src="../Images/dcbcf2c27da1246da303deb4b4d0bd0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I7w-_8aU4Zvql-_YcgsD7w.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">加入插图-作者图片</p></figure></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="764a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这篇博文就讲到这里吧！我希望你已经发现这是有用的。如果你对其他Python技巧感兴趣，我为你整理了一份简短博客列表:</p><ul class=""><li id="c4fc" class="ns nt jj la b lb lc le lf lh nu ll nv lp nw lt nx ny nz oa bi translated"><a class="ae jg" rel="noopener" target="_blank" href="/python-tricks-flattening-lists-75aeb1102337"> Python技巧:拉平列表</a></li><li id="84b0" class="ns nt jj la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated"><a class="ae jg" rel="noopener" target="_blank" href="/python-tricks-simplifying-if-statements-boolean-evaluation-4e10cc7c1e71"> Python技巧:简化If语句&amp;布尔求值</a></li><li id="5387" class="ns nt jj la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated"><a class="ae jg" rel="noopener" target="_blank" href="/python-tricks-check-multiple-variables-against-single-value-18a4d98d79f4"> Python技巧:对照单个值检查多个变量</a></li></ul><p id="be3f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想了解更多关于Python、数据科学或机器学习的知识，你可能想看看这些帖子:</p><ul class=""><li id="b678" class="ns nt jj la b lb lc le lf lh nu ll nv lp nw lt nx ny nz oa bi translated"><a class="ae jg" rel="noopener" target="_blank" href="/7-easy-ways-for-improving-your-data-science-workflow-b2da81ea3b2">改进数据科学工作流程的7种简单方法</a></li><li id="3bcd" class="ns nt jj la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated"><a class="ae jg" rel="noopener" target="_blank" href="/efficient-implementation-of-conditional-logic-on-pandas-dataframes-4afa61eb7fce">熊猫数据帧上的高效条件逻辑</a></li><li id="7179" class="ns nt jj la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated"><a class="ae jg" rel="noopener" target="_blank" href="/memory-efficiency-of-common-python-data-structures-88f0f720421">常见Python数据结构的内存效率</a></li><li id="4da3" class="ns nt jj la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated"><a class="ae jg" rel="noopener" target="_blank" href="/parallelism-with-python-part-1-196f0458ca14">与Python并行</a></li><li id="979b" class="ns nt jj la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated"><a class="ae jg" rel="noopener" target="_blank" href="/cookiecutter-plugin-for-jupyter-easily-organise-your-data-science-environment-a56f83140f72">数据科学的基本Jupyter扩展设置</a></li><li id="7dd8" class="ns nt jj la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated"><a class="ae jg" rel="noopener" target="_blank" href="/mastering-root-searching-algorithms-in-python-7120c335a2a8">Python中高效的根搜索算法</a></li></ul><p id="2dff" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想了解更多关于如何将机器学习应用于交易和投资的信息，这里有一些你可能感兴趣的帖子:</p><ul class=""><li id="9753" class="ns nt jj la b lb lc le lf lh nu ll nv lp nw lt nx ny nz oa bi translated"><a class="ae jg" href="https://pub.towardsai.net/genetic-algorithm-for-trading-strategy-optimization-in-python-614eb660990d" rel="noopener ugc nofollow" target="_blank">用Python实现交易策略优化的遗传算法</a></li><li id="ef50" class="ns nt jj la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated"><a class="ae jg" href="https://medium.com/towards-artificial-intelligence/genetic-algorithm-stop-overfitting-trading-strategies-5df671d5cde1" rel="noopener">遗传算法——停止过度拟合交易策略</a></li><li id="f205" class="ns nt jj la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated"><a class="ae jg" href="https://pub.towardsai.net/ann-recommendation-system-for-stock-selection-c9751a3a0520" rel="noopener ugc nofollow" target="_blank">人工神经网络选股推荐系统</a></li></ul><div class="is it gp gr iu og"><a href="https://www.linkedin.com/in/louis-chan-b55b9287" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd jk gy z fp ol fr fs om fu fw ji bi translated">Louis Chan—FTI Consulting | LinkedIn数据科学总监</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">雄心勃勃的，好奇的和有创造力的个人，对分支知识和知识之间的相互联系有强烈的信念</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">www.linkedin.com</p></div></div><div class="op l"><div class="oq l or os ot op ou ja og"/></div></div></a></div></div></div>    
</body>
</html>