<html>
<head>
<title>Data Drift — Part 2: How to Detect Data Drift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据漂移—第2部分:如何检测数据漂移</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-drift-part-2-how-to-detect-data-drift-1f8bfa1a893e?source=collection_archive---------18-----------------------#2021-06-27">https://towardsdatascience.com/data-drift-part-2-how-to-detect-data-drift-1f8bfa1a893e?source=collection_archive---------18-----------------------#2021-06-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5710" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">识别模型中数据漂移的指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/400bf6882d5a6146059be8375a05d185.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mpyrgqwMjfclV2oN1U2VIA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由卢克·切瑟 | <a class="ae kv" href="https://unsplash.com/photos/JKUTrJ4vK00" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="5123" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">在本帖中，我们将介绍一些用于识别任何可能发生的数据漂移的技术。</strong></p><p id="932f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设您已经将一个模型部署到生产中，并且您注意到性能正在下降。性能下降背后有几个可能的原因:</p><ol class=""><li id="a25a" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">模型输入数据本身存在错误:</li></ol><ul class=""><li id="7f14" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mb ly lz ma bi translated">由于数据源的问题，输入数据可能是错误的。前端问题意味着写入数据库的数据不正确</li><li id="bffe" class="ls lt iq ky b kz mc lc md lf me lj mf ln mg lr mb ly lz ma bi translated">特征工程计算中可能存在错误。来源处的数据是正确的，但在管线中或特征工程期间存在错误，这意味着输入到特定特征的模型中的数据是不正确的</li></ul><p id="d4fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些问题通常需要进一步的人工调查，并且可以通过代码审查、调试等来解决。</p><p id="1c6c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.当外部因素导致数据发生真实变化时。这就是数据漂移，在本系列的第1部分中，我们了解了不同类型的数据漂移(协变量漂移、先验概率漂移&amp;概念漂移)和一些例子。</p><p id="d07f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设经过一些检查后，您怀疑模型性能下降确实是由于数据漂移。那么，我们如何验证这一点，并确定数据漂移发生在数据的哪个位置呢？</p><p id="a04e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">测量漂移有三种主要技术:</p><ol class=""><li id="19da" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">统计:这种方法使用数据集上的各种统计指标来得出关于训练数据的分布是否不同于生产数据分布的结论。我们已经有了数据，所以它通常涉及到每次运行相同的计算，并可能绘制结果以便于分析。</li><li id="1ff4" class="ls lt iq ky b kz mc lc md lf me lj mf ln mg lr lx ly lz ma bi translated">基于模型:这种方法包括训练分类模型，以确定某些数据点是否与另一组数据点相似。如果模型很难区分数据，那么就没有任何显著的数据漂移。如果模型能够正确地分离数据组，那么可能存在一些数据漂移。</li><li id="042c" class="ls lt iq ky b kz mc lc md lf me lj mf ln mg lr lx ly lz ma bi translated">自适应窗口(ADWIN):这种方法用于流数据，在这种情况下，有大量的无限数据流入，不可能全部存储。与此同时，数据可能会变化得非常快。</li></ol><h1 id="1895" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">1.统计法</h1><p id="48a2" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">这些方法中有许多是比较分布的。比较需要一个参考分布，它是我们用来比较生产数据分布的固定数据分布。例如，这可能是训练数据的第一个月，或者是整个训练数据集。这取决于你试图检测漂移的背景和时间范围。但是显然，参考分布应该包含足够的样本来表示训练数据集。让我们考虑一个使用2019年的数据训练的分类模型，其性能在2020年一直在缓慢下降。在这种情况下，我们可以开始尝试使用以下方法来检测顶级功能中的数据漂移。</p><p id="4f87" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong>因为我们想观察数据随时间的漂移，我们想按时间聚合或划分数据，可以是每月、每周等，这取决于您的数据和监控频率。在本例中，我们将按月汇总数据。</p><p id="3e59" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面我将解释一些用于检测漂移的不同统计方法。要查看使用真实数据集的完整代码示例，请参考我的博文<a class="ae kv" href="https://practicalml.net/Data-Drift-Code-Examples/" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><h2 id="258f" class="ne mi iq bd mj nf ng dn mn nh ni dp mr lf nj nk mt lj nl nm mv ln nn no mx np bi translated">平均</h2><p id="f400" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">我们可以考虑的第一个也是最简单的一个衡量标准是我们特征的方法。如果平均值在几个月内逐渐向某一特定方向移动，那么可能发生了数据漂移。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/b117c82dc4393407b53d2a958e6b44df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SHvfqQWWyyPcmFabXAK8FQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="7677" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以从迷你图中看到，功能A处于下降趋势。迷你图不是识别趋势的最佳工具，因为它们会使细微的变化看起来有些夸张。平均值不是检查漂移的最可靠的方法，但却是一个很好的起点。</p><h1 id="410a" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">统计距离度量</h1><p id="8e03" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">有许多不同的统计距离度量可以帮助量化分布之间的变化。不同的距离检查在不同的情况下是有用的。</p><h2 id="8cc0" class="ne mi iq bd mj nf ng dn mn nh ni dp mr lf nj nk mt lj nl nm mv ln nn no mx np bi translated">人口稳定指数</h2><p id="696a" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">PSI常用于金融行业，是一种衡量变量在两个样本之间或一段时间内的分布变化程度的指标。顾名思义，它有助于测量两个人口样本之间的人口稳定性。</p><p id="aa9b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nr ns nt nu b">Equation: PSI = (Pa — Pb)ln(Pa/Pb)</code></p><p id="1582" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ln(Pa/Pb)项意味着，与具有大百分比分布的仓中的大变化相比，代表小百分比分布的仓中的大变化对PSI的影响更大。</p><p id="17e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">应该注意的是，群体稳定性指数仅仅表示特征的变化。但是，这不一定会导致性能下降。因此，如果您确实注意到性能下降，您可以使用PSI来确认总体分布确实发生了变化。PSI检查也可以添加到您的<strong class="ky ir">监控计划</strong>中。</p><h2 id="1f58" class="ne mi iq bd mj nf ng dn mn nh ni dp mr lf nj nk mt lj nl nm mv ln nn no mx np bi translated">库尔巴克-莱布勒散度</h2><p id="84b8" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">KL散度衡量两个概率分布之间的差异，也称为相对熵。如果一个分布与另一个分布有很高的方差，KL散度是有用的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/3e3dbae82ebf53447c18ad4719652306.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*QMKMJyP6L8RR2A8fPaK_UQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">KL公式来自<a class="ae kv" href="https://en.wikipedia.org/w/index.php?title=Kullback%E2%80%93Leibler_divergence&amp;oldid=1029607529" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></figure><p id="0267" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">KL散度也是不对称的。这意味着，与PSI不同，如果参考和生产(比较)分布对被交换，结果会有所不同。所以KL(P || Q)！= KL(Q || P)。这对于涉及Baye定理的应用或当您有大量训练(参考)样本，但在比较分布中只有一小组样本(导致更多方差)时非常有用。</p><p id="afb2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">KL分数的范围从0到无穷大，其中0分意味着两个分布是相同的。如果KL公式采用以2为底的对数，结果将以位为单位，如果使用自然对数(底e)，结果将以“nats”为单位。</p><h2 id="b4fe" class="ne mi iq bd mj nf ng dn mn nh ni dp mr lf nj nk mt lj nl nm mv ln nn no mx np bi translated">詹森-香农(JS)散度</h2><p id="4f3b" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">JS散度是量化两个概率分布之间差异的另一种方式。它使用我们上面看到的KL散度来计算对称的标准化得分。这使得JS散度分数更有用，也更容易解释，因为当使用对数基数2时，它提供了0(相同分布)和1(最大不同分布)之间的分数。</p><p id="de1c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用JS，不存在被零除的问题。当一个分布在某些区域有值而另一个没有值时，就会出现被零除的问题。</p><h2 id="47a6" class="ne mi iq bd mj nf ng dn mn nh ni dp mr lf nj nk mt lj nl nm mv ln nn no mx np bi translated">瓦瑟斯坦距离度量</h2><p id="454a" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">Wasserstein距离，也称为推土机距离，是给定区域内两个概率分布之间距离的度量。Wasserstein距离对于非重叠数值分布移动和高维空间(例如图像)的统计是有用的。</p><h2 id="94de" class="ne mi iq bd mj nf ng dn mn nh ni dp mr lf nj nk mt lj nl nm mv ln nn no mx np bi translated">Kolmogorov-Smirnov检验(K-S检验或KS检验)</h2><p id="8450" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">KS检验是连续/不连续一维概率分布相等的一种<a class="ae kv" href="https://en.wikipedia.org/wiki/Nonparametric_statistics" rel="noopener ugc nofollow" target="_blank">非参数检验</a>，可用于比较样本与参考概率分布(单样本K–S检验)，或比较两个样本(双样本K–S检验)。</p><h1 id="acc3" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">2.基于模型</h1><p id="d1ca" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">上述统计方法的替代方法是建立一个分类器模型，尝试区分参考分布和比较分布。我们可以通过以下步骤做到这一点:</p><ol class=""><li id="2d3f" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">将用于构建当前生产模型的批中的数据标记为0。</li><li id="8a83" class="ls lt iq ky b kz mc lc md lf me lj mf ln mg lr lx ly lz ma bi translated">将我们从那时起收到的那批数据标记为1。</li><li id="e5b8" class="ls lt iq ky b kz mc lc md lf me lj mf ln mg lr lx ly lz ma bi translated">开发一个模型来区分这两个标签。</li><li id="10f8" class="ls lt iq ky b kz mc lc md lf me lj mf ln mg lr lx ly lz ma bi translated">评估结果，必要时调整模型。</li></ol><p id="5d52" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果开发的模型可以很容易地区分两组数据，那么协变量发生了变化，模型需要重新校准。另一方面，如果模型难以区分两组数据(其精确度约为0.5，与随机猜测一样好)，则没有发生显著的数据偏移，我们可以继续使用该模型。</p><h1 id="e860" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">3.ADWIN自适应滑动窗口</h1><p id="e9bd" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">如前所述，当我们有一个输入数据流时，上述技术不是很合适。在某些情况下，数据可能漂移得如此之快，以至于当我们收集数据并训练模型时，趋势可能已经发生了变化，我们的模型已经过时了。但是计算出训练的最佳时间框架也不是那么简单。这就是自适应滑动窗口技术有用的地方。它能适应不断变化的数据。例如，如果发生变化，窗口大小将自动缩小，否则，如果数据是静止的，窗口大小将增大以提高准确性。</p><p id="2572" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些技术可以根据其适用性来检测数据漂移。但是我们希望避免等到发现模型中的性能显著下降时才开始调查数据漂移。这就是拥有一个模型监控计划变得非常有用的地方。查看本系列文章的第3部分(即将发布),了解如何创建有效的模型监控计划。</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><p id="d928" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="od">原载于2021年6月10日</em><a class="ae kv" href="https://practicalml.net/Detecting-data-drift/" rel="noopener ugc nofollow" target="_blank"><em class="od">【https://practicalml.net】</em></a><em class="od">。</em></p><p id="ad25" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="od">在</em><a class="ae kv" href="https://practicalml.net" rel="noopener ugc nofollow" target="_blank"><em class="od">https://practicalml.net</em></a><em class="od">查看我的博客，将来会有更多帖子</em></p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><h1 id="a72c" class="mh mi iq bd mj mk oe mm mn mo of mq mr jw og jx mt jz oh ka mv kc oi kd mx my bi translated">参考</h1><p id="b94d" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">[1] Dhinakaran，A. (2020年10月19日)。<em class="od">使用机器学习可观察性的统计距离度量</em>。中等。<a class="ae kv" rel="noopener" target="_blank" href="/using-statistical-distance-metrics-for-machine-learning-observability-4c874cded78.">https://towards data science . com/using-statistical-distance-metrics-for-machine-learning-observability-4c 874 cded 78。</a></p><p id="fc61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[2]维基媒体基金会。(2021年6月21日)。<em class="od">库尔贝克-莱布勒散度</em>。维基百科。<a class="ae kv" href="https://en.wikipedia.org/w/index.php?title=Kullback%E2%80%93Leibler_divergence&amp;oldid=1029607529." rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/w/index.php?title = kull back % E2 % 80% 93 lei bler _ divergence&amp;oldid = 1029607529。</a></p><h1 id="1b84" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">进一步阅读</h1><p id="deaa" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated"><strong class="ky ir">PSI:</strong><a class="ae kv" rel="noopener" target="_blank" href="/using-statistical-distance-metrics-for-machine-learning-observability-4c874cded78.">https://towards data science . com/using-statistical-distance-metrics-for-machine-learning-observability-4c 874 cded 78。</a></p><p id="978d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">kull back-lei bler(KL)divergence:</strong><a class="ae kv" rel="noopener" target="_blank" href="/light-on-math-machine-learning-intuitive-guide-to-understanding-kl-divergence-2b382ca2b2a8">https://towardsdatascience . com/light-on-math-machine-learning-intuitive-guide-to-understanding-KL-divergence-2b 382 ca 2 B2 a 8</a></p><p id="14eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">詹森-香农(JS)散度:</strong><a class="ae kv" href="https://medium.com/datalab-log/measuring-the-statistical-similarity-between-two-samples-using-jensen-shannon-and-kullback-leibler-8d05af514b15" rel="noopener">https://medium . com/datalab-log/measuring-the-statistical-similarity-between-two-samples-using-Jensen-Shannon-and-kull back-lei bler-8d 05 af 514 b 15</a></p><p id="4fa1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">瓦瑟斯坦距离度量:</strong>(<a class="ae kv" rel="noopener" target="_blank" href="/earth-movers-distance-68fff0363ef2">https://towardsdatascience . com/earth-movers-distance-68 fff 0363 ef2</a>)</p><p id="627e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://en.wikipedia.org/wiki/Wasserstein_metric" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Wasserstein_metric</a></p><p id="a255" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">Kolmogorov–Smirnov测试:</strong><a class="ae kv" href="https://en.wikipedia.org/wiki/Kolmogorov%E2%80%93Smirnov_test#Discrete_and_mixed_null_distribution" rel="noopener ugc nofollow" target="_blank">https://en . Wikipedia . org/wiki/Kolmogorov % E2 % 80% 93 Smirnov _ test # Discrete _ and _ mixed _ null _ distribution</a></p><p id="ba84" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">基于模型:</strong><a class="ae kv" href="https://www.arangodb.com/2020/11/arangoml-part-4-detecting-covariate-shift-in-datasets/" rel="noopener ugc nofollow" target="_blank">https://www . arango db . com/2020/11/arango ml-part-4-detecting-co variate-shift-in-datasets/</a></p></div></div>    
</body>
</html>