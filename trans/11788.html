<html>
<head>
<title>A Full End-to-End Deployment of a Machine Learning Algorithm into a Live Production Environment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将机器学习算法完全端到端部署到实际生产环境中</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-full-end-to-end-deployment-of-a-machine-learning-algorithm-into-a-live-production-environment-3d9971ade188?source=collection_archive---------3-----------------------#2021-11-24">https://towardsdatascience.com/a-full-end-to-end-deployment-of-a-machine-learning-algorithm-into-a-live-production-environment-3d9971ade188?source=collection_archive---------3-----------------------#2021-11-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f718" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用scikit-learn、pickle、Flask、Microsoft Azure和ipywidgets将Python机器学习算法完全部署到真实的生产环境中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e866e1a73c5335e49394afb581ab064c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*81oVjlRcufPVKjZ2kuWXqg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@ffstop?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Fotis Fotopoulos </a>在<a class="ae ky" href="https://unsplash.com/s/photos/python?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="eac1" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="e6cc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">2021年10月，我撰写了一篇关于“将机器学习和数据科学项目部署为公共Web应用程序”的文章(参见<a class="ae ky" rel="noopener" target="_blank" href="/deploying-machine-learning-and-data-science-projects-as-public-web-applications-3abc91088c11">https://towards Data Science . com/Deploying-Machine-Learning-and-Data-Science-Projects-as-Public-we B- Applications-3abc 91088 c11</a>)。</p><p id="1275" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在本文中，我探讨了如何使用Voila、GitHub和mybinder将Jupyter笔记本部署为公共可用的web应用程序。</p><p id="8cee" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">文章发表后，我收到了读者的反馈，他们对如何进一步推动生产部署感兴趣，以探索如何将机器学习算法完全部署到真实的生产环境中，以便以平台无关的方式“消费”它，这导致了本文的想法…</p><h1 id="4d93" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">第一步:开发机器学习算法</h1><p id="f21f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">第一步是开发我们想要部署的机器学习算法。在现实世界中，这可能需要几周或几个月的开发时间，以及跨越数据科学管道步骤的大量迭代，但对于这个示例，我将开发一个基本的ML算法，因为本文的主要目的是找到一种方法来部署供“消费者”使用的算法。</p><p id="55ee" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我从ka ggle(<a class="ae ky" href="https://www.kaggle.com/prathamtripathi/drug-classification" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/prathamtripathi/drug-classification</a>)中选择了一个数据集，它是由作者以“CC0:公共领域”许可证创建的，这意味着它没有版权，可以不受限制地用于其他作品中(详见<a class="ae ky" href="https://creativecommons.org/publicdomain/zero/1.0/" rel="noopener ugc nofollow" target="_blank">https://creativecommons.org/publicdomain/zero/1.0/</a>)。</p><p id="aa65" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">开发预测性机器学习算法以在给定一系列患者标准的情况下对药物处方进行分类的Python代码如下</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="33e7" class="mz la it mv b gy na nb l nc nd">0.99 0.012247448713915901</span></pre><p id="e819" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这一点上，我们可以看到，我们有一个经过训练的机器学习算法来预测药物处方，并且交叉验证(即折叠数据)已用于评估99%的模型准确性。</p><p id="59aa" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">到目前为止，一切顺利...</p><p id="0ddc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们将把这个模型部署到生产环境中，虽然这是一个简单的例子，但我们不希望每次用户想要预测药物处方时都必须在真实环境中重新训练我们的模型，因此我们的下一步是使用<code class="fe ne nf ng mv b">pickle</code>来保存我们训练好的模型的状态...</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="e966" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，每当我们想要使用训练好的模型时，我们只需要从<code class="fe ne nf ng mv b">model.pkl</code>文件中重新加载它的状态，而不是重新执行训练步骤。</p><h1 id="bcc3" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">第二步:根据训练好的模型进行个人预测</h1><p id="4aab" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我将在第二步做几个假设-</p><ol class=""><li id="55ed" class="nh ni it lt b lu mn lx mo ma nj me nk mi nl mm nm nn no np bi translated">机器学习算法的消费者要求对单个患者而不是一批患者进行预测。</li><li id="678c" class="nh ni it lt b lu nq lx nr ma ns me nt mi nu mm nm nn no np bi translated">这些消费者希望使用类似文本的参数值(例如血压=“正常”或“高”)与算法进行交流，而不是像0和1这样的标签编码等价物。</li></ol><p id="c1f7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">因此，我们将从查看用作算法输入的所有标签编码分类特征的值开始…</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="91a6" class="mz la it mv b gy na nb l nc nd">Sex ['F', 'M'] [0, 1] <br/><br/>BP ['HIGH', 'LOW', 'NORMAL'] [0, 1, 2] <br/><br/>Cholesterol ['HIGH', 'NORMAL'] [0, 1] <br/><br/>Drug ['DrugY', 'drugC', 'drugX', 'drugA', 'drugB'] [0, 3, 4, 1, 2]</span></pre><p id="8325" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在我们有了一个列表，其中列出了数据中出现的每个分类特征的唯一值，以及由<code class="fe ne nf ng mv b">LabelEncoder()</code>转换的相应数值。</p><p id="d1fb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">有了这些知识，我们可以提供一组映射文本类值(例如“高”、“低”等)的字典。)转换成它们的编码等价物，然后开发一个简单的函数来进行如下的单独预测…</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="93a6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然后，可以通过调用该函数根据原始数据的值进行一些预测来验证该实现，这样我们就知道输出应该是什么…</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="b825" class="mz la it mv b gy na nb l nc nd">'drugC'</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="6fac" class="mz la it mv b gy na nb l nc nd">'DrugY'</span></pre><p id="a9a6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">请注意，我们的<code class="fe ne nf ng mv b">predict_drug</code>函数不需要训练模型，而是将之前由<code class="fe ne nf ng mv b">pickle</code>保存其状态的模型“再水合”到<code class="fe ne nf ng mv b">model.pkl</code>文件中，我们可以从输出中看到药物推荐的预测是正确的。</p><h1 id="9ad4" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤3:开发Web服务包装器</h1><p id="941e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">到目前为止，一切看起来都很好，但主要问题是:我们的机器学习算法的客户或消费者必须用Python编程语言编写，不仅如此，我们必须有能力改变和修改应用程序。</p><p id="dbf1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果第三方应用程序想要使用和消费我们的算法，如果这个第三方应用程序不是用Python编写的，该怎么办？也许它是用Java、C#、JavaScript或其他非Python语言编写的。</p><p id="2bb1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这就是web服务的用武之地。web服务是一个“包装器”,它使用http GET和http PUT命令接收来自客户端和消费者的请求，调用Python代码并将结果作为HTML响应返回。</p><p id="6c85" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这意味着客户端和调用者只需要能够制定HTTP请求，几乎所有的编程语言和环境都有办法做到这一点。</p><p id="9a88" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在Python世界中，有几种不同的方法可用，但我选择的是使用<code class="fe ne nf ng mv b">flask</code>来构建我们的web服务包装器。</p><p id="412a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">代码并不复杂，但要配置VS代码以使开发人员能够调试flask应用程序是一个挑战。如果您需要这一步的教程，请查看我的文章“如何在VS代码中调试Flask应用程序”，可以在这里找到—<a class="ae ky" rel="noopener" target="_blank" href="/how-to-debug-flask-applications-in-vs-code-c65c9bdbef21">https://towardsdatascience . com/How-to-Debug-Flask-Applications-in-VS-Code-c 65 c 9 BD bef 21</a>。</p><p id="fe47" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">以下是web服务的包装代码…</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="fc23" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">从Anaconda Navigator页面启动VS代码IDE(或者通过启动Anaconda命令提示符并键入<code class="fe ne nf ng mv b">code</code>)。这将使用conda基本环境启动VS代码，这是运行和调试flask应用程序所必需的。</p><p id="4acc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">通过点击“运行和调试”，然后选择“Flask启动并调试Flask web应用程序”，可以从VS代码内部启动web服务</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/04c6fbe3c90aa47adc47ca2604d05699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aPwCyr17WgzrEAJOG8dskw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b2ec" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果一切都按计划进行，终端窗口中的最后一条消息应该是<code class="fe ne nf ng mv b">Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)</code>,这表明您的flask web应用程序已经启动并正在运行。</p><p id="5294" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您现在应该使用这些方法之一来测试您的web服务</p><ol class=""><li id="4eb9" class="nh ni it lt b lu mn lx mo ma nj me nk mi nl mm nm nn no np bi translated">打开网页浏览器，输入:<a class="ae ky" href="http://127.0.0.1:5000/drug?Age=60&amp;Sex=F&amp;BP=LOW&amp;Cholesterol=HIGH&amp;Na_to_K=20" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:5000/drug？年龄=60 &amp;性别=F &amp;血压=低&amp;胆固醇=高&amp; Na_to_K=20 </a></li><li id="c799" class="nh ni it lt b lu nq lx nr ma ns me nt mi nu mm nm nn no np bi translated">打开anaconda命令提示符并输入:<code class="fe ne nf ng mv b">curl -X GET "http://127.0.0.1:5000/drug?Age=60&amp;Sex=F&amp;BP=LOW&amp;Cholesterol=HIGH&amp;Na_to_K=20"</code></li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/1b0770967f6eb6bb50ad7f6a44fe87cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1qghTkCDGv29dgGmDWnzlw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a025" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您想了解更多关于开发<code class="fe ne nf ng mv b">flask</code>应用程序和web服务的信息，这些文章是一个很好的起点</p><ul class=""><li id="0c91" class="nh ni it lt b lu mn lx mo ma nj me nk mi nl mm nx nn no np bi translated"><a class="ae ky" href="https://programminghistorian.org/en/lessons/creating-apis-with-python-and-flask" rel="noopener ugc nofollow" target="_blank">https://programminghistorian . org/en/lessons/creating-API-with-python-and-flask</a></li><li id="2268" class="nh ni it lt b lu nq lx nr ma ns me nt mi nu mm nx nn no np bi translated"><a class="ae ky" href="https://code.visualstudio.com/docs/python/tutorial-flask" rel="noopener ugc nofollow" target="_blank">https://code.visualstudio.com/docs/python/tutorial-flask</a></li></ul><h1 id="cbd7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤4:将Web服务部署到Microsoft Azure</h1><p id="cf9e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们现在有一个预测机器学习算法，可以以99%的准确率预测药物处方，我们有一个助手功能，可以进行个体预测，我们有一个web服务包装器，可以从浏览器或命令行调用这些组件。</p><p id="5eb8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然而，所有这些仍然只能从开发环境中调用。下一步是将一切都部署到云中，这样客户就可以通过公共互联网“消费”web服务。</p><p id="0233" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">有许多不同的公共服务可用于web应用程序部署，包括-</p><ul class=""><li id="5999" class="nh ni it lt b lu mn lx mo ma nj me nk mi nl mm nx nn no np bi translated">Google—<a class="ae ky" href="https://cloud.google.com/appengine/docs/standard/python3/building-app/writing-web-service" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/app engine/docs/standard/python 3/building-app/writing-web-service</a></li><li id="0549" class="nh ni it lt b lu nq lx nr ma ns me nt mi nu mm nx nn no np bi translated">亚马逊网络服务—<a class="ae ky" href="https://medium.com/@rodkey/deploying-a-flask-application-on-aws-a72daba6bb80" rel="noopener">https://medium . com/@ rodkey/deploying-a-flask-application-on-AWS-a 72 Daba 6 bb 80</a></li><li id="67da" class="nh ni it lt b lu nq lx nr ma ns me nt mi nu mm nx nn no np bi translated">微软Azure—<a class="ae ky" href="https://medium.com/@nikovrdoljak/deploy-your-flask-app-on-azure-in-3-easy-steps-b2fe388a589e" rel="noopener">https://medium . com/@ nikovrdoljak/deploy-your-flask-app-on-Azure-in-3-easy-steps-B2 Fe 388 a 589 e</a></li></ul><p id="40e1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我选择Azure是因为它是免费的(对于一个入门级的帐户)，易于使用，快速并且完全与VS代码集成，这是我最喜欢的开发环境。</p><h2 id="666a" class="mz la it bd lb ny nz dn lf oa ob dp lj ma oc od ll me oe of ln mi og oh lp oi bi translated">步骤4.1:将Azure App服务扩展添加到VS代码中</h2><p id="f5f2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">将任务切换成VS代码，进入“扩展”(Ctrl+Shft_X)，加入“Azure App Service”扩展。添加扩展后，你会在活动栏中看到一个新的Azure图标-</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/af9440ee4761fe9a4aa5d5e64e35f0bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RU0r1VW3KSNLRa3aiHqBZg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="bd0b" class="mz la it bd lb ny nz dn lf oa ob dp lj ma oc od ll me oe of ln mi og oh lp oi bi translated">步骤4.1:创建Azure帐户</h2><p id="a240" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您必须有一个帐户才能开始部署到Azure cloud，并且您必须在注册过程中提供信用卡详细信息。但是，除非您明确选择退出免费许可，否则不会向您收费。</p><p id="4b77" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">你可以按照该页面上的说明进行操作—<a class="ae ky" href="https://azure.microsoft.com/en-gb/free/" rel="noopener ugc nofollow" target="_blank">https://azure.microsoft.com/en-gb/free/</a>通过浏览器创建你的免费Azure帐户，但最简单的方法是点击活动栏中的新Azure图标，然后选择“创建免费Azure帐户”(或者如果你已经有一个，则选择“登录Azure”)——</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/687196ddbac750d1484272f87e376d6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s9KGGKNDrlfTALCKUuZU4Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="1919" class="mz la it bd lb ny nz dn lf oa ob dp lj ma oc od ll me oe of ln mi og oh lp oi bi translated">步骤4.3:创建Azure Web应用程序</h2><p id="d4f6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">下一步是通过点击“应用服务”窗口中的“+”号创建一个Azure web应用来托管您的应用。系统将提示您输入应用程序的名称。该名称将用于最终的网址，它必须是唯一的，但除此之外，名称并不特别重要。</p><p id="4c0d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当提示输入许可证类型时，选择“免费试用”-您的web应用程序现在将创建完毕，您可以开始部署了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/e9e0837c1b4490ee43d056d5458c176a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WFES4XTxvn6TPSAlwRM7zw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="b0ff" class="mz la it bd lb ny nz dn lf oa ob dp lj ma oc od ll me oe of ln mi og oh lp oi bi translated">步骤4.4创建一个“requirements.txt”部署文件</h2><p id="90cc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在将应用部署到Azure之前，您必须在与Flask web应用相同的文件夹中创建一个“requirements.txt”文件，该文件包含Azure为了运行您的应用而必须安装的所有依赖项和库的列表。如果库不在部署的环境中，应用程序将崩溃，这一步是至关重要的。</p><p id="0bdd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们app的<code class="fe ne nf ng mv b">requirements.txt</code>内容如下-</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/7bed160b7dba6bae17b22a5b9cdfe95c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VWwCFTNdsiYI41TRBDN_mg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4fc9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">需要注意的几点是-</p><ol class=""><li id="2beb" class="nh ni it lt b lu mn lx mo ma nj me nk mi nl mm nm nn no np bi translated">如果使用pip安装，库名必须与您键入的完全匹配，例如<code class="fe ne nf ng mv b">pip install Flask</code>。</li><li id="a1aa" class="nh ni it lt b lu nq lx nr ma ns me nt mi nu mm nm nn no np bi translated">注意<code class="fe ne nf ng mv b">Flask</code>有一个大写字母“F”。这是因为Flask的大写方式不同寻常，通常库都是小写的。</li><li id="8202" class="nh ni it lt b lu nq lx nr ma ns me nt mi nu mm nm nn no np bi translated">需要<code class="fe ne nf ng mv b">sklearn</code>来执行再水合的<code class="fe ne nf ng mv b">model.pkl</code>。虽然代码中没有明确引用sklearn和<code class="fe ne nf ng mv b">DecisionTreeClassifier</code>，但是它们是<code class="fe ne nf ng mv b">model.fit</code>所需要的，所以如果省略了<code class="fe ne nf ng mv b">sklearn</code>，应用程序将会崩溃。</li><li id="e61a" class="nh ni it lt b lu nq lx nr ma ns me nt mi nu mm nm nn no np bi translated">不需要对<code class="fe ne nf ng mv b">pickle</code>的引用，因为这个库是核心Python安装的一部分。如果您包含了<code class="fe ne nf ng mv b">pickle</code>，部署将会崩溃，因为您不能执行<code class="fe ne nf ng mv b">pip install pickle</code>。</li></ol><p id="351a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您坚持这些规则，您的部署将会工作，并且任何错误消息通常都足够提供信息，使得通过一点互联网研究就可以解决问题。</p><h2 id="8116" class="mz la it bd lb ny nz dn lf oa ob dp lj ma oc od ll me oe of ln mi og oh lp oi bi translated">步骤4.5将你的应用部署到Azure</h2><p id="db80" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果到目前为止你已经遵循了这些步骤，那么现在你在VS代码中已经有了一个Flask应用程序。您的应用程序代码文件将被称为<code class="fe ne nf ng mv b">app.py</code>，应用程序名称为<code class="fe ne nf ng mv b">app</code>。Flask应用已经在本地开发web服务器上进行了测试。</p><p id="1425" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您已经安装了VS Code Azure应用程序扩展，并使用它创建了一个Microsoft Azure免费帐户和一个Azure web应用程序。</p><p id="7448" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您应该在VS代码中打开Flask应用程序，并且您已经准备好将应用程序部署到云中。</p><p id="692f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">只需点击蓝色圆圈图标旁边的web应用程序名称，然后点击“+”号旁边的云图标即可。</p><p id="fd23" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">出现提示时，选择以下选项-</p><ul class=""><li id="e70a" class="nh ni it lt b lu mn lx mo ma nj me nk mi nl mm nx nn no np bi translated">选择要部署的默认文件夹</li><li id="f659" class="nh ni it lt b lu nq lx nr ma ns me nt mi nu mm nx nn no np bi translated">选择“免费试用”订阅</li><li id="2abd" class="nh ni it lt b lu nq lx nr ma ns me nt mi nu mm nx nn no np bi translated">选择您创建的web应用程序名称</li><li id="72bf" class="nh ni it lt b lu nq lx nr ma ns me nt mi nu mm nx nn no np bi translated">如果提示覆盖，请选择“部署”</li><li id="e00a" class="nh ni it lt b lu nq lx nr ma ns me nt mi nu mm nx nn no np bi translated">当要求“总是部署…”时，选择“现在跳过”</li><li id="8b0d" class="nh ni it lt b lu nq lx nr ma ns me nt mi nu mm nx nn no np bi translated">当部署开始时，单击“输出窗口”</li></ul><p id="e5ef" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在坐下来煮一杯咖啡，同时应用程序展开-</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/977c865f6320c43c5b8ea5b42560cc19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NPKJACtn39s-tdJ0e5Q4lA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7222" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">部署完成后，点击“浏览网站”,您将被带到运行<code class="fe ne nf ng mv b">app.route("/")</code>功能的正确URL。</p><p id="8d25" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">只需添加我们用来测试本地部署的相同URL参数，您将看到完全部署的web应用程序的输出！-</p><p id="79af" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">【https://graham-harrison68-web03.azurewebsites.net/drug? T2】年龄=60 &amp;性别=F &amp;血压=低&amp;胆固醇=高&amp; Na_to_K=20 </p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/8c8db380276fe18eb12f21be0b3cb019.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FWFX8SSFBiLspeWYAyRisg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="2a72" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">需要注意的一点是:过了一会儿，azure应用程序进入睡眠状态，之后的第一次调用需要很长时间。</p><p id="1087" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你选择升级到付费的Azure订阅，有一个选项可以让应用程序保持刷新和“唤醒”，但在免费订阅中，睡眠相关的延迟是不可避免的，因为该订阅旨在进行测试，因此有一些限制。</p><h1 id="1b73" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤5:构建客户端应用程序来使用Azure部署的Web服务</h1><p id="9de9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">此时，任何可以调用web请求的编程语言或环境都只需几行代码就可以调用部署的web服务。</p><p id="bcfd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们确实从C#、JavaScript等非Python环境开始。都可以使用，但我将通过编写一些代码从Python客户端使用<code class="fe ne nf ng mv b">ipywidgets</code>调用部署的应用程序来结束这个示例</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/dc449012c267c4f577b2cd47cdcef489.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z9BCqnPI9dp6Uzml5eWWkQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="2825" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您使用默认值单击“处方”,建议应该是“药物”。</p><p id="c69b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">将年龄改为60岁，将Na改为K改为20岁，并应规定“吸毒”。把年龄放回47岁，把钠对钾放回14岁，把血压改为“高”，应该开drugA。</p><p id="f412" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这些简单的测试证明，使用基于决策树的预测机器学习算法的Azure托管的web服务完全部署到公共云，可以被任何能够执行<code class="fe ne nf ng mv b">http GET</code>命令的开发环境调用，并且完全端到端工作。</p><h1 id="e9d8" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="8f5f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这涉及到相当多的步骤，但使用现成的库和免费工具，包括scikit-learn、pickle、flask、Microsoft Azure和ipywidgets，我们已经构建了一个完全工作的、公开可用的机器学习算法的云部署和一个完全功能的客户端，以调用和使用web服务并显示结果。</p><h1 id="4190" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">进一步阅读</h1><p id="6f70" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果你觉得这个教程很有趣，我会推荐这篇文章，它深入讨论了模型部署策略的细节</p><div class="on oo gp gr op oq"><a href="https://neptune.ai/blog/model-deployment-strategies" rel="noopener  ugc nofollow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd iu gy z fp ov fr fs ow fu fw is bi translated">模型部署策略- neptune.ai</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">近年来，大数据和机器学习已经被大多数主要行业采用，大多数初创公司都在…</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">海王星. ai</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe ks oq"/></div></div></a></div><h1 id="9510" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">感谢您的阅读！</h1><p id="5406" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果你喜欢读这篇文章，为什么不看看我在https://grahamharrison-86487.medium.com/<a class="ae ky" href="https://grahamharrison-86487.medium.com/" rel="noopener">的其他文章呢？</a></p><p id="86c6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">此外，我很乐意听到您对这篇文章、我的任何其他文章或任何与数据科学和数据分析相关的内容的看法。</p><p id="f075" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你想联系我讨论这些话题，请在LinkedIn上找我—<a class="ae ky" href="https://www.linkedin.com/in/grahamharrison1" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/grahamharrison1</a>或者发电子邮件到<a class="ae ky" href="mailto:GHarrison@lincolncollege.ac.uk" rel="noopener ugc nofollow" target="_blank">ghar rison @ Lincoln college . AC . uk</a>。</p><p id="013b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你想通过订阅来支持作者和全世界成千上万为文章写作做出贡献的人，请使用这个链接——【https://grahamharrison-86487.medium.com/membership<a class="ae ky" href="https://grahamharrison-86487.medium.com/membership" rel="noopener"/>。注意:如果你使用这个链接注册，作者将收到一定比例的费用。</p></div></div>    
</body>
</html>