<html>
<head>
<title>Customize your Sklearn Pipelines with BaseEstimator, TransformerMixin and FeatureUnion</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用BaseEstimator、TransformerMixin和FeatureUnion定制您的Sklearn管道</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/customizing-sklearn-pipelines-transformermixin-a54341d8d624?source=collection_archive---------8-----------------------#2021-12-13">https://towardsdatascience.com/customizing-sklearn-pipelines-transformermixin-a54341d8d624?source=collection_archive---------8-----------------------#2021-12-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="98dd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><em class="ki">如何为Sklearn管道创建自定义转换器</em></h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/c15f72536768eaffd517c0a0e053039f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E3uB09VEGp742vkPkayCEA.jpeg"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated"><a class="ae kz" href="https://unsplash.com/@tetrakiss?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">阿瑟尼·托古列夫</a>在<a class="ae kz" href="https://unsplash.com/s/photos/transformer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="4916" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Scikit-Learn最常用和最受欢迎的特性之一是<em class="lw">管道</em>。虽然它们的使用是可选的，但是它们可以用来使我们的代码更干净，更容易维护。管道接受<em class="lw">估算器</em>作为输入，它们是从<a class="ae kz" href="https://scikit-learn.org/stable/modules/generated/sklearn.base.BaseEstimator.html" rel="noopener ugc nofollow" target="_blank">sk learn . base . base estimator</a>继承的类，并且包含<em class="lw"> fit </em>和<em class="lw"> transform </em>方法。<strong class="lc iu">这允许我们使用Sklearn默认不提供的功能定制管道。</strong></p><p id="021d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们将讨论<em class="lw"> transformers </em>，对输入进行转换的对象。我们将继承的类是TransformerMixin，但是也可以从ClassifierMixin、RegressionMixin、ClusterMixin和其他类扩展来创建一个定制的估计器。阅读<a class="ae kz" href="https://scikit-learn.org/stable/modules/generated/sklearn.base.BaseEstimator.html" rel="noopener ugc nofollow" target="_blank">此处</a>的所有可用选项。</p><p id="78f8" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们将使用文本数据的数据集，我们希望对其应用转换，例如:</p><ul class=""><li id="a807" class="lx ly it lc b ld le lg lh lj lz ln ma lr mb lv mc md me mf bi translated">文本预处理</li><li id="c75e" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated">TF-IDF矢量化</li><li id="4164" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated">创建附加功能，如情感、字符数和句子数</li></ul><p id="723f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这将通过使用Pipeline和<a class="ae kz" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.FeatureUnion.html" rel="noopener ugc nofollow" target="_blank"> FeatureUnion </a>来完成，后者是一个Sklearn类，它组合了来自不同来源的特性集。</p><h1 id="7931" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">数据集</h1><p id="46e1" class="pw-post-body-paragraph la lb it lc b ld nd ju lf lg ne jx li lj nf ll lm ln ng lp lq lr nh lt lu lv im bi translated">我们将使用Sklearn提供的数据集<em class="lw"> 20newsgroups </em>，快速访问大量文本数据。出于演示的目的，我将只使用10个文本的样本，但该示例可以扩展到任何数量的文本。</p><p id="7592" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们导入数据集</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ni nj l"/></div></figure><h1 id="a249" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">文本特征的创建</h1><p id="cc8d" class="pw-post-body-paragraph la lb it lc b ld nd ju lf lg ne jx li lj nf ll lm ln ng lp lq lr nh lt lu lv im bi translated">我们将构建包含这些信息的特性集</p><ul class=""><li id="b94d" class="lx ly it lc b ld le lg lh lj lz ln ma lr mb lv mc md me mf bi translated">应用预处理后使用TF-IDF进行矢量化</li><li id="ac32" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated">与NLTK的感悟。维德</li><li id="2fa8" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated">文本中的字符数</li><li id="50a9" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated">课文中的句子数量</li></ul><p id="434d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们的流程不使用管道，而是用单独的代码块顺序应用所有这些步骤。管道的美妙之处在于，排序是在单个代码块中维护的——管道本身变成了一个估计器，能够在一条语句中执行所有操作。</p><p id="7d42" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们创建我们的函数</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="df53" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们的目标是创建一个独特的特征集，以便为某项任务训练一个模型。我们将使用管道和FeatureUnion把我们的矩阵放在一起。</p><h1 id="70b1" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">如何合并不同来源的要素</h1><p id="1ebe" class="pw-post-body-paragraph la lb it lc b ld nd ju lf lg ne jx li lj nf ll lm ln ng lp lq lr nh lt lu lv im bi translated">TF-IDF矢量化将创建一个稀疏矩阵，该矩阵将具有维度<em class="lw">n _ documents _ in _ corpus</em>*<em class="lw">n _ features</em>，情感将是单个数字，以及n_chars和n_sentences的输出。<strong class="lc iu">我们将获取每个步骤的输出，并创建一个包含所有输出的矩阵，这样我们就可以根据我们设计的所有功能训练一个模型</strong>。我们将从这样的模式开始</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nk"><img src="../Images/5c2fdbf9015c619c93d9ea2cd059b3ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ll43-RMRsQke6k8fepWuVA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">事物的初始状态。图片作者。</p></figure><p id="08f6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">并达到这个最终的表现</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nl"><img src="../Images/e7c76336355370a53fb5d7a3517a65c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nYICMM3oQQNGnpYCr_N8Vg.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">FeatureUnion的工作原理。图片作者。</p></figure><p id="669c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">该特征集将被用作我们模型的训练向量。</p><h2 id="a231" class="nm mm it bd mn nn no dn mr np nq dp mv lj nr ns mx ln nt nu mz lr nv nw nb nx bi translated">从BaseEstimator和TransformerMixin继承的类</h2><p id="fc89" class="pw-post-body-paragraph la lb it lc b ld nd ju lf lg ne jx li lj nf ll lm ln ng lp lq lr nh lt lu lv im bi translated">为了让我们的过程继续下去，我们需要定义类以及它们将在管道中做什么。让我们从创建一个DummyEstimator开始，我们将从它继承init、fit和transform。DummyEstimator是一个方便的类，它让我们不必编写多余的代码。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="4115" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">DummyEstimator将从四个类继承:SparseToArray的<em class="lw">预处理器</em>、<em class="lw">感知分析</em>、<em class="lw"> NChars </em>、<em class="lw">内容</em>和<em class="lw">。</em></p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="934d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如您所见，DummyEstimator只允许我们定义转换函数，因为其他所有类都从DummyEstimator继承了其<em class="lw"> init </em>和<em class="lw"> fit </em>。</p><p id="d9ca" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在让我们看看如何实现矢量化管道，<strong class="lc iu">，它将考虑到我们的文本预处理。</strong></p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="0e72" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">剩下要做的就是应用FeatureUnion将这些片段组合在一起</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ni nj l"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/049213f735332c2925594be4991a29ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*yEk9i59v9r_CJ_MAAyfSAA.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">特征联合的步骤和估计量。图片作者。</p></figure><p id="55b8" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们在语料库上检查一下<em class="lw"> fit_transform </em>的输出</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/a8082f089e49eeac38a937d8a7eedcb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*XB8cXv-qvKjjVdX_Ax5mEg.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">FeatureUnion的输出-四个数据源合并在一个矩阵中。图片作者。</p></figure><p id="9e1a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">输出似乎是正确的！虽然不是很清楚。我们通过将组合的特征集插入数据帧来结束本教程</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="0b5c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">结果如下(出于可读性的原因，我在这里截断了结果)</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/cae14964bc98b9680216fc2d150ffdcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*u6bkwLXpLnxGIHgtcjmvNA.png"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">熊猫数据框架中的联合特征集。图片作者。</p></figure><p id="0fab" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><strong class="lc iu">我们现在有了一个数据集，可以随时提供给任何训练模型</strong>。用<a class="ae kz" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html" rel="noopener ugc nofollow" target="_blank"><em class="lw">sk learn . preprocessing . standard scaler</em></a><em class="lw"/>或类似的东西进行实验，并使n _ chars和n_sentences正常化，这将是有用的。我将把这个练习留给读者。</p><h1 id="7e98" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">结论</h1><p id="6a91" class="pw-post-body-paragraph la lb it lc b ld nd ju lf lg ne jx li lj nf ll lm ln ng lp lq lr nh lt lu lv im bi translated">我们已经看到了Sklearn中的<strong class="lc iu"> BaseEstimator </strong>、<strong class="lc iu"> TransformerMixin </strong>和<strong class="lc iu"> FeatureUnion </strong>类的基本操作可以为我们的定制项目做些什么。</p><p id="b84b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">它使我们能够创建定制的预处理类，并在管道中连接特性集。</p><p id="f875" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><strong class="lc iu">这种方法提高了生产率和干净的代码</strong>并且可以帮助整个团队构建脚本和笔记本。</p><p id="b343" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我希望你今天学到了新的东西，并且在你的代码库中应用了这些原则！😀</p></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><h1 id="ca87" class="ml mm it bd mn mo oi mq mr ms oj mu mv jz ok ka mx kc ol kd mz kf om kg nb nc bi translated">推荐阅读</h1><p id="f760" class="pw-post-body-paragraph la lb it lc b ld nd ju lf lg ne jx li lj nf ll lm ln ng lp lq lr nh lt lu lv im bi translated">对于感兴趣的人来说，这里有一个我为每个与ML相关的主题推荐的书籍列表。在我看来，有一些必不可少的书籍对我的职业生涯产生了巨大影响。<br/> <em class="lw">免责声明:这些是亚马逊会员链接。我会收到亚马逊为你推荐这些项目的一小笔佣金。你的体验不会改变，你也不会被收取更多费用，但它将帮助我扩大业务规模，围绕人工智能制作更多内容。</em></p><ul class=""><li id="0870" class="lx ly it lc b ld le lg lh lj lz ln ma lr mb lv mc md me mf bi translated"><strong class="lc iu">ML简介</strong> : <a class="ae kz" href="https://amzn.to/3WZ51cE" rel="noopener ugc nofollow" target="_blank"> <em class="lw">自信的数据技能:掌握处理数据的基本原理，为你的职业生涯增压</em> </a> <em class="lw"> </em>作者:基里尔·叶列缅科</li><li id="4d00" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated"><strong class="lc iu">sk Learn/tensor flow</strong>:<a class="ae kz" href="https://amzn.to/3jseVGb" rel="noopener ugc nofollow" target="_blank"><em class="lw">使用Scikit-Learn、Keras和TensorFlow </em> </a>进行动手机器学习</li><li id="0bd3" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated"><strong class="lc iu"> NLP </strong> : <a class="ae kz" href="https://amzn.to/3l9FO22" rel="noopener ugc nofollow" target="_blank"> <em class="lw">文本即数据:机器学习和社会科学的新框架</em> </a> <em class="lw"> </em>作者贾斯汀·格里默</li><li id="cab2" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated"><strong class="lc iu">sk Learn/PyTorch</strong>:<a class="ae kz" href="https://amzn.to/3wYZf0e" rel="noopener ugc nofollow" target="_blank"><em class="lw">用py torch和Scikit进行机器学习——Learn:用Python开发机器学习和深度学习模型</em> </a>塞巴斯蒂安·拉什卡著</li><li id="b72f" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated"><strong class="lc iu">数据即</strong> : <a class="ae kz" href="https://amzn.to/3HUtGtB" rel="noopener ugc nofollow" target="_blank"> <em class="lw">用数据讲故事:商务人士数据可视化指南</em> </a>科尔·克纳弗利克著</li></ul><h1 id="15d3" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">有用的链接(我写的)</h1><ul class=""><li id="bff8" class="lx ly it lc b ld nd lg ne lj on ln oo lr op lv mc md me mf bi translated"><strong class="lc iu">学习如何用Python执行顶层探索性数据分析</strong> : <a class="ae kz" rel="noopener" target="_blank" href="/exploratory-data-analysis-in-python-a-step-by-step-process-d0dfa6bf94ee"> <em class="lw">用Python执行探索性数据分析——一步一步的过程</em> </a></li><li id="e8d9" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated"><strong class="lc iu">学习TensorFlow的基础知识</strong>:<a class="ae kz" href="https://medium.com/towards-data-science/a-comprehensive-introduction-to-tensorflows-sequential-api-and-model-for-deep-learning-c5e31aee49fa" rel="noopener"><em class="lw">tensor flow 2.0入门—深度学习入门</em> </a></li><li id="8c20" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated"><strong class="lc iu">用Python中的TF-IDF进行文本聚类</strong> : <a class="ae kz" href="https://medium.com/mlearning-ai/text-clustering-with-tf-idf-in-python-c94cd26a31e7" rel="noopener"> <em class="lw">用Python中的TF-IDF进行文本聚类</em> </a></li></ul><p id="a419" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><strong class="lc iu">如果你想支持我的内容创作活动，欢迎点击我下面的推荐链接，加入Medium的会员计划</strong>。我将收到你投资的一部分，你将能够以无缝的方式访问Medium的大量数据科学文章。</p><div class="oq or gp gr os ot"><a href="https://medium.com/@theDrewDag/membership" rel="noopener follow" target="_blank"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd iu gy z fp oy fr fs oz fu fw is bi translated">通过我的推荐链接加入Medium-Andrew D # data science</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">阅读Andrew D #datascience(以及媒体上成千上万的其他作者)的每一个故事。您的会员费直接…</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">medium.com</p></div></div><div class="pc l"><div class="pd l pe pf pg pc ph kt ot"/></div></div></a></div><h1 id="3e00" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">密码</h1><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ni nj l"/></div></figure></div></div>    
</body>
</html>