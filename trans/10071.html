<html>
<head>
<title>Accessing public datasets through Datacommons, Google’s API for stats</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过谷歌的统计Datacommons访问公共数据集</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/exploring-datacommons-the-api-powering-google-search-afc366ec242b?source=collection_archive---------37-----------------------#2021-09-22">https://towardsdatascience.com/exploring-datacommons-the-api-powering-google-search-afc366ec242b?source=collection_archive---------37-----------------------#2021-09-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="eff1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一种查询公共数据集的新范式</h2></div><p id="8f6e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有没有想过谷歌是如何对诸如“旧金山的平均收入是多少？”这样的问题给出如此准确的回答的？</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/1190a785b5e5c96612ec50969d654751.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cZf9q5j_RCy35PrRp0JzIw.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">作者图片</p></figure><p id="f57c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">谷歌搜索上的统计查询由<a class="ae lr" href="https://datacommons.org/" rel="noopener ugc nofollow" target="_blank"> DataCommons </a>提供支持，这是一个公开可用数据集的开源存储库。</p><p id="fa1b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">DataCommons提供了一个中央API来处理来自世界银行、美国劳工统计局、疾病控制中心等不同的公共数据集。这种工具意味着您不必花费大部分时间来查找、清理和连接这些数据(我们不喜欢谈论的70%的数据分析工作)。这是一个开发人员友好的开放标准，意味着任何人都可以从他们喜欢的工具中访问它，并且在以下领域非常有用:</p><ul class=""><li id="1153" class="ls lt iq kh b ki kj kl km ko lu ks lv kw lw la lx ly lz ma bi translated">科学研究</li><li id="1f88" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">新闻工作</li><li id="ceb1" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">卡格尔比赛</li><li id="4d18" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">市场调查</li><li id="b68f" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">学问</li></ul><p id="12fc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们看看当它与我们最喜欢的Python可视化库结合时能做什么！</p><h1 id="ccc9" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">热身的例子</h1><p id="2f4a" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">想象一下，我们是一名记者，正在撰写一篇专题文章，比较美国不同州变老的情况。首先，我们想知道年龄与收入、健康、空气污染、人口密度等其他变量之间的关系。我们可以通过查看美国500个最大城市的数据立即开始:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="8967" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于DataCommons，要记住的最重要的事情是<strong class="kh ir">所有东西都是图</strong>中的一个节点。在这种情况下，我们从查询特殊的组节点<code class="fe nf ng nh ni b">CDC500_City</code>开始，并询问它的<code class="fe nf ng nh ni b">members</code>，即链接到它的其他节点。这为我们提供了CDC500数据集中城市的data commons id(<code class="fe nf ng nh ni b">dcid</code>s)。Google已经做了一些非常复杂的实体解析，所以这些位置在不同的数据源中是标准化的。接下来，我们将这些id加上一个统计变量列表<a class="ae lr" href="https://datacommons.org/tools/stat-var" rel="noopener ugc nofollow" target="_blank">传递到一个<code class="fe nf ng nh ni b">dc.build_multivariate_dataframe</code>查询中，并获得一个熊猫数据框架，其中包含来自CDC、劳工统计局和人口普查局的数据，所有这些数据都被神奇地清理并按城市分组。</a></p><p id="61f1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我无法强调这有多酷！想象一下，如果你要从头开始做这件事，要花多长时间:用不兼容格式的数据在不同的网站上爬行，清理和标准化数据，为实体建立一个通用名称列表，并将其全部合并在一起。</p><p id="caa6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行该代码，加上下面的可视化结果，我们得到了以下结果:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="a830" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一个很好的开始，看起来中值年龄和收入之间存在微弱的正相关，但是我们不知道这些城市的实际名称。为此，我们需要丰富数据。</p><h1 id="d338" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">丰富数据</h1><p id="d882" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">我们希望获得数据集中每个位置的城市和州名。通常，这需要几个小时，因为我们必须找到另一个数据源，标准化名称，进行合并，然后花很长时间调试略有不同的输出。在DataCommons中，我们需要做的就是使用他们的<a class="ae lr" href="https://docs.datacommons.org/api/" rel="noopener ugc nofollow" target="_blank"> API </a>从图中获取更多的属性:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="f69e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用<code class="fe nf ng nh ni b">dc.get_property_values</code>很容易获得关于每个节点及其关系的附加信息。我们传递参数<code class="fe nf ng nh ni b">containedInPlace</code>来查找父节点，传递参数<code class="fe nf ng nh ni b">name</code>来查找正确的名称。</p><p id="ee31" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">数据如下所示:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="12ef" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太好了，一些更清晰的趋势出现了！我们可以看到大多数最富有的城市在加利福尼亚，大多数最古老的城市在佛罗里达。根据人口统计数据也更容易看出纽约和洛杉矶等大城市的发展趋势。</p><h1 id="01f8" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">在地图上显示</h1><p id="7879" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">最后，假设我们希望帮助读者在地图上可视化这些数据。DataCommons有一个方便的内置<a class="ae lr" href="https://datacommons.org/tools/map" rel="noopener ugc nofollow" target="_blank">地图浏览器</a>工具，我们可以在其中选择统计变量和地理级别。如果我们想要可视化一些更复杂的东西，例如，65岁以上的家庭年收入达到或超过20万美元的比例是多少，我们可以轻松地重新提取数据，并将其插入geoviz工具，如Folium:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="0943" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这段代码中，我们按州重新提取数据，下载一个GeoJson对象，然后使用<code class="fe nf ng nh ni b">key_on=feature.properties.name</code>连接州名。添加一点语法糖来显示悬停标签，我们就完成了。有了干净的数据，你就会平静！</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="a73d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我过了一会儿才意识到，最富裕的退休者实际上是在夏威夷，65岁以上的家庭中有近10%年收入在20万美元或以上😱。</p><h2 id="94ac" class="nj mh iq bd mi nk nl dn mm nm nn dp mq ko no np ms ks nq nr mu kw ns nt mw nu bi translated">摘要</h2><p id="ce95" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">在大约100行代码中，我从几个不同的来源提取了数据，进行了分析，并在不同的绘图库中构建了几个可视化程序。有了DataCommons，你的大部分精力可以用于实际分析和可视化数据，而不是清理、清理和管理数据。</p><p id="3332" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从这里开始，您可以探索收集在DataCommons中的数千个统计变量<a class="ae lr" href="https://datacommons.org/tools/stat-var" rel="noopener ugc nofollow" target="_blank">中的一些，或者尝试他们的</a><a class="ae lr" href="https://datacommons.org/browser/" rel="noopener ugc nofollow" target="_blank">图形浏览器</a>。你能回答的问题没有限制！</p><p id="3651" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">参见<a class="ae lr" href="https://github.com/johnmicahreid/datascienceexamples/blob/main/DataCommons_Tutorial.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>上本教程的代码，以及下面的最终数据集:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nd ne l"/></div></figure></div></div>    
</body>
</html>