<html>
<head>
<title>Instruments in the air using Python and Mediapipe</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python和Mediapipe的空中仪器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/instruments-in-the-air-using-python-and-mediapipe-e2576819ef8a?source=collection_archive---------19-----------------------#2021-09-05">https://towardsdatascience.com/instruments-in-the-air-using-python-and-mediapipe-e2576819ef8a?source=collection_archive---------19-----------------------#2021-09-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1d4b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过在空中运行手指来弹奏任何乐器，<em class="kf">在这里，我在手部跟踪模块和mediapipe的帮助下选择了钢琴键</em></h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/16bd0518debd209f994a680e2339044c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ci9_1AtoRCAzXmS2ab2geg.jpeg"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated"><a class="ae kw" href="https://unsplash.com/@shotsbywolf?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">吉尔特·皮特斯</a>在<a class="ae kw" href="https://unsplash.com/s/photos/piano?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="0208" class="kx ky iq bd kz la lb lc ld le lf lg lh jw li jx lj jz lk ka ll kc lm kd ln lo bi translated"><strong class="ak">我的灵感</strong></h1><p id="b0c8" class="pw-post-body-paragraph lp lq iq lr b ls lt jr lu lv lw ju lx ly lz ma mb mc md me mf mg mh mi mj mk ij bi translated">几天前，我看见我哥哥哼着曲子，用手指敲着桌子。当我问他时，他回答说他在想象中演奏肖邦的作品，尽管我确信他甚至不知道如何拼写肖邦。但就在那时，我突然想到了制作虚拟钢琴的想法。当我在做这个项目时，我开始意识到不仅仅是钢琴，我们可以在稀薄的空气中用手指触摸任何乐器。</p><h1 id="220c" class="kx ky iq bd kz la lb lc ld le lf lg lh jw li jx lj jz lk ka ll kc lm kd ln lo bi translated">履行</h1><p id="f6ff" class="pw-post-body-paragraph lp lq iq lr b ls lt jr lu lv lw ju lx ly lz ma mb mc md me mf mg mh mi mj mk ij bi translated">该项目利用了一种称为手标志检测的先进技术，可以在检测到的手区域内对21个3D手指关节坐标进行精确的关键点定位。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi mm"><img src="../Images/88ce5ca24de98aa20a1236c6c08036ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_PE1GwYnDuOXykEc.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">中间管道</p></figure><p id="5a8e" class="pw-post-body-paragraph lp lq iq lr b ls mn jr lu lv mo ju lx ly mp ma mb mc mq me mf mg mr mi mj mk ij bi translated">如果有兴趣建立一个类似的项目跟随我在下面我是如何实现的。</p><h2 id="cde6" class="ms ky iq bd kz mt mu dn ld mv mw dp lh ly mx my lj mc mz na ll mg nb nc ln nd bi translated"><strong class="ak"> #1导入所需包</strong></h2><pre class="kh ki kj kk gt ne nf ng nh aw ni bi"><span id="8eed" class="ms ky iq nf b gy nj nk l nl nm">import numpy as np<br/>import time<br/>import cv2<br/>from cvzone.HandTrackingModule <br/>import HandDetector<br/>import pyglet</span></pre><p id="83d7" class="pw-post-body-paragraph lp lq iq lr b ls mn jr lu lv mo ju lx ly mp ma mb mc mq me mf mg mr mi mj mk ij bi translated">导入指定的软件包，如果软件包没有安装在计算机上，可以使用pip命令从终端安装。</p><h2 id="9f87" class="ms ky iq bd kz mt mu dn ld mv mw dp lh ly mx my lj mc mz na ll mg nb nc ln nd bi translated">#2从网络摄像头捕捉视频</h2><pre class="kh ki kj kk gt ne nf ng nh aw ni bi"><span id="1c0c" class="ms ky iq nf b gy nj nk l nl nm">cap =cv2.VideoCapture(0)<br/>cap.set(3,1280)<br/>cap.set(4,720)</span></pre><p id="5a56" class="pw-post-body-paragraph lp lq iq lr b ls mn jr lu lv mo ju lx ly mp ma mb mc mq me mf mg mr mi mj mk ij bi translated">使用带有true条件的while循环，我们可以继续从网络摄像头读取帧，直到我们终止程序。</p><h2 id="a493" class="ms ky iq bd kz mt mu dn ld mv mw dp lh ly mx my lj mc mz na ll mg nb nc ln nd bi translated">#3定义按钮类</h2><p id="9b08" class="pw-post-body-paragraph lp lq iq lr b ls lt jr lu lv lw ju lx ly lz ma mb mc md me mf mg mh mi mj mk ij bi translated">在这里，我选择了钢琴键，因此，我会给我的按钮描述一个钢琴键，你可以给你自己的乐器你选择的描述。</p><pre class="kh ki kj kk gt ne nf ng nh aw ni bi"><span id="ca29" class="ms ky iq nf b gy nj nk l nl nm">class Button():    <br/>    def __init__(self,pos,text,size,color): <br/>       self.pos=pos        <br/>       self.size=size       <br/>       self.text=text        <br/>       self.color=color</span></pre><h2 id="4950" class="ms ky iq bd kz mt mu dn ld mv mw dp lh ly mx my lj mc mz na ll mg nb nc ln nd bi translated">#4在屏幕上绘制按钮</h2><pre class="kh ki kj kk gt ne nf ng nh aw ni bi"><span id="278b" class="ms ky iq nf b gy nj nk l nl nm">keys=[["C","D",'E',"F","G","A","B","C","D","E","F","G","A","B"],["C#","D#","F#","G#","A#","C#","D#","F#","G#","A#"]]</span></pre><p id="49ed" class="pw-post-body-paragraph lp lq iq lr b ls mn jr lu lv mo ju lx ly mp ma mb mc mq me mf mg mr mi mj mk ij bi translated">我们的键的标签被定义并存储在一个列表中，现在我们将把键追加到一个列表中，该列表将存储带有指定参数的按钮对象。</p><pre class="kh ki kj kk gt ne nf ng nh aw ni bi"><span id="752f" class="ms ky iq nf b gy nj nk l nl nm">buttonList=[]<br/>for i in range(len(keys)):<br/>    for j,key in enumerate(keys[i]):<br/>           if i==0:<br/>               buttonList.append(Button([38*j+15,80],key,[35,100],  (255,255,255)))<br/>           else:<br/>               buttonList.append(Button([(40+j)*j+25,80],key,[35,50] ,(0,0,0)))</span></pre><p id="667a" class="pw-post-body-paragraph lp lq iq lr b ls mn jr lu lv mo ju lx ly mp ma mb mc mq me mf mg mr mi mj mk ij bi translated">第一个参数指定我们的键的位置，第二个参数指定我们想要在键上显示的文本，最后两个参数分别指定键的大小和颜色。</p><p id="fba7" class="pw-post-body-paragraph lp lq iq lr b ls mn jr lu lv mo ju lx ly mp ma mb mc mq me mf mg mr mi mj mk ij bi translated">我们在按钮列表中有各自的键，现在是时候在屏幕上绘制这些对象了。为此，我们将定义一个函数并传递两个参数，</p><ol class=""><li id="6415" class="nn no iq lr b ls mn lv mo ly np mc nq mg nr mk ns nt nu nv bi translated">图像<em class="ml">(我们想要绘制对象的位置)</em></li><li id="b072" class="nn no iq lr b ls nw lv nx ly ny mc nz mg oa mk ns nt nu nv bi translated">按钮列表<em class="ml">(我们添加按钮类对象的列表)</em></li></ol><pre class="kh ki kj kk gt ne nf ng nh aw ni bi"><span id="25c3" class="ms ky iq nf b gy nj nk l nl nm">def drawAll(img,buttonList):<br/>    for button in buttonList:<br/>        x,y=button.pos<br/>        w,h=button.size<br/>        colorr=button.color<br/>        cv2.rectangle(img,button.pos,(x+w,y+h),colorr,cv2.FILLED)  <br/>        cv2.putText(img,button.text,(x+10,y+h-10), cv2.FONT_HERSHEY_COMPLEX,0.5,(214,0,220),2)      <br/>    return img</span></pre><h2 id="661f" class="ms ky iq bd kz mt mu dn ld mv mw dp lh ly mx my lj mc mz na ll mg nb nc ln nd bi translated">#5播放声音</h2><p id="884a" class="pw-post-body-paragraph lp lq iq lr b ls lt jr lu lv lw ju lx ly lz ma mb mc md me mf mg mh mi mj mk ij bi translated">现在我们已经画出了我们的按键，我们希望当我们把手指放在按键上时，按键能够发出声音。我们将同样定义我们的函数。</p><pre class="kh ki kj kk gt ne nf ng nh aw ni bi"><span id="d158" class="ms ky iq nf b gy nj nk l nl nm">def playkeys(button):<br/>    if button.text=="A":<br/>                       effectA = pyglet.resource.media("A.wav",streaming=False)<br/>                       effectA.play()            </span><span id="3c6a" class="ms ky iq nf b gy ob nk l nl nm">    elif button.text=="B":<br/>                    effectB=<br/>pyglet.resource.media("B.wav",streaming=False)<br/>                    effectB.play()<br/>    elif button.text=="C":                    effectC=pyglet.resource.media("C.wav",streaming=False)        effectC.play()<br/>    elif button.text=="D":                    effectD=pyglet.resource.media("D.wav",streaming=False)        effectD.play()<br/>    elif button.text=="E":                    effectE=pyglet.resource.media("E.wav",streaming=False)        effectE.play()<br/>    elif button.text=="F":                    effectF=pyglet.resource.media("F.wav",streaming=False)        effectF.play()<br/>    elif button.text=="G":                    effectG=pyglet.resource.media("G.wav",streaming=False)        effectG.play()</span></pre><p id="5dfa" class="pw-post-body-paragraph lp lq iq lr b ls mn jr lu lv mo ju lx ly mp ma mb mc mq me mf mg mr mi mj mk ij bi translated"><strong class="lr ir"> <em class="ml">请注意缩进并相应地格式化代码</em> </strong></p><p id="9cab" class="pw-post-body-paragraph lp lq iq lr b ls mn jr lu lv mo ju lx ly mp ma mb mc mq me mf mg mr mi mj mk ij bi translated">我们希望选择的键发出的声音与之前选择的键发出的声音融合在一起，而不中断它，因此我们使用pyglet库，这是python的一个多媒体库。</p><h2 id="148e" class="ms ky iq bd kz mt mu dn ld mv mw dp lh ly mx my lj mc mz na ll mg nb nc ln nd bi translated">#6检测手指并播放相应的声音</h2><p id="07ae" class="pw-post-body-paragraph lp lq iq lr b ls lt jr lu lv lw ju lx ly lz ma mb mc md me mf mg mh mi mj mk ij bi translated">现在我们已经有了所有的功能，是时候在我们从网络摄像头捕捉的画面上使用它们了。但是在我们的最后一步之前，我们需要我们的手被检测到，以便mediapipe库可以处理它，我们可以用一行简单的代码做到这一点</p><pre class="kh ki kj kk gt ne nf ng nh aw ni bi"><span id="bd9b" class="ms ky iq nf b gy nj nk l nl nm">detector =HandDetector(detectionCon=0.8)</span></pre><p id="2ccb" class="pw-post-body-paragraph lp lq iq lr b ls mn jr lu lv mo ju lx ly mp ma mb mc mq me mf mg mr mi mj mk ij bi translated">现在我们有了检测到的手，让我们在网络摄像头捕捉到的连续帧中使用我们的所有功能。</p><pre class="kh ki kj kk gt ne nf ng nh aw ni bi"><span id="55a3" class="ms ky iq nf b gy nj nk l nl nm">while True:<br/>    success,img=cap.read()<br/>    img= detector.findHands(img)<br/>    lmlist,bboxInfo=detector.findPosition(img)<br/>    img=drawAll(img,buttonList)<br/>    if lmlist:        #hand is there<br/>        for button in buttonList:<br/>            x,y=button.pos<br/>            w,h=button.size<br/>            for f in [4,8,12,16,20]:<br/>                  if x&lt;lmlist[f][0]&lt;x+w and y&lt;lmlist[f][1]&lt;y+h:<br/>                     l,_,_=detector.findDistance(f,f-3, img, draw =False)<br/>                     if l&lt;120:<br/>                         #cv2.rectangle(img,button.pos,(x+w,y+h),(80,9,78),cv2.FILLED)<br/>                         playkeys(button)</span></pre><p id="f9ad" class="pw-post-body-paragraph lp lq iq lr b ls mn jr lu lv mo ju lx ly mp ma mb mc mq me mf mg mr mi mj mk ij bi translated">这里，列表<em class="ml"> [4，8，12，16，20] </em>是检测到的手的指尖的索引列表。“如果”条件是检查指尖是否在按钮的范围内，即通过比较按钮的位置和指尖的位置</p><p id="be65" class="pw-post-body-paragraph lp lq iq lr b ls mn jr lu lv mo ju lx ly mp ma mb mc mq me mf mg mr mi mj mk ij bi translated">如果您只想通过将手指放在按键上而不是点击按键来播放声音，那么需要省略下面几行代码</p><p id="f673" class="pw-post-body-paragraph lp lq iq lr b ls mn jr lu lv mo ju lx ly mp ma mb mc mq me mf mg mr mi mj mk ij bi translated"><strong class="lr ir"><em class="ml">“l，_，_=detector.findDistance(f，f-3，img，draw = False)”<br/>“如果l&lt;120:“</em></strong></p><p id="68ef" class="pw-post-body-paragraph lp lq iq lr b ls mn jr lu lv mo ju lx ly mp ma mb mc mq me mf mg mr mi mj mk ij bi translated">如果您想在键被选中时更改它们的颜色，请取消对下面指定代码行的注释</p><p id="4ef2" class="pw-post-body-paragraph lp lq iq lr b ls mn jr lu lv mo ju lx ly mp ma mb mc mq me mf mg mr mi mj mk ij bi translated">" #cv2.rectangle(img，button.pos，(x+w，y+h)，(80，9，78)，cv2。已填充)”</p><p id="c626" class="pw-post-body-paragraph lp lq iq lr b ls mn jr lu lv mo ju lx ly mp ma mb mc mq me mf mg mr mi mj mk ij bi translated"><strong class="lr ir"> #7最后一步</strong></p><p id="2e72" class="pw-post-body-paragraph lp lq iq lr b ls mn jr lu lv mo ju lx ly mp ma mb mc mq me mf mg mr mi mj mk ij bi translated">我们有了各自声音的按键，剩下的就是用两行简单的代码显示我们的图像</p><pre class="kh ki kj kk gt ne nf ng nh aw ni bi"><span id="5809" class="ms ky iq nf b gy nj nk l nl nm">cv2.imshow("IMAGE",img)<br/>cv2.waitKey(1)</span></pre><h1 id="13ad" class="kx ky iq bd kz la lb lc ld le lf lg lh jw li jx lj jz lk ka ll kc lm kd ln lo bi translated">结论</h1><p id="f49e" class="pw-post-body-paragraph lp lq iq lr b ls lt jr lu lv lw ju lx ly lz ma mb mc md me mf mg mh mi mj mk ij bi translated">这是对该项目的详细描述。要演奏任何其他乐器，请相应地更改函数的参数，并下载它们各自的声音。访问<a class="ae kw" href="https://github.com/priiyaanjaalii0611/Piano" rel="noopener ugc nofollow" target="_blank"><strong class="lr ir"><em class="ml">GitHub repo</em></strong></a><strong class="lr ir"><em class="ml"/></strong>链接可以更好的理解。</p><p id="36e0" class="pw-post-body-paragraph lp lq iq lr b ls mn jr lu lv mo ju lx ly mp ma mb mc mq me mf mg mr mi mj mk ij bi translated">结果会有点像<a class="ae kw" href="https://www.linkedin.com/posts/fruitykernel_opencv-python-activity-6837803814481920000-nnai" rel="noopener ugc nofollow" target="_blank"> <strong class="lr ir"> <em class="ml">这个</em> </strong> </a></p><p id="80d2" class="pw-post-body-paragraph lp lq iq lr b ls mn jr lu lv mo ju lx ly mp ma mb mc mq me mf mg mr mi mj mk ij bi translated">感谢您的阅读。如果你喜欢这篇文章，请在脸书或推特上分享。如果你有任何问题，请在评论中告诉我。</p></div></div>    
</body>
</html>