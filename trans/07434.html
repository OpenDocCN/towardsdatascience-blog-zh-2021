<html>
<head>
<title>How to Sample a Dataframe in Python Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python Pandas中对数据帧进行采样</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-sample-a-dataframe-in-python-pandas-d18a3187139b?source=collection_archive---------1-----------------------#2021-07-07">https://towardsdatascience.com/how-to-sample-a-dataframe-in-python-pandas-d18a3187139b?source=collection_archive---------1-----------------------#2021-07-07</a></blockquote><div><div class="fc ik il im in io"/><div class="ip iq ir is it"><h2 id="8857" class="iu iv iw bd b dl ix iy iz ja jb jc dk jd translated" aria-label="kicker paragraph">数据预处理</h2><div class=""/><div class=""><h2 id="81f5" class="pw-subtitle-paragraph kc jf iw bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">使用不同的技术对Python Pandas中的数据集进行采样的现成代码</h2></div><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj ku"><img src="../Images/46b78f4218f0a1615d9a9f0aef133957.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PqjAs3YE2UbjQ0E7rA0IOg.jpeg"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">图片来自<a class="ae lk" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1026499" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure><p id="3011" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">您可能只需要Python数据帧中的一些行。你可以通过<strong class="ln jg">不同的采样技术</strong>达到这个结果。</p><p id="6938" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">在本教程中，我演示了通过<strong class="ln jg"> Python Pandas </strong>执行行采样的以下技术:</p><ul class=""><li id="dde2" class="mh mi iw ln b lo lp lr ls lu mj ly mk mc ml mg mm mn mo mp bi translated">随意采样</li><li id="2fd6" class="mh mi iw ln b lo mq lr mr lu ms ly mt mc mu mg mm mn mo mp bi translated">有条件抽样</li><li id="46b6" class="mh mi iw ln b lo mq lr mr lu ms ly mt mc mu mg mm mn mo mp bi translated">以恒定速率采样</li></ul><p id="f404" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">完整的代码可以从我的<a class="ae lk" href="https://github.com/alod83/data-science/blob/master/Preprocessing/DataSampling/Data%20Sampling.ipynb" rel="noopener ugc nofollow" target="_blank"> Github库</a>下载。</p><h1 id="3763" class="mv mw iw bd mx my mz na nb nc nd ne nf kl ng km nh ko ni kp nj kr nk ks nl nm bi translated">加载数据集</h1><p id="1e1b" class="pw-post-body-paragraph ll lm iw ln b lo nn kg lq lr no kj lt lu np lw lx ly nq ma mb mc nr me mf mg ip bi translated">在本教程中，我利用了由<code class="fe ns nt nu nv b">scikit-learn</code>库提供的<code class="fe ns nt nu nv b">iris</code>数据集，并将其转换为<code class="fe ns nt nu nv b">pandas</code>数据帧:</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="34f4" class="oa mw iw nv b gz ob oc l od oe">from sklearn.datasets import load_iris<br/>import pandas as pd</span><span id="959a" class="oa mw iw nv b gz of oc l od oe">data = load_iris()<br/>df = pd.DataFrame(data.data, columns=data.feature_names)</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj og"><img src="../Images/aa2c49eb1892c53a4209d7fc64d343b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pCIO1sknXGOHQvaJFzqL1w.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="8f70" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">数据集由4列150行组成。</p><h1 id="2ef7" class="mv mw iw bd mx my mz na nb nc nd ne nf kl ng km nh ko ni kp nj kr nk ks nl nm bi translated">随意采样</h1><p id="e2e0" class="pw-post-body-paragraph ll lm iw ln b lo nn kg lq lr no kj lt lu np lw lx ly nq ma mb mc nr me mf mg ip bi translated">给定一个有N行的数据帧，随机抽样从数据帧中抽取X个随机行，其中X ≤ N. Python <code class="fe ns nt nu nv b">pandas</code>提供了一个名为<code class="fe ns nt nu nv b">sample()</code>的函数来执行随机抽样。</p><p id="ab6f" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">要提取的样本数量可以用两种可选方式表示:</p><ul class=""><li id="bee0" class="mh mi iw ln b lo lp lr ls lu mj ly mk mc ml mg mm mn mo mp bi translated">指定要提取的随机行数</li><li id="66f7" class="mh mi iw ln b lo mq lr mr lu ms ly mt mc mu mg mm mn mo mp bi translated">指定要提取的随机行的百分比。百分比以0到1之间的数字表示。</li></ul><h2 id="d7f1" class="oa mw iw bd mx oh oi dn nb oj ok dp nf lu ol om nh ly on oo nj mc op oq nl jc bi translated">确切数量</h2><p id="80a3" class="pw-post-body-paragraph ll lm iw ln b lo nn kg lq lr no kj lt lu np lw lx ly nq ma mb mc nr me mf mg ip bi translated">在这种情况下，您可以将参数<code class="fe ns nt nu nv b">n</code>传递给<code class="fe ns nt nu nv b">sample()</code>函数，如下所示:</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="b074" class="oa mw iw nv b gz ob oc l od oe">subset = df.sample(n=100)</span></pre><p id="0997" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">在前面的例子中，<code class="fe ns nt nu nv b">sample()</code>函数提取了100个随机行。您可以通过<code class="fe ns nt nu nv b">shape</code>功能检查<code class="fe ns nt nu nv b">subset</code>结果数据集的形状:</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="9afe" class="oa mw iw nv b gz ob oc l od oe">subset.shape</span></pre><p id="25a7" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">它给出了以下输出:</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="2221" class="oa mw iw nv b gz ob oc l od oe">(100, 4)</span></pre><h2 id="42ab" class="oa mw iw bd mx oh oi dn nb oj ok dp nf lu ol om nh ly on oo nj mc op oq nl jc bi translated">百分率</h2><p id="04e1" class="pw-post-body-paragraph ll lm iw ln b lo nn kg lq lr no kj lt lu np lw lx ly nq ma mb mc nr me mf mg ip bi translated">如果您想要指定要提取的随机行的百分比，您可以将<code class="fe ns nt nu nv b">frac</code>参数作为<code class="fe ns nt nu nv b">sample()</code>函数的输入:</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="6db2" class="oa mw iw nv b gz ob oc l od oe">subset = df.sample(frac=0.5)</span></pre><p id="d77e" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">在前面的例子中，<code class="fe ns nt nu nv b">sample()</code>函数提取了50%的随机行。注意，您只能在<code class="fe ns nt nu nv b">n</code>和<code class="fe ns nt nu nv b">frac</code>参数之间指定一个。</p><h1 id="ff62" class="mv mw iw bd mx my mz na nb nc nd ne nf kl ng km nh ko ni kp nj kr nk ks nl nm bi translated">有条件抽样</h1><p id="eb4e" class="pw-post-body-paragraph ll lm iw ln b lo nn kg lq lr no kj lt lu np lw lx ly nq ma mb mc nr me mf mg ip bi translated">有条件抽样只允许提取满足给定条件的一些行。首先，必须指定条件。例如，作为一个条件，您可以只选择<code class="fe ns nt nu nv b">sepal width (cm)</code>列的值小于3的行:</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="d766" class="oa mw iw nv b gz ob oc l od oe">condition = df['sepal width (cm)'] &lt; 3</span></pre><p id="ea30" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">变量<code class="fe ns nt nu nv b">condition</code>是一个与<code class="fe ns nt nu nv b">df</code>大小相同的数列，包含<code class="fe ns nt nu nv b">True/False</code>，取决于行是否满足条件。</p><p id="9bd0" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">然后，检索与满足上述条件的行相关联的索引:</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="34ce" class="oa mw iw nv b gz ob oc l od oe">true_index = condition[condition == True].index</span></pre><p id="b755" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">在当前示例中，57行满足条件，因此您最多可以采样57行。</p><p id="780d" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated"><code class="fe ns nt nu nv b">sample()</code>功能可用于执行采样，条件如下:</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="e417" class="oa mw iw nv b gz ob oc l od oe">subset = df[condition].sample(n = 10)</span></pre><h1 id="7ce1" class="mv mw iw bd mx my mz na nb nc nd ne nf kl ng km nh ko ni kp nj kr nk ks nl nm bi translated">以恒定速率采样</h1><p id="4bac" class="pw-post-body-paragraph ll lm iw ln b lo nn kg lq lr no kj lt lu np lw lx ly nq ma mb mc nr me mf mg ip bi translated">另一种采样策略是以恒定速率采样，这意味着您希望两个相邻样本之间的距离恒定。例如，您可能希望以4的速率进行采样，如下图所示:</p><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj or"><img src="../Images/1b235fb1ff84b1e3406887dff0be8700.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZA3e32CQ0EYu8xDmKvK-qg.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="dfed" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">在这种情况下，首先指定速率:</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="c823" class="oa mw iw nv b gz ob oc l od oe">rate = 10</span></pre><p id="f6e5" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">然后，你可以简单地提取样本:</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="cd53" class="oa mw iw nv b gz ob oc l od oe">subset = df[::rate]</span></pre><p id="a46a" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">在<code class="fe ns nt nu nv b">iris</code>数据集中，样本数为150，因此10的采样率将产生15行的子集:</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="3ff9" class="oa mw iw nv b gz ob oc l od oe">subset.shape</span></pre><p id="89f8" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">它给出了以下输出:</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="cfb4" class="oa mw iw nv b gz ob oc l od oe">(15, 4)</span></pre><h1 id="903f" class="mv mw iw bd mx my mz na nb nc nd ne nf kl ng km nh ko ni kp nj kr nk ks nl nm bi translated">获取数据集的剩余部分</h1><p id="aea4" class="pw-post-body-paragraph ll lm iw ln b lo nn kg lq lr no kj lt lu np lw lx ly nq ma mb mc nr me mf mg ip bi translated">一旦提取了数据集的子集，还可以提取剩余部分。例如，如果您想在训练和测试集中分割数据集，可以使用这种策略，而不使用<code class="fe ns nt nu nv b">scikit-learn</code>库提供的<code class="fe ns nt nu nv b">train_test_split()</code>函数。</p><p id="62f8" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">可以采用两种可能的解决方案来提取数据集的剩余部分。这两种解决方案产生了相同的结果。</p><h2 id="bc45" class="oa mw iw bd mx oh oi dn nb oj ok dp nf lu ol om nh ly on oo nj mc op oq nl jc bi translated">第一种解决方案</h2><p id="48ad" class="pw-post-body-paragraph ll lm iw ln b lo nn kg lq lr no kj lt lu np lw lx ly nq ma mb mc nr me mf mg ip bi translated">第一种解决方案删除原始数据帧<code class="fe ns nt nu nv b">df</code>中提取的数据帧<code class="fe ns nt nu nv b">subset</code>的行，并将结果存储在新的数据帧中。这可以通过将待删除的索引列表传递给<code class="fe ns nt nu nv b">drop()</code>函数来实现:</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="9620" class="oa mw iw nv b gz ob oc l od oe">remaining = df.drop(labels=subset.index)</span></pre><h2 id="247c" class="oa mw iw bd mx oh oi dn nb oj ok dp nf lu ol om nh ly on oo nj mc op oq nl jc bi translated">第二种解决方案</h2><p id="1819" class="pw-post-body-paragraph ll lm iw ln b lo nn kg lq lr no kj lt lu np lw lx ly nq ma mb mc nr me mf mg ip bi translated">第二种解决方案仅选择原始数据帧<code class="fe ns nt nu nv b">df</code>中的行，其中索引不在提取的数据帧<code class="fe ns nt nu nv b">subset</code>的索引列表中:</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="0048" class="oa mw iw nv b gz ob oc l od oe">remaining = df[~df.index.isin(subset.index)]</span></pre><h1 id="c94d" class="mv mw iw bd mx my mz na nb nc nd ne nf kl ng km nh ko ni kp nj kr nk ks nl nm bi translated">摘要</h1><p id="ea76" class="pw-post-body-paragraph ll lm iw ln b lo nn kg lq lr no kj lt lu np lw lx ly nq ma mb mc nr me mf mg ip bi translated">在本教程中，我演示了如何以不同的方式执行数据帧采样:</p><ul class=""><li id="cd34" class="mh mi iw ln b lo lp lr ls lu mj ly mk mc ml mg mm mn mo mp bi translated">随机抽样，抽取N个随机行；</li><li id="fe1b" class="mh mi iw ln b lo mq lr mr lu ms ly mt mc mu mg mm mn mo mp bi translated">带条件抽样，应用一个条件，然后随机抽取N行；</li><li id="8775" class="mh mi iw ln b lo mq lr mr lu ms ly mt mc mu mg mm mn mo mp bi translated">以恒定速率采样。</li></ul><p id="e482" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">如果你想了解我的研究和其他活动的最新情况，你可以在<a class="ae lk" href="https://twitter.com/alod83" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae lk" href="https://www.youtube.com/channel/UC4O8-FtQqGIsgDW_ytXIWOg?view_as=subscriber" rel="noopener ugc nofollow" target="_blank"> Youtube </a>和<a class="ae lk" href="https://github.com/alod83" rel="noopener ugc nofollow" target="_blank"> Github </a>上关注我。</p><h1 id="dec3" class="mv mw iw bd mx my mz na nb nc nd ne nf kl ng km nh ko ni kp nj kr nk ks nl nm bi translated">相关文章</h1><div class="os ot gq gs ou ov"><a rel="noopener follow" target="_blank" href="/data-preprocessing-in-python-pandas-part-6-dropping-duplicates-e35e46bcc9d6"><div class="ow ab fp"><div class="ox ab oy cl cj oz"><h2 class="bd jg gz z fq pa fs ft pb fv fx jf bi translated">Python Pandas中的数据预处理—第6部分删除重复项</h2><div class="pc l"><h3 class="bd b gz z fq pa fs ft pb fv fx dk translated">使用Python熊猫库删除重复项的快速教程。</h3></div><div class="pd l"><p class="bd b dl z fq pa fs ft pb fv fx dk translated">towardsdatascience.com</p></div></div><div class="pe l"><div class="pf l pg ph pi pe pj le ov"/></div></div></a></div><div class="os ot gq gs ou ov"><a rel="noopener follow" target="_blank" href="/how-to-load-huge-csv-datasets-in-python-pandas-d306e75ff276"><div class="ow ab fp"><div class="ox ab oy cl cj oz"><h2 class="bd jg gz z fq pa fs ft pb fv fx jf bi translated">如何在Python Pandas中加载巨大的CSV数据集</h2><div class="pc l"><h3 class="bd b gz z fq pa fs ft pb fv fx dk translated">可能会出现这样的情况，您的硬盘中有一个巨大的CSV数据集，占用了4或5gb(甚至更多),而您…</h3></div><div class="pd l"><p class="bd b dl z fq pa fs ft pb fv fx dk translated">towardsdatascience.com</p></div></div><div class="pe l"><div class="pk l pg ph pi pe pj le ov"/></div></div></a></div><div class="os ot gq gs ou ov"><a rel="noopener follow" target="_blank" href="/data-preprocessing-with-scikit-learn-missing-values-8dff2c266db"><div class="ow ab fp"><div class="ox ab oy cl cj oz"><h2 class="bd jg gz z fq pa fs ft pb fv fx jf bi translated">使用scikit-learn进行数据预处理—缺失值</h2><div class="pc l"><h3 class="bd b gz z fq pa fs ft pb fv fx dk translated">在本教程中，我演示了如何使用scikit-learn预处理数据，这是一个用于机器学习的Python库。</h3></div><div class="pd l"><p class="bd b dl z fq pa fs ft pb fv fx dk translated">towardsdatascience.com</p></div></div><div class="pe l"><div class="pl l pg ph pi pe pj le ov"/></div></div></a></div></div></div>    
</body>
</html>