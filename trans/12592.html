<html>
<head>
<title>Introducing Anomaly/Outlier Detection in Python with PyOD 🔥</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 PyOD 在 Python 中引入异常/离群点检测🔥</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introducing-anomaly-outlier-detection-in-python-with-pyod-40afcccee9ff?source=collection_archive---------4-----------------------#2021-12-27">https://towardsdatascience.com/introducing-anomaly-outlier-detection-in-python-with-pyod-40afcccee9ff?source=collection_archive---------4-----------------------#2021-12-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9012" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">你认为那些讨厌的局外人能躲得过你吗？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/249a42169f549bcfda19fa28e515581e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gCqfKwkIQ7a9ZkCD"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">约翰·施诺布里奇在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="eac1" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">您的旅程概述</h1><ol class=""><li id="dc27" class="lr ls it lt b lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated"><a class="ae ky" href="#2a76" rel="noopener ugc nofollow">设置舞台</a></li><li id="65a3" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><a class="ae ky" href="#5a70" rel="noopener ugc nofollow">什么是异常/异常值检测？</a></li><li id="831f" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><a class="ae ky" href="#d2b4" rel="noopener ugc nofollow">介绍 PyOD </a></li><li id="ec70" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><a class="ae ky" href="#2562" rel="noopener ugc nofollow">熟悉数据</a></li><li id="90b3" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><a class="ae ky" href="#8787" rel="noopener ugc nofollow">用于数据清洗的异常检测</a></li><li id="bcd6" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><a class="ae ky" href="#1525" rel="noopener ugc nofollow">用于预测的异常检测</a></li><li id="edda" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><a class="ae ky" href="#45a1" rel="noopener ugc nofollow">包装</a></li></ol></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="2a76" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">1 —搭建舞台</h1><p id="e1a9" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">近年来，<strong class="lt iu">异常检测</strong>在机器学习社区变得更加流行。尽管如此，在异常检测上的资源肯定比经典的机器学习算法要少。因此，学习异常检测可能会比想象中更棘手。从概念的角度来看，异常检测实际上非常简单！</p><p id="66a2" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">这篇博文的目的是给你一个异常/异常值检测的快速介绍。具体来说，我将向您展示如何使用包<a class="ae ky" href="https://pyod.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> PyOD — Python 异常检测</a>在 Python 中实现异常检测。通过这种方式，您不仅会了解什么是异常/异常值检测，还会了解如何在 Python 中实现异常检测。</p><p id="47fc" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">好消息是 PyOD 很容易应用——尤其是如果你已经有了使用<a class="ae ky" href="https://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank"> Scikit-Learn </a>的经验。事实上，PyOD 包试图与 Scikit-Learn API 接口非常相似。</p><p id="b780" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated"><strong class="lt iu">先决条件:</strong>你应该对 Python 和熊猫有一些基本的熟悉。然而，不需要异常检测的知识😃</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="5a70" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">2 —什么是异常/异常值检测？</h1><p id="3463" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">异常检测有许多名称；<em class="nn">异常检测</em>、<em class="nn">异常分析</em>、<em class="nn">异常分析</em>、<em class="nn">新奇检测</em>。来自维基百科的简明描述如下描述了异常检测:</p><blockquote class="nt"><p id="45da" class="nu nv it bd nw nx ny nz oa ob oc me dk translated"><strong class="ak"> <em class="od">异常检测</em> </strong>是对罕见项目、事件或观察结果的识别，这些项目、事件或观察结果因与大多数数据显著不同而引起怀疑。</p></blockquote><p id="af8c" class="pw-post-body-paragraph na nb it lt b lu oe ju nc lw of jx nd ly og nf ng ma oh ni nj mc oi nl nm me im bi translated">让我们试着解开以上陈述。假设您有一个由许多观察值组成的数据集。异常检测的目标是识别明显不同于其他观测的观测。你为什么想这么做？有两个主要原因:</p><h2 id="0a0f" class="oj la it bd lb ok ol dn lf om on dp lj ly oo op ll ma oq or ln mc os ot lp ou bi translated">用例 1 —数据清理</h2><p id="293c" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">清理数据时，有时最好删除异常，因为它们歪曲了数据。让我们用一个具体的例子来说明这一点:假设你做了一个调查，问了一些关于受访者最喜欢的猫品种的问题😺</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/7de90b4c0f2aa7fdab4df62d6cee403c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qUNbVr4Uj8vr-BQX"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@miklevasilyev?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">米哈伊尔·瓦西里耶夫</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="7348" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">您首先将调查交给 100 个人，每个人完成调查。现在，您需要估计参加调查所需的平均时间。为什么？您希望有 10，000 多人参加调查。指出新受访者的调查大概需要多长时间是很专业的。即使猫很牛逼，人也很忙！</p><p id="6fca" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">假设您从前 100 个人那里获得了以下结果:</p><ul class=""><li id="1223" class="lr ls it lt b lu no lw np ly ow ma ox mc oy me oz mg mh mi bi translated">3 分钟— 57 名受访者</li><li id="94b4" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me oz mg mh mi bi translated">4 分钟— 33 名受访者</li><li id="e82e" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me oz mg mh mi bi translated">5 分钟— 6 名受访者</li><li id="e3ad" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me oz mg mh mi bi translated">6 分钟— 3 名受访者</li><li id="78e2" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me oz mg mh mi bi translated">480 分钟— 1 名受访者</li></ul><p id="ad31" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">最后一个是怎么回事？480 分钟就是 8 小时！经进一步检查，你发现被调查人在晚上 23:58 开始调查，然后从 00:00 一直站到 07:56。然后从 07:56 到 07:58 结束。你能看到发生了什么吗？</p><p id="f8a5" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">明明一个人开始调查，然后睡觉，然后早上起来就完成了调查。如果您保留这一结果，那么完成调查的平均时间将是</p><p id="69db" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">平均值=(3 * 57+4 * 33+5 * 6+6 * 3+1 * 480)/100 = 8.31</p><p id="2c66" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">然而，说调查大约需要 8 分钟是不准确的。花了那么长时间的唯一原因是因为一个困倦的回答者😪</p><p id="4d97" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">更准确的做法是把那个人从记录中去掉</p><p id="3064" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">平均值= (3 * 57 + 4 * 33 + 5 * 6 + 6 * 3)/99 = 3.54</p><p id="3fc2" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">为简单起见，调查可以写成这样的句子:<em class="nn">调查的平均完成时间在 3 到 4 分钟之间。</em></p><p id="bbd2" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">这里，您已经手动删除了一个异常值，以清理数据，从而更好地代表现实。<strong class="lt iu">异常检测是实现自动检测异常值的算法。</strong></p><blockquote class="pa pb pc"><p id="e0e4" class="na nb nn lt b lu no ju nc lw np jx nd pd nq nf ng pe nr ni nj pf ns nl nm me im bi translated"><strong class="lt iu">注意:</strong>在上面的例子中，您已经删除了一个异常值，以更好地匹配调查长度与现实。异常检测不应该<strong class="lt iu">被用来人为地让一个产品看起来比它实际上更好。应该仔细考虑使用异常检测进行数据清理在道德上是否合适。</strong></p></blockquote><h2 id="e396" class="oj la it bd lb ok ol dn lf om on dp lj ly oo op ll ma oq or ln mc os ot lp ou bi translated">用例 2 —预测</h2><p id="bbf3" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">在其他应用中，<em class="nn">异常本身就是关注点</em>。例如网络入侵、银行欺诈和某些结构缺陷。在这些应用中，异常代表了值得进一步研究的东西。</p><ul class=""><li id="301d" class="lr ls it lt b lu no lw np ly ow ma ox mc oy me oz mg mh mi bi translated"><strong class="lt iu">网络入侵</strong> —网络数据的异常可能表明某种网络攻击已经发生。</li><li id="852f" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me oz mg mh mi bi translated"><strong class="lt iu">银行欺诈</strong> —交易数据的异常可能表明欺诈或可疑行为。</li><li id="fbe7" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me oz mg mh mi bi translated"><strong class="lt iu">结构缺陷</strong> —异常可能表明您的硬件有问题。虽然在这种情况下通常可以使用更传统的监控软件，但是异常检测可以发现更奇怪的缺陷。</li></ul><blockquote class="pa pb pc"><p id="e620" class="na nb nn lt b lu no ju nc lw np jx nd pd nq nf ng pe nr ni nj pf ns nl nm me im bi translated"><strong class="lt iu">警告:</strong>在某些情况下，比如银行欺诈，并不总是单笔交易引起怀疑。应该考虑的是在上下文中看到的多次交易的频率和数量。为了解决这个问题，应该对数据进行适当的汇总。这超出了本博客的范围，但是您应该知道。</p></blockquote></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="d2b4" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">3 —介绍 PyOD</h1><p id="de0e" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">让我们描述一下帮助您进行异常检测的 Python 包<a class="ae ky" href="https://pyod.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank"> PyOD </a>。用 PyOD 文档的话说:</p><blockquote class="nt"><p id="716a" class="nu nv it bd nw nx ny nz oa ob oc me dk translated">PyOD 是一个全面且可扩展的<strong class="ak"> Python 工具包</strong>，用于<strong class="ak">检测多元数据中的无关对象</strong>。</p></blockquote><p id="af03" class="pw-post-body-paragraph na nb it lt b lu oe ju nc lw of jx nd ly og nf ng ma oh ni nj mc oi nl nm me im bi translated">简而言之，PyOD 为您提供了一系列执行异常检测的模型。一些值得一提的亮点是:</p><ul class=""><li id="4ea7" class="lr ls it lt b lu no lw np ly ow ma ox mc oy me oz mg mh mi bi translated">PyOD 包括 30 多种不同的算法。他们中的一些是经典作品(如 LOF)，而另一些则是新晋作品(如科普德)。参见<a class="ae ky" href="https://pyod.readthedocs.io/en/latest/pyod.models.html" rel="noopener ugc nofollow" target="_blank">支持型号的完整列表</a>。</li><li id="b4dc" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me oz mg mh mi bi translated">PyOD 通过使用 Numba 的 jit-decorator 优化了它的代码。如果你对此感兴趣，我已经在 Numba 上写了一篇博文。</li><li id="82e3" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me oz mg mh mi bi translated">PyOD 有统一的 API。因此，如果您熟悉 PyOD 中的一些模型，那么您可以轻松地学习其余的模型。我建议在你写完这篇博客后，看看<a class="ae ky" href="https://pyod.readthedocs.io/en/latest/api_cc.html" rel="noopener ugc nofollow" target="_blank"> PyOD API 备忘单</a>。</li></ul><p id="8313" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">如果您正在使用 PIP，那么您可以使用以下命令安装 PyOD:</p><pre class="kj kk kl km gt pg ph pi pj aw pk bi"><span id="7caf" class="oj la it ph b gy pl pm l pn po">pip install pyod</span></pre><p id="a852" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">如果您之前已经安装了 PyOD，请确保使用 pip 命令更新它:</p><pre class="kj kk kl km gt pg ph pi pj aw pk bi"><span id="ff98" class="oj la it ph b gy pl pm l pn po">pip install --upgrade pyod</span></pre><p id="d540" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">如果您使用的是 Conda 软件包管理器，那么您可以运行以下命令:</p><pre class="kj kk kl km gt pg ph pi pj aw pk bi"><span id="02aa" class="oj la it ph b gy pl pm l pn po">conda install -c conda-forge pyod</span></pre><p id="3546" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">在这篇博文中，我将演示两种异常检测算法:KNN 和 LOC。你可能以前听说过 KNN(K-最近邻)，而 LOC(本地离群因子)可能对你来说并不熟悉。让我们先来看看你将使用⚡️的数据</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="2562" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">4 —熟悉数据</h1><p id="4d85" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">我们将使用经典的<strong class="lt iu">泰坦尼克号数据集</strong>。要将数据集加载到 Pandas 中，只需运行下面的代码:</p><pre class="kj kk kl km gt pg ph pi pj aw pk bi"><span id="5392" class="oj la it ph b gy pl pm l pn po">import pandas as pd<br/>titanic = pd.read_csv(<br/>"<a class="ae ky" href="https://raw.githubusercontent.com/datasciencedojo/datasets/master/titanic.csv" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/datasciencedojo/datasets/master/titanic.csv</a>"<br/>)</span></pre><p id="248b" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">要检查数据集的第一行，使用<code class="fe pp pq pr ph b">head()</code>方法:</p><pre class="kj kk kl km gt pg ph pi pj aw pk bi"><span id="e57c" class="oj la it ph b gy pl pm l pn po">titanic.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ps"><img src="../Images/f048f64e3d52b64b9df72e8c90a0eb32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kSAl7dHRe0nOoO1pdz4vQQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">泰坦尼克号数据帧的前 5 行。</p></figure><p id="db77" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">如您所见，有代表性别、年龄、票价、乘客级别、机票等的列。为简单起见，您将只使用以下四列:</p><pre class="kj kk kl km gt pg ph pi pj aw pk bi"><span id="9d1e" class="oj la it ph b gy pl pm l pn po"># Selecting only the columns Survived, Pclass, Fare, and Sex<br/>partial_titanic = titanic[["Survived", "Pclass", "Fare", "Sex"]]</span></pre><p id="fa64" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated"><code class="fe pp pq pr ph b">partial_titanic</code>中没有缺失值。然而，列<code class="fe pp pq pr ph b">Sex</code>由字符串值<code class="fe pp pq pr ph b">male</code>或<code class="fe pp pq pr ph b">female</code>组成。为了能够进行异常检测，您需要数值。您可以使用代码将这个二进制分类变量转换为值 0 和 1:</p><pre class="kj kk kl km gt pg ph pi pj aw pk bi"><span id="6a56" class="oj la it ph b gy pl pm l pn po"># Change the categorical value Sex to numeric values<br/>partial_titanic["Sex"] = partial_titanic["Sex"].map({<br/>"male": 0,<br/>"female": 1<br/>})</span></pre><p id="a11b" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">现在您已经准备好进行异常检测了😃</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="8787" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">5 —用于数据清理的异常检测</h1><p id="46b7" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">现在让我们使用异常检测来清理您在上一节中创建的数据集<code class="fe pp pq pr ph b">partial_titanic</code>。您将使用 KNN 模型来完成这项工作。KNN 模型检查数据并寻找远离其他数据点的数据点(行)。首先，您需要导入 KNN 模型，如下所示:</p><pre class="kj kk kl km gt pg ph pi pj aw pk bi"><span id="9e40" class="oj la it ph b gy pl pm l pn po"># Import the KNN<br/>from pyod.models.knn import KNN</span></pre><p id="7c40" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">我们从提出一个 KNN 模型开始:</p><pre class="kj kk kl km gt pg ph pi pj aw pk bi"><span id="5187" class="oj la it ph b gy pl pm l pn po"># Initiate a KNN model<br/>KNN_model = KNN()</span></pre><p id="dff7" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">对于用于数据清理的异常检测方法，您可以对整个数据集进行如下拟合</p><pre class="kj kk kl km gt pg ph pi pj aw pk bi"><span id="ae06" class="oj la it ph b gy pl pm l pn po"># Fit the model to the whole dataset<br/>KNN_model.fit(partial_titanic)</span><span id="425c" class="oj la it ph b gy pt pm l pn po"><strong class="ph iu">Output:</strong><br/>KNN(algorithm='auto', contamination=0.1, leaf_size=30, method='largest', metric='minkowski', metric_params=None, n_jobs=1, n_neighbors=5, p=2, radius=1.0)</span></pre><p id="7b0e" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">当运行上面的代码时，你会打印出很多默认值(例如<code class="fe pp pq pr ph b">contamination=0.1</code>)。如果需要，可以进行调整。运行模型后，您可以访问两种类型的输出:</p><ul class=""><li id="4216" class="lr ls it lt b lu no lw np ly ow ma ox mc oy me oz mg mh mi bi translated"><strong class="lt iu">标签:</strong>通过运行<code class="fe pp pq pr ph b">KNN_model.labels_</code>，您可以找到观察值是否为异常值的二进制标签。数字<code class="fe pp pq pr ph b">0</code>表示正常观察值，而数字<code class="fe pp pq pr ph b">1</code>表示异常值。</li><li id="0f3c" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me oz mg mh mi bi translated"><strong class="lt iu">决策分数:</strong>通过运行<code class="fe pp pq pr ph b">KNN_model.decision_scores_</code>，您可以得到某件事情有多异常的原始分数。这些值的范围从<code class="fe pp pq pr ph b">0</code>到更高。较高的异常值表示数据点更像是异常值。</li></ul><p id="91a4" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">让我们来看看训练模型的标签:</p><pre class="kj kk kl km gt pg ph pi pj aw pk bi"><span id="87a3" class="oj la it ph b gy pl pm l pn po"># Find the labels<br/>outlier_labels = KNN_model.labels_</span><span id="1b22" class="oj la it ph b gy pt pm l pn po"># Find the number of outliers<br/>number_of_outliers = len(outlier_labels[outlier_labels == 1])<br/>print(number_of_outliers)</span><span id="7606" class="oj la it ph b gy pt pm l pn po"><strong class="ph iu">Output:</strong><br/>88</span></pre><p id="2843" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">对于一个有 891 名乘客的数据集，有 88 个异常值是相当高的。为了减少这种情况，您可以将 KNN 模型中的参数<code class="fe pp pq pr ph b">contamination</code>指定得更低。<code class="fe pp pq pr ph b">contamination</code>表示异常值数据点的百分比。假设污染仅仅发生在<code class="fe pp pq pr ph b">1%</code>:</p><pre class="kj kk kl km gt pg ph pi pj aw pk bi"><span id="524f" class="oj la it ph b gy pl pm l pn po"># Initiate a KNN model<br/>KNN_model = KNN(contamination=0.01)</span><span id="1dc8" class="oj la it ph b gy pt pm l pn po"># Fit the model to the whole dataset<br/>KNN_model.fit(partial_titanic)</span><span id="1875" class="oj la it ph b gy pt pm l pn po"># Find the labels<br/>outlier_labels = KNN_model.labels_</span><span id="c080" class="oj la it ph b gy pt pm l pn po"># Find the number of outliers<br/>number_of_outliers = len(outlier_labels[outlier_labels == 1])<br/>print(number_of_outliers)</span><span id="c6a1" class="oj la it ph b gy pt pm l pn po"><strong class="ph iu">Output:</strong> <br/>9</span></pre><p id="b5b9" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">现在只有<code class="fe pp pq pr ph b">9</code>离群！您可以查看它们:</p><pre class="kj kk kl km gt pg ph pi pj aw pk bi"><span id="8cdd" class="oj la it ph b gy pl pm l pn po"># Finding the outlier passengers<br/>outliers = partial_titanic.iloc[outlier_labels == 1]</span></pre><p id="f2e9" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">如果你检查<code class="fe pp pq pr ph b">outliers</code>变量，你会得到下表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pu"><img src="../Images/a44bf57e6a3ec870bee3880dacbc5d9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/format:webp/1*-q44FhXay91HzbXrQxwL2Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">离群乘客</p></figure><p id="8c73" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">如果你看看上面的乘客，KNN 模型会发现他们的票价高得令人难以置信。所有乘客的平均票价很容易在熊猫身上找到:</p><pre class="kj kk kl km gt pg ph pi pj aw pk bi"><span id="4d76" class="oj la it ph b gy pl pm l pn po"># Average fare price<br/>round(partial_titanic["Fare"].mean(), 3)</span><span id="dfd3" class="oj la it ph b gy pt pm l pn po"><strong class="ph iu">Output:</strong><br/>32.204</span></pre><p id="63c9" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">KNN 算法已经成功地发现了 9 名在票价意义上是异常值的乘客。KNN 模型有许多可选参数<a class="ae ky" href="https://pyod.readthedocs.io/en/latest/pyod.models.html#module-pyod.models.knn" rel="noopener ugc nofollow" target="_blank">供您选择，以满足您的特定需求🔥</a></p><p id="8a65" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">如果您觉得异常值不能代表数据的总体感觉，那么现在可以从数据中删除这些异常值。如前所述，您应该仔细考虑用于数据清理的异常检测是否适合您的问题。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="1525" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">6 —用于预测的异常检测</h1><p id="6d22" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">在上一节中，您看到了用于数据清理的<strong class="lt iu">异常检测</strong>。在本节中，您将在预测的<strong class="lt iu">异常检测处取一个峰值。您将根据现有数据训练一个模型，然后使用该模型来预测新数据<em class="nn">是否为异常值。</em></strong></p><p id="aee1" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">假设有谣言说沃森太太也乘坐了泰坦尼克号，但她的死亡从未被记录。根据传闻，沃森太太是一位富有的女士，她花了 1000 美元乘坐泰坦尼克号在一个非常高级的套房里旅行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pv"><img src="../Images/05d4e3addbe80bea389a75be82ead537.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*W4o2LL6DQqTSRH7C"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">卢克·布拉斯韦尔在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="59f6" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">异常检测不能肯定地说谣言是真是假。然而，它可以根据其他乘客的信息来判断沃森太太是否是异常。如果她是一个异常，谣言应该半信半疑。</p><p id="f443" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">让我们用 PyOD 库中的另一个模型来测试 Watson 夫人的存在性；<strong class="lt iu">局部异常值因子(LOF) </strong>。LOF 模型通过将数据点的<em class="nn">局部密度</em>与其相邻数据点的局部密度进行比较来测试数据点是否为异常值。关于这种方法的更多信息，你可以查看它的维基百科页面。</p><p id="4154" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">让我们开始编码吧！首先建立一个局部异常因素模型:</p><pre class="kj kk kl km gt pg ph pi pj aw pk bi"><span id="791e" class="oj la it ph b gy pl pm l pn po"># Import the LOF<br/>from pyod.models.lof import LOF</span><span id="8e63" class="oj la it ph b gy pt pm l pn po"># Initiate a LOF model<br/>LOF_model = LOF()</span><span id="2863" class="oj la it ph b gy pt pm l pn po"># Train the model on the Titanic data<br/>LOF_model.fit(partial_titanic)</span></pre><p id="4b91" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">请注意，使用 LOF 模型与使用 KNN 模型是多么相似。</p><p id="43a6" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">现在你可以把沃森太太表示成一个数据点:</p><pre class="kj kk kl km gt pg ph pi pj aw pk bi"><span id="0704" class="oj la it ph b gy pl pm l pn po"># Represent Mrs. Watson as a data point<br/>mrs_watson = [[0, 1, 1000, 1]]</span></pre><p id="dcab" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated"><code class="fe pp pq pr ph b">mrs_watson</code>中的值代表她的存活(<code class="fe pp pq pr ph b">0</code>代表未存活)、乘客等级(<code class="fe pp pq pr ph b">1</code>代表头等舱)、票价(<code class="fe pp pq pr ph b">1000$</code>代表票价)、性别(<code class="fe pp pq pr ph b">1</code>代表女性)。LOF 模型需要 2D 阵列，因此这就是在<code class="fe pp pq pr ph b">mrs_watson</code>中增加一对括号<code class="fe pp pq pr ph b">[]</code>的原因。</p><p id="fbba" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">我们现在使用<code class="fe pp pq pr ph b">predict()</code>方法来预测沃森太太是否是异常值:</p><pre class="kj kk kl km gt pg ph pi pj aw pk bi"><span id="9873" class="oj la it ph b gy pl pm l pn po">outlier = LOF_model.predict(mrs_watson)<br/>print(outlier)</span><span id="c09a" class="oj la it ph b gy pt pm l pn po"><strong class="ph iu">Output:</strong><br/>1</span></pre><p id="dabc" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">值<code class="fe pp pq pr ph b">1</code>表示沃森太太是异常值。这应该让你怀疑关于沃森太太的谣言是假的😮</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="45a1" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">7—总结</h1><p id="ade7" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">我已经向您展示了如何用 KNN 和 LOF 两种算法实现异常检测。正如你可能会怀疑的那样，PyOD 中有更多的算法可以使用。</p><p id="2ef2" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">异常检测对于清理数据和预测异常值都很重要。手边的应用程序应该确定是否需要应用异常检测。如果您计划在 Python 中应用异常检测，那么<a class="ae ky" href="https://pyod.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> PyOD </a>是一个可靠的选择。</p><p id="22ce" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated"><strong class="lt iu">喜欢我写的？查看我的其他帖子，了解更多 Python 内容:</strong></p><ul class=""><li id="af99" class="lr ls it lt b lu no lw np ly ow ma ox mc oy me oz mg mh mi bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/modernize-your-sinful-python-code-with-beautiful-type-hints-4e72e98f6bf1">用漂亮的类型提示使你罪恶的 Python 代码现代化</a></li><li id="8e96" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me oz mg mh mi bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/visualizing-missing-values-in-python-is-shockingly-easy-56ed5bc2e7ea">用 Python 可视化缺失值非常简单</a></li><li id="43c2" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me oz mg mh mi bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/painlessly-speed-up-your-data-analysis-in-python-with-mito-2b79de4f2f46">使用米托轻松加速 Python 中的数据分析</a></li><li id="3825" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me oz mg mh mi bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/5-awesome-numpy-functions-that-can-save-you-in-a-pinch-ba349af5ac47"> 5 个能在紧要关头拯救你的超赞数字功能</a></li><li id="64b0" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me oz mg mh mi bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/5-expert-tips-to-skyrocket-your-dictionary-skills-in-python-1cf54b7d920d"> 5 个专家提示，让你的 Python 字典技能一飞冲天🚀</a></li></ul><p id="d516" class="pw-post-body-paragraph na nb it lt b lu no ju nc lw np jx nd ly nq nf ng ma nr ni nj mc ns nl nm me im bi translated">如果你对数据科学、编程或任何介于两者之间的东西感兴趣，那么请随意在 LinkedIn 上添加我，并向✋问好</p></div></div>    
</body>
</html>