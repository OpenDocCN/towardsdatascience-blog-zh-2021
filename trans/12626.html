<html>
<head>
<title>5 Examples to Learn Date and Time Manipulation with Python Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 熊猫学习日期和时间操作的 5 个例子</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/5-examples-to-learn-date-and-time-manipulation-with-python-pandas-9ab9cdeb032e?source=collection_archive---------10-----------------------#2021-12-28">https://towardsdatascience.com/5-examples-to-learn-date-and-time-manipulation-with-python-pandas-9ab9cdeb032e?source=collection_archive---------10-----------------------#2021-12-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ef24" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">实用指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/eb6339383028b4f2e8815f020986a137.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5ipY1hFf1aPrBK2f06V9Sw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="bdd0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们经常在数据科学中处理日期和时间。如果您正在处理时间序列数据，它们总是您工作的一部分。</p><p id="ae71" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Pandas 在处理日期和时间方面非常高效和实用。在本文中，我们将通过 5 个例子来解决一些常见的日期和时间操作。</p><blockquote class="lu lv lw"><p id="30a2" class="ky kz lx la b lb lc ju ld le lf jx lg ly li lj lk lz lm ln lo ma lq lr ls lt im bi translated">如果你想在我发表新文章时收到电子邮件，别忘了订阅。</p></blockquote><p id="25a9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们首先创建一个包含日期的示例数据框架。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="72e0" class="mh mi it md b gy mj mk l ml mm">import pandas as pd</span><span id="2e6f" class="mh mi it md b gy mn mk l ml mm">df = pd.DataFrame({<br/>    "Date": pd.date_range(start="2021-12-28", periods=5, freq="D"),<br/>    "Measurement": [1, 10, 25, 7, 12]<br/>})</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/d843f8b366392e0c7b396aecfad3df6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*QyC2Tg6uREnzXrLQrF50zA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h2 id="b95f" class="mh mi it bd mw mx my dn mz na nb dp nc lh nd ne nf ll ng nh ni lp nj nk nl nm bi translated">1.使用 DateOffset 的日期时间操作</h2><p id="ce20" class="pw-post-body-paragraph ky kz it la b lb nn ju ld le no jx lg lh np lj lk ll nq ln lo lp nr lr ls lt im bi translated"><code class="fe ns nt nu md b">DateOffset</code>功能可用于为日期添加特定长度的持续时间。</p><p id="32c6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们通过向现有的日期列添加 6 个月来创建一个新列。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="3582" class="mh mi it md b gy mj mk l ml mm">df["Date2"] = df["Date"] + pd.DateOffset(months=6)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/ea7d1412511c49470f075f7e694ef61c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*a3QN964tdUubeGys1o7N8Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="53f5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下代码行将 1 年添加到现有的日期列中。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="44c6" class="mh mi it md b gy mj mk l ml mm">df["Date2"] = df["Date"] + pd.DateOffset(years=1)</span></pre></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><p id="c814" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">需要注意的是，日期列中值的数据类型是<code class="fe ns nt nu md b">datetime</code>。因此，我们也可以添加时间间隔。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="4151" class="mh mi it md b gy mj mk l ml mm">df["Date"] + pd.DateOffset(hours=2)</span><span id="891f" class="mh mi it md b gy mn mk l ml mm"># output<br/>0   2021-12-28 02:00:00<br/>1   2021-12-29 02:00:00<br/>2   2021-12-30 02:00:00<br/>3   2021-12-31 02:00:00<br/>4   2022-01-01 02:00:00<br/>Name: Date, dtype: datetime64[ns]</span></pre><p id="b2a4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果需要做减法，只需将“+”号改为“-”号，或者在函数内部使用负值。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h2 id="b633" class="mh mi it bd mw mx my dn mz na nb dp nc lh nd ne nf ll ng nh ni lp nj nk nl nm bi translated">2.使用 Timedelta 的日期时间操作</h2><p id="3fc9" class="pw-post-body-paragraph ky kz it la b lb nn ju ld le no jx lg lh np lj lk ll nq ln lo lp nr lr ls lt im bi translated">我们也可以使用<code class="fe ns nt nu md b">Timedelta</code>功能来添加日期和时间。它的语法与<code class="fe ns nt nu md b">DateOffset</code>函数的语法略有不同。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="d8dc" class="mh mi it md b gy mj mk l ml mm">df["Date"] + pd.Timedelta(3, unit="day")</span><span id="ad51" class="mh mi it md b gy mn mk l ml mm"># output<br/>0   2021-12-31<br/>1   2022-01-01<br/>2   2022-01-02<br/>3   2022-01-03<br/>4   2022-01-04<br/>Name: Date, dtype: datetime64[ns]</span></pre><p id="fc77" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe ns nt nu md b">Timedelta</code>函数也接受字符串来指定要添加的持续时间。下面的代码行执行与上面相同的操作。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="170a" class="mh mi it md b gy mj mk l ml mm">df["Date"] + pd.Timedelta("3 days")</span></pre></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h2 id="2e01" class="mh mi it bd mw mx my dn mz na nb dp nc lh nd ne nf ll ng nh ni lp nj nk nl nm bi translated">3.从日期时间对象中提取信息</h2><p id="0537" class="pw-post-body-paragraph ky kz it la b lb nn ju ld le no jx lg lh np lj lk ll nq ln lo lp nr lr ls lt im bi translated">一个<code class="fe ns nt nu md b">datetime</code>对象包含几条信息，比如年、月、日、周、小时、微秒等等。</p><p id="f7c5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们有时需要一条特定的信息。例如，我们可以从日期中提取月份，如下所示:</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="1093" class="mh mi it md b gy mj mk l ml mm">df["Date"].dt.month</span><span id="249f" class="mh mi it md b gy mn mk l ml mm"># output<br/>0    12<br/>1    12<br/>2    12<br/>3    12<br/>4     1<br/>Name: Date, dtype: int64</span></pre><p id="7a6b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe ns nt nu md b">year</code>和<code class="fe ns nt nu md b">day</code>方法分别返回日期的年和日部分。</p><p id="d7b6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在零售分析中，星期几是用于分析和建模的重要信息。<code class="fe ns nt nu md b">dayofweek</code>方法可以用来从一个日期中获取这个信息。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="89dd" class="mh mi it md b gy mj mk l ml mm">df["Date"].dt.dayofweek</span><span id="610e" class="mh mi it md b gy mn mk l ml mm"># output<br/>0    1<br/>1    2<br/>2    3<br/>3    4<br/>4    5<br/>Name: Date, dtype: int64</span></pre></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><p id="6152" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所有这些方法都可以在<code class="fe ns nt nu md b">dt</code>访问器下使用，所以一定要在方法名前写“dt”。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h2 id="7e37" class="mh mi it bd mw mx my dn mz na nb dp nc lh nd ne nf ll ng nh ni lp nj nk nl nm bi translated">4.异日历</h2><p id="3007" class="pw-post-body-paragraph ky kz it la b lb nn ju ld le no jx lg lh np lj lk ll nq ln lo lp nr lr ls lt im bi translated"><code class="fe ns nt nu md b">isocalendar</code>函数返回带有年、周和星期几的数据帧。因此，这是一种在单次操作中提取多条信息的快速方法。</p><p id="a2c3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，我们可以将年、周和星期几列添加到初始数据框架中，如下所示:</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="6fc7" class="mh mi it md b gy mj mk l ml mm">df = pd.concat([df, df["Date"].dt.isocalendar()], axis=1)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/c6ec9f65f7b9ea65d7212bfd92da1950.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gaD7oaOPbYTMg0gLaSIR0w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="1785" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">创建附加列的部分是:</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="e69a" class="mh mi it md b gy mj mk l ml mm">df["Date"].dt.isocalendar()</span></pre><p id="d66e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们使用<code class="fe ns nt nu md b">concat</code>函数将这些列与原始数据帧结合起来。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h2 id="6ddf" class="mh mi it bd mw mx my dn mz na nb dp nc lh nd ne nf ll ng nh ni lp nj nk nl nm bi translated">5.差异</h2><p id="cab9" class="pw-post-body-paragraph ky kz it la b lb nn ju ld le no jx lg lh np lj lk ll nq ln lo lp nr lr ls lt im bi translated">在某些任务中，两个日期或时间之间的差异可能非常重要。例如，我们可能需要计算流程中连续测量之间的时间。</p><p id="283a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">两个<code class="fe ns nt nu md b">datetime</code>对象的减法运算给出了天数的差异。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="ff0d" class="mh mi it md b gy mj mk l ml mm">df["Diff"] = df["Date2"] - df["Date"]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/7703bfa15e05862633da00dd63139052.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PPJeWTW4_DqsDAnql-fkqQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="41c7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">diff 列的数据类型是<code class="fe ns nt nu md b">timedelta</code>，所以我们可以使用<code class="fe ns nt nu md b">days</code>方法得到天数。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="0b8a" class="mh mi it md b gy mj mk l ml mm">df["Diff"].dt.days</span><span id="bbaf" class="mh mi it md b gy mn mk l ml mm"># output<br/>0    365<br/>1    365<br/>2    365<br/>3    365<br/>4    365<br/>Name: Diff, dtype: int64</span></pre><p id="9f31" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们也可以用 1 天除以一个<code class="fe ns nt nu md b">timedelta</code>对象来得到天数。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="b203" class="mh mi it md b gy mj mk l ml mm">df["Diff"] / pd.Timedelta(days=1)</span><span id="e890" class="mh mi it md b gy mn mk l ml mm"># output<br/>0    365.0<br/>1    365.0<br/>2    365.0<br/>3    365.0<br/>4    365.0<br/>Name: Diff, dtype: float64</span></pre><p id="0f1d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您想要将差异转换为月或年，请使用 NumPy 的<code class="fe ns nt nu md b">timedelta</code>,因为熊猫无法从月或年构造<code class="fe ns nt nu md b">Timedelta</code>。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="25f9" class="mh mi it md b gy mj mk l ml mm">import numpy as np</span><span id="3c63" class="mh mi it md b gy mn mk l ml mm">df["Diff"] / np.timedelta64(1, 'M')</span><span id="dc66" class="mh mi it md b gy mn mk l ml mm"># output<br/>0    11.992033<br/>1    11.992033<br/>2    11.992033<br/>3    11.992033<br/>4    11.992033<br/>Name: Diff, dtype: float64</span></pre></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><p id="10a8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们已经学习了熊猫的功能和方法来解决日期和时间操作中的一些常见任务。</p><p id="7740" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="lx">别忘了</em> <a class="ae mb" href="https://sonery.medium.com/subscribe" rel="noopener"> <em class="lx">订阅</em> </a> <em class="lx">如果你想在我发表新文章时收到邮件。</em></p><p id="dd89" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="lx">你可以成为</em> <a class="ae mb" href="https://sonery.medium.com/membership" rel="noopener"> <em class="lx">媒介会员</em> </a> <em class="lx">解锁我的全部写作权限，外加其余媒介。如果您使用以下链接，我将收取您的一部分会员费，无需您支付额外费用。</em></p><div class="ny nz gp gr oa ob"><a href="https://sonery.medium.com/membership" rel="noopener follow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">通过我的推荐链接加入 Medium-Soner yl DRM</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">sonery.medium.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op ks ob"/></div></div></a></div></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><p id="2c95" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>