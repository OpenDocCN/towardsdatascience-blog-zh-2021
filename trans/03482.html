<html>
<head>
<title>Creating a Custom R Package</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建自定义的R包</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-a-custom-r-package-9a2e303d3332?source=collection_archive---------12-----------------------#2021-03-20">https://towardsdatascience.com/creating-a-custom-r-package-9a2e303d3332?source=collection_archive---------12-----------------------#2021-03-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b771" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">为所有用户定义的函数创建一个中心位置。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/e7feb63a0acbba40bf7f3eb959339b39.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*KvngifMhJZYtVKOwPsLmjA.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><p id="2138" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我不知道你怎么想，但是我发现R用来排序数据帧的方法非常不直观。每当我想对一个数据帧进行排序时，我都不得不绞尽脑汁，通常是通过在网上查找别人是如何做到的，然后复制并修改他们的代码。最后，我决定创建一个易于使用的函数，它可以为我排序数据帧。这是我想到的函数的最新版本:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="e1ff" class="ls lt iq lo b gy lu lv l lw lx">sortby &lt;- function(df, col, desc = FALSE) {</span><span id="bd25" class="ls lt iq lo b gy ly lv l lw lx">    #### df is the dataframe to be sorted<br/>    #### col is the variable by which it should be sorted<br/>    #### desc indicates whether the sort order should be descending<br/>    #### str2expression() allows us to dynamically create a df$col<br/>    ####     variable which gets evaluated by eval()<br/>    df[order(<br/>            eval(<br/>                str2expression(paste0("df$", col))<br/>             ), <br/>            decreasing = desc<br/>        ),]<br/>}</span></pre><p id="6c15" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我当时的问题是，当我想使用这个功能时，如何找到它。答案是创建我自己的包。现在，有很多关于如何创建R包的教程，但是它们都缺少一些东西。有些是不完整的或分成多页。有些令人困惑。有些已经过时了。本文的目的是从头到尾详细介绍我结合许多教程得出的过程。</p><p id="5abd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，我应该提到我在所有的R编程中都使用RStudio。我的一个要求是，它必须在那个环境中是可行的。虽然没有任何教程实际上排除了RStudio的使用，但许多教程完全忽略了它。</p><p id="227b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在R中创建可用包的过程有几个部分:</p><ul class=""><li id="86cc" class="lz ma iq kt b ku kv kx ky la mb le mc li md lm me mf mg mh bi translated">编写要包含在包中的函数。</li><li id="d92d" class="lz ma iq kt b ku mi kx mj la mk le ml li mm lm me mf mg mh bi translated">为包中的功能创建文档。</li><li id="fd06" class="lz ma iq kt b ku mi kx mj la mk le ml li mm lm me mf mg mh bi translated">构建包。</li><li id="0876" class="lz ma iq kt b ku mi kx mj la mk le ml li mm lm me mf mg mh bi translated">(可选，不在此讨论)发布包。</li></ul><p id="0bba" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我的sortby()函数已经涵盖了第一步。我将这个函数存储在一个名为sortby.R的脚本中。</p></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><p id="b5d8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我们继续之前，我们需要做一些设置。要在Windows中创建R包，需要安装RTools 4.0。这是作为一个普通的Windows程序安装的，而不是作为r中的一个包。你可以在<a class="ae mu" href="https://cran.r-project.org/bin/windows/Rtools/" rel="noopener ugc nofollow" target="_blank">https://cran.r-project.org/bin/windows/Rtools/</a>找到安装程序。我应该说，我在尝试让RTools工作时遇到了问题。安装进行得很顺利，但是安装出错了。当我创建。Renviron文件编辑路径，我无法再安装软件包。我尝试了一些事情，包括重置窗口。经过大量的研究，我发现有人提到在试图安装包之前以管理员身份运行R。这似乎解决了所有问题，我不再需要以管理员身份运行了。</p></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><p id="96ac" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦RTools设置好了，您就可以着手创建这个包了。在RStudio中，选择文件&gt;新建项目&gt;新建目录&gt; R包。在弹出的对话框中，给包起一个名字，并输入你希望包驻留的目录。如果您已经像我一样创建了R脚本，那么您可以将它添加到“基于源文件创建包:”下的框中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/5fc7e55a1e97663d707a6d9cb97d6741.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*5XxR2R0IOhccNxnBAkoxEA.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者截图</p></figure><p id="bf84" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后点击<create project="">。</create></p><p id="54f0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此时，您应该在某处看到一个“Build”选项卡。我把它放在左下方我的“历史”标签旁边。(我相信默认是在右上角窗口。)选择“Build”选项卡，然后单击“Install and Restart”来安装您的软件包。一旦你这样做了，这个包应该出现在你的“包”标签中，如下所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/b09ea54d8fac33fe7ee8a0a0e02ddc37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*623EtgfV1geLTnxKXkOhYg.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者截图</p></figure><p id="7e93" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意，包的描述仍然写着“包做什么(标题格)”。我们稍后会解决这个问题。接下来，查看“文件”选项卡。您将看到RStudio为您的项目创建的一系列文件和目录。脚本文件将位于“R”目录中，而帮助文件将位于“man”目录中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/4135a80d36836dc8053f0ebd66505e3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*R2ykh7bc7k3Ssxjxt82P8A.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者截图</p></figure><p id="71ac" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要解决上述描述问题，请打开描述文件。这个必需的文件存储关于包的元数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/1f488bf14d0d2e0df93eb1b8e32c10b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*bJVD_o5-hZijCwSdHmLdpA.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者截图，显示默认描述文件</p></figure><p id="4289" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，让我们只改变显而易见的东西。如果你的包有任何依赖项(比如dplyr等等。)，它应该包含在这个文件中，但不是默认设置的一部分。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/c01576c94ac8dca23c0c9c35f60f50b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*77hcnsgsLt9swts2IPQbuA.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者截图</p></figure><p id="1a6c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我已经编辑了标题、作者和描述行，并删除了维护行。请注意，标题行变成了右下方窗口中软件包列表中的描述。</p></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><h2 id="9d5d" class="ls lt iq bd mx my mz dn na nb nc dp nd la ne nf ng le nh ni nj li nk nl nm nn bi translated"><strong class="ak">帮助文件</strong></h2><p id="24de" class="pw-post-body-paragraph kr ks iq kt b ku no jr kw kx np ju kz la nq lc ld le nr lg lh li ns lk ll lm ij bi translated">创建帮助文件最简单的方法是使用roxygen2包。</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="04a8" class="ls lt iq lo b gy lu lv l lw lx">install.packages("roxygen2")<br/>library(roxygen2)</span></pre><p id="6f97" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，我们转到R脚本，在开头添加一些roxygen注释。每个oxygen注释行都以# '开头。您应该添加几个项目:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="72ea" class="ls lt iq lo b gy lu lv l lw lx">#' @title <br/>#' @description<br/>#' @param<br/>#' @return<br/>#' @example<br/>#' @examples</span></pre><ul class=""><li id="e8a8" class="lz ma iq kt b ku kv kx ky la mb le mc li md lm me mf mg mh bi translated">标题—用于向帮助页面添加标题(使用标题大小写)</li><li id="2ab5" class="lz ma iq kt b ku mi kx mj la mk le ml li mm lm me mf mg mh bi translated">描述—用于添加简短描述</li><li id="29f5" class="lz ma iq kt b ku mi kx mj la mk le ml li mm lm me mf mg mh bi translated">Param为函数中的每个参数添加其中一行</li><li id="3311" class="lz ma iq kt b ku mi kx mj la mk le ml li mm lm me mf mg mh bi translated">return——函数会给你什么</li><li id="8298" class="lz ma iq kt b ku mi kx mj la mk le ml li mm lm me mf mg mh bi translated">示例-添加一行或多行示例。如果你要添加一行以上的例子，用复数。在完成之前仔细检查这些例子，确保在你没注意的时候没有错误。</li></ul><p id="5fce" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">添加完roxygen注释后，运行以下命令:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="f684" class="ls lt iq lo b gy lu lv l lw lx">roxygenize()</span></pre><p id="7dff" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">(和往常一样，R允许命令的美式英语或英式英语版本，所以roxygenise()也能很好地工作。)</p><p id="c907" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此命令创建。man文件夹中的Rd文件。的。RD文件是用来创建实际的帮助文件的。我最终的R脚本和生成的帮助文件如下所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/59e1095f8c76a3147d143fc73d49cdb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*aIBwTIbUA_sizU-WBFyU1Q.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者截图</p></figure></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><h2 id="b965" class="ls lt iq bd mx my mz dn na nb nc dp nd la ne nf ng le nh ni nj li nk nl nm nn bi translated"><strong class="ak">结论</strong></h2><p id="869a" class="pw-post-body-paragraph kr ks iq kt b ku no jr kw kx np ju kz la nq lc ld le nr lg lh li ns lk ll lm ij bi translated">这就是创建R包的基础。您可以做更多的微调，尤其是如果您想要发布您的包。想了解更多关于软件包创建的信息，请在https://r-pkgs.org/<a class="ae mu" href="https://r-pkgs.org/" rel="noopener ugc nofollow" target="_blank">查看哈德利·威克姆的书<em class="nt"> R软件包</em>。</a></p></div></div>    
</body>
</html>