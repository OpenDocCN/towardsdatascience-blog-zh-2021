<html>
<head>
<title>Geopandas Hands-on: Geospatial Relations and Operations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Geopandas实践:地理空间关系和操作</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/geopandas-hands-on-geospatial-relations-and-operations-a6e7047d7ba1?source=collection_archive---------37-----------------------#2021-04-26">https://towardsdatascience.com/geopandas-hands-on-geospatial-relations-and-operations-a6e7047d7ba1?source=collection_archive---------37-----------------------#2021-04-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="39cf" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于如何处理地理空间机器学习的教程</h2></div><p id="0bf5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第1部分:地理空间概念介绍(<a class="ae le" rel="noopener" target="_blank" href="/geopandas-hands-on-introduction-to-geospatial-machine-learning-6e7e4a539daf"> <em class="lf">跟随此处</em> </a> ) <br/>第2部分:地理空间可视化和几何创建(<a class="ae le" rel="noopener" target="_blank" href="/geopandas-hands-on-geospatial-data-visualization-and-intro-to-geometry-7f2ed9df52ab"> <em class="lf">跟随此处</em> </a> ) <br/>第3部分:地理空间操作(<em class="lf">本帖</em> ) <br/>第4部分:构建地理空间机器学习管道(<a class="ae le" rel="noopener" target="_blank" href="/geopandas-hands-on-building-geospatial-machine-learning-pipeline-9ea8ae276a15"> <em class="lf">跟随此处</em> </a>)</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/116955dfc2ddf4a10e061142d5360a5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*w4qrnWG09yU-6234"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated"><a class="ae le" href="https://unsplash.com/@marjan_blan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Marjan Blan | @marjanblan </a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="8102" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在前两篇文章中，我们讨论了geopandas的基础知识以及如何可视化地理空间数据集。这里，我们将介绍地理空间操作的基本概念，包括关系和空间连接。</p><h1 id="f07d" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">目录:</h1><ol class=""><li id="c363" class="mo mp it kk b kl mq ko mr kr ms kv mt kz mu ld mv mw mx my bi translated">概述</li><li id="6875" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">地理空间关系</li><li id="dd06" class="mo mp it kk b kl mz ko na kr nb kv nc kz nd ld mv mw mx my bi translated">空间连接</li></ol><h1 id="4978" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">概述</h1><p id="1f9d" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">在我们继续本教程之前，请确保我们恢复了之前帖子的地理数据框。</p><pre class="lh li lj lk gt nh ni nj nk aw nl bi"><span id="272b" class="nm lx it ni b gy nn no l np nq"># Import the necessary libraries<br/>import geopandas<br/>import shapely.geometry<br/>import matplotlib.pyplot as plt</span><span id="e9b0" class="nm lx it ni b gy nr no l np nq"># Initialize our geodataframe (gdf)<br/>path_to_data = gpd.datasets.get_path("nybb")<br/>gdf = gpd.read_file(path_to_data)</span><span id="3ced" class="nm lx it ni b gy nr no l np nq"># Set borough name as index<br/>gdf = gdf.set_index("BoroName")</span><span id="617c" class="nm lx it ni b gy nr no l np nq"># Get buffered region and centroid points<br/>gdf["buffered"] = gdf.buffer(10000)<br/>gdf['centroid'] = gdf.centroid</span></pre><p id="f780" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">既然初步步骤已经定下来了，那就从教程开始吧。</p><h1 id="c81c" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">地理空间关系</h1><p id="8ada" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">几何图形(如定义单个区的多边形或表示区域或点之间的边界以指示质心位置的线)可以彼此相关。</p><h2 id="21b0" class="nm lx it bd ly ns nt dn mc nu nv dp mg kr nw nx mi kv ny nz mk kz oa ob mm oc bi translated">A.交叉</h2><p id="781a" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">假设我们提出以下问题:缓冲区是否与纽约的布鲁克林区相交？</p><p id="957d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先我们得到布鲁克林的多边形</p><pre class="lh li lj lk gt nh ni nj nk aw nl bi"><span id="9e94" class="nm lx it ni b gy nn no l np nq">brooklyn = gdf.loc["Brooklyn", "geometry"]</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi od"><img src="../Images/4be15427225fdddca0184503d095127c.png" data-original-src="https://miro.medium.com/v2/resize:fit:614/format:webp/1*wRGNjpqgKfEHDKI-RlXdzw.png"/></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">布鲁克林区</p></figure><p id="2fe9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们可以检查缓冲区域是否与它相交。</p><pre class="lh li lj lk gt nh ni nj nk aw nl bi"><span id="5a90" class="nm lx it ni b gy nn no l np nq">gdf["buffered"].intersects(brooklyn)</span><span id="2550" class="nm lx it ni b gy nr no l np nq">&gt;&gt;BoroName<br/>&gt;&gt;Staten Island     True<br/>&gt;&gt;Queens            True<br/>&gt;&gt;Brooklyn          True<br/>&gt;&gt;Manhattan         True<br/>&gt;&gt;Bronx            False<br/>&gt;&gt;dtype: bool</span></pre><p id="881b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">布朗克斯似乎离布鲁克林很远，边界外10，000英尺的缓冲区根本不与布鲁克林相交。</p><h2 id="c11a" class="nm lx it bd ly ns nt dn mc nu nv dp mg kr nw nx mi kv ny nz mk kz oa ob mm oc bi translated">B.在…之内</h2><p id="f86f" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">另一个问题可能类似地出现:形心是否包含在它们各自的区(即。唯一的质心)？这可以通过指定点的集合是否包含在所述多边形中的内关系来执行。</p><pre class="lh li lj lk gt nh ni nj nk aw nl bi"><span id="3de8" class="nm lx it ni b gy nn no l np nq">gdf["centroid"].within(brooklyn)</span><span id="bca8" class="nm lx it ni b gy nr no l np nq">&gt;&gt;BoroName<br/>&gt;&gt;Staten Island    False<br/>&gt;&gt;Queens           False<br/>&gt;&gt;Brooklyn          True<br/>&gt;&gt;Manhattan        False<br/>&gt;&gt;Bronx            False<br/>&gt;&gt;dtype: bool</span></pre><p id="46e9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不出所料，布鲁克林的质心位于布鲁克林多边形内，而不在其他区域内。</p><h1 id="33e4" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">空间连接</h1><p id="e7b7" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">我们可以使用geopandas执行的另一个重要的地理空间操作是空间连接。顾名思义，它允许两个不同的几何图形基于特定的几何标准进行连接。</p><p id="0f51" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们假设在这个区域内有几个公共汽车站，我们想要识别每个车站所在的行政区。</p><pre class="lh li lj lk gt nh ni nj nk aw nl bi"><span id="c696" class="nm lx it ni b gy nn no l np nq"># Generate some points<br/>b = [int(x) for x in gdf.total_bounds]<br/>N = 6</span><span id="7ddc" class="nm lx it ni b gy nr no l np nq">pointdf = gpd.GeoDataFrame([<br/>    {'geometry': shapely.geometry.Point(x, y), 'value1': x + y, 'value2': x - y}<br/>    for x, y in zip(range(b[0], b[2], int((b[2] - b[0]) / N)),<br/>                    range(b[1], b[3], int((b[3] - b[1]) / N)))])</span><span id="709f" class="nm lx it ni b gy nr no l np nq"># Make sure they're using the same projection reference<br/>pointdf.crs = gdf.crs</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/d131cb018802395cfa1e2af6f82e2e39.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/format:webp/1*eEWNQvb_QlnZi5RASpv0RQ.png"/></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">随机生成的公交车站</p></figure><p id="4003" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">想到的第一个解决方案是像以前一样执行一个within操作，然后对于每个区，将真正的索引值分配给该点(例如，如果汽车站1在布鲁克林，则将布鲁克林分配给该点项目)。从视觉上看，它可以表示为:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi of"><img src="../Images/a87ecaf88b2b887451bb64f3310d7602.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*jCuyPhzV0NfAslYaZKie-w.png"/></div></figure><p id="b93a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，可以按如下方式执行空间连接:</p><pre class="lh li lj lk gt nh ni nj nk aw nl bi"><span id="e0d6" class="nm lx it ni b gy nn no l np nq">from geopandas.tools import sjoin</span><span id="c706" class="nm lx it ni b gy nr no l np nq"># Joining the NYC borough INTO the pointdf<br/>sjoin(pointdf, gdf, how="left", op="intersects")</span><span id="996e" class="nm lx it ni b gy nr no l np nq"># The NaNs are the points that do not intersect with any borough</span></pre><p id="7de9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">或者，如果您想删除nan，可以执行一个<em class="lf">内部连接</em>来代替。</p><pre class="lh li lj lk gt nh ni nj nk aw nl bi"><span id="2752" class="nm lx it ni b gy nn no l np nq">sjoin(pointdf, gdf, how="inner", op="intersects")</span></pre><h1 id="f379" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">结论</h1><p id="1a53" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">就是这样！希望你今天能学到新东西。在下一篇文章中，我们将最终准备好建立我们的第一个地理空间机器学习管道。敬请期待！</p></div><div class="ab cl og oh hx oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="im in io ip iq"><p id="221f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> <em class="lf">做订阅我的邮件简讯:</em></strong><a class="ae le" href="https://tinyurl.com/2npw2fnz" rel="noopener ugc nofollow" target="_blank"><em class="lf">【https://tinyurl.com/2npw2fnz】</em></a><em class="lf"/><strong class="kk iu"><em class="lf">在这里我定期用通俗易懂的语言和漂亮的可视化总结AI研究论文。</em>T15】</strong></p></div></div>    
</body>
</html>