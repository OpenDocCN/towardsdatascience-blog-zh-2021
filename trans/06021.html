<html>
<head>
<title>Bayesian A/B Testing in PyMC3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PyMC3中的贝叶斯A/B测试</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/bayesian-a-b-testing-in-pymc3-54dceb87af74?source=collection_archive---------5-----------------------#2021-05-30">https://towardsdatascience.com/bayesian-a-b-testing-in-pymc3-54dceb87af74?source=collection_archive---------5-----------------------#2021-05-30</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><h2 id="76f8" class="is it iu bd b dl iv iw ix iy iz ja dk jb translated" aria-label="kicker paragraph"><a class="ae ep" href="https://medium.com/tag/bayesian-statistics" rel="noopener">贝叶斯统计</a></h2><div class=""/><div class=""><h2 id="8517" class="pw-subtitle-paragraph ka jd iu bd b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dk translated">抛弃p值，拥抱更直观的概率</h2></div><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ks"><img src="../Images/1ec847ad4abd56bb2fa00c10543ea094.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Q0RF05VrMa3zPNUu"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">由<a class="ae li" href="https://unsplash.com/@opticalnomad?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> OpticalNomad </a>在<a class="ae li" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="3103" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">有时，你不得不在两个选项中做出选择。这可能是在完全不知情的情况下，你只有50%的可能性做出更好的选择。在一些不知情的情况下，你甚至可以用一个简单的技巧来提高这个概率，正如我在另一篇文章中所展示的。</p><p id="af85" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">然而，通常情况下，你能够<strong class="ll je">收集一些信息</strong>帮助你选择更好的选项。一个简单而聪明的方法是<em class="mf"> A/B测试</em>，你可能已经听说过或者已经使用过了。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj mg"><img src="../Images/b27702e7e084ac01945dbbda4eab6534.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tl02VI9d8yvIA7o-grtcMw.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">两个实验的结果。是A还是B产生的价值更高？你对此有多确定？图片由作者提供。</p></figure><p id="39cf" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">在本文中，我将简要解释A/B测试背后的动机，并概述其背后的逻辑。这种方法的问题在于它使用了容易被误解的p值。</p><p id="e37c" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">因此，我们将花时间用少许<em class="mf">贝叶斯</em>魔法来改进这种方法，产生<strong class="ll je">贝叶斯A/B测试</strong>。最重要的是，我们将使用Python中出色的PyMC3库实现一个简单的贝叶斯A/B测试。</p></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><blockquote class="mo mp mq"><p id="7c64" class="lj lk mf ll b lm ln ke lo lp lq kh lr mr lt lu lv ms lx ly lz mt mb mc md me in bi translated">如果您不完全确定什么是贝叶斯统计，或者您以前从未使用过PyMC3，请查看我关于这个主题的入门级文章:</p></blockquote><div class="mu mv gq gs mw mx"><a rel="noopener follow" target="_blank" href="/a-gentle-introduction-to-bayesian-inference-6a7552e313cb"><div class="my ab fp"><div class="mz ab na cl cj nb"><h2 class="bd je gz z fq nc fs ft nd fv fx jd bi translated">贝叶斯推理的简明介绍</h2><div class="ne l"><h3 class="bd b gz z fq nc fs ft nd fv fx dk translated">了解频率主义者和贝叶斯推理方法之间的区别</h3></div><div class="nf l"><p class="bd b dl z fq nc fs ft nd fv fx dk translated">towardsdatascience.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl lc mx"/></div></div></a></div><div class="mu mv gq gs mw mx"><a rel="noopener follow" target="_blank" href="/conducting-bayesian-inference-in-python-using-pymc3-d407f8d934a5"><div class="my ab fp"><div class="mz ab na cl cj nb"><h2 class="bd je gz z fq nc fs ft nd fv fx jd bi translated">使用PyMC3在Python中进行贝叶斯推理</h2><div class="ne l"><h3 class="bd b gz z fq nc fs ft nd fv fx dk translated">重温硬币的例子，并使用PyMC3计算解决它。</h3></div><div class="nf l"><p class="bd b dl z fq nc fs ft nd fv fx dk translated">towardsdatascience.com</p></div></div><div class="ng l"><div class="nm l ni nj nk ng nl lc mx"/></div></div></a></div></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><h1 id="a931" class="nn no iu bd np nq nr ns nt nu nv nw nx kj ny kk nz km oa kn ob kp oc kq od oe bi translated">A/B测试动机</h1><p id="c820" class="pw-post-body-paragraph lj lk iu ll b lm of ke lo lp og kh lr ls oh lu lv lw oi ly lz ma oj mc md me in bi translated">假设您经营着一家相当成功的在线商店，每天有大约10，000名访问者。这10000人中大约有100人实际上在你的店里买了东西——你所谓的<em class="mf">转化率</em>大约是100/10000 = 1%，相当小。</p><blockquote class="mo mp mq"><p id="7de0" class="lj lk mf ll b lm ln ke lo lp lq kh lr mr lt lu lv ms lx ly lz mt mb mc md me in bi translated">大多数网上商店的转化率在1-3%左右，亚马逊甚至超过10%。</p></blockquote><p id="b448" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">因为无论如何都会有很多人光顾你的店铺，但只有很少一部分人成为顾客，所以你决定提高你的店铺的转化率，因为这是提高收入的最大杠杆。你认为:</p><blockquote class="ok"><p id="6595" class="ol om iu bd on oo op oq or os ot me dk translated">是什么让人们不买我的好产品？</p></blockquote></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><p id="4810" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">你想不出一个好的解释，所以你向一些朋友寻求灵感。他们告诉你，他们不喜欢你购买按钮的蓝色。也许红色会更吸引人？这是你可以测试的东西！</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div class="gi gj ou"><img src="../Images/fb0f2418ca80cbad392512f052675417.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*Re0wFFMI0Nd2mfDLlWTYSA.png"/></div><p class="le lf gk gi gj lg lh bd b be z dk translated">让战斗开始吧！图片由作者提供。</p></figure><p id="fee1" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">方法如下:</p><blockquote class="ok"><p id="47d1" class="ol om iu bd on oo op oq or os ot me dk translated">以50%的概率随机将新访客分配到蓝队或红队。蓝队的人会看到蓝色按钮，红队会看到红色按钮。在运行这个过程一段时间后，您检查哪个团队实现了更高的转化率。</p></blockquote><blockquote class="mo mp mq"><p id="fd6b" class="lj lk mf ll b lm ov ke lo lp ow kh lr mr ox lu lv ms oy ly lz mt oz mc md me in bi translated"><em class="iu">术语:</em>你称蓝队<strong class="ll je">对照组</strong>，红队<strong class="ll je">治疗组或试验组</strong>。对照组给你一个指示，如果你让一切保持原样会发生什么，治疗组告诉你如果你做某种干预会发生什么，比如改变按钮的颜色。</p></blockquote><p id="9721" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">请注意，如果您想轻松评估实验，这种随机化很重要。你应该<strong class="ll je">而不是</strong>做的事情包括:</p><ul class=""><li id="f26c" class="pa pb iu ll b lm ln lp lq ls pc lw pd ma pe me pf pg ph pi bi translated"><strong class="ll je">将所有男性分配到红色团队，将所有女性分配到蓝色团队</strong>，因为即使一个团队的转化率高得多，你也无法知道这是因为按钮的颜色还是仅仅因为性别。</li><li id="633d" class="pa pb iu ll b lm pj lp pk ls pl lw pm ma pn me pf pg ph pi bi translated"><strong class="ll je">本周将每个人分配到红色团队，下周分配到蓝色团队</strong>，因为即使一个团队的转换率很高，你也无法知道这是因为按钮的颜色，还是因为人们在一周内购买了更多的东西，而不考虑颜色。也许其中一周包括像黑色星期五或圣诞节这样的节日，或者其他更微妙的季节模式。</li><li id="58d4" class="pa pb iu ll b lm pj lp pk ls pl lw pm ma pn me pf pg ph pi bi">…</li></ul><p id="cf4f" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">你明白了。为了提取<strong class="ll je">按钮颜色效果</strong> <em class="mf">，</em>应该没有其他<strong class="ll je">混淆</strong>效果可以解释两个团队的不同转换率。</p><h1 id="8995" class="nn no iu bd np nq po ns nt nu pp nw nx kj pq kk nz km pr kn ob kp ps kq od oe bi translated">准备A/B测试</h1><p id="3dd8" class="pw-post-body-paragraph lj lk iu ll b lm of ke lo lp og kh lr ls oh lu lv lw oi ly lz ma oj mc md me in bi translated">让我们假设您为您的A/B测试进行了一天的适当的数据收集，并最终获得了一些数据。你有10，000名访客，你将他们随机分为蓝队(对照组)和红队(治疗组)。你记下这位游客是否买了东西(编码为<strong class="ll je"> 1 </strong>)或没有买(编码为<strong class="ll je"> 0 </strong>)。</p><p id="94b0" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">我们使用以下代码模拟结果:</p><pre class="kt ku kv kw gu pt pu pv bn pw px bi"><span id="75e3" class="py no iu pu b be pz qa l qb qc">import numpy as np<br/><br/>np.random.seed(0)<br/><br/>blue_conversions = np.random.binomial(1, 0.01, size=4800)<br/>red_conversions = np.random.binomial(1, 0.012, size=5200)</span></pre><p id="c6b2" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">你可以看到我把1%作为对照组转化率，1.2%作为治疗组转化率。<strong class="ll je">所以你已经知道，如果采样没有做什么奇怪的事情，红色按钮应该表现得更好</strong>！但让我们从现在开始假装我们不知道这些数据是如何产生的，因为这是我们在现实中经常面临的问题。</p><blockquote class="mo mp mq"><p id="7088" class="lj lk mf ll b lm ln ke lo lp lq kh lr mr lt lu lv ms lx ly lz mt mb mc md me in bi translated">另外，请注意，这些组有不同的大小，这通常是随机分配的结果。他们在10000/2 = 5000左右，但不太可能得到如此完美的50:50分成。然而，这很好。</p></blockquote><p id="bd86" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">两个NumPy数组都由1和0组成，大多数条目都是0。</p><pre class="kt ku kv kw gu pt pu pv bn pw px bi"><span id="6e28" class="py no iu pu b be pz qa l qb qc">print(blue_conversions)<br/># output: [0 0 0 ... 0 0 0]</span></pre><pre class="qd pt pu pv bn pw px bi"><span id="67b8" class="py no iu pu b be pz qa l qb qc">print(red_conversions)<br/># output: [0 0 0 ... 0 0 0]</span></pre><p id="8d5a" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">接下来，我们可以检查的是one(即购买了某些东西的访问者)的份额。</p><pre class="kt ku kv kw gu pt pu pv bn pw px bi"><span id="c9a8" class="py no iu pu b be pz qa l qb qc">print(f'Blue: {blue_conversions.mean():.3%}')<br/>print(f'Red: {red_conversions.mean():.3%}')<br/># output: Blue: 0.854%, Red: 1.135%</span></pre><p id="6f12" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">这表明红色按钮的性能可能会更好，但我们现在还不能确定。即使不同组之间的转化率完全相同，一组最终的转化率也很可能比另一组高。</p><p id="4ca2" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">我们仍然必须排除这仅仅是由于偶然而发生的，这正是A/B测试的目的。</p><h1 id="e4fa" class="nn no iu bd np nq po ns nt nu pp nw nx kj pq kk nz km pr kn ob kp ps kq od oe bi translated">进行A/B测试</h1><p id="e855" class="pw-post-body-paragraph lj lk iu ll b lm of ke lo lp og kh lr ls oh lu lv lw oi ly lz ma oj mc md me in bi translated">现在让我们看看我们如何能对正在发生的事情提出一个更好的解释。蓝色按钮好还是红色按钮好？首先，我们将再现传统的方式，然后，我们将做贝叶斯风格。</p><h2 id="13cc" class="qe no iu bd np qf qg dn nt qh qi dp nx ls qj qk nz lw ql qm ob ma qn qo od ja bi translated">传统的方式</h2><p id="b740" class="pw-post-body-paragraph lj lk iu ll b lm of ke lo lp og kh lr ls oh lu lv lw oi ly lz ma oj mc md me in bi translated">我不会在这里深入探讨，因为有大量的资源可以完美地解释如何进行一个普通的A/B测试。你想知道以下两个假设哪个是正确的:</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj qp"><img src="../Images/d42aa9d64a3ddfe20388d9159dd99137.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ddki7kUSoKfuU4lFdcXfJA.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">图片由作者提供。</p></figure><p id="1ef5" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">基本上，你计算某种测试统计，例如在费希尔精确测试或T2韦尔奇的t-测试中。然后计算一个p值，并检查它是否在某个任意范围内，比如5%。让我们来看看<strong class="ll je">韦尔奇的</strong> <strong class="ll je"> t测试</strong>。</p><pre class="kt ku kv kw gu pt pu pv bn pw px bi"><span id="5ed0" class="py no iu pu b be pz qa l qb qc">from scipy.stats import ttest_ind<br/><br/>print(f'p-value: {ttest_ind(blue_conversions, red_conversions, equal_var=False, alternative="less").pvalue:.1%}')<br/># output: p-value: 7.8%</span></pre><p id="ef2b" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">因为有些人纠结于p值，你可以这样解读:</p><blockquote class="ok"><p id="94f6" class="ol om iu bd on oo op oq or os ot me dk translated">假设₀是真实的，我们得到我们观察到的或者更极端的结果的几率最多是7.8%。</p></blockquote><p id="3cae" class="pw-post-body-paragraph lj lk iu ll b lm ov ke lo lp ow kh lr ls ox lu lv lw oy ly lz ma oz mc md me in bi translated">由于7.8% &gt; 5%，我们保持原假设。没有证据表明红色按钮明显比蓝色按钮好，所以我们只保留蓝色按钮。</p></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><p id="0185" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">我认为p值的定义相当不直观——每个曲解过p值的人都证明了这一点。最常见的<strong class="ll je">误解</strong>如下:</p><blockquote class="ok"><p id="285d" class="ol om iu bd on oo op oq or os ot me dk translated">蓝色更好的概率是7.8%。(错！！！)</p></blockquote><p id="56bf" class="pw-post-body-paragraph lj lk iu ll b lm ov ke lo lp ow kh lr ls ox lu lv lw oy ly lz ma oz mc md me in bi translated">虽然这是p值告诉你的<strong class="ll je">而不是</strong>，但是能够表达出这样一个清晰而简短的陈述是可取的，不是吗？好吧，那么，贝氏拯救。</p><h2 id="53a3" class="qe no iu bd np qf qg dn nt qh qi dp nx ls qj qk nz lw ql qm ob ma qn qo od ja bi translated">贝叶斯方法</h2><p id="b94e" class="pw-post-body-paragraph lj lk iu ll b lm of ke lo lp og kh lr ls oh lu lv lw oi ly lz ma oj mc md me in bi translated">贝叶斯A/B测试有以下优点:</p><ol class=""><li id="e5e6" class="pa pb iu ll b lm ln lp lq ls pc lw pd ma pe me qr pg ph pi bi translated">它使您能够以一定的概率做出一个版本比另一个版本更好的陈述。正是我们想要的。</li><li id="7fa5" class="pa pb iu ll b lm pj lp pk ls pl lw pm ma pn me qr pg ph pi bi translated">你不需要知道所有的统计测试。您只需构建一个合适的生成模型，然后按下贝叶斯推理按钮。</li></ol><blockquote class="mo mp mq"><p id="0e4b" class="lj lk mf ll b lm ln ke lo lp lq kh lr mr lt lu lv ms lx ly lz mt mb mc md me in bi translated">我假设你现在已经有一些关于使用PyMC3的先验知识，否则，检查我上面的链接文章。</p></blockquote><p id="d2d3" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">为了更清楚地说明这些优点，让我们借助PyMC3用贝叶斯方法来分析我们的问题。首先，我们需要考虑要推断哪些参数。这很容易，有两个未知参数:</p><ul class=""><li id="f2fb" class="pa pb iu ll b lm ln lp lq ls pc lw pd ma pe me pf pg ph pi bi translated">蓝色按钮的转换率</li><li id="e6f9" class="pa pb iu ll b lm pj lp pk ls pl lw pm ma pn me pf pg ph pi bi translated">红色按钮的转换率。</li></ul><p id="61ad" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">我们现在需要决定两个参数的先验分布。由于转换率可以在0到1之间，所以<a class="ae li" href="https://en.wikipedia.org/wiki/Beta_distribution" rel="noopener ugc nofollow" target="_blank">贝塔分布</a>是有意义的。Beta分布有两个参数<em class="mf"> a </em>和<em class="mf"> b，</em>，你可以通过改变它们来创建不同的分布。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj qs"><img src="../Images/026c57f7cb48415d0c6a03b9727d44ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S1gncwDig04Hjzw9aLJpRQ.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">图片由作者提供。</p></figure><p id="9c53" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">因为我们知道转换率相当小，例如，两者的良好先验都是β(1，99)。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj qt"><img src="../Images/16869ed9bd1b09d0c3fd777bf0b92ced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qJRMxho3ndEWydHl5_XAvA.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">图片由作者提供。</p></figure><p id="db23" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">现在，我们必须模拟我们观察到的结果(包含0和1的数组)是如何与这些参数联系起来的。最直接的方法是使用<a class="ae li" href="https://en.wikipedia.org/wiki/Bernoulli_distribution" rel="noopener ugc nofollow" target="_blank">伯努利变量</a>，因为它们只能取值0和1，并使用单个概率参数。</p></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><p id="9bd3" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">长话短说，我们可以写下面的小程序:</p><pre class="kt ku kv kw gu pt pu pv bn pw px bi"><span id="c019" class="py no iu pu b be pz qa l qb qc">import pymc3 as pm<br/><br/>with pm.Model():<br/>    blue_rate = pm.Beta('blue_rate', 1, 99)<br/>    red_rate = pm.Beta('red_rate', 1, 99)<br/>    <br/>    blue_obs = pm.Bernoulli('blue_obs', blue_rate, observed=blue_conversions)<br/>    red_obs = pm.Bernoulli('red_obs', red_rate, observed=red_conversions)<br/>    <br/>    trace = pm.sample(return_inferencedata=True)</span></pre><p id="0f40" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">加上解释，这个程序应该对你有意义。在模型的前两行，我们定义了先验知识。之后，我们设计模型的输出(伯努利变量),并使用<code class="fe qu qv qw pu b">observed</code>参数额外给出来自A/B测试准备的观察结果。最后一行是著名的贝叶斯推理按钮的PyMC3版本。</p></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><p id="fca0" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">在<code class="fe qu qv qw pu b">trace</code>对象的帮助下，你可以重建转换率的后验分布。</p><pre class="kt ku kv kw gu pt pu pv bn pw px bi"><span id="4dc9" class="py no iu pu b be pz qa l qb qc">import arviz as az<br/><br/>az.plot_posterior(trace)</span></pre><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj qx"><img src="../Images/69825930362dfddb0a84148cb552c3ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DsbfrQCasY4J2xbji6r5lg.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">图片由作者提供。</p></figure><p id="faae" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">我们发现，蓝色的转化率约为0.854%，红色的转化率约为1.135%，这与我们的最大似然估计值非常接近，甚至还有一个可信的估计区间。比如蓝率在0.62%到1.1%之间，有94%的概率。</p><p id="ed0c" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">整洁，对不对？但这并没有回答我们的问题。红色按钮的转化率比蓝色按钮的转化率高的概率有多大？为了回答这个问题，我们可以对两个后验分布进行采样，看看红色比率高于蓝色比率的频率。幸运的是，样本已经存储在<code class="fe qu qv qw pu b">trace</code>对象中。我们只需了解红色速率样本比蓝色速率样本大的频率。</p><pre class="kt ku kv kw gu pt pu pv bn pw px bi"><span id="ef0b" class="py no iu pu b be pz qa l qb qc">blue_rate_samples = trace.posterior['blue_rate'].values<br/>red_rate_samples = trace.posterior['red_rate'].values<br/><br/>print(f'Probability that red is better: {(red_rate_samples &gt; blue_rate_samples).mean():.1%}.')<br/><br/># Output (for me):<br/># Probability that red is better: 91.7%.</span></pre><p id="c85c" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">这是我们可以合作的事情！这对我们来说很容易理解，但对其他所有人来说也很容易理解，我特别关注业务部门。红色按钮更好，概率在92%左右。</p><p id="1754" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated"><em class="mf">完美！</em>”，你想着和你店里的红版，希望它能提高你的转化率。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div class="gi gj qy"><img src="../Images/d1c0633f57900599da5c04cbc4077130.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/format:webp/1*-Gov0Zl5fhEG0IYCnTnJ0A.png"/></div><p class="le lf gk gi gj lg lh bd b be z dk translated">Uaaa，uaaa，uaaa。图片由作者提供。</p></figure><p id="30e8" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">现在想象一下:这只是一个微小的变化，却有可能增加你的销售额。可能有各种各样的或大或小的东西你可以修补，让你的商店更好。比赛刚刚开始。</p><h1 id="32ed" class="nn no iu bd np nq po ns nt nu pp nw nx kj pq kk nz km pr kn ob kp ps kq od oe bi translated">结论</h1><p id="107a" class="pw-post-body-paragraph lj lk iu ll b lm of ke lo lp og kh lr ls oh lu lv lw oi ly lz ma oj mc md me in bi translated">在许多情况下，我们不得不在两个选项中做出选择。这可以只是一个按钮的颜色，也可以是一个对象在网站上的位置，按钮或图像上的文本，或者任何可能被改变的东西。</p><p id="0bbe" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">在两个版本之间进行选择的一种方法是运行A/B测试。这个想法很简单:<strong class="ll je">你把你的顾客分成两组，唯一不同的是你想改变的东西</strong>，也就是一个按钮的颜色。这样你就可以确定只有你改变的事情导致了结果的改变，其他的都没有。不是人们的年龄或性别，也不是你收集数据的工作日。</p><p id="9403" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">通常，人们使用p值进行经典的A/B测试。虽然这对于统计学家来说是一个熟悉的概念，但普通人经常会对涉及p值的陈述感到困惑。这就是为什么我们转向贝叶斯A/B测试，它允许每个人都可以很容易地掌握结果。最后，我们甚至可以用PyMC3不用太多代码就能得出这样的结果。</p></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><p id="5d3e" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">我希望你今天学到了新的、有趣的、有用的东西。感谢阅读！</p><p id="2b50" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated"><strong class="ll je">作为最后一点，如果你</strong></p><ol class=""><li id="b1f3" class="pa pb iu ll b lm ln lp lq ls pc lw pd ma pe me qr pg ph pi bi translated"><strong class="ll je">想支持我多写点机器学习和</strong></li><li id="0612" class="pa pb iu ll b lm pj lp pk ls pl lw pm ma pn me qr pg ph pi bi translated"><strong class="ll je">无论如何都要计划获得中等订阅量，</strong></li></ol><p id="af23" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated"><strong class="ll je">为什么不通过此链接</strong><a class="ae li" href="https://dr-robert-kuebler.medium.com/membership" rel="noopener"><strong class="ll je"/></a><strong class="ll je">？这将对我帮助很大！😊</strong></p><p id="10d7" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated"><em class="mf">说白了，给你的价格不变，但大约一半的订阅费直接归我。</em></p><p id="d8e4" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">非常感谢，如果你考虑支持我的话！</p><blockquote class="ok"><p id="d1c7" class="ol om iu bd on oo op oq or os ot me dk translated"><em class="qq">有问题就在</em><a class="ae li" href="https://www.linkedin.com/in/dr-robert-k%C3%BCbler-983859150/" rel="noopener ugc nofollow" target="_blank"><em class="qq">LinkedIn</em></a><em class="qq">上写我！</em></p></blockquote></div></div>    
</body>
</html>