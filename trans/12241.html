<html>
<head>
<title>Unsupervised Anomaly Detection in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的无监督异常检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/unsupervised-anomaly-detection-in-python-f2e61be17c2b?source=collection_archive---------1-----------------------#2021-12-13">https://towardsdatascience.com/unsupervised-anomaly-detection-in-python-f2e61be17c2b?source=collection_archive---------1-----------------------#2021-12-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="071e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">初学者指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/728a3b5a23098f15495a838512d419ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aY9_EwKCTEpIxIpW"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@mullyadii?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Mulyadi </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="b5e4" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">什么是异常检测？</h1><p id="74d3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">异常检测也称为离群点检测，是在数据集中寻找与其他数据点不同的数据点的过程。异常检测的常见应用包括金融交易中的欺诈检测、故障检测和预测性维护。</p><p id="b233" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">广义地说，异常检测可以分为监督和非监督领域。监督异常检测需要带标签的数据集来指示记录是“正常”还是“异常”。无监督异常检测涉及未标记的数据集。它假设未标记数据集中的大多数数据点是“正常”的，并且它寻找不同于“正常”数据点的数据点。</p><p id="686d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在本文中，我们将使用Pycaret来检测异常。Pycaret是一个自动机器学习(AutoML)工具，可用于监督和非监督学习。</p><h1 id="039b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">无监督异常检测</h1><p id="941c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们从安装PyCaret开始。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="d01a" class="mx la it mt b gy my mz l na nb">pip install pycaret==2.3.5<br/>pip install scipy==1.4.1</span></pre><p id="ee30" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">导入必要的模块</strong></p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="aa3d" class="mx la it mt b gy my mz l na nb">from pycaret.anomaly import *<br/>from sklearn.datasets import load_breast_cancer</span></pre><p id="7b37" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">加载数据集</strong></p><p id="715a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们将使用来自UCI机器学习库[2]的威斯康星州乳腺癌(诊断)数据集[1],该数据集包含乳腺肿块细针抽吸的特征计算数字化图像以及肿块是良性(B)还是恶性(M)的诊断。该数据集通常用于演示受监督的机器学习，其中模型被训练来预测诊断。出于演示无监督异常检测的目的，我们将忽略诊断。</p><p id="ccf1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们将数据分成训练集，保留一小部分“看不见的”数据用于评分。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="70b4" class="mx la it mt b gy my mz l na nb">df = load_breast_cancer(as_frame=True)['data']<br/>df_train = df.iloc[:-10]<br/>df_unseen = df.tail(10)</span></pre><p id="ddd6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">设置Pycaret </strong></p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="ec55" class="mx la it mt b gy my mz l na nb">anom = setup(data = df_train, <br/>             silent = True)</span></pre><p id="76d0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当执行<code class="fe nc nd ne mt b">setup</code>时，将<code class="fe nc nd ne mt b">silent</code>参数设置为<code class="fe nc nd ne mt b">True</code>会自动确认数据类型的输入。如果<code class="fe nc nd ne mt b">silent</code>设置为<code class="fe nc nd ne mt b">False,</code>，Pycaret要求用户手动确认输入数据类型，如下图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/fa0c1a93b2ada9ec80b277f53bfef6ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ysVDNjv6OClMLECT"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="8b46" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果没有显式定义，Pycaret将推断数据类型。我们还可以使用<code class="fe nc nd ne mt b">categorical_features</code>、<code class="fe nc nd ne mt b">numeric_features</code>、<code class="fe nc nd ne mt b">ordinal_features</code>参数定义哪些列包含分类、数字、序数和日期特性。定义不同的数据类型将影响列的预处理方式。例如，<code class="fe nc nd ne mt b">categorical_imputation</code>参数决定了如何处理缺失的分类值。可用选项有<code class="fe nc nd ne mt b">constant</code>和<code class="fe nc nd ne mt b">mode</code>。类似地，对于数字特征，<code class="fe nc nd ne mt b">numeric_imputation</code>参数决定了如何处理丢失的数值。可用选项有<code class="fe nc nd ne mt b">mean</code>、<code class="fe nc nd ne mt b">median</code>或<code class="fe nc nd ne mt b">zero</code>。</p><p id="9c00" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">还有各种其他预处理选项，如归一化、降维甚至自定义转换。查看<a class="ae ky" href="https://pycaret.org/anomaly-detection/" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多详情。</p><p id="415a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">查看可用车型</strong></p><p id="d2da" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们看看Pycaret中有哪些异常检测模型。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="f5fd" class="mx la it mt b gy my mz l na nb">models()</span></pre><p id="8cc5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">reference列指示模型是从哪个源包构建的。PyOD (Python离群点检测)是一个提供各种离群点检测模型的包。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/dba4ac3e5c2d878bb8ce3571e9e661db.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/0*wFRsnfisQUwO3GAl"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="202c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">训练异常检测模型</strong></p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="7ccd" class="mx la it mt b gy my mz l na nb">anom_model = create_model(model = 'iforest', fraction = 0.05)</span></pre><p id="0e3e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们通过定义模型的ID来训练异常检测模型。<code class="fe nc nd ne mt b">fraction</code>参数指示数据集中存在的异常值的数量。默认值是<code class="fe nc nd ne mt b">0.05</code>，表示数据集有5%的异常值。</p><p id="0b50" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">对数据集评分</strong></p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="9f3b" class="mx la it mt b gy my mz l na nb">results = assign_model(anom_model)</span></pre><p id="68d9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe nc nd ne mt b">assign_model</code>使用训练好的模型对训练数据集进行评分，并返回模型的预测，与训练数据连接在一起。<code class="fe nc nd ne mt b">Anomaly</code>列为二进制，其中<code class="fe nc nd ne mt b">1</code>表示记录异常，<code class="fe nc nd ne mt b">0</code>表示记录正常。<code class="fe nc nd ne mt b">Anomaly_Score</code>列给出了记录的原始分数，负值表示记录正常。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/23e32f3244b2a0fd38cc63299f0d04e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*P3TR0qXESclnRlW4"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a68d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">剧情模式</strong></p><p id="3d61" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe nc nd ne mt b">plot_model</code>功能有助于使用TSNE或UMAP可视化高维数据。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="55b1" class="mx la it mt b gy my mz l na nb">plot_model(anom_model, plot = 'tsne')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/a318a105d6d0ed8611f6800d77fb24d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*N9d0gez0g1LLGwLG"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者Gif</p></figure><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="7cf6" class="mx la it mt b gy my mz l na nb">plot_model(anom_model, plot = 'umap')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/fd939c7690901e71f0b24dc6c818286b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*t7jIl7klYt1x0QC3"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="c01f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">保存模型</strong></p><p id="bf6e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe nc nd ne mt b">save_model</code>将转换管道和训练好的模型保存为pickle文件。pickle文件包含一个scikit-learn管道对象。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="6cca" class="mx la it mt b gy my mz l na nb">save_model(model = anom_model, model_name = 'iforest_model')</span></pre><p id="fc6f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">加载模型</strong></p><p id="13ee" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe nc nd ne mt b">load_model</code>加载保存的转换管道和训练模型作为scikit-learn管道对象。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="fdce" class="mx la it mt b gy my mz l na nb">loaded_model = load_model('iforest_model')</span><span id="f958" class="mx la it mt b gy nk mz l na nb">type(loaded_model)<br/>&gt;&gt; sklearn.pipeline.Pipeline</span></pre><p id="c9dd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">看不见的数据得分</strong></p><p id="8eb8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe nc nd ne mt b">predict</code>方法将得到<code class="fe nc nd ne mt b">1</code>或<code class="fe nc nd ne mt b">0</code>的二进制输出，其中<code class="fe nc nd ne mt b">1</code>代表异常记录而<code class="fe nc nd ne mt b">0</code>代表正常记录。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="3e23" class="mx la it mt b gy my mz l na nb">loaded_model.predict(df_unseen)</span><span id="4af3" class="mx la it mt b gy nk mz l na nb">&gt;&gt; array([0, 0, 0, 0, 0, 1, 0, 0, 1, 0])</span></pre><p id="bf2e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe nc nd ne mt b">predict_proba</code>方法将得到记录被分类为<code class="fe nc nd ne mt b">0</code>或<code class="fe nc nd ne mt b">1</code>的概率。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="72e2" class="mx la it mt b gy my mz l na nb">loaded_model.predict_proba(df_unseen)</span><span id="69d5" class="mx la it mt b gy nk mz l na nb">&gt;&gt; array([[0.81527091, 0.18472909],<br/>       [0.88219213, 0.11780787],<br/>       [0.4789605 , 0.5210395 ],<br/>       [0.46277058, 0.53722942],<br/>       [0.47638085, 0.52361915],<br/>       [0.4421625 , 0.5578375 ],<br/>       [0.68153289, 0.31846711],<br/>       [0.75207438, 0.24792562],<br/>       [0.27120702, 0.72879298],<br/>       [0.54821746, 0.45178254]])</span></pre><p id="aad8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe nc nd ne mt b">decision_function</code>方法将返回异常值</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="ac1a" class="mx la it mt b gy my mz l na nb">loaded_model.decision_function(df_unseen)</span><span id="9d9a" class="mx la it mt b gy nk mz l na nb">&gt;&gt; array([-0.11826784, -0.14024322, -0.00783128, -0.00251488, -0.00698418,<br/>        0.00425233, -0.07435137, -0.09751556,  0.06039016, -0.03057366])</span></pre><h1 id="4de7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="3f9d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在本文中，我们探讨了如何使用Pycaret快速训练无监督异常检测模型，使用TSNE或UMAP可视化高维特征，并使用训练好的模型预测未知数据。</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="ae19" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><a class="ae ky" href="https://medium.com/@edwin.tan/membership" rel="noopener">加入Medium </a>阅读更多这样的故事。</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h1 id="6bdc" class="kz la it bd lb lc ns le lf lg nt li lj jz nu ka ll kc nv kd ln kf nw kg lp lq bi translated">参考</h1><p id="a745" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">[1] <a class="ae ky" href="https://archive-beta.ics.uci.edu/ml/datasets/breast+cancer+wisconsin+diagnostic" rel="noopener ugc nofollow" target="_blank">乳腺癌威斯康星州(诊断)数据集</a></p><p id="0676" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">创作者:</p><p id="7088" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">1.威廉·h·沃尔伯格医生，普通外科部<br/>威斯康辛大学，临床科学中心<br/>麦迪逊，WI 53792 <br/>沃尔伯格<strong class="lt iu">' @ '</strong>eagle.surgery.wisc.edu</p><p id="c3fe" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">2.威斯康星大学计算机科学系w . Nick Street<br/>，威斯康辛州麦迪逊市西代顿街1210号，邮编:53706<br/>Street<strong class="lt iu">' @ '</strong>cs.wisc.edu 608–262–6619</p><p id="67aa" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">3.Olvi L. Mangasarian，计算机科学系<br/>威斯康星大学，威斯康辛州麦迪逊市西代顿街1210号，邮编:53706<br/>olvi<strong class="lt iu">' @ '</strong>cs.wisc.edu</p><p id="ef91" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">捐赠者:尼克街</p><p id="a8b1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">许可证:CC BY 4.0</p><p id="a3e8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">[2]Dua d .和Graff c .(2019年)。UCI机器学习知识库[http://archive . ics . UCI . edu/ml]。加州欧文:加州大学信息与计算机科学学院。</p></div></div>    
</body>
</html>