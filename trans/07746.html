<html>
<head>
<title>Chi-square Test for Independence</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">独立性卡方检验</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/chi-square-test-for-independence-cf2f5057cc35?source=collection_archive---------22-----------------------#2021-07-15">https://towardsdatascience.com/chi-square-test-for-independence-cf2f5057cc35?source=collection_archive---------22-----------------------#2021-07-15</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="b1fd" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">使用pingouin库实现卡方分析</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/c70ef4e097b217f02b9786b0e0312450.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r4wF70KiQbA6a6enOs826g.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">图片来自<a class="ae kz" href="https://unsplash.com/photos/FBL09HBLuWg" rel="noopener ugc nofollow" target="_blank"> unsplash </a></p></figure><blockquote class="la lb lc"><p id="6e7a" class="ld le lf lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated"><strong class="lg iv">简介</strong></p></blockquote><p id="a1b5" class="pw-post-body-paragraph ld le iu lg b lh li jv lj lk ll jy lm ma lo lp lq mb ls lt lu mc lw lx ly lz in bi translated">数据科学家有时需要检查一个分类变量是否与同一人群中的另一个分类变量相关。如果数据是连续的，人们可以简单地计算变量之间的相关性，并根据相关系数确定这些变量是否高度相关。卡方检验是对分类变量进行分析的工具。例如，我们可能想检查性别是否在心脏病中起作用，或者教育是否与婚姻状况有关。在这种情况下，卡方检验是正确的分析工具。</p><blockquote class="la lb lc"><p id="7896" class="ld le lf lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated"><strong class="lg iv">背景</strong></p></blockquote><p id="e68f" class="pw-post-body-paragraph ld le iu lg b lh li jv lj lk ll jy lm ma lo lp lq mb ls lt lu mc lw lx ly lz in bi translated">为了进行卡方检验，我想简单回顾一下相关术语的背景。python中的分析和输出解释需要理解这些术语。</p><blockquote class="la lb lc"><p id="d377" class="ld le lf lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated"><strong class="lg iv"> P值、置信区间和显著性水平</strong></p></blockquote><p id="7b07" class="pw-post-body-paragraph ld le iu lg b lh li jv lj lk ll jy lm ma lo lp lq mb ls lt lu mc lw lx ly lz in bi translated">p值是两个值之间的差异偶然存在的概率。如果p =值很小，观察到的数据偶然出现的概率很小，因此我们得出结论，观察到的数据和预期的数据之间存在统计上的显著差异。</p><p id="35c2" class="pw-post-body-paragraph ld le iu lg b lh li jv lj lk ll jy lm ma lo lp lq mb ls lt lu mc lw lx ly lz in bi translated">置信区间是测试结果百分比的范围。如果置信区间设定为95%，这并不意味着我们对测试结果有95%的把握。可以认为，如果我们重复测试100次，测试结果将在100次中有95次落入该范围内。通常，CI在大多数情况下设置为95%。</p><p id="867f" class="pw-post-body-paragraph ld le iu lg b lh li jv lj lk ll jy lm ma lo lp lq mb ls lt lu mc lw lx ly lz in bi translated">另一个名为显著性水平(alpha)的术语是当假设事实上为真时拒绝零假设的概率。大多数情况下通常设定为5%。</p><blockquote class="la lb lc"><p id="56e8" class="ld le lf lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated"><strong class="lg iv">卡方检验</strong></p></blockquote><p id="a3a5" class="pw-post-body-paragraph ld le iu lg b lh li jv lj lk ll jy lm ma lo lp lq mb ls lt lu mc lw lx ly lz in bi translated">卡方检验有几种类型。一种类型的卡方检验被称为拟合优度检验，它检查一个分类变量是否很好地符合总体数据。另一种类型的检验检查一个分类变量相对于另一个分类变量的独立性，这被称为独立性卡方检验。在本文中，我将通过检验卡方统计量和p值来检验一个分类变量是否与另一个分类变量相关。</p><blockquote class="la lb lc"><p id="f777" class="ld le lf lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated"><strong class="lg iv">用python实现</strong></p></blockquote><p id="5243" class="pw-post-body-paragraph ld le iu lg b lh li jv lj lk ll jy lm ma lo lp lq mb ls lt lu mc lw lx ly lz in bi translated">让我们导入心脏病的数据。它显示了来自几个人的心脏相关变量的数据，如收缩压和舒张压、糖尿病、身体质量指数、心率葡萄糖水平、吸烟习惯等。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj md"><img src="../Images/ff03e718293d3b188e9b14e216921d6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xxwem86ImjB3eZ-o88TeyA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">心脏病数据集</p></figure><p id="5f4b" class="pw-post-body-paragraph ld le iu lg b lh li jv lj lk ll jy lm ma lo lp lq mb ls lt lu mc lw lx ly lz in bi translated">Python有来自<code class="fe me mf mg mh b">scipy.stats</code>的<code class="fe me mf mg mh b">chi2_contingency</code>模块，我们需要在那里提供列联表。列联表是两个分类变量之间关系的总结。如果我们只提供数据，有一个名为pingouin的模块可以提供列联表。</p><p id="634f" class="pw-post-body-paragraph ld le iu lg b lh li jv lj lk ll jy lm ma lo lp lq mb ls lt lu mc lw lx ly lz in bi translated">根据我们的数据，假设我们想要检查冠心病(CHD)是否与性别分布有关。使用pingouin，代码只有一行。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj mi"><img src="../Images/997c0d1190d4bb446505dda76e43c19d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XM7nE4lu_KMeKuCD9zayMg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">使用pingouin获得卡方统计数据</p></figure><p id="ecd2" class="pw-post-body-paragraph ld le iu lg b lh li jv lj lk ll jy lm ma lo lp lq mb ls lt lu mc lw lx ly lz in bi translated">chi2_independence返回三个表。<em class="lf">期望</em>表是列联表，显示了初始数据中两个感兴趣的分类变量之间的关系。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj mj"><img src="../Images/59c4174dd898b05c683b9cd66905a815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ngNcFQWmdyf3BobjtMMXjw.png"/></div></div></figure><p id="25b6" class="pw-post-body-paragraph ld le iu lg b lh li jv lj lk ll jy lm ma lo lp lq mb ls lt lu mc lw lx ly lz in bi translated">为了分析预期数据，我们首先需要获得初始数据中不同性别的比率。我们的数据显示，第0组和第1组之间的比例为2420:1820 = 1.329，为了成为冠心病的不良预测因素，冠心病各组之间的性别比例应该相似。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj mk"><img src="../Images/271baa95871fa822eae007b665237398.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SLciVqc5hrJtGE9KwUpESg.png"/></div></div></figure><p id="2257" class="pw-post-body-paragraph ld le iu lg b lh li jv lj lk ll jy lm ma lo lp lq mb ls lt lu mc lw lx ly lz in bi translated">当我们取第0组和第1组之间的比率时，我们在<em class="lf">期望</em>表中得到不同性别之间相同的1.329:1比率。例如，十年期第0组的性别比率为2052.42/1543.56，相当于1.329(近似值)，另一组也是如此。</p><p id="4591" class="pw-post-body-paragraph ld le iu lg b lh li jv lj lk ll jy lm ma lo lp lq mb ls lt lu mc lw lx ly lz in bi translated">零假设表明我们期望观察到的表中有相同的比率。我们需要通过卡方统计来验证零假设，卡方统计根据自由度和显著性水平与卡方表中的特定卡方值进行比较。上面的<em class="lf">观察值</em>表显示了数据中实际观察到的性别类别和冠心病之间的关系。如果我们从<em class="lf">观察到的</em>表中计算性别比例，我们得到2118.5/1477.5 = 1.433和342.5/301.5 = 1.136，这与预期的比例不同。接下来，我们需要从<em class="lf"> stats </em>表中找出测试统计量和p值。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ml"><img src="../Images/700aa5e77513d58ff898553f2de60f90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HaW96SS98SCwOnCBVSyv1g.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Ch平方统计量和p值</p></figure><p id="4f99" class="pw-post-body-paragraph ld le iu lg b lh li jv lj lk ll jy lm ma lo lp lq mb ls lt lu mc lw lx ly lz in bi translated">皮尔逊残差的卡方统计量是最常见的统计量。皮尔逊残差被定义为通过期望值的平方根归一化的观察值和期望值之间的差。</p><blockquote class="mm"><p id="af04" class="mn mo iu bd mp mq mr ms mt mu mv lz dk translated"><em class="mw">皮尔逊残差=(观察值-期望值)/(sqrt(期望值))</em></p></blockquote><p id="6cf8" class="pw-post-body-paragraph ld le iu lg b lh mx jv lj lk my jy lm ma mz lp lq mb na lt lu mc nb lx ly lz in bi translated">对于这个单一自由度和5%的显著性水平，卡方统计的临界值是3.841，测试统计是在32.618获得的，这要高得多。该统计是对观察数据偏离预期值的程度的度量。我们还观察到一个非常小的p值，它基本上提供了反对零假设的证据。p值越小，观察到的差异只是偶然出现的可能性就越低。因此，在这种情况下，我们有强有力的证据来拒绝零假设，并声明观察到的差异是真实的。本质上，我们可以得出结论，性别是冠心病的一个很好的预测因素。</p><blockquote class="la lb lc"><p id="5c28" class="ld le lf lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated"><strong class="lg iv">A/B测试的扩展</strong></p></blockquote><p id="447d" class="pw-post-body-paragraph ld le iu lg b lh li jv lj lk ll jy lm ma lo lp lq mb ls lt lu mc lw lx ly lz in bi translated">卡方检验可视为简单A/B检验的扩展版本，在两组之间进行，以检查两组之间是否存在任何观察到的差异。一组称为<em class="lf">对照组</em>，另一组称为<em class="lf">治疗组</em>。有时我们感兴趣的是一次检查多个治疗，卡方检验提供了各组与对照组偏离程度的信息。比如查看翻新网页多个版本的点击量，我们实质上可以做两个以上的组，提供给不同的用户组。应急表应反映新版本网页以及初始页面的点击次数或最终购买次数。</p><blockquote class="la lb lc"><p id="9917" class="ld le lf lg b lh li jv lj lk ll jy lm ln lo lp lq lr ls lt lu lv lw lx ly lz in bi translated"><strong class="lg iv">结论</strong></p></blockquote><p id="3ac3" class="pw-post-body-paragraph ld le iu lg b lh li jv lj lk ll jy lm ma lo lp lq mb ls lt lu mc lw lx ly lz in bi translated">在本文中，我描述了卡方测试的背景，并展示了它在python中的实现。卡方检验是检查分类变量独立性的简单统计检验。当需要多重处理来检查时，我们需要超越简单的A/B检验，进行卡方检验。</p><p id="3c32" class="pw-post-body-paragraph ld le iu lg b lh li jv lj lk ll jy lm ma lo lp lq mb ls lt lu mc lw lx ly lz in bi translated"><a class="ae kz" href="https://mdsohelmahmood.github.io/2021/07/14/Chi_square.html" rel="noopener ugc nofollow" target="_blank"> Github页面</a></p><p id="0062" class="pw-post-body-paragraph ld le iu lg b lh li jv lj lk ll jy lm ma lo lp lq mb ls lt lu mc lw lx ly lz in bi translated">参考:</p><ol class=""><li id="9baf" class="nc nd iu lg b lh li lk ll ma ne mb nf mc ng lz nh ni nj nk bi translated"><a class="ae kz" href="https://pingouin-stats.org/generated/pingouin.chi2_independence.html" rel="noopener ugc nofollow" target="_blank"> pingouin文档</a></li><li id="171e" class="nc nd iu lg b lh nl lk nm ma nn mb no mc np lz nh ni nj nk bi translated"><a class="ae kz" href="https://github.com/thadaJ/autoInsight" rel="noopener ugc nofollow" target="_blank">心脏病数据</a></li></ol></div></div>    
</body>
</html>