<html>
<head>
<title>Predict Customer Churn (the right way) using PyCaret</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PyCaret预测客户流失(正确的方式)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predict-customer-churn-the-right-way-using-pycaret-8ba6541608ac?source=collection_archive---------0-----------------------#2021-05-21">https://towardsdatascience.com/predict-customer-churn-the-right-way-using-pycaret-8ba6541608ac?source=collection_archive---------0-----------------------#2021-05-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a926" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">关于如何使用PyCaret正确预测客户流失的分步指南，实际上优化了业务目标并提高了投资回报率</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/62e56d0299926d8e11447530300def1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mu45A-psfPHTIM1F_nUXBw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用PyCaret预测客户流失(正确的方式)——作者图片</p></figure><h1 id="6539" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated"><strong class="ak">简介</strong></h1><p id="aa14" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">对于采用基于订阅的业务模式的公司来说，客户维系是主要的KPI之一。竞争非常激烈，尤其是在SaaS市场，消费者可以自由地从大量供应商中进行选择。一次糟糕的体验，客户可能会转向竞争对手，导致客户流失。</p><h1 id="cf97" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated"><strong class="ak">什么是客户流失？</strong></h1><p id="60af" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">客户流失率是在一定时间内停止使用贵公司产品或服务的客户的百分比。计算客户流失率的方法之一是用给定时间间隔内流失的客户数量除以该期间开始时的活跃客户数量。例如，如果你有1000个客户，上个月失去了50个，那么你的月流失率是5%。</p><p id="57b7" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">预测客户流失是一个具有挑战性但极其重要的商业问题，尤其是在客户获取成本较高的行业，如技术、电信、金融等。预测特定客户面临高风险的能力，同时还有时间做些什么，对公司来说是一个巨大的额外潜在收入来源。</p><h1 id="c60f" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">客户流失机器学习模型在实践中是如何使用的？</h1><p id="eb24" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">客户流失预测模型的主要目标是通过主动与客户接触来留住流失风险最高的客户。例如:提供礼品券或任何促销价格，并将其锁定一两年，以延长其对公司的终身价值。</p><p id="32d2" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">这里有两个宽泛的概念需要理解:</p><ul class=""><li id="5bf7" class="mo mp iq lp b lq mj lt mk lw mq ma mr me ms mi mt mu mv mw bi translated">我们想要一个客户流失预测模型来提前预测流失(比如提前一个月、提前三个月、甚至提前六个月——这完全取决于用例)。这意味着你必须非常小心截止日期，即你不应该使用截止日期之后的任何信息作为机器学习模型中的特征，否则这将是泄漏。截止日期之前的时期被称为<strong class="lp ir">事件。</strong></li><li id="d2d1" class="mo mp iq lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">通常对于客户流失预测，您需要做一些工作来创建一个<strong class="lp ir"> <em class="nc">目标列</em> </strong>，它通常不会以您想要的形式出现。例如，您希望预测客户是否会在下一季度内流失，因此您将遍历截至事件截止日期的所有活跃客户，并检查他们是否会在下一季度离开公司(1表示是，0表示否)。这种情况下的季度称为<strong class="lp ir">性能窗口</strong>。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/de307effc7b7b2e64088d06b60672eda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*yNaRKOY1ZjTF59U1LRnQ0g.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">如何创建客户流失数据集—按作者分类的图像</p></figure><h1 id="410f" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">客户流失模型工作流程</h1><p id="9674" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">现在，您已经了解了数据是如何来源的以及流失目标是如何创建的(这是问题中最具挑战性的部分之一)，让我们讨论一下这种机器学习模型将如何在业务中使用。从左至右阅读下图:</p><ul class=""><li id="cfa3" class="mo mp iq lp b lq mj lt mk lw mq ma mr me ms mi mt mu mv mw bi translated">基于客户流失历史(X特征的事件周期和目标变量的性能窗口)训练模型。</li><li id="3cf4" class="mo mp iq lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">每个月，活跃客户群都被传递到<strong class="lp ir">机器学习预测模型</strong>上，以返回每个客户的流失概率(在商业行话中，这有时被称为流失分数)。</li><li id="58e8" class="mo mp iq lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">该列表将从最高概率值到最低概率值(或他们所说的分数)排序，客户保留团队将开始与客户接触以阻止客户流失，通常通过提供某种促销或礼品卡来锁定未来几年。</li><li id="2d67" class="mo mp iq lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">流失率非常低的客户(或者基本上模型预测没有流失率的客户)是快乐的客户。不对它们采取任何操作。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/b2c1ea8ada193b0e4a251413490969fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V_Yiyl5iWIC6mRXEiTC0Qg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">客户流失模型工作流程-按作者分类的图片</p></figure><h1 id="9e9e" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">让我们从实际例子开始</h1><p id="5e87" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在这一部分中，我将演示机器学习模型训练和选择、超参数调整、结果分析和解释的完整端到端工作流。我还将讨论您可以优化的指标，以及为什么AUC、准确性、召回率等传统指标可能不适合客户流失模型。我将使用<a class="ae nf" href="https://www.pycaret.org" rel="noopener ugc nofollow" target="_blank">py caret</a>——一个开源、低代码的机器学习库来执行这个实验。本教程假设您对PyCaret有基本的了解。</p><h1 id="afed" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">PyCaret</h1><p id="5b64" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated"><a class="ae nf" href="https://www.pycaret.org/" rel="noopener ugc nofollow" target="_blank"> PyCaret </a>是一个开源、低代码的机器学习库和端到端的模型管理工具，内置于Python中，用于自动化机器学习工作流。PyCaret以其易用性、简单性以及快速高效地构建和部署端到端机器学习管道的能力而闻名。要了解更多关于PyCaret的信息，请查看他们的<a class="ae nf" href="https://www.github.com/pycaret/pycaret" rel="noopener ugc nofollow" target="_blank"> GitHub </a>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/f81ef235ef65d76e55b7fe5d9390ea37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KAZzGooA90037WgZ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">PyCaret的特点—作者图片</p></figure><h1 id="f84f" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">安装PyCaret</h1><pre class="kg kh ki kj gt nh ni nj nk aw nl bi"><span id="aada" class="nm kw iq ni b gy nn no l np nq"><strong class="ni ir"># install pycaret<br/></strong>pip install pycaret</span></pre><h1 id="9c35" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">👉资料组</h1><p id="2437" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">对于本教程，我使用来自Kaggle的<a class="ae nf" href="https://www.kaggle.com/blastchar/telco-customer-churn" rel="noopener ugc nofollow" target="_blank">电信客户流失</a>数据集。数据集已经包含我们可以按原样使用的目标列。您可以直接从这个<a class="ae nf" href="https://raw.githubusercontent.com/srees1988/predict-churn-py/main/customer_churn_data.csv" rel="noopener ugc nofollow" target="_blank"> GitHub </a>链接中读取这个数据集。(<em class="nc">大喊到sres 1988</em></p><pre class="kg kh ki kj gt nh ni nj nk aw nl bi"><span id="c255" class="nm kw iq ni b gy nn no l np nq"><strong class="ni ir"># import libraries</strong><br/>import pandas as pd<br/>import numpy as np</span><span id="7bc5" class="nm kw iq ni b gy nr no l np nq"><strong class="ni ir"># read csv data<br/></strong>data <strong class="ni ir">= </strong>pd.read_csv('<a class="ae nf" href="https://raw.githubusercontent.com/srees1988/predict-churn-py/main/customer_churn_data.csv'" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/srees1988/predict-churn-py/main/customer_churn_data.csv'</a>)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/dd3f77dec505febc5c81e50782d7b8a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mN9rTN4VxjI5opbTbnSZmQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">样本数据集-按作者分类的图像</p></figure><h1 id="2390" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated"><strong class="ak">👉探索性数据分析</strong></h1><pre class="kg kh ki kj gt nh ni nj nk aw nl bi"><span id="cab3" class="nm kw iq ni b gy nn no l np nq"><strong class="ni ir"># check data types<br/></strong>data.dtypes</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/33a6bd0578cfb55b2622268bb288a786.png" data-original-src="https://miro.medium.com/v2/resize:fit:590/format:webp/1*S7mP3s8pykG4EBCBnXlAGw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数据类型-按作者分类的图像</p></figure><p id="baef" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">注意到<code class="fe nu nv nw ni b">TotalCharges</code>是一个<code class="fe nu nv nw ni b">object</code>类型，而不是<code class="fe nu nv nw ni b">float64.</code>，经过调查，我发现这个列中有一些空格，这导致Python将数据类型强制为<code class="fe nu nv nw ni b">object</code>。要解决这个问题，我们必须在改变数据类型之前修剪空白。</p><pre class="kg kh ki kj gt nh ni nj nk aw nl bi"><span id="e509" class="nm kw iq ni b gy nn no l np nq"><strong class="ni ir"># replace blanks with np.nan</strong><br/>data['TotalCharges'] = data['TotalCharges'].replace(' ', np.nan)</span><span id="b682" class="nm kw iq ni b gy nr no l np nq"><strong class="ni ir"># convert to float64</strong><br/>data['TotalCharges'] = data['TotalCharges'].astype('float64')</span></pre><p id="46c5" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">从直觉上来说，合同类型、期限(客户停留的时间长度)和定价计划是客户流失或保留的非常重要的信息。让我们探讨一下这种关系:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae nf" href="https://gist.github.com/moezali1/2624c9a5eaf78d9a7ffa1b97195a4812" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/moe zali 1/2624 c 9 a5 EAF 78d 9 a 7 FFA 1 b 97195 a 4812</a></p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/54bf208c2dbe11e3602da0163a5cd25a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I-h0lJJnHADHpk7rOUlYOg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">按任期、费用和合同类型划分的客户流失(图片由作者提供)</p></figure><p id="c6b2" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">请注意，大多数流失可以在“逐月”合同中看到。当然有道理。此外，我可以看到，随着任期的增加和总费用的增加，与高任期和高费用的客户相比，高任期和低费用的客户的可能性较小。</p><p id="0375" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated"><strong class="lp ir">缺失值</strong></p><pre class="kg kh ki kj gt nh ni nj nk aw nl bi"><span id="1d0d" class="nm kw iq ni b gy nn no l np nq"><strong class="ni ir"># check missing values<br/></strong>data.isnull().sum()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/a68b992a59f3ae5dc88f92bcff13de60.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/format:webp/1*HP-9ncnzxgURBYwl6cG9DA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">缺失值-按作者分类的图像</p></figure><p id="94f7" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">请注意，因为我们用<code class="fe nu nv nw ni b">np.nan</code>替换了空白值，所以现在<code class="fe nu nv nw ni b">TotalCharges</code>中有11行缺少值。没问题——我会让PyCaret自动估算它。</p><h1 id="f5b5" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated"><strong class="ak">👉数据准备</strong></h1><p id="7f7d" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">对于PyCaret中的所有模块来说，<code class="fe nu nv nw ni b">setup</code>是在PyCaret中执行的任何机器学习实验中的第一个也是唯一一个强制步骤。该功能负责训练模型之前所需的所有数据准备。除了执行一些基本的默认处理任务，PyCaret还提供了一系列预处理功能。要了解PyCaret中所有预处理功能的更多信息，您可以查看这个<a class="ae nf" href="https://pycaret.org/preprocessing/" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><pre class="kg kh ki kj gt nh ni nj nk aw nl bi"><span id="1f02" class="nm kw iq ni b gy nn no l np nq"><strong class="ni ir"># init setup</strong><br/>from pycaret.classification import *<br/>s = setup(data, target = 'Churn', ignore_features = ['customerID'])</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/f48a089eb1cde78706de55cfb3dfb81d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w-tUxTQ4p0tDhgYv8DbNOg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">pycaret.classification中的设置函数—按作者分类的图像</p></figure><p id="772e" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">每当在PyCaret中初始化<code class="fe nu nv nw ni b">setup</code>函数时，它都会分析数据集并推断所有输入要素的数据类型。在这种情况下，你可以看到除了<code class="fe nu nv nw ni b">tenure</code> <code class="fe nu nv nw ni b">MonthlyCharges</code>和<code class="fe nu nv nw ni b">TotalCharges</code>之外，其他都是绝对的，这是正确的，你现在可以按回车键继续。如果数据类型推断不正确(这有时会发生)，您可以使用<code class="fe nu nv nw ni b">numeric_feature</code>和<code class="fe nu nv nw ni b">categorical_feature</code>来覆盖数据类型。</p><p id="e917" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">另外，请注意，我已经在<code class="fe nu nv nw ni b">setup</code>函数中传递了<code class="fe nu nv nw ni b">ignore_features = ['customerID']</code>，因此在训练模型时不会考虑它。这样做的好处是PyCaret不会从数据集中删除该列，它只是在模型训练的幕后忽略它。因此，当您在最后生成预测时，您不需要担心自己将IDs连接回来。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/bed1294c9c2e11b48a855b5c59015626.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*Y2N6dU1qvJFwOyTmTbgoCw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">设置的输出-为显示而截断-作者提供的图像</p></figure><h1 id="3bf3" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">👉模型训练和选择</h1><p id="6ef9" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">现在数据准备工作已经完成，让我们使用<code class="fe nu nv nw ni b">compare_models</code>功能开始培训过程。此函数训练模型库中可用的所有算法，并使用交叉验证评估多个性能指标。</p><pre class="kg kh ki kj gt nh ni nj nk aw nl bi"><span id="6d1a" class="nm kw iq ni b gy nn no l np nq"><strong class="ni ir"># compare all models</strong><br/>best_model = compare_models(sort='AUC')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/962712dcc0da1a2f4e9ea20045e56024.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eHvFHPaXU0IQoshg2_5rlw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">compare_models的输出—按作者分类的图像</p></figure><p id="6042" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">基于<strong class="lp ir"> AUC </strong> <em class="nc"> </em>的最佳模型是<code class="fe nu nv nw ni b">Gradient Boosting Classifier </code>。使用10倍交叉验证的AUC为0.8472。</p><pre class="kg kh ki kj gt nh ni nj nk aw nl bi"><span id="ecde" class="nm kw iq ni b gy nn no l np nq"><strong class="ni ir"># print best_model parameters</strong><br/>print(best_model)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/ba09cf95edcb60ebec3c1b5960204583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6TQiy5iPNmCYM0DolQ8Mjg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">最佳模型参数—作者图片</p></figure><h1 id="a57f" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated"><strong class="ak">超参数调谐</strong></h1><p id="90bf" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">您可以使用PyCaret中的<code class="fe nu nv nw ni b">tune_model</code>函数来自动调整模型的超参数。</p><pre class="kg kh ki kj gt nh ni nj nk aw nl bi"><span id="b947" class="nm kw iq ni b gy nn no l np nq"><strong class="ni ir"># tune best model</strong><br/>tuned_best_model = tune_model(best_model)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi of"><img src="../Images/c5c99dd0109c979e6705ffa80a081c6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*NY4wOQYZB0l3V2FkScz8xQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">tune_model结果—作者提供的图片</p></figure><p id="d0e0" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">请注意，AUC从<code class="fe nu nv nw ni b">0.8472</code>到<code class="fe nu nv nw ni b">0.8478</code>略有增加。</p><h1 id="f407" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">模型分析</h1><pre class="kg kh ki kj gt nh ni nj nk aw nl bi"><span id="6181" class="nm kw iq ni b gy nn no l np nq"><strong class="ni ir"># AUC Plot</strong><br/>plot_model(tuned_best_model, plot = 'auc')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi og"><img src="../Images/8cf753e596e64dfb8615d375b5404f24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*QJNvMQmXxWk4n78VHF0jHQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">AUC图—作者提供的图像</p></figure><pre class="kg kh ki kj gt nh ni nj nk aw nl bi"><span id="2082" class="nm kw iq ni b gy nn no l np nq"><strong class="ni ir"># Feature Importance Plot</strong><br/>plot_model(tuned_gbc, plot = 'feature')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/358abaa3d04d62d698e0e0ef9dd48a50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tahIWrTGqWG-KJTe3MvF5g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">特征重要性图—按作者分类的图像</p></figure><pre class="kg kh ki kj gt nh ni nj nk aw nl bi"><span id="d827" class="nm kw iq ni b gy nn no l np nq"><strong class="ni ir"># Confusion Matrix</strong><br/>plot_model(tuned_best_model, plot = 'confusion_matrix')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/42cbed43c3d42668f51908ae5c0cc5a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*5qW6fHWqXi-BPkhxYzcQmg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">混淆矩阵梯度推进分类器—图片由作者提供</p></figure><p id="75b3" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">这个混淆矩阵在测试集上，测试集包括我们30%的数据(2，113行)，我们有309个<strong class="lp ir"> <em class="nc">真阳性</em> </strong> (15%) —这些是我们将能够延长生命周期价值的客户。如果我们没有预测到，那么就没有干预的机会。</p><p id="de83" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">我们也有138 (7%) <strong class="lp ir"> <em class="nc">误报</em> </strong>我们将会损失金钱，因为提供给这些客户的促销只是额外的成本。</p><p id="9d9b" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">1388个(66%)是真阴性(好客户)，278个(13%)是<strong class="lp ir"> <em class="nc">假阴性</em> </strong>(这是错过的机会)。</p><p id="a182" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">到目前为止，我们已经训练了多个模型，以选择给出最高AUC的最佳模型，然后调整最佳模型的超参数，以在AUC方面获得更多一点的性能。然而，最好的AUC不一定转化为最好的商业模式。</p><p id="6acd" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">在一个流失模型中，通常<strong class="lp ir"> <em class="nc">真阳性</em> </strong>的回报与<strong class="lp ir"> <em class="nc">假阳性</em> </strong>的成本大相径庭。让我们使用以下假设:</p><ul class=""><li id="05f5" class="mo mp iq lp b lq mj lt mk lw mq ma mr me ms mi mt mu mv mw bi translated">将向所有被识别为流失的客户提供1000美元的代金券(真阳性+假阳性)；</li><li id="3669" class="mo mp iq lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">如果我们能够阻止客户流失，我们将获得5000美元的客户终身价值。</li></ul><p id="0791" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">使用这些假设和上面的混淆矩阵，我们可以计算该模型的美元影响:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/c5aa5ac32cabd28b55cb1a8ba89558f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*FcLFdEVYe3Y9XWYj144Dgw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">模型对2，113名客户的影响——图片由作者提供</p></figure><p id="81ac" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">这是一个很好的模式，但问题是它不是一个商业智能模式。与没有模型相比，它做得非常好，但是我们如何训练和选择一个模型来最大化商业价值。为了实现这一目标，我们必须使用业务指标来训练、选择和优化模型，而不是任何传统的指标，如AUC或准确性。</p><h1 id="3439" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated"><strong class="ak">👉在PyCaret </strong>中添加自定义指标</h1><p id="a3e1" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">多亏了PyCaret，使用<code class="fe nu nv nw ni b">add_metric</code>函数可以非常容易地实现这一点。</p><pre class="kg kh ki kj gt nh ni nj nk aw nl bi"><span id="0755" class="nm kw iq ni b gy nn no l np nq"><strong class="ni ir"># create a custom function<br/></strong>def calculate_profit(y, y_pred):<br/>    tp = np.where((y_pred==1) &amp; (y==1), (5000-1000), 0)<br/>    fp = np.where((y_pred==1) &amp; (y==0), -1000, 0)<br/>    return np.sum([tp,fp])</span><span id="e565" class="nm kw iq ni b gy nr no l np nq"><strong class="ni ir"># add metric to PyCaret<br/></strong>add_metric('profit', 'Profit', calculate_profit)</span></pre><p id="028a" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">现在让我们运行<code class="fe nu nv nw ni b">compare_models</code>看看神奇之处。</p><pre class="kg kh ki kj gt nh ni nj nk aw nl bi"><span id="d7b3" class="nm kw iq ni b gy nn no l np nq"><strong class="ni ir"># compare all models</strong><br/>best_model = compare_models(sort='Profit')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/4e6cf328bc091de52592565c4ffab023.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J1eZLSvWgk67Fe4EdxUwAQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">compare_models的输出—按作者分类的图像</p></figure><p id="bb15" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">请注意，这次添加了一个新列<code class="fe nu nv nw ni b">Profit</code>，令人惊讶的朴素贝叶斯是一个在<code class="fe nu nv nw ni b">AUC</code>方面相当糟糕的模型，但在利润方面却是最好的模型。让我们看看如何:</p><pre class="kg kh ki kj gt nh ni nj nk aw nl bi"><span id="24a4" class="nm kw iq ni b gy nn no l np nq"><strong class="ni ir"># confusion matrix</strong><br/>plot_model(best_model, plot = 'confusion_matrix')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/43111ebbacc9b3b98dcb0cd8cfdb0830.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*WKTgO9-KhST6KK4d9qdH4Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">混淆矩阵朴素贝叶斯-作者图片</p></figure><p id="9cea" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">客户的总数仍然是一样的(测试集中有2，113个客户)，现在发生变化的是模型如何在误报和漏报上出错。让我们用同样的假设(如上所述),用一些美元价值来反对它:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi om"><img src="../Images/be597c8bb1b5a91d06c60dde98abec7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*tqM7173iOXcLToPgy9WgUQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">模型对2，113名客户的影响——图片由作者提供</p></figure><blockquote class="on"><p id="8ac7" class="oo op iq bd oq or os ot ou ov ow mi dk translated"><strong class="ak"> <em class="ox">嘭！</em> </strong> <em class="ox">我们刚刚增加了约400，000美元的利润，其AUC比最佳型号低2%。这是怎么发生的？首先，AUC或任何其他现成的分类指标(</em>准确度、召回率、精确度、F1、Kappa等)。<em class="ox">)不是一个商业智能指标，因此它没有考虑风险和回报。添加自定义指标并将其用于模型选择或优化是一个很好的想法和正确的方法。</em></p></blockquote><p id="219f" class="pw-post-body-paragraph ln lo iq lp b lq oy jr ls lt oz ju lv lw pa ly lz ma pb mc md me pc mg mh mi ij bi translated">我希望你会喜欢PyCaret的简单易用。只需几行代码，我们就能够训练多个模型，并选择对业务至关重要的模型。我是一个普通的博客作者，我主要写PyCaret及其在现实世界中的用例，如果你想自动收到通知，你可以在<a class="ae nf" href="https://medium.com/@moez-62905" rel="noopener"> Medium </a>、<a class="ae nf" href="https://www.linkedin.com/in/profile-moez/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae nf" href="https://twitter.com/moezpycaretorg1" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我。</p></div><div class="ab cl pd pe hu pf" role="separator"><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi"/></div><div class="ij ik il im in"><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pk"><img src="../Images/a2b33c94ff198e448e08dc3f87383811.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PLdJpNCTXdttEn8W.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">PyCaret —作者图片</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pl"><img src="../Images/de69aee1dba2d884b952c8a15d9d4a1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IvqhUYDstXqz55eF.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">PyCaret —作者图片</p></figure><p id="0631" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">使用Python中的这个轻量级工作流自动化库，您可以实现的目标是无限的。如果你觉得这很有用，请不要忘记给我们GitHub库上的⭐️。</p><p id="5eac" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">想了解更多关于PyCaret的信息，请在LinkedIn和Youtube上关注我们。</p><p id="9087" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">加入我们的休闲频道。邀请链接<a class="ae nf" href="https://join.slack.com/t/pycaret/shared_invite/zt-p7aaexnl-EqdTfZ9U~mF0CwNcltffHg" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><h1 id="20f2" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">重要链接</h1><p id="3967" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated"><a class="ae nf" href="https://pycaret.readthedocs.io/en/latest/installation.html" rel="noopener ugc nofollow" target="_blank">文档</a> <br/> <a class="ae nf" href="https://medium.com/@moez_62905" rel="noopener">博客</a><br/><a class="ae nf" href="http://www.github.com/pycaret/pycaret" rel="noopener ugc nofollow" target="_blank">GitHub</a><br/><a class="ae nf" href="https://stackoverflow.com/questions/tagged/pycaret" rel="noopener ugc nofollow" target="_blank">stack overflow</a><br/><a class="ae nf" href="https://pycaret.readthedocs.io/en/latest/installation.html" rel="noopener ugc nofollow" target="_blank">安装PyCaret <br/> </a> <a class="ae nf" href="https://pycaret.readthedocs.io/en/latest/tutorials.html" rel="noopener ugc nofollow" target="_blank">笔记本教程<br/> </a> <a class="ae nf" href="https://pycaret.readthedocs.io/en/latest/contribute.html" rel="noopener ugc nofollow" target="_blank">投稿于PyCaret </a></p><h1 id="a1f0" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">更多PyCaret相关教程:</h1><div class="pm pn gp gr po pp"><a rel="noopener follow" target="_blank" href="/machine-learning-in-alteryx-with-pycaret-fafd52e2d4a"><div class="pq ab fo"><div class="pr ab ps cl cj pt"><h2 class="bd ir gy z fp pu fr fs pv fu fw ip bi translated">用PyCaret在Alteryx中进行机器学习</h2><div class="pw l"><h3 class="bd b gy z fp pu fr fs pv fu fw dk translated">使用PyCaret在Alteryx Designer中训练和部署机器学习模型的分步教程</h3></div><div class="px l"><p class="bd b dl z fp pu fr fs pv fu fw dk translated">towardsdatascience.com</p></div></div><div class="py l"><div class="pz l qa qb qc py qd kp pp"/></div></div></a></div><div class="pm pn gp gr po pp"><a rel="noopener follow" target="_blank" href="/machine-learning-in-knime-with-pycaret-420346e133e2"><div class="pq ab fo"><div class="pr ab ps cl cj pt"><h2 class="bd ir gy z fp pu fr fs pv fu fw ip bi translated">用PyCaret实现KNIME中的机器学习</h2><div class="pw l"><h3 class="bd b gy z fp pu fr fs pv fu fw dk translated">使用PyCaret在KNIME中训练和部署端到端机器学习管道的分步指南</h3></div><div class="px l"><p class="bd b dl z fp pu fr fs pv fu fw dk translated">towardsdatascience.com</p></div></div><div class="py l"><div class="qe l qa qb qc py qd kp pp"/></div></div></a></div><div class="pm pn gp gr po pp"><a rel="noopener follow" target="_blank" href="/easy-mlops-with-pycaret-mlflow-7fbcbf1e38c6"><div class="pq ab fo"><div class="pr ab ps cl cj pt"><h2 class="bd ir gy z fp pu fr fs pv fu fw ip bi translated">使用PyCaret + MLflow轻松实现MLOps</h2><div class="pw l"><h3 class="bd b gy z fp pu fr fs pv fu fw dk translated">一个初学者友好的，一步一步的教程，使用PyCaret在你的机器学习实验中集成MLOps</h3></div><div class="px l"><p class="bd b dl z fp pu fr fs pv fu fw dk translated">towardsdatascience.com</p></div></div><div class="py l"><div class="qf l qa qb qc py qd kp pp"/></div></div></a></div><div class="pm pn gp gr po pp"><a rel="noopener follow" target="_blank" href="/write-and-train-your-own-custom-machine-learning-models-using-pycaret-8fa76237374e"><div class="pq ab fo"><div class="pr ab ps cl cj pt"><h2 class="bd ir gy z fp pu fr fs pv fu fw ip bi translated">使用PyCaret编写和训练您自己的自定义机器学习模型</h2><div class="px l"><p class="bd b dl z fp pu fr fs pv fu fw dk translated">towardsdatascience.com</p></div></div><div class="py l"><div class="qg l qa qb qc py qd kp pp"/></div></div></a></div><div class="pm pn gp gr po pp"><a rel="noopener follow" target="_blank" href="/build-with-pycaret-deploy-with-fastapi-333c710dc786"><div class="pq ab fo"><div class="pr ab ps cl cj pt"><h2 class="bd ir gy z fp pu fr fs pv fu fw ip bi translated">用PyCaret构建，用FastAPI部署</h2><div class="pw l"><h3 class="bd b gy z fp pu fr fs pv fu fw dk translated">一步一步，初学者友好的教程，如何建立一个端到端的机器学习管道与PyCaret和…</h3></div><div class="px l"><p class="bd b dl z fp pu fr fs pv fu fw dk translated">towardsdatascience.com</p></div></div><div class="py l"><div class="qh l qa qb qc py qd kp pp"/></div></div></a></div><div class="pm pn gp gr po pp"><a rel="noopener follow" target="_blank" href="/time-series-anomaly-detection-with-pycaret-706a6e2b2427"><div class="pq ab fo"><div class="pr ab ps cl cj pt"><h2 class="bd ir gy z fp pu fr fs pv fu fw ip bi translated">基于PyCaret的时间序列异常检测</h2><div class="pw l"><h3 class="bd b gy z fp pu fr fs pv fu fw dk translated">使用PyCaret对时间序列数据进行无监督异常检测的分步教程</h3></div><div class="px l"><p class="bd b dl z fp pu fr fs pv fu fw dk translated">towardsdatascience.com</p></div></div><div class="py l"><div class="qi l qa qb qc py qd kp pp"/></div></div></a></div><div class="pm pn gp gr po pp"><a rel="noopener follow" target="_blank" href="/supercharge-your-machine-learning-experiments-with-pycaret-and-gradio-5932c61f80d9"><div class="pq ab fo"><div class="pr ab ps cl cj pt"><h2 class="bd ir gy z fp pu fr fs pv fu fw ip bi translated">使用PyCaret和Gradio增强您的机器学习实验</h2><div class="pw l"><h3 class="bd b gy z fp pu fr fs pv fu fw dk translated">快速开发机器学习管道并与之交互的循序渐进教程</h3></div><div class="px l"><p class="bd b dl z fp pu fr fs pv fu fw dk translated">towardsdatascience.com</p></div></div><div class="py l"><div class="qj l qa qb qc py qd kp pp"/></div></div></a></div><div class="pm pn gp gr po pp"><a rel="noopener follow" target="_blank" href="/multiple-time-series-forecasting-with-pycaret-bc0a779a22fe"><div class="pq ab fo"><div class="pr ab ps cl cj pt"><h2 class="bd ir gy z fp pu fr fs pv fu fw ip bi translated">基于PyCaret的多时间序列预测</h2><div class="pw l"><h3 class="bd b gy z fp pu fr fs pv fu fw dk translated">使用PyCaret预测多个时间序列的分步教程</h3></div><div class="px l"><p class="bd b dl z fp pu fr fs pv fu fw dk translated">towardsdatascience.com</p></div></div><div class="py l"><div class="qk l qa qb qc py qd kp pp"/></div></div></a></div></div></div>    
</body>
</html>