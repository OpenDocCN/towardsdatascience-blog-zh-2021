<html>
<head>
<title>Setting up Airflow on AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在AWS上设置气流</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/setting-up-airflow-on-aws-eks-385667671789?source=collection_archive---------6-----------------------#2021-05-30">https://towardsdatascience.com/setting-up-airflow-on-aws-eks-385667671789?source=collection_archive---------6-----------------------#2021-05-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6c9a72356d0c9ab23a84be6097dcaa7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qsahpt2kqQ6e8iM5lqfZNg.jpeg"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">亚历克斯·丘马克在<a class="ae kc" href="https://unsplash.com/s/photos/python?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="4360" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">介绍</h1><p id="e725" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">Airflow是我最喜欢的工具之一，我经常使用它来设置和管理数据科学管道。气流用户界面为我们提供了DAGS及其当前状态的清晰画面。我可能是错的，但是从我的经验来看，我认为单个机器上的气流是不可扩展的。因此，为了扩大气流，我们可以使用Kubernetes。</p><p id="d7ff" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">当我试图在AWS EKS上部署气流时，我不得不通过多个来源，从社区获得澄清。因此，我写这篇文章是为了让在AWS EKS上部署气流变得尽可能容易。</p><p id="bd6b" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">本文的先决条件是安装aws-cli、kubectl和helm，在aws中设置一个EKS集群。我们将使用helm在EKS自动气象站部署气流舵图表。</p><p id="51bd" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">我发现Helm在设置和管理Kubernetes应用程序时非常有用。Artifacthub.io中提供了许多舵图。</p><p id="759f" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">气流也有一个舵图表，有很好的社区支持。我得感谢气流舵图表社区，他们帮了我大忙！舵轮图可在<a class="ae kc" href="https://github.com/airflow-helm/charts/tree/main/charts/airflow" rel="noopener ugc nofollow" target="_blank">https://github . com/air flow-helm/charts/tree/main/charts/air flow</a>获得。</p><h1 id="859f" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">先决条件</h1><p id="53cc" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">首先，我们需要设置我们的kubectl配置以指向AWS EKS集群。它的“如何”部分可在以下链接中找到:</p><p id="0bb2" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><a class="ae kc" href="https://docs.aws.amazon.com/eks/latest/userguide/create-kubeconfig.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/eks/latest/user guide/create-kube config . html</a></p><p id="a662" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">一旦kubectl kubeconfig(本地配置)设置为与AWS EKS集群通信，我们就可以继续在AWS EKS上部署气流了！！！！</p></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="96b8" class="kd ke iq bd kf kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw mp ky kz la bi translated">舵图和自定义默认安装</h1><p id="2bde" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在设置了前面指定的所有先决条件之后，我们现在可以开始我们的旅程了！</p><p id="5209" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">首先，我们需要添加回购并更新回购。这可以使用以下代码来完成:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="8b7d" class="mz ke iq mv b gy na nb l nc nd">helm repo add airflow-stable <a class="ae kc" href="https://airflow-helm.github.io/charts" rel="noopener ugc nofollow" target="_blank">https://airflow-helm.github.io/charts</a><br/>helm repo update</span></pre><p id="f894" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">更新helm repo后，我们可以在Kubernetes集群上安装气流。为此，您可以先在本地的minikube上试用，然后再在AWS EKS集群上使用，或者直接安装在AWS EKS集群上。</p><p id="188d" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">以下命令将在Kubernetes集群上安装Airflow:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="a43e" class="mz ke iq mv b gy na nb l nc nd">helm install RELEASE_NAME airflow-stable/airflow <br/>--namespace NAMESPACE \<br/>--version CHART_VERSION</span></pre><p id="b921" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">RELEASE_NAME可以取用户给定的任何值，名称空间是我们要安装Airflow的Kubernetes名称空间。默认情况下，如果没有指定名称空间，它将安装在kubeconfig的默认名称空间上。图表版本是需要安装的特定图表的版本，可以从<a class="ae kc" href="https://github.com/airflow-helm/charts/releases" rel="noopener ugc nofollow" target="_blank">https://github.com/airflow-helm/charts/releases</a>获得</p><p id="2430" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">这将在Kubernetes集群上安装气流，并将创建pod。这可能需要一些时间，所以请耐心等待。成功安装后，我们可以使用kubectl端口转发访问airflow UI，如下所示:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="21e3" class="mz ke iq mv b gy na nb l nc nd">export POD_NAME=$(kubectl get pods --namespace NAMESPACE -l "component=web,app=airflow" -o jsonpath="{.items[0].metadata.name}")<br/>kubectl port-forward --namespace NAMESPACE $POD_NAME 8080:8080</span></pre><p id="608f" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">这样，您可以通过localhost:8080上的浏览器访问UI。它可能会问你用户名和密码，默认的用户名和密码分别是admin和admin。</p><h1 id="e44a" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">自动气象站EKS上的气流</h1><p id="304f" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">Kubernetes上的Airflow使用PostgreSQL数据库、持久性卷来存储dags代码和日志、Redis数据库和其他组件。更多信息请参考<a class="ae kc" href="https://github.com/airflow-helm/charts/tree/main/charts/airflow" rel="noopener ugc nofollow" target="_blank">https://github . com/air flow-helm/charts/tree/main/charts/air flow</a></p><p id="4898" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">上述组件在Kubernetes集群中创建为pod，并由气流使用。</p><p id="ca2b" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">从AWS的角度来看，其中一些可以用AWS提供的服务来替代。就像我们可以使用AWS EFS作为永久卷的基础来保存我们的气流日志并保留我们的气流DAG代码，AWS RDS PostgreSQL而不是使用PostgreSQL数据库作为pod，AWS弹性缓存而不是Redis数据库(虽然我没有尝试过)。气流推荐用PostgreSQL代替MySQL。</p><p id="8baf" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">AWS的所有这些定制都可以在helm安装过程中使用的values.yml文件中完成。利用values.yml覆盖默认值的方法如下:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="be73" class="mz ke iq mv b gy na nb l nc nd">helm install RELEASE_NAME airflow-stable/airflow <br/>--namespace NAMESPACE \<br/>--version CHART_VERSION \<br/>--values values.yml</span></pre><p id="1871" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">可以在以下链接中找到示例values.yml文件:</p><p id="d3b8" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><a class="ae kc" href="https://github.com/manojbalaji1/aws-airflow-helm/blob/main/values.yml" rel="noopener ugc nofollow" target="_blank">https://github . com/manojbalaji 1/AWS-air flow-helm/blob/main/values . yml</a></p><p id="a5d9" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">假设我们有一些AWS RDS PostgreSQL。我们可以通过编辑上面提到的values.yml文件的“# Database-External Database”部分，用它来替代默认的PostgreSQL。</p><p id="f8c3" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">在此之前，我们需要将我们的AWS RDS PostgreSQL密码作为kubernetes-secret。这可以通过创建一个类似于<a class="ae kc" href="https://github.com/manojbalaji1/aws-airflow-helm/blob/main/airflow-db-secret.yml" rel="noopener ugc nofollow" target="_blank">https://github . com/manojbalaji 1/AWS-air flow-helm/blob/main/airflow-db-secret.yml</a>的air flow-d b-secret . yml文件来完成</p><p id="a362" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">该文件包含AWS RDS PostgreSQL base64编码的密码。在基于Linux的系统上，密码可以编码如下:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="666c" class="mz ke iq mv b gy na nb l nc nd">&gt;$echo “password” | base64<br/>cGFzc3dvcmQK</span></pre><p id="99a8" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">其中cGFzc3dvcmQK是字符串“password”的base64编码值。类似地，您可以获得各自密码的base64编码值。</p><p id="2069" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">密码的编码值存储在airflow-db-secret.yml中，与密钥“密码”相对应，如下所示:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="9c9b" class="mz ke iq mv b gy na nb l nc nd">apiVersion: v1<br/>kind: Secret<br/>metadata: <br/>    name: airflowdb<br/>type: Opaque<br/>data: <br/>    password: cGFzc3dvcmQK</span></pre><p id="7c41" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">创建秘密文件后，我们可以使用以下命令使其在Kubernetes集群上可用，helm将在安装期间访问该集群，如下所示:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="9734" class="mz ke iq mv b gy na nb l nc nd">kubectl apply -f airflow-db-secret.yml</span></pre><p id="dd20" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">现在继续，如果我们希望Airflow使用AWS RDS PostgreSQL，首先我们需要在values.yml文件的“# Database-PostgreSQL Chart”部分将enable设置为false，并编辑“# Database-External Database”部分，如下所示:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="8326" class="mz ke iq mv b gy na nb l nc nd">###################################<br/># Database - External Database<br/># - these configs are only used when `postgresql.enabled` is false<br/>###################################<br/>externalDatabase:  <br/>    ## the type of external database:{mysql,postgres}  ##  <br/>    type: postgres   <br/>    <br/>    ## the host of the external database  ##  <br/>    host: &lt;aws-postgresql-url&gt;   <br/> <br/>    ## the port of the external database  ##  <br/>    port: 5432   </span><span id="7b11" class="mz ke iq mv b gy ne nb l nc nd">    ## the database/scheme to use within the the external database##         <br/>    database: airflow   </span><span id="444c" class="mz ke iq mv b gy ne nb l nc nd">    ## the user of the external database  ##  <br/>    user: postgres   <br/>    <br/>    ## the name of a pre-created secret containing the external                       database password  ##  <br/>    passwordSecret: "airflowdb"   <br/>    <br/>    ## the key within `externalDatabase.passwordSecret` containing the password string  ##  <br/>    passwordSecretKey: "password"   <br/>    <br/>    ## the connection properties for external database, e.g. "?sslmode=require"  <br/>    properties: ""</span></pre><p id="f0d0" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">这里，我们需要在主机部分添加AWS RDS PostgreSQL，将用户部分编辑为创建数据库时使用的适当用户名，添加我们在上一步中创建的密码的名称，在本例中，它是passwordSecret部分中的“airflowdb”和包含base64编码密码的密钥。在passwordSecretKey部分。</p><p id="96ad" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">假设有一个在s3中持久化日志的需求，那么我们可以做同样的事情，首先在气流配置部分中添加一个具有适当值的连接，如下所示:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="44fa" class="mz ke iq mv b gy na nb l nc nd">connections:     <br/>    - id: s3_conn      <br/>      type: aws      <br/>      description: my AWS connection      <br/>      extra: |-        <br/>      { <br/>        "aws_access_key_id": "&lt;aws_key_id&gt;",             <br/>        "aws_secret_access_key": "&lt;aws_key&gt;",           <br/>        "region_name":"&lt;aws-region&gt;"         <br/>      }</span></pre><p id="20bb" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">除此之外，我们还需要在config部分下设置一些环境变量，如下所示:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="f43b" class="mz ke iq mv b gy na nb l nc nd"><br/>AIRFLOW__SCHEDULER__DAG_DIR_LIST_INTERVAL: "30"            <br/>AIRFLOW__LOGGING__REMOTE_LOGGING : "True"        <br/>AIRFLOW__LOGGING__REMOTE_LOG_CONN_ID : "s3_conn"        <br/>AIRFLOW__LOGGING__REMOTE_BASE_LOG_FOLDER : "s3://&lt;s3-path&gt;/"        <br/>AIRFLOW__CORE__ENCRYPT_S3_LOGS: "False"AIRFLOW__KUBERNETES_ENVIRONMENT_VARIABLES__AIRFLOW__CORE__REMOTE_LOGGING: "True"        AIRFLOW__KUBERNETES_ENVIRONMENT_VARIABLES__AIRFLOW__CORE__REMOTE_BASE_LOG_FOLDER: "s3://&lt;s3-path&gt;/"        AIRFLOW__KUBERNETES_ENVIRONMENT_VARIABLES__AIRFLOW__CORE__REMOTE_LOG_CONN_ID: "s3_conn"        AIRFLOW__KUBERNETES_ENVIRONMENT_VARIABLES__AIRFLOW__CORE__ENCRYPT_S3_LOGS: "False"</span></pre><p id="3315" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">除此之外，还有其他需要注意的事情，比如我们如何获取代码库中的代码库。有一个git-sync选项，可以将git存储库中的代码与持久性卷中的代码同步。对于企业来说，这可能不是一个理想的选择，因为代码库是不可公开访问的。相反，我们可以有一个Jenkins作业，将代码部署到AWS EFS的一个可以通过气流访问的位置。</p><p id="5307" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">我们首先可以通过如下定义efs-pvc.yml来设置持久卷和持久卷声明，以便使用AWS:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="f9ae" class="mz ke iq mv b gy na nb l nc nd">kind: StorageClassapi<br/>Version: storage.k8s.io/v1<br/>metadata:  <br/>    name: efs-sc<br/>provisioner: efs.csi.aws.com <br/>---</span><span id="b63a" class="mz ke iq mv b gy ne nb l nc nd">apiVersion: v1<br/>kind: PersistentVolume<br/>metadata:  <br/>    name: efs-pvc<br/>spec:  <br/>    capacity:    <br/>        storage: 10Gi  <br/>    volumeMode: Filesystem  <br/>    accessModes:    <br/>        - ReadWriteMany  <br/>    persistentVolumeReclaimPolicy: Retain  <br/>    storageClassName: efs-sc  <br/>    nfs:    <br/>        server: &lt;sub-region&gt;.&lt;efs-key&gt;.efs.&lt;region&gt;.amazonaws.com     <br/>        path: "/" <br/>---</span><span id="233c" class="mz ke iq mv b gy ne nb l nc nd">apiVersion: v1<br/>kind: PersistentVolumeClaim<br/>metadata:  <br/>    name: efs-storage-claim<br/>spec:  <br/>    accessModes:    <br/>        - ReadWriteMany  <br/>    storageClassName: efs-sc  <br/>    resources:    <br/>        requests:      <br/>            storage: 10Gi</span></pre><p id="97f0" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">在代码中，我们需要用适当的AWS EFS值替换服务器属性的值，如上所述。</p><p id="e8e4" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">创建这个文件后，我们可以使用下面的代码创建一个PV和PVC:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="4e3e" class="mz ke iq mv b gy na nb l nc nd">kubectl apply -f efs-pvc.yml</span></pre><p id="7539" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">这将在Kubernetes集群中创建一个PV和PVC，并且可以在values.yml文件中使用，如下所示:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="57bf" class="mz ke iq mv b gy na nb l nc nd">airflow:<br/>    extraVolumeMounts:<br/>        - name: airflow-efs-dag<br/>          mountPath: /opt/efs/<br/>    <br/>    extraVolumes:<br/>        - name: airflow-efs-dag<br/>          persistentVolumeClaim:<br/>              claimName: efs-storage-claim</span></pre><p id="34a9" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">在上面的代码中，我们要求helm使用前面定义的PVC名称创建一个额外的卷。然后，使用它在extraVolumeMounts中指定的路径上创建一个卷装载。这样，我们现在可以通过路径/opt/efs/访问helm install创建的Airflow pods上的AWS EFS。</p><p id="57b8" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">要将该路径用作dags文件夹的路径，我们需要对values.yml文件中的“# air flow-DAGs Configs”部分进行如下小改动:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="ac83" class="mz ke iq mv b gy na nb l nc nd">dags:<br/>    path: /opt/efs/dags # /opt/efs is EFS mount path specified above</span></pre><p id="4c21" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">使用values.yml文件中的上述代码，Airflow集群将从上述路径访问dags文件。现在，我们可以创建一个Jenkins作业，将代码从git存储库复制到前面提到的EFS的dags文件夹路径中。</p><p id="247c" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">同样，如果想使用AWS ElasticCache而不是Redis数据库，他们可以编辑values.yml文件中的# External Redis数据库部分，并能够使用ElasticCache。仅供参考，如果ElasticCache不需要密码，您可以忽略密码部分，在前面提到的部分填写其他详细信息。</p><h1 id="7578" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">气流AWS连接器</h1><p id="4b0c" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">最后但同样重要的是，airflow默认不提供连接器和其他库来与AWS一起工作，所以我们需要安装Airflow AWS提供程序。这可以通过在values.yml文件中使用以下代码进行编辑来完成:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="6708" class="mz ke iq mv b gy na nb l nc nd">airflow:<br/>    extraPipPackages: <br/>        - "apache-airflow-providers-amazon"<br/>        - "awscli"</span></pre><p id="ac95" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">使用上面的代码，helm将确保这些包安装在web、worker和scheduler pods上。如果有任何其他外部pip包需求，它们可以被添加到上面的代码中，它也将被安装。</p><p id="924a" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><strong class="ld ir">注意:</strong>不要忘记更改fermatkey默认值…！！！！</p><h1 id="4c1e" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结论</h1><p id="86d6" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">通过遵循上述所有步骤，我们可以在AWS EKS上设置一个气流集群，利用它我们可以轻松地进行纵向扩展和横向扩展。</p><p id="d7d5" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">设置气流集群的代码可在https://github.com/manojbalaji1/aws-airflow-helm<a class="ae kc" href="https://github.com/manojbalaji1/aws-airflow-helm" rel="noopener ugc nofollow" target="_blank">的</a>处获得</p><p id="720e" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">希望这是有帮助的，请让我知道你的想法！干杯……！！！</p></div></div>    
</body>
</html>