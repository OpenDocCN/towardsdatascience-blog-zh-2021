<html>
<head>
<title>Implementing Customer Segmentation using RFM analysis with PySpark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PySpark的RFM分析实现客户细分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/implementing-customer-segmentation-using-rfm-analysis-with-pyspark-3aed363f1d53?source=collection_archive---------5-----------------------#2021-07-02">https://towardsdatascience.com/implementing-customer-segmentation-using-rfm-analysis-with-pyspark-3aed363f1d53?source=collection_archive---------5-----------------------#2021-07-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f136" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Python和Apache Spark的RFM方法实现客户细分的分步指南。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/48dacf9eda6c5eb60ebabaae40ba3b11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kimxgidffWwfqdSJJqQmvw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">德文·艾弗里在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="779e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">客户细分是一种营销工具，根据共同特征对客户进行分组，以便您可以有效地关注和营销每个群体，并最大限度地提高每个客户对企业的价值。</p><p id="4b8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像许多其他学科一样，在商业领域，我们也看到了古老的80-20法则。其中80%的收入来自20%的客户。这就是为什么要增加你的业务，你需要了解你的客户。</p><p id="98d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">客户细分至少有两个主要目标:</p><ol class=""><li id="8201" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">继续为您最好的客户提供最好的服务。</li><li id="cda6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">关注与你的最佳客户相似的潜在客户。</li></ol><h2 id="53d5" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated"><strong class="ak">目录</strong></h2><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="027b" class="mj mk it nd b gy nh ni l nj nk">  ∘ <a class="ae ky" href="#e548" rel="noopener ugc nofollow">RFM Model</a><br/>  ∘ <a class="ae ky" href="#6803" rel="noopener ugc nofollow">Dataset</a><br/>  ∘ <a class="ae ky" href="#87d9" rel="noopener ugc nofollow">Recency, Frequency &amp; Monetary value calculation</a><br/>  ∘ <a class="ae ky" href="#221f" rel="noopener ugc nofollow">RFM score calculation</a><br/>  ∘ <a class="ae ky" href="#a4f5" rel="noopener ugc nofollow">Segmentation based on RFM Score</a><br/>  ∘ <a class="ae ky" href="#aac0" rel="noopener ugc nofollow">Segmentation results</a><br/>  ∘ <a class="ae ky" href="#1ef1" rel="noopener ugc nofollow">Conclusion</a></span></pre><h2 id="e548" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">RFM模型</h2><p id="6639" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated"><a class="ae ky" href="https://en.wikipedia.org/wiki/RFM_(market_research)" rel="noopener ugc nofollow" target="_blank"> RFM代表近期、频率和货币</a>，这是一个高度灵活的管理客户细分模型。</p><p id="51fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文将通过最流行的分布式数据处理框架<a class="ae ky" href="https://spark.apache.org/" rel="noopener ugc nofollow" target="_blank"> PySpark </a>使用RFM模型逐步细分客户群。在未来，我们将看到如何利用机器学习算法(如K-Means)来改善细分过程，甚至尝试预测客户流失。</p><p id="7179" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文中使用的完整代码可以在<a class="ae ky" href="https://github.com/asish012/dataanalytics" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p><h2 id="6803" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated"><strong class="ak">数据集</strong></h2><p id="2865" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">对于本文，我们将使用Kaggle的一个公开的在线零售交易数据集<a class="ae ky" href="https://www.kaggle.com/vijayuv/onlineretail" rel="noopener ugc nofollow" target="_blank">数据集</a>，它包含了来自世界各地的每个客户的交易信息。它包括发票号、发票日期、客户id、产品描述、购买数量和客户居住的国家等信息。为了保持文章简短，我将排除数据探索和数据准备步骤，从一个干净的数据集开始。</p><p id="951d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于超过90%的数据点来自英国，我们将只考虑这些数据点。让我们读取干净的数据集并检查它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/84f33ca719396ac68ddeb7e5c8fa25bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HDLM_lkp1sFAKMxD"/></div></div></figure><h2 id="87d9" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">新近性、频率和货币价值计算</h2><p id="90f3" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">我们首先要计算的是RFM分析的三个关键因素(近期、频率和货币)。</p><ul class=""><li id="a6eb" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nt mb mc md bi translated"><strong class="lb iu">最近度:</strong>顾客购买的时间。</li><li id="2c66" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nt mb mc md bi translated"><strong class="lb iu">频率:</strong>为了简单起见，我们将统计每位顾客购物的次数。</li><li id="2c32" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nt mb mc md bi translated"><strong class="lb iu">货币:</strong>他们总共花了多少钱。</li></ul><p id="cd63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将通过按客户分组来计算这三个关键因素，并将“2011/12/10”作为我们的参考结束日期，因为这是我们数据集中列出的最后一个交易日期。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/99ac5359fbe1aa8577b057813bceb507.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*VWghaWmOH-Z2zx-Qj5VxVw.png"/></div></figure><p id="8ff9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">使用熊猫+海牛探索RFM价值观</strong></p><p id="4473" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们计算出每个客户的个人最近次数、频率和货币价值，我们希望看到分布图来更好地理解数据。不幸的是，Apache Spark不太适合可视化。这就是为什么我们在这部分会用熊猫和Seaborn。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/bd8e64e3618e9712c985864ffb8a7cf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zT9mIR20C5MBSDshQo_IoA.png"/></div></div></figure><h2 id="221f" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">RFM分数计算</h2><p id="6a9b" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">正如我们在图表中看到的，我们的近期、频率和货币价值在不同的尺度和范围上，所有三个指标都是右偏的。对于RFM细分模型来说，这不是问题，但是如果我们想要使用机器学习模型进行细分(我们将在未来这样做)，我们必须将这些数据标准化。</p><p id="9fb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">先说细分。首先，我们将为每个客户分配一个特定的分数，以反映他们个人的近期、频率和货币价值。然后，我们将汇总这些单独的分数，得到一个组合的细分分数。就像大学成绩一样。你个人的科目分数会被转换成科目成绩，然后通过合并个人成绩计算出最终成绩。</p><p id="c543" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将把我们的客户分成三个相等的部分(每个部分33%)，并给每个部分打分，从1到3(最好到最差)。</p><p id="75eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于最近，我们将为最近购买的客户(前33%)分配分数“1”，为中间组分配分数“2”，为第三组分配分数“3”(最后一次购买是在很久以前)。由于最近购买的客户更有可能再次做生意，我们会给他们更高的分数。</p><p id="cfea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是对于频率和金钱，我们会给最后33%的顾客打分“1”，这些顾客购物更频繁，花费更多。并将“3”分配给前33%的购物频率较低且花费较少的客户。</p><p id="6c37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们将得到一个从“111”到“333”(最好到最差)的分段等级，以及一个从3到9的总分数。</p><p id="cc0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的评分矩阵如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/b0e69e883cffca816212c7f7a387c2f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eoCUYfoEsfB8wHNG"/></div></div></figure><p id="a783" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看RFM得分的代码。评分基准将取决于每个指标的百分比。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/1b65c4afff152b112f96c65363004f42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mHM-rtEZIMM9jv_x"/></div></div></figure><p id="1de4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">使用熊猫+海豹探索RFM分数</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/cc6d3cba44ef97429b142f7ef3490200.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EdU3kmYdNQDvwFsK"/></div></div></figure><p id="7712" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们在左图中看到的，我们汇总了客户的个人rfm得分，我们得到了一个分布相当均匀的图表。但是当我们查看元素方面的分数(右图)时，我们看到它们并不是均匀分布的，并且由于聚合，我们丢失了重要的细节。例如，rfm得分“5”(在左图中)可以通过元素得分“212”或“131”或“221”甚至“113”来实现。但它们并不相同。</p><h2 id="a4f5" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">基于RFM分数的分割</h2><p id="d854" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">到目前为止，我们已经计算了我们客户的个人新近度、频率和货币价值，然后是他们单独的r_score、f_score和m_score，最后是一个聚合的rfm-score。我们还保留了元素方面的rfm分数。</p><p id="8d3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，根据业务需求，我们可以按照我们想要的方式划分客户群。但是，为简单起见，我们将根据rfm总分将我们的客户群分为3个部分，并分配一个忠诚度徽章(白金、黄金、白银):</p><ul class=""><li id="a2ee" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nt mb mc md bi translated">第1部分<strong class="lb iu">(白金)</strong>:前33%</li><li id="5bfc" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nt mb mc md bi translated">第二段<strong class="lb iu">(黄金)</strong> : 33% — 66%</li><li id="9da8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nt mb mc md bi translated">第三部分<strong class="lb iu">(银)</strong>:最后33%</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/37d5cdbbf7c077f84e6cafb63a1395ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*owrTUD3BHmZoilmV"/></div></div></figure><p id="2b20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">使用熊猫+海豹来检查我们的3个忠诚度等级</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/e0d245cd8e866fdfb2b0cd412292af73.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/0*oT8Ezo-j_uH4uxGS"/></div></figure><h2 id="aac0" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">检查结果</h2><p id="66e9" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">最后，让我们用分布图来看看分割结果。</p><p id="e75f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有趣的是，当我们观察<em class="ob">近期与货币</em>和<em class="ob">近期与频率</em>图表时，可以观察到我们的<em class="ob">白金</em>和<em class="ob">白银</em>客户之间的明显对比。看起来白金顾客比其他人购物更频繁，花费更多(这很好)。也许银顾客可能已经失去了和我们一起购物的兴趣。他们购物更少，消费更少(这并不太好)。但是，<em class="ob">黄金</em>客户处于中间位置，看起来最近<em class="ob">黄金</em>客户的交易更加活跃。</p><p id="4171" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，从分析中可以得出的结论是，我们需要思考如何才能继续满足我们的白金顾客继续与我们一起购物。我们可能还需要考虑如何影响我们的<em class="ob">黄金</em>客户<em class="ob"> </em>来增加与我们的接触。而且追究那些银卡用户可能为时已晚。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="a76f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">货币与近期</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/6e5d1956f6eff6b03c91395782bece7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hXMgztBzR9HuUykH"/></div></div></figure><p id="002f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">频率与新近度</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/8c540b75787f23262801d84a9986b1df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_67AjXei_R6rwukg"/></div></div></figure><p id="3acc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">货币vs频率</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/a65b1d6fdfce80ed8e3b8cde543ad02e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AsLEJFu6GMxtb1sB"/></div></div></figure></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><h2 id="1ef1" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">结论</h2><p id="66aa" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">RFM细分模型非常有洞察力，是了解你的客户的有力工具。在本文中，我试图展示如何用PySpark实现RMF管理细分模型。我希望这篇文章是有帮助的。我将在以后的帖子中尝试向您展示一种机器学习方法来进行客户细分。</p></div></div>    
</body>
</html>