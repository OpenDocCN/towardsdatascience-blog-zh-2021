<html>
<head>
<title>Simple Plotly Tutorials</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">简单的情节教程</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/simple-plotly-tutorials-868bd0890b8b?source=collection_archive---------9-----------------------#2021-04-07">https://towardsdatascience.com/simple-plotly-tutorials-868bd0890b8b?source=collection_archive---------9-----------------------#2021-04-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="82ff" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><em class="kf">第1部分:创建漂亮的动画地图</em></h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/c41d411ddc63cd1e7e30a2cb6f015fa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SOA1izGcwef7raj79aWyVQ.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">作者图片</p></figure><p id="e9ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">动画地图是可视化和交流具有地理属性的数据的有效方式。在本教程中，您将学习如何在Python中部署Plotly Express包，以快速制作具有交互式功能的精美地图。</p><p id="aed4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Plotly是数据科学家可用的增长最快的可视化库之一，证明了它的易用性和它可以生成的漂亮的图形。这是展示日益复杂的Plotly功能的3个系列教程中的第一个。本期将向您展示如何使用Plotly Express快速制作动画地图。随后的教程将依次关注进一步定制Plotly图形，并在Dash应用程序中可视化它们。</p><h1 id="be27" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">温哥华犯罪数据集</strong></h1><p id="19f7" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在本教程中，我们将使用Kaggle数据集，它提供了加拿大温哥华市不同类型犯罪的数据。</p><p id="9059" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在开始编码之前，您需要在Python中安装以下包。只需在您的终端或Jupyter笔记本中运行以下pip安装程序:</p><ul class=""><li id="cfed" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">pip安装计划</li><li id="153a" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">pip安装geopandas</li></ul><p id="932e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们加载所需的包和数据集。我们可以在读取CSV文件时使用parse_dates参数创建一个<code class="fe ne nf ng nh b">Date</code>列。在这里，我选择使用<code class="fe ne nf ng nh b">MONTH</code>和<code class="fe ne nf ng nh b">YEAR</code>列来创建<code class="fe ne nf ng nh b">Date</code>列，但是如果您愿意，也可以包含<code class="fe ne nf ng nh b">HOUR</code>和<code class="fe ne nf ng nh b">MINUTE</code>列。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="ni nj l"/></div></figure><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nk"><img src="../Images/4a56c3e7f4d5cc89e688708e80ea4e63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*owq3X2ReO2pDFi2tkaTDEg.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">温哥华犯罪数据集的前5行。作者图片</p></figure><p id="d8e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在开始分析之前绘制数据是一个很好的做法，以便发现任何不寻常的情况。当查看<code class="fe ne nf ng nh b">Latitude</code>和<code class="fe ne nf ng nh b">Longitude</code>特征的分布时，我注意到几个0值扰乱了数据的绘制方式——点显示在世界的另一端，使得无法在温哥华可视化数据！</p><p id="8f67" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了本教程的目的，让我们去掉它们，使用一个2000行的样本。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="ni nj l"/></div></figure><h1 id="0618" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">绘制温哥华地图</h1><h2 id="c205" class="nl lt iq bd lu nm nn dn ly no np dp mc lf nq nr me lj ns nt mg ln nu nv mi nw bi translated">1.散点图</h2><p id="06f8" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><strong class="ky ir">“静态”视图</strong></p><p id="5537" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我用Plotly这样的库做任何“花哨”的工作之前，我总是喜欢看我的地图的简单版本，以便对事物应该是什么样子有一种感觉。通常，这涉及到查找shapefile或geojson，温哥华市的开放数据门户<a class="ae mp" href="# https://opendata.vancouver.ca/explore/dataset/local-area-boundary/export/?location=6,47.9237,-119.82788" rel="noopener ugc nofollow">就有这些工具。</a>因为我们将需要geojson文件来绘制choropleth多边形，所以让我们下载它。我们加载带有Geopandas库的geojson，并在其上绘制数据集中的所有事件。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="ni nj l"/></div></figure><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nx"><img src="../Images/b90eae4bf9a5e17c8e9c371c98a7dfe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1_pC6bm6VEvPjdfu-PJRLQ.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">温哥华犯罪类型的分布。作者图片</p></figure><p id="0042" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这看起来很不错，但地图看起来很拥挤，很难获得洞察力。让我们来看看如何使用Plotly Express向我们的观众展示犯罪如何随着时间的推移而演变。</p><p id="9259" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">“动态”视图</strong></p><p id="7e43" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">map box是一种在地图上显示散点数据的服务。因为这是第三方服务，所以您需要为自己生成一个访问令牌，以便显示他们的地图。这可以通过遵循此处的说明<a class="ae mp" href="https://docs.mapbox.com/accounts/guides/tokens/#default-public-access-token" rel="noopener ugc nofollow" target="_blank">轻松完成。你需要做的就是用Mapbox创建一个帐户，然后你就可以访问你的令牌了——整个过程是免费的。一旦有了令牌，只需用自己的替换下面代码块中的“your_token”字符串。</a></p><pre class="kh ki kj kk gt ny nh nz oa aw ob bi"><span id="2298" class="nl lt iq nh b gy oc od l oe of">px.set_mapbox_access_token("your_token")</span></pre><p id="a304" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您现在可以开始了！</p><p id="656c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过将特征设置为<code class="fe ne nf ng nh b">animation_frame</code>，可以快速实现具有Plotly Express功能的动画，它将使用特征的值来子集化和显示您的数据。例如，将<code class="fe ne nf ng nh b">time_col</code>设置为“年”将允许您可视化数据集中所有年份的犯罪，“月”表示所有月份，依此类推。</p><p id="b8c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以通过设置一个<code class="fe ne nf ng nh b">“color”</code>参数来指定散点图的颜色，与海运的<code class="fe ne nf ng nh b">“hue”</code>参数的工作方式相同。默认情况下，传递给<code class="fe ne nf ng nh b">“animate_frame”</code>参数(它决定了地图动画的顺序)的值是不排序的，所以我们添加了一个<code class="fe ne nf ng nh b">“category_orders”</code>参数:一个包含要迭代的值的排序列表。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="222d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">瞧啊。我们有一个很好的互动地图。如果您想显示数据在几个月(或几个小时等)内的变化。)相反，只需更改上面函数中的<code class="fe ne nf ng nh b">time_col</code>参数。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi og"><img src="../Images/459748c2c1b772ed997ebae1a1e56807.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*EuiqvjgGm_CnEDnfwkx3nA.gif"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">温哥华犯罪数据的动画散点图。作者Gif</p></figure><p id="b259" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意事项:</p><ul class=""><li id="8575" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">因为Plotly散点图依赖于Mapbox服务，使用它们的一个很好的优势是，它们会根据您提供的坐标自动显示地图——无需提供地理文件！但是，在显示choropleth地图时，您需要提供一个geojson文件，如下一节所示。</li><li id="af37" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">如gif所示，你可以点击<code class="fe ne nf ng nh b">Type</code>变量中的类别来过滤图上显示的数据点！这提供了很好的初始互动性，可以帮助你引导你如何传达你的见解。</li></ul><h2 id="e51b" class="nl lt iq bd lu nm nn dn ly no np dp mc lf nq nr me lj ns nt mg ln nu nv mi nw bi translated"><strong class="ak"> 2。Choropleth地图</strong></h2><p id="06d9" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><strong class="ky ir">“静态”视图</strong></p><p id="3d63" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">绘制犯罪数据的另一个很好的方法是使用choropleth地图可视化每个街区的事件数量，然后显示这些数字如何随时间演变。当显示choropleth地图时，我们根据想要可视化的基础值给多边形(每个多边形对应一个邻域)着色。在下面的示例中，我们将根据每个面内发生的犯罪事件的数量对其进行着色，较深的着色代表较高的犯罪事件数量，较浅的着色代表较低的犯罪数量。</p><p id="afc2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们绘制任何东西之前，数据集需要一些额外的操作。首先，我注意到geojson和crime数据之间的一些命名差异，所以我重命名了一些街区，以确保它们的名称一致。我还删除了斯坦利公园附近的观测数据，不幸的是，geojson文件中没有这些数据。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="acaf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在可以绘制重新格式化的数据。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="ni nj l"/></div></figure><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi oh"><img src="../Images/a86fbd375e7ccded08e20404856ebd52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OW5etQF6Ive35qYTr7mEMg.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">温哥华社区累积犯罪事件的Choropleth地图。作者图片</p></figure><p id="ff6f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们所见，温哥华的每个街区都由一个多边形表示，其颜色强度与街区内发生的犯罪事件数量成正比。城市北部的街区往往比南部的街区有更高的犯罪率，CBD(中央商务区)街区在整个样本中的犯罪率最高，白色阴影区的街区犯罪率最低。</p><p id="3412" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">“动态”视图</strong></p><p id="d2d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们制作上图的动画。对于每个时间戳，我们希望可视化温哥华不同社区中累积事件的分布。</p><p id="8ddb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在处理最终的数据帧之前，我们需要完成几个额外的步骤，该数据帧将包含数据中每个时间戳每个邻域所有事件的累积总和。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="ni nj l"/></div></figure><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi oi"><img src="../Images/0a7a893c6f53aedf190547ef4fd4e3e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*TERFXk8-M2rbHindBiYUNQ.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">滚动计数数据帧的前5行。作者图片</p></figure><p id="e3de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在这里有一个稍微棘手的部分。如果您查看我们刚刚生成的<code class="fe ne nf ng nh b">counts_rolling</code>数据帧，您会注意到并非所有的邻域都有每个时间戳的值。这是因为某些街区在特定日期没有任何犯罪记录，因此我们需要使用向前填充来填充那些“缺失”的值。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="ni nj l"/></div></figure><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/13fdda1123ee71f8e0f53a2854fc311d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*ZI13AvVty_vax5F2uU40uA.png"/></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">最终犯罪累计金额数据框架预览。作者图片</p></figure><p id="ffae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们有了一个完整的数据帧，其中包含每个时间戳/邻域组合的值。我们终于可以绘制图表了！</p><p id="f520" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了使用Plotly的choropleth_mapbox函数，我们必须确保包含犯罪数量的数据帧和用于绘制地图的geojson具有相同的标识符，以便映射函数可以正确地将每个面与其犯罪数量相关联。这里，我利用<code class="fe ne nf ng nh b">featureidkey</code>参数告诉映射函数多边形标识符位于geojson文件的“properties.name”位置。这些标识符与犯罪数据帧中包含的邻居名称相同。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="ni nj l"/></div></figure><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ok"><img src="../Images/7a0737240a88533acb16bf981442d769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*gmzjUdPpixW5Nc_DbpdphA.gif"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">温哥华犯罪统计动画地图。作者Gif</p></figure><h2 id="3852" class="nl lt iq bd lu nm nn dn ly no np dp mc lf nq nr me lj ns nt mg ln nu nv mi nw bi translated">后续步骤</h2><p id="da59" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">正如我们刚刚看到的，用Plotly制作动画图形是一件轻松快捷的事情。在接下来的教程中，我将展示如何进一步定制Plotly Express图形。例如，我们可能希望选择一个特定的年份，并可视化犯罪在这一年的几个月中的演变。或者，我们可能希望有一个选项来按犯罪类型过滤数据，并可视化其随时间的演变。幸运的是，Plotly使我们可以轻松地在Plotly Express图形的基础上构建，一步一步地添加定制层。在后面的教程中，我们将会看到如何将所有的东西包装成一个漂亮的Dash应用程序！</p></div><div class="ab cl ol om hu on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="ij ik il im in"><p id="c5dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我想对我在数据科学和人工智能精英团队的同事们大声欢呼，感谢他们激励我写这篇博文。特别感谢<a class="ae mp" href="https://medium.com/@violante.andre" rel="noopener"> Andre Violante </a>和<a class="ae mp" href="https://medium.com/@rakshithdl" rel="noopener">Rakshith Dasenahalli linga raju</a>的意见和建议，以及Robert Uleman<strong class="ky ir">极其</strong>彻底的校对和代码改进！</p></div></div>    
</body>
</html>