<html>
<head>
<title>Point clouds in the cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">云中的点云</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/point-clouds-in-the-cloud-b7266da4ff25?source=collection_archive---------13-----------------------#2021-07-09">https://towardsdatascience.com/point-clouds-in-the-cloud-b7266da4ff25?source=collection_archive---------13-----------------------#2021-07-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="30b6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Azure Batch和PDAL按比例处理激光雷达数据</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/558c64b4968faa85796fbc2d1befc4a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_-wKyfMfqcK8RRNpRglDzA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来自开放数据集AHN3的点云样本，用plas.io可视化(图由作者提供)</p></figure><p id="08c5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">点云存在许多许多的x，y，z坐标来描述环境或物体，如建筑物。通过激光技术(LiDAR)获取的点云通常带有额外的测量值和每个坐标的特征。例如，反射强度、返回次数、返回、扫描角度和RGB值。换句话说，点云本质上是海量的数据集。在这里，这些大规模数据集的处理通过使用开源点数据抽象库(PDAL)进行演示，并通过Azure Batch运行。</p><h2 id="a808" class="lr ls iq bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated"><strong class="ak">用PDAL处理</strong></h2><p id="c4a0" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">激光雷达数据的处理在这里用开源库<a class="ae mp" href="https://pdal.io/" rel="noopener ugc nofollow" target="_blank"> PDAL </a>完成。通过该库，点云数据可以与许多不同的格式相互转换(例如，las、laz、geotif、geojson、ascii、pgpointcloud、hdf5、numpy、tiledDB、ept等，以及专有数据格式)。此外，该库支持对数据进行<a class="ae mp" href="https://pdal.io/stages/filters.html" rel="noopener ugc nofollow" target="_blank">过滤</a>操作，如重投影、分类、过滤、DEM和网格创建等。PDAL可以作为一个应用程序独立执行，还有一个Python <a class="ae mp" href="https://pypi.org/project/PDAL/" rel="noopener ugc nofollow" target="_blank"> PDAL扩展</a>，这样PDAL就可以成为你的Python应用程序的一部分。这为将自己的处理逻辑或过滤器合并到激光雷达处理中提供了灵活性。PDAL扩展使用以json格式定义并通过pdal实现执行的管道。以下管道示例说明了以下所有依赖于PDAL内置功能的步骤:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/77df6a0edfaf96fd8a58651e2bba59bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*FUzDsqyW3M5VTjA2Yw_ZGw.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">PDAL管道示例(作者提供的图片)</p></figure><p id="20c7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">-读取输入las或laz文件，带有设定的参考投影(此处为EPSG:28992，荷兰的投影坐标系)，</p><p id="d6be" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">-应用filters.csf(布料模拟过滤器，张等2016)对地面和非地面点进行分类，</p><p id="c356" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">-应用只选择接地回路的滤波器，</p><p id="8d1b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">-将过滤后的数据写入las文件</p><p id="488c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">此管道使用AHN3的样本数据集执行，Ahn 3是荷兰全国激光雷达开放数据集的第三版，位于南林堡地区。下面是使用<a class="ae mp" href="https://plas.io/" rel="noopener ugc nofollow" target="_blank"> plas.io </a>创建的两个视觉效果，a)原始数据集，b)使用管道创建的数据集，显示地面返回，基于【】张等人2016 的<a class="ae mp" href="https://pdal.io/stages/filters.csf.html#filters-csf" rel="noopener ugc nofollow" target="_blank">实现</a>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/b2af7e2c0b07c1bfa23d6591abe8bd69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kQ1uUx_bPDZlMKmwj7Iv3w.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来自开放数据集AHN3的点云样本，用plas.io可视化(图由作者提供)</p></figure><h2 id="8949" class="lr ls iq bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated"><strong class="ak">用天蓝色批秤</strong></h2><p id="9483" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">由于数据量和应用于数据的算法类型，处理激光雷达数据是计算密集型的。扩展处理可能是一个挑战。<a class="ae mp" href="https://docs.microsoft.com/en-us/azure/batch/batch-technical-overview" rel="noopener ugc nofollow" target="_blank"> Azure Batch </a>是在Azure中高效运行大规模并行和高性能计算(HPC)批处理作业的服务。Azure Batch创建并管理计算节点(虚拟机)池，安装要运行的应用程序，并调度要在节点上运行的作业。在这里，应用程序将是处理激光雷达数据的(Python)脚本。Azure Batch可以通过Azure门户、Azure Batch APIs和Azure Batch SDKs进行管理。由于地理空间和地球科学领域的许多开发人员和研究人员都熟悉Python，这里使用了Azure Batch Python SDK。</p><p id="3c20" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下图描述了一般概念。通过一个本地Python客户端，Azure批处理计算池在一个已经存在的Azure资源组中提供，该资源组具有一个存储帐户和一个Azure批处理帐户。使用客户端(1)将应用/脚本和数据上传到blob存储器。在下图中)。然后，使用提供的Azure批处理帐户凭据，将创建一个计算池，并提交任务和作业(2)。通过这样做，计算池将应用和数据拉至计算节点，执行处理，并将结果推回blob存储(3)。为了更好地理解这个概念的实现，这篇博客文章附有一个PDAL在Azure Batch上的工作示例<a class="ae mp" href="https://github.com/delange/lidar-batch-python/tree/master/lidar-batch-python/src" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir"> GitHub repo </strong> </a>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/3f24968946f98504dde809f80875ccb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jklHcEpKd6jqFQcWT_5VUw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Azure Batch的常规设置。1)本地客户端将数据和应用程序文件上传到Azure Blob存储，2)使用Azure Batch的Python SDK，本地客户端开始创建Azure批处理池，然后可以添加Azure批处理作业以在LiDAR文件上运行，3) Azure Batch自动调度作业和任务，执行处理并将输出文件上传到Azure Blob存储。(图由作者提供)</p></figure><p id="2c71" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了与Azure storage和Azure Batch正确通信，客户端环境需要两个Python库，它们是azure-batch和azure-storage-blob(这里分别使用10.0.0和12.8.1版本)。</p><p id="7eaf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">针对激光雷达数据运行的应用程序/ Python脚本需要PDAL库，建议从conda-forge安装。在Azure Batch Pool的初始化过程中，首先会下载一个(迷你)conda环境，以静默模式安装并初始化，这是通过StartTask.sh完成的——在上图的步骤2中(有关技术解释和示例，请参见<a class="ae mp" href="https://github.com/delange/lidar-batch-python/tree/master/lidar-batch-python/src" rel="noopener ugc nofollow" target="_blank"> repo </a>)。</p><p id="6c17" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">创建Azure池后，可以提交作业。对于每个输入激光雷达文件，将执行包括PDAL管道在内的Python脚本，并将输出las文件上传到Azure blob存储以实现持久性。</p><p id="b515" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">根据LiDAR文件的大小和数量，以及要运行的管道的复杂性，您可以创建小型(1个节点)到非常大(&gt; 1000个节点)的Azure批处理池，可以打开也可以不打开自动缩放选项。这只需要重新调整池的规模，Azure Batch会处理作业调度和管理，因此提供的代码可以用于大型和小型批处理作业，而无需对代码本身进行任何更改。</p><p id="1ac1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这里的意见是我的。</p><h2 id="37e5" class="lr ls iq bd lt lu lv dn lw lx ly dp lz le ma mb mc li md me mf lm mg mh mi mj bi translated"><strong class="ak">参考文献</strong>:</h2><p id="ac55" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">Azure Batch和PDAL代码示例:<a class="ae mp" href="https://github.com/delange/lidar-batch-python/tree/master/lidar-batch-python/src" rel="noopener ugc nofollow" target="_blank">https://github . com/de lange/lidar-Batch-python/tree/master/lidar-Batch-python/src</a></p><p id="b971" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">azure Batch:<a class="ae mp" href="https://docs.microsoft.com/en-us/azure/batch/batch-technical-overview" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/Batch/Batch-technical-overview</a></p><p id="f8f5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Azure批处理浏览器:<a class="ae mp" href="https://azure.github.io/BatchExplorer/" rel="noopener ugc nofollow" target="_blank">https://azure.github.io/BatchExplorer/</a></p><p id="b76d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">用于激光雷达处理的PDAL:<a class="ae mp" href="https://pdal.io/" rel="noopener ugc nofollow" target="_blank">https://pdal.io/</a></p><p id="8a80" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">浏览器中点云渲染的plas io:<a class="ae mp" href="https://plas.io" rel="noopener ugc nofollow" target="_blank">https://plas . io</a></p><p id="96b8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">https://www.ahn.nl/国家激光雷达开放数据集AHN: <a class="ae mp" href="https://www.ahn.nl/" rel="noopener ugc nofollow" target="_blank">荷兰</a></p><p id="7e0c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一种基于布料模拟的简易机载激光雷达数据滤波方法。<em class="mt">遥感</em>。2016;8(6):501.https://doi.org/10.3390/rs8060501<a class="ae mp" href="https://www.mdpi.com/2072-4292/8/6/501/htm" rel="noopener ugc nofollow" target="_blank"/><a class="ae mp" href="https://doi.org/10.3390/rs8060501" rel="noopener ugc nofollow" target="_blank">https://www.mdpi.com/2072-4292/8/6/501/htm</a></p></div></div>    
</body>
</html>