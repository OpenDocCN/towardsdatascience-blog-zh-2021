<html>
<head>
<title>Patsy: Build Powerful Features with Arbitrary Python Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Patsy:用任意Python代码构建强大的特性</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/patsy-build-powerful-features-with-arbitrary-python-code-bb4bb98db67a?source=collection_archive---------8-----------------------#2021-08-14">https://towardsdatascience.com/patsy-build-powerful-features-with-arbitrary-python-code-bb4bb98db67a?source=collection_archive---------8-----------------------#2021-08-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fe56" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一行代码中的数据转换</h2></div><h1 id="3be4" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">动机</h1><p id="d93d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">有时，您可能想要试验各种功能的组合来创建一个好的模型。然而，这通常需要额外的工作来将特征转换成可以被scikit-learn的模型使用的数组。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi lw"><img src="../Images/d4e8c5bafee521255e9cfaaf9bbc34ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qB5e2Wlr04N5J0K-isSp2Q.png"/></div></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者图片</p></figure><p id="0b1a" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">如果可以使用任意Python代码快速创建要素，那不是很好吗？这时候Patsy就派上用场了。</p><h1 id="a905" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">Patsy是什么？</h1><p id="6fff" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><a class="ae mr" href="https://patsy.readthedocs.io/en/latest/overview.html" rel="noopener ugc nofollow" target="_blank"> Patsy </a>是一个Python库，允许使用任意Python代码进行数据转换。</p><p id="bafe" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">对于Patsy，您可以使用人类可读的语法，如<code class="fe ms mt mu mv b">life_expectancy ~ income_group + year + region</code>(预期寿命取决于收入群体、年份和地区)。</p><p id="6e2e" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">要安装Patsy，请键入:</p><pre class="lx ly lz ma gt mw mv mx my aw mz bi"><span id="a9fd" class="na kj it mv b gy nb nc l nd ne">pip install patsy</span></pre><h1 id="a161" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">入门指南</h1><p id="b4c5" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了测试这个库，我们将使用来自Kaggle 的<a class="ae mr" href="https://www.kaggle.com/shitalgaikwad123/life-expectancy-at-birth-for-different-countries" rel="noopener ugc nofollow" target="_blank">不同国家出生时预期寿命数据集。为了便于我们观察输出，我们将只取原始数据的一个子集。</a></p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nh"><img src="../Images/0fc2ccb4bfa3f9abaa22d61358a8fc33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8x743JkXmaj5VCtJlpSLkg.png"/></div></div><p class="mi mj gj gh gi mk ml bd b be z dk translated"><a class="ae mr" href="https://datapane.com/u/khuyentran1401/reports/0kzZNyk/patsy/?block_name=life_expectancy" rel="noopener ugc nofollow" target="_blank">查看数据</a></p></figure><p id="c4d0" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">我们的任务是预测一个地区在特定年份的预期寿命。</p><p id="1cae" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">由于收入群体、地区和年份可能在决定预期寿命方面起很大作用，我们将使用Patsy将这3个特征转换成一个矩阵。</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="d234" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">在上面的代码中，</p><ul class=""><li id="412e" class="ni nj it lc b ld mm lg mn lj nk ln nl lr nm lv nn no np nq bi translated"><code class="fe ms mt mu mv b">outcome</code>是一个代表<code class="fe ms mt mu mv b">life_expectancy</code>的<code class="fe ms mt mu mv b">DesignMatrix</code>对象，T3是我们要预测的变量</li></ul><pre class="lx ly lz ma gt mw mv mx my aw mz bi"><span id="b8bf" class="na kj it mv b gy nb nc l nd ne">&gt;&gt;&gt; outcome</span><span id="e36e" class="na kj it mv b gy nr nc l nd ne">DesignMatrix with shape (140, 1)<br/>  life_expectancy<br/>         60.73805<br/>         59.74837<br/>         68.94266<br/>         46.45793<br/>         54.71871<br/>  [135 rows omitted]<br/>  Terms:<br/>    'life_expectancy' (column 0)<br/>  (to view full data, use np.asarray(this_obj))</span></pre><ul class=""><li id="9e2c" class="ni nj it lc b ld mm lg mn lj nk ln nl lr nm lv nn no np nq bi translated"><code class="fe ms mt mu mv b">predictors</code>是一个<code class="fe ms mt mu mv b">DesignMatrix</code>对象，代表<code class="fe ms mt mu mv b">income_group</code>、<code class="fe ms mt mu mv b">region</code>和<code class="fe ms mt mu mv b">year</code>的组合</li></ul><pre class="lx ly lz ma gt mw mv mx my aw mz bi"><span id="a055" class="na kj it mv b gy nb nc l nd ne">&gt;&gt;&gt; predictors</span><span id="dc88" class="na kj it mv b gy nr nc l nd ne">DesignMatrix with shape (140, 11)<br/>  Columns:<br/>    ['Intercept',<br/>     'income_group[T.Low income]',<br/>     'income_group[T.Lower middle income]',<br/>     'income_group[T.Upper middle income]',<br/>     'region[T.Europe &amp; Central Asia]',<br/>     'region[T.Latin America &amp; Caribbean]',<br/>     'region[T.Middle East &amp; North Africa]',<br/>     'region[T.North America]',<br/>     'region[T.South Asia]',<br/>     'region[T.Sub-Saharan Africa]',<br/>     'year']<br/>  Terms:<br/>    'Intercept' (column 0)<br/>    'income_group' (columns 1:4)<br/>    'region' (columns 4:10)<br/>    'year' (column 10)<br/>  (to view full data, use np.asarray(this_obj))</span></pre><p id="c8df" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">酷！似乎我们得到了一个形状的特征矩阵<code class="fe ms mt mu mv b">(140, 11)</code>。<code class="fe ms mt mu mv b">140</code>表示有140个例子，<code class="fe ms mt mu mv b">11</code>表示有11个特征。这11个特征是:</p><ul class=""><li id="aa42" class="ni nj it lc b ld mm lg mn lj nk ln nl lr nm lv nn no np nq bi translated">Intercept(第0列)—1的数组</li><li id="c20b" class="ni nj it lc b ld ns lg nt lj nu ln nv lr nw lv nn no np nq bi translated"><code class="fe ms mt mu mv b">income_group</code>(第1至第4栏)</li><li id="390c" class="ni nj it lc b ld ns lg nt lj nu ln nv lr nw lv nn no np nq bi translated"><code class="fe ms mt mu mv b">region</code>(第4至10栏)</li><li id="3ae5" class="ni nj it lc b ld ns lg nt lj nu ln nv lr nw lv nn no np nq bi translated"><code class="fe ms mt mu mv b">year</code>(第10列)</li></ul><p id="2f2c" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">为什么<code class="fe ms mt mu mv b">income_group</code>和<code class="fe ms mt mu mv b">regions</code>特性有额外的列？这是因为Patsy使用<a class="ae mr" href="https://hackernoon.com/what-is-one-hot-encoding-why-and-when-do-you-have-to-use-it-e3c6186d008f" rel="noopener ugc nofollow" target="_blank">一键编码</a>对这些分类特征进行编码，因此它们可以被机器学习模型解释。</p><p id="1d5a" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">这意味着，分类列:</p><pre class="lx ly lz ma gt mw mv mx my aw mz bi"><span id="23ee" class="na kj it mv b gy nb nc l nd ne">   income_group<br/>1. low_income   <br/>2. upper_middle_income<br/>3. lower_middle_income<br/>4. low_income<br/>5. upper_middle_income</span></pre><p id="00c0" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">…将被转换为0和1的矩阵:</p><pre class="lx ly lz ma gt mw mv mx my aw mz bi"><span id="eee2" class="na kj it mv b gy nb nc l nd ne">   low_income  lower_middle_income  upper_middle_income<br/>1.     1               0                     0<br/>2.     0               0                     1<br/>3.     0               1                     0<br/>4.     1               0                     0<br/>5.     0               0                     1                                </span></pre><h2 id="c512" class="na kj it bd kk nx ny dn ko nz oa dp ks lj ob oc ku ln od oe kw lr of og ky oh bi translated">好吧，我知道用Patsy创建功能有多简单了。但是我如何使用这些功能呢？</h2><p id="ff9f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Patsy创建的功能可以很容易地被scikit-learn等流行的机器学习库使用。换句话说，你可以把<strong class="lc iu"> </strong> <code class="fe ms mt mu mv b"><strong class="lc iu">DesignMatrix</strong></code> <strong class="lc iu">对象当作一个NumPy数组。</strong></p><p id="5e3d" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">这意味着您可以使用<code class="fe ms mt mu mv b">train_test_split</code>将<code class="fe ms mt mu mv b">DesignMatrix</code>对象分为训练集和测试集:</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="8033" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">…并将训练集和测试集提供给机器学习模型。</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="e5f3" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">我们将使用<a class="ae mr" rel="noopener" target="_blank" href="/introduction-to-yellowbrick-a-python-library-to-explain-the-prediction-of-your-machine-learning-d63ecee10ecc"> Yellowbrick </a>的预测误差图来比较实际目标和我们的模型生成的预测值。</p><p id="c03d" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">要安装Yellowbrick，请键入:</p><pre class="lx ly lz ma gt mw mv mx my aw mz bi"><span id="cc96" class="na kj it mv b gy nb nc l nd ne">pip install yellowbrick</span></pre><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/e052a52c2e9aed4ea7798deeb1041914.png" data-original-src="https://miro.medium.com/v2/resize:fit:742/format:webp/1*Ld2T7bXUQUQftGXUIZk15A.png"/></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者图片</p></figure><p id="2dfc" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">在上面的图中，</p><ul class=""><li id="0289" class="ni nj it lc b ld mm lg mn lj nk ln nl lr nm lv nn no np nq bi translated">y是代表真实值的轴</li><li id="5def" class="ni nj it lc b ld ns lg nt lj nu ln nv lr nw lv nn no np nq bi translated">ŷ是表示预测值的轴</li><li id="9eb3" class="ni nj it lc b ld ns lg nt lj nu ln nv lr nw lv nn no np nq bi translated">黑色虚线是由当前模型创建的拟合线</li><li id="2f40" class="ni nj it lc b ld ns lg nt lj nu ln nv lr nw lv nn no np nq bi translated">如果预测值与实际值完全匹配，灰色虚线表示拟合线的位置</li></ul><p id="0151" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">线性模型很好地跟踪了观察到的目标。R分是0.911。让我们创建一个函数，这样我们就可以观察给定方程的拟合线。</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="4838" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">如果我们仅使用<code class="fe ms mt mu mv b">income_group</code>列预测目标值，会发生什么情况？</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/8af43088e71e3d9021d78fc8f54f1075.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*NpDU46CQ8U_oZI7G0LZ4wQ.png"/></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者图片</p></figure><p id="cc66" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">R分相当低。我们可以通过组合<code class="fe ms mt mu mv b">income_group</code>列和<code class="fe ms mt mu mv b">region</code>列来看输出是否更好:</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/b2700dbbad9258ee277955b45179a642.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*hDRMnfg8vWOUKMreZQSurg.png"/></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者图片</p></figure><p id="d77b" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">输出看起来也不是很好。让我们试着把<code class="fe ms mt mu mv b">income_group</code>和<code class="fe ms mt mu mv b">year</code>结合起来:</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/915cb8d91a2259d9e41462c1232f78ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*UWfdUWgUrBCKkiJ-arq6Pg.png"/></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者图片</p></figure><p id="ffee" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">啊哈！结合<code class="fe ms mt mu mv b">income_group</code>和<code class="fe ms mt mu mv b">year</code>功能可以产生非常好的结果。这可能是因为收入群体和年份强烈影响一个国家一年的预期寿命。</p><h1 id="d9d4" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">内置函数</h1><p id="fe2e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">有时，我们可能希望对某个特性进行额外的处理，比如缩放或标准化。幸运的是，Patsy提供了内置函数，使我们可以轻松地做到这一点。</p><p id="4874" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">为了演示这些函数，让我们切换到<a class="ae mr" href="https://www.scikit-yb.org/en/latest/api/datasets/bikeshare.html" rel="noopener ugc nofollow" target="_blank"> Bikeshare数据集</a>并仅从数据中提取2k个样本。</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ol"><img src="../Images/dac587736f5fcbca1e3df04a2556fe35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pJAq1GPNcUS9mUIT1kz2Wg.png"/></div></div><p class="mi mj gj gh gi mk ml bd b be z dk translated"><a class="ae mr" href="https://datapane.com/u/khuyentran1401/reports/0kzZNyk/patsy/?block_name=bikeshare" rel="noopener ugc nofollow" target="_blank">查看数据</a></p></figure><p id="a63a" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">注意列<code class="fe ms mt mu mv b">season</code>、<code class="fe ms mt mu mv b">year</code>、<code class="fe ms mt mu mv b">month</code>、<code class="fe ms mt mu mv b">hour</code>、<code class="fe ms mt mu mv b">holiday</code>、<code class="fe ms mt mu mv b">workingday</code>和<code class="fe ms mt mu mv b">weather</code>是分类变量。然而，由于它们的数据类型是整数，Patsy认为它们是数字变量。</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nf ng l"/></div></figure><pre class="lx ly lz ma gt mw mv mx my aw mz bi"><span id="7848" class="na kj it mv b gy nb nc l nd ne">DesignMatrix with shape (2000, 4)<br/>  Intercept  year  hour  temp<br/>          1     0     4  0.58<br/>          1     1     0  0.46<br/>          1     0     0  0.44<br/>          1     1     7  0.64<br/>          1     1     3  0.44<br/>  [1995 rows omitted]<br/>  Terms:<br/>    'Intercept' (column 0)<br/>    'year' (column 1)<br/>    'hour' (column 2)<br/>    'temp' (column 3)<br/>  (to view full data, use np.asarray(this_obj))</span></pre><h2 id="d1c3" class="na kj it bd kk nx ny dn ko nz oa dp ks lj ob oc ku ln od oe kw lr of og ky oh bi translated">指定分类变量</h2><p id="05cf" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了解决上面的问题，我们可以使用<code class="fe ms mt mu mv b">C(column)</code>将一些列指定为分类列:</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nf ng l"/></div></figure><pre class="lx ly lz ma gt mw mv mx my aw mz bi"><span id="4177" class="na kj it mv b gy nb nc l nd ne">DesignMatrix with shape (2000, 26)<br/>  Columns:<br/>    ['Intercept',<br/>     'C(year)[T.1]',<br/>     'C(hour)[T.1]',<br/>     'C(hour)[T.2]',<br/>     ....<br/>     'C(hour)[T.22]',<br/>     'C(hour)[T.23]',<br/>     'temp']<br/>  Terms:<br/>    'Intercept' (column 0)<br/>    'C(year)' (column 1)<br/>    'C(hour)' (columns 2:25)<br/>    'temp' (column 25)<br/>  (to view full data, use np.asarray(this_obj))</span></pre><p id="45d5" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">这些特征现在得到了更好的表现。</p><h2 id="bf6f" class="na kj it bd kk nx ny dn ko nz oa dp ks lj ob oc ku ln od oe kw lr of og ky oh bi translated">使标准化</h2><p id="c3c9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们还可以通过使用<code class="fe ms mt mu mv b">standardize</code>方法来标准化特定特征(减去平均值并除以标准偏差):</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="9548" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">该功能将转换<code class="fe ms mt mu mv b">humidity</code>的初始分布:</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi om"><img src="../Images/8c53ba2813814b6790299cb3abfc0ce3.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*NRbLqaQMK8YL4qJWprUmWw.png"/></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者图片</p></figure><p id="ce4f" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">…对于该发行版:</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi on"><img src="../Images/6b684d8f4dcffcda56de2df0a97804f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*xQp_3STTzBRLjNdHQ10vJQ.png"/></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者图片</p></figure><p id="993a" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">你可以在这里找到Patsy提供的其他内置方法<a class="ae mr" href="https://patsy.readthedocs.io/en/latest/builtins-reference.html" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="422a" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">自定义功能</h1><p id="1a4d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">除了内置函数之外，您还可以编写自己的函数，例如将一列乘以二:</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="389d" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated"><code class="fe ms mt mu mv b">temp</code>功能的前5行:</p><pre class="lx ly lz ma gt mw mv mx my aw mz bi"><span id="f149" class="na kj it mv b gy nb nc l nd ne">  temp<br/>  0.58<br/>  0.46<br/>  0.44<br/>  0.64<br/>  0.44</span></pre><p id="b71b" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated"><code class="fe ms mt mu mv b">multiply_by_two(temp)</code>特征的前5行:</p><pre class="lx ly lz ma gt mw mv mx my aw mz bi"><span id="fc67" class="na kj it mv b gy nb nc l nd ne">  multiply_by_two(temp)<br/>  1.16<br/>  0.92<br/>  0.88<br/>  1.28<br/>  0.88</span></pre><h1 id="4698" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">经营者</h1><p id="1c36" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">除了<code class="fe ms mt mu mv b">+</code>操作符，您可以使用其他操作符以其他方式组合特征。</p><p id="8963" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated"><code class="fe ms mt mu mv b"><strong class="lc iu">-</strong></code> <strong class="lc iu">操作员</strong></p><p id="b696" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">该运算符用于删除右边的术语。例如，使用<code class="fe ms mt mu mv b">month + temp — 1</code>将删除截距:</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nf ng l"/></div></figure><pre class="lx ly lz ma gt mw mv mx my aw mz bi"><span id="680b" class="na kj it mv b gy nb nc l nd ne">DesignMatrix with shape (2000, 2)<br/>  month  temp<br/>      9  0.58<br/>     10  0.46<br/>      5  0.44<br/>      6  0.64<br/>      1  0.44<br/>  [1995 rows omitted]<br/>  Terms:<br/>    'month' (column 0)<br/>    'temp' (column 1)<br/>  (to view full data, use np.asarray(this_obj))</span></pre><p id="6dbd" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated"><code class="fe ms mt mu mv b"><strong class="lc iu">:</strong></code> <strong class="lc iu">操作员</strong></p><p id="52bc" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">该运算符计算左侧和右侧每一项之间的相互作用。例如，使用<code class="fe ms mt mu mv b">riders ~ month:temp</code>会将<code class="fe ms mt mu mv b">month</code>列中的值除以<code class="fe ms mt mu mv b">temp</code>列中的值。</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nf ng l"/></div></figure><pre class="lx ly lz ma gt mw mv mx my aw mz bi"><span id="b0da" class="na kj it mv b gy nb nc l nd ne">DesignMatrix with shape (2000, 2)<br/>  Intercept  month:temp<br/>          1        5.22<br/>          1        4.60<br/>          1        2.20<br/>          1        3.84<br/>          1        0.44<br/>  [1995 rows omitted]<br/>  Terms:<br/>    'Intercept' (column 0)<br/>    'month:temp' (column 1)</span></pre><p id="ef8f" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">如果每边有多个项，左边的每个项将被右边的每个项除。举个例子，</p><pre class="lx ly lz ma gt mw mv mx my aw mz bi"><span id="f600" class="na kj it mv b gy nb nc l nd ne">(C(year) + C(hour) + C(workingday)) : temp</span></pre><p id="8c2c" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">扩展为:</p><pre class="lx ly lz ma gt mw mv mx my aw mz bi"><span id="cb6a" class="na kj it mv b gy nb nc l nd ne">C(year):temp + C(hour):temp + C(workingday):temp</span></pre><p id="f87a" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">让我们画出上面的等式，看看输出是什么样子的:</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/ab33ec3635cca0eab344e19154cefab7.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*ZS2M2404BiuyOaN67Lepeg.png"/></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者图片</p></figure><p id="550e" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">我们得到了0.709的R值。这是一个相当不错的分数！</p><p id="68de" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated"><code class="fe ms mt mu mv b"><strong class="lc iu">*</strong></code> <strong class="lc iu">操作员</strong></p><p id="61e1" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated"><code class="fe ms mt mu mv b">a:b</code>包括<code class="fe ms mt mu mv b">a</code>和<code class="fe ms mt mu mv b">b</code>之间的互动，但不包括<code class="fe ms mt mu mv b">a</code>和<code class="fe ms mt mu mv b">b</code>本身的特性。如果你想既包括变量又包括变量之间的相互作用，使用<code class="fe ms mt mu mv b">a * b</code>。</p><p id="3c5a" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">举个例子，</p><pre class="lx ly lz ma gt mw mv mx my aw mz bi"><span id="193b" class="na kj it mv b gy nb nc l nd ne">month * temp</span></pre><p id="cb0c" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">是以下内容的简写:</p><pre class="lx ly lz ma gt mw mv mx my aw mz bi"><span id="6977" class="na kj it mv b gy nb nc l nd ne">month + temp + month:temp</span></pre><p id="4dfa" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated"><code class="fe ms mt mu mv b"><strong class="lc iu">**</strong></code> <strong class="lc iu">操作员</strong></p><p id="4935" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">这个操作符用自身计算一组术语的<code class="fe ms mt mu mv b">*</code>n次。</p><p id="ff0e" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">举个例子，</p><pre class="lx ly lz ma gt mw mv mx my aw mz bi"><span id="7e22" class="na kj it mv b gy nb nc l nd ne">(temp + humidity + windspeed)**3</span></pre><p id="4fd2" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">扩展为:</p><pre class="lx ly lz ma gt mw mv mx my aw mz bi"><span id="d06d" class="na kj it mv b gy nb nc l nd ne">(temp + humidity + windspeed) * (temp + humidity + windspeed) * (temp + humidity + windspeed)</span></pre><p id="ec58" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">让我们画出方程式<code class="fe ms mt mu mv b">riders ~ (C(year) + C(hour) + C(workingday) + temp) ** 3</code>，看看它看起来是什么样子:</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi op"><img src="../Images/6d9002b0e37d9f81281d41cfc995a423.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*h6SycWchnt1eytt-eFT54g.png"/></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者图片</p></figure><p id="2bda" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">哇！我们得到了0.812的R，这是一个非常好的分数。这是否意味着拥有更多的功能会产生更好的输出？让我们试着把<code class="fe ms mt mu mv b">3</code>换成<code class="fe ms mt mu mv b">6</code>，看看会发生什么。</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/5163a4507d5ff3282780f2c50e7c06da.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*mk3Usv4tAGJoo56xflYd3w.png"/></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">作者图片</p></figure><p id="ecd1" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">不完全是。拥有更多的特性会导致过度拟合，所以增加更多的特性并不一定更好。</p><p id="9911" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">你可以在这里找到所有的操作符及其用法<a class="ae mr" href="https://patsy.readthedocs.io/en/latest/formulas.html#operators" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="51d5" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">结论</h1><p id="380f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">恭喜你！您刚刚学习了如何使用Patsy用任意Python代码构建特性。我希望这个工具能让您更容易地试验不同的特性组合，并理解它们对输出的影响。</p><p id="4374" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">随意发挥，并在这里叉源代码:</p><div class="or os gp gr ot ou"><a href="https://github.com/khuyentran1401/Data-science/blob/master/statistics/patsy_example.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">数据科学/patsy _ example . ipynb at master khuyentran 1401/数据科学</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">收集有用的数据科学主题以及代码和文章-Data-science/patsy _ example . ipynb at master…</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">github.com</p></div></div><div class="pd l"><div class="pe l pf pg ph pd pi mg ou"/></div></div></a></div></div><div class="ab cl pj pk hx pl" role="separator"><span class="pm bw bk pn po pp"/><span class="pm bw bk pn po pp"/><span class="pm bw bk pn po"/></div><div class="im in io ip iq"><p id="0a5c" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">我喜欢写一些基本的数据科学概念，并尝试不同的算法和数据科学工具。你可以在LinkedIn和Twitter上与我联系。</p><p id="c660" class="pw-post-body-paragraph la lb it lc b ld mm ju lf lg mn jx li lj mo ll lm ln mp lp lq lr mq lt lu lv im bi translated">如果你想查看我写的所有文章的代码，请点击这里。在Medium上关注我，了解我的最新数据科学文章，例如:</p><div class="or os gp gr ot ou"><a rel="noopener follow" target="_blank" href="/kats-a-generalizable-framework-to-analyze-time-series-data-in-python-3c8d21efe057"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">kats:Python中分析时间序列数据的通用框架</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">预测、检测变化点、异常，并获得时间序列中的关键统计数据</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">towardsdatascience.com</p></div></div><div class="pd l"><div class="pq l pf pg ph pd pi mg ou"/></div></div></a></div><div class="or os gp gr ot ou"><a rel="noopener follow" target="_blank" href="/how-to-solve-a-production-planning-and-inventory-problem-in-python-45c546f4bcf0"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">如何用Python解决生产计划和库存问题</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">为了使生产和库存成本最小化，你每天应该生产多少件？</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">towardsdatascience.com</p></div></div><div class="pd l"><div class="pr l pf pg ph pd pi mg ou"/></div></div></a></div><div class="or os gp gr ot ou"><a rel="noopener follow" target="_blank" href="/how-to-schedule-flights-in-python-3357b200db9e"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">如何在Python中安排航班</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">使用CVXPY分配足够的飞机，同时最小化成本</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">towardsdatascience.com</p></div></div><div class="pd l"><div class="ps l pf pg ph pd pi mg ou"/></div></div></a></div><div class="or os gp gr ot ou"><a rel="noopener follow" target="_blank" href="/human-learn-create-rules-by-drawing-on-the-dataset-bcbca229f00"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">人类学习:通过绘图创建人类学习模型</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">使用您的领域知识来标记您的数据</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">towardsdatascience.com</p></div></div><div class="pd l"><div class="pt l pf pg ph pd pi mg ou"/></div></div></a></div></div></div>    
</body>
</html>