<html>
<head>
<title>Deploy multiple Flask Applications using Nginx and Gunicorn</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Nginx和Gunicorn部署多个Flask应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploy-multiple-flask-applications-using-nginx-and-gunicorn-16f8f7865497?source=collection_archive---------7-----------------------#2021-07-03">https://towardsdatascience.com/deploy-multiple-flask-applications-using-nginx-and-gunicorn-16f8f7865497?source=collection_archive---------7-----------------------#2021-07-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/230a878552339fe1cf32d33daf9568ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XBktsimICRx2AbHA3vRNYQ.jpeg"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">来自<a class="ae kc" href="https://www.pexels.com/photo/close-up-photo-of-mining-rig-1148820/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae kc" href="https://www.pexels.com/@cookiecutter?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> panumas nikhomkhai </a>的照片</p></figure><p id="3860" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇博文是关于如何使用Nginx和Gunicorn在Linux服务器上部署多个Flask应用程序的分步教程。</p><p id="7bae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本教程中，我假设您已经有了一个可以使用IP地址ssh到的服务器。我还假设你对创建Flask应用程序有基本的了解，因为我不会详细讨论。</p><p id="7828" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在本教程中使用的VPS运行在Ubuntu上。其实，如果你想知道如何购买和配置一个VPS，你可以查看这个<a class="ae kc" href="https://www.youtube.com/watch?v=goToXTC96Co&amp;ab_channel=CoreySchafer" rel="noopener ugc nofollow" target="_blank">视频</a>。此外，如果您不熟悉创建Flask应用程序，您可以查看此<a class="ae kc" href="https://flask.palletsprojects.com/en/1.1.x/quickstart/" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="a6c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们开始吧！</p><h1 id="a1c6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">本地机器:</h1><p id="868e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在我的本地机器上，我有一个Flask应用程序，我想把它部署在我的远程VPS上，(实际上我有两个应用程序，但是现在让我们只关注一个应用程序)。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi me"><img src="../Images/61855652fc9985873b487fcb43bbb44b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*rkR9x9vKTXV866Ntxh1ZQA.jpeg"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">图片来自memegenerator.net</p></figure><p id="f2c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我的应用程序位于一个名为<em class="mj">“chatbot”</em>的目录下，其中包含了主Flask app文件<em class="mj"> (app.py) </em>，我的虚拟环境<em class="mj"> (chatvenv) </em>，以及一些帮助文件。因此，在我的本地机器上，我使用<code class="fe mk ml mm mn b">scp</code>命令将我项目的所有文件复制到远程服务器上。</p><p id="c3ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ scp -r Desktop/chatbot ubuntu@IP_ADDRESS:~/</code></p><p id="4844" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">⚠️请记住，根据您的服务器配置，可能会要求您提供密码。此外，请确保您更改了本地路径，以及远程服务器的用户名和IP地址！</p><h1 id="9ff2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">虚拟专用服务器</h1><p id="397a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">让我们现在连接到我们的副总裁，以便做肮脏的工作</p><p id="34cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ ssh ubuntu@IP_ADDRESS</code></p><p id="c31a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们已经在服务器上了，让我们安装python和虚拟环境包。然后，在我们的项目文件夹中创建一个虚拟环境。</p><p id="8f2e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">~$ sudo apt install python3-pip</code></p><p id="55e5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">~$ sudo apt install python3-venv</code></p><p id="8627" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ python3 -m venv chatvenv</code></p><p id="65c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是我们目录树结构的概述:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/a95e5408c5bb8da513fdbfd0bdce0d2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IXlQLW9H03sBh8Nf.png"/></div></div></figure><p id="7cfe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们将使用以下命令激活虚拟环境:</p><p id="30ad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ source chatvenv/bin/activate</code></p><p id="a14f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您已经有了一个<em class="mj"> requirements.txt </em>文件，那么您可以简单地使用下面这个不言自明的命令来安装您项目的需求。相反，您必须手动安装您的应用程序所依赖的包。</p><p id="2e93" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">(chatvenv)$ pip install -r requirements.txt</code></p><p id="2a3b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">之后，尝试执行以下两个命令来运行您的应用程序。</p><p id="a1ce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">(chatvenv)$ export FLASK_APP=app.py</code></p><p id="e051" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">(chatvenv)$ flask run --host=0.0.0.0</code></p><p id="6889" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，您可以通过浏览器访问您的应用程序来检查一切是否正常:<code class="fe mk ml mm mn b"><a class="ae kc" href="http://IP_ADDRESS:5000/" rel="noopener ugc nofollow" target="_blank">http://IP_ADDRESS:5000/</a></code></p><h1 id="82f2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Nginx和Gunicorn</h1><p id="daee" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">虽然到目前为止你对你的工作很满意，但是我们的方法有两个问题。首先，正如您在终端中看到的，Flask运行在开发模式下。第二，应用程序在前台运行，如果我们点击<code class="fe mk ml mm mn b">^C</code>来取回我们的终端，应用程序将不再可达。</p><p id="b0e7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了解决这个问题，我们将使用一个web服务器(<em class="mj"> Nginx </em>)、一个Web服务器网关接口(<em class="mj"> Gunicorn </em>)，并将我们的执行妖魔化，以便应用程序将在后台运行。</p><p id="2799" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们首先在我们的虚拟环境中安装<em class="mj"> Nginx </em>和<em class="mj"> Gunicorn </em></p><p id="7d48" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">(chatvenv)$ sudo apt install nginx</code></p><p id="e330" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">(chatvenv)$ pip install gunicorn</code></p><p id="ea56" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，您可以使用这个命令将<code class="fe mk ml mm mn b">http://IP_ADDRESS:5000</code>和您的Python逻辑绑定在一起</p><p id="49d0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">(chatvenv)$ cd ~/chatbot</code></p><p id="a70e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">(chatvenv)$ gunicorn --bind 0.0.0.0:5000 app:app</code></p><p id="0b78" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe mk ml mm mn b"><a class="ae kc" href="http://ip_address:5000" rel="noopener ugc nofollow" target="_blank">http://IP_ADDRESS:5000</a></code>查看你的应用</p><p id="9c06" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">⚠️注意，在最后一个命令中，第一个<em class="mj"> app </em>指的是flask app文件的名称，而第二个<em class="mj"> app </em>指的是您在该文件中用来创建应用程序的名称:<code class="fe mk ml mm mn b">app = Flask(__name__)</code></p><p id="d081" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在是时候让Ubuntu的<em class="mj"> init </em>系统在服务器启动时自动启动Gunicorn并为Flask应用提供服务了。</p><p id="3212" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，让我们退出虚拟环境。</p><p id="85bf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">(chatvenv)$ deactivate</code></p><p id="92a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，用下面的代码创建一个项目名为<em class="mj">“chatbot”</em>的服务文件。别忘了更改用户名(<em class="mj"> ubuntu </em>)、项目名(<em class="mj"> chatbot </em>)和虚拟环境名(<em class="mj"> chatvenv </em>)。</p><p id="adb9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ sudo nano /etc/systemd/system/chatbot.service</code></p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="735a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">[Unit]</code><br/><code class="fe mk ml mm mn b">Description=Gunicorn instance to serve <strong class="kf ir">chatbot</strong></code><br/>T3】</p><p id="e305" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">[Service]</code><br/><code class="fe mk ml mm mn b">User=<strong class="kf ir">ubuntu</strong></code><br/><code class="fe mk ml mm mn b">Group=www-data</code><br/><code class="fe mk ml mm mn b">WorkingDirectory=/home/<strong class="kf ir">ubuntu</strong>/<strong class="kf ir">chatbot</strong></code><br/><code class="fe mk ml mm mn b">Environment="PATH=/home/<strong class="kf ir">ubuntu</strong>/<strong class="kf ir">chatbot</strong>/<strong class="kf ir">chatvenv</strong>/bin"</code><br/><code class="fe mk ml mm mn b">ExecStart=/home/<strong class="kf ir">ubuntu</strong>/<strong class="kf ir">chatbot</strong>/<strong class="kf ir">chatvenv</strong>/bin/gunicorn --workers 3 --bind unix:<strong class="kf ir">chatbot</strong>.sock -m 007 <strong class="kf ir">app:app</strong></code></p><p id="f56b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">[Install]</code> <br/> <code class="fe mk ml mm mn b">WantedBy=multi-user.target</code></p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="a32c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后启动、启用并测试Gunicorn服务:</p><p id="cd2d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ sudo systemctl start chatbot</code></p><p id="88a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ sudo systemctl enable chatbot</code></p><p id="f5a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ sudo systemctl status chatbot</code></p><p id="c0fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可能已经注意到了，我不会在这里解释每一行代码。然而，如果你有兴趣了解更多，查看这篇<a class="ae kc" href="https://www.digitalocean.com/community/tutorials/how-to-serve-flask-applications-with-gunicorn-and-nginx-on-ubuntu-18-04" rel="noopener ugc nofollow" target="_blank">博客文章</a>了解更多细节。</p><h1 id="9d86" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将Nginx配置为代理请求</h1><p id="ff2e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在这一节中，我们将通过修改配置文件来配置Nginx传递web请求。首先，我们在站点可用目录中创建<em class="mj">聊天机器人</em>文件，然后将它链接到启用了站点的目录。</p><p id="caf3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当你复制/粘贴这段代码时，再次仔细检查名字；否则你会遇到一些麻烦，很明显！</p><p id="395c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ sudo nano /etc/nginx/sites-available/chatbot</code></p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="9577" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">server {</code> <br/> <code class="fe mk ml mm mn b"> listen 80;</code> <br/> <code class="fe mk ml mm mn b"> server_name <strong class="kf ir">IP_ADDRESS</strong>;</code></p><p id="7ea1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">location / {</code><br/><code class="fe mk ml mm mn b"> include proxy_params;</code><br/><code class="fe mk ml mm mn b"> proxy_pass http://unix:/home/<strong class="kf ir">ubuntu</strong>/<strong class="kf ir">chatbot</strong>/<strong class="kf ir">chatbot</strong>.sock;</code><br/><code class="fe mk ml mm mn b"> }</code><br/><code class="fe mk ml mm mn b">}</code></p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="2426" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ sudo ln -s /etc/nginx/sites-available/chatbot /etc/nginx/sites-enabled</code></p><p id="a306" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行以下命令检查语法错误</p><p id="968f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ sudo nginx -t</code></p><p id="640a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果一切顺利，重启Nginx服务器；然后配置防火墙，允许完全访问Nginx服务器:</p><p id="7830" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ sudo systemctl restart nginx</code></p><p id="0010" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ sudo ufw allow 'Nginx Full'</code></p><p id="520c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，你可以在<code class="fe mk ml mm mn b"><a class="ae kc" href="http://ip_address:5000" rel="noopener ugc nofollow" target="_blank">http://IP_ADDRESS</a></code>查看你的应用。恭喜你！现在可以自豪地说，你知道如何使用Nginx和Gunicorn部署Flask应用程序😅。</p><h1 id="6694" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">添加另一个烧瓶应用程序</h1><p id="618d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">即使我们退出VPS环境并关闭本地机器，我们的Flask应用程序现在也在上述地址启动并运行。在本节中，我们将做一些更改，以便能够在同一台服务器上同时运行多个应用程序。</p><p id="ad0a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，让我们将第二个Flask应用程序移动到VPS。然后，正如我们之前所做的，我们开始创建一个虚拟环境(<em class="mj"> betavenv </em>)并安装您的项目的任何需求。因此，文件夹树的新结构现在看起来像这样:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/afd200eef12d4eab824b7270e4859478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7lXTKXBt0_uLZHUx.png"/></div></div></figure><p id="b8fd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其次，我们用新项目的名称<em class="mj">“beta PP”</em>创建另一个服务文件，代码如下。再来一次:别忘了更改用户名(<em class="mj"> ubuntu </em>)、项目名(<em class="mj"> betapp </em>)、虚拟环境名(<em class="mj"> betavenv </em>)！</p><p id="5e50" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ sudo nano /etc/systemd/system/betapp.service</code></p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="f1f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">[Unit]<br/>Description = guni corn instance to serve<strong class="kf ir">beta PP</strong><br/>After = network . target</p><p id="9e43" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">【服务】<br/>User =<strong class="kf ir">Ubuntu</strong><br/>Group = www-data<br/>working directory =/home/<strong class="kf ir">Ubuntu</strong>/<strong class="kf ir">beta PP</strong><br/>Environment = " PATH =/home/<strong class="kf ir">Ubuntu</strong>/<strong class="kf ir">beta PP</strong>/<strong class="kf ir">beta venv</strong>/bin】<br/>ExecStart =/home/<strong class="kf ir">ubsock-m 007<strong class="kf ir">beta run</strong>:<strong class="kf ir">app</strong></strong></p><p id="d004" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">[安装]<br/>wanted by = multi-user . target</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="2baa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后启动并启用Gunicorn服务:</p><p id="eace" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ sudo systemctl start betapp</code></p><p id="43c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ sudo systemctl enable betapp</code></p><p id="e9ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就像第一个项目一样，我们将配置Nginx来传递web请求，首先，在站点可用目录中创建<em class="mj"> app2 </em>文件，然后将它链接到启用了站点的目录。但是，为了让我们的新应用程序正常工作，我们应该选择80以外的另一个端口(这里是5000)。</p><p id="2652" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ sudo nano /etc/nginx/sites-available/app2</code></p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="6fe8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">服务器{ <br/>监听<strong class="kf ir">5000</strong>；<br/>服务器名称<strong class="kf ir"> IP地址</strong>；</p><p id="6d17" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">location / { <br/>包含proxy _ params<br/>proxy _ pass<a class="ae kc" href="http://unix:/home/ubuntu/betapp/betapp.sock;" rel="noopener ugc nofollow" target="_blank">http://UNIX:/home/<strong class="kf ir">Ubuntu</strong>/<strong class="kf ir">beta PP</strong>/<strong class="kf ir">beta PP</strong>。袜子；</a> <br/> } <br/></p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="0d86" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ sudo ln -s /etc/nginx/sites-available/app2 /etc/nginx/sites-enabled</code></p><p id="153a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检查语法错误:</p><p id="256c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ sudo nginx -t</code></p><p id="021e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">重启Nginx服务器，在<code class="fe mk ml mm mn b"> <a class="ae kc" href="http://ip_address:5000/" rel="noopener ugc nofollow" target="_blank">http://IP_ADDRESS</a></code>和<code class="fe mk ml mm mn b"><a class="ae kc" href="http://ip_address:5000/" rel="noopener ugc nofollow" target="_blank">http://IP_ADDRESS:5000</a></code>访问你的两个应用</p><p id="04dc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mk ml mm mn b">$ sudo systemctl restart nginx</code></p><h1 id="7253" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="7102" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Flask APIs是将你训练过的<em class="mj">机器学习</em>模型投入<em class="mj">生产</em><a class="ae kc" rel="noopener" target="_blank" href="/a-guide-to-building-whatsapp-chatbots-using-dialogflow-and-firebase-4ff5e904ac3"/><a class="ae kc" rel="noopener" target="_blank" href="/machine-learning-in-production-keras-flask-docker-and-heroku-933b5f885459">【2】</a>的优秀工具。在本教程中，我们介绍了如何使用Nginx和Gunicorn部署Flask应用程序的过程。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="5d7f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mj">原载于2021年7月3日https://aienthusiasts.com</em><a class="ae kc" href="https://aienthusiasts.com/deploy-multiple-flask-applications/" rel="noopener ugc nofollow" target="_blank"><em class="mj"/></a><em class="mj">。</em></p></div></div>    
</body>
</html>