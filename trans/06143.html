<html>
<head>
<title>My TubeStats App (ft. Ali Abdaal)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我的TubeStats应用程序(英尺。阿里·阿卜杜勒)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/my-tubestats-app-ft-ali-abdaal-48dfc982c7ed?source=collection_archive---------44-----------------------#2021-06-01">https://towardsdatascience.com/my-tubestats-app-ft-ali-abdaal-48dfc982c7ed?source=collection_archive---------44-----------------------#2021-06-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="65fc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在YouTube频道中寻找一致性</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6512816218a70ae2eeeaefd5f42ed344.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Fs_XCWnZsS_dqM0b"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@vmxhu?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">绍博·维克多</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="6626" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">拥有超过1亿的浏览量和100万的订阅者，Ali Abdaal绝对是一个建议建立一个成功的YouTube频道的人。除了给有抱负的YouTuber今天就开始的建议之外，他还鼓吹一致性。</p><p id="491f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是这个应用程序的动机所在。问题是:阿里·阿布达尔的YouTube频道有多稳定？那其他YouTube频道呢？</p><p id="71cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将看到使用TubeStats来回答这个问题。我们还将介绍它是如何工作的。我还会提供我的个人倾向以及我未来的计划。</p><p id="4b8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">app链接:<a class="ae kv" href="https://www.tubestats.app" rel="noopener ugc nofollow" target="_blank">https://www . tubestats . app</a></p><p id="6812" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">github:<a class="ae kv" href="https://www.github.com/shivans93/tubestats" rel="noopener ugc nofollow" target="_blank">https://www.github.com/shivans93/tubestats</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/2264605d889cc6fd4478e2cbb5864eb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JnYPpO1qzJVZUKI5.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者的动画gif</p></figure><h1 id="0a6c" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">TubeStats做什么？</h1><p id="2128" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">该应用程序接受用户输入。这可以是:</p><ul class=""><li id="edd9" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">频道ID(例如<code class="fe mz na nb nc b">UCoOae5nYA7VqaXzerajD0lg</code>)，</li><li id="f052" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr mv mw mx my bi translated">链接到通道(如<code class="fe mz na nb nc b"><a class="ae kv" href="https://www.youtube.com/channel/UCoOae5nYA7VqaXzerajD0lg," rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/channel/UCoOae5nYA7VqaXzerajD0lg</a></code>、<a class="ae kv" href="https://www.youtube.com/channel/UCoOae5nYA7VqaXzerajD0lg," rel="noopener ugc nofollow" target="_blank">、</a></li><li id="fb38" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr mv mw mx my bi translated">链接到感兴趣频道的视频(如<code class="fe mz na nb nc b">https://www.youtube.com/watch?v=epF2SYpWtos</code>，或</li><li id="4e0c" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr mv mw mx my bi translated">视频ID(例如<code class="fe mz na nb nc b">epF2SYpWtos</code>)。</li></ul><p id="5adf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">几分钟后，它将生成该频道的汇总统计数据。示例包括总视频计数和总观看时间，如下所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/ae4b3b6dcdb80ce6ee6f9385fe9eed49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0c4wlNwew8cMVv2J.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="e096" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，我们还有渠道头像图像以及渠道上提供的描述。</p><p id="2de4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们有一个图表，总结了频道中的所有视频。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/40a388f4a608e81106108ffcbb89d07c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6zg6dksegeINWGNYy7a20Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="2662" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该图涉及发布时间对查看次数的自然对数。y轴有对数刻度，因为数据偏向尾部。这是由于视频的“病毒”性质。如果我们使用线性访问，那么大多数视频将在底部附近，只有少数在顶部附近。</p><p id="1f4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">圆圈的颜色代表视频的喜欢-不喜欢比率。圆圈的大小与其绝对视图数有关。</p><p id="8155" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">日期范围可以更改。在这个例子中，我改变了日期范围，因为Ali Abdaal在2017年7月开始更加认真地对待他的渠道。</p><p id="0893" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一个图表显示了视频之间的天数。例如，在上面选择的日期中，“我最喜欢的iPad Pro应用程序”视频的最长不活动时间不到22天。从视频的日期来看，这是在节日期间。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/363874bb959a51db6783178d2af8ec81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*M4xecFJazFH70db0.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="aa8c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">平均来说，Ali Abdaal能够每3天发布一个视频，其中大多数(75%)在5天内发布。</p><p id="0261" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，TubeStats提供了一个在频道中观看次数最多的视频列表，以及喜欢/不喜欢比率最低的视频列表。</p><h1 id="7c60" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">TubeStats是如何工作的？</h1><p id="225c" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">主要工作部件:</p><ol class=""><li id="af1d" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr nj mw mx my bi translated">YouTube数据API</li><li id="6aea" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nj mw mx my bi translated"><code class="fe mz na nb nc b">pandas</code></li><li id="26f0" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nj mw mx my bi translated"><code class="fe mz na nb nc b">streamlit</code></li><li id="9d98" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nj mw mx my bi translated">赫罗库</li></ol><p id="6234" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我还把这分成了几个障碍，并提供了克服它们的解决方案。</p><h2 id="b0cf" class="nk lu iq bd lv nl nm dn lz nn no dp md lf np nq mf lj nr ns mh ln nt nu mj nv bi translated">障碍#1:我如何设置我的开发环境？</h2><p id="0890" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我用的是Linux。建立我们的开发环境对于我们编码的生产力是必不可少的。</p><p id="6b89" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们从创建目录开始。接下来，我们创建一个虚拟环境来管理我们的包，而不会干扰其他项目。最后，我们初始化git来跟踪变化，并允许与世界共享我们的代码。</p><pre class="kg kh ki kj gt nw nc nx ny aw nz bi"><span id="224c" class="nk lu iq nc b gy oa ob l oc od">$ mkdir tubestats<br/>$ cd tubestats</span><span id="3a95" class="nk lu iq nc b gy oe ob l oc od">$ python3 -m venv venv<br/>$ source venv/bin/activate<br/>$ (venv)</span><span id="f463" class="nk lu iq nc b gy oe ob l oc od">$ git init</span></pre><h2 id="b262" class="nk lu iq bd lv nl nm dn lz nn no dp md lf np nq mf lj nr ns mh ln nt nu mj nv bi translated">障碍2:我们如何访问视频信息？</h2><p id="c134" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我们可以为了观看次数、评论次数等而放弃每一个视频。这需要很长时间。幸运的是，我们可以使用<a class="ae kv" href="https://developers.google.com/youtube/v3/" rel="noopener ugc nofollow" target="_blank"> YouTube数据API </a>。这提供了对YouTube视频和频道的统计数据的简单访问。要访问这个，我们必须设置我们的<a class="ae kv" href="https://console.cloud.google.com/apis/dashboard" rel="noopener ugc nofollow" target="_blank">谷歌云控制台平台</a>。</p><p id="f584" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由此，我们创建了一个“新项目”。我们激活YouTube数据API v3应用程序。最后，我们创建凭证(<a class="ae kv" href="https://shivansivakumaran.com/data-science/my-first-data-project-exploring-daniel-bourkes-youtube-channel-part-1/#YouTube_Data_API" rel="noopener ugc nofollow" target="_blank">单击此处了解更多信息</a>)。这些步骤将提供访问YouTube数据API的关键。</p><h2 id="f6bc" class="nk lu iq bd lv nl nm dn lz nn no dp md lf np nq mf lj nr ns mh ln nt nu mj nv bi translated">障碍3:我们如何存储密码和API密匙？</h2><p id="0e23" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我们想分享我们的代码，但不是我们的密码和API密匙。我们如何做到这一点？</p><p id="e4e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以用一个<a class="ae kv" href="https://pypi.org/project/python-dotenv/" rel="noopener ugc nofollow" target="_blank">第三方包:</a> <code class="fe mz na nb nc b"><a class="ae kv" href="https://pypi.org/project/python-dotenv/" rel="noopener ugc nofollow" target="_blank">python-dotenv</a></code>。</p><p id="be5d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这很重要，这样我们就可以在本地访问数据。我们将会看到，当我们使用Heroku推进网络服务时，我们必须使用不同的方法。</p><p id="8ba6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以将密钥存储在一个<code class="fe mz na nb nc b">.env</code>文件中，并且我们可以将这个文件添加到<code class="fe mz na nb nc b">.gitignore</code>中，这样它就不会被共享。</p><pre class="kg kh ki kj gt nw nc nx ny aw nz bi"><span id="45d5" class="nk lu iq nc b gy oa ob l oc od">.env file<br/> APIKey=xxxAPIKEYherexxx</span></pre><p id="8ba8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们安装了允许访问YouTube API的模块。我们在激活虚拟环境的同时，使用pip来实现这一点。</p><pre class="kg kh ki kj gt nw nc nx ny aw nz bi"><span id="8b5b" class="nk lu iq nc b gy oa ob l oc od">$ (venv) pip install google-api-python-client</span></pre><h2 id="7902" class="nk lu iq bd lv nl nm dn lz nn no dp md lf np nq mf lj nr ns mh ln nt nu mj nv bi translated">障碍4:我们如何获得视频统计数据？</h2><p id="e525" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">如果我们有一个频道ID，我们可以用它来获得一个播放列表，其中包含从该频道上传的所有视频的ID。然后我们可以调用视频ID，然后获得我们感兴趣的统计数据。</p><pre class="kg kh ki kj gt nw nc nx ny aw nz bi"><span id="1b92" class="nk lu iq nc b gy oa ob l oc od">def get_video_data(self) -&gt; pd.core.frame.DataFrame:</span><span id="2636" class="nk lu iq nc b gy oe ob l oc od">         ...</span><span id="fbd9" class="nk lu iq nc b gy oe ob l oc od">         while True:                     <br/>            # obtaining video ID + titles                       <br/>            playlist_request = self.youtube.playlistItems().list(                    <br/>                    part='snippet,contentDetails',                 <br/>                    maxResults=50, # API Limit is 50                  <br/>                    pageToken=next_page_token,                    <br/>                    playlistId=upload_playlist_ID,                <br/>                    )                 <br/>            playlist_response = playlist_request.<br/>            # isolating video ID<br/>            vid_subset = [ vid_ID['contentDetails']['videoId'] for vid_ID in playlist_response['items']<br/>            # retrieving video ID<br/>            vid_info_subset_request = self.youtube.videos().<br/>                part='snippet,contentDetails,<br/>                id=vid_subset<br/>                )       <br/>                <br/>            vid_info_subset_response = vid_info_subset_request.    <br/>            video_response.append(    <br/>            # obtaining page     <br/>            next_page_token = playlist_response.get('nextPageToken') <br/>            # get method used because token may not exist<br/>            if next_page_token is <br/>                break<br/>        df = pd.json_normalize(video_response, 'items')       <br/>        return df</span></pre><p id="5e77" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里我们调用API，但是一次只能获得50个视频id。这要归功于分页。每次调用时，如果超过50个视频，则提供一个页面令牌。页面标记指向下一页。如果页面令牌是返回<code class="fe mz na nb nc b">None</code>，这意味着所有的id已经用尽。我们使用while循环来获取视频id。一旦我们不再有页面标记，while循环就会停止。</p><p id="b7b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将这个输出附加到一个python列表中，这是一个JSON格式的字符串列表。我们将这些信息存储在一个<code class="fe mz na nb nc b">pandas</code> <code class="fe mz na nb nc b">DataFrame</code>中。我们能够做到这一点要感谢一个内置函数<code class="fe mz na nb nc b">json_normalize()</code>。由此，我们有了数据框架。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/f411fe82d85ddcce8b51515f6b369c42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-oJH2WvsJ4Jm4dvD.jpg"/></div></div></figure><h2 id="ed4d" class="nk lu iq bd lv nl nm dn lz nn no dp md lf np nq mf lj nr ns mh ln nt nu mj nv bi translated">障碍5:如何组织代码？</h2><p id="39a0" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">既然我们的代码已经开始腾飞，将所有这些代码放入一个文件变得越来越困难。这是我们为组织使用不同文件和目录的地方。</p><pre class="kg kh ki kj gt nw nc nx ny aw nz bi"><span id="91eb" class="nk lu iq nc b gy oa ob l oc od">├── data<br/> │   ├── channel_data.pkl<br/> │   └── video_data.pkl<br/> ├── LICENSE<br/> ├── Procfile<br/> ├── README.MD<br/> ├── requirements.txt<br/> ├── setup.sh<br/> ├── tests<br/> │   ├── <strong class="nc ir">__init__</strong>.py<br/> │   ├── test_settings.py<br/> │   ├── test_youtube_api.py<br/> │   ├── test_youtube_data.py<br/> │   └── test_youtube_parser.py<br/> ├── tubestats<br/> │   ├── __init__.py<br/> │   ├── youtube_api.py<br/> │   ├── youtube_data.py<br/> │   └── youtube_parser.py<br/> └── youtube_presenter.py</span></pre><p id="019c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">需要注意的主要子目录是<code class="fe mz na nb nc b">tubestats</code>,它包含访问API的python源代码，处理数据，并生成底层图形来呈现数据。<code class="fe mz na nb nc b">tests</code>包含用于测试<code class="fe mz na nb nc b">tubestats</code>模块的测试代码。</p><p id="c124" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，<code class="fe mz na nb nc b">youtube_presenter.py</code>是呈现代码的东西。我们看到了一些其他的文件，我们将在后面处理。</p><h2 id="c845" class="nk lu iq bd lv nl nm dn lz nn no dp md lf np nq mf lj nr ns mh ln nt nu mj nv bi translated">障碍6:如何测试代码？</h2><p id="a6f1" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">确保我们的代码工作是很重要的。在这种情况下，我使用<code class="fe mz na nb nc b">pytest</code>。下面是测试上述<code class="fe mz na nb nc b">get_video_data()</code>功能的一个例子。</p><pre class="kg kh ki kj gt nw nc nx ny aw nz bi"><span id="33fa" class="nk lu iq nc b gy oa ob l oc od">from tubestats.youtube_api import create_api, YouTubeAPI<br/> from tests.test_settings import set_channel_ID_test_case</span><span id="3fff" class="nk lu iq nc b gy oe ob l oc od"> from pathlib import Path</span><span id="9437" class="nk lu iq nc b gy oe ob l oc od"> import pytest</span><span id="327e" class="nk lu iq nc b gy oe ob l oc od"> import googleapiclient<br/> import pandas</span><span id="03af" class="nk lu iq nc b gy oe ob l oc od"> def test_create_api():<br/>     youtube = create_api()<br/>     assert isinstance(youtube, googleapiclient.discovery.Resource)</span><span id="89f4" class="nk lu iq nc b gy oe ob l oc od"> @pytest.fixture()<br/> def youtubeapi():<br/>     channel_ID = set_channel_ID_test_case()<br/>     yt = YouTubeAPI(channel_ID)<br/>     return yt</span><span id="0ac0" class="nk lu iq nc b gy oe ob l oc od"> def test_get_video_data(youtubeapi):<br/>     df = youtubeapi.get_video_data()<br/>     assert isinstance(df, pandas.core.frame.DataFrame)<br/> <br/>     # saving video data to save API calls for later test <br/>     BASE_DIR = Path(<strong class="nc ir">file</strong>).parent.parent<br/>     df.to_pickle(BASE_DIR / 'data' / 'video_data.pkl')</span></pre><p id="3e06" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这种情况下，我们导入源代码，以及相关的模块。我们使用<code class="fe mz na nb nc b">pytest.fixture()</code>装饰器。这允许我们重用我们在测试用例中提取的数据的结果。我们“腌制”数据，这样我们就可以使用它，而不是为其他测试进行更多的API调用。</p><p id="6586" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我可能比<code class="fe mz na nb nc b">isinstance</code>做得更好，但这也是必须的。</p><p id="4081" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们在终端中运行<code class="fe mz na nb nc b">pytest</code>，这将测试我们代码的功能。</p><h2 id="d8e9" class="nk lu iq bd lv nl nm dn lz nn no dp md lf np nq mf lj nr ns mh ln nt nu mj nv bi translated">障碍#7:如何显示这些数据以供他人交互？</h2><p id="cd9c" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">这是通过<code class="fe mz na nb nc b">altair</code>的组合来完成的，它为我们提供了交互式的图形。此外，我们使用<code class="fe mz na nb nc b">streamlit</code>来显示这些图形并允许交互。</p><p id="43f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下代码创建了一个图表，显示一段时间内的所有视频。</p><pre class="kg kh ki kj gt nw nc nx ny aw nz bi"><span id="6f4c" class="nk lu iq nc b gy oa ob l oc od">import altair as alt<br/> def scatter_all_videos(self, df: pd.core.frame.DataFrame) -&gt; alt.vegalite.v4.Chart:<br/>df_views = df<br/>         c = alt.Chart(df_views, title='Plot of videos over time').mark_point().encode(<br/>                 x=alt.X('snippet.publishedAt_REFORMATED:T', axis=alt.Axis(title='Date Published')),<br/>                 y=alt.Y('statistics.viewCount_NLOG:Q', axis=alt.Axis(title='Natural Log of Views')),<br/>                 color=alt.Color('statistics.like-dislike-ratio:Q', scale=alt.Scale(scheme='turbo'), legend=None),<br/>                 tooltip=['snippet.title:N', 'statistics.viewCount:Q', 'statistics.like-dislike-ratio:Q'],<br/>                 size=alt.Size('statistics.viewCount:Q', legend=None)<br/>         )<br/>         return c</span></pre><p id="6829" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们可以显示这个图表，并能够编辑日期。</p><pre class="kg kh ki kj gt nw nc nx ny aw nz bi"><span id="c0e8" class="nk lu iq nc b gy oa ob l oc od">import streamlit as st</span><span id="8de6" class="nk lu iq nc b gy oe ob l oc od"> def date_slider(date_end=datetime.today()):<br/>         date_start, date_end = st.slider(<br/>                 'Select date range to include:',<br/>                 min_value=first_video_date, # first video<br/>                 max_value=last_video_date, #value for date_end<br/>                 value=(first_video_date , last_video_date), #same as min value<br/>                 step=timedelta(days=2),<br/>                 format='YYYY-MM-DD',<br/>                 key=999)<br/>         return date_start, date_end</span><span id="7970" class="nk lu iq nc b gy oe ob l oc od">    date_start, date_end = date_slider()<br/>     transformed_df = youtuber_data.transform_dataframe(date_start=date_start, date_end=date_end) <br/>     c = youtuber_data.scatter_all_videos(transformed_df)<br/>     st.altair_chart(c, use_container_width=True)</span></pre><p id="5e7f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我们在本地运行程序时看到的，<code class="fe mz na nb nc b">streamlit run youtube_presenter.py</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/76b306a65d097f2d353ea6852abe516d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Wc3PhdfHz5WOIVD9.png"/></div></div></figure><h2 id="98d4" class="nk lu iq bd lv nl nm dn lz nn no dp md lf np nq mf lj nr ns mh ln nt nu mj nv bi translated">障碍7:我如何炫耀？</h2><p id="115b" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">坐在我们的电脑上没有任何意义。我们需要与世界分享这一点。Github可以用来共享代码，但是我们当中的非技术人员呢？</p><p id="b4eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">解决办法是用<a class="ae kv" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku来主持</a>。</p><p id="1a28" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们要做的是在Heroku上创建一个帐户。一个免费账户就够了。</p><p id="acd2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们已经确保代码工作，我们可以把它推到GitHub上。接下来，我们创建一个<code class="fe mz na nb nc b">requirements.txt</code>、<code class="fe mz na nb nc b">setup.sh</code>和<code class="fe mz na nb nc b">Procfile</code>。</p><p id="ae4e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mz na nb nc b">requirements.txt</code>文件将包含外部库。我们可以使用命令:</p><pre class="kg kh ki kj gt nw nc nx ny aw nz bi"><span id="6fcd" class="nk lu iq nc b gy oa ob l oc od">$ (venv) pip freeze &gt; requirements.txt</span></pre><p id="80a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建了<code class="fe mz na nb nc b">setup.sh</code>文件:</p><pre class="kg kh ki kj gt nw nc nx ny aw nz bi"><span id="8f85" class="nk lu iq nc b gy oa ob l oc od">mkdir -p ~/.streamlit/echo "\\<br/>[server]\\n\\<br/>headless = true\\n\\<br/>port = $PORT\\n\\<br/>enableCORS = false\\n\\<br/>\\n\\<br/>" &gt; ~/.streamlit/config.toml</span></pre><p id="7129" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后<code class="fe mz na nb nc b">Procfile</code>告诉Heroku这是一个web应用程序。它还指示<code class="fe mz na nb nc b">setup.py</code>运行文件以及使用<code class="fe mz na nb nc b">streamlit</code>运行我们的代码。</p><pre class="kg kh ki kj gt nw nc nx ny aw nz bi"><span id="c42b" class="nk lu iq nc b gy oa ob l oc od">web: sh setup.sh &amp;&amp; streamlit run app.py</span></pre><p id="5f9e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们安装Heroku命令行接口。</p><p id="d969" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们可以将代码推送到Heroku，就像我们对GitHub库所做的那样。</p><pre class="kg kh ki kj gt nw nc nx ny aw nz bi"><span id="c361" class="nk lu iq nc b gy oa ob l oc od">$ heroku login<br/>$ heroku create tubestats</span><span id="9382" class="nk lu iq nc b gy oe ob l oc od">$ git push heroku main</span></pre><p id="8618" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是我们的最终产品。</p><p id="b35e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还可以<a class="ae kv" href="https://devcenter.heroku.com/articles/custom-domains" rel="noopener ugc nofollow" target="_blank">附加一个域</a>来定制应用程序。</p><h2 id="4f7b" class="nk lu iq bd lv nl nm dn lz nn no dp md lf np nq mf lj nr ns mh ln nt nu mj nv bi translated">障碍8:如果输入了一个视频ID怎么办？</h2><p id="1ac8" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">到目前为止，这仅适用于通道ID输入。视频ID呢？一个网址？这是我们需要解析输入的地方。</p><p id="b7a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们结合使用正则表达式和检查长度。</p><p id="8c16" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，频道ID正好是24个字符长，视频ID是11个字符长。</p><p id="23ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果提供了链接，我们可以使用正则表达式(regex，使用<code class="fe mz na nb nc b">re</code>模块)来提取视频ID或频道ID。有很多网站可以帮助使用regex。这里有一个。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/7fd104749639953a5544d5813d5a3d02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mBB8bIvvlyWTjEng.jpg"/></div></div></figure><p id="3fc1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是一个应用正则表达式的例子。</p><pre class="kg kh ki kj gt nw nc nx ny aw nz bi"><span id="a2fe" class="nk lu iq nc b gy oa ob l oc od">import re</span><span id="f3e3" class="nk lu iq nc b gy oe ob l oc od">LINK_MATCH = r'(^.*youtu)(\\.be|be\\.com)(\\/watch\\?v\\=|\\/)([a-zA-Z0-9_-]+)(\\/)?([a-zA-Z0-9_-]+)?'<br/>m = re.search(LINK_MATCH, for_parse)<br/>video_id = m.group(4) # video ID<br/>if video_id == 'channel':<br/>    return m.group(6) # Channel ID<br/>elif video_id == 'user':<br/>    channel_username = m.group(6) # Channel Username</span></pre><h1 id="028c" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">我从TubeStats中学到了什么？</h1><p id="782c" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">从这个项目中可以学到很多东西。</p><p id="fca1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">项目可以帮助学习，让你保持兴趣。没有什么比提出问题并回答它更有帮助的了。这意味着你所有的研究和你学到的东西都是相关的，并且可能会坚持下去。</p><p id="59fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，达到“最低可行产品”也很重要。如果一个项目是压倒性的，把它分解成一个简单的层次，得到一些刚刚工作。然后，专注于使代码有性能，干净等等。</p><h1 id="b45b" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">我将来能做什么？</h1><p id="f75b" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">错误。没有办法捕捉错误。将打印的是代码本身提供的错误。</p><p id="7fbc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更好的性能。可能有很多地方可以让代码运行得更好。不过，我可以稍后再谈这个。</p><h1 id="a32d" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">结论</h1><p id="caab" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">发布视频的一致性是YouTube频道成功的一个重要因素。这个应用程序就是这样测量的。或者至少尝试过。</p><p id="c732" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该项目实现了YouTube数据API以及<code class="fe mz na nb nc b">pandas</code>、<code class="fe mz na nb nc b">streamlit</code>，并推送到Heroku进行托管。一个重要的教训是建立一个项目到一个最低限度可行的阶段。以后集中精力完善它。</p><p id="00f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我从这个项目中学到了很多，也有更多我可以做的。</p><h1 id="a47f" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">参考</h1><ol class=""><li id="d25a" class="mq mr iq ky b kz ml lc mm lf of lj og ln oh lr nj mw mx my bi translated">一个阿卜达尔，<a class="ae kv" href="https://aliabdaal.com" rel="noopener ugc nofollow" target="_blank">阿里阿卜达尔</a> (2021)，<a class="ae kv" href="https://aliabdaal.com/" rel="noopener ugc nofollow" target="_blank">https://aliabdaal.com/</a></li><li id="4453" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nj mw mx my bi translated">谷歌，<a class="ae kv" href="https://developers.google.com/youtube/v3/" rel="noopener ugc nofollow" target="_blank"> Youtube数据API </a> (2021)，<a class="ae kv" href="https://developers.google.com/youtube/v3/" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/youtube/v3/</a></li><li id="e38b" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nj mw mx my bi translated">熊猫开发团队，<a class="ae kv" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank">熊猫文档</a> (2021)，<a class="ae kv" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank">https://pandas.pydata.org/</a></li><li id="b9c3" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nj mw mx my bi translated">H Krekel，pytest-dev团队，<a class="ae kv" href="https://docs.pytest.org/en/6.2.x/" rel="noopener ugc nofollow" target="_blank"> pytest:帮助您编写更好的程序— pytest文档</a> (2021)，<a class="ae kv" href="https://docs.pytest.org/en/6.2.x/" rel="noopener ugc nofollow" target="_blank">https://docs.pytest.org/en/6.2.x/</a></li><li id="afbc" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nj mw mx my bi translated">牛郎星开发者，<a class="ae kv" href="https://altair-viz.github.io/" rel="noopener ugc nofollow" target="_blank">牛郎星:Python中的声明式可视化——牛郎星4.10文档</a> (2021)，<a class="ae kv" href="https://altair-viz.github.io/" rel="noopener ugc nofollow" target="_blank">https://altair-viz.github.io/</a></li><li id="6ff2" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nj mw mx my bi translated">细流公司，<a class="ae kv" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank">细流公司</a> (2021)，<a class="ae kv" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank">https://streamlit.io/</a></li><li id="efd9" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nj mw mx my bi translated">赫罗库，<a class="ae kv" href="https://www.heroku.com" rel="noopener ugc nofollow" target="_blank">赫罗库</a> (2021)，【https://www.heroku.com】T2</li><li id="8cd4" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nj mw mx my bi translated">名词（noun的缩写）Mashinchi，<a class="ae kv" rel="noopener" target="_blank" href="/a-quick-tutorial-on-how-to-deploy-your-streamlit-app-to-heroku-874e1250dadd">一个关于如何将你的Streamlit应用程序部署到Heroku的快速教程。</a> (2017)，走向数据科学</li></ol></div></div>    
</body>
</html>