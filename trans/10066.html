<html>
<head>
<title>Spatio-temporal Mapping of Seasonal Droughts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">季节性干旱的时空制图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/spatio-temporal-mapping-of-seasonal-droughts-e471f8cf9dad?source=collection_archive---------32-----------------------#2021-09-22">https://towardsdatascience.com/spatio-temporal-mapping-of-seasonal-droughts-e471f8cf9dad?source=collection_archive---------32-----------------------#2021-09-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3bce" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何创建动画gif来显示你感兴趣的地区在一段时间内的干旱情况</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/b8ac2177fe073ef999aed753c0fed19e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/1*Lp3uTMsh5b27C4320m61XA.gif"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">干旱的时空制图:作者提供的图像</p></figure><h1 id="bd5e" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">介绍</h1><p id="0fb7" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">干旱规模和频率的增加经常被认为是气候变化的不利影响之一。干旱是一种气候现象，其特点是由于降水不足而导致水分不足。干旱有三种类型:</p><ol class=""><li id="2aa1" class="mf mg iq ll b lm mh lp mi ls mj lw mk ma ml me mm mn mo mp bi translated"><strong class="ll ir">气象</strong>——降水不足导致。印度气象局(IMD)根据降雨量不足分别超过25%和50%，将气象干旱分为“中度”和“严重”。</li><li id="3975" class="mf mg iq ll b lm mq lp mr ls ms lw mt ma mu me mm mn mo mp bi translated"><strong class="ll ir">水文</strong>——长时间的干旱导致地表水和地下水枯竭，造成牲畜和人类用水短缺。</li><li id="7fad" class="mf mg iq ll b lm mq lp mr ls ms lw mt ma mu me mm mn mo mp bi translated"><strong class="ll ir">农业</strong>——作物季节降雨量和土壤湿度不足的情况。</li></ol><p id="6d75" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">监测干旱很重要，因为它直接关系到粮食安全。有许多指数可以用来量化干旱情况。在这篇博客中，我将演示如何使用Python中的开源工具以动画GIF的形式呈现干旱的时空变化。</p><h1 id="4329" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">2.工作流程</h1><p id="8e27" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">工作流程由以下主要步骤组成:</p><ul class=""><li id="aa53" class="mf mg iq ll b lm mh lp mi ls mj lw mk ma ml me my mn mo mp bi translated">导入库并验证谷歌地球引擎(GEE)。</li><li id="d91b" class="mf mg iq ll b lm mq lp mr ls ms lw mt ma mu me my mn mo mp bi translated">定义感兴趣区域(aoi)。</li><li id="d492" class="mf mg iq ll b lm mq lp mr ls ms lw mt ma mu me my mn mo mp bi translated">根据观测期间的日降水量栅格创建月复合数据。</li><li id="9ba4" class="mf mg iq ll b lm mq lp mr ls ms lw mt ma mu me my mn mo mp bi translated">创建长期的月度复合基线——比如说10年。</li><li id="6e21" class="mf mg iq ll b lm mq lp mr ls ms lw mt ma mu me my mn mo mp bi translated">计算每个月的降雨量不足。</li><li id="1692" class="mf mg iq ll b lm mq lp mr ls ms lw mt ma mu me my mn mo mp bi translated">通过创建镶嵌图，使用矢量边界覆盖的计算赤字图层的RGB可视化创建镶嵌图。</li><li id="c249" class="mf mg iq ll b lm mq lp mr ls ms lw mt ma mu me my mn mo mp bi translated">将每月的马赛克绘制成动画GIF的帧。</li><li id="bd88" class="mf mg iq ll b lm mq lp mr ls ms lw mt ma mu me my mn mo mp bi translated">用相应月份标注每一帧并显示GIF。</li></ul><p id="f4c1" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">我们将从通常的python设置和GEE初始化开始。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="7664" class="ne ks iq na b gy nf ng l nh ni">import geemap<br/>import ee</span><span id="ed14" class="ne ks iq na b gy nj ng l nh ni">try:<br/>    ee.Initialize()<br/>except:<br/>    ee.Authenticate()<br/>    ee.Initialize()</span></pre><h1 id="f76e" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">3.数据处理</h1><p id="8d64" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们将使用气候灾害小组的红外降水和台站(CHIRPS)降水数据，这些数据在GEE(<a class="ae nk" href="https://developers.google.com/earth-engine/datasets/catalog/UCSB-CHG_CHIRPS_DAILY" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/earth-engine/datasets/catalog/UCSB-CHG _ CHIRPS _ DAILY</a>)中被同化。这是一个开放的数据集，所有版权都被放弃。它包含从1981年开始的0.05分辨率卫星图像的每日降雨量数据，这有助于为趋势分析和季节性干旱监测创建网格降雨量时间序列。</p><p id="a57c" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">正如工作流中所讨论的，我们定义了用于分析和可视化的区域。我们将使用印度的矢量shapefile，其中包含各邦边界的GIS信息。这个shapefile在互联网(IGISmap.com、gadm.org、arcgis.com等)上很容易找到。)并可以通过代码编辑器作为资产上传到GEE上。一种更简单的替代方法是使用FAO-GAUL数据集，该数据集已经在GEE中获取，但需要做出一些努力，以将有争议的地理区域纳入印度领土，从而实现精确制图。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="82e6" class="ne ks iq na b gy nf ng l nh ni"># We use the country boundaries from Global Administrative Unit Layers (2015) provided by FAO(UN)<br/>india = ee.FeatureCollection("users/skantbksc/states");</span><span id="119a" class="ne ks iq na b gy nj ng l nh ni"># Define the regional bounds for animation frames.<br/>region = india.geometry().bounds();</span></pre><h2 id="ed79" class="ne ks iq bd kt nl nm dn kx nn no dp lb ls np nq ld lw nr ns lf ma nt nu lh nv bi translated">3.1为观察期创建每月合成图像</h2><p id="6511" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们将分析2020年的干旱情况。由于干旱主要发生在印度大部分降水发生的季风季节，我们将选择6月至10月进行分析。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="a6db" class="ne ks iq na b gy nf ng l nh ni"># set start date for analysis<br/>startDate = '2020-06-01';</span><span id="7759" class="ne ks iq na b gy nj ng l nh ni"># set end date for analysis<br/>endDate = '2020-10-31';</span><span id="3670" class="ne ks iq na b gy nj ng l nh ni">#filter the image collection using dates<br/>pptCol = ee.ImageCollection("UCSB-CHG/CHIRPS/DAILY")\<br/>        .filterDate(startDate, endDate)\<br/>        .select('precipitation');</span><span id="e284" class="ne ks iq na b gy nj ng l nh ni"># Setting year and month as a property of every image which will later be used to form monthly composites<br/>def set_yymm(img):<br/>    return img.set('yymm', img.id().slice(0,6))</span><span id="60f7" class="ne ks iq na b gy nj ng l nh ni">pptCol = pptCol.map(set_yymm)</span><span id="bb8f" class="ne ks iq na b gy nj ng l nh ni"># Define a list of unique observation months from the image collection.<br/>yymmList = ee.List(pptCol.aggregate_array('yymm')).distinct().sort();</span><span id="54cc" class="ne ks iq na b gy nj ng l nh ni"># Function to sum up the daily precipitation data of each month <br/>def groupByMonth(yymm):<br/>    pptMonth = pptCol.filterMetadata('yymm', 'equals', yymm)\<br/>                .sum()\<br/>                .clip(india)\<br/>                .set('yymm', yymm);<br/>    return pptMonth</span><span id="b435" class="ne ks iq na b gy nj ng l nh ni"># Map the function over the list of months to build a collection of monthly image composites.<br/>pptMonthList = yymmList.map(groupByMonth);</span><span id="c925" class="ne ks iq na b gy nj ng l nh ni">pptByYYMM = ee.ImageCollection.fromImages(pptMonthList);</span></pre><p id="98fc" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">使用<code class="fe nw nx ny na b">pptCol.size().getInfo()</code>和<code class="fe nw nx ny na b">pptByYYMM.size().getInfo()</code>可以检查到，原始每日采集和计算每月采集中的图像数量分别为152和5。</p><h2 id="cfb9" class="ne ks iq bd kt nl nm dn kx nn no dp lb ls np nq ld lw nr ns lf ma nt nu lh nv bi translated">3.2基线月度综合数据的计算</h2><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="e415" class="ne ks iq na b gy nf ng l nh ni"># We use 10 year data to construct a baseline figure <br/>baseCol = ee.ImageCollection("UCSB-CHG/CHIRPS/DAILY")\<br/>        .filterDate('2000-01-01','2010-01-01')\<br/>        .select('precipitation');</span><span id="32ff" class="ne ks iq na b gy nj ng l nh ni"># Create a list of months<br/>months = ee.List.sequence(1, 12);</span><span id="17be" class="ne ks iq na b gy nj ng l nh ni"># Function to find the average monthly precipitation<br/>def avgByMonth(m):<br/>    img = baseCol.filter(ee.Filter.calendarRange(m,m, 'month')).sum().divide(10).clip(india);<br/>    return img.set('mm',ee.Number(m).format('%02d'));</span><span id="4990" class="ne ks iq na b gy nj ng l nh ni"># Map over the list of months to build a collection of long term average monthly precipitation composites<br/>baseMonthCol = ee.ImageCollection.fromImages(months.map(avgByMonth))</span></pre><h2 id="e703" class="ne ks iq bd kt nl nm dn kx nn no dp lb ls np nq ld lw nr ns lf ma nt nu lh nv bi translated">3.3降雨量不足的计算</h2><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="dd63" class="ne ks iq na b gy nf ng l nh ni"># Compare the monthly composites against the corresponding baseline to arrive at the deficit figures</span><span id="f834" class="ne ks iq na b gy nj ng l nh ni">def calc_deficit(img):<br/>    <br/>    mm = ee.String(img.get('yymm')).slice(4,6); <br/>    base = baseMonthCol.filterMetadata('mm','equals',mm).first();<br/>    deficit = base.subtract(img).divide(base).set('yymm', img.get('yymm'));<br/>    return deficit;</span><span id="9de8" class="ne ks iq na b gy nj ng l nh ni">deficitByMonth = pptByYYMM.map(calc_deficit);</span></pre><h2 id="bbac" class="ne ks iq bd kt nl nm dn kx nn no dp lb ls np nq ld lw nr ns lf ma nt nu lh nv bi translated">3.4移除干旱区域进行分析</h2><p id="ca10" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">由于许多干旱地区降水很少，由于分母效应低，它们的赤字百分比可能很高。我们将把这些像素的不足百分比设置为零。如果该地区的年降雨量少于500毫米，我们将把该地区划分为干旱地区。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="ad75" class="ne ks iq na b gy nf ng l nh ni"># Remove deficit of arid areas from visualisation. We define an area as arid if its annual rainfall is less than 500mm.</span><span id="b0ba" class="ne ks iq na b gy nj ng l nh ni">baseAnnualCol = baseMonthCol.sum();</span><span id="42f5" class="ne ks iq na b gy nj ng l nh ni">notArid = baseAnnualCol.gt(500);</span><span id="e47b" class="ne ks iq na b gy nj ng l nh ni">def arid_rem(img):<br/>    return img.multiply(notArid);</span><span id="9988" class="ne ks iq na b gy nj ng l nh ni">deficitByMonth = deficitByMonth.map(arid_rem);</span></pre><h1 id="c218" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">4.测绘</h1><p id="1bd9" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">下一步是可视化这5张图片，它们是<code class="fe nw nx ny na b">deficitByMonth</code>图片集的一部分。作为参数提供的调色板在最小和最大不足值之间线性插值颜色。我们设置可视化图像的参数，使黄色和红色像素分别代表中度和严重干旱条件。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="c9bf" class="ne ks iq na b gy nf ng l nh ni"># Define RGB visualization parameters.<br/>visParams = {<br/>    'min' : 0,<br/>    'max' : 1,<br/>    'palette': ['e6ffe6','ffffff', 'fff633', 'fc0703']<br/>};</span></pre><p id="f28f" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">创建印度各州的轮廓很重要，这样干旱像素就可以通过州边界来描绘。我们将创建干旱层的RGB可视化，并在每个层上叠加州边界，从而创建一个马赛克。首先，我们创建地图轮廓。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="0119" class="ne ks iq na b gy nf ng l nh ni"># Create an empty image into which to paint the features.<br/>transparent = ee.Image();<br/>empty = ee.Image.cat([transparent, transparent,transparent]);</span><span id="8b8c" class="ne ks iq na b gy nj ng l nh ni"># Select and (optionally) rename bands.<br/>empty = empty.select(<br/>    ['constant', 'constant_1', 'constant_2'], #old names<br/>    ['vis-red', 'vis-green', 'vis-blue']  #new names<br/>);</span><span id="9095" class="ne ks iq na b gy nj ng l nh ni"># Paint all the polygon edges with the same number and width, display.<br/>outline = empty.paint(<br/>    featureCollection = india,<br/>    color = 1,<br/>    width = 1);</span></pre><p id="5fa4" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">接下来，我们创建一个干旱的RGB图像表示的镶嵌图，然后是地图轮廓，按此顺序。这个顺序很重要，因为否则地图轮廓就看不见了。我们创建一个函数<code class="fe nw nx ny na b">rgb_fc_mosaic</code>来做这件事，并把它映射到<code class="fe nw nx ny na b">defictByMonth</code>中的图像集合上。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="69af" class="ne ks iq na b gy nf ng l nh ni">def rgb_fc_mosaic(img):<br/>    #Create RGB visualization images for use as animation frames.<br/>    imgRGB = img.visualize(**visParams).clip(india)<br/>#   Mosaic the visualization layers and display (or export).<br/>    mosaic = ee.ImageCollection([imgRGB, outline]).mosaic()<br/>    return mosaic</span><span id="6210" class="ne ks iq na b gy nj ng l nh ni">rgbVis = deficitByMonth.map(rgb_fc_mosaic);</span></pre><p id="0606" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">生成动画的最后一步是设置动画帧的参数和它显示图像的速度。我们将为<code class="fe nw nx ny na b">getVideoThumbURL</code>函数提供必要的参数，并将其映射到<code class="fe nw nx ny na b">rgbVis</code>图像集合上。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="6f1b" class="ne ks iq na b gy nf ng l nh ni"># Define GIF visualization parameters.<br/>gifParams = {<br/>  'region': region,<br/>  'dimensions': 600,<br/>  'crs': 'EPSG:3857',<br/>  'framesPerSecond': 1<br/>};</span><span id="7231" class="ne ks iq na b gy nj ng l nh ni"># Print the GIF URL to the console.<br/>print(rgbVis.getVideoThumbURL(gifParams));</span></pre><p id="2110" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">一旦动画GIF(drugal _ in . GIF)准备就绪，我们将在GIF的每一帧上添加月份信息。这可以使用<code class="fe nw nx ny na b">geemap</code>包的<code class="fe nw nx ny na b">add_text_to_gif</code>功能轻松完成。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="a622" class="ne ks iq na b gy nf ng l nh ni">import pandas as pd<br/>text = pd.date_range(startDate, endDate, <br/>              freq='MS').strftime("%b-%Y").tolist()</span><span id="0939" class="ne ks iq na b gy nj ng l nh ni"># Add the months information on each frame of GIF</span><span id="1fd2" class="ne ks iq na b gy nj ng l nh ni">in_gif = 'C:\\Users\\ADMIN\\Desktop\\satellite\\geemap\\images\\drought_in.gif'</span><span id="3f29" class="ne ks iq na b gy nj ng l nh ni">out_gif = 'C:\\Users\\ADMIN\\Desktop\\satellite\\geemap\\images\\drought_out.gif'</span><span id="3dc7" class="ne ks iq na b gy nj ng l nh ni">geemap.add_text_to_gif(in_gif, out_gif, xy = ('40%', '0%'), text_sequence = text, font_size=30, font_color = '#ffffff',duration = 1000)</span></pre><p id="f678" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated">您可以使用<code class="fe nw nx ny na b">show_image</code>功能在Jupyter Notebook中可视化带注释的GIF。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="3223" class="ne ks iq na b gy nf ng l nh ni">geemap.show_image(out_gif)</span></pre><h1 id="4527" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">5.结论</h1><p id="d330" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">动画gif是表现天气时空变化的非常有用的工具。这些视觉工具以一种吸引读者并易于理解的方式表达了价值千言万语的信息。在这篇博客中，我演示了如何使用GEE中的开放数据和python中的开源工具创建动画gif来捕捉干旱条件随时间的变化。</p><p id="3462" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mv lu lv lw mw ly lz ma mx mc md me ij bi translated"><em class="nz">免责声明:本博客表达的观点是个人观点。</em></p><h1 id="5bb1" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">参考</h1><ul class=""><li id="2c9e" class="mf mg iq ll b lm ln lp lq ls oa lw ob ma oc me my mn mo mp bi translated">吴(2020)。geemap:一个Python包，用于与Google Earth引擎进行交互式地图绘制。《开放源码软件杂志》，5(51)，2305页。<a class="ae nk" href="https://doi.org/10.21105/joss.02305" rel="noopener ugc nofollow" target="_blank">https://doi.org/10.21105/joss.02305</a></li><li id="d3eb" class="mf mg iq ll b lm mq lp mr ls ms lw mt ma mu me my mn mo mp bi translated"><a class="ae nk" href="https://developers.google.com/earth-engine/guides/feature_collections_visualizing" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/earth-engine/guides/feature _ collections _ visualizing</a></li><li id="7f0b" class="mf mg iq ll b lm mq lp mr ls ms lw mt ma mu me my mn mo mp bi translated"><a class="ae nk" href="https://developers.google.com/earth-engine/guides/image_visualization" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/earth-engine/guides/image _ visualization</a></li><li id="e46b" class="mf mg iq ll b lm mq lp mr ls ms lw mt ma mu me my mn mo mp bi translated"><a class="ae nk" href="https://www.nrsc.gov.in/sites/default/files/pdf/ebooks/Chap_13_AgricultureDroughtMonitoring.pdf" rel="noopener ugc nofollow" target="_blank">https://www . nrsc . gov . in/sites/default/files/pdf/ebooks/Chap _ 13 _ agriculturedraughtmonitoring . pdf</a></li></ul></div></div>    
</body>
</html>