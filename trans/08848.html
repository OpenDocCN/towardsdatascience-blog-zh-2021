<html>
<head>
<title>Python Logging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python日志记录</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-logging-from-nothing-to-something-79a7f6a0c1eb?source=collection_archive---------20-----------------------#2021-08-15">https://towardsdatascience.com/python-logging-from-nothing-to-something-79a7f6a0c1eb?source=collection_archive---------20-----------------------#2021-08-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="5985" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">没事-&gt;有事</h2><div class=""/><div class=""><h2 id="15ab" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">跟着练习，为你的编程工作装备这种不性感但重要的日志记录技能</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/66a41e8269c4a0c36a7e7d4e00975fda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yf9cDeTkaq58PqDOAWRxNA.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">只是一个基本的日志功能！</p></figure><p id="8717" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们通常打印输出来检查我们的逻辑在编码时是否按预期运行。但是，在生产过程中可能会出现运行时问题，我们无法验证打印输出。这时，日志记录可以帮助我们识别运行时问题。我们开始吧！</p><h2 id="42ce" class="md me it bd mf mg mh dn mi mj mk dp ml lq mm mn mo lu mp mq mr ly ms mt mu iz bi translated">导入日志模块</h2><p id="af2b" class="pw-post-body-paragraph lh li it lj b lk mv kd lm ln mw kg lp lq mx ls lt lu my lw lx ly mz ma mb mc im bi translated">创建一个python文件<code class="fe na nb nc nd b">log_utility.py</code>并编写第一行代码:</p><pre class="ks kt ku kv gt ne nd nf ng aw nh bi"><span id="45f9" class="md me it nd b gy ni nj l nk nl">import logging</span></pre><p id="8c76" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">简单，嗯？日志是软件开发的基本特性之一，所以Python拥有这个内置模块来支持严肃的软件开发是很好的。</p><h2 id="deb3" class="md me it bd mf mg mh dn mi mj mk dp ml lq mm mn mo lu mp mq mr ly ms mt mu iz bi translated">定义get_logger()函数并初始化日志记录参数</h2><p id="d37d" class="pw-post-body-paragraph lh li it lj b lk mv kd lm ln mw kg lp lq mx ls lt lu my lw lx ly mz ma mb mc im bi translated">在<code class="fe na nb nc nd b">log_utility.py</code>中，我们定义一个函数并初始化所有参数:</p><pre class="ks kt ku kv gt ne nd nf ng aw nh bi"><span id="296b" class="md me it nd b gy ni nj l nk nl">def get_logger(name, log_config = None):<br/> log_filename = 'C:\\temp\\main_%PID%.txt'.replace('%PID%', str(os.getpid()))<br/> log_format = "%(asctime)s from %(name)s: %(message)s"<br/> log_datefmt = "%d %b %Y %H:%M:%S"<br/> log_level = logging.INFO<br/> logging.basicConfig(filename = log_filename,<br/>      format = log_format,<br/>      datefmt = log_datefmt,<br/>      level = log_level)<br/> return logging.getLogger(name)</span></pre><ul class=""><li id="d899" class="nm nn it lj b lk ll ln lo lq no lu np ly nq mc nr ns nt nu bi translated"><code class="fe na nb nc nd b">filename</code>:存储日志消息的日志文件的文件名。在这种情况下，输出的一个例子是<code class="fe na nb nc nd b">C:\temp\main_8888.txt</code>。我们可以使用PID(进程ID)作为唯一的标识符，作为文件名的一部分。因此，我们需要包含模块<code class="fe na nb nc nd b">os</code>:</li></ul><pre class="ks kt ku kv gt ne nd nf ng aw nh bi"><span id="dbc5" class="md me it nd b gy ni nj l nk nl">import logging, os </span></pre><ul class=""><li id="a73a" class="nm nn it lj b lk ll ln lo lq no lu np ly nq mc nr ns nt nu bi translated"><code class="fe na nb nc nd b">format</code>:日志文件中记录的消息格式。输出的一个可能的例子是<code class="fe na nb nc nd b">14 Aug 2021 00:00:00 from __main__: Hello World!</code>，其中<code class="fe na nb nc nd b">asctime</code>表示日期时间，<code class="fe na nb nc nd b">name</code>表示传递给函数的参数<code class="fe na nb nc nd b">name</code>，而<code class="fe na nb nc nd b">message</code>表示要记录的消息。日期时间的格式由下一个参数定义。</li><li id="b7f5" class="nm nn it lj b lk nv ln nw lq nx lu ny ly nz mc nr ns nt nu bi translated"><code class="fe na nb nc nd b">datefmt</code>:日期时间的格式。这里格式字符串<code class="fe na nb nc nd b">%d %b %Y %H:%M:%S</code>被翻译成<code class="fe na nb nc nd b">14 Aug 2021 00:00:00</code>。有关更多格式化指令，请参考<a class="ae oa" href="https://docs.python.org/3/library/time.html#time.strftime" rel="noopener ugc nofollow" target="_blank">时间—时间访问和转换— Python 3.9.6文档</a></li><li id="8939" class="nm nn it lj b lk nv ln nw lq nx lu ny ly nz mc nr ns nt nu bi translated"><code class="fe na nb nc nd b">level</code>:如果消息的级别高于或等于该参数，将被记录。否则，不会。在这里，水平被设置在<code class="fe na nb nc nd b">logging.INFO</code>。</li></ul><p id="9697" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">最后，我们通过调用<code class="fe na nb nc nd b">logging.getLogger(name)</code>返回一个Logger对象</p><h2 id="c0f3" class="md me it bd mf mg mh dn mi mj mk dp ml lq mm mn mo lu mp mq mr ly ms mt mu iz bi translated">记录器的使用</h2><p id="429d" class="pw-post-body-paragraph lh li it lj b lk mv kd lm ln mw kg lp lq mx ls lt lu my lw lx ly mz ma mb mc im bi translated">既然我们已经创建了一个基本的日志功能，我们需要将这个功能合并到我们的主应用程序中。</p><p id="2d7e" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">创建一个<code class="fe na nb nc nd b">main.py</code>并插入如下代码:</p><pre class="ks kt ku kv gt ne nd nf ng aw nh bi"><span id="bc7f" class="md me it nd b gy ni nj l nk nl">from log_utility import get_logger</span><span id="ecb3" class="md me it nd b gy ob nj l nk nl">logger = get_logger(__name__)</span><span id="4a6d" class="md me it nd b gy ob nj l nk nl">def run():<br/> logger.info('Hello World from main!')</span><span id="97ce" class="md me it nd b gy ob nj l nk nl">if __name__ == '__main__':<br/> run()</span></pre><p id="c728" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">运行<code class="fe na nb nc nd b">main.py</code>，你将得到一个日志文件<code class="fe na nb nc nd b">C:\temp\main_%PID%.txt</code>，其中<code class="fe na nb nc nd b">%PID%</code>是一个反映运行进程PID的数字序列。日志文件中一个可能的输出是<code class="fe na nb nc nd b">14 Aug 2021 00:58:46 from __main__: Hello World from main!</code>。</p><p id="fc43" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">就是这样！我们已经成功地实现了一个基本的日志功能，可以在项目的任何地方使用。每当我想到对这个日志记录机制的任何改进，我都会用它来更新这个页面。也欢迎分享你的想法。</p></div></div>    
</body>
</html>