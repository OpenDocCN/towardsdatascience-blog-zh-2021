<html>
<head>
<title>Two Sentiment Analysis Libraries and How They Perform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">两个情感分析库及其性能</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/two-sentiment-analysis-libraries-and-how-they-perform-3de4a06342ec?source=collection_archive---------31-----------------------#2021-06-07">https://towardsdatascience.com/two-sentiment-analysis-libraries-and-how-they-perform-3de4a06342ec?source=collection_archive---------31-----------------------#2021-06-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="19ca" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用文本块和VADER库进行情感分析很容易，但是它们有多准确呢</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1468f15e48e75c852e73f5e856e71966.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4_l47fE3XcTR237O"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@tengyart?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">腾雅特</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="33dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">情感分析不是一门精确的科学。自然语言中充满了奇怪的表达方式，意思不止一个的单词，习语，讽刺以及任何使意思提取变得困难的事物。看看这两句话。</p><p id="7621" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“我知道我为什么一直犯同样的错误——我不认为！”</p><p id="8f41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“情绪分析在所有情况下都是准确的——我不这么认为！”</p><p id="51f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第一句中，短语“我不认为”解释了句子的第一部分，但在第二句中，它是讽刺性的，否定了句子前一部分的意思。于是，我们有了两个相同的短语，根据它们的使用方式，它们有着完全不同的目的。</p><p id="7feb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，期望情绪分析器在所有情况下都准确是不合理的，因为句子的意思可能是模糊的。</p><p id="9265" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是它们有多准确呢？显然，这取决于用来执行分析的技术，也取决于上下文。为了找到答案，我们将使用两个易于使用的库做一个简单的实验，看看我们是否能找到我们期望的精度。</p><p id="d462" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以决定构建自己的分析器，这样做的话，您可能会学到更多关于情感分析和文本分析的知识。如果你想做这样的事情，我强烈推荐你阅读由<a class="lv lw ep" href="https://medium.com/u/4ae48256fb37?source=post_page-----3de4a06342ec--------------------------------" rel="noopener" target="_blank">康纳·奥沙利文</a>，<a class="ae ky" href="https://conorosullyds.medium.com/" rel="noopener">撰写的文章《情感分析简介</a>，他不仅解释了情感分析的目的，还演示了如何使用单词袋方法和称为支持向量机(SVN)的机器学习技术在Python中构建分析器。</p><p id="51ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，你可能更喜欢导入一个库，比如TextBlob或者VADER来完成这项工作。</p><p id="fe18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的节目中，我们将分析来自<a class="ae ky" href="http://help.sentiment140.com" rel="noopener ugc nofollow" target="_blank">sentitment 140</a>项目的一组推文。他们已经收集了160万条推文，这些推文被贴上了积极、消极或中性情绪的标签。</p><p id="05c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">推文真多。</p><p id="0add" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是我们将使用这些推文中的一个子集——只有500条。你可以在这里下载数据<a class="ae ky" href="http://help.sentiment140.com/for-students" rel="noopener ugc nofollow" target="_blank">sensition 140——给学者</a>。在这个网站上，你会发现一个zip文件，其中包含两个CSV文件，一个有160万条推文，另一个我们将使用500条推文—<em class="lx">testdata . manual . 2009 . 06 . 14 . CSV</em>。</p><p id="0640" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将对该文件运行TextBlob和VADER情感分析器，并查看结果与数据集中之前分配的标签相比如何。(有关分析器的更多信息，请参见我的文章<a class="ae ky" rel="noopener" target="_blank" href="/sentiment-analysis-of-tweets-167d040f0583">推文的情绪分析</a>。)</p><p id="0ab6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将一次检查几行代码，但在本文的最后会包括整个代码的要点。</p><p id="5c0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要导入库。</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="0d6e" class="md me it lz b gy mf mg l mh mi">from textblob import TextBlob<br/>from vaderSentiment.vaderSentiment import SentimentIntensityAnalyzer<br/>import pandas as pd</span><span id="85e6" class="md me it lz b gy mj mg l mh mi">analyzer = SentimentIntensityAnalyzer()</span></pre><p id="32c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那是文本博客，VADER和熊猫——不，是惊喜，在那里——然后我们创建了一个VADER分析器，我们以后会用到。</p><p id="a982" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们读取数据并做一些整理。</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="1aaf" class="md me it lz b gy mf mg l mh mi">completeDF = pd.read_csv("testdata.manual.2009.06.14.csv", names=["polarity", "id","date","query","user","text"])</span><span id="6b86" class="md me it lz b gy mj mg l mh mi">df = completeDF.drop(columns=['date','query','user'])<br/>df.polarity = df.polarity.replace({0: -1, 2: 0, 4: 1})</span></pre><p id="bea3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当读取csv文件时，我们给每一列一个名称。然而，我们并不真的需要所有这些列，所以我们立即创建一个新的数据帧，删除不需要的列。</p><p id="5100" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">原始数据将情绪分为“积极”、“中性”和“消极”，并分别用数字4、2和0表示这些情绪。这些值在“极性”栏中。我们将要使用的分析器使用相同的分类，但是使用1到-1之间的实数来表示情绪的极性。所以-1是很负，+1是很正，0是中性。0.5可能有些积极。</p><p id="2bad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我们将“极性”列的值更改为1表示正极，0表示中性，1表示负极。(这给我们带来了一个比较一系列数字的小问题，这些数字是由分析器生成的，与数据中记录的三个类别相比较——但是我们很快就会处理这个问题。)</p><p id="76ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来要做的是遍历数据中的推文，并通过两个分析器运行它们。我们将在list中记录结果，因此先定义两个空的。</p><p id="e365" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">真正的工作是由</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="2b59" class="md me it lz b gy mf mg l mh mi">TextBlob(text).sentiment.polarity)</span></pre><p id="5ba6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">获取TextBlob分析和</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="13be" class="md me it lz b gy mf mg l mh mi">analyzer.polarity_scores(text)['compound'])</span></pre><p id="d9da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从VADER那里得到分析结果。</p><p id="35e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">函数<code class="fe mk ml mm lz b">rounder</code>将完成从实数到类别的转换——稍后会详细介绍。</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="62d6" class="md me it lz b gy mf mg l mh mi">TBpol = []<br/>Vpol = []</span><span id="b030" class="md me it lz b gy mj mg l mh mi">for text in df['text']:<br/>    TBpol.append(rounder(TextBlob(text).sentiment.polarity))<br/>    Vpol.append(rounder(analyzer.polarity_scores(text)['compound']))</span></pre><p id="39b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将这两个列表作为新列添加到我们的数据框架中。</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="0f8c" class="md me it lz b gy mf mg l mh mi">df['TBPolarity'] = TBpol <br/>df['VPolarity'] = Vpol</span></pre><p id="6f37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是我们如何将一个0.5的极性转换成一个类别呢？应该是正面的还是中性的。你可以采取一种简单的方法，简单地对数字进行四舍五入，这样0.5以上的数字就变成1，-0.5以下的就变成-1，其他的都是0。但这确实有效，因为这意味着中性范围是其他两个范围的两倍。</p><p id="7882" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更合理的方法是向上舍入到1.3以上，从-1.3向下舍入。这意味着正值的范围。阴性和中性是一样的。但我并不是出于非常实际的目的才这么做的——效果并不太好。</p><p id="2e01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我解释一下。</p><p id="dc13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果在转换成类别时，我使范围相等，那么我得到的结果是:</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="9558" class="md me it lz b gy mf mg l mh mi">Overall length 498 <br/>VADER agreements/disagreements 302/196<br/>Accuracy: 60.6425702811245% <br/>TextBlob agreements/disagreements 217/281<br/>Accuracy: 43.57429718875502%</span></pre><p id="29a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一行是推文的数量，接下来的几行记录了分析师对预先分配的类别的认同程度，然后是准确率。VADER的准确率约为61%，TextBlob的准确率约为44%。不聪明。</p><p id="419a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，我摆弄了一下舍入函数，看看能否提高精度。把0以上的都当成正的，0以下的都当成负的，我得到了以下结果。</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="54d7" class="md me it lz b gy mf mg l mh mi">Overall length 498 <br/>VADER agreements/disagreements 360/138<br/>Accuracy: 72.28915662650603%<br/>TextBlob agreements/disagreements 324/174<br/>Accuracy: 65.06024096385542%</span></pre><p id="1b16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是相当好的。所以<code class="fe mk ml mm lz b">rounder</code>函数是这样的:</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="a6a4" class="md me it lz b gy mf mg l mh mi">def rounder(num):<br/>    if num &gt; 0: return 1<br/>    if num &lt; 0: return -1<br/>    return 0</span></pre><p id="5211" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">给出了72%和65%的准确率。</p><p id="2263" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些数字合理吗？这么简单的测试很难说。也许一个更大的数据集，或者不同类型的数据(即不是推文)会给出不同的结果。值得注意的是，上面提到的由@conorosullyds编写的分析器只给出了比VADER略好的结果(73%)，公平地说，VADER特别针对tweets，所以应该比更一般的TextBlob表现得更好。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="4e56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这些，我希望这是有趣的，一如既往地感谢阅读。我会像往常一样邀请你订阅不定期的<a class="ae ky" href="https://technofile.substack.com/" rel="noopener ugc nofollow" target="_blank">时事通讯</a>，获取我发表的文章的新闻以及我的代码的完整列表。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure></div></div>    
</body>
</html>