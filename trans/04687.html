<html>
<head>
<title>How to simulate a stock market with less than 10 lines of Python code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用不到10行Python代码模拟股票市场</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-simulate-a-stock-market-with-less-than-10-lines-of-python-code-5de9336114e5?source=collection_archive---------4-----------------------#2021-04-23">https://towardsdatascience.com/how-to-simulate-a-stock-market-with-less-than-10-lines-of-python-code-5de9336114e5?source=collection_archive---------4-----------------------#2021-04-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0243" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们用几何布朗运动来模拟一个金融市场</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d0368edbb0ea9cda468210a2edd03345.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Vj9mY_WEuDudIBpb"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马克西姆·霍普曼在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="0cf3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于那些对量化交易感兴趣的人来说，随机过程理论是美妙的，充满了理论机会。有时，为了测试交易策略，模拟股票市场可能是有用的。让我们看看理论是如何发挥作用的，以及如何使用Python将其转化为实践。</p><p id="0937" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">来自《走向数据科学》编辑的提示:</em> </strong> <em class="lv">虽然我们允许独立作者根据我们的</em> <a class="ae ky" rel="noopener" target="_blank" href="/questions-96667b06af5"> <em class="lv">规则和指导方针</em> </a> <em class="lv">发表文章，但我们并不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的</em> <a class="ae ky" rel="noopener" target="_blank" href="/readers-terms-b5d780a700a4"> <em class="lv">读者术语</em> </a> <em class="lv">。</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="8415" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">市场回报</h1><p id="3e5d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">除了价格，当涉及到股票市场建模时，我们可以建模的最重要的对象是回报。如果我们考虑特定的一天<em class="lv"> n </em>和它的前一天<em class="lv"> n-1 </em> <strong class="lb iu"> </strong>收益计算如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/ac52ec544895b77938a413a3a86695e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:368/format:webp/1*KcG2pmCIfDQp7pFwnualRw.png"/></div></figure><p id="52bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从这个定义出发，我们可以使用以下公式计算价格时间序列:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/c9bada98b4910e3b16a723712de737e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:412/format:webp/1*oiPAm7rvQCwIC-pUe5kNaQ.png"/></div></figure><p id="4b88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，知道了起始价格<em class="lv"> p0 </em>，我们就可以使用收益序列来计算未来价格。</p><p id="9f4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">问题是回报是随机对象，所以每次实现回报都会给我们不同的价格时间序列。价格的随机行为就是这样建模的。</p><p id="4ede" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，如果我们想模拟价格时间序列，我们需要对收益做一些假设，然后应用上面的公式。几何布朗运动就是这些假设之一。</p><h1 id="3af1" class="md me it bd mf mg nc mi mj mk nd mm mn jz ne ka mp kc nf kd mr kf ng kg mt mu bi translated">什么是几何布朗运动？</h1><p id="dc0c" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">GBM是股票市场的一个特殊模型，其收益是不相关的，并且是正态分布的。</p><p id="b61c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以从数学上把这句话翻译成:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/8cce7e1471dc9b3c48eedd6244907410.png" data-original-src="https://miro.medium.com/v2/resize:fit:278/format:webp/1*0PJfgG-8nIbeQV_pgy5hSg.png"/></div></figure><p id="4046" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也就是说，回报率正态分布，均值为μ，标准差为σ。请记住，这些参数与时间无关，因此该过程称为“稳态”。</p><p id="8e34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">μ是回报的平均值。如果它是积极的，我们有一个看涨的趋势。如果是负面的，我们有一个看跌的趋势。该参数的绝对值越高，趋势越强。</p><p id="8805" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">σ是收益的波动性。与μ相比，该值越高，价格越不稳定。</p><p id="7837" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回到投资组合理论，无风险收益等于0的夏普比率是μ/σ。</p><p id="d2b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于像我一样热爱统计背后的数学的人来说，如果我们切换到连续时间，我们可以写出这个随机微分方程(SDE):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/e72314f87d584edeb3ec14bd6e842ec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:470/format:webp/1*FQZmYuyGUuO2RO-ozjnFeg.png"/></div></figure><p id="1d8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中<em class="lv"> W </em>是维纳过程。</p><p id="938c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个模型经常在金融数学中使用，因为它是你能建立的最简单的股票市场模型。例如，它是诺贝尔奖获得者布莱克-肖尔斯期权理论的理论基础。然而，这个模型被证明并不完全正确，因为股票市场回报<a class="ae ky" rel="noopener" target="_blank" href="/statistical-analysis-of-a-stock-price-e6d6f84ac2cd">不是正态分布的，也不是平稳的</a>，但这是一个很好的起点。</p><p id="72c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在伊藤的解释下，SDE可以解析地解决，但在现实中，我们从来没有连续的时间，因为交易是离散的和有限的。因此，如果我们想模拟GBM，我们可以简单地离散时间，保持回报的正态性。这在数学上等同于使用<a class="ae ky" href="https://en.wikipedia.org/wiki/Euler%E2%80%93Maruyama_method" rel="noopener ugc nofollow" target="_blank">欧拉-丸山方法</a>数值求解SDE。</p><p id="92d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个想法非常简单:生成n个正态分布的随机变量，并从起始价格开始计算未来价格。</p><p id="d3f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看如何用不到10行代码在Python中实现它。</p><h1 id="7109" class="md me it bd mf mg nc mi mj mk nd mm mn jz ne ka mp kc nf kd mr kf ng kg mt mu bi translated">Python模拟</h1><p id="066d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">首先，让我们导入一些有用的库:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="209b" class="no me it nk b gy np nq l nr ns">import numpy as np<br/>import matplotlib.pyplot as plt</span></pre><p id="e0ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们必须定义μ，σ和起始价格。例如，我们可以使用这些值:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="098c" class="no me it nk b gy np nq l nr ns">mu = 0.001<br/>sigma = 0.01<br/>start_price = 5</span></pre><p id="9b54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在是模拟部分。首先，我们需要设置<em class="lv"> numpy </em>随机数发生器的种子，以便产生可重复的结果。然后，我们为回报生成100个值，最后我们从起始价格开始构建价格时间序列。</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="39a5" class="no me it nk b gy np nq l nr ns">np.random.seed(0)<br/>returns = np.random.normal(loc=mu, scale=sigma, size=100)<br/>price = start_price*(1+returns).cumprod()</span></pre><p id="c93c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们可以绘制这些结果:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="82ce" class="no me it nk b gy np nq l nr ns">plt.plot(price)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/bd0a0b7d921c527e84fa415b833d9677.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*kOxp4-7Iqw7yTRon9KE_cw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">股票市场的模拟。作者图片</p></figure><p id="4fd1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样。总共9行。它看起来真的像一个股票价格，不是吗？</p><p id="c56d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，我们可以增加μ的值，看看会发生什么。</p><p id="e025" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，μ=0.004时，我们有:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/68ebc79fa76e83a21aaf58885e2d87a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*ggHebJnFGlW2SzXkvkVlXQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="9fe0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们所见，μ值越高，我们的看涨趋势越强。</p><h1 id="05bb" class="md me it bd mf mg nc mi mj mk nd mm mn jz ne ka mp kc nf kd mr kf ng kg mt mu bi translated">结论</h1><p id="290c" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">使用几何布朗运动在Python中模拟股票市场非常简单，但是当我们做这个练习时，我们需要记住股票市场并不总是正态分布的，也不是平稳的。例如，我们可以对μ和σ应用时间相关性，或者对回报使用不同的概率分布。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="b8e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv"> Gianluca Malato是意大利数据科学家和小说作家。他是数据科学、机器学习和数据分析在线学校</em><a class="ae ky" href="https://www.yourdatateacher.com/" rel="noopener ugc nofollow" target="_blank"><em class="lv">YourDataTeacher.com</em></a><em class="lv">的创始人。</em></p></div></div>    
</body>
</html>