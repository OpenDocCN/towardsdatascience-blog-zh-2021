<html>
<head>
<title>3 Solutions for the Setting with Copy Warning of Python Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python熊猫复制警告设置的3种解决方案</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-solutions-for-the-setting-with-copy-warning-of-python-pandas-dfe15d62de08?source=collection_archive---------3-----------------------#2021-11-09">https://towardsdatascience.com/3-solutions-for-the-setting-with-copy-warning-of-python-pandas-dfe15d62de08?source=collection_archive---------3-----------------------#2021-11-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="970d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">永远不要忽略警告。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9ae694a5994fb1ecdc4b3baf87760db8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mBc-X7D8OU78Bq1enfyMNg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@neonbrand?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> NeONBRAND </a>在<a class="ae ky" href="https://unsplash.com/s/photos/solution?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="0426" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你曾经对熊猫进行过数据分析或操作，你很有可能至少遇到一次<code class="fe lv lw lx ly b">SettingWithCopy</code>警告。</p><p id="9e69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们尝试使用链式索引进行赋值时，会出现此警告，因为链式索引具有固有的不可预测的结果。</p><p id="6d3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是链式索引的样子:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="1770" class="md me it ly b gy mf mg l mh mi">df[df["column_a" &gt; 5]["column_b"]</span></pre><p id="5f4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一部分筛选a列中的值大于5的行，第二部分从筛选的数据框中选择b列。</p><p id="a95b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">问题是这种链式索引可能会返回一个视图或副本。</p><p id="ab4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果是视图，那么我们所做的更改也会反映在原始数据框中。例如，以下代码将更新原始数据框。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="9858" class="md me it ly b gy mf mg l mh mi">df[df["column_a" &gt; 5]["column_b"] = 5</span></pre><p id="29d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果返回的是副本，则不会在原始数据框中进行更改。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/71928a0e681b7914e9fa6b39e6ff4e07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wqS5EVz3g4UnglA9GP9gQA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">查看与复制(图片由作者提供)</p></figure><p id="e12e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是熊猫在出现这种暧昧情况时会警告我们的原因。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="4187" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将讨论导致<code class="fe lv lw lx ly b">SettingWithCopy</code>警告的3种解决方案。</p><p id="e0b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">先来看一个给我们警示的真实案例。我创建了一个包含7行4列的样本数据框。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/1f7b48c626e04f859e9f6ee2fac1a6f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*knBz7bLh8rybQinrqK02Dg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure><p id="4c9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想将不在产品组PG2中的产品价格降低50%。这是我想到的第一个解决方案。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="290e" class="md me it ly b gy mf mg l mh mi">df[df["product_group"]!="PG2"]["price"] = df[df["product_group"]!="PG2"]["price"] * 0.5</span><span id="2c9a" class="md me it ly b gy ms mg l mh mi">SettingWithCopyWarning: <br/>A value is trying to be set on a copy of a slice from a DataFrame.</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/1f7b48c626e04f859e9f6ee2fac1a6f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*knBz7bLh8rybQinrqK02Dg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure><p id="e302" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于链式索引和所选产品的价格没有变化，我们收到了一个警告。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="1c1d" class="mt me it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">解决方案1</h1><p id="8448" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">第一种选择是使用loc方法。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="c7d2" class="md me it ly b gy mf mg l mh mi">df.loc[df["product_group"]!="PG2", "price"] = df.loc[df["product_group"]!="PG2", "price"] * 0.5</span><span id="30d0" class="md me it ly b gy ms mg l mh mi">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/40061131e39800e5db6d8c8ddd9a216c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*jdd_Ok_C1LSUXcxIMx_cVw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure><p id="593d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以看到数据框中的价格变化。</p><p id="87e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">loc方法允许在单个步骤中进行筛选和选择，因此不会出现链式索引。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="b8cf" class="mt me it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">解决方案2</h1><p id="803f" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">另一种方法是where函数，它可用于根据条件更新值。</p><p id="c21f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">where函数的工作方式如下:</p><ul class=""><li id="cbb3" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated">它接受条件和值</li><li id="bf85" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">当条件为真时，它保持原始值</li><li id="a7f5" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">当条件不成立时，它用给定值更新原始值</li></ul><p id="e9d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码片段没有改变产品组PG2中产品的价格，但是将其他产品的价格减半。</p><p id="1991" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了保存数据框中的更改，将inplace参数设置为true。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="226d" class="md me it ly b gy mf mg l mh mi">df["price"].where(<br/>   df["product_group"]=="PG2", df["price"] * 0.5, inplace=True<br/>)</span><span id="cf4d" class="md me it ly b gy ms mg l mh mi">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/40061131e39800e5db6d8c8ddd9a216c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*jdd_Ok_C1LSUXcxIMx_cVw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="6af8" class="mt me it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">解决方案3</h1><p id="306f" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">我们还可以使用替换功能来更新数据框中的值，而不会出现<code class="fe lv lw lx ly b">SettingWithCopy</code>警告。</p><p id="901e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们需要将产品组PG4更改为PG14。这是一个给我们警告的解决方案。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="7086" class="md me it ly b gy mf mg l mh mi">df[df["product_group"]=="PG4"]["product_group"] = "PG14"</span><span id="407a" class="md me it ly b gy ms mg l mh mi">df</span><span id="19f7" class="md me it ly b gy ms mg l mh mi">SettingWithCopyWarning: <br/>A value is trying to be set on a copy of a slice from a DataFrame.</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/c29c7d6dbe4d98280d9180476b896e51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*LNszixCFqeKxloz91GZGKA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure><p id="544f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们收到了警告，而且值也没有更新。</p><p id="8aa4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是应用于列而不是数据框的略有不同的版本。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="ca8e" class="md me it ly b gy mf mg l mh mi">df["product_group"][df["product_group"]=="PG4"] = "PG14"</span><span id="2f5c" class="md me it ly b gy ms mg l mh mi">df</span><span id="61f9" class="md me it ly b gy ms mg l mh mi">SettingWithCopyWarning: <br/>A value is trying to be set on a copy of a slice from a DataFrame.</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/02f4c8a9698decb4383abfbdfb15f369.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*6CMHCUXG4SutqneARpfr3w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure><p id="3c90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们仍然得到警告，但是值被更新了。这就是为什么我们不应该相信链式索引并且永远不要忽略这些警告的原因。</p><p id="d5c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下代码片段使用replace函数执行此任务。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="9aa9" class="md me it ly b gy mf mg l mh mi">df.replace({"product_group" : "PG4"}, "PG14", inplace=True)</span><span id="8ac2" class="md me it ly b gy ms mg l mh mi">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/21393f7fd5bc90649eff22d290fead22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*47h6YbHp1Jnoq2sPUQyREQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure><p id="ad1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">任务完成，没有任何错误！</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="8241" class="mt me it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">结论</h1><p id="a764" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">警告可能没有错误那么重要，因为它们不会停止代码的执行。您可以选择忽略错误并继续。</p><p id="26df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，你可能会得到意想不到的结果。因此，了解警告的根本原因并解决它是非常重要的。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="3c0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你还不是<a class="ae ky" href="https://sonery.medium.com/membership" rel="noopener">中级会员</a>并计划成为其中一员，我恳请你使用以下链接。我将收取你的一部分会员费，不增加你的额外费用。</p><div class="oh oi gp gr oj ok"><a href="https://sonery.medium.com/membership" rel="noopener follow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">通过我的推荐链接加入Medium-Soner yl DRM</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">sonery.medium.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy ks ok"/></div></div></a></div></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="3e87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>