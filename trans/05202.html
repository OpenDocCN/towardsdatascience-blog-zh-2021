<html>
<head>
<title>Trivially Scale PyTorch on AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS上的普通比例PyTorch</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/trivially-scale-pytorch-on-aws-4cfde16e6d37?source=collection_archive---------22-----------------------#2021-05-07">https://towardsdatascience.com/trivially-scale-pytorch-on-aws-4cfde16e6d37?source=collection_archive---------22-----------------------#2021-05-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fe73" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在AWS上运行PyTorch工作负载，无需更改代码</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/579a938af8df9a13e3d9a4eabddb68ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*wKIp3rys06B4vU4hNT2KHg.gif"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">来源<a class="ae kr" href="https://bestanimations.com/gifs/Large-Lightning-Bolt-Currents-Lace-Sky-Clouds-Over-City-Storm.html" rel="noopener ugc nofollow" target="_blank">bestanimation.com</a>(经许可)</p></figure><p id="a177" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><a class="ae kr" href="https://github.com/pytorch/pytorch" rel="noopener ugc nofollow" target="_blank"> PyTorch </a>是一个构建神经网络的惊人框架。很容易上手，也很快获得价值。但是对于实际的研究或生产用例，您的笔记本电脑或本地服务器就不行了。</p><p id="8d86" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在本教程中，我将向你展示如何在云上运行<strong class="ku ir"> ANY </strong> PyTorch代码，而无需做任何代码更改。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="eaf7" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">模型</h1><p id="5acb" class="pw-post-body-paragraph ks kt iq ku b kv mn jr kx ky mo ju la lb mp ld le lf mq lh li lj mr ll lm ln ij bi translated">对于本教程，我将从<a class="ae kr" href="https://github.com/pytorch/examples/tree/master/dcgan" rel="noopener ugc nofollow" target="_blank"> PyTorch示例库</a>中选择dcgan。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ms"><img src="../Images/c4aac2e8ca1373f24c7f6e03f6ff0a70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TO8d3Rhxm9ISpZ4ms9rT9w.png"/></div></div></figure><p id="70dc" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这个文件夹有3个文件，main.py和requirements.txt。</p><p id="833c" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这个模型是一个简单的<a class="ae kr" href="https://arxiv.org/abs/1511.06434" rel="noopener ugc nofollow" target="_blank">深度卷积GAN </a>，然而只要代码不崩溃，这个模型并不重要。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="c647" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">验证它不会在本地崩溃</h1><p id="358b" class="pw-post-body-paragraph ks kt iq ku b kv mn jr kx ky mo ju la lb mp ld le lf mq lh li lj mr ll lm ln ij bi translated">第一步是验证它不会在本地崩溃。为此，我将把它克隆到我的本地机器上并运行它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="3fcc" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">您现在应该会看到类似这样的内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mz"><img src="../Images/a0f6576a3c94563a7825064e2f9ffd82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*1B4DWYZeLtfC8cOcZu29Eg.gif"/></div></div></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="c032" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">在云上运行</h1><p id="c611" class="pw-post-body-paragraph ks kt iq ku b kv mn jr kx ky mo ju la lb mp ld le lf mq lh li lj mr ll lm ln ij bi translated">为了在AWS上运行，我们将使用Grid.ai ( <a class="ae kr" href="https://www.grid.ai/pricing/" rel="noopener ugc nofollow" target="_blank">在这里创建一个免费帐户</a>)。网格人工智能的免费层提供了许多功能，包括更便宜的AWS成本的现货定价。你仍然需要支付计算费用，但是价格和AWS一样。</p><p id="7979" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">现在安装网格并登录</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="b934" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">现在用<strong class="ku ir">网格运行</strong>改变单词python，按回车键！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mz"><img src="../Images/97cc49db9cdfe3d6f4fe6a3d1a807eae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*kaU5zkgcZoEeovjKQgoE5g.gif"/></div></div></figure><p id="d960" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">Grid将在AWS上运行代码！查看作业类型的状态</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi na"><img src="../Images/1d2ec2369a27ec35e548d72b72850290.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CYDFGwHZu_TFdAfg9-16Aw.png"/></div></div></figure><p id="b83b" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这个模型生成图像(毕竟是GAN)，我们来看看</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="f134" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">(没错，Grid制造了双关的名字)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nb"><img src="../Images/880428eb524392fddb5bc0fea1da0ae7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XxV1O_q5_wsNtalDU9ir6g.png"/></div></div></figure><p id="063b" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">还有很多，探索用户界面吧！</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="2b70" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">在GPU上运行</h1><p id="e87a" class="pw-post-body-paragraph ks kt iq ku b kv mn jr kx ky mo ju la lb mp ld le lf mq lh li lj mr ll lm ln ij bi translated">在单CPU机器上运行…嗯，没什么大不了的。我们用同样的努力在(2x) 4个GPU机器上运行怎么样？</p><p id="cec3" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这个GAN脚本实际上可以在2个GPU上运行…为了实现这一点，让我们添加脚本标志(<a class="ae kr" href="https://github.com/pytorch/examples/blob/master/dcgan/main.py#L28-L30" rel="noopener ugc nofollow" target="_blank">这里的这些参数</a>)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mz"><img src="../Images/df289102f7a3d556c316157281b4354f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*mUvpP-4aNfcC9QCzMsCzoQ.gif"/></div></div></figure><p id="a775" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">现在我们需要告诉grid在2个GPU上运行该模型(我选择的是4个v100s的机器)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mz"><img src="../Images/cefdf5f3a6d8c3c09593ab45bdeacd2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*s3f9-Pr27zv9A3fc20o-ww.gif"/></div></div></figure><p id="60b5" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">但是等等……机器有4个GPU，为什么不用4个GPU？嗯，我实际上想用不同的学习率来尝试相同的模型…所以我将要求grid使用我想尝试的学习率(0.001、0.002、0.01、0.02)给我这个模型的4个版本</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mz"><img src="../Images/ab62d27bad8784cee47cea89f7564a81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*HmcqjhkTKMyQyrCMmuyzRA.gif"/></div></div></figure><p id="6ffc" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">grid有大量的特殊语法来简化扫描。网格状态显示了我的4个实验。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nc"><img src="../Images/0289838d010f8fdfe1b930d6c08cdf33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0UL2Lk7ncLS_dCMvAL_BAA.png"/></div></div></figure><p id="c713" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">现在我的紧张的anaconda正在运行这个GAN的4个版本，每个版本在2个GPU上！</p><p id="bcc8" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在引擎盖下，grid启动了2台机器，并自动分发模型，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/c7ce5cb1286b17a2bed3b777d93ad6c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/1*aK3CJehbEKjOCjo_6L6_8g.gif"/></div></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="63ea" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">可中断机器</h1><p id="c7e1" class="pw-post-body-paragraph ks kt iq ku b kv mn jr kx ky mo ju la lb mp ld le lf mq lh li lj mr ll lm ln ij bi translated">云提供商提供节省成本的方法。在AWS上，您可以使用<strong class="ku ir"> use_spot </strong>标志为您的计算支付高达90%的折扣。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mz"><img src="../Images/746467f0fdbff7b516414d2ce4ed955d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*t-7TFwRJuUDJaWL0Ghy44Q.gif"/></div></div></figure><p id="35fa" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">但是不利的一面是，您的机器可能会在任何时候被终止…然而，对于许多工作负载来说，这是可以的。您可以随时从网格中获取模型检查点，并再次运行模型以继续训练</p><p id="5a20" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">完整的命令是:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="dde3" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">就是这样！</h1><p id="fe9e" class="pw-post-body-paragraph ks kt iq ku b kv mn jr kx ky mo ju la lb mp ld le lf mq lh li lj mr ll lm ln ij bi translated">网格不需要任何东西就可以扩展。对于具有大规模数据集和多节点模型的更严重的工作负载，grid也已经覆盖了<a class="ae kr" href="http://docs.grid.ai/" rel="noopener ugc nofollow" target="_blank">！</a></p><p id="e9a0" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">快乐训练！</p></div></div>    
</body>
</html>