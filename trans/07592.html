<html>
<head>
<title>How to Scrape Data from PDF Files Using Python and tabula-py</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python和tabula-py从PDF文件中抓取数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/scrape-data-from-pdf-files-using-python-fe2dc96b1e68?source=collection_archive---------1-----------------------#2021-07-12">https://towardsdatascience.com/scrape-data-from-pdf-files-using-python-fe2dc96b1e68?source=collection_archive---------1-----------------------#2021-07-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b84e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">你想和白板和熊猫交朋友</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ccb0747ab4e05b809ee1b8020eb576e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Bwgt-3VHlshuv0G8.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="1f01" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">背景</h1><p id="125d" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">数据科学专业人员正在处理各种形状和形式的数据。数据可以存储在流行的SQL数据库中，如PostgreSQL、MySQL或老式的excel电子表格。有时，数据也可能以非常规的格式保存，如PDF。在这篇文章中，我将讲述如何使用Python库:<strong class="ls iu"> tabula-py从PDF中抓取数据。</strong></p><h2 id="545d" class="mm kz it bd la mn mo dn le mp mq dp li lz mr ms lk md mt mu lm mh mv mw lo mx bi translated">必需的库</h2><ul class=""><li id="c71d" class="my mz it ls b lt lu lw lx lz na md nb mh nc ml nd ne nf ng bi translated"><strong class="ls iu"> tabula-py </strong>:从PDF文件中抓取文本</li><li id="24d8" class="my mz it ls b lt nh lw ni lz nj md nk mh nl ml nd ne nf ng bi translated"><strong class="ls iu"> re </strong>:使用正则表达式提取数据</li><li id="cf1a" class="my mz it ls b lt nh lw ni lz nj md nk mh nl ml nd ne nf ng bi translated"><strong class="ls iu"> pandas: </strong>构建和操作我们的面板数据</li></ul><h2 id="6434" class="mm kz it bd la mn mo dn le mp mq dp li lz mr ms lk md mt mu lm mh mv mw lo mx bi translated">安装库</h2><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="ff78" class="mm kz it nn b gy nr ns l nt nu">pip install tabula-py<br/>pip install pandas</span></pre><h2 id="2715" class="mm kz it bd la mn mo dn le mp mq dp li lz mr ms lk md mt mu lm mh mv mw lo mx bi translated">导入库</h2><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="499b" class="mm kz it nn b gy nr ns l nt nu">import tabula as tb<br/>import pandas as pd<br/>import re</span></pre><h1 id="566d" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">以结构化形式抓取PDF数据</h1><p id="68e5" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">首先，我们来谈谈以结构化格式抓取PDF数据。在下面的例子中，我们要刮左下角的桌子。它是结构良好的表格数据，其中的行和列定义良好。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/bda918498ead58f37bb9ac622f2fe998.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fN4QmRCoPSqC2WjXvE_PvA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">样本结构化数据(<a class="ae nw" href="https://www.infoplease.com/us/states/state-population-by-rank" rel="noopener ugc nofollow" target="_blank">来源</a>)</p></figure><p id="86d5" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">使用<code class="fe oc od oe nn b">tabula-py</code>可以直接抓取结构化形式的PDF数据。我们只需要通过指定<code class="fe oc od oe nn b">area</code>的<strong class="ls iu">(上、左、下、右)</strong>坐标来输入表格数据在PDF页面中的位置。在实践中，你将通过反复试验来学习使用什么样的价值观。如果PDF页面只包含目标表格，那么我们甚至不需要指定区域。<code class="fe oc od oe nn b">tabula-py</code>应该能够自动检测行和列。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="174f" class="mm kz it nn b gy nr ns l nt nu">file = 'state_population.pdf'<br/>data = tb.read_pdf(file, area = <strong class="nn iu">(300, 0, 600, 800)</strong>, pages = '1')</span></pre><h1 id="597f" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">以非结构化形式抓取PDF数据</h1><p id="f9ee" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">接下来，我们将探索更有趣的东西——非结构化格式的PFD数据。</p><p id="091c" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">为了实现统计分析、数据可视化和机器学习模型，我们需要表格形式的数据(面板数据)。然而，许多数据只能以非结构化格式获得。例如，人力资源人员可能会保留历史工资数据，这些数据可能不会以表格形式创建。在下图中，我们有一个工资数据的例子，它具有混合的数据结构。在左侧部分，它有长格式的数据，包括员工姓名、净额、支付日期和支付期间。在右边部分，它有支付类别、支付比率、时数和支付金额。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/c2976a847ccfc7ae4bbd2d6693b3d9eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pJl_P0KapiJZC9aU7oHzWQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(作者创作)</p></figure><p id="d645" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">我们需要采取几个步骤将数据转换成面板格式。</p><ul class=""><li id="4a78" class="my mz it ls b lt nx lw ny lz og md oh mh oi ml nd ne nf ng bi translated"><strong class="ls iu">步骤1:将PDF数据作为数据框架导入</strong></li></ul><p id="91e9" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">像结构化格式的数据一样，我们也使用<code class="fe oc od oe nn b">tb.read_pdf</code>来导入非结构化数据。这一次，我们需要指定额外的选项来正确导入数据。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="79b1" class="mm kz it nn b gy nr ns l nt nu">file = 'payroll_sample.pdf'<br/>df= tb.read_pdf(file, pages = '1', area = <strong class="nn iu">(0, 0, 300, 400)</strong>, columns = <strong class="nn iu">[200, 265, 300, 320]</strong>, pandas_options={'header': None}, stream=True)[0]</span></pre><ul class=""><li id="aa6e" class="my mz it ls b lt nx lw ny lz og md oh mh oi ml nd ne nf ng bi translated"><em class="oj">区域和列</em>:上面已经讲过<code class="fe oc od oe nn b">area</code>。这里我们还需要使用<code class="fe oc od oe nn b">columns</code>来标识所有相关列的位置。像area一样，列的值也是通过反复试验来确定的。</li><li id="f95d" class="my mz it ls b lt nh lw ni lz nj md nk mh nl ml nd ne nf ng bi translated"><em class="oj"> Stream and Lattice </em>:如果有网格线分隔每个单元格，可以用<code class="fe oc od oe nn b">lattice = True</code>自动识别每个单元格，如果没有，可以用<code class="fe oc od oe nn b">stream = True</code>和<code class="fe oc od oe nn b">columns</code>手动指定每个单元格。流模式将寻找列之间的空白。这些选项可能会产生巨大的影响，所以我们可以用lattice或stream进行实验，看看它们是否能改善整体抓取。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/1f574bc324a5100b65beac41ae7d41b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r5VUzr6iSRl4oqzgIn1pBA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(作者创作)</p></figure><ul class=""><li id="5dc3" class="my mz it ls b lt nx lw ny lz og md oh mh oi ml nd ne nf ng bi translated"><strong class="ls iu">步骤2:创建一个行标识符</strong></li></ul><p id="af04" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">现在我们有一些数据要处理，我们将使用Python库<code class="fe oc od oe nn b">Pandas</code>来操作数据帧。</p><p id="b564" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">首先，我们需要创建一个新列来标识唯一的行。我们注意到员工姓名(超人和蝙蝠侠)似乎有助于识别不同记录之间的边界。每个雇员的名字都包含一个独特的模式，以大写字母开始，以小写字母结束。我们可以使用正则表达式<code class="fe oc od oe nn b">'^[A-Z].*[a-z]$'</code>来标识雇员姓名，然后使用Pandas函数<code class="fe oc od oe nn b">cumsum</code>(累积和)来创建一个行标识符。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="b359" class="mm kz it nn b gy nr ns l nt nu">df['border'] = df.apply(lambda x: 1 if re.findall('^[A-Z].*[a-z]$', str(x[0])) else 0, axis = 1)<br/>df['row'] = df['border'].transform('cumsum')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/87661d6324ee3583844637e54bacab93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lnk7XfDYxJmgpXQZ8z_fPQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(作者创作)</p></figure><ul class=""><li id="0aaa" class="my mz it ls b lt nx lw ny lz og md oh mh oi ml nd ne nf ng bi translated"><strong class="ls iu">步骤3:重塑数据(将数据从长格式转换为宽格式)</strong></li></ul><p id="e1a4" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">接下来，我们将重塑左半部分和右半部分的数据。对于左侧部分，我们创建一个新的数据框架，<em class="oj"> employee </em>，其中包括employee_name、net_amount、pay_date和pay_period。对于右侧部分，我们创建另一个数据框架，<em class="oj">支付</em>，它包括加班费率、常规费率、加班小时数、常规小时数、加班金额和常规金额。要将数据转换成宽格式，我们可以使用Pandas函数<code class="fe oc od oe nn b">pivot</code>。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="aa4c" class="mm kz it nn b gy nr ns l nt nu"># reshape left section<br/>employee = df[[0, 'row']]<br/>employee = employee[employee[0].notnull()]<br/>employee['index'] = employee.groupby('row').cumcount()+1<br/>employee = employee.pivot(index = ['row'], columns = ['index'], values = 0).reset_index()<br/>employee = employee.rename(columns = {1: 'employee_name', 2: 'net_amount', 3: 'pay_date', 4: 'pay_period'})<br/>employee['net_amount'] = employee.apply(lambda x: x['net_amount'].replace('Net', '').strip(), axis = 1)</span><span id="0ee1" class="mm kz it nn b gy om ns l nt nu"># reshape right section<br/>payment = df[[1, 2, 3, 4, 'row']]<br/>payment = payment[payment[1].notnull()]<br/>payment = payment[payment['row']!=0]<br/>payment = payment.pivot(index = ['row'], columns = 1, values = [2, 3, 4]).reset_index()<br/>payment.columns = [str(col[0])+col[1] for col in payment.columns.values]<br/>for i in ['Regular', 'OT']:<br/>    payment = payment.rename(columns = {f'2{i}': f'{i}_Rate', f'3{i}': f'{i}_Hours', f'4{i}': f'{i}_Amt'})</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/cb95c005888f8d5292fcb39204965cc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ykVECK8YSCM791qnbmFHng.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(作者创作)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/381d34996474fc04a94ca3832948dcff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V17v9SbEzdwoTKooObB4mA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(作者创作)</p></figure><ul class=""><li id="ed4d" class="my mz it ls b lt nx lw ny lz og md oh mh oi ml nd ne nf ng bi translated"><strong class="ls iu">第四步:将左边部分的数据与右边部分的数据连接起来</strong></li></ul><p id="7a87" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">最后，我们使用函数<code class="fe oc od oe nn b">merge</code>根据行标识符连接<em class="oj">雇员</em>和<em class="oj">支付</em>数据帧。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="8e48" class="mm kz it nn b gy nr ns l nt nu">df_clean = employee.merge(payment, on = ['row'], how = 'inner')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/dd6f0af8561124a2f3f3dbfee26ba9f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dPDum4zH4aVkC4zx-qrLTw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(作者创作)</p></figure><h1 id="74e5" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">最后一个音符</h1><p id="40ec" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">时至今日，公司仍然手动处理PDF数据。在python库的帮助下，我们可以通过自动化从PDF文件中抓取数据并将非结构化数据转换为面板数据的过程来节省时间和金钱。</p><p id="6d6c" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">请记住，当从PDF文件中抓取数据时，您应该始终仔细阅读作者发布的条款和条件，并确保您有权限这样做。</p><p id="2075" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">如果你想继续探索PDF抓取，请查看我的其他文章:</p><ul class=""><li id="d7d2" class="my mz it ls b lt nx lw ny lz og md oh mh oi ml nd ne nf ng bi translated"><a class="ae nw" rel="noopener" target="_blank" href="/scrape-data-from-pdf-files-using-python-and-pdfquery-d033721c3b28"> <strong class="ls iu">使用Python和PDFQuery从PDF文件中抓取数据</strong> </a></li><li id="3a3a" class="my mz it ls b lt nh lw ni lz nj md nk mh nl ml nd ne nf ng bi translated"><a class="ae nw" rel="noopener" target="_blank" href="/scrape-data-from-pdf-files-using-python-fe2dc96b1e68"> <strong class="ls iu">使用Python和tabula-py从PDF文件中抓取数据</strong> </a></li><li id="c08b" class="my mz it ls b lt nh lw ni lz nj md nk mh nl ml nd ne nf ng bi translated"><a class="ae nw" href="https://python.plainenglish.io/convert-scanned-files-to-searchable-pdf-using-python-and-pytesseract-3ee31ee6f01f" rel="noopener ugc nofollow" target="_blank"> <strong class="ls iu">如何使用Python和Pytesseract将扫描文件转换为可搜索的PDF</strong></a></li><li id="ccba" class="my mz it ls b lt nh lw ni lz nj md nk mh nl ml nd ne nf ng bi translated"><a class="ae nw" rel="noopener" target="_blank" href="/pdf-text-extraction-while-preserving-whitespaces-using-python-and-pytesseract-ec142743e805"> <strong class="ls iu">使用Python和Pytesseract提取PDF文本，同时保留空白区域</strong> </a></li></ul><h1 id="e376" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">感谢您的阅读！！！</h1><p id="f1ea" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">如果你喜欢这篇文章，并且想<strong class="ls iu">请我喝杯咖啡，请</strong>点击这里。</p><p id="7805" class="pw-post-body-paragraph lq lr it ls b lt nx ju lv lw ny jx ly lz nz mb mc md oa mf mg mh ob mj mk ml im bi translated">您可以注册一个<a class="ae nw" href="https://aaron-zhu.medium.com/membership" rel="noopener"> <strong class="ls iu">会员</strong> </a>来解锁我的文章的全部访问权限，并且可以无限制地访问介质上的所有内容。如果你想在我发表新文章时收到电子邮件通知，请订阅。</p></div></div>    
</body>
</html>