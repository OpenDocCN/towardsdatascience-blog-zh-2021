<html>
<head>
<title>7 Key Operations for Data Wrangling in R or Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R或Python中数据争论的7个关键操作</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/7-key-operations-for-data-wrangling-in-r-or-python-6b1177e0a55e?source=collection_archive---------22-----------------------#2021-03-26">https://towardsdatascience.com/7-key-operations-for-data-wrangling-in-r-or-python-6b1177e0a55e?source=collection_archive---------22-----------------------#2021-03-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6488" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这两者之间的转换比看起来容易</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f6a845b69e7ab1d416be9d81a0e74277.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cCmM-qnx00zndgvMfQV60Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://burst.shopify.com/coding?utm_campaign=photo_credit&amp;utm_content=Free+Stock+Photo+of+Programmer+Focused+On+Code+%E2%80%94+HD+Images&amp;utm_medium=referral&amp;utm_source=credit" rel="noopener ugc nofollow" target="_blank">爆裂</a>的<a class="ae ky" href="https://burst.shopify.com/@sarahpflugphoto?utm_campaign=photo_credit&amp;utm_content=Free+Stock+Photo+of+Programmer+Focused+On+Code+%E2%80%94+HD+Images&amp;utm_medium=referral&amp;utm_source=credit" rel="noopener ugc nofollow" target="_blank">莎拉·普弗卢格</a>的照片</p></figure><p id="2f9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论您是数据科学家、数据工程师、数据分析师还是任何类型的开发人员，了解和学习多种编程语言一直都很重要。能够成为一名多才多艺的程序员意味着你的技能永远不会过时，你可以快速适应行业趋势。</p><p id="fbb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也就是说，作为程序员，我们都面临过这种熟悉的困境:</p><blockquote class="lv lw lx"><p id="8dfb" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">你有一个建立数据管道的大期限，而你的老板一直在问它的预计到达时间。或者你必须做那个机器学习类的项目，离期末报告只有几天了。您希望继续致力于提高您的R技能(或Python ),但是坚持使用您最熟悉的语言会更容易、更快、压力更小。</p></blockquote><p id="1405" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，现实情况是，对于使用Python处理数据框时可以做的任何事情，都有一种方法可以在r中完成。很多时候，除了语法之外，这种方法非常相似。</p><p id="ca86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将介绍在典型的数据争论过程中，您可能会遇到的7种有用的Python操作。但是我们也将一起看看用r实现它的等价代码。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><p id="1c99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用Kaggle上的澳大利亚降雨数据集。我们首先需要加载所需的包，并使用函数将csv文件读入数据帧。</p><p id="da23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="ly"> Python </em> </strong></p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="af32" class="mo mp it mk b gy mq mr l ms mt">import pandas as pd</span><span id="5cb9" class="mo mp it mk b gy mu mr l ms mt">df = pd.read_csv(‘data/weatherAUS.csv’)<br/>df.head(5)</span></pre><p id="da10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="ly"> R </em> </strong></p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="2c22" class="mo mp it mk b gy mq mr l ms mt">library(dplyr)<br/>library(ggplot2)<br/>library(tidyr)<br/>library(pivottabler)<br/>library(reshape2) </span><span id="ecd7" class="mo mp it mk b gy mu mr l ms mt">df &lt;- read.csv(‘data/weatherAUS.csv’)<br/>head(df)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/13b9d1396b476ca59f4566beb3f8f54f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6jMgoXSqweGfshdWGL8gjw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">初始R数据帧</p></figure><h1 id="9475" class="mw mp it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">查找缺失值(NA)</h1><p id="5134" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated"><strong class="lb iu"> <em class="ly"> Python </em> </strong></p><p id="232e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过使用布尔检查来检查每一列，看看是否至少有一个<code class="fe ns nt nu mk b">NA</code>值存在，从而找到丢失的值。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="11d3" class="mo mp it mk b gy mq mr l ms mt">df.isna().any()</span></pre><p id="00e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="ly"> R </em> </strong></p><p id="5865" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在R中，我们可以使用<code class="fe ns nt nu mk b">sapply</code>函数应用类似的逻辑。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="a1a8" class="mo mp it mk b gy mq mr l ms mt">sapply(df, function(x)any(is.na(x)))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/72f2260c9571f123bee915ccde561756.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NMUGiHG0cVKY0MlrA2is4A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">对至少有一个NA缺失的数据帧列进行布尔检查</p></figure><h1 id="21a8" class="mw mp it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">替换缺失值(NA)</h1><p id="ea9a" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated"><strong class="lb iu"> <em class="ly"> Python </em> </strong></p><p id="1552" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于选择的列，我们可以用一个特定的值(比如零)来代替NAs。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="19b2" class="mo mp it mk b gy mq mr l ms mt">df[‘Rainfall’] = df[‘Rainfall’].fillna(0)</span></pre><p id="3618" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="ly"> R </em> </strong></p><p id="9c55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在R中，我们通过使用<code class="fe ns nt nu mk b">dplyr</code>管道<code class="fe ns nt nu mk b">%&gt;%</code>来链接数据转换。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="a02f" class="mo mp it mk b gy mq mr l ms mt">df$Rainfall &lt;- df$Rainfall %&gt;% replace_na(0)</span></pre><h1 id="7768" class="mw mp it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">删除缺失值(NA)</h1><p id="66d7" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated"><strong class="lb iu"> <em class="ly"> Python </em> </strong></p><p id="72c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们可以删除至少包含一个NA值的所有观察值。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="5932" class="mo mp it mk b gy mq mr l ms mt">df.dropna(axis=0, inplace=True)</span></pre><p id="5a83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="ly"> R </em> </strong></p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="2fc3" class="mo mp it mk b gy mq mr l ms mt">df &lt;- df %&gt;% drop_na()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/b73064657456c599026b179b74e1e4dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OmOOEBtweo8qxFEGSFml5Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">丢失值的结果R数据帧被丢弃</p></figure><h1 id="b2a0" class="mw mp it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">应用分组依据和聚集</h1><p id="0087" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated"><strong class="lb iu"> <em class="ly">巨蟒</em> </strong></p><p id="e888" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Python中，我们可以对数据进行分组，并通过将命令链接到相应的数据帧来应用聚合计算。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="9a8d" class="mo mp it mk b gy mq mr l ms mt">df[[‘Location’, ‘MinTemp’, ‘MaxTemp’, <br/>    ‘Rainfall’, ‘WindGustSpeed’]].groupby(‘Location’).mean()</span></pre><p id="4522" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">T23】RT25】</strong></p><p id="3d9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这并不奇怪。我们可以使用dplyr的<code class="fe ns nt nu mk b">group_by</code>和<code class="fe ns nt nu mk b">summarise</code>功能。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="9fe5" class="mo mp it mk b gy mq mr l ms mt">df %&gt;% group_by(Location) %&gt;% <br/>           summarise(across(c(‘MinTemp’, ‘MaxTemp’, ‘Rainfall’,  <br/>                               ‘WindGustSpeed’), mean))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/72720ce312bdd6835bd96cf49a3beb3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MTrWn49p5DHeYY7bUP8WnQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">R中聚合集的结果group by</p></figure><h1 id="c31c" class="mw mp it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated"><strong class="ak">将自定义函数应用于数据帧列</strong></h1><p id="eace" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated"><strong class="lb iu"> <em class="ly"> Python </em> </strong></p><p id="decf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将函数应用于列的pythonic方式是使用<code class="fe ns nt nu mk b">apply</code>和<code class="fe ns nt nu mk b">lambda</code>函数。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="965f" class="mo mp it mk b gy mq mr l ms mt"># define function <br/>def convertToFahrenheit(c_degrees):<br/>    f = c_degrees * 1.8 + 32<br/>    return f</span><span id="9b7d" class="mo mp it mk b gy mu mr l ms mt">df[['MinTemp', 'MaxTemp']] = <br/>df[['MinTemp', 'MaxTemp']].apply(lambda x: convertToFahrenheit(x))</span></pre><p id="84a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">T33】RT35】</strong></p><p id="3ed3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe ns nt nu mk b">mutate</code>和<code class="fe ns nt nu mk b">sapply</code>的r-方式。Mutate可用于创建新列或更新现有列。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="fcf3" class="mo mp it mk b gy mq mr l ms mt">convertToFahrenheit &lt;- function(c_degrees){<br/>     f &lt;- c_degrees * 1.8 + 32<br/>     return(f)<br/>}</span><span id="03c4" class="mo mp it mk b gy mu mr l ms mt">df %&gt;% mutate(MinTemp = sapply(MinTemp, convertToFahrenheit),<br/>              MaxTemp = sapply(MaxTemp, convertToFahrenheit))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/b61746095639a89bbcee2b38ffbf912d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C4bWoLm6R73gRW6WE7xZ_w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">R中的结果数据帧具有最小和最大温度的突变列</p></figure><h1 id="3985" class="mw mp it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">创建数据透视表</h1><p id="1408" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated"><strong class="lb iu"> <em class="ly"> Python </em> </strong></p><p id="4cc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于那些熟悉<a class="ae ky" href="https://support.microsoft.com/en-us/office/create-a-pivottable-to-analyze-worksheet-data-a9a84538-bfe9-40a9-a8e9-f99134456576" rel="noopener ugc nofollow" target="_blank"> Excel的</a>著名数据透视表的人来说，我们可以很容易地在熊猫数据帧上这样做，以快速总结和汇总具体数据。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="12ae" class="mo mp it mk b gy mq mr l ms mt">pd.pivot_table(data=df,<br/>               values=’WindGustSpeed’,<br/>               index=’Location’,<br/>               columns=’WindGustDir’,<br/>               aggfunc=’mean’,<br/>               fill_value=0)</span></pre><p id="a6cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="ly"> R </em> </strong></p><p id="abca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然不那么直观，但我们可以使用reshape2的<code class="fe ns nt nu mk b">dcast</code>功能来实现。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="91d6" class="mo mp it mk b gy mq mr l ms mt">dcast(data=df, formula=Location ~ WindGustDir,   <br/>      value.var='WindGustSpeed', fun.aggregate=mean, fill=0)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/66980432cd99882241ff70b8a26e8aa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*irIkS1jFTmfjP54HgcxWhw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">R中的结果数据透视表</p></figure><h1 id="e6ed" class="mw mp it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated"><strong class="ak">检测数据集中异常值的存在</strong></h1><p id="d98f" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated"><strong class="lb iu"> <em class="ly"> Python </em> </strong></p><p id="cc15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然有许多方法可以识别异常值，但我们可以用pandas数据框架来做这件事的一个常用方法是为我们感兴趣的列绘制一个箱线图。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="53da" class="mo mp it mk b gy mq mr l ms mt">df.boxplot(column=[‘Rainfall’])</span></pre><p id="f694" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="ly"> R </em> </strong></p><p id="07b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谈到探索性数据分析和可视化，R的<code class="fe ns nt nu mk b">ggplot2</code>包允许我们轻松地生成一个箱线图。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="900b" class="mo mp it mk b gy mq mr l ms mt">ggplot(df, aes(x=Rainfall)) + geom_boxplot()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/86753e1cbf436e598f72a7d43c7c1e33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3DRhEw4kglROkduaLUNZoQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">R中降雨量数据的结果曲线图</p></figure><h1 id="4cb8" class="mw mp it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">摘要</h1><p id="0d04" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">上面的例子并没有穷尽R和Python中可以对数据帧执行的所有操作。但希望它能让你看到克服犹豫是多么容易，也许在你的下一个数据争论任务中尝试一种新的语言。</p><p id="2242" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于接下来的步骤，如果你真的很习惯使用Python中的<em class="ly"> pandas </em>，挑战自己使用类似的<a class="ae ky" href="https://dplyr.tidyverse.org/" rel="noopener ugc nofollow" target="_blank"><em class="ly">dplyr</em></a><em class="ly"/><a class="ae ky" href="https://tidyr.tidyverse.org/" rel="noopener ugc nofollow" target="_blank"><em class="ly">tidyr</em></a><em class="ly"/>和<a class="ae ky" href="https://cran.r-project.org/web/packages/reshape2/index.html" rel="noopener ugc nofollow" target="_blank"> <em class="ly"> reshape2 </em> </a>包</p><p id="a32e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。希望这对您有所帮助，如果您有任何问题或对任何其他类似的具体并行系列操作感兴趣，请告诉我。</p></div></div>    
</body>
</html>