<html>
<head>
<title>End-to-End AutoML Pipeline with H2O AutoML, MLflow, FastAPI, and Streamlit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">H2O AutoML、MLflow、FastAPI 和 Streamlit 的端到端 AutoML 管道</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/end-to-end-automl-train-and-serve-with-h2o-mlflow-fastapi-and-streamlit-5d36eedfe606?source=collection_archive---------10-----------------------#2021-12-20">https://towardsdatascience.com/end-to-end-automl-train-and-serve-with-h2o-mlflow-fastapi-and-streamlit-5d36eedfe606?source=collection_archive---------10-----------------------#2021-12-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="edad" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于使用一系列强大工具来培训和服务保险交叉销售的 AutoML 渠道的简单易懂的综合指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d846dab82e70c8f21ceb4ef89202faf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ihdSOuQGf9P1mtIj"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@fitzmaug?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">乔治·菲兹莫里斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="c07a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">传统的机器学习(<strong class="lb iu"> ML </strong>)模型开发耗时、资源密集，需要高度的技术专业知识和多行代码。</p><p id="64ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着自动化机器学习(<strong class="lb iu"> AutoML </strong>)的出现，这一模型开发过程已经加速，允许数据科学家高效地生成高性能和可扩展的模型。</p><p id="a31a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，除了模型开发，在一个生产就绪的 ML 系统中还有多个组件需要大量的工作。</p><p id="d73c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本综合指南中，我们将探讨如何使用 H2O AutoML、MLflow、FastAPI 和 Streamlit 的强大功能来建立、培训和服务一个 ML 系统。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/54613c13e3f33e1a7aa715d3ea873be7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NCyuDpkyu6m_FtfS.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ML 代码只是 ML 生产系统的一小部分</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="9199" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">内容</h1><blockquote class="mv mw mx"><p id="a65a" class="kz la my lb b lc ld ju le lf lg jx lh mz lj lk ll na ln lo lp nb lr ls lt lu im bi translated"><strong class="lb iu"><em class="it">(1)</em></strong><a class="ae ky" href="#6194" rel="noopener ugc nofollow"><em class="it">业务上下文</em></a><strong class="lb iu"><em class="it"><br/>(2)</em></strong><a class="ae ky" href="#fb1d" rel="noopener ugc nofollow"><em class="it">工具概述</em></a><strong class="lb iu"><em class="it"><br/>(3)</em></strong><a class="ae ky" href="#e6ac" rel="noopener ugc nofollow"><em class="it">分步实施</em></a><em class="it"><br/></em><strong class="lb iu"><em class="it"/></strong></p></blockquote></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="6194" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">(1)商业背景</h1><p id="6af7" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated"><strong class="lb iu">保险中的交叉销售</strong>是推销与客户已有保单互补的产品的做法。</p><p id="709e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">交叉销售创造了双赢局面，客户可以以较低的捆绑价格获得全面的保护。与此同时，保险公司可以通过提高保单转换来增加收入。</p><p id="98e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该项目旨在通过建立一个 ML 渠道来<strong class="lb iu">识别有兴趣购买额外车辆保险的健康保险客户</strong>，从而使交叉销售更加高效和有针对性。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/a4f774bca331f285151ea638483b3286.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*01QrVZsLhzmOR4CR"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@medienstuermer?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">医学家</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="fb1d" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">(2)工具概述</h1><h2 id="d496" class="ni me it bd mf nj nk dn mj nl nm dp mn li nn no mp lm np nq mr lq nr ns mt nt bi translated">H2O 汽车公司</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/ed7d97f8e386a60644fefcb31521265b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BWGv2zHl-ULAtGonIqYvQg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://github.com/h2oai/h2o-3/blob/master/LICENSE" rel="noopener ugc nofollow" target="_blank"> Apache 许可 2.0 </a>下使用的图像</p></figure><p id="4553" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/welcome.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> H2O </strong> </a>是一个开源的、分布式的、可扩展的平台，使用户能够在企业环境中轻松构建和生产 ML 模型。</p><p id="7c6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">H2O 的主要特色之一是<a class="ae ky" href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/automl.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> H2O 汽车</strong> </a>，这是一项自动化 ML 工作流程的服务，包括多个模型的自动训练和调整。</p><p id="81d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种自动化允许团队关注其他重要的组件，例如数据预处理、特征工程和模型部署。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="17ec" class="ni me it bd mf nj nk dn mj nl nm dp mn li nn no mp lm np nq mr lq nr ns mt nt bi translated">MLflow</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/31586f77d50ebf49a62051aa81bc4816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*84mItoTSiJXttPw19rz_Ag.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://github.com/mlflow/mlflow/blob/master/LICENSE.txt" rel="noopener ugc nofollow" target="_blank"> Apache 2.0 许可下使用的图像</a></p></figure><p id="feed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://mlflow.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> MLflow </strong> </a>是一个管理 ML 生命周期的开源平台，包括实验、部署和中央模型注册中心的创建。</p><p id="1053" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://www.mlflow.org/docs/latest/tracking.html" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">ML flow Tracking</strong></a><a class="ae ky" href="https://www.mlflow.org/docs/latest/concepts.html" rel="noopener ugc nofollow" target="_blank">组件</a>是一个 API，它<strong class="lb iu">记录并加载</strong>ML 模型实验的参数、代码版本和工件。</p><p id="2262" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">MLflow 还附带了一个<a class="ae ky" href="https://www.mlflow.org/docs/latest/python_api/mlflow.h2o.html" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="my">mlflow . H2O</em></strong></a>API 模块，该模块集成了 H2O AutoML 运行与 ml flow 跟踪。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="e9b0" class="ni me it bd mf nj nk dn mj nl nm dp mn li nn no mp lm np nq mr lq nr ns mt nt bi translated">FastAPI</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/b1c9d9c62cca9932ea77963f963919e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wn9Jd9_wmaCrYaw7F1YdpA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">根据<a class="ae ky" href="https://github.com/tiangolo/fastapi/blob/master/LICENSE" rel="noopener ugc nofollow" target="_blank">麻省理工学院许可</a>使用图像</p></figure><p id="5a39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> FastAPI </strong> </a>是一个快速高效的 web 框架，用于在 Python 中构建 API。它的设计是用户友好的、直观的和生产就绪的。</p><p id="4161" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将我们的 ML 模型部署为 FastAPI 端点的目的是在将我们的测试数据解析到 API 中之后，能够容易地检索预测结果。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="5aae" class="ni me it bd mf nj nk dn mj nl nm dp mn li nn no mp lm np nq mr lq nr ns mt nt bi translated">细流</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/f0f8b5e1a221526de9d3c49b59c0ccbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*udmmwYRHkh9c1KhRSqhGog.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://streamlit.io/brand" rel="noopener ugc nofollow" target="_blank">品牌条款下使用的图像</a></p></figure><p id="930e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> Streamlit </strong> </a>是一个开源的应用框架，可以在几分钟内将数据脚本转化为可共享的 web 应用。它有助于为技术和非技术用户创建用户友好的前端界面。</p><p id="7cfe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用户界面允许我们通过 FastAPI 端点将数据上传到后端管道，然后点击鼠标下载预测。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="0364" class="ni me it bd mf nj nk dn mj nl nm dp mn li nn no mp lm np nq mr lq nr ns mt nt bi translated"><strong class="ak">虚拟环境设置</strong></h2><p id="ee85" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们首先使用<a class="ae ky" href="https://docs.python.org/3/library/venv.html#creating-virtual-environments" rel="noopener ugc nofollow" target="_blank"> <em class="my"> venv </em>模块</a>创建一个 Python 虚拟环境(参见下面的设置截图)。</p><p id="4d4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">激活虚拟环境后，我们根据<a class="ae ky" href="https://github.com/kennethleungty/End-to-End-AutoML-Insurance/blob/main/requirements.txt" rel="noopener ugc nofollow" target="_blank"> <em class="my">需求，用<code class="fe nw nx ny nz b">pip install -r requirements.txt</code>安装必要的包。</em></a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/a3ae65e8dc52c91fb810b5a573e7f1ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J88akxBwgGSN-dZwOR6c4g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">虚拟环境的设置(命名为<em class="ob"> env_automl </em> ) |图片作者</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="e6ac" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">(3)分步实施</h1><p id="1616" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated"><strong class="lb iu">这个项目的 GitHub repo 可以在</strong> <a class="ae ky" href="https://github.com/kennethleungty/End-to-End-AutoML-Insurance" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">这里</strong> </a>找到，在这里可以找到跟随的代码。</p><h1 id="d89c" class="md me it bd mf mg oc mi mj mk od mm mn jz oe ka mp kc of kd mr kf og kg mt mu bi translated">㈠数据获取和勘探</h1><p id="d799" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们将使用<a class="ae ky" href="https://www.kaggle.com/anmolkumar/health-insurance-cross-sell-prediction" rel="noopener ugc nofollow" target="_blank">健康保险交叉销售预测</a>数据，我们可以通过 Kaggle API 检索这些数据。</p><p id="7eae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用 API，请转到“帐户”选项卡(<em class="my">kaggle.com/&lt;用户名&gt;/帐户</em>)，然后选择“<strong class="lb iu">创建 API 令牌</strong>”。这个动作触发下载包含您的 API 凭证的<em class="my"> kaggle.json </em>文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/1529a5f9dad9875ecd0221485c742c9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zo2LTRNXOcw0JYIdUe1Qvw.png"/></div></div></figure><p id="c656" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用<a class="ae ky" href="https://github.com/JovianML/opendatasets" rel="noopener ugc nofollow" target="_blank"> <em class="my"> opendatasets </em> </a>包(与<code class="fe nw nx ny nz b">pip install opendatasets</code>一起安装)和凭证来检索原始数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="40c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据集包含 12 个<strong class="lb iu">特征</strong>，描述 38 万+ <strong class="lb iu">健康保险投保人</strong>的概况。所有的数据都被匿名化和数字化，以确保隐私和保密性。</p><p id="31e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">目标</strong>变量是<strong class="lb iu"> <em class="my">响应</em> </strong>，客户购买额外车辆保险的<strong class="lb iu">兴趣</strong>的二元度量(其中<strong class="lb iu"> 1 </strong>表示正兴趣)。</p><p id="999b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其他变量如下:</p><ul class=""><li id="a8c2" class="ok ol it lb b lc ld lf lg li om lm on lq oo lu op oq or os bi translated"><strong class="lb iu"> id: </strong>每个客户的唯一标识符</li><li id="475b" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><strong class="lb iu">性别:</strong>客户性别</li><li id="d01a" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><strong class="lb iu">年龄:</strong>客户年龄(岁)</li><li id="0692" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><strong class="lb iu">驾驶执照:</strong>客户是否持有驾驶执照(1)</li><li id="499a" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><strong class="lb iu"> Region_Code: </strong>客户所在地区的唯一代码</li><li id="d45e" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><strong class="lb iu">以前投保:</strong>客户是否已经投保车辆保险(1)</li><li id="1839" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><strong class="lb iu">车龄:</strong>客户车辆的车龄</li><li id="807e" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><strong class="lb iu">车辆损坏:</strong>客户的车辆在过去(1)是否损坏</li><li id="6b87" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><strong class="lb iu">年度 _ 保费:</strong>客户一年支付的保费总额</li><li id="64c4" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><strong class="lb iu">保单销售渠道:</strong>保险代理人联系客户的渠道的匿名代码，例如电话、面谈</li><li id="cc63" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><strong class="lb iu">年份:</strong>客户在保险公司工作的天数</li></ul></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="6f12" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">(二)数据预处理</h1><p id="54d6" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">数据预处理和特征工程是任何数据科学项目的关键步骤。以下是所采取步骤的摘要:</p><ul class=""><li id="7afb" class="ok ol it lb b lc ld lf lg li om lm on lq oo lu op oq or os bi translated"><strong class="lb iu">标签编码<em class="my">性别</em>变量的</strong>(<em class="my">1 =女性，0 =男性</em>)</li><li id="37e3" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><strong class="lb iu">分类变量的一键编码</strong></li><li id="c2d4" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><strong class="lb iu">为更清晰起见，重命名一键编码变量的</strong></li><li id="4931" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><strong class="lb iu">数值变量的最小-最大缩放比例</strong></li></ul><p id="33b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="my">因为重点是展示端到端管道的设置，所以执行的转换没有尽可能广泛。在现实世界中，作为以数据为中心的方法的一部分，这一步值得深入研究。</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="3606" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">㈢H2O 和物流设置</h1><p id="21dc" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在对处理过的数据集开始模型训练之前，我们首先初始化一个<strong class="lb iu"> H2O 实例</strong>和一个<strong class="lb iu"> MLflow 客户端</strong>。</p><h2 id="3e93" class="ni me it bd mf nj nk dn mj nl nm dp mn li nn no mp lm np nq mr lq nr ns mt nt bi translated"><strong class="ak"> H2O 初始化</strong></h2><p id="94c5" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">一个 H2O 实例的初始化可以用<code class="fe nw nx ny nz b">h2o.init()</code>来完成，之后它将在<code class="fe nw nx ny nz b">127.0.0.1:54321</code>连接一个本地 H2O 服务器。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="9d45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">H2O 连接成功后，将显示以下打印输出。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/e16c9191f9f1b34fb8cb7e59aea39ce0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dYF-VvfHiaPxThB4dCu5ug.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">成功连接到 H2O 本地服务器后的输出|图片作者</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="83a4" class="ni me it bd mf nj nk dn mj nl nm dp mn li nn no mp lm np nq mr lq nr ns mt nt bi translated">MLflow 初始化</h2><p id="f8ae" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">MLflow 用<code class="fe nw nx ny nz b">client = MlflowClient()</code>初始化，这创建了一个管理我们的实验运行的<a class="ae ky" href="https://www.mlflow.org/docs/latest/python_api/mlflow.tracking.html" rel="noopener ugc nofollow" target="_blank"> MLflow 跟踪服务器</a>客户端。</p><p id="6590" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个 MLflow 实验可以包含多个 ML 训练运行，所以我们从<strong class="lb iu">创建和设置</strong>我们的第一个实验(<code class="fe nw nx ny nz b">automl-insurance</code>)开始。默认情况下，日志记录在本地的<code class="fe nw nx ny nz b">/mlruns</code>子文件夹中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/805048db8848d170c18fca9d5ad5c68a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W2vno__S1aFLK9InOS5PFA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">MLflow 实验设置的打印输出|作者提供的图片</p></figure><p id="8d07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">MLflow 有一个<strong class="lb iu">用户界面</strong>用于浏览我们的 ML 实验。我们可以通过在命令提示符下(从项目目录中)运行<code class="fe nw nx ny nz b">mlflow ui</code>，然后访问本地主机 URL <code class="fe nw nx ny nz b">127.0.0.1:5000</code>来访问该界面。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/3f6363b018ae7d3101bd91e8bf048493.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i30-vbYfm12Qr_0uXUteSQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">按作者初始化 MLflow 跟踪 UI |图像的命令</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/4f423e17a314f5db6977457f40c425a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UNneQIo_rSGTkELTZIGmxw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">MLflow 实验跟踪的用户界面|作者图片</p></figure><p id="f667" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了本地文件存储之外，还有各种<a class="ae ky" href="https://mlflow.org/docs/latest/tracking.html#backend-stores" rel="noopener ugc nofollow" target="_blank">后端</a>和<a class="ae ky" href="https://mlflow.org/docs/latest/tracking.html#artifact-stores" rel="noopener ugc nofollow" target="_blank">工件</a>存储配置，用于将运行<a class="ae ky" href="https://www.mlflow.org/docs/latest/tracking.html#how-runs-and-artifacts-are-recorded" rel="noopener ugc nofollow" target="_blank">记录</a>到 SQLAlchemy 兼容数据库或远程跟踪服务器。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="da0f" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">(四)H2O 汽车公司的物流跟踪培训</h1><p id="f4a1" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">将我们的数据作为 H2O 数据框导入，定义目标和预测特征，并将目标变量设置为分类变量(用于<strong class="lb iu">二元分类</strong>)后，我们可以开始模型训练设置。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="9cfd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">H2O <a class="ae ky" href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/automl.html" rel="noopener ugc nofollow" target="_blank"> AutoML </a>提供了一个包装器函数<code class="fe nw nx ny nz b">H2OAutoML()</code>，它自动执行各种 ML 算法的训练。</p><p id="c237" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们初始化一个 AutoML 实例(<code class="fe nw nx ny nz b">aml = H2OAutoML()</code>)时，我们使用<code class="fe nw nx ny nz b">mlflow.start_run()</code>将它包装在一个 MLflow 上下文管理器中，以便将模型记录在一个活动的 MLflow 运行中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="615f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是对 AutoML 实例参数的解释:</p><ul class=""><li id="6753" class="ok ol it lb b lc ld lf lg li om lm on lq oo lu op oq or os bi translated"><code class="fe nw nx ny nz b"><strong class="lb iu">max_models</strong></code> —在自动运行中构建的模型的最大数量</li><li id="2e8d" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><code class="fe nw nx ny nz b"><strong class="lb iu">seed</strong></code> <strong class="lb iu"> </strong> —再现性随机种子</li><li id="4973" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><code class="fe nw nx ny nz b"><strong class="lb iu">balance_classes</strong></code> —指示是否对少数类进行过采样以平衡类分布。</li><li id="ee1e" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><code class="fe nw nx ny nz b"><strong class="lb iu">sort_metric</strong></code> —指定用于在 AutoML 运行结束时对排行榜进行排序的指标</li><li id="08d4" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><code class="fe nw nx ny nz b"><strong class="lb iu">verbosity</strong></code> —培训期间要打印的后端消息类型</li><li id="a682" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><code class="fe nw nx ny nz b"><strong class="lb iu">exclude_algos</strong></code> <strong class="lb iu"> </strong> —指定建模时要跳过的算法(<em class="my">我排除了</em> <a class="ae ky" href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/glm.html" rel="noopener ugc nofollow" target="_blank"> <em class="my"> GLM </em> </a> <em class="my">和</em><a class="ae ky" href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/drf.html" rel="noopener ugc nofollow" target="_blank"><em class="my">DRF</em></a><em class="my">以便重点放在</em><a class="ae ky" href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/gbm.html" rel="noopener ugc nofollow" target="_blank"><em class="my">GBM</em></a><em class="my">算法)</em></li></ul><p id="bb95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">然后，我们可以用一行代码启动 AutoML 培训</strong>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="3ebe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="my">考虑在</em><a class="ae ky" href="https://colab.research.google.com/" rel="noopener ugc nofollow" target="_blank"><em class="my">Google Colab</em></a></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="fd86" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">(五)记录最佳 AutoML 模型</h1><p id="623a" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">训练完成后，我们会获得一个显示候选型号列表的<strong class="lb iu">排行榜</strong>。该表根据前面指定的<code class="fe nw nx ny nz b">sort_metric</code>性能指标(<strong class="lb iu">日志损失</strong>)进行排序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/4381c1b17057bf4e01c336c36f289c21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*00vd1RkHYTYNUyH4-hhNKQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">排行榜中的 10 大算法|作者图片</p></figure><p id="896a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">排行榜显示，基于对数损失值(0.267856)，堆叠集合模型<strong class="lb iu">' stacked ensemble _ all models _ 4 '</strong>具有<strong class="lb iu">最佳</strong>性能。</p><p id="77e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">H2O 的<strong class="lb iu">堆叠集成</strong>是一个监督的 ML 模型，它使用<a class="ae ky" href="https://www.geeksforgeeks.org/stacking-in-machine-learning/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">堆叠</strong> </a>找到各种算法的最佳组合。算法的堆叠提供了比任何组成学习算法更好的预测性能。</p><p id="96fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来要做的是记录<strong class="lb iu">最佳</strong> AutoML 模型(又名<strong class="lb iu"> AutoML leader </strong>)。作为日志记录的一部分，我们还导入了<code class="fe nw nx ny nz b">mlflow.h2o</code>模块。我们希望记录 AutoML 模型的三个方面:</p><ul class=""><li id="3e49" class="ok ol it lb b lc ld lf lg li om lm on lq oo lu op oq or os bi translated">指标(例如，对数损失、AUC)</li><li id="1005" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated">模型工件</li><li id="adae" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated">排行榜(保存为工件文件夹中的 CSV 文件)</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="8b4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="my">您可以使用</em><a class="ae ky" href="https://github.com/kennethleungty/End-to-End-AutoML-Insurance/blob/main/train.py" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="my">train . py</em></strong></a><em class="my">脚本执行 AutoML 训练。这可以通过命令提示符下的</em> <code class="fe nw nx ny nz b">python train.py — —target ‘Response'</code> <em class="my">来完成。</em></p><p id="6dff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">H2O 还提供<a class="ae ky" href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/explain.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">模型可解释性</strong> </a>让你向技术和商业利益相关者解释模型的内部运作。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="e4f9" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">㈥生成和评估预测</h1><p id="4963" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在多次运行一个实验(或不同的实验)后，我们希望选择最佳模型进行模型推断。</p><p id="e7e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用<code class="fe nw nx ny nz b">mlflow.search_runs()</code>来寻找性能最好的模型，<code class="fe nw nx ny nz b">mlflow.h2o.load_model()</code>来加载 H2O 模型，而<code class="fe nw nx ny nz b">.predict()</code>来生成预测。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="8e9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">AutoML 模型与像<strong class="lb iu">XGBoost with randomized search cv</strong>这样的基线模型相比表现如何？以下是评估他们的预测后的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/4a41eae21af5526488fbab5c1a2fc337.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1UyFKwpVCdJ-Ss7BbPcVFQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">两种模型的性能指标比较|图片由作者提供</p></figure><p id="ec7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">AutoML 型号<strong class="lb iu">略胜基准</strong> <strong class="lb iu">。这种更好的性能证明了 AutoML 能够快速、轻松地交付高性能模型。</strong></p><p id="20d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="my">请务必查看详细描述这两个模型的训练和预测的笔记本:</em></p><ul class=""><li id="0613" class="ok ol it lb b lc ld lf lg li om lm on lq oo lu op oq or os bi translated"><a class="ae ky" href="https://github.com/kennethleungty/End-to-End-AutoML-Insurance/blob/main/notebooks/02_XGBoost_Baseline_Model.ipynb" rel="noopener ugc nofollow" target="_blank"><em class="my">02 _ XGBoost _ Baseline _ model . ipynb</em></a></li><li id="3c74" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated"><a class="ae ky" href="https://github.com/kennethleungty/End-to-End-AutoML-Insurance/blob/main/notebooks/03_H2O_AutoML_with_MLflow.ipynb" rel="noopener ugc nofollow" target="_blank"><em class="my">03 _ H2O _ AutoML _ with _ ml flow . ipynb</em></a></li></ul></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="dcd1" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">FastAPI 设置</h1><p id="63d7" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">既然我们已经选择了我们的最佳模型，那么是时候将它部署为 FastAPI 端点了。我们的目标是创建一个<strong class="lb iu">后端</strong>服务器，在那里我们的模型被加载并通过 HTTP 请求进行实时预测。</p><p id="f511" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在一个新的 Python 脚本<code class="fe nw nx ny nz b">main.py</code>中，我们用<code class="fe nw nx ny nz b">app = FastAPI()</code>创建了一个 FastAPI 实例，然后设置一个路径操作<code class="fe nw nx ny nz b">@app.post("/predict")</code>来生成并返回预测。</p><p id="6d37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还包括 H2O 和 MLflow 初始化的代码，以及来自<a class="ae ky" href="#e4f9" rel="noopener ugc nofollow"> <strong class="lb iu">步骤 vi </strong> </a>的模型推断的代码。</p><p id="b741" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="#e4f9" rel="noopener ugc nofollow"> <strong class="lb iu">步骤六</strong> </a> <strong class="lb iu"> </strong>中的模型推理代码旨在从所有实验中检索最佳模型，但您可以更改 ID 参数，以便使用特定实验运行的模型。</p><p id="0376" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">路径操作符将接收测试数据作为一个<strong class="lb iu">字节的</strong>文件对象，所以我们使用<code class="fe nw nx ny nz b">BytesIO</code>作为将数据转换成<a class="ae ky" href="https://docs.h2o.ai/h2o/latest-stable/h2o-py/docs/frame.html" rel="noopener ugc nofollow" target="_blank"> H2O 帧</a>的一部分。</p><p id="eb6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们需要一个包含模型预测的 JSON 输出。可以使用来自<code class="fe nw nx ny nz b">fastapi.responses</code>的<code class="fe nw nx ny nz b">JSONResponse</code>将输出作为 JSON 文件返回。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="6872" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="my">你可以在</em><a class="ae ky" href="https://github.com/kennethleungty/End-to-End-AutoML-Insurance/blob/main/backend/main.py" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="my">main . py</em></strong></a><em class="my">脚本中找到完整的 FastAPI 代码。</em></p><p id="4bc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一部分是通过运行<em class="my">uvi corn</em>T34】服务器(从存储脚本的<code class="fe nw nx ny nz b">backend</code>子目录中)来激活我们的 FastAPI 端点，方法是使用以下命令:</p><pre class="kj kk kl km gt pe nz pf pg aw ph bi"><span id="35d5" class="ni me it nz b gy pi pj l pk pl">uvicorn main:app --host 0.0.0.0 --port 8000</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pm"><img src="../Images/fb59aa50465c74f24420c2f49af0f512.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U2_DuRmaGcGA3BYT7LeW1A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">运行 uvicorn 服务器启动 FastAPI | Image by author 的命令行</p></figure><p id="5c6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">FastAPI 端点将在本地机器上提供服务，我们可以在<code class="fe nw nx ny nz b">127.0.0.1:8000/docs</code>(或<code class="fe nw nx ny nz b">localhost:8000/docs</code>)访问 API 接口</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/ad290bddff9eec46f2ddb0bfe6bf0921.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PyM_qomNsSuG9AtcJ27dMw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">浏览器中的 FastAPI 用户界面|作者图片</p></figure><p id="0c6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到我们的<code class="fe nw nx ny nz b">/predict</code>路径操作符出现在 FastAPI 接口的<em class="my"> /docs </em>页面上，表明 API 已经准备好通过 POST 请求接收数据。</p><p id="9e99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们点击 POST 部分时，我们看到 API 已经被正确设置为接收<strong class="lb iu">二进制文件</strong>，例如 CSV 文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi po"><img src="../Images/8a80de74de5bba1705a45b9a9fde533d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d750g2GWDOCbAa99yIApww.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">FastAPI endpoint |作者图片的帖子部分</p></figure><p id="be4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此时，我们已经可以通过使用 Jupyter 笔记本中的<code class="fe nw nx ny nz b">requests</code>模块和几行 Python 代码来检索预测了。</p><p id="8311" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，<strong class="lb iu">让这个系统更上一层楼的一个好方法是建立一个带有<strong class="lb iu">图形用户界面</strong>的<strong class="lb iu">网络应用</strong>，用户只需点击几次鼠标</strong>就可以上传数据和下载预测。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="2d14" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">(八)设置和构建 Streamlit 网络应用程序</h1><p id="6f97" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">Streamlit 提供了一个简单的框架来构建 web 应用，使数据团队能够随时展示他们的 ML 产品。</p><p id="eaf1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">web 应用程序的目标是让用户上传数据文件，运行模型推理，然后将预测下载为 JSON 文件，所有这些都无需编写任何代码。</p><p id="5cb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们创建了一个新脚本<code class="fe nw nx ny nz b">app.py</code>来存放以下关键组件的 Streamlit 代码:</p><ul class=""><li id="48ea" class="ok ol it lb b lc ld lf lg li om lm on lq oo lu op oq or os bi translated">用于选择 CSV 或 Excel 测试数据集文件的文件上传程序</li><li id="9ed6" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated">将文件作为 Pandas 数据帧读取，并显示前五行(用于完整性检查)</li><li id="4aee" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated">将数据帧转换成一个<strong class="lb iu">字节的</strong>文件对象</li><li id="1230" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated">显示一个'<strong class="lb iu">开始预测'</strong>按钮，点击该按钮，将通过<code class="fe nw nx ny nz b">requests.post()</code>将 BytesIO 对象解析为 FastAPI 端点</li><li id="e70a" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated">完成模型推断后，会出现一个“<strong class="lb iu">下载</strong>”按钮，供用户将预测下载为 JSON 文件。</li></ul><p id="174b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为模型推理的一部分，我们还包括端点的定义— <code class="fe nw nx ny nz b"><a class="ae ky" href="http://localhost:8000/predict." rel="noopener ugc nofollow" target="_blank">http://localhost:8000/predict</a></code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="efb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="my">在 GitHub repo 中，可以在</em><a class="ae ky" href="https://github.com/kennethleungty/End-to-End-AutoML-Insurance/blob/main/frontend/app.py" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="my">app . py</em></strong></a><em class="my">脚本中找到完整的 Streamlit 代码。</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="e959" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">㈨初始化 FastAPI 和 Streamlit 服务器</h1><p id="e278" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">到目前为止，FastAPI 和 Streamlit 函数的所有 Python 脚本都已经准备好了。接下来，我们在命令提示符下初始化两个服务器。</p><p id="0875" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(1)如果您的<em class="my">uvicon</em>服务器(用于 FastAPI)仍然从<a class="ae ky" href="#dcd1" rel="noopener ugc nofollow"> <strong class="lb iu">步骤 vii </strong> </a>运行，您可以保持原样。否则，打开一个新的命令提示符，转到包含<code class="fe nw nx ny nz b">main.py</code>脚本的<code class="fe nw nx ny nz b">/backend</code>子目录，并输入:</p><pre class="kj kk kl km gt pe nz pf pg aw ph bi"><span id="73a6" class="ni me it nz b gy pi pj l pk pl">uvicorn main:app --host 0.0.0.0 --port 8000</span></pre><p id="080f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(2)打开<strong class="lb iu">另一个单独的</strong>命令提示符，用<code class="fe nw nx ny nz b">streamlit run app.py</code>初始化 Streamlit 服务器(从包含脚本的<code class="fe nw nx ny nz b">frontend</code>文件夹)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/6b195c1f8037543649cfd2f9c95f29e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lCxR8maGReTYHze9B92POw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">运行 start Streamlit server | Image by author 的命令行</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="6188" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">(x)运行预测并下载结果</h1><p id="5aad" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">随着 FastAPI 和 Streamlit 服务器的启动和运行，是时候通过前往<code class="fe nw nx ny nz b">http://localhost:8501</code>访问我们的 Streamlit web 应用程序了。</p><p id="7af0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面这张 gif 图说明了 web app 从数据上传到预测下载的简单性。</p><p id="68f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="my">注:用于演示预测的文件为</em><a class="ae ky" href="https://github.com/kennethleungty/End-to-End-AutoML-Insurance/tree/main/backend/data/processed" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="my">data/processed/test . CSV</em></strong></a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pq"><img src="../Images/534f13832180c1de4d6ed07eecf0ff22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0_-dOqb7P8TN65DC418dtQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Streamlit web 应用程序演示|作者图片</p></figure><p id="bf49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是 JSON 输出的快照，包含对每个客户的预测(1 或 0):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pr"><img src="../Images/3b488f3ad1c7027eb5349354d1476a1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xgC6er6Wx8m_XgPhi6q1RQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">包含模型预测的 JSON 输出|作者图片</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="8724" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">(4)向前迈进</h1><p id="83ec" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">让我们回顾一下我们所做的事情。我们首先进行<strong class="lb iu"> H2O AutoML </strong>培训和<strong class="lb iu"> MLflow </strong>跟踪，开发各种 ML 模型。</p><p id="4c3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们检索性能最佳的模型，并使用<strong class="lb iu"> FastAPI </strong>将其部署为端点。最后，我们创建了一个<strong class="lb iu"> Streamlit </strong> web 应用程序来轻松上传测试集数据和下载模型预测。</p><p id="f89b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里 找到项目 GitHub repo <a class="ae ky" href="https://github.com/kennethleungty/End-to-End-AutoML-Insurance" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">。</strong></a></p><p id="8315" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然到目前为止，在成功构建我们的端到端 ML 管道方面已经做了大量的工作，但是我们还需要几个步骤来完成整个画面。这些任务包括:</p><ul class=""><li id="809a" class="ok ol it lb b lc ld lf lg li om lm on lq oo lu op oq or os bi translated">将整个 ML 应用程序和部署放在云上的<strong class="lb iu">docking</strong></li><li id="b4d1" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated">Docker 中的管道<strong class="lb iu">编排</strong>(如气流、Kedro)</li></ul><p id="114b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是这篇文章的续集，我们使用 Docker 来封装整个管道:</p><div class="ps pt gp gr pu pv"><a rel="noopener follow" target="_blank" href="/how-to-dockerize-machine-learning-applications-built-with-h2o-mlflow-fastapi-and-streamlit-a56221035eb5"><div class="pw ab fo"><div class="px ab py cl cj pz"><h2 class="bd iu gy z fp qa fr fs qb fu fw is bi translated">如何对接用 H2O、MLflow、FastAPI 和 Streamlit 构建的机器学习应用</h2><div class="qc l"><h3 class="bd b gy z fp qa fr fs qb fu fw dk translated">用 Docker 容器化多服务 ML 应用的简单指南</h3></div><div class="qd l"><p class="bd b dl z fp qa fr fs qb fu fw dk translated">towardsdatascience.com</p></div></div><div class="qe l"><div class="qf l qg qh qi qe qj ks pv"/></div></div></a></div></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="5a94" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">在你走之前</h1><p id="1762" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">欢迎您加入我们的数据科学学习之旅！关注我的<a class="ae ky" href="https://kennethleungty.medium.com/" rel="noopener"> Medium </a>页面和<a class="ae ky" href="https://github.com/kennethleungty" rel="noopener ugc nofollow" target="_blank"> GitHub </a>了解更多精彩的数据科学内容。同时，享受构建端到端 AutoML 解决方案的乐趣！</p><div class="ps pt gp gr pu pv"><a rel="noopener follow" target="_blank" href="/key-learning-points-from-mlops-specialization-course-2-13af51e22d90"><div class="pw ab fo"><div class="px ab py cl cj pz"><h2 class="bd iu gy z fp qa fr fs qb fu fw is bi translated">MLOps 专业化认证的关键学习点—课程 2</h2><div class="qc l"><h3 class="bd b gy z fp qa fr fs qb fu fw dk translated">面向生产的机器学习工程(MLOps)课程概述</h3></div><div class="qd l"><p class="bd b dl z fp qa fr fs qb fu fw dk translated">towardsdatascience.com</p></div></div><div class="qe l"><div class="qk l qg qh qi qe qj ks pv"/></div></div></a></div><div class="ps pt gp gr pu pv"><a rel="noopener follow" target="_blank" href="/autoxgb-for-financial-fraud-detection-f88f30d4734a"><div class="pw ab fo"><div class="px ab py cl cj pz"><h2 class="bd iu gy z fp qa fr fs qb fu fw is bi translated">利用 AutoXGB 进行金融欺诈检测</h2><div class="qc l"><h3 class="bd b gy z fp qa fr fs qb fu fw dk translated">AutoXGB 与标准 XGBoost 在检测欺诈性信用卡交易方面的对比</h3></div><div class="qd l"><p class="bd b dl z fp qa fr fs qb fu fw dk translated">towardsdatascience.com</p></div></div><div class="qe l"><div class="ql l qg qh qi qe qj ks pv"/></div></div></a></div><div class="ps pt gp gr pu pv"><a href="https://kennethleungty.medium.com/membership" rel="noopener follow" target="_blank"><div class="pw ab fo"><div class="px ab py cl cj pz"><h2 class="bd iu gy z fp qa fr fs qb fu fw is bi translated">通过我的推荐链接加入媒体-梁建华</h2><div class="qc l"><h3 class="bd b gy z fp qa fr fs qb fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="qd l"><p class="bd b dl z fp qa fr fs qb fu fw dk translated">kennethleungty.medium.com</p></div></div><div class="qe l"><div class="qm l qg qh qi qe qj ks pv"/></div></div></a></div></div></div>    
</body>
</html>