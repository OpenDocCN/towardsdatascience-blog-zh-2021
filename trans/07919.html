<html>
<head>
<title>Biased Data and How to Deal with It</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">有偏数据及其处理方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/biased-data-and-how-to-deal-with-it-fdaeb9da3b20?source=collection_archive---------25-----------------------#2021-07-20">https://towardsdatascience.com/biased-data-and-how-to-deal-with-it-fdaeb9da3b20?source=collection_archive---------25-----------------------#2021-07-20</a></blockquote><div><div class="fc ig ih ii ij ik"/><div class="il im in io ip"><figure class="ir is gp gr it iu gh gi paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="gh gi iq"><img src="../Images/9d3ff6a451e224178a6cadc9b40a67a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HeBE8xz6pC6ngY2x"/></div></div><p class="jb jc gj gh gi jd je bd b be z dk translated">由<a class="ae jf" href="https://unsplash.com/@edge2edgemedia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Edge2Edge媒体</a>在<a class="ae jf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><div class=""/><div class=""><h2 id="406a" class="pw-subtitle-paragraph kf jh ji bd b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dk translated">欠采样的故事</h2></div><p id="d4a8" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls il bi translated">我的一个学生刚刚完成了一个涉及分类的数据科学荣誉项目——或者至少他认为他完成了。他收到了波士顿地区大约2000名学生和大约700名企业家发布的几千条推文。他必须训练一个ML模型(RandomForestClassifier)来预测一条推文是由学生还是由企业家发布的。听起来很容易。他随机选择了70%的推文用于训练，其余的用于测试。这个模型看起来很有效，准确率达到了83%——对于一个课程项目来说，这已经很不错了。</p><p id="53a5" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls il bi translated">不幸的是，该模型非常擅长识别学生推文(95%的准确率)，但识别企业家推文(55%的准确率)却相当糟糕。为什么？因为训练数据集有大约1400名学生，只有大约500名企业家。换句话说，它偏向于学生，并学会了如何更好地识别他们的推文。</p></div><div class="ab cl lt lu hw lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="il im in io ip"><p id="6d83" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls il bi translated">修复训练数据集的一种方法是为每个结果提供相等或大致相等数量的样本。如果我们在培训数据中只有大约500名企业家，那么我们也应该只包括大约500名学生，除非我们的目标是扭曲培训过程。Python中最流行的数据分析包Scikit-Learn没有无偏倚的训练/测试分裂功能。但是我们可以自己造一个。</p><p id="f503" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls il bi translated">假设X是一个Pandas数据框架，它包含我们整个数据集的特征(预测)和结果。特征在列x1中..xN和结果在y列。首先计算支持每个结果的样本数:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="e4b8" class="mj mk ji mf b gy ml mm l mn mo">from numpy.random import binomial<br/>np.random.seed(0)<br/># Generate synthetic dataset with three outcomes</span><span id="45c1" class="mj mk ji mf b gy mp mm l mn mo">samples = 100<br/>X = pd.DataFrame({"x1": binomial(1, 0.3, samples),<br/>                  "x2": binomial(1, 0.6, samples),<br/>                   "y": binomial(2, 0.5, samples)})</span><span id="21bb" class="mj mk ji mf b gy mp mm l mn mo">grouper = X.groupby("y")<br/>sizes = grouper.size()<br/>#0 26 &lt;- the smallest<br/>#1 46<br/>#2 28</span></pre><p id="74d4" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls il bi translated">假设我们仍然希望从最小的<em class="mq">组样本中选择70%用于训练，并从较大的组中选择匹配数量的样本。我们可以计算来自较大组的样本的百分比，以匹配最小组的70%。这些百分比是选择样本的概率:</em></p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="fa5e" class="mj mk ji mf b gy ml mm l mn mo">fracs = (sizes.min() * 0.7) / sizes<br/>#0 0.700000 &lt;- the smallest<br/>#1 0.395652<br/>#2 0.650000</span></pre><p id="2d7d" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls il bi translated">现在我们知道了概率，我们可以使用二项式分布(<code class="fe mr ms mt mf b">np.random.binomial</code>)及其布尔补码来分别随机选择训练和测试样本。当我们在相同结果的组中循环时，我们将在两个最初为空的数据帧中累积样本:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="6bfc" class="mj mk ji mf b gy ml mm l mn mo">test  = pd.DataFrame()<br/>train = pd.DataFrame()</span><span id="ccb8" class="mj mk ji mf b gy mp mm l mn mo">for grp, data in grouper: # reuse the grouper!<br/>    mask = binomial(1, fracs.loc[grp], data.shape[0]).astype(bool)<br/>    train = train.append(data[mask])<br/>    test  =  test.append(data[~mask])</span></pre><p id="aa42" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls il bi translated">现在，对于每个结果，训练数据集中的行数大致相同。训练数据集是平衡的，不偏向任何特定的结果:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="8918" class="mj mk ji mf b gy ml mm l mn mo">train.groupby("y").size()<br/>#y<br/>#0    21<br/>#1    20<br/>#2    23</span></pre><p id="eae6" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls il bi translated">在该数据集上训练的模型将会看到属于这三个类的大约相等数量的样本，并且不会有偏差。</p><p id="625e" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls il bi translated">我们是否也应该均衡不平衡的测试数据集？很可能不是:您只将它用于测试，它的偏差不应该是一个问题。</p></div></div>    
</body>
</html>