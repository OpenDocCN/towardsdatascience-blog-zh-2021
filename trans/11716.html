<html>
<head>
<title>CatBoost CPU Training Speedup Tricks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CatBoost CPU 训练加速技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/catboost-cpu-training-speedup-tricks-57cb10974ce3?source=collection_archive---------9-----------------------#2021-11-21">https://towardsdatascience.com/catboost-cpu-training-speedup-tricks-57cb10974ce3?source=collection_archive---------9-----------------------#2021-11-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1dfd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 CatBoost 获得更快的训练速度，即使您没有单独的 GPU</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d364fc64803908184e55eb6979b4078a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NRJmZm-EbqEckhdZcfJtBQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4952189" rel="noopener ugc nofollow" target="_blank">pix abay</a>cebbi</p></figure><p id="f98c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我与这些公司都没有关系。这是一项独立审查。 </p><p id="23d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文面向那些没有配备独立(独立)NVIDIA GPU(显卡)的 PC 或笔记本电脑，并且希望运行大幅加速的 CatBoost 模型的用户。</p><p id="9e1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你已经有一台带独立 NVIDIA GPU 的 PC 或笔记本电脑，跳过这篇内容，跳到下面这篇我写的文章。</p><div class="lw lx gp gr ly lz"><a rel="noopener follow" target="_blank" href="/10x-times-fast-catboost-training-speed-with-an-nvidia-gpu-5ffefd9b57a6"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd iu gy z fp me fr fs mf fu fw is bi translated">借助 NVIDIA GPU，CatBoost 训练速度提高 10 倍</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">使用 10M 行数据集比较 CatBoost CPU 和 GPU 的训练时间！</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn ks lz"/></div></div></a></div><p id="96ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CatBoost 模型可以使用 CPU 或 GPU 进行训练。很明显，对于大型数据集，通过 GPU 训练可以获得更好的加速(例如 10 倍)。</p><p id="6bee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，在 CatBoost CPU 训练中可以使用一些技巧来实现显著的加速。其中大多数可以通过改变参数值来实现，而其他的则需要对数据进行一些操作。</p><p id="e138" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来探索它们。</p><h1 id="51e7" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">减少迭代次数</h1><p id="85bd" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">在 CatBoost 模型中，boosting 轮次或迭代次数由参数<code class="fe nl nm nn no b">iterations</code>定义。默认值为 1000。我们可以减小这个值来加快训练速度。</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="fdd9" class="nt mp it no b gy nu nv l nw nx">cb = CatBoostClassifier(iterations=100)<br/>cb = CatBoostRegressor(iterations=100)</span></pre><p id="29b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我用一个 10M 行的数据集测试了 100 次和 1000 次迭代:</p><ul class=""><li id="1d3c" class="ny nz it lb b lc ld lf lg li oa lm ob lq oc lu od oe of og bi translated"><strong class="lb iu"> 100 次迭代:</strong>训练时间 95.5 秒，准确率 0.72 分</li><li id="bbac" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated"><strong class="lb iu"> 1000 次迭代:</strong> 878 秒训练时间，0.74 精度分数</li></ul><blockquote class="om on oo"><p id="bda7" class="kz la lv lb b lc ld ju le lf lg jx lh op lj lk ll oq ln lo lp or lr ls lt lu im bi translated">在将迭代次数减少 10 倍后，您可能会期望精确度分数略有下降，但是在模型训练中您可以获得 9 倍的加速。</p></blockquote><p id="337d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注:</strong>CatBoost 模型中的学习率与迭代次数成反比。如果你减少迭代次数，你也需要增加学习率，反之亦然。但是，该算法会根据迭代次数自动调整学习率。学习率还取决于数据集的大小。在 CatBoost 模型中设置<code class="fe nl nm nn no b">learning_rate=None</code>(默认)即可。</p><h1 id="7dc0" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">使用所有 CPU 核心</h1><p id="9170" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">不是每个人都有独立的 GPU。但是，您可能有一个内核数量更多的好 CPU。参数<code class="fe nl nm nn no b">thread_count</code>定义了在 Catboost 模型训练中 CPU 应该使用多少内核。默认情况下，所有内核都由 CPU 使用。这用-1 表示。</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="242c" class="nt mp it no b gy nu nv l nw nx">cb = CatBoostClassifier(thread_count=-1)<br/>cb = CatBoostRegressor(thread_count=-1)</span></pre><p id="2a36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经用一个 10M 行的数据集对 3 个内核和 6 个内核(在我的例子中是所有的<em class="lv">T2<em class="lv">T4】内核)进行了测试:</em></em></p><ul class=""><li id="c7a6" class="ny nz it lb b lc ld lf lg li oa lm ob lq oc lu od oe of og bi translated"><strong class="lb iu"> 3 核:</strong>训练时间 119 秒，准确率 0.72 分</li><li id="f0a3" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated"><strong class="lb iu"> 6 核:</strong> 95.5 <strong class="lb iu"> </strong>秒训练时间，0.72 准确率分数</li></ul><blockquote class="om on oo"><p id="7ba7" class="kz la lv lb b lc ld ju le lf lg jx lh op lj lk ll oq ln lo lp or lr ls lt lu im bi translated">准确性分数不受训练过程中使用的 CPU 核心数量的影响。在这种情况下，如果使用所有(默认)CPU 内核，您可以减少大约 25%的训练时间。</p></blockquote><h1 id="c093" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">减少树的深度</h1><p id="8184" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">您可以定义每个提升回合中添加到集合的每个新树的深度。该值可由 CatBoost 模型中的参数<code class="fe nl nm nn no b">depth</code>控制。默认值为 6。我们可以减小这个值来加快训练速度。</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="c805" class="nt mp it no b gy nu nv l nw nx">cb = CatBoostClassifier(depth=3)<br/>cb = CatBoostRegressor(depth=3)</span></pre><p id="6d7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我用一个 10M 行的数据集对树深度 3 和 6 进行了测试。</p><ul class=""><li id="7d82" class="ny nz it lb b lc ld lf lg li oa lm ob lq oc lu od oe of og bi translated"><strong class="lb iu">深度-3: </strong>训练时间 95.5 秒，准确率 0.72 分</li><li id="edaf" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated"><strong class="lb iu">深度-6: </strong>训练时间 127 秒，准确率 0.74 分</li></ul><blockquote class="om on oo"><p id="e1c5" class="kz la lv lb b lc ld ju le lf lg jx lh op lj lk ll oq ln lo lp or lr ls lt lu im bi translated">在降低树深度后，您可能会期望精确度分数略有下降，但是在模型训练中您可以获得大约 33%的加速。</p></blockquote><h1 id="9a88" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">将对象数据类型转换为分类数据类型</h1><p id="a64f" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">您可以在 CatBoost 中直接使用分类特征。下面是<a class="ae ky" rel="noopener" target="_blank" href="/how-do-you-use-categorical-features-directly-with-catboost-947b211c2923">如何</a>。默认情况下，Pandas 将分类值存储在不能直接用于 CatBoost 的对象数据类型中。您有两个选择来克服这个问题:</p><ul class=""><li id="0368" class="ny nz it lb b lc ld lf lg li oa lm ob lq oc lu od oe of og bi translated">您可以通过使用<strong class="lb iu"> Pool() </strong>类将整个数据集转换为 CatBoost 的特殊<strong class="lb iu"> <em class="lv"> Pool </em> </strong>数据类型。</li><li id="eeb7" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">您可以将<strong class="lb iu"> <em class="lv">对象</em> </strong>数据类型转换为<strong class="lb iu"> <em class="lv">类别</em> </strong>数据类型。</li></ul><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="78c8" class="nt mp it no b gy nu nv l nw nx">for col in data.select_dtypes(include=['object']):<br/>  data[col] = data[col].astype('category')</span></pre><p id="151b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用第二个选项可以在 CatBoost 模型训练中实现显著的加速。</p><h1 id="623e" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">使用 Numpy 数组代替 Pandas 数据框</h1><p id="a336" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">Numpy 数组和 Pandas 数据帧都可以用作 CatBoost 算法的输入。但是，对大型数据集使用 Numpy 数组将显著加快 CatBoost 训练过程。</p><h1 id="ca38" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">摘要</h1><p id="4a96" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">CatBoost GPU training 只有在您的 PC 配有 NVIDIA GPU 的情况下才能使用。此外，请注意，如果数据集不够大，CPU 和 GPU 的训练时间不会有太大差异。</p><p id="983f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，在我们只需要使用 CPU 进行 CatBoost 训练的场景中，我们今天讨论的技巧对于获得加速非常有用。</p><p id="0a26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在大多数情况下，我们可以通过改变参数值来控制训练速度。有时候，我们不需要改变价值观。默认值将提供最佳的训练速度！</p></div><div class="ab cl os ot hx ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="im in io ip iq"><h2 id="26f8" class="nt mp it bd mq oz pa dn mu pb pc dp my li pd pe na lm pf pg nc lq ph pi ne pj bi translated">阅读下一条(推荐):</h2><p id="5b6b" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">使用 NVIDIA GPU 将训练 CatBoost 模型的速度提高 10 倍！</p><div class="lw lx gp gr ly lz"><a rel="noopener follow" target="_blank" href="/10x-times-fast-catboost-training-speed-with-an-nvidia-gpu-5ffefd9b57a6"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd iu gy z fp me fr fs mf fu fw is bi translated">借助 NVIDIA GPU，CatBoost 训练速度提高 10 倍</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">使用 10M 行数据集比较 CatBoost CPU 和 GPU 的训练时间！</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn ks lz"/></div></div></a></div><h2 id="8fb9" class="nt mp it bd mq oz pa dn mu pb pc dp my li pd pe na lm pf pg nc lq ph pi ne pj bi translated">阅读下一条(可选):</h2><p id="2b07" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">为数据科学和机器学习任务选择合适的笔记本电脑！</p><div class="lw lx gp gr ly lz"><a rel="noopener follow" target="_blank" href="/20-necessary-requirements-of-a-perfect-laptop-for-data-science-and-machine-learning-tasks-7d0c59c3cb63"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd iu gy z fp me fr fs mf fu fw is bi translated">数据科学和机器学习任务对完美笔记本电脑的 20 项必要要求</h2><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="pk l mk ml mm mi mn ks lz"/></div></div></a></div></div><div class="ab cl os ot hx ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="im in io ip iq"><p id="2527" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天的帖子到此结束。</p><p id="f3c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您有任何反馈，请告诉我。</p><p id="d408" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同时，你可以<a class="ae ky" href="https://rukshanpramoditha.medium.com/membership" rel="noopener"> <strong class="lb iu">注册成为会员</strong> </a>来获得我写的每一个故事，我会收到你的一部分会员费。</p><p id="733f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">非常感谢你一直以来的支持！下一个故事再见。祝大家学习愉快！</p><p id="bedb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">特别感谢 Pixabay 上的<strong class="lb iu"> cebbi </strong>，<strong class="lb iu"> </strong>为我提供了这篇文章的封面图片。</p><p id="a914" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="pl pm ep" href="https://medium.com/u/f90a3bb1d400?source=post_page-----57cb10974ce3--------------------------------" rel="noopener" target="_blank">鲁克山普拉莫迪塔</a><br/><strong class="lb iu">2021–11–21</strong></p></div></div>    
</body>
</html>