<html>
<head>
<title>Is your A/B test suffering from assignment imbalance?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你的 A/B 考试是否遭遇了分配失衡？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/does-your-a-b-test-have-an-assignment-bias-8b2a5a83b817?source=collection_archive---------9-----------------------#2021-11-06">https://towardsdatascience.com/does-your-a-b-test-have-an-assignment-bias-8b2a5a83b817?source=collection_archive---------9-----------------------#2021-11-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/e38a3f7025a6e3b700d271ccc4b19804.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RQQE9_ow3DePMLvrXhMl8A.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">来源:https://burst.shopify.com/photos/scales-of-justice?q=scale</p></figure><p id="b59b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最近，我的团队进行了一项实验来测试一种新产品推荐算法的性能。在收集了几周的数据后，看起来我们的新算法获得了巨大的成功；这个实验将我们的主要成功指标(每个用户的订单数)提高了 3%。这相当于我们团队在整个上半场的目标<em class="le">。</em></p><p id="6560" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些结果好得令人难以置信。我们正要在每周实验回顾中宣布这些结果的成功，这时我们决定暂停一下，再一次检查实验的基本原理。下面是我们看到的关于用户分配的情况:</p><ul class=""><li id="37c9" class="lf lg it ki b kj kk kn ko kr lh kv li kz lj ld lk ll lm ln bi translated">控制:7，018，463 个用户</li><li id="b343" class="lf lg it ki b kj lo kn lp kr lq kv lr kz ls ld lk ll lm ln bi translated">待遇:7 008 472 名用户</li></ul><p id="fcc7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">与对照组相比，处理组(新产品推荐算法)分配的用户少了 9，991 个。所以我们开始回答两个问题:</p><h2 id="904c" class="lt lu it bd lv lw lx dn ly lz ma dp mb kr mc md me kv mf mg mh kz mi mj mk ml bi translated">1.这种差异可以用随机抽样变异来解释吗？</h2><h2 id="4e15" class="lt lu it bd lv lw lx dn ly lz ma dp mb kr mc md me kv mf mg mh kz mi mj mk ml bi translated">2.如果不是，是什么导致了偏差？</h2></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="5cdb" class="mt lu it bd lv mu mv mw ly mx my mz mb na nb nc me nd ne nf mh ng nh ni mk nj bi translated">观察到的差异可以用随机抽样变异来解释吗？</h1><p id="5376" class="pw-post-body-paragraph kg kh it ki b kj nk kl km kn nl kp kq kr nm kt ku kv nn kx ky kz no lb lc ld im bi translated">这个问题相当于<a class="ae kf" href="https://en.wikipedia.org/wiki/Checking_whether_a_coin_is_fair" rel="noopener ugc nofollow" target="_blank">检查一个硬币是否公平</a>。考虑以下场景——我们投掷硬币 1000 次，观察以下结果:</p><ul class=""><li id="a54f" class="lf lg it ki b kj kk kn ko kr lh kv li kz lj ld lk ll lm ln bi translated">人头:465</li><li id="286b" class="lf lg it ki b kj lo kn lp kr lq kv lr kz ls ld lk ll lm ln bi translated">反面:535</li></ul><p id="7267" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">用一枚公平硬币观察到这个结果(相差-70)的概率是多少？我们可以通过构造一个抽样分布来回答这个问题。在 R 中，我们可以通过模拟创建这个分布:</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="213a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这会产生以下结果:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/e8c3069b8e629580f23171e4997fb20a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ufNYC4l3sLYZL3mNE-BW8A.png"/></div></div></figure><p id="a4a9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并且采样分布简单地是增量值的密度图:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nw"><img src="../Images/6b19a5edcfc3cffb73b50acbb7fe264c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UMi8BCrPQM2H5zJ5bpKS6Q.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">模拟分布</p></figure></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="478a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">原来，标准误差(<strong class="ki iu"> <em class="le"> SE </em> </strong>)由下式给出:</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="nx nu l"/></div></figure><p id="a7e9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">其中:</p><ul class=""><li id="b358" class="lf lg it ki b kj kk kn ko kr lh kv li kz lj ld lk ll lm ln bi translated"><strong class="ki iu"><em class="le">n</em></strong><em class="le"/>=每个样本的观察总数(1000)</li><li id="9b31" class="lf lg it ki b kj lo kn lp kr lq kv lr kz ls ld lk ll lm ln bi translated"><strong class="ki iu"> <em class="le"> p </em> </strong> =正面概率</li></ul><p id="0bf9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">代入这些值，我们得到 SE = 31.62。既然我们知道了如何计算<strong class="ki iu"> <em class="le"> SE </em> </strong>，我们就可以不用模拟来重新创建抽样分布了。我们简单地构造一个均值= 0，标准差= 31.62 的正态分布:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nw"><img src="../Images/3a61226eea545deba269c414a0925b91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ElWSaUMdVzF2TgzqPI4eA.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">计算分布(红色)与模拟分布(黑色)</p></figure></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="34f6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">回到我们的问题，如果我们掷一枚硬币 1000 次，那么观察到 465 次正面和 535 次反面的概率是多少？</p><p id="4dc3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们将观察到的-70 的δ除以<strong class="ki iu"> <em class="le"> SE </em> </strong>，那么我们可以利用标准正态分布来回答我们的问题，如下所示:</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="35e6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这产生了:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/71bb663ca069d1cb96e620a50e7de245.png" data-original-src="https://miro.medium.com/v2/resize:fit:446/format:webp/1*LPdmZRJ8XJximyksQ2ZsfQ.png"/></div></figure><p id="01c9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以如果硬币是公平的，只有 2.69%的机会观察到这个结果。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="4797" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">类似地，回到我们最初的问题，给定 50/50 的实验分割，那么观察到的概率是多少:</p><ul class=""><li id="0eac" class="lf lg it ki b kj kk kn ko kr lh kv li kz lj ld lk ll lm ln bi translated">控制:7，018，463 个用户</li><li id="3ba2" class="lf lg it ki b kj lo kn lp kr lq kv lr kz ls ld lk ll lm ln bi translated">待遇:7 008 472 名用户</li></ul><p id="9e8d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们以同样的方式回答这个问题:</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="017d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这产生了:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/85d6110b6514bb296dcc514b0ad968ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:474/format:webp/1*yE8F5VzOklAkLgIHMM1Feg.png"/></div></figure><p id="334f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以只有 0.76%的机会观察到这个结果，如果事实上实验任务是无偏的。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h2 id="b713" class="lt lu it bd lv lw lx dn ly lz ma dp mb kr mc md me kv mf mg mh kz mi mj mk ml bi translated">是什么导致了这种偏见？</h2><p id="6af8" class="pw-post-body-paragraph kg kh it ki b kj nk kl km kn nl kp kq kr nm kt ku kv nn kx ky kz no lb lc ld im bi translated">仅仅随机抽样的变化不可能解释观察到的用户分配的差异:</p><ul class=""><li id="ea2d" class="lf lg it ki b kj kk kn ko kr lh kv li kz lj ld lk ll lm ln bi translated">控制:7，018，463 个用户</li><li id="cee9" class="lf lg it ki b kj lo kn lp kr lq kv lr kz ls ld lk ll lm ln bi translated">待遇:7 008 472 名用户</li></ul><p id="ab55" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将这一发现带给了设置实验的机器学习工程师，并要求他们重新检查分配标准。在深入研究代码之后，他们意识到偏见确实被引入了:</p><ul class=""><li id="9f5c" class="lf lg it ki b kj kk kn ko kr lh kv li kz lj ld lk ll lm ln bi translated">控制:所有登录的用户都被分配</li><li id="b8f9" class="lf lg it ki b kj lo kn lp kr lq kv lr kz ls ld lk ll lm ln bi translated">处理:所有登录<strong class="ki iu">并在过去 180 天</strong>内至少有 2 个订单的用户都被分配</li></ul><p id="5255" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，治疗有一个额外的分配标准，意味着我们分配的用户比对照组少。此外，与对照组相比，被分配到治疗组的用户更有可能参与其中。因此，我们的主要成功指标(每用户订单数)显示，治疗组比对照组好得多。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h2 id="4051" class="lt lu it bd lv lw lx dn ly lz ma dp mb kr mc md me kv mf mg mh kz mi mj mk ml bi translated">摘要</h2><p id="d7fb" class="pw-post-body-paragraph kg kh it ki b kj nk kl km kn nl kp kq kr nm kt ku kv nn kx ky kz no lb lc ld im bi translated">最后，我们简单地重新开始了实验，这次对两个变量使用了相同的赋值标准。我们现在也监控所有实验中作业数量的差异。使用本文概述的方法，您也可以做到！😃</p></div></div>    
</body>
</html>