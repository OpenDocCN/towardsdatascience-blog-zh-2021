<html>
<head>
<title>A Practical Guide to ARIMA Models using PyCaret — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 PyCaret 的 ARIMA 模型实用指南—第 1 部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/understanding-arima-models-using-pycarets-time-series-module-part-1-692e10ca02f2?source=collection_archive---------8-----------------------#2021-11-14">https://towardsdatascience.com/understanding-arima-models-using-pycarets-time-series-module-part-1-692e10ca02f2?source=collection_archive---------8-----------------------#2021-11-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d917" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">奠定统计基础</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1fffa640eff2567fe7b4b928c63ee2ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Dra8YUNCvq01x5IJ"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@agebarros?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">阿格巴洛斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="d03d" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">📚<strong class="ak">简介</strong></h1><p id="7f17" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">PyCaret 是一个用 Python 编写的开源、低代码的机器学习库，可以自动化机器学习工作流。这是一个端到端的机器学习和模型管理工具，可以成倍地加快实验周期，提高您的工作效率。</p><p id="0b0b" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">PyCaret 最近发布了一个时间序列模块，它附带了许多方便的特性，使得时间序列建模变得轻而易举。你可以在这篇文章中了解更多。</p><div class="mz na gp gr nb nc"><a rel="noopener follow" target="_blank" href="/announcing-pycarets-new-time-series-module-b6e724d4636c"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd iu gy z fp nh fr fs ni fu fw is bi translated">📢宣布 PyCaret 的新时间序列模块</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">🚪介绍</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">towardsdatascience.com</p></div></div><div class="nl l"><div class="nm l nn no np nl nq ks nc"/></div></div></a></div><p id="d388" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在这个由多个部分组成的系列文章中，我们将重点讨论如何使用 PyCaret 这样的“低代码”库来更深入地理解 ARIMA 模型的工作原理。在第一部分中，我们将对 ARIMA 模型及其参数进行概述。然后，我们将从一个简单的 ARIMA 模型开始，为这个模型的预测和预测区间创建一个理论框架，以发展对其工作的直觉。最后，我们将使用 PyCaret 构建这个 ARIMA 模型，并将理论计算与模型输出进行比较。将模型的输出与我们的理论框架联系起来，有望加深我们对模型的理解，并为后续文章中更详细的分析奠定基础。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="0b33" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">📖建议的先前阅读</h1><p id="0168" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">本文推荐给那些对时间序列有基本了解(例如，季节性、自相关 ACF、白噪声、训练-测试-分割等概念)但有兴趣了解更多 ARIMA 模型的人。如果你不熟悉这些概念，我建议你先阅读这些短文。这将有助于理解这篇文章。</p><p id="e451" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">👉<a class="ae ky" href="https://github.com/pycaret/pycaret/discussions/1765" rel="noopener ugc nofollow" target="_blank">时间序列中的季节性和自相关性</a></p><p id="8c4a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">👉<a class="ae ky" href="https://github.com/pycaret/pycaret/discussions/1800" rel="noopener ugc nofollow" target="_blank">什么是「白噪音」</a>？</p><p id="9be1" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">👉<a class="ae ky" href="https://github.com/pycaret/pycaret/discussions/1761" rel="noopener ugc nofollow" target="_blank">时间序列交叉验证</a></p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="3702" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated"><strong class="ak"> 1️⃣ ARIMA 模型概述</strong></h1><p id="fef7" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">ARIMA 是一个经典的时间序列模型，用于模拟时态数据的自回归特性。自回归意味着依赖于自身过去的值。时间序列可能依赖于(1)其最近的过去值，或者(2)可能表现出季节性行为，并在一定数量的时间点过去后重复自身。</p><p id="0e50" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">直观上，(1)的一个例子是股票数据。这是时间数据，明天的价格受今天(或最近的过去)价格的影响很大，而与一个月或一年前发生的事情没有太大关系。类似地,( 2)的一个例子可以是在零售店销售冬装。这通常在冬季前达到高峰，在夏季逐渐减弱。因此，它表现出季节性模式。今年冬天的销售额将与去年冬天的销售额高度相关。</p><p id="4937" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">现在我们已经看到了一些基本的例子，让我们看看这是如何在模型中表示的。经典的 ARIMA 模型有几个超参数，但我们将重点关注其中的两个主要参数— <code class="fe nr ns nt nu b">order</code>和<code class="fe nr ns nt nu b">seasonal_order</code>。</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="dec6" class="nz lh it nu b gy oa ob l oc od"><strong class="nu iu">order:<br/></strong>iterable or array-like, shape=(3,), optional (default=(1, 0, 0))<br/>The (p,d,q) order of the model for the number of AR parameters,     differences, and MA parameters to use.</span><span id="005d" class="nz lh it nu b gy oe ob l oc od"><strong class="nu iu">seasonal_order:<br/></strong>array-like, shape=(4,), optional (default=(0, 0, 0, 0))<br/>The (P,D,Q,s) order of the seasonal component of the model for the     AR parameters, differences, MA parameters, and periodicity.</span></pre><p id="c83d" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">现在，你可能想知道这些术语与我们上面强调的例子有什么联系，以及<code class="fe nr ns nt nu b">order</code>和<code class="fe nr ns nt nu b">seasonal_order</code>中的三个和四个术语分别是什么意思。在非常高的层次上，<code class="fe nr ns nt nu b">order</code>与上面的例子(1)相关，其中下一个值与紧接的前一个值强相关。<code class="fe nr ns nt nu b">seasonal_order</code>与上面的示例(2)相关，其中下一个值与过去一个或多个季节的数据相关。</p><p id="eeb1" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">但这仍然没有回答什么是<code class="fe nr ns nt nu b">(p, d, q)</code>和<code class="fe nr ns nt nu b">(P, D, Q, s)</code>的问题。这正是我们将在这一系列文章中试图回答的问题。</p><p id="3a4a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">注意:本系列文章采用“代码优先”的方法来理解 ARIMA 模型。我强烈建议读者也参考[5]，以便从理论角度更好地理解。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="7ba6" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">2️⃣基线 ARIMA 模型</h1><p id="f16c" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">为了更好地理解 ARIMA 模型的各种超参数，让我们从一个非常简单的 ARIMA 模型开始——一个没有任何自回归属性的模型。这通常用于表示白噪声(即数据中没有任何信号)。你可以在[1]和[2]中找到更多关于它的信息。该模型由以下超参数表示:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="e804" class="nz lh it nu b gy oa ob l oc od">##############################################<br/>#### Baseline ARIMA Model Hyperparameters ####<br/>##############################################</span><span id="4672" class="nz lh it nu b gy oe ob l oc od">(p, d, q)    = (0, 0, 0)<br/>(P, D, Q, s) = (0, 0, 0, 0)</span></pre><p id="387d" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">理论上，由于时间序列数据没有任何信号，未来预测(样本外)的最佳表示是用于训练模型的数据的平均值(详细信息请参见[2])。同样，样本内预测的最佳估计也是用于训练模型的数据的平均值。</p><p id="a81d" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们可以通过计算样本内拟合的残差来获得这些预测的预测区间。残差表示实际样本内数据(即用于训练的数据)和由该模型产生的样本内估计(在这种情况下是训练数据的平均值)之间的差异。</p><p id="1e06" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">好吧，理论是一回事，但一张图胜过千言万语。所以让我们来实践一下。我们将使用 PyCaret 的时间序列模块来更深入地了解这个模型。注意，可以在这里的 和参考资料部分找到代码的笔记本<a class="ae ky" href="https://nbviewer.org/github/ngupta23/medium_articles/blob/main/time_series/pycaret/pycaret_ts_arima_000_0000.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="ma iu">。</strong></a></p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="e3d9" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">3️⃣使用 PyCaret 了解 ARIMA 模型</h1><p id="55ac" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">PyCaret 的时间序列模块提供了超过 2000 个已知属性的时间序列的数据游乐场。我们将使用来自这个操场的“白噪声”数据集来解释这个例子。</p><p id="53db" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">👉<strong class="ma iu">步骤 1:设置 PyCaret 时间序列实验</strong></p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="7e54" class="nz lh it nu b gy oa ob l oc od">#### Get data from data playground ----<br/>y = get_data("1", folder="time_series/white_noise")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/205bdc5d07ba3136527617fb48e422b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:260/format:webp/1*Vq80kV_4QyMg5OpmktJwrQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">实验的白噪声数据(仅前 5 行)[图片由作者提供]</p></figure><p id="2b9c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">接下来，让我们设置一个时间序列实验来探索和建模这个数据集。“时间序列实验”是一个一站式商店，用户可以在这里执行<strong class="ma iu">探索性分析(EDA) </strong>、<strong class="ma iu">模型构建</strong>、模型<strong class="ma iu">适合度评估</strong>以及<strong class="ma iu">部署</strong>——同时遵循引擎盖下的最佳建模实践。</p><p id="e5da" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在这个设置中，我将预测范围<code class="fe nr ns nt nu b">fh</code>设置为 30(即我们打算预测接下来的 30 个时间点)。我还暂时将<code class="fe nr ns nt nu b">seasonal_period</code>设置为 1。注意，如果您的数据有一个<code class="fe nr ns nt nu b">DatetimeIndex</code>或<code class="fe nr ns nt nu b">PeriodIndex</code>指数(这里不是这种情况)，那么季节周期是自动推断的。如果是别的什么，我们需要度过季节期。我还传递了一个会话 ID，它充当种子并使实验可重复。</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="ce2d" class="nz lh it nu b gy oa ob l oc od">#### Setup experiment ----<br/>exp = TimeSeriesExperiment()<br/>exp.setup(data=y, seasonal_period=1, fh=30, session_id=42)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/177a1028bd620ebf27e2a5a93a5dd9df.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*G29lw2AstGbeXlgU47_h-w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">[图片由作者提供]</p></figure><p id="9a05" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">该设置从一开始就为我们提供了一些方便的信息。</p><p id="44d1" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">(1)我们看到我们的数据有 340 个数据点。在这个实验中，pycaret 保留了最后 30 个数据点(与预测时间范围相同)作为“测试集”，剩余的 310 个数据点用于训练。</p><p id="e5e3" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">(2)我们通过了季节性周期 1，但是在内部测试季节性之后，没有检测到它。这是意料之中的，因为这是没有季节性的白噪声数据。</p><p id="4cb8" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">(3)内部进行了白噪音的永盒测试(见前面的读数),确定数据与白噪音一致。同样，这也是我们所期望的，因为我们是从白噪音领域中挑选数据的。</p><p id="6e9c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">👉<strong class="ma iu">步骤 2:执行 EDA </strong></p><p id="9862" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">接下来，我们可以对这些数据进行快速 EDA:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="be72" class="nz lh it nu b gy oa ob l oc od"># `plot_model` without any estimator works on the original <br/>exp.plot_model()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/36552ecdbc30991d9a2f940114d64a2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c2nVa9-Jn2DbZETN6IC_mA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">绘制数据[图片由作者提供]</p></figure><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="d7b3" class="nz lh it nu b gy oa ob l oc od"># Plot ACF ----<br/>exp.plot_model(plot="acf")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/2bdadae78cde2f2671d6cc0bae05b151.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TeMbUoOpGfmnUcjbMRuTWw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ACF 图显示没有显著的自相关[图片由作者提供]</p></figure><p id="ee8b" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">ACF 数据显示没有显著的自相关，并且与白噪声一致。这也是意料中的事(详见前面的内容)。</p><h2 id="0956" class="nz lh it bd li oj ok dn lm ol om dp lq mh on oo ls ml op oq lu mp or os lw ot bi translated">👉第三步:理论计算</h2><p id="c9d8" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">接下来，让我们从实验中获得一些数据统计，并添加上面我们框架中的理论计算。</p><p id="db3f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">注意:训练和测试数据分割可以使用实验对象的“get_config”方法获得，如下所示。</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="ad8d" class="nz lh it nu b gy oa ob l oc od"># Get Train Data<br/>y_train = exp.get_config("y_train")</span><span id="e7db" class="nz lh it nu b gy oe ob l oc od"># Get Test Data<br/>y_test = exp.get_config("y_test")</span><span id="a350" class="nz lh it nu b gy oe ob l oc od">#########################################################<br/># Convert into dataframe &amp; add residual calculations ----<br/>#########################################################</span><span id="94f4" class="nz lh it nu b gy oe ob l oc od">train_data = pd.DataFrame({"y":y_train})<br/>train_data['preds'] = y_train.mean()<br/>train_data['split'] = "Train"</span><span id="e0c2" class="nz lh it nu b gy oe ob l oc od">test_data = pd.DataFrame({'y': y_test})<br/>test_data['preds'] = y_train.mean()<br/>test_data['split'] = "Test"</span><span id="24fc" class="nz lh it nu b gy oe ob l oc od">data = pd.concat([train_data, test_data])</span><span id="ff4b" class="nz lh it nu b gy oe ob l oc od">data['residuals'] = data['y'] - data['preds']<br/>data.reset_index(inplace=True)</span></pre><p id="7fa3" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">接下来，让我们计算进行理论预测和计算预测区间所需的计算。</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="a4b0" class="nz lh it nu b gy oa ob l oc od">#######################################################<br/>#### Compute values based on theoretical equations ----<br/>#######################################################</span><span id="69be" class="nz lh it nu b gy oe ob l oc od">y_train_mean <strong class="nu iu">=</strong> data<strong class="nu iu">.</strong>query("split=='Train'")['y']<strong class="nu iu">.</strong>mean()<br/>resid <strong class="nu iu">=</strong> data<strong class="nu iu">.</strong>query("split=='Train'")['residuals']<br/>resid_sigma2 <strong class="nu iu">=</strong> (resid<strong class="nu iu">**</strong>2)<strong class="nu iu">.</strong>sum()<strong class="nu iu">/</strong>len(resid)<br/><br/>print(f"Mean of Training Data: {y_train_mean}")<br/>print(f"Residuals Sigma2: {resid_sigma2}")</span><span id="4881" class="nz lh it nu b gy oe ob l oc od"><strong class="nu iu"><em class="ou">&gt;&gt;&gt; Mean of Training Data: 176.01810663414085<br/>&gt;&gt;&gt; Residuals Sigma2: 0.9769567915901368</em></strong></span><span id="19de" class="nz lh it nu b gy oe ob l oc od">######################################<br/>#### Compute Prediction Intervals ----<br/>######################################</span><span id="40c3" class="nz lh it nu b gy oe ob l oc od">import scipy.stats as st<br/>alpha = 0.05</span><span id="89aa" class="nz lh it nu b gy oe ob l oc od"># 2 sided multiplier<br/>multiplier = st.norm.ppf(1-alpha/2)</span><span id="5269" class="nz lh it nu b gy oe ob l oc od">lower_interval <strong class="nu iu">=</strong> np<strong class="nu iu">.</strong>round(y_train_mean <strong class="nu iu">-</strong> multiplier <strong class="nu iu">*</strong> resid_sigma2<strong class="nu iu">**</strong>0.5, 2)<br/>upper_interval <strong class="nu iu">=</strong> np<strong class="nu iu">.</strong>round(y_train_mean <strong class="nu iu">+</strong> multiplier <strong class="nu iu">*</strong> resid_sigma2<strong class="nu iu">**</strong>0.5, 2)<br/>print(f"Prediction Interval: {lower_interval} - {upper_interval}")</span><span id="701a" class="nz lh it nu b gy oe ob l oc od"><strong class="nu iu"><em class="ou">&gt;&gt;&gt; Prediction Interval: 174.08 - 177.96</em></strong></span></pre></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h2 id="d896" class="nz lh it bd li oj ok dn lm ol om dp lq mh on oo ls ml op oq lu mp or os lw ot bi translated">👉步骤 4:构建模型</h2><p id="7c49" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">既然我们已经完成了理论计算，让我们使用 PyCaret 构建这个模型并检查结果。模型创建就像从实验对象调用<code class="fe nr ns nt nu b">create_model</code>方法一样简单。此外，此时您还可以将特定的超参数传递给模型。在我们的例子中，我们正在建模没有任何自回归属性的数据，所以我们将为<code class="fe nr ns nt nu b">order</code>和<code class="fe nr ns nt nu b">seasonal_order</code>传递全零。如果你想了解更多关于如何用 PyCaret 创建时间序列模型，以及如何定制它们，请参考[3]。</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="236e" class="nz lh it nu b gy oa ob l oc od">model1 = exp.create_model(<br/>    "arima",<br/>    order=(0, 0, 0),<br/>    seasonal_order=(0, 0, 0, 0)<br/>)</span></pre><h2 id="181e" class="nz lh it bd li oj ok dn lm ol om dp lq mh on oo ls ml op oq lu mp or os lw ot bi translated">👉第五步:分析结果</h2><p id="57c2" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">接下来，我使用 PyCaret 一行程序编写了一些小的包装器函数来帮助进行模型评估(参见附录中的定义)。这些是</p><p id="cba2" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">(1) <code class="fe nr ns nt nu b">summarize_model</code>:生成模型的统计概要</p><p id="cda5" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">(2) <code class="fe nr ns nt nu b">get_residual_properties</code>:绘制并显示残差的方差</p><p id="c467" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">(3) <code class="fe nr ns nt nu b">plot_predictions</code>:绘制样本外和样本内预测</p><p id="2a83" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果你想知道更多关于这些功能是如何工作的，特别是<code class="fe nr ns nt nu b">summarize_model</code>，请参考【4】。</p><p id="40c5" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">现在，让我们看看当我们通过这些助手函数运行模型时会得到什么</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="d61b" class="nz lh it nu b gy oa ob l oc od">summarize_model(model1)<br/>get_residual_properties(model1)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/a6850319f0d8a14407d0d9a07a181019.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*-EjDIjpYgQjFCPmPfLCnqA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ARIMA 模型的统计摘要[图片由作者提供]</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/755191a079e17080692d7363acaa14da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xmihqezEV6GYOlC4XS1tTg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">模型残差和残差方差[图片由作者提供]</p></figure><p id="d191" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">上面显示了模型的统计摘要。截距是训练数据的平均值。它与我们上面的理论框架中的计算相吻合！</p><p id="35bc" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">sigma2 是残差的方差。我们怎么知道？检查<code class="fe nr ns nt nu b">get_residual_properties</code>功能的输出。它显示了残差的方差。这个值与统计概要完全匹配，也与我们的理论框架的计算完全匹配！</p><p id="f38d" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">但是预测呢？接下来让我们检查一下。</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="db36" class="nz lh it nu b gy oa ob l oc od">plot_predictions(model1)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/8fee9b4e1cea46760f6b7c48468e1b40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a5Vrr_dfVtIP0x0qE_vZow.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">样本外预测和预测区间[图片由作者提供]</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/06c2d1b3bd73ba4a94b6dcf90ff5ec1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*td3qYS6-TY7q6qnKjyBZpw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在样本预测中[图片由作者提供]</p></figure><p id="1c28" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">默认情况下，PyCaret 使用<code class="fe nr ns nt nu b">plotly</code>库提供交互式绘图，因此我们可以通过悬停在绘图上来快速验证值。我们可以很快看到，样本外和样本内预测值都等于 176.02，这与我们理论框架的计算结果相匹配。预测区间也与我们理论框架中的值相匹配！</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="84bd" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">🚀结论</h1><p id="ec51" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">希望这个简单的模型为我们理解 ARIMA 模型的内部运作打下了良好的基础。在下一组文章中，我们将开始逐一介绍其他参数，并查看它们对模型行为的影响。在那之前，如果你愿意在我的社交渠道上与我联系(我经常发布关于时间序列分析的文章)，你可以在下面找到我。暂时就这样了。预测快乐！</p><p id="f6e8" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">🔗<a class="ae ky" href="https://www.linkedin.com/in/guptanick/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a></p><p id="02ef" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">🐦<a class="ae ky" href="https://twitter.com/guptanick13" rel="noopener ugc nofollow" target="_blank">推特</a></p><p id="fd0b" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">📘<a class="ae ky" href="https://github.com/ngupta23" rel="noopener ugc nofollow" target="_blank"> GitHub </a></p><p id="3850" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><em class="ou">喜欢这篇文章吗？成为</em> <a class="ae ky" href="https://ngupta13.medium.com/membership" rel="noopener"> <strong class="ma iu"> <em class="ou">中等会员</em> </strong> </a> <em class="ou">继续</em> <strong class="ma iu"> <em class="ou">无限制学习</em> </strong> <em class="ou">。如果你使用下面的链接，</em> <strong class="ma iu"> <em class="ou">，我会收到你的一部分会员费，而不会给你带来额外的费用</em> </strong> <em class="ou">。</em></p><div class="mz na gp gr nb nc"><a href="https://ngupta13.medium.com/membership" rel="noopener follow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd iu gy z fp nh fr fs ni fu fw is bi translated">通过我的推荐链接加入 Medium—Nikhil Gupta</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">阅读 Nikhil Gupta(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">ngupta13.medium.com</p></div></div><div class="nl l"><div class="oz l nn no np nl nq ks nc"/></div></div></a></div></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="5095" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">🔖建议下次阅读</h1><p id="9d0a" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/understanding-arima-models-using-pycarets-time-series-module-part2-308ea7bfecf6">使用 PyCaret 的时间序列模块理解 ARIMA 模型—第二部分</a></p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="0821" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">📗资源</h1><ol class=""><li id="b348" class="pa pb it ma b mb mc me mf mh pc ml pd mp pe mt pf pg ph pi bi translated"><a class="ae ky" href="https://nbviewer.org/github/ngupta23/medium_articles/blob/main/time_series/pycaret/pycaret_ts_arima_000_0000.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="ma iu"> Jupyter 笔记本</strong> </a>包含这篇文章的代码</li></ol></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="07b2" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">📚参考</h1><p id="61be" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">[1] <a class="ae ky" href="https://github.com/pycaret/pycaret/discussions/1800" rel="noopener ugc nofollow" target="_blank">诊断 PyCaret </a>中的“白噪声”</p><p id="adc0" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">[2] <a class="ae ky" href="https://github.com/pycaret/pycaret/discussions/1837" rel="noopener ugc nofollow" target="_blank">在 PyCaret 中建模“白噪声”</a></p><p id="813b" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">[3] <a class="ae ky" href="https://github.com/pycaret/pycaret/discussions/1757" rel="noopener ugc nofollow" target="_blank">创建和定制时间序列模型</a></p><p id="991c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">[4] <a class="ae ky" href="https://medium.com/p/57336a2f39c7" rel="noopener">了解 PyCaret 时间序列模块的底层架构</a></p><p id="9210" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">[5] <a class="ae ky" href="https://otexts.com/fpp2/arima.html" rel="noopener ugc nofollow" target="_blank">第八章 ARIMA 模型</a>，《预测:原理与实践》，罗伯 J 海曼和乔治阿萨纳索普洛斯</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="ca19" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated"><strong class="ak">📘附录</strong></h1><ol class=""><li id="1377" class="pa pb it ma b mb mc me mf mh pc ml pd mp pe mt pf pg ph pi bi translated">助手功能</li></ol><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="c6f2" class="nz lh it nu b gy oa ob l oc od"><strong class="nu iu">def summarize_model(model):</strong><br/>    """<br/>    Provides statistical summary for some statistical models<br/>    """<br/>    # Statistical Summary Table<br/>    try:<br/>        print(model.summary())<br/>    except:<br/>        print("Summary does not exist for this model.")</span><span id="08ff" class="nz lh it nu b gy oe ob l oc od"><strong class="nu iu">def get_residual_properties(model):</strong><br/>    """<br/>    Plots and displays variance of residuals<br/>    """<br/>    <em class="ou">#### Residuals ----</em><br/>    try:<br/>        plot_data = exp.plot_model(<br/>            model,<br/>            plot="residuals",<br/>            return_data=True<br/>        )<br/>        resid = plot_data['data']<br/>        resid_sigma2 = (resid**2).sum()/(len(resid))<br/>        print(f"Residual Sigma2: {resid_sigma2}")<br/>    except:<br/>        print("Residuals can not be extracted for this model.")</span><span id="2237" class="nz lh it nu b gy oe ob l oc od"><strong class="nu iu">def plot_predictions(model):</strong><br/>    """<br/>    Plots out-of-sample and in-sample predictions<br/>    """<br/>    # Out-of-Sample Forecast<br/>    exp.plot_model(model)</span><span id="d3a5" class="nz lh it nu b gy oe ob l oc od">    # In-Sample Forecast<br/>    exp.plot_model(model, plot="insample")</span></pre></div></div>    
</body>
</html>