<html>
<head>
<title>How 2 Build a Cloud-Based ML Ops Framework in 2 weeks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在两周内构建基于云的ML Ops框架</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-2-build-a-cloud-based-ml-ops-framework-in-2-weeks-ae67e7a179fe?source=collection_archive---------20-----------------------#2021-04-22">https://towardsdatascience.com/how-2-build-a-cloud-based-ml-ops-framework-in-2-weeks-ae67e7a179fe?source=collection_archive---------20-----------------------#2021-04-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="9c87" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/notes-from-industry" rel="noopener" target="_blank">行业笔记</a></h2><div class=""/><div class=""><h2 id="1304" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">在本帖中，我们将详细介绍我们如何依靠软件工程中的DevOps最佳实践，在两周内构建一个完整的ML Ops框架。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/7c600324468ed1a205d802728947265b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*up0Ssfw1uel68V4G_fWUiA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">我们对ML Ops @ Ekstra Bladet的实现名为“Jokke”。资料来源:Ekstra Bladet。</p></figure><p id="dfef" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">许多组织已经投资开发基于机器学习的服务，但仍在努力寻找将机器学习模型从开发过渡到生产的最佳方式。</p><p id="1800" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">时至今日，这种方法通常是严格的，并且意味着各种各样的手动过程(以及这种手动过程所带来的所有操作风险)。从组织和模型开发人员的角度来看，这是非常低效和反生产的。</p><h1 id="3667" class="md me it bd mf mg mh mi mj mk ml mm mn ki mo kj mp kl mq km mr ko ms kp mt mu bi translated"><strong class="ak">解决方案:ML Ops </strong></h1><p id="9ec7" class="pw-post-body-paragraph lh li it lj b lk mv kd lm ln mw kg lp lq mx ls lt lu my lw lx ly mz ma mb mc im bi translated">当你开发一个现实生活中的机器学习服务时，你实际上是在开发一个软件。因此，在传统软件开发的世界中寻找解决方案是显而易见的。</p><p id="eafa" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">正如在<a class="ae na" rel="noopener" target="_blank" href="/ml-ops-machine-learning-as-an-engineering-discipline-b86ca4874a3f">之前的文章</a>中所详细描述的，来自软件工程的DevOps最佳实践使得软件可以(持续地)立即交付生产，并保持其可靠运行。</p><p id="f40d" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这些DevOps原则可以应用于开发和部署机器学习服务(新版本)的迭代过程。当这样做时，这有时被称为<em class="nb">机器学习操作</em> (=ML Ops) <em class="nb">。</em></p><p id="8207" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">与DevOps类似，ML Ops依赖于工具、自动化和工作流，这些工具、自动化和工作流抽象出意外的复杂性，让模型开发人员专注于他们应该做的事情和他们擅长的事情:开发机器学习模型。</p><h1 id="c5ab" class="md me it bd mf mg mh mi mj mk ml mm mn ki mo kj mp kl mq km mr ko ms kp mt mu bi translated">建还是买？</h1><p id="f96b" class="pw-post-body-paragraph lh li it lj b lk mv kd lm ln mw kg lp lq mx ls lt lu my lw lx ly mz ma mb mc im bi translated">存在多个云机器学习平台，包括AWS Sagemaker、BentoML和ML Flow。它们当然不坏，但它们可能很贵，有时感觉像用大锤砸坚果。</p><p id="acb2" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">当我们考虑如何接近ML Ops时，我们知道我们将很快不得不将许多机器学习模型投入生产，特别是推荐系统和自然语言处理系统。</p><p id="b7e2" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">此外，我们知道我们需要一个标准化和可扩展的设置。这种设置必须为几个模型构建者指定清晰简单的规则，同时保持训练方法的自由度。最后，我们的解决方案必须支持多种多样的ML模型，并能够轻松实现不断涌现的新机器学习方法。</p><p id="d8b5" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这让我们选择建造而不是购买。</p><h1 id="e421" class="md me it bd mf mg mh mi mj mk ml mm mn ki mo kj mp kl mq km mr ko ms kp mt mu bi translated">遇见“Jokke”</h1><p id="222f" class="pw-post-body-paragraph lh li it lj b lk mv kd lm ln mw kg lp lq mx ls lt lu my lw lx ly mz ma mb mc im bi translated">在我们的组织Ekstra Bladet中，我们使用Amazon Web Services堆栈中的一套相关服务，在两周内构建了一个简单(但功能强大)的基于云的ML Ops实现。我们把这个框架命名为“Jokke”。</p><p id="1cee" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">其核心“Jokke”由两条<a class="ae na" href="https://en.wikipedia.org/wiki/Continuous_integration" rel="noopener ugc nofollow" target="_blank">连续集成</a> / <a class="ae na" href="https://en.wikipedia.org/wiki/Continuous_delivery" rel="noopener ugc nofollow" target="_blank">连续输送</a>管道组成。管道是动作序列，每次模型开发人员向git提交新版本的机器学习模型时都会自动运行:</p><ol class=""><li id="52d2" class="nc nd it lj b lk ll ln lo lq ne lu nf ly ng mc nh ni nj nk bi translated">构建和发布模型的<strong class="lj jd">构建</strong>管道</li><li id="dc04" class="nc nd it lj b lk nl ln nm lq nn lu no ly np mc nh ni nj nk bi translated">一个<strong class="lj jd"> DEPLOY </strong>管道将模型部署为一个微服务，通过HTTP请求计算预测</li></ol><p id="8b6d" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">下面我们举例说明了两个管道的工作流程(的简化版本),以及它们是如何相互链接的。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nq"><img src="../Images/5aa15135ebcd2336d2c0b50814a49374.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XniRoqQDeH73yDm8Yj4wBA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">“Jokke”构建和部署CI/CD管道的工作流程。资料来源:Ekstra Bladet</p></figure><p id="c4c2" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">接下来，我们将带您更详细地了解每个管道的工作原理。</p><h1 id="1f25" class="md me it bd mf mg mh mi mj mk ml mm mn ki mo kj mp kl mq km mr ko ms kp mt mu bi translated">阶段1:构建</h1><p id="f72d" class="pw-post-body-paragraph lh li it lj b lk mv kd lm ln mw kg lp lq mx ls lt lu my lw lx ly mz ma mb mc im bi translated">为了让机器学习模型与我们的框架兼容，模型的代码必须只满足几个要求。</p><p id="8b5b" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们已经尝试设计需求，这样它们强制执行我们为我们的模型开发代码的方式的最小标准化，而不限制模型开发人员对他们的分析方法和工具的选择的不必要的限制(实际上这是最重要的原因之一，为什么我们首先决定开发我们自己的框架)。</p><p id="0f6e" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">首先，我们要求模型的代码必须包装成python包。这是我们的框架与大多数可用解决方案之间的主要区别，后者专注于将笔记本电脑转变为服务。</p><p id="4518" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们还要求，模型本身必须作为自己的python类<code class="fe nr ns nt nu b">Model</code>来实现，并有两个强制方法:</p><ol class=""><li id="3410" class="nc nd it lj b lk ll ln lo lq ne lu nf ly ng mc nh ni nj nk bi translated"><code class="fe nr ns nt nu b">produce_model()</code>:产生模型的方法。</li><li id="56e2" class="nc nd it lj b lk nl ln nm lq nn lu no ly np mc nh ni nj nk bi translated"><code class="fe nr ns nt nu b">predict()</code>:通过调用(1)得到的训练模型预测新观测值的方法。</li></ol><p id="05c3" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">当模型开发人员向git提交模型的新版本时，它会触发“Jokke”<strong class="lj jd">BUILD</strong>管道来启动一个适当维度的虚拟实例，该实例:</p><ul class=""><li id="1bde" class="nc nd it lj b lk ll ln lo lq ne lu nf ly ng mc nv ni nj nk bi translated">安装软件包</li><li id="df1c" class="nc nd it lj b lk nl ln nm lq nn lu no ly np mc nv ni nj nk bi translated">运行由模型开发人员编写的测试(例如，单元、集成和验收测试(包括模型性能测试))</li><li id="ef2f" class="nc nd it lj b lk nl ln nm lq nn lu no ly np mc nv ni nj nk bi translated">训练并生产模型工件(使用<code class="fe nr ns nt nu b">produce_model()</code>方法)</li><li id="433c" class="nc nd it lj b lk nl ln nm lq nn lu no ly np mc nv ni nj nk bi translated">在我们自己的Python包索引上发布模型包</li><li id="828b" class="nc nd it lj b lk nl ln nm lq nn lu no ly np mc nv ni nj nk bi translated">将模型工件和测试报告写入AWS S3存储桶</li></ul><p id="374c" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果管道中的一个步骤失败，所有后续步骤都将中止。</p><p id="30c4" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果流水线是成功的，则机器学习模型的新版本通过python模型包的新版本与训练好的模型工件的结合来发布。</p><p id="42de" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果你想知道代码中的构建管道是什么样子，我们已经发布了开源人工智能模型项目<a class="ae na" href="https://github.com/ebanalyse/NERDA/blob/main/.github/workflows/build.yml" rel="noopener ugc nofollow" target="_blank"> NERDA </a>的简化版本:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nw nx l"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">一个用Github动作实现的我们的人工智能项目“NERDA”的简化“构建”管道的例子。</p></figure><h1 id="e26f" class="md me it bd mf mg mh mi mj mk ml mm mn ki mo kj mp kl mq km mr ko ms kp mt mu bi translated">阶段2:部署</h1><p id="31a5" class="pw-post-body-paragraph lh li it lj b lk mv kd lm ln mw kg lp lq mx ls lt lu my lw lx ly mz ma mb mc im bi translated">如果“Jokke”<strong class="lj jd">构建</strong>管道成功，我们现在就有了自己的机器学习模型的新版本。如果我们想将模型部署为服务，即实时预测服务，我们的Jokke <strong class="lj jd"> DEPLOY </strong>管道将完成这项工作。</p><p id="0876" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们所需要的是，模型开发人员构建一个最小的应用程序(默认为python Flask应用程序)，该应用程序(1)加载由<strong class="lj jd">构建</strong>管道产生的模型包和模型工件，以及(2)利用<code class="fe nr ns nt nu b">predict()</code>方法预测“预测”端点中的新观察。</p><p id="d957" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">当模型开发人员向git提交应用程序的新版本时，它会触发“Jokke”<strong class="lj jd">DEPLOY</strong>管道，即:</p><ol class=""><li id="5e6f" class="nc nd it lj b lk ll ln lo lq ne lu nf ly ng mc nh ni nj nk bi translated">收集由<strong class="lj jd">构建</strong>管道产生的模型包和模型工件</li><li id="1932" class="nc nd it lj b lk nl ln nm lq nn lu no ly np mc nh ni nj nk bi translated">将应用程序封装并发布为Docker映像</li><li id="86c7" class="nc nd it lj b lk nl ln nm lq nn lu no ly np mc nh ni nj nk bi translated">从(2)中内置的Docker映像启动一个web服务，该服务提供实时预测</li></ol><p id="7f96" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">与第一阶段一样，如果管道的任何步骤失败，所有后续步骤都将中止。</p><p id="fb66" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果流水线成功，机器学习模型现在在<em class="nb">测试</em>环境中运行，在那里它通过RESTFUL API(默认)实时提供预测。</p><p id="2b92" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果我们对我们的新服务感到满意，剩下要做的就是单击一下就批准它，这将触发我们的服务部署到<em class="nb">生产</em>。耶！</p><h1 id="9a15" class="md me it bd mf mg mh mi mj mk ml mm mn ki mo kj mp kl mq km mr ko ms kp mt mu bi translated">还有吗？</h1><p id="b701" class="pw-post-body-paragraph lh li it lj b lk mv kd lm ln mw kg lp lq mx ls lt lu my lw lx ly mz ma mb mc im bi translated">“Jokke”不仅仅是管道。例如，我们已经使用出色的<a class="ae na" href="https://pypi.org/project/cookiecutter/" rel="noopener ugc nofollow" target="_blank"> cookiecutter </a>包为“Jokke”模型和服务设计了自己的项目模板。</p><p id="dd2e" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">此外，我们还开发了云基础设施，这使得为新项目启用管道以及在测试和生产中实时监控模型服务的仪表板变得更加容易。</p><h1 id="b7e7" class="md me it bd mf mg mh mi mj mk ml mm mn ki mo kj mp kl mq km mr ko ms kp mt mu bi translated">我们取得了什么成就？</h1><p id="ff03" class="pw-post-body-paragraph lh li it lj b lk mv kd lm ln mw kg lp lq mx ls lt lu my lw lx ly mz ma mb mc im bi translated">“Jokke”管道的优势在于，每当模型开发人员想要发布一个新版本的模型时，它们会自动执行原本必须由他/她手工完成的操作和工作。这使得可以(连续地)立即将新模型交付生产，并保持它们可靠地运行。</p><p id="05c1" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">此外，“Jokke”使我们的模型开发人员能够专注于模型开发，从而利用他们的生产力。</p><h1 id="c56c" class="md me it bd mf mg mh mi mj mk ml mm mn ki mo kj mp kl mq km mr ko ms kp mt mu bi translated"><strong class="ak">快捷键</strong></h1><p id="2456" class="pw-post-body-paragraph lh li it lj b lk mv kd lm ln mw kg lp lq mx ls lt lu my lw lx ly mz ma mb mc im bi translated">如果你想为你的机器学习项目尝试CI/CD，你可以考虑开源框架<a class="ae na" href="https://cml.dev/" rel="noopener ugc nofollow" target="_blank"> CML(连续机器学习)</a>，那看起来真的很有前途。</p><p id="c113" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果您像我们一样选择开发自己的框架，我们建议您利用您的云平台上的相关服务。例如，我们使用AWS CodeBuild和AWS Code Pipeline来编排我们的管道。其他成熟的云平台上也有类似的服务。使用这些服务当然有助于大大加快我们的开发过程。</p><h1 id="ed3e" class="md me it bd mf mg mh mi mj mk ml mm mn ki mo kj mp kl mq km mr ko ms kp mt mu bi translated">退关货物</h1><p id="88bd" class="pw-post-body-paragraph lh li it lj b lk mv kd lm ln mw kg lp lq mx ls lt lu my lw lx ly mz ma mb mc im bi translated">“Jokke”是由三个人组成的团队在两周内开发的:<a class="ae na" href="https://www.linkedin.com/in/alexander-jensen-67674075/" rel="noopener ugc nofollow" target="_blank">亚历山大·詹森</a>、<a class="ae na" href="https://www.linkedin.com/in/simon-kokkendorff-2aa488a0/" rel="noopener ugc nofollow" target="_blank">西蒙·科肯多夫</a>和你真正的。它现在被Ekstra Bladet的数据科学团队和Ekstra Bladet的ML创新团队用于构建和部署大规模模型，后者是新闻平台智能项目的一部分，由丹麦创新基金慷慨赞助。</p><h1 id="bf85" class="md me it bd mf mg mh mi mj mk ml mm mn ki mo kj mp kl mq km mr ko ms kp mt mu bi translated">资源</h1><div class="ny nz gp gr oa ob"><a rel="noopener follow" target="_blank" href="/ml-ops-machine-learning-as-an-engineering-discipline-b86ca4874a3f"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd jd gy z fp og fr fs oh fu fw jc bi translated">ML Ops:作为工程学科的机器学习</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">随着ML从研究走向应用商业解决方案的成熟，我们是否需要提高其运营的成熟度…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op lb ob"/></div></div></a></div><div class="ny nz gp gr oa ob"><a href="https://cml.dev/" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd jd gy z fp og fr fs oh fu fw jc bi translated">CML -连续机器学习:将DevOps带入数据科学</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">CML是机器学习的持续集成。将DevOps实践引入您的项目，以实现自动化…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">cml.dev</p></div></div><div class="ok l"><div class="oq l om on oo ok op lb ob"/></div></div></a></div><div class="ny nz gp gr oa ob"><a href="https://pypi.org/project/cookiecutter/" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd jd gy z fp og fr fs oh fu fw jc bi translated">烹饪刀具</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">从项目模板创建项目的命令行实用程序，例如，从…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">pypi.org</p></div></div><div class="ok l"><div class="or l om on oo ok op lb ob"/></div></div></a></div></div></div>    
</body>
</html>