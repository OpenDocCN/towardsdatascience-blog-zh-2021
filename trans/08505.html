<html>
<head>
<title>Time-filter for Great Whale’s migration routes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">巨鲸迁徙路线的时间过滤器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-filter-for-great-whales-migration-routes-32c429ac6bb9?source=collection_archive---------25-----------------------#2021-08-05">https://towardsdatascience.com/time-filter-for-great-whales-migration-routes-32c429ac6bb9?source=collection_archive---------25-----------------------#2021-08-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1854" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">大鲸的跟踪记录与移动的熊猫成直线</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/05da3e37800a82584f8291ad1d299914.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*bU4C--lPdtWk-gllLw8EOw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。带时间过滤器的大鲸迁徙路线的最终演示。</p></figure><p id="0cb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当谈到它们的迁徙行为时，大鲸鱼是令人着迷的动物。<a class="ae ky" href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0076507#abstract0" rel="noopener ugc nofollow" target="_blank"> Silva等人</a> (2013)解释说，鲸鱼每年都要花费大量的时间和精力在相距遥远的地理区域之间移动。正如我们在这个故事的地图上看到的，大鲸鱼从亚速尔群岛出发，穿越北大西洋，进行了一次相当长的旅行。在该数据集中登记的最长的一条是7194公里，对应于2009年。</p><p id="0a17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过时间过滤器可视化迁移路线的主要发现与鲸鱼移动的季节性影响有关。正如我们在演示中看到的，在初夏开始旅程的大鲸鱼(紫色和黄色)一直在中纬度地区移动，假设它们在迁徙栖息地觅食。另一方面，其他鲸鱼(绿色、橙色、蓝色和粉色)后来开始在亚速尔群岛附近觅食。</p><blockquote class="lv"><p id="3112" class="lw lx it bd ly lz ma mb mc md me lu dk translated"><a class="ae ky" href="https://bryanvallejo16.github.io/whale-tracking-azores/" rel="noopener ugc nofollow" target="_blank">这里是最终演示</a></p></blockquote><p id="e0b7" class="pw-post-body-paragraph kz la it lb b lc mf ju le lf mg jx lh li mh lk ll lm mi lo lp lq mj ls lt lu im bi translated">谈到大鲸鱼的迁徙行为，一个重要的因素是食物的可获得性。在觅食季节，鲸鱼需要注意出发的时间和身体状况，因为它会影响到达繁殖地的时间和身体状况，最终影响繁殖成功[1]。在我的一个演示中，我解释了如何通过分析迁徙行为来发现鸟类跟踪记录中的筑巢点。在这里找到文章:<a class="ae ky" rel="noopener" target="_blank" href="/stop-detection-in-gps-tracks-movingpandas-keplergl-point-map-with-stops-duration-in-bird-664064b3ccbc"> <strong class="lb iu">鸟类迁徙GPS轨迹中的停止检测—移动的熊猫&amp; KeplerGl </strong> </a> <strong class="lb iu">。</strong></p><blockquote class="lv"><p id="0aea" class="lw lx it bd ly lz ma mb mc md me lu dk translated">“这种做法的目的是按年份过滤大鲸鱼的迁徙路线，并将GPS轨迹转换为线串。第二部分，基于动物行为参数寻找觅食点</p></blockquote><p id="aecb" class="pw-post-body-paragraph kz la it lb b lc mf ju le lf mg jx lh li mh lk ll lm mi lo lp lq mj ls lt lu im bi translated">这个演示是大鲸迁徙路线中动物行为分析的第一部分。在第二部分，将包括识别觅食点的算法。看看演示中的觅食行为分析图:<a class="ae ky" rel="noopener" target="_blank" href="/stop-detection-in-blue-whales-gps-tracking-movingpandas-0-6-55a4b893a592"> <strong class="lb iu">蓝鲸GPS追踪中的觅食点</strong> </a>，南极企鹅追踪中的觅食点<a class="ae ky" rel="noopener" target="_blank" href="/orthographic-projection-with-pyproj-for-penguin-tracking-in-antarctica-18cd2bf2d570"><strong class="lb iu"/></a><strong class="lb iu">。</strong></p><p id="aa55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大鲸行为分析的重点是了解在迁徙栖息地进食的相关性，以及这种策略是否会在它们生命周期的后期级联。分析迁徙路线需要回答的问题是:单个鲸鱼在这个迁徙栖息地停留多长时间？该地区的日常活动和活动是什么？是否在沿途的其他站点进行馈送？[1]</p><blockquote class="lv"><p id="978b" class="lw lx it bd ly lz ma mb mc md me lu dk translated">“如今的问题可以用运动分析来回答，专用于这种分析的软件是<a class="ae ky" href="https://medium.com/gis4-wildlife-tracking/the-wildlife-tracker-a-real-time-gis-tool-for-nature-conservation-7e2e0584464e?sk=9b7da5b3ff969d4f8e53e61706a1c357" rel="noopener">野生动物跟踪器</a>”</p></blockquote><h1 id="6dc4" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">数据</h1><p id="1f01" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">本演示中使用的数据集对应于<a class="ae ky" href="https://www.movebank.org/cms/webapp?gwt_fragment=page=studies,path=study72289508" rel="noopener ugc nofollow" target="_blank">亚速尔群岛大鲸卫星遥测程序</a>。它可以在Movebank中找到，并且是在非商业性知识共享许可下使用。</p><h1 id="fd73" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz nh ka mw kc ni kd my kf nj kg na nb bi translated"><strong class="ak">练习</strong></h1><p id="3e85" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在本练习中，我将展示如何将GPS跟踪记录转换为Linestring，以及如何执行简单的时间过滤来查看2009年大鲸鱼的迁徙路线。我选择2009年是因为这一年的迁徙路线最长，长达7194公里。</p><p id="905e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们将导入所有需要的库:</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="587d" class="np ml it nl b gy nq nr l ns nt">import pandas as pd<br/>import geopandas as gpd<br/>import movingpandas as mpd<br/>from shapely.geometry import Point<br/>from datetime import datetime, timedelta<br/>from keplergl import KeplerGl</span></pre><p id="36bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们读取数据文件:</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="c3d6" class="np ml it nl b gy nq nr l ns nt">fp = r’data/azores_great_whales.geojson’<br/>geodata = gpd.read_file(fp, driver=’GeoJSON’)</span></pre><p id="4a45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们准备包括<code class="fe nu nv nw nl b">timestamp</code>的数据作为索引。我们在<code class="fe nu nv nw nl b">id_whale</code>列中为鲸鱼创建了一个新的<code class="fe nu nv nw nl b">id </code>，并且我们包括了<code class="fe nu nv nw nl b">year </code>和<code class="fe nu nv nw nl b">month</code>。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="db7d" class="np ml it nl b gy nq nr l ns nt"># preparing data<br/>geodata[‘t’] = pd.to_datetime(geodata[‘timestamp’])<br/>geodata = geodata.set_index(‘t’)</span><span id="099b" class="np ml it nl b gy nx nr l ns nt"># setting individuals<br/>geodata[‘id_whale’] = [‘w’+str(idwhale) for idwhale in geodata[‘ind_ident’].to_list()]</span><span id="38ef" class="np ml it nl b gy nx nr l ns nt"># time attributes<br/>geodata[‘year’] = geodata.index.year<br/>geodata[‘month’] = geodata.index.month</span></pre><p id="49eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们创建了一个<code class="fe nu nv nw nl b">trajectory_collection </code>对象，并创建了一个函数来返回转换成<strong class="lb iu"> LineString </strong>的GPS记录。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="304a" class="np ml it nl b gy nq nr l ns nt">traj_collection = mpd.TrajectoryCollection(geodata, ‘id_whale’)</span><span id="610f" class="np ml it nl b gy nx nr l ns nt">def line_tracement(trajectory_collection):<br/> <br/> tracement = gpd.GeoDataFrame(columns = [‘geometry’], geometry = ‘geometry’)<br/> tracement[‘whale_id’] = [route.id for route in trajectory_collection]<br/> <br/> tracement[‘i’] = tracement[‘whale_id’]<br/> tracement = tracement.set_index(‘i’)<br/> <br/> for line in trajectory_collection:<br/> <br/> tracement.at[line.id, ‘geometry’] = line.to_linestring()<br/> tracement.at[line.id, ‘length_km’] = line.get_length()/1000<br/> <br/> return tracement</span></pre><p id="f33e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们应用函数:</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="12c5" class="np ml it nl b gy nq nr l ns nt">whales_lines = line_tracement(traj_collection)</span></pre><p id="df62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将看到一个格式如下的表格:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/32cdd6e08e6516ce8cfa99d9b0345177.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O5fJxLx05Z3dATWNIzfPTw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。包含作为线串的路由的表的结构</p></figure><p id="c358" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前，我们已经可以想象出我们拥有的路线，它们看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/0977d85ba1d8c2ba1e9fdd04473a3f3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zttWEi6z1YzGYjd0m5owww.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。所有研究期间大鲸的洄游路线</p></figure><p id="0cea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以开始应用时间过滤器:</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="cb88" class="np ml it nl b gy nq nr l ns nt"># prepare tables for visualizationgeovis = geodata[[‘timestamp’, ‘long’, ‘lat’,’id_whale’, ‘year’, ‘geometry’]]</span><span id="60c7" class="np ml it nl b gy nx nr l ns nt">geovis = geovis.reset_index(drop=True)</span><span id="1553" class="np ml it nl b gy nx nr l ns nt">subset = [2009]</span><span id="7310" class="np ml it nl b gy nx nr l ns nt">geovis = geovis.loc[geovis[‘year’].isin(subset)]</span><span id="38e8" class="np ml it nl b gy nx nr l ns nt">geovis[‘year_id’] = [‘Year ‘+str(year) for year in geovis[‘year’].to_list() ]</span></pre><p id="281f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能会注意到我们2009年的可视化中有6条大鲸鱼，我们在GPS记录中应用了过滤器，而不是在线表格中。该表如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/619ca62727a41c97c87c0ce1ee310ac6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*El5ezTV_9mOBh_re0LEL2g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。2009年应用时间过滤器的大鲸GPS记录</p></figure><p id="787e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了增加一个漂亮的可视化效果，我们还在LineString表中包含了2009年6条鲸鱼的id。像这样:</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="433a" class="np ml it nl b gy nq nr l ns nt">whales_subset=[‘w80711’, ‘w80712’, ‘w80717’, ‘w80716’, ‘w80700’, ‘w80709’]<br/>year_whalelines = whales_lines.loc[whales_lines[‘whale_id’].isin(whales_subset)]</span></pre><p id="b328" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你已经可以在这样的地图上看到6条巨鲸的迁徙路线:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/56b01c9495994e53243a630371afa4ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*45MEiUPugy0vyWZ81dZBwA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。2009年大鲸的迁徙路线</p></figure><p id="bd59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们要用视觉化来工作。我们创建一个KeplerGl实例，添加数据集，并配置地图，如前面所示。您可以在此添加一个时间过滤器，用于GPS记录(点)的动画:</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="a088" class="np ml it nl b gy nq nr l ns nt"># Create KeplerGl instance<br/>m = KeplerGl(height=600)</span><span id="ce8b" class="np ml it nl b gy nx nr l ns nt"># Add tracement in point<br/>m.add_data(geovis, ‘Location’)</span><span id="b1e7" class="np ml it nl b gy nx nr l ns nt"># Add tracement in line<br/>m.add_data(whales_lines, ‘Trajectories’)</span><span id="b369" class="np ml it nl b gy nx nr l ns nt">m.add_data(year_whalelines, ‘2009 Trajectories’)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/b27b53609c0c71c2c222960848faf9ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mxv6pGFMJG5Wc2Vt1yHjdw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。2009年大鲸的迁徙路线。线串和GPS记录。</p></figure><p id="091f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们保存HTML文件:</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="020c" class="np ml it nl b gy nq nr l ns nt">m.save_to_html(file_name=’index.html’)</span></pre><h1 id="5187" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz nh ka mw kc ni kd my kf nj kg na nb bi translated">结论</h1><p id="3b5e" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">运动分析的能力是理解动物行为的关键工具。在第一种方法中，时间过滤器有助于理解大鲸的迁徙路线受季节性的影响。它们中的一些喜欢在迁徙栖息地觅食，而另一些则喜欢待在亚速尔群岛附近。作为一种地理可视化，这种运动是野生动物研究的有力工具，有助于划定这些大型哺乳动物的猎物采集范围。在未来的方法中，我将包括探测鲸鱼觅食点的觅食行为分析。这种可视化可以生成关于迁徙路线中的位置(纬度、路线段)的清晰地图和见解，并且可以帮助测试与大鲸迁徙行为相关的假设。</p><h1 id="f9d8" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz nh ka mw kc ni kd my kf nj kg na nb bi translated">建议</h1><p id="99e8" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">作为个人建议，我建议在应用时间过滤器时要明确。该演示展示了2009年的迁移路线，但您永远不知道您正在处理的数据集是否包含同一年的整个路线。根据收集数据集的追踪技术的能力，数据收集的时间框架可能会超过一年。这只是一个时间过滤器应用程序，可以解释野生动物迁徙路线中季节性影响的界限。</p></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><p id="4077" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您在创建线串或可视化的过程中需要支持。请不要犹豫，在这里发表评论，在我的LinkedIn个人简介中给我发消息。</p><h1 id="fb05" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz nh ka mw kc ni kd my kf nj kg na nb bi translated">参考</h1><p id="2e1b" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">[1]席尔瓦·马、彼尔托·R、琼森·I、鲍姆加特纳·MF、桑多斯·RS(2013年)。北大西洋的蓝鲸和长须鲸暂停春季迁徙，前往中纬度地区觅食:为旅途积蓄能量？ 《公共科学图书馆·综合》8(10): e76507。【https://doi.org/10.1371/journal.pone.0076507 T4】</p></div></div>    
</body>
</html>