<html>
<head>
<title>How to overlay data on maps easily using SAS Studio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 SAS Studio 轻松地在地图上叠加数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-overlay-data-on-maps-easily-using-sas-studio-3b85de998e5e?source=collection_archive---------29-----------------------#2021-11-03">https://towardsdatascience.com/how-to-overlay-data-on-maps-easily-using-sas-studio-3b85de998e5e?source=collection_archive---------29-----------------------#2021-11-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3c99" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">SAS Studio 中的地图非常简单</h2></div><h1 id="eb7f" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">动机</h1><p id="178c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">每年，我的许多朋友都会问我最安全的纽约区，在那里他们可以为他们的孩子租一个地方。许多学生来纽约参加暑期培训或工作。我住在纽约，但不是纽约市。因此，我总是去寻找数据来回答这个问题，并在我的书《使用 SAS Studio<a class="ae lw" href="https://amzn.to/3lh00JU" rel="noopener ugc nofollow" target="_blank">学习数据科学》中添加了这个过程，该书于 2020 年由 Apress 出版。</a></p><h1 id="b33f" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated"><strong class="ak">地图</strong></h1><p id="b162" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在地图上显示数据增加了新的视角。它可以自己讲述整个故事。SAS Studio 使在地图上显示数据变得容易。此外，使用颜色和气泡自定义地图会为您的数据添加新的维度。本节将使用现实生活中的数据引导您完成这一过程。它将逐步向您展示如何下载数据并准备在地图上显示。</p><h1 id="ca98" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">气泡图</h1><p id="7d55" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">气泡图任务创建一个覆盖有气泡图的地图。对于这个例子，我们将使用纽约市的犯罪数据来创建一个气泡图，显示 2018 年纽约市不同行政区的犯罪率。这些数据可通过纽约市开放数据项目网站获得。</p><p id="e94a" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">您将在“数据集”文件夹中找到该数据文件；文件命名为 NYPD _ 投诉 _ 数据 _ 当前 _ _ 年度 _ 截止日期. csv，或者，您可以从以下网址下载数据集:<a class="ae lw" href="https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Current-Year-To-Date-/5uac-w243/data" rel="noopener ugc nofollow" target="_blank">https://Data . cityofnewyork . us/Public-Safety/NYPD-投诉-数据-当前年度至今-/5uac-w243/data </a> [1]。</p><p id="4492" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">要从链接下载数据集，如图 1 所示，单击 Export，然后单击 CSV。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/887533b1a9f5ad1241ec64e4682d0b23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vUghzAv0DCBNXXGjz4n5UA.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">图 1:符合 NYPD 标准的数据——NYC open Data(图片由作者提供)</p></figure><p id="36c8" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">数据集包含大量信息。利用这些数据可以进行大量的调查和分析。例如，每个区最普遍的犯罪类型是什么？犯罪最有可能发生的时间是什么时候？大多数犯罪发生在一周的哪一天？</p><p id="9cd9" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">对于这个例子，我们只对回答哪个区的犯罪率最高和哪个区的犯罪率最低感兴趣。要回答这个问题，我们需要以下三列:行政区、经度和纬度。因此，我们删除了所有其他列。然后，我们计算每个区的犯罪数量，用地图上的气泡来表示。</p><p id="c5db" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">在清理和准备数据之后，我们得到了下表所示的数据集。</p><h2 id="50d6" class="ms kj it bd kk mt mu dn ko mv mw dp ks lj mx my ku ln mz na kw lr nb nc ky nd bi translated">表:每个区的犯罪数量</h2><p id="7201" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">行政区|犯罪数量|纬度|经度</p><p id="c88a" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">布朗克斯| 50153 | 40.82452 | -73.8978</p><p id="095d" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">布鲁克林| 67489 | 40.82166 | -73.9189</p><p id="a8a9" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">曼哈顿| 56691 | 40.71332 | -73.9829</p><p id="fc29" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">皇后区| 44137 | 40.74701 | -73.7936</p><p id="d81d" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">斯塔滕岛| 10285 | 40.63204 | -74.1222</p><p id="76cb" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">为了加载数据，我们在 SAS Studio 中编写清单 1。</p><h2 id="a512" class="ms kj it bd kk mt mu dn ko mv mw dp ks lj mx my ku ln mz na kw lr nb nc ky nd bi translated">清单 1:为每个区的犯罪数量创建数据集</h2><pre class="md me mf mg gt ne nf ng nh aw ni bi"><span id="a7bb" class="ms kj it nf b gy nj nk l nl nm">data NYC_crime;<br/>input Borough $13.;<br/>datalines;<br/>BRONX<br/>BROOKLYN<br/>MANHATTAN<br/>QUEENS<br/>STATEN ISLAND<br/>;<br/>run;</span><span id="fce4" class="ms kj it nf b gy nn nk l nl nm">data NYC_crime_dim;<br/>set nyc_crime;<br/>input count Latitude Longitude;<br/>datalines;<br/>50153 40.82451851 -73.897849<br/>67489 40.82166423 -73.91885603<br/>56691 40.71332365 -73.98288902<br/>44137 40.74701026 -73.79358825<br/>10285 40.63203653 -74.1222402<br/>;<br/>run;</span></pre><p id="5916" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">在这个程序中，我们没有导入原始数据文件。我们在数据步骤中使用 DATALINES 关键字将表的值插入到代码中。在清单 1 中，我们有两个数据步骤。第一个叫 NYC_crime。第二行使用 INPUT 语句指定列的名称和类型。在这个表中，我们只定义了一列作为区名，它的类型是 character，因为我们使用了$。最大字符数为 13。然后，我们使用 DATALINES 语句插入实际值，并以分号结束。</p><p id="f669" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">第二个数据步骤创建另一个名为 NYC_crime_dim 的表，在每个表中插入行政区的维度和犯罪数量。该表由前面的表 nyc_crime 使用 SET 语句初始化。同样，我们使用 INPUT 语句来指定我们应该向 borough 中再添加三列。我们添加计数、纬度和经度。记住在列名之间留一个空格，不要使用逗号。同样，使用数据行插入实际值，并以分号结束。</p><p id="5e87" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">运行清单 1 后，将在工作库中创建两个名为 NYC_crime 和 NYC_crime_dim 的新表。要查看输出表，请单击库➤工作；在它下面，你会找到 NYC_crime 和 NYC_crime_dim。如果没有，请刷新您的库。</p><p id="f666" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">现在，点击任务和工具➤任务➤地图➤气泡图，如图 2 所示。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi no"><img src="../Images/b6013e8748ce5baa0b529e6367e785f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/format:webp/1*gGJPw_F5CJaea8ma4yIBWQ.png"/></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">图 2:创建气泡图(图片由作者提供)</p></figure><p id="5031" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">如图 2 所示，选择数据集工作。数据字段中的 NYC_CRIME_DIM。在角色中，选择纬度和经度。在气泡大小中，选择计数，即犯罪的数量。最后，在“组”中，选择“区”列。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi np"><img src="../Images/8ca7ca0a8bbfd1ac2c09ccb389f09a25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*vFATx0T0twkfj_l7Fp0JAQ.png"/></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">图 3:每个区的犯罪数量(图片由作者提供)</p></figure><p id="3cb7" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">对于基本地图，选择 OpenStreetMap。在本章的后面，我们将尝试 Esri maps 来查看输出中的差异。保留其余的默认值，然后单击 Run。将显示图 4 中的气泡图。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi nq"><img src="../Images/62f9892759b8d8007fa177d542c1e265.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qRFwLS-Bgt9L17p10JyBeg.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">图 4:每个区的犯罪数量(图片由作者提供)</p></figure><p id="7c22" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">从泡沫大小可以清楚地看出，布鲁克林的犯罪率最高，而斯塔滕岛的犯罪率最低。SAS Studio 会自动调整气泡的位置、大小和颜色。此外，它还在地图底部添加了一个图例，用于表示行政区的颜色代码。</p><p id="5238" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">现在，让我们增强气泡图的外观。我们可以给带有犯罪数量的气泡添加一个标签，并给地图添加一个标题。如图 5 所示，在 Appearance 选项卡的 Data Labels 中，从 Bubble label 的数据集中选择 count 列。然后，在“标签选项”中，选择“粗体”作为“字体粗细”。在标签位置，选择“居中”。最后，在标题和脚注中，输入“纽约市行政区的犯罪数量”</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/642d69f3fb577b39736a2d165f0130b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*viWMW02YtbM-rthe_rjTvw.png"/></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">图 5:增强外观(图片由作者提供)</p></figure><p id="a193" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">单击运行以检查新的更改。输出如图 6 所示。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi ns"><img src="../Images/1279c48b6fc641e10868329ccbb884ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7dpCnpeATQuLl13I6AMwkA.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">图 6:纽约市各区的犯罪数量(图片由作者提供)</p></figure><p id="f52f" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">清单 2 显示了 SAS Studio 通过用户界面从我们的选项中自动生成的代码。</p><h2 id="2cf4" class="ms kj it bd kk mt mu dn ko mv mw dp ks lj mx my ku ln mz na kw lr nb nc ky nd bi translated">清单 2:为每个区的犯罪数量创建数据集</h2><pre class="md me mf mg gt ne nf ng nh aw ni bi"><span id="b581" class="ms kj it nf b gy nj nk l nl nm">ods graphics / reset width=6.4in height=4.8in;<br/>proc sgmap plotdata=WORK.NYC_CRIME_DIM;<br/>openstreetmap;<br/>title ‘Number of crimes in NYC Boroughs’;<br/>bubble x=Longitude y=Latitude size=count/ group=Borough datalabel=count<br/>datalabelpos=center<br/>datalabelattrs = (color=CX0f0e0e size=7pt weight=bold)<br/>name=”bubblePlot”;<br/>keylegend “bubblePlot” / title = ‘Borough’ ;<br/>run;<br/>ods graphics / reset;<br/>title;</span></pre><p id="b7b0" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">SAS Studio 功能强大，因为它提供了两种类型的底图:OpenStreetMap 和 Esri maps。现在，让我们尝试另一种底图类型。如图 3–48 所示，返回数据选项卡，选择 Esri maps，然后单击运行。输出图如图 7 所示。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/e79bfc009b1484053ed23ac4b008a64b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*edy9BMORVGWOy52PqndaYw.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">图 7:使用 Esri maps 的地图(图片由作者提供)</p></figure><p id="cea8" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">SAS Studio 将为这个 Esri 地图选项生成清单 3 中的代码。</p><h2 id="0464" class="ms kj it bd kk mt mu dn ko mv mw dp ks lj mx my ku ln mz na kw lr nb nc ky nd bi translated">清单 3:使用 Esri Map 生成地图</h2><pre class="md me mf mg gt ne nf ng nh aw ni bi"><span id="78ec" class="ms kj it nf b gy nj nk l nl nm">ods graphics / reset width=6.4in height=4.8in;<br/>proc sgmap plotdata=WORK.NYC_CRIME_DIM;<br/>esrimap url= ‘http://server.arcgisonline.com/arcgis/rest/services/<br/>World_Street_Map/MapServer’;<br/>title ‘Number of crimes in NYC Boroughs’;<br/>bubble x=Longitude y=Latitude size=count / group=Borough<br/>datalabel=count datalabelpos=center<br/>datalabelattrs=(color=CX0f0e0e size=7pt weight=bold)<br/>name=”bubblePlot”;<br/>keylegend “bubblePlot” / title =’Borough’;<br/>run;<br/>ods graphics / reset;<br/>title;</span></pre><h1 id="953c" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">结论</h1><p id="12fc" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如您所见，通过输入 SAS studio clean 数据集，您可以在地图上叠加数据，而无需编写任何代码。事实上，SAS Studio 会生成代码供您编辑，这太棒了。如果你试图用其他编程语言来完成同样的任务，那将会令人望而生畏。我强烈推荐数据科学新手使用 SAS Studio。</p><h1 id="6d94" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">参考</h1><p id="261b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">[1] NYPD 投诉数据当前，<a class="ae lw" href="https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Current-Year-To-Date-/5uac-w243/data" rel="noopener ugc nofollow" target="_blank">https://Data . cityofnewyork . us/Public-Safety/NYPD-Complaint-Data-Current-Year-Date-/5uac-w243/Data</a>，NYC 开放数据项目。(条款:【https://www1.nyc.gov/home/terms-of-use.page】T2)</p></div></div>    
</body>
</html>