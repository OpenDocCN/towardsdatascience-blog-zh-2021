<html>
<head>
<title>Making Python Packages Part 2: How to Publish &amp; Test Your Package on PyPI with Poetry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">制作 Python 包第 2 部分:如何用诗歌在 PyPI 上发布和测试您的包</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/packages-part-2-how-to-publish-test-your-package-on-pypi-with-poetry-9fc7295df1a5?source=collection_archive---------5-----------------------#2021-12-02">https://towardsdatascience.com/packages-part-2-how-to-publish-test-your-package-on-pypi-with-poetry-9fc7295df1a5?source=collection_archive---------5-----------------------#2021-12-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d12f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Python 诗歌项目指南</h2></div><p id="9afd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本指南的上一版中，我们使用传统的 setup.py 发布了一个 python 包给 PyPI。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/e8c8d72ab8060a10dd9bf5c7ab5c1e6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X51jYPje7rn5j8kUiP1_7A.jpeg"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">照片由<a class="ae lb" href="https://unsplash.com/@christinhumephoto?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">克里斯汀·休姆</a>在<a class="ae lb" href="https://unsplash.com/s/photos/computer-digital?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="784e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它需要一个奇怪的 Manifest.in 文件，没有附带任何测试，我们甚至没有用 requirements.txt 讨论<strong class="kh ir">依赖管理</strong>，为什么？因为 2021 年不是这样，我的朋友们。</p><p id="5823" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">依赖管理</strong>是关于你的包使用的 Python 库。如果您导入 numpy 并使用它的类/函数，您的包将依赖于 numpy 的<strong class="kh ir">版本</strong>。</p><p id="70fe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果一个新版本的 numpy 使用了不同的语法或者去掉了一个函数，那么你的包就不能在那个版本的 numpy 上工作。我们需要跟踪您使用的版本。</p><p id="1897" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者，如果您使用 numpy 和 pandas，并且它们都依赖于其他某个库的不同版本，该怎么办？谁来记录这些事情？！</p><p id="0b5b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">诗歌会。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="d57b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">poem 是一个 Python 库，我们可以使用它来创建一个包，更容易地将其发布到 PyPI，它将为我们处理<strong class="kh ir">依赖管理</strong>。耶！</p><p id="e872" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要开始，我们只需安装诗歌</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="7930" class="me mf iq ma b gy mg mh l mi mj">pip install poetry</span></pre><p id="d6d5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">和往常一样，如果您没有 pip，请尝试 pip 3(python 3 的版本)。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="703e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">新诗</strong></p><p id="ff0b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的第一个命令是创建目录。当我们有诗的时候，在我们项目的开始没有 mkdir。</p><p id="c98b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">真的，在你这样做之前不要为你的项目创建一个目录，因为 poems 会用你的项目名创建一个目录，把所有的东西都放在里面<strong class="kh ir">包括一个也是以你的项目命名的子目录，源代码就放在那里。</strong></p><p id="5115" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以，如果你为你的项目做一个目录，并在那里这样做，你会得到一个俄罗斯娃娃的情况:我的包/我的包/我的包/yikes。</p><p id="4957" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">相反，只需转到所有包所在的目录(这样当您运行 ls 时，就可以看到您的其他项目)，然后运行:</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="cabe" class="me mf iq ma b gy mg mh l mi mj">poetry new</span></pre><p id="8d3b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在你可以看到你的诗歌目录及其所有部分，包括最重要的<strong class="kh ir"> pyproject.toml. </strong></p><p id="0841" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以开始建立一个诗歌包了！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="6cad" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">虚拟环境</p><p id="1838" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但首先，快速绕道一下诗歌作为虚拟环境是如何工作的。</p><p id="c934" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">虚拟环境是一个孤立的数字环境，其中的库、代码和解释程序与计算机上的其他程序完全分离。</p><p id="6499" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你进入一个数字环境并试图导入 numpy，它将不会存在，因为它没有安装在那个数字环境中。</p><p id="c2a4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">相反，如果你在数字环境中安装了一个库，它就不会安装在你电脑的其他部分。</p><p id="f3cb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本质上，环境中可用的库都存储在该环境中的某个目录中。虚拟环境使用自己的可用库目录，因此它与计算机的可用库目录没有关系。</p><p id="8484" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们运行新诗时，我们创建了一个虚拟环境！当我们在诗歌目录中从命令行运行代码时，我们在虚拟环境中是<strong class="kh ir">而不是</strong>。但是，如果我们用</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="5ae2" class="me mf iq ma b gy mg mh l mi mj">poetry run the-rest-of-the-command</span></pre><p id="2a62" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以在诗歌环境中运行这个命令。</p><p id="21f0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者，如果我们跑了</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="2e0e" class="me mf iq ma b gy mg mh l mi mj">poetry shell</span></pre><p id="b73d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们将进入我们的诗歌文件夹的虚拟环境，在那里我们可以使用我们将通过诗歌安装的库。</p><p id="b880" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用 ctrl+d 退出虚拟外壳。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="f5f4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">诗歌添加</strong></p><p id="909e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">事实上，让我们看看如何安装带有诗歌的库，这将很好地管理我们的依赖性。</p><p id="d757" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们进入我们创建的 pyproject.toml。它将包含两个主要内容:</p><ol class=""><li id="8679" class="mk ml iq kh b ki kj kl km ko mm ks mn kw mo la mp mq mr ms bi translated">我们项目的文档(嗯，包括引用自述文件和许可证)。我们将在完成图书馆事务后回到文档上。</li><li id="219a" class="mk ml iq kh b ki mt kl mu ko mv ks mw kw mx la mp mq mr ms bi translated">我们的包需要的库版本的范围</li></ol><p id="c4e7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们制作包时，我们需要告诉 poems 我们使用的是什么版本的库。这个命令很简单:</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="1e37" class="me mf iq ma b gy mg mh l mi mj">poetry add library-name</span></pre><p id="af1d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其中 library-name 是我们正在使用的任何库的名称，比如 numpy。</p><p id="76cf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该命令会将库版本添加到我们的 pyproject.toml 中。它实际上是一系列遵循语义版本化的版本。你可以在这里看到语法:【https://classic.yarnpkg.com/en/docs/dependency-versions/<a class="ae lb" href="https://classic.yarnpkg.com/en/docs/dependency-versions/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="9e7f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它还会在我们的诗歌虚拟环境中安装库。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="82b7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">poem . lock</strong></p><p id="085b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您<strong class="kh ir">poems 添加</strong>一个库，这也将<strong class="kh ir">安装</strong>那个库，您不仅会看到您的 pyproject.toml 自动更新——您还会获得一个新文件:poetry.lock。</p><p id="03bb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">pyproject.toml 记录了您的包可接受的库版本的范围，并且只列出了您用 poeties add 直接添加的库。</p><p id="9d71" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一方面，poetry.lock 记录了安装在您的包中的<strong class="kh ir">确切的库版本</strong>。它包括你的依赖项需要的每一个库。</p><p id="6813" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以如果你把<strong class="kh ir">诗加上 seaborn，</strong></p><p id="52c2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当你的 pyproject.toml 得到 seaborn 的时候，</p><p id="97cf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你的诗。锁将获得:</p><p id="70d6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="my"> atomicwrites、attrs、colorama、cycler、fonttools、kiwisolver、matplotlib、more-itertools、numpy、packaing、pandas、pillow、pluggy、py、pyparsing、pytest、pytz、scipy、setuptools-scm、six、tomli、wcwidth、</em> <strong class="kh ir"> <em class="my">和 seaborn </em> </strong></p><p id="9554" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为这是 seaborn 所依赖的每一个库，加上每一个库所依赖的每一个库，递归地直到 seaborn 所需要的每一个库都有它所需要的库。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="b0af" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">关于他人使用你的源代码的旁注</strong></p><p id="f010" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，如果有人从 github 克隆了你的包，他们会有你的 pyproject.toml，但是还没有安装你的库。他们需要逃跑</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="c5ad" class="me mf iq ma b gy mg mh l mi mj">poetry install</span></pre><p id="3907" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果他们也有你的 poetry.lock，他们将安装你的 poetry.lock 中声明的精确版本。</p><p id="6505" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果他们没有你的 poetry.lock，那么 poem 会为你做它做过的事情——找出要安装的编写版本，并将其写入 poetry.lock。</p><p id="b77e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">总的来说，poetry.lock 列出了一个包运行时安装的所有精确的库版本，这样你的包的用户就可以使用所有东西的相同版本。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="be86" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">用 pyproject.toml 进行项目描述</strong></p><p id="5620" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好的，那么我将尽快跳到 PyPI 发布，我们只需要在这里对我们的包文档稍微好一点。</p><p id="d6fb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">pyproject.toml 顶部的那个部分将包含 setup.py 在传统打包方法中包含的所有内容，没有诗意。</p><p id="4281" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">pyproject.toml 的顶部应该是这样的:</p><p id="81be" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">pyproject.toml</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="ac7a" class="me mf iq ma b gy mg mh l mi mj">[tool.poetry]</span><span id="c8e8" class="me mf iq ma b gy mz mh l mi mj">name = “” #your package name</span><span id="be1b" class="me mf iq ma b gy mz mh l mi mj">version = “0.0.1”</span><span id="eda7" class="me mf iq ma b gy mz mh l mi mj">description = “” #a short description of your package that will be used in PyPI search</span><span id="a315" class="me mf iq ma b gy mz mh l mi mj">authors = [“your-name &lt;your-email&gt;”]</span><span id="b738" class="me mf iq ma b gy mz mh l mi mj">license = “MIT”</span><span id="b498" class="me mf iq ma b gy mz mh l mi mj">readme = “README.md”</span><span id="47f4" class="me mf iq ma b gy mz mh l mi mj">homepage = “” #can be the repo</span><span id="49c2" class="me mf iq ma b gy mz mh l mi mj">repository = “”</span><span id="a8ff" class="me mf iq ma b gy mz mh l mi mj">keywords = [“test”, “dependencies”, “documentation”]</span><span id="90d0" class="me mf iq ma b gy mz mh l mi mj">classifiers = [</span><span id="162c" class="me mf iq ma b gy mz mh l mi mj">“Development Status :: 5 — Production/Stable”,</span><span id="f4be" class="me mf iq ma b gy mz mh l mi mj">“Intended Audience :: Education”,</span><span id="6f52" class="me mf iq ma b gy mz mh l mi mj">“Operating System :: MacOS”,</span><span id="5ad5" class="me mf iq ma b gy mz mh l mi mj">“License :: OSI Approved :: MIT License”,</span><span id="2167" class="me mf iq ma b gy mz mh l mi mj">“Programming Language :: Python :: 3”,</span><span id="4239" class="me mf iq ma b gy mz mh l mi mj">]</span><span id="8080" class="me mf iq ma b gy mz mh l mi mj">include = [</span><span id="c3fe" class="me mf iq ma b gy mz mh l mi mj">“LICENSE”,</span><span id="e178" class="me mf iq ma b gy mz mh l mi mj">]</span></pre><p id="0c9d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">继续把它复制到你的 toml 中并更新字段:填写你的名字和电子邮件，项目名称和版本，简短描述，回购/主页，并使用这里的选项填写这些分类器:<a class="ae lb" href="https://pypi.org/pypi?%3Aaction=list_classifiers" rel="noopener ugc nofollow" target="_blank">https://pypi.org/pypi?%3Aaction=list_classifiers</a></p><p id="d2e9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如您所见，我们引用的是 README.md，所以如果您愿意，可以将 README.rst 更改为 md (markdown)文件。您将把包含变更日志的长项目描述放在那个<strong class="kh ir"> README.md </strong>中，因此它看起来像这样:</p><p id="72fb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">README.md</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="b7fd" class="me mf iq ma b gy mg mh l mi mj">My long description blah blah blah blah.</span><span id="8b3e" class="me mf iq ma b gy mz mh l mi mj">Change Log</span><span id="27d8" class="me mf iq ma b gy mz mh l mi mj"><strong class="ma ir">================</strong></span><span id="b7da" class="me mf iq ma b gy mz mh l mi mj">0.0.1 (Dec 1, 2021)</span><span id="197e" class="me mf iq ma b gy mz mh l mi mj"><strong class="ma ir"> — — — — — — — — — — — — — — — -</strong></span><span id="f149" class="me mf iq ma b gy mz mh l mi mj">- First Release</span><span id="94ea" class="me mf iq ma b gy mz mh l mi mj">0.0.2 (Dec 2, 2021)</span><span id="f167" class="me mf iq ma b gy mz mh l mi mj"><strong class="ma ir"> — — — — — — — — — — — — — — — -</strong></span><span id="04a7" class="me mf iq ma b gy mz mh l mi mj">- Did some more stuff</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="c22f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">发布到 PyPI </strong></p><p id="182a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好了，我们开始吧。我将跳到有趣的部分，然后我将回头提供一些提示。</p><p id="d920" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可以一行发布到 PyPI。在您使用以下工具设置一次您的凭证后:</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="3454" class="me mf iq ma b gy mg mh l mi mj">poetry config http-basic.pypi username password</span></pre><p id="3670" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些是你在 pypi.org 的证件，你可以在他们的网页上注册账户。</p><p id="6fdc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在您设置了这些凭证之后，下面是一行 publish:</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="056e" class="me mf iq ma b gy mg mh l mi mj">poetry publish --build my_package</span></pre><p id="5684" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你就这样在 PyPI 上！</p><p id="6c28" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有一个单独的诗歌构建命令，但是您可以在发布的同时使用构建标志(— build)进行构建。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="2c03" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">对测试 PyPI 的测试</strong></p><p id="5fa5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是也许在我们把半成品包扔给 PyPI 之前，我们可以在 PyPI 的测试版本上测试它。</p><p id="5875" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个测试 PyPI 将允许我们模拟对 PyPI 的更新，然后 pip 安装我们自己的包，看看它是否像预期的那样工作。</p><p id="8fc7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样做的第一步是在 test.pypi.org 上创建一个新帐户(是的，你需要一个与你的 pypi 帐户不同的帐户，但是它可以有相同的用户名)。</p><p id="2442" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，您可以将存储库添加到诗歌中:</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="3e1b" class="me mf iq ma b gy mg mh l mi mj">poetry config repositories.testpypi https://test.pypi.org/legacy/</span></pre><p id="f6bf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">发布到存储库:</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="ebad" class="me mf iq ma b gy mg mh l mi mj">poetry publish –-build -r testpypi</span></pre><p id="bd45" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">pip 从存储库中安装您包:</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="3df1" class="me mf iq ma b gy mg mh l mi mj">pip install --index-url <a class="ae lb" href="https://test.pypi.org/simple/" rel="noopener ugc nofollow" target="_blank">https://test.pypi.org/simple/</a> my_package</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="df34" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">侧栏:pip 安装故障排除</strong></p><p id="656a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您遇到问题，这个更长的命令行功能可以解决一些常见问题:</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="daa3" class="me mf iq ma b gy mg mh l mi mj">python3 -m pip install -i <a class="ae lb" href="https://test.pypi.org/simple/" rel="noopener ugc nofollow" target="_blank">https://test.pypi.org/simple/</a> — extra-index-url <a class="ae lb" href="https://pypi.org/simple" rel="noopener ugc nofollow" target="_blank">https://pypi.org/simple</a> my_package==0.0.1</span></pre><p id="24d2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">pip 之前的 python -m 是为了确保您使用的是正确的 pip 版本。您也可以尝试查看您的 pip 版本和 python 版本</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="b5f6" class="me mf iq ma b gy mg mh l mi mj">which pip<br/>which python<br/>pip --version<br/>python --version </span></pre><p id="70b8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者更新画中画</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="6d0b" class="me mf iq ma b gy mg mh l mi mj"> python -m pip install --upgrade pip</span></pre><p id="9542" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">和往常一样，你可能需要用 python3 切换 python，或者用 pip3 切换 pip。</p><p id="d69a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">额外的索引 url 指向普通的 PyPI repo(而不是测试)，您的依赖项需要从这里下载。</p><p id="1cc9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我还添加了版本，您应该用您的包版本号替换它，以便它得到正确的版本号。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="1f7e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">在新的虚拟环境中安装和导入</strong></p><p id="25d1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当您尝试 pip 安装时，我将进入一个新的虚拟环境，这样您的软件包模块名称就不会与我们所在的目录名称混淆，该目录也称为您的软件包名称。</p><p id="3f86" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我喜欢直接进入我的顶级项目目录，用 poems new 创建一个新目录，用</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="a4b1" class="me mf iq ma b gy mg mh l mi mj">poetry shell</span></pre><p id="ef7b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">pip 从测试 PyPI 安装它。</p><p id="8556" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我在虚拟环境中运行 python 解释器</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="71ad" class="me mf iq ma b gy mg mh l mi mj">poetry run python</span></pre><p id="8909" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，用 Python 导入您的包和函数！你可以先试试:</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="9729" class="me mf iq ma b gy mg mh l mi mj">import my_package</span></pre><p id="8ded" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，尝试导入您的函数。如果它们在 __init__ 中。py 您可以直接导入它们，如</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="5d8b" class="me mf iq ma b gy mg mh l mi mj">from my_package import my_function</span></pre><p id="d112" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者它们是否在与 __init__ 相同级别的文件中。py，您将指定不带。py 来获取它的模块名。比如 utils.py 就叫 utils。</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="5c02" class="me mf iq ma b gy mg mh l mi mj">from my_package.my_module import my_function</span></pre><p id="a813" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果在那个级别有一个文件夹。py 文件，通过添加 __init__，将该文件夹变成一个包。也复制到那个文件夹。初始化文件可以是空的。</p><p id="2b28" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以如果</p><ol class=""><li id="fd7a" class="mk ml iq kh b ki kj kl km ko mm ks mn kw mo la mp mq mr ms bi translated">我的 _ 包是整个库，</li><li id="c915" class="mk ml iq kh b ki mt kl mu ko mv ks mw kw mx la mp mq mr ms bi translated">my_package 文件夹中是 my_subpackage 文件夹，它包含。py 文件和 init 文件，</li><li id="0b44" class="mk ml iq kh b ki mt kl mu ko mv ks mw kw mx la mp mq mr ms bi translated">my_subpackage 文件夹中是 my_module.py</li><li id="3c97" class="mk ml iq kh b ki mt kl mu ko mv ks mw kw mx la mp mq mr ms bi translated">在 my_module.py 中存放着我的 _function，</li></ol><p id="37f6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">应该是:</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="2d11" class="me mf iq ma b gy mg mh l mi mj">from my_package.my_subpackage.my_module import my_function</span></pre><p id="67b1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您还可以使用以下命令检查导入的模块中有哪些函数:</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="44fa" class="me mf iq ma b gy mg mh l mi mj">dir(my_package.my_module)</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="e748" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">奖励:用诗歌更新更新所有依赖关系</strong></p><p id="17d1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为什么总有关于更新东西的加分部分？</p><p id="32e2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">总之，为了更新所有的库(依赖项)并将它们写入您的 poetry.lock，您运行:</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="c023" class="me mf iq ma b gy mg mh l mi mj">poetry update</span></pre><p id="dcd5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不要把它和<strong class="kh ir">更新诗歌、</strong>混淆，后者可以通过</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="c1b9" class="me mf iq ma b gy mg mh l mi mj">pip install --upgrade poetry</span></pre><p id="2fac" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者</p><pre class="ld le lf lg gt lz ma mb mc aw md bi"><span id="9781" class="me mf iq ma b gy mg mh l mi mj">poetry self update</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="bce6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢阅读！</p><p id="b8e3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请关注我，了解更多关于 Python 和数据科学的知识！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="696b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">查看本指南的第 1 部分，学习如何用传统的方式向 PyPI 发布 setup.py，一些其他的技巧，再加上一些幽默。那天我运气很好:</p><div class="na nb gp gr nc nd"><a href="https://medium.com/@skylar.kerzner/publish-your-first-python-package-to-pypi-8d08d6399c2f" rel="noopener follow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd ir gy z fp ni fr fs nj fu fw ip bi translated">包第 1 部分:如何将 Python 包发布到 PyPI</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">嘿！欢迎阅读这份关于如何将 python 包发布到 PyPI 的快速、有趣的指南。</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">medium.com</p></div></div><div class="nm l"><div class="nn l no np nq nm nr lm nd"/></div></div></a></div></div></div>    
</body>
</html>