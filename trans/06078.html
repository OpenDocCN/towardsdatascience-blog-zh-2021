<html>
<head>
<title>Working with OpenStreetMap Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用OpenStreetMap数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/working-with-openstreetmap-data-37da18d55822?source=collection_archive---------30-----------------------#2021-05-31">https://towardsdatascience.com/working-with-openstreetmap-data-37da18d55822?source=collection_archive---------30-----------------------#2021-05-31</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="a10e" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">如何使用开放数据进行商业洞察</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/cd6917a43253d40c1ae973905c1cef80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qMySlsUB9vtk9KPLjxLZ3g.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">乔伊·孙约在<a class="ae kz" href="https://unsplash.com/s/photos/map?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="233a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本演练中，我将使用BigQuery中的OpenStreetMap数据。谷歌在他们的公共数据集中免费发布，这太棒了。所以你可以用SQL [1]轻松查询地理信息。谷歌上传了一次他们的数据集，但没有任何更新。如果您需要更新的数据，那么OpenStreetMap API结合一些简单的python代码可能是您的问题的一个可能的解决方案。</p><h2 id="b5a7" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">OpenStreetMap的用例</h2><p id="5580" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">OpenStreetMap.org是一个国际项目，成立于2004年，目标是创建一个免费的世界地图。为此，我们收集了世界范围内的公路、铁路、河流、森林、房屋等数据。</p><p id="cbb7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">虽然来自OpenStreetMap的数据是免费的，但你可以很好地得出一定的商业优势。我帮助开发或至少参与开发的一些示例如下:</p><ul class=""><li id="a5fc" class="mu mv iu lc b ld le lg lh lj mw ln mx lr my lv mz na nb nc bi translated">地理分析(我的客户在哪里？)</li><li id="3cc3" class="mu mv iu lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">市场分析(我的竞争对手在哪里有门店？)</li><li id="0f8c" class="mu mv iu lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">旅游优化(如何优化物流路线？)</li><li id="ae5c" class="mu mv iu lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">欺诈检测(运输发票是否合理？)</li><li id="b9c0" class="mu mv iu lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">还有更多</li></ul><h2 id="e9c9" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">什么是嵌套数据？</h2><p id="b429" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">从BigQuery数据集中查询数据将返回嵌套的数据字段。BigQuery支持从支持基于对象的模式(例如JSON)的源格式中加载和查询嵌套和循环数据。下面是嵌套数据的简短说明:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj ni"><img src="../Images/089c04f94b84bef1f62bb77a8c78f00b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/0*3vn8n-YCoD1sXZJA.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">嵌套和重复数据的图示-按作者分类的图像</p></figure><p id="b43d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">地址列包含一个值数组。数组中的不同地址是重复出现的数据。每个地址中的不同字段是嵌套数据。</p><h2 id="14c7" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">真实的例子</h2><p id="d068" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">对于使用BigQuery的示例演练，我在<em class="nj"> geo_openstreetmap </em>数据集<em class="nj">中使用了开放数据集<em class="nj"> planet_features </em>。</em>在这里，数据是以嵌套格式存储的，所以我们来看看:</p><pre class="kk kl km kn gu nk nl nm nn aw no bi"><span id="14bb" class="lw lx iu nl b gz np nq l nr ns">SELECT * FROM `bigquery-public-data.geo_openstreetmap.planet_features` LIMIT 1000</span></pre><p id="5da5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这是以下输出中的结果:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nt"><img src="../Images/c866692a4097fc16742523f957484163.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-MZAFKhodHNVf1df.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">输出—按作者分类的图像</p></figure><p id="30a6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">结果乍一看还不错。与传统的关系数据库不同，我可以使用数组并保存额外的列。此外，整件事的效果非常好。现在，我想在德国找一家超市，应该使用简单的where子句，对吗？差不多了。在这里，你需要<strong class="lc iv"> <em class="nj"> Unnest、</em> </strong>的魔力</p><pre class="kk kl km kn gu nk nl nm nn aw no bi"><span id="56ff" class="lw lx iu nl b gz np nq l nr ns">SELECT * <br/>FROM   `bigquery-PUBLIC-   data.geo_openstreetmap.planet_features` <br/>WHERE  'Netto' IN <br/>       ( <br/>              SELECT value <br/>              FROM   unnest(all_tags)) <br/>AND    ( <br/>              'addr:country', 'DE') IN <br/>       ( <br/>              SELECT (KEY, value) <br/>              FROM   unnest(all_tags)) <br/>AND    ( <br/>              'addr:city', 'Hamburg') IN <br/>       ( <br/>              SELECT (KEY, value) <br/>              FROM   unnest (all_tags));</span></pre><p id="d3b5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这导致了期望的输出:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nu"><img src="../Images/6ced6e00885fe7f2f8ce411733e79d5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uVSPQCdMG_c8E-PL.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">输出—按作者分类的图像</p></figure><p id="1bcc" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">利用<strong class="lc iv"> <em class="nj">功能，您还能够</em> </strong> <em class="nj"> </em>展平<strong class="lc iv">数据并由此输出查询结果:</strong></p><pre class="kk kl km kn gu nk nl nm nn aw no bi"><span id="b89b" class="lw lx iu nl b gz np nq l nr ns">SELECT osm_id,tags<br/>FROM bigquery-public-data.geo_openstreetmap.planet_features,<br/>UNNEST(all_tags) as tags limit 100</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nv"><img src="../Images/23d8871d7c699be59715dad9c3b3ea61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Tc0jT4TF1uKp_gp3.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">拼合数据—按作者排列的图像</p></figure><p id="992e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当在BigQuery中处理嵌套数据并想要查询一些数据时，这可能是您必须知道的最重要的事情。但是，如果您想将数据用于进一步的ETL过程，将数据存储在关系数据库中，或者需要键值对作为分类器的属性，该怎么办呢？这里，您不希望数据变平，因为这将导致重复的行，这里您希望数组中的键值对作为新列:</p><pre class="kk kl km kn gu nk nl nm nn aw no bi"><span id="1b65" class="lw lx iu nl b gz np nq l nr ns">SELECT<br/>       (<br/>              SELECT osm_id) osmid,<br/>       (<br/>              SELECT value<br/>              FROM   unnest(all_tags)<br/>              WHERE  KEY = "Address") AS address,<br/>       (<br/>              SELECT value<br/>              FROM   unnest(all_tags)<br/>              WHERE  KEY = "name") AS name,<br/>       (<br/>              SELECT value<br/>              FROM   unnest(all_tags)<br/>              WHERE  KEY = "opening_hours") AS opening_hours,<br/>       (<br/>              SELECT value<br/>              FROM   unnest(all_tags)<br/>              WHERE  KEY = "organic") AS organic,<br/>       (<br/>              SELECT geometry) AS geometry,<br/>FROM   bigquery-public-data.geo_openstreetmap.planet_features<br/>WHERE  (<br/>              'Edeka' IN<br/>              (<br/>                     SELECT value<br/>                     FROM   unnest(all_tags))<br/>       OR     'Rewe' IN<br/>              (<br/>                     SELECT value<br/>                     FROM   unnest(all_tags))<br/>       OR     'Netto' IN<br/>              (<br/>                     SELECT value<br/>                     FROM   unnest(all_tags)))<br/>AND    (<br/>              'addr:country', 'DE') IN<br/>       (<br/>              SELECT (KEY, value)<br/>              FROM   unnest(all_tags)) -<br/>AND    (<br/>              'addr:city', 'Hamburg') IN<br/>       (<br/>              SELECT (KEY, value)<br/>              FROM   unnest(all_tags));</span></pre><p id="b33c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这给了我们输出:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nw"><img src="../Images/e52b117a0a9db607a841ad368b871eb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UUcvF-gvCePYcxzW.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">嵌套和重复出现的列数据—按作者分类的图像</p></figure><p id="ed17" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最后，您可以通过Google Data Studio等商业智能工具来可视化数据——尤其是在使用BigQuery时。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nx"><img src="../Images/db2a91fd5f3d9dc8da0bb936b24e9577.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OCYSos0-bZU-9M8w"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">用于可视化地理数据的Google Data Studio按作者分类的图片</p></figure><p id="154c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在相关的用例中，数据也显示在地图上，以了解商店的分布情况。在仪表板中，一个底层表格也提供了更接近的见解。为了进行更深入的分析，这些数据还被用于即将到来的客户细分场景。</p><h2 id="98c1" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">结论</h2><p id="b738" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">除了OpenStreetMap API和Googles的公共数据集之外，你还可以找到更多的数据集用于你的分析。在这里，我推荐谷歌数据集搜索网站:<a class="ae kz" href="https://datasetsearch.research.google.com/" rel="noopener ugc nofollow" target="_blank">https://www.google.com/publicdata/directory</a></p><p id="5b84" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">BigQuery等新系统通过基于列的数据库提供了极高的计算能力和快速的结果。通过上面的例子，您应该能够很好地查询和处理大多数嵌套数据用例。有了免费数据和计算能力，您可以实现许多有利可图的用例。作为第一步，我建议简单地处理数据。使用Google Cloud免费层，你可以相对容易地做到这一点。</p><h2 id="89fb" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">资料来源和进一步阅读</h2><p id="afb8" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">[1]谷歌，<a class="ae kz" href="https://console.cloud.google.com/marketplace/details/openstreetmap/geo-openstreetmap" rel="noopener ugc nofollow" target="_blank"> OpenStreetMap公共数据集</a></p><p id="dc88" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">[2] OpenStreetMap，【https://www.openstreetmap.de/ T4】(2021)</p><p id="272e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">[3]谷歌，<a class="ae kz" href="https://cloud.google.com/free" rel="noopener ugc nofollow" target="_blank">在谷歌云上解决真正的商业挑战</a> (2021年)</p></div></div>    
</body>
</html>