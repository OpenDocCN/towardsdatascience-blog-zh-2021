<html>
<head>
<title>Apple’s M1 Pro and M1 Max Outperform Google Colab by up to 54%</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">苹果的 M1 Pro 和 M1 Max 超过谷歌 Colab 高达 54%</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/apples-m1-pro-and-m1-max-outperform-google-colab-by-up-to-54-cbf13c8b6357?source=collection_archive---------1-----------------------#2021-12-06">https://towardsdatascience.com/apples-m1-pro-and-m1-max-outperform-google-colab-by-up-to-54-cbf13c8b6357?source=collection_archive---------1-----------------------#2021-12-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2c0e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">2021 苹果 M1 Pro 和 M1 Max 机器学习速度测试对比</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ecb9c75d9940f8f5c7f34245681f49e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nqzluwfIM40Mu1ost7czEQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">标志性的绿色充电灯又回来了。作者照片。</p></figure><p id="2eb3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我使用的主键盘连接在 MacBook Pro 上。我在 MacBook Pro 上打这个。</p><p id="ca79" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为一个技术呆子，当苹果发布了几款升级了硬件的新 MacBook Pro:M1 Pro、M1 Max 芯片和重新设计等等，我决定，我最好测试一下。</p><p id="d9df" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于上下文，我制作关于机器学习的视频，编写机器学习代码，教授机器学习。</p><p id="0188" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这就是本文的重点。</p><p id="133f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将苹果的 M1、M1 Pro 和 M1 Max 芯片与其他几款芯片进行对比。</p><p id="8576" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">怎么会？</p><p id="85fd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">四项测试:</p><ol class=""><li id="0927" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated"><strong class="la iu"> Final Cut Pro 导出</strong> —各种 MacBook Pro 导出 4 小时长的 TensorFlow 教学视频(我制作编码教育视频)和 10 分钟长的故事视频(使用 H.264 和 ProRes 编码)的速度有多快？</li><li id="e075" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><strong class="la iu"> CreateML 图像分类机器学习模型创建</strong> —各种 MacBook Pro 用 CreateML 把一万张图像变成一个图像分类模型能有多快？</li><li id="89b4" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><strong class="la iu"> CIFAR10 TinyVGG 图像分类与 tensor flow(via</strong><code class="fe mi mj mk ml b"><strong class="la iu">tensorflow-macos</strong></code><strong class="la iu">)</strong>——多亏了<code class="fe mi mj mk ml b">tensorflow-metal</code>，你现在可以利用你的 MacBook 的内部 GPU 来加速机器学习模型训练。这个和小一点的模型配起来怎么样？</li><li id="4e56" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><strong class="la iu"> Food101 EfficientNetB0 用</strong> <code class="fe mi mj mk ml b"><strong class="la iu">tensorflow-macos</strong></code>进行特征提取——我很少从零开始训练机器学习模型。那么，新的 M1 Pro 和 M1 Max 芯片如何利用 TensorFlow 代码进行迁移学习呢？</li></ol><p id="d8f3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本文严格关注性能。对于设计、输入、输出、电池寿命，还有很多其他资源。</p><h1 id="4d79" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">硬件规格</h1><p id="1edf" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">我目前使用基于英特尔的 16 英寸 MacBook Pro 作为我的主机(几乎总是插着电源)，2020 年的 13 英寸 M1 MacBook Pro 作为随身携带的选项。</p><p id="623a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了训练更大的机器学习模型，我使用谷歌 Colab、谷歌云 GPU 或 SSH(通过互联网连接)连接到一台配备泰坦 RTX GPU 的专用深度学习 PC。</p><p id="764f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于 TensorFlow 代码测试，我包括了与 Google Colab 和泰坦 RTX GPU 的比较。</p><p id="8bce" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里的规格主要是基于英特尔的 MacBook Pro、M1、M1 Pro 和 M1 Max。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">测试中 Mac 机型的不同硬件规格。</p></figure><p id="6187" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在每项测试中，所有的 MacBook Pro 都运行 macOS Monterey 12.0.1，并接通了电源。</p><h1 id="373e" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">实验 1: Final Cut Pro 导出(小视频和大视频)</h1><p id="53f9" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">我制作 YouTube 视频和教授机器学习的教育视频。</p><p id="9615" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以我用的机器必须能快速渲染和导出。这是我购买 2019 年 16 英寸 MacBook Pro 规格的主要原因之一，这样我就可以毫无延迟地编辑视频。</p><p id="8d03" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，M1 专业和 M1 最大芯片是针对专业人士。他们中的许多人编辑视频的质量比我高得多(目前)。</p><p id="b355" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于每个视频，我都将其导出为<a class="ae nl" href="https://en.wikipedia.org/wiki/Advanced_Video_Coding" rel="noopener ugc nofollow" target="_blank"> H.264 </a>编码(更高的压缩率，更多的 GPU 密集型)和<a class="ae nl" href="https://en.wikipedia.org/wiki/Apple_ProRes" rel="noopener ugc nofollow" target="_blank"> ProRes </a>编码(更低的压缩率，更少的 CPU 和 GPU 密集型)。</p><p id="13d2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是因为苹果公司声明，新的 M1 芯片有专门的 ProRes 引擎。</p><h2 id="78df" class="nm mn it bd mo nn no dn ms np nq dp mw lh nr ns my ll nt nu na lp nv nw nc nx bi translated">大型视频</h2><p id="200c" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">实验详情:</p><ul class=""><li id="aa35" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt ny ma mb mc bi translated"><strong class="la iu">视频:</strong> <a class="ae nl" href="https://youtu.be/ZUKz4125WNI" rel="noopener ugc nofollow" target="_blank">学习 TensorFlow 进行深度学习第二部分</a></li><li id="25d1" class="lu lv it la b lb md le me lh mf ll mg lp mh lt ny ma mb mc bi translated"><strong class="la iu">时长:</strong> 4 小时</li><li id="1ee0" class="lu lv it la b lb md le me lh mf ll mg lp mh lt ny ma mb mc bi translated"><strong class="la iu">风格:</strong>拼接在一起的 30 倍屏幕录像短片(每部约 10 分钟)</li><li id="c640" class="lu lv it la b lb md le me lh mf ll mg lp mh lt ny ma mb mc bi translated"><strong class="la iu">质量:</strong> 1080p</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="6d9b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有趣的是，当使用 H.264 编码时，新的 M1s (Pro 和 Max)占用的时间是基本 M1 的两倍，是基于英特尔的 Mac 的近四倍。</p><p id="2849" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">还应该注意的是，在使用 H.264 编码时，M1 Pro(约 89%空闲)和 M1 Max(约 68%空闲)上都有大量硬件处于空闲状态。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/160de546defcbb8a0487b02a696f81d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1-KuKfW9Oj9EqpJFbg0qOg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在导出到 H.264 编码时，M1 Pro 和 M1 Max 上的大量硬件被闲置。我不确定这是什么原因造成的。但这确实解释了为什么与其他 MAC 相比，它们的出口时间如此之长。</p></figure><p id="f953" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">可能需要更新软件才能充分利用新芯片的全部功能？</p><p id="9a26" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不过，对于 ProRes 编码来说，情况就不同了。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="abfd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">ProRes 编码是较新的 M1 芯片真正闪光的地方。</p><p id="5e63" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">与 H.264 编码相比，在 M1 Pro 和 M1 Max 上导出到 ProRes 时，会占用大量 CPU 资源。或许这是来自专用的 ProRes 内核？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/5652d47df37b78d763563ab0ae9a1bff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XGay7jrfe2qQXg-tJVL6jw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">导出到 ProRes 编码时，在 M1 Max 和 M1 Pro 上可以看到大量的 CPU 使用。<strong class="bd ob">注:</strong>所有屏幕记录均与结果跟踪分开进行。</p></figure><p id="8f73" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，尽管 ProRes 编码导出比 H.264 快得多，但文件大小的差异使它对许多人来说几乎不可用。</p><p id="6a71" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将大视频导出到 H.264 时，文件大小为 7GB，导出到 ProRes 时，文件大小为 167GB。</p><p id="6786" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我不知道你的网速，但这种视频需要三四天才能上传给我。</p><h2 id="7d70" class="nm mn it bd mo nn no dn ms np nq dp mw lh nr ns my ll nt nu na lp nv nw nc nx bi translated">小视频</h2><p id="da5c" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">较小的视频产生了非常接近的结果。</p><p id="ca07" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">实验详情:</p><ul class=""><li id="79e8" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt ny ma mb mc bi translated"><strong class="la iu">视频:</strong> <a class="ae nl" href="https://youtu.be/hsQ9efb6a7c" rel="noopener ugc nofollow" target="_blank">我如何学习机器学习每周 5 天</a></li><li id="6239" class="lu lv it la b lb md le me lh mf ll mg lp mh lt ny ma mb mc bi translated">长度: 10 分钟</li><li id="c0c5" class="lu lv it la b lb md le me lh mf ll mg lp mh lt ny ma mb mc bi translated"><strong class="la iu">风格:</strong>画外音，视频剪辑编辑成语音</li><li id="166f" class="lu lv it la b lb md le me lh mf ll mg lp mh lt ny ma mb mc bi translated"><strong class="la iu">质量:</strong> 1080p</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="16f3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所有的出口时间都非常相似。</p><p id="d270" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但同样，当导出到 H.264 编码时，M1 Pro 和 M1 Max 芯片上有大量硬件闲置。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="18f8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当使用 ProRes 编码时，M1 Pro 和 M1 Max 再次大放异彩。检查活动监视器显示了大量的 CPU 使用率，M1 Pro 的使用率为 350-450%，M1 Max 的使用率为 300-500%。</p><h1 id="9087" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">实验 2: CreateML 图像分类</h1><p id="cbb5" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated"><a class="ae nl" href="https://developer.apple.com/machine-learning/create-ml/" rel="noopener ugc nofollow" target="_blank"> CreateML </a>是苹果公司制作的机器学习 app，自带 Xcode(苹果公司制作 iOS 和 macOS 应用的软件)。</p><p id="a460" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它提供了一种将数据转化为机器学习模型的简单方法。</p><p id="f336" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我之所以尝试它，是因为我和我哥哥一直在用它制作<a class="ae nl" href="https://www.nutrify.app/" rel="noopener ugc nofollow" target="_blank"> Nutrify </a>(一款拍摄食物照片并了解食物的应用程序)上的原型模型。</p><p id="a4d7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它不仅适用于我们的用例，还能生成针对苹果设备优化的训练模型。</p><p id="edc9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">实验详情:</p><ul class=""><li id="316d" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt ny ma mb mc bi translated"><strong class="la iu">数据:</strong>所有 Food101 类的随机 10%子集(~7.5k 训练图像，~2.5k 测试图像)</li><li id="d1c4" class="lu lv it la b lb md le me lh mf ll mg lp mh lt ny ma mb mc bi translated"><strong class="la iu">训练:</strong> 25 个历元，所有数据扩充设置开启</li><li id="4ba7" class="lu lv it la b lb md le me lh mf ll mg lp mh lt ny ma mb mc bi translated"><strong class="la iu">模型:</strong> CreateML powered 模型(苹果没有告诉你用的是什么架构)</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="4fa3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">再一次，M1 Pro 和 M1 Max 之间没有太大的区别。尽管它们都比其他芯片表现出色。</p><p id="45a8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在培训期间，检查 M1 专业版和 M1 最大版的活动监视器显示，在进程名称“MLRecipeExcecutionService”下有大量的 CPU 使用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/d5215072cb13a1a0a454aa30def9d8d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cV1vG9jSHJxGBsOvbp2ubw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在 CreateML 应用程序中训练模型的过程中，CPU 使用率飙升至 500%以上。GPU 根本用不上多少。也许这是 16 核神经引擎在起作用？截图摄于 M1 专业版。</p></figure><p id="70b6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">值得注意的是，在训练或特征提取期间，GPU 根本没有得到多少使用。</p><p id="3ed0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这让我相信 CreateML 使用 16 核神经引擎来加速训练。然而，这并没有得到 100%的证实，因为活动监视器并没有透露神经引擎何时启动。</p><p id="079e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在 CreateML 也没有透露使用什么样的模型。从性能来看，我猜它至少会使用预训练的 ResNet50 型号或 EfficientNetB2 以上或类似型号。</p><h1 id="c51c" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">实验三:带 TensorFlow 代码的 CIFAR10 TinyVGG 模型</h1><p id="9811" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">CreateML 工作起来很棒，但有时你会想要制作自己的机器学习模型。</p><p id="9176" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为此，您可能最终会使用 TensorFlow 这样的框架。</p><p id="8ba8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae nl" href="https://dbourke.link/tfcourse" rel="noopener ugc nofollow" target="_blank">我教 TensorFlow </a>几乎每天都要编码。所以我很期待看到新机器在这里的表现。</p><p id="b45e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于所有自定义 TensorFlow 测试，所有机器都使用相同的数据集和相同的环境设置运行相同的代码。</p><p id="3201" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">唯一的区别是谷歌 Colab 和英伟达巨头 RTX 与每台 MAC 电脑之间的区别。</p><p id="4bc8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">每台 Mac 都运行了<code class="fe mi mj mk ml b"><a class="ae nl" href="https://developer.apple.com/metal/tensorflow-plugin/" rel="noopener ugc nofollow" target="_blank">tensorflow-macos</a></code><a class="ae nl" href="https://developer.apple.com/metal/tensorflow-plugin/" rel="noopener ugc nofollow" target="_blank">(Mac 的 TensorFlow)和</a> <code class="fe mi mj mk ml b"><a class="ae nl" href="https://developer.apple.com/metal/tensorflow-plugin/" rel="noopener ugc nofollow" target="_blank">tensorflow-metal</a></code> <a class="ae nl" href="https://developer.apple.com/metal/tensorflow-plugin/" rel="noopener ugc nofollow" target="_blank">的组合，用于 GPU 加速</a>。而 Google Colab 和 Nvidia TITAN RTX 使用的是标准 TensorFlow。</p><p id="704c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以<a class="ae nl" href="https://github.com/mrdbourke/m1-machine-learning-test" rel="noopener ugc nofollow" target="_blank">在 GitHub </a>上看到所有实验和 TensorFlow 在 Mac 上设置的代码。</p><p id="1d00" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">注意:</strong>我目前不知道有任何 PyTorch 等同于<code class="fe mi mj mk ml b">tensorflow-metal</code>来加速 Mac GPUs 上的 PyTorch 代码。目前，PyTorch 只能在 Mac CPU 上运行。</p><p id="18f5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首次 TensorFlow 实验详情:</p><ul class=""><li id="118e" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt ny ma mb mc bi translated"><strong class="la iu">数据:</strong>来自 TensorFlow 数据集的 cifar 10(32x 32 幅图像，10 个类别，50，000 次训练，10，000 次测试)</li><li id="5c0f" class="lu lv it la b lb md le me lh mf ll mg lp mh lt ny ma mb mc bi translated"><strong class="la iu">型号:</strong> TinyVGG(来自 CNN Explainer 网站)</li><li id="acc8" class="lu lv it la b lb md le me lh mf ll mg lp mh lt ny ma mb mc bi translated"><strong class="la iu">训练:</strong> 10 个时期，批量 32</li><li id="58ab" class="lu lv it la b lb md le me lh mf ll mg lp mh lt ny ma mb mc bi translated"><strong class="la iu">代码:</strong> <a class="ae nl" href="https://github.com/mrdbourke/m1-machine-learning-test" rel="noopener ugc nofollow" target="_blank">在 GitHub 上看到</a></li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="od">*对于 TensorFlow 实验，我使用谷歌 Colab 的免费版本，这是谷歌提供的一个非常棒的产品，可以使用连接到 GPU 的 Jupyter 笔记本，只需很少的设置。免费版本曾经提供更快的图形处理器(英伟达 P100，T4)，然而，自从我获得其中一个已经有一段时间了。你可以通过 Colab Pro 获得更快的 GPU，但在我居住的地方(澳大利亚)还没有。</em></p></figure><p id="f486" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">泰坦 RTX 胜过其他机器是有道理的。这是一个专门为机器学习和数据科学而构建的 GPU。</p><p id="33d3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就每个时期的时间而言，所有 MAC 的性能或多或少在相同的范围内。M1 马克斯和平原 M1 机器运行代码在类似的时间。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/c8a8fb6bc4a4e844ec2bb173df7a5154.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*gQ_p4B-6w-2XxN1JL-XmTA.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用较小的数据集(CIFAR10，32x32 图像大小)和使用 TensorFlow 代码制作的模型架构(TinyVGG)测试的不同设备的比较。</p></figure><p id="81ee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">检查每台 M1 MAC 电脑的活动监视器发现，在培训期间使用了大量的 GPU。这要归功于苹果的<code class="fe mi mj mk ml b"><a class="ae nl" href="https://developer.apple.com/metal/tensorflow-plugin/" rel="noopener ugc nofollow" target="_blank">tensorflow-metal</a></code> <a class="ae nl" href="https://developer.apple.com/metal/tensorflow-plugin/" rel="noopener ugc nofollow" target="_blank"> PluggableDevice </a>，一个利用苹果金属 GPU 框架加速 TensorFlow 的软件包。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/1cdaa5a2614c5593f6027aa396a6b8a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8GjlFPd2rAgIud8DW0uMZg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">多亏了<code class="fe mi mj mk ml b">tensorflow-metal</code>，在所有的 MAC 上，训练期间活动监视器中显示了大量的 GPU 使用情况。截图来自 M1 专业版。</p></figure><h1 id="42bd" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">实验 4:使用 TensorFlow 代码进行 Food101 EfficientNetB0 特征提取</h1><p id="2437" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">最后的机器学习实验规模更大了。使用比实验 3 更多更大的图像。</p><p id="25f3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当训练机器学习模型时，获得奇妙结果的最好方法之一是使用迁移学习。</p><p id="c0a9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">迁移学习利用一个模型在类似数据集上学习到的权重(模式)，并允许您将它们用于自己的数据集。</p><p id="ab33" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于实验 4，我在 Food101 数据集上使用了 EfficientNetB0 模型的迁移学习。</p><p id="a7ad" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">实验详情:</p><ul class=""><li id="4cf2" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt ny ma mb mc bi translated"><strong class="la iu">数据:</strong> <a class="ae nl" href="https://www.tensorflow.org/datasets/catalog/food101" rel="noopener ugc nofollow" target="_blank"> Food101 </a>来自 TensorFlow 数据集(224x224 幅图像，101 个类别，~75k 训练，~25k 测试)</li><li id="b726" class="lu lv it la b lb md le me lh mf ll mg lp mh lt ny ma mb mc bi translated"><strong class="la iu">型号:</strong> <a class="ae nl" href="https://www.tensorflow.org/api_docs/python/tf/keras/applications/efficientnet/EfficientNetB0" rel="noopener ugc nofollow" target="_blank"> EfficientNetB0 </a>在 ImageNet 上预训练，顶层被替换(特征提取)</li><li id="9169" class="lu lv it la b lb md le me lh mf ll mg lp mh lt ny ma mb mc bi translated"><strong class="la iu">训练:</strong> 5 个时期，批量 32</li><li id="567e" class="lu lv it la b lb md le me lh mf ll mg lp mh lt ny ma mb mc bi translated"><strong class="la iu">代码:</strong> <a class="ae nl" href="https://github.com/mrdbourke/m1-machine-learning-test" rel="noopener ugc nofollow" target="_blank">在 GitHub 上看到</a></li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="od">*在 16 英寸 MacBook Pro 上运行的代码使用了 SGD 优化器，而不是 Adam 优化器，因为在基于英特尔的 Mac 上运行的</em> <code class="fe mi mj mk ml b"><em class="od">tensorflow-macos</em></code> <em class="od">有一个未解决的问题，我找不到修复方法。</em></p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/ae8cbc5ad849786b4ffe594c915be4dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*WH2yh3HtiJmg3In9wtDHzQ.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">事实证明，对于更大规模的模型和数据集，更新的 M1 Pro 和 M1 Max 芯片比谷歌 Colab 的免费产品(K80 GPU)更快。M1 Max 甚至与泰坦 RTX 相差不远。</p></figure><p id="28a4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对我来说，最突出的是 M1 Pro 和 M1 Max 在放大到更大的实验时的性能。</p><p id="d534" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">实验 3 在所有 MAC 上看到了类似的结果，但当数据量增加时(图像大小和图像数量)，M1 Pro 和 M1 Max 远远领先于其他 MAC。</p><p id="c481" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">M1 Pro 和 M1 Max 甚至超过了配备专用 Nvidia GPU 的谷歌 Colab(M1 Pro 快约 1.5 倍，M1 Max 快约 2 倍)。</p><p id="7f43" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这意味着你可以在本地机器上进行机器学习实验，比用在线的 Colab 笔记本更快。给你在本地跑步的所有好处。不过，Google Colab 确实给了你通过链接分享笔记本的神奇能力。</p><p id="6960" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当然，泰坦 RTX 表现最好，但 M1 Max 也不甘落后，这对于便携式设备来说是非常令人印象深刻的。</p><p id="0152" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">活动监视器显示所有设备都使用了大量 GPU。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/c74092d8ab00dd0eb8b27a1d419fc269.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W95FrwrIJegKtIihRutzTQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">多亏了<code class="fe mi mj mk ml b">tensorflow-metal</code>，所有 MAC 的 GPU 使用率在培训期间都很高。不过，看到神经引擎在这里发挥作用会很酷。CreateML 上的训练非常快。我想知道这是否可以用于定制代码。截图来自 M1 麦克斯。</p></figure><h1 id="e269" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">应该买哪个？</h1><p id="e7f1" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">在过去的一年里，我每天都在使用一台 13 英寸的 M1 MacBook Pro。我将它用于小规模的机器学习实验、视频编辑和谷歌 Colab 浏览器。</p><p id="6197" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，我现在正在考虑用 M1 Pro 升级到 14 英寸的 MacBook Pro，并在需要时在泰坦 RTX 或云上升级之前在本地做一切事情(不再有谷歌 Colab)。</p><p id="3404" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从测试来看，很明显 13 英寸的 M1 MacBook Pro(尽管这里没有测试，M1 MacBook Air 的性能应该仍然接近 M1 MacBook Pro 的结果)仍然是一款不可思议的笔记本电脑。</p><p id="262b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然如果你有预算，M1 专业版会给你一个明显的性能提升。</p><p id="37c1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">至于 M1 Max，我的测试很难证明它和 M1 Pro 之间 1100 美元的价格差距。对我来说，我宁愿把钱花在额外的本地存储、RAM 或专用 GPU 上。</p><p id="1780" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">简而言之，这些是我的建议:</p><ul class=""><li id="17b0" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt ny ma mb mc bi translated"><strong class="la iu"> 13 英寸的 M1 MacBook Pro/MacBook Air</strong>——对于初学机器学习和数据科学的人来说，这仍然是一款非常棒的笔记本电脑。</li><li id="11a4" class="lu lv it la b lb md le me lh mf ll mg lp mh lt ny ma mb mc bi translated"><strong class="la iu"> 14 英寸 M1 专业版 MacBook Pro </strong> —来自 M1 的显著性能提升，如果你喜欢新设计或有预算，这是值得的。</li><li id="a5be" class="lu lv it la b lb md le me lh mf ll mg lp mh lt ny ma mb mc bi translated"><strong class="la iu"> 14 英寸 M1 Max MacBook Pro</strong>——M1 Pro 的显著性能提升<strong class="la iu">只有在大规模模型训练</strong>中，许多其他性能基准达到了与 M1 Pro 相同的水平。如果您发现自己经常编辑多个 4K 视频流，这可能是一个选项。</li></ul><h1 id="c637" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">结论</h1><p id="afdb" class="pw-post-body-paragraph ky kz it la b lb ne ju ld le nf jx lg lh ng lj lk ll nh ln lo lp ni lr ls lt im bi translated">我想看看苹果的专用芯片在什么地方，什么时候被使用。</p><p id="e540" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，当神经引擎开始发挥作用时，看起来会很酷。比如在使用 CreateML 时(所有 M1 机器都在这里快速通过训练，就像没有明天一样)。</p><p id="5e3f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">或者更好的是，如何编写代码来利用神经引擎本身？</p><p id="8735" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">去年，我说<a class="ae nl" href="https://www.mrdbourke.com/m1-macbook-vs-intel-macbook-speed-comparison/" rel="noopener ugc nofollow" target="_blank">16 英寸 MacBook Pro 配 M2 </a>怎么样，苹果送了一台 M1 Max。或许 M2 仍在以 Mac mini 或新款 iMac 的形式出现。</p><p id="26c0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果有什么是明确的，专用于某些目的的芯片似乎是趋势。性能优势不言自明。</p><h1 id="f2b8" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">资源</h1><ul class=""><li id="d6c5" class="lu lv it la b lb ne le nf lh oi ll oj lp ok lt ny ma mb mc bi translated">在 GitHub 上查看所有用于测试和评估的<a class="ae nl" href="https://github.com/mrdbourke/m1-machine-learning-test" rel="noopener ugc nofollow" target="_blank">代码。</a></li><li id="4edd" class="lu lv it la b lb md le me lh mf ll mg lp mh lt ny ma mb mc bi translated">看我关于<a class="ae nl" href="https://youtu.be/_1CaUOHhI6U" rel="noopener ugc nofollow" target="_blank">如何为机器学习和数据科学设置你的新 M1 机器的视频</a>。</li><li id="71e8" class="lu lv it la b lb md le me lh mf ll mg lp mh lt ny ma mb mc bi translated">在 YouTube 上观看这篇博文的<a class="ae nl" href="https://youtu.be/JWYsWhR3Pxg" rel="noopener ugc nofollow" target="_blank">视频版本</a>。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol nk l"/></div></figure></div></div>    
</body>
</html>