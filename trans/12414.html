<html>
<head>
<title>How to Load Excel Files with Hidden Rows and Columns into Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将带有隐藏行和列的 Excel 文件加载到 Pandas</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-load-excel-files-with-hidden-rows-and-columns-into-pandas-19d445fa5c47?source=collection_archive---------4-----------------------#2021-12-18">https://towardsdatascience.com/how-to-load-excel-files-with-hidden-rows-and-columns-into-pandas-19d445fa5c47?source=collection_archive---------4-----------------------#2021-12-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="040b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 openpyxl 包在将 Excel 文件作为 Pandas DataFrames 读取时忽略隐藏的行和列</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7164f94dc58e24de68419ff948dd65ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KLuP2oPNTl9lOn-4"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@mbaumi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">米卡·鲍梅斯特</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="5216" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最近学到了一些新东西——在将 Excel 文件作为 Pandas DataFrames 读取时，可以排除隐藏的行和/或列，这都要归功于<code class="fe lv lw lx ly b">openpyxl</code>包，我想与你分享一下。</p><p id="f739" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">隐藏 Excel 文件的行或列并不罕见。不太相关的列可以被隐藏以保持电子表格的整洁；或者隐藏行以故意忽略重复数据。</p><p id="7715" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论原因是什么，当加载一个文件作为 Pandas DataFrame 时，隐藏它们可能是有价值的，因为它可能会影响后续的数据争论和探索。</p><p id="b0b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，将 Excel 文件作为 Pandas 数据帧读取的传统方式——使用<code class="fe lv lw lx ly b">pandas.read_excel()</code>方法——并不方便。</p><p id="05e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将探索如何使用<code class="fe lv lw lx ly b">openpyxl</code>包来识别 Excel 文件中隐藏的行和列，从而在将其作为 Pandas DataFrame 加载时排除它们。</p><h1 id="4601" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">数据集</h1><p id="5788" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">我们将使用在<a class="ae ky" href="https://www.kaggle.com/c/titanic/data" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上公开的 titanic 训练数据集的一小部分。为了简单起见，我将数据行数限制为 20。我还故意隐藏了 F(“年龄”)、I(“机票”)和 K(“客舱”)列，以及第 6、11、16 和 21 行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/492c1ec17889a65e9bd3d508d1bd843d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*91f12-Oindh-xNX_Xxw4EA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在 Excel 中预览数据集(图片由作者提供)</p></figure><h1 id="441e" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">为什么` pandas.read_excel()`不工作？</h1><p id="a87f" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">通常，我们使用 Pandas 的<code class="fe lv lw lx ly b">read_excel()</code>方法在 Excel 中加载数据集作为 Pandas DataFrame。让我们看看当我们对包含隐藏行和列的 titanic 数据集这样做时会发生什么。</p><pre class="kj kk kl km gt mx ly my mz aw na bi"><span id="e8e7" class="nb ma it ly b gy nc nd l ne nf">&gt;&gt;&gt; import pandas as pd</span><span id="62b5" class="nb ma it ly b gy ng nd l ne nf">&gt;&gt;&gt; df = pd.read_excel("data/titanic.xlsx")</span><span id="2cc0" class="nb ma it ly b gy ng nd l ne nf">&gt;&gt;&gt; df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/6094dc02e331cdce58073dd6f9742543.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C80uaeE5zGyshh71t4YzVg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据集为熊猫数据框，包含所有行和列(图片由作者提供)</p></figure><p id="daf2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，<code class="fe lv lw lx ly b">read_excel()</code>方法从指定的 Excel 文件的所有行和列中读入<strong class="lb iu">数据。换句话说，它不排除隐藏的行和列。</strong></p><h1 id="a1c5" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">openpyxl 的安装</h1><p id="4b31" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">要加载 Pandas DataFrames 而不隐藏行和列，我们可以使用<strong class="lb iu"> openpyxl </strong>包，一个 Python 库来“读/写 Excel 2010 xlsx/xlsm/xltx/xltm 文件”。</p><p id="7150" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于 openpyxl 不是一个标准的 Python 内置库，您首先需要安装它。打开命令行窗口，键入以下命令:</p><pre class="kj kk kl km gt mx ly my mz aw na bi"><span id="c296" class="nb ma it ly b gy nc nd l ne nf">&gt;&gt;&gt; pip install openpyxl</span></pre><h1 id="0f7a" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">使用 openpyxl 加载 Excel 文件和工作表</h1><p id="ec83" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">要使用<code class="fe lv lw lx ly b">openpyxl</code>包打开现有的 Excel 文件，我们使用<code class="fe lv lw lx ly b">openpyxl.load_workbook()</code>方法，指定存储 Excel 文件的路径名。</p><pre class="kj kk kl km gt mx ly my mz aw na bi"><span id="48ed" class="nb ma it ly b gy nc nd l ne nf">&gt;&gt;&gt; import openpyxl</span><span id="ee73" class="nb ma it ly b gy ng nd l ne nf"># Open an Excel workbook<br/>&gt;&gt;&gt; workbook = openpyxl.load_workbook("data/titanic.xlsx")</span></pre><p id="262b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这创建了一个<code class="fe lv lw lx ly b">Workbook</code>对象，根据文档，它是“所有文档信息的顶级容器”。该对象包含许多与输入文件相关的属性，包括返回工作簿中所有工作表名称列表的<code class="fe lv lw lx ly b">.sheetnames</code>属性。</p><pre class="kj kk kl km gt mx ly my mz aw na bi"><span id="7a7e" class="nb ma it ly b gy nc nd l ne nf"># Create a list of names of all worksheets in `workbook`<br/>&gt;&gt;&gt; sheet_names = workbook.sheetnames</span><span id="80ee" class="nb ma it ly b gy ng nd l ne nf"># Create a `Worksheet` object <br/>&gt;&gt;&gt; worksheet = workbook[sheet_names[0]]</span></pre><p id="7db5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的<code class="fe lv lw lx ly b">titanic.xlsx</code>文件中，我们只有一个名为“train”的工作表，所以我们通过获取<code class="fe lv lw lx ly b">sheet_names</code>列表的第一个元素来获得工作表名称。接下来，我们从<code class="fe lv lw lx ly b">Workbook</code>对象创建一个<code class="fe lv lw lx ly b">Worksheet</code>对象。</p><h1 id="903e" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">查找隐藏行的索引</h1><p id="1b13" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">类似地，<code class="fe lv lw lx ly b">Worksheet</code>对象包含属于指定工作表的属性。为了找到所有隐藏行的索引，我们使用了<code class="fe lv lw lx ly b">Worksheet</code>对象的<code class="fe lv lw lx ly b">.row_dimensions</code>属性，如下所示:</p><pre class="kj kk kl km gt mx ly my mz aw na bi"><span id="39a9" class="nb ma it ly b gy nc nd l ne nf"># List of indices corresponding to all hidden rows<br/>&gt;&gt;&gt; hidden_rows_idx = [<br/>        row - 2 <br/>        for row, dimension in worksheet.row_dimensions.items() <br/>        if dimension.hidden<br/>    ]</span><span id="fbcc" class="nb ma it ly b gy ng nd l ne nf">&gt;&gt;&gt; print(hidden_rows_idx)</span><span id="2e26" class="nb ma it ly b gy ng nd l ne nf">[4, 9, 14, 19]</span></pre><p id="f66f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，我们需要使用<code class="fe lv lw lx ly b">row — 2</code>而不仅仅是<code class="fe lv lw lx ly b">row</code>,因为我们想要找到对应于熊猫数据帧的索引，而不是 Excel 文件。</p><h1 id="6d9b" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">查找隐藏列的名称</h1><p id="bb1a" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">为了找到所有隐藏列的名称，我们首先使用<code class="fe lv lw lx ly b">Worksheet</code>对象的<code class="fe lv lw lx ly b">.column_dimension</code>属性:</p><pre class="kj kk kl km gt mx ly my mz aw na bi"><span id="d1e1" class="nb ma it ly b gy nc nd l ne nf"># List of indices corresponding to all hidden columns<br/>&gt;&gt;&gt; hidden_cols = [<br/>        col <br/>        for col, dimension in worksheet.column_dimensions.items() <br/>        if dimension.hidden<br/>    ]</span><span id="f495" class="nb ma it ly b gy ng nd l ne nf">&gt;&gt;&gt; print(hidden_cols)</span><span id="c683" class="nb ma it ly b gy ng nd l ne nf">['F', 'I', 'K']</span></pre><p id="2fde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将生成一个包含大写字母的列表，这些字母对应于 Excel 工作表的隐藏列。因此，我们需要以某种方式将<code class="fe lv lw lx ly b">hidden_cols</code>列表转换成隐藏列的名称列表。为此，我们使用 Python 的内置库<code class="fe lv lw lx ly b">string</code>及其<code class="fe lv lw lx ly b">.ascii_uppercase</code>属性:</p><pre class="kj kk kl km gt mx ly my mz aw na bi"><span id="9b16" class="nb ma it ly b gy nc nd l ne nf"># List of indices corresponding to all hidden columns<br/>&gt;&gt;&gt; hidden_cols_idx = [<br/>        string.ascii_uppercase.index(col_name) <br/>        for col_name in hidden_cols<br/>    ]</span><span id="4dc8" class="nb ma it ly b gy ng nd l ne nf"># Find names of columns corresponding to hidden column indices<br/>&gt;&gt;&gt; hidden_cols_name = df.columns[hidden_cols_idx].tolist()</span><span id="9731" class="nb ma it ly b gy ng nd l ne nf">&gt;&gt;&gt; print(hidden_cols_name)</span><span id="fb16" class="nb ma it ly b gy ng nd l ne nf">['Age', 'Ticket', 'Cabin']</span></pre><p id="959d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="ni">免责声明:请注意，使用</em> </strong> <code class="fe lv lw lx ly b"><strong class="lb iu">string.ascii_uppercase</strong></code> <strong class="lb iu"> <em class="ni">假设最多有 26 列。如果超过 26 列，就需要修改代码。</em> </strong></p><p id="1dea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，一旦我们有了隐藏行的索引和隐藏列的名称，剩下的就简单了。为了排除那些隐藏的行和列，我们简单地使用 Pandas 的<code class="fe lv lw lx ly b">.drop()</code>方法。</p><pre class="kj kk kl km gt mx ly my mz aw na bi"><span id="0e15" class="nb ma it ly b gy nc nd l ne nf"># Drop the hidden columns<br/>&gt;&gt;&gt; df.drop(hidden_cols_name, axis=1, inplace=True)</span><span id="b3c2" class="nb ma it ly b gy ng nd l ne nf"># Drop the hidden rows<br/>&gt;&gt;&gt; df.drop(hidden_rows_idx, axis=0, inplace=True)</span><span id="5171" class="nb ma it ly b gy ng nd l ne nf"># Reset the index <br/>&gt;&gt;&gt; df.reset_index(drop=True, inplace=True)</span><span id="96f0" class="nb ma it ly b gy ng nd l ne nf">&gt;&gt;&gt; df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/9fa487a75818e2d11d51a4740e851e2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cO2jHfMHMk82GugipcUqMw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">没有隐藏行和列的数据集作为熊猫数据框架(图片由作者提供)</p></figure><h1 id="6353" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">把所有的放在一起</h1><p id="d478" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">下面是一个代码片段，它通过一些简单的重构将上述代码组合在一起:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h1 id="5e40" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">包装它</h1><p id="5ca3" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">现在，你有了它——一个 Python 代码，它允许你读取一个包含隐藏行和/或列的 Excel 文件，就像熊猫数据帧一样。</p><p id="1cff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个特殊的用例仅仅触及了<code class="fe lv lw lx ly b">openpyxl</code>包所提供的皮毛。关于<code class="fe lv lw lx ly b">openpyxl</code>包的更多信息，查看它的文档<a class="ae ky" href="https://openpyxl.readthedocs.io/en/stable/index.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="a825" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章中显示的代码也可以在这个<a class="ae ky" href="https://github.com/zeyalt/My-Articles/tree/master/Python%20Tips/How%20to%20Load%20Excel%20Files%20with%20Hidden%20Rows%20and%20Columns%20into%20Pandas" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>的笔记本中找到。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><p id="6b4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你好！我是泽雅。感谢你阅读这篇文章。如果你觉得它有用，请在评论中告诉我。我也欢迎<em class="ni"> </em>讨论、问题和建设性的反馈。请随时通过<a class="ae ky" href="https://zeyalt.medium.com/" rel="noopener">媒体</a>关注我，或者通过<a class="ae ky" href="https://www.linkedin.com/in/zeyalt/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或<a class="ae ky" href="https://twitter.com/zeyalt_" rel="noopener ugc nofollow" target="_blank"> Twitter </a>联系我。祝您愉快！</p></div></div>    
</body>
</html>