<html>
<head>
<title>PySpark Analysis on Airport Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">机场数据的PySpark分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pyspark-analysis-on-airport-data-6d10aaf9cbb1?source=collection_archive---------15-----------------------#2021-05-16">https://towardsdatascience.com/pyspark-analysis-on-airport-data-6d10aaf9cbb1?source=collection_archive---------15-----------------------#2021-05-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d922" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用大数据平台PySpark和Google Collaboratory笔记本分析机场和航班数据</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0d46ea614e679c951310e8cc73d882bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RVPRxqz2VUuY7NGXSXzmtw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在<a class="ae kv" href="https://unsplash.com/s/photos/big-data?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kv" href="https://unsplash.com/@kmuza?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Carlos Muza </a>拍摄的照片</p></figure><p id="06bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">大数据是大量复杂数据集和数据量的集合，包括海量数据、数据管理功能、社交媒体分析和实时数据。大数据是指无法通过简化的处理方法处理的数据，因为要处理的数据非常庞大。大数据也被定义为处理大量数据的系统，以非常短的延迟实时产生结果。Apache Spark是一个统一的分析引擎，主要用于大规模处理。<a class="ae kv" href="https://spark.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Spark </a>的一些主要优势是处理速度、易用性、平台通用性以及可以与之集成的工具包。</p><p id="935d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">PySpark是在Apache Spark上工作的Python API。使用<a class="ae kv" href="https://www.gangboard.com/blog/what-is-pyspark#:~:text=PySpark%20is%20the%20Python%20API%20written%20in%20python%20to%20support%20Apache%20Spark.&amp;text=Apache%20Spark%20is%20written%20in,in%20parallel%20and%20batch%20systems." rel="noopener ugc nofollow" target="_blank"> PySpark </a>的主要优势是它可以很容易地与Java、R和Scala集成。数据科学家可以利用RDD以更高的速度在分布式集群上工作，以部分方式存储数据。磁盘持久化和强大的缓存有助于进一步提高处理速度。在本文中，我们讨论了如何在Google Collaboratory笔记本上使用<a class="ae kv" href="https://www.gangboard.com/blog/what-is-pyspark#:~:text=PySpark%20is%20the%20Python%20API%20written%20in%20python%20to%20support%20Apache%20Spark.&amp;text=Apache%20Spark%20is%20written%20in,in%20parallel%20and%20batch%20systems." rel="noopener ugc nofollow" target="_blank"> PySpark </a>来分析包含大约360万行和15个特征的巨大数据集。</p><div class="ls lt gp gr lu lv"><a href="https://github.com/ojaashampiholi/Airport_Analysis_PySpark" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">ojaashampiholi/Airport _ Analysis _ py spark</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">这个项目的重点是执行探索性分析的航班在美国使用PySpark是运行在谷歌Colab…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">github.com</p></div></div><div class="me l"><div class="mf l mg mh mi me mj kp lv"/></div></div></a></div><h1 id="b4d4" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">在Google Colab上安装和初始化PySpark</h1><ol class=""><li id="e32a" class="nc nd iq ky b kz ne lc nf lf ng lj nh ln ni lr nj nk nl nm bi translated">下载JRE无头版到笔记本。</li></ol><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="0a76" class="ns ml iq no b gy nt nu l nv nw">!apt-get install openjdk-8-jdk-headless -qq &gt; /dev/null</span></pre><p id="2f85" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.下载Spark with Hadoop安装zip文件并解压缩以备后用。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="9a03" class="ns ml iq no b gy nt nu l nv nw">!wget -q https://downloads.apache.org/spark/spark-3.0.2/spark-3.0.2-bin-hadoop2.7.tgz<br/><br/>!tar xf spark-3.0.2-bin-hadoop2.7.tgz</span></pre><p id="4d7c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">3.设置Javahome和Sparkhome变量。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="bf7a" class="ns ml iq no b gy nt nu l nv nw">import os <br/>os.environ["JAVA_HOME"] = "/usr/lib/jvm/java-8-openjdk-amd64" os.environ["SPARK_HOME"] = "/content/spark-3.0.2-bin-hadoop2.7"</span></pre><p id="1f1e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">4.安装并初始化findspark库。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="2d47" class="ns ml iq no b gy nt nu l nv nw">!pip install -q findspark</span><span id="ab49" class="ns ml iq no b gy nx nu l nv nw"><strong class="no ir">import</strong> <strong class="no ir">findspark</strong><br/>findspark.find()<br/>findspark.init()</span></pre><p id="33c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">5.创建Spark和SQLContext会话。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="a46c" class="ns ml iq no b gy nt nu l nv nw"><strong class="no ir">from</strong> <strong class="no ir">pyspark.sql</strong> <strong class="no ir">import</strong> SparkSession<br/><br/>spark = SparkSession.builder\<br/>        .master("local")\<br/>        .appName("Colab")\<br/>        .config('spark.ui.port', '4050')\<br/>        .getOrCreate()<br/><br/><strong class="no ir">from</strong> <strong class="no ir">pyspark.sql</strong> <strong class="no ir">import</strong> SQLContext<br/>sqlContext = SQLContext(spark)<br/>spark</span></pre><p id="9a34" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以上步骤可以在<a class="ae kv" href="https://github.com/ojaashampiholi/Airport_Analysis_PySpark/blob/main/Airport_Analysis_PySpark.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>中找到。一旦我们完成了必要的安装并建立了分析环境，数据就是开源的，可以在Kaggle上找到，标题是<a class="ae kv" href="https://www.kaggle.com/flashgordon/usa-airport-dataset" rel="noopener ugc nofollow" target="_blank">美国机场数据集</a>。该项目使用截至2021年3月31日可在link上获得的数据集。下载后，我们可以将CSV数据读取到pyspark，并注册它的表格形式，以便与SQLContext一起使用。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="caf6" class="ns ml iq no b gy nt nu l nv nw">df = spark.read.csv("./Airports2.csv", header=True, inferSchema=True)</span><span id="8126" class="ns ml iq no b gy nx nu l nv nw">df.registerTempTable('df')</span></pre><h1 id="c027" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">初步分析和见解</h1><p id="7a03" class="pw-post-body-paragraph kw kx iq ky b kz ne jr lb lc nf ju le lf ny lh li lj nz ll lm ln oa lp lq lr ij bi translated">任何数据分析师对数据集进行初步分析的第一步都是计算行数、数据方案和要素的统计描述。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="720e" class="ns ml iq no b gy nt nu l nv nw">df.printSchema()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/f2dd1930632218613a0cdd706162bb18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*z0Vo3OUSqMtvovUzSQik2w.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://github.com/ojaashampiholi/Airport_Analysis_PySpark/blob/main/query_images/schema.JPG" rel="noopener ugc nofollow" target="_blank"> <strong class="bd oc">数据模式</strong> </a></p></figure><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="1203" class="ns ml iq no b gy nt nu l nv nw">df.describe().show()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/b411d6eb42daff1475955b1184ac9ea1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aXENwnrELobNxV24wXZYZg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://github.com/ojaashampiholi/Airport_Analysis_PySpark/blob/main/query_images/describe.JPG" rel="noopener ugc nofollow" target="_blank"> <strong class="bd oc">统计分析</strong> </a></p></figure><p id="80df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完成上述步骤是为了获得对数据的基本见解，它们帮助数据分析师确定需要应用于数据的预处理步骤，以将数据转换为正确的格式。为了更好地理解数据，我们可以看一下前几行数据。Spark转换和动作可用于数据的子集化。</p><h2 id="7428" class="ns ml iq bd mm oe of dn mq og oh dp mu lf oi oj mw lj ok ol my ln om on na oo bi translated">数据子集</h2><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="54b4" class="ns ml iq no b gy nt nu l nv nw">df.select("Origin_airport","Destination_airport","Passengers","Seats").show(15)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi op"><img src="../Images/992c6afdc75a41a399afa3ee150d887f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*12w9d_ErgzyQVFyllEbpoA.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://github.com/ojaashampiholi/Airport_Analysis_PySpark/blob/main/query_images/subset.JPG" rel="noopener ugc nofollow" target="_blank"> <strong class="bd oc">数据子集</strong> </a></p></figure><h2 id="e705" class="ns ml iq bd mm oe of dn mq og oh dp mu lf oi oj mw lj ok ol my ln om on na oo bi translated">数据集合</h2><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="1a3f" class="ns ml iq no b gy nt nu l nv nw">airportAgg_DF = df.groupBy("Origin_airport").agg(F.sum("Passengers"))<br/>airportAgg_DF.show(10)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/a30251ae1f393811c560e3e0a8218633.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*SHBRl_H9Tpl3AthvQTbA5g.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://github.com/ojaashampiholi/Airport_Analysis_PySpark/blob/main/query_images/aggregate.JPG" rel="noopener ugc nofollow" target="_blank"> <strong class="bd oc">汇总数据</strong> </a></p></figure><h1 id="cda9" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">研究问题和SQL解决方案</h1><p id="e8d7" class="pw-post-body-paragraph kw kx iq ky b kz ne jr lb lc nf ju le lf ny lh li lj nz ll lm ln oa lp lq lr ij bi translated">完成所有初步分析后，我们将继续回答一些问题，这些问题可以使用SQLContext用SQL查询来表达。下面简要讨论了研究问题及其相应的答案。以下问题的代码解决方案可以在这里找到。</p><h2 id="4136" class="ns ml iq bd mm oe of dn mq og oh dp mu lf oi oj mw lj ok ol my ln om on na oo bi translated"><strong class="ak">查找航班起飞次数最多的机场</strong></h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi or"><img src="../Images/5fb559d0d0aa2f471a96e8a0e53e5d2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*8Z0th4y7HTTWayHr-DZZ_g.jpeg"/></div></figure><p id="c22a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到，在航班起飞方面，受欢迎的机场依次是芝加哥奥黑尔机场、哈兹菲尔德-杰克逊亚特兰大机场、达拉斯/沃斯堡机场和洛杉矶国际机场。</p><h2 id="31ff" class="ns ml iq bd mm oe of dn mq og oh dp mu lf oi oj mw lj ok ol my ln om on na oo bi translated"><strong class="ak">找到到达旅客人数最多的机场</strong></h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi os"><img src="../Images/d12a56cde9e812982a839a322eecf787.png" data-original-src="https://miro.medium.com/v2/resize:fit:676/format:webp/1*2ezX9OIpR4XwwYqIZN8cKQ.jpeg"/></div></figure><p id="568b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到，就到达旅客人数而言，受欢迎的机场依次是亚特兰大哈兹菲尔德-杰克逊机场、芝加哥奥黑尔机场、达拉斯/沃斯堡机场和洛杉矶国际机场。</p><h2 id="d80f" class="ns ml iq bd mm oe of dn mq og oh dp mu lf oi oj mw lj ok ol my ln om on na oo bi translated"><strong class="ak">寻找航班流量最多的机场</strong></h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/5a835e378fd2ac8eed5c5fe071de992e.png" data-original-src="https://miro.medium.com/v2/resize:fit:498/format:webp/1*KAhgH2JtFaHjNvAiOGIY2A.jpeg"/></div></figure><p id="0179" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到，就航班数量而言，受欢迎的机场依次是芝加哥奥黑尔机场、哈兹菲尔德-杰克逊亚特兰大机场、达拉斯/沃斯堡机场和洛杉矶国际机场。</p><h2 id="aa47" class="ns ml iq bd mm oe of dn mq og oh dp mu lf oi oj mw lj ok ol my ln om on na oo bi translated"><strong class="ak">找到客流量最多的机场</strong></h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi os"><img src="../Images/d12a56cde9e812982a839a322eecf787.png" data-original-src="https://miro.medium.com/v2/resize:fit:676/format:webp/1*2ezX9OIpR4XwwYqIZN8cKQ.jpeg"/></div></figure><p id="0ceb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到，就乘客数量而言，受欢迎的机场依次是达拉斯/沃思堡机场、哈兹菲尔德-杰克逊亚特兰大机场、芝加哥奥黑尔机场和洛杉矶国际机场。</p><h2 id="f8fb" class="ns ml iq bd mm oe of dn mq og oh dp mu lf oi oj mw lj ok ol my ln om on na oo bi translated"><strong class="ak">查找最受欢迎路线的占用率</strong></h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/eb5eb94f4b0f22dd2c959547a08e2c2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*7LUBsM9ezW-BdGTZLDJdFg.jpeg"/></div></figure><p id="087c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">热门航班的上座率在48%到71%之间，平均为60%。这意味着尽管有许多航班在机场之间运行，但大多数航班在客运方面效率不高。此外，减少和重新安排一些航班以提高客座率可以帮助航空公司降低燃料成本，同时也有助于通过减少碳足迹来保护环境。</p><h2 id="f580" class="ns ml iq bd mm oe of dn mq og oh dp mu lf oi oj mw lj ok ol my ln om on na oo bi translated"><strong class="ak">查找长途旅行的航班数量</strong></h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/d70c15a099ae894c0a0c4093df9fd9f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*OdUIsHr6hDXy-innuJqATQ.jpeg"/></div></figure><p id="1c0b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以从输出中观察到，在大多数情况下，长途飞行的频率较低。然而，有趣的是，有许多航班在夏威夷—檀香山(檀香山国际机场)和纽约(约翰·肯尼迪国际机场和纽瓦克自由国际机场)之间运行，即使两地之间的距离相当远。</p><h2 id="ebf2" class="ns ml iq bd mm oe of dn mq og oh dp mu lf oi oj mw lj ok ol my ln om on na oo bi translated"><strong class="ak">查找航班最多的航线的平均距离</strong></h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/49e1a9e3093fb7476820134ee748c645.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*YDfs3p-EgldLWNUZ21OWMA.jpeg"/></div></figure><p id="8786" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到，除了少数例外情况，中距离航线(100-300英里)的航班数量最多。即使机场之间的距离是725英里，芝加哥(ORD)和纽约(LGA EWR)之间的航线仍然非常繁忙。我们在这里看到的另一个有趣的例子是，即使距离约为720英里，亚特兰大(ATL)和达拉斯/沃斯堡(DFW)之间的航班也是一项受欢迎的服务。</p><h1 id="29a4" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated"><strong class="ak">未来工作</strong></h1><p id="4707" class="pw-post-body-paragraph kw kx iq ky b kz ne jr lb lc nf ju le lf ny lh li lj nz ll lm ln oa lp lq lr ij bi translated">输出表可以保存为单独的CSV文件，并可用于使用Python或Tableau可视化数据，以创建交互式仪表盘，从而帮助人们选择航班并相应地计划他们的假期。一个应用程序可以包含一个使用Apache AirFlow的工作流，该工作流每天刷新数据并更新已经在仪表板上创建的图表。</p></div></div>    
</body>
</html>