<html>
<head>
<title>How to do Causal Inference using Synthetic Controls</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用合成控件进行因果推断</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-do-causal-inference-using-synthetic-controls-ab435e0228f1?source=collection_archive---------11-----------------------#2021-10-05">https://towardsdatascience.com/how-to-do-causal-inference-using-synthetic-controls-ab435e0228f1?source=collection_archive---------11-----------------------#2021-10-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="31c1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">麻省理工学院开发的t-测验综合控制概述。</h2></div><p id="43d6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在2017年和2021年之间，有大量关于合成控制的研究。然而，该方法尚未被数据科学行业广泛采用。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/3ce3e422bfeeb905ea2aad5a06bc4dec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cF8jpEh67rAAB5ryhlyZFQ.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图1:首次发布的合成控制示例，显示了恐怖袭击对巴斯克地区GDP的影响。图片作者。</p></figure><p id="be1f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">一句话，合成控制(SC)预测观察到的数据在没有处理的情况下会是什么样子。</strong> SC很有吸引力，因为它们允许对观察到的时间序列数据进行偶然的推断。它们的计算效率也很高，而且相对简单。</p><p id="e568" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本帖中，我们将讨论合成控制和一种由麻省理工学院研究人员开发的新变体，用于对合成控制数据进行<a class="ae lr" href="https://arxiv.org/pdf/1812.10820.pdf" rel="noopener ugc nofollow" target="_blank"> t检验</a>。与传统方法相比，它拥有一些令人印象深刻的优势，例如置信区间大小减少了50%。它的计算效率也很高，并且不依赖于假设。</p><p id="e534" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">事不宜迟，让我们开始吧…</p><h1 id="36f0" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">技术TLDR</h1><p id="8806" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">综合控制方法在观察时间序列数据中发展了一个控制组的估计。这允许我们在不可能随机化的情况下分离出干预的治疗效果。</p><p id="7f54" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们首先选择一个与我们的治疗组相似的对照组。然后，在干预前阶段，我们使用加权平均值来最小化对照组和治疗组中共变量之间的距离。最后，我们使用对照组中“训练过的”协变量来推断如果治疗没有发生会发生什么。</p><p id="5296" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，由于潜在的不正确的权重向量和长期方差的不良估计，对SC的推断并不稳健。为了解决这些问题，我们提出了一个无标度t统计量，使用K-fold交叉拟合过程进行拟合。唯一的假设要求是对照组“充分”喜欢治疗。</p><p id="6246" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里是<a class="ae lr" href="https://github.com/kwuthrich/scinference" rel="noopener ugc nofollow" target="_blank"> R包</a>回购。</p><h1 id="b379" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">但是，到底是怎么回事呢？</h1><p id="6548" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">好吧，你只是遇到了很多麻烦。让我们慢一点，通过合成控制和麻省理工学院的t-测试进行推理。</p><h2 id="5619" class="mp lt iq bd lu mq mr dn ly ms mt dp mc ko mu mv me ks mw mx mg kw my mz mi na bi translated">1 —因果推理</h2><p id="eda0" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">在统计学中，我们经常对因果关系感兴趣。</p><p id="ae7c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">确定一段关系是否是因果关系的黄金标准是A/B测试。通过在治疗组和对照组之间随机分配，我们可以保证(平均)在各组之间均匀分布协变量，如图2所示。<strong class="kh ir">随机化有效地使实验组相同。</strong></p><p id="ee8e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦我们有了<em class="nb">个相同的</em>组，我们就可以给其中一组分配一种治疗方法，并观察它们的差异。<strong class="kh ir">由于两组是相同的，差异必然是由治疗引起的。</strong></p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nc"><img src="../Images/79bddfb252fe3bbf24b1dd90a3e4de4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xxwxTsC_bJwncKYB7yo2eg.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图2:一个均匀分布的协变量的例子，<em class="nd">性别</em>。图片作者。</p></figure><p id="d4fe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，我们也有兴趣对我们观察到但没有随机化的数据进行因果推断。一个简单的方法是开发一个完美的因果模型，考虑所有可能的混杂因素。但是我们怎么知道我们是否有所有的混杂因素呢？</p><p id="8915" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你经常不能。“正确”模型的假设是大多数简单因果模型的基础，从根本上说是无法证明的。</p><p id="a34a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有许多选择<a class="ae lr" href="https://mixtape.scunning.com/introduction.html" rel="noopener ugc nofollow" target="_blank"/>，但在本帖中，我们将讨论一种专门针对时间序列数据的最稳健的方法…</p><h2 id="c181" class="mp lt iq bd lu mq mr dn ly ms mt dp mc ko mu mv me ks mw mx mg kw my mz mi na bi translated">2 —合成控制</h2><p id="460b" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">合成控制是在观察数据中创建控制组的一种非常聪明的方法。通过这样做，我们有了一个比较的基线，从而可以准确地估计治疗效果。</p><p id="f8a6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们看一个例子。</p><p id="d055" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设我们正在评估费城清洁能源政策的影响。我们感兴趣的变量是安装在房屋上的太阳能电池板的数量。</p><p id="529e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">理想情况下，我们的处理效果看起来像下面的图3。在干预之后，政策的批准，我们会看到太阳能电池板的数量(蓝色)相对于我们的理论控制(绿色点)有所增加。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ne"><img src="../Images/777d40a226f75712d2f0de843fcd7262.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MnJTgVq8ZHyNRnK9HId5tQ.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图3:综合控制的时间序列结构示例。图片作者。</p></figure><p id="94ac" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了这个框架，让我们通过开发一个综合控制的步骤…</p><p id="8afa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">第一步:选择对照组</strong>。控制组用于训练预测合成控制值的权重向量。注意，对照组不能以任何方式受到治疗的影响。对于我们的示例，我们可能希望排除与费城有业务往来的城市，因为化石燃料出口可能会发生变化。</p><p id="920b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">第二步:确定相关预测因子。</strong>治疗组和对照组中的预测因子都应该是可观察到的。它们可以是不受治疗系统影响的任何东西。一些例子可以是一个城市的国内生产总值或房屋总数。</p><p id="6664" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">第三步:拟合权重向量。</strong>选择的权重必须使治疗组和对照组预测值之间的距离最小，如图4所示。<em class="nb"> X1 </em>和<em class="nb"> X0 </em>是相同的预测因子，但分别在处理和对照中观察。W 是我们的权重向量。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/d6981117971a6d777d14458ff77c22f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*MUdIWIRAgtGrWZh-cnAy7Q.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图4:我们希望最小化的范数向量。x是预测值，W是权重向量。</p></figure><p id="5894" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这一步的最后，我们有一组权重，使控制协变量看起来像处理协变量。</p><p id="20ae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第四步:预测我们的控制值。掌握了控制预测因子与治疗预测因子之间的关系，我们可以使用观察到的控制数据来预测未进行干预的治疗<em class="nb">。</em></p><p id="8794" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">第五步:观察治疗电梯。</strong>有了对照组和治疗组，我们就可以开始探索差异了。</p><p id="6c08" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不算太坏，对吧？</p><h1 id="f3e8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">方法:合成对照的T检验</h1><p id="ca02" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">现在普通的综合控制框架不能确定估计值的变化，所以我们不能确定统计意义。</p><p id="8f86" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一个常见的解决方法是运行一个<a class="ae lr" rel="noopener" target="_blank" href="/how-to-use-permutation-tests-bacc79f45749">排列测试</a>，但是这里我们概述一个麻省理工学院开发的替代方法。令人印象深刻的是，该方法只需要假设“处理单元与控制单元足够相似”</p><p id="10f0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当估计综合控制的不确定性时，该方法解决了两个主要问题。第一个是<strong class="kh ir">我们的加权平均框架可能产生不准确的估计</strong>，即使我们的治疗和控制预测之间的距离最小化。第二个更微妙，但仍然很重要。在确定统计显著性时，我们经常使用长期方差的估计量来定义置信区间。那些<strong class="kh ir">长期方差估值器通常是不准确的</strong>。</p><p id="e064" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了简洁起见，这将变得有点技术性，但是请随意参考论文。</p><h2 id="ef8c" class="mp lt iq bd lu mq mr dn ly ms mt dp mc ko mu mv me ks mw mx mg kw my mz mi na bi translated">问题1 —重量矢量不准确</h2><p id="771d" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">为了解决潜在的权重向量估计不准确的问题，我们执行了一个<em class="nb"> K </em>折叠交叉拟合过程，概述如下…</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ng"><img src="../Images/302343071ba2240efc8fec8ef2921223.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9BVxhCbUKSyAbFK6lFMATw.png"/></div></div></figure><p id="6ada" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里，<em class="nb"> T0 </em>和<em class="nb"> T1 </em>分别是干预前后的时间点。<em class="nb"> K </em>是用户自定义的参数，决定折叠的次数，类似于交叉验证。</p><p id="d00f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，这个符号非常简单，但希望能提供一个大致的理解。详见<a class="ae lr" href="https://arxiv.org/pdf/1812.10820.pdf" rel="noopener ugc nofollow" target="_blank">第2.2节</a>开头。</p><p id="2c4f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">只剩最后一节了…</p><h2 id="ad69" class="mp lt iq bd lu mq mr dn ly ms mt dp mc ko mu mv me ks mw mx mg kw my mz mi na bi translated">问题2——不准确的长期方差估计量</h2><p id="b4a9" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">为了解决长期方差估计不准确的问题，我们开发了一种无标度统计。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/33b5b172612e2c7ae218c3fd2f88ba70.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*NKE7FKHfgWU33vMXm8zWRw.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图5:无标度t统计量。</p></figure><p id="c574" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">尽管符号看起来很复杂，但这只是一个t统计量。括号中的值是我们的处理平均值和对照平均值之间的差值。分母是通过我们的k倍拟合过程确定的标准偏差。并且，<em class="nb"> K </em>是折叠的次数。</p><h1 id="e69b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">摘要</h1><p id="2ac2" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">这就是综合控制的概要，以及如何对这些信息进行T检验。</p><p id="0616" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">概括地说，合成对照使用干预前观察到的治疗组和对照组之间的关系来预测干预后对照组的值。尽管这种方法很受欢迎，但它很难进行稳健的统计推断。</p><p id="2403" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们概述了利用k倍交叉拟合和无标度t统计的t检验，以解决开发合成对照时发现的常见问题。此外，令人印象深刻的是，这种方法只需要假设我们控制的单位与我们治疗的单位相似。</p><h1 id="480c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">实施说明</h1><ul class=""><li id="17a4" class="ni nj iq kh b ki mk kl ml ko nk ks nl kw nm la nn no np nq bi translated">理论上，供应链框架超越了线性关系和简单的加权平均。然而，数学变得更加复杂，所以在这个领域没有太多的发展。这里有一个值得注意的例外。</li><li id="0775" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">拟合协变量时，评估拟合的质量很重要。一个严重错误的模型会极大地降低我们结论的质量。这里有一个<a class="ae lr" href="https://arxiv.org/pdf/1811.04170.pdf" rel="noopener ugc nofollow" target="_blank">偏差修正方法，适用于拟合不佳的模型</a>。</li><li id="a78f" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">为了在不牺牲拟合的情况下简化过程，通常将PCA应用于治疗和控制中的预测器。然后，在每个主分量上拟合权重向量。</li><li id="592b" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">SC依靠大量的预干预期进行训练。预干预期越长越好。</li><li id="8d26" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated">最小化权重时标准化预测值通常是个好主意。这防止具有不同大小/单位的预测器扭曲最小化。</li><li id="26d2" class="ni nj iq kh b ki nr kl ns ko nt ks nu kw nv la nn no np nq bi translated"><a class="ae lr" href="https://dimewiki.worldbank.org/Difference-in-Differences" rel="noopener ugc nofollow" target="_blank">差异中的差异</a>是一个常见的选择，但需要更多的假设。如果这些假设中的任何一个都不被支持，SC和这个t检验是一个很好的默认选项。</li></ul><p id="c1eb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">附言:有很多非常好的研究即将出炉。查看<a class="ae lr" href="https://arxiv.org/search/?query=synthetic+control&amp;searchtype=title&amp;source=header" rel="noopener ugc nofollow" target="_blank">arxiv.com</a>了解最新消息。</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><p id="da07" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nb">感谢阅读！我会再写32篇文章，把学术研究带到DS行业。查看我的评论，链接到这篇文章的主要来源和一些有用的资源。</em></p></div></div>    
</body>
</html>