<html>
<head>
<title>How to Write NumPy Arrays to CSV Files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将 NumPy 数组写入 CSV 文件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-write-numpy-arrays-to-csv-files-449a217ae7ee?source=collection_archive---------9-----------------------#2021-12-25">https://towardsdatascience.com/how-to-write-numpy-arrays-to-csv-files-449a217ae7ee?source=collection_archive---------9-----------------------#2021-12-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a8fc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">以及为什么您应该考虑其他文件格式</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c94cef301b67ddabdba16b92afe0bbe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8W90uoxvcxtxs9yGSso-Jw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由英驰通过<a class="ae ky" href="http://unsplash.com" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="f80b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章解释了<strong class="lb iu">如何将 NumPy 数组写入 CSV 文件</strong>。</p><p id="d610" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将看看:</p><ul class=""><li id="5f5a" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">将不同的 NumPy 数组写入 CSV 的语法</li><li id="23dc" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">将 NumPy 数组写入 CSV 的限制</li><li id="521c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">保存 NumPy 数组的替代方法</li></ul><p id="974a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们开始吧。</p><h1 id="8e70" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">将 NumPy 数组写入 CSV</h1><p id="4292" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">您可以使用<code class="fe ng nh ni nj b">np.savetxt()</code>方法将 Numpy 数组保存到一个 CSV 文件中。</p><p id="eb15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保:</p><ul class=""><li id="521e" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">添加”。csv”到文件名目的地，并且</li><li id="f97d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">将 delimiter 关键字设置为“，”</li></ul><p id="e3f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你不使用这两个设置，NumPy 将会把你的文件保存为. txt。</p><p id="ac2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CSV 文件可以很棒，因为它们是人类可读的。它们还有一个额外的好处，就是很容易加载到 pandas 或 Dask 数据帧中。</p><h1 id="a1da" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">写一维数组</h1><p id="00b4" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">让我们使用<code class="fe ng nh ni nj b">np.random.rand()</code>创建一个包含随机数的一维数组。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="3ddb" class="no mk it nj b gy np nq l nr ns">import numpy as np <br/># create 1D array <br/>a = np.array([1,2,3]) </span><span id="64fa" class="no mk it nj b gy nt nq l nr ns"># store in current directory <br/>np.savetxt( "a.csv", a, delimiter="," )</span></pre><p id="8da1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，NumPy 将按列写入数组。让我们检查一下<code class="fe ng nh ni nj b">a.csv</code>的内容以确认:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="9721" class="no mk it nj b gy np nq l nr ns">1<br/>2<br/>3</span></pre><p id="c1f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">改为按行写入数据，将<code class="fe ng nh ni nj b">newline</code> kwarg 设置为“，”(您的分隔符)。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="f006" class="no mk it nj b gy np nq l nr ns"># write array row-wise <br/>np.savetxt("very.csv", a, delimiter=",", newline=",")</span></pre><p id="7daa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以通过先将数组转换为 2D 数组来按行写入数组</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="56ff" class="no mk it nj b gy np nq l nr ns">np.savetxt("very.csv", [a], delimiter="," )</span></pre><p id="b6a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这两种情况下，<code class="fe ng nh ni nj b">very.csv</code>的内容会是这样的:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="96e1" class="no mk it nj b gy np nq l nr ns">1   2   3</span></pre><h1 id="4a93" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">写二维数组</h1><p id="d0d6" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">现在让我们创建一个二维 NumPy 数组并保存到 CSV。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="af60" class="no mk it nj b gy np nq l nr ns"># create 2D array <br/>b = np.array([1, 2, 3], [4, 5, 6]) </span><span id="ecd1" class="no mk it nj b gy nt nq l nr ns"># write 2D array to CSV <br/>np.savetxt( "merry.csv", b, delimiter="," )</span></pre><p id="77f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您所料，默认情况下，2D 数组是按行写入的。</p><p id="2410" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ng nh ni nj b">merry.csv</code>的内容:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="7c2e" class="no mk it nj b gy np nq l nr ns">1   2   3<br/>4   5   6</span></pre><h1 id="ac5f" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">写三维数组</h1><p id="677b" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">最后，让我们创建一个三维 NumPy 数组，并尝试将其保存为 CSV 格式。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="cd85" class="no mk it nj b gy np nq l nr ns"># create 3D array <br/>c = np.random.rand(3,3,3) </span><span id="c0c9" class="no mk it nj b gy nt nq l nr ns"># write 3D array to CSV <br/>np.savetxt( "christmas.csv", c, delimiter="," )</span></pre><p id="5ad2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这不管用。您将看到如下错误消息:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="1995" class="no mk it nj b gy np nq l nr ns">--------------------------------------------------------------------ValueError Traceback (most recent call last) /var/folders/ky/bqjn_gxn1xv0cn_8q5xvp3q40000gn/T/ipykernel_46872/1804416501.py in &lt;module&gt; ----&gt; 1 np.savetxt(f"{home}/Documents/numpy/bar.csv", c, delimiter=",") &lt;__array_function__ internals&gt; in savetxt(*args, **kwargs) ~/mambaforge/envs/numpy-zarr/lib/python3.9/site-packages/numpy/lib/npyio.py in savetxt(fname, X, fmt, delimiter, newline, header, footer, comments, encoding) 1380 # Handle 1-dimensional arrays 1381 if X.ndim == 0 or X.ndim &gt; 2: -&gt; 1382 raise ValueError( 1383 "Expected 1D or 2D array, got %dD array instead" % X.ndim) 1384 elif X.ndim == 1: </span><span id="80a8" class="no mk it nj b gy nt nq l nr ns">ValueError: Expected 1D or 2D array, got 3D array instead</span></pre><p id="79ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CSV 是一种可读的表格格式。这意味着只有 1D 和 2D NumPy 阵列可以写入 CSV。</p><h1 id="f4a6" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">用 np.save()保存 Numpy 数组</h1><p id="a17f" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在磁盘上存储 NumPy 数组的另一种方法是使用本机的<code class="fe ng nh ni nj b">np.save()</code>方法。这将以二进制文件格式存储您的数组。</p><p id="f8dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种格式允许您保存所有维度的 NumPy 数组。这意味着这些文件将不是人类可读的。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="4756" class="no mk it nj b gy np nq l nr ns"># save 3D array to binary NPY format <br/>np.save('christmas.npy', c)</span></pre><p id="1b1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看在 CSV 和 NPY 中存储的文件大小是否有区别。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="5423" class="no mk it nj b gy np nq l nr ns"># create medium-sized 2D array <br/>d = np.random.rand(100,100) </span><span id="785e" class="no mk it nj b gy nt nq l nr ns"># save 2D array to CSV format <br/>np.savetxt( f"time.csv", d, delimiter="," ) </span><span id="402e" class="no mk it nj b gy nt nq l nr ns"># get the size (in bytes) of the stored .npy file <br/>! stat -f '%z' time.csv</span></pre><p id="3e17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi">&gt;&gt;&gt; 250000</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="24d3" class="no mk it nj b gy np nq l nr ns"># save 2D array to binary NPY format <br/>np.save('time.npy', d) </span><span id="a6ab" class="no mk it nj b gy nt nq l nr ns"># get the size (in bytes) of the stored .npy file <br/>! stat -f '%z' time.npy</span></pre><p id="98e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi">&gt;&gt;&gt; 80128</p><p id="ec06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，与 250KB 的 CSV 相比，NPY 文件格式输出的文件更小:大约 80KB。</p><h1 id="e1f4" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">保存 NumPy 数组的其他方法</h1><p id="60de" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">还有其他存储 NumPy 数组的方法。<a class="ae ky" href="https://mungingdata.com/numpy/save-numpy-text-txt/" rel="noopener ugc nofollow" target="_blank">这里有一篇很棒的博文</a>向你展示了如何将 NumPy 数组写入 TXT 文件。</p><p id="f169" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从技术上讲，您也可以使用<code class="fe ng nh ni nj b">np.ndarray.tofile()</code>方法，但是这将把数组编码成依赖于平台的二进制格式，所以通常不推荐使用。</p><h1 id="23e0" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">NumPy 阵列的并行读/写</h1><p id="cf7e" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">如果你处理的是小的本地数据，上面提到的格式就可以了。</p><p id="2f60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但许多真实世界的数据集与小型和本地数据集相反:它们非常大(通常比本地内存大)并且基于云。这意味着您需要并行读写 NumPy 数组。</p><p id="dd8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">NPY 文件格式不允许并行读取和写入。</p><h1 id="cb84" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">改为将数组写入 Zarr</h1><p id="5037" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">如果您需要并行读/写，那么将 NumPy 数组写成 Zarr 文件格式是一个不错的选择。Zarr 是一种存储任何维度的分块和压缩数组的格式。这意味着你可以通过一次处理多个块来并行读写你的数组<strong class="lb iu"/>；通过使用类似<a class="ae ky" href="https://dask.org/" rel="noopener ugc nofollow" target="_blank"> Dask </a>的并行处理库。</p><p id="9bfc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与前面提到的所有其他文件格式相比，这有两个重要的好处:</p><ol class=""><li id="ca85" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nu mb mc md bi translated">您可以更快地读/写数组</li><li id="4858" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nu mb mc md bi translated">您可以读取/写入超出本地计算机内存的数组</li></ol><h1 id="4beb" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">结论</h1><p id="0d67" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">使用<code class="fe ng nh ni nj b">np.savetxt()</code>方法- <strong class="lb iu">可以将 NumPy 数组写入 CSV，但前提是</strong>你的数组只有 2 维或更少。</p><p id="a194" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">二进制 NPY 格式比 CSV 更节省内存，但它不是人类可读的，也不能并行处理。</p><p id="134e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果数据集非常大，并行编写 NumPy 数组会快得多，并且可以避免内存错误。使用 Zarr 文件格式并行读写 NumPy 数组。</p></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><p id="026b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在 Twitter 上关注我，获取更多类似的内容。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><p id="dfdd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="oe">原载于 2021 年 12 月 25 日 http://crunchcrunchhuman.com</em><a class="ae ky" href="https://crunchcrunchhuman.com/2021/12/25/numpy-save-csv-write/" rel="noopener ugc nofollow" target="_blank"><em class="oe"/></a><em class="oe">。</em></p></div></div>    
</body>
</html>