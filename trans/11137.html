<html>
<head>
<title>PyQt &amp; Relational Databases — Data Format</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PyQt和关系数据库—数据格式</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pyqt-relational-databases-data-format-36907b427b8?source=collection_archive---------11-----------------------#2021-10-31">https://towardsdatascience.com/pyqt-relational-databases-data-format-36907b427b8?source=collection_archive---------11-----------------------#2021-10-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="8e20" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">数据</h2><div class=""/><div class=""><h2 id="874a" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">PyQt为关系数据库数据表示提供了一种方便的方式。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/76edc5f1f35e0c93ddd914109f135ce8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HbclsZAIXhQGeh_H6ve-zQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">按作者排列图像，按像素排列背景</p></figure><h2 id="2eb7" class="lh li it bd lj lk ll dn lm ln lo dp lp lq lr ls lt lu lv lw lx ly lz ma mb iz bi translated">模型-视图设计模式</h2><p id="b93a" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk lq ml mm mn lu mo mp mq ly mr ms mt mu im bi translated"><code class="fe mv mw mx my b">QTableView</code>小部件是向用户呈现数据的一种方便灵活的方式。</p><p id="7412" class="pw-post-body-paragraph mc md it me b mf mz kd mh mi na kg mk lq nb mm mn lu nc mp mq ly nd ms mt mu im bi translated">此外，它可以有效地处理关系数据库，并且不用强调它完全符合模型-视图-控制器设计模式。</p><p id="c123" class="pw-post-body-paragraph mc md it me b mf mz kd mh mi na kg mk lq nb mm mn lu nc mp mq ly nd ms mt mu im bi translated">我们已经知道如何连接到数据库并从关系表中显示数据。</p><p id="4ae5" class="pw-post-body-paragraph mc md it me b mf mz kd mh mi na kg mk lq nb mm mn lu nc mp mq ly nd ms mt mu im bi translated">最有价值的好处是我们不需要SQL语言专业知识。众所周知，掌握SQL查询是一项长期任务。</p><h2 id="dab7" class="lh li it bd lj lk ll dn lm ln lo dp lp lq lr ls lt lu lv lw lx ly lz ma mb iz bi translated">为什么数据格式很重要</h2><p id="ccbc" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk lq ml mm mn lu mo mp mq ly mr ms mt mu im bi translated">现在，让我们使我们的数据对人眼更有吸引力。</p><p id="60c3" class="pw-post-body-paragraph mc md it me b mf mz kd mh mi na kg mk lq nb mm mn lu nc mp mq ly nd ms mt mu im bi translated">数据格式在数据科学中起着重要的作用。人们必须知道他们面对的是什么数据。没有正确的格式，数据就不能得到有效的利用。</p><h2 id="7d9e" class="lh li it bd lj lk ll dn lm ln lo dp lp lq lr ls lt lu lv lw lx ly lz ma mb iz bi translated">本文是PyQt &amp;关系数据库系列的一部分:</h2><div class="ne nf gp gr ng"><div role="button" tabindex="0" class="ab bv gv cb fp nh ni bn nj lb ex"><div class="nk l"><div class="ab q"><div class="l di"><img alt="Stefan Melo" class="l de bw nl nm fe" src="../Images/b28b9ceb41c488532f34fbb9b4e5b485.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*ulugY22Ollx0QvWgTOPQSg.jpeg"/><div class="fb bw l nl nm fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated">斯特凡·梅洛</p></div></div><div class="np nq gw l"><h2 class="bd jd un pa fp uo fr fs pv fu fw jc bi translated">PyQt &amp;关系数据库系列</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi up au uq ur us re ut an eh ei uu uv uw el em eo de bk ep" href="https://melo-stefan.medium.com/list/pyqt-relational-databases-series-9ded67b27631?source=post_page-----36907b427b8--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="ux l fo"><span class="bd b dl z dk">6 stories</span></div></div></div><div class="oc dh od fp ab oe fo di"><div class="di nu bv nv nw"><div class="dh l"><img alt="" class="dh" src="../Images/edba3e23850732675eaf821bf15d8dfe.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*-lqsR31ZIk0x2h0I"/></div></div><div class="di nu bv nx ny nz"><div class="dh l"><img alt="" class="dh" src="../Images/dac62b021212cceabb22d8eb8de637ba.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*hGqwpPX6N-yLYsC4"/></div></div><div class="di bv oa ob nz"><div class="dh l"><img alt="" class="dh" src="../Images/f544d0802f13c5585dbcd029343af724.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*s6zoQDf6AOkb-_ET"/></div></div></div></div></div></div><div class="ab cl oj ok hx ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="im in io ip iq"><h2 id="b229" class="lh li it bd lj lk ll dn lm ln lo dp lp lq lr ls lt lu lv lw lx ly lz ma mb iz bi translated">PyQt中的MVC</h2><p id="3b27" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk lq ml mm mn lu mo mp mq ly mr ms mt mu im bi translated"><em class="oq">模型-视图-控制器</em> (MVC)是一种<em class="oq">软件设计模式</em>，通常用于开发用户界面，以分离内部信息表示(<em class="oq">模型</em>)和它们如何呈现(<em class="oq">视图</em>)之间的逻辑。</p><p id="9678" class="pw-post-body-paragraph mc md it me b mf mz kd mh mi na kg mk lq nb mm mn lu nc mp mq ly nd ms mt mu im bi translated"><em class="oq">控制器</em>接受输入并将其转化为模型或视图的指令。</p><p id="10dc" class="pw-post-body-paragraph mc md it me b mf mz kd mh mi na kg mk lq nb mm mn lu nc mp mq ly nd ms mt mu im bi translated">PyQt将视图和控制器合并成一个元素。当视图和控制器元素结合成一个时，结果就是<em class="oq">模型-视图</em>设计架构。</p><p id="5f77" class="pw-post-body-paragraph mc md it me b mf mz kd mh mi na kg mk lq nb mm mn lu nc mp mq ly nd ms mt mu im bi translated">PyQt有不同的模型类和各自的视图类。下表显示了匹配的模型基础。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi or"><img src="../Images/24b0f39fbf1754399f62f27926769b58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*88vbULjkoZkYUP1R6_Rc6w.png"/></div></div></figure><h2 id="7f47" class="lh li it bd lj lk ll dn lm ln lo dp lp lq lr ls lt lu lv lw lx ly lz ma mb iz bi translated">自己展示你的数据</h2><p id="af9e" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk lq ml mm mn lu mo mp mq ly mr ms mt mu im bi translated">为了更好地控制数据的显示方式，我们将定制模型。</p><p id="65f2" class="pw-post-body-paragraph mc md it me b mf mz kd mh mi na kg mk lq nb mm mn lu nc mp mq ly nd ms mt mu im bi translated">在模型-视图架构中，要编写一个<em class="oq">定制模型</em>，我们必须子类化一个适当的抽象模型。</p><p id="1eb8" class="pw-post-body-paragraph mc md it me b mf mz kd mh mi na kg mk lq nb mm mn lu nc mp mq ly nd ms mt mu im bi translated">对于我们的例子来说，<code class="fe mv mw mx my b">QAbstractTableModel</code>正是我们所需要的。然而，<code class="fe mv mw mx my b">QAbstractTableModel</code>是一个<em class="oq">抽象基类</em>，对于其他编程语言来说，它被称为<em class="oq">接口</em>。直接用的话就不行了。定制表格需要实现的最小方法是<code class="fe mv mw mx my b">data</code>和<code class="fe mv mw mx my b">rowCount</code>。</p><p id="c227" class="pw-post-body-paragraph mc md it me b mf mz kd mh mi na kg mk lq nb mm mn lu nc mp mq ly nd ms mt mu im bi translated"><code class="fe mv mw mx my b">data</code>方法返回表格数据。而<code class="fe mv mw mx my b">rowCount</code>方法必须返回数据源的维度。</p><h2 id="46f3" class="lh li it bd lj lk ll dn lm ln lo dp lp lq lr ls lt lu lv lw lx ly lz ma mb iz bi translated">修改前面的代码</h2><p id="646e" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk lq ml mm mn lu mo mp mq ly mr ms mt mu im bi translated">为了从我们的<code class="fe mv mw mx my b">data</code>方法返回一些数据，我们需要修改我们已经拥有的代码。数据将来自我们的关系数据模型。否则，我们将失去关系表的功能。</p><p id="0d7b" class="pw-post-body-paragraph mc md it me b mf mz kd mh mi na kg mk lq nb mm mn lu nc mp mq ly nd ms mt mu im bi translated">因此，我们没有使用<code class="fe mv mw mx my b">view.setModel(model)</code>，而是使用了一个新的模型<code class="fe mv mw mx my b">view.setModel(presentation_model)</code>，它将从我们现有的关系表<code class="fe mv mw mx my b">model</code>中获取数据。修改后的代码如下所示:</p><pre class="ks kt ku kv gt os my ot ou aw oi bi"><span id="b38b" class="lh li it my b gy ov ow l ox oy">class MainWindow(QMainWindow):<br/>    def __init__(self, parent = None):<br/>        super().__init__(parent)</span><span id="e7a8" class="lh li it my b gy oz ow l ox oy">        self.setWindowTitle('QTableView Example')</span><span id="d2c5" class="lh li it my b gy oz ow l ox oy">        # Setup the model<br/>        model = QSqlRelationalTableModel(self)<br/>        model.setTable('orders')<br/>        model.setRelation(2, QSqlRelation('customers', 'CustomerID', 'Customer'))<br/>        model.setRelation(3, QSqlRelation('products', 'ProductID', 'Product'))<br/>        model.setRelation(1, QSqlRelation('products', 'ProductID', 'Price'))<br/>        model.select()</span><span id="a75b" class="lh li it my b gy oz ow l ox oy">        # Create the presentation model, which gets data from relational table model<br/>        <strong class="my jd">presentation_model = MyTableModel(model)</strong></span><span id="1620" class="lh li it my b gy oz ow l ox oy">        # Setup the view<br/>        view = QTableView(self)<br/>        <strong class="my jd">view.setModel(presentation_model)</strong><br/>        view.resizeColumnsToContents()<br/>        self.setCentralWidget(view)</span></pre><h2 id="8ea6" class="lh li it bd lj lk ll dn lm ln lo dp lp lq lr ls lt lu lv lw lx ly lz ma mb iz bi translated">展示模型</h2><p id="a8cd" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk lq ml mm mn lu mo mp mq ly mr ms mt mu im bi translated">但是这个神秘的<code class="fe mv mw mx my b">MyTableModel</code>班是什么？它从哪里来？这是我们新的<code class="fe mv mw mx my b">QAbstractTableModel</code>子类。让我们创造它。</p><pre class="ks kt ku kv gt os my ot ou aw oi bi"><span id="b15b" class="lh li it my b gy ov ow l ox oy">class MyTableModel(<strong class="my jd">QAbstractTableModel</strong>):<br/>    def __init__(self, <strong class="my jd">model</strong>):<br/>        super().__init__(model)</span><span id="a355" class="lh li it my b gy oz ow l ox oy">        self._model = model</span><span id="9a42" class="lh li it my b gy oz ow l ox oy">    # Create the data method<br/>    def data(self, <strong class="my jd">index</strong>, <strong class="my jd">role</strong>):<br/>    <br/>        if role == Qt.ItemDataRole.DisplayRole:<br/>            value = self._model.record(index.row()).value(index.column())<br/>            if isinstance(value, int) and index.column() == 1:<br/>                # Format the currency value<br/>                return "${: ,.2f}".format(value)<br/>            return value</span><span id="4756" class="lh li it my b gy oz ow l ox oy">    # Create the headerData method<br/>    def headerData(self, <strong class="my jd">section</strong>: int, <strong class="my jd">orientation</strong>: Qt.Orientation, <strong class="my jd">role</strong>: int):<br/>        if role == Qt.ItemDataRole.DisplayRole and orientation == Qt.Orientation.Horizontal:<br/>            return self._model.headerData(section, orientation, role=role)</span><span id="3fe0" class="lh li it my b gy oz ow l ox oy">    # Create the rowCount method<br/>    def rowCount(self, parent: QModelIndex) -&gt; int:<br/>        return self._model.rowCount()</span><span id="80c4" class="lh li it my b gy oz ow l ox oy">    # Create the columnCount method<br/>    def columnCount(self, parent: QModelIndex) -&gt; int:<br/>        return self._model.columnCount()</span></pre><p id="9721" class="pw-post-body-paragraph mc md it me b mf mz kd mh mi na kg mk lq nb mm mn lu nc mp mq ly nd ms mt mu im bi translated">让我们来评论一些重要的细节:</p><ul class=""><li id="a93d" class="pa pb it me b mf mz mi na lq pc lu pd ly pe mu pf pg ph pi bi translated">一定不要忘记导入几个模块:<br/> <code class="fe mv mw mx my b">from PyQt6.QtCore import QAbstractTableModel, QModelIndex, Qt</code></li><li id="e53b" class="pa pb it me b mf pj mi pk lq pl lu pm ly pn mu pf pg ph pi bi translated"><code class="fe mv mw mx my b">__init__</code>构造函数只接受一个参数<code class="fe mv mw mx my b">model</code>。<br/>我们将它存储在<code class="fe mv mw mx my b">self._model</code>中，以便在我们的方法中访问它。</li><li id="2d1d" class="pa pb it me b mf pj mi pk lq pl lu pm ly pn mu pf pg ph pi bi translated"><code class="fe mv mw mx my b">data</code>方法首先寻找显示<code class="fe mv mw mx my b">role</code>。当找到它时，我们得到<code class="fe mv mw mx my b">value</code>并检查需要格式化的列。最后，该方法为演示返回一个格式化的<code class="fe mv mw mx my b">value</code>。</li><li id="250d" class="pa pb it me b mf pj mi pk lq pl lu pm ly pn mu pf pg ph pi bi translated"><code class="fe mv mw mx my b">headerData</code>方法寻找<code class="fe mv mw mx my b">role</code>和<code class="fe mv mw mx my b">orientation</code>。当方向为<code class="fe mv mw mx my b">horizontal</code>时，返回可用的表头。因为我们没有定义行标题，所以行标题是隐藏的。</li><li id="f59a" class="pa pb it me b mf pj mi pk lq pl lu pm ly pn mu pf pg ph pi bi translated">尽管我们已经创建了<code class="fe mv mw mx my b">rowCount</code>和<code class="fe mv mw mx my b">columnCount</code>方法，但它们目前什么也做不了。但是，我们稍后会用到它们。</li></ul><h2 id="59ff" class="lh li it bd lj lk ll dn lm ln lo dp lp lq lr ls lt lu lv lw lx ly lz ma mb iz bi translated">结论</h2><p id="0eb5" class="pw-post-body-paragraph mc md it me b mf mg kd mh mi mj kg mk lq ml mm mn lu mo mp mq ly mr ms mt mu im bi translated">只要对代码稍加更新，我们就可以用我们喜欢的任何方式格式化数据。结果如下:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi po"><img src="../Images/cf971aa96174293ff02edcfc8bb31e20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*djTGky2i12b_8OlBiI8xtA.png"/></div></div></figure><p id="00af" class="pw-post-body-paragraph mc md it me b mf mz kd mh mi na kg mk lq nb mm mn lu nc mp mq ly nd ms mt mu im bi translated">接下来，我们将看看其他一些格式，并开始修改数据。</p><p id="552a" class="pw-post-body-paragraph mc md it me b mf mz kd mh mi na kg mk lq nb mm mn lu nc mp mq ly nd ms mt mu im bi translated"><strong class="me jd"> <em class="oq">如果你想阅读更多这样的内容，成为会员:</em> </strong></p><div class="ne nf gp gr ng pp"><a href="https://melo-stefan.medium.com/membership" rel="noopener follow" target="_blank"><div class="pq ab fo"><div class="pr ab ps cl cj pt"><h2 class="bd jd gy z fp pu fr fs pv fu fw jc bi translated">通过我的推荐链接加入Medium-Stefan Melo</h2><div class="pw l"><h3 class="bd b gy z fp pu fr fs pv fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="px l"><p class="bd b dl z fp pu fr fs pv fu fw dk translated">melo-stefan.medium.com</p></div></div><div class="py l"><div class="pz l qa qb qc py qd lb pp"/></div></div></a></div><p id="99f8" class="pw-post-body-paragraph mc md it me b mf mz kd mh mi na kg mk lq nb mm mn lu nc mp mq ly nd ms mt mu im bi translated"><strong class="me jd"> <em class="oq">或者你可以订阅我下面的简讯。谢谢你。</em>T29】</strong></p></div></div>    
</body>
</html>