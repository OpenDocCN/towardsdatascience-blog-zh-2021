<html>
<head>
<title>Designing &amp; Implementing An NFL Analytics Tool in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用R语言设计和实现NFL分析工具</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/designing-implementing-an-nfl-analytics-tool-in-r-3532034b7ff2?source=collection_archive---------19-----------------------#2021-09-16">https://towardsdatascience.com/designing-implementing-an-nfl-analytics-tool-in-r-3532034b7ff2?source=collection_archive---------19-----------------------#2021-09-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4a0b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让自己在日常生活中运用分析技巧</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c1ddcf770c6fc1a04a2f9291fa31c3d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aGP5K0HiZG80AUBr"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">戴夫·阿达姆松在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="3577" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为一名数据科学专业人员，我欣赏分析工具的设计和实施，这些工具为组织内的关键利益相关者提供数据驱动的见解。这些工具的结构和功能各不相同，从嵌入在业务报告应用程序中的生产级机器学习系统，到针对半常规用例跨多种编程语言手动执行的脚本。不管一个工具看起来像什么，创造和开发的过程是这些工具成功背后的驱动力，可以应用于商业和娱乐。随着2021年国家橄榄球联盟赛季的开始，我决定建立一个解决方案，让我能够灵活地分析NFL的比赛数据，以收集见解。通过这个，我希望展示一些我在职业生涯中使用的成功实践。我很感激对这篇文章内容的任何评论。</p><p id="601d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可能会觉得有趣的是，我将在这个项目中使用R。目前，Python似乎是数据科学和分析专业人士首选的主要编程语言；以至于有些文章甚至觉得没有必要明确指出他们是在用Python编码。我相信这两种语言都为我可能会在这里做的绝大多数事情提供了很好的解决方案，而且在<a class="ae kv" href="https://dplyr.tidyverse.org/" rel="noopener ugc nofollow" target="_blank"> dplyr </a>被创造出来之前我就已经在使用R了，所以我对它更加得心应手。可能的话，我会用不同的方式来计算事物，以展示语言的多样性。最后，我在PC上通过RStudio使用R 4.0.4。</p><p id="6db2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们从确定项目范围和目的开始。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="9cd5" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated"><strong class="ak">定义目的&amp;分析解决方案的范围</strong></h2><p id="b63a" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">对项目范围的全面考虑将引出分析解决方案的目的。在这个发现阶段，我向组织提出的一些问题包括:</p><ul class=""><li id="1277" class="mx my iq ky b kz la lc ld lf mz lj na ln nb lr nc nd ne nf bi translated">用例影响哪些业务部门？</li><li id="b424" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">谁是解决方案的最终用户或消费者？这些观众的专业技术水平如何？</li><li id="5fb9" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">该解决方案要解决的关键难点是什么？</li><li id="4a4f" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">对关键利益相关者来说，成功是什么样的？</li><li id="7f75" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">需要哪些数据？需要外部获取吗？</li><li id="1d41" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">这是一次性的事情，还是一个重复的过程？</li><li id="37e2" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">什么类型的定量工具可以增加价值而不牺牲效用？</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/ac13f9a533f14c518a6f4a2accb6c96d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hw-eUWVN_5MULtIzh_Q-QA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图一。作者图片</p></figure><p id="1a3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我还考虑任何项目的高级过程流，以识别核心结构和功能。通常，分析解决方案从数据源开始。提取、转换、预处理和特征工程被执行以“清洗”数据流；这包括操作和网络安全方面的考虑。探索性数据分析将确定数据完整性和准确性问题。一旦完成这些步骤(有时不止一次)，清理后的数据将以可访问的方式存储在长期和/或短期存储中，并根据需要创建连续收集和存储的方法。</p><p id="827e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在构建了这个关键的基础设施之后，功能层提供了进一步的处理和量化方法来满足项目的需求。</p><p id="f461" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">考虑到我对这种解决方案的随意使用，我不必太担心耐用性或生产化。我是最终用户。只是一个真正喜欢看和分析NFL比赛的人。我在几个梦幻足球联盟踢球，并且住在一个体育博彩合法的州。我希望有一种方法来动态地检查游戏，测试假设，并比较玩家和团队。灵活性对我来说将是关键，因为我想随着赛季的进展增加功能。我认为现在这个解决方案的目的是为我编写函数和脚本提供上面R中描述的基础设施。</p><p id="51bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就我的数据要求而言，这意味着什么？我想要至少三年的详细数据。我最有可能使用web抓取或API来收集这些数据。我想在本地存储清理后的数据；我不需要不断地导入和处理多年的数据。我想每周收集新数据。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="89b6" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated"><strong class="ak">建立或利用现有的数据管道</strong></h2><p id="9650" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">通常，我不想以可靠和准确的形式编写已经存在的代码。比如我不手动计算vector的平均值；我总是用<em class="nm">表示(x)。</em>它存在，它是正确的，它节省我的时间。我会一直尝试以合法的方式识别和利用来自知名来源的现有软件包。考虑到我目前没有任何内部数据源，我将把我的数据收集选项限制为从一个数据源手动抓取这些数据或者识别一个可靠且准确的API。我发现了一些开源的R包，它们提供了获取、清理和转换NFL比赛数据的高级功能，<em class="nm">NFL scrapr</em>&amp;<em class="nm">NFL fastr</em>。前者通过NFL.com JSON提要获取数据，而后者依赖于第三方JSON提要。在查阅文档之后，我决定使用<a class="ae kv" href="https://www.nflfastr.com/" rel="noopener ugc nofollow" target="_blank"> <em class="nm"> nflfastR </em> </a>，主要是因为它似乎是一个更大的生态系统<a class="ae kv" href="https://github.com/nflverse" rel="noopener ugc nofollow" target="_blank"> <em class="nm"> nflverse </em> </a>的一部分。我鼓励你通过上面的链接查看他们的网站，以便你自己进行评论。在这个集合中还有其他几个有趣的包，稍后我将会看一看。</p><p id="99ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我开始使用这个包之前，我想尽可能多地了解所使用的方法。这样，我将能够预测输出并识别边缘情况，以及了解解决方案将使用哪些功能，以及我必须定制或在其他地方找到哪些功能。<a class="ae kv" href="https://cran.r-project.org/web/packages/nflfastR/nflfastR.pdf" rel="noopener ugc nofollow" target="_blank">官方文档</a>和<a class="ae kv" href="https://www.nflfastr.com/articles/beginners_guide.html" rel="noopener ugc nofollow" target="_blank">用户指南</a>为使用和实施提供了很好的信息。</p><p id="6b01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我需要检查任何其他的包依赖或需求。根据您的设置，您可能需要安装或更新某些项目。您可以使用<em class="nm"> utils </em>中的<em class="nm"> available.packages() </em>来检查包的依赖性和导入，并查找相应的包:</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="7bf8" class="lz ma iq no b gy ns nt l nu nv">pkgs&lt;-available.packages()<br/>pkgs["nflfastR", c("Depends","Imports")]</span></pre><p id="0f57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我最后不得不安装<em class="nm"> gsisdecoder </em>来解码玩家id和更新<em class="nm"> Rcpp。</em></p><p id="1652" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">经过审查，<em class="nm"> nflfastR </em>通过一个由几种不同格式的文件组成的<a class="ae kv" href="https://github.com/nflverse/nfldata" rel="noopener ugc nofollow" target="_blank"> Github存储库</a>提供NFL的详细比赛数据(你可以在本文末尾找到版权和许可信息)。对于倾向于Python的人，该团队提供了一种在他们的站点上导入这些数据的简洁方法。首先，您必须从<em class="nm">fast _ scraper _ schedules():</em>a<a class="ae kv" href="https://tibble.tidyverse.org/" rel="noopener ugc nofollow" target="_blank">tible</a>中获取17列的结果。第一列称为<em class="nm"> game_id </em>，用作获取数据的输入。让我们获取数据并进行探索；注意为了简洁起见，我将排除一些输出:</p><ul class=""><li id="b14d" class="mx my iq ky b kz la lc ld lf mz lj na ln nb lr nc nd ne nf bi translated">标识返回的数据对象的类别</li><li id="c511" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">看看数据对象的结构</li><li id="7bed" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">看一个实际数据的例子</li><li id="1c22" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">确定游戏的总数</li><li id="a1ba" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">按赛季周检查比赛数量</li></ul><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="74b6" class="lz ma iq no b gy ns nt l nu nv">library(gsisdecoder)<br/>library(nflfastR)</span><span id="8e44" class="lz ma iq no b gy nw nt l nu nv">game_ids_2021&lt;-fast_scraper_schedules(2021)</span><span id="3319" class="lz ma iq no b gy nw nt l nu nv">class(game_ids_2021)<br/># [1] "tbl_df"     "tbl"        "data.frame"</span><span id="3255" class="lz ma iq no b gy nw nt l nu nv">str(game_ids_2021)<br/># tibble [269 x 17] (S3: tbl_df/tbl/data.frame)<br/># $ game_id    : chr [1:269] "2020_01_HOU_KC" "2020_01_SEA_ATL" "2020_01_CLE_BAL" "2020_01_NYJ_BUF" ...<br/># $ season     : int [1:269] 2020 2020 2020 2020 2020 2020 2020 2020 2020 2020 ...<br/># $ game_type  : chr [1:269] "REG" "REG" "REG" "REG" ...<br/># $ week       : int [1:269] 1 1 1 1 1 1 1 1 1 1 ...<br/># $ gameday    : chr [1:269] "2020-09-10" "2020-09-13" "2020-09-13" "2020-09-13" ...<br/># $ weekday    : chr [1:269] "Thursday" "Sunday" "Sunday" "Sunday" ...<br/># $ gametime   : chr [1:269] "20:20" "13:00" "13:00" "13:00" ...<br/># $ away_team  : chr [1:269] "HOU" "SEA" "CLE" "NYJ" ...<br/># $ home_team  : chr [1:269] "KC" "ATL" "BAL" "BUF" ...<br/># $ away_score : int [1:269] 20 38 6 17 34 27 20 43 11 17 ...<br/># $ home_score : int [1:269] 34 25 38 27 30 23 27 34 21 27 ...<br/># $ home_result: int [1:269] 14 -13 32 10 -4 -4 7 -9 10 10 ...<br/># $ stadium    : chr [1:269] "Arrowhead Stadium" "Mercedes-Benz Stadium" "M&amp;T Bank Stadium" "New Era Field" ...<br/># $ location   : chr [1:269] "Home" "Home" "Home" "Home" ...<br/># $ roof       : chr [1:269] "outdoors" "closed" "outdoors" "outdoors" ...<br/># $ surface    : chr [1:269] "astroturf" "fieldturf" "grass" "astroturf" ...<br/># $ old_game_id: chr [1:269] "2020091000" "2020091300" "2020091301" "2020091302" ...head(game_ids_2021)</span><span id="61cb" class="lz ma iq no b gy nw nt l nu nv">head(game_ids_2021)</span><span id="acb6" class="lz ma iq no b gy nw nt l nu nv">nrow(game_ids_2021)<br/># [1] 272</span><span id="71ac" class="lz ma iq no b gy nw nt l nu nv">count(game_ids_2021, week)<br/># A tibble: 18 x 2<br/>#     week     n<br/>#   &lt;int&gt; &lt;int&gt;<br/>#  1     1    16<br/>#  2     2    16<br/>#  3     3    16<br/>#  4     4    16<br/>#  5     5    16<br/>#  6     6    14<br/>#  7     7    13<br/>#  8     8    15<br/>#  9     9    14<br/># 10    10    14<br/># 11    11    15<br/># 12    12    15<br/># 13    13    14<br/># 14    14    14<br/># 15    15    16<br/># 16    16    16<br/># 17    17    16<br/># 18    18    16</span></pre><p id="4632" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们知道了返回对象的列名和数据类型。不要忘记，由于多了一场常规赛，我们今年还有18周。此外，请注意数据流的节奏似乎足以满足我的需求；我们有所有第1周的数据，而且似乎每天都在更新。这可以通过上面链接的Github repo看出来。</p><p id="b3fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个包的主要功能是加载和解析原始的逐场播放数据，这个功能是<em class="nm"> fast_scraper()，</em>，它从<em class="nm">fast _ scraper _ schedules()</em>中提取结果的一个子集，这是一个<a class="ae kv" href="https://tibble.tidyverse.org/" rel="noopener ugc nofollow" target="_blank">tible</a>，列为<em class="nm"> game_id。</em>同时，通过<em class="nm"> clean_pbp() </em>执行清理原始数据的动作。本质上，这个函数构建了我们将要保存和构建功能的数据结构。还有几种创建特征的方法，包括<em class="nm"> add_qb_epa()、add_xyac()、add_xpass() </em>。这个包背后的团队已经开发了<strong class="ky ir"><em class="nm">build _ nflfastR _ pbp()</em></strong>，这是一个调用这五个函数的高级函数，以及<em class="nm"> decode_player_ids() </em>，它为所有球员创建了一个标准的GSIS ID字段，用于以后的球员统计。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="e270" class="lz ma iq no b gy ns nt l nu nv"># Subset the 2021 schedule to obtain Week 1 games;<br/># You can do it many different ways.<br/># Through dplyr, with and without the standard syntax:</span><span id="9f1c" class="lz ma iq no b gy nw nt l nu nv">game_ids&lt;-subset(game_ids_2021, week == 1, select = “game_id”)<br/>game_ids</span><span id="207e" class="lz ma iq no b gy nw nt l nu nv">game_ids&lt;-game_ids_2021$game_id %&gt;% filter(week ==1)<br/>game_ids&lt;-game_ids$game_id</span><span id="987b" class="lz ma iq no b gy nw nt l nu nv"># Or use vectorization <br/>game_ids&lt;-game_ids_2021[game_ids_2021$week == 1, colnames(game_ids_2021)==”game_id”]</span><span id="49e6" class="lz ma iq no b gy nw nt l nu nv"># Run the ETL pipeline <br/>pbp_data_2021&lt;-build_nflfastR_pbp(game_ids, decode = TRUE)</span></pre><p id="b75f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经有了管道的结果，让我们研究数据以了解它的结构并检查质量问题。虽然我在这里只处理一些事情，但是这是您想要进行EDA最佳实践的地方。</p><ul class=""><li id="48d1" class="mx my iq ky b kz la lc ld lf mz lj na ln nb lr nc nd ne nf bi translated">查看数据集的结构，包括它的维度</li><li id="64bb" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">通过一些关键分组变量检查观察值的分布</li><li id="be71" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">查找任何缺少的值，并获取键列的不同值</li></ul><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="1f3b" class="lz ma iq no b gy ns nt l nu nv"># Understand the structure of the play-by-play data</span><span id="5f21" class="lz ma iq no b gy nw nt l nu nv">str(pbp_data_2021)<br/>class(pbp_data_2021)<br/># [1] "tbl_df"     "tbl"        "data.frame"<br/>ncol(pbp_data_2021)<br/># [1] 372<br/>nrow(pbp_data_2021)<br/># [1] 2911</span><span id="e3fd" class="lz ma iq no b gy nw nt l nu nv"># Look at the number of plays by game for Week 1</span><span id="5e5e" class="lz ma iq no b gy nw nt l nu nv">count(pbp_data_2021, game_id)<br/># A tibble: 16 x 2<br/>#   game_id             n<br/>#   &lt;chr&gt;           &lt;int&gt;<br/># 1 2021_01_ARI_TEN   182<br/># 2 2021_01_BAL_LV    213<br/># 3 2021_01_CHI_LA    155<br/># 4 2021_01_CLE_KC    165<br/># 5 2021_01_DAL_TB    203<br/># 6 2021_01_DEN_NYG   159<br/># 7 2021_01_GB_NO     156<br/># 8 2021_01_JAX_HOU   206<br/># 9 2021_01_LAC_WAS   178<br/># 10 2021_01_MIA_NE    164<br/># 11 2021_01_MIN_CIN   212<br/># 12 2021_01_NYJ_CAR   175<br/># 13 2021_01_PHI_ATL   191<br/># 14 2021_01_PIT_BUF   189<br/># 15 2021_01_SEA_IND   169<br/># 16 2021_01_SF_DET    194</span><span id="d60d" class="lz ma iq no b gy nw nt l nu nv"># Look for NAs/missing values in the play_id column</span><span id="8010" class="lz ma iq no b gy nw nt l nu nv">nrow(pbp_data_2021[is.na(pbp_data_2021$play_id),])<br/># [1] 0</span><span id="7767" class="lz ma iq no b gy nw nt l nu nv"># Obtain distinct values for the column play_type</span><span id="9f71" class="lz ma iq no b gy nw nt l nu nv">pbp_data_2021 %&gt;% distinct(play_type)<br/># A tibble: 10 x 1<br/>#  play_type  <br/>#   &lt;chr&gt;      <br/># 1 NA         <br/># 2 kickoff    <br/># 3 run        <br/># 4 pass       <br/># 5 punt       <br/># 6 no_play    <br/># 7 field_goal <br/># 8 extra_point<br/># 9 qb_spike   <br/># 10 qb_kneel</span></pre><p id="f9ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这一点上，我们已经取得了2021年NFL的比赛数据，净化了它，并审查了结果的问题和见解。一旦我感到满意，我会将结果保存到本地驱动器，以备将来使用。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="e52f" class="lz ma iq no b gy ns nt l nu nv">save(pbp_data_2021, file = “nfl_pbp_data_2021.RData”)</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="4fc4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我应用了我在专业数据科学环境中使用的一些原则，为我的一个爱好设计和构建了一个分析解决方案。我希望我已经激励你也这样做了。虽然我的工具的基础结构已经设计好了，但是在这个基础结构上构建功能将是以后文章的主题。我也将进行分析来检查NFL的所有事情，希望我能把我获得的经验传递给其他人。我将以一个小例子来结束，说明我们如何从数据中获取有价值的信息。</p><p id="1251" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">出于各种原因，看看NFL进攻的跑位/传球分类可能会很有趣。让我们使用dplyr的<em class="nm"> left_join() </em>函数来检查第1周的情况。请注意，team的<em class="nm"> NA </em>值表示暂停和季末等比赛，应该忽略。</p><pre class="kg kh ki kj gt nn no np nq aw nr bi"><span id="df06" class="lz ma iq no b gy ns nt l nu nv"># Get run and pass plays by team and join together</span><span id="f2ca" class="lz ma iq no b gy nw nt l nu nv">run_plays&lt;-pbp_data_2021[pbp_data_2021$play_type == “run”,]<br/>run_plays&lt;-count(run_plays, posteam)<br/>pass_plays&lt;-pbp_data_2021[pbp_data_2021$play_type == “pass”,]<br/>pass_plays&lt;-count(pass_plays, posteam)<br/>off_plays_by_team&lt;-left_join(run_plays, pass_plays, by = “posteam” )<br/>colnames(off_plays_by_team)&lt;-c(“team”,”run_plays”,”pass_plays”)</span><span id="dd6b" class="lz ma iq no b gy nw nt l nu nv"># Calculate run and pass play percentages and use cbind() to combine</span><span id="5765" class="lz ma iq no b gy nw nt l nu nv">run_percent&lt;-off_plays_by_team$run_plays/(off_plays_by_team$run_plays + off_plays_by_team$pass_plays)<br/>pass_percent&lt;-off_plays_by_team$pass_plays/(off_plays_by_team$run_plays + off_plays_by_team$pass_plays)<br/>off_plays_by_team&lt;-cbind(off_plays_by_team, run_percent, pass_percent)<br/>off_plays_by_team<br/># team run_plays pass_plays run_percent pass_percent<br/># 1 ARI 33 34 0.4925373 0.5074627<br/># 2 ATL 26 38 0.4062500 0.5937500<br/># 3 BAL 33 33 0.5000000 0.5000000<br/># 4 BUF 25 54 0.3164557 0.6835443<br/># 5 CAR 24 36 0.4000000 0.6000000<br/># 6 CHI 26 43 0.3768116 0.6231884<br/># 7 CIN 36 31 0.5373134 0.4626866<br/># 8 CLE 27 30 0.4736842 0.5263158<br/># 9 DAL 18 59 0.2337662 0.7662338<br/># 10 DEN 28 38 0.4242424 0.5757576<br/># 11 DET 24 62 0.2790698 0.7209302<br/># 12 GB 15 37 0.2884615 0.7115385<br/># 13 HOU 40 34 0.5405405 0.4594595<br/># 14 IND 31 41 0.4305556 0.5694444<br/># 15 JAX 15 52 0.2238806 0.7761194<br/># 16 KC 21 39 0.3500000 0.6500000<br/># 17 LA 19 27 0.4130435 0.5869565<br/># 18 LAC 26 49 0.3466667 0.6533333<br/># 19 LV 21 57 0.2692308 0.7307692<br/># 20 MIA 20 29 0.4081633 0.5918367<br/># 21 MIN 22 52 0.2972973 0.7027027<br/># 22 NE 30 40 0.4285714 0.5714286<br/># 23 NO 37 21 0.6379310 0.3620690<br/># 24 NYG 19 38 0.3333333 0.6666667<br/># 25 NYJ 18 44 0.2903226 0.7096774<br/># 26 PHI 32 35 0.4776119 0.5223881<br/># 27 PIT 18 34 0.3461538 0.6538462<br/># 28 SEA 27 26 0.5094340 0.4905660<br/># 29 SF 27 26 0.5094340 0.4905660<br/># 30 TB 14 50 0.2187500 0.7812500<br/># 31 TEN 22 42 0.3437500 0.6562500<br/># 32 WAS 27 22 0.5510204 0.4489796<br/># 33 &lt;NA&gt; 116 116 0.5000000 0.5000000</span></pre><p id="cfbd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将引用这段话。虽然它是关于“真正的”足球，我认为它也适用于美国版本。</p><blockquote class="nx ny nz"><p id="9e93" class="kw kx nm ky b kz la jr lb lc ld ju le oa lg lh li ob lk ll lm oc lo lp lq lr ij bi translated">有些人认为足球是生死攸关的事情。我向你保证，比那严重得多。—比尔·香克利</p></blockquote><p id="e463" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不隶属于国家足球联盟。</p><p id="63bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nm"> nflverse </em>和<em class="nm"> nflfastR </em>版权2020 Sebastian Carl本·鲍德温并在麻省理工学院许可下分发。</p><p id="74b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过<em class="nm"> nflfastR </em>函数从<a class="ae kv" href="https://twitter.com/LeeSharpeNFL" rel="noopener ugc nofollow" target="_blank">李夏普</a>通过<a class="ae kv" href="https://nflgamedata.com/schedule.php" rel="noopener ugc nofollow" target="_blank">NFLGameData.com</a>获得的数据。</p></div></div>    
</body>
</html>