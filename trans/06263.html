<html>
<head>
<title>3 Must-Know SQL Functions For Efficient Data Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">高效数据分析的3个必备SQL函数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-must-know-sql-functions-for-efficient-data-analysis-b7e4ee820faf?source=collection_archive---------4-----------------------#2021-06-05">https://towardsdatascience.com/3-must-know-sql-functions-for-efficient-data-analysis-b7e4ee820faf?source=collection_archive---------4-----------------------#2021-06-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="83fc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用实际例子说明</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/3f39aead12a37dcdaeb88a715d20034a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mhW-IR7S3z9xkTWPHbY0cg.jpeg"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">卡尔·海尔达尔在<a class="ae le" href="https://unsplash.com/s/photos/efficient?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="ebd3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">SQL是关系数据库管理系统使用的一种编程语言。它提供了许多对存储在关系数据库中的数据进行操作的函数和方法。</p><p id="7b47" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">SQL不仅仅是一种查询语言。我们也可以用它来过滤、操作和分析数据。在本文中，我们将介绍3个对高效数据分析非常有用的SQL函数。</p><p id="aa7c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将涉及的功能有:</p><ul class=""><li id="18f3" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">联合</li><li id="7781" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">什么情况下</li><li id="19d3" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">行数</li></ul><p id="d7a5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我创建了两个样本表，并用模拟数据填充它们。我们先来看看这些表。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lt"><img src="../Images/6ada855cc3e770287695794c4d4f7b40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G59vFzIwMbm4teSnJcA1SA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">产品表(作者图片)</p></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lu"><img src="../Images/e98dd7fde3be2ba539c5a06de9a624e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C0_wb1rZyMsbAas0rvYKBw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">销售表(作者图片)</p></figure><p id="d34f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些表包含两个不同商店的销售和产品数据。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="4a32" class="mc md it bd me mf mg dn mh mi mj dp mk kb ml mm mn kf mo mp mq kj mr ms mt mu bi translated">1.联合</h2><p id="2e55" class="pw-post-body-paragraph jq jr it js b jt mv jv jw jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">考虑这样一种情况，我们需要将sales表左连接到products表。它们通过产品代码联系在一起，所以我们基于该列连接这些表。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="c187" class="mc md it nb b gy nf ng l nh ni">SELECT P.*, S.storecode, s.date, s.salesqty, s.salesrevenue                                                                      FROM products P                                                                                                                             LEFT JOIN sales S                                                                                                                           ON P.productcode = S.productcode;</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nj"><img src="../Images/54b8e61c5581933c6ee48be88be03fd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4AbekGnOabOltfcETEIwJg.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">(图片由作者提供)</p></figure><p id="5291" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不是每个产品在给定日期都有销售。对于这些产品，sales表中的列包含空值(在上面的屏幕截图中为空)。</p><p id="b05b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以使用coalesce函数来处理连接表后的空值。在我们的例子中，我们可以用零填充销售数量和销售收入列。日期列可以用其他行中的日期来填充。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="b04b" class="mc md it nb b gy nf ng l nh ni">SELECT <br/>   P.*, <br/>   S.storecode, <br/>   coalesce(s.date, '2021-05-10') as date,  <br/>   coalesce(s.salesqty,0) as salesqty, <br/>   coalesce(s.salesrevenue, 0)as salesrevenue                                                                                                                             FROM Products P                                                                                                                             LEFT JOIN Sales S                                                                                                                           ON P.productcode = S.productcode;</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nj"><img src="../Images/c234cc707fffaa3f5d8b2e7a20477902.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UnM6FnbFe0u6fvnXdd2Paw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">(图片由authot提供)</p></figure><p id="b76f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">空单元格用coalesce函数中的指定值填充。我已将商店代码留空。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="0823" class="mc md it bd me mf mg dn mh mi mj dp mk kb ml mm mn kf mo mp mq kj mr ms mt mu bi translated">2.什么情况下</h2><p id="80ec" class="pw-post-body-paragraph jq jr it js b jt mv jv jw jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">函数允许根据给定条件更新值的情况。它类似于Python中的if-else语句。</p><p id="2dd1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">假设我们希望从sales表中选择所有列，并根据销售收入创建一个附加列。如果收入高于5，则该列取值“高”。否则就填“正规”。</p><p id="7456" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以用如下函数时的情况来完成这个操作:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="7da7" class="mc md it nb b gy nf ng l nh ni">SELECT <br/>   *,<br/>   CASE WHEN salesrevenue &gt; 5 THEN 'high' ELSE 'regular' END AS<br/>   salesgroup<br/>FROM Sales;</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nk"><img src="../Images/af68d90b5c9805eafa84a06c3f8e36a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*088eP6cW9tlGl67Y4PK98A.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">(图片由作者提供)</p></figure><p id="b089" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上述查询中的case when语句执行以下步骤:</p><ul class=""><li id="e3f1" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">创建名为“销售组”的列</li><li id="ce76" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">当“销售收入”列中的值大于5时，将“高”分配给此列</li><li id="7246" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">否则(即else)指定“常规”</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="07c5" class="mc md it bd me mf mg dn mh mi mj dp mk kb ml mm mn kf mo mp mq kj mr ms mt mu bi translated">3.行数</h2><p id="19b2" class="pw-post-body-paragraph jq jr it js b jt mv jv jw jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">row_number函数允许根据特定列中的值对行进行排序。通过与分区结合，我们可以使它更灵活或更有用。</p><p id="eaae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">回忆一下销售表:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lu"><img src="../Images/e98dd7fde3be2ba539c5a06de9a624e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C0_wb1rZyMsbAas0rvYKBw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">销售表(作者图片)</p></figure><p id="1266" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">假设我们需要根据销售收入分配一个等级。我们希望不同的产品组有不同的等级。因此，水果和蔬菜将在它们自己之内被排列。</p><p id="fac3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第一步是从products表中获取product group列。然后，我们将使用row_number函数。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="d680" class="mc md it nb b gy nf ng l nh ni">SELECT<br/>   S.*, <br/>   P.productgroup, <br/>   ROW_NUMBER() OVER(PARTITION BY P.productgroup ORDER BY  <br/>   salesrevenue DESC) AS salesrank<br/>FROM sales S <br/>LEFT JOIN products P <br/>ON S.productcode = P.productcode;</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nl"><img src="../Images/81c8adf6b4892274b66f9d3a2faf5834.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q7aSlNQHHLdXM7xcEitW-g.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">(图片由作者提供)</p></figure><p id="96da" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在每个组中，第一个等级被分配给销售收入最高的行。然后，相应增加。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="c3b9" class="mc md it bd me mf mg dn mh mi mj dp mk kb ml mm mn kf mo mp mq kj mr ms mt mu bi translated">结论</h2><p id="1eb9" class="pw-post-body-paragraph jq jr it js b jt mv jv jw jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">SQL是数据科学生态系统中的强大工具。绝对是数据科学家必备的技能。我们不仅应该使用SQL从数据库中检索数据，还应该使用SQL进行数据分析和操作。</p><p id="8698" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">SQL能够执行几乎所有可以用流行的数据分析库(如Python pandas和R data table)完成的操作。</p><p id="a14d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>