<html>
<head>
<title>Automate sample Big data generation with Faker and PostgreSQL for Django Projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Faker和PostgreSQL为Django项目自动生成样本大数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automate-sample-big-data-generation-with-faker-and-postgresql-for-django-projects-e95343ae93e?source=collection_archive---------20-----------------------#2021-06-06">https://towardsdatascience.com/automate-sample-big-data-generation-with-faker-and-postgresql-for-django-projects-e95343ae93e?source=collection_archive---------20-----------------------#2021-06-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c3f1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">为您的数据密集型项目在几秒钟内生成可重复使用的大型模拟数据集</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c5618d1b4e79f24ed191ac7fa2bc109c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gwh4ElgPDfTIF0AfGxrdxQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/photos/1K6IQsQbizI?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditShareLink" rel="noopener ugc nofollow" target="_blank">unsplash.com</a></p></figure><p id="97b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在处理数据密集型应用程序时，总是需要生成大量模拟数据，以便在多种场景中进行测试。在大多数情况下，我们需要在几分钟内(如果不是几秒钟)生成大型数据集的方法。在我的例子中，我们需要一个模拟数据集用于我们的UAT环境IoT，并验证API和查询的性能。我曾经在CSV中生成数据，并将数据移动到数据库中。但这似乎效率低下。如果数据集尚未保存，则必须生成，然后我们需要维护、集成和运行一个独立的python脚本。</p><p id="9791" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我以前在一些情况下使用过Django管理命令。由于我们当前的一些后端运行在Django中，并且是用ORM管理的，我认为有一个生成模拟数据集的管理命令会很好。事实证明，这不仅对我，而且对整个团队和管理人员都非常有益。</p><p id="73c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你没有编写过定制管理命令，或者需要一份编写定制管理命令的参考资料，试试<a class="ae kv" href="https://simpleisbetterthancomplex.com/tutorial/2018/08/27/how-to-create-custom-django-management-commands.html" rel="noopener ugc nofollow" target="_blank">这个</a>。尽可能地使用它。它不仅可以与您的Django应用程序很好地集成，而且您还可以充分利用Django的ORM，从使用对象到运行聚合策略。</p><p id="fc93" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我非常依赖的一个软件包是<a class="ae kv" href="https://pypi.org/project/Faker/" rel="noopener ugc nofollow" target="_blank"> Faker </a>，用于生成虚假数据集，如用户名、电子邮件、公司名称。但是还有最后一个缺失的部分——时间序列数据的生成。这就是PostgreSQL <a class="ae kv" href="https://www.postgresql.org/docs/9.1/functions-srf.html" rel="noopener ugc nofollow" target="_blank">生成系列</a>的用武之地。它提供了创建时间序列等系列数据的有效方法。</p><p id="54d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我为一个物联网应用程序创建了一个包含三个模型的Django项目样本，安装了Faker库，并将其连接到本地Postgres数据库。</p><ul class=""><li id="4406" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">应用程序用户注册用户数据</li><li id="745c" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">用户设备为用户添加传感器设备</li><li id="1b5b" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">设备数据按时间顺序捕获新增用户设备的温度和湿度。</li></ul><p id="da5f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">数据库模式和模型:</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/a3e11a60c59d2c9160c721c584e13b7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*_yZEBfxhfcdDKQlkGQ7Vpw.png"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="e4ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在将模型映射到相应的admin.py。我喜欢Django的一点是管理页面。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="0ece" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我通常设计模式，并用<a class="ae kv" href="https://docs.djangoproject.com/en/3.2/ref/contrib/admin/" rel="noopener ugc nofollow" target="_blank"> Django-admin </a>创建数据层的快速模型，包括过滤器、搜索、数据导出、只读字段。</p><p id="3be1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我的组织中有一个需求，我们需要从excel(一个计数表)中提取数据。有多个表，每个表都有很多信息，有些单元格有基于月份的财务数据，如account_no、credit、debit、closing-balance和opening-balance，有些表有非每月的非结构化数据。所有这些数据集都按类别存储。我想到了一个关于表单类型的可配置模型层的小点子。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mj"><img src="../Images/51c6af82baafd602fd09ff1308830c2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hjZa4TGw_ktH2JaBFautPw.jpeg"/></div></div></figure><p id="d57d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">根据类别数据类型的配置，在理货数据页面上输入的数据将应用该公式并计算最终金额。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/8661528bb5b4141f4fb879bd9e01abc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*bNHRrqncHUTSYnPKy_3PJQ.jpeg"/></div></figure><p id="6da5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不仅如此，它的编码方式是，当计数表被上传到一个类别时，提取和计算也会基于配置发生。这是在很短的时间内完成的，结果证明它非常有活力，非常有用。</p><p id="115d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您是Pythonista，只要知道如何将设计好的模式转换成模型并创建管理页面映射，就可以为您节省大量创建数据层的时间。它还会为您的数据层提供一个漂亮、时尚的UI。</p><p id="2830" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">是的，我明白了，这和这篇文章没有关系。但是如果你是python开发人员、数据分析师或科学家，Django管理层会给你很多支持和帮助。我总是用Django admin来原型化我的数据层。</p><p id="8cc9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于Django admin已经说得够多了。现在你可以在Django-admin中创建一个用户和一些与用户相关的设备。我已经创建了一个用户和一个设备。现在让我们使用原始SQL为设备生成数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ml"><img src="../Images/ebd72de117932d3af0dce2b2cddee355.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dXo7gjIH0CEWVfTrL_m76Q.png"/></div></div></figure><p id="42f8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">PostgreSQL generate-series是一个非常强大的系列数据生成函数，可以在几分钟内创建数百万条记录。</p><p id="2099" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们为我们创建的ID尝试一个示例生成系列函数</p><blockquote class="mm mn mo"><p id="1772" class="kw kx mp ky b kz la jr lb lc ld ju le mq lg lh li mr lk ll lm ms lo lp lq lr ij bi translated">插入到设备数据(日期时间，用户设备id，温度，湿度)<br/>选择<br/>日期时间，<br/>用户设备id，<br/> random()*100作为温度，<br/> random()*100作为湿度<br/>从generate_series(now() —间隔' 3年'，now()，间隔' 1小时')作为g1(日期时间)，<br/> generate_series(1，1)作为g2(用户设备id)</p></blockquote><p id="a7a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们正在为我们创建的设备插入3年的每小时数据</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/c2c51fda5d7b00970a16cc919192d937.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5WHh4jqXPGiPO3rOIG0gHw.png"/></div></div></figure><p id="985a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以看到快速的数据生成与Postgres生成系列。现在将它与Faker和Django ORM结合起来，您就可以将任何Django应用程序的样本数据生成脚本集成到您的代码库中。</p><p id="84ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些是我遵循的步骤:</p><ol class=""><li id="02ff" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr mu ly lz ma bi translated">从用户处获取总用户和相关设备的数量作为输入。</li><li id="a79b" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mu ly lz ma bi translated">User Faker(faker.name())来创建模拟用户名。</li><li id="3d42" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mu ly lz ma bi translated">然后用Django <a class="ae kv" href="https://docs.djangoproject.com/en/3.2/ref/models/querysets/" rel="noopener ugc nofollow" target="_blank"> bulk_create </a>批量插入那些用户数据和设备数据</li><li id="37c2" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr mu ly lz ma bi translated">然后用上面的原始SQL传递必要的参数，迭代地为设备生成数据。</li></ol><p id="e999" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过这种方式，我们现在可以将样本数据集生成作为代码与Django中的MVT一起维护。</p><p id="d6bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/b76d8bb989fe80bf46945ea977110ced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ol3OhG7RxpCS_hju_ejpbQ.jpeg"/></div></div></figure><p id="d8e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">或者，您仍然可以在psycopg2中使用等效的SQLAlchemy ORM或纯python本身。随意发挥你的想法。我之前用过python，CSV，还有<a class="ae kv" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_sql.html" rel="noopener ugc nofollow" target="_blank"> pandas_to_sql </a>。虽然这很快，但与生成系列相比，它差远了。在我的一个示例项目中，我能够在20分钟内生成2100万条包含相关数据的记录。但要警惕的是，随着数据的增加，插入速度往往会变得缓慢。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/c60e0149d97ca77fbd0039361ad97e89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*jKECI3WfrVaOe903AD8mOw.jpeg"/></div></figure><p id="11ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完整的代码在<a class="ae kv" href="https://github.com/pravinmj-cs/mock-data-iot" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中。</p><p id="bfca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">模拟数据——一种生成可预测数据并测试不可测试数据的方法</p><p id="1b79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开心嘲讽和数据叠加！！</p></div></div>    
</body>
</html>