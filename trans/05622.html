<html>
<head>
<title>Timetk: The R Library for Time Series Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Timetk:时间序列分析的R库</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/timetk-the-r-library-for-time-series-analysis-9822f7720318?source=collection_archive---------14-----------------------#2021-05-19">https://towardsdatascience.com/timetk-the-r-library-for-time-series-analysis-9822f7720318?source=collection_archive---------14-----------------------#2021-05-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9ddb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">您可以使用它来分析、操作和检测时序数据的异常。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d7bf08e8993e27dfed3467f398a04c39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CMpfBTRbY_OjzVHOBxuKMg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">尼古拉斯·卡佩罗在<a class="ae ky" href="https://unsplash.com/s/photos/chart?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="cba7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="e508" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">你见过像天气温度、股票价格或销售数字这样随时间变化的数据吗？我很确定你已经在现实生活中至少见过一次这些数据了。这些是时间序列数据。时间序列是随着时间变化的数据，无论是由其他因素还是时间本身引起的。</p><p id="e557" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">分析时间序列数据可能是一项具有挑战性的任务。例如，检测异常情况，甚至希望看到几个月或几周的季节性趋势。如果你想做到这一点，你需要做脚本和使用这么多的库。</p><p id="a953" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在谢天谢地，有一个R编程语言库可以帮助我们。它叫timetk。Timetk是由Matt Dancho和Davis Vaughan创建的库，用于分析和可视化时间序列数据。Timetk很容易使用，如果你曾经和tidyverse一起玩，它会更容易。</p><p id="d69b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在本文中，我将向您展示如何在r中使用timetk。</p><p id="69e6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">没有进一步，让我们开始吧！</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="eb43" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">实施</h1><h2 id="f494" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">安装并导入库</h2><p id="2eaa" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们需要做的第一件事是安装库。在这种情况下，我们将安装timetk和tidyverse。之后，我们可以导入库。下面是命令的样子，</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="040a" class="ne la it nr b gy nv nw l nx ny">install.packages("timetk")<br/>install.packages("tidyverse")</span><span id="3dc5" class="ne la it nr b gy nz nw l nx ny">library(tidyverse)<br/>library(lubridate)<br/>library(timetk)</span></pre><h2 id="f9bf" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">导入数据</h2><p id="3bdf" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">导入库之后，现在让我们导入数据。在这种情况下，我们将使用来自UCI机器学习知识库(名为自行车共享数据集)的数据。该数据包含从2011年到2012年单日自行车用户数量的信息。</p><p id="0ac2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">幸运的是，timetk包含了数据，所以你不需要下载它。如果你还想使用原始数据，你可以在这里访问数据集<a class="ae ky" href="https://archive.ics.uci.edu/ml/datasets/bike+sharing+dataset" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="5f62" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要查看数据，您可以使用这里的命令，</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="8cd4" class="ne la it nr b gy nv nw l nx ny">View(bike_sharing_daily)</span></pre><p id="ebbd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是数据的预览，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/0388eac6d8c4da492acf6943df0a2f7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PVj2cfVoZpHYLyPH"/></div></div></figure><p id="7c63" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">正如您在上面看到的，数据中有几列。有关于时间、温度、湿度和骑自行车的人数的信息。在这种情况下，我们只使用dteday和cnt列，其中每一列都表示日期和自行车用户的数量。下面是检索数据的代码，</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="6f07" class="ne la it nr b gy nv nw l nx ny"><strong class="nr iu"># Get the data</strong><br/>bike_sharing &lt;- bike_sharing_daily %&gt;%<br/> <strong class="nr iu"># Get the columns</strong><br/> select(dteday, cnt) %&gt;%<br/> <strong class="nr iu"># Change the columns name</strong><br/> set_names(c("date", "value"))</span><span id="2652" class="ne la it nr b gy nz nw l nx ny">bike_sharing</span></pre><p id="8e5d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是数据的预览，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/716adc7c36df7a0caedf04d8682caf75.png" data-original-src="https://miro.medium.com/v2/resize:fit:396/0*BVPw-2KOJMg-jbvq"/></div></figure><h2 id="ac3e" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">时间序列可视化</h2><p id="b95d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我们得到数据后，现在让我们进入可视化。为了可视化时间序列，我们可以使用timetk库中的plot_time_series函数。下面是命令的样子，</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="d28e" class="ne la it nr b gy nv nw l nx ny">bike_sharing %&gt;%<br/>  plot_time_series(date, value)</span></pre><p id="a80a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">以下是该命令的结果，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/d8f6b7bfcb4465ae1d979bc71349238c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*4D5B0nfNz-F2SKeu6R8zsw.gif"/></div></div></figure><p id="9eed" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">正如您在上面看到的，该函数返回一个交互式可视化。这种可视化是基于一个名为Plotly的库。因此，您可以悬停以获取数据点，并缩放以查看可视化的详细信息。</p><p id="56fb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">还可以添加一个滑块来过滤数据观察值。plotly_slider参数为true。下面是命令的样子，</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="dbaa" class="ne la it nr b gy nv nw l nx ny">bike_sharing %&gt;%<br/>  plot_time_series(date, value, .interactive=TRUE, .plotly_slider=TRUE)</span></pre><p id="3158" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是结果，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/234f32a1a03293f41d7cd100a525f5b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*2CKJXFu4cUCMvbmVx7xAyg.gif"/></div></div></figure><p id="d1b2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果只需要静态可视化，可以将。交互式参数设置为false。该函数将返回一个基于ggplot库的静态可视化。命令看起来像这样，</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="337a" class="ne la it nr b gy nv nw l nx ny">bike_sharing %&gt;%<br/> plot_time_series(date, value, .interactive=FALSE)</span></pre><p id="ce0e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是结果，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/85383b1e9d0eae8e042bbb2fcb75d162.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*f0uLzE-zMw2D6hk6"/></div></div></figure><p id="fdb1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">就像其他可视化一样，您可以使用timetk库进行分组可视化。如你所见，数据范围从2011年到2012年。在这种情况下，我们将根据可视化发生的年份对其进行分组。下面是命令的样子，</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="8936" class="ne la it nr b gy nv nw l nx ny">bike_sharing %&gt;%<br/>  group_by(year(date)) %&gt;%<br/>  plot_time_series(date, value, .facet_scales="free")</span></pre><p id="e885" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">结果看起来像这样，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/753ae3a3e9f9f834e0c820bb98353866.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*YS6CdKgt-vIJSkHVc-V30w.gif"/></div></div></figure><p id="40fd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了使可视化更加引人注目，我们可以添加。color_var参数根据数据发生的月份对数据进行着色。此外，我们将通过设置。将参数平滑为假。下面是命令的样子，</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="78bc" class="ne la it nr b gy nv nw l nx ny">bike_sharing %&gt;%<br/>  group_by(year(date)) %&gt;%<br/>  plot_time_series(date, value, .facet_scales="free", .smooth=FALSE .color_var=month(date), .interactive=FALSE)</span></pre><p id="12ec" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是结果，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/9417fb17252f3bb97d95451204cb6232.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wPvWOJ0ZuoRBQXZK"/></div></div></figure><p id="a326" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">除此之外，我们还可以通过季节性来可视化时间序列，无论是以小时、天、周，甚至是月为单位。您可以通过使用plot_seasonal_diagnostics函数获得所有信息。下面是命令的样子，</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="17c4" class="ne la it nr b gy nv nw l nx ny">bike_sharing %&gt;%<br/>  group_by(year(date)) %&gt;%<br/>  plot_seasonal_diagnostics(date, value, .x_lab='Date', .y_lab='# of users', .title='Bike Sharing Users')</span></pre><p id="e6ef" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是结果，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/ffbe83b7ca240e65be187ff6ebb731ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qInXkbiXVTvIRUxR"/></div></div></figure><h2 id="1047" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">异常检测</h2><p id="a90b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">最后，我想向您展示这个库的一个主要特性。您可以只使用一个函数来检测异常。</p><p id="79b7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">异常检测是一项任务，旨在发现具有异常价值的数据。换句话说，数据是不同的。</p><p id="74d6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在timetk中，我们可以为异常检测做两件事。你能做的第一件事是将数据中的异常可视化。在这种情况下，我们将可视化时间序列和异常。还有，我们按年份分。</p><p id="84b2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们可以使用plot_anomaly_diagnostics函数来可视化时间序列和异常，并按年份进行拆分。命令看起来像这样，</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="ff1d" class="ne la it nr b gy nv nw l nx ny"><strong class="nr iu"># Get the data</strong><br/>bike_sharing %&gt;%<br/><strong class="nr iu">  # Group the data by year</strong><br/>  group_by(year(date)) %&gt;%<br/><strong class="nr iu">  # Visualize the result</strong><br/>  plot_anomaly_diagnostics(date, value)</span></pre><p id="71ce" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是可视化的样子，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/64b72d2195055e98868f73c665e1e68c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Ev5oinI3QSaVFA5rfqun4A.gif"/></div></div></figure><p id="c9ce" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">你能做的第二件事是收集有异常的数据。我们按年份对数据进行分组。此外，我们过滤数据，只包含有异常的数据。我们可以使用tk_anomaly_diagnostics函数来收集异常。下面是命令的样子，</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="85bc" class="ne la it nr b gy nv nw l nx ny">anomaly_data &lt;- bike_sharing %&gt;%<br/>  group_by(year(date)) %&gt;%<br/>  tk_anomaly_diagnostics(date, value) %&gt;%<br/>  filter(anomaly == 'Yes')</span><span id="1204" class="ne la it nr b gy nz nw l nx ny">View(anomaly_data)</span></pre><p id="5dcc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是数据的预览，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/208a73aeb72a04cfc914239b9723170a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6CxQ1NylwADK-37T"/></div></div></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="06bc" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">结束语</h1><p id="68ad" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">恭喜你！现在你已经学会了如何在R中使用timetk进行时间序列分析。有了timetk，我们可以比以前更容易地分析时间序列数据。</p><p id="3682" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我希望这篇文章对你有用。如果你想看更多这样的文章，可以关注我的媒介。如果你有任何问题或者想进行对话，你可以在<a class="ae ky" href="https://www.linkedin.com/in/alghaniirfan/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系我。</p><p id="de8e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">谢谢你看我的文章！</p></div></div>    
</body>
</html>