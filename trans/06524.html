<html>
<head>
<title>Predicting Board Game Ratings with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python预测桌游评分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-board-game-ratings-with-python-60c9de9ee067?source=collection_archive---------20-----------------------#2021-06-11">https://towardsdatascience.com/predicting-board-game-ratings-with-python-60c9de9ee067?source=collection_archive---------20-----------------------#2021-06-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ed52" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为实时数据科学竞赛编写解决方案</h2></div><h1 id="f90a" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">切片背景</h1><p id="8b2c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">SLICED是一个竞争性的数据科学游戏节目，参与者有两个小时的时间来探索和预测他们刚刚看到的数据。如果你对数据分析、数据科学或机器学习感兴趣，我强烈推荐你去看看这些剧集。</p><p id="8f86" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">尼克·万和<a class="ae mb" href="https://twitter.com/MeganRisdal" rel="noopener ugc nofollow" target="_blank">梅格·里斯达尔</a>是《切片》的主持人。在第一周，参赛者被要求预测棋盘游戏的评分，给出一系列特征(游戏发布的年份，游戏持续的时间等)。</p><p id="d179" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">你可以在Twitch 上查看《T4》第一集，在上了解更多关于该剧的内容和时间安排<a class="ae mb" href="https://www.notion.so/SLICED-Show-c7bd26356e3a42279e2dfbafb0480073" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="f6b7" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">两小时后的数据科学</h1><p id="c1dc" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">作为一个挑战，我想尝试在两个小时内建立一个预测——类似于参赛者，尽管在我编码时没有200人看着我，压力要小得多。</p><h2 id="6ff0" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated">问题概述</h2><p id="cec3" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">该数据集包含约3，500个棋盘游戏，具有各种描述性栏目和我们试图预测的“极客评级”。目标是预测另外1，500个棋盘游戏的未知极客评级。你可以在下面看到几个专栏的样本，在<a class="ae mb" href="https://www.kaggle.com/c/sliced-s01e01/overview" rel="noopener ugc nofollow" target="_blank"> kaggle </a>上可以获得完整的数据(和得分)。</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mo"><img src="../Images/8d6c2665d1208de12db881fd2a849ac7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/0*tjwuf7gCRbPaSYwT.png"/></div></div><p class="na nb gj gh gi nc nd bd b be z dk translated">数据概述</p></figure><h2 id="f80b" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated">探索性数据分析</h2><p id="c704" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我做的第一件事(导入库和数据之后)是用我们的目标变量geek_rating绘制各种特性的pairgrid。有些列是文本或者有点难以解析，我把它们留到后面的步骤中。这样做的时候，我注意到一些有趣的关系:</p><ol class=""><li id="cd41" class="ne nf it lc b ld lw lg lx lj ng ln nh lr ni lv nj nk nl nm bi translated">棋盘游戏的特征(最少玩家、最多玩家、平均游戏时间)似乎与预测评级有松散的关系。就有多少玩家和一款游戏需要多长时间才能被评为优秀而言，可能存在一个最佳点。</li><li id="3211" class="ne nf it lc b ld nn lg no lj np ln nq lr nr lv nj nk nl nm bi translated">在有多少人拥有一个游戏/对一个游戏投票和它的评价有多高之间似乎有一个更强的(和非线性的)关系。</li><li id="4929" class="ne nf it lc b ld nn lg no lj np ln nq lr nr lv nj nk nl nm bi translated">游戏在被高度评价之前已经存在了一段时间。</li></ol><pre class="mp mq mr ms gt ns nt nu nv aw nw bi"><span id="cc96" class="mc kj it nt b gy nx ny l nz oa">pg = sns.PairGrid(train_df, x_vars=['min_players', 'max_players', 'avg_time', 'year', 'owned', 'num_votes', 'age'], y_vars=['geek_rating'])<br/>pg.map(sns.scatterplot)</span></pre><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi ob"><img src="../Images/0e0feaea29dd8c68d989c781e2c9d961.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LcQ688PmGSFEhT99.png"/></div></div><p class="na nb gj gh gi nc nd bd b be z dk translated">成对网格图</p></figure><p id="9882" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">进一步挖掘，绘制出玩家的最小数量和等级，我们看到1-2个玩家的最小平均得分最高。对最大玩家的类似分析表明，最“正常”的游戏配置似乎很受欢迎。</p><pre class="mp mq mr ms gt ns nt nu nv aw nw bi"><span id="431f" class="mc kj it nt b gy nx ny l nz oa">sns.boxplot(data=train_df, x='min_players', y='geek_rating')</span></pre><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/f9a5452c7ca65959210e5b3fa623a2d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/0*zWmjFcTX7fKtIV7j.png"/></div><p class="na nb gj gh gi nc nd bd b be z dk translated">最小玩家盒图</p></figure><p id="1853" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">视觉扫描一些游戏机制，我挑选了一些导致更高分数的关键词。一个更好的方法是解析出各种短语，并使用游戏机制和评级之间的汇总统计数据建立关系……但两个小时很快就过去了！</p><pre class="mp mq mr ms gt ns nt nu nv aw nw bi"><span id="6a41" class="mc kj it nt b gy nx ny l nz oa">train_df.groupby('mechanic')['geek_rating'].mean().sort_values(ascending=False)[:20]<br/>train_df.groupby('mechanic')['geek_rating'].mean().sort_values(ascending=False)[-20:]</span></pre><h2 id="e48f" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated">特征工程</h2><p id="cd9e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><strong class="lc iu">玩家分组</strong></p><p id="aca6" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">我决定添加一个“玩家分组”的特性，只是为了捕捉一些在玩家数量方框图中可见的关系。决策树等机器学习算法可以自动提取这些信息，但它很快就将我认为有用的信息编码为一个集合，以帮助学习。</p><pre class="mp mq mr ms gt ns nt nu nv aw nw bi"><span id="782b" class="mc kj it nt b gy nx ny l nz oa">def player_grouping(df):<br/>    if df['min_players'] &lt;= 0:<br/>        return 'Low'<br/>    elif df['max_players'] &lt;= 3:<br/>        return 'Low'<br/>    elif df['min_players'] == 8:<br/>        return 'Exact'<br/>    elif df['min_players'] == 5:<br/>        return 'Odd'<br/>    elif df['max_players'] &gt; 3 and df['max_players'] &lt;= 7:<br/>        return 'Exact'<br/>    else:<br/>        return 'Other'<br/><br/>train_df['player_grouping'] = train_df.apply(lambda row: player_grouping(row), axis=1)</span></pre><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/dfcdd148071585a23ae1bef0895a22a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/0*whrTXX-OjeKDj56e.png"/></div><p class="na nb gj gh gi nc nd bd b be z dk translated">新的衍生玩家分组功能</p></figure><p id="496b" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated"><strong class="lc iu">类别评分</strong></p><p id="968e" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">我想创建的下一个功能是基于游戏的类别(策略、骰子等)。</p><p id="be18" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">这些信息存储在许多列中。我使用第一个创建了一个查找字典(最好有全部12个，但是时间过得很快……)，然后遍历各个列，找到与类别术语相关的平均分数。例如<em class="od">医学、文艺复兴和文明</em>类别表现最好，而<em class="od">琐事、记忆和数字</em>类别表现最差。</p><pre class="mp mq mr ms gt ns nt nu nv aw nw bi"><span id="ffbe" class="mc kj it nt b gy nx ny l nz oa">category_lookup_dict = dict(train_df.groupby('category1')['geek_rating'].mean())<br/><br/>def get_combined_category_scoring(df, category_dict, col_list):<br/>    score_list = []<br/>    for col in col_list:<br/>        if df[col] != np.nan:<br/>            # Handle errors for new categories not profiled<br/>            try:<br/>                score_list.append(category_dict[df[col]])<br/>            except:<br/>                pass<br/>    if len(score_list) &gt; 0:<br/>        return np.mean(score_list)<br/>    else:<br/>        return 6.09 # avg for missing categories<br/><br/>col_list_cat = [col for col in train_df.columns if 'category' in col]<br/>train_df['cat_score'] = train_df.apply(lambda row: get_combined_category_scoring(row, category_lookup_dict, col_list_cat), axis=1)</span></pre><p id="54ff" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated"><strong class="lc iu">技工组</strong></p><p id="18ee" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">我在游戏机械领域做了类似的特征工程，但是随着时间的减少，关于计算平均值和二进制标志方法的科学程度降低了。</p><h2 id="b1de" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated">预言；预测；预告</h2><p id="4b8c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">最后一步是选择输入预测和机器学习算法的列。我试了几个，最后用的是渐变提升。我没有花太多时间优化超参数，只是使用了默认值。</p><pre class="mp mq mr ms gt ns nt nu nv aw nw bi"><span id="3e04" class="mc kj it nt b gy nx ny l nz oa">feature_cols = ['age', 'player_grouping', 'owned', 'num_votes', 'cat_score', 'min_players', 'max_players', 'avg_time',<br/>       'min_time', 'max_time', 'year', 'mechanic_group']<br/>target_col = 'geek_rating'<br/><br/>x = train_df[feature_cols]<br/>y = train_df[target_col]<br/><br/>reg = GradientBoostingRegressor()<br/>reg.fit(x, y)<br/>predictions = reg.predict(x)<br/>print(f'RMSE for training set: {np.sqrt(mean_squared_error(y_true=y, y_pred=predictions))}')</span></pre><p id="e6b4" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">训练集的均方根误差为0.141，验证集的均方根误差为0.167(训练样本的30%)。</p><h2 id="987e" class="mc kj it bd kk md me dn ko mf mg dp ks lj mh mi ku ln mj mk kw lr ml mm ky mn bi translated">结果</h2><p id="4d3f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在整合了这些功能和几个迭代之后，我最终得到了下面的笔记本和0.177的RMSE——在排行榜上排名第九。</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/cb45c13d32a663a28d41039b6b786ce0.png" data-original-src="https://miro.medium.com/v2/resize:fit:470/format:webp/0*BY9fY56kYE9ZdLro.png"/></div><p class="na nb gj gh gi nc nd bd b be z dk translated">结果</p></figure><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi of"><img src="../Images/fcc728b9bade34cf5c360d55492b9f39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QTNOpo2RrSb3WVWC.png"/></div></div><p class="na nb gj gh gi nc nd bd b be z dk translated">排行榜(仅在Twitch stream期间显示提交内容)</p></figure><h1 id="8d86" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">摘要</h1><p id="c331" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这是一个有趣的挑战，建议其他人尝试分析数据。除了儿时的家庭垄断争吵之外，我在棋盘游戏方面的专业知识几乎为零，所以看看我能做出多准确的预测是件有趣的事情。</p><p id="db8e" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated"><em class="od">在</em><a class="ae mb" href="https://github.com/bstuddard/python-examples/blob/master/sliced/2021_01/Sliced_Week_01.ipynb" rel="noopener ugc nofollow" target="_blank"><em class="od">Github</em></a><em class="od">上可以找到所有的例子和文件。</em></p></div><div class="ab cl og oh hx oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="im in io ip iq"><p id="a150" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated"><em class="od">原载于</em><a class="ae mb" href="https://datastud.dev/posts/sliced-2021-w1" rel="noopener ugc nofollow" target="_blank"><em class="od">https://data stud . dev</em></a><em class="od">。</em></p></div></div>    
</body>
</html>