<html>
<head>
<title>pandas-to-sql — Moving code from SQL to Python and Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">pandas-to-sql——将代码从SQL转移到Python和Pandas</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pandas-to-sql-moving-code-from-sql-to-python-and-pandas-afc4c62a644c?source=collection_archive---------14-----------------------#2021-05-31">https://towardsdatascience.com/pandas-to-sql-moving-code-from-sql-to-python-and-pandas-afc4c62a644c?source=collection_archive---------14-----------------------#2021-05-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0f4b80234582fd41027572d6176bef6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EWxbxfl_xW_3aSD7"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">迈克尔·泽兹奇在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="2726" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae kc" href="https://github.com/AmirPupko/pandas-to-sql" rel="noopener ugc nofollow" target="_blank"> pandas-to-sql </a>是一个python库，允许使用python的<a class="ae kc" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> Pandas </a> <a class="ae kc" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html" rel="noopener ugc nofollow" target="_blank"> DataFrames </a>来创建sql字符串，这些字符串稍后可用于查询数据库。<a class="ae kc" href="https://colab.research.google.com/github/AmirPupko/pandas-to-sql/blob/main/pandas_to_sql_colab_example.ipynb" rel="noopener ugc nofollow" target="_blank">这里有一些你可以运行</a>的例子。</p><p id="7e9f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">数据科学项目的常见结构将从数据获取和准备阶段开始。如果保存数据的数据库支持SQL，数据提取甚至一些数据准备都可以使用SQL来执行(受DB支持，为什么不呢？)</p><p id="e233" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这方面的问题:</p><ul class=""><li id="712f" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">用两种不同的语言(SQL和Python)维护代码</li><li id="fdf6" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">该项目成为一个两步项目(SQL部分，然后是Python部分)。这可能是设计的选择，但也可能是项目中两种编码语言的副作用</li><li id="cd57" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">在SQL代码上更难使用编码原则和最佳实践(例如<a class="ae kc" href="https://en.wikipedia.org/wiki/SOLID" rel="noopener ugc nofollow" target="_blank"> SOLID </a></li><li id="3470" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">通常，SQL代码不会被测试</li></ul><p id="978f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">pandas-to-sql如何尝试解决这些问题？</p><p id="2449" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae kc" href="https://github.com/AmirPupko/pandas-to-sql" rel="noopener ugc nofollow" target="_blank"> pandas-to-sql </a>是一个python库，允许用户使用pandas数据帧，创建不同的操作，并最终使用<strong class="kf ir"> get_sql_string() </strong>方法获得描述操作的sql字符串。此时，可以使用这个字符串来查询数据库。</p><p id="0f55" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如何安装:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="ef1d" class="ly lz iq lu b gy ma mb l mc md">pip install pandas-to-sql</span></pre></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><p id="557e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">简单的例子:</strong></p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="2483" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">输出:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="2439" class="ly lz iq lu b gy ma mb l mc md">‘SELECT (sepal_length) AS sepal_length, (sepal_width) AS sepal_width, (petal_length) AS petal_length, (petal_width) AS petal_width, (species) AS species FROM iris’</span></pre><p id="d0fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的例子中，我们将虹膜数据集加载到熊猫数据帧中。然后我们使用<strong class="kf ir"> pandas_to_sql.wrap_df </strong>转换数据帧。从这一点开始，所有操作都将保存为SQL字符串。在任何时候，都可以使用<strong class="kf ir"> df.get_sql_string() </strong>获得这个SQL字符串。</p></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><p id="c234" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里还有一些例子…</p><p id="3491" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">过滤示例:</strong></p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="c80a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">输出:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="9ae8" class="ly lz iq lu b gy ma mb l mc md">‘SELECT (sepal_length) AS sepal_length, (sepal_width) AS sepal_width, (petal_length) AS petal_length, (petal_width) AS petal_width, (species) AS species FROM iris WHERE (((petal_length &gt; 1.4) AND (petal_width &lt; 0.2)))’</span></pre></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><p id="ff6b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">分组示例:</strong></p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="fba0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">输出:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="23bb" class="ly lz iq lu b gy ma mb l mc md">‘SELECT (avg(petal_length)) AS petal_length_mean, (sum(petal_length)) AS petal_length_sum, (count(petal_length)) AS petal_length_count, (species) AS species FROM iris GROUP BY species’</span></pre><p id="2805" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意<strong class="kf ir">约定的使用。由于Pandas groupby返回一个多索引数据帧，而该数据帧不适用于SQL，因此该方法编辑SQL查询中的列名，以匹配<strong class="kf ir"> reset_index() </strong>返回的默认值(并对groupby返回的数据帧执行<strong class="kf ir"> reset_index() </strong>)。</strong></p></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><p id="2b7e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">串联示例:</strong></p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="4288" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">输出:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="c434" class="ly lz iq lu b gy ma mb l mc md">‘SELECT (sepal_length) AS sepal_length, (sepal_width) AS sepal_width, (petal_length) AS petal_length, (petal_width) AS petal_width, (species) AS species, ((CASE WHEN ((ABS(sepal_width) — ROUND(ABS(sepal_width)-0.5))==.5) AND ((CAST(sepal_width AS INT))%2 == 0) THEN (CASE WHEN sepal_width&gt;0 THEN ROUND(sepal_width-0.001) ELSE ROUND(sepal_width+0.001) END) ELSE (ROUND(sepal_width)) END)) AS sepal_width_rounded FROM iris WHERE ((species = ‘setosa’)) UNION ALL SELECT (sepal_length) AS sepal_length, (sepal_width) AS sepal_width, (petal_length) AS petal_length, (petal_width) AS petal_width, (species) AS species, ((CASE WHEN ((ABS(sepal_width) — ROUND(ABS(sepal_width)-0.5))==.5) AND ((CAST(sepal_width AS INT))%2 == 0) THEN (CASE WHEN sepal_width&gt;0 THEN ROUND(sepal_width-0.001) ELSE ROUND(sepal_width+0.001) END) ELSE (ROUND(sepal_width)) END)) AS sepal_width_rounded FROM iris WHERE ((species = ‘versicolor’))‘</span></pre><p id="754b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里注意PD<strong class="kf ir">pandas _ to _ SQL . wrap _ PD(PD)</strong>的包装，以便覆盖<strong class="kf ir"> pd.concat() </strong></p></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><p id="2526" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以下是一个要点中的所有示例:</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="d86c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该库尚未投入生产。我的主要目标是检查这个想法的吸引力，以及是否有更多的人觉得这个有用。如果是的话，会增加更多的支持。目前的支持只针对<a class="ae kc" href="https://www.sqlite.org/index.html" rel="noopener ugc nofollow" target="_blank"> SQLite </a>，希望很快增加对<a class="ae kc" href="https://prestodb.io/" rel="noopener ugc nofollow" target="_blank">的支持。对于任何bug或新功能请求，请随时提出问题。</a><a class="ae kc" href="https://github.com/AmirPupko/pandas-to-sql/issues" rel="noopener ugc nofollow" target="_blank">问题</a></p><p id="d6e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢阅读:-)</p></div></div>    
</body>
</html>