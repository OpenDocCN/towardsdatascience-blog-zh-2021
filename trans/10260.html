<html>
<head>
<title>Running a dockerized CKAN Geospatial Open Data Portal on a Mac</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Mac上运行dockerized CKAN地理空间开放数据门户</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/running-a-dockerized-ckan-geospatial-open-data-portal-on-a-mac-347a0346729d?source=collection_archive---------14-----------------------#2021-09-29">https://towardsdatascience.com/running-a-dockerized-ckan-geospatial-open-data-portal-on-a-mac-347a0346729d?source=collection_archive---------14-----------------------#2021-09-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="234b" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="25b5" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">关于如何利用docker-compose充分利用OSX世界领先的操作系统数据门户的实践指南</h2></div><p id="5120" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">CKAN很棒。它不仅是全球开放数据门户最受欢迎的系统之一:大量可用的插件和蓬勃发展的社区使它成为一个非常灵活和强大的工具，用于不同类型的数据和可视化，<strong class="kt jd">包括地理空间</strong>。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ln"><img src="../Images/cf1002d6a1fd6d39d1340bbbc436c269.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XUG5Ocz1kFHyd4ISbtC9Og.png"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">Docker让运行CKAN实例变得简单多了，不需要运行Ubuntu机器</p></figure><p id="86db" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">说到地理空间数据门户，其他工具可能更为人们所知。ESRI无疑在说服顶级玩家(如全球的<a class="ae md" href="http://unhabitatiraq.net/mosulportal/" rel="noopener ugc nofollow" target="_blank">联合国</a>和<a class="ae md" href="https://iede.rs.gov.br/" rel="noopener ugc nofollow" target="_blank">地方政府</a>使用<a class="ae md" href="https://enterprise.arcgis.com/en/" rel="noopener ugc nofollow" target="_blank"><strong class="kt jd">ArcGIS Enterprise</strong></a>方面做得很好，但是这种设置会花费你几千美元。OSGEO社区在开发<a class="ae md" href="https://geonode.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt jd"> GeoNode </strong> </a>和<a class="ae md" href="https://geonetwork-opensource.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt jd"> GeoNetwork </strong> </a>方面做得很好，但这将占用你的机器上的<strong class="kt jd">大量</strong>空间，因为这两者都需要Postgres数据库和Geoserver实例来存储数据和地理服务。</p><p id="9288" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">如果你正在寻找一些例子来说服自己，请查看CKAN网站上的<a class="ae md" href="https://ckan.org/showcase" rel="noopener ugc nofollow" target="_blank">展示页面</a>。许多国家政府，如美国和加拿大，正在使用它作为他们的开放数据门户。我最喜欢的一个是联合国OCHA办事处的人道主义数据交换门户网站。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi me"><img src="../Images/92992f6107f6ec3fd1c1a502f54bafcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yy1FDHl79uDumuypqkmlvg.png"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">人道主义数据交换门户，您可以在其中按类别和位置搜索数据，并在嵌入式web地图中预先可视化空间数据。图片由作者提供。</p></figure><p id="3ce7" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">因此，如果您正在寻找一个免费的轻量级解决方案来存储地理空间元数据，CKAN会支持您。在本教程中，我们将设置一个基本的CKAN安装在Mac与Docker，设置一些基本的插件，并使其地理空间友好。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="199b" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">让我们从头开始——一个非常好的起点</h1><p id="d49b" class="pw-post-body-paragraph kr ks it kt b ku ne kd kw kx nf kg kz la ng lc ld le nh lg lh li ni lk ll lm im bi translated">让我们开门见山吧:您可能最终阅读了这篇文章，因为您正试图在Mac上运行CKAN门户，而关于如何操作的文档并不理想。坏消息是CKAN被开发成主要在Linux上运行<strong class="kt jd">(尽管你可以在OSX上运行源码安装)，所以你不能运行包安装。好消息是CKAN也作为docker-compose recipe </strong>发布，所以你可以在Mac的docker容器中运行它。</p><ol class=""><li id="fe78" class="nj nk it kt b ku kv kx ky la nl le nm li nn lm no np nq nr bi translated">在我们开始之前，确保您的机器上安装了Docker和Docker-compose。在mac上，这意味着你只需下载并安装Docker-compose自带的<a class="ae md" href="https://hub.docker.com/editions/community/docker-ce-desktop-mac" rel="noopener ugc nofollow" target="_blank"> Docker桌面应用</a>。</li></ol><p id="c940" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">如果你不熟悉Docker的工作方式，也许值得<a class="ae md" href="https://docs.docker.com/compose/" rel="noopener ugc nofollow" target="_blank">研究一下</a>。您需要知道的最起码的事情是，Docker文件包含一个构建映像的方法，该映像作为一个容器中的卷依次执行。docker-compose方法指向docker文件的集合，因此您可以在一个容器中有多个卷运行您的设置的不同部分，如数据库、web服务器和应用程序。所有这一切都不需要建立一个虚拟机:<strong class="kt jd">您只需运行这些服务工作所需的部分</strong>。</p><p id="cf44" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">2.现在打开您的终端，直接从Github获取CKAN的源代码:</p><p id="4e0f" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><code class="fe ns nt nu nv b">$ git clone https://github.com/ckan/ckan.git</code></p><p id="0d69" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">3.进入下载目录，并导航至docker-compose配方的存储目录:</p><p id="11f9" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><code class="fe ns nt nu nv b">$ cd ckan/contrib/docker</code></p><p id="805f" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">4.在为CKAN实例构建映像时，Docker将被告知寻找。env文件，它包含一些环境变量。我们将创造我们的。env文件，方法是通过运行以下命令复制CKAN提供的模板(. env.template):</p><p id="5cb0" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><code class="fe ns nt nu nv b">$ cp .env.template .env</code></p><p id="6a4a" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">5.这些变量没有太多需要改变的地方。有一件事是绝对必须的，那就是更改变量CKAN_SITE_URL。为此，请打开新创建的。env文件用你最喜欢的文本编辑器(由于这个文件以点开始，你的Mac会隐藏它；点击<code class="fe ns nt nu nv b">CMD+SHIFT+.</code>使隐藏文件在Finder中可见)。该变量应该如下所示:</p><p id="3858" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><code class="fe ns nt nu nv b">CKAN_SITE_URL = http://docker.for.mac.localhost:5000</code></p><p id="4021" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">6.现在我们已经准备好构建我们的Docker映像了！让我们调用docker-compose，告诉它构建必要的图像，并在容器中将它们作为卷运行。</p><p id="28ed" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><code class="fe ns nt nu nv b">$ docker-compose up -d --build</code></p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi nw"><img src="../Images/bf2a7f769e150a02932723b3176dd616.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uX3ykn0uV185NVfRS31O_Q.png"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">如果一切顺利，您应该会在Docker桌面应用程序中看到一个正在运行的容器。ckan的每个部分都有一个实例，比如数据库、web服务器和ckan本身。图片由作者提供。</p></figure><p id="4e85" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">7.如果您遇到任何问题，运行以下命令来修剪Docker可能是值得的:</p><p id="1383" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><code class="fe ns nt nu nv b">$ docker container prune<br/>$ docker volume prune<br/>$ docker network prune<br/>$ docker system prune</code></p><p id="6225" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">8.在你的浏览器上检查<a class="ae md" href="http://docker.for.mac.localhost:5000/" rel="noopener ugc nofollow" target="_blank">http://docker.for.mac.localhost:5000/</a>，你应该会看到CKAN网站正在运行！</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi nx"><img src="../Images/35ddddc5063272ab314c3c004eace85d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SsPmJ7SPQjsG5aOo.png"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">它还活着！图片由作者提供。</p></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="85bf" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">就这些吗？</h1><p id="5180" class="pw-post-body-paragraph kr ks it kt b ku ne kd kw kx nf kg kz la ng lc ld le nh lg lh li ni lk ll lm im bi translated">好的，很好。我们设法很快完成了基础安装，这将作为CKAN最初设定的<strong class="kt jd">元数据</strong>门户。不过，您可能会有兴趣将CKAN作为一个<strong class="kt jd"> <em class="ny">数据</em> </strong>门户来运行。为此，您需要设置数据存储扩展，同时让我们也设置管理员用户名。</p><blockquote class="nz oa ob"><p id="3bc3" class="kr ks ny kt b ku kv kd kw kx ky kg kz oc lb lc ld od lf lg lh oe lj lk ll lm im bi translated">在本节中，我们将使用<strong class="kt jd"><em class="it">production . ini</em></strong>文件。这基本上是CKAN存储所有相关选项的地方，比如语言、用户和扩展。但是请注意，根据您使用的CKAN版本，这可能会被命名为<strong class="kt jd"> <em class="it"> ckan.ini </em> </strong>。</p></blockquote><ol class=""><li id="91c7" class="nj nk it kt b ku kv kx ky la nl le nm li nn lm no np nq nr bi translated">预先为数据存储设置用户:</li></ol><p id="22e2" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><code class="fe ns nt nu nv b">$ docker exec ckan ckan -c /etc/ckan/production.ini datastore set-permissions | docker exec -i db psql -U ckan</code></p><blockquote class="nz oa ob"><p id="43d4" class="kr ks ny kt b ku kv kd kw kx ky kg kz oc lb lc ld od lf lg lh oe lj lk ll lm im bi translated">docker exec命令意味着我们可以在任何特定的<strong class="kt jd">运行</strong>容器中运行命令——在本例中，我们已经访问了ckan分区。</p></blockquote><p id="3d9a" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">2.访问Docker Linux虚拟机:</p><p id="f467" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><code class="fe ns nt nu nv b">$ docker run -it --privileged --pid=host justincormack/nsenter1</code></p><p id="0524" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">3.现在您已经进入了Linux机器，让我们使用<a class="ae md" href="https://www.tutorialspoint.com/unix/unix-vi-editor.htm" rel="noopener ugc nofollow" target="_blank"> UNIX <strong class="kt jd"> vi </strong>编辑器</a>对<em class="ny"> production.ini </em>文件(或<em class="ny"> ckan.ini </em>取决于ckan的版本)进行修改，CKAN的大多数规则:<br/> <code class="fe ns nt nu nv b">$ vi var/lib/docker/volumes/docker_ckan_config/_data/production.ini</code>都在这个文件中</p><p id="8716" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">a.将<code class="fe ns nt nu nv b">datastore datapusher</code>添加到<code class="fe ns nt nu nv b">ckan.plugins<br/></code> b。取消<code class="fe ns nt nu nv b">ckan.datapusher.formats<br/></code> c。将<code class="fe ns nt nu nv b">ckan.locale_default</code>更改为您偏好的语言</p><blockquote class="nz oa ob"><p id="9428" class="kr ks ny kt b ku kv kd kw kx ky kg kz oc lb lc ld od lf lg lh oe lj lk ll lm im bi translated">要编辑production.ini文件，键入<strong class="kt jd"> i </strong>进行插入。然后<strong class="kt jd"> ESC </strong>，然后<strong class="kt jd"> :x </strong>保存时退出vi，或者<strong class="kt jd"> :q！</strong>不保存退出。要退出虚拟机，请键入<strong class="kt jd"> exit </strong>。</p></blockquote><p id="fdd8" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">4.一旦您退出了VM，让我们重新启动容器来实现更改:<br/> <code class="fe ns nt nu nv b">$ docker-compose restart ckan</code></p><p id="14ba" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">5.要检查一切是否顺利，请访问<a class="ae md" href="http://docker.for.mac.localhost:5000/api/3/action/datastore_search?resource_id=_table_metadata" rel="noopener ugc nofollow" target="_blank">http://docker . for . MAC . localhost:5000/API/3/action/datastore _ search？resource _ id = _ table _ metadata</a><br/>您应该会看到一个带有“success: true”属性的JSON对象。</p><p id="554c" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">6.现在让我们为CKAN创建超级用户:<br/> <code class="fe ns nt nu nv b">$ docker exec -it ckan ckan -c/etc/ckan/production.ini sysadmin add yourname</code></p><p id="cc3d" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">你现在应该可以用<code class="fe ns nt nu nv b">yourname</code>登录CKAN了。</p><p id="1329" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">7.作为将来的参考，如果您想让<strong class="kt jd">停止</strong>容器，只需访问存储和运行原始docker-compose文件的文件夹:<code class="fe ns nt nu nv b"><br/>$ docker-compose down</code></p><p id="6be6" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">要重新激活它，只需运行<br/> <code class="fe ns nt nu nv b">$ docker-compose up</code></p><p id="4405" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">让我们用我们的用户登录并上传一个数据集，看看它会是什么样子。我将上传一些存储在压缩shapefile中的行政边界，看看它是什么样子的。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi of"><img src="../Images/74aa0d7206fc078f2a81b5c30597bdb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4_c_DL0UwtsfFN5IGIuzEw.png"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">图片由作者提供。</p></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="3363" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">我以为你提到了地理空间？</h1><p id="ad80" class="pw-post-body-paragraph kr ks it kt b ku ne kd kw kx nf kg kz la ng lc ld le nh lg lh li ni lk ll lm im bi translated">为了让CKAN具有空间感知能力，我们需要安装两个扩展:<a class="ae md" href="https://github.com/ckan/ckanext-geoview" rel="noopener ugc nofollow" target="_blank"> geoview </a>和<a class="ae md" href="https://github.com/ckan/ckanext-spatial" rel="noopener ugc nofollow" target="_blank"> spatial </a>。请记住，有许多扩展可能非常有用，比如<a class="ae md" href="https://extensions.ckan.org/extension/spatialui/" rel="noopener ugc nofollow" target="_blank">地图小部件</a>。</p><p id="1da1" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在CKAN的dockerized实例中安装扩展的方法不止一种。您可以将这些步骤包含在菜谱中，并从一开始就安装它们。在这里，我们将把扩展<strong class="kt jd">直接安装在这个特定的运行容器</strong>上，因此这不会对我们用来构建这些映像的docker文件产生任何影响。</p><h2 id="e5c4" class="og mn it bd mo oh oi dn ms oj ok dp mw la ol om my le on oo na li op oq nc iz bi translated">地理视图</h2><p id="9429" class="pw-post-body-paragraph kr ks it kt b ku ne kd kw kx nf kg kz la ng lc ld le nh lg lh li ni lk ll lm im bi translated"><strong class="kt jd"> Ckanext-geoview </strong>是一个扩展，能够以网络地图的形式预可视化空间数据。那些可以是shapefiles，geojson甚至是WMS。</p><ol class=""><li id="de38" class="nj nk it kt b ku kv kx ky la nl le nm li nn lm no np nq nr bi translated">进入正在运行的ckan容器:<br/> <code class="fe ns nt nu nv b">$ docker exec -it ckan /bin/bash -c "export TERM=xterm; exec bash"</code></li></ol><p id="3f90" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">2.在运行容器内，激活virtualenv: <br/> <code class="fe ns nt nu nv b">$ source $CKAN_VENV/bin/activate &amp;&amp; cd $CKAN_VENV/src<br/>$ git clone <a class="ae md" href="https://github.com/ckan/ckanext-geoview.git" rel="noopener ugc nofollow" target="_blank">https://github.com/ckan/ckanext-geoview.git</a><br/>$ cd ckanext-geoview<br/>$ pip install -r pip-requirements.txt<br/>$ python setup.py install<br/>$ python setup.py develop<br/>$ cd ..<br/>$ exit</code></p><p id="3bf4" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">3.访问Docker Linux虚拟机:<br/> <code class="fe ns nt nu nv b">$ docker run -it --privileged --pid=host justincormack/nsenter1</code></p><p id="5cc0" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">4.从虚拟机内部:<br/> <code class="fe ns nt nu nv b">$ vi var/lib/docker/volumes/docker_ckan_config/_data/production.ini</code></p><p id="3345" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">5.在<code class="fe ns nt nu nv b">ckan.plugins</code>中增加<code class="fe ns nt nu nv b">resource_proxy geo_view geojson_view shp_view</code></p><p id="5584" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">6.将<code class="fe ns nt nu nv b">geo_view geojson_view shp_view</code>添加到<code class="fe ns nt nu nv b">ckan.views.default_views</code></p><blockquote class="nz oa ob"><p id="6323" class="kr ks ny kt b ku kv kd kw kx ky kg kz oc lb lc ld od lf lg lh oe lj lk ll lm im bi translated">同样，要用vi编辑器编辑production.ini文件，键入<strong class="kt jd"> i </strong>进行插入。然后<strong class="kt jd"> ESC </strong>，然后<strong class="kt jd"> :x </strong>保存时退出vi，或者<strong class="kt jd"> :q！</strong>退出而不保存。要退出虚拟机，请键入<strong class="kt jd"> exit </strong>。</p></blockquote><p id="4adb" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">7.通过运行<br/> <code class="fe ns nt nu nv b">$ docker-compose restart ckan</code>重新启动容器</p><p id="aba5" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">安装Geoview后，我们现在可以通过点击<em class="ny"> Explore </em>按钮，直接在CKAN的网络地图中显示我们之前上传的数据。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi or"><img src="../Images/85fb76f3ce058943fe54acf4b3b24ab8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-xeihUrHbnP_jdpAu_xQmA.png"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">图片由作者提供。</p></figure><h2 id="b1ea" class="og mn it bd mo oh oi dn ms oj ok dp mw la ol om my le on oo na li op oq nc iz bi translated">空间的</h2><p id="fb65" class="pw-post-body-paragraph kr ks it kt b ku ne kd kw kx nf kg kz la ng lc ld le nh lg lh li ni lk ll lm im bi translated">Spatial是一个扩展，可将空间字段用于CKAN中存储的所有元数据。所以基本上，它将在底层PostgreSQL数据库中安装PostGIS，并在我们的门户中启用空间索引和搜索。安装它会比geoview稍微复杂一点，但是我们会做到的。</p><ol class=""><li id="99bd" class="nj nk it kt b ku kv kx ky la nl le nm li nn lm no np nq nr bi translated">进入正在运行的ckan容器:<br/> <code class="fe ns nt nu nv b">$ docker exec -it ckan /bin/bash -c "export TERM=xterm; exec bash"</code></li></ol><p id="f377" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">2.在运行容器中，激活virtualenv，获取扩展的源代码并安装:<br/> <code class="fe ns nt nu nv b">$ source $CKAN_VENV/bin/activate &amp;&amp; cd $CKAN_VENV/src/<br/>$ git clone <a class="ae md" href="https://github.com/ckan/ckanext-spatial.git" rel="noopener ugc nofollow" target="_blank">https://github.com/ckan/ckanext-spatial.git</a><br/>$ cd ckanext-spatial<br/>$ pip install -r pip-requirements.txt<br/>$ python setup.py install<br/>$ python setup.py develop<br/>$ cd ..<br/>$ exit</code></p><p id="f474" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">3.这就是棘手的地方。我们将从主机容器中更新postgis的权限:<br/> <code class="fe ns nt nu nv b">$ docker exec -it db psql -U ckan -f /docker-entrypoint-initdb.d/20_postgis_permissions.sql</code></p><p id="c615" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">4.访问Docker Linux虚拟机:<br/> <code class="fe ns nt nu nv b">$ docker run -it --privileged--pid=host justincormack/nsenter1</code></p><p id="0f64" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">5.从虚拟机内部:<br/> <code class="fe ns nt nu nv b">$ vi var/lib/docker/volumes/docker_ckan_config/_data/production.ini</code></p><p id="7457" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">将<code class="fe ns nt nu nv b">spatial_metadata spatial_query</code>添加到<code class="fe ns nt nu nv b">ckan.plugins</code></p><p id="2d71" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">添加<code class="fe ns nt nu nv b">ckanext.spatial.search_backend = solr</code></p><p id="03c1" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">6.重启容器:<br/> <code class="fe ns nt nu nv b">$ docker-compose restart ckan</code></p><p id="65ed" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">​​7.重新进入正在运行的ckan容器并重新激活virtualenv: <br/> <code class="fe ns nt nu nv b">$ docker exec -it ckan /bin/bash -c "export TERM=xterm; exec bash"<br/>$ source $CKAN_VENV/bin/activate &amp;&amp; cd $CKAN_VENV/src/</code></p><p id="d221" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">8.从虚拟机内部，运行空间initdb命令:<br/> <code class="fe ns nt nu nv b">$ ckan--config=/etc/ckan/production.ini spatial initdb</code></p><p id="d77e" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">9.通过访问<a class="ae md" href="http://docker.for.mac.localhost:5000/api/3/action/status_show" rel="noopener ugc nofollow" target="_blank">http://docker . for . MAC . localhost:5000/API/3/action/status _ show</a>再次重启容器并检查它是否工作</p><p id="5239" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">安装Spatial后，我们现在可以对数据集进行地理索引，并按空间范围进行搜索！</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="e1c6" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">这是所有的乡亲</h1><p id="90ab" class="pw-post-body-paragraph kr ks it kt b ku ne kd kw kx nf kg kz la ng lc ld le nh lg lh li ni lk ll lm im bi translated">这一块就到此为止！我们已经成功地在Mac上运行了CKAN的dockerized实例，它具有两个重要的地理空间数据扩展！如果你有问题或建议，不要犹豫，随时给我写信！</p><p id="9517" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">如果你喜欢这篇文章，考虑给我买杯咖啡，这样我就可以继续写更多的文章了！</p><div class="os ot gp gr ou ov"><a href="https://www.buymeacoffee.com/guilhermeiablo" rel="noopener  ugc nofollow" target="_blank"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd jd gy z fp pa fr fs pb fu fw jc bi translated">古伊列梅·亚布洛诺夫斯基正在传播空间数据科学</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">嘿👋我刚刚在这里创建了一个页面。你现在可以给我买杯咖啡了！</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">www.buymeacoffee.com</p></div></div><div class="pe l"><div class="pf l pg ph pi pe pj lx ov"/></div></div></a></div></div></div>    
</body>
</html>