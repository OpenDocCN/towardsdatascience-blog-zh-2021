<html>
<head>
<title>Creating a better dashboard with Python, Dash, and Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python、Dash 和 Plotly 创建更好的仪表板</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-a-better-dashboard-with-python-dash-and-plotly-80dfb4269882?source=collection_archive---------0-----------------------#2021-12-24">https://towardsdatascience.com/creating-a-better-dashboard-with-python-dash-and-plotly-80dfb4269882?source=collection_archive---------0-----------------------#2021-12-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7c08" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让您开始使用 python 轻松创建仪表板的演练。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bc114ceb8ec11a962d05eae110490c98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oKGxj5AzbZ5wRuOawBZ7fQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">仪表板——来自<a class="ae ky" href="https://www.pexels.com/photo/white-motorcycle-cluster-gauge-887843/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae ky" href="https://www.pexels.com/@mikebirdy?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">迈克</a>拍摄</p></figure><h1 id="a8e7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="a88b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我的爱好是研究商品和期货的深度。正如人们可能想象的那样，其中包含大量数据和分析。表格、报告、图表、图形——应有尽有。</p><p id="f38e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在努力前进并弄清楚这一切的过程中，我发现自己需要想象那些并不总是存在的东西。我需要以我想要的方式查看数据。</p><p id="b00f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你从事任何形式或行业的数据分析，你可能已经知道我在说什么了。然而，有很多刚接触数据分析的人只是在尝试。也有一些比较有经验的人只是没用过这些工具。</p><p id="9e27" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这篇文章是写给那些想做更多事情或者想尝试新工具的人的。也许你已经完成了 Dash 和 Plotly 的基础部分，想看看不同的东西。</p><p id="2c29" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">希望这能回答一些问题或激发一些新的创意。</p><h1 id="a567" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">期待什么</h1><p id="97a6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我将用一种全新的方法来研究这篇文章。我将解释这个项目是如何产生的，它的结构和功能，以及我认为它未来的发展方向。</p><p id="b178" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">由于大小的原因，我无法对所有内容进行完整的逐行解剖。然而，我已经煞费苦心地编写了包含大量内联文档的冗长而简单的代码。作为补充，存储库文件将是非常宝贵的。</p><p id="abc0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我的目的是提供一个运行这样一个项目的模板概述，并展示一些可能的东西。你不需要真正理解底层数据，甚至不需要对它感兴趣就能获得洞察力。如果你对商品和期货感兴趣，那么这将会有一个全新的价值维度。</p><h1 id="0942" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">开始的时候…</h1><p id="99b1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">正如我在介绍中所说，我的爱好是收集和分析商品数据。这些数据的一个重要来源是商品期货交易委员会(CFTC)提供的每周报告。</p><p id="4e88" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我在整个项目中使用的数据保存在这里:<a class="ae ky" href="https://www.cftc.gov/MarketReports/CommitmentsofTraders/index.htm" rel="noopener ugc nofollow" target="_blank">https://www . CFTC . gov/market reports/CommitmentsofTraders/index . htm</a></p><p id="775c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">对我来说，整个项目始于对一些报告的剖析。当我第一次开始时，我编写了一个快速脚本，它将获取报告，对文件进行一些处理，添加一些值，并输出一些图表。然后举报数量开始增长。</p><p id="b7d2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">随着我的继续，我开始观察多种商品。我运行我的脚本，让几十个标签用各种各样的图表填满浏览器窗口。这是不可持续的。</p><p id="d25f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我需要组织这一切。因此，仪表板被概念化了。</p><p id="0201" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">像所有懒惰的程序员一样，我从一个模板开始。该模板碰巧是我过去使用的标准模板，并针对更大的数据库驱动的分析系统进行了改进。我开始撕掉我不需要的东西，开始建造。</p><p id="a107" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我提出这个并不是为了用不必要的描述和故事来浪费时间，而是为了给出一些架构决策背后的一些逻辑。乍一看似乎很奇怪的事情。然而，当把简单的系统扩展成更健壮和更复杂的系统时，这一切都是有意义的。</p><p id="f236" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">好的解决方案解决今天的问题。更好的解决方案着眼于未来。伟大的系统融合了这两者。</p><h1 id="ae61" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">代码</h1><p id="3b24" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">当我们深入研究时，你需要访问代码。这是我的这个项目资源库的链接。所有代码示例和参考均来自此处:</p><div class="ms mt gp gr mu mv"><a href="https://github.com/brad-darksbian/commodities-dashboard" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">GitHub-Brad-darksbian/commodities-dashboard:一个查看商品头寸数据的简单仪表板…</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">一个简单的仪表板，查看商品的立场数据的基础上，CFTC 报告这是一个 python 项目使用破折号和…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">github.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj ks mv"/></div></div></a></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/b4dff86499a4a2e3417bad3572dead74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7iw3yLEq1SeQfv56-pzw3Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">商品仪表板——我们在构建什么</p></figure><h1 id="7be8" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">高层设计</h1><p id="5c94" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">该仪表板包含多个元素，这些元素被划分为不同的组织文件。</p><ol class=""><li id="b3cb" class="nl nm it lt b lu mn lx mo ma nn me no mi np mm nq nr ns nt bi translated">main.py —此文件包含仪表板代码，用作前端组织文件。</li><li id="5f24" class="nl nm it lt b lu nu lx nv ma nw me nx mi ny mm nq nr ns nt bi translated">support_functions.py —这个文件是系统的核心。从报告检索到实际图表创建的一切都存在于此。</li><li id="6885" class="nl nm it lt b lu nu lx nv ma nw me nx mi ny mm nq nr ns nt bi translated">business_logic.py —该文件充当收集数据和设置必要数据框架的桥梁。</li><li id="e954" class="nl nm it lt b lu nu lx nv ma nw me nx mi ny mm nq nr ns nt bi translated">layout_configs.py —该文件包含帮助器元素，用于按照我希望的方式设计图表，以及定义我希望使用的工具。</li></ol><p id="52d0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果我要进一步重构，我可以通过重新组织来删除其中的一些文件。然而，随着系统的增长，它为适当地合并其他功能提供了一个很好的平衡。例如，在我的较大的应用程序中，我的 business_logic 文件处理数据库调用和更多的数据争论，然后才进行传递。</p><h1 id="6f0a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">支持功能</h1><p id="2431" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们从讨论一些获取数据所需的后台函数开始。没有一些数据，我们真的做不了什么。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="7052" class="oe la it oa b gy of og l oh oi">deacot_file = "/tmp/deacot2021.txt"<br/>da_file = "/tmp/deacot_DA_2021.txt"</span><span id="53b1" class="oe la it oa b gy oj og l oh oi"># Data Retreival and Handling<br/># Function to retrieve reports<br/>def get_COT(url, file_name):<br/>  with urllib.request.urlopen(url) as response, open(file_name, "wb") as out_file:<br/>    shutil.copyfileobj(response, out_file)<br/>  with zipfile.ZipFile(file_name) as zf:<br/>    zf.extractall()</span><span id="643e" class="oe la it oa b gy oj og l oh oi"># Function to make sure things are fresh for data<br/>def get_reports():<br/>  freshness_date = datetime.now() - timedelta(days=7)<br/>  if os.path.exists(deacot_file):<br/>    filetime = datetime.fromtimestamp(os.path.getctime(deacot_file))<br/>    if (filetime - timedelta(days=7)) &lt;= freshness_date:<br/>      print("Deacot file exists and is current - using cached data")<br/>    else:<br/>      get_COT(<br/>        "https://www.cftc.gov/files/dea/history/deacot2021.zip",<br/>        "deacot2021.zip",)<br/>      os.rename(r"annual.txt", deacot_file)<br/>      print("Deacot file is stale - getting fresh copy")<br/>  else:<br/>    print("Deacot file does not exist - getting fresh copy")<br/>    get_COT(<br/>      "https://www.cftc.gov/files/dea/history/deacot2021.zip",<br/>      "deacot2021.zip")<br/>    os.rename(r"annual.txt", deacot_file)</span><span id="3a91" class="oe la it oa b gy oj og l oh oi">  if os.path.exists(da_file):<br/>    filetime = datetime.fromtimestamp(os.path.getctime(da_file))<br/>    if (filetime - timedelta(days=7)) &lt;= freshness_date:<br/>      print("Disaggregation report file exists and is current - using cached data")<br/>    else:<br/>      get_COT( "https://www.cftc.gov/files/dea/history/fut_disagg_txt_2021.zip",<br/>        "fut_disagg_txt_2021.zip",)<br/>      os.rename(r"f_year.txt", da_file)<br/>      print(<br/>        "Disaggregation report file is stale - getting fresh copy")<br/>  else:<br/>    print(<br/>      "Disaggregation report file does not exist - getting fresh copy")<br/>    get_COT(<br/>   "https://www.cftc.gov/files/dea/history/fut_disagg_txt_2021.zip",<br/>      "fut_disagg_txt_2021.zip",)<br/>    os.rename(r"f_year.txt", da_file)</span></pre><p id="22d8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">上面的两个函数(在 Medium 的代码框中被可怕地格式化了)做了几件事。首先，函数 get_reports()评估文本报告文件是否存在。如果是，则检查它们是否是“新鲜的”,因为它们少于或等于七天。如果它们是好的，则使用现有的文件。如果没有，则检索新的。同样，如果文件不存在，则从 CFTC 网站检索。</p><p id="e294" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">文件检索使用第一个函数 get_COT，并将 url 和文件名作为参数。这些函数使用 python 模块 zip 文件、url lib、shutil、os 和 datetime。设置两个变量来定义路径。</p><p id="2e1b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果使用此代码，请记住根据您的情况适当地设置这些变量。</p><p id="64d2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一旦我们有了文件，我们就有了要处理的数据。但是，它还是生的。文件“deacot_process”和“DA_process”中的下两个函数会对数据帧进行一些修改。</p><p id="3c52" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一般来说，这些函数首先重命名一些列，使事情更容易处理。接下来，他们按照日期对数据帧进行排序，以确保事情按照预期的方式有序进行。之后，会创建一些新的计算列，以便以后参考。最后，拆分“exchange”列，为商品和市场创建两个新列。最后一步是必要的，以便以后在图表和其他位置提供一些标签。</p><p id="e4f4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">就我个人而言，我总是觉得很难决定是应该将计算列添加到主数据框架中，还是等到以后再添加。我个人的原则是，如果我认为有可能不止一个地方需要它，我会全力以赴。</p><p id="b3c3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这个文件的其余部分由生成特定图表的函数组成，这些图表将在仪表板上使用。我不会详细讨论它们，但是如果有不清楚的地方，我鼓励任何人提问。</p><p id="9c63" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">因为这是一个图表优先的过程，所以图表是在合并到仪表板框架之前定义的。简单地将它们创建为可调用的函数比采用其他方法更有意义。但是，和任何事情一样，应对这一挑战的方法不止一种。</p><p id="e7cc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要记住的关键是图表是由函数作为一个现成的对象返回的。这意味着您可以将其作为函数的输出、图形变量或作为布局对象的一部分内联调用。你的选择实际上取决于组织和使用。</p><h1 id="dea1" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">业务逻辑</h1><p id="ae5a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这个应用程序中，business_logic.py 文件非常简单。总共 41 行，包括许多注释，它实际上只是提供了一个在应用程序启动或重新加载时运行某些功能的入口。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="eb93" class="oe la it oa b gy of og l oh oi">"""    <br/>This files does a lot of the dataframe work and larger data functions. Mostly this is data retrieval, organization, and making sure everything is ready to be called by the main app via call backs.    <br/>This is called by main.py and in turn calls support functions when needed<br/>"""<br/>import pandas as pd<br/>import numpy as np<br/>import plotly.io as pio<br/>import support_functions as sf </span><span id="48ad" class="oe la it oa b gy oj og l oh oi">pd.options.plotting.backend = "plotly"<br/>pio.templates.default = "plotly_dark" </span><span id="f0eb" class="oe la it oa b gy oj og l oh oi"># Make sure we have data<br/># This will check to see if a file exists and if not gets one<br/>#  This also checks the data freshness<br/>sf.get_reports() </span><span id="5899" class="oe la it oa b gy oj og l oh oi"># Get the data frames to work with<br/># DEACOT report<br/>df_deacot = pd.read_csv("/tmp/deacot2021.txt", na_values="x")<br/>df_deacot = sf.deacot_process(df_deacot) </span><span id="4501" class="oe la it oa b gy oj og l oh oi"># Disambiguation report<br/>df_da = pd.read_csv("/tmp/deacot_DA_2021.txt", na_values="x", low_memory=False)<br/>df_da = sf.DA_process(df_da) </span><span id="6d35" class="oe la it oa b gy oj og l oh oi">####################################################<br/># Generate the commodities list - use the DA listing<br/>####################################################<br/>da_list = df_da["Exchange"].unique()<br/>da_list = np.sort(da_list) </span><span id="7783" class="oe la it oa b gy oj og l oh oi">if __name__ == "__main__":    <br/>  print("business logic should not be run like this")</span></pre><p id="843c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">总体布局如下:</p><ol class=""><li id="2ab4" class="nl nm it lt b lu mn lx mo ma nn me no mi np mm nq nr ns nt bi translated">将数据帧后端设置为 plotly。</li><li id="27d3" class="nl nm it lt b lu nu lx nv ma nw me nx mi ny mm nq nr ns nt bi translated">将默认模板配置为深色主题。</li><li id="d74e" class="nl nm it lt b lu nu lx nv ma nw me nx mi ny mm nq nr ns nt bi translated">使用函数获取报告</li><li id="45cd" class="nl nm it lt b lu nu lx nv ma nw me nx mi ny mm nq nr ns nt bi translated">将 CSV 读入数据帧并适当处理</li><li id="78ca" class="nl nm it lt b lu nu lx nv ma nw me nx mi ny mm nq nr ns nt bi translated">创建一个只包含交换列中唯一值的新数组</li></ol><p id="890b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">第 5 项用于创建商品的主列表，我们将使用它来驱动仪表板视图并相应地更新图表。</p><h1 id="445b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">布局配置</h1><p id="c83b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">layout_config.py 文件包含一些可以跨图表重用的样式数据。它的存在主要是为了简化布局和图表构建过程。</p><p id="b9b0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">例如:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="d1a6" class="oe la it oa b gy of og l oh oi">layout = go.Layout(    <br/>  template="plotly_dark",    <br/>  # plot_bgcolor="#FFFFFF",    <br/>  hovermode="x",    <br/>  hoverdistance=100,  # Distance to show hover label of data point    <br/>  spikedistance=1000,  # Distance to show spike    <br/>  xaxis=dict(        <br/>    title="time",        <br/>    linecolor="#BCCCDC",        <br/>    showspikes=True,        <br/>    spikesnap="cursor",        <br/>    spikethickness=1,        <br/>    spikedash="dot",        <br/>    spikecolor="#999999",        <br/>    spikemode="across",    <br/>  ),    <br/>  yaxis=dict(        <br/>    title="price",        <br/>    linecolor="#BCCCDC",        <br/>    tickformat=".2%",        <br/>    showspikes=True,        <br/>    spikesnap="cursor",        <br/>    spikethickness=1,        <br/>    spikedash="dot",        <br/>    spikecolor="#999999",        <br/>    spikemode="across",    <br/>  ),<br/>)</span><span id="253c" class="oe la it oa b gy oj og l oh oi">tool_config = {    <br/>  "modeBarButtonsToAdd": [        <br/>    "drawline",        <br/>    "drawopenpath",        <br/>    "drawclosedpath",        <br/>    "drawcircle",        <br/>    "drawrect",        <br/>    "eraseshape",        <br/>    "hoverclosest",        <br/>    "hovercompare",    <br/>  ],    <br/>  "modeBarButtonsToRemove": [        <br/>    "zoom2d",        <br/>    "pan2d",        <br/>    "select2d",        <br/>    "lasso2d",        <br/>    "zoomIn2d",        <br/>    "zoomOut2d",        <br/>    "autoScale2d",    <br/>  ],    <br/>  "showTips": False,    <br/>  "displaylogo": False,<br/>}</span></pre><p id="caa6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这两种情况下，放置这些类型的配置允许对图表呈现和工具配置进行集中管理。</p><h1 id="681a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">主仪表板</h1><p id="6ec6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这是你们期待已久的时刻，构建真正的仪表板代码。</p><p id="dafd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我知道当我第一次开始使用 Dash 时，主文件似乎令人生畏。发生了很多事。我也没有明确的组织流程。但是，我让它以一种对我有意义的方式工作。这就是我将带领你经历的。</p><p id="b311" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我倾向于按以下方式整理我的主要文件:</p><ol class=""><li id="636b" class="nl nm it lt b lu mn lx mo ma nn me no mi np mm nq nr ns nt bi translated">样式修饰符。</li><li id="623e" class="nl nm it lt b lu nu lx nv ma nw me nx mi ny mm nq nr ns nt bi translated">内容结构。通常，这些是保存行数据的容器。我发现以反映实际布局的方式构造我的文件是最容易的。我从顶部开始向下移动。</li><li id="c979" class="nl nm it lt b lu nu lx nv ma nw me nx mi ny mm nq nr ns nt bi translated">页面布局聚合。内容结构被放入页面布局中，并被组织到一个引用中。</li><li id="2790" class="nl nm it lt b lu nu lx nv ma nw me nx mi ny mm nq nr ns nt bi translated">应用参数。这是实际应用程序行为以及应用程序标题、样式表和主题等全局项目所在的地方。</li><li id="cc04" class="nl nm it lt b lu nu lx nv ma nw me nx mi ny mm nq nr ns nt bi translated">复试。这些是允许窗口小部件运行的动态代码，并真正使仪表板起作用。</li><li id="a66a" class="nl nm it lt b lu nu lx nv ma nw me nx mi ny mm nq nr ns nt bi translated">服务器运行。这是实际启动服务器和运行仪表板的最后一行代码。</li></ol><p id="0a23" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们浏览其中的一些，让您感受一下所有部分是如何组合在一起的。我要把这些有点乱，但没什么大不了的。</p><p id="147c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">首先，让我们看看应用程序参数和服务器一起运行。这些构成了仪表板的骨架，并告知了布局的其他一些方面。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="154d" class="oe la it oa b gy of og l oh oi">#####################################################<br/># Application parameters<br/>#####################################################<br/>app = dash.Dash(    <br/>  __name__,    <br/>  suppress_callback_exceptions=True,    <br/>  external_stylesheets=[dbc.themes.CYBORG],<br/>)<br/>app.title = "CFTC Data Analysis"<br/>app.layout = html.Div(    <br/>  [<br/>    dcc.Location(<br/>      id="url", <br/>      refresh=False), <br/>    html.Div(id="page-content")<br/>  ]) </span><span id="8cb7" class="oe la it oa b gy oj og l oh oi"># Multi-page selector callback - left in for future use<br/>@app.callback(<br/>  Output("page-content", "children"), <br/>  Input("url", "pathname")<br/>)<br/>def display_page(pathname):        <br/>  # if pathname == "/market-sentiment":    <br/>  #     return volumes    <br/>  # else:    <br/>  return main_page</span><span id="7f98" class="oe la it oa b gy oj og l oh oi">###################################################<br/># Server Run<br/>###################################################<br/>if __name__ == "__main__":    <br/>  app.run_server(<br/>    debug=True, <br/>    host="0.0.0.0", <br/>    port=8050, <br/>    dev_tools_hot_reload=True<br/>  )</span></pre><p id="2e78" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在大多数情况下，应用程序参数应该是不言自明的。需要注意的关键项目是“外部样式表”。这正是我们所说的——外部样式表。在这个例子中，我使用了一个名为 CYBORG 的引导主题，这是一个黑暗主题。</p><p id="862b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这里，我们还有 app.title 参数，用于应用程序设置标题。app.layout 参数设置了一个过程，通过该过程，名为“page-content”的 id 通过回调函数“display_page”的输出进行传递。这不是绝对必要的，但它允许读取 URL 路径并基于该路径提供不同的内容。它用于多页应用程序。我把它留在里面作为参考。</p><p id="b83a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，我们有服务器运行部分。我们可以在这里设置监听 ip 地址和端口。因为我在本地服务器上运行我的仪表板，以便在我所有的计算机上使用，所以我被配置为在端口 8050 上公开侦听。我还将 debug 设置为 True。这减少了我的日志文件中的喋喋不休。如果 debug 设置为 true，应用程序还会在检测到任何文件中的更改时进行热重新加载，这对于开发来说非常有用。</p><h1 id="4ee7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">复试</h1><p id="e050" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">许多文章、视频和其他材料都是围绕着回调而产生的。这是一个复杂的问题，我只谈一点皮毛。然而，这个主题至少可以让你了解它们是如何排列的。</p><p id="7b84" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这个仪表板中，有一个主下拉选择器，用于更新页面上的所有图表。稍后我将介绍这个下拉菜单，但是现在，重要的是要理解这个下拉菜单提供了一个 id 为“future”的输入</p><p id="4d5f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">记住这一点，让我们分解 main.py 文件中的第一个回调。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="2f13" class="oe la it oa b gy of og l oh oi"># Sentiment charts<br/>@app.callback(    <br/>  dash.dependencies.Output("deacot_sent", "figure"),    <br/>  [dash.dependencies.Input("future", "value")],<br/>)<br/>def deacot_sentiment(future1):    <br/>  df1 = bl.df_deacot[bl.df_deacot["Exchange"] == future1]    <br/>  df1.set_index("Date", inplace=True)     </span><span id="5e2d" class="oe la it oa b gy oj og l oh oi">  arr = df1["commodity"].unique()    <br/>  asset = arr[0]     <br/>  <br/>  fig = sf.make_sentiment_chart(df1, asset)    <br/>  return fig</span></pre><p id="7b96" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在不多的代码中，发生了很多事情。这主要是因为我们前面提到的组织。</p><p id="085e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">回调从 decorator app.callback 开始，这里我们有一行用于输出，一行用于输入。两者都接受它们引用的元素的 id 和被传递的数据类型的参数。</p><p id="7dab" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这种情况下，输入从“future”id 中收集一个值，我在本节开始时提到过。输出将图形数据发送到“deacot _ sent”。(是的，我知道我应该用连字符来标识……)</p><p id="a10a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">有了发送的输入和输出路由，我们必须做些什么来将该值转换成一个数字。这就是函数“deacot _ 情操”的用武之地。它接受输入参数，并简单地将其命名为 future1。</p><p id="0787" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">该函数首先过滤在 business_logic 中定义的名为 df _ deacot 的数据帧，并匹配从 future1 传入的值。我们只剩下一个整合的数据框架(df1 ),其中包含交换列与下拉列表中的选择相匹配的数据。</p><p id="fe54" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下一行将日期列设置为索引。接下来，我们获取商品列中的唯一值，并将它们放入一个数组中。由于报告的过滤方式，我们应该只有一个值。但是，因为有时事情不会按计划进行，所以我们将第一个数组元素放入名为“asset”的变量中。</p><p id="715c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然后，我们的 dataframe (df1)和变量“asset”被输入到位于 support_functions 文件中的图表函数 SF . make _ invision _ chart 中。函数的输出被设置为变量“fig”，它是图表的代码。</p><p id="fbed" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，fig 通过回调的输出以图形的形式返回。它正前往 id“deacot _ sent”。</p><p id="fa11" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">需要注意的是回调可以有多个输入和输出。输出可以链接到其他回调。</p><p id="18f1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然而，让我们跟随这个数字的路径…</p><h1 id="42bb" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">内容</h1><p id="9bf9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们刚刚看到了输入如何触发回调并将数字返回到 id。如果我们跳回内容，我们可以在构建用于显示的元素时看到这一点。</p><p id="3ddf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">正如我前面提到的，我喜欢按照行设置的自上而下的布局来排列我的主文件。这有助于我想象网格，并在构建时将它保存在我的脑海中。在这种情况下，我们为两个情绪图表定义了一行:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="d3a1" class="oe la it oa b gy of og l oh oi"># Container for sentiment charts<br/>sentiment_direction = dbc.Row(    <br/>  [        <br/>    dbc.Col(            <br/>      dcc.Graph(                <br/>        id="deacot_sent",                <br/>        style={"height": "70vh"},                <br/>        config=lc.tool_config,            <br/>      ),            <br/>      md=6,        <br/>    ),        <br/>    dbc.Col(            <br/>      dcc.Graph(                <br/>        id="da_sent",                <br/>        style={"height": "70vh"},                <br/>        config=lc.tool_config,            <br/>      ),            <br/>      md=6,        <br/>    ),    <br/>  ]<br/>)</span></pre><p id="b019" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">上面的代码设置了一个包含两列的行，每列包含一个不同的图表。第一列的 id 为“deacot _ sent”，这是回调输出的目标 id。</p><p id="6370" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">因为我们持有一个图表，所以我们使用 dash 核心组件(dcc)库提供的图形容器。在这里，我们设置 id 和许多其他参数。我特意将高度设置为样式覆盖。我还添加了一个“config”元素，它被设置为上面突出显示的 layout_config.py 文件中的 tool_config 值。</p><p id="ff05" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">因为元素是从回调的输出填充的，所以不需要显式数据源。如果我们以不同的方式生成图表，我们可能会使用“figure”参数来保存数据。</p><p id="cadb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，在 dbc 中。Col 函数，我们看到了“md=6”。这是一个使用引导框架的格式值。其中，每行被分成 12 个单元。设置“md=6”告诉框架，我希望我的列填充总数的 6 或一半。</p><p id="91ae" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">除了不同的 id 值之外，第二列是相同的。该列将是同一行上另一个图表的输出，占据了另一半空间。</p><h1 id="4476" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">布局</h1><p id="1550" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们从输入到输出之旅的最后一步是将行实际链接到将通过应用程序显示的页面布局。这很简单:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="c43c" class="oe la it oa b gy of og l oh oi">####################################################<br/># Layout Creation Section<br/>####################################################<br/>main_page = html.Div(    <br/>  [        <br/>    html.Hr(),        <br/>    html.H5(<br/>      "Futures Market Comparison and Analysis", <br/>      style=TEXT_STYLE<br/>    ),        <br/>    html.Hr(),        <br/>    future_select,        <br/>    html.Hr(),        <br/>    info_bar,        <br/>    html.Hr(),        <br/>    sentiment_direction,        <br/>    html.Hr(),        <br/>    da_postiions,        <br/>    html.Hr(),        <br/>    da_pos_snap,        <br/>    html.Hr(),        <br/>    da_diffs,        <br/>    html.Hr(),        <br/>    references,    <br/>  ],    <br/>  style=CONTENT_STYLE,<br/>)</span></pre><p id="f8d1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您还记得关于应用程序参数的部分，您会注意到应用程序的页面内容 id。没关系——再读一遍那个句子，有很多是连在一起的。</p><p id="c2a2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">main_page 变量只是 html.div 的另一个容器。div 由对以前构造的其他元素的引用组成。本质上，我们只是一点一点地构建，以达到最终的结果。</p><p id="4ab1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这里是页面集合的地方。在上面的代码中，我从空格、要显示的标题、更多空格、包含选择下拉列表的行、空格、信息栏、更多空格开始，然后是我们的第一行图表。这就是我上面展示的那一行。</p><p id="628d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是我们构建仪表板所需的一切。实际上，这比我们需要的要多得多，因为这个设计有点大，而且分散在几个文件中。然而，你现在也许能明白为什么为组织分解各种元素对保持你的理智是有效的。有很多块和元素。将它们组织成逻辑单元对于创建有用且可维护的应用程序大有帮助。</p><h1 id="2c07" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">最后一件事</h1><p id="3081" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我结束之前，我真的想为你整理一下。</p><p id="8acd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下拉菜单驱动仪表板。它提供了原始数据点，并允许基于特定商品评估整套报告。它是页面标题下的第一行，非常重要。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="cb81" class="oe la it oa b gy of og l oh oi"># Create drop-down selector<br/>future_select = dbc.Row(    <br/>  [        <br/>    dbc.Col(            <br/>      [                <br/>        html.Div(                    <br/>          [                        <br/>            dcc.Dropdown(                            <br/>              id="future",                            <br/>              options=[<br/>                {"label": i, "value": i} for i in bl.da_list],                            <br/>              value="SILVER - COMMODITY EXCHANGE INC.",                        <br/>            ),                    <br/>          ],                    <br/>          className="dash-bootstrap",                <br/>        ),            <br/>      ],            <br/>      md=6,        <br/>    )    <br/>  ]<br/>)</span></pre><p id="d0e6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">和以前一样，这是一个非常普通的结构。我们从行开始，然后添加一列。列中有一个 Div，包含 id 为“future”的下拉列表。记住“未来”是回调的输入。</p><p id="b95d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在下拉列表中，我们设置选项，这只是一个基于我们在 business_logic 文件中定义的 bl.da_list 数组的标签和值的扩展列表。这是从 DA 报告数据框架中提取的所有商品的唯一列表。实际上，DA 报告数据框架比 DEACOT 报告包含的内容少，因此使用 DA 作为主列表只是最小的公分母。</p><p id="9b65" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们最后设置了一个默认值，就是在启动时加载一些东西。在这种情况下，我使用银，因为这是我经常看的商品。</p><p id="0797" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">同样重要的是，尤其是在使用深色主题时，设置 classname 值。这允许应用适当的样式，以便下拉菜单在深色背景上看起来很合适。这会省去你很多审美上的头疼。</p><p id="e7d1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">沿着样式线，虽然我们只有一列，但它被设置为只延伸到整个行的一半。这是一个设计上的选择。你可能不同意。</p><h1 id="02d0" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">包扎</h1><p id="c9a6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这要涵盖的内容太多了。Dash 不是一个简单的平台，因为你可以用它完成很多事情。它的能力令人难以置信，一旦你习惯了它的细微差别，事情就会变得更有意义，你可以很快地构建。</p><p id="2ec2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">正如我在开始时提到的，从我的存储库中抓取代码并浏览它。虽然这只是一个大概的介绍，但是实际的代码是通过文档逐步实现的。更重要的是，这是一个你可以自己运行和探索的功能系统。</p><p id="6fcc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您确实提取了代码，请随意使用它。做一些很酷的东西，或者只是解剖它，尽你所能去学习。如果你真的想用我写的东西，就告诉我一声。否则，这就是我给这个世界的礼物。</p><p id="c3af" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果有关于清晰性的问题或与代码相关的问题，请随时直接联系我或留下您的评论。我鼓励提供反馈和建议，让事情变得更好。</p></div></div>    
</body>
</html>