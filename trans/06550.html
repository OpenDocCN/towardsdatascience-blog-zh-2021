<html>
<head>
<title>A Graphical Explanation of RoC and AUC</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RoC和AUC的图解说明</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-graphical-explanation-of-roc-and-auc-183705caeb27?source=collection_archive---------23-----------------------#2021-06-12">https://towardsdatascience.com/a-graphical-explanation-of-roc-and-auc-183705caeb27?source=collection_archive---------23-----------------------#2021-06-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6b65" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">理解阈值不变性<strong class="ak">并警惕一个常见错误</strong></h2></div><p id="b8d0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇文章将帮助你理解AUC相对于其他指标的优势，它是如何计算的(使用RoC ),以及为什么有必要这样计算。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/fa91a9426c79d264637c5332e9708fb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dIPdoYSqefwsIiOtFGZFiA.jpeg"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">大自然拥有巨鸟(图片来自<a class="ae lr" href="https://pixabay.com/users/ykaiavu-7068951/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=5372892" rel="noopener ugc nofollow" target="_blank">ykaaivu</a>来自<a class="ae lr" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=5372892" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure><h2 id="333a" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated"><strong class="ak">简介</strong></h2><p id="4858" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">如果您已经构建了一个分类器，那么您肯定已经使用准确度、精确度、召回率或F值等指标来衡量模型的性能。但是这些指标中的每一个都是在定义了衡量指标的截止概率(比如0.5)之后计算的。</p><h2 id="a1d1" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated"><strong class="ak">AUC相对于其他指标的优势</strong></h2><p id="2d73" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">当你有两个竞争模型，并想比较他们的表现呢？如果模型1在截止值为0.5时表现最佳，而模型2在截止值为0.4时表现最佳，会怎样？那么只检查上面提到的指标将会给出一个不完整的视图。因此，在比较两个模型时，建议检查受试者工作特征(RoC)曲线下的面积。</p><p id="e772" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是因为<strong class="kh ir"> AUC是阈值不变指标</strong>。我们的意思是，AUC不依赖于用于计算分类性能的概率阈值。相反，我们迭代0到1之间的所有截止概率，并计算每个截止点的TPR和FPR。</p><p id="8b9b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后画一条曲线——FPR对TPR的RoC曲线——并计算曲线下的面积。这是AUC。</p><h2 id="c5cc" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated"><strong class="ak">计算AUC——正确的方法</strong></h2><p id="c390" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">我有一个分类器，可以预测下个月顾客再次购买的可能性[ <a class="ae lr" href="https://github.com/divya-chou/Retail_Transactions" rel="noopener ugc nofollow" target="_blank">零售交易案例研究</a> ]。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/388ea997e9b39737c52693a7ed18af74.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/format:webp/1*xybgH1H1J9uyfhUwh8Dmog.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">分类器的概率输出[图片由作者提供]</p></figure><p id="903d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<em class="mt">sk learn . metrics</em>中提供的<em class="mt"> roc_curve </em>函数来计算TPR和FPR。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/5c58266caf2609afcb4af8bc40b0af8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*01MM-nVIZFft6r0bMoSKOw.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">Roc在每个阈值返回TPR和TPR图片由作者提供]</p></figure><p id="b536" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mt">不用担心1排1.99的阈值。根据sklearn的官方文档，</em> <a class="ae lr" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.roc_curve.html" rel="noopener ugc nofollow" target="_blank"> <em class="mt"> thresholds[0]表示没有实例被预测，并且被任意设置为max(y_score)+1。</em>T25】</a></p><p id="a05e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">计算AUC如下:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="28fb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并将RoC曲线绘制为:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/904fce7afa7489d384b63080d033d020.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*1Y6HBwOxDmGbS_ilnvI7NA.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">RoC的正确表示[图片由作者提供]</p></figure><h2 id="a273" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated"><strong class="ak">计算AUC时的常见错误</strong></h2><p id="1e08" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">很多时候，当我们太专注于编写计算f1的代码(或者准确度、精确回忆等)时。)喜欢:</p><p id="f550" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mt"> f1 = f1_score(y_true，y_pred) </em></p><p id="e3ab" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">…我们最终复制了那一行，并对其进行编辑，以计算AUC，如下所示:</p><p id="f06e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mt"> AUC = roc_auc_score(y_true，y_pred) </em></p><p id="f52b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">人们忘记了f1使用二值化输出，而AUC需要模型的概率输出。因此，正确的代码应该是:</p><p id="6c9b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mt"> AUC = roc_auc_score(y_true，y_pred_prob) </em></p><p id="84c6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为什么是错的？</p><p id="9c3b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">搞乱AUC的阈值不变性质会怎么样？对分类器的二值化结果计算AUC会发生什么？</strong></p><p id="f580" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们用同样的例子来理解。</p><p id="21e7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过最大化F1，我们找到了零售交易案例研究的最佳概率截止值。然后，我们将概率输出转换为二进制形式。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mw"><img src="../Images/bd6ac70bd161796a670810eded1e8857.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zfl2fa1Sb9aHQ8fdeKmgNA.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">分类器的概率输出(L)和二值化输出(R)[作者图片]</p></figure><p id="41fc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在计算所有可能的概率阈值下的TPR和FPR..</p><p id="fc9c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">等待..我们不是刚把输出二进制化了吗..？</p><p id="9199" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样我们只有两个概率阈值——0和1</p><p id="25a4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以TRP和FPR看起来像是——实际上只有两个条目——一个代表0，一个代表1。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/aa141aa245ba75e6e6ff03e23f962f7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*rXDrYrY0fpmz14y5gwJLiQ.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">二值化输出的RoC图片由作者提供]</p></figure><p id="d4fe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">RoC图看起来像这样:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/e0369809ce11451ba9e3f4905b7817ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*odO9C0D3j5viKjlq7o6xSA.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">具有二值化输出的RoC图片由作者提供]</p></figure><p id="4942" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意AUC从74%下降到68%。</p><p id="f45f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们叠加两条RoC曲线时，差异变得明显。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/f37128e1b5defbcb01961dd31364bed4.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*8tRezgBreCXk5dfvZ0pVzQ.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">由于二值化输出而丢失的区域[图片由作者提供]</p></figure><p id="a9cb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">蓝色和橙色线之间的区域是通过计算二进制化输出的AUC而损失的区域。</p><h2 id="e98d" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated"><strong class="ak">概括多个截止阈值</strong></h2><p id="8a2c" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">通过在多个阈值上进行二进制化，绘制二进制化输出的RoC。然后画一条连接所有曲线拐点的曲线，我们最终得到正确的RoC曲线。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi my"><img src="../Images/0d6dbeec07a21e175906a376ced963fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-PM8uaHsEA9hV3mma17KOg.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">加入拐点得到RoC[图片作者]</p></figure><p id="70b0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">紫色线实际上是绘制在概率输出上的RoC曲线。</p><h2 id="5479" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated"><strong class="ak">结论</strong></h2><p id="554e" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">我希望这些图表能阐明为什么AUC是根据分类器的概率输出计算的，以及我们所说的AUC是阈值不变的意思。</p></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><p id="caac" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢阅读。想了解更多这样的数据科学知识，请阅读我的其他帖子，并在Linkedin上与我联系。</p></div></div>    
</body>
</html>