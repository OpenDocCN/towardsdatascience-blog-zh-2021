<html>
<head>
<title>Exploratory Data Analysis, Visualization, and Prediction Model in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的探索性数据分析、可视化和预测模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/exploratory-data-analysis-visualization-and-prediction-model-in-python-241b954e1731?source=collection_archive---------5-----------------------#2021-04-13">https://towardsdatascience.com/exploratory-data-analysis-visualization-and-prediction-model-in-python-241b954e1731?source=collection_archive---------5-----------------------#2021-04-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/2f910ad3576f4f1d581fb7cbe2b5375f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BG14YgPM-mDc6urk"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">卡伦·艾姆斯利在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><div class=""/><div class=""><h2 id="13c3" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">在Python中使用Pandas、Matplotlib、Seaborn和Scikit_learn库</h2></div><p id="dfb1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本文主要关注一个数据故事项目。换句话说，探索性数据分析。在看了一个大数据集甚至一个小数据集之后，很难马上理解它。从数据集中提取一些有意义的信息需要努力、更多的工作和分析。</p><p id="4fb6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我们将采用一个数据集，并使用一些流行的python库，如Numpy、Pandas、Matplotlib、Seaborn，从中找到一些有意义的信息。最后，我们将运行scikit-learn库中的预测模型。</p><blockquote class="lu"><p id="9c24" class="lv lw jj bd lx ly lz ma mb mc md lt dk translated">作为一名数据科学家或数据分析师，您可能不得不处理您不太熟悉的主题数据。这个数据集可能就是其中之一。很多专栏都是医学术语。但这应该不是什么大问题。借助伟大的工具和技术，探索数据集仍然是可能的。</p></blockquote><blockquote class="me mf mg"><p id="82c4" class="ky kz mh la b lb mi kk ld le mj kn lg mk ml lj lk mm mn ln lo mo mp lr ls lt im bi translated"><strong class="la jk">本文将涵盖:</strong></p></blockquote><p id="1068" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如何处理数据集以从中提取有意义的信息或理解数据</p><p id="28f5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用机器学习模型进行预测</p><h2 id="6415" class="mq mr jj bd ms mt mu dn mv mw mx dp my lh mz na nb ll nc nd ne lp nf ng nh ni bi translated">从数据集中提取信息</h2><p id="685b" class="pw-post-body-paragraph ky kz jj la b lb nj kk ld le nk kn lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">这里使用的数据集称为“心力衰竭临床记录”数据集。请随意从<a class="ae jg" href="https://www.kaggle.com/andrewmvd/heart-failure-clinical-data" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>下载数据集并跟随。</p><p id="f532" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们在jupyter笔记本环境中导入必要的包和数据集:</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="3510" class="mq mr jj nt b gy nx ny l nz oa">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt</span><span id="5eec" class="mq mr jj nt b gy ob ny l nz oa">df = pd.read_csv("heart_failure_clinical_records_dataset.csv")</span></pre><p id="d3d3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">数据集对于在这里显示截图来说有点大。数据集有299行数据，以下是数据集的列:</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="285f" class="mq mr jj nt b gy nx ny l nz oa">df.columns</span></pre><p id="a5ed" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">输出:</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="1e26" class="mq mr jj nt b gy nx ny l nz oa">Index(['age', 'anaemia', 'creatinine_phosphokinase', 'diabetes',<br/>       'ejection_fraction', 'high_blood_pressure', 'platelets',<br/>       'serum_creatinine', 'serum_sodium', 'sex', 'smoking', 'time',<br/>       'DEATH_EVENT', 'sex1', 'death'],<br/>      dtype='object')</span></pre><p id="92fc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里，“年龄”、“肌酸酐磷酸激酶”、“T8”、“射血分数”、“血小板”、“T9”、“血清肌酸酐”、“血清钠”、“时间”是连续变量。</p><p id="b3ad" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">“贫血”、“糖尿病”、“T10”、“高血压”、“性别”、“吸烟”、“T11”、“死亡事件”是分类变量。所有分类变量只有0和1值。因此，“性别”只说是男性还是女性，“高血压”说的是这个人是否有高血压，“贫血”说的是这个人是否患有贫血。</p><p id="47a2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我喜欢通过观察连续变量的分布来开始大部分EDA项目。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="80bc" class="mq mr jj nt b gy nx ny l nz oa">df[['age', 'creatinine_phosphokinase', <br/>    'ejection_fraction', 'platelets', 'serum_creatinine', 'serum_sodium']].hist(bins=20,<br/>                                                                               figsize=(15, 15))<br/>plt.show()</span></pre><figure class="no np nq nr gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oc"><img src="../Images/7769ea688faee97bb0123be7caff7e90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cN8GZ14DUNifOhQ4kviaMg.png"/></div></div></figure><p id="48fe" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它一目了然地显示了大多数人口所在的位置和分布的性质。</p><p id="9456" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了理解数据，找到一些常用的描述性变量数据是有帮助的，例如平均值、中值、最大值、最小值、标准差和四分位数。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="87ba" class="mq mr jj nt b gy nx ny l nz oa">continous_var = ['age', 'creatinine_phosphokinase', <br/>    'ejection_fraction', 'platelets', 'serum_creatinine', 'serum_sodium']</span><span id="a84b" class="mq mr jj nt b gy ob ny l nz oa">df[continous_var].describe()</span></pre><figure class="no np nq nr gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi od"><img src="../Images/747cc481bafc3d16e4bd00afdb1b2bf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m9e7MgS0bBDF_dOoq9MoaQ.png"/></div></div></figure><p id="cfa4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，我们已经分别看到了分布和统计参数，tt将很高兴看到这些变量如何与“死亡事件”相关联。此列有0和1值。我会把它改成‘是’和‘不是’。我还想更改“性别”列，将0和1替换为“男性”和“女性”。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="3fe9" class="mq mr jj nt b gy nx ny l nz oa">df['sex1'] = df['sex'].replace({1: "Male", 0: "Female"})<br/>df['death'] = df['DEATH_EVENT'].replace({1: "yes", 0: "no"})</span></pre><p id="6fa6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您现在检查这些列，您将看到数据集中的两个附加列:“sex1”和“death”。在下一个图中，我们将看到一个pairplot，它将显示每个连续变量与其余变量之间的关系。我们也将为死亡事件使用不同的颜色。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="fe0d" class="mq mr jj nt b gy nx ny l nz oa">sns.pairplot(df[["creatinine_phosphokinase", "ejection_fraction",<br/>                       "platelets", "serum_creatinine",<br/>                       "serum_sodium", "time", "death"]], hue = "death", <br/>            diag_kind='kde', kind='scatter', palette='husl')<br/>plt.show()</span></pre><figure class="no np nq nr gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oe"><img src="../Images/c4babb641b9dab3fc076b27f2f24a1c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0-1IfiOpOoSXutcMSbEv0A.png"/></div></div></figure><p id="d20a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里，红色表示死亡事件，绿色表示没有死亡。该图显示了这些变量在死亡事件之间是如何分离的。此外，散点图和中间的密度图显示了死亡事件和非死亡事件数据的明显区别。箱线图将更清晰地说明这一点:</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="c51f" class="mq mr jj nt b gy nx ny l nz oa">continous_var = ['age', 'creatinine_phosphokinase', <br/>    'ejection_fraction', 'platelets', 'serum_creatinine', 'serum_sodium']</span><span id="532d" class="mq mr jj nt b gy ob ny l nz oa">plt.figure(figsize=(16, 25))</span><span id="1fdd" class="mq mr jj nt b gy ob ny l nz oa">for i, col in enumerate(continous_var):<br/>    plt.subplot(6, 4, i*2+1)<br/>    plt.subplots_adjust(hspace =.25, wspace=.3)<br/>    <br/>    plt.grid(True)<br/>    plt.title(col)<br/>    sns.kdeplot(df.loc[df["death"]=='no', col], label="alive", color = "green", shade=True, kernel='gau', cut=0)<br/>    sns.kdeplot(df.loc[df["death"]=='yes', col], label="dead",  color = "red", shade=True, kernel='gau', cut=0)<br/>    plt.subplot(6, 4, i*2+2) <br/>    sns.boxplot(y = col, data = df, x="death", palette = ["green", "red"])</span></pre><figure class="no np nq nr gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi of"><img src="../Images/7bdb4ee8060380d2f907d10a1a550db8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZMLudFUNSsYpsKO11EQFGQ.png"/></div></div></figure><p id="4ec1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">死亡事件和无死亡事件的每个连续变量的平均值的一些数字数据对于一个好的报告是必要的。一些可靠的数字数据有助于讨论。在这里，我们将找到死亡事件和无死亡事件的每个连续变量的平均值和中值。正如我们之前在分布和密度图中看到的，并非所有变量都是正态分布的。有些是倾斜的。所以，平均并不能代表每一个。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="0400" class="mq mr jj nt b gy nx ny l nz oa">y = df.groupby("death")["creatinine_phosphokinase", "ejection_fraction", "platelets", "serum_creatinine", "serum_sodium", "time"].agg([np.mean, np.median])<br/>y</span></pre><figure class="no np nq nr gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi og"><img src="../Images/41388bd9b49e986bf7f1b8cb24905ba2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-vRq2GHJa5X7n_yly7VBYw.png"/></div></div></figure><p id="ee79" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看起来死亡事件之间的“时间”变量非常不同。</p><p id="c8bf" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们稍后可能会对“时间”变量进行更多的探索。</p><p id="f860" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们看看高血压是否在性别死亡中起作用。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="1073" class="mq mr jj nt b gy nx ny l nz oa">df.groupby(['sex1', 'high_blood_pressure', 'death']).size().unstack().fillna(0).apply(lambda x: x/x.sum(), axis=1)</span></pre><p id="5777" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">输出:</p><figure class="no np nq nr gt iv gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/56c1ba508f9b58cb563996ddc57dbb93.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*BTLu32WrD2PeoY0FAB9vfw.png"/></div></figure><p id="d507" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，你可以看到一些比例上的差异。但是这种差异在高血压的情况下比在性别上更明显。但是即使在高血压的情况下，这种差异也不会太大。在女性人口中，28%的死亡发生在没有高血压的女性身上，39%的死亡发生在有高血压的女性身上。这看起来显然有很大的不同。但也不要太激烈。它需要一些统计推断来做出更好的结论，这不是本文的范围。</p><p id="e3d9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">除了“死亡”变量，我们在这个数据集中还有五个其他分类变量。值得研究它们与“死亡”变量的关系。我将使用barplot或seaborn库中的countplot来完成这项工作。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="e065" class="mq mr jj nt b gy nx ny l nz oa">binary_var = ['anaemia', 'diabetes', 'high_blood_pressure',<br/>             'sex1', 'smoking']</span><span id="0d96" class="mq mr jj nt b gy ob ny l nz oa">plt.figure(figsize=(13, 9))</span><span id="b885" class="mq mr jj nt b gy ob ny l nz oa">for i, var in enumerate(binary_var):<br/>    plt.subplot(2, 3, i+1)<br/>    plt.title(var, fontsize=14)<br/>    plt.xlabel(var, fontsize=12)<br/>    plt.ylabel("Count", fontsize=12)<br/>    plt.subplots_adjust(hspace = 0.4, wspace = 0.3)<br/>    sns.countplot(data= df, x = var, hue="death", palette = ['gray', "coral"]</span></pre><p id="f501" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">输出:</p><figure class="no np nq nr gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oi"><img src="../Images/af4f130fc4771f6b3b5214467da657d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MiZJDq6E7Ts0b3Glqjak9g.png"/></div></div></figure><p id="0014" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上面的图中，它清楚地显示了不同性别(在该数据集中只有男性和女性)、高血压、吸烟和糖尿病状态之间的死亡事件数量的差异。但与此同时，它也表明了数据集在吸烟和不吸烟的人数或患糖尿病或不患糖尿病的人数，或男性和女性的人数上是不平衡的。所以，看看这个比例会让我们有一个清晰的概念。</p><p id="e4af" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此时，我可以考虑在这些变量和死亡变量之间做交叉表。让我们从sex1变量开始:</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="ceb9" class="mq mr jj nt b gy nx ny l nz oa">x = pd.crosstab(df["sex1"], df['death'])<br/>x</span></pre><p id="2aa5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">输出:</p><figure class="no np nq nr gt iv gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/981c76047cbd73f611118fd7e9a42c89.png" data-original-src="https://miro.medium.com/v2/resize:fit:346/format:webp/1*PgTk5KA_pNu1MgZLLV6Klw.png"/></div></figure><p id="6243" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以看到这些数字。男性人口中有多少人死亡，女性人口中有多少人死亡。但是在这种情况下，比例会提供更多的信息。因为显然男性和女性的数量是不一样的。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="8792" class="mq mr jj nt b gy nx ny l nz oa">x.apply(lambda z: z/z.sum(), axis=1)</span></pre><p id="c7a6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">输出:</p><figure class="no np nq nr gt iv gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/513cacc556478332d1c5e501e63f996d.png" data-original-src="https://miro.medium.com/v2/resize:fit:470/format:webp/1*zWuOLb2ClvEz2ICEUb3GKA.png"/></div></figure><p id="6b82" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看啊！男性和女性人口的死亡率均约为32%。所以他们是一样的。我对其他四个分类变量也做了同样的处理。</p><p id="ca98" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">贫血vs死亡</strong></p><figure class="no np nq nr gt iv gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/af73059637b926cce489ea9f801d5e80.png" data-original-src="https://miro.medium.com/v2/resize:fit:496/format:webp/1*qCMnc_a5aAaTn9bENTHiUQ.png"/></div></figure><p id="fddc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">贫血患者的死亡比例更高一些。</p><p id="b224" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">糖尿病vs死亡</strong></p><figure class="no np nq nr gt iv gh gi paragraph-image"><div class="gh gi om"><img src="../Images/d9c06f06e673d9c04f63a513a707856e.png" data-original-src="https://miro.medium.com/v2/resize:fit:498/format:webp/1*Q4iaLxMIC3bSeA9uUZ0Z6A.png"/></div></figure><p id="837f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里，糖尿病患者和非糖尿病患者的死亡比例完全相同。</p><p id="fc6d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">吸烟vs死亡</strong></p><figure class="no np nq nr gt iv gh gi paragraph-image"><div class="gh gi on"><img src="../Images/ba594c9c12589fc2f64a30c72992834a.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*fhsXgKb4oeL8Hf6N9Gt2pA.png"/></div></figure><p id="9a79" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">吸烟者和不吸烟者的死亡比例几乎相同。</p><p id="db0a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">高血压vs死亡</strong></p><figure class="no np nq nr gt iv gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/87a0a27d56363fcb1c45f45a1beb8345.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*zKdyl-JcIj9nklrr6k_4bA.png"/></div></figure><p id="e24f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这里，高血压患者的死亡比例更高。</p><p id="731c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在所有上述分析中，我们只试图确定所有其他变量与‘死亡’变量的关系。我们能做的远不止这些。我们试试看能不能提取一些有趣的信息。</p><p id="0987" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，元素是小提琴图，显示了吸烟和不吸烟男性和女性的“时间”分布。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="0f3a" class="mq mr jj nt b gy nx ny l nz oa">plt.figure(figsize=(8, 6))<br/>a = sns.violinplot(df.smoking, df.time, hue=df.sex1, split=True)<br/>plt.title("Smoking vs Time Segregated by Gender", fontsize=14)<br/>plt.xlabel("Smoking", fontsize=12)<br/>plt.ylabel("Time", fontsize=12)<br/>plt.show()</span></pre><figure class="no np nq nr gt iv gh gi paragraph-image"><div class="gh gi op"><img src="../Images/9b25cd3683b7ef4389b7ce103f2a0cd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*OhTrDWgp6U12gMGI-GD4eg.png"/></div></figure><p id="9166" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在不吸烟的人群中，男性和女性的分布是一样的。另一方面，就吸烟者而言，男性和女性的分布非常不同。大多数女性处于大约0到140的狭窄范围内。而男性人口的范围从-50到350。</p><p id="5560" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我想看看‘射血分数’和‘死亡’所分隔的‘时间’之间的关系。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="fac4" class="mq mr jj nt b gy nx ny l nz oa">sns.lmplot(x="ejection_fraction", y="time", <br/>           hue="death", data=df, scatter_kws=dict(s=40, linewidths=0.7,<br/>                                            edgecolors='black'))<br/>plt.xlabel("Ejection Fraction", fontsize=12)<br/>plt.ylabel("Time", fontsize=12)<br/>plt.title("Ejection fraction vs time segregated by death", fontsize=14)<br/>plt.show()</span></pre><figure class="no np nq nr gt iv gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/5909794b052dff80a05089462bb78624.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*4ih0F9Gf-ttT7ZrQii3WKw.png"/></div></figure><p id="e250" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个图暂时没有提供太多的信息。但是你可以看到回归线和置信带。正如所料，置信带在数据密度较高的中间较窄，在数据密度较低的两侧较宽。</p><p id="c0e1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来的剧情，我们再来看一个男女人口的对比。“时间”如何随“年龄”而变化:</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="727a" class="mq mr jj nt b gy nx ny l nz oa">fig = plt.figure(figsize=(20, 8), dpi=80)<br/>g = sns.lmplot(x='age', y='time', <br/>               data = df, <br/>               robust = True,<br/>              palette="Set1", col="sex1",<br/>              scatter_kws=dict(s=60, linewidths=0.7, edgecolors="black"))<br/>for ax in g.axes.flat:<br/>    ax.set_title(ax.get_title(), fontsize='x-large')<br/>    ax.set_ylabel(ax.get_ylabel(), fontsize='x-large')<br/>    ax.set_xlabel(ax.get_xlabel(), fontsize='x-large')</span></pre><figure class="no np nq nr gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi or"><img src="../Images/45f5ed57fc81cba200b93a646e3787e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xf8SNw-s6DiEu6B5kkrIfg.png"/></div></div></figure><p id="7340" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意这里的回归线，对于男性人口，回归线要陡得多。随着“年龄”的增长，“时间”也在减少。</p><p id="1426" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上面的大多数图中，我们试图找出变量之间的关系。显示所有变量之间相关性的热图非常有用。热图用于机器学习的特征选择，也用于数据分析以了解变量之间的相关性。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="6a65" class="mq mr jj nt b gy nx ny l nz oa">plt.figure(figsize=(10, 10))<br/>sns.heatmap(df.corr(), annot=True, linewidths=0.5, cmap="crest")<br/>plt.show()</span></pre><figure class="no np nq nr gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi os"><img src="../Images/36b5f72b26e373d9426a40ed5a19b0f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H6dS-MkNXoEGycVg0BGdUA.png"/></div></div></figure><p id="046c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您将在下一节看到这些相关性的使用。</p><h2 id="224e" class="mq mr jj bd ms mt mu dn mv mw mx dp my lh mz na nb ll nc nd ne lp nf ng nh ni bi translated">死亡预测</h2><p id="af34" class="pw-post-body-paragraph ky kz jj la b lb nj kk ld le nk kn lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">利用数据集中的所有变量，我们可以训练一个机器学习模型来预测死亡。对于这个项目，我将简单地从scikit_learn库中导入一个机器学习模型并使用它。</p><blockquote class="me mf mg"><p id="a2d6" class="ky kz mh la b lb lc kk ld le lf kn lg mk li lj lk mm lm ln lo mo lq lr ls lt im bi translated">数据准备</p></blockquote><p id="c341" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这个数据集中，所有的列最初都是数字，这是机器学习模型所需要的。我们在开始创建了两个带有字符串的列。这些列需要删除。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="8d7f" class="mq mr jj nt b gy nx ny l nz oa">df = df.drop(columns=['sex1', 'death'])</span></pre><p id="41be" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">另外，我将在数据集上使用dropna()函数。数据集非常干净。但是万一有空值，它会删除那些行。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="4531" class="mq mr jj nt b gy nx ny l nz oa">df = df.dropna()</span></pre><p id="e485" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如我之前提到的，上面的相关变量可以用于机器学习的特征选择。请注意热图中DEATH_EVENT和热图最后一列中的其他变量之间的相关性。死亡事件与“贫血”、“糖尿病”、“性别”、“吸烟”、“肌酸酐磷酸激酶”之间的相关性非常低。</p><p id="802c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我将简单地从数据集中删除这些列。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="82b8" class="mq mr jj nt b gy nx ny l nz oa">df = df.drop(columns=['anaemia', 'diabetes', 'sex', 'smoking', <br/>                       'creatinine_phosphokinase'])</span></pre><p id="f516" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将数据集中的所有变量放在同一个尺度上是个好主意。看，不同的变量有不同的范围。像“血小板”有一个非常高的范围。另一方面，血清肌酸酐具有非常低的范围。为了使所有的连续变量范围相似，我将每个变量除以它们的最大值。</p><p id="ab0b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在此之前，我将把数据集df复制到变量df2中，以保持原始值不变。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="6461" class="mq mr jj nt b gy nx ny l nz oa">df2 = df</span><span id="7ac9" class="mq mr jj nt b gy ob ny l nz oa">continuous_var = ['age', 'ejection_fraction', 'platelets', 'serum_creatinine', 'serum_sodium']</span><span id="e879" class="mq mr jj nt b gy ob ny l nz oa">for i in continous_var:<br/>    df2[i] = df2[i]/max(df2[i])</span></pre><p id="e4e0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">分类变量不需要改变。它们已经是0或1值。</p><p id="4b7b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个机器学习模型将用于预测死亡事件。所以，DEATH_EVENT是输出变量。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="a305" class="mq mr jj nt b gy nx ny l nz oa">y = df2['DEATH_EVENT']</span></pre><p id="ed68" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我将使用其余的变量作为输入变量。DEATH_EVENT从将成为输入变量列表的df2中删除。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="3c61" class="mq mr jj nt b gy nx ny l nz oa">X = df2.drop(columns=['DEATH_EVENT'])</span></pre><blockquote class="me mf mg"><p id="9e59" class="ky kz mh la b lb lc kk ld le lf kn lg mk li lj lk mm lm ln lo mo lq lr ls lt im bi translated">训练和测试数据的分离</p></blockquote><p id="c415" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">训练模型前的最后一步。通常，在机器学习中，一部分数据与训练数据是分开的。以便在训练模型之后，您可以使用模型看不到的一些数据来检查模型。但是标签或者输出是你知道的。</p><p id="9798" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">scikit_learn库为此提供了一个train_test_split函数。</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="af7e" class="mq mr jj nt b gy nx ny l nz oa">from sklearn.model_selection import train_test_split<br/>X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.25, random_state=22)</span></pre><blockquote class="me mf mg"><p id="a42b" class="ky kz mh la b lb lc kk ld le lf kn lg mk li lj lk mm lm ln lo mo lq lr ls lt im bi translated">使用决策树分类器</p></blockquote><p id="fa9e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我在这个例子中使用了决策树分类器。下面是分类器和结果:</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="0288" class="mq mr jj nt b gy nx ny l nz oa">clf_tree = DecisionTreeClassifier(random_state=21, max_depth = 7, max_leaf_nodes=6).fit(X_train,y_train)<br/>y_pred = clf_tree.predict(X_test)<br/>print("Accuracy:",metrics.accuracy_score(y_test,y_pred))<br/>print("Precision:",metrics.precision_score(y_test,y_pred,pos_label=0))<br/>print("Recall:",metrics.recall_score(y_test,y_pred,pos_label=0))<br/>print("F Score:",metrics.f1_score(y_test,y_pred,pos_label=0))<br/>print("Confusion Matrix:\n",metrics.confusion_matrix(y_test,y_pred))</span></pre><p id="a947" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">输出:</p><pre class="no np nq nr gt ns nt nu nv aw nw bi"><span id="4111" class="mq mr jj nt b gy nx ny l nz oa">Accuracy: 0.84<br/>Precision: 0.9215686274509803<br/>Recall: 0.8545454545454545<br/>F Score: 0.8867924528301887<br/>Confusion Matrix:<br/> [[47  8]<br/> [ 4 16]]</span></pre><p id="58d5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">准确率0.84或者84%。还有，F分0.89。F值越接近1，模型越好。</p><p id="234c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，如果你知道一个人的“年龄”、“射血分数”、“高血压”、“血小板”、“血清肌酸酐”、“血清钠”、“时间”，你就可以预测这个人是死是活。这个预测几乎有84%是正确的。</p><h2 id="401c" class="mq mr jj bd ms mt mu dn mv mw mx dp my lh mz na nb ll nc nd ne lp nf ng nh ni bi translated">结论</h2><p id="623f" class="pw-post-body-paragraph ky kz jj la b lb nj kk ld le nk kn lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">在本次演示中，我试图向您展示一些技术来理解该数据集并运行预测模型。有许多不同的方法来完成探索性数据分析任务。这是我对这次演示的选择。</p><p id="2251" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">欢迎在推特上关注我，喜欢我的T2脸书页面。</p><h2 id="644e" class="mq mr jj bd ms mt mu dn mv mw mx dp my lh mz na nb ll nc nd ne lp nf ng nh ni bi translated">更多阅读:</h2><div class="is it gp gr iu ot"><a rel="noopener follow" target="_blank" href="/an-ultimate-cheatsheet-of-data-visualization-in-seaborn-be8ed13a3697"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd jk gy z fp oy fr fs oz fu fw ji bi translated">用Python的Seaborn库实现数据可视化的终极指南</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">对学习者来说也是一个很好的资源</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">towardsdatascience.com</p></div></div><div class="pc l"><div class="pd l pe pf pg pc ph ja ot"/></div></div></a></div><div class="is it gp gr iu ot"><a rel="noopener follow" target="_blank" href="/take-full-control-over-the-subplots-in-matplotlib-71b3bc11ff0b"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd jk gy z fp oy fr fs oz fu fw ji bi translated">完全控制Matplotlib中的支线剧情</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">使用支线剧情和GridSpec一起更好地控制</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">towardsdatascience.com</p></div></div><div class="pc l"><div class="pi l pe pf pg pc ph ja ot"/></div></div></a></div><div class="is it gp gr iu ot"><a rel="noopener follow" target="_blank" href="/a-full-length-machine-learning-course-in-python-for-free-f2732954f35f"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd jk gy z fp oy fr fs oz fu fw ji bi translated">免费的Python全长机器学习课程</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">吴恩达用Python写的机器学习教程</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">towardsdatascience.com</p></div></div><div class="pc l"><div class="pj l pe pf pg pc ph ja ot"/></div></div></a></div><div class="is it gp gr iu ot"><a rel="noopener follow" target="_blank" href="/do-you-need-a-masters-degree-to-become-a-data-scientist-ab894c2a8d41"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd jk gy z fp oy fr fs oz fu fw ji bi translated">成为数据科学家需要硕士学位吗？</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">我作为波士顿大学数据分析专业硕士学生的经历和体会</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">towardsdatascience.com</p></div></div><div class="pc l"><div class="pk l pe pf pg pc ph ja ot"/></div></div></a></div><div class="is it gp gr iu ot"><a rel="noopener follow" target="_blank" href="/a-collection-of-advanced-visualization-in-matplotlib-and-seaborn-with-examples-2150e6c3f323"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd jk gy z fp oy fr fs oz fu fw ji bi translated">Matplotlib和Seaborn中的高级可视化集合，带有示例</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">丰富可视化技术和技能</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">towardsdatascience.com</p></div></div><div class="pc l"><div class="pl l pe pf pg pc ph ja ot"/></div></div></a></div><div class="is it gp gr iu ot"><a rel="noopener follow" target="_blank" href="/sort-and-segment-your-data-into-bins-to-get-sorted-ranges-pandas-cut-and-qcut-7785931bbfde"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd jk gy z fp oy fr fs oz fu fw ji bi translated">数据宁滨与熊猫削减或Qcut方法</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">当你在寻找一个范围而不是一个确切的数值，一个等级而不是一个分数</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">towardsdatascience.com</p></div></div><div class="pc l"><div class="pm l pe pf pg pc ph ja ot"/></div></div></a></div></div></div>    
</body>
</html>