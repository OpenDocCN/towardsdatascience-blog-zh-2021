<html>
<head>
<title>How to Produce an Animated Bar Plot in Plotly using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python在Plotly中制作动画柱状图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-produce-an-animated-bar-plot-in-plotly-using-python-2b5b360492f8?source=collection_archive---------16-----------------------#2021-08-22">https://towardsdatascience.com/how-to-produce-an-animated-bar-plot-in-plotly-using-python-2b5b360492f8?source=collection_archive---------16-----------------------#2021-08-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3840" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让您的原始数据集产生一个动画条形图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c88717e6e6137dddaf837629c9880929.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2qWGG3VhhCZNitqfmDJnfg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者斯蒂芬·福特汉姆提供</p></figure><h2 id="7ed3" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">绘制美国各县的抗生素处方率</h2><p id="c9a8" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">本教程详细介绍了如何使用Python中的Plotly库将原始数据转换成动画条形图。本教程中使用的数据集标题为:</p><p id="2e40" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated"><em class="ms">从2010年开始，提供者所在县的儿童医疗补助参保者的潜在可避免抗生素处方观察率和风险调整率</em>。</p><p id="3522" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">数据集可以通过<a class="ae mt" href="https://data.world/healthdatany/r2m7-fr63/workspace/file?filename=potentially-avoidable-antibiotic-prescribing-rates-for-acute-respiratory-infection-by-provider-count-1.csv" rel="noopener ugc nofollow" target="_blank">数据世界</a>找到。具体来说，我们的目标是绘制2010年至2016年美国各县抗生素处方率/100次就诊的动画柱状图。</p><h2 id="c378" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">准备数据</h2><p id="5545" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">首先，我们首先导入pandas库和plotly express。此外，在处理数据集时，查看所有行和列有时会很有用。为此，我们可以将“显示最大行数”和“显示最大列数”都设置为None，如下所示。但是，重要的是要考虑到应用此设置时，较大的数据集将需要加载器来加载。最后，我们可以在我标记为“<em class="ms">潜在可避免抗生素处方率. csv </em>”的数据集中阅读。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1:GitHub Gist；初始设置</p></figure><h2 id="d79b" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">每年的条目</h2><p id="3edf" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">我们可以首先确定数据集中县的数量。这将使我们能够破译每个县存在了多少年的信息。这里有63个不同的县，dataframe总共有441行，这意味着每个县有7年的可用数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/7d7cb936ba3c5497517206ee90ffc958.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z13TNSN8M76rETNxcSoFYw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2:无序的数据格式</p></figure><h2 id="bd50" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">将数据放入动画条形图的正确形状中</h2><p id="22c0" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">为了绘制动画条形图，我们需要将数据配置为不同于当前的格式。我们需要在单个数据框架中按照年份顺序排列每个县。为了说明这一点，下面的dataframe图像片段显示了所需的格式。</p><p id="db5b" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">简单明了的数据争论可以将格式从上面的图2变成下面的图3。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mx"><img src="../Images/a6da42550dedb7a666f4ff974dc85524.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JTj8OLLKeaPsTW2URI_jew.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3:正确格式化的数据。在单个数据框架中按年份顺序排列的县</p></figure><h2 id="a562" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">数据争论</h2><p id="86f2" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">为了重新组织数据，我们首先使用list comprehension创建一个从0到63的键列表。然后，我们可以实例化一个空字典，遍历键列表和唯一的县列表。通过每次循环，我们为每个县创建一个新的数据框架，首先按最早年份排序。最后，我们可以将新的数据帧添加到all_dataframes字典中，该字典在每个循环中都被分配了一个唯一的键值。</p><p id="4238" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">然后，我们可以使用唯一键遍历所有数据帧，并添加到所有数据帧的列表中，称为master_df。</p><p id="3661" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">使用pandas的pd.concat函数，所有这些数据帧最终可以连接成一个数据帧。这个函数调用的输出数据帧被命名为df_all。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/34eb6ba6ed5a043cccc97ee638060e9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2SbTIAjfhVx3tPGzNWWYlQ.png"/></div></div></figure><p id="6bfc" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">实现这些步骤的简明代码如下所示</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><h2 id="b32d" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">绘制县的子选择</h2><p id="8fe9" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">我们可以绘制所有63个县的数据，或者选择一个子选项进行绘制。在这里，我们将选取10个独特的县进行演示。</p><p id="fd61" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">为此，我们选择包含县的列，并调用sample方法，将参数replace设置为布尔值True。然后我们调用values属性，该属性在使用tolist()方法转换为列表之前返回一个数组。我们现在可以看到10个独特的选定县的列表。</p><p id="2e36" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">我们使用这10个县，通过熊猫isin方法过滤数据框架。这将返回plot_df数据帧。最后的步骤包括知道我们打算在y轴上绘制的列的最小值和最大值，在我们的例子中，是“每100次就诊的观察处方率”，我们将在我们的figure对象上使用它作为range_y参数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/8bb793540000e77f0be84a1da72a9b80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*FcJSFYEWjSXfX673P2KCFA.png"/></div></figure><h2 id="0b15" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">动画条形图</h2><p id="1b5f" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">格式正确的数据，加上我们的10个县，现在可以绘制出来了。我们首先将dataframe和x、y轴的列以及提供者县传递给color参数。我们将animation_frame设置为year列，将animation_group设置为Provider County列。然后，我们使用上面为y轴确定的范围来设置y轴的合理界限，并给该图一个信息性的标题。</p><p id="70da" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">现在我们有了10个县的动画情节！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na mv l"/></div></figure></div></div>    
</body>
</html>