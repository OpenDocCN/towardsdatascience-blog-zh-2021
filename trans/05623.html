<html>
<head>
<title>GPUs Are Fast! Datasets Are Your Bottleneck</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GPU快！数据集是你的瓶颈</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/gpus-are-fast-datasets-are-your-bottleneck-e5ac9bf2ad27?source=collection_archive---------15-----------------------#2021-05-19">https://towardsdatascience.com/gpus-are-fast-datasets-are-your-bottleneck-e5ac9bf2ad27?source=collection_archive---------15-----------------------#2021-05-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3ee9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解数据集如何成为您培训的瓶颈</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5b04fc507254f52027bccb766a8b393e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2AXUCwaLB9GC-8Fy.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">糟糕的数据实践会减缓你的训练(图片来源:<a class="ae kv" href="https://pixabay.com/photos/taxis-traffic-road-vehicles-city-1209542/" rel="noopener ugc nofollow" target="_blank"> pixabay </a></p></figure><p id="da98" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你正在使用机器学习或深度学习，那么你可能会沉迷于确保你的所有代码都可以在GPU上运行，或者，对于勇敢的人来说，甚至可以在TPU上运行。</p><p id="0b7f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我讨厌带来坏消息，但你的模型可能已经非常适合GPU了！(特别是如果你使用像<a class="ae kv" href="https://github.com/PyTorchLightning/pytorch-lightning" rel="noopener ugc nofollow" target="_blank"> PyTorch Lightning </a>这样的框架，它可以让你在GPU和CPU之间自动切换，而无需修改代码)。</p><p id="8f4e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">真正的罪魁祸首是数据吞吐量。数据可能会以您可能没有意识到的微妙方式成为瓶颈。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="a33a" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">CPU上的转换</h1><p id="315e" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">当处理深度学习的数据时，你非常非常可能以某种方式转换你的输入。例如，如果您处理图像，您可能会对这些图像应用转换管道。</p><p id="e31b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，这是一个典型的计算机视觉管道:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/c4253de2a38393c373b225bd98c6d760.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0lubDQhzmUaJJCGi4GfFVA.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图像转换(作者自己的)</p></figure><p id="2dea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">肮脏的秘密是，今天这些转换在CPU上一次一个输入地被应用<strong class="ky ir">…这意味着它们<em class="mx">超级</em>慢。如果您的模型允许，您可以在GPU上一次对一批数据应用相同的转换。</strong></p><p id="a3ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Kornia 是一个帮助你在GPU内存中完成这些转换的库</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="9c67" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">磁盘吞吐量</h1><p id="a504" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">下一个主要瓶颈是从磁盘读取样本的速度。不管你有世界上最快的型号和GPU…你的数据必须从磁盘-&gt; CPU -&gt; GPU。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/b0e11be47b339ff2c0fdd43a8d503195.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*unj3bMduY37Q-N13mOnDAQ.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">GPU机器内部(作者自己的)</p></figure><p id="69f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你机器上的磁盘？最好是真正好的SSD。</p><p id="83a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在云上，这变得更加相关…例如，如果您开始在云机器上运行几十个模型，这些模型都需要相同的数据，那么您将不得不为此构建非常优化的系统。在大规模训练时，S3根本做不到！</p><p id="9e32" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当通过<a class="ae kv" href="https://docs.grid.ai/" rel="noopener ugc nofollow" target="_blank">网格AI </a>在AWS上运行云作业时，您可以使用网格<a class="ae kv" href="https://docs.grid.ai/products/add-data-to-grid-datastores" rel="noopener ugc nofollow" target="_blank">数据存储库</a>，这些数据存储库针对大规模运行进行了优化。只需创建一个数据存储:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/c310515311d0edb2308989db556cbb49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*22_401UGG19bFUIEsLSQ8A.gif"/></div></div></figure><p id="46d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当模型大规模运行时(甚至跨越数百个GPU和许多并发模型)，grid将确保对其进行优化。</p><p id="6699" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，要在云上运行代码，只需使用<a class="ae kv" href="https://docs.grid.ai/products/run-run-and-sweep-github-files" rel="noopener ugc nofollow" target="_blank">网格运行</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/1e13458077bb90ac7b77e7908fdb9d7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*rRAuUDDSJ3i0xb6CMyAQ-Q.gif"/></div></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="d2f7" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">同时数据加载</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/064501b3d47efb851ff12051de132485.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*IlnRNuXxjza2fkoHGpWSYA.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用<strong class="bd nc"> num_workers ( </strong>作者自己的)预加载数据</p></figure><p id="48e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一个容易出错的地方是将数据集加载到机器学习代码中的类。PyTorch有一个Dataloader抽象，负责批处理和预加载数据。但是，为了充分利用这一点，请确保使用num_workers参数，它将在后台自动预加载批处理</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="7d00" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">问题总是num_workers应该是什么？通常，它是你机器上CPU数量的倍数。</p><p id="da35" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你使用PyTorch Lightning这样的框架，它甚至会为你推荐num_workers！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/b6e8f7bb7a3b1d3368b20a5ca0275031.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pmydtUxZkc3LU4bID6CdFw.png"/></div></div></figure></div></div>    
</body>
</html>