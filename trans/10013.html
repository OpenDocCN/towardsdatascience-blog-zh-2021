<html>
<head>
<title>Analyzing 120 Years of Olympics History with SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用SQL分析120年奥运历史</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/analyzing-120-years-of-olympics-history-with-sql-11d4daace4d0?source=collection_archive---------19-----------------------#2021-09-21">https://towardsdatascience.com/analyzing-120-years-of-olympics-history-with-sql-11d4daace4d0?source=collection_archive---------19-----------------------#2021-09-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c844" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">SQL实践教程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1da34296133cfdfe7064803b8cdcc359.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3HmbUObM1aUa0YF1O4jdow.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马特·李在<a class="ae ky" href="https://unsplash.com/s/photos/olympics?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="28a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在Kaggle上发现了一个很棒的<a class="ae ky" href="https://www.kaggle.com/heesoo37/120-years-of-olympic-history-athletes-and-results" rel="noopener ugc nofollow" target="_blank">数据集</a>。它是在知识共享许可下共享的，所以我们可以公开使用和共享它。我认为了解奥运会的历史将是令人兴奋的。</p><p id="5c45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有许多替代工具可用于对此数据集执行分析。我选择SQL没有特别的原因。在本文中，我们将在练习SQL的同时了解奥运会。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="5083" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意:</strong> SQL被很多关系数据库管理系统使用，比如MySQL、SQL Server、PostgreSQL等等。尽管它们大多采用相同的SQL语法，但可能会有一些细微的差别。在本文中，我们将使用PostgreSQL。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="6605" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我选择了一些列，并将数据上传到一个SQL表中。让我们先来看看奥运表。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="1b5f" class="mh mi it md b gy mj mk l ml mm">SELECT * FROM olympics LIMIT 5</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/f99d3c861559227d7f550eedebb938bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ASfR8WgV9jUplON3rlsE3w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="5c70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有运动员的名字、性别、年龄和他们参加的运动。该表还包含游戏的详细信息。原始数据集包含271116行，但是我只上传了200000行到olympics表。如果对整个数据集进行相同的分析，结果可能会略有不同。</p><p id="c2c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想看看有多少不同的运动员参加了奥运会。我们可以数出不同的名字。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="f633" class="mh mi it md b gy mj mk l ml mm">SELECT COUNT(DISTINCT(name)) FROM olympics</span><span id="b953" class="mh mi it md b gy mo mk l ml mm">99875</span></pre><p id="9f81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这张桌子上有近10万名不同的运动员。我想知道他们中有多少人获得了奖牌。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="616f" class="mh mi it md b gy mj mk l ml mm">SELECT COUNT(DISTINCT(name)) FROM olympics<br/>WHERE medal IS NOT NULL</span><span id="ae1f" class="mh mi it md b gy mo mk l ml mm">20560</span></pre><p id="23d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们刚刚使用where语句添加了一个条件。</p><p id="006d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们找出奖牌总数前3名的国家。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="ca63" class="mh mi it md b gy mj mk l ml mm">SELECT team, COUNT(medal) AS medal_won<br/>FROM olympics<br/>WHERE medal IS NOT NULL<br/>GROUP BY team<br/>ORDER BY medal_won DESC<br/>LIMIT 3</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/230b75370ebe2e8301fbc63e4c99de63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IipS4O2M8A2x7StfjR7kBw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="0243" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的查询过滤了medal列没有空值的行。然后，根据团队列对行进行分组，并对行进行计数，这就给出了获得的奖牌数。最后，结果集按奖牌数降序排序，选择前三个。</p><p id="64f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">了解获得奖牌的男女运动员的平均年龄是很有趣的。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="02ad" class="mh mi it md b gy mj mk l ml mm">SELECT sex, AVG(age) AS avg_age<br/>FROM olympics<br/>WHERE medal IS NOT NULL<br/>GROUP BY sex</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/b601b1ebbddb43bcfa6708619ace4cb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dmVldU3EVCCzW6wpoLv0IQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="d49a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">女运动员比男运动员小两岁。</p><p id="2e58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以查看女运动员获得奖牌最多的前5项运动。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="494e" class="mh mi it md b gy mj mk l ml mm">SELECT sport, COUNT(medal) AS medal_count <br/>FROM olympics<br/>WHERE sex = 'F'<br/>GROUP BY sport<br/>ORDER BY medal_count DESC<br/>LIMIT 5</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/c2d9299aaad06255716d35b3d9af9925.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4PdBqNZg8Dbw-0osgac8tQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="141c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑到我们对比赛年份感兴趣。该表没有单独的年份列，但可以从游戏列中提取。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="4ae1" class="mh mi it md b gy mj mk l ml mm">SELECT LEFT(games, 4) AS year, games<br/>FROM olympics<br/>LIMIT 5</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/4a8f2417d549889e4692a85de3a047ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h02y6QfZhxbxfm4VSo0U9A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="fda6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">左边的函数允许从字符串中选择部分。它接受列名和要选择的字符数。right函数做同样的事情，但是从右边开始计数。</p><p id="aeed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一个示例与其说是探索数据集，不如说是SQL实践。考虑到我们只需要1950年以后的数据。我们可以删除属于1950年或之前的游戏的行，或者用我们感兴趣的数据创建一个新表。</p><p id="901a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下查询使用olympics表中的数据创建一个新表。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="5c54" class="mh mi it md b gy mj mk l ml mm">CREATE TABLE olympics_after_1950 AS<br/>SELECT * FROM olympics<br/>WHERE CAST(LEFT(games, 4) AS INTEGER) &gt; 1950</span></pre><p id="0b2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们检查一下查询是否工作正常。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="722e" class="mh mi it md b gy mj mk l ml mm">SELECT MIN(LEFT(games, 4)) FROM olympics_after_1950</span><span id="7b65" class="mh mi it md b gy mo mk l ml mm">1952</span></pre><p id="97c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">令人惊讶的是，create table语句用于创建表😃。我们可以通过使用select语句和create table语句从不同的表中选择数据来填充新表。</p><p id="aacf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以通过删除属于1950年或之前的奥运会的行来更新奥林匹克表。我想保持原来的桌子不变。我们可以在新表上练习update语句。</p><p id="6234" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们删除新表中1970年之前的行，然后检查最小日期。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="58de" class="mh mi it md b gy mj mk l ml mm">DELETE FROM olympics_after_1950<br/>WHERE CAST(LEFT(games, 4) AS INTEGER) &lt; 1970</span><span id="e87d" class="mh mi it md b gy mo mk l ml mm">SELECT MIN(LEFT(games, 4)) FROM olympics_after_1950</span><span id="f3b9" class="mh mi it md b gy mo mk l ml mm">1972</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="0fd2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们做了几个例子来深入了解奥林匹克的历史。我们还练习了基本的SQL语句和函数。</p><p id="c9a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>