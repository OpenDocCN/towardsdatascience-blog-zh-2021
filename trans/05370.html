<html>
<head>
<title>DataBricks Widgets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据块部件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/databricks-widgets-20483229e84e?source=collection_archive---------10-----------------------#2021-05-12">https://towardsdatascience.com/databricks-widgets-20483229e84e?source=collection_archive---------10-----------------------#2021-05-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8ac0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用DataBricks小部件和中间的其他东西</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/245763527de2e5ab5ae60a79856ee462.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bXQAdpIipbVkOFZ6kMh92A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://unsplash.com/photos/ANod8Sxse6g" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><h1 id="cc0d" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="cedf" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在过去的两个月里，我开始更频繁地使用DataBricks，对此我有过许多情绪波动。前一分钟我还超级感动，后一分钟我又厌恶它。公平地说，许多关于它的负面情绪都与它需要一些时间来适应这一事实有关，我发现自己缺乏这样做的时间。</p><blockquote class="mn mo mp"><p id="039d" class="lr ls mq lt b lu mr ju lw lx ms jx lz mt mu mc md mv mw mg mh mx my mk ml mm im bi translated">但是什么是数据块呢？</p></blockquote><p id="b5b4" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">简而言之，DataBrick就像Jupyter笔记本，但更多的是类固醇。它在以下方面胜过Jupyter笔记本</p><ul class=""><li id="bfab" class="mz na it lt b lu mr lx ms ma nb me nc mi nd mm ne nf ng nh bi translated">能够在一台笔记本上运行spark SQL、scala、r和python代码，只需使用%符号后跟语言名称，例如<code class="fe ni nj nk nl b">%sql</code>、<code class="fe ni nj nk nl b">%python</code>等。</li><li id="8ac6" class="mz na it lt b lu nm lx nn ma no me np mi nq mm ne nf ng nh bi translated">它具有出色的文件组织，有利于团队笔记本访问和知识转移，即如果您的团队使用DataBricks，您可以通过DataBricks中每个人的电子邮件地址工作区访问他们的笔记本。</li><li id="f0f0" class="mz na it lt b lu nm lx nn ma no me np mi nq mm ne nf ng nh bi translated">用户可以通过集群调整计算能力。</li></ul><blockquote class="mn mo mp"><p id="21c9" class="lr ls mq lt b lu mr ju lw lx ms jx lz mt mu mc md mv mw mg mh mx my mk ml mm im bi translated">什么是DataBricks小部件？</p></blockquote><p id="32a4" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">把一个小部件想象成一个过滤器。比如SQL中的<code class="fe ni nj nk nl b">where</code>子句或者Tableau中的filter部分。</p><p id="572c" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">在数据块中，有三种主要类型的小部件</p><ul class=""><li id="f97c" class="mz na it lt b lu mr lx ms ma nb me nc mi nd mm ne nf ng nh bi translated">文本小部件——它在你的笔记本顶部创建一个文本框，用户(也就是你)可以在你的栏或数据中键入你只想看到的类别。</li><li id="2ce3" class="mz na it lt b lu nm lx nn ma no me np mi nq mm ne nf ng nh bi translated">下拉单选小部件—在笔记本顶部创建一个下拉框，在您的列中显示预定义的默认字段。这种类型的小部件也有两种风格:下拉列表和组合框。</li><li id="072b" class="mz na it lt b lu nm lx nn ma no me np mi nq mm ne nf ng nh bi translated">下拉多选小部件—这也类似于下拉单选小部件。唯一的区别是，您可以一次单击多个字段，而不是一个。</li></ul><h1 id="5fb3" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">如何在SQL中创建小部件</h1><p id="b920" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在DataBrick中创建任何类型的小部件都有一个典型的代码模式，可以分为四个部分。</p><ul class=""><li id="b26c" class="mz na it lt b lu mr lx ms ma nb me nc mi nd mm ne nf ng nh bi translated">从<code class="fe ni nj nk nl b">CREATE WIDGET</code>条款开始</li><li id="020e" class="mz na it lt b lu nm lx nn ma no me np mi nq mm ne nf ng nh bi translated">后跟小部件的类型</li><li id="c71d" class="mz na it lt b lu nm lx nn ma no me np mi nq mm ne nf ng nh bi translated">然后指定一个小部件名称来标识小部件变量。</li><li id="0b82" class="mz na it lt b lu nm lx nn ma no me np mi nq mm ne nf ng nh bi translated">最后，一个<code class="fe ni nj nk nl b">DEFAULT</code>命令和默认的选择词。默认单词是将作为默认单词出现在小部件图标中的单词。</li></ul><p id="5130" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">小部件SQL查询如下所示</p><pre class="kj kk kl km gt nr nl ns nt aw nu bi"><span id="9eac" class="nv la it nl b gy nw nx l ny nz">CREATE WIDGET &lt;widget type&gt; &lt;widget variable name&gt; DEFAULT &lt;Default category word&gt;</span></pre><p id="c784" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated"><em class="mq">注意:确保</em> <strong class="lt iu"> <em class="mq">默认类别词</em> </strong> <em class="mq">在双/单引号内</em></p><p id="3c1a" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">因为<strong class="lt iu">下拉小部件类型</strong>需要指定一个选择列来反映正确的类别，所以在默认单词之后添加了一个<code class="fe ni nj nk nl b">select</code>语句。</p><p id="7924" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">这个select语句看起来像这样</p><pre class="kj kk kl km gt nr nl ns nt aw nu bi"><span id="2afb" class="nv la it nl b gy nw nx l ny nz">SELECT DISTINCT &lt;&lt;column name&gt;&gt; <br/>FROM &lt;&lt;tablename&gt;&gt;</span></pre><p id="a870" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">下面是所有四个小部件及其视觉效果的示例代码</p><p id="67b9" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated"><strong class="lt iu">为文本小工具</strong></p><pre class="kj kk kl km gt nr nl ns nt aw nu bi"><span id="34ed" class="nv la it nl b gy nw nx l ny nz">CREATE WIDGET TEXT Policy_product_name DEFAULT 'Car Classic'</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/c7323df01dc8e6d97d273b8ffeb0bb06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pTp8LqXdTOb64hJVeDWLBQ.png"/></div></div></figure><p id="533e" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated"><strong class="lt iu">为下拉菜单</strong></p><pre class="kj kk kl km gt nr nl ns nt aw nu bi"><span id="d154" class="nv la it nl b gy nw nx l ny nz">CREATE WIDGET DROPDOWN policy_product_name DEFAULT 'Car Classic' CHOICES <br/>SELECT DISTINCT product_name <br/>FROM train_csv</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/5ebe4561d7b8d0fb36f4ce3e36552e3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q-OIgTAQuZMt1vN1r6gsmg.png"/></div></div></figure><p id="1d6d" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated"><strong class="lt iu">用于组合框</strong></p><pre class="kj kk kl km gt nr nl ns nt aw nu bi"><span id="95b9" class="nv la it nl b gy nw nx l ny nz">CREATE WIDGET COMBOBOX policy_product_name DEFAULT 'Car Classic' CHOICES <br/>SELECT DISTINCT product_name <br/>FROM train_csv</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/8e852b0ac4b00c31bb6185a76025ac4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bXqlmZtozLWkhO1ukWQ6ww.png"/></div></div></figure><p id="b79d" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated"><strong class="lt iu">用于多选</strong></p><pre class="kj kk kl km gt nr nl ns nt aw nu bi"><span id="6948" class="nv la it nl b gy nw nx l ny nz">CREATE WIDGET MULTISELECT policy_product_name DEFAULT 'Car Classic' CHOICES <br/>SELECT DISTINCT product_name <br/>FROM train_csv</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/415702c34e6973d4dd1ec7ace67df973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Brtf3zLQDQYwMPq_BA3iTQ.png"/></div></div></figure><p id="8cd3" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated"><em class="mq">注意，在上面的示例代码中，我们假设要查询的表名为train_csv，要动态过滤的列名为product_name。根据您的使用情况进行定制。</em></p><p id="ef44" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated"><em class="mq">注意:小部件下拉框和文本框出现在笔记本工具栏的正下方。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/3cefc447f2f6c6990fae00ad8928733a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w94_ugQ4YwVW5F_bQ_tFKA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自作者</p></figure><h1 id="44a7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">如何利用小工具</strong></h1><p id="9c49" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">创建小部件是利用小部件的一个步骤。第二步是将微件链接到数据/表以控制过滤器动态</p><p id="5f31" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">下面是一个链接小部件的示例查询</p><pre class="kj kk kl km gt nr nl ns nt aw nu bi"><span id="ba67" class="nv la it nl b gy nw nx l ny nz">SELECT * <br/>FROM &lt;table name&gt; <br/>WHERE &lt;column name&gt; = getArgument(&lt;widget name&gt;)</span></pre><p id="b4ed" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated"><em class="mq">注意:</em> <strong class="lt iu"> <em class="mq">小工具名称</em> </strong> <em class="mq">应该用双/单引号</em></p><ul class=""><li id="4a73" class="mz na it lt b lu mr lx ms ma nb me nc mi nd mm ne nf ng nh bi translated">在这种情况下，where子句指定了要作为筛选依据的列或字段。</li><li id="8041" class="mz na it lt b lu nm lx nn ma no me np mi nq mm ne nf ng nh bi translated">where子句还有一个名为<code class="fe ni nj nk nl b">getArgument()</code>的附加函数，它将小部件的名称作为输入。</li></ul><p id="7c62" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated"><em class="mq">注意:创建的小部件过滤器中的选项/列应该对应于where子句中的列</em></p><p id="2ed7" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated"><strong class="lt iu">总之，</strong>使用小工具分为两步</p><p id="3138" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated"><strong class="lt iu">步骤1: </strong>创建小部件</p><p id="ef3e" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated"><strong class="lt iu">第二步:</strong>将创建的小部件链接到您想要查询的表格</p><h1 id="4748" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">移除小工具</strong></h1><p id="400c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要删除一个小部件，只需输入以下查询</p><pre class="kj kk kl km gt nr nl ns nt aw nu bi"><span id="3f13" class="nv la it nl b gy nw nx l ny nz">REMOVE WIDGET &lt;name&gt;</span></pre><p id="80fc" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">其中<name>是您要删除的小工具的变量名</name></p><p id="1417" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">上面的代码适用于所有的小部件类型，但是如果有许多小部件需要删除，您需要多次运行它并调整小部件的名称。</p><p id="a5fd" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">要一次删除所有小部件，您可以键入以下查询</p><pre class="kj kk kl km gt nr nl ns nt aw nu bi"><span id="32d5" class="nv la it nl b gy nw nx l ny nz">%python</span><span id="6108" class="nv la it nl b gy ob nx l ny nz">dbutils.widgets.removeAll()</span></pre><p id="cd35" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">在这种情况下，您需要通过在代码前使用<code class="fe ni nj nk nl b">%python</code>命令来切换到python。</p><h1 id="8995" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">使用数据砖块小部件的技巧</strong></h1><ol class=""><li id="ca1a" class="mz na it lt b lu lv lx ly ma oc me od mi oe mm of nf ng nh bi translated">默认情况下，widget设置通常是在<strong class="lt iu">模式下运行笔记本</strong>。这意味着每次您更改过滤器类别时，无论是下拉选项还是书面文本，它都会自动运行笔记本中的每个单元格。这有时会很烦人。您可以通过单击左上角的设置图标来调整小部件设置，该图标仅在创建小部件时出现。点击之后，你会看到一个弹出的窗口小部件面板设置对话框。有三种模式可供选择。这是界面的样子</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/8710002d3ae2ca38532115b1cff09fce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jdfCTraEYQ0b__9geneSvQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自作者</p></figure><p id="4259" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">您可以根据需要调整设置</p><p id="8bba" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">2.虽然您可以同时使用所有三种小部件类型(如果出现用例)，但请记住按名称区分它们，因为默认情况下，您的笔记本会在每次更改小部件选项时运行。如果两个不同的小部件类型存在一个名称，则最后运行的查询将覆盖之前的查询。</p><h1 id="9169" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">我的两分钱</strong></h1><ul class=""><li id="c204" class="mz na it lt b lu lv lx ly ma oc me od mi oe mm ne nf ng nh bi translated">我个人不使用文本小部件或多选小部件，因为我还没有它的用例。我的定位窗口小部件类型是下拉列表或组合框。</li><li id="af62" class="mz na it lt b lu nm lx nn ma no me np mi nq mm ne nf ng nh bi translated">Dropdown和Combobox之间也没有明显的区别。区别主要在于小部件接口。</li><li id="24ca" class="mz na it lt b lu nm lx nn ma no me np mi nq mm ne nf ng nh bi translated">如果您想做一个快速的可视化演示，您可以使用一个小部件和DataBricks中的仪表板功能。</li></ul></div></div>    
</body>
</html>