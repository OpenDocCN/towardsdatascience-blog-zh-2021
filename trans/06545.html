<html>
<head>
<title>Coordinates of a flat scene</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">平面场景的坐标</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/coordinates-of-a-flat-scene-b37487df63ca?source=collection_archive---------18-----------------------#2021-06-12">https://towardsdatascience.com/coordinates-of-a-flat-scene-b37487df63ca?source=collection_archive---------18-----------------------#2021-06-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b7b0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">从像素转换到毫米，反之亦然</h2></div><p id="8eda" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你有没有想过生活在平原会是什么样子？我不知道你怎么想，但是我不想把宇宙降级到二维。我对3D空间提供的可能性感到满意，比如在我的鞋带上打结和其他拓扑满足感。</p><p id="4dd2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当编码自动化检查时，通常不得不冒险进入平原。例如，您可以考虑一个检测系统，其中零件在传送带上移动，摄像机从顶部捕捉图像。在这个场景中，感兴趣的对象被限制在传送带平面上，因此场景本质上是二维的。另一个例子是待检查的物体具有平坦表面的情况。可能希望在图像中定位这些表面，以检查缺陷的存在或验证某些特征是否存在。</p><p id="91be" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在由单个相机拍摄的3D场景的一般情况下，场景中的点的3D坐标和图像中的2D坐标之间没有一对一的关系。多个3D点将被投影到给定的图像点。你可以通过想象你正在通过一系列多个透明的窗口拍照来想象这一点。如果每个窗户上都有一只苍蝇，而且每只苍蝇都对准相机的焦点，那么你只能看到一只苍蝇。最近的一个会遮挡其他的，因为苍蝇占据的所有3D点都被投影到同一个像素。换句话说，场景中的3D坐标和图像中的2D坐标之间存在多对一的关系。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/6ea5ca96221857fcc809b7f68cf07880.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KufhVOlRhcEecTgAzvPw8A.jpeg"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">图片由<a class="ae lb" href="https://unsplash.com/@fraconca" rel="noopener ugc nofollow" target="_blank"> Fl </a> á <a class="ae lb" href="https://unsplash.com/@fraconca" rel="noopener ugc nofollow" target="_blank">维奥康卡</a>发自<a class="ae lb" href="https://unsplash.com/photos/IcOz5cCQooI" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="aefe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在单个平面中具有有趣特征的情况下，情况是不同的。您可以记下感兴趣的平面(位于3D世界中)和图像平面(坐标以像素为单位)之间的线性关系。在这种特殊情况下，感兴趣平面上的点的2D坐标(去掉Z坐标，我们将它任意设置为0)和图像中的2D坐标之间存在一一对应关系:这是一个<a class="ae lb" href="https://en.wikipedia.org/wiki/Homography_(computer_vision)" rel="noopener ugc nofollow" target="_blank">单应</a>。让我们考虑相机图像平面和3D场景中感兴趣的平面之间的映射。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi ls"><img src="../Images/8946f41728a787a2f7be72c9b54e7ec6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m1K3mkBN9oeefKIdstIpyA.jpeg"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">图片来自<a class="ae lb" href="https://unsplash.com/photos/0tj3kW1DmY8" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><blockquote class="lt lu lv"><p id="c5c0" class="kf kg lw kh b ki kj jr kk kl km ju kn lx kp kq kr ly kt ku kv lz kx ky kz la ij bi translated">一个同性恋？听起来很棒。现在，如何计算呢？</p></blockquote><p id="b519" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关键是在平面上具有已知坐标(通常以毫米为单位)的点与它们在图像中的坐标(以像素为单位)之间有对应关系。我们知道，用一个<a class="ae lb" href="https://en.wikipedia.org/wiki/Pinhole_camera_model" rel="noopener ugc nofollow" target="_blank">型号</a>的针孔摄像机，这些对应点以线性关系联系在一起。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/0488f8acfe56a8d096699dd08777566e.png" data-original-src="https://miro.medium.com/v2/resize:fit:92/format:webp/1*p8M_6dKKZCGiMIcbChjjYA.png"/></div></figure><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/42a62fef66e653b4b168d0bd8a1d4fc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:226/format:webp/1*m8_qjOXKaaeoAsU29wfxfg.png"/></div></figure><p id="1c51" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lw"> T </em>是从像素到毫米的3x3变换矩阵。(X，Y)是约束到感兴趣平面的点的2D坐标(参考轴在该平面内)，而(X，Y)是其对应的像素坐标。</p><blockquote class="lt lu lv"><p id="1e05" class="kf kg lw kh b ki kj jr kk kl km ju kn lx kp kq kr ly kt ku kv lz kx ky kz la ij bi translated">为什么我们要添加第三个总是设置为1的虚拟坐标呢？</p></blockquote><p id="8b39" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该变换是缩放、剪切、旋转和平移的组合。这些操作可以用2×2矩阵和一个附加的2×1矢量来表示。通过引入虚拟第三坐标(即<em class="lw">齐次</em>表示)，我们可以用一个3×3矩阵封装复合转换。</p><blockquote class="lt lu lv"><p id="9537" class="kf kg lw kh b ki kj jr kk kl km ju kn lx kp kq kr ly kt ku kv lz kx ky kz la ij bi translated">这是一个紧凑的问题。</p></blockquote><p id="da98" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">我们的目标将是计算变换矩阵<em class="lw"> T </em>，</strong>，这将允许我们从图像中的相应坐标获得场景中点的坐标。让我们显式地写出转换方程，对于给定的对应关系(<em class="lw"> X </em> ᵢ <em class="lw">，Y </em> ᵢ <em class="lw">，x </em> ᵢ <em class="lw">，y </em> ᵢ):</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/0b5a82916b11cabde388ad5b159868d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:396/format:webp/1*-FA6Vz1_3VXEly7L6PqXTA.png"/></div></figure><p id="9546" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将方程重组为<em class="lw"> Az = b </em>的形式后，其中<em class="lw"> z </em>包含我们的未知数{t₀₀，… t₁₂}:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi md"><img src="../Images/edd58fa50c55edb19224120da368ab5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*dBo40h-LgxeTsCkQM1lVYw.png"/></div></figure><p id="588b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们看到，每封信都为我们提供了两个6个未知数的线性方程。为了解这个线性方程组，我们需要至少三个对应，以得到最少6个线性独立的方程。在实践中，我们将尝试获得三个以上的对应，并用最小二乘法求解超定系统。</p><p id="285a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面的代码和图片可以在这个<a class="ae lb" href="https://github.com/sebastiengilbert73/tutorial_homography" rel="noopener ugc nofollow" target="_blank"> github库</a>中找到。</p><p id="6f65" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">图像<em class="lw">checkerboard.png</em>显示的是一个平面。X和Y轴用蓝线标注。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi me"><img src="../Images/8393e2c65b25625a074ff30d9fc1950b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2MLKElvhr9AMouIlIVYiwg.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">作者checkerboard.png</p></figure><p id="3a5e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对物理对象的测量允许我们将2D坐标(以毫米为单位)与其对应的坐标(以像素为单位)进行映射。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/cc72eecfe2df5ea0977220dd35b42446.png" data-original-src="https://miro.medium.com/v2/resize:fit:242/format:webp/1*ZvZgHNTVkq6Q38cNrVV-MA.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">将(798，67)手动识别为真实世界坐标(214.2毫米，178.5毫米)的对应关系</p></figure><p id="0a2c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了四个这样的对应(彼此尽可能远)，超定方程组可以用numpy函数<a class="ae lb" href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.lstsq.html" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir">numpy . linalg . lstsq()</strong></a>来求解</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="99db" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了{t₀₀，… t₁₂}矩阵条目(在上面的代码片段中用向量<em class="lw"> z </em>表示)，我们就有了我们的变换矩阵<em class="lw"> T </em>。有了它，我们可以得到一个点的毫米坐标，我们有像素坐标。例如，将像素坐标(399，500)与T:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/46ceb55cd99d495cf4b34b4b8360fc3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:258/format:webp/1*RfyrMu-5VR6FdhaxOEJbpw.png"/></div></figure><p id="ac3a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">预测值(72.3毫米，74.8毫米)与测量坐标(71.4毫米，71.5毫米)的误差在4毫米以内。4 mm)。相反，通过反转T，我们可以得到一个点的像素坐标，我们有毫米坐标。例如，点(107.1毫米，107.1毫米)位于原点右侧三个方格处。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/3edf861ca0fd2a7a43f228a2fc698e73.png" data-original-src="https://miro.medium.com/v2/resize:fit:358/format:webp/1*1eoMYsqvgoKi2ODhFbw4BQ.png"/></div></figure><p id="5f01" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">逆变换预测其舍入后的像素坐标应为(496，370):</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/4c4f3527cb6183426ff397c81cc82cef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*TXW5HfRFadj2OB8jL-C9Lw.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">绿色十字表示预测位置(107.1毫米，107.1毫米)。它落在离实际位置几毫米的地方(向右三格，原点向上三格)</p></figure><p id="fc29" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如我们所见，预测很接近，但不准确。这可能是因为我们假设了一个简单的针孔摄像机模型。为了超越针孔照相机模型，我们的成像系统的校准将需要考虑任何非线性失真。</p><p id="8a68" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们已经介绍了构建变换矩阵的步骤，当我们处理平面场景时，变换矩阵给出了像素坐标和毫米坐标之间的线性关系。这是一项基本的计算机视觉操作，需要在自动化检测中经常执行。在实践中，待检查的零件可能具有一些易于定位的基准标记或独特特征。平面上特征的已知2D位置(以毫米为单位)及其检测到的图像位置(以像素为单位)将构成一组对应关系，用于计算变换矩阵<em class="lw"> T </em>。然后，已知真实世界坐标的平面上的任何物体都可以在图像中定位，即使这个物体很难检测到，甚至不存在。<br/> <br/>请随意试验<a class="ae lb" href="https://github.com/sebastiengilbert73/tutorial_homography" rel="noopener ugc nofollow" target="_blank">代码</a>，并且<a class="ae lb" href="https://www.linkedin.com/in/s%C3%A9bastien-gilbert-69735219/" rel="noopener ugc nofollow" target="_blank">让我知道</a>您认为<br/>可能适用的用例。</p><p id="b3b8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设感兴趣的平面不通过照相机的焦点</p><p id="f8d9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">针孔相机模型忽略了镜头失真和失焦模糊。它是真实相机的一阶近似。</p></div></div>    
</body>
</html>