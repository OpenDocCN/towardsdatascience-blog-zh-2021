<html>
<head>
<title>Using Machine Learning to Predict Customers’ Next Purchase Day</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用机器学习来预测客户的下一个购买日</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-machine-learning-to-predict-customers-next-purchase-day-7895ad49b4db?source=collection_archive---------0-----------------------#2021-04-30">https://towardsdatascience.com/using-machine-learning-to-predict-customers-next-purchase-day-7895ad49b4db?source=collection_archive---------0-----------------------#2021-04-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e212" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">机器学习模型来预测客户是否会在一段时间后进行下一次购买。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a448cca453694cad463105497e2e6b02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*57y22gCTcHbOfwsy5d1iVQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由<a class="ae kv" href="https://pixabay.com/users/mediamodifier-1567646/" rel="noopener ugc nofollow" target="_blank"> Mediamodifier </a>制作，可以在这里<a class="ae kv" href="https://pixabay.com/photos/ecommerce-selling-online-2140603/" rel="noopener ugc nofollow" target="_blank">访问。</a></p></figure><h1 id="3afe" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="83ff" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果说零售业的人从<a class="ae kv" href="https://en.wikipedia.org/wiki/Severe_acute_respiratory_syndrome_coronavirus_2" rel="noopener ugc nofollow" target="_blank">新型冠状病毒</a>疫情那里学到了一个重要的教训，那就是要求他们转向通过互联网做生意，即<a class="ae kv" href="https://en.wikipedia.org/wiki/E-commerce" rel="noopener ugc nofollow" target="_blank">电子商务</a>。电子商务的理念有助于管理人员为公司的发展做出决策。毫无疑问，这些决策中的大多数都会受到数据分析、数据科学和机器学习专家对在线客户购买行为数据的研究结果的影响。</p><p id="5450" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">假设一家在线零售店的管理团队带着<a class="ae kv" href="https://www.kaggle.com/mashlyn/online-retail-ii-uci/download" rel="noopener ugc nofollow" target="_blank">数据集</a>来找你，你是一名数据科学家，你想知道顾客是否会在最后一次购物后的90天内进行下一次购物。您对他们询问的回答将有助于他们确定他们的营销团队在推出下一次促销活动时需要关注哪些客户。</p><p id="d212" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在本文中，作为一名数据科学家，我的目标是构建一个模型，为公司经理提出的问题提供合适的答案。更准确地说，使用给定的<a class="ae kv" href="https://www.kaggle.com/mashlyn/online-retail-ii-uci/download" rel="noopener ugc nofollow" target="_blank">数据集</a>，我建立了一个机器学习模型，预测零售店的在线客户是否会在他们最后一次购买的90天后进行下一次购买。</p><p id="241f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">值得一提的是<a class="ae kv" href="https://medium.com/@karamanbk" rel="noopener">巴尔·卡拉曼</a>已经做了一个<a class="ae kv" rel="noopener" target="_blank" href="/predicting-next-purchase-day-15fae5548027">类似的工作</a>回答了一个不同的问题，而不是我们想要先发制人的这个问题的准确预测。</p><h1 id="696c" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">关于数据集的一些信息</h1><p id="188c" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在开始回答感兴趣的问题之前，我将首先介绍一些关于<a class="ae kv" href="https://www.kaggle.com/mashlyn/online-retail-ii-uci/download" rel="noopener ugc nofollow" target="_blank">数据集</a>的一般有用信息。</p><p id="d87c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">该数据集记录了来自43个不同国家的5942名在线客户。在零售店的在线客户中，90.8%的人生活在英国。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/e69554a618eb267319a8d7dc42fe88ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TGPiMZe52tKfjLpCo-e7AA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图1:以百分比表示的客户国家计数—图片由<a class="ae kv" href="https://eocansey.medium.com/" rel="noopener">作者</a>提供</p></figure><p id="a175" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">英国有如此庞大的客户群，公司83%的收入来自英国也就不足为奇了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/175fe04ba7334a65bdd13439a015355e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fMY1c3z5BzG8SqWoE-3qAw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图2:各国收入百分比——图片由<a class="ae kv" href="https://eocansey.medium.com/" rel="noopener">作者</a>提供</p></figure><p id="7efb" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面的图3给出了在线零售公司每月收入的直观表示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/8016e9dc7722c4711ca7bb425a504d07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GErH_MhT09Z_U6UJ8pT7nA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图3:2009年12月至2011年12月的月收入——图片由<a class="ae kv" href="https://eocansey.medium.com/" rel="noopener">作者</a>提供。</p></figure><p id="c8e0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在这里，我们可以观察到该公司在2010年11月的收入最高，其次是2011年11月。此外，8月份以后每月收入有所上升。</p><p id="71af" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">根据本节所做的分析，我们可以向经理们提出一些建议供他们考虑。在该公司努力增加除英国以外的其他国家的客户群的过程中，数据科学家可以向管理团队提出什么建议？在回答这个问题时，我会说…</p><p id="f4cb" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">由于该公司在英国拥有坚实的客户基础，它可以利用这一点推出“双赢促销”。具体来说，对于现有客户购买的任何产品，他/她都有机会通过网络链接邀请英国以外的新客户。如果新客户使用他/她从现有客户那里收到的网络链接从在线商店购买了一些东西，公司将向现有客户和新客户提供一张现金券，双方可以在下次购买时使用该现金券。通过这样做，我们看到公司、现有或以前的客户以及新客户在交易中都获得了一定程度的满意度。</p><h1 id="6783" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">预测顾客的下一次购买</h1><p id="ba2b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在这一节中，我将重点介绍我为解决感兴趣的问题而部署的方法。也就是说，<em class="mq">建立一个机器学习模型，该模型将预测零售店的在线客户是否会在他们最后一次购买的90天后进行下一次购买。</em></p><p id="efcf" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">主要步骤包括如下:</p><ul class=""><li id="2113" class="mr ms iq lq b lr mk lu ml lx mt mb mu mf mv mj mw mx my mz bi translated"><strong class="lq ir">数据角力</strong></li><li id="74db" class="mr ms iq lq b lr na lu nb lx nc mb nd mf ne mj mw mx my mz bi translated"><strong class="lq ir">特征工程</strong></li><li id="2f0c" class="mr ms iq lq b lr na lu nb lx nc mb nd mf ne mj mw mx my mz bi translated"><strong class="lq ir">建立机器学习模型</strong></li><li id="9762" class="mr ms iq lq b lr na lu nb lx nc mb nd mf ne mj mw mx my mz bi translated"><strong class="lq ir">选择型号</strong></li></ul><p id="3294" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我首先导入必要的Python包，下载<a class="ae kv" href="https://www.kaggle.com/mashlyn/online-retail-ii-uci/download" rel="noopener ugc nofollow" target="_blank">数据集</a>，然后将其加载到我的Python环境中。下面的代码片段总结了这个步骤。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h2 id="9c8e" class="nh kx iq bd ky ni nj dn lc nk nl dp lg lx nm nn li mb no np lk mf nq nr lm ns bi translated">数据争论</h2><p id="4b48" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">然后，我与数据集争论，让它进入良好的状态，以便引入新的<code class="fe nt nu nv nw b">X</code>特性。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="165d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">给定数据集的<code class="fe nt nu nv nw b">CustomerID</code>列有<code class="fe nt nu nv nw b">243007</code>缺失数据。这代表了所有在线客户的<code class="fe nt nu nv nw b">22.77%</code>。此外，<code class="fe nt nu nv nw b">Description</code>列有<code class="fe nt nu nv nw b">4382</code>缺失数据。我如何处理这些丢失的数据？在与公司领导交谈后，他们建议应该放弃任何缺少<code class="fe nt nu nv nw b">CustomerID</code>的项目。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="569d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">数据帧<code class="fe nt nu nv nw b">df_data</code>被分成两个熊猫数据帧。即，</p><ul class=""><li id="e817" class="mr ms iq lq b lr mk lu ml lx mt mb mu mf mv mj mw mx my mz bi translated">第一个子数据框架<code class="fe nt nu nv nw b">ctm_bhvr_dt</code>包含客户在2009年1月12日至2011年8月30日期间的购买情况。从这个数据集中，我得到了所有在线客户的最后购买日期。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><ul class=""><li id="e214" class="mr ms iq lq b lr mk lu ml lx mt mb mu mf mv mj mw mx my mz bi translated">第二个子数据帧<code class="fe nt nu nv nw b">ctm_next_quarter</code>用于获取客户从2011年01月09日到2011年11月30日的首次购买日期。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="59a6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">接下来，我创建一个pandas数据框架，其中包含每个客户的一组特征，以便我们构建预测模型。我首先创建一个数据集，它包含数据帧<code class="fe nt nu nv nw b">ctm_bhvr_dt</code>中的不同客户。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="8178" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">然后，我向数据帧<code class="fe nt nu nv nw b">ctm_dt</code>添加一个新标签<code class="fe nt nu nv nw b"><strong class="lq ir">NextPurchaseDay</strong></code>。这个新标签将是数据帧中某个客户的最后一次购买日期之间的天数，该客户拥有最频繁购买的商品，并且缺少CustomerID下面的过程处理CustomerID列中缺少的值。结果是数据框<code class="fe nt nu nv nw b">ctm_next_quarter</code>中的<code class="fe nt nu nv nw b">ctm_bhvr_dt</code>和他/她的首次购买日期。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="55ea" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面的图5是上面代码片段的输出。它显示了dataframe对象的前5个条目<code class="fe nt nu nv nw b">ctm_dt</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图5:客户的下一个购买日数据</p></figure><p id="d96f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在下一节中，我将介绍一些功能，并将它们添加到数据框架<code class="fe nt nu nv nw b">ctm_dt</code>中，以构建我们的机器学习模型。</p><h2 id="1cc0" class="nh kx iq bd ky ni nj dn lc nk nl dp lg lx nm nn li mb no np lk mf nq nr lm ns bi translated">特征工程</h2><p id="40ee" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我在我们的数据框架<code class="fe nt nu nv nw b">ctm_dt</code>中引入了一些特性，这些特性根据客户对公司的价值将他们分成不同的组。在执行这个过程中，我使用了RFM分割法。RFM代表</p><ul class=""><li id="5d28" class="mr ms iq lq b lr mk lu ml lx mt mb mu mf mv mj mw mx my mz bi translated"><strong class="lq ir">最近度</strong>:表示顾客购买的时间有多近。</li><li id="a161" class="mr ms iq lq b lr na lu nb lx nc mb nd mf ne mj mw mx my mz bi translated">频率:顾客购买的频率或次数。</li><li id="9a46" class="mr ms iq lq b lr na lu nb lx nc mb nd mf ne mj mw mx my mz bi translated"><strong class="lq ir">货币价值/收入</strong>:客户在某一时间点购买时所花费的金额。</li></ul><p id="8c72" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">利用这三个特征，即新近性、频率和货币价值/收入，我创建了一个RFM评分系统来对客户进行分组。从本质上讲，RFM得分有助于洞察客户在未来可能会做出什么样的购买决定。</p><p id="9529" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在计算出RFM分数后，我接着应用<em class="mq">无监督机器学习</em>为每个分数识别不同的组(群)并将它们添加到数据框架<code class="fe nt nu nv nw b">ct_dt</code>。最后，我将pandas数据框架方法<code class="fe nt nu nv nw b">get_dummies</code>应用到<code class="fe nt nu nv nw b">ctm_dt</code>来处理数据框架中的分类特征。我现在开始编写代码，找出RFM分数和聚类的计算方法。</p><p id="0ba0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir">新近度</strong></p><p id="cf6d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在了解谁有可能进行当前购买的过程中，我使用最近特征来解决这个问题。考虑到顾客在最后一次购买后离开的时间长度，最近特征在这里就派上用场了。我使用这个特性来了解哪个客户将进行交易。还需要注意的是，最近购买的客户的销售交易远比有一段时间没有购买的客户更有价值。</p><p id="44da" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们进入下面的编码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="2ad5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面的图6给出了在线客户的最近数据的可视化表示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/3baed2602e8f9b748d423d91f6b147ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wBewS6ZEFI69-xT-DOWBig.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图6:客户最近数据的直方图—图片由<a class="ae kv" href="https://eocansey.medium.com/" rel="noopener">作者</a>提供。</p></figure><p id="08fe" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">用于生成上面图6的代码可以在Jupyter笔记本<a class="ae kv" href="https://github.com/evansdoe/online_retail/blob/main/online_retail.ipynb" rel="noopener ugc nofollow" target="_blank">这里</a>访问。</p><p id="c478" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">接下来，我需要为最近值分配一个最近分数。这可以通过应用<em class="mq"> K均值聚类算法来实现。</em>但是，在使用算法之前，我们需要知道聚类的数量。应用<a class="ae kv" href="https://en.wikipedia.org/wiki/Elbow_method_(clustering)" rel="noopener ugc nofollow" target="_blank"> <em class="mq">肘法</em> </a>，可以确定给定数据所需的聚类数。在我们的例子中，给定最近值作为我们的数据，计算的聚类数是4。用于计算星团数量的代码可在Jupyter笔记本<a class="ae kv" href="https://github.com/evansdoe/online_retail/blob/main/online_retail.ipynb" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p><p id="b875" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我现在可以使用数据帧<code class="fe nt nu nv nw b">ctm_dt</code>中的<code class="fe nt nu nv nw b"><strong class="lq ir">Recency</strong></code>列构建4个聚类，并在<code class="fe nt nu nv nw b">ctm_dt</code>中创建一个新列<code class="fe nt nu nv nw b"><strong class="lq ir">RecencyCluster</strong></code>，其值是由无监督机器学习算法<code class="fe nt nu nv nw b">kmeans</code>预测的聚类值。使用用户定义的Python函数<code class="fe nt nu nv nw b">order_cluster</code>可访问<a class="ae kv" href="https://github.com/evansdoe/online_retail/blob/main/online_retail.ipynb" rel="noopener ugc nofollow" target="_blank">这里是</a>，我按照<code class="fe nt nu nv nw b"><strong class="lq ir">RecencyCluster</strong></code>中值的降序对数据帧<code class="fe nt nu nv nw b">ctm_dt</code>进行排序。下面的代码片段输出了图7。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图7:客户最近聚类数据</p></figure><p id="ac8d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们根据标有<code class="fe nt nu nv nw b"><strong class="lq ir">RecencyCluster</strong></code>的列中的聚类值对数据帧<code class="fe nt nu nv nw b">ctm_dt</code>进行分组，并取出每个聚类的<code class="fe nt nu nv nw b"><strong class="lq ir">Recency</strong></code>数据的统计描述</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图RecencyCluster的最近数据的统计摘要</p></figure><p id="3dd9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">从上面的图8中可以看出，聚类值3包含最近的客户，而0包含最不活跃的客户。</p><p id="c742" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在接下来的小节中，我将我们在这一小节中讨论的方法应用于频率和收入特性。</p><p id="cfca" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir">频率</strong></p><p id="f5c9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如前所述，在特定的时间段内，如果我们考虑客户参与购买交易的次数，频率就会发挥作用。现在，这种频率特征有助于我们了解特定公司或贸易品牌的客户联盟。考虑到这一点，它使公司能够洞察营销策略，以及在什么时间点进行传递，以便特别触及这些客户。</p><p id="0944" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在这里，我进行了与上一小节相似的分析过程(<strong class="lq ir">新近度</strong>)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图9:带有频率的主数据集的前5个条目</p></figure><p id="eed4" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面的图10展示了购买频率低于1200的客户的直方图。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/6e8c48286f13bd94df54c6f9d6f8b403.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Zyp3lxgAalsCjP6fG18PQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图10:购买频率低于1200的客户直方图—图片由<a class="ae kv" href="https://eocansey.medium.com/" rel="noopener">作者</a>提供。</p></figure><p id="e155" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面的代码片段为每个客户的购买频率分配一个分类值，并按降序对分类值进行排序。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图11:带有FrequencyCluster的主数据集的前五个条目</p></figure><p id="71c2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面的代码片段根据记录在标签为<code class="fe nt nu nv nw b"><strong class="lq ir">FrequencyCluster</strong></code>的列中的聚类值对数据帧<code class="fe nt nu nv nw b">ctm_dt</code>进行分组，并提取每个<code class="fe nt nu nv nw b"><strong class="lq ir">FrequencyCluster</strong></code>值的<code class="fe nt nu nv nw b"><strong class="lq ir">Frequency</strong></code>数据的统计描述。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图12:针对FrequencyCluster的频率数据统计摘要</p></figure><p id="3a09" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">就像最近的情况一样，具有较高频率聚类值的客户是更好的客户。换句话说，他们经常光顾零售店的产品，而不是那些频率聚类值较低的产品。</p><p id="b482" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir">货币价值/收入</strong></p><p id="8f31" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为了更详细地描述货币价值或收入，它更侧重于客户在任何时间点购买时所花的钱。因此，这有助于确定顾客在购物时可能会放出多少钱。尽管收入的这一特征并不能让人们预测顾客下一次购买的时间，但知道当顾客完成交易时会有多少收入是值得的。</p><p id="9f17" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我再次遵循类似的过程来获得每个客户的收入分数，并根据他们的收入分数为每个客户分配聚类值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图13:带有收入的主数据集的前五个条目</p></figure><p id="92dd" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下图直观地展示了收入低于10，000英镑的客户。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/8b68ce8a6d9a954252ca5646ccdf1cfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WQKkBrux5eFrACovA7mo4Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图14:货币价值低于10000的客户直方图—图片由<a class="ae kv" href="https://eocansey.medium.com/" rel="noopener">作者</a>提供。</p></figure><p id="4744" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面的代码片段为每个客户的收入分配一个分类值，并按升序对分类值进行排序。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图RevenueCluster的收入数据统计摘要</p></figure><p id="1c7b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir">总分</strong></p><p id="137a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在下面的代码片段中，我向dataframe <code class="fe nt nu nv nw b">ctm_dt</code>添加了一个新列<code class="fe nt nu nv nw b"><strong class="lq ir">OverallScore</strong></code>,其值是最近、频率和收入的聚类值之和。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图16:根据整体核心价值分组的近期、频率和收入的平均值</p></figure><p id="1972" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">上面的评分清楚地告诉我们，总体得分为8分的客户是非常优秀的客户，他们为公司带来了很多价值，而那些得分为3分的客户被认为是不可靠的，仅仅是徘徊不定。</p><p id="cc20" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">作为跟进，我根据总体得分将客户分为以下几类:</p><ul class=""><li id="aa8d" class="mr ms iq lq b lr mk lu ml lx mt mb mu mf mv mj mw mx my mz bi translated">3到4:低值</li><li id="10a7" class="mr ms iq lq b lr na lu nb lx nc mb nd mf ne mj mw mx my mz bi translated">5到6:中间值</li><li id="6e5d" class="mr ms iq lq b lr na lu nb lx nc mb nd mf ne mj mw mx my mz bi translated">7到8:高价值</li></ul><p id="1177" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">代码片段如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图17:带有Segment列的主数据集的前五个条目</p></figure><p id="0be0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">然后，我创建数据集<code class="fe nt nu nv nw b">ctm_dt</code>的副本，并对其应用方法<code class="fe nt nu nv nw b">get_dummies</code>，以便将所有分类列<code class="fe nt nu nv nw b"><strong class="lq ir">Segment</strong></code>转换为指示变量。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="8cac" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为了实现估计客户是否会在下个季度购买的目标，我创建了一个值为1或0的新列<code class="fe nt nu nv nw b"><strong class="lq ir">NextPurchaseDayRange</strong></code>,定义如下:</p><ul class=""><li id="eb38" class="mr ms iq lq b lr mk lu ml lx mt mb mu mf mv mj mw mx my mz bi translated">如果值为1，则表明客户将在下一季度购买某样东西，即从他或她最后一次购买起90天。</li><li id="dcf5" class="mr ms iq lq b lr na lu nb lx nc mb nd mf ne mj mw mx my mz bi translated">值0表示客户将在自上次购买后的90天内购买商品。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="86de" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我通过计算我们的特征和标签之间的相关性来结束这一部分。我通过对数据帧<code class="fe nt nu nv nw b">ctm_class</code>应用<code class="fe nt nu nv nw b">corr</code>方法来实现这一点。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图18:最小和最大相关系数</p></figure><p id="a6b1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">从上面的图18可以看出，<code class="fe nt nu nv nw b"><strong class="lq ir">OverallScore</strong></code>与<code class="fe nt nu nv nw b"><strong class="lq ir">RecencyCluster</strong></code>的正相关性最高，为0.97，<code class="fe nt nu nv nw b"><strong class="lq ir">Segment_Low-Value</strong> </code>与<code class="fe nt nu nv nw b"><strong class="lq ir">Segment_Mid-Value</strong></code>的负相关性最高，为-0.99。</p><p id="477f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在下面的图19中，我展示了一个很好的系数矩阵的可视化。代码片段如下。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/7f41edd15bb70a1a0bf0e3ba469a662a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YmGBJjP3Lpw4c_LZPYvydw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图19:相关矩阵—图片由<a class="ae kv" href="https://eocansey.medium.com/" rel="noopener">作者</a>提供。</p></figure><h2 id="1ee9" class="nh kx iq bd ky ni nj dn lc nk nl dp lg lx nm nn li mb no np lk mf nq nr lm ns bi translated">构建机器学习模型</h2><p id="05a7" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在本节中，我将介绍构建机器学习模型所需的必要先决条件。下面的代码片段将数据帧<code class="fe nt nu nv nw b">ctm_class</code>分成<code class="fe nt nu nv nw b"><strong class="lq ir">X</strong></code>特征和目标变量<code class="fe nt nu nv nw b"><strong class="lq ir">y</strong></code>。之后，我将<code class="fe nt nu nv nw b"><strong class="lq ir">X</strong></code>和<code class="fe nt nu nv nw b"><strong class="lq ir">y</strong></code>分开，以获得训练和测试数据集，然后测量不同模型的准确度、F₁-score、召回率和精确度。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图20:所有模型的度量</p></figure><p id="7a58" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">从上面图20的结果中，我们看到<code class="fe nt nu nv nw b">LogisticRegression</code>模型在度量准确性和F₁-score.方面是最好的</p><p id="4efe" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们看看如何通过找到合适的参数来控制模型的学习过程，从而对现有模型<code class="fe nt nu nv nw b">XGB Classifier</code>进行改进，该模型在上面的图20中排名第四。这个过程称为<em class="mq">超参数调整</em>。然后我用下面的计算来验证改进的<code class="fe nt nu nv nw b">XGB Classifier</code>模型是否优于<code class="fe nt nu nv nw b">LogisticRegression</code>模型。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图21: XGB分类器模型——超参数调整</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图22:改进的XGB分类器准确度分数</p></figure><h2 id="f700" class="nh kx iq bd ky ni nj dn lc nk nl dp lg lx nm nn li mb no np lk mf nq nr lm ns bi translated">选择模型</h2><p id="29f6" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">比较上面图20中的<code class="fe nt nu nv nw b">LogisticsRegression</code>和上面图22中的精确<code class="fe nt nu nv nw b">XGB classifier</code>的精度，很明显精确<code class="fe nt nu nv nw b">XGB classifier </code>模型比<code class="fe nt nu nv nw b">LogisticRegression</code>模型精确<code class="fe nt nu nv nw b">0.1</code>。其他指标呢？</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图23:XGB和LogisticRegression分类器的度量分数</p></figure><p id="4278" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">从上面图23中的输出可以明显看出，对于每个指标、<code class="fe nt nu nv nw b">accuracy</code>、<code class="fe nt nu nv nw b">F₁-score</code>、<code class="fe nt nu nv nw b">recall</code>和<code class="fe nt nu nv nw b">precision</code>，改进的<code class="fe nt nu nv nw b">XGB classifier</code>模型优于<code class="fe nt nu nv nw b">LogisticRegression</code>模型。</p><p id="63c9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在预测客户在最后一次购买90天后在网上零售店再次购买的预期时，我们的提交需要准确。因此，我感兴趣的是在进行这种先发制人时尽可能给出最高精确度的模型。因此，最好选择使用改进的<code class="fe nt nu nv nw b">XGB classifier</code>型号，而不是<code class="fe nt nu nv nw b">LogisticRegression</code>型号。</p><h1 id="3bda" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">结论</h1><p id="3db8" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">从数据集中，我强调了一个事实，即以英国为中心的网上商店的强大客户群是公司从英国作为一个地区获得高收入的主要原因。</p><p id="689c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我还详细演示了如何建立一个机器学习模型来预测零售商店的在线客户是否会在他们最后一次购买的90天后进行下一次购买。在我使用的模型中，我必须通过超参数调整过程进一步改进<code class="fe nt nu nv nw b">XGB classifier</code>模型，以胜过<code class="fe nt nu nv nw b">LogisticRegression</code>模型。<code class="fe nt nu nv nw b">XGB classifier</code>模型<code class="fe nt nu nv nw b">max_depth</code>和<code class="fe nt nu nv nw b">min_child_weight</code>的超参数调整后的初始指标都设置为3，并没有超过<code class="fe nt nu nv nw b">LogisticRegression</code>的指标。所以我不得不进一步试探性地调整这些值，以便让<code class="fe nt nu nv nw b">XGB classifier</code>模型的性能优于<code class="fe nt nu nv nw b">LogisticRegression</code>模型。</p><p id="37ab" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">尽管如此，进一步研究如何再次提高模型的准确性和F₁-score度量将是有趣的。我建议通过引入“正确的”<code class="fe nt nu nv nw b">X</code>特性来改进数据集，从而避免使用超参数调整过程。所以我现在的问题是</p><blockquote class="nz"><p id="8137" class="oa ob iq bd oc od oe of og oh oi mj dk translated">在不调整超参数的情况下，将哪些<code class="fe nt nu nv nw b">X-</code>特征引入数据集以达到或提高模型的高精度和F₁-score指标是合适的？</p></blockquote><p id="b2e2" class="pw-post-body-paragraph lo lp iq lq b lr oj jr lt lu ok ju lw lx ol lz ma mb om md me mf on mh mi mj ij bi translated">本文使用的Jupyter笔记本可从<a class="ae kv" href="https://github.com/evansdoe/online_retail/blob/main/online_retail.ipynb" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p></div><div class="ab cl oo op hu oq" role="separator"><span class="or bw bk os ot ou"/><span class="or bw bk os ot ou"/><span class="or bw bk os ot"/></div><div class="ij ik il im in"><h2 id="7007" class="nh kx iq bd ky ni nj dn lc nk nl dp lg lx nm nn li mb no np lk mf nq nr lm ns bi translated">参考</h2><p id="aad9" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">[1] <a class="ae kv" href="https://medium.com/@karamanbk" rel="noopener">巴尔斯卡拉曼</a>。(2021年4月28日访问)<a class="ae kv" rel="noopener" target="_blank" href="/predicting-next-purchase-day-15fae5548027">预测下一个购买日</a></p></div></div>    
</body>
</html>