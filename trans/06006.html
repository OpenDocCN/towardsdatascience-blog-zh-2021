<html>
<head>
<title>Rock Containerized GPU Machine Learning Development with VS Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Rock容器化GPU机器学习开发用VS代码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/rock-containerized-gpu-machine-learning-development-with-vs-code-34940ff25509?source=collection_archive---------18-----------------------#2021-05-29">https://towardsdatascience.com/rock-containerized-gpu-machine-learning-development-with-vs-code-34940ff25509?source=collection_archive---------18-----------------------#2021-05-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dd45" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">再也不用为破损的基础设施而烦恼了</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8f98fbc1fb653c59e9dba6e0036fd407.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5EeTpWg1ZCwPZaL9Aqltew.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@fossy?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Fab Lentz </a>在<a class="ae ky" href="https://unsplash.com/s/photos/success?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="198a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在GPU上运行机器学习算法是一种常见的做法。虽然有像Paperspace和Colab这样的云ML服务，但是最方便/灵活的原型化方式仍然是本地机器。</p><h1 id="7097" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">别闹了，用集装箱🦺</h1><p id="612f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">自从机器学习库(例如TensorFlow、Torch和Caffe)出现以来，处理Nvidia库一直是许多数据科学家头疼的问题:</p><ul class=""><li id="f67b" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">Nvidia驱动程序/库和硬件/操作系统可能不兼容，这在面向消费者的笔记本电脑/台式机上经常发生。</li><li id="9b36" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">Nvidia库可能与ML库版本不匹配，这意味着您不能让系统自动更新库。</li><li id="994c" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">ML进程和其他进程可以竞争资源。例如，如果您在训练模型时筛选记录，则两者都有可能崩溃，因为编解码器和模型训练都需要锁定GPU资源。</li><li id="5e90" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">更多奇怪的问题…</li></ul><p id="4ac3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总之，建立一个GPU ML环境会不断弄乱现有的基础设施，通常需要重新安装操作系统来恢复。</p><p id="2743" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更好的方法是在支持CUDA的容器中进行开发，其中开发环境与主机和其他项目相隔离。</p><h1 id="fc49" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">VS代码远程容器=在容器中开发</h1><p id="0ec6" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在容器内开发通常效率很低，因为很难想象VM内发生了什么。</p><p id="4769" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，VS代码通过在IDE前端和后端之间定义一组通用的API使它变得简单，这使得在两个系统中运行它们对用户来说是无缝的。</p><p id="1683" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是来自VS代码文档网站的图表，展示了它是如何工作的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/1894f8d551b26464662c21200bfac16b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WwuNtvg204SBHmXdM--uXg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">鸣谢:<a class="ae ky" href="https://code.visualstudio.com/docs/remote/containers" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码文档网站</a></p></figure><p id="3bc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于它如何工作的更多细节，参见<a class="ae ky" href="https://code.visualstudio.com/docs/remote/containers" rel="noopener ugc nofollow" target="_blank">官方文档</a>。</p><h1 id="0810" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">逐步安装说明</h1><p id="dbd4" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">让我们一步一步来看看如何用VS代码建立一个容器化的GPU ML开发环境。</p><h2 id="3048" class="nh lw it bd lx ni nj dn mb nk nl dp mf li nm nn mh lm no np mj lq nq nr ml ns bi translated">步骤1:定义容器</h2><p id="2291" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">基于容器的开发中最基本的组件是容器。我们需要用Dockerfile文件定义容器。</p><p id="3d28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是张量流的一个例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="f3ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个Dockerfile告诉VS代码以官方的TensorFlow图像为基线构建一个容器，此外，使用BASH作为默认终端，而不是不太用户友好的SH(IMO)。</p><h2 id="2232" class="nh lw it bd lx ni nj dn mb nk nl dp mf li nm nn mh lm no np mj lq nq nr ml ns bi translated">步骤2:定义VS代码应该如何使用VM</h2><p id="fc0d" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">现在我们有了一个可以利用GPU能力的容器，我们需要告诉VS代码<strong class="lb iu">使用之前定义的容器</strong>并且<strong class="lb iu">将GPU能力传递给它</strong>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h2 id="9b38" class="nh lw it bd lx ni nj dn mb nk nl dp mf li nm nn mh lm no np mj lq nq nr ml ns bi translated">步骤3(可选):在虚拟机中添加用户</h2><p id="6b8c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">理论上，我们已经可以使用这个环境进行开发，但是，由于我们还没有定义任何用户，所以所有的操作都将在root下进行，这是可以的，但是不太安全。</p><p id="4aed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过在docker文件中添加以下代码来定义用户:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="9c77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们需要告诉VS代码以这个远程用户的身份登录:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h2 id="3ea9" class="nh lw it bd lx ni nj dn mb nk nl dp mf li nm nn mh lm no np mj lq nq nr ml ns bi translated">步骤4:启动虚拟机开发环境</h2><p id="15e5" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">最后，我们已经准备好运行远程开发会话的一切，让我们试一试:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/18a2c8924af2ad53324637de1823d929.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*A14zmj90ANMXiCRp6rQpHg.gif"/></div></div></figure><p id="3626" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要了解更多细节，请查看<a class="ae ky" href="https://github.com/DocsQnA/experimental" rel="noopener ugc nofollow" target="_blank">这个库</a>，这是我试验这个设置的库。更多后续提示和技巧(我仍在努力)，请在GitHub 上关注我<a class="ae ky" href="https://github.com/tianhaoz95" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="84dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是如何在GPU的支持下进行ML开发，但又不会经常搞乱你的基础设施。快乐黑客🚀🚀🚀</p></div></div>    
</body>
</html>