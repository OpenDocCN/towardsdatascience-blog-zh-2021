<html>
<head>
<title>Automate Microsoft Excel and Word Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python自动化Microsoft Excel和Word</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automate-microsoft-excel-and-word-using-python-4244c613f818?source=collection_archive---------1-----------------------#2021-11-13">https://towardsdatascience.com/automate-microsoft-excel-and-word-using-python-4244c613f818?source=collection_archive---------1-----------------------#2021-11-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4e19" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将Excel与Word集成，无缝生成自动化报告</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c4636efe47db99a20cfe2adc445abc79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RoXfMFgqrbPi4q5M"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">艾萨克·史密斯在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="1954" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">毫无疑问，微软的Excel和Word是公司和非公司领域使用最广泛的两个软件。它们实际上是“工作”这个术语本身的同义词。通常，没有一个星期我们不把这两者结合起来，并以这样或那样的方式利用它们的优点。虽然对于一般的日常目的来说，不会要求自动化，但有时自动化是必要的。也就是说，当您有大量的图表、数字、表格和报告要生成时，如果您选择手动方式，这可能会成为一项非常乏味的工作。嗯，不一定非要那样。事实上，有一种方法可以在Python中创建一个管道，您可以无缝地将两者集成在一起，在Excel中生成电子表格，然后将结果传输到Word中，几乎即时生成报告。</p><h2 id="c2ef" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">Openpyxl</h2><p id="d23c" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">认识一下Openpyxl，它可以说是Python中最通用的绑定之一，它使得与Excel的交互简直就像在公园里散步。有了它，您可以读写所有当前和传统的excel格式，即xlsx和xls。Openpyxl允许你填充行和列，执行公式，创建2D和3D图表，标记轴和标题，以及大量其他可以派上用场的<a class="ae ky" href="https://openpyxl.readthedocs.io/en/stable/index.html" rel="noopener ugc nofollow" target="_blank">功能</a>。然而，最重要的是，这个包使您能够在Excel中迭代无数的行和列，从而将您从以前必须做的所有讨厌的数字计算和绘图中解救出来。</p><h2 id="d527" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">Python-docx</h2><p id="644b" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">然后出现了Python-docx——这个包对于Word就像Openpyxl对于Excel一样。如果你还没有研究过他们的<a class="ae ky" href="https://python-docx.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">文档</a>，那么你或许应该看一看。毫不夸张地说，自从我开始使用Python以来，Python-docx是我使用过的最简单、最容易理解的工具包之一。它允许您通过自动插入文本、填写表格和将图像渲染到您的报告中来自动生成文档，而没有任何开销。</p><p id="f7cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事不宜迟，让我们创建自己的自动化管道。继续启动Anaconda(或您选择的任何其他IDE)并安装以下软件包:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="4ee1" class="lv lw it mu b gy my mz l na nb">pip install openpyxl</span><span id="7386" class="lv lw it mu b gy nc mz l na nb">pip install python-docx</span></pre><h2 id="379c" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">Microsoft Excel自动化</h2><p id="8fd5" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">首先，我们将加载一个已经创建的Excel工作簿(如下所示):</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="19c6" class="lv lw it mu b gy my mz l na nb">workbook = xl.load_workbook('Book1.xlsx')<br/>sheet_1 = workbook['Sheet1']</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/30eb4634c66e1814e0e6ced725a3a6c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:436/format:webp/1*pR0Udh3SNfHjvPgdVXFFTA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。</p></figure><p id="127a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随后，我们将迭代电子表格中的所有行，通过将电流乘以电压来计算并插入功率值:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="5e2e" class="lv lw it mu b gy my mz l na nb">for row in range(2, sheet_1.max_row + 1):<br/>    current = sheet_1.cell(row, 2)<br/>    voltage = sheet_1.cell(row, 3)<br/>    power = float(current.value) * float(voltage.value)<br/>    power_cell = sheet_1.cell(row, 1)<br/>    power_cell.value = power</span></pre><p id="5b0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成后，我们将使用功率的计算值来生成一个折线图，该折线图将插入到指定的单元格中，如下所示:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="af50" class="lv lw it mu b gy my mz l na nb">values = Reference(sheet_1, min_row = 2, max_row = sheet_1.max_row, min_col = 1, max_col = 1)<br/>chart = LineChart()<br/>chart.y_axis.title = 'Power'<br/>chart.x_axis.title = 'Index'<br/>chart.add_data(values)<br/>sheet_1.add_chart(chart, 'e2') <br/>workbook.save('Book1.xlsx')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/169ff596f1154dd02aa29192e9a7f631.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d9ylJLJEaBbHIc71sZ6U-Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">自动生成的Excel电子表格。图片由作者提供。</p></figure><h2 id="cdbf" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">提取图表</h2><p id="9855" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">现在我们已经生成了图表，我们需要将其提取为图像，以便在Word报告中使用。首先，我们将声明Excel文件的确切位置，以及输出图表图像应该保存的位置:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="94af" class="lv lw it mu b gy my mz l na nb">input_file = "C:/Users/.../Book1.xlsx"<br/>output_image = "C:/Users/.../chart.png"</span></pre><p id="b09d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后使用以下方法访问电子表格:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="0d1b" class="lv lw it mu b gy my mz l na nb">operation = win32com.client.Dispatch("Excel.Application")<br/>operation.Visible = 0<br/>operation.DisplayAlerts = 0<br/>workbook_2 = operation.Workbooks.Open(input_file)<br/>sheet_2 = operation.Sheets(1)</span></pre><p id="882d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随后，您可以迭代电子表格中的所有图表对象(如果有多个图表对象),并将它们保存在指定位置，如下所示:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="bbe7" class="lv lw it mu b gy my mz l na nb">for x, chart in enumerate(sheet_2.Shapes):<br/>    chart.Copy()<br/>    image = ImageGrab.grabclipboard()<br/>    image.save(output_image, 'png')<br/>    pass</span><span id="a512" class="lv lw it mu b gy nc mz l na nb">workbook_2.Close(True)<br/>operation.Quit()</span></pre><h2 id="2c8d" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">Microsoft Word自动化</h2><p id="9f30" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">现在我们已经生成了图表图像，我们必须创建一个模板文档，它基本上是一个普通的Microsoft Word文档。docx)完全按照我们希望的方式来制定我们的报告，包括字体、字体大小、格式和页面结构。然后，我们需要做的就是为我们的自动化内容创建占位符，即表格值和图像，并用变量名声明它们，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/7de94933a150ca59fd940be5de2c4e3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Sck0Ac2qzGmWwiL5FepWA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Microsoft Word文档模板。图片由作者提供。</p></figure><p id="0279" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">任何自动化内容都可以在一对双花括号{{ <em class="ng"> variable_name </em> }}中声明，包括文本和图像。对于表，您需要创建一个包含所有列的带有模板行的表，然后您需要用下面的符号在上面和下面各添加一行:</p><p id="9297" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">第一排:</strong></p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="11b4" class="lv lw it mu b gy my mz l na nb">{%tr for item in <em class="ng">variable_name </em>%}</span></pre><p id="31fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">最后一排:</strong></p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="aaf7" class="lv lw it mu b gy my mz l na nb">{%tr endfor %}</span></pre><p id="ba7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上图中，变量名为</p><ul class=""><li id="bcbd" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated"><em class="ng"> table_contents </em>用于存储表格数据的Python字典</li><li id="aee7" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><em class="ng">字典关键字的索引</em>(第一列)</li><li id="725a" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><em class="ng">字典值的功率、电流和电压</em>(第二、第三和第四列)</li></ul><p id="be9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们将模板文档导入Python，并创建一个存储表值的字典:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="9650" class="lv lw it mu b gy my mz l na nb">template = DocxTemplate('template.docx')<br/>table_contents = []</span><span id="4b10" class="lv lw it mu b gy nc mz l na nb">for i in range(2, sheet_1.max_row + 1):<br/>    table_contents.append({<br/>        'Index': i-1,<br/>        'Power': sheet_1.cell(i, 1).value,<br/>        'Current': sheet_1.cell(i, 2).value,<br/>        'Voltage': sheet_1.cell(i, 3).value<br/>        })</span></pre><p id="86ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将导入之前由Excel生成的图表图像，并创建另一个字典来实例化模板文档中声明的所有占位符变量:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="04fc" class="lv lw it mu b gy my mz l na nb">image = InlineImage(template,'chart.png',Cm(10))</span><span id="69b5" class="lv lw it mu b gy nc mz l na nb">context = {<br/>    'title': 'Automated Report',<br/>    'day': datetime.datetime.now().strftime('%d'),<br/>    'month': datetime.datetime.now().strftime('%b'),<br/>    'year': datetime.datetime.now().strftime('%Y'),<br/>    'table_contents': table_contents,<br/>    'image': image<br/>    }</span></pre><p id="38ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们将呈现带有值表和图表图像的报告:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="3025" class="lv lw it mu b gy my mz l na nb">template.render(context)<br/>template.save('Automated_report.docx')</span></pre><h2 id="be19" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">结果</h2><p id="352a" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">这就是自动生成的Microsoft Word报表，其中包含在Microsoft Excel中创建的数字和图表。这样，您就有了一个完全自动化的管道，可以根据您的需要创建尽可能多的表格、图表和文档。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/54e72eaf477017c986e1fbc019faa0be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_b2o4o5fz1_aal5RLNtV2A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">自动生成的报告。图片由作者提供。</p></figure><h2 id="fb24" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">源代码</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="151b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想了解更多关于数据可视化和Python的知识，请随时查看以下(附属链接)课程:</p><h2 id="d771" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">使用Streamlit开发Web应用程序:</h2><div class="ny nz gp gr oa ob"><a href="https://www.amazon.com/Web-Application-Development-Streamlit-Applications/dp/1484281101?&amp;linkCode=ll1&amp;tag=mkhorasani09-20&amp;linkId=a0cb2bc17df598006fd9029c58792a6b&amp;language=en_US&amp;ref_=as_li_ss_tl" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">使用Streamlit开发Web应用程序:开发和部署安全且可伸缩的Web应用程序…</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">使用Streamlit开发Web应用程序:使用……开发安全且可扩展的Web应用程序并将其部署到云中</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">www.amazon.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op ks ob"/></div></div></a></div><h2 id="7177" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">使用Python实现数据可视化:</h2><div class="ny nz gp gr oa ob"><a href="https://www.coursera.org/learn/python-for-data-visualization?irclickid=xgMQ4KWb%3AxyIWO7Uo7Vva0OcUkGQgW2aEwvr1c0&amp;irgwc=1&amp;utm_medium=partners&amp;utm_source=impact&amp;utm_campaign=3308031&amp;utm_content=b2c" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">用Python实现数据可视化</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">“一图胜千言”。我们都熟悉这个表达。它尤其适用于试图…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">www.coursera.org</p></div></div><div class="ok l"><div class="oq l om on oo ok op ks ob"/></div></div></a></div><h2 id="ac9e" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">面向所有人的Python专业化:</h2><div class="ny nz gp gr oa ob"><a href="https://www.coursera.org/specializations/python?irclickid=xgMQ4KWb%3AxyIWO7Uo7Vva0OcUkGQgW16Ewvr1c0&amp;irgwc=1&amp;utm_medium=partners&amp;utm_source=impact&amp;utm_campaign=3308031&amp;utm_content=b2c" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">面向所有人的Python</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">学习用Python编程和分析数据。开发收集、清理、分析和可视化数据的程序…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">www.coursera.org</p></div></div><div class="ok l"><div class="or l om on oo ok op ks ob"/></div></div></a></div><h2 id="a899" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">GitHub资源库:</h2><div class="ny nz gp gr oa ob"><a href="https://github.com/mkhorasani/excel_word_automation" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">mkhorasani/excel _ word _ automation</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">集成Microsoft Excel和Word，无缝生成自动化报告</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">github.com</p></div></div><div class="ok l"><div class="os l om on oo ok op ks ob"/></div></div></a></div></div><div class="ab cl ot ou hx ov" role="separator"><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy"/></div><div class="im in io ip iq"><h1 id="d72d" class="pa lw it bd lx pb pc pd ma pe pf pg md jz ph ka mg kc pi kd mj kf pj kg mm pk bi translated">☕喜欢这个教程？在这里随意给我捐一杯咖啡<a class="ae ky" href="https://www.paypal.com/paypalme/dummylearn" rel="noopener ugc nofollow" target="_blank">。</a></h1><h1 id="a5a7" class="pa lw it bd lx pb pl pd ma pe pm pg md jz pn ka mg kc po kd mj kf pp kg mm pk bi translated">新到中？您可以在此订阅并解锁无限文章<a class="ae ky" href="https://khorasani.medium.com/membership" rel="noopener">。</a></h1></div></div>    
</body>
</html>