<html>
<head>
<title>Machine Learning with Docker and Kubernetes: Batch Inference</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Docker和Kubernetes的机器学习:批量推理</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/machine-learning-with-docker-and-kubernetes-batch-inference-4a25328f23c7?source=collection_archive---------17-----------------------#2021-05-21">https://towardsdatascience.com/machine-learning-with-docker-and-kubernetes-batch-inference-4a25328f23c7?source=collection_archive---------17-----------------------#2021-05-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="10c2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Kubernetes、Docker、Python和Scikit——学习机器和深度学习:如何扩展数据科学家的工作</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e1f33225e5f6f1f0c3499352144f5fc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4fcYuWfjsNmI5lMTVOcsfw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Annamária Borsos摄影</p></figure><p id="a919" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这一章中，我们将从我们在前一章中开发和安装的Kubernetes集群中的训练模型中实现一个批量推理:<a class="ae lr" href="https://xaviervasques.medium.com/machine-learning-with-docker-and-kubernetes-training-models-cbe33a08c999" rel="noopener">https://xaviervasques . medium . com/machine-learning-with-docker-and-Kubernetes-training-models-CBE 33 a 08 c 999</a></p><p id="a66b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你可以在<a class="ae lr" href="https://github.com/xaviervasques/kubernetes.git" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到本章用到的所有文件。</p><p id="8e4f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了开始，我们需要对之前的<strong class="kx ir">文档</strong>进行如下修改:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="49ca" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">与之前的<strong class="kx ir"> Dockerfile </strong>相比，我们只是增加了<strong class="kx ir"> inference.py </strong>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="889a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<strong class="kx ir"> inference.py </strong>中，我们开始导入必要的库，读取Docker映像中设置的环境变量，并读取存储在<a class="ae lr" href="https://raw.githubusercontent.com/xaviervasques/kubernetes/main/test.csv" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上的新数据(test.csv ),以便为我们的序列化模型提供预测并提供准确度分数。这里，我们将使用SSH从远程服务器(192.168.1.11)下载存储在指定目录(/home/xavi/output)中的先前训练的模型(线性判别分析和一个多层感知器神经网络)。</p><p id="0a4c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，我们可以进入下一步，构建docker映像，运行它以在本地测试我们的应用程序，在Docker Hub注册表上用映像存储库的名称标记它，并将其推送到注册表，准备在我们的Kubernetes集群中使用该映像:</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="72e9" class="lz ma iq lv b gy mb mc l md me">docker build -t kubernetes-inference -f Dockerfile .</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mf"><img src="../Images/9d0d443c319c8188886eefd891d8a669.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ryKaqTH5CiHPg44anEXheQ.png"/></div></div></figure><p id="afec" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了测试我们的代码是否正常，我们将在本地运行我们的容器来测试图像:</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="0826" class="lz ma iq lv b gy mb mc l md me">docker run kubernetes-inference python3 train.py rm ./id_rsa</span></pre><p id="7070" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果一切正常，我们可以使用CLI将新映像推送到存储库:</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="dee9" class="lz ma iq lv b gy mb mc l md me">docker login</span><span id="a6cc" class="lz ma iq lv b gy mg mc l md me">docker tag kubernetes-inference:latest xaviervasques/kubernetes-inference:latest</span><span id="fd9e" class="lz ma iq lv b gy mg mc l md me">docker push xaviervasques/kubernetes-inference:latest</span></pre><h1 id="7376" class="mh ma iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">为Kubernetes创建配置文件</h1><p id="8f09" class="pw-post-body-paragraph kv kw iq kx b ky my jr la lb mz ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">一旦图像成功上传到注册表，我们就转到我们的项目目录(连接到kubmaster)并创建一个配置文件<strong class="kx ir"> inference.yaml </strong>，它执行我们的python代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="3495" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">等效的docker命令应该是:</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="fc85" class="lz ma iq lv b gy mb mc l md me">docker run kubernetes-inference python3 inference.py rm ./id_rsa</span></pre><p id="642a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们终于准备好让我们的应用程序在Kubernetes上运行了。启动以下命令:</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="8fae" class="lz ma iq lv b gy mb mc l md me">kubectl create -f inference.yaml</span></pre><p id="41d5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通过运行以下命令检查作业对象:</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="7508" class="lz ma iq lv b gy mb mc l md me">kubectl get jobs</span><span id="df95" class="lz ma iq lv b gy mg mc l md me">kubectl get pods — selector=job-name=inference-job</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mf"><img src="../Images/733df19f2f8cd5a25b52d404943c5cc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c5Emn6JJPVWkJpsp-YLrGA.png"/></div></div></figure><p id="ad10" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以查看流程的日志(我们代码的输出):</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="b7fd" class="lz ma iq lv b gy mb mc l md me">kubectl logs inference-job-stskf</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mf"><img src="../Images/c644910aa85dbabad74bb2a68d780c08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u35UOr7wWhJmQs93XG4r-g.png"/></div></div></figure><h1 id="c649" class="mh ma iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">后续步骤</h1><p id="7d4c" class="pw-post-body-paragraph kv kw iq kx b ky my jr la lb mz ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">Kubernetes是一个有效部署模型的优秀框架。我们可以使用Kubernetes将我们的每个模型部署为独立的轻量级微服务。这些微服务可以用于其他应用。我们还可以与Kubernetes合作，安排我们的训练和推理过程定期运行。现在，下一步将是使用REST APIs部署在线推理。您可以在这里找到使用REST APIs的在线推理的部署示例:</p><div class="nd ne gp gr nf ng"><a href="https://xaviervasques.medium.com/machine-learning-prediction-in-real-time-using-docker-python-rest-apis-with-flask-and-kubernetes-fae08cd42e67" rel="noopener follow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">使用Docker、Python Rest APIs和Flask和Kubernetes进行实时机器学习预测…</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">用于机器和深度学习的Kubernetes、Docker、Python、Scikit-Learn和Flask:如何扩展数据科学家的工作</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">xaviervasques.medium.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu kp ng"/></div></div></a></div></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><p id="7fd9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">来源</strong></p><p id="2702" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae lr" href="https://developer.ibm.com/technologies/containers/tutorials/scalable-python-app-with-kubernetes/" rel="noopener ugc nofollow" target="_blank">https://developer . IBM . com/technologies/containers/tutorials/scalable-python-app-with-kubernetes/</a></p><p id="ee22" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">【https://mlinproduction.com/k8s-jobs/ T4】</p></div></div>    
</body>
</html>