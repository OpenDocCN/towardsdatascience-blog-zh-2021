<html>
<head>
<title>Create a fully fledged, professional API with Flask in Python — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python中的Flask创建一个成熟、专业的API第1部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/create-a-fully-fledged-professional-api-with-flask-in-python-part-1-1c94f732e584?source=collection_archive---------20-----------------------#2021-05-18">https://towardsdatascience.com/create-a-fully-fledged-professional-api-with-flask-in-python-part-1-1c94f732e584?source=collection_archive---------20-----------------------#2021-05-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8e06" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">专业且安全地允许访问您的Python程序-通过6个简单的步骤设置基础</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d1e92e4a5b045d0f770dde69f65f8d9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rEHFWBS_hzIcc-ld-EwSFA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的API正在愉快地连接我们的服务(图片由<a class="ae ky" href="https://www.pexels.com/@steve" rel="noopener ugc nofollow" target="_blank"> Steven Johnson </a>在<a class="ae ky" href="https://www.pexels.com/photo/four-white-travel-adapters-1694830/" rel="noopener ugc nofollow" target="_blank"> Pexels </a>上提供)</p></figure><p id="5497" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没有API的应用程序就像没有服务员的餐馆。在餐馆里，你不需要和厨房沟通，也不需要等着点菜来享用美食。同样的，一个网站不需要知道如何与你的数据库通信。像一个服务员一样，我们的API从我们的网站收到一个命令:“我想要一些带有元数据的用户统计数据”。API随后检查订单(是否允许您拥有该数据？)，说服我们的数据库(厨师)为他烹制一些美味的信息，等待数据库完成，最后将数据返回到网站。</p><h1 id="69d6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">为什么需要API呢？</h1><p id="8c97" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">API允许两个(或更多)服务以一种分离的方式相互通信。最常见的例子是处理网站和数据库之间通信的API。它提供访问、便利、安全和额外的功能。让我们来看一下每个要点的简短示例。</p><h2 id="bfb4" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">1.接近</h2><p id="14df" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">假设您创建了一个名为pixelcounter.py的Python程序，它读取一个图像文件并计算像素数。当你把你的图像文件放在USB上的时候，走到装有pixelcounter.py的电脑前，把图像放在电脑上，然后把它加载到pixelcounter.py中，最后开始计数。<br/>这行得通，唯一的问题是:我们是程序员。我们没有时间把东西放到u盘上，更不用说走到咖啡机以外的地方了！一个好的解决方案是将API和pixelcounter.py放在服务器上。这样，人们可以发送图像进行统计..轻松点。</p><h2 id="b39f" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">2.便利</h2><p id="e3d8" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">API也提供了很多便利。为了发送电子邮件，只需将收件人、主题和消息发送到API。如果您可以将数据发送给API，那么您不需要理解和SMTP是如何工作的。</p><h2 id="bf3d" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">3.额外功能</h2><p id="0b0e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">使用API还可以提供额外的功能。例如，您可以计算哪个用户请求了哪些数据。这样你可以限制使用，检查人们最感兴趣的功能，哪些功能根本不会被使用，或者按请求向用户收费。</p><h2 id="d6c0" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">4.安全性</h2><p id="0338" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">API允许两个程序以安全的方式相互通信。像脸书这样的网站要检索你的朋友，需要从数据库中获取数据。你不希望另一个人得到你的个人资料。这就是API的用武之地；它检查是谁发出的请求，以及这个人是否被允许获取数据。</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="9b73" class="lv lw it bd lx ly nl ma mb mc nm me mf jz nn ka mh kc no kd mj kf np kg ml mm bi translated">如何创建一个API？</h1><p id="0bef" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在这篇文章中，我们将开始创建一个API，它将允许我们做上面描述的所有事情。在这一部分中，我们将着重于设置我们的项目，获得一些基本的功能和测试我们的路线。如果您看到任何您不熟悉的术语，请查看本页底部的词汇表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/02788c247233e1e4e3e7f672f02dda22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bkmNveYebI31zIgx"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">让我们连接我们的服务！(图片由<a class="ae ky" href="https://www.pexels.com/photo/close-up-of-telephone-booth-257736/" rel="noopener ugc nofollow" target="_blank">像素</a>上的<a class="ae ky" href="https://www.pexels.com/@pixabay" rel="noopener ugc nofollow" target="_blank">像素</a>生成)</p></figure><p id="40f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">按照这些步骤创建一个包含所有必需依赖项的项目，然后我们将创建一个控制器来处理路由上的请求。</p><h2 id="c19a" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">第一步。创建您的python项目</h2><p id="0d20" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">创建您的根文件夹:将包含项目的文件夹。在这个例子中，我们将使用<code class="fe nr ns nt nu b">c:/my_root_folder</code></p><h2 id="52fc" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">步骤1.1(可选)创建虚拟环境</h2><p id="cfd3" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">创建虚拟环境可以帮助您将已安装的软件包保持在一个整洁的包中。本文 中<a class="ae ky" href="https://mikehuls.medium.com/virtual-environments-for-absolute-beginners-what-is-it-and-how-to-create-one-examples-a48da8982d4b" rel="noopener"> <strong class="lb iu">关于理解和创建venvs的更多信息。以下是本项目的操作方法:</strong></a></p><p id="e64b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导航到您的根文件夹并执行这段代码。<br/> <code class="fe nr ns nt nu b">python -m venv c:/my_root_folder/venv</code> <br/>这将创建一个文件夹来存放你所有已安装的软件包。不要忘记:</p><ul class=""><li id="02ba" class="nv nw it lb b lc ld lf lg li nx lm ny lq nz lu oa ob oc od bi translated">通过导航到<code class="fe nr ns nt nu b">c:/my_root_folder/venv/scripts</code>并执行<code class="fe nr ns nt nu b">activate</code>，在安装包之前激活您的环境。现在您处于您的环境中，可以在这里安装软件包了</li><li id="7513" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">通过调用<code class="fe nr ns nt nu b">c:/my_root_folder/venv/Scripts/python.exe</code>来执行你的脚本。我们稍后会更深入地讨论它</li></ul><h2 id="788c" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">第二步。安装依赖项</h2><p id="f28f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们需要两个包，所以我们需要安装Flask和flask-restful。<code class="fe nr ns nt nu b">pip install Flask flask-restful</code></p><h2 id="1067" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">第三步。构建您的项目</h2><p id="4a33" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">下一步:创建一些文件夹，我们可以把我们的te API的不同部分，即我们的配置，路线和控制器:<br/> <code class="fe nr ns nt nu b">mkdir config routes controllers</code></p><h2 id="5da8" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">第四步。创建API</h2><p id="9e9f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们的项目已经建立，是时候构建我们的API了！在我们的根文件夹中创建一个名为main.py的文件，并赋予它以下内容</p><pre class="kj kk kl km gt oj nu ok ol aw om bi"><span id="4a19" class="ms lw it nu b gy on oo l op oq">from flask import Flask<br/>from flask_restful import Api</span><span id="89ee" class="ms lw it nu b gy or oo l op oq">app = Flask(__name__)<br/>api = Api(app)</span><span id="1583" class="ms lw it nu b gy or oo l op oq">if __name__ == "__main__":<br/>    # start up api<br/>    app.run(port=5000, debug=True)</span></pre><p id="bd62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里发生了什么事？:<br/>这个脚本导入所有需要的包，并实例化一个app和api。然后，它在本地主机端口5000上运行应用程序。执行您的脚本:<br/> <code class="fe nr ns nt nu b">c:/my_root_folder/venv/Scripts/python.exe c:/my_root_folder/main.py`</code> <br/>您会注意到您的脚本正在运行，但没有停止。我们创建的服务器持续监听请求。让我们给它点东西听。</p><h2 id="75dd" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">第五步。创建路线和控制器</h2><p id="7fb5" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们希望转到localhost:5000/test，并让API在我们导航到该页面或向该位置发布内容时执行一些操作。为了做到这一点，我们需要我们的API来监听一个路由，即<strong class="lb iu"> /test </strong>。</p><pre class="kj kk kl km gt oj nu ok ol aw om bi"><span id="7e77" class="ms lw it nu b gy on oo l op oq">from flask import Flask<br/>from flask_restful import Api<br/>from controllers.testController import TestController</span><span id="5aa8" class="ms lw it nu b gy or oo l op oq">app = Flask(__name__)<br/>api = Api(app)<br/>api.add_resource(TestController, '/test')</span><span id="7a74" class="ms lw it nu b gy or oo l op oq">if __name__ == "__main__":<br/>    # start up api<br/>    app.run(port=5000, debug=True)</span></pre><p id="6c21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码与第一段代码几乎相同。如你所见，听路线很容易。这发生在第7行:<code class="fe nr ns nt nu b">api.add_resource(TestController, ‘/test’)</code> <br/>它在<strong class="lb iu"> /test </strong>监听请求，并将请求传递给我们的TestController，这是我们在第3行导入的一个类。让我们创建这个控制器。用这个内容创建<code class="fe nr ns nt nu b">c:/my_root_folder/controllers/testController.py</code>:</p><pre class="kj kk kl km gt oj nu ok ol aw om bi"><span id="ad36" class="ms lw it nu b gy on oo l op oq">from flask_restful import Resource, request</span><span id="a26f" class="ms lw it nu b gy or oo l op oq">class TestController(Resource):<br/>    def get(self):<br/>        return {<br/>            "message": "get: hello from the testcontroller"<br/>        }</span></pre><p id="a399" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从API请求数据有多种方式。您可以发送GET请求或POST请求。GET用于检索数据，比如检索我的个人资料图片。POST请求用于提交数据，如提交评论。还有更多的类型，我们将在下一部分讨论。首先让我们测试一个简单的API。</p><p id="ef4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的TestController实现了一个get方法，该方法处理传递给控制器的get请求。现在我们只返回一条简单的消息。</p><h2 id="a33c" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">第六步。测试</h2><p id="1714" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">打开浏览器并导航到localhost:5000/test。如果一切顺利，您将看到我们在控制器中定义的消息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/a729496de56970a0512e2f34ef41abe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7-TfhQlUbo9deWzv"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">假设这个服务员是我们的API，为我们提供一些数据(图片由<a class="ae ky" href="https://www.pexels.com/@pixabay" rel="noopener ugc nofollow" target="_blank">pix abay</a>on<a class="ae ky" href="https://www.pexels.com/photo/blur-breakfast-chef-cooking-262978/" rel="noopener ugc nofollow" target="_blank">Pexels</a>提供)</p></figure><h1 id="f051" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="e121" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">祝贺你创建了你的第一个API！我们的新API已经启动并运行，但是它很笨。在下一部分中，我们将实现更多的功能，比如不同类型的请求、使用JSON web令牌的安全性以及到数据库的连接。<a class="ae ky" href="https://mikehuls.medium.com" rel="noopener">关注我</a>敬请关注！</p><p id="67d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">—迈克</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="7e6a" class="lv lw it bd lx ly nl ma mb mc nm me mf jz nn ka mh kc no kd mj kf np kg ml mm bi translated">词汇表</h1><p id="b578" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">一些术语，解释</p><ul class=""><li id="edde" class="nv nw it lb b lc ld lf lg li nx lm ny lq nz lu oa ob oc od bi translated"><strong class="lb iu"> API </strong> =应用编程接口。允许您连接两个程序</li><li id="fbaf" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">发送给API的命令。你在请求它做些什么</li><li id="f5da" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated"><strong class="lb iu">响应=</strong>API返回的东西；数据、错误或状态</li><li id="c8a1" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">某网站上的一条路径。是【www.medium.com】<strong class="lb iu">/@ Mike huls</strong><strong class="lb iu">T9】或<a class="ae ky" href="http://www.medium.com/@mikehuls" rel="noopener">test.com<strong class="lb iu">/this/is/a/path</strong></a>中的<strong class="lb iu">加粗</strong>部分</strong></li><li id="f35b" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated"><strong class="lb iu">状态代码= </strong>代表api状态的代码。大家都听说过404:没找到！</li></ul></div></div>    
</body>
</html>