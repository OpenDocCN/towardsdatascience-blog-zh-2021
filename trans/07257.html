<html>
<head>
<title>Query Salesforce Data in Python using intake-salesforce</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用intake-salesforce在Python中查询Salesforce数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/query-salesforce-data-in-python-using-intake-salesforce-b80c7a714943?source=collection_archive---------32-----------------------#2021-07-01">https://towardsdatascience.com/query-salesforce-data-in-python-using-intake-salesforce-b80c7a714943?source=collection_archive---------32-----------------------#2021-07-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c7a0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">【salesforce的进气驱动</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/74bf1ce291710a7eb31b6b5fdb33beef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*73_StuTWUI5j6N4-0UusJw.jpeg"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated"><a class="ae kz" href="https://unsplash.com/@jackward?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">杰克·沃德</a>在<a class="ae kz" href="https://unsplash.com/@jackward?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="28ce" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Salesforce数据库可能非常混乱。下图说明了Salesforce中一些数据表之间的关系。如您所见，数据表(即对象)之间的关系可能很复杂，很难处理。我之前写过一篇关于如何通过Python API simple-salesforce使用<a class="ae kz" href="https://developer.salesforce.com/docs/atlas.en-us.soql_sosl.meta/soql_sosl/sforce_api_calls_soql.htm" rel="noopener ugc nofollow" target="_blank"> Salesforce对象查询语言(SOQL) </a>理解和查询Salesforce数据的<a class="ae kz" href="https://medium.com/swlh/query-salesforce-data-in-python-e290a00e3cba" rel="noopener">博文。Salesforce对象查询语言(SOQL)是一种类似SQL的语言，专门为Salesforce中的关系数据设计，对于不熟悉Salesforce数据库的人来说，它不是最容易理解和编写的。因此，我编写了一个导入驱动程序来加载Salesforce数据，以帮助人们方便地查询Salesforce数据。</a></p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi lw"><img src="../Images/0776c6f71c8d64d99e7be1947ae41a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wUiVyMbqkPPL9xlo.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">作者创造的形象</p></figure><h1 id="2184" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">什么是摄入？</h1><p id="70ec" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">Intake是Anaconda在2018年开发的。这是一个轻量级的数据目录和数据访问库。它帮助用户更有效地访问数据和共享数据。具体来说，Intake具有以下关键特征，这些特征令数据科学家们趋之若鹜:</p><ul class=""><li id="245e" class="mu mv it lc b ld le lg lh lj mw ln mx lr my lv mz na nb nc bi translated">摄入加载来自各种数据源的数据，并在摄入目录中提供您的数据的描述。</li><li id="6d82" class="mu mv it lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">缓存有助于更快地加载数据。</li><li id="3f30" class="mu mv it lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">Intake允许用户轻松创建数据包。</li><li id="1d01" class="mu mv it lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">图形界面有助于轻松浏览数据。</li><li id="466e" class="mu mv it lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">Intake从各种数据格式加载数据，并允许用户为新的文件格式创建插件/驱动程序。</li><li id="3cec" class="mu mv it lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">入口生态系统目前包括30多个<a class="ae kz" href="https://intake.readthedocs.io/en/latest/plugin-directory.html" rel="noopener ugc nofollow" target="_blank">入口驱动</a>，帮助用户使用统一的API加载来自不同来源的数据。</li></ul><p id="e9db" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">关于如何使用进气的更多信息可在<a class="ae kz" href="https://intake.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">进气文件</a>中找到。</p><h1 id="08fb" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">如何使用intake-salesforce？</h1><p id="d1c8" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">在我们开始了解intake-salesforce之前，我们需要获得一些salesforce凭据信息:</p><ul class=""><li id="cbd9" class="mu mv it lc b ld le lg lh lj mw ln mx lr my lv mz na nb nc bi translated">用户名</li><li id="a71e" class="mu mv it lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">密码</li><li id="ae6a" class="mu mv it lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">安全令牌:可在“设置—个人—重置我的安全令牌”下找到</li><li id="339e" class="mu mv it lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">实例:您的公司名称. lightning.force.com</li></ul><p id="2bdd" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">要安装intake-salesforce，请运行以下程序</p><pre class="kk kl km kn gt ni nj nk nl aw nm bi"><span id="dff1" class="nn ly it nj b gy no np l nq nr">conda install intake-salesforce -c conda-forge</span></pre><p id="14cc" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">或者<code class="fe ns nt nu nj b">pip install intake-salesforce</code></p><p id="f830" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了在Salesforce中获得表的目录，我们使用了<code class="fe ns nt nu nj b">intake.open_salesforce_catalog</code>方法:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nv"><img src="../Images/c4011e804f48596320f96b40eb9a5db9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*b9xM6NLloHbC9Ynh.png"/></div></div></figure><p id="5edb" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在我们有一个包含1003个表的列表，我们可以使用<code class="fe ns nt nu nj b">catalog.TABLE_NAME.read()</code>读取这些表，并在内存中返回Pandas数据帧。例如，让我们读入“账户”表(非真实数据):</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nw"><img src="../Images/1d2a34588e83c9c798342c011ad9a402.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*77cSqHesek1hhqbZ.png"/></div></div></figure><p id="f1a9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">帐户表中有48列。请注意，以__c结尾的列名都是Salesforce中的自定义对象，这意味着在这种情况下，我们的Salesforce管理员在帐户表对象中创建了一个名为“ARR__c”的变量对象。</p><p id="6e6b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">类似地，我们可以读入其他表(例如Opportunity)并将Account表与Opportunity表合并(同样，下面显示的不是真实数据)。为了明确哪些变量属于哪个表，我在帐户变量前面加了“acc_ ”,在机会变量前面加了“opp_”。这里我们看到合并后的表有90列。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nx"><img src="../Images/3affb569bfdd63c8c61479b7ea7ca518.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HoZdfoEJVvdEcj6W.png"/></div></div></figure><h1 id="b9b5" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">把所有东西放在一起</h1><p id="e61d" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">我们如何以一致的方式从各种来源加载数据？我们将展示一个加载本地。csv文件、存储在AWS上的一组拼花文件和Salesforce数据。</p><p id="d700" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Intake的关键特性和概念是目录文件，它是“一个YAML规范文件，包含一个描述如何加载数据源的命名条目列表”(https://Intake . readthedocs . io/en/latest/catalog . html)。在下面的“load_data.yaml”示例中，我们定义了三个数据源:example_csv_data、example_s3_data和salesforce_catalog。在每个数据源下，我们列出了它的引入驱动因素、参数和其他信息。请注意，我们将所有数据加载为Pandas数据帧，其他数据类型和分区/并行访问也可以使用Intake。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="b7be" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">要从这三个数据源加载数据，我们只需打开这个yaml文件作为目录<code class="fe ns nt nu nj b">cat</code>，并按如下方式读入数据:</p><ul class=""><li id="3e57" class="mu mv it lc b ld le lg lh lj mw ln mx lr my lv mz na nb nc bi translated">阅读。csv文件:<code class="fe ns nt nu nj b">cat.example_csv_data.read()</code></li><li id="967a" class="mu mv it lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">阅读。拼花文件:<code class="fe ns nt nu nj b">cat.example_s3_data(year=xxx, month=xxx).read() </code>。注意，我们首先需要<code class="fe ns nt nu nj b">conda install intake-parquet s3fs python-snappy</code>,还要注意，我们能够将参数作为参数传入。</li><li id="8610" class="mu mv it lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">读取Salesforce数据:<code class="fe ns nt nu nj b">cat.salesforce_catalog</code>显示Salesforce表的列表和指定表中的<code class="fe ns nt nu nj b">cat.salesforce_catalog.TABLE_NAME.read()</code>读取。</li></ul><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oa"><img src="../Images/f427e44f8332021baa4b0bae54e55551.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4c-iP6vBcPwPGeKt.png"/></div></div></figure><p id="779e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">总之，intake-salesforce为用户提供了一种在salesforce中查看表格目录和读取特定数据表(如Pandas dataframes)的简单方法。摄入目录允许用户一致地从各种来源加载数据。希望你喜欢使用摄入和摄入销售力量。谢谢！</p><p id="4d97" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">鸣谢:特别感谢Martin Durant、Albert DeFusco和Stan Seibert在开发intake-Salesforce和撰写本文时提供的指导和反馈。</p><h1 id="11bf" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">参考资料:</h1><p id="4f65" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated"><a class="ae kz" href="https://intake.readthedocs.io/" rel="noopener ugc nofollow" target="_blank">https://intake.readthedocs.io/</a><a class="ae kz" href="https://www.anaconda.com/intake-taking-the-pain-out-of-data-access/" rel="noopener ugc nofollow" target="_blank">https://www . anaconda . com/intake-taking-the-pain-out-of-data-access/</a><a class="ae kz" href="https://martindurant.github.io/blog/flurry-of-drivers/" rel="noopener ugc nofollow" target="_blank">https://martindurant.github.io/blog/flurry-of-drivers/</a><a class="ae kz" href="https://medium.com/swlh/query-salesforce-data-in-python-e290a00e3cba" rel="noopener">https://medium . com/swlh/query-sales force-data-in-python-e 290 a 00 E3 CBA</a><a class="ae kz" href="https://developer.salesforce.com/docs/atlas.en-us.soql_sosl.meta/soql_sosl/sforce_api_calls_soql.htm" rel="noopener ugc nofollow" target="_blank">https://developer . sales force . com/docs/atlas . en-us . soql _ sosl . meta/soql _ sosl/sforce _ API _ calls _ calls</a></p><p id="eb20" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">作者索菲亚·杨2021年7月1日</p></div></div>    
</body>
</html>