<html>
<head>
<title>Automating Forms Submissions with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python自动提交表单</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automating-submission-forms-with-python-94459353b03e?source=collection_archive---------3-----------------------#2021-07-29">https://towardsdatascience.com/automating-submission-forms-with-python-94459353b03e?source=collection_archive---------3-----------------------#2021-07-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/6f2f504a4597a6f8f3591b6aed8c2c98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WBW_6ahyvgi08Jyx"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@glenncarstenspeters?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">格伦·卡斯滕斯-彼得斯</a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><div class=""/><div class=""><h2 id="7653" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">永远不要再填写提交表单</h2></div><h1 id="f5a0" class="ky kz jj bd la lb lc ld le lf lg lh li kp lj kq lk ks ll kt lm kv ln kw lo lp bi translated">不用再填表格了</h1><p id="05de" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">填写在线表格很烦人。然而，许多从事案头工作的人有时仍然不得不花相当多的时间填写在线表格。那么，为什么不使用Python来自动化这个过程并节省一些宝贵的时间呢？</p><p id="bc82" class="pw-post-body-paragraph lq lr jj ls b lt mm kk lv lw mn kn ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">在本文中，我将向您展示如何使用Python来自动化填写提交表单的过程。T11】</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><p id="5c74" class="pw-post-body-paragraph lq lr jj ls b lt mm kk lv lw mn kn ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">如果你喜欢视频，请点击这里查看我的Youtube视频:</p><figure class="mz na nb nc gt iv"><div class="bz fp l di"><div class="nd ne l"/></div></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h2 id="1c97" class="nf kz jj bd la ng nh dn le ni nj dp li lz nk nl lk md nm nn lm mh no np lo nq bi translated">台阶</h2><p id="45a2" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">对于这个例子，我将创建一个简单的google forms调查，然后我将检查它以收集执行自动化所需的必要web元素。</p><p id="6ddb" class="pw-post-body-paragraph lq lr jj ls b lt mm kk lv lw mn kn ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">总体步骤将是:</p><ol class=""><li id="d6de" class="nr ns jj ls b lt mm lw mn lz nt md nu mh nv ml nw nx ny nz bi translated"><strong class="ls jk">将您的答案设置为. csv文件</strong></li><li id="1306" class="nr ns jj ls b lt oa lw ob lz oc md od mh oe ml nw nx ny nz bi translated"><strong class="ls jk">根据输入类型检查必要的网页元素</strong></li><li id="7a40" class="nr ns jj ls b lt oa lw ob lz oc md od mh oe ml nw nx ny nz bi translated"><strong class="ls jk">设置网址和浏览器</strong></li><li id="a068" class="nr ns jj ls b lt oa lw ob lz oc md od mh oe ml nw nx ny nz bi translated"><strong class="ls jk">访问网址</strong></li><li id="0478" class="nr ns jj ls b lt oa lw ob lz oc md od mh oe ml nw nx ny nz bi translated"><strong class="ls jk">发送基于文本输入的按键</strong></li><li id="e6f2" class="nr ns jj ls b lt oa lw ob lz oc md od mh oe ml nw nx ny nz bi translated"><strong class="ls jk">发送复选框类型输入的点击</strong></li><li id="798c" class="nr ns jj ls b lt oa lw ob lz oc md od mh oe ml nw nx ny nz bi translated"><strong class="ls jk">访问并点击提交按钮完成</strong></li><li id="1360" class="nr ns jj ls b lt oa lw ob lz oc md od mh oe ml nw nx ny nz bi translated"><strong class="ls jk">循环访问数据库并为每个用户提交答案</strong></li></ol></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h2 id="3082" class="nf kz jj bd la ng nh dn le ni nj dp li lz nk nl lk md nm nn lm mh no np lo nq bi translated">1.将您的答案设置为. csv文件</h2><p id="a9af" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">为了简单起见，我在google forms上创建的表单由三个简单的问题组成:</p><ol class=""><li id="0ada" class="nr ns jj ls b lt mm lw mn lz nt md nu mh nv ml nw nx ny nz bi translated">你叫什么名字？</li><li id="ee7b" class="nr ns jj ls b lt oa lw ob lz oc md od mh oe ml nw nx ny nz bi translated">你多大了？</li><li id="4285" class="nr ns jj ls b lt oa lw ob lz oc md od mh oe ml nw nx ny nz bi translated">你最喜欢什么颜色？</li></ol><p id="9bfe" class="pw-post-body-paragraph lq lr jj ls b lt mm kk lv lw mn kn ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">我知道我知道…非常原始，但这只是为了演示的目的，所以对我来说是赤裸裸的。实际的形式如下所示:</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div class="ab gu cl of"><img src="../Images/2f45b8b57ea8e9e97d34d428b5d8ea0a.png" data-original-src="https://miro.medium.com/v2/format:webp/1*x_VAS0GZgdt71_3ctMjh-A.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</p></figure><p id="37d7" class="pw-post-body-paragraph lq lr jj ls b lt mm kk lv lw mn kn ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">现在，让我们建立一个. csv文件来存储我们的答案。我将使用<code class="fe og oh oi oj b">faker</code>库、<code class="fe og oh oi oj b">numpy.rando.randint()</code>方法和熊猫来模拟一个简单的名字、年龄和颜色选择的数据库，作为最终的数据帧。</p><pre class="mz na nb nc gt ok oj ol om aw on bi"><span id="1ef6" class="nf kz jj oj b gy oo op l oq or">from selenium import webdriver<br/>import pandas as pd<br/>import time<br/>import json<br/>from datetime import datetime<br/>import pathlib<br/>import glob<br/>import sys<br/>sys.path.append(".")<br/>import faker<br/>import numpy as np<br/>import pandas as pd<br/><br/>f = faker.Faker()<br/>colors = ["Blue","Pink","Black","White","Green"]<br/><br/>names = [f.name() for _ in range(100)]<br/>ages =  [np.random.randint(18,65) for _ in range(100)]<br/>color_choices = [np.random.choice(colors,1)[0] for _ in range(100)]<br/><br/>database = pd.DataFrame(dict(names=names, ages=ages, colors = color_choices))<br/>database.to_csv("submission_form_database.csv", index=False)<br/>database.head()</span></pre><figure class="mz na nb nc gt iv gh gi paragraph-image"><div class="ab gu cl of"><img src="../Images/24e67a5436892dc68d2f399ed99396c4.png" data-original-src="https://miro.medium.com/v2/format:webp/1*B1OOwAKr8QUiDT9gWTkhBg.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</p></figure><p id="2c4c" class="pw-post-body-paragraph lq lr jj ls b lt mm kk lv lw mn kn ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">完美！现在我们有了数据库，让我们设置浏览器自动化。</p><h2 id="ca51" class="nf kz jj bd la ng nh dn le ni nj dp li lz nk nl lk md nm nn lm mh no np lo nq bi translated">2.根据输入类型检查必要的web元素</h2><p id="1146" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">现在，我只需进入我的google表单的预览链接，或真实案例调查的实际网址，并根据输入类型收集不同问题的类别名称。</p><p id="fca8" class="pw-post-body-paragraph lq lr jj ls b lt mm kk lv lw mn kn ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">在这种情况下，我有三个问题，其中两个是基于文本的，一个是多选的，所以我通过按下<code class="fe og oh oi oj b">CTRL+Shift+I</code>检查问题中的每个元素，如果你在chrome中，然后转到:<code class="fe og oh oi oj b">copy -&gt; copy element</code>，在那里我复制每个问题的元素，看起来应该是这样的:</p><ul class=""><li id="4e95" class="nr ns jj ls b lt mm lw mn lz nt md nu mh nv ml os nx ny nz bi translated">问题1和2的Web元素:<code class="fe og oh oi oj b">&lt;input type="text" class="quantumWizTextinputPaperinputInput exportInput" jsname="YPqjbf" autocomplete="off" tabindex="0" aria-labelledby="i1" aria-describedby="i2 i3" required="" dir="auto" data-initial-dir="auto" data-initial-value=""&gt;</code></li><li id="5b53" class="nr ns jj ls b lt oa lw ob lz oc md od mh oe ml os nx ny nz bi translated">问题3的Web元素(多选)<code class="fe og oh oi oj b">&lt;div class="appsMaterialWizToggleRadiogroupOffRadio exportOuterCircle"&gt;&lt;div class="appsMaterialWizToggleRadiogroupOnRadio exportInnerCircle"&gt;&lt;/div&gt;&lt;/div&gt;</code></li></ul><p id="463b" class="pw-post-body-paragraph lq lr jj ls b lt mm kk lv lw mn kn ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">现在，我只是复制每种类型的类名，并把它和提交按钮的<code class="fe og oh oi oj b">xpath</code>一起设置为两个不同的变量:</p><pre class="mz na nb nc gt ok oj ol om aw on bi"><span id="075d" class="nf kz jj oj b gy oo op l oq or">text_question_element_class = "quantumWizTextinputPaperinputInput"<br/>checkbox_question_element_class = "appsMaterialWizToggleRadiogroupOffRadio"<br/>submit_element_class = '//*[@id="mG61Hd"]/div[2]/div/div[3]/div[1]/div/div/span/span'</span></pre><p id="2da3" class="pw-post-body-paragraph lq lr jj ls b lt mm kk lv lw mn kn ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">太好了，现在我们已经为自动化部分做好了准备！</p><h2 id="ff83" class="nf kz jj bd la ng nh dn le ni nj dp li lz nk nl lk md nm nn lm mh no np lo nq bi translated">3.<strong class="ak">设置网址和浏览器</strong></h2><pre class="mz na nb nc gt ok oj ol om aw on bi"><span id="cca0" class="nf kz jj oj b gy oo op l oq or">url = "https://forms.gle/WY7E9N8wkiMtziTD9"<br/>driver = webdriver.Chrome(executable_path="./chromedriver")</span></pre><p id="d548" class="pw-post-body-paragraph lq lr jj ls b lt mm kk lv lw mn kn ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">这里，我们只是为提交表单的url和浏览器设置了变量，在我的例子中是Google Chrome。要使用它，你需要下载chromedriver，你可以在这里找到<a class="ae jg" href="https://chromedriver.storage.googleapis.com/index.html?path=92.0.4515.43/" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="7d12" class="nf kz jj bd la ng nh dn le ni nj dp li lz nk nl lk md nm nn lm mh no np lo nq bi translated">4.访问网址</h2><pre class="mz na nb nc gt ok oj ol om aw on bi"><span id="275b" class="nf kz jj oj b gy oo op l oq or">driver.get(url)</span></pre><h2 id="a2ed" class="nf kz jj bd la ng nh dn le ni nj dp li lz nk nl lk md nm nn lm mh no np lo nq bi translated">5.为基于文本的输入发送按键</h2><p id="f4c3" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">现在，我们编写一个函数，通过使用提供的element类来回答基于文本的问题。这个函数将把数据帧、类名、用户ID和控制浏览器的驱动程序作为输入，并提交适当的答案。</p><pre class="mz na nb nc gt ok oj ol om aw on bi"><span id="0626" class="nf kz jj oj b gy oo op l oq or">def answerNameAge(driver, df, element_class, user_id):<br/>    name = df["names"][user_id]<br/>    age = df["ages"][user_id]<br/>    text_answers = [name, str(age)] # following the order in the form<br/>    text_questions = driver.find_elements_by_class_name(element_class)<br/>    for a,q in zip(text_answers,text_questions):<br/>        q.send_keys(a)<br/>    <br/>    return driver</span></pre><h2 id="3ed2" class="nf kz jj bd la ng nh dn le ni nj dp li lz nk nl lk md nm nn lm mh no np lo nq bi translated">6.发送复选框输入的点击</h2><p id="84c6" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">现在，我们设置函数来填充复选框问题，对于这个问题，我们需要一个字典来匹配颜色和它们在表单中的相应顺序。</p><pre class="mz na nb nc gt ok oj ol om aw on bi"><span id="3769" class="nf kz jj oj b gy oo op l oq or">color_index_dict = {"Blue": 0, "Pink": 1, "Black": 2, "White": 3, "Green": 4}<br/><br/>def answerCheckBox(driver, df, element_class, user_id):<br/>    color_answer = df["colors"][user_id]<br/>    color_answer_index = color_index_dict[color_answer]<br/>    driver.find_elements_by_class_name(element_class)[color_answer_index].click()<br/>    <br/>    <br/>    return driver</span></pre><p id="5d72" class="pw-post-body-paragraph lq lr jj ls b lt mm kk lv lw mn kn ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">太好了，现在我们要做的就是提交表单！</p><h2 id="5cf4" class="nf kz jj bd la ng nh dn le ni nj dp li lz nk nl lk md nm nn lm mh no np lo nq bi translated">7.访问并单击提交按钮完成</h2><p id="6744" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">在这里，我们只编写一个简单的函数来访问之前获得的提交按钮的<code class="fe og oh oi oj b">xpath</code>并单击它。</p><pre class="mz na nb nc gt ok oj ol om aw on bi"><span id="3c1e" class="nf kz jj oj b gy oo op l oq or">def submit(driver, element_class):<br/>    driver.find_element_by_xpath(element_class).click()<br/>    return driver</span></pre><p id="29e5" class="pw-post-body-paragraph lq lr jj ls b lt mm kk lv lw mn kn ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">搞定了。现在，我们遍历数据库并提交每个用户的答案。</p><h2 id="6e32" class="nf kz jj bd la ng nh dn le ni nj dp li lz nk nl lk md nm nn lm mh no np lo nq bi translated">8.遍历数据库并提交每个用户的答案</h2><p id="7fe9" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">让我们在包含数据的数据帧上创建一个简单的循环，然后一个接一个地提交答案。</p><pre class="mz na nb nc gt ok oj ol om aw on bi"><span id="ac0b" class="nf kz jj oj b gy oo op l oq or">df = pd.read_csv("./submission_form_database.csv")<br/>text_question_element_class = "quantumWizTextinputPaperinputInput"<br/>checkbox_question_element_class = "appsMaterialWizToggleRadiogroupOffRadio"<br/><br/>url = "https://forms.gle/WY7E9N8wkiMtziTD9"<br/>driver = webdriver.Chrome(executable_path="./chromedriver")<br/>for user_id in range(len(df)):<br/>    driver.get(url)<br/>    <br/>    driver.maximize_window()<br/>    driver = answerNameAge(driver, df, text_question_element_class, user_id)<br/>    driver = answerCheckBox(driver, df, checkbox_question_element_class, user_id)<br/>    driver = submit(driver, submit_element_class)</span></pre><p id="f00b" class="pw-post-body-paragraph lq lr jj ls b lt mm kk lv lw mn kn ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">我们做到了，我们自动化了提交多个表单的枯燥过程！在我的谷歌表单回复统计页面上，我现在看到了这个:</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/6ade21098defbf5d205a72acb72b512f.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*n_Zl38E5ZQvjJ74Nb6mTLg.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</p></figure><p id="abe6" class="pw-post-body-paragraph lq lr jj ls b lt mm kk lv lw mn kn ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">这对于经常发现自己填写具有相似结构的在线表单的个人，以及从事案头工作并必须为客户或其组织中的人员执行这些类型的提交的人来说可能是有用的。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="b83c" class="ky kz jj bd la lb ou ld le lf ov lh li kp ow kq lk ks ox kt lm kv oy kw lo lp bi translated">为什么要自动化？</h1><p id="e3f5" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">我们在网上做的任何可重复的任务都应该自动化，这样我们就可以只关注重要的事情。当试图检测可自动化的任务时，一件有用的事情是问:<em class="mr">我是否定期这样做？它是否涉及可重复的过程，很少或没有涉及明智的决策？</em>如果两个问题的答案都是肯定的，那么你应该自动完成这个任务。</p><p id="8f18" class="pw-post-body-paragraph lq lr jj ls b lt mm kk lv lw mn kn ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">在本文中，您了解了:</p><ul class=""><li id="c817" class="nr ns jj ls b lt mm lw mn lz nt md nu mh nv ml os nx ny nz bi translated">如何使用Python的<code class="fe og oh oi oj b">selenium</code>框架来自动化填写提交表单(如google forms)的过程</li><li id="1f62" class="nr ns jj ls b lt oa lw ob lz oc md od mh oe ml os nx ny nz bi translated">自动化提交表单包括:用表单的数据建立一个数据框架，从所需的web地址检查web元素以了解如何导航在线表单，编写一个函数来回答基于输入类型的问题，编写一个简单的函数来点击相关的按钮，如提交按钮</li></ul><p id="cf6c" class="pw-post-body-paragraph lq lr jj ls b lt mm kk lv lw mn kn ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">如果你喜欢这篇文章，请在<a class="ae jg" href="https://twitter.com/LucasEnkrateia" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae jg" href="https://www.linkedin.com/in/lucas-soares-969044167/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>、<a class="ae jg" href="https://www.instagram.com/theaugmentedself/" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上联系我，并在<a class="ae jg" href="https://lucas-soares.medium.com" rel="noopener"> Medium </a>上关注我。谢谢，下次再见！:)</p></div></div>    
</body>
</html>