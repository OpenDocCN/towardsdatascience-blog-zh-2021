<html>
<head>
<title>How to Replace Null Values in Spark DataFrames</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何替换Spark数据帧中的空值</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-replace-null-values-in-spark-dataframes-ab183945b57d?source=collection_archive---------6-----------------------#2021-07-19">https://towardsdatascience.com/how-to-replace-null-values-in-spark-dataframes-ab183945b57d?source=collection_archive---------6-----------------------#2021-07-19</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="ee46" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">讨论如何使用fillna()和fill()替换PySpark中的空值</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/08d2e2b85283f24b3c267abab1cca42b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QfzJMbRuyeBn8eFwhIbZBw.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">由<a class="ae kz" href="https://unsplash.com/@kellysikkema?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Kelly Sikkema </a>在<a class="ae kz" href="https://unsplash.com/s/photos/empty?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h2 id="08c2" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">介绍</h2><p id="f89a" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">替换PySpark数据帧中的空值是最常见的操作之一。这可以通过使用<code class="fe mp mq mr ms b">DataFrame.fillna()</code>或<code class="fe mp mq mr ms b">DataFrameNaFunctions.fill()</code>方法来实现。在今天的文章中，我们将讨论这两个函数之间的主要区别。</p></div><div class="ab cl mt mu hy mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="in io ip iq ir"><h2 id="6d8c" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">为什么我们需要替换空值</h2><p id="2640" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">在处理Spark数据帧时，我们通常对它们执行的许多操作可能会在某些记录中返回空值。从那时起，如果观察到null/空值，一些其他操作可能会导致错误，因此我们必须以某种方式替换这些值，以便继续处理数据帧。</p><p id="6aaf" class="pw-post-body-paragraph lw lx iu ly b lz na jv mb mc nb jy me lj nc mg mh ln nd mj mk lr ne mm mn mo in bi translated">此外，当报告表格时(例如，当将它们输出到<code class="fe mp mq mr ms b">csv</code>文件中时)，避免包含空值是很常见的。例如，如果为创建计数而执行的操作返回空值，那么用<code class="fe mp mq mr ms b">0</code>替换这些值会更好。</p></div><div class="ab cl mt mu hy mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="in io ip iq ir"><p id="4ad3" class="pw-post-body-paragraph lw lx iu ly b lz na jv mb mc nb jy me lj nc mg mh ln nd mj mk lr ne mm mn mo in bi translated">在开始讨论如何在PySpark中替换空值以及探索<code class="fe mp mq mr ms b">fill()</code>和<code class="fe mp mq mr ms b">fillNa()</code>之间的区别之前，让我们创建一个示例数据帧，作为整篇文章的参考。</p><pre class="kk kl km kn gu nf ms ng nh aw ni bi"><span id="5c4a" class="la lb iu ms b gz nj nk l nl nm">from pyspark.sql import SparkSession<br/></span><span id="6e8f" class="la lb iu ms b gz nn nk l nl nm">spark_session = SparkSession.builder \<br/>    .master('local[1]') \<br/>    .appName('Example') \<br/>    .getOrCreate()</span><span id="4252" class="la lb iu ms b gz nn nk l nl nm"><br/>df = spark_session.createDataFrame(<br/>    [<br/>       (1, 'UK', 'London', None),<br/>       (2, 'US', 'New York', 8000000),<br/>       (3, 'US', 'Washington DC', None),<br/>       (4, 'UK', 'Manchester', 550000),<br/>    ],<br/>    ['id', 'country', 'city', 'population']<br/>)</span><span id="e230" class="la lb iu ms b gz nn nk l nl nm">df.show()</span><span id="ef6a" class="la lb iu ms b gz nn nk l nl nm">+---+---------+--------------+-----------+<br/>| id|  country|         city | population|<br/>+---+---------+--------------+-----------+<br/>|  1|       UK|        London|       null|<br/>|  2|       US|      New York|    8000000|<br/>|  3|       US| Washington DC|       null|<br/>|  4|       UK|    Manchester|     550000|<br/>+---+---------+--------------+-----------+</span></pre></div><div class="ab cl mt mu hy mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="in io ip iq ir"><h2 id="bc6e" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">菲尔娜</h2><p id="d30c" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated"><code class="fe mp mq mr ms b"><a class="ae kz" href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.sql.DataFrame.fillna.html#pyspark.sql.DataFrame.fillna" rel="noopener ugc nofollow" target="_blank">pyspark.sql.DataFrame.fillna()</a></code>函数在Spark版本<code class="fe mp mq mr ms b">1.3.1</code>中引入，用于将空值替换为另一个指定值。它接受两个参数，即<code class="fe mp mq mr ms b">value</code>和<code class="fe mp mq mr ms b">subset</code>。</p><ul class=""><li id="a836" class="no np iu ly b lz na mc nb lj nq ln nr lr ns mo nt nu nv nw bi translated"><code class="fe mp mq mr ms b">value</code>对应于您想要替换空值的所需值。如果<code class="fe mp mq mr ms b">value</code>是一个<code class="fe mp mq mr ms b">dict</code>对象，那么它应该是一个映射，其中键对应于列名，值对应于替换值，替换值必须是<code class="fe mp mq mr ms b">int</code>、<code class="fe mp mq mr ms b">float</code>、<code class="fe mp mq mr ms b">bool</code>或<code class="fe mp mq mr ms b">str</code>。</li><li id="2733" class="no np iu ly b lz nx mc ny lj nz ln oa lr ob mo nt nu nv nw bi translated"><code class="fe mp mq mr ms b">subset</code>对应于替换空值时要考虑的列名列表。如果<code class="fe mp mq mr ms b">value</code>参数是一个<code class="fe mp mq mr ms b">dict</code>，那么该参数将被忽略。</li></ul><p id="fb32" class="pw-post-body-paragraph lw lx iu ly b lz na jv mb mc nb jy me lj nc mg mh ln nd mj mk lr ne mm mn mo in bi translated">现在，如果我们想要替换一个数据帧中的所有空值，我们可以简单地只提供<code class="fe mp mq mr ms b">value</code>参数:<code class="fe mp mq mr ms b"><br/>df.na.fill(value=0).show()<br/><br/>#Replace Replace 0 for null on only population column <br/>df.na.fill(value=0,subset=["population"]).show()</code></p><pre class="kk kl km kn gu nf ms ng nh aw ni bi"><span id="687a" class="la lb iu ms b gz nj nk l nl nm">df.fillna(value=0).show()</span><span id="b29f" class="la lb iu ms b gz nn nk l nl nm">+---+---------+--------------+-----------+<br/>| id|  country|         city | population|<br/>+---+---------+--------------+-----------+<br/>|  1|       UK|        London|          0|<br/>|  2|       US|      New York|    8000000|<br/>|  3|       US| Washington DC|          0|<br/>|  4|       UK|    Manchester|     550000|<br/>+---+---------+--------------+-----------+</span></pre><p id="91f4" class="pw-post-body-paragraph lw lx iu ly b lz na jv mb mc nb jy me lj nc mg mh ln nd mj mk lr ne mm mn mo in bi translated">上述操作将用<code class="fe mp mq mr ms b">0</code>的值替换整数列中的所有空值。</p><p id="6524" class="pw-post-body-paragraph lw lx iu ly b lz na jv mb mc nb jy me lj nc mg mh ln nd mj mk lr ne mm mn mo in bi translated">我们甚至可以使用<code class="fe mp mq mr ms b">subset</code>参数显式指定列名:</p><pre class="kk kl km kn gu nf ms ng nh aw ni bi"><span id="271a" class="la lb iu ms b gz nj nk l nl nm">df.fillna(value=0, subset=['population']).show()</span><span id="4ddd" class="la lb iu ms b gz nn nk l nl nm">+---+---------+--------------+-----------+<br/>| id|  country|         city | population|<br/>+---+---------+--------------+-----------+<br/>|  1|       UK|        London|          0|<br/>|  2|       US|      New York|    8000000|<br/>|  3|       US| Washington DC|          0|<br/>|  4|       UK|    Manchester|     550000|<br/>+---+---------+--------------+-----------+</span></pre></div><div class="ab cl mt mu hy mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="in io ip iq ir"><h2 id="c744" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">填充()</h2><p id="ffdc" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">现在<code class="fe mp mq mr ms b"><a class="ae kz" href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.sql.DataFrameNaFunctions.fill.html#pyspark.sql.DataFrameNaFunctions.fill" rel="noopener ugc nofollow" target="_blank">pyspark.sql.DataFrameNaFunctions.fill()</a></code>(在版本<code class="fe mp mq mr ms b">1.3.1</code>中再次引入)是<code class="fe mp mq mr ms b"><a class="ae kz" href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.sql.DataFrame.fillna.html#pyspark.sql.DataFrame.fillna" rel="noopener ugc nofollow" target="_blank">pyspark.sql.DataFrame.fillna()</a></code>的别名，两种方法将导致完全相同的结果。</p><p id="b477" class="pw-post-body-paragraph lw lx iu ly b lz na jv mb mc nb jy me lj nc mg mh ln nd mj mk lr ne mm mn mo in bi translated">正如我们在下面看到的，<code class="fe mp mq mr ms b">na.fill()</code>的结果与<code class="fe mp mq mr ms b"><a class="ae kz" href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.sql.DataFrame.fillna.html#pyspark.sql.DataFrame.fillna" rel="noopener ugc nofollow" target="_blank">pyspark.sql.DataFrame.fillna()</a></code>应用于数据帧时观察到的结果相同。</p><pre class="kk kl km kn gu nf ms ng nh aw ni bi"><span id="89a7" class="la lb iu ms b gz nj nk l nl nm">df.na.fill(value=0).show()</span><span id="ac09" class="la lb iu ms b gz nn nk l nl nm">+---+---------+--------------+-----------+<br/>| id|  country|         city | population|<br/>+---+---------+--------------+-----------+<br/>|  1|       UK|        London|          0|<br/>|  2|       US|      New York|    8000000|<br/>|  3|       US| Washington DC|          0|<br/>|  4|       UK|    Manchester|     550000|<br/>+---+---------+--------------+-----------+</span></pre><p id="5b3b" class="pw-post-body-paragraph lw lx iu ly b lz na jv mb mc nb jy me lj nc mg mh ln nd mj mk lr ne mm mn mo in bi translated">上述操作将用<code class="fe mp mq mr ms b">0</code>的值替换整数列中的所有空值。类似地，我们可以使用<code class="fe mp mq mr ms b">subset</code>参数显式指定列名:</p><pre class="kk kl km kn gu nf ms ng nh aw ni bi"><span id="6b5f" class="la lb iu ms b gz nj nk l nl nm">df.na.fill(value=0, subset=['population']).show()</span><span id="9b66" class="la lb iu ms b gz nn nk l nl nm">+---+---------+--------------+-----------+<br/>| id|  country|         city | population|<br/>+---+---------+--------------+-----------+<br/>|  1|       UK|        London|          0|<br/>|  2|       US|      New York|    8000000|<br/>|  3|       US| Washington DC|          0|<br/>|  4|       UK|    Manchester|     550000|<br/>+---+---------+--------------+-----------+</span></pre></div><div class="ab cl mt mu hy mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="in io ip iq ir"><h2 id="e39e" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">最后的想法</h2><p id="8ca6" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">在今天的文章中，我们讨论了为什么在Spark数据帧中替换空值有时很重要。此外，我们还讨论了如何使用<code class="fe mp mq mr ms b">fillna()</code>和<code class="fe mp mq mr ms b">fill()</code>来实现这一点，它们实际上是彼此的别名。</p><p id="5d33" class="pw-post-body-paragraph lw lx iu ly b lz na jv mb mc nb jy me lj nc mg mh ln nd mj mk lr ne mm mn mo in bi translated">你可以在下面找到更多Spark相关的文章。</p><div class="oc od gq gs oe of"><a rel="noopener follow" target="_blank" href="/distinct-vs-dropduplicates-in-spark-3e28af1f793c"><div class="og ab fp"><div class="oh ab oi cl cj oj"><h2 class="bd iv gz z fq ok fs ft ol fv fx it bi translated">Spark中的distinct()与dropDuplicates()</h2><div class="om l"><h3 class="bd b gz z fq ok fs ft ol fv fx dk translated">Spark中distinct()和dropDuplicates()有什么区别？</h3></div><div class="on l"><p class="bd b dl z fq ok fs ft ol fv fx dk translated">towardsdatascience.com</p></div></div><div class="oo l"><div class="op l oq or os oo ot kt of"/></div></div></a></div><div class="oc od gq gs oe of"><a rel="noopener follow" target="_blank" href="/sparksession-vs-sparkcontext-vs-sqlcontext-vs-hivecontext-741d50c9486a"><div class="og ab fp"><div class="oh ab oi cl cj oj"><h2 class="bd iv gz z fq ok fs ft ol fv fx it bi translated">spark session vs spark context vs SQLContext vs hive context</h2><div class="om l"><h3 class="bd b gz z fq ok fs ft ol fv fx dk translated">SparkSession、SparkContext HiveContext和SQLContext有什么区别？</h3></div><div class="on l"><p class="bd b dl z fq ok fs ft ol fv fx dk translated">towardsdatascience.com</p></div></div><div class="oo l"><div class="ou l oq or os oo ot kt of"/></div></div></a></div><div class="oc od gq gs oe of"><a rel="noopener follow" target="_blank" href="/sort-vs-orderby-in-spark-8a912475390"><div class="og ab fp"><div class="oh ab oi cl cj oj"><h2 class="bd iv gz z fq ok fs ft ol fv fx it bi translated">Spark中的sort()与orderBy()</h2><div class="on l"><p class="bd b dl z fq ok fs ft ol fv fx dk translated">towardsdatascience.com</p></div></div><div class="oo l"><div class="ov l oq or os oo ot kt of"/></div></div></a></div></div></div>    
</body>
</html>