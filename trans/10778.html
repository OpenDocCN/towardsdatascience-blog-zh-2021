<html>
<head>
<title>How to Include R and ggplot in a Python Notebook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python笔记本中包含R和ggplot</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-include-r-and-ggplot-in-a-python-notebook-f2b76091353d?source=collection_archive---------25-----------------------#2021-10-18">https://towardsdatascience.com/how-to-include-r-and-ggplot-in-a-python-notebook-f2b76091353d?source=collection_archive---------25-----------------------#2021-10-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="80bb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">您可以在同一个Jupyter笔记本中混合使用匹配的Python和R——方法如下</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3c95464cce2e73aac8f47764a9e96ad9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vgXqsFmQfCCmz35jBpDr3A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Python笔记本中R的ggplot2中的图片-作者图片</p></figure><p id="e27b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你要么是R人，要么是Python人，对吧？当然，除非你喜欢Python的某些方面和r的其他方面。</p><p id="1c97" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">那么为什么不混搭呢？例如，R的<em class="lu"> ggplot2 </em>是一个很棒的可视化包，那么能够在Python程序中使用它不是很好吗？</p><p id="c316" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将看看如何实现这一点——这很容易——然后你可以决定是否值得努力。</p><p id="ad4d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我将从Python用户的角度来处理这个问题，所以我假设您的计算机上已经安装了Python和Jupyter。这意味着你还需要两样东西:R和一个名为<em class="lu"> rpy2 </em>的Python包。需要安装R，因为我们将运行R脚本(尽管是在Python上下文中),而<em class="lu"> rpy2 </em>是两种语言之间的桥梁。</p><p id="e1f4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以，你可以去R网站<a class="ae lv" href="https://cran.r-project.org/" rel="noopener ugc nofollow" target="_blank">下载你的操作系统版本，然后按照说明安装R。</a></p><p id="476b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">完成了吗？好了，接下来我们将打开R控制台，看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lw"><img src="../Images/a95d8d4b8a5fcdbbb78ffa06b222c014.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8KFyOHr5wjXdhw-4up1c1g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">r控制台—作者图片</p></figure><p id="2bc0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将使用<em class="lu"> ggplot2 </em>可视化软件包，因此需要安装该软件包。在控制台中键入以下内容:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="e437" class="mc md it ly b gy me mf l mg mh">packages.install("tidyverse")</span></pre><p id="5be9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="lu">小包装</em>包括<em class="lu"> ggplot2 </em>。(如果你想遵循这里的所有代码，你还需要安装软件包<em class="lu"> ggalt </em>。)现在可以关闭R控制台了。</p><p id="b898" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们用pip安装<em class="lu"> rpy2 </em>包:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="f86b" class="mc md it ly b gy me mf l mg mh">pip install rpy2</span></pre><p id="72d9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们现在准备编写一个Python Jupyter笔记本，它可以运行用r编写的单元格。</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="5ff9" class="mc md it ly b gy me mf l mg mh">%load_ext rpy2.ipython</span></pre><p id="8292" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将加载<em class="lu"> rpy2 </em>包并启用<em class="lu"> rmagic </em>命令(我们很快就会看到)。但是首先让我们导入熊猫并创建一个数据框架。</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="9e2d" class="mc md it ly b gy me mf l mg mh">import pandas as pd</span></pre><p id="22b2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是一个数据帧，代表了2018年伦敦记录的月气温。</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="ac31" class="mc md it ly b gy me mf l mg mh">w = {<br/>  "Month":[1,2,3,4,5,6,7,8,9,10,11,12],<br/>  "Tmax":[9.7,6.7,9.8,15.5,20.8,24.2,28.3,24.5,20.9,16.5,12.2,10.7],<br/>  "Tmin":[3.8,0.6,3.0,7.9,9.8,13.1,16.4,14.5,11.0,8.5,5.8,5.2]<br/>  }</span><span id="c615" class="mc md it ly b gy mi mf l mg mh">weather=pd.DataFrame(w)</span></pre><p id="12af" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这给了我们一个这样的数据框架:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/ea91413c9f5589448edf9e10f403cebb.png" data-original-src="https://miro.medium.com/v2/resize:fit:334/format:webp/1*vuKUSWehMjyQTevYeZll5w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">天气数据框—图片由作者提供</p></figure><p id="59e1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们将使用r中的<em class="lu"> ggplot2 </em>绘制一个图形。因此我们打开一个新的单元格，我们需要输入的第一行是这样的:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="6886" class="mc md it ly b gy me mf l mg mh">%%R -i weather -w 15 -h 10 --units cm</span></pre><p id="9528" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe mk ml mm ly b">%%R</code>将单元标识为R代码，随后是一些决定单元如何工作的参数。<code class="fe mk ml mm ly b">-i weather</code>将之前创建的Python变量导入到R单元格、<code class="fe mk ml mm ly b">-w 15</code>、<code class="fe mk ml mm ly b">-h 10</code>、<code class="fe mk ml mm ly b">— units cm</code>中，使创建的任意图形宽15厘米，高10厘米。</p><p id="38c4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是一个完整的单元格，包含了<code class="fe mk ml mm ly b">%%R</code>魔法，导入了<em class="lu"> ggplot2 </em>库，然后从<code class="fe mk ml mm ly b">weather</code>数据帧绘制了一个线图。</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="68df" class="mc md it ly b gy me mf l mg mh">%%R -i weather -w 15 -h 10 --units cm <br/># import df from Python and set figure size 15 by 10cm</span><span id="19c6" class="mc md it ly b gy mi mf l mg mh">library("ggplot2")</span><span id="74d8" class="mc md it ly b gy mi mf l mg mh">ggplot(weather,aes(Month, Tmax)) + <br/>    geom_line() +<br/>    ggtitle("Temperature")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/dc3d0088a65a770f54603234b558197e.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*x-CdfxeCnPsH1iFntp1grA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">简单线形图—作者提供的图片</p></figure><p id="b71a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">默认图并不理想，因为x刻度实际上应该是从1到12，它可以更漂亮一点。让我们解决这个问题。</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="19b6" class="mc md it ly b gy me mf l mg mh">%%R -i weather -w 15 -h 10 --units cm <br/># import df from Python and set figure size 15 by 10cm</span><span id="7b65" class="mc md it ly b gy mi mf l mg mh">library("ggplot2")</span><span id="3303" class="mc md it ly b gy mi mf l mg mh">ggplot(weather) + <br/>    geom_line(aes(Month, Tmax),color="Red",size=1.25) +<br/>    scale_x_continuous(breaks=seq(1, 12, 1))+<br/>    scale_y_continuous(breaks=seq(-10, 40, 5))+<br/>    labs(y="Temperature", x="Month", <br/>         title="London Monthly Temperatures 2018") +<br/>    theme_light() +<br/>    theme(panel.grid.minor=element_blank())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/2a2b0ab321bd3f1e17520679817b38af.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*V2lT0HzzEO_GQslOS0U5hw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">更好的线图<strong class="bd mo"> </strong> —作者图片</p></figure><p id="b4ba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在R的<em class="lu"> ggplot2 </em>中，我们可以看到一种简洁的方式，一层一层地构建图表。</p><p id="249a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是如果我们想在同一个图表上绘制<code class="fe mk ml mm ly b">Tmax</code>和<code class="fe mk ml mm ly b">Tmin</code>呢？我们需要转换数据，以便两个值在同一列中。在Python中，我们可以通过打开一个新的单元格并输入以下Python代码来做到这一点。</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="931c" class="mc md it ly b gy me mf l mg mh">weather2=pd.melt(weather, id_vars=['Month'], <br/>                 value_vars=['Tmax', 'Tmin'],var_name="Temp")</span></pre><p id="6d3d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这创建了一个新的数据帧<code class="fe mk ml mm ly b">weather2</code>,如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/a216d8ad27ebb89634c1d3b3754806f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:318/format:webp/1*bnx227_67vanz0jHHQMekw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Weather2数据框架—作者图片</p></figure><p id="2e87" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我确信你也可以这样做，但是这里的想法是展示这两种语言是如何混合的。</p><p id="aa73" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们可以用ggplot2绘制一个图表，通过创建一个像这样的新R单元格来绘制这两个值。</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="a67e" class="mc md it ly b gy me mf l mg mh">%%R -i weather2 -w 15 -h 10 --units cm <br/># import df from Python and set figure size 15 by 10cm</span><span id="89f0" class="mc md it ly b gy mi mf l mg mh">library("ggplot2")</span><span id="f837" class="mc md it ly b gy mi mf l mg mh">ggplot(weather2,aes(Month, value)) + <br/>    geom_line(aes(color=Temp),size=1.25)+<br/>    scale_x_continuous(breaks=seq(1, 12, 1))+<br/>    scale_y_continuous(breaks=seq(-10, 40, 5))+<br/>    labs(y="Temperature", x="Month", <br/>         title="London Monthly Temperatures 2018") +<br/>    theme_light() +<br/>    theme(panel.grid.minor=element_blank())</span></pre><p id="ee11" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这给了我们下面的图表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/33c94ad2aec6624cae0aa6dc90a765e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*JIPT6Ra-IGVzAsHOBBa_sA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带有两个图的折线图—作者提供的图片</p></figure><p id="38b7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，在这一点上，你可能认为这一切都很好，但我可以用Plotnine做到这一点，而不会用一种新的语言搞乱我的Python笔记本。</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="70c8" class="mc md it ly b gy me mf l mg mh">from plotnine import *</span><span id="db34" class="mc md it ly b gy mi mf l mg mh">(ggplot(weather2,aes("Month", "value")) + <br/>    geom_line(aes(color="Temp"),size=1.25)+<br/>    scale_x_continuous(breaks=range(1,13,1))+<br/>    scale_y_continuous(breaks=range(-10, 40, 5))+<br/>    labs(y="Temperature", x="Month", <br/>         title="London Monthly Temperatures 2018") +<br/>    theme_light() +<br/>    theme(panel_grid_minor=element_blank())<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/629deb1bc140266b8468e1575ee22287.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*-FZ_dt_iSO9DV-KjzrrkQQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Plotnine plot —作者图片</p></figure><p id="1c79" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当然，这是真的，你可以从上面的代码中看到。Plotnine是一个很好的包，正如我在这里描述的<a class="ae lv" rel="noopener" target="_blank" href="/ggplot-grammar-of-graphics-in-python-with-plotnine-2e97edd4dacf"/>一样，但它不是<em class="lu"> ggplot </em>的完全克隆，因为它在它所基于的Matplotlib所能实现的方面受到限制。</p><p id="af69" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，如果我想创建一个像这样的月温度的dumbell图会怎么样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/f2db602056c534177924877a3388d9c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*5EzJINgpMfC-AlQcD7Gq6A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一个dumbell情节-作者的形象</p></figure><p id="e9eb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个简洁的图表显示了每个月的温度范围，当然，通过一点努力和独创性，我们可以在Plotnine(或者，实际上，在Matplotlib)中创建它。但也许这样更简单:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="ab2a" class="mc md it ly b gy me mf l mg mh">%%R -i weather -w 15 -h 10 --units cm <br/># import df from Python and set figure size 15 by 10cm</span><span id="b4b2" class="mc md it ly b gy mi mf l mg mh">library(ggplot2)<br/>library(ggalt)</span><span id="126f" class="mc md it ly b gy mi mf l mg mh">ggplot(weather, aes(y=Month, x=Tmin, xend=Tmax)) +<br/>  geom_dumbbell(size=1.25, color="Gray",<br/>                colour_x = "Blue", <br/>                colour_xend = "Red",<br/>                size_x=4,<br/>                size_xend=4) +<br/>  labs(x="Temperature", y="Month", <br/>       title="London Monthly Temperatures 2018") +<br/>  scale_y_continuous(breaks=seq(1, 12, 1))+<br/>  scale_x_continuous(breaks=seq(-10, 40, 5))+<br/>  theme_light()</span></pre><p id="a5c0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">库<em class="lu"> ggalt </em>用额外的绘图类型扩展了<em class="lu"> ggplot2 </em>，这使得绘制dumbell图表非常简单。</p><p id="f1dd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">除了<code class="fe mk ml mm ly b">%%R</code>之外，还有一个神奇的命令<code class="fe mk ml mm ly b">%R</code>，可以让你在一个Python单元格中使用单独的R代码行，但是，坦率地说，我认为混合不同语言的单元格会让笔记本变得很乱，所以我就讲到这里。</p><p id="72e0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以，R和Python在同一个笔记本里——好主意？嗯，也许吧。我喜欢我可以直接使用<em class="lu"> ggplot2 </em>，但是我也喜欢Plotnine，它允许我专门使用Python。</p><p id="d973" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">关于rpy2 的内容比我在这里介绍的还要多。更多详情请看他们的<a class="ae lv" href="https://rpy2.github.io/" rel="noopener ugc nofollow" target="_blank">网站</a>。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><p id="1957" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一如既往，感谢阅读。如果你想知道我什么时候发表新文章，请考虑在这里注册一个电子邮件提醒<a class="ae lv" href="https://alan-jones.medium.com/subscribe" rel="noopener">。</a></p><p id="9e59" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你不是一个媒体订阅者，那就注册吧，这样你就可以每月花5美元阅读尽可能多的文章。在这里注册<a class="ae lv" href="https://alan-jones.medium.com/membership" rel="noopener"/>,我会赚一点佣金。</p></div></div>    
</body>
</html>