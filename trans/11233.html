<html>
<head>
<title>Deploy and Monitor your ML Application with Flask and WhyLabs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Flask和WhyLabs部署和监控您的ML应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploy-and-monitor-your-ml-application-with-flask-and-whylabs-4cd1e757c94b?source=collection_archive---------17-----------------------#2021-11-03">https://towardsdatascience.com/deploy-and-monitor-your-ml-application-with-flask-and-whylabs-4cd1e757c94b?source=collection_archive---------17-----------------------#2021-11-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8d60" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">提高你的人工智能系统的可观察性</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/40fd04823b41ca359818cfe140c8efda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SNUWKx8xHG8TrwRVPjS2Hg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="48c5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在每个人工智能构建者的旅程中，最好的里程碑之一是模型准备好从培训中毕业并投入生产的那一天。根据Algorithmia 最近做的一项调查<a class="ae lr" href="https://info.algorithmia.com/2021" rel="noopener ugc nofollow" target="_blank">，大多数组织已经有超过25个模型投入生产。这强调了企业是如何越来越多地依赖ML来提高实验室之外的性能的。然而，部署后阶段对于您的ML模型来说可能是一个困难的阶段。数据科学家可能认为一旦模型部署完毕，困难的部分就结束了，但事实是问题才刚刚开始。数据错误、管道破裂和模型性能下降总有一天会出现，当这一天到来时，我们必须准备好有效地调试和解决这些问题。为了拥有一个可靠和健壮的ML系统，可观测性是绝对必须的。</a></p><p id="7629" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本文中，我想分享一种方法，通过有效地记录和监控您的模型来提高您的ML应用程序的可观察性。为了演示，我们将部署一个Flask应用程序，用于基于众所周知的<a class="ae lr" href="https://archive.ics.uci.edu/ml/datasets/iris" rel="noopener ugc nofollow" target="_blank">虹膜数据集</a>的模式识别。在监控部分，我们将探索免费的入门版<a class="ae lr" href="https://whylabs.ai/" rel="noopener ugc nofollow" target="_blank">why labs</a>Observability Platform，以便建立我们自己的模型监控仪表板。从仪表板上，我们可以访问从ML管道的每个部分收集的所有统计数据、指标和性能数据。为了与平台交互，我们将使用由WhyLabs开发的开源数据日志库<a class="ae lr" href="https://github.com/whylabs/whylogs" rel="noopener ugc nofollow" target="_blank"> whylogs </a>。</p><p id="6570" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">监控仪表板的一个关键用例是当我们的数据质量和/或一致性发生意外变化时。因此，我们模拟了最常见的模型失败场景之一，即特征漂移，这意味着我们的输入分布发生了变化。然后，我们使用一个监控仪表板来查看如何检测和调试这类问题。虽然特征漂移可能会也可能不会影响模型的性能，但观察生产中的这种变化应该始终是进一步检查和模型再训练的理由。</p><p id="e720" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">总之，我们将一步一步地介绍:</p><ul class=""><li id="91d9" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated">部署集成了WhyLabs的Flask API</li><li id="51fb" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">测试应用程序</li><li id="600f" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">注入特征漂移并浏览模型操控板</li></ul><p id="ccca" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果这是一个让你产生共鸣的问题，我们已经将本教程的完整代码放在<a class="ae lr" href="https://github.com/whylabs/whylogs/tree/mainline/examples/flask_whylabs_example" rel="noopener ugc nofollow" target="_blank">这里</a>供你重用。您需要将它复制到您的机器上，以便遵循这个示例。您还需要一个Docker，最好还需要一个Python环境管理工具，比如Conda或pipenv。对于那些对细节感兴趣的人，我们已经包括了一个非常详细的描述和一个Jupyter笔记本作为指南。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="30be" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">1.概观</h1><p id="a3e2" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">让我们看看系统的不同组件是如何相互作用的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/724edc7194436d97bf5ceb03cc3911c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*itz_LEBNBfnduUpZ"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="a80d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将在本地部署一个Flask应用程序，它负责通过REST端点向用户提供所请求的预测。我们的应用程序还将使用whylogs库来创建生产过程中应用程序的输入和输出特性的统计概要。这些统计特性将在固定的时间间隔内以微批次的形式发送到WhyLabs。WhyLabs会自动合并它们，每天创建统计数据。</p><p id="0bfd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有多种方法可以将您记录的指标上传到平台。在本例中，我们定期在微批次中上传它们，如图所示。另一种选择是在每个日志步骤上传它们。</p><h1 id="5d8d" class="mn mo iq bd mp mq nl ms mt mu nm mw mx jw nn jx mz jz no ka nb kc np kd nd ne bi translated">2.设置您的WhyLabs帐户</h1><p id="17e9" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">为了监控我们的应用程序，让我们首先设置一个WhyLabs帐户。具体来说，我们需要两条信息:</p><ul class=""><li id="f242" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated">API令牌</li><li id="b291" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">组织ID</li></ul><p id="14e5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">前往https://whylabs.ai/free的<a class="ae lr" href="https://whylabs.ai/free" rel="noopener ugc nofollow" target="_blank">获取一个免费账户。如果您愿意，您可以跟随示例，但是如果您只对跟随本演示感兴趣，您可以跳过快速入门说明。</a></p><p id="b783" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">之后，系统会提示您创建一个API令牌，您将使用它与您的仪表板进行交互。创建令牌后，复制它并将其存储在安全的地方。这里的第二个重要信息是您的组织ID。把它也记下来。WhyLabs为您提供了如何创建会话并将数据发送到仪表板的示例代码。你也可以测试它，检查数据是否通过。否则，在你获得API令牌和Org ID后，你可以去https://hub.whylabsapp.com/models的<a class="ae lr" href="https://hub.whylabsapp.com/models" rel="noopener ugc nofollow" target="_blank">看看你闪亮的新模型的仪表板。为了进行到这一步，我们使用了WhyLabs API文档</a>，它也提供了关于令牌创建的附加信息以及如何使用它的基本示例。</p><h1 id="7dd2" class="mn mo iq bd mp mq nl ms mt mu nm mw mx jw nn jx mz jz no ka nb kc np kd nd ne bi translated">3.部署Flask应用程序</h1><p id="9a64" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">一旦仪表板启动并运行，我们就可以开始部署应用程序本身了。我们将使用Gunicorn提供一个Flask应用程序，打包到Docker容器中以方便部署。</p><h2 id="9b35" class="nq mo iq bd mp nr ns dn mt nt nu dp mx le nv nw mz li nx ny nb lm nz oa nd ob bi translated">WhyLabs配置</h2><p id="ae6d" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">第一步是配置与WhyLabs的连接。在这个例子中，我们通过<code class="fe oc od oe of b">.whylogs_flask.yaml</code>文件来完成。可以将写入器设置为在本地输出数据或输出到不同的位置，例如S3、MLFlow path或直接输出到WhyLabs。在这个文件中，我们还将设置项目的名称和其他附加信息。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="5b49" class="nq mo iq bd mp nr ns dn mt nt nu dp mx le nv nw mz li nx ny nb lm nz oa nd ob bi translated">环境变量</h2><p id="a9a8" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">应用程序假设存在一组变量，所以我们将在一个<code class="fe oc od oe of b">.env</code>文件中定义它们。这些稍后使用<strong class="kx ir"> dotenv </strong>库加载。复制以下内容，并将<code class="fe oc od oe of b">WHYLABS_API_KEY</code>和<code class="fe oc od oe of b">WHYLABS_DEFAULT_ORG_ID</code>值替换为创建WhyLabs帐户时获得的值。您可以保持其他变量不变。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="c5fa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们谈谈其他一些现有的变量。</p><ul class=""><li id="73f9" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated"><strong class="kx ir">why labs _ DEFAULT _ DATASET _ ID</strong>—数据集的ID。模型-1是默认值，在您创建帐户后自动创建。如果您尚未向WhyLabs发送任何内容，请保持不变。但是如果它已经被填充，您可以将其更改为model-2。记得在https://hub.whylabsapp.com/models设置新模型。一个新的模型id将被分配给新创建的模型，您可以在您的。环境文件。</li><li id="40f1" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kx ir"> ROTATION_TIME </strong> —用于向WhyLabs发送数据的周期。在实际的应用程序中，我们可能不需要如此频繁的更新，但是对于这个例子，我们将它设置为一个较低的值，这样我们就不必等待那么长时间来确保它正常工作。</li></ul><h2 id="cccf" class="nq mo iq bd mp nr ns dn mt nt nu dp mx le nv nw mz li nx ny nb lm nz oa nd ob bi translated">创造环境</h2><p id="9db0" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">该应用程序将从Docker容器内部运行，但是我们还将运行一些前脚本(下载数据和训练模型)和后脚本(发送请求)，所以让我们为本教程创建一个环境。如果您正在使用Conda，您可以从<code class="fe oc od oe of b">environment.yml</code>配置文件中创建它:</p><pre class="kg kh ki kj gt oi of oj ok aw ol bi"><span id="cd7a" class="nq mo iq of b gy om on l oo op">conda env create -f environment.yml</span></pre><p id="be2c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果没有达到预期效果，您还可以从头开始创建一个环境:</p><pre class="kg kh ki kj gt oi of oj ok aw ol bi"><span id="79e4" class="nq mo iq of b gy om on l oo op">conda create -n whylogs-flask python=3.7.11</span><span id="d5bc" class="nq mo iq of b gy oq on l oo op">conda activate whylogs-flask</span></pre><p id="2559" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后从需求中直接安装:</p><pre class="kg kh ki kj gt oi of oj ok aw ol bi"><span id="5fb1" class="nq mo iq of b gy om on l oo op">python -m pip install -r requirements.txt</span></pre><h2 id="be9a" class="nq mo iq bd mp nr ns dn mt nt nu dp mx le nv nw mz li nx ny nb lm nz oa nd ob bi translated">训练模型</h2><p id="a665" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">如果你仔细观察，我们的一个环境变量叫做<code class="fe oc od oe of b">MODEL_PATH</code>。我们还没有模型，所以让我们创建它。我们将使用<strong class="kx ir"> sklearn </strong>从<a class="ae lr" href="https://archive.ics.uci.edu/ml/machine-learning-databases/iris/" rel="noopener ugc nofollow" target="_blank">虹膜数据集</a>中训练一个简单的SVC分类模型，并将其保存为<code class="fe oc od oe of b">model.joblib</code>。从我们示例的文件夹的根，我们可以简单地调用<a class="ae lr" href="https://github.com/whylabs/whylogs/blob/mainline/examples/flask_whylabs_example/train.py" rel="noopener ugc nofollow" target="_blank">训练例程</a>:</p><pre class="kg kh ki kj gt oi of oj ok aw ol bi"><span id="5e31" class="nq mo iq of b gy om on l oo op">python train.py</span></pre><h2 id="f292" class="nq mo iq bd mp nr ns dn mt nt nu dp mx le nv nw mz li nx ny nb lm nz oa nd ob bi translated">建立码头工人形象</h2><p id="10ba" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">现在我们已经具备了实际运行应用程序的一切。为了构建映像，我们定义了下面的Dockerfile文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="e17b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后构建图像并运行我们的容器:</p><pre class="kg kh ki kj gt oi of oj ok aw ol bi"><span id="17bc" class="nq mo iq of b gy om on l oo op">docker build --build-arg PYTHON_VERSION=3.7 -t whylabs-flask:latest .</span><span id="19be" class="nq mo iq of b gy oq on l oo op">docker run --rm -p 5000:5000 -v $(pwd):/app  whylabs-flask</span></pre><p id="3a04" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这将在本地端口5000上启动我们的应用程序。在这个例子中，我们使用<strong class="kx ir"> Gunicorn </strong>将Flask应用程序作为WSGI HTTP服务器运行。通过设置<code class="fe oc od oe of b">reload</code>变量，我们能够更有效地调试，当代码发生变化时，自动重新加载工人。</p><p id="c533" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您应该会看到来自gunicorn的启动服务器的消息:</p><pre class="kg kh ki kj gt oi of oj ok aw ol bi"><span id="c12a" class="nq mo iq of b gy om on l oo op">[2021-10-12 17:53:01 +0000] [1] [INFO] Starting gunicorn 20.1.0<br/>[2021-10-12 17:53:01 +0000] [1] [INFO] Listening at: http://0.0.0.0:5000 (1)<br/>[2021-10-12 17:53:01 +0000] [1] [INFO] Using worker: sync<br/>[2021-10-12 17:53:01 +0000] [8] [INFO] Booting worker with pid: 8<br/>[2021-10-12 17:53:01 +0000] [20] [INFO] Booting worker with pid: 20</span></pre><h2 id="b580" class="nq mo iq bd mp nr ns dn mt nt nu dp mx le nv nw mz li nx ny nb lm nz oa nd ob bi translated">4.测试API</h2><p id="9b7f" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">一旦Docker容器运行，我们应该检查API是否正常工作。该应用程序有两个端点:</p><ul class=""><li id="b4e8" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated"><strong class="kx ir"> /api/v1/health </strong>:如果api启动并运行，则返回200状态响应。</li><li id="be32" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kx ir"> /api/v1/predict </strong>:给定输入特征向量，返回预测类。</li></ul><p id="05af" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Swagger对该API进行了适当的文档化，因此您可以前往<strong class="kx ir">http:127 . 0 . 0 . 1:5000/API docs</strong>浏览文档:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/1971424961cf19fdbd4f767bb9abc6b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*y1Qli8n7ImF7s3Og"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="ac08" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从<strong class="kx ir"> /apidocs </strong>中，您将能够看到尝试两个端点的请求示例，以及<strong class="kx ir"> curl </strong>片段，如:</p><pre class="kg kh ki kj gt oi of oj ok aw ol bi"><span id="9ae5" class="nq mo iq of b gy om on l oo op">curl -X GET "http://127.0.0.1:5000/api/v1/health" -H "accept: application/json"</span><span id="fad7" class="nq mo iq of b gy oq on l oo op">curl -X POST "http://127.0.0.1:5000/api/v1/predict" -H "accept: application/json" -H "Content-Type: application/json" -d "{ \"petal_length_cm\": 0, \"petal_width_cm\": 0, \"sepal_length_cm\": 0, \"sepal_width_cm\": 0}"</span></pre><p id="67f9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您应该从第一个命令中获得“健康”的响应。同样，来自预测请求的响应应该是:</p><pre class="kg kh ki kj gt oi of oj ok aw ol bi"><span id="14e8" class="nq mo iq of b gy om on l oo op">{<br/>  "data": {<br/>    "class": "Iris-virginica"<br/>  }, <br/>  "message": "Success"<br/>}</span></pre><p id="e1a2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">好了，我们的应用程序正恰当地服务于我们的请求。现在，我们可以检查数据是否安全可靠地到达我们的仪表板。</p><p id="ba3c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">重要的是要记住，数据不会随着每个请求的完成而立即发送。根据在<code class="fe oc od oe of b">.env</code>文件中定义的<code class="fe oc od oe of b">ROTATION_TIME</code>环境变量，它被定期发送。在本例中，它被设置为5分钟，这意味着在信息被发送到我们的仪表板之前，我们必须等待5分钟。然后，我们应该会从whylogs中看到一条消息，表明上传已经完成。</p><p id="f48e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上传完成后，收到的信息将在几分钟内显示在您的模型的仪表板上。从您的<a class="ae lr" href="https://hub.whylabsapp.com/models" rel="noopener ugc nofollow" target="_blank">型号的仪表板</a>中，您可以检查是否记录了任何配置文件，并访问您的摘要仪表板:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/6737a10f1bd5774a8e9ff736ab954bc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dSstkXQMXOnLYpzi"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="a3b6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">到目前为止，我们已经记录了1个配置文件和5个特征，这意味着数据正在通过。现在，让我们通过一个用例更深入地探索这个平台:我们将向我们的数据分布中添加一些异常值，并看看这是如何反映在我们的仪表板中的。</p><h1 id="ba25" class="mn mo iq bd mp mq nl ms mt mu nm mw mx jw nn jx mz jz no ka nb kc np kd nd ne bi translated">5.检测特征漂移</h1><p id="90c4" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">当事情出错时，任何可观察性平台的真正价值就会显现出来。事情可能以许多不同的方式出错，但是对于这个演示，让我们选择一个特定的方式:特性漂移。</p><p id="d236" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">机器学习环境中的漂移现象可能是一个冗长的主题，因此在这种情况下，我们将限制自己对特征漂移的基本定义:当模型输入的分布发生变化时。</p><p id="8a4c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将使用Iris数据集中的150个未改变的样本来表示每日批次的正态分布。然后，为了表示异常批次，我们将采用相同的样本集，除了我们将这些样本中的30个样本替换为一个随机输入要素的随机异常值。我们将继续请求具有如下输入要素的预测:</p><ul class=""><li id="be4f" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated"><strong class="kx ir">第1天</strong> —正常数据</li><li id="1517" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kx ir">第2天</strong> —修改数据(改变分布)</li><li id="86b9" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kx ir">第三天</strong> —正常数据</li></ul><p id="a2d1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面的代码片段将在不改变输入特性的情况下发出150个请求。第二天，我们简单地修改代码以传递<code class="fe oc od oe of b">data_mod</code>作为有效载荷，而不是<code class="fe oc od oe of b">data</code>(第35行)，然后重复这个过程。在这个演示中，离群值被添加到了<code class="fe oc od oe of b">sepal_width</code>特征中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="a344" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们简要地看一下我们控制面板中的一些部分。从<strong class="kx ir">输入</strong>页面，有许多有用的信息，如每批记录的数量、空分数和推断的特征类型。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/744558f0f2a996ab6f7dc075301285fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cdzZZfBNFoCXs-NS"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者Gif</p></figure><p id="1f3c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一条特别有用的信息是<strong class="kx ir">分布距离</strong>。这是一个时间序列，它显示了在所选日期范围内该特征与前一批数据的平均统计距离，使用<a class="ae lr" href="https://en.wikipedia.org/wiki/Hellinger_distance" rel="noopener ugc nofollow" target="_blank"> Hellinger距离</a>来估计分布之间的距离。通过在<code class="fe oc od oe of b">sepal_width</code>特征中添加异常值，我们不仅看到了<code class="fe oc od oe of b">sepal_width</code>特征本身的分布距离的变化，还看到了预测结果的变化。</p><blockquote class="os ot ou"><p id="a10f" class="kv kw ov kx b ky kz jr la lb lc ju ld ow lf lg lh ox lj lk ll oy ln lo lp lq ij bi translated">注意:对于剩余的特征，距离似乎在最后一天增加。这实际上是我的一个错误，因为我多发送了1条记录，总共151条记录。由于图中各要素之间的比例不同，因此这种变化的影响似乎很大，但是当检查值本身时，附加记录产生的分布距离为0.02。</p></blockquote><p id="4510" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以通过单击来进一步检查各个功能。从分布图中，我们可以看到漂移对<code class="fe oc od oe of b">class</code>和<code class="fe oc od oe of b">sepal_width</code>特征的影响。</p><p id="80b0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<strong class="kx ir">配置文件</strong>部分，我们可以选择多达3个数据集配置文件进行比较，这是一个非常酷的功能。在下面的图片中，我选择了一些特征进行比较。如前所述，添加异常值引起的变化也非常明显。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/276bdc1bccf819473eac2d69c861ab1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*edMGRdyaOJgbqCfY"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="91cd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">虽然我们不可能在这里讨论所有可用的特性，但我最喜欢的一些特性是:</p><ul class=""><li id="3ee4" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated">每个功能监视器的手动阈值配置</li><li id="925c" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">电子邮件/松弛时间的通知计划</li><li id="ec31" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">上传训练集作为基线参考集</li><li id="ece9" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">分析期间分段数据</li></ul><p id="044d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">请自行探索它们吧！</p><h1 id="4476" class="mn mo iq bd mp mq nl ms mt mu nm mw mx jw nn jx mz jz no ka nb kc np kd nd ne bi translated">6.结论</h1><p id="73c5" class="pw-post-body-paragraph kv kw iq kx b ky nf jr la lb ng ju ld le nh lg lh li ni lk ll lm nj lo lp lq ij bi translated">ML应用程序的部署后阶段给我们带来了无数的挑战，这些应用程序的故障排除过程仍然是非常手动和繁琐的。在这篇文章中，我们介绍了一个例子，说明如何通过WhyLabs提高系统的可观测性来减轻这一负担。</p><p id="d8e8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们讲述了一个简单的例子，基于众所周知的Iris数据集部署Flask应用程序进行分类，并使用whylogs数据记录库将其与WhyLabs平台集成。我们还通过在输入中注入异常值来模拟一个特性漂移场景，以便查看它是如何反映在我们的监控仪表板中的。尽管这是一个非常简单的用例，但是这个例子可以很容易地被修改以涵盖更多定制的场景。</p><p id="bd71" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">感谢您的阅读，如果您有任何问题/建议，请随时联系我们！如果你试用后有问题，我发现Slack 上的<a class="ae lr" href="https://communityinviter.com/apps/whylabs-community/whylabs-community" rel="noopener ugc nofollow" target="_blank"> WhyLabs社区非常有帮助，反应也很快。</a></p></div></div>    
</body>
</html>