<html>
<head>
<title>Stop Using CSVs for Storage — Pickle is an 80 Times Faster Alternative</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">停止使用CSV进行存储——泡菜是速度快80倍的替代品</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/stop-using-csvs-for-storage-pickle-is-an-80-times-faster-alternative-832041bbc199?source=collection_archive---------4-----------------------#2021-09-15">https://towardsdatascience.com/stop-using-csvs-for-storage-pickle-is-an-80-times-faster-alternative-832041bbc199?source=collection_archive---------4-----------------------#2021-09-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3cd1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">它还轻了2.5倍，并提供了每个数据科学家都必须知道的功能。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/12d53f92fbba9ffacde72ec5039994c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tsBtpoSAZE6ECZbVR_yHiQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@ktryna?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> KTRYNA </a>在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="aafe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将数据存储在云中会花费你一大笔钱。很自然，您会希望远离最广为人知的数据存储格式— CSV —并选择稍微轻松一些的格式。也就是说，如果您不关心动态查看和编辑数据文件。</p><p id="a7d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天，您将了解在Python中存储几乎任何东西的最简单的方法之一——Pickle。Pickling不仅限于数据集，您很快就会看到，但是本文中的每个示例都基于数据集。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bdc9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">泡菜到底是什么？</h1><p id="87ad" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在Python中，可以使用<code class="fe mz na nb nc b">pickle</code>模块来序列化对象并将它们保存到文件中。然后，您可以反序列化该序列化文件，以便在需要时重新加载它们。</p><p id="81e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pickle与其他格式相比有一个主要优势——可以用它来存储任何Python对象。没错，你不限于数据。最广泛使用的功能之一是在训练完成后保存机器学习模型。这样，您就不必在每次运行脚本时重新训练模型。</p><p id="486d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我也多次使用Pickle来存储Numpy数组。这是一个在代码中设置某种检查点<em class="nd">的简单解决方案。</em></p><p id="320c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">听起来是一种完美的存储格式？嗯，沉住气。Pickle有几个你应该知道的缺点:</p><ul class=""><li id="b6e9" class="ne nf it lb b lc ld lf lg li ng lm nh lq ni lu nj nk nl nm bi translated"><strong class="lb iu">不能保证跨语言支持</strong>——Pickle是特定于Python的，所以没人能保证你能阅读另一种编程语言的Pickle文件。</li><li id="d36b" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated"><strong class="lb iu">pickle文件是特定于Python版本的</strong>——当在一个Python版本中保存文件而在另一个版本中读取它们时，您可能会遇到问题。如果可能的话，尽量使用相同的Python版本。</li><li id="65b6" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated"><strong class="lb iu">酸洗不会压缩数据</strong> —酸洗一个对象不会压缩它。当然，与CSV相比，该文件会更小，但是您可以手动压缩数据以获得最大效率。</li></ul><p id="fa22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将很快看到一个压缩数据的解决方案。接下来让我们看看如何在Python中使用Pickle。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="52fe" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如何在Python中使用Pickle？</h1><p id="a818" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们从导入所需的库并创建一个相对较大的数据集开始。你需要熊猫、熊猫、泡菜和BZ2。您将使用最后一种方法进行数据压缩:</p><pre class="kj kk kl km gt ns nc nt nu aw nv bi"><span id="4305" class="nw md it nc b gy nx ny l nz oa">import numpy as np<br/>import pandas as pd<br/>import pickle<br/>import bz2<br/><br/>np.random.seed = 42<br/>df_size = 10_000_000<br/><br/>df = pd.DataFrame({<br/>    'a': np.random.rand(df_size),<br/>    'b': np.random.rand(df_size),<br/>    'c': np.random.rand(df_size),<br/>    'd': np.random.rand(df_size),<br/>    'e': np.random.rand(df_size)<br/>})<br/>df.head()</span></pre><p id="9a53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是数据集的外观:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ob"><img src="../Images/c16111282d79987b6efc7912cb5de61a.png" data-original-src="https://miro.medium.com/v2/format:webp/1*EV1AmgFOb68DBOwgqSClCQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片1-随机虚拟数据集(图片由作者提供)</p></figure><p id="748e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来就本地保存吧。您可以使用以下命令来清理数据帧:</p><pre class="kj kk kl km gt ns nc nt nu aw nv bi"><span id="f0fb" class="nw md it nc b gy nx ny l nz oa">with open('10M.pkl', 'wb') as f:<br/>    pickle.dump(df, f)</span></pre><p id="f5e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">文件现在保存在本地。您也可以用类似的方式阅读——只需将模式从<code class="fe mz na nb nc b">wb</code>更改为<code class="fe mz na nb nc b">rb</code></p><pre class="kj kk kl km gt ns nc nt nu aw nv bi"><span id="f9e1" class="nw md it nc b gy nx ny l nz oa">with open('10M.pkl', 'rb') as f:<br/>    df = pickle.load(f)</span></pre><p id="56e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太棒了。如前所述，默认情况下，Pickle不会进行任何压缩。您必须手动处理。Python让<code class="fe mz na nb nc b">bz2</code>模块变得非常简单:</p><pre class="kj kk kl km gt ns nc nt nu aw nv bi"><span id="1ba3" class="nw md it nc b gy nx ny l nz oa">with open('10M_compressed.pkl', 'wb') as f:<br/>    compressed_file = bz2.BZ2File(f, 'w')<br/>    pickle.dump(df, compressed_file)</span></pre><p id="e9c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这只是一行额外的代码，但它可以为您节省一些磁盘时间。储蓄过程会明显更长，但这是你必须接受的权衡。</p><p id="a6de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">读取压缩文件需要一行额外的代码:</p><pre class="kj kk kl km gt ns nc nt nu aw nv bi"><span id="d406" class="nw md it nc b gy nx ny l nz oa">with open('10M_compressed.pkl', 'rb') as f:<br/>    compressed_file = bz2.BZ2File(f, 'r')<br/>    df = pickle.load(compressed_file)</span></pre><p id="db68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只需确保不要弄乱文件模式，因为读取文件时提供<code class="fe mz na nb nc b">wb</code>会删除其所有内容。最好为读写操作编写助手函数，这样就不会把它们搞砸。</p><p id="781e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一节将介绍与CSV文件格式在文件大小、读取和写入时间方面的比较。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="002e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">CSV与泡菜-您应该使用哪一种？</h1><p id="6156" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">回答这个问题并不像看起来那么容易。当然，CSV提供了查看和编辑权限，任何人都可以打开它们。出于明显的原因，这也可能被视为一个不利因素。此外，您不能将机器学习模型保存到CSV文件中。</p><p id="a60a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不过，让我们在文件大小、读取和写入时间方面比较一下这两者。</p><p id="3440" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图显示了在本地保存最后一部分的数据帧所需的时间:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/cb94370b0de955009f13a827dd32dc41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ke1TbFtf6GtkdcYirApseQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图像2-CSV与Pickle本地保存时间(秒)(CSV:34.9；泡菜(压缩):32.7；泡菜:0.44)(作者图片)</p></figure><p id="b4da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你不在乎压缩，这大约是速度增加的80倍。</p><p id="46d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们来比较一下读取时间—读取不同格式的相同数据集需要多长时间:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/66e20c6ae32f3784fe754249df8a5f42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e8QF0Pyq6RMlzyKc3e5vpg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图像3-CSV与Pickle读取时间(秒)(CSV:3.71；泡菜(压缩):15.3；泡菜:0.339)(作者图片)</p></figure><p id="e475" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">泡菜在没有压缩的情况下，这次大约快11倍。在读取和保存文件时，压缩是一个巨大的难点。但是，让我们看看它能节省多少磁盘空间。</p><p id="3225" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是以下可视化的答案:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/9de00b1b262adae9c6e4e5ca6f90eeb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pl_FU835_FTUnCwHAKrtfw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图像4-CSV与Pickle文件大小对比，单位为MB(CSV:963.5；泡菜(压缩):381.8；泡菜:400)(作者图片)</p></figure><p id="ef84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与CSV相比，文件大小显著减小，但在这种情况下，压缩并没有节省太多磁盘空间。</p><p id="5816" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">概括地说，从CSV到Pickle有明显的优势。不完全明显的是，Pickle允许您存储其他对象——任何内置于Python、Numpy数组甚至机器学习模型中的对象。CSV和其他纯数据格式不具备这种能力。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="bd41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nd">你对泡菜有什么想法和经历？这是您对Python生态系统的常用格式吗？</em>以下留言请告知。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="1bbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">喜欢这篇文章吗？成为 <a class="ae ky" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="nd">中等会员</em> </a> <em class="nd">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="oe of gp gr og oh"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">通过我的推荐链接加入Medium-Dario rade ci</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">medium.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov ks oh"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d08d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">保持联系</h1><ul class=""><li id="ddf0" class="ne nf it lb b lc mu lf mv li ow lm ox lq oy lu nj nk nl nm bi translated">在<a class="ae ky" href="https://medium.com/@radecicdario" rel="noopener">媒体</a>上关注我，了解更多类似的故事</li><li id="2bf2" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">注册我的<a class="ae ky" href="https://mailchi.mp/46a3d2989d9b/bdssubscribe" rel="noopener ugc nofollow" target="_blank">简讯</a></li><li id="a1a8" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">在<a class="ae ky" href="https://www.linkedin.com/in/darioradecic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上连接</li></ul></div></div>    
</body>
</html>