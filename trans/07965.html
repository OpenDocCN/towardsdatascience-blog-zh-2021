<html>
<head>
<title>How We Track Machine Learning Experiments with MLFlow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们如何用MLFlow追踪机器学习实验</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-we-track-machine-learning-experiments-with-mlflow-948ff158a09a?source=collection_archive---------37-----------------------#2021-07-21">https://towardsdatascience.com/how-we-track-machine-learning-experiments-with-mlflow-948ff158a09a?source=collection_archive---------37-----------------------#2021-07-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1c76" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">正确跟踪你的机器学习实验比你想象的要容易</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6d21341247c654d6f4dbb71505274da6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4wwy7asY7iIjGmsNWYGyvQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:作者</p></figure><p id="26aa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当您建立机器学习模型时，通常会运行几十个或数百个实验来找到正确的输入数据、参数和算法。你做的实验越多，就越难记住什么有效，什么无效。</p><p id="9683" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有时你看到一个很好的结果，但是因为它需要几个小时或几天才能产生，你已经改变了代码。而现在你不记得你用什么参数得到那个结果了！</p><p id="fea7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当然，这是所有科学研究的永恒问题。这是一个传统上由实验室笔记本解决的问题:一本科学家仔细记录他们进行的每个实验的日志。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lr"><img src="../Images/14d9ec175ca7b26c9050adb94db41316.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*it6s0HeHo8k1QukA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">莱纳斯·鲍林实验笔记本的一页。来源:作者</p></figure><p id="65be" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">许多数据科学家遵循类似的方法，用数字或手工记录他们的实验。但这并不总是适用于机器学习。您需要跟踪三件事情:<a class="ae ls" href="https://datarevenue.com/en-blog/software-development-vs-machine-learning-engineering" rel="noopener ugc nofollow" target="_blank">数据、代码和模型</a>。即使你记笔记非常精确，也不可能把所有事情都完整地记录下来。</p><p id="dcd0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">幸运的是，您可以使用MLFlow自动跟踪实验。它不仅设置简单，而且很容易适应您现有的工作流程。</p><h1 id="6b48" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">什么是MLFlow？</h1><p id="86fa" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">MLFlow是一个广泛的机器学习平台，有几个组件。我们现在只关注它的实验跟踪特性。我们之前已经讨论过<a class="ae ls" href="https://datarevenue.com/en-blog/why-is-a-model-registry-valuable" rel="noopener ugc nofollow" target="_blank">模型注册中心以及它们为什么有价值</a>。实验跟踪和模型注册之间肯定有一些重叠，但它们并不相同。</p><h1 id="5c30" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">实验跟踪与模型注册</h1><p id="c569" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">模型注册是为系统经理准备的，关注于<strong class="kx ir">生产的模型</strong>。另一方面，实验跟踪工具是让科学家跟踪所有的实验，包括不成功的实验。</p><p id="5fb9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">注册中心跟踪并可视化这些模型的性能和相关元数据。但对于生产中的每个模型，通常都有数百次失败的尝试。实验跟踪是为科学家和研究人员设计的，有助于理解不成功和尚未成功的实验。通过确保工作不会丢失或重复，它使研究过程更有效率。</p><h1 id="02be" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">MLFlow的Python库和仪表盘</h1><p id="1f42" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">您将用于实验追踪的MLFlow的两个组件是其Web UI和Python库。您可以通过运行一个install命令来获得这两者:</p><p id="d1ed" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="mq"> pip安装mlflow </em></p><p id="5025" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通过运行<em class="mq"> mlflow ui </em>并在浏览器中访问<a class="ae ls" href="http://localhost:5000" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000 </a>，您可以立即查看所有实验所在的仪表板。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/515581fcb245a46fb5589670e2195252.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3LWAu1O_SHhH_Ajc.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">MLFlow仪表板的默认视图。来源:作者</p></figure><p id="ac81" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个仪表板已经有了一系列类似于实验室笔记本的功能:你可以做笔记，搜索以前的数据，并设置新的实验。</p><p id="c492" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当您将它与您刚刚安装的同一个<em class="mq"> mlflow </em> Python库结合使用时，事情会变得更加有趣。通过在现有的机器学习代码文件中添加几行代码，您可以轻松地跟踪每一次运行。这将自动保存您使用的参数、结果，甚至完整的模型二进制文件。</p><p id="5e3e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面的截图展示了如何用大约十行代码开始自动跟踪你的实验。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/6ebb1cfddf8a319d4439c2c705c6bcd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*R8YlrpBPcIweFvTk.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用MLFlow跟踪预测葡萄酒质量的代码。来源:作者</p></figure><p id="084c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">突出显示的行是特定于MLFlow的，而其余的是预测葡萄酒质量的标准scikit-learn示例。</p><p id="4722" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">每当您用这段代码运行一个实验时，它都会记录一个条目，您可以在仪表板中查看。请注意以下几点:</p><ul class=""><li id="e7dd" class="mt mu iq kx b ky kz lb lc le mv li mw lm mx lq my mz na nb bi translated">在Python代码中，我们引用了一个<em class="mq">实验id`。在UI中创建新实验后，您可以在仪表板中看到这一点。一个实验可以运行多次，因此每次尝试新的超参数或其他变化时，您都不需要新的实验ID。</em></li><li id="b94a" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">您现有的培训和评估代码需要在<em class="mq"> mlflow.start_run </em>块内。</li><li id="b8c5" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">您可以使用方法<em class="mq"> log_param、</em> <em class="mq"> log_metric </em>和<em class="mq"> sklearn.log_model </em>记录参数、度量和整个模型。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/5ad988213b3c25e8b69f8ca3b7378357.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*M8RMKLsBIluF2Rqb.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示两次运行的MLFlow仪表板。来源:作者</p></figure><p id="d55d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从这里，您可以随心所欲地更改参数，而不用担心忘记您已经使用了哪些参数。例如，在屏幕截图中，您可以看到MLFlow跟踪了两个实验的结果，在这两个实验中，我们更改了<em class="mq"> alpha </em>和<em class="mq"> l1_ratio </em>参数，从而很容易比较这些指标如何影响r2和rmse性能。</p><h1 id="0917" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">保存自由格式的笔记</h1><p id="026d" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">许多科学家保留自己的笔记本而不是使用结构化平台的原因是，他们觉得预先创建的模板不够灵活。</p><p id="eb8a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们喜欢MLFlow的一点是，您可以在不同的级别保存笔记:与整个实验或特定运行相关的笔记。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/80c3c9284182b37d1ecaa698e3b3c07c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*r4OezZJT2b_ePYxs.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">MLFlow的笔记功能。来源:作者</p></figure><h1 id="a070" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">MLFlow内部工作方式</h1><p id="6c10" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">MLFlow可以用不同的方式设置。您可以在本地完成，就像我们在上面的例子中所做的那样，或者在远程服务器上完成，这样您就可以在整个科学家团队之间共享一个仪表板。</p><p id="4b16" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您在本地安装它，您会注意到它在您执行Python代码的同一个目录中创建了一个名为“mlruns”的目录。在这个目录中，您可以找到完整的模型二进制文件(如<em class="mq">)。pkl </em>文件)。</p><p id="3e19" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您想要跟踪大量的模型，并且需要更多的空间，您可以配置MLFlow将这些文件存储在S3或另一个云存储提供商上。</p><h1 id="d185" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">扩展您的机器学习基础设施</h1><p id="36ca" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">我们使用MLFlow作为我们<a class="ae ls" href="https://github.com/datarevenue-berlin/OpenMLOps" rel="noopener ugc nofollow" target="_blank">开放式MLOps架构</a>的一部分。您可以单独使用MLFlow，但它也可以与其他MLOps组件配合使用，例如用于调度和管理任务的<a class="ae ls" href="https://datarevenue.com/en-blog/what-we-are-loving-about-prefect" rel="noopener ugc nofollow" target="_blank">提督</a>，以及用于轻松协作的基于云的Jupyter笔记本环境。</p><p id="bf17" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们喜欢讨论构建和跟踪机器学习模型的挑战。如果您想讨论您团队的机器学习方法，请联系我们。</p></div></div>    
</body>
</html>