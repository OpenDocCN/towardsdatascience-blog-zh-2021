<html>
<head>
<title>Monitoring and Observability in Cloud Native Architectures</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">云本地架构中的监控和可观察性</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/monitoring-and-observability-in-cloud-native-architectures-54e68e52b103?source=collection_archive---------34-----------------------#2021-08-18">https://towardsdatascience.com/monitoring-and-observability-in-cloud-native-architectures-54e68e52b103?source=collection_archive---------34-----------------------#2021-08-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a716" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为什么监控对于云原生应用程序至关重要？有哪些工具可以完成这项工作？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/39b98e931ceb84e8609432466781ee79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cwbUSR0kelw5wYsFlVwK8Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2030266" rel="noopener ugc nofollow" target="_blank">皮克斯拜</a>的康斯坦丁·科洛索夫拍摄</p></figure><p id="99f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想象一下被囚禁在一个没有窗户、没有日历和挂钟的牢房里。此外，你没有访客，你唯一的同伴是一个不喜欢闲聊的警卫。我知道这是一个非常黑暗的场景，但是请原谅我。</p><p id="9fa3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你有一个目标:找出季节(例如，夏天或秋天)以及外面是白天还是晚上。你怎么能这样做？你可以观察警卫的行为，他穿什么，吃什么食物，他晒黑了吗？如果他戴着太阳镜，那么也许现在是夏天，外面阳光明媚。如果他穿着外套，那么也许我们正处于隆冬。这就是我们所说的黑箱监控。</p><p id="671b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">历史上，我们使用黑盒监控来推断问题的原因。我们有磁盘错误吗？我们是否观察到CPU使用率的峰值？但是试图通过监控系统的间接数据来提高应用程序的性能并不是理想的方法。我们可以做得更好！让我们打开一扇窗，要求我们应得的电话。</p><p id="7993" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个故事介绍了我们现在可以用来监控云原生应用程序性能的工具，以及如何将它们安装在Kubernetes集群中。在另一个故事中，我们将看到如何正确地使用它们来构建一个仪表板，它可以揭示我们的宠物项目内部正在发生的事情。</p><blockquote class="lv lw lx"><p id="c380" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><a class="ae ky" href="https://www.dimpo.me/newsletter?utm_source=medium&amp;utm_medium=article&amp;utm_campaign=monitoring" rel="noopener ugc nofollow" target="_blank"> Learning Rate </a>是一份时事通讯，面向那些对AI和MLOps世界感到好奇的人。你会在每周五收到我关于最新人工智能新闻和文章的更新和想法。订阅<a class="ae ky" href="https://www.dimpo.me/newsletter?utm_source=medium&amp;utm_medium=article&amp;utm_campaign=monitoring" rel="noopener ugc nofollow" target="_blank">这里</a>！</p></blockquote></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="ff5a" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">监控与可观察性</h1><p id="615f" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在本文中，我们关心的是工程师方面的情况。因此，当错误发生时，开发人员需要正确的反馈，以便他们知道应该修复什么。他们可以通过正确的监控和观察工具来实现。但是有什么区别呢？</p><blockquote class="ng"><p id="1093" class="nh ni it bd nj nk nl nm nn no np lu dk translated"><strong class="ak">我们监控系统并观察应用</strong></p></blockquote><h2 id="4cdf" class="nq mk it bd ml nr ns dn mp nt nu dp mt li nv nw mv lm nx ny mx lq nz oa mz ob bi translated">监视</h2><p id="999b" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在监控中，我们关注的是系统本身。例如，在云环境中，系统很可能是一个Kubernetes集群。然而，监控不会告诉我们应用程序内部发生了什么。它会给出诸如内存可用性低之类的指标，但它不会帮助我们查明问题的原因。</p><h2 id="44cc" class="nq mk it bd ml nr oc dn mp nt od dp mt li oe nw mv lm of ny mx lq og oa mz ob bi translated">可观察性</h2><p id="3919" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在可观察性中，我们可以直接进入我们的应用程序，观察它的各种过程和功能。我们可以看到服务如何执行以及它们如何交互。然后，我们可以揭示几个问题或发现优化，使我们的应用程序性能更好。</p><p id="8261" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据经验，请记住:<strong class="lb iu">我们监控系统并观察应用</strong>。你还会听到人们使用术语<em class="ly">可观测性</em>来对这两个概念进行分组(即监控<em class="ly">和</em>可观测性)。</p><h1 id="bff3" class="mj mk it bd ml mm oh mo mp mq oi ms mt jz oj ka mv kc ok kd mx kf ol kg mz na bi translated">可观察性工具</h1><p id="76a8" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">专家们常用的堆栈可观测性包括<a class="ae ky" href="https://prometheus.io/" rel="noopener ugc nofollow" target="_blank">普罗米修斯</a>、<a class="ae ky" href="https://grafana.com/" rel="noopener ugc nofollow" target="_blank">格拉夫纳</a>和<a class="ae ky" href="https://www.jaegertracing.io/" rel="noopener ugc nofollow" target="_blank">耶格</a>。</p><p id="7a6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Prometheus是领先的开源监控解决方案。它是由SoundCloud在2012年创建的，属于云本地计算基金会(CNCF)。Prometheus收集系统信息，有一个时间序列数据库和自己的查询语言，称为PromQL。此外，普罗米修斯有自己的内置警报工具。</p><p id="d756" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">优步在2015年创造了耶格，它也属于CNCF。与Prometheus不同，Jaeger收集应用程序信息，并提供分布式跟踪系统。</p><p id="2fa4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Grafana是一个可视化平台，允许您构建直观的仪表板。它支持时序数据库，因此经常与Prometheus捆绑在一起。而且，你可以用插件来扩展Grafana。</p><h1 id="c02c" class="mj mk it bd ml mm oh mo mp mq oi ms mt jz oj ka mv kc ok kd mx kf ol kg mz na bi translated">装置</h1><p id="ea97" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">要使用这些工具，我们需要将它们安装在Kubernetes集群中。因此，首先，要生成一个Kubernetes实例，我们可以使用<a class="ae ky" href="https://k3s.io/" rel="noopener ugc nofollow" target="_blank"> K3s </a>。要安装K3s，请执行以下命令:</p><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="0974" class="nq mk it on b gy or os l ot ou">curl -sfL https://get.k3s.io | sh -<br/># Check for Ready node, takes maybe 30 seconds<br/>k3s kubectl get node</span></pre><p id="300f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将使用头盔安装普罗米修斯和格拉夫纳。所以，让我们安装头盔:</p><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="dd6b" class="nq mk it on b gy or os l ot ou">curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash</span></pre><p id="bf5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了在我们的应用程序和可观察性堆栈之间创建一些分离，我们可以创建一个新的名称空间。姑且称之为<em class="ly">监控</em>:</p><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="660d" class="nq mk it on b gy or os l ot ou">kubectl create namespace monitoring</span></pre><p id="1f5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在准备安装普罗米修斯。执行以下命令:</p><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="25d4" class="nq mk it on b gy or os l ot ou">helm repo add prometheus-community <a class="ae ky" href="https://prometheus-community.github.io/helm-charts" rel="noopener ugc nofollow" target="_blank">https:<em class="ly">//prometheus-community.github.io/helm-charts</em></a></span><span id="42a7" class="nq mk it on b gy ov os l ot ou">helm repo add stable <a class="ae ky" href="https://charts.helm.sh/stable" rel="noopener ugc nofollow" target="_blank">https:<em class="ly">//charts.helm.sh/stable</em></a></span><span id="26e7" class="nq mk it on b gy ov os l ot ou">helm repo update</span><span id="420e" class="nq mk it on b gy ov os l ot ou">helm install prometheus prometheus-community/kube-prometheus-stack --namespace monitoring --kubeconfig /etc/rancher/k3s/k3s.yaml</span></pre><p id="f0b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要验证您的安装，运行<code class="fe ow ox oy on b">kubectl get pods -n monitoring</code>。您应该会看到6个豆荚即将准备就绪。您现在可以运行端口转发命令来查看Grafana仪表板:</p><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="c121" class="nq mk it on b gy or os l ot ou">kubectl port-forward prometheus-grafana-5855d975d8-495bn --address 0.0.0.0 3000:3000 -n monitoring</span></pre><p id="0548" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导航到<code class="fe ow ox oy on b">127.0.0.1:3000</code>；用户名为<code class="fe ow ox oy on b">admin</code>，默认密码为<code class="fe ow ox oy on b">prom-operator</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/b7cf28551d4514225a2da385d79285e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R0oGIFtn6K3vU8GqJE6bkg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">欢迎来到Grafana——作者图片</p></figure><p id="ade1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，让我们在集群中安装Jaeger。我们将使用官方<a class="ae ky" href="https://github.com/jaegertracing/jaeger" rel="noopener ugc nofollow" target="_blank"> Jaeger GitHub仓库</a>中的文件。为了安装Jaeger，我们将创建一个新的<em class="ly">可观察性</em>名称空间:</p><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="621c" class="nq mk it on b gy or os l ot ou">kubectl create namespace observability</span></pre><p id="8baa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，运行以下命令:</p><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="2de7" class="nq mk it on b gy or os l ot ou">kubectl create -f <a class="ae ky" href="https://raw.githubusercontent.com/jaegertracing/jaeger-operator/master/deploy/crds/jaegertracing.io_jaegers_crd.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/jaegertracing/jaeger-operator/master/deploy/crds/jaegertracing.io_jaegers_crd.yaml</a></span><span id="205a" class="nq mk it on b gy ov os l ot ou">kubectl create -n observability -f <a class="ae ky" href="https://raw.githubusercontent.com/jaegertracing/jaeger-operator/master/deploy/service_account.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/jaegertracing/jaeger-operator/master/deploy/service_account.yaml</a></span><span id="c85d" class="nq mk it on b gy ov os l ot ou">kubectl create -n observability -f <a class="ae ky" href="https://raw.githubusercontent.com/jaegertracing/jaeger-operator/master/deploy/role.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/jaegertracing/jaeger-operator/master/deploy/role.yaml</a></span><span id="6144" class="nq mk it on b gy ov os l ot ou">kubectl create -n observability -f <a class="ae ky" href="https://raw.githubusercontent.com/jaegertracing/jaeger-operator/master/deploy/role_binding.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/jaegertracing/jaeger-operator/master/deploy/role_binding.yaml</a></span><span id="39c0" class="nq mk it on b gy ov os l ot ou">kubectl create -n observability -f <a class="ae ky" href="https://raw.githubusercontent.com/jaegertracing/jaeger-operator/master/deploy/operator.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/jaegertracing/jaeger-operator/master/deploy/operator.yaml</a></span></pre><p id="fac0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！现在您已经有了一个安装了行业标准可观察性工具的Kubernetes集群。</p><h1 id="ef88" class="mj mk it bd ml mm oh mo mp mq oi ms mt jz oj ka mv kc ok kd mx kf ol kg mz na bi translated">序</h1><p id="e890" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在这个故事中，我们看到了什么是黑盒监控，以及它与白盒监控的对比。我们看到了什么是可观察性和监控，它们的区别，以及它们带来了什么。</p><p id="84a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们看到了如何创建一个Kubernetes集群并安装Prometheus、Jaeger和Grafana，它们是用于监视和观察的行业标准工具。</p><p id="738f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在后面的故事中，我们将看到如何正确地使用它们来构建一个仪表板，它可以揭示我们的宠物项目内部正在发生的事情。</p><h1 id="5c44" class="mj mk it bd ml mm oh mo mp mq oi ms mt jz oj ka mv kc ok kd mx kf ol kg mz na bi translated">关于作者</h1><p id="d45b" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我的名字是<a class="ae ky" href="https://www.dimpo.me/?utm_source=medium&amp;utm_medium=article&amp;utm_campaign=monitoring" rel="noopener ugc nofollow" target="_blank">迪米特里斯·波罗普洛斯</a>，我是一名为<a class="ae ky" href="https://www.arrikto.com/" rel="noopener ugc nofollow" target="_blank">阿里克托</a>工作的机器学习工程师。我曾为欧洲委员会、欧盟统计局、国际货币基金组织、欧洲央行、经合组织和宜家等主要客户设计和实施过人工智能和软件解决方案。</p><p id="2bc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有兴趣阅读更多关于机器学习、深度学习、数据科学和数据操作的帖子，请关注我的<a class="ae ky" href="https://towardsdatascience.com/medium.com/@dpoulopoulos/follow" rel="noopener" target="_blank"> Medium </a>、<a class="ae ky" href="https://www.linkedin.com/in/dpoulopoulos/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或Twitter上的<a class="ae ky" href="https://twitter.com/james2pl" rel="noopener ugc nofollow" target="_blank"> @james2pl </a>。</p><p id="5c00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所表达的观点仅代表我个人，并不代表我的雇主的观点或意见。</p></div></div>    
</body>
</html>