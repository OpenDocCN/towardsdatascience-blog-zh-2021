<html>
<head>
<title>The Battle of Interactive Geographic Visualization Part 3- Plotly Graph Objects (Go)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">交互式地理可视化之战第三部分:Plotly 图形对象(Go)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-battle-of-interactive-geographic-visualization-part-3-plotly-graph-objects-go-c3d3f2a00132?source=collection_archive---------36-----------------------#2021-12-14">https://towardsdatascience.com/the-battle-of-interactive-geographic-visualization-part-3-plotly-graph-objects-go-c3d3f2a00132?source=collection_archive---------36-----------------------#2021-12-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="0b12" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">PYTHON。数据科学。地理可视化。</h2><div class=""/><div class=""><h2 id="be07" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">充分利用 Plotly 对日益增长的地理可视化需求的响应</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/27399c295705fa06b27efbae40ecc8a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GuJ17oCMYqlyM4eg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@drewmark?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">安德鲁·斯图特斯曼</a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="4181" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">我们离开的地方</h1><p id="55d2" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">在本系列的第一部分:<a class="ae lh" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-1-interactive-geoplot-using-one-line-of-8214e9ed1bb4">交互式地理可视化之战第 1 部分—使用一行代码的交互式 geo plot</a>，我们讨论了地理可视化对于以地理为特征的数据科学项目的重要性。通过一行命令，我们讨论了如何使用<strong class="mc jd"> Holoviews </strong>交互绘制。</p><p id="309a" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">在<a class="ae lh" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-2-interactive-geoplot-using-one-line-of-2118af59a77c">上一篇文章</a>中，我们讨论了如何使用 Plotly express 绘制相同的数据集。虽然在语法方面易于理解，但 Plotly express 缺乏可以定制我们的绘图的高级工具和命令。</p><p id="4ec2" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">在本文中，我们将看到 Plotly 有一种方法来弥合这些需求，但使用了不同的包—<strong class="mc jd">Plotly Graph Object(Plotly go)</strong>。</p><h1 id="348d" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">PLOTLY GRAPH OBJECTS (GO)与 PLOTLY EXPRESS</h1><p id="56bf" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">在这篇文章中，我们不会详细讨论为什么这个模块被称为<em class="nb"> graph objects </em>，而是直接将它与上一篇文章中我们已经知道的内容进行比较。(<em class="nb">关于 graph_objects 的技术细节的详细解释可以在</em> <a class="ae lh" href="https://plotly.com/python/graph-objects/" rel="noopener ugc nofollow" target="_blank"> <em class="nb">这里</em> </a> <em class="nb">找到。</em>)</p><p id="7345" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">在不使事情变得太复杂的情况下，plotly 和<code class="fe nc nd ne nf b">plotly express</code>的<code class="fe nc nd ne nf b">graph_objects</code>模块可以生成相同的基本图形。这里的关键词是“基本”。</p><p id="02ec" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">这意味着你可以用 plotly express 做的任何事情，你都可以用<code class="fe nc nd ne nf b">graph_objects</code>模块来做，尽管它不仅仅是一行程序。正如我们在上一篇文章中所解释的，plotly express 旨在拥有更简单的语法，同时保留大部分 plotly 功能。</p><p id="f771" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">然而，反过来就不正确了:并不是所有使用<code class="fe nc nd ne nf b">graph_objects</code>模块可以做的事情在 plotly express 中都是可行的。这只是简单性和定制能力之间的权衡。</p><p id="f85a" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">不多说了，让我们开始编码吧！</p><h1 id="128a" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">编码</h1><h2 id="354b" class="ng lj it bd lk nh ni dn lo nj nk dp ls mj nl nm lu mn nn no lw mr np nq ly iz bi translated">预赛</h2><pre class="ks kt ku kv gt nr nf ns nt aw nu bi"><span id="2ab1" class="ng lj it nf b gy nv nw l nx ny">import plotly.graph_objects as go<br/>import pandas as pd</span></pre><h2 id="0684" class="ng lj it bd lk nh ni dn lo nj nk dp ls mj nl nm lu mn nn no lw mr np nq ly iz bi translated">加载数据集</h2><p id="f7e0" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">加载相同的数据集，我们有:</p><pre class="ks kt ku kv gt nr nf ns nt aw nu bi"><span id="096d" class="ng lj it nf b gy nv nw l nx ny">df = pd.read_csv('data/Coffee Brands Footprint.csv',<br/>                index_col=0)<br/>df.head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nz"><img src="../Images/e6531271c629528f88c4302ce7aab098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kwd22FLe9AHzaVXqdiXcjw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片:我们数据集的前五次观察。</p></figure><h2 id="9d65" class="ng lj it bd lk nh ni dn lo nj nk dp ls mj nl nm lu mn nn no lw mr np nq ly iz bi translated">颜色词典</h2><p id="119a" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">为每个品牌建立我们想要的颜色:</p><pre class="ks kt ku kv gt nr nf ns nt aw nu bi"><span id="ff8c" class="ng lj it nf b gy nv nw l nx ny">color_dict = dict(zip(list(df.brand.unique()),<br/>                      ['rosybrown', 'palegreen', 'indianred', 'brown']))</span></pre><h2 id="b674" class="ng lj it bd lk nh ni dn lo nj nk dp ls mj nl nm lu mn nn no lw mr np nq ly iz bi translated">主代码</h2><pre class="ks kt ku kv gt nr nf ns nt aw nu bi"><span id="2764" class="ng lj it nf b gy nv nw l nx ny">fig = go.Figure(data=go.Scattergeo(<br/>        lon = df['lng'],<br/>        lat = df['lat'],<br/>        text = df['vicinity'],<br/>        mode = 'markers',<br/>        marker = dict(<br/>            size = 8,<br/>            opacity = 0.8,<br/>            reversescale = True,<br/>            autocolorscale = False,<br/>            color=[color_dict[x] for x in df['brand']],<br/>            symbol = 'circle',<br/>            line = dict(<br/>                width=1,<br/>                color='rgba(102, 102, 102)'<br/>            )        )))</span></pre><p id="374b" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">让我们解释一下上面的代码部分:</p><ul class=""><li id="9a42" class="oa ob it mc b md mw mg mx mj oc mn od mr oe mv of og oh oi bi translated">走吧。Scattergeo 将提供的参数转换成 graph 对象，该对象将由<code class="fe nc nd ne nf b">go.Figure</code>参数使用</li><li id="2e55" class="oa ob it mc b md oj mg ok mj ol mn om mr on mv of og oh oi bi translated"><code class="fe nc nd ne nf b">go.Figure</code>的争论改变了我们的走向。将地理对象分散成实际图形</li><li id="84c1" class="oa ob it mc b md oj mg ok mj ol mn om mr on mv of og oh oi bi translated">我们将它存储在变量 fig 中，以便该对象可以接收我们想要实现的定制。</li></ul><p id="8efa" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">要查看这个图形，请调用 show()方法。</p><pre class="ks kt ku kv gt nr nf ns nt aw nu bi"><span id="4390" class="ng lj it nf b gy nv nw l nx ny">fig.show()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oo"><img src="../Images/d332027557ffd200f6bef8cb47248d7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2eRiBqQxuPz3j5encXmeqA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者提供的图像:生成的底图类似于 Plotly Expres 的底图</p></figure><p id="9ae4" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">现在我们已经有了基本地图，让我们添加一些自定义！</p><h1 id="b9c7" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">定制 1 —增加布局</h1><p id="92a9" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">为了增加版面，我们将访问<code class="fe nc nd ne nf b">update_layout</code>模块。</p><pre class="ks kt ku kv gt nr nf ns nt aw nu bi"><span id="a0e5" class="ng lj it nf b gy nv nw l nx ny">fig.update_layout(height=600, margin={"r":0,"t":0,"l":0,"b":0})<br/>fig.show()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi op"><img src="../Images/916f78b1f5f6792fafafc5605f76ba59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qe8EGQNXHB8rjxYUHofzBA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者提供的图片:更新了布局尺寸的底图</p></figure><h1 id="736e" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">自定义 2-地图的缩放和居中</h1><p id="d3b4" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">回想一下，在我们上次的更新中，我们发现很难将我们的地图放在菲律宾的中心，因此，我们总是需要缩放很多次才能看到我们想要的位置(例如菲律宾)。</p><p id="a20e" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">使用 Plotly Go，我们已经可以做到这一点。</p><p id="9d2a" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">首先，我们把范围限制在“亚洲”。</p><pre class="ks kt ku kv gt nr nf ns nt aw nu bi"><span id="812c" class="ng lj it nf b gy nv nw l nx ny">fig.update_geos(<br/>    visible=False, resolution=50, scope="asia",<br/>    showcountries=True, countrycolor="Black",<br/>    showsubunits=True, subunitcolor="Blue"<br/>)</span><span id="1f91" class="ng lj it nf b gy oq nw l nx ny">fig.show()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oo"><img src="../Images/a362ae7e3fbd180951731f4ed48fe007.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PayGg83k_9TwRw35oaTtMA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片:更新范围的地图</p></figure><p id="3dc6" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">接下来，我们可以添加使地图以菲律宾、经度和纬度为中心的参数。回想一下，我们在之前的帖子中已经为此指定了代码。</p><pre class="ks kt ku kv gt nr nf ns nt aw nu bi"><span id="eadd" class="ng lj it nf b gy nv nw l nx ny">from geopy.geocoders import Nominatim<br/>geolocator = Nominatim(user_agent="geocoder") #Do not forget to put in the user_agent argument<br/>location = geolocator.geocode("Philippines")<br/>print((location.latitude, location.longitude))</span></pre><p id="e194" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">接下来，参数<code class="fe nc nd ne nf b">projection_scale</code>类似于 Mapbox 的缩放参数(我们将有单独的文章讨论)。摆弄这些信息给了我们:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi or"><img src="../Images/d006d225dfda9dd7584d79ae1b1e7be0.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*iXGqj6MoHC_pH0Jrf1T2MA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者提供的图像:应用于底图的投影比例</p></figure><h1 id="21e5" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">定制 3-地图的背景</h1><p id="3d62" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">最后，Plotly go 的另一个可能的定制是底图的定制。使用此选项，可以对地图元素进行定制，例如是否显示海洋、陆地、湖泊等。以及它们的颜色。</p><p id="0ae6" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">使用<code class="fe nc nd ne nf b">update_geos</code>方法:</p><pre class="ks kt ku kv gt nr nf ns nt aw nu bi"><span id="9a5e" class="ng lj it nf b gy nv nw l nx ny">fig.update_geos(<br/>    resolution=50,<br/>    showcoastlines=True, coastlinecolor="RebeccaPurple",<br/>    showland=True, landcolor="#C1E1C1",<br/>    showocean=True, oceancolor="#99cccc",<br/>    showlakes=True, lakecolor="Blue",<br/>    showrivers=True, rivercolor="Blue"<br/>)</span><span id="49e4" class="ng lj it nf b gy oq nw l nx ny">fig.show()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi os"><img src="../Images/b61d4dda1373a791fae6541bd467fcb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U7b14lIb6KyodLnKi69ohw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">按作者分类的图像:应用于地图的背景</p></figure><p id="8213" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">颜色参数可以提供十六进制或 RGB 代码，以便更好地定制。</p><h1 id="e946" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">最终图形</h1><p id="e71c" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">下面，我们将看到最终的图表，以及它的交互功能:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi os"><img src="../Images/83b2787333884ff5929f5296641b0187.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*7GMPe07AerMH_Klfz4rZtg.gif"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者 GIF:最终输出</p></figure><h1 id="2ad4" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">结束语</h1><p id="1b59" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">Plotly 图形对象真正是 Plotly 进入交互式可视化的战斗。通过交换我们在 Plotly express 中看到的一些简单性，我们可以对我们的交互式地图进行更多的定制。</p><p id="f527" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我鼓励我们的读者尝试其他功能，如定制您自己的地图框图块并与 Plotly go 一起使用，以及使用定制标记。</p><p id="0719" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">在下一篇文章中，我们将探索另一种交互式地理空间可视化。敬请期待！</p><p id="91fb" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">查看我的其他文章:</p><p id="47fc" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-1-interactive-geoplot-using-one-line-of-8214e9ed1bb4">交互式地理可视化之战第一部分——使用一行代码的交互式 geo plot</a></p><p id="85a0" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/the-battle-of-interactive-geographic-visualization-part-2-interactive-geoplot-using-one-line-of-2118af59a77c">交互式地理可视化之战第二部分——使用一行代码的交互式地理地图</a></p><p id="0ca4" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/calculating-the-distance-between-two-locations-using-geocodes-1136d810e517?source=your_stories_page----------------------------------------">使用地理编码计算两个位置之间的距离</a></p><p id="2f9f" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/generating-geocodes-using-google-maps-api-eb56028821a6?source=your_stories_page----------------------------------------">使用谷歌地图 API 生成地理编码</a></p><p id="529b" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/mapping-your-favorite-coffee-shop-in-the-philippines-using-google-places-api-and-folium-2f9d5ad697bf?source=your_stories_page----------------------------------------">使用 Google Places API 和 fluous 为您在菲律宾最喜欢的咖啡店绘制地图</a></p></div></div>    
</body>
</html>