<html>
<head>
<title>Stationarity Assumption in Time Series Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列数据的平稳性假设</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/stationarity-assumption-in-time-series-data-67ec93d0f2f?source=collection_archive---------10-----------------------#2021-07-04">https://towardsdatascience.com/stationarity-assumption-in-time-series-data-67ec93d0f2f?source=collection_archive---------10-----------------------#2021-07-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e1e3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">平稳性假设重要吗，我们该怎么做？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/eb6339383028b4f2e8815f020986a137.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5ipY1hFf1aPrBK2f06V9Sw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">萨曼莎·加德斯在<a class="ae ky" href="https://unsplash.com/s/photos/time?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="3ae7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我进行时间序列分析时，平稳性总是我遇到的术语。当我遇到这个学期时，我脑子里有许多问题。什么被认为是平稳数据？我们需要关心平稳性假设吗？如果我们需要，我们应该做什么？</p><h1 id="74f4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">什么是平稳数据？</h1><p id="0474" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">平稳数据是指均值和方差不随时间变化的<strong class="lb iu">时间序列数据</strong>。如果从数据中观察到<strong class="lb iu">强趋势或季节性</strong>，则数据被认为是非平稳的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/89df389cc507b388082a21938b85bcfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F8ae28yr9MFkxa0Ms5BbrA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://otexts.com/fpp2/" rel="noopener ugc nofollow" target="_blank">预测:原理与实践</a></p></figure><p id="cf29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上图所示从<a class="ae ky" href="https://otexts.com/fpp2/stationarity.html" rel="noopener ugc nofollow" target="_blank">这里</a>，只有(b)和(g)被认为是静止的。</p><p id="0c3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">观察到的明确趋势</strong> : a、c、e、f、I</p><p id="57c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">观察到明显的季节性</strong> : d、h、I</p><p id="529c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(g)乍一看显示了一些周期性运动，但实际上它具有不同的循环时间周期，因此仍然被认为是静止的。如何检测时间序列数据中的平稳性的更详细的方法将在后面的文章中介绍。</p><h1 id="3f89" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">平稳性对时间序列分析重要吗？</h1><p id="a140" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在大多数情况下，这很重要。这是因为许多统计分析或模型<strong class="lb iu">是建立在均值和方差随时间保持一致的假设上</strong>。</p><p id="27f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们用平稳模型来拟合我们想要分析的时间序列数据时，我们应该检测数据的平稳性，并从数据中去除趋势/季节性效应。</p><p id="3ec8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">许多当前的时间序列模型，如ARIMA，可以选择包括将原始数据转换成平稳数据的步骤，或者使我们的生活更加方便。然而，如果我们能够理解数据的平稳性，以便我们能够<strong class="lb iu">为模型</strong>提供更好的输入，这仍然是有益的。</p><h1 id="586c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">我们使用的数据:</h1><p id="262b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">正如我在我的另一篇文章<a class="ae ky" rel="noopener" target="_blank" href="/how-to-predict-your-step-count-for-next-week-a16b7800b408">这里</a>中介绍的，我使用的是来自苹果健康的我自己的计步数据。可以参考这个<a class="ae ky" href="http://www.markwk.com/data-analysis-for-apple-health.html" rel="noopener ugc nofollow" target="_blank">链接</a>下载自己的苹果健康数据，开始一些很酷的分析。</p><h1 id="22f3" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">我们如何知道数据是否是平稳的？</h1><h2 id="03ab" class="mt lw it bd lx mu mv dn mb mw mx dp mf li my mz mh lm na nb mj lq nc nd ml ne bi translated">方法一:看图表</h2><p id="98c5" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">最简单方便的方法就是直接看图表，看是否有明显的趋势或者观察到的季节性。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/a3c50cdd5d6b2d217b48996c8e147783.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MoeF-Y1-4iNgqzoFPqSlfA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我自己的步数可视化</p></figure><p id="ab53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你从我自己的步数图表中看到的，从2020年开始有一个明显的向下移动的趋势，这使得数据不是那么稳定。有时很难区分，你可以选择使用<a class="ae ky" href="https://www.statsmodels.org/stable/generated/statsmodels.tsa.seasonal.seasonal_decompose.html" rel="noopener ugc nofollow" target="_blank">季节性分解</a>包<strong class="lb iu">将主图表分解成趋势和季节性</strong>。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="d77c" class="mt lw it nh b gy nl nm l nn no">import statsmodels.api as sm<br/>extract=train.set_index('date')<br/>from pylab import rcParams<br/>rcParams['figure.figsize'] = 18, 8<br/>decomposition = sm.tsa.seasonal_decompose(extract, model='additive')<br/>fig = decomposition.plot()<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/5b780fc83dcf8645c0b823f933975372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e81XRhhQhDUQ9Hqwo5iyAg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">季节性分解图</p></figure><p id="2816" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将原始时间序列图分解为趋势图、季节图和残差图。从这张图上你可以看到更清晰的趋势变化模式。</p><h2 id="c88b" class="mt lw it bd lx mu mv dn mb mw mx dp mf li my mz mh lm na nb mj lq nc nd ml ne bi translated">方法2:统计方法——扩展的Dickey-Fuller检验</h2><p id="ead1" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果您仍然不能从直接图或分解图中确定平稳性。扩展的Dickey-Fuller检验或ADF检验是确定时间序列数据是否平稳的最流行的统计方法之一。</p><p id="3387" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">增强的迪基-富勒测试是迪基-富勒测试的增强版本。它测试预测Y值与时间滞后项和滞后差分项之间的<strong class="lb iu">相关性，如下所示。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/90a49ad30155af24296cd77b9edf05a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rDr9vqGsVPHGwPolBp49tA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">AFD测试公式</p></figure><p id="8b6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Python中，我们可以直接使用statsmodels的<a class="ae ky" href="https://www.statsmodels.org/stable/generated/statsmodels.tsa.stattools.adfuller.html" rel="noopener ugc nofollow" target="_blank"> adfuller包</a>来查看数据在不同的显著性水平上是否平稳。让我们对步数数据进行ADF测试，看看它是否是稳定的。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="5104" class="mt lw it nh b gy nl nm l nn no">from statsmodels.tsa.stattools import adfuller<br/>result = adfuller(weekly.value)<br/>print('ADF Statistic: %f' % result[0])<br/>print('p-value: %f' % result[1])<br/>print('Critical Values:')<br/>for key, value in result[4].items():<br/> print('\t%s: %.3f' % (key, value))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/9537a4f456f289402d78c95d67cd333d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*KHq7zySG-9t5J2Y_sk2fHQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ADF结果</p></figure><p id="7e04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从上面的结果可以看出，p值略高于0.05，这意味着我的步数数据在1%或5%的显著性水平上是非平稳的。您还可以将ADF统计数据与不同显著性水平的临界值进行比较。与临界值相比，<strong class="lb iu">ADF统计值越负，数据就越稳定</strong>。</p><h1 id="5c2e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">如果我的数据不稳定，我该怎么办？</h1><p id="55cc" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">最常见的解决方案是差分。这意味着您<strong class="lb iu">对后续时间序列值之间的差异建模，而不是对值本身建模</strong>。这是因为差异通常可以消除趋势或季节性的影响。另外，如果一阶差分(扣一次)不行，可以试试二阶差分(扣两次)。</p><p id="a6d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">原始数据:</strong> Y0，Y1，Y2</p><p id="39ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">一阶差分:</strong> (Y1-Y0)，(Y2-Y1)</p><p id="7b1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">二阶差分:</strong> ((Y2-Y1)-(Y1-Y0))</p><p id="a4b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将差分方法应用于我们的步数数据，看看会发生什么。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="9621" class="mt lw it nh b gy nl nm l nn no">#calculate first order differencing value<br/>first_order_diff=weekly.value.diff()</span><span id="d297" class="mt lw it nh b gy ns nm l nn no">#remove na value due to differencing<br/>first_order_diff=first_order_diff.dropna()</span><span id="5b18" class="mt lw it nh b gy ns nm l nn no">#ADF test<br/>result = adfuller(first_order_diff)<br/>print('ADF Statistic: %f' % result[0])<br/>print('p-value: %f' % result[1])<br/>print('Critical Values:')<br/>for key, value in result[4].items():<br/> print('\t%s: %.3f' % (key, value))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/6470ba629157d7a5c225e382a6395b35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*wIa0dhBIIIoFdDzOCreblw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">差异后的ADF测试结果</p></figure><p id="42ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们从上面的结果中看到的，在一阶差分后，p值已经下降到0.01以下，数据已经转换为严格平稳。</p><h1 id="c7ec" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">我们如何在ARIMA模型中应用平稳性？</h1><p id="250f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">“I”在ARIMA的意思是“集成的”,它指的是获得稳定数据所需的差分数。当我们在Python中使用ARIMA模型包时，它<strong class="lb iu">也与参数d(差分顺序)</strong>相关。</p><p id="e50b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我的步数预测示例中，我们已经分析并知道原始数据不是严格静态的，一阶差分可以将数据转换为静态时间序列数据集。我们可以调整<a class="ae ky" href="https://alkaline-ml.com/pmdarima/modules/generated/pmdarima.arima.auto_arima.html" rel="noopener ugc nofollow" target="_blank"> auto_arima </a>包的启动参数如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/acfc7a4610e38192eb73251f9c45db10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*shndKifPA2FPxoSOi0RgPA.png"/></div></div></figure><h1 id="2df3" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">最后</h1><p id="136b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">建议每次开始时间序列分析时检查平稳性假设。它可以帮助您更好地理解数据，并为模型选择更好的参数值范围。</p><p id="791d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您有兴趣了解使用时间序列方法进行端到端步骤计数预测的更多信息，请参考以下链接:</p><div class="nv nw gp gr nx ny"><a rel="noopener follow" target="_blank" href="/how-to-predict-your-step-count-for-next-week-a16b7800b408"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">如何使用时间序列模型预测你下周的步数</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">基于ARIMA模型的端到端时间序列预测</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">towardsdatascience.com</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om ks ny"/></div></div></a></div><h1 id="d231" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">参考:</h1><p id="ae20" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><a class="ae ky" href="https://otexts.com/fpp2/stationarity.html" rel="noopener ugc nofollow" target="_blank">https://otexts.com/fpp2/stationarity.html</a>(平稳性检查和差分)</p><p id="d4a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://www.statsmodels.org/stable/generated/statsmodels.tsa.stattools.adfuller.html" rel="noopener ugc nofollow" target="_blank">https://www . stats models . org/stable/generated/stats models . TSA . stat tools . ad fuller . html</a>。(Python中的ADF测试包)</p><p id="45a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！如果您有任何反馈或任何其他您想了解的话题，请在评论框中填写！</p></div></div>    
</body>
</html>