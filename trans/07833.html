<html>
<head>
<title>Building a streaming pipeline using SQL with Google Data Flow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用带有Google数据流的SQL构建流管道</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-streaming-pipeline-using-sql-with-google-dataflow-726564caf92?source=collection_archive---------11-----------------------#2021-07-18">https://towardsdatascience.com/building-a-streaming-pipeline-using-sql-with-google-dataflow-726564caf92?source=collection_archive---------11-----------------------#2021-07-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dfac" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">大家都在说实时数据。没有人知道如何做这件事。每个人都认为其他人都在做，所以每个人都声称自己在做。JK！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f3459387d0620350c40d6e5598a8f823.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BpOzEy9K-2W1ZjwR"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">约书亚·索蒂诺在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="c67a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">什么是实时数据</h1><p id="2ba3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">实时数据是指在收集数据时交付的数据。这使您能够处理和查询这些数据，为决策提供信息或推动数据应用。有一些术语，如实时、近实时和批处理。这三者之间的区别没有明确定义，但您可以大致使用以下指南(IMHO)。</p><ul class=""><li id="f707" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm mu mv mw mx bi translated"><strong class="lt iu">实时:</strong>亚秒/分钟延迟，精度最差。</li><li id="8458" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated"><strong class="lt iu">接近实时:</strong>1–5分钟延迟，更高精度。</li><li id="d56b" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated"><strong class="lt iu">批次:</strong>从1小时、1天到1周的任何时间，潜伏期在5分钟以上，精确度最高。</li></ul><p id="3b3a" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">除非您需要处理金融交易，否则大多数流分析用例将属于近实时类别。例如，如果您开展促销活动，您将需要向客户发送一条消息，说明他们的购买是否符合特定标准。在这种情况下，你可以在购买发生后几分钟内完成。</p><h1 id="8332" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">实时数据的价值</h1><p id="68e7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">实时访问数据对许多企业都有好处，因为数据是当今许多企业的命脉。您可以访问最新的信息来做出更好的决策，而不是依赖过时的、更新缓慢的信息。大多数现代数据仓库和BI工具都支持流式插入和查询，因此您的公司可以访问实时指标。</p><p id="661f" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">更好的是，许多决策可以使用流管道和一些业务逻辑自主做出。例如，您可以在将产品添加到购物车但未在最后30分钟内结帐后通知客户。</p><h1 id="ba05" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">使用SQL构建流式管道</h1><p id="b989" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">过去，资金雄厚的科技初创公司或拥有数百万美元预算的公司可以访问实时数据。你通常还需要一个数据工程师团队来构建和维护流管道。然而，随着云计算和开源数据社区的进步，许多这些功能正在向我们所有人开放。</p><h2 id="ad7a" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">商业案例</h2><p id="af5e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">假设你是一家电子商务公司，有一个营销活动，奖励任何消费超过5000美元并进行新购买的客户。当这些顾客购买新商品时，你想发送一条应用程序推送来祝贺他们。您还需要一个实时仪表板来跟踪活动的进展情况。开发团队说他们已经满负荷了，不会在这个活动中帮助你，所以你只能靠自己了。</p><p id="e875" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">像这样的任务通常需要两个数据源并将它们组合起来。您需要查询您的数据仓库来获取所有消费超过$ 5000的客户。您还需要实时数据来捕获今天的新交易。这也被称为lambda架构，其中有一个每天至少运行一次的批处理层和一个实时流数据的速度层。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/492674589f1c8a05e60ed1e65b36794a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/0*IYM_0z4nuH4keSQZ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">λ建筑—图片来源:<a class="ae ky" href="https://en.wikipedia.org/wiki/Lambda_architecture" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></figure><h2 id="977d" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">建筑</h2><p id="f087" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">假设您的开发团队能够构建订单和客户数据的流源(这实际上是一个先决条件)，我们的架构将如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/eab949a10f9c6446d9c6feacf23dc20e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rC7TBhQiZGU2N9tpEtIZQA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图表</p></figure><p id="2515" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">在这种架构中，新订单(一天之内)被流式传输到发布/订阅。数据流创建的管道将检查每一笔新的购买，以查看该客户是否在花费超过5000美元的客户列表中。结果将被写入两个目的地。BigQuery的结果将用于带有可视化工具的实时仪表板。写入发布/订阅的结果将用于向获胜的客户发送推送通知。</p><h2 id="fcf4" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">入门指南</h2><p id="7fe0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">以下是一些入门的先决条件:</p><ul class=""><li id="d2eb" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm mu mv mw mx bi translated">谷歌云账户</li><li id="dc8e" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">一个有效的付费账户(你可以注册300美元的免费试用)</li><li id="0673" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">谷歌云项目</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/66c37d256bb61273e18994b9c5c4c70b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*LSVyaxYbSewD3H-gdYz2Zw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">激活云壳—作者GIF</p></figure><div class="nv nw gp gr nx ny"><a href="https://github.com/tuanchris/dataflow-sql" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">Tuan Chris/数据流-sql</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">Permalink无法加载最新的提交信息。gcloud pubsub主题创建订单构建实时管道...</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">github.com</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om ks ny"/></div></div></a></div><p id="064f" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">通过运行以下命令将此存储库克隆到Cloudshell:</p><pre class="kj kk kl km gt on oo op oq aw or bi"><span id="c3b5" class="ng la it oo b gy os ot l ou ov"># Clone the repo locally<br/>git clone <a class="ae ky" href="https://github.com/tuanchris/dataflow-sql" rel="noopener ugc nofollow" target="_blank">https://github.com/tuanchris/dataflow-sql</a><br/>cd dataflow-sql</span><span id="3ab2" class="ng la it oo b gy ow ot l ou ov"># Install requirements<br/>pip3 install -r requirements.txt</span></pre><h2 id="f404" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">创建数据源</h2><p id="6704" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们的流管道需要两个数据源，如下所示:</p><p id="f09c" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated"><strong class="lt iu"> 1。一个大查询批量源</strong>——所有订单和客户信息，每天更新</p><pre class="kj kk kl km gt on oo op oq aw or bi"><span id="9833" class="ng la it oo b gy os ot l ou ov"># This script will create 100 customers with 1000 orders<br/>python3 generate_data.py batch \<br/> --customer_count=100 \<br/> --order_count=1000 \<br/> --project_id=$DEVSHELL_PROJECT_ID<br/># Replace the project_id varaible if you are running locally</span></pre><p id="a615" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated"><em class="ox">当云壳要求验证您的请求时，选择“授权”。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/359275265c798e70dedf25d26956a5ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rbf4uYnb995GR97l0qA0HQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">生成的客户表-按作者分类的图像</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/070b46c7907744a9279fff8453a3c75c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ya57C_ZibcvntLhWNX_Myw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">生成的订单表-按作者排序的图像</p></figure><p id="4ac3" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated"><strong class="lt iu"> 2。名为</strong> <code class="fe pa pb pc oo b"><strong class="lt iu">orders</strong></code>的发布/订阅主题——通过订阅发布/订阅主题获得的订单数据流</p><pre class="kj kk kl km gt on oo op oq aw or bi"><span id="79a9" class="ng la it oo b gy os ot l ou ov"># Create a Pub/Sub topic<br/>gcloud pubsub topics create orders</span><span id="4c4c" class="ng la it oo b gy ow ot l ou ov"># Generate a stream of order data to Pub/Sub<br/>python3 generate_data.py stream \<br/> --customer_range 100 \<br/> --project_id $DEVSHELL_PROJECT_ID</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/d5d9561ff85b45475fe4c62a08b705f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3mq300DtSwLMdftKFyrVqg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">实时流向发布/订阅的模拟订单—图片由作者提供</p></figure><h2 id="806f" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">将发布/订阅源添加到BigQuery</h2><p id="b0c2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要将发布/订阅源添加到BigQuery，请执行以下步骤:</p><ol class=""><li id="3e07" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm pe mv mw mx bi translated"><strong class="lt iu">将BigQuery中的查询引擎改为云数据流引擎</strong></li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/431289fe2f964d233a2a36014070df81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/0*xgnih0drCP-UO-pr.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">更改查询设置-按作者排序的图像</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/9dc08d86a714698f1c759e337ca5639e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/0*aagNezC7lncnFdMu.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将查询引擎更改为云数据流—图片由作者提供</p></figure><p id="9c23" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated"><strong class="lt iu"> 2。从BigQuery UI中，选择添加数据并选择云数据流源</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/e3157b7d3cdef50c74d60d5c79c9420d.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*VX5XmwTgNXw-6qo1.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">添加云数据流源—图片由作者提供</p></figure><p id="d5be" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated"><strong class="lt iu"> 3。添加发布/订阅主题源</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/9e62cbe79cff70f79cf46615f3e80d2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*wBeDIP-xgyvLbBUCeqDreQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">选择项目和发布/订阅主题—按作者分类的图像</p></figure><p id="5ca4" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated"><strong class="lt iu"> 4。为订单主题添加一个模式</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/06c02afa297027cc0b6e4f95394e84f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7e6SbTZcaxdf461KZiV-UQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">选择“添加的订单”主题，然后单击“编辑模式——按作者排序的图像”</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pk"><img src="../Images/6fb6079f384a2ebbd276553a5f9d27be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m0qs801WDmJ_v0iJUjnxKw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">切换编辑为文本并粘贴以下值-按作者排序的图像</p></figure><pre class="kj kk kl km gt on oo op oq aw or bi"><span id="d742" class="ng la it oo b gy os ot l ou ov">[<br/>    {<br/>        "name": "event_timestamp",<br/>        "description": "",<br/>        "mode": "REQUIRED",<br/>        "type": "TIMESTAMP"<br/>    },<br/>    {<br/>        "name": "customer_id",<br/>        "description": "",<br/>        "mode": "NULLABLE",<br/>        "type": "INT64"<br/>    },<br/>    {<br/>        "name": "amount",<br/>        "description": "",<br/>        "mode": "NULLABLE",<br/>        "type": "FLOAT64"<br/>    },<br/>    {<br/>        "name": "order_status",<br/>        "description": "",<br/>        "mode": "NULLABLE",<br/>        "type": "STRING"<br/>    },<br/>    {<br/>        "name": "order_datetime",<br/>        "description": "",<br/>        "mode": "NULLABLE",<br/>        "type": "STRING"<br/>    }<br/>]</span></pre><p id="c39d" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated"><strong class="lt iu">写一个SQL查询</strong></p><p id="15ab" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">下面是一个简单的SQL查询，它将回答我们的业务问题。</p><pre class="kj kk kl km gt on oo op oq aw or bi"><span id="20a5" class="ng la it oo b gy os ot l ou ov">WITH<br/>  eligible_customers AS (<br/>  SELECT<br/>    o.customer_id,<br/>    SUM(o.amount) AS total_spent<br/>  FROM<br/>    bigquery.table.`demobox-313313`.ecommerce.orders o<br/>  WHERE<br/>    o.order_status = 'Closed'<br/>  GROUP BY<br/>    1<br/>  HAVING<br/>    total_spent &gt;= 5000)<br/>SELECT<br/>  o.*,<br/>  ec.total_spent<br/>FROM<br/>  pubsub.topic.`demobox-313313`.orders o<br/>INNER JOIN<br/>  eligible_customers ec<br/>USING<br/>  (customer_id)<br/>WHERE<br/>  o.order_status != 'Cancelled'</span></pre><p id="f4ec" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">我们首先从orders表中选择数据，只筛选出“已完成”的订单，然后按客户分组，计算总支出，并筛选出购买了$5，000或更多的客户。然后，我们将符合条件的客户列表加入到任何新的交易中，过滤掉状态为<code class="fe pa pb pc oo b">Cancelled</code>的交易。</p><p id="f982" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">您可以看到，像上面这样编写SQL很容易，任何分析师都可以做到。尝试时，请确保替换您的project_id。</p><h2 id="5a93" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">创建数据流作业</h2><p id="6449" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">查询准备好并得到验证后，您可以从BigQuery UI中选择<code class="fe pa pb pc oo b">Create Dataflow job</code>。按照下图配置两个目的地。您可以将其他值保留为默认值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/0bdfc883ab831fbe1516bbe2027b8634.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*oB0ap5F5Q3PWyvYarjqyzA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">配置大查询目标和发布/订阅目标—按作者分类的图像</p></figure><p id="8dab" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">创建数据流作业后，您可以看到下面的结果。按照作业ID中的链接查看您的数据流作业及其状态。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/fdd08fc3327792812cb295c6e40fbf3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*m6N8u-IkoolbUWovO0adAw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据流创建结果-作者图片</p></figure><p id="4f0e" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">数据流作业可能需要3-5分钟才能启动。之后，您应该能够像下面这样处理管道。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/1266c69dd81f969399e460f76fda12d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*8igVnS0MSvJAdbHL1EuJrw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据流SQL管道—作者图片</p></figure><h2 id="9501" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">验证结果</h2><p id="2b26" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在数据流作业成功启动和运行之后，您可以进入BigQuery和Pub/Sub来验证我们的管道是否按预期工作。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi po"><img src="../Images/98ac7fde6bd36464ea4ab8dd96eead62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ru1buqsCbh139R0DnR9Qpg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">购买金额超过5000美元且有新交易的客户列表-按作者分类的图片</p></figure><p id="4c7d" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">通过运行数据流作业，我们可以看到关于管道的各种作业指标。比如数据流处理数据需要11秒，还不错！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/01743fee061b3e3b10f3ac40baa0a896.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ryZNt3YPjHb79EBDUXXRUg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据新鲜度报告-按作者分类的图像</p></figure><h2 id="0505" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">打扫</h2><p id="8f07" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">确保取消数据流管道，删除发布/订阅主题，并删除BigQuery数据集，以避免产生成本。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/5fc32214e40415b49032f8fbd885c685.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*pMPQPmAAXzM6EN5LF24MMA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">取消数据流作业-按作者分类的图像</p></figure><h1 id="38f7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="8f6e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">实时数据过去非常昂贵，而且只为最熟练的数据工程师保留。它仍然很贵，而且需要相当多的技术知识。然而，有了SQL Dataflow这样的托管工具或Kafka的KSQL和Spark SQL这样的开源替代工具，流式分析有望大众化，更容易获得。</p><p id="7f6f" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">快乐学习！</p></div></div>    
</body>
</html>