<html>
<head>
<title>Active Learning using Detectron2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用检测器的主动学习2</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/active-learning-using-detectron2-922a13982564?source=collection_archive---------33-----------------------#2021-05-31">https://towardsdatascience.com/active-learning-using-detectron2-922a13982564?source=collection_archive---------33-----------------------#2021-05-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d6f4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">厌倦了给所有数据贴标签？了解有关模型预测和嵌入如何帮助您选择正确数据的更多信息。</h2></div><p id="5e6e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">监督机器学习需要有标签的数据。在自动驾驶等计算机视觉应用中，标记一帧图像的成本高达10美元。新的互联设备和更便宜的传感器的快速增长导致新数据不断增加。给所有东西贴标签再也不可能了。事实上，许多公司只标注了他们收集的数据的0.1%到1%。但是找到正确的0.1%的数据就像大海捞针，不知道针长什么样。那么，如何才能做到高效呢？</p><p id="81c5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">解决这个问题的一个方法是主动学习。当进行主动学习时，我们使用预训练的模型，并使用模型预测来选择下一批数据进行标记。有不同的算法可以帮助您根据模型预测选择正确的数据。例如，众所周知的不确定性采样方法基于低模型置信度选择新数据。让我们假设一个场景，我们有两张猫的图片，一张是模型60%确定是猫，另一张是模型90%确定有猫。我们现在将选择模型只有60%置信度的图像。我们本质上选择了“更难”的例子。<br/>通过主动学习，我们重复这个预测和选择过程，直到达到我们的目标指标。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/9ecc2b67f9fc8e61fd06ce35f851d8ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kxdA1etQKKZ9ZdX10oyrAA.jpeg"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">来自Comma10k的示例图像，具有在MS COCO上训练的具有ResNet-50主干的更快R-CNN模型的模型预测。</p></figure><p id="7383" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我们不会详细讨论主动学习是如何工作的。有很多关于主动学习的好资源。相反，我们将关注如何通过使用Lightly 的<a class="ae lr" href="https://docs.lightly.ai/getting_started/active_learning.html" rel="noopener ugc nofollow" target="_blank">主动学习特性，用几行代码来使用主动学习。</a><a class="ae lr" href="https://lightly.ai/" rel="noopener ugc nofollow" target="_blank">轻飘飘</a>是一个计算机视觉的数据策展平台。它利用自我监督学习和主动学习的最新进展来帮助您处理未标记的数据集。</p><h1 id="342f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">数据集:从COCO女士到Comma10k</h1><p id="353c" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">如今，使用预先训练好的模型，并使用迁移学习在新任务中对其进行微调是非常常见的。因为我们对物体检测感兴趣，所以我们使用了一个来自可可小姐的预训练模型。它由超过100k个标记图像组成，是一个非常常见的数据集，用于图像分割、对象检测或关键点/姿态估计的迁移学习。</p><p id="65a4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的目标是使用主动学习来使用COCO预训练模型，并在自动驾驶的数据集上对其进行微调。对于这个传输任务，我们使用的是<a class="ae lr" href="https://github.com/commaai/comma10k" rel="noopener ugc nofollow" target="_blank"> Comma10k数据集</a>。来自<a class="ae lr" href="https://github.com/commaai/comma10k" rel="noopener ugc nofollow" target="_blank">仓库</a>:“这是从逗号舰队捕获的10，000 png真实驾驶。这是麻省理工学院的许可证，没有学术限制或任何东西。”</p><p id="8fa5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可能已经注意到，Comma10k数据集有用于训练“segnets”(语义分段网络)的注释。但是，没有我们转移任务所需的边界框注释。因此，我们必须添加缺少的注释。我们将使用主动学习来挑选前100张图像，并首先对它们进行注释，而不是对所有10k图像进行注释，我们预计这100张图像在模型改进方面的回报最高。</p><p id="7837" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们看看主动学习如何帮助我们选择前100幅图像进行标注。</p><h1 id="0b92" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">我们开始吧</h1><p id="ac0d" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">本文基于<a class="ae lr" href="https://docs.lightly.ai/tutorials/platform/tutorial_active_learning_detectron2.html" rel="noopener ugc nofollow" target="_blank">在Comma10k教程</a>上使用Detectron2主动学习。如果你想自己运行代码，还有一个现成的Google Colab笔记本。</p><p id="4b44" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">主动学习工作真的很难。许多公司未能恰当地实施主动学习，从中得到很少甚至没有价值。其中一个主要原因是他们只关注不确定性抽样。不确定采样是主动学习算法的两大类别之一。在下图中，你会发现右侧有两种主动学习方法。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mp"><img src="../Images/da73100e63b535c8d4a6183805532f67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NyQEGmAD-PttzLbq.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">知识象限—右栏是主动学习。(参见<a class="ae lr" href="https://medium.com/pytorch/https-medium-com-robert-munro-active-learning-with-pytorch-2f3ee8ebec" rel="noopener">使用PyTorch进行主动学习</a>)</p></figure><p id="ee60" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不确定性抽样可能是最常见的方法。您根据模型预测可信度低的地方选择新样本。</p><blockquote class="mq"><p id="9a07" class="mr ms iq bd mt mu mv mw mx my mz la dk translated">Lightly平台支持不确定性采样和分集采样算法。</p></blockquote><p id="61ae" class="pw-post-body-paragraph kf kg iq kh b ki na jr kk kl nb ju kn ko nc kq kr ks nd ku kv kw ne ky kz la ij bi translated">第二种方法是多样性抽样。您可以使用它来使数据集多样化。我们挑选视觉上/语义上彼此不同的图像。</p><p id="9e1e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不确定性抽样可用于各种评分(最小置信度、边际、熵……)。<br/>对于多样性采样，轻度使用coreset算法，轻度使用<a class="ae lr" href="https://github.com/lightly-ai/lightly" rel="noopener ugc nofollow" target="_blank">从其开源自我监督学习框架获得的嵌入</a>。</p><p id="315f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，还有更多。</p><blockquote class="nf ng nh"><p id="e879" class="kf kg ni kh b ki kj jr kk kl km ju kn nj kp kq kr nk kt ku kv nl kx ky kz la ij bi translated">Lightly有另一种称为CORAL的主动学习算法(<strong class="kh ir">COR</strong>ESET<strong class="kh ir">A</strong>active<strong class="kh ir">L</strong>earning)，它使用多样性和不确定性采样的组合。</p></blockquote><p id="ea38" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">目标是通过选择具有低模型置信度的图像来克服单个方法的局限性，但同时确保它们在视觉上彼此不同。</p><p id="ceae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们看看如何利用主动学习和Lightly平台。</p><h1 id="4070" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">嵌入并上传数据集</h1><p id="0940" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">让我们从创建嵌入并将数据集上传到Lightly平台开始。稍后，我们将在CORAL算法的多样化部分使用嵌入。</p><p id="fb98" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以使用<a class="ae lr" href="https://github.com/lightly-ai/lightly" rel="noopener ugc nofollow" target="_blank"> lightly Python包</a>轻松训练、嵌入和上传数据集。<br/>首先，我们需要安装软件包。为此，我们建议使用pip。确保您处于Python3.6+环境中。如果你在Windows上，你应该创建一个conda环境。</p><p id="cad6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在shell中运行以下命令，轻松安装最新版本的:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="99b6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们已经轻松安装了，我们可以运行命令行命令<code class="fe no np nq nr b">lightly-magic</code>来训练、嵌入和上传我们的数据集。您需要向命令传递一个<em class="ni">令牌</em>和一个<em class="ni"> dataset_id </em>参数。在创建一个新的数据集后，您可以在Lightly平台中找到这两者。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">用于训练、嵌入和上传数据集到Lightly平台的命令行界面命令</p></figure><p id="e7d4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦运行了<code class="fe no np nq nr b">lightly-magic</code> CLI命令，您应该会在Lightly平台中看到上传的数据集。您可以查看数据集的2d可视化效果。你能看到形成白天和黑夜图像的两个星团吗？</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/1e3409cf9be4070c5b293ec7813b3959.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*newoQvjpckTK4xDr0vkQ2g.gif"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">Lightly平台上Comma10k数据集的2D可视化</p></figure><h1 id="0df8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">主动学习工作流程</h1><p id="4aad" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">现在，我们已经将数据集上传到带有嵌入的Lightly平台，我们可以开始主动学习工作流了。我们感兴趣的部分是，你有一个训练好的模型，并准备好对未标记的数据进行预测。我们从创建一个<code class="fe no np nq nr b">ActiveLearningAgent</code>开始。这个代理将帮助我们管理未标记的图像，并确保我们与平台的接口正确。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">创建ActiveLearningAgent的代码。代理将用于以正确的顺序获取文件名，并上传模型预测。</p></figure><p id="da24" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的例子中，我们还没有一个模型。让我们从磁盘中加载它，并让它准备好对未标记的数据运行预测。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">从检查点加载detectron2模型的代码。</p></figure><p id="2e0d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们可以使用我们预先训练的模型，对未标记的数据进行预测。重要的是，我们使用与Lightly平台上相同的单个文件顺序。我们可以简单地通过迭代<code class="fe no np nq nr b">al_agent.query_set</code>来做到这一点，它包含一个按正确顺序排列的文件名列表。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">基于主动学习代理的query_set运行模型预测的代码。</p></figure><p id="87f9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了上传预测，我们需要将它们转化为分数。因为我们正在处理一个“物体检测”问题，所以我们使用了<code class="fe no np nq nr b">ScorerObjectDetection</code>。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">计算主动学习分数的代码。</p></figure><p id="611f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们终于准备好查询第一批图像了。</p><h1 id="bcc0" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">查询前100个图像进行标记</h1><p id="4630" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">为了基于模型预测和我们在Lightly平台上的嵌入来查询数据，我们可以使用代理的<code class="fe no np nq nr b">.query(...)</code>方法。我们可以将它传递给一个<code class="fe no np nq nr b">SamplerConfig</code>对象来描述我们想要运行的采样算法及其参数。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">创建SamplerConfig并执行查询的代码。</p></figure><p id="ea11" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在查询了新的100幅图像后，我们可以使用主动学习代理的<code class="fe no np nq nr b">added_set</code>简单地访问它们的文件名。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">我们现在可以打印新选择的图像的前3个文件名进行标记。</p></figure><p id="b5a5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">恭喜你，你完成了你的(第一次)主动学习迭代！<br/>现在你可以标记这100张图片，并用它们训练你的模型。主动学习通常是在一个连续的反馈循环中完成的。在使用新数据训练您的模型后，您将进行另一次迭代，并预测+选择另一批图像进行标记。</p><p id="8ce1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我希望你对如何在你的下一个计算机视觉项目中使用主动学习有一个很好的想法。欲了解更多信息，请查看使用Comma10k上的Detectron2的<a class="ae lr" href="https://docs.lightly.ai/tutorials/platform/tutorial_active_learning_detectron2.html" rel="noopener ugc nofollow" target="_blank">主动学习</a>教程。</p><p id="9c09" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Igor Susmelj，联合创始人<br/> <a class="ae lr" href="https://lightly.ai/" rel="noopener ugc nofollow" target="_blank">淡淡地</a></p><p id="6f90" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ni">原帖已发布于此:</em><a class="ae lr" href="https://www.lightly.ai/post/active-learning-using-detectron2" rel="noopener ugc nofollow" target="_blank"><em class="ni">https://www . lightly . ai/post/active-learning-using-detectron 2</em></a></p></div></div>    
</body>
</html>