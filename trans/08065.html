<html>
<head>
<title>How to Synchronize Time Series Datasets in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中同步时间序列数据集</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-synchronize-time-series-datasets-in-python-f2ae51bee212?source=collection_archive---------6-----------------------#2021-07-24">https://towardsdatascience.com/how-to-synchronize-time-series-datasets-in-python-f2ae51bee212?source=collection_archive---------6-----------------------#2021-07-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2c5c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用动态时间弯曲同步时序数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8b837083e367a9335c661879933e7c02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0JJ0gvs4OlMG5gfAEZB4AQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><h2 id="a87c" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">介绍</h2><p id="d21f" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">在与数据相关的职业生涯中，人们可能遇到的最痛苦的事情之一就是不得不处理不同步的时间序列数据集。差异可能是由一系列原因造成的——夏令时调整、不准确的SCADA信号和损坏的数据等等。在同一个数据集中的不同点上发现几个差异甚至是很常见的，这需要您单独识别和纠正每一个差异。当你这样做的时候，你可能会无意中抵消另一个同步部分。幸运的是，在新颖的“动态时间扭曲”技术的帮助下，我们能够对我们所有的非同步数据集应用一种尺寸适合所有人的解决方案。</p><h2 id="026b" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">动态时间扭曲</h2><p id="0edd" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">简称DTW是一种计算两个数据序列之间最佳匹配的技术。换句话说，您正在寻找在任何给定时间从一个数据集到另一个数据集的最短路径。这种方法的美妙之处在于，它允许您根据需要对数据集应用尽可能多的校正，以确保每个点尽可能地同步。您甚至可以将它应用于不同长度的数据集。DTW的应用是无止境的，你可以将它用于时态和非时态数据，如金融指标、股票市场指数、计算音频等等。唯一的警告是要确保你的数据没有空值或缺失值，因为这可能会影响DTW的工作。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/15c87fa3762f73512fb4c149c1c517f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Xz4vykA8CSdKS7XAvtJaw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">DTW的欧氏距离度量实现。图片作者。</p></figure><p id="43b6" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">用于查找对应点之间最短路径的距离度量可以是Scipy的距离度量<a class="ae mt" href="https://docs.scipy.org/doc/scipy/reference/spatial.distance.html" rel="noopener ugc nofollow" target="_blank">模块</a>提供的任何一个。虽然在大多数情况下欧几里得距离可以解决问题，但是您可能希望用其他距离来做好测量。</p><h2 id="de22" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">履行</h2><p id="5175" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">为了实现我们自己的DTW版本，我们将使用Python中的<a class="ae mt" href="https://pypi.org/project/fastdtw/" rel="noopener ugc nofollow" target="_blank"> fastdtw </a>库。这个包的新颖之处在于它简化了warping函数的复杂度，从而将复杂度从O(n)降低到O(n ),这在运行时带来了明显的不同。</p><p id="7a8f" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">请启动Anaconda或您选择的任何Python IDE并安装fastdtw，如下所示:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="7bc9" class="ky kz it mv b gy mz na l nb nc">pip install fastdtw</span></pre><p id="5642" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">随后，导入所有必需的包:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="104b" class="ky kz it mv b gy mz na l nb nc">import numpy as np<br/>import pandas as pd<br/>import streamlit as st<br/>import plotly.express as px<br/>from sklearn.metrics import r2_score</span></pre><p id="4c82" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">在运行同步之前，导入数据集并填写任何空值:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="257d" class="ky kz it mv b gy mz na l nb nc">df = pd.read_csv('dataset.csv')</span><span id="b349" class="ky kz it mv b gy nd na l nb nc">df['Power'] = pd.to_numeric(df['Power'],errors='coerce')<br/>df['Voltage'] = pd.to_numeric(df['Voltage'],errors='coerce')</span><span id="c3c0" class="ky kz it mv b gy nd na l nb nc">x = np.array(df['Power'].fillna(0))<br/>y = np.array(df['Voltage'].fillna(0))</span></pre><p id="e297" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">然后继续执行同步:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="c43d" class="ky kz it mv b gy mz na l nb nc">distance, path = fastdtw(x, y, dist=euclidean)</span></pre><p id="c8f4" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">同步路径的结果将类似于以下内容:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="4966" class="ky kz it mv b gy mz na l nb nc">path = [(0, 0), (0, 1), (0, 2), (1, 3), (2, 4),...]</span></pre><p id="a9d9" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">参考数据集中的每个点将与目标数据集中的一个或多个点匹配，即参考数据的行0可以与目标数据的点0、1或2匹配。</p><p id="a0b4" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">现在您已经有了扭曲的路径，您可以继续创建具有同步结果的数据框，如下所示:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="f60a" class="ky kz it mv b gy mz na l nb nc">result = []</span><span id="596a" class="ky kz it mv b gy nd na l nb nc">for i in range(0,len(path)):<br/>    result.append([df['DateTime'].iloc[path[i][0]],<br/>    df['Power'].iloc[path[i][0]],<br/>    df['Voltage'].iloc[path[i][1]]])</span><span id="3d7d" class="ky kz it mv b gy nd na l nb nc">df_sync = pd.DataFrame(data=result,columns=['DateTime','Power','Voltage']).dropna()<br/>df_sync = df_sync.drop_duplicates(subset=['DateTime'])<br/>df_sync = df_sync.sort_values(by='DateTime')<br/>df_sync = df_sync.reset_index(drop=True)</span><span id="e708" class="ky kz it mv b gy nd na l nb nc">df_sync.to_csv('C:/Users/.../synchronized_dataset.csv',index=False)</span></pre><p id="3661" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">最后，您可以使用Sklearn的r2_score模块计算相关性分数，以比较同步前后的相关性或同步级别:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="b9b9" class="ky kz it mv b gy mz na l nb nc">correlation = r2_score(df['Power'],df['Voltage'])</span></pre><h2 id="0781" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">数据可视化</h2><p id="7a22" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">为了绘制和可视化您的同步数据，我们将使用Plotly和Streamlit——这是我最喜欢的两个库，用于可视化数据并将其渲染为应用程序。</p><p id="a4cd" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">您可以使用下面的函数来创建时间序列图。请确保您的时间戳采用dd-mm-yyyy hh:mm的正确格式，或者修改函数以适应您的数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="b9fb" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">要可视化和呈现您的图表，请在Anaconda提示符下键入以下命令来运行您的脚本:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="f1f7" class="ky kz it mv b gy mz na l nb nc">cd C:/Users/.../local_directory<br/>streamlit run synchronization.py</span></pre><p id="1dae" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">在这里，您可以看到同步前后的数据:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/2e1c179d647336c53479d14c90658cd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*EqbQyCAnEiYAZ6Cb74hwqQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者视觉。</p></figure><h2 id="d151" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">结论</h2><p id="a316" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">对于时间序列数据的快速和方便的同步，动态时间弯曲可能是唯一最有效的解决方案。虽然它不是完美无缺的，而且确实有一些缺点，比如边界条件匹配不佳，但它是我见过的最全面的解决方案。您也决不会局限于线性数据，实际上您可以同步不同维度的非线性数据。</p><p id="8088" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">如果您想了解更多关于数据可视化和Python的知识，请随时查看以下(附属链接)课程:</p><h2 id="99c1" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">使用Streamlit开发Web应用程序:</h2><div class="nh ni gp gr nj nk"><a href="https://www.amazon.com/Web-Application-Development-Streamlit-Applications/dp/1484281101?&amp;linkCode=ll1&amp;tag=mkhorasani09-20&amp;linkId=a0cb2bc17df598006fd9029c58792a6b&amp;language=en_US&amp;ref_=as_li_ss_tl" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">使用Streamlit开发Web应用程序:开发和部署安全且可伸缩的Web应用程序…</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">使用Streamlit开发Web应用程序:使用……开发安全且可扩展的Web应用程序并将其部署到云中</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">www.amazon.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny ks nk"/></div></div></a></div><h2 id="7177" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">使用Python实现数据可视化:</h2><div class="nh ni gp gr nj nk"><a href="https://www.coursera.org/learn/python-for-data-visualization?irclickid=xgMQ4KWb%3AxyIWO7Uo7Vva0OcUkGQgW2aEwvr1c0&amp;irgwc=1&amp;utm_medium=partners&amp;utm_source=impact&amp;utm_campaign=3308031&amp;utm_content=b2c" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">用Python实现数据可视化</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">“一图胜千言”。我们都熟悉这个表达。它尤其适用于试图…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">www.coursera.org</p></div></div><div class="nt l"><div class="nz l nv nw nx nt ny ks nk"/></div></div></a></div><h2 id="ac9e" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">面向所有人的Python专业化:</h2><div class="nh ni gp gr nj nk"><a href="https://www.coursera.org/specializations/python?irclickid=xgMQ4KWb%3AxyIWO7Uo7Vva0OcUkGQgW16Ewvr1c0&amp;irgwc=1&amp;utm_medium=partners&amp;utm_source=impact&amp;utm_campaign=3308031&amp;utm_content=b2c" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">面向所有人的Python</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">学习用Python编程和分析数据。开发收集、清理、分析和可视化数据的程序…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">www.coursera.org</p></div></div><div class="nt l"><div class="oa l nv nw nx nt ny ks nk"/></div></div></a></div><h2 id="a899" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">GitHub资源库:</h2><div class="nh ni gp gr nj nk"><a href="https://github.com/mkhorasani/dynamic_time_warping_synchronzation" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">mkhorasani/动态时间扭曲同步</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">使用动态时间弯曲同步时序数据</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">github.com</p></div></div><div class="nt l"><div class="ob l nv nw nx nt ny ks nk"/></div></div></a></div></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h1 id="2405" class="oj kz it bd la ok ol om ld on oo op lg jz oq ka lk kc or kd lo kf os kg ls ot bi translated">新到中？您可以在此订阅和解锁无限文章<a class="ae mt" href="https://khorasani.medium.com/membership" rel="noopener">。</a></h1></div></div>    
</body>
</html>