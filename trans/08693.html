<html>
<head>
<title>Implementing Optical Character Recognition (OCR) using pytesseract</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用pytesseract实现光学字符识别(OCR)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/implementing-optical-character-recognition-ocr-using-pytesseract-5f42cf62ddcc?source=collection_archive---------8-----------------------#2021-08-11">https://towardsdatascience.com/implementing-optical-character-recognition-ocr-using-pytesseract-5f42cf62ddcc?source=collection_archive---------8-----------------------#2021-08-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8499" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我们如何将图像转换成机器编码的文本？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/38d51053237fd8d9b27409013fea60ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s8p_xPXdPeVErKrf.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:<a class="ae kv" href="https://en.wikipedia.org/wiki/Optical_character_recognition" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></figure><p id="97dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">各位python爱好者，我想和你们分享一个简单但非常有效的OCR服务，它使用pytesseract，并通过Flask提供web界面。</p><p id="cf1b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">光学字符识别(OCR)可用于多种用途，例如用于支付目的的信用卡扫描，或将文档的<code class="fe ls lt lu lv b">.jpeg</code>扫描转换为<code class="fe ls lt lu lv b">.pdf</code></p><p id="1e80" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">没有出卖使用OCR的想法，或者如何使用它，让我们开始编码过程！</p><h1 id="a3b6" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">先决条件</h1><p id="0061" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">我们将使用pytesseract(用于OCR)和Flask(用于web界面)</p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="ffae" class="mx lx iq lv b gy my mz l na nb">pip install pytesseract</span><span id="2066" class="mx lx iq lv b gy nc mz l na nb">from PIL import Image<br/>import pytesseract</span></pre><blockquote class="nd ne nf"><p id="c8d3" class="kw kx ng ky b kz la jr lb lc ld ju le nh lg lh li ni lk ll lm nj lo lp lq lr ij bi translated">注意:如果你在导入宇宙魔方时遇到一些问题，你可能需要下载并安装pytesseract.exe，可以在这里找到<a class="ae kv" href="https://sourceforge.net/projects/tesseract-ocr-alt/files/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="507e" class="kw kx ng ky b kz la jr lb lc ld ju le nh lg lh li ni lk ll lm nj lo lp lq lr ij bi translated">安装后，您必须包含pytesseract可执行文件的路径，这可以通过一行代码完成:</p></blockquote><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="107c" class="mx lx iq lv b gy my mz l na nb">pytesseract.pytesseract.tesseract_cmd = r'YOUR-PATH-TO-TESSERACT\tesseract.exe'</span></pre></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="ff2b" class="lw lx iq bd ly lz nr mb mc md ns mf mg jw nt jx mi jz nu ka mk kc nv kd mm mn bi translated">核心OCR功能</h1><p id="6ef9" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">因为我们已经安装并导入了pytesseract，所以让我们创建核心函数并检查它是否按预期工作:</p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="607b" class="mx lx iq lv b gy my mz l na nb">def ocr_core(filename):<br/>    text = pytesseract.image_to_string(Image.open(filename))<br/>    return text</span></pre><p id="d262" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">很简单，对吧？<strong class="ky ir"> ocr_core </strong>函数获取图像文件的路径并返回其文本组件。根据<a class="ae kv" href="https://pypi.org/project/pytesseract/" rel="noopener ugc nofollow" target="_blank">文档</a>，<code class="fe ls lt lu lv b">image_to_string</code> <strong class="ky ir"> </strong>函数使用英语作为默认识别语言，具体语言我们稍后再说。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/02708963bf7e1bd08a199b074755a74d.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*c17pt1gnfdWsm2GxIx6dlA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">此图片与ocr_core函数<em class="nx">【作者图片】</em>一起使用</p></figure><p id="a659" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/910174b5eea46ab1104f36686974e62b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sm9VopacJY9vppRiSLs-Dw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">ocr_core函数将我们的图像作为字符串返回，耶！<em class="nx">【作者图片】</em></p></figure><p id="42c8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦我们确定一切正常，就该为我们的OCR服务创建一个web界面了</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="6755" class="lw lx iq bd ly lz nr mb mc md ns mf mg jw nt jx mi jz nu ka mk kc nv kd mm mn bi translated">使用Flask的Web界面</h1><p id="a341" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">现在我们要创建一个简单的html表单，允许用户上传一个图像文件，并从中检索文本。</p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="d531" class="mx lx iq lv b gy my mz l na nb">from flask import Flask, render_template, request</span><span id="4aed" class="mx lx iq lv b gy nc mz l na nb">app = Flask(__name__)</span><span id="d2d6" class="mx lx iq lv b gy nc mz l na nb"># from ocr_core import ocr_core<br/># uncomment the line above, if your Flask fails to get access to your function, or your OCR &amp; Flask are on different scripts</span></pre><p id="181f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">保持简单，让我们为上传的文件创建一些后端测试，例如允许的扩展名:</p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="220b" class="mx lx iq lv b gy my mz l na nb">ALLOWED_EXTENSIONS = ['png', 'jpg', 'jpeg']</span><span id="099d" class="mx lx iq lv b gy nc mz l na nb">def allowed_file(filename):<br/>    return '.' in filename and \<br/>           filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS</span></pre><p id="5001" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">保持它的美丽和简单，就像<a class="ae kv" href="https://zen-of-python.info/" rel="noopener ugc nofollow" target="_blank">《Python的禅》</a>建议的那样，对吗？</p><p id="843c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，让我们创建一个保存用户上传图像的路径:</p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="d88b" class="mx lx iq lv b gy my mz l na nb">import os</span><span id="d893" class="mx lx iq lv b gy nc mz l na nb">path = os.getcwd()</span><span id="a39a" class="mx lx iq lv b gy nc mz l na nb">UPLOAD_FOLDER = os.path.join(path, 'uploads\\')</span><span id="ba74" class="mx lx iq lv b gy nc mz l na nb">if not os.path.isdir(UPLOAD_FOLDER):<br/>    os.mkdir(UPLOAD_FOLDER)</span><span id="ae1b" class="mx lx iq lv b gy nc mz l na nb">app.config['UPLOAD_FOLDER'] = UPLOAD_FOLDER</span></pre><p id="680e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您想知道我们为什么要导入<code class="fe ls lt lu lv b">os</code> <strong class="ky ir"> : </strong>我们将需要它来获取上传图像的路径(用于后端)，并且在用户成功上传文件后为我们的<code class="fe ls lt lu lv b">&lt;img&gt;</code>标记创建一个源。如果你想特别指定一个文件夹，只需将<code class="fe ls lt lu lv b">os.getcwd()</code>更改为你想使用的任何路径。</p><p id="7e9f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你从未创建过“上传”文件夹，上面的代码也会为你创建(用爱)。</p><h1 id="c7b9" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">基于HTML表单的web界面</h1><p id="df90" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">现在，让我们构建一个简单的表单，并将文件命名为<code class="fe ls lt lu lv b">upload.html</code></p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="6dae" class="mx lx iq lv b gy my mz l na nb">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>&lt;head&gt;<br/> &lt;title&gt;OCR&lt;/title&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/> {% if msg %}<br/> &lt;h1 style="color: green"&gt; {{ msg }} &lt;/h1&gt;<br/> {% endif %}</span><span id="7b60" class="mx lx iq lv b gy nc mz l na nb">&lt;h1&gt; Upload your file &lt;/h1&gt;</span><span id="0287" class="mx lx iq lv b gy nc mz l na nb">&lt;form method=post enctype=multipart/form-data&gt; <br/>  &lt;input type="file" name=file&gt;<br/>  &lt;input type="submit" name=Upload value="Upload"&gt;<br/> &lt;/form&gt;</span><span id="33a2" class="mx lx iq lv b gy nc mz l na nb">{% if extracted %}<br/> &lt;h1&gt; Results: &lt;/h1&gt;<br/> {% endif %}</span><span id="d0c9" class="mx lx iq lv b gy nc mz l na nb">{% if img_src %}<br/> &lt;img src="<!-- -->{{ img_src }}<!-- -->"&gt;<br/> {% endif %}</span><span id="474b" class="mx lx iq lv b gy nc mz l na nb">{% if extracted %}<br/> &lt;p&gt; {{ extracted }} &lt;/p&gt;<br/> {% endif %}</span><span id="51f6" class="mx lx iq lv b gy nc mz l na nb">&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="9b49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">等等，为什么有大括号？嗯，不是完全HTML形式，我撒了个谎。实际上，这是<a class="ae kv" href="https://jinja.palletsprojects.com/en/2.11.x/templates/" rel="noopener ugc nofollow" target="_blank"> jinja格式化</a>，它允许我们相应地格式化我们的HTML。这里没什么特别的，<code class="fe ls lt lu lv b">{% if %}</code>代表if语句，所以如果有什么消息，就会被包裹在<code class="fe ls lt lu lv b">&lt;h1&gt;</code>标签里，等等。</p><p id="5855" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个表单非常简单，但是不要忘记<code class="fe ls lt lu lv b">enctype=multipart/form-data</code>允许表单接受文件上传。</p><p id="7e54" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦后端进入操作，花括号内的所有变量就会出现，所以在上传任何东西之前，您的<code class="fe ls lt lu lv b">upload.html</code>应该是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/52149fba93c8a4fcb12f4926d574e940.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*RBDv5g7akGer7ADqDk5O5w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">你的<code class="fe ls lt lu lv b">upload.html should look like this. </code> <em class="nx">【图片由作者提供】</em></p></figure><blockquote class="nd ne nf"><p id="9f2e" class="kw kx ng ky b kz la jr lb lc ld ju le nh lg lh li ni lk ll lm nj lo lp lq lr ij bi translated">重要提示:不要忘记将你的“upload.html”文件保存到与你的主python脚本相同的路径，不管你是在中心还是本地计算机上工作。如果你不知道你的工作目录在哪里，参考上面的<code class="fe ls lt lu lv b">os.getcwd()</code>。</p></blockquote><h1 id="5f5f" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">最终确定OCR web服务</h1><p id="b56e" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">一旦我们完成了以上所有的准备工作，就该通过Flask创建一个web界面了:</p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="bd56" class="mx lx iq lv b gy my mz l na nb"><a class="ae kv" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/', methods = ['GET', 'POST'])</span><span id="652d" class="mx lx iq lv b gy nc mz l na nb">def upload_page():<br/>    if request.method == 'POST':<br/>        if 'file' not in request.files:<br/>            return render_template('upload.html', msg = 'No file selected')<br/>        file = request.files['file']</span><span id="e055" class="mx lx iq lv b gy nc mz l na nb">if file.filename == '':<br/>            return render_template('upload.html', msg = 'No file')</span><span id="d156" class="mx lx iq lv b gy nc mz l na nb">if file and allowed_file(file.filename):<br/>            file.save(os.path.join(app.config['UPLOAD_FOLDER'], file.filename))<br/>            extracted = ocr_core(file)<br/>            return render_template('upload.html', <br/>                                    msg = 'OCR completed',<br/>                                    extracted = extracted, <br/>                                    img_src = UPLOAD_FOLDER + file.filename)<br/>    else:<br/>        return render_template('upload.html')<br/>if __name__ == '__main__':<br/>    app.run()</span></pre><p id="2696" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们检查请求方法是否为<code class="fe ls lt lu lv b">POST</code>，主要是为了安全措施。然后，我们必须检查文件是否被选择和上传(换句话说，文件是否到达后端)。一旦入门级测试完成，我们检查<code class="fe ls lt lu lv b">file</code>是否存在，以及它的格式是否被允许。</p><p id="e92a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦满足所有这些条件，我们将上传的文件保存到上传文件夹，并将其赋给一个名为<code class="fe ls lt lu lv b">extracted</code>的变量</p><p id="4ef8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行代码后，您应该会看到应用程序运行的地址:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/fc4b677bc9e46591bc3d37e660aefcec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*AbQeR0be6NZRpIoFA2PfXA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">应用程序运行的地址。<em class="nx">【作者图片】</em></p></figure><p id="b34f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以在上传之前，你的界面应该是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/c893d13cd722fe63e610e7b44b547673.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*nTiH0RiC9mh1kW-n6xERbg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">上传前的App。<em class="nx">【作者图片】</em></p></figure><p id="a8b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦您选择了您的文件，它应该会有如下的细微变化:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/be10b6794feaa469d27faad2b7b2cb77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*oYlzD2xssqM20AsOu3a_4g.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">上传图片后的App。<em class="nx">【作者图片】</em></p></figure><p id="fae9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">瞧啊。您刚刚创建了一个OCR web服务！</p><h1 id="ae41" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">最后的想法</h1><p id="fb8a" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">正如承诺的那样，我们已经创建了一个简单但非常有效的OCR web服务，它允许从图像中识别文本。但是有很多方法可以改善它。例如，您可以添加选项来选择OCR应该使用哪种语言。后端和前端都是这样:</p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="3d0b" class="mx lx iq lv b gy my mz l na nb">def ocr_core(filename):<br/>     text = pytesseract.image_to_string(Image.open(filename), lang=selected_language)<br/>    return text</span></pre><p id="0198" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你所要做的就是在<code class="fe ls lt lu lv b">ocr_core</code>函数中指定<code class="fe ls lt lu lv b">lang</code>属性。并在您的<code class="fe ls lt lu lv b">upload.html</code>文件中添加一个<code class="fe ls lt lu lv b">&lt;select&gt;</code>标签。只是不要忘记从前端获取数据，并将其传递给你的<code class="fe ls lt lu lv b">ocr_core</code>函数</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/0591baaf39828e85e688e35104bd329c.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*1QCfWAcdR0yFXVkd4ouWog.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">未来的改进。<em class="nx">【图片作者】</em></p></figure><p id="2d5d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">希望这篇文章证明对你有用，并使一些事情变得更清楚。感谢您的时间，如果您有任何反馈或任何问题，请随时在下面留下评论。</p><p id="4f46" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">再见。</p></div></div>    
</body>
</html>