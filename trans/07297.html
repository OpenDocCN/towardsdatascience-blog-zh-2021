<html>
<head>
<title>Embed Observable Notebooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">嵌入式可观察笔记本</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/embed-observable-notebooks-492292424923?source=collection_archive---------25-----------------------#2021-07-02">https://towardsdatascience.com/embed-observable-notebooks-492292424923?source=collection_archive---------25-----------------------#2021-07-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4623" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">将所有酷的例子用于你自己的数据，同时将数据保存在本地或你的网络中。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c61e540a80c86ac9a7abd7a86d75474e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qSr17mQ-jqZLwAQ06foQfg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">过着最佳觅食生活的鸡。图片作者。</p></figure><p id="2914" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你没听说过，<a class="ae lr" href="https://observablehq.com/trending" rel="noopener ugc nofollow" target="_blank"> Observable </a>是d3的创造者Mike Bostock带给世界的一个交互编码平台。它体现了Bret Victor 对<a class="ae lr" href="https://www.youtube.com/watch?v=8pTEmbeENF4" rel="noopener ugc nofollow" target="_blank">反应式编程的大胆设想，坦率地说，我认为它非常酷。一个缺点:我不擅长核心语言Javascript。我非常擅长这个，不要误解我，但是我一直对人们在Observable上做的事情印象深刻。冒着重复Observable团队优秀指南的风险，我只分享一个具体的例子。</a></p><p id="a801" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你被我的指南卡住了，权威参考是<a class="ae lr" href="https://observablehq.com/@observablehq/introduction-to-embedding" rel="noopener ugc nofollow" target="_blank">嵌入简介</a>、<a class="ae lr" href="https://observablehq.com/@observablehq/downloading-and-embedding-notebooks?collection=@observablehq/embed-trail" rel="noopener ugc nofollow" target="_blank">高级嵌入和下载</a> g，以及<a class="ae lr" href="https://observablehq.com/@observablehq/troubleshooting-embedding?collection=@observablehq/embedding-notebooks" rel="noopener ugc nofollow" target="_blank">嵌入故障排除</a>。</p><p id="300f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们走吧。Mike Bostock展示了d3的两个出色的可视化示例:<a class="ae lr" href="https://observablehq.com/@d3/line-chart-with-tooltip" rel="noopener ugc nofollow" target="_blank">带工具提示的折线图</a>和<a class="ae lr" href="https://observablehq.com/@d3/calendar-view" rel="noopener ugc nofollow" target="_blank">日历视图</a>。我给加州大学伯克利分校MIDS分校的学生展示了后者，我们很好奇日历视图中显示的数据在折线图中会是什么样子。首先从日历视图下载数据:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/8377cd0a6f2656ed1235e34938b0a68a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ghwZq96C9ycPLENFb9_F4g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">下载“数据”变量的JSON。图片作者。</p></figure><p id="4aa8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们有了数据，让我们创建嵌入。从折线图中，单击右上角的三个点，然后选择嵌入:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lt"><img src="../Images/f9a204c2e17e932da39c475b40c1bc77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7MXJ4GKzcIL7La-qmiUhAA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">单击嵌入单元格。图片作者。</p></figure><p id="aea8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们只需要图表，所以只选择图表。确保获得“JavaScript运行时”,这样我们就可以覆盖数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lu"><img src="../Images/23da3cd60a48a317b70c9709c23d050c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KvODSYqyUyAv4dpFH_qdGA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。</p></figure><p id="416a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在您应该有了这段代码:</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="73ed" class="ma mb iq lw b gy mc md l me mf">&lt;div id="observablehq-chart-22ee36d2"&gt;&lt;/div&gt;<br/>&lt;p&gt;Credit: &lt;a href="<a class="ae lr" href="https://observablehq.com/@d3/line-chart-with-tooltip" rel="noopener ugc nofollow" target="_blank">https://observablehq.com/@d3/line-chart-with-tooltip</a>"&gt;Line Chart with Tooltip by D3&lt;/a&gt;&lt;/p&gt;</span><span id="60dd" class="ma mb iq lw b gy mg md l me mf">&lt;script type="module"&gt;<br/>import {Runtime, Inspector} from "<a class="ae lr" href="https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js" rel="noopener ugc nofollow" target="_blank">https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js</a>";<br/>import define from "<a class="ae lr" href="https://api.observablehq.com/@d3/line-chart-with-tooltip.js?v=3" rel="noopener ugc nofollow" target="_blank">https://api.observablehq.com/@d3/line-chart-with-tooltip.js?v=3</a>";<br/>new Runtime().module(define, name =&gt; {<br/>  if (name === "chart") return new Inspector(document.querySelector("#observablehq-chart-22ee36d2"));<br/>});<br/>&lt;/script&gt;</span></pre><p id="1ab1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在您已经下载的<code class="fe mh mi mj lw b">data.json</code>旁边打开一个空的<code class="fe mh mi mj lw b">index.html</code>，我们将把它嵌入到一个HTML容器中(在我的Atom编辑器中，我只需键入<code class="fe mh mi mj lw b">html</code>，并使用补全来获得“外壳”)。它应该是这样的:</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="e81e" class="ma mb iq lw b gy mc md l me mf">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en" dir="ltr"&gt;<br/>    &lt;head&gt;<br/>        &lt;meta charset="utf-8"&gt;<br/>        &lt;title&gt;&lt;/title&gt;<br/>    &lt;/head&gt;<br/>    &lt;body&gt;<br/>        &lt;div id="observablehq-chart-b01c95fe"&gt;&lt;/div&gt;</span><span id="3ffb" class="ma mb iq lw b gy mg md l me mf">        &lt;script type="module"&gt;<br/>        import {Runtime, Inspector} from "<a class="ae lr" href="https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js" rel="noopener ugc nofollow" target="_blank">https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js</a>";<br/>        import define from "<a class="ae lr" href="https://api.observablehq.com/@d3/line-chart-with-tooltip.js?v=3" rel="noopener ugc nofollow" target="_blank">https://api.observablehq.com/@d3/line-chart-with-tooltip.js?v=3</a>";<br/>        new Runtime().module(define, name =&gt; {<br/>            if (name === "chart") return new Inspector(document.querySelector("#observablehq-chart-b01c95fe"));<br/>            return ["x","y","yAxis","bisect","  xAxis","line"].includes(name);<br/>        });<br/>        &lt;/script&gt;<br/>    &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="85df" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们将加载数据，首先加载d3库并使用它来获取JSON文件:</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="ad1d" class="ma mb iq lw b gy mc md l me mf">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en" dir="ltr"&gt;<br/>    &lt;head&gt;<br/>        &lt;meta charset="utf-8"&gt;<br/>        &lt;title&gt;&lt;/title&gt;<br/>    &lt;/head&gt;<br/>    &lt;body&gt;<br/>        &lt;div id="observablehq-chart-b01c95fe"&gt;&lt;/div&gt;</span><span id="3df5" class="ma mb iq lw b gy mg md l me mf">        &lt;script src="<a class="ae lr" href="https://d3js.org/d3.v7.min.js" rel="noopener ugc nofollow" target="_blank">https://d3js.org/d3.v7.min.js</a>"&gt;&lt;/script&gt;<br/>        &lt;script type="module"&gt;<br/>        import {Runtime, Inspector} from "<a class="ae lr" href="https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js" rel="noopener ugc nofollow" target="_blank">https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js</a>";<br/>        import define from "<a class="ae lr" href="https://api.observablehq.com/@d3/line-chart-with-tooltip.js?v=3" rel="noopener ugc nofollow" target="_blank">https://api.observablehq.com/@d3/line-chart-with-tooltip.js?v=3</a>";<br/>        const main = new Runtime().module(define, name =&gt; {<br/>            if (name === "chart") return new Inspector(document.querySelector("#observablehq-chart-b01c95fe"));<br/>            return ["x","y","yAxis","bisect","  xAxis","line"].includes(name);<br/>        });</span><span id="b390" class="ma mb iq lw b gy mg md l me mf">        d3.json("data.json").then(function(d) {<br/>            [next bit goes here]<br/>        });<br/>        &lt;/script&gt;<br/>    &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="b17b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">好的，我不仅仅是加载了d3和数据。看还有什么？我还将运行时固定在一个变量中，我用<code class="fe mh mi mj lw b">const main = ...</code>称之为“main”。</p><p id="8f04" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，一旦数据被加载，我们只需要覆盖运行时上的数据。为了避免再次重复整个代码块，我们将用我们的覆盖替换<code class="fe mh mi mj lw b">[next bit goes here]</code>。让我们开始吧，首先用日期制作日期对象并添加轴标签，然后覆盖数据:</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="b47a" class="ma mb iq lw b gy mc md l me mf">const newData = Object.assign(d.map(({date, close}) =&gt; ({date: new Date(date), value: close})), {y: "$ Close"});<br/>main.redefine("data", newData);</span></pre><p id="fef7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">而且应该管用！因为我们从本地文件系统请求<code class="fe mh mi mj lw b">data.json</code>，要查看<code class="fe mh mi mj lw b">index.html</code>文件，你需要一个本地服务器(你的浏览器保护你免受恶意JS文件的攻击！).出于方便，我通常只是用</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="6850" class="ma mb iq lw b gy mc md l me mf">python3 -m http.server</span></pre><p id="bfa0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当导航到<a class="ae lr" href="http://localhost:8000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8000/ </a>查看成品时:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mk"><img src="../Images/3e831b4a38eebb0a6123b9a2e7b99aad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RUSgcYq5J4eLvJIOu3we1Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">是的，我需要升级我的浏览器。图片作者。</p></figure><p id="c78f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">干杯！</p></div></div>    
</body>
</html>