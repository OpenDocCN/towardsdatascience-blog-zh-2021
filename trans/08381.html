<html>
<head>
<title>Image Classification of PCBs and its Web Application (Flask)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">多氯联苯的图像分类及其网络应用(Flask)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/image-classification-of-pcbs-and-its-web-application-flask-c2b26039924a?source=collection_archive---------6-----------------------#2021-08-02">https://towardsdatascience.com/image-classification-of-pcbs-and-its-web-application-flask-c2b26039924a?source=collection_archive---------6-----------------------#2021-08-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4206" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Flask创建多氯联苯的图像分类模型和设计Web应用程序。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/22968306d986929bd0f888bc3accd884.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w9L0jst2QWPVOAmO-XRFkQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:<a class="ae kv" href="https://alutritos.vercel.app/index/view-29-simple-circuit-board-art/" rel="noopener ugc nofollow" target="_blank"> alutriots </a> (CC0)。</p></figure><p id="7c8d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你好，这篇博客是关于为PCB(印刷电路板)创建一个图像分类模型，以检测有缺陷的PCB并将其分类为好或坏。因此，我们将创建一个深度学习模型，并尝试获得最佳可能的结果，以及每个步骤的正确可视化。创建工作模型后，我们将使用Flask创建一个Web应用程序。你可以在我的GitHub上找到这个项目的代码，以及下面的安装说明文件。所以，让我们向前迈进，灵活应变。</p><blockquote class="ls lt lu"><p id="25e3" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated"><strong class="ky ir">要求</strong></p></blockquote><ol class=""><li id="e014" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr me mf mg mh bi translated">Jupyter笔记本</li><li id="12b3" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">Python 3.5或更高版本。(最好是3.7)</li><li id="d359" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">库— Tensorflow、Keras、Pandas、Numpy、Matplotlib、OpenCV、Pillow、Flask。【<em class="lv">所有最新版本</em></li></ol><blockquote class="ls lt lu"><p id="07e7" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated"><strong class="ky ir">了解数据集</strong></p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mn"><img src="../Images/cd633f4b76d1e5fd2384e19e45d570e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bpK_lgPS0sm47Aki7aBurw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:<a class="ae kv" href="https://pcbways.blogspot.com/1969/12/pcb-layout-altium-designer.html" rel="noopener ugc nofollow" target="_blank"> pcbways </a> (CC0)。</p></figure><p id="dff2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">PCB(印刷电路板)是一种广泛使用的电子元件，几乎用于任何电子设备。有时在工厂的大规模生产过程中会出现一些异常，从而导致有缺陷的产品。电子公司必须承担这一损失。所以这种深度学习图像分类模型有助于仅在生产时识别好的和坏的电路。</p><p id="a16c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们使用的数据集是PCB的二进制图像，其中黑色部分表示电路，白色部分表示空白电路区域。图像中的点或噪声显示异常。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/5a82716045a7c20fd43167c584afc28e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*j15CXf3rL0YBeJlsyV4olA.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图2“无缺陷”PCB的二进制图像。</p></figure><p id="b723" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们所见，图像中没有异常和缺陷。现在，我们将看到另一个有缺陷的PCB图像。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/b0a69162c6e93d59547c392757a310f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*lUJLv-cT3nTbgplr6NM4-Q.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图2“有缺陷”的PCB的二进制图像(我编辑了图像并标记了缺陷)。</p></figure><p id="0e9c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于这里标记了缺陷，这是一个有缺陷的PCB的例子。你可以从<a class="ae kv" href="https://github.com/tangsanli5201/DeepPCB" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="lv">这里</em> </strong> </a>下载数据集。</p><blockquote class="ls lt lu"><p id="d9c2" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated"><strong class="ky ir">数据准备/预处理</strong></p></blockquote><p id="eb74" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，在我们下载数据集后，我们可以看到每张图像的尺寸为640x640。如果我们降低它们的维数会更好，这样就更容易训练数据，但为了确保图像质量不受影响，我们将使用反走样技术压缩图像。</p><p id="aaca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我的<a class="ae kv" href="https://github.com/utk-ink/Image-Operation-Tools" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="lv">链接</em> </strong> </a>到我的GitHub repo，这也有助于做同样的事情。使用那里的图像调整工具，你会得到想要的结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/de0aef7c98c04e3124f54542119bdaba.png" data-original-src="https://miro.medium.com/v2/resize:fit:448/format:webp/1*t8y7DIho-6CwC7w9-LRnvA.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图处理后的224x224图像。</p></figure><p id="b2c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，在将图像大小调整为224x224后，我们将它们保存到不同的文件夹中。我保存了1，095张良莠不齐的PCB图片。因此，该文件夹将成为您的训练数据集。挑选一些其他图像(不同于训练集)并把它们放到一个单独的文件夹中，作为测试数据集。确保测试文件夹是好图像和坏图像的良好混合，并保持适当的比例。</p><p id="4666" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我将检查我的训练数据集，它具有两种类型图像的适当比例，或者换句话说，检查可能的“类别不平衡”。作为参考，我将良好的PCB图像命名为good()。jpeg和Bad as Bad()JPEG .然后我把好的图像标为‘0’，坏的图像标为‘1’。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="58e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后我们画出他们的图表</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/3d293ee27821d812f81b1e7cc72c5ad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*bFBm5ukRZDeSf_g2MjN4Dg.png"/></div></figure><p id="a223" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们可以从图表中观察到，我们的班级相当平衡。现在为了交叉验证，我们将把训练数据集分成训练集和验证集。正如我之前提到的，我拍了1095张照片。我将它们分成80%的训练数据和20%的验证集。</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="6085" class="my mz iq mu b gy na nb l nc nd">train_df, validate_df = train_test_split(df, test_size=0.20, random_state=42)</span><span id="70cc" class="my mz iq mu b gy ne nb l nc nd">train_df = train_df.reset_index(drop=True)<br/>validate_df = validate_df.reset_index(drop=True)</span></pre><p id="e2d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后我们绘制训练和测试图像比率:-</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/ff8571828af4ce729636eb11e0c26c1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*jLJ0DJgPjJPgs8QGB8EuYA.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/503ef7f6cd08adf65515cf12877e1d82.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*z3772t6wAPIs7A2AwDUbqQ.png"/></div></figure><p id="8a56" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi">⇙</p><ul class=""><li id="8a7a" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr nf mf mg mh bi translated">这是最终“训练数据集”的绘图，即两个类别中大约400+个图像。</li></ul><p id="3866" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi">⇖</p><p id="40ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi">⇙</p><ul class=""><li id="89b9" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr nf mf mg mh bi translated">这是“验证数据集”的绘图，即两个类别中大约有100多个图像。</li></ul><p id="9dbf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi">⇖</p><p id="3f31" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi">___</p><p id="62f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我将应用我认为最好的工具之一，即Keras ImageDataGenerator。这是一个非常有用的工具，因为它有助于在训练模型的同时实时进行数据扩充。正如我们所知，我们的训练数据已经很少了，所以应用增强不仅有助于我们使我们的模型更健壮，而且还节省了内存。</p><p id="2a74" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们添加路径并将图像加载到生成器中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/84859f779ab6b1e86fe4db483e71824c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dt1-fCKHdHXzoS44Yej8HA.png"/></div></div></figure><p id="3701" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，现在我们可以说我们的数据准备/预处理部分已经完成了。</p><blockquote class="ls lt lu"><p id="b9e3" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated"><strong class="ky ir">模型实现</strong></p></blockquote><p id="5380" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在是时候设计大脑了。这里我使用了在ImageNet数据集上预先训练好的<em class="lv">"</em><strong class="ky ir"><em class="lv">MobileNet</em></strong><em class="lv">"</em>模型。MobileNet是一种基于深度学习的卷积神经网络架构。它是一种轻量级架构，使用深度方向可分离的卷积。你可以从它的论文<a class="ae kv" href="https://arxiv.org/abs/1704.04861" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="lv">这里</em> </strong> </a> <em class="lv">了解更多。</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/a5b116a55799bf41507a03c90c8fa7a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*igdU_PkuLUq8EvQ-whLiTw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图MobileNets架构。资料来源:<a class="ae kv" href="https://www.hindawi.com/journals/misy/2020/7602384/fig1/" rel="noopener ugc nofollow" target="_blank">欣达维</a> (CC0)。</p></figure><p id="09d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我提到的，我们使用ImageNet数据集预训练的MobileNet模型，因此这里我们使用迁移学习的概念。因此，不是训练整个模型，我们将冻结基础层，并根据我们的要求添加一些其他层。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="d822" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于我们使用预训练的重量，我们将确保所有的重量是不可训练的，除了最后几个密集层。我把前20层设为不可训练。</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="dcb2" class="my mz iq mu b gy na nb l nc nd">for layer in model.layers[:20]:<br/>    layer.trainable=False<br/>for layer in model.layers[20:]:<br/>    layer.trainable=True</span></pre><p id="c0e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是如果你想把所有的层都设置成不可训练的，你可以用这个来代替。</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="15ab" class="my mz iq mu b gy na nb l nc nd">for layer in model.layers:    <br/>    layer.trainable=False</span></pre><p id="a074" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们已经完成了模型实现部分。</p><blockquote class="ls lt lu"><p id="e843" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated"><strong class="ky ir">训练</strong></p></blockquote><p id="8967" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们的数据准备与模型实现一起完成。现在，是时候训练我们的模型了。在继续之前，我想提一下，我使用了两个回调函数，分别名为“<em class="lv">提前停止</em>和“<em class="lv">学习率降低</em>”。</p><p id="a129" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要仔细考虑历元的数量，因为太多会导致数据过拟合，而太少会导致数据过拟合。早期停止允许您指定任意大数量的训练时期，并在模型停止对保留验证数据集进行改进时停止训练。这里有一个<a class="ae kv" href="https://machinelearningmastery.com/how-to-stop-training-deep-neural-networks-at-the-right-time-using-early-stopping/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="lv">链接</em> </strong> </a>如果你想了解更多。</p><p id="16b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当指标停止改善时，ReduceLROnPlateau会降低学习率。一旦学习停滞，模型通常会受益于将学习速度降低2-10倍。这种回调监控一个数量，如果在“耐心”次数内没有看到改进，则学习率降低。这个可以从<a class="ae kv" href="https://keras.io/api/callbacks/reduce_lr_on_plateau/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="lv">这里</em> </strong> </a>查。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="839e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们将开始训练我们的模型。嗯，我在Google Colab上训练了我的模型，因为它有一定的优势，我会建议每个人尝试使用Google Colab，你只需要在google drive上上传或链接数据集，然后通过给出正确的文件夹位置，使用这个简单的调用将其安装在Colab上</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="1fdf" class="my mz iq mu b gy na nb l nc nd">from google.colab import drive<br/>drive.mount('/content/drive')</span></pre><p id="bfb3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们将在model.fit.generator()中设置所有变量，然后开始训练我们的模型。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/7678faf16338bdd3286f418049e8ec11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kLcjvkMaipzbF1GYGp6YEQ.png"/></div></div></figure><p id="d5bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">嗯，我把我的纪元设定为50，但它停在42，因为它停止改善。我根据训练模型时提取的数据绘制了两张图表。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/89f4a770db3d9b2b1f7fb0fbed7a036a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q3GdQbzakoT5s_M2Pb7A4w.png"/></div></div></figure><p id="bbad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi">.</p><p id="56be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi">⇙</p><ul class=""><li id="7a0b" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr nf mf mg mh bi translated">“损失与时代”图表。</li></ul><p id="37ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi">⇖</p><p id="2550" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi">.</p><p id="c13c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi">⇙</p><ul class=""><li id="9b96" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr nf mf mg mh bi translated">“精确度与时代”图。</li></ul><p id="0295" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi">⇖</p><p id="5ecb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi">.</p><p id="fd90" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lv">注意:-在两个图表中，蓝线表示训练，红线表示验证变量。</em></p><p id="1656" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">于是，在训练完模型后，我得到了一个<strong class="ky ir"/><em class="lv">95.71%的验证准确率。</em></p><p id="90b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们将训练好的权重保存在. h5或. hdf5文件中(两者相同)。</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="12b6" class="my mz iq mu b gy na nb l nc nd">model.save_weights("model.h5")</span></pre><p id="0958" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你通过Google Colab训练它，你可以像这样直接在驱动器中保存重量</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="de86" class="my mz iq mu b gy na nb l nc nd">model.save('/content/drive/My Drive/folder (1)/model.h5')</span></pre><p id="c604" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此我们的训练已经完成，现在是检查结果的时候了。</p><blockquote class="ls lt lu"><p id="0308" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated"><strong class="ky ir">预测和结果</strong></p></blockquote><p id="9c1c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们将加载我们的模型。</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="14a4" class="my mz iq mu b gy na nb l nc nd">model = load_model(r'C:/Users/nEW u/Flask/model.h5')</span></pre><p id="a2cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后我们将使用ImagedataGenerator来访问测试文件夹，并共同调用图像文件。并将调用预测函数并用图像生成器函数对其进行设置。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="ff4e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们将把结果和图像一起绘制出来。我借助了Matplotlib库。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="ec58" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是我们的结果</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/1b0821a02a9e25c677eaca09a253452a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AagOOvAUxGUXuOmEor9kvQ.png"/></div></div></figure><p id="b888" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="lv">注</em> </strong> <em class="lv"> :-正如我前面提到的，我将图像文件命名为好的和坏的，以供参考。因此，初始部分是图像文件的名称，结果在括号中。因此，您可以根据图像名称将结果与实际图像质量进行比较。</em></p><p id="e99e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">至此，我们的图像分类模型成功完成。现在，是时候创建Web应用程序了。我要用烧瓶来装它。</p></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><h1 id="3249" class="ns mz iq bd nt nu nv nw nx ny nz oa ob jw oc jx od jz oe ka of kc og kd oh oi bi translated"><strong class="ak">使用Flask的Web应用程序</strong></h1><p id="7bda" class="pw-post-body-paragraph kw kx iq ky b kz oj jr lb lc ok ju le lf ol lh li lj om ll lm ln on lp lq lr ij bi translated">Flask是用于创建web应用程序的Python API。所以，首先，我会给你一个基本的代码片段，这是我们在使用Flask时通常遵循的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="3add" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">希望你有一点想法，现在让我们开始实施。</p><blockquote class="ls lt lu"><p id="4982" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated"><strong class="ky ir">功能</strong></p></blockquote><p id="d8ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们必须编写函数来调用模型，以便在将图像传递给我们的模型和预测函数之前处理图像，预测函数让我们的图像通过模型并返回结果。</p><ul class=""><li id="7dff" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr nf mf mg mh bi translated">用于调用模型:-</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><ul class=""><li id="f6c4" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr nf mf mg mh bi translated">为了处理图像:-</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><ul class=""><li id="ce71" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr nf mf mg mh bi translated">预测函数(使用<em class="lv">“load _ image”</em>函数):-</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><blockquote class="ls lt lu"><p id="2195" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated"><strong class="ky ir">设计</strong></p></blockquote><p id="aa6c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们完成了我们的功能，我们将继续设计我们的网页。因此，这里我们将需要两个页面，在第一页，它会要求选择和上传图像。第二页将显示图像和结果。</p><p id="0d64" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="lv">重要提示</em> </strong> <em class="lv"> :-使用Flask时，我们必须非常小心，因为我们需要创建一个单独的文件夹。在该文件夹中，我们将创建使用flask的python文件，我们还需要创建两个名为“Templates”和“Static”的子文件夹。模板是我们保存HTML文件的地方，在静态文件夹中，我们保存图像和其他东西。如果你想把自己从错误循环中拯救出来，你必须遵循这个惯例。</em></p><p id="df0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，由于我们需要两个页面，我相应地设计了两个HTML页面。出于设计目的，我使用了<em class="lv">“自举”</em>。Bootstrap是一个开源的前端框架，用于创建网站和网络应用。它包含各种基于HTML、CSS和JavaScript的设计模板，用于UI界面元素，如按钮和表单等。</p><p id="156d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我的第一个网页HTML文件，名为home.html</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="1f6b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意在第三行，使用了设计的引导链接(基于CSS的模板)。</p><p id="6171" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是第二页HTML文件，保存为predict.html:-</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="ef79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里同时使用了CSS和JavaScript模板。</p><blockquote class="ls lt lu"><p id="e331" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated"><strong class="ky ir">编译和部署</strong></p></blockquote><p id="3099" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的模型准备好了，功能准备好了，模板也准备好了。现在是时候编译所有这些东西，享受魔法了。</p><p id="14d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们运行烧瓶:-</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="d290" class="my mz iq mu b gy na nb l nc nd">app = Flask(__name__)</span></pre><p id="c68f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们通过调用函数来加载模型:-</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="a7c7" class="my mz iq mu b gy na nb l nc nd">get_model()</span></pre><p id="40a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们调用这两个页面以及函数和模板:-</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="e626" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">好了，现在到了最后一步，即运行一切并生成URL:-</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/e1e1ce7432420e78b32328ffd38e74ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0xHq8xzxmHkLMqumfiuY8w.png"/></div></div></figure><p id="9bfe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在生成了一个URL(注意蓝色部分)。点击它，我们会得到这样的第一页:-</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/8b1673ec7b7b3d07c5e410bd4f428e97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gpgyF9T_a3nJYGDmIyMa1Q.png"/></div></div></figure><p id="6b87" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们选择要检查的图像文件，然后单击上传。按下上传按钮后，用url+"/predict "重定向到下一个页面。它将显示图像和结果:-</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/6418dc3607b2794bd2fdb587468b5bfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0EOZl71sjRHyrvu3lc9LFQ.png"/></div></div></figure><p id="c41a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是最终结果。因此，基于深度学习模型的PCB缺陷检测Web应用程序的实现是成功的。</p><p id="bb58" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">您可以通过以下方式克隆存储库:- </strong></p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="f20d" class="my mz iq mu b gy na nb l nc nd">git clone <a class="ae kv" href="https://github.com/utk-ink/Defect-Detection-of-PCB.git" rel="noopener ugc nofollow" target="_blank">https://github.com/utk-ink/Defect-Detection-of-PCB.git</a></span></pre><p id="5f2b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">或者</p><p id="27b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">这是我的GitHub的链接，是整个代码</strong> :-</p><div class="oq or gp gr os ot"><a href="https://github.com/utk-ink/Defect-Detection-of-PCB" rel="noopener  ugc nofollow" target="_blank"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd ir gy z fp oy fr fs oz fu fw ip bi translated">GitHub-utk-ink/Defect-Detection-of-PCB:为缺陷创建深度学习模型的知识库…</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">为PCB缺陷检测创建深度学习模型并为其设计Web应用程序的存储库。…</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">github.com</p></div></div><div class="pc l"><div class="pd l pe pf pg pc ph kp ot"/></div></div></a></div><p id="17da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">希望你喜欢！！！</p><blockquote class="pi"><p id="aed0" class="pj pk iq bd pl pm pn po pp pq pr lr dk translated">这个博客没有商业化，我只是想以最好的方式分享我的知识。请鼓掌，关注和分享，因为它激励我写更多。谢谢大家！！</p></blockquote></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><p id="af8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lv">参考资料:- </em></p><ol class=""><li id="b5c9" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr me mf mg mh bi translated"><a class="ae kv" href="https://deeplizard.com/learn/video/XgzxH6G-ufA" rel="noopener ugc nofollow" target="_blank">https://deeplizard.com/learn/video/XgzxH6G-ufA</a></li><li id="674c" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated"><a class="ae kv" href="https://github.com/Charmve/Surface-Defect-Detection/tree/master/DeepPCB" rel="noopener ugc nofollow" target="_blank">https://github . com/charm ve/Surface-Defect-Detection/tree/master/deep PCB</a></li><li id="2ac5" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated"><a class="ae kv" href="https://arxiv.org/abs/1704.04861" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/abs/1704.04861</a></li><li id="5418" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated"><a class="ae kv" href="https://machinelearningmastery.com/how-to-stop-training-deep-neural-networks-at-the-right-time-using-early-stopping/" rel="noopener ugc nofollow" target="_blank">https://machine learning mastery . com/how-to-stop-training-deep-neural-networks-at-the-right-time-using-early-stopping/</a></li><li id="e655" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated"><a class="ae kv" rel="noopener" target="_blank" href="/transfer-learning-using-mobilenet-and-keras-c75daf7ff299">https://towards data science . com/transfer-learning-using-mobilenet-and-keras-c 75 daf 7 ff 299</a></li><li id="7bc3" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated"><a class="ae kv" href="https://keras.io/api/callbacks/reduce_lr_on_plateau/" rel="noopener ugc nofollow" target="_blank">https://keras.io/api/callbacks/reduce_lr_on_plateau/</a></li><li id="49c2" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated"><a class="ae kv" href="https://www.kaggle.com/uysimty/get-start-image-classification" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/uysimty/get-start-image-class ification</a></li><li id="fed7" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated"><a class="ae kv" href="https://getbootstrap.com/docs/5.0/getting-started/introduction/" rel="noopener ugc nofollow" target="_blank">https://get bootstrap . com/docs/5.0/入门/简介/ </a></li></ol></div></div>    
</body>
</html>