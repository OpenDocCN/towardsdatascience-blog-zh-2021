<html>
<head>
<title>Calculating and Setting Thresholds to Optimise Logistic Regression Performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">计算和设置阈值以优化逻辑回归性能</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/calculating-and-setting-thresholds-to-optimise-logistic-regression-performance-c77e6d112d7e?source=collection_archive---------1-----------------------#2021-05-02">https://towardsdatascience.com/calculating-and-setting-thresholds-to-optimise-logistic-regression-performance-c77e6d112d7e?source=collection_archive---------1-----------------------#2021-05-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="31dd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何创建一个简单的类来优化精确度、召回率、f1分数、准确度、TPR-FPR或定制成本函数的阈值</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/340b2f5a43e7baad5f2292f6cabc70ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uUv3yOK8z9TbG8Dz_gHwXw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@seanlimm?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">肖恩·林</a>在<a class="ae ky" href="https://unsplash.com/s/photos/computer-programming?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><h2 id="2e01" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">背景</h2><p id="8f38" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">我已经了解了逻辑回归、混淆矩阵、ROC曲线、阈值等。我参加过各种数据科学课程，但我从未完全理解它们，并希望更详细地探索它们。</p><p id="4481" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">此外，我还在网上看到了各种例子，说明如何在给定阈值的情况下重新计算真假分类，但这些例子没有提供我在现实世界中使用阈值所需的细节。</p><p id="c50b" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我怀疑可能有一种方法可以将阈值优化封装到一个简单的面向对象的类中，这样我就可以在将来轻松地使用它们，因此本文记录了我实现这些目标的学习之旅。</p><h2 id="3ca6" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">准备</h2><p id="2e6e" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">让我们从导入我们将需要的库开始…</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="1ef1" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们还需要一些数据来操作。我选取的数据是来自ka ggle—<a class="ae ky" href="https://www.kaggle.com/c/credit-default-prediction-ai-big-data/overview" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/c/credit-default-prediction-ai-big-data/overview</a>的银行信用违约数据。</p><p id="d279" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我对这些数据进行了一些清理，包括处理空值、转换分类特征和平衡数据以均匀地表示真假分类，这超出了本文的范围。下面导入的数据包括所有这些数据清理步骤…</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/3244a633a1e7ada96f7c3e0d026a8443.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wICCirQJEyktJfJO0ckpng.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="bd46" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">让我们通过将数据分为测试和培训来完成准备工作，这样我们就可以根据培训数据进行优化，稍后再回到测试数据上来…</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="99ef" class="kz la it mx b gy nb nc l nd ne">((4754, 32), (1189, 32), (4754,), (1189,))</span></pre><h1 id="98f9" class="nf la it bd lb ng nh ni le nj nk nl lh jz nm ka ll kc nn kd lp kf no kg lt np bi translated">标杆管理</h1><h2 id="8b5d" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">初步分析</h2><p id="7817" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">好了，让我们对测试数据进行基本的<code class="fe nq nr ns mx b">LogisticRegression</code>拟合，然后查看结果...</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="e242" class="kz la it mx b gy nb nc l nd ne">array([0, 0, 0, ..., 1, 0, 0], dtype=int64)</span></pre><p id="7ee2" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">混淆矩阵的可视化将有助于我们评估性能…</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/7568c2ad7c6cf51d5cff216dda667a5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*3smvx_GdK4NZR4kjq9SU_w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a8f4" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">银行数据被用来预测哪些客户会继续违反他们的信贷协议，哪些不会违约。</p><p id="060f" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们可以直接看到，一个基本的逻辑回归有79%的准确性，预测了352个客户将违约，3395个客户不会违约。</p><p id="040a" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">听起来很不错，对吧？好吧，如果我是接收这个算法的经理之一，我的第一个问题会是——“那934个假阴性呢？”。有近1000名客户没有被算法预测为违约，而是继续违约。</p><p id="612e" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">如果银行默认账户的平均成本是10，000英镑，我的数据科学团队刚刚让企业损失了934万英镑，对此我肯定不会满意！</p><p id="29cb" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">这个简单的分析揭示了三个关键点-</p><ul class=""><li id="f677" class="nu nv it lx b ly mo mb mp li nw lm nx lq ny mn nz oa ob oc bi translated"><code class="fe nq nr ns mx b">accuracy</code>测量可能并不总是评估分类算法性能的最佳方式。</li><li id="8b18" class="nu nv it lx b ly od mb oe li of lm og lq oh mn nz oa ob oc bi translated">分类算法的优化方式在很大程度上取决于企业想要实现的目标。</li><li id="704b" class="nu nv it lx b ly od mb oe li of lm og lq oh mn nz oa ob oc bi translated">必须对算法进行适当的优化，以实现预期的业务成果。</li></ul><h2 id="4fbb" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">进一步分析</h2><p id="571d" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">更深入的挖掘将揭示我们基本算法性能的所有关键指标-</p><p id="87cf" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><code class="fe nq nr ns mx b">accuracy = 0.7881783761043332 precision = 0.8282352941176471</code></p><p id="49de" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><code class="fe nq nr ns mx b">recall = 0.2737169517884914</code></p><p id="214a" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><code class="fe nq nr ns mx b">f1 score = 0.4114552893045003</code></p><p id="8f06" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><code class="fe nq nr ns mx b">true positive rate (tpr) = 0.2737169517884914</code></p><p id="e2b6" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><code class="fe nq nr ns mx b">false positive rate (fpr) = 0.02104959630911188</code></p><p id="082f" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><code class="fe nq nr ns mx b">tpr-fpr = 0.2526673554793796</code></p><p id="32f5" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我通常也会看一下ROC(受试者工作特性)曲线</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/a08f589114bcf8470dd47bb62b09cd05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uRhcEk7DC66vuc8cKLghrg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="42ff" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">黑点代表最佳点的一种解释。</p><p id="65d5" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">一种可用于计算ROC曲线上最佳点的方法是𝑇𝑃𝑅−𝐹𝑃𝑅，其中𝑇𝑃𝑅=的真阳性率和𝐹𝑃𝑅=的假阳性率。𝑇𝑃𝑅−𝐹𝑃𝑅达到最大值的点是最佳点。</p><p id="fd27" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">该图显示，如果我们将逻辑回归的阈值设置为0.31261，而不是默认值0.5，那么我们将优化𝑇𝑃𝑅−𝐹𝑃𝑅.的逻辑回归算法</p><h2 id="30d5" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">快速回顾一下阈值</h2><p id="741e" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">如果所有这些关于阈值的讨论令人困惑，有许多在线文章将解释细节，但最简单的设想是这样的</p><p id="f194" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们数据的每一行将被分类为<code class="fe nq nr ns mx b">Default=True</code>或<code class="fe nq nr ns mx b">Default=False</code>。逻辑回归为每一行分配一个带来<code class="fe nq nr ns mx b">True</code>的概率，然后对每一行进行预测，其中该概率为&gt; = 0.5，即0.5是默认阈值。</p><p id="6b18" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">一旦我们对其工作原理有了更多的了解，我们就可以使用0.5的默认值来改进和优化我们预测算法的结果。</p><h2 id="de6f" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">分析结论</h2><p id="fb23" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">根据这个快速分析，证据表明我们可以做得比接受默认阈值0.5更好，默认阈值是在作为<code class="fe nq nr ns mx b">sklearn.linear_model</code>库的一部分的<code class="fe nq nr ns mx b">LogisticRegression</code>算法中实现的。例如，我们已经知道，如果我们改变默认值为0.31261，我们将优化𝑇𝑃𝑅−𝐹𝑃𝑅TPR−FPR.</p><p id="c51a" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">然而，没有简单的方法来改变<code class="fe nq nr ns mx b">LogisticRegression</code>类中的阈值，通常数据科学家将手动完成这一点，并在多个项目中重复工作。</p><p id="4392" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们需要的是一个简单的类，每当我们想要优化阈值时，它就会为我们做这件事。</p><h1 id="aa88" class="nf la it bd lb ng nh ni le nj nk nl lh jz nm ka ll kc nn kd lp kf no kg lt np bi translated">自动化阈值计算</h1><p id="b135" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">这是我第一次尝试编写一个类来扩展<code class="fe nq nr ns mx b">LogisticRegression</code>类，以优化基于𝑇𝑃𝑅−𝐹𝑃𝑅TPR−FPR计算的阈值。它由一个类定义、一个名为<code class="fe nq nr ns mx b">threshold_from_optimal_tpr_minus_fpr</code>的方法和一个<code class="fe nq nr ns mx b">predict</code>方法组成，后者覆盖了基类方法，使<code class="fe nq nr ns mx b">threshold</code>参数能够被传入...</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="8f43" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">有了这个新的实用程序类，我们现在可以轻松地将训练数据与它相匹配，要求该类告诉我们𝑇𝑃𝑅−𝐹𝑃𝑅TPR−FPR的最佳阈值，然后使用该阈值返回一组新的预测…</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="0e59" class="kz la it mx b gy nb nc l nd ne">(0.3126109044627986, 0.3383474055618039)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/665e61caad1cd02f6f331aa0bc020bd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*w6nLIRnWzHqCG2P_KUCaxg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="8636" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">嗯，这种优化确实改变了结果的形状，如混淆矩阵所示。假阴性和真阴性减少了，而假阳性和真阳性增加了。</p><p id="24bd" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">这个发现让我问了一个问题——“还有什么其他的优化方法？”</p><h1 id="4bce" class="nf la it bd lb ng nh ni le nj nk nl lh jz nm ka ll kc nn kd lp kf no kg lt np bi translated">精确和召回的快速回顾</h1><p id="0bf5" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">评估分类算法结果的另一种方式是绘制混淆矩阵的精确度和召回率，而不是FPR和TPR。</p><p id="49fa" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">快速提醒一下，精确度和召回率的计算如下-</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/c6c24adcfdf19adbecbd6e5287d12a31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*TCCPe_MszDsoIbEVULnmgw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7b03" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">即精度是混淆矩阵的右手列，精度是底行。</p><p id="e727" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">𝑇𝑃𝑅−𝐹𝑃𝑅通常用于挑选ROC曲线上的最佳点，而F1分数可以用于挑选精度-召回曲线上的最佳点。F1分数的计算方法如下-</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/b24a3e4faa2280fe31cd0ac98c480447.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*LMXNhetpTxp1MGtaoz2Ttg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="8451" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">F1分数是精确度和召回率的调和平均值。我们使用调和平均值而不是简单平均值，因为它会惩罚极值。</p><p id="5cf1" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们默认算法的精确度和召回率的关系图如下所示-</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/674eed951ac16863417dc28f9143f334.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6BCizOZ2qvWSjVo88ChOzw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="14eb" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">这里我们可以看到最佳(即最大)F1分数是0.5237148537347345，最佳精度和召回率分别是0.41和0.72。从算法中产生这个结果的阈值是0 . 32660 . 386383863686</p><h2 id="f45d" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">自动化阈值计算需要2</h2><p id="2a57" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">扩展<code class="fe nq nr ns mx b">LogisticRegression</code>类的第二次尝试增加了一种优化F1分数的新方法，以产生最佳精度和阈值-</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="2926" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">现在，我们可以很容易地使用该类的新版本来告诉我优化f1分数所需的阈值，然后使用该值来微调算法，以获得最佳精度和召回率…</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="8a67" class="kz la it mx b gy nb nc l nd ne">(0.3126109044627986, 0.5237148537347345)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/5695269ff23f584a07f7e2729aeaa312.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*WSPzNpp7mDFT6JP4_gIC1w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="e340" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">这个版本大大减少了假阴性，代表了最大可能的优化精度和召回。</p><p id="b621" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">现在想象一下，我把新模型带回给银行的管理团队，他们说“嗯，这是一个改进，但我们必须召回90%的产品，这种模型才能有效”。</p><p id="9a38" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">记住，回忆是𝑇𝑃/(𝑇𝑃+𝐹𝑁)而此刻这个模型有922 / (364+922) = 71.7%。</p><p id="8ca6" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们需要向管理团队解释召回率和精确度是相互权衡的，因此如果模型被调优为90%的召回率，精确度肯定会降低，但是如果这是可以接受的，如何实现呢？</p><h2 id="30c2" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">自动化阈值计算需要3</h2><p id="58ce" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">第三次尝试增加了两种新方法来计算给定特定召回(和精度)所需的阈值，现在可以使用这两种方法来实现管理团队要求的性能-</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="bfa0" class="kz la it mx b gy nb nc l nd ne">(0.19142214362243234, 0.35382262996941893)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/3213c2895509546500d068eea7e908cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*z4L4ze7L-kIdKsv0po_m5w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="168a" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们可以看到，管理团队要求的召回已经实现，因此精确度从41.3%降到了35.4%。</p><h2 id="dcfd" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">自动化阈值计算需要4</h2><p id="a975" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">在这一点上，我有点忘乎所以了，我想要一个可以实现自定义成本函数的优化版本。</p><p id="ea71" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">让我们假设管理团队现在给我们以下新信息-</p><ul class=""><li id="83d6" class="nu nv it lx b ly mo mb mp li nw lm nx lq ny mn nz oa ob oc bi translated">每一个真负值意味着我们可以向不会违约的客户销售10，000份额外的信贷产品。</li><li id="f1ac" class="nu nv it lx b ly od mb oe li of lm og lq oh mn nz oa ob oc bi translated">每一次误报都会让我们损失1000英镑，因为我们本可以吸引这些客户，但我们却避开了他们。</li><li id="ccb7" class="nu nv it lx b ly od mb oe li of lm og lq oh mn nz oa ob oc bi translated">因为我们未能干预并阻止这些客户违约，所以每一次假阴性都会让我们损失1500英镑。</li><li id="94ff" class="nu nv it lx b ly od mb oe li of lm og lq oh mn nz oa ob oc bi translated">每一个真正的积极有助于我们防止信贷违约，每一个都产生20，000英镑的新收入。</li></ul><p id="4925" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">实现这一点的“成本函数”很容易构建</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="ade4" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">再做一点工作，我们可以修改我们的类，计算出优化这个成本函数所需的阈值，然后应用它-</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="5af7" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">…可以按如下方式使用-</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="06fd" class="kz la it mx b gy nb nc l nd ne">(0.4324142856743824, -40033500)</span></pre><p id="039c" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">新的混淆矩阵看起来像这样..</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/6c8f81ec31a2d3c27840821e43c263f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/1*92NAxtrVcie16fW6QJqJeg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b684" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">…这是我们的自定义成本函数值与阈值的关系图…</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/9886e2238f3c11658aabef0a0ba0b531.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qANaSZzLNmX7u_KYka5CyA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="f620" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">阈值计算自动化—最终版本</h2><p id="1f5a" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">鉴于我已经意识到最佳精度的阈值可以使用与定制成本函数非常相似的方法来计算，我想我会将其添加到最终版本中。</p><p id="fc33" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">毕竟，许多数据科学竞赛确实是基于准确性进行评估的，尽管我已经开始考虑这并不总是，事实上也不经常是分类算法有效性的最佳衡量标准。</p><p id="e2b4" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">也就是说，当我将使用训练数据计算的最佳准确性阈值插入到测试数据中时，它将预测的准确性提高了整整1%,这在数据科学竞赛中可能会有所不同！</p><p id="a376" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><code class="fe nq nr ns mx b">LogisticRegressionWithThreshold</code>类的最终版本增加了一个新方法来计算优化精度所需的阈值</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="f4c2" class="kz la it mx b gy nb nc l nd ne">(0.5654501621491699, 0.7968026924694994)</span></pre><p id="28cb" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">这是最佳(最高)精确度的混淆矩阵…</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/492377c0b1413a49385d5f1b938c7df3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*Ugwv7lA5cvqu_dwUXZcbwQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4dc8" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">…这是精度与阈值的关系图…</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/00069b52bea1f82dae10a0ea9189fb00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tDNUoKqD9kRQWpbi01ikAA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="7e11" class="nf la it bd lb ng nh ni le nj nk nl lh jz nm ka ll kc nn kd lp kf no kg lt np bi translated">结论</h1><p id="fe28" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">我们已经看到，有许多优化逻辑回归的方法，这些方法可以顺便应用于其他分类算法。这些优化包括为精确度、召回率、f1分数、准确度、TPR-FPR或定制成本函数的优化寻找和设置阈值。</p><p id="c3aa" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们还看到，所选择的优化严重依赖于期望的业务成果。</p><p id="1782" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们已经看到，<code class="fe nq nr ns mx b">sklearn.linear_model</code>中的<code class="fe nq nr ns mx b">LogisticRegression</code>类无法设置阈值来优化算法，但是我们可以使用本文中开发的<code class="fe nq nr ns mx b">LogististicRegressionWithThreshold</code>类来让我们即时访问所有必要的功能，以便根据期望的业务结果来调整基本算法。</p><p id="892a" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">完整的代码可以通过以下链接在GitHub上找到</p><div class="ot ou gp gr ov ow"><a href="https://github.com/grahamharrison68/Public-Github/blob/master/Logistic%20Regression%20Thresholds/Logistic%20Regression%20Thresholds.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd iu gy z fp pb fr fs pc fu fw is bi translated">grahamharrison68/Public-Github</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">GH公共项目库。通过在…上创建帐户，为grahamharrison68/Public-Github开发做出贡献</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">github.com</p></div></div><div class="pf l"><div class="pg l ph pi pj pf pk ks ow"/></div></div></a></div><h1 id="0561" class="nf la it bd lb ng nh ni le nj nk nl lh jz nm ka ll kc nn kd lp kf no kg lt np bi translated">感谢您的阅读！</h1><p id="d79a" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">如果你喜欢读这篇文章，为什么不看看我在https://grahamharrison-86487.medium.com/<a class="ae ky" href="https://grahamharrison-86487.medium.com/" rel="noopener">的其他文章呢？</a></p><p id="eb19" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">此外，我很乐意听到您对这篇文章、我的任何其他文章或任何与数据科学和数据分析相关的内容的看法。</p><p id="21e8" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">如果你想联系我讨论这些话题，请在LinkedIn上找我—<a class="ae ky" href="https://www.linkedin.com/in/grahamharrison1" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/grahamharrison1</a>或者发邮件给我<a class="ae ky" href="mailto:GHarrison@lincolncollege.ac.uk" rel="noopener ugc nofollow" target="_blank">ghar rison @ Lincoln college . AC . uk</a>。</p></div></div>    
</body>
</html>