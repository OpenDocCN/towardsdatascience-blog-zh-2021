<html>
<head>
<title>Neural Networks for Real-Time Audio: Raspberry-Pi Guitar Pedal</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实时音频的神经网络:树莓皮吉他踏板</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/neural-networks-for-real-time-audio-raspberry-pi-guitar-pedal-bded4b6b7f31?source=collection_archive---------3-----------------------#2021-05-24">https://towardsdatascience.com/neural-networks-for-real-time-audio-raspberry-pi-guitar-pedal-bded4b6b7f31?source=collection_archive---------3-----------------------#2021-05-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/35ccfc69fef286f84304318aa018598e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aIanP1aslwLM-12yGAQbDw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">作者图片</p></figure><div class=""/><p id="d34d" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这是关于使用神经网络进行实时音频的五部分系列的最后一部分。<br/>上一篇关于有状态LSTMs的文章，点击 <a class="ae lb" rel="noopener" target="_blank" href="/neural-networks-for-real-time-audio-stateful-lstm-b534babeae5d">这里</a> <em class="la">。</em></p><p id="a22c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg"> <em class="la">重要提示:</em> </strong> <em class="la">从写这篇文章的时候起，软件和硬件都有了很大的改进。这些更新列在本文的末尾，包括一个新的视频演示。</em></p><p id="bc1e" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在本文中，我们将一步一步地在Raspberry Pi上构建一个实时运行神经网络的功能性吉他踏板。</p><p id="0d06" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们现在已经介绍了三种不同的神经网络模型，并使用JUCE框架在实时吉他插件中实现了它们。作为一名吉他手和工程师，对我来说，下一个合乎逻辑的步骤是使用我们从以前的文章中学到的知识来制作吉他踏板。令人惊讶的是，所有的软件工具都是免费的，硬件成本大约为150美元(如果你手头已经有所需的电源和音频适配器，价格会更低)。</p><p id="1476" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让这成为可能的秘方是<a class="ae lb" href="https://elk.audio/" rel="noopener ugc nofollow" target="_blank"> Elk Audio OS </a>。这是一个基于Linux的开源操作系统，专门用于嵌入式设备上的低延迟音频处理。它允许您在Raspberry Pi等设备上运行现有的VST3插件。</p><p id="50c3" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我写的软件叫<a class="ae lb" href="https://github.com/GuitarML/NeuralPi" rel="noopener ugc nofollow" target="_blank"> NeuralPi </a>，在Github上开源。我包括了一个<a class="ae lb" href="https://www.amazon.com/Ibanez-TS9-Tube-Screamer-Classic/dp/B000T4PJC6" rel="noopener ugc nofollow" target="_blank">依班娜TS9电子管发声器</a>踏板的模型，以及一个<a class="ae lb" href="https://www.amazon.com/Fender-0213205700-Junior-Guitar-Amplifier/dp/B001OI6LP0/ref=sr_1_1?dchild=1&amp;keywords=fender+blues+jr&amp;qid=1621863208&amp;sr=8-1" rel="noopener ugc nofollow" target="_blank">挡泥板布鲁斯Jr. </a>放大器。</p><p id="360d" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">下面是一个视频，展示了在Raspberry Pi硬件上使用NeuralPi VST3插件完成的项目:</p><figure class="lc ld le lf gt is"><div class="bz fp l di"><div class="lg lh l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">特别感谢我的儿子(5岁)拍摄的介绍(视频作者)</p></figure><h1 id="5725" class="li lj jf bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">项目设置</h1><p id="cae3" class="pw-post-body-paragraph kc kd jf ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated">该项目由四个主要部分组成:</p><ol class=""><li id="fdb6" class="ml mm jf ke b kf kg kj kk kn mn kr mo kv mp kz mq mr ms mt bi translated"><a class="ae lb" href="https://www.raspberrypi.org/products/raspberry-pi-4-model-b/" rel="noopener ugc nofollow" target="_blank"> Raspberry Pi 4b </a>(运行插件的迷你电脑)</li><li id="7e78" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated"><a class="ae lb" href="https://www.hifiberry.com/shop/boards/hifiberry-dac-adc/" rel="noopener ugc nofollow" target="_blank"> HiFi Berry ADC + DAC </a>(位于Raspberry Pi顶部的模数、数模转换板。</li><li id="28d0" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated"><a class="ae lb" href="https://github.com/elk-audio/elk-pi/releases/tag/0.9.0" rel="noopener ugc nofollow" target="_blank"> Elk Audio OS </a>用于Raspberry Pi4(专门用于音频的低延迟操作系统)</li><li id="d6dc" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated">为Elk Audio OS交叉编译的实时VST3插件(<a class="ae lb" href="https://github.com/GuitarML/NeuralPi/releases/tag/v1.0" rel="noopener ugc nofollow" target="_blank"> NeuralPi </a>)(运行带有吉他放大器/踏板模型的神经网络引擎的插件)</li></ol><h1 id="90dd" class="li lj jf bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">零件和价格的完整列表:</h1><p id="23f4" class="pw-post-body-paragraph kc kd jf ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated">这是我为这个项目购买的所有东西的清单，除了HiFiBerry ADC +DAC，我从芝加哥电子公司订购的，其他都是从亚马逊订购的。</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mz"><img src="../Images/6f86467738f51e79ea4468419c270ffc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8svVj1GWVNztV-FycnwaNw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">Raspberry Pi / HifiBerry设置(图片由作者提供)</p></figure><ol class=""><li id="7afd" class="ml mm jf ke b kf kg kj kk kn mn kr mo kv mp kz mq mr ms mt bi translated"><strong class="ke jg">树莓派4b </strong>(亚马逊)，50美元(我见过售价35美元的Rpi4)</li><li id="fd00" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated">Rpi4电源适配器(USB-C连接器，5.1V — 3.5A <strong class="ke jg"> ) </strong> $10</li><li id="d592" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated">Micro SD卡(最低8GB，我买的是32GB)，12美元</li><li id="9ea2" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated">Rpi4 + HiFiBerry兼容外壳，(这里你想花多少就花多少；我买了一个适合原型制作的可定制外壳，但不同的外壳更适合成品)$20</li><li id="e3c6" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated">HDMI微型转标准HDMI适配器电缆(Rpi4有2个微型HDMI输出)$8</li><li id="25ef" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated"><strong class="ke jg"> HiFi Berry ADC + DAC </strong>，(有一款“pro”版售价65美元，但我坚持用标准版)$50</li><li id="e1c6" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated">双1/4”女性到1/8”男性立体声音频适配器(用于将吉他插入HifiBerry)，8美元</li><li id="a93f" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated">立体声男性RCA到1/4”女性音频适配器(我买了1/8”的耳机使用，但1/4”将是典型的吉他踏板输出)，8美元</li></ol><p id="1572" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">零件总成本:166美元+税费和运费</strong></p><p id="efe1" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">我已经拥有的其他物品:</strong></p><ul class=""><li id="b936" class="ml mm jf ke b kf kg kj kk kn mn kr mo kv mp kz na mr ms mt bi translated">带HDMI输入的独立电脑显示器(可使用任何带HDMI输入的屏幕)(50美元及以上)</li><li id="b0bc" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz na mr ms mt bi translated">有线USB键盘(10美元)</li><li id="3a98" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz na mr ms mt bi translated">运行Ubuntu Linux的笔记本电脑(用于构建VST3插件并通过WiFi与Rpi4通信(翻新，$250)，<em class="la">你也可以使用运行Linux的虚拟机</em></li><li id="620d" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz na mr ms mt bi translated">1/8英寸公头至1/4英寸母头适配器5美元(用于使用放大器代替耳机)</li></ul><p id="0f2a" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="la">注意:除非你自己交叉编译插件，否则不需要单独的Linux计算机。但是，您需要一台单独的计算机来连接和上传VST3到Raspberry Pi(通过WiFi或以太网)</em></p><h1 id="7486" class="li lj jf bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">组装硬件</h1><p id="e02b" class="pw-post-body-paragraph kc kd jf ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated">HifiBerry通过两排插脚连接器插入树莓皮顶部。它带有垫片，可以将HifiBerry卡固定在Rpi4的顶部。我选择了一个通用原型设置的外壳，但HiFiBerry网站提供了一个<a class="ae lb" href="https://www.hifiberry.com/shop/cases/steel-case-for-hifiberry-dac-pi-4-2/" rel="noopener ugc nofollow" target="_blank">好看的外壳</a>用于一个简单的吉他踏板项目，没有额外的脚踏开关或旋钮。我可能最终会为最终产品构建自己的外壳。</p><p id="c6ca" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">硬件组装好后，你就可以连接所有必要的适配器了。如果您熟悉使用Raspberry Pi 2，您会希望注意到它与Raspberry Pi 4的一些主要区别:</p><ol class=""><li id="53e4" class="ml mm jf ke b kf kg kj kk kn mn kr mo kv mp kz mq mr ms mt bi translated">HDMI输出为微型(而非标准尺寸)</li><li id="d957" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated">电源线是USB-C(而不是micro USB)</li><li id="c027" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated">Rpi4内置了Wifi和蓝牙功能</li></ol><h1 id="e0ce" class="li lj jf bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">为Raspberry Pi 4 + HiFiBerry设置Elk音频操作系统<strong class="ak"> ADC + DAC </strong></h1><p id="e530" class="pw-post-body-paragraph kc kd jf ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated">第一步是用树莓Pi 4的Elk Audio OS来闪存micro SD卡。为此，我们将使用一种叫做<a class="ae lb" href="https://www.balena.io/etcher/" rel="noopener ugc nofollow" target="_blank"> balenaEtcher </a>的工具，但也有其他方法可以对SD卡进行成像。</p><p id="5f59" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">使用Elk Audio操作系统对microSD进行成像</strong></p><ol class=""><li id="3496" class="ml mm jf ke b kf kg kj kk kn mn kr mo kv mp kz mq mr ms mt bi translated">从<a class="ae lb" href="https://github.com/elk-audio/elk-pi/releases" rel="noopener ugc nofollow" target="_blank"> Github </a> (.bz2)下载Rpi4的Elk音频操作系统镜像。拉开拉链。wic文件。</li><li id="1278" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated">下载并安装balenaEtcher。</li><li id="9afb" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated">将microSD卡插入电脑(最低8GB)(可能需要USB适配器将microSD连接到电脑)</li><li id="c988" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated">运行balenaEtcher并按照提示下载microSD映像。wic文件。</li><li id="6bdb" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated">成像完成后，取出microSD，插入Raspberry Pi 4上的microSD插槽。</li></ol><p id="ce55" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">使用Elk Audio操作系统启动Rpi4并执行初始设置</strong></p><ol class=""><li id="2b48" class="ml mm jf ke b kf kg kj kk kn mn kr mo kv mp kz mq mr ms mt bi translated">使用HDMI将Rpi4连接到外部显示器，连接USB键盘，并连接电源。</li><li id="93d5" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated">当登录提示出现时，键入“root”并按enter以root身份登录(默认情况下，root没有密码，但如果需要，您可以设置一个)。</li><li id="156c" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated">配置Elk音频操作系统，以配合HiFiBerry ADC + DAC使用。在命令提示符下键入以下内容:<br/> <code class="fe nb nc nd ne b">sudo elk_system_utils --set-audio-hat hifiberry-dac-plus-adc</code></li></ol><p id="c430" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">并重新启动Rpi4以使更改生效:<br/> <code class="fe nb nc nd ne b">sudo reboot</code></p><p id="c339" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">4.按照官方<a class="ae lb" href="https://elk-audio.github.io/elk-docs/html/documents/working_with_elk_board.html#connecting-to-your-board" rel="noopener ugc nofollow" target="_blank"> Elk文档</a>中的详细说明，配置通过Wifi或以太网进行通信。</p><p id="573b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">5.您现在可以通过WiFi从另一台计算机ssh(安全shell)到Rpi4。在我的Ubuntu Linux计算机上，这就像在终端上运行以下命令一样简单:</p><pre class="lc ld le lf gt nf ne ng nh aw ni bi"><span id="ea98" class="nj lj jf ne b gy nk nl l nm nn">ssh mind@&lt;ip_address_here&gt;<br/># And enter the default password for "mind" user: "elk"</span><span id="8d45" class="nj lj jf ne b gy no nl l nm nn"># Files can also be transferred to the Rpi4<br/>scp -r YourFile root@&lt;rpi-ip-address&gt;:/target_path/</span></pre><p id="38c1" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="la">注意:一旦您将Rpi4连接到WiFi，您可以通过在Elk OS终端中键入“</em> ip a <em class="la">”来获取分配给它的IP地址。</em></p><h1 id="ce0b" class="li lj jf bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">为吉他踏板选择神经网络模型</h1><p id="93ae" class="pw-post-body-paragraph kc kd jf ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated">在过去的三篇文章中，我们讨论了三种神经网络模型及其实时实现。每个模型都有自己的优点和缺点。为了给我们的踏板选择最合适的型号，我们进行了一项简单的贸易研究。每个神经网络模型都有一个从1到3的分数等级，3是最好的。选择了三个类别:训练速度、声音质量和实时性能。</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi np"><img src="../Images/057d73eadd7a7295c46ed1aca509cc58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JRvMdm7eA49x1SdgXMphIg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">表1:模型选择贸易研究(图片由作者提供)</p></figure><p id="4243" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="la">注意:每个类别都被赋予了相同的权重，但实际上对于使用Raspberry Pi来说，实时性能将是最重要的因素，其次是声音质量。</em></p><p id="19e8" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">状态LSTM模型在实时性能和声音质量方面获得了最高分。</strong>没有国家的LSTM有更高的训练速度，但是对于我们创建定制吉他踏板的应用程序来说，这相对于拥有好的声音来说是次要的。WavNet有很好的声音，但它较高的CPU使用率可能会在Raspberry Pi上造成问题(尽管这值得回去测试)。此外，WavNet在处理高增益吉他声音方面的困难使得它在吉他踏板中的使用不太吸引人。</p><h1 id="c3cc" class="li lj jf bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">Rpi4与Elk Audio工具链和JUCE的交叉编译</h1><p id="30ea" class="pw-post-body-paragraph kc kd jf ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated">如果你使用的是来自<a class="ae lb" href="https://github.com/GuitarML/NeuralPi/releases/tag/v1.0" rel="noopener ugc nofollow" target="_blank"> Github </a>的NeuralPi.vst3，可以跳过这一节。如果您想使用JUCE编译自己的VST3，或者修改现有的VST3插件以在Elk OS上运行，可以使用这些步骤。Elk Audio OS运行“无头”插件，这意味着没有图形界面。JUCE 6包含了headless构建特性，但是你可能需要进一步修改你的插件，以满足<a class="ae lb" href="https://elk-audio.github.io/elk-docs/html/documents/building_plugins_for_elk.html" rel="noopener ugc nofollow" target="_blank">构建Elk插件文档</a>中详述的需求。</p><p id="2066" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在Linux电脑或Linux虚拟机上(我用的是Ubuntu 18.04):</p><ol class=""><li id="44aa" class="ml mm jf ke b kf kg kj kk kn mn kr mo kv mp kz mq mr ms mt bi translated">为Rpi4下载<a class="ae lb" href="https://github.com/elk-audio/elkpi-sdk/releases/tag/0.9.0" rel="noopener ugc nofollow" target="_blank"> Elk Audio SDK </a></li><li id="2723" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated">运行下载的SDK(。sh文件)进行安装。我使用了默认位置:<code class="fe nb nc nd ne b">/opt/elk/1.0</code></li><li id="c098" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated">打开你的。使用Projucer应用程序的jucer项目(JUCE 6，我使用的是JUCE 6.08)，并根据<a class="ae lb" href="https://elk-audio.github.io/elk-docs/html/documents/building_plugins_for_elk.html#cross-compiling-juce-plugin" rel="noopener ugc nofollow" target="_blank"> Elk文档</a>修改项目(参见“内部Projucer:”部分)。</li><li id="4c33" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated">创建一个Linux makefile构建目标(如果它还不存在),并保存Projucer项目以生成Makefile目录和Makefile。</li><li id="d858" class="ml mm jf ke b kf mu kj mv kn mw kr mx kv my kz mq mr ms mt bi translated">遵循<a class="ae lb" href="https://elk-audio.github.io/elk-docs/html/documents/building_plugins_for_elk.html#cross-compiling-juce-plugin" rel="noopener ugc nofollow" target="_blank">交叉编译JUCE插件</a>文档中详述的步骤。以下是我使用的具体步骤:</li></ol><figure class="lc ld le lf gt is"><div class="bz fp l di"><div class="nq lh l"/></div></figure><p id="a0f0" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">进入<em class="la"> make </em>命令后，插件将开始编译。如果一切顺利，你现在将拥有一个兼容Elk OS / Raspberry Pi 4的. vst3插件。</p><p id="5a12" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">重要提示:确保编译后的VST3中的架构文件夹名称为“aarch64-linux”，例如“plugin name . vst 3/Contents/aarch 64-Linux”，否则插件不会在Elk OS上运行。如有必要，将文件夹重命名为“aarch64-linux”。</p><h1 id="3ed5" class="li lj jf bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">使用RTNeural优化插件代码</h1><p id="0ce6" class="pw-post-body-paragraph kc kd jf ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated">当我第一次在Raspberry Pi上运行我的插件时，我立刻遇到了问题。它运行没有任何错误，但它发出了可怕的声音:</p><figure class="lc ld le lf gt is"><div class="bz fp l di"><div class="nr lh l"/></div></figure><p id="de9b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在<a class="ae lb" href="https://forum.elk.audio/t/guitar-pedal-bad-sound-using-juce-cross-compiled-vst3-and-hifiberry-dac-adc/631/6" rel="noopener ugc nofollow" target="_blank">麋鹿音频论坛</a>的帮助下，我的插件运行太慢了。如果我查看进程诊断，它使用了99%的CPU资源，并且很可能超过了这个数量。我必须找到一种方法来优化我的代码，否则它将无法使用。</p><p id="7ec6" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在我得出结论说我当前的插件不能在Pi上工作的第二天，一个非常偶然的事情发生了，RTNeural的创建者找到了我，对在我的一个插件中实现他的代码感兴趣。事实证明，他在优化音频处理的神经网络方面做了相当多的研究，并创建了RTNeural作为实时音频的推理引擎。</p><p id="ca51" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">事实证明，将我的LSTM推理代码换成RTNeural相当简单。我用Pi上的RTNeural加载了新编译的插件，交叉手指，查看了进程诊断。起初我不敢相信我所看到的:它已经从99%下降到16%！我插上吉他和耳机，它听起来就像笔记本电脑上的插件。我添加了一些延迟和混响，并直接从树莓派录制了这个样本:</p><figure class="lc ld le lf gt is"><div class="bz fp l di"><div class="nr lh l"/></div></figure><p id="603d" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我不会深入解释为什么RTNeural能够为我的插件增压，但这与利用<a class="ae lb" href="https://en.wikipedia.org/wiki/SIMD" rel="noopener ugc nofollow" target="_blank"> SIMD </a>(单指令，多数据)指令有关。这些是使用进程矢量化来并行运行计算的低级操作(类似于图形卡所做的)。现代处理器具有这种在CPU上进行高性能计算的能力。</p><h1 id="9fd2" class="li lj jf bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">在Elk Audio操作系统上运行实时插件</h1><p id="3e40" class="pw-post-body-paragraph kc kd jf ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated">Elk用的是一个叫“寿司”的外挂主机。Sushi使用配置文件来设置音频路由、插件设置和midi设置。你可以在<a class="ae lb" href="https://github.com/GuitarML/NeuralPi/blob/main/elk_configs/config_neuralpi.json" rel="noopener ugc nofollow" target="_blank"> Github </a>上查看NeuralPi的配置文件示例。为了将你的插件移动到Raspberry Pi，我推荐在WiFi上使用“ssh”(安全外壳)。我使用了一台专用的Ubuntu Linux笔记本电脑，但是有几种方法可以做到这一点。我将回顾一下我在这里使用的步骤。</p><ol class=""><li id="9bb9" class="ml mm jf ke b kf kg kj kk kn mn kr mo kv mp kz mq mr ms mt bi translated"><strong class="ke jg">从</strong> <a class="ae lb" href="https://github.com/GuitarML/NeuralPi/releases/tag/v1.0" rel="noopener ugc nofollow" target="_blank"> <strong class="ke jg"> Github </strong> </a> <strong class="ke jg">下载NeuralPi-elk.zip并解压. vst3和配置文件。</strong></li></ol><p id="fd33" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">注意:本文引用了NeuralPi的原始版本。有关具有更新功能的最新版本，请参见<a class="ae lb" href="https://github.com/GuitarML/NeuralPi/releases" rel="noopener ugc nofollow" target="_blank"> <strong class="ke jg"> NeuralPi版本</strong> </a>页面。</p><p id="b46d" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg"> 2。将. vst3移动到Rpi4。</strong></p><p id="ebad" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用此处描述的<a class="ae lb" href="https://elk-audio.github.io/elk-docs/html/documents/working_with_elk_board.html#connecting-to-your-board" rel="noopener ugc nofollow" target="_blank">方法之一连接到Pi。为了通过ssh over Wifi进行连接，我在一台单独的Linux计算机上使用了以下命令，该计算机与Pi连接到同一个Wifi网络。</a></p><pre class="lc ld le lf gt nf ne ng nh aw ni bi"><span id="3407" class="nj lj jf ne b gy nk nl l nm nn"># Secure copy the .vst3 to the Raspberry Pi</span><span id="9ff1" class="nj lj jf ne b gy no nl l nm nn">scp -r YourPlugin.vst3 root@&lt;rpi-ip-address&gt;:/home/mind/plugins/<br/></span><span id="0ac3" class="nj lj jf ne b gy no nl l nm nn"># After you copy the vst3 to the RPi, you can ssh to verify it <br/>#  copied correctly</span><span id="661f" class="nj lj jf ne b gy no nl l nm nn">ssh root@&lt;rpi_ip_address&gt;</span></pre><p id="dd1e" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg"> 3。为运行插件创建一个. json配置文件。如果运行的是NeuralPi.vst3，可以使用Github发行版中包含的版本。</strong></p><pre class="lc ld le lf gt nf ne ng nh aw ni bi"><span id="c455" class="nj lj jf ne b gy nk nl l nm nn"># Secure copy the .config to the Raspberry Pi</span><span id="fad1" class="nj lj jf ne b gy no nl l nm nn">scp -r YourConfig.config    <br/>       root@&lt;rpi-ip-address&gt;:/home/mind/config_files/</span></pre><p id="f55c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg"> 4。连接音频适配器、吉他输入和音频输出设备(扬声器、耳机、放大器)。</strong></p><p id="985b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg"> 5。使用Sushi运行插件。</strong></p><pre class="lc ld le lf gt nf ne ng nh aw ni bi"><span id="c06a" class="nj lj jf ne b gy nk nl l nm nn"># Login to the "mind" user and run the plugin with sushi<br/>#  (the default password is  "elk")</span><span id="12ca" class="nj lj jf ne b gy no nl l nm nn">ssh mind@&lt;rpi_ip_address&gt;<br/></span><span id="cdd3" class="nj lj jf ne b gy no nl l nm nn">sushi -r --multicore-processing=2 -c ~/config_files/config_neuralpi.json &amp;</span></pre><p id="89ca" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这将在后台运行无头插件。您可以通过键入以下命令查看实时插件的进程使用情况:<br/> <code class="fe nb nc nd ne b">watch -n 0.5 cat /proc/xenomai/sched/stat</code></p><p id="b0aa" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="la">注意:使用标准的Linux流程工具，如“</em>top”<em class="la">只会显示非实时任务。</em></p><p id="a766" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">要退出插件，请在终端中键入以下内容:<br/> <code class="fe nb nc nd ne b">pkill sushi</code></p><p id="862c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您可以设置Raspberry Pi在启动时自动<a class="ae lb" href="https://elk-audio.github.io/elk-docs/html/documents/working_with_elk_board.html#configuring-automatic-startup" rel="noopener ugc nofollow" target="_blank">运行配置。这对于像操作典型的音频效果设备一样操作Pi非常有用。</a></p><h1 id="2bbd" class="li lj jf bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">实时性能</h1><p id="8597" class="pw-post-body-paragraph kc kd jf ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated">当Pi上的进程使用率为16%时，有足够的空间添加其他效果，如cab模拟(脉冲响应)、混响、延迟、凸缘或任何数量的CPU密集型效果。说到树莓派的可能性，天空是无限的。人们可以创建一个手机应用程序，通过WiFi控制插件，添加旋钮和控件，甚至双启动另一个运行媒体中心、网络浏览器或视频游戏模拟器的操作系统。</p><p id="256b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Elk Audio OS专为低延迟音频而设计，因此您不必像在普通笔记本电脑上那样担心其他进程会干扰插件性能。Raspberry Pi 4处理器有四个内核，两个运行实时操作，两个运行非实时操作。这确保了音频性能保持不变。</p><p id="1418" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在这个树莓皮吉他踏板非常简单，但我计划添加物理旋钮和一个好看的外壳，把它变成一个真正的吉他踏板。一旦完成，我将发布一篇关于构建过程的新文章。</p><h1 id="d959" class="li lj jf bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">软件更新</h1><p id="de53" class="pw-post-body-paragraph kc kd jf ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated"><strong class="ke jg">更新1 </strong>:自从写这篇文章以来，我已经增加了从Windows或Mac电脑使用NeuralPi插件/应用程序通过WiFi控制模型选择、均衡器/增益/音量的能力。多个放大器和踏板模型可用<a class="ae lb" href="https://guitarml.com/tonelibrary/tonelib-npi.html" rel="noopener ugc nofollow" target="_blank">这里</a>。(1.1版)更多详情请参见NeuralPi GitHub页面:</p><div class="ip iq gp gr ir ns"><a href="https://github.com/GuitarML/NeuralPi" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd jg gy z fp nx fr fs ny fu fw je bi translated">吉他ML/NeuralPi</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">NeuralPi是一个吉他踏板，使用神经网络来模拟树莓Pi 4上的真实放大器和踏板。神经肽…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">github.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og ix ns"/></div></div></a></div><p id="7268" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">更新2</strong>:neural pi推出3d打印表壳。STL文件可以在<a class="ae lb" href="https://guitarml.com/#products" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/ff98b64f83d11ac7d8cde4b9d90fb4c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*cSMpzvLID6yHwD6uRWhBng.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">STL模型(上图)和无盖印刷盒(下图)(图片由作者提供)</p></figure><p id="f437" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">更新3</strong>:neural pi软件的1.2版本现在包括加载脉冲响应文件的功能，以及简单的延迟和混响效果。脉冲响应是一种常用的效果，用于模拟吉他音箱或特定空间的混响特性。当与LSTM模型相结合，它提供了一个吉他放大器更现实的表现。</p><div class="ip iq gp gr ir ns"><a href="https://github.com/GuitarML/NeuralPi/releases/tag/v1.2.0" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd jg gy z fp nx fr fs ny fu fw je bi translated">发布NeuralPi 1.2.0 GuitarML/NeuralPi</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">NeuralPi 1.2.0发布了新特性:增加了红外载入，增加了延迟和混响效果，更新了脚本，增加了新的红外…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">github.com</p></div></div><div class="ob l"><div class="oi l od oe of ob og ix ns"/></div></div></a></div><p id="4a2d" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">更新4</strong>:neural pi 1.3版本增加了加载条件模型(增益/驱动旋钮的全范围)的能力，并将默认快照模型替换为TS-9、Blues Jr和HT40放大器的条件模型。</p><div class="ip iq gp gr ir ns"><a href="https://github.com/GuitarML/NeuralPi/releases/tag/v1.3.0" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd jg gy z fp nx fr fs ny fu fw je bi translated">发布NeuralPi 1.3.0 GuitarML/NeuralPi</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">NeuralPi 1.3.0发布了新特性:-除了快照模型之外，增加了加载条件模型的能力。这些…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">github.com</p></div></div><div class="ob l"><div class="oj l od oe of ob og ix ns"/></div></div></a></div><p id="958c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">更新5(2023年2月9日):</strong>我使用NeuralPi软件的更新版本制作了一个名为Proteus的实际吉他踏板，用于更真实的模型。踏板包括一个金属外壳中的缓冲输入、音量控制和线路/乐器电平开关。您可以在此处观看视频演示和硬件演练:</p><figure class="lc ld le lf gt is"><div class="bz fp l di"><div class="lg lh l"/></div></figure><p id="eab4" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这结束了我的关于使用神经网络进行实时音频的五部分系列。我希望它能激发你对音乐神经网络可能性的好奇心，甚至说服你自己尝试一下。</p><p id="d6e6" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="la">感谢您的阅读！</em></p><p id="896e" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你想继续阅读关于吉他效果的机器学习，请在这里查看我的下一篇文章:</p><div class="ip iq gp gr ir ns"><a rel="noopener follow" target="_blank" href="/transfer-learning-for-guitar-effects-4af50609dce1"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd jg gy z fp nx fr fs ny fu fw je bi translated">吉他效果的迁移学习</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">如果每一件新事物都要从头学起，生活会有多艰难？如果一旦你学会了“狗”这个词，你…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="ok l od oe of ob og ix ns"/></div></div></a></div><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mz"><img src="../Images/94c46d4c8b2206bbf6efb4e726ea3514.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9eMTzPPc_sgQ88fOLt4_Qw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">作者图片</p></figure></div></div>    
</body>
</html>