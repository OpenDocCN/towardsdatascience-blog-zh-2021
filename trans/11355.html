<html>
<head>
<title>How to calculate confidence intervals in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 Python 中计算置信区间</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-calculate-confidence-intervals-in-python-a8625a48e62b?source=collection_archive---------0-----------------------#2021-11-08">https://towardsdatascience.com/how-to-calculate-confidence-intervals-in-python-a8625a48e62b?source=collection_archive---------0-----------------------#2021-11-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="18fa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于如何在 Python 中计算置信区间的简便指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e61f7a9650876d6af93bbaaf97045406.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*O-kSG7rM2InakUhl.jpg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="ky">照片由</em><a class="ae kz" href="https://unsplash.com/@edge2edgemedia?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"><em class="ky">edge 2 edge Media</em></a><em class="ky"/><a class="ae kz" href="https://unsplash.com/s/photos/statistics?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"><em class="ky">Unsplash</em></a></p></figure><p id="3153" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">当我们测量一些东西时，我们总是要计算结果的不确定性。置信区间是一个非常有用的工具，用来计算一个范围，在这个范围内，我们可以找到具有一定置信度的可观测值的真实值。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="f6dd" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">什么是置信区间？</h1><p id="8613" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">想象你问我身高。我可以说我身高 1.93 米，但我不会给你任何关于这个测量的不确定性的信息。置信区间是我们有一定的信心找到我们测量的可观测值的真实值的区间。科学家通常会寻找 95%的置信区间，但使用 90%甚至 99%也很常见。所以，当你问我的身高时，我应该用一个误差估计或者一个置信区间来回答你，比如“有 95%的把握我身高 1.92 米到 1.93 米”。</p><p id="f897" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这就是这个工具给我们的:一个区间，在这里可以找到可观察的真实价值。</p><p id="cdcc" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">置信区间的一些有用属性是:</p><ul class=""><li id="ee3f" class="na nb it lc b ld le lg lh lj nc ln nd lr ne lv nf ng nh ni bi translated">固定置信度，当样本量增加时，区间越来越窄。这是由于大数定律</li><li id="9081" class="na nb it lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">固定样本中的点数，当置信度增加时，区间越来越宽。所以，要有更大的信心，就要有更大的区间。</li></ul><p id="47f5" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在数据科学和统计学中，置信区间对于给出我们测量的科学结果非常有用，其他科学家可以用它来比较他们的结果和我们的结果。</p><h1 id="a858" class="md me it bd mf mg no mi mj mk np mm mn jz nq ka mp kc nr kd mr kf ns kg mt mu bi translated">置信区间公式</h1><p id="e51c" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">在本文中，我将介绍样本平均值的置信区间的计算，这是对总体期望值的估计。</p><p id="58ca" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">给定<em class="nt"> m </em>平均值、<em class="nt"> s </em>样本标准差和<em class="nt"> N </em>样本量，置信区间由以下公式定义:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/a20e0904ca5327977f8489a9c0183b48.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/format:webp/1*oLjDLsANBTeh7k-e5kPgbA.png"/></div></figure><p id="78ee" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">有一个<em class="nt"> t </em>参数，你可以看到，它与我们想要的置信度有关。这个参数的计算可以用不同的方式来完成。如果我们的样本量很小(即少于 30 点)，我们可以使用学生的 t 分布来计算它。给定置信度，我们必须选择<em class="nt"> t </em>的值，该值给出[ <em class="nt"> -t，t </em> ]区间中的分布面积，该面积等于我们的置信度。</p><p id="0b3a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">从数学上讲，给定一个等于<em class="nt"> c </em>的置信度值，<em class="nt"> t </em>对应的值为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/4a33b54a9ead6a91f7999e36c55826a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*wdFNn73-HSxMSr94rwYytQ.png"/></div></figure><p id="54e8" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">其中<em class="nt"> I(x) </em>是学生的具有<em class="nt"> N-1 </em>个自由度的逆累积分布函数。实际上，它是我们从 1 中减去置信度后，分布的右尾等于剩余面积的一半的值。这样，包含在尾部之间的面积就等于我们想要的置信度。</p><p id="5d3d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果样本量很大(即大于 30 个点)，我们可以用正态分布来近似学生的 t 分布，并忽略自由度。</p><p id="6b26" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这些分布背后的原因是中心极限定理的结果。对于大样本，样本平均值的行为类似于高斯变量(如果测量值是独立的且总体方差有限)。对于小样本量，我们使用学生的 t 分布。</p><h1 id="4976" class="md me it bd mf mg no mi mj mk np mm mn jz nq ka mp kc nr kd mr kf ns kg mt mu bi translated">使用引导程序</h1><p id="5adb" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">关注我的文章的人都知道我非常喜欢<a class="ae kz" href="https://www.yourdatateacher.com/2021/04/19/the-bootstrap-the-swiss-army-knife-of-any-data-scientist/" rel="noopener ugc nofollow" target="_blank">引导技术</a>。这是因为它是一个无偏的算法，不对数据集的分布做任何假设。</p><p id="bc80" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们可以使用 bootstrap 来计算置信区间，方法如下:</p><ol class=""><li id="c338" class="na nb it lc b ld le lg lh lj nc ln nd lr ne lv nw ng nh ni bi translated">基于我们的数据集创建一个新的样本，替换掉相同数量的点</li><li id="f9e5" class="na nb it lc b ld nj lg nk lj nl ln nm lr nn lv nw ng nh ni bi translated">计算平均值并存储在数组或列表中</li><li id="5e6f" class="na nb it lc b ld nj lg nk lj nl ln nm lr nn lv nw ng nh ni bi translated">多次重复该过程(例如 1000 次)</li><li id="8430" class="na nb it lc b ld nj lg nk lj nl ln nm lr nn lv nw ng nh ni bi translated">在平均值列表中，计算 2.5%和 97.5%的值(如果您想要 95%的置信区间)</li></ol><p id="6c49" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Bootstrap 给了我们一个无偏的估计，支付了复杂算法的计算成本。当编写这样的算法不成问题时，我更喜欢使用它，但通常在几乎所有情况下，您都可以安全地使用原始公式。</p><h1 id="d1da" class="md me it bd mf mg no mi mj mk np mm mn jz nq ka mp kc nr kd mr kf ns kg mt mu bi translated">Python 中的置信区间计算器</h1><p id="4f5d" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">现在让我们使用 Student 的 t 分布和 bootstrap 技术来计算 Python 中的置信区间。</p><p id="6a57" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们导入一些有用的库。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="8549" class="oc me it ny b gy od oe l of og">import numpy as np <br/>from scipy.stats import t</span></pre><p id="ea0a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在让我们模拟一个数据集，它由从正态分布中提取的 100 个数字组成。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="e7bd" class="oc me it ny b gy od oe l of og">x = np.random.normal(size=100)</span></pre><p id="f97a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们看看我们要计算平均值的 95%置信区间。让我们根据置信区间的公式来计算我们需要的所有数字。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="f2d8" class="oc me it ny b gy od oe l of og">m = x.mean() <br/>s = x.std() <br/>dof = len(x)-1 <br/>confidence = 0.95</span></pre><p id="6ab2" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们现在需要<em class="nt"> t </em>的值。计算逆累积分布的函数是<em class="nt"> ppf。</em>我们需要应用绝对值，因为累积分布适用于左尾，所以结果将是负的。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="c22b" class="oc me it ny b gy od oe l of og">t_crit = np.abs(t.ppf((1-confidence)/2,dof))</span></pre><p id="08ad" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，我们可以应用原始公式来计算 95%的置信区间。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="8bf5" class="oc me it ny b gy od oe l of og">(m-s*t_crit/np.sqrt(len(x)), m+s*t_crit/np.sqrt(len(x))) </span><span id="2e82" class="oc me it ny b gy oh oe l of og"># (-0.14017768797464097, 0.259793719043611)</span></pre><p id="a4f3" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们知道这是正确的，因为正态分布的均值为 0，但如果我们对总体一无所知，我们可以说，在 95%的置信度下，总体的期望值介于-0.14 和 0.26 之间。</p><p id="3532" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们可以用无偏的 bootstrap 得出同样的结果。在这个例子中，我创建了数据集的 1000 个重采样(带有替换)。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="2897" class="oc me it ny b gy od oe l of og">values = [np.random.choice(x,size=len(x),replace=True).mean() for i in range(1000)] </span><span id="2fd8" class="oc me it ny b gy oh oe l of og">np.percentile(values,[100*(1-confidence)/2,100*(1-(1-confidence)/2)]) </span><span id="fefe" class="oc me it ny b gy oh oe l of og"># array([-0.13559955, 0.26480175])</span></pre><p id="3fb6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">正如我们所看到的，这个结果几乎等于我们用封闭公式得出的结果。</p><h1 id="0b37" class="md me it bd mf mg no mi mj mk np mm mn jz nq ka mp kc nr kd mr kf ns kg mt mu bi translated">结论</h1><p id="b434" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">置信区间很容易计算，可以为数据分析师和科学家提供非常有用的见解。它们给出了非常强大的误差估计，如果使用正确，可以真正帮助我们从数据中提取尽可能多的信息。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="e294" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><em class="nt"> Gianluca Malato 是一名数据科学家，在</em><a class="ae kz" href="http://www.yourdatateacher.com/" rel="noopener ugc nofollow" target="_blank"><em class="nt"/></a><em class="nt">上教授机器学习和数据科学。</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="d213" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><em class="nt">原载于 2021 年 11 月 8 日 https://www.yourdatateacher.com</em><em class="nt">的</em> <a class="ae kz" href="https://www.yourdatateacher.com/2021/11/08/how-to-calculate-confidence-intervals-in-python/" rel="noopener ugc nofollow" target="_blank"> <em class="nt">。</em></a></p></div></div>    
</body>
</html>