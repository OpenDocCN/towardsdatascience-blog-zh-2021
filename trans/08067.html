<html>
<head>
<title>How to Implement Random Forest, SVM, and Gradient Boosted Models for Time-to-Event Analyses</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何实现用于事件时间分析的随机森林、SVM和梯度增强模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-implement-random-forest-svm-and-gradient-boosted-models-for-time-to-event-analyses-5d79d8153bcd?source=collection_archive---------8-----------------------#2021-07-24">https://towardsdatascience.com/how-to-implement-random-forest-svm-and-gradient-boosted-models-for-time-to-event-analyses-5d79d8153bcd?source=collection_archive---------8-----------------------#2021-07-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8d54" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">带示例的循序渐进教程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/02cea586a5405a424716ea7cadd6acfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wrgjhH6hdc0YndcoNTMcZQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">乔纳森·彼得森在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="9376" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将比较几种先进的方法来进行时间-事件分析(又名生存分析)。具体来说，我们将涵盖随机森林，梯度推进和SVM生存模型。</p><p id="699d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">时间-事件分析是帮助我们分析问题的重要方法，其中我们的研究问题有时间成分。顾名思义，当我们对理解时间和某个事件之间的关系感兴趣时，就会用到这些。</p><p id="f8d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然我们通常在生物研究(即临床、制药)中发现这些研究，但它同样适用于其他领域(即工程、商业、营销)。一些例子包括:</p><ul class=""><li id="b96c" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">疾病复发的时间</li><li id="e847" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">死亡时间</li><li id="ffc7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">下次购买的时间</li><li id="7ea0" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">取消会员资格的时间</li></ul><p id="dbc4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事件时间分析是一种修改的回归任务，但它是独特的，因为一部分数据是不完整的(经过审查的)。要理解这意味着什么，请看下图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/f124ad3a1b27700ca4a21986c0eec6a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mLgtEYK-RWPlx5i2w59c3A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1 —事件发生时间(存活)分析。灰色数字代表一个事件。红色数字完成研究，无事件。黄色图没有完成研究，但也没有事件。(<em class="mk">图片作者)</em></p></figure><p id="fbd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设这是一项临床试验，观察某种药物对肿瘤复发时间的疗效。两个灰色数字代表观察到的事件(新肿瘤)，一个在3年后，另一个在6.5年左右。红色数字完成了这项研究，历时10年，没有观察到任何事件。最后，黄色的数字没有完成研究。他们在5年时从研究中丢失，但没有观察到任何事件。</p><p id="51ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本例中，灰色数字代表<em class="ml">未经审查的</em>数据，而红色和黄色数字代表<em class="ml">经审查的</em>数据。删失数据指的是仅部分已知的数据。具体来说，红色数字完成了10年的研究。虽然没有观察到肿瘤复发，但这并不意味着两周后没有新的肿瘤形成(希望没有)。</p><p id="caca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">黄色数字在5年时从研究中移除，在他们参与研究期间没有观察到新的肿瘤。它们为什么被移除？也许有不可接受的副作用。也许目标死于其他原因。另一种看待受审查参与者的方式是，他们在最后一次随访前没有发生任何事件。</p><h2 id="5700" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">数据</h2><p id="de30" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">对于今天的例子，我们将使用NKI乳腺癌数据集。你可以在这里找到数据集<a class="ae ky" href="https://data.world/deviramanan2016/nki-breast-cancer-data" rel="noopener ugc nofollow" target="_blank">。完整的数据集包括272名乳腺癌患者(行)和1570列。出于时间的考虑，我选择将列数减少到11个预测变量和2个结果变量(事件和存活时间)。下面，你可以预览我们的数据集。</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2 —我们分析中使用的NKI乳腺癌数据集的选择。</p></figure><p id="6a2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关数据集中变量的快速描述，请参考下图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3——数据集中变量的描述</p></figure><p id="40ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们开始之前，分割数据与大多数机器学习模型略有不同，因为我们有2个目标变量。这可以使用下面的代码来完成。</p><p id="a5e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很重要的一点是，y变量的格式应该使事件指示器为布尔型，时间变量为浮点型。点击查看更多<a class="ae ky" href="https://scikit-survival.readthedocs.io/en/latest/api/generated/sksurv.datasets.get_x_y.html" rel="noopener ugc nofollow" target="_blank">细节。</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4 —为事件时间分析创建数据集</p></figure><p id="03fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以建立我们的时间到事件模型，看看哪一个表现最好！</p><h2 id="4209" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">1.随机森林生存模型</h2><p id="8353" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">如果你有兴趣了解更多关于随机森林模型是如何工作的，我建议你看看scikit-survival <a class="ae ky" href="https://scikit-survival.readthedocs.io/en/stable/user_guide/random-survival-forest.html" rel="noopener ugc nofollow" target="_blank">文档</a>。也有很多关于这个主题的帖子，其中一个你可以在这里找到<a class="ae ky" rel="noopener" target="_blank" href="/understanding-random-forest-58381e0602d2">。</a></p><p id="ffa9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您在下面看到的，运行算法非常简单。在导入您决定评估的模型和指标之后(块1)，您可以创建您的模型(块2)。</p><p id="f818" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将模型与数据拟合后，您可以发现它在测试集上的效果如何。事件时间分析最常用的指标是c指数(和谐指数)。这是预测风险值与观察时间之间的等级相关分数。你可以在这里找到更多关于这个<a class="ae ky" href="https://scikit-survival.readthedocs.io/en/stable/api/generated/sksurv.metrics.concordance_index_censored.html" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><p id="52ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的结果提供了0.77的c指数，这可以解释为一个很好的模型。仅仅作为一个引子，c指数得分为:</p><ul class=""><li id="a3f9" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">在预测结果方面，0.5并不比随机概率更好</li><li id="048c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">&gt; 0.7表示模型良好</li><li id="4674" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">&gt; 0.8表示强模型</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图5 —实现随机森林生存模型</p></figure><p id="52b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管c-index为我们提供了整个模型的信息，但考察模型在不同时间点的表现也很有趣。为此，我们可以使用<em class="ml"> cumulative_dynamic_auc </em>指标，并使用下面的代码将其可视化。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图6——如何计算和绘制依赖于时间的AUC</p></figure><p id="9eea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下图中，我们看到，尽管该模型在整个研究中表现良好(最小auc = 0.72)，但在第2-4年和第11-12年出现峰值，auc值&gt; 0.80。如果我们试图解释这一点，我们将不得不更多地查阅科学文献，以帮助我们理解哪些因素可能影响不同时间点的存活率。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/2de2713e986d001aa97ef67fc47fbc18.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*D3-YPgH0Es-F8hRVPRtEoA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图7-随机森林生存模型的时间相关AUC分数。(<em class="mk">图片作者)</em></p></figure><p id="aacb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经有了模型，是时候找出不同的特性是如何影响我们的模型的了。有几个包可供选择，我从中选择了<a class="ae ky" href="https://eli5.readthedocs.io/en/latest/overview.html" rel="noopener ugc nofollow" target="_blank"> ELI5 </a>。下面，您将找到为您的模型实现这一点的必要代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图8 —使用eli5的特性重要性</p></figure><p id="ea1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果表明，雌激素受体表达(esr1)、严重性(等级)和大小(直径)、脉管系统结构的侵袭和年龄是我们模型中的前五个区别特征。有趣的是，在这项研究中，化疗或激素疗法并不能很好地区分那些活着或死去的人。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图9-随机森林生存模型的特征重要性</p></figure><h2 id="c488" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">2.梯度增强模型</h2><p id="cc5f" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">梯度增强模型与随机森林模型有一些相似之处，因为它们都是集合方法。他们将多个模型的预测结合起来，以改进整体模型。区别在于它们是如何组合的。</p><p id="3039" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然随机森林独立地适合许多不同的树并平均它们的预测，但是梯度增强模型是相加的。在后者中，来自一个模型的加权特征以连续的方式被输入到下一个模型中。更多信息，请查看scikit survival <a class="ae ky" href="https://scikit-survival.readthedocs.io/en/stable/user_guide/boosting.html" rel="noopener ugc nofollow" target="_blank">文档</a>。你也可以看看这篇<a class="ae ky" rel="noopener" target="_blank" href="/ensemble-methods-bagging-boosting-and-stacking-c9214a10a205">文章</a>，它详细解释了增压和装袋。</p><p id="634d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与随机森林生存模型相似，它从导入模型开始(参见下面的代码)。有三种损失函数可用，在这里有更详细的描述<a class="ae ky" href="https://scikit-survival.readthedocs.io/en/stable/user_guide/boosting.html#Losses" rel="noopener ugc nofollow" target="_blank">。我选择了考克斯比例风险模型(coxpf)，这是默认的损失函数，但你可以尝试所有这些方法，看看你的结果有什么不同。</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图10 —实施梯度提升生存模型</p></figure><p id="2101" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">整个模型的c指数得分为0.703，低于使用随机森林模型获得的得分。在下图中，我们可以看到，随着时间的推移，区分存活率变得越来越差，到最后略有改善。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/26e02b2093e2839cca469a67f042fee9.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*uL5ZalOZuNUKDQy0JPgocw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图11-梯度增强生存模型的时间依赖性AUC评分。(<em class="mk">图片作者)</em></p></figure><p id="9b94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管我们的模型在整体和时间相关拟合方面存在差异，但对于前5个特征，特征重要性(见下文)具有几乎相同的轮廓，尽管顺序不同。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图12 —梯度增强存活率模型的特征重要性</p></figure><h2 id="e39b" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">3.生存支持向量机</h2><p id="50f5" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">作为标准支持向量机(SVM)的扩展，生存SVM基于我们的特征和生存之间的线性(或非线性)关系来分离类别。如果你想了解更多，你可以参考scikit survival <a class="ae ky" href="https://scikit-survival.readthedocs.io/en/stable/user_guide/survival-svm.html" rel="noopener ugc nofollow" target="_blank">文档</a>，或者查看这个<a class="ae ky" href="https://jakevdp.github.io/PythonDataScienceHandbook/05.07-support-vector-machines.html" rel="noopener ugc nofollow" target="_blank">深入探究本质。在这一节中，我们将探索线性SVM和核SVM生存模型，看看哪一个对我们的数据集表现最好。</a></p><h2 id="ebfa" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">线性生存SVM</h2><p id="6794" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">在下面的代码中，我导入了必要的模型和指标。接下来，定义线性生存SVM，然后拟合我们的数据。该模型产生了0.716的c指数，这比我们的梯度增强模型有更好的性能，但不是随机森林模型。</p><p id="58b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">生存SVM的局限性之一是我们无法将这些模型与随机森林或SVM生存模型进行比较。这是因为它们缺乏时间-事件分析的“标准”指标，如生存函数和累积风险函数。这限制了我们与c指数得分的比较。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图13 —实现线性生存SVM</p></figure><p id="aa4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">前5个区别特征再次与其他模型相似。尽管顺序不同，唯一的区别是化疗取代了前5名中的肿瘤大小。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图14-线性生存SVM的特征重要性</p></figure><h2 id="7907" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">内核生存SVM</h2><p id="737f" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">因为不能总是使用简单的线性方法来实现分类，所以可以使用核SVM来考虑我们的特征和生存之间更复杂的关系。下面的代码是我们如何实现内核生存SVM的，它导致了0.766的c-index分数。这与我们的随机森林生存模型(0.768)表现一样好(精确到小数点后两位)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图15 —实现内核存活SVM</p></figure><p id="79f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能在上面的代码中注意到内核是“线性”的。这是默认的内核，但是你可能会问这和线性SVM有什么不同？我鼓励你阅读我上面链接的文章来了解更多细节，但是作为一个快速的解释，请考虑下图。</p><p id="72af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我问你我们如何线性分割左边图像中的蓝色和黑色球，你会怎么说？不可能吧？如果我们处理的是二维空间，那就是真的。</p><p id="cf04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们增加另一个维度会发生什么？在右图中，您可以看到球在三维空间中旋转，我们现在可以看到y轴在垂直方向，z轴在水平方向。我们可以在这里想象x轴，就好像我们在你的屏幕上插了一根棒(请不要这样做)。</p><p id="f099" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们这样做的时候，很明显，至少对于这组球，我们可以用一个沿着x和z轴的平面来线性分离它们。这被称为超平面。然而，我们可以想象一张纸，而不是一条线。</p><p id="2b1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用核SVM，可以将我们的特征映射到可以被(n维-1)超平面分开的n维空间中。这就是SVM核中的线性核与线性SVM的不同之处。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/41ef45c651d88ee00c4574859afc03ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YF7HLKXZqDNpM5GtUBrWpA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图16——通过将特征从2维空间(左)映射到n维空间(右，3d ),并找到最大程度分隔类别的超平面(n维-1 ),核存活SVM可以找到一种对患者存活进行分类的方法。(图片由作者提供)</p></figure><p id="c9b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看特征重要性权重(见下文)，我们得到了与其他模型相同的前5个特征。尽管在比较我们的模型时c指数得分不同，但这些结果让我们在试图从我们的数据中看到更大的画面时更有信心。</p><p id="de6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我试图总结我们从这些分析中学到的东西，那就是患者的生存更多地取决于肿瘤的发展、esr1受体的表达、年龄和血管浸润，而不是任何种类的治疗(化疗、激素治疗或乳腺切除)。简而言之，我认为早期诊断是我们数据集中患者生存的最佳指标。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图17 —内核存活SVM的特征重要性</p></figure><h2 id="5b93" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">4.使用GridSearch优化您的模型</h2><p id="4f60" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">到目前为止，我们已经比较了随机森林、SVM和梯度增强事件时间模型来预测我们数据集中乳腺癌患者的生存率。我认为这将是有益的，通过一个例子，我们可以尝试优化我们的一个模型的结果。如果您想了解如何优化我们今天介绍的其他模型，请查看我们的<a class="ae ky" href="https://github.com/ryancburke/NKI_breast_cancer" rel="noopener ugc nofollow" target="_blank">笔记本</a>。</p><p id="ac09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看是否可以改进我们的内核SVM。您可以手动完成这项工作，也可以实现网格搜索，在网格搜索中，您可以一次运行多个模型。你可以在这里找到更多关于这项技术的信息。</p><p id="8515" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重要的是要记住，这是一个计算量很大的过程，所以要确保在这个过程中你有事可做。在下面的代码中，你会看到我们从sklearn导入了<em class="ml"> GridSearchCV </em>和<em class="ml"> ShuffleSplit </em>。</p><p id="8b9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第一个模块中，我们定义了指标，因此我们可以在以后将它添加到模型参数中。下一行定义了我们的基本模型，它与我们上面运行的模型相同。</p><p id="47ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">带有<em class="ml">shuffles split</em>的行表示我们想要<em class="ml"> </em> 100个随机分裂，其中我们训练80%的数据，并验证20%的数据。</p><p id="2b1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ml"> param_grid </em>是每次运行模型时将进行的调整，每次调整的结果将进行比较，以查看哪一个执行得最好。值得注意的是，我选择只调查修改<em class="ml"> alpha </em>超参数的影响，这是对损失函数的惩罚，类似于岭或套索回归的工作方式。选择的范围I是从2e-12到2e+12，步长为2(即2e-12、2e-10、2e-8……)。</p><p id="d22f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，定义模型并使其适合您的数据。请记住，当您这样做时，您是在整个数据集(X，y)上运行它，因为您已经使用<em class="ml">shuffles split</em>定义了分割。</p><p id="a2f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果实际上给了我们一个更差的模型，c指数得分为0.713。这是你在使用网格搜索时可能已经注意到的。据我所知，这主要是由于数据集分割的随机性造成的。我们还获得了一些关于最佳<em class="ml"> alpha </em>分数的信息，该分数为0.0625。这不同于默认值1.0。</p><p id="2262" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我将alpha值插回到我们的原始模型中时，我最终得到了完全相同的分数(0.766)，表明我们的原始结果得到了优化。当然，如果我们改变内核等其他超参数，情况可能会有所不同。如果你感兴趣的话，我把这些放在我的笔记本里，上面有链接。但是，为了不让你担心，结果并没有从0.766提高。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图18——使用GridSearch尝试并优化我们的内核生存SVM</p></figure><h2 id="99c7" class="mm mn it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">摘要</h2><p id="7a2f" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">在今天的帖子中，我们介绍了3种不同的模型，用于研究乳腺癌存活率的数据集的时间-事件分析。具体来说，我们发现随机森林和核SVM生存模型优于梯度增强生存模型。</p><p id="29e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还研究了如何通过在超参数<em class="ml"> alpha </em>上运行网格搜索来优化我们的内核SVM模型。我鼓励您尝试在网格搜索中添加额外的超参数。事实上，这是确保我们的模型得到优化的唯一方法。然而，如果你这样做了，也许可以通宵运行，这样你就不用等待结果了。这有点像观察草的生长。</p><p id="db59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你喜欢今天的帖子。玩你的数据玩得开心！</p></div></div>    
</body>
</html>