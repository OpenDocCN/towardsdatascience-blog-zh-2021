<html>
<head>
<title>All You Need to Know About Pandas Cut and Qcut Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你所需要知道的关于熊猫切和Qcut函数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/all-you-need-to-know-about-pandas-cut-and-qcut-functions-4a0c1001c38b?source=collection_archive---------9-----------------------#2021-06-16">https://towardsdatascience.com/all-you-need-to-know-about-pandas-cut-and-qcut-functions-4a0c1001c38b?source=collection_archive---------9-----------------------#2021-06-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="eb86" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">它们之间到底有什么区别？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4997fdb8e4ff7656a498b71ea22af5c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zJUshIh3G9U_sI24CgaIhA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@worthyofelegance?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">亚历克斯</a>在<a class="ae ky" href="https://unsplash.com/s/photos/divide?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="4626" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas可以说是数据科学生态系统中最受欢迎的数据分析和操作工具。感谢众多的函数和方法，我们可以自由地处理数据。</p><p id="bee1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在许多情况下，cut和qcut函数非常方便。起初我并不清楚它们之间的区别。在做了几个例子之后，我就能弄明白了。</p><p id="7d35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们也将这样做。本文中的例子将演示如何使用cut和qcut函数，并强调它们之间的区别。</p><p id="a456" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从创建一个样本数据框开始。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2f37" class="ma mb it lw b gy mc md l me mf">import numpy as np<br/>import pandas as pd</span><span id="b962" class="ma mb it lw b gy mg md l me mf">df = pd.DataFrame({<br/>  "col_a": np.random.randint(1, 50, size=50),<br/>  "col_b": np.random.randint(20, 100, size=50),<br/>  "col_c": np.random.random(size=50).round(2)<br/>})</span><span id="e726" class="ma mb it lw b gy mg md l me mf">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/bfd7f1b093a1e8398ba8cc16b2346c13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Msv-rZPtH8zixr8IfdV0zg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="905a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一列和第二列分别包含1-50和20–100之间的整数。第三列包含0到1之间的浮点数。我们使用numpy函数来随机生成这些值。</p><blockquote class="mi"><p id="9ecc" class="mj mk it bd ml mm mn mo mp mq mr lu dk translated">剪切功能将整个取值范围划分为多个区间。每个箱覆盖的范围将是相同的。</p></blockquote><p id="2f05" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">在第一列(col_a)中，我们随机分配1到50之间的整数。让我们首先检查这一列中的最小值和最大值。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="be12" class="ma mb it lw b gy mc md l me mf">df.col_a.max(), df.col_a.min()</span><span id="e8d0" class="ma mb it lw b gy mg md l me mf">(49, 3)</span></pre><p id="737d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果要将此列分成5个范围相等的容器，每个容器的大小将为9.2，计算如下:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a245" class="ma mb it lw b gy mc md l me mf">(49 - 3) / 5 = 9.2</span></pre><p id="f59f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">cut函数执行这种宁滨运算，然后将每个值分配到适当的bin中。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="eed1" class="ma mb it lw b gy mc md l me mf">df["col_a_binned"] = pd.cut(df.col_a, bins=5)<br/>df.col_a_binned.value_counts()</span><span id="e71f" class="ma mb it lw b gy mg md l me mf">(21.4, 30.6]     16 <br/>(39.8, 49.0]     14 <br/>(12.2, 21.4]      8 <br/>(30.6, 39.8]      6 <br/>(2.954, 12.2]     6</span></pre><p id="2ba0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们所看到的，除了最小的那个，每个箱子的大小正好是9.2。下限不包含在内。因此，最小容器的下限稍微小于最小值(3)以能够包括它。</p><p id="4c9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过手动定义箱边缘来自定义箱。边值作为列表传递给bin参数。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d40f" class="ma mb it lw b gy mc md l me mf">pd.cut(df.col_a, bins=[0, 10, 40, 50]).value_counts()</span><span id="331a" class="ma mb it lw b gy mg md l me mf">(10, 40]    33 <br/>(40, 50]    13 <br/>(0, 10]      4</span></pre><p id="d6cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，右边缘是包含的，但可以更改。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f8d8" class="ma mb it lw b gy mc md l me mf">pd.cut(df.col_a, bins=[0, 10, 40, 50], right=False).value_counts()</span><span id="d505" class="ma mb it lw b gy mg md l me mf">[10, 40)    33 <br/>[40, 50)    13 <br/>[0, 10)      4</span></pre><p id="5db2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用cut函数，我们无法控制每个容器中有多少值。我们只能指定箱边缘。</p><p id="f2a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我们需要学习qcut函数的地方。它可用于将值划分为多个桶，每个桶包含大约相同数量的值。</p><p id="603a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">先说个例子。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="84ed" class="ma mb it lw b gy mc md l me mf">pd.qcut(df.col_a, q=4).value_counts()</span><span id="470d" class="ma mb it lw b gy mg md l me mf">(40.75, 49.0]    13 <br/>(19.5, 25.0]     13 <br/>(2.999, 19.5]    13 <br/>(25.0, 40.75]    11</span></pre><p id="86ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有4个桶，每个桶包含几乎相同数量的值。在4的情况下，存储桶也称为四分位数。值总数的四分之一在第一个四分位数中，一半在前两个桶中，依此类推。</p><p id="9f9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用qcut功能，我们无法控制bin边缘。它们是自动计算的。假设一列中有40个值(即行),我们希望有4个存储桶。从最小值开始，第一个桶的上限范围将按照第一个桶包含10个值的方式来确定。</p><ul class=""><li id="cad5" class="mx my it lb b lc ld lf lg li mz lm na lq nb lu nc nd ne nf bi translated">剪切功能:重点是根据值范围(即，容器上边缘和下边缘之间的差异)来确定容器的大小</li><li id="b1ba" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">Qcut函数:重点是根据每个箱中值的数量来确定箱的大小。</li></ul><p id="41f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">qcut功能允许定制铲斗尺寸。让我们创建3个桶。第一个包含最小的50%的值(即下半部分)。然后，我们把上半部分分成两个箱。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="5a52" class="ma mb it lw b gy mc md l me mf">pd.qcut(df.col_a, q=[0, .50, .75, 1]).value_counts()</span><span id="d089" class="ma mb it lw b gy mg md l me mf">(2.999, 25.0]    26 <br/>(40.75, 49.0]    13 <br/>(25.0, 40.75]    11</span></pre></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="3f9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">cut和qcut功能都允许给箱子或桶贴标签。我们如下使用标签参数。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="437a" class="ma mb it lw b gy mc md l me mf">df["new"] = pd.qcut(df.col_a, q=[0, .33, .66, 1], labels=["small", "medium", "high"])</span><span id="f13f" class="ma mb it lw b gy mg md l me mf">df["new"].value_counts()</span><span id="a9da" class="ma mb it lw b gy mg md l me mf">high      17 <br/>small     17 <br/>medium    16</span></pre><p id="3598" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就像把一个连续变量转换成一个范畴变量。让我们检查每个类别中的平均值，以确保qcut函数正常工作。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="e86c" class="ma mb it lw b gy mc md l me mf">df.groupby("new").agg(avg=("col_a","mean"))</span><span id="b829" class="ma mb it lw b gy mg md l me mf">               avg<br/>new<br/>small    14.000000<br/>medium   26.687500<br/>high     43.705882</span></pre><p id="614d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">平均增加，因为我们从小到大，这是意料之中的。</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h2 id="37fc" class="ma mb it bd ns nt nu dn nv nw nx dp ny li nz oa ob lm oc od oe lq of og oh oi bi translated">结论</h2><p id="c0d5" class="pw-post-body-paragraph kz la it lb b lc oj ju le lf ok jx lh li ol lk ll lm om lo lp lq on ls lt lu im bi translated">cut和qcut函数都可以用于将一组连续值转换为离散或分类变量。</p><p id="cdc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">cut函数关注于bin的取值范围。它根据最小值和最大值之间的差异确定整个范围。然后，它根据所需的箱数将整个范围划分为多个箱。默认情况下，每个箱的大小是相同的(大约),它是箱的上边缘和下边缘之间的差值。</p><p id="93a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">qcut函数关注每个bin中值的数量。这些值从最小到最大排序。如果我们需要5个桶，前20%的值放在第一个桶中，后20%放在第二个桶中，依此类推。</p><p id="6175" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两个功能都允许定制上边缘和下边缘。因此，我们可以有不同大小的箱子或桶。</p><p id="eacf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>