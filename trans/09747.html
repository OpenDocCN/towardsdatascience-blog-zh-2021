<html>
<head>
<title>5 Common Excel Tasks Simplified with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python简化的5个常见Excel任务</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/5-common-excel-tasks-simplified-with-python-feff966e73a4?source=collection_archive---------13-----------------------#2021-09-12">https://towardsdatascience.com/5-common-excel-tasks-simplified-with-python-feff966e73a4?source=collection_archive---------13-----------------------#2021-09-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="171d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Pandas、OS和datetime模块简化Python中的Excel任务。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/dd9bed96752c976d852e04303a1750f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KrMU6jKdQ6_fOYXP"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@melodyp?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Mélody P </a>拍摄</p></figure><p id="5a3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的第一份工作是做一些简单的Excel任务，这些任务在大范围内变得冗长而耗时。我可以手动完成所有这些工作，成为处理日常任务的专家，但是我决定学习Python来简化它们。</p><p id="fdb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Excel是处理数据的好工具，但在处理数百个需要修改的文件时有一些限制。这就是Python可以提供帮助的地方。</p><p id="a674" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将简化我(可能还有你)在工作中经常要做的5个Excel任务。</p><h1 id="e431" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">重要的事情先来</h1><h2 id="9821" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">安装库</h2><p id="6d78" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">为了用Python简化这些Excel任务，我将使用Pandas、OS和datetime。Python默认自带最后两个库，而Pandas需要安装。为此，在您的终端中编写以下命令。</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="3310" class="mn lw it nf b gy nj nk l nl nm">pip install pandas</span></pre><p id="190c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我假设您知道如何使用Pandas导入和导出Excel文件。但是如果你不知道怎么做，这里有一些方法:</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="70cf" class="mn lw it nf b gy nj nk l nl nm">import pandas as pd</span><span id="1a4d" class="mn lw it nf b gy nn nk l nl nm"># Read an Excel file and save it to a dataframe<br/>df = pd.read_excel(excel_file_path)</span><span id="ea64" class="mn lw it nf b gy nn nk l nl nm">... # (all the operations we'll do in this article)</span><span id="5d93" class="mn lw it nf b gy nn nk l nl nm"># Export dataframe to a new Excel file<br/>df.to_excel(file_path, index=False)</span></pre><h2 id="4e1a" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">数据</h2><p id="4774" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">对于本指南，我使用了两个Excel文件，它们位于我的Python脚本所在的目录中。电子表格包含如下所示的虚拟数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="acb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些数据并不相关。主要思想是所有的数据被分成多个块(Book1，Book2，Book3，…)，我们的任务是对所有的数据执行操作。</p><p id="3bf7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以创建自己的虚拟数据，使用自己的Excel文件或从我的<a class="ae ky" href="https://github.com/ifrankandrade/data_preprocessing/tree/main/datasets/common_tasks" rel="noopener ugc nofollow" target="_blank"> Github </a>上下载这两个文件。<strong class="lb iu">将这些文件放在Python脚本所在的目录中。</strong></p><h1 id="f030" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">1)用Python连接多个Excel文件</h1><p id="a9e8" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">我们的第一个任务是将所有这些块合并到一个Excel文件中(假设我们想与老板共享所有数据)。</p><p id="58cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果有2个Excel文件，这样做将像复制一个文件中的数据并粘贴到另一个文件中一样容易；然而，对数百个文件这样做是不切实际的。</p><p id="e645" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个简单的解决办法是使用熊猫。</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="78ae" class="mn lw it nf b gy nj nk l nl nm">import os<br/>import pandas as pd</span><span id="a6e8" class="mn lw it nf b gy nn nk l nl nm">my_list = []<br/>for file in os.listdir():<br/>    if file.endswith('.xlsx'):<br/>        df = pd.read_excel(file)<br/>        my_list.append(df)<br/><br/>df_concat = pd.concat(my_list, axis=0)<br/>df_concat.to_excel('concatenate.xlsx', index=False)</span></pre><p id="c72d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们用<code class="fe nq nr ns nf b">os.listdir()</code>列出当前目录下的所有文件。然后我们用<code class="fe nq nr ns nf b">.endswith(‘.xlsx’)</code>方法过滤掉文件。</p><p id="3bfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有的Excel文件将被存储到一个名为<code class="fe nq nr ns nf b">my_list</code>的列表中，然后与返回一个我们称之为<code class="fe nq nr ns nf b">df_concat</code>的数据帧的<code class="fe nq nr ns nf b">pd.concat()</code>相结合。该数据帧被导出到Excel文件中。</p><p id="96c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，如果使用逗号分隔值(CSV文件)，可以使用<code class="fe nq nr ns nf b">read_csv()</code>和<code class="fe nq nr ns nf b">to_csv()</code></p><h1 id="7e04" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">2)使用Python更改多个CSV文件的名称或扩展名</h1><p id="c236" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">CSV是一种常用的文件扩展名，用于存储和读取数据。可以用Excel打开，在工作中广泛使用。</p><p id="9967" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我经常需要重命名CSV文件，这样任何人都可以很容易地识别它们(例如，在名称的开头添加日期),并且还必须进行转换。csv文件到。txt文件，反之亦然，</p><p id="e0d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">两者都是简单的任务，但是当处理数百个文件时，它们就变得令人头疼了。幸运的是，我使用下面代码所示的<code class="fe nq nr ns nf b">.split()</code>和<code class="fe nq nr ns nf b">os.rename()</code>方法在几秒钟内完成了这些任务。</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="08ca" class="mn lw it nf b gy nj nk l nl nm">import os<br/>import datetime</span><span id="1848" class="mn lw it nf b gy nn nk l nl nm"># 1.Getting the current date in YYYYMMDD format<br/>today = datetime.date.today()<br/>today_str = today.strftime('%Y%m%d')</span><span id="127f" class="mn lw it nf b gy nn nk l nl nm"># 2.Adding date and changing extension to CSV files within directory<br/>for file in os.listdir():<br/>    if file.endswith('.csv'):<br/>        file_name, file_extension = file.split('.')<br/>        new_file_name = f'{today_str}_{file_name}'<br/>        new_extension = '.txt'<br/>        new_name = f'{new_file_name}{new_extension}'<br/>        os.rename(file, new_name)</span></pre><p id="a642" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们必须使用datetime模块来获取当前日期，并按照我们的要求对其进行格式化(在本例中是年、月、日)。</p><p id="b757" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们过滤掉CSV之外的文件，每次文件名到达一个点号(.)，所以我们把扩展名和文件名分开。我们用f字符串<code class="fe nq nr ns nf b">(f’’)</code>连接名称，并用<code class="fe nq nr ns nf b">os.rename()</code>重命名文件。这将当前文件作为第一个参数，新名称作为第二个参数</p><h1 id="a019" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">3)在Python中左右使用Excel的字符串函数</h1><p id="d95b" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">想象一下，在我们之前见过的电子表格中，您必须将国家代码添加到“号码”列的每个电话号码中。</p><p id="3999" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以对每个文件执行Excel的LEFT函数，但这会花费很多时间。相反，我们可以使用for循环，将每个Excel文件读入Pandas dataframe，然后使用<code class="fe nq nr ns nf b">lambda</code>和f-string将国家代码添加到每个电话号码中。</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="4479" class="mn lw it nf b gy nj nk l nl nm">import os<br/>import pandas as pd</span><span id="5d50" class="mn lw it nf b gy nn nk l nl nm">for file in os.listdir():<br/>    if file.endswith('.xlsx'):<br/>        file_name = file.split('.')[0]<br/>        df = pd.read_excel(file)<br/>        df = df.astype({'Number': str})<br/>        df['Number'] = df['Number'].apply(lambda x: f'44{x}')<br/>        df.to_excel(f'country_code_{file_name}.xlsx', index=False)</span></pre><p id="479c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们一起使用<code class="fe nq nr ns nf b">apply</code>和<code class="fe nq nr ns nf b">lambda</code>函数，我们可以修改列中的值。在本例中，我在“Number”列中每个值的开头添加了“44”代码。注意，我们必须确保列“Number”中的值是string (str ),所以我们使用了<code class="fe nq nr ns nf b">.astype()</code>方法来更改数据类型。</p><p id="fbba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们将数据帧导出到一个名称中包含单词“country_code”的新Excel文件中。</p><h1 id="b926" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">4)删除列中的重复项并删除NaN值</h1><p id="1847" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">在Excel中执行的一些基本数据清理，如删除重复项和NaN值，可以通过Pandas轻松完成。</p><p id="5b1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用<code class="fe nq nr ns nf b">.drop_duplicates().</code>轻松删除基于所有列的重复行</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="fc37" class="mn lw it nf b gy nj nk l nl nm">df = df.drop_duplicates()</span></pre><p id="74ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是如果您想要删除特定列上的重复项，请添加<code class="fe nq nr ns nf b">subset</code>参数。假设我们想删除“数字”列中的重复项。</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="9b09" class="mn lw it nf b gy nj nk l nl nm">df = df.drop_duplicates(subset=['Number'])</span></pre><p id="8092" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，通过<code class="fe nq nr ns nf b">.dropna()</code>可以降低NaN值</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="a5d1" class="mn lw it nf b gy nj nk l nl nm">df = df.dropna(subset=[‘column_name’])</span></pre><p id="8f63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也可以替换空值，而不是删除整行。假设我们想用零替换空值。</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="6c19" class="mn lw it nf b gy nj nk l nl nm">df = df.fillna(0)</span></pre><p id="4076" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除此之外，还可以用高于(向前填充)或低于(向后填充)一行的值来填充这些空值。</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="b4bd" class="mn lw it nf b gy nj nk l nl nm"># Forward filling<br/>df.fillna(method='ffill')</span><span id="cd50" class="mn lw it nf b gy nn nk l nl nm"># Backwards filling<br/>df.fillna(method='bfill')</span></pre><h1 id="55ac" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">5)排序值</h1><p id="0b92" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">对熊猫数据框架进行排序就像对Excel电子表格进行排序一样简单。我们只需使用<code class="fe nq nr ns nf b">.sort_values()</code>并指定升序或降序<code class="fe nq nr ns nf b">(ascending=True, ascending=False)</code>以及排序所依据的列。</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="7276" class="mn lw it nf b gy nj nk l nl nm">df = df.sort_values(ascending=True, by=['Year'])</span></pre><p id="e4ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们想保存更改，而不需要像上面显示的那样将值设置为等于<code class="fe nq nr ns nf b">df</code>，我们可以使用<code class="fe nq nr ns nf b">inplace</code>参数</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="9fe3" class="mn lw it nf b gy nj nk l nl nm">df.sort_values(ascending=True, by=['Number'], inplace=True)</span></pre></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><p id="829a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！这是我们在工作中可能遇到的5个常见任务，可以用Python简化。如果你是一个Excel用户，想使用Python/Pandas，请查看下面的指南。</p><div class="oa ob gp gr oc od"><a rel="noopener follow" target="_blank" href="/a-complete-yet-simple-guide-to-move-from-excel-to-python-d664e5683039"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">从Excel迁移到Python的完整而简单的指南</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">用熊猫和Numpy永远抛弃Excel。</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">towardsdatascience.com</p></div></div><div class="om l"><div class="on l oo op oq om or ks od"/></div></div></a></div><p id="48a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://frankandrade.ck.page/bd063ff2d3" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">与3k以上的人一起加入我的电子邮件列表，获取我在所有教程中使用的Python for Data Science备忘单(免费PDF) </strong> </a></p><p id="acd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢阅读这样的故事，并想支持我成为一名作家，可以考虑报名成为一名媒体成员。每月5美元，你可以无限制地阅读媒体上的故事。如果你使用<a class="ae ky" href="https://frank-andrade.medium.com/membership" rel="noopener">我的链接</a>注册，我会赚一小笔佣金，不需要你额外付费。</p><div class="oa ob gp gr oc od"><a href="https://frank-andrade.medium.com/membership" rel="noopener follow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">阅读弗兰克·安德拉德(以及媒体上成千上万的其他作家)的每一个故事</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">frank-andrade.medium.com</p></div></div><div class="om l"><div class="os l oo op oq om or ks od"/></div></div></a></div></div></div>    
</body>
</html>