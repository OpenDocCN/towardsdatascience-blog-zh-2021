<html>
<head>
<title>Twenty-one Techniques and Five Concepts For Better Docker Usage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">更好地使用Docker的21个技巧和5个概念</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/twenty-one-techniques-and-five-concepts-for-better-docker-usage-9ee135dccdc9?source=collection_archive---------31-----------------------#2021-07-21">https://towardsdatascience.com/twenty-one-techniques-and-five-concepts-for-better-docker-usage-9ee135dccdc9?source=collection_archive---------31-----------------------#2021-07-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e194" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Docker是为你的非智能手机电脑设计的应用软件。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/63947155efcfed8503597a7aff6197bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GG2uFlLh3y8N4_6wI09uhQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">乔纳斯·李在<a class="ae ky" href="https://unsplash.com/s/photos/mobile-application?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="0394" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">起初</h1><p id="aaf1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">你已经编程几年了，你的沙箱，你的本地开发机器，被许多不同的库、框架，也许还有一两个病毒的下载搞得乱七八糟。</p><p id="2291" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">以上描述了我2008年的生活。下面的艰巨任务详细描述了我当时生活中的巨大PIA(你要靠自己来解决这个缩写词):</p><ol class=""><li id="9cda" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">从Python 2.x升级到3.x</li><li id="5561" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">支持用Python 2.x编写的生产服务，即使你想升级到Python 3.x，也不被允许；</li><li id="e25c" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">将Linux OS服务器升级到下一个主要版本以及相关的工具、框架、服务和库层；</li><li id="106d" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">尝试一个与您当前的工具、框架、服务和库相冲突的新包；</li><li id="4446" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">需要一个现在被不同名字调用的包的依赖，或者最坏的情况是依赖不再存在；</li><li id="0b6d" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">损坏，可能是操作系统驱动程序，因此需要重新安装，因为重新启动没有解决问题；</li><li id="edf1" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">最后但同样重要的是，我最大的PIA(需要我去看医生)是超过五年的Linux服务器，它们有硬件故障、备份和/或不完整的文档，或者更糟的是，从未被验证为可重现。</li></ol><p id="c392" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我生命中最大的七个“问题”(BPIAIML)看起来像是系统管理员的待办事项清单或者DevOps大师的梦想成真。作为一名架构师和几个产品和项目的经理，我向你保证，它们是我需要解决的最大问题。</p><h2 id="f71c" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">我们在跑之前需要先走一走。</h2><blockquote class="ns"><p id="61fa" class="nt nu it bd nv nw nx ny nz oa ob mm dk translated">DevOps是未来的解决方案。—匿名</p></blockquote><p id="7dfb" class="pw-post-body-paragraph lr ls it lt b lu oc ju lw lx od jx lz ma oe mc md me of mg mh mi og mk ml mm im bi translated">DevOps是未来的解决方案。—匿名</p><p id="54eb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们几乎所有人都使用智能手机。让智能手机如此有价值的是名为Apps的应用程序。一些有用的应用程序预装在智能手机上，而其他应用程序我们免费或收取少量费用下载。</p><p id="5383" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Docker支持笔记本电脑、台式机、服务器、云和混合云上的应用。</p><p id="d5d3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> Dockerfile </strong>是我的应用的构建蓝图。Docker <strong class="lt iu">镜像</strong>是从<strong class="lt iu"> Dockerfile规范</strong>(构建蓝图)中产生的App指令。Docker <strong class="lt iu">容器</strong>是围绕Docker <strong class="lt iu">映像</strong>创建应用程序的运行时虚拟环境包装器。</p><p id="9b95" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">像应用程序一样，Docker <strong class="lt iu"> Images </strong>是免费的，如果它们包含开放源代码，即Linux、Jupyter、Rust、Python、Tensorflow、Spark、Kafka、NGINX，这是一个越来越长的列表，可以从公共存储库中下载。</p><p id="3b4c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我决定使用Docker作为我们处理SBPIAIML的宏伟解决方案的一个解决方案。</p><h2 id="6df4" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">Docker如何解析七个BPIAIML？</h2><p id="3f8b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">每一个和开发人员交谈过的人都以某种形式听说过，“它在我的机器上工作。”</p><p id="84fa" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当我没有现在这么成熟的时候，我的第一反应是，“你被解雇了！”</p><p id="0368" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，我说，“哦，太好了。把你的docker文件和单元测试发给我。我会努力找出我做错了什么，然后回来找你。”</p><p id="ed74" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">通常会发生一两个事件，但不总是发生:</p><ol class=""><li id="3843" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">开发人员将docker文件和单元测试发送给我，或者:</li><li id="f9ef" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">开发人员开夜车创建Dockerfile文件和单元测试，然后发给我。</li></ol><h2 id="f71b" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">我们码头之旅的真正开始。</h2><p id="9ae4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我建议您从我们旅程的起点开始:</p><div class="oh oi gp gr oj ok"><a href="https://levelup.gitconnected.com/our-enterprise-docker-solution-for-migration-to-the-cloud-d7bb9d1a796b" rel="noopener  ugc nofollow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">我们面向云迁移的企业Docker解决方案</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">这是一个关于我们第一次推出Docker的故事，它发生在我以前作为承包商工作过的一家公司。代码，作为…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy ks ok"/></div></div></a></div><p id="2782" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我假设你已经安装了Docker。如果没有，现在就可以，请转到此处:</p><div class="oh oi gp gr oj ok"><a href="https://docs.docker.com/engine/install/" rel="noopener  ugc nofollow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">安装Docker引擎</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">Docker Engine可在多种Linux平台、macOS和Windows 10上通过Docker Desktop获得，并作为…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">docs.docker.com</p></div></div><div class="ot l"><div class="oz l ov ow ox ot oy ks ok"/></div></div></a></div><h2 id="3013" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">Docker是如何工作的？</h2><p id="0a66" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了解释Docker是如何工作的，我首先更正式地定义了我们在这篇博客文章中多次引用的四个基本Docker术语。</p><p id="425f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一个<strong class="lt iu">映像</strong>就是<strong class="lt iu"> </strong>一大块<a class="ae ky" href="https://stackoverflow.com/questions/50974960/whats-the-difference-between-docker-and-python-virtualenv" rel="noopener ugc nofollow" target="_blank">虚拟环境</a>二进制指令。按照<strong class="lt iu"> Dockerfile </strong>指定的二进制指令对图像进行分层。一个例子是Ubuntu 20.04、<a class="ae ky" href="https://nbdev.fast.ai/example.html#Important-Notes-about-show_doc:" rel="noopener ugc nofollow" target="_blank"> nbdev </a>和Jupyter notebook实例的层。</p><p id="c8b6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">层</strong>按顺序应用于基础图像，以创建最终图像。</p><p id="05ac" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一个<strong class="lt iu"> Dockerfile </strong>是一个<strong class="lt iu">图像的蓝图。</strong>蓝图由文本文件中的一系列Docker命令组成。</p><blockquote class="ns"><p id="a94e" class="nt nu it bd nv nw nx ny nz oa ob mm dk translated"><code class="fe pa pb pc pd b">Dockerfile</code>是一个文本文档，包含用户可以在命令行上调用的所有命令，以组合一个图像。— <a class="ae ky" href="https://docs.docker.com/engine/reference/builder/" rel="noopener ugc nofollow" target="_blank">文档参考</a></p></blockquote><p id="3ee8" class="pw-post-body-paragraph lr ls it lt b lu oc ju lw lx od jx lz ma oe mc md me of mg mh mi og mk ml mm im bi translated">Docker <strong class="lt iu">容器</strong>是围绕Docker <strong class="lt iu">映像实例的运行时虚拟环境包装器。</strong></p><p id="046b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> <em class="pe">注意</em> </strong> <em class="pe"> : Docker可以自动为你生成一个容器名，或者你可以在</em> <code class="fe pa pb pc pd b"><em class="pe">Docker run ...</em></code>的时候给容器命名</p><p id="9b40" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> DockerHub (Image) Registry </strong>:您可以将公共(或私有)Docker映像放在这个共享存储库(repo)中。要将您的一张图片发布到公共回购平台，需要一个<a class="ae ky" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker登录帐户</a>。如果你不推送图像，它会留在本地的私人回购中。</p><p id="5dd1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您可以使用Docker桌面查看本地<strong class="lt iu">容器、</strong>本地和提取的<strong class="lt iu">图像、</strong>和其他我们尚未讨论的重要Docker实体。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/59b16e0a918d53b52e7012851fcd6bf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zIMydoOnnI3tc1WmvYCjoA.png"/></div></div></figure><p id="cd42" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我为这些术语道歉。似乎任何一门学科，比如计算机科学，医学，或者物理学，90%是术语，10%是概念。我接受它，因为在讨论概念之前，你需要定义概念中的术语。</p><p id="8744" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当我们讨论概念的伪哲学时，你需要深入了解Docker <strong class="lt iu">图像</strong>和Docker <strong class="lt iu">容器</strong>之间的区别。</p><p id="79eb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我知道我不得不多次回顾Docker <strong class="lt iu">图像</strong>和Docker <strong class="lt iu">容器</strong>的定义。我通过将一个<strong class="lt iu">容器</strong>包含一个<strong class="lt iu">图像来简化我的生活。</strong></p><p id="0ad1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一个<strong class="lt iu">容器</strong>可以做更多的事情，但是除非我想分拆我自己的Docker公司，否则我不需要知道Docker架构或者内部工作方式。</p><p id="3394" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">见鬼，我可能比你慢一点。不要让我劝阻你深入研究Docker内部。你可以利用你的时间做一些最糟糕的事情。</p><p id="393c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们将在博客文章的后面详细讨论所有这些术语和Docker命令。</p></div><div class="ab cl pg ph hx pi" role="separator"><span class="pj bw bk pk pl pm"/><span class="pj bw bk pk pl pm"/><span class="pj bw bk pk pl"/></div><div class="im in io ip iq"><h1 id="5677" class="kz la it bd lb lc pn le lf lg po li lj jz pp ka ll kc pq kd ln kf pr kg lp lq bi translated">不是，不是在这里发明的</h1><p id="839d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><em class="pe">不要发展自己的形象</em>，至少在需要Docker I <strong class="lt iu"> mage </strong>的时候。</p><p id="9eec" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Docker Hub上有超过800万张图片。很有可能，你会在Docker Hub上找到你需要的东西，避免自己动手制作。</p><p id="268e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">即使你没有找到你想要的，你可能会找到一些相近的东西。通过查看其他人的代码，使用学习软件的古老艺术(IMHO，这很好)，您将找到other文件和其他来源的链接。</p><p id="b2ea" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您应该检查您想要的容器是否在:</p><div class="oh oi gp gr oj ok"><a href="https://hub.docker.com/search?q=&amp;type=image" rel="noopener  ugc nofollow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">码头枢纽</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">编辑描述</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">hub.docker.com</p></div></div></div></a></div><p id="63c9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我根据类别、操作系统和机器架构进行过滤搜索。此外，我在搜索框中输入一个或多个术语来改进我的搜索。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ps"><img src="../Images/fae27752ce60edf5d1eeac13349a2642.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jv49Uw-jQ5TAwBv2MNcdxw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在超过800万个容器中优化搜索—图片来源:作者桌面快照。</p></figure><p id="56bf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我的示例搜索<em class="pe"> nbdev </em>图像的结果是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pt"><img src="../Images/ff3f651bde46bd8954629473c8a7eb69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8G3FrQMzMjvYbay0aP6XTw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:作者桌面快照。</p></figure><p id="81a8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果我点击容器名<code class="fe pa pb pc pd b">fastdotai/nbdev-dev:</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pu"><img src="../Images/ada0fd33e7184476978348200ea32d67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-H2RZSBJfo8p0EpP0Ni3_w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:图片:图片:作者桌面快照。</p></figure><p id="79ed" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我使用docker hub <code class="fe pa pb pc pd b">fastdotai/nbdev-dev</code>中的docker映像，方法是使用以下命令:</p><pre class="kj kk kl km gt pv pd pw px aw py bi"><span id="f3ca" class="ng la it pd b gy pz qa l qb qc">docker pull <!-- -->fastdotai/nbdev-dev</span></pre><p id="c236" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您必须创建一个本地副本，以便在创建容器时不引用全局中心副本。</p><p id="4d3a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您不希望造成网络瓶颈，并且您希望知道<strong class="lt iu">容器</strong>是由同一个<strong class="lt iu">映像</strong>构成的。你努力追求速度和再现性。</p></div><div class="ab cl pg ph hx pi" role="separator"><span class="pj bw bk pk pl pm"/><span class="pj bw bk pk pl pm"/><span class="pj bw bk pk pl"/></div><div class="im in io ip iq"><h1 id="0845" class="kz la it bd lb lc pn le lf lg po li lj jz pp ka ll kc pq kd ln kf pr kg lp lq bi translated">列出所有可用的Docker图像和容器</h1><p id="afb8" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe pa pb pc pd b">docker images -a</code>列出本地储存在您电脑上的所有图像。该列表中包括您使用<code class="fe pa pb pc pd b">docker pull &lt;image-mame&gt;</code>绘制的图像和中间图像(<strong class="lt iu">图层</strong>)。</p><pre class="kj kk kl km gt pv pd pw px aw py bi"><span id="0a8a" class="ng la it pd b gy pz qa l qb qc">docker images -a</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qd"><img src="../Images/9f702ca440a5f86c836753847c6f45d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rtnbpt8j3ephcww9iUeQwA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">CLI docker images -a. Image的输出:作者桌面快照。</p></figure><p id="9747" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe pa pb pc pd b">docker ps</code>列出你电脑上所有正在运行的容器。</p><pre class="kj kk kl km gt pv pd pw px aw py bi"><span id="2551" class="ng la it pd b gy pz qa l qb qc">docker ps -a</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qe"><img src="../Images/ad6a4723dff3ae119179b1b79de17979.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ejtHKJhqyyC8dGHexDJmQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我的沙箱上没有运行Docker容器。图:作者桌面快照。</p></figure></div><div class="ab cl pg ph hx pi" role="separator"><span class="pj bw bk pk pl pm"/><span class="pj bw bk pk pl pm"/><span class="pj bw bk pk pl"/></div><div class="im in io ip iq"><h1 id="9d91" class="kz la it bd lb lc pn le lf lg po li lj jz pp ka ll kc pq kd ln kf pr kg lp lq bi translated">docker运行选项是Docker的核心</h1><p id="cc66" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">对我来说，Docker和java的目标是一样的，关键的区别在于Docker实现了。</p><blockquote class="ns"><p id="9f73" class="nt nu it bd nv nw nx ny nz oa ob mm dk translated">调试一次，随处运行—匿名</p></blockquote><p id="3008" class="pw-post-body-paragraph lr ls it lt b lu oc ju lw lx od jx lz ma oe mc md me of mg mh mi og mk ml mm im bi translated">对我来说，Docker和java的目标是一样的，关键的区别在于Docker实现了。</p><p id="ad59" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">调试一次，随处运行—匿名</p><p id="286c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">以上可能有些言过其实。出于我的目的，上面的引用对Linux、Windows、Macintosh、Kubernetes和云供应商的许多变体都有效。</p><p id="cba8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">理解命令Docker run操作对于指定Docker <strong class="lt iu">容器</strong>如何与外部环境通信至关重要。</p><p id="8366" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">实际上，你的“外部环境”要么是一台本地机器(你的沙箱)，要么是几台联网的机器，通常是一个云，或者更好的是一个分布式操作系统，比如<a class="ae ky" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>。</p><pre class="kj kk kl km gt pv pd pw px aw py bi"><span id="ac1a" class="ng la it pd b gy pz qa l qb qc">docker run [OPTIONS] &lt;image-name&gt; [COMMAND] [ARG...]</span></pre><p id="d42a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我在这篇博客文章中展示了各种形式的有用的<code class="fe pa pb pc pd b">[OPTIONS]</code> n。</p><h2 id="c0b1" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">完成后移除Docker容器</h2><p id="127e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe pa pb pc pd b">--rm</code>退出时自动移除<strong class="lt iu">容器</strong>并释放其正在使用的内存。当我们运行一个<strong class="lt iu">容器</strong>时，我们几乎总是使用这个选项，因为我们觉得这最接近于模仿你的智能手机上的应用程序行为。</p><pre class="kj kk kl km gt pv pd pw px aw py bi"><span id="b028" class="ng la it pd b gy pz qa l qb qc">docker run --rm <!-- -->&lt;image-name&gt;</span></pre><h2 id="da57" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">装入容器</h2><p id="dccd" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">所有的Docker <strong class="lt iu">镜像</strong>都有一个Linux基础层。当您运行Docker容器时，您可以附加并运行大多数shell命令。例如，您可以列出<strong class="lt iu">容器的</strong>工作目录中的文件:</p><pre class="kj kk kl km gt pv pd pw px aw py bi"><span id="63c5" class="ng la it pd b gy pz qa l qb qc">docker exec -t &lt;container name/ID&gt; bash -c "ls -al"</span></pre><p id="5f05" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">或者脱离背景:</p><pre class="kj kk kl km gt pv pd pw px aw py bi"><span id="62ae" class="ng la it pd b gy pz qa l qb qc">docker exec -t -d &lt;container name/ID&gt; bash -c "ls -al"</span></pre><p id="fb5c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了调试一个<strong class="lt iu">容器</strong>，我们启动一个交互式会话:</p><pre class="kj kk kl km gt pv pd pw px aw py bi"><span id="d977" class="ng la it pd b gy pz qa l qb qc">docker exec -it &lt;container name/ID&gt; bash</span></pre><p id="d5cc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> <em class="pe">注意</em> </strong> <em class="pe">:您可以通过输入</em> <code class="fe pa pb pc pd b"><em class="pe">exit</em></code> <em class="pe">来结束或终止您的会话。</em></p><p id="adf5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> <em class="pe">注意</em> </strong> <em class="pe">:以上命令对于监控和您可能想要在运行的</em> <strong class="lt iu"> <em class="pe">容器</em> </strong> <em class="pe">上执行的其他任务非常有用。</em></p><p id="b8be" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">注意:有很多关于“边车模式”的抽象讨论上面的命令是实现Docker容器“sidecar”的方法之一(IMHO，最好的方法之一。)</p><h2 id="49c2" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">将Docker容器目录树映射到本地目录树。</h2><p id="a41f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">请记住，当我们讨论“本地”时，我们指的是外部主机环境。有时候我可能没有做到应有的一致，也可能把“本地”说成是“外部”环境。</p><p id="30ba" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们可以覆盖(忽略)Dockerfile指定的<code class="fe pa pb pc pd b">volume</code>或<code class="fe pa pb pc pd b">workdir</code>命令技术:</p><pre class="kj kk kl km gt pv pd pw px aw py bi"><span id="8f04" class="ng la it pd b gy pz qa l qb qc">docker run -v $PWD:&lt;local-directory-root&gt; -w &lt;local-directory-root&gt; &lt;container name/ID&gt;</span><span id="eb4b" class="ng la it pd b gy qf qa l qb qc"># Example<br/>docker exec -it -v $PWD:&lt;local-directory-root&gt; -w &lt;local-directory-root&gt; nbdev bash</span></pre><p id="9f12" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在前面的命令中，您将当前的“本地”目录<code class="fe pa pb pc pd b">$PWD,</code>挂载到了<strong class="lt iu">容器的</strong>卷中(即<code class="fe pa pb pc pd b">-v</code>标志)。您导致名为<code class="fe pa pb pc pd b">&lt;local-directory-root&gt;</code>的目录成为<strong class="lt iu">容器</strong>(<code class="fe pa pb pc pd b">-w</code>标志)的<code class="fe pa pb pc pd b">/workdir</code>。)结果是<strong class="lt iu">容器</strong>与<code class="fe pa pb pc pd b">$PWD,</code>中的<code class="fe pa pb pc pd b">/workdir</code>一起启动，该目录是您启动时所在的目录。</p><p id="f5e5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们发现上面的技术经常被使用。</p><p id="ec86" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您愿意，可以使用以下命令查看Docherfile <code class="fe pa pb pc pd b">workdir</code>规范:</p><pre class="kj kk kl km gt pv pd pw px aw py bi"><span id="8ffd" class="ng la it pd b gy pz qa l qb qc">docker exec &lt;container name/ID&gt; pwd<br/># Example<br/>docker exec lp pwd</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qg"><img src="../Images/2bc60a114c67602d4fcdae098b461dac.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/format:webp/1*n-NP1rzeDW9w7WjQ7mjPHw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图:作者桌面快照。</p></figure><h2 id="80f3" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">将Docker网络和端口映射到您的“本地”网络。</h2><p id="a163" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">记住，一个Docker <strong class="lt iu">容器</strong>为Docker <strong class="lt iu">映像</strong>创建了一个小小的封装宇宙，一个<a class="ae ky" href="https://stackoverflow.com/questions/50974960/whats-the-difference-between-docker-and-python-virtualenv" rel="noopener ugc nofollow" target="_blank">虚拟环境</a>。</p><p id="b3ee" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">通过执行以下命令，您可以在Docker包安装后看到Docker网络:</p><pre class="kj kk kl km gt pv pd pw px aw py bi"><span id="b834" class="ng la it pd b gy pz qa l qb qc">docker network ls</span></pre><p id="a874" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一开始你会看到三个网络。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qh"><img src="../Images/b372fecb67dba096d0938399a8b09d1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*oYXx-rQNjrR7RM_btThYcQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图:作者桌面快照。</p></figure><p id="0191" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">将<code class="fe pa pb pc pd b">lp </code> <strong class="lt iu">容器</strong>作为Linux守护进程运行，然后使用以下命令列出所有“本地”<strong class="lt iu">容器</strong>:</p><pre class="kj kk kl km gt pv pd pw px aw py bi"><span id="106c" class="ng la it pd b gy pz qa l qb qc">docker pull  fastdotai/nbdev:latest<br/>docker run -d --name lp --net=host fastdotai/nbdev</span><span id="e733" class="ng la it pd b gy qf qa l qb qc"># List running containers<br/>docker ps -a</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qi"><img src="../Images/9343136f221f1adfa0b6998bf7e75740.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hxT15th6AsAlMEpw0LKjQQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图:作者桌面快照。</p></figure><p id="9de9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们通过使用Docker命令创建一个“sidecar”来查看<code class="fe pa pb pc pd b">lp</code> <strong class="lt iu">容器</strong>的内部:</p><pre class="kj kk kl km gt pv pd pw px aw py bi"><span id="0ab9" class="ng la it pd b gy pz qa l qb qc">docker exec -it lp /bin/bash</span></pre><p id="f53a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">看看<code class="fe pa pb pc pd b">lp</code> <strong class="lt iu">容器中有哪些网络接口:</strong></p><pre class="kj kk kl km gt pv pd pw px aw py bi"><span id="99cc" class="ng la it pd b gy pz qa l qb qc">root@docker-desktop:~# ifconfig</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qj"><img src="../Images/5d3c6db6e98d16cb36d0c4a4fdbd5d7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*afbE-__dI909GvFfVoctnw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图像:作者桌面快照</p></figure><p id="9899" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">注意网络接口<code class="fe pa pb pc pd b">docker0:</code>和<code class="fe pa pb pc pd b">eth0:</code>是相同的。选项<code class="fe pa pb pc pd b">-net=host</code>将Docker <strong class="lt iu">容器</strong>虚拟环境网络接口映射到“本地”或主机网络接口。</p><p id="20d1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> <em class="pe">注意</em> </strong> <em class="pe">:在</em> <code class="fe pa pb pc pd b"><em class="pe">lp</em></code> <em class="pe"> Ubuntu Linux变种</em> <strong class="lt iu"> <em class="pe">容器</em> </strong> <em class="pe">上你需要运行一个root用户sidecar并执行；</em></p><pre class="kj kk kl km gt pv pd pw px aw py bi"><span id="4f64" class="ng la it pd b gy pz qa l qb qc">docker exec -u root -t -i lp /bin/bash<br/>root@docker-desktop:~# <!-- -->apt-get update<br/>root@docker-desktop:~# <!-- -->apt-get install net-tools</span></pre><p id="53f8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在执行<code class="fe pa pb pc pd b">ifconfig.</code>之前</p><p id="efdc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在我们已经用完了，请将容器移走。</p><pre class="kj kk kl km gt pv pd pw px aw py bi"><span id="43b1" class="ng la it pd b gy pz qa l qb qc">docker container rm lp</span></pre><h1 id="f231" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">清理码头建筑的混乱</h1><p id="ba3c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">每次创建Docker <strong class="lt iu">图像时，</strong>Docker文件都会导致旧的<strong class="lt iu">层</strong>变得多余。这些冗余的<strong class="lt iu">层</strong>消耗内存和交换空间。使用Docker命令删除这些层:</p><pre class="kj kk kl km gt pv pd pw px aw py bi"><span id="bdf0" class="ng la it pd b gy pz qa l qb qc">docker system prune</span></pre><p id="e1b6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为什么Docker没有垃圾收集器？我不知道。我确信通过一些研究我可以找到答案。上面的Docker命令在你做的时候警告你，对我来说就够了。</p><p id="97c0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们从未遇到过运行<code class="fe pa pb pc pd b">docker system prune.</code>的问题，但是，如果我们在频繁更改docker文件时不使用<code class="fe pa pb pc pd b">docker system prune</code>，我们就会耗尽“本地”内存。</p><h2 id="ae1f" class="ng la it bd lb nh ni dn lf nj nk dp lj ma nl nm ll me nn no ln mi np nq lp nr bi translated">检查所有Docker运行选项</h2><p id="60b8" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您可以对这个docker <code class="fe pa pb pc pd b">run </code>命令应用许多其他标志，以实现更加定制的容器创建过程。</p><p id="6fb8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">运行下面的命令，以获得与此命令一起运行的更多选项。</p><pre class="kj kk kl km gt pv pd pw px aw py bi"><span id="a06a" class="ng la it pd b gy pz qa l qb qc">docker run -it &lt;image ID&gt; --help</span></pre></div><div class="ab cl pg ph hx pi" role="separator"><span class="pj bw bk pk pl pm"/><span class="pj bw bk pk pl pm"/><span class="pj bw bk pk pl"/></div><div class="im in io ip iq"><h1 id="8089" class="kz la it bd lb lc pn le lf lg po li lj jz pp ka ll kc pq kd ln kf pr kg lp lq bi translated">摘要</h1><p id="7728" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">你可能已经注意到我已经讨论了Dockerfile文件的丰富主题。我也没有讨论Docker-compose，但是我会在未来的博客文章中讨论这个问题。)在此之前，我可以说我们使用Docker-compose从微服务构建服务。</p><p id="5eaa" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这篇博客文章中，我主要关注Docker run命令和必要的辅助管理Docker命令。</p><p id="0668" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我被允许分享我们迄今为止的旅程。当我们做出重大改变时，将会有更新。</p><p id="6aef" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">编码快乐！</p></div></div>    
</body>
</html>