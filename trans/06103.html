<html>
<head>
<title>How to Build A Machine Learning API Using Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Flask构建机器学习API</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-build-a-machine-learning-api-using-flask-2fb345518801?source=collection_archive---------4-----------------------#2021-06-01">https://towardsdatascience.com/how-to-build-a-machine-learning-api-using-flask-2fb345518801?source=collection_archive---------4-----------------------#2021-06-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="06bf" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们把你的ML模型应用到现实生活中吧！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/adfb2b36311ff1cd50328ab2c696f19a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5JbgOVEcqiOBXZvewdRCOQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">卢卡·布拉沃在<a class="ae ky" href="https://unsplash.com/s/photos/web?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="5161" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="080c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">机器学习(ML)是一种很好的方式来完成无法显式编码的任务，例如图像分类。但是当模型已经构建好了，如果我们不把它部署到应用程序中，它就没有用了。</p><p id="3f91" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">部署是机器学习工作流中的一个重要步骤。这是我们希望将ML模型应用到应用程序中的一个步骤。之后，我们可以在现实生活中使用该模型。</p><p id="744d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">但是我们如何将模型创建为应用程序呢？我们可以构建一个应用编程接口(API)。有了它，我们可以从任何地方访问模型，无论是在移动应用程序上还是在web应用程序上。在Python中，有一个库可以帮助我们构建API。它叫烧瓶。</p><p id="6ec2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">本文将向您展示如何使用Flask为我们的机器学习模型构建REST API。事不宜迟，我们开始吧！</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="fdaa" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">REST API</h1><p id="f78d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我们进入实现之前，让我解释一下REST API。REST API代表表述性状态转移应用程序编程接口。</p><p id="bdb8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">REST API的机制是这样的。假设你想在谷歌上搜索猫的照片。第一步是向谷歌发送一个请求，给他们一个类似“猫照片”的查询。然后，服务器会给你的电脑发送一个响应，就是猫咪照片的汇编。</p><p id="4914" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">关于REST API就这些了！这是作为客户端的你们之间的交流方式，通过向服务器请求一些东西，然后服务器会向你发送响应。下面是REST API如何工作的一个例子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f1217748a234c7c2c7b5d5453fb56464.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MXDwOnQuth0Af1IH"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">这个形象是作者创造的</p></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="b667" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">履行</h1><p id="bcfa" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在您已经理解了REST API的基本概念。让我们进入使用Flask的实现。我们将介绍几个流程:</p><ol class=""><li id="1c14" class="ne nf it lt b lu mn lx mo ma ng me nh mi ni mm nj nk nl nm bi translated">导入库</li><li id="07cf" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">加载机器学习模型</li><li id="e836" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">构建预处理和预测图像的函数</li><li id="bcaf" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">初始化flask对象</li><li id="382a" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">设置向用户浏览器返回某些内容的路径和函数</li><li id="17aa" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">运行并测试API</li></ol><h2 id="5a24" class="ns la it bd lb nt nu dn lf nv nw dp lj ma nx ny ll me nz oa ln mi ob oc lp od bi translated">导入库</h2><p id="d0bf" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">第一步是加载库。我们将导入的库是TensorFlow、Flask、Pillow和其他支持库。如果没有安装这些库，可以使用pip命令进行安装。</p><p id="6f81" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">以下是导入库的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="6cb7" class="ns la it bd lb nt nu dn lf nv nw dp lj ma nx ny ll me nz oa ln mi ob oc lp od bi translated">加载模型</h2><p id="882d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">加载库之后，下一步是加载机器学习模型。在这种情况下，我将使用我的图像分类器模型，在使用TensorFlow之前，我已经对它进行了预训练。该模型将预测图像是否包含食物。</p><p id="5880" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面是加载模型的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><blockquote class="og oh oi"><p id="2967" class="lr ls oj lt b lu mn ju lw lx mo jx lz ok mp mc md ol mq mg mh om mr mk ml mm im bi translated">旁注:<br/>如果你在GPU上训练模型，想在CPU上运行它们，也没问题。TensorFlow支持这一点，你根本不需要调整模型。</p></blockquote><h2 id="675c" class="ns la it bd lb nt nu dn lf nv nw dp lj ma nx ny ll me nz oa ln mi ob oc lp od bi translated">构建预处理和预测图像的函数</h2><p id="2570" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">加载模型后，下一步是创建函数来处理图像。因为我们将从客户端的请求中获取图像，所以我们将使用io。BytesIO函数将图像加载到我们的Python代码中。之后，我们只需要调用。从我们的模型预测函数来预测结果。</p><p id="7d1d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面是预处理和预测图像的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="68c0" class="ns la it bd lb nt nu dn lf nv nw dp lj ma nx ny ll me nz oa ln mi ob oc lp od bi translated">初始化flask对象</h2><p id="e541" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">构建完函数后，现在让我们初始化Flask对象。此外，我们在Flask对象参数上设置名称。这一步是为了确保运行web应用程序时python脚本是可读的。</p><p id="d4ba" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面是执行该操作的命令:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="d143" class="ns la it bd lb nt nu dn lf nv nw dp lj ma nx ny ll me nz oa ln mi ob oc lp od bi translated">设置路线和功能</h2><p id="9a2b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在让我们设置路线和我们想要运行的功能。路由是访问网络上特定功能的一种方式。当我们访问路由时，它将运行一个函数，并将消息返回给用户。</p><p id="fbc4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">基于超文本传输协议(HTTP)方法，每条路由都有不同的交互方式。我们可以使用几种HTTP方法。</p><p id="6b2a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">第一个是GET方法，我们只访问路由，不发送任何数据。第二个是POST方法。在这个方法中，我们可以访问路由，也可以向它发送数据。</p><p id="a949" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">还有像PUT、PATCH和DELETE方法这样的方法。但我们不会进一步谈论它。这次我们将只使用GET和POST方法。</p><p id="1138" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在让我们创建两条路线。第一个是“/”路由路径。该路由将返回API的欢迎消息。因此，我们会给这个路由一个GET方法。</p><p id="16f6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">第二个是“/predict”路由路径。该路径将从图像返回预测结果。我们将使用POST方法将图像发送到路由中。此外，我们需要设置密钥，这样应用程序就可以知道图像在哪里。我们将使用“file”键作为图像文件的标识符。</p><p id="653d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">以下是设置路线及其功能的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="6d9f" class="ns la it bd lb nt nu dn lf nv nw dp lj ma nx ny ll me nz oa ln mi ob oc lp od bi translated">运行API</h2><p id="e1ef" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我们构建了函数和它们的路径之后，现在让我们运行API。但是在我们运行API之前还有最后一步。我们需要添加。像这样将方法路由到我们的代码中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="a522" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在转到您的终端，运行以下命令之一(确保您与API文件位于同一路径):</p><pre class="kj kk kl km gt on oo op oq aw or bi"><span id="3f40" class="ns la it oo b gy os ot l ou ov"><strong class="oo iu">flask run</strong></span><span id="9d29" class="ns la it oo b gy ow ot l ou ov">OR</span><span id="15dc" class="ns la it oo b gy ow ot l ou ov"><strong class="oo iu">python app.py</strong></span></pre><p id="fb68" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您运行该命令，它将返回如下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/149ab6802b0b075be44afbcbd49b020f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Pdn9d35P46rUsn4R"/></div></div></figure><p id="8f40" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">从上面可以看到，它显示了来自TensorFlow的几个日志。别担心。这只是一个我们可以忽略的警告。只要你能看到“正在运行”的消息，就意味着你的API正在运行。</p><p id="5412" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在我们通过地址<a class="ae ky" href="http://127.0.0.1:5000/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:5000/ </a>访问API，其中127.0.0.1是你的本地地址，5000是访问API的端口号。如果它成功了，它会在网上这样显示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/19fec2b0e9e643194f2d9767d0279116.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/0*xU-pN-MRt4sFfQzu"/></div></figure><p id="e104" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">太好了！我们的API完美启动。让我们试试API，看它能不能预测一个图像里面有没有食物。我们可以使用一个名为Postman的应用程序来测试我们之前创建的API。你可以在这里下载<a class="ae ky" href="https://www.postman.com/downloads/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="bf47" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是结果的预览，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/09f1815bc2caee64c4812766a18185a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*o1TFJR7vFxItSEEmzjebpA.gif"/></div></div></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="7278" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">结束语</h1><p id="24d8" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">从上面可以看出，API可以捕捉图像并返回预测结果。意味着我们的API已经在工作了。干得好！</p><p id="1dc8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，您已经使用Flask构建了机器学习API。我希望这篇文章能帮助你理解REST API的概念。此外，它还可以指导您在自己的项目中开发自己的API。</p><p id="6fcf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你对这篇文章感兴趣，你可以关注我的媒体以获得更多类似的文章。此外，如果您有任何问题或想与我交谈，您可以在<a class="ae ky" href="https://www.linkedin.com/in/alghaniirfan/" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> LinkedIn </strong> </a>上与我联系。</p><p id="dea1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您仍然困于编写API，这里是API的完整代码，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="bc0d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">谢谢你看我的文章！</p><h2 id="7d5e" class="ns la it bd lb nt nu dn lf nv nw dp lj ma nx ny ll me nz oa ln mi ob oc lp od bi translated">参考</h2><p id="c431" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">[1]<a class="ae ky" href="https://www.smashingmagazine.com/2018/01/understanding-using-rest-api/" rel="noopener ugc nofollow" target="_blank">https://www . smashingmagazine . com/2018/01/understanding-using-rest-API/</a></p></div></div>    
</body>
</html>