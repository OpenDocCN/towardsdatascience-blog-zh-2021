<html>
<head>
<title>How to Declutter a Bar Chart in Altair</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 Altair 中整理条形图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-declutter-a-bar-chart-in-altair-e721f5c0ad87?source=collection_archive---------20-----------------------#2021-12-27">https://towardsdatascience.com/how-to-declutter-a-bar-chart-in-altair-e721f5c0ad87?source=collection_archive---------20-----------------------#2021-12-27</a></blockquote><div><div class="fc ik il im in io"/><div class="ip iq ir is it"><h2 id="bf91" class="iu iv iw bd b dl ix iy iz ja jb jc dk jd translated" aria-label="kicker paragraph">数据可视化</h2><div class=""/><div class=""><h2 id="2c61" class="pw-subtitle-paragraph kc jf iw bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">关于如何通过流行的 Python 数据库提高条形图可读性的一些技巧和提示</h2></div><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj ku"><img src="../Images/8abb9fcff4bb09ec4ba8a700e597349a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dUGYvYaCBGAcJw7z"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">照片由<a class="ae lk" href="https://unsplash.com/@nate_dumlao?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">内森·杜姆劳</a>在<a class="ae lk" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="080f" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">最近我读了一本非常有趣的书，作者是 Jose Berengueres，书名为<em class="mh">数据可视化简介&amp;讲故事:数据科学家指南。在本书中，作者描述了许多从数据集中提取一个非常有趣的故事的技术。受这本书的启发，在本文中，我描述了一个在 Altair 中整理条形图并从表示的数据中提取一个故事的策略。</em></p><p id="1082" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">Altair 是一个流行的用于数据可视化的 Python 库。还有许多其他用于数据可视化的 Python 库，比如 Matplotlib 和 Seaborn。在本教程中，我将描述 Altair，留待将来分析其他数据 Viz 库时使用😃</p><p id="7c93" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">在本教程中，我将演示如何在 Altair 中构建一个条形图，以及如何对其进行整理。</p><blockquote class="mi"><p id="50b6" class="mj mk iw bd ml mm mn mo mp mq mr mg dk translated">整理图表意味着删除所有不必要的东西，这些东西会分散读者获取正确信息的注意力。</p></blockquote><p id="2668" class="pw-post-body-paragraph ll lm iw ln b lo ms kg lq lr mt kj lt lu mu lw lx ly mv ma mb mc mw me mf mg ip bi translated">作为一个用例，我利用了欧盟统计局提供的<a class="ae lk" href="https://ec.europa.eu/eurostat/databrowser/view/tps00204/default/table?lang=en" rel="noopener ugc nofollow" target="_blank">活产和粗出生率</a>数据集。该数据集包含从 2009 年到 2020 年每个欧洲国家的活产婴儿数量。</p><p id="924c" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated"><strong class="ln jg">目标是通过整理一个基本条形图，从数据中提取一些有意义的信息，重点是上一期(2019–2020)。</strong></p><p id="a6ab" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">目录:</p><ul class=""><li id="3a72" class="mx my iw ln b lo lp lr ls lu mz ly na mc nb mg nc nd ne nf bi translated">加载并清理数据集</li><li id="dfba" class="mx my iw ln b lo ng lr nh lu ni ly nj mc nk mg nc nd ne nf bi translated">条形图基础</li><li id="ab31" class="mx my iw ln b lo ng lr nh lu ni ly nj mc nk mg nc nd ne nf bi translated">数据聚合</li><li id="258d" class="mx my iw ln b lo ng lr nh lu ni ly nj mc nk mg nc nd ne nf bi translated">最终清理</li></ul><h1 id="ce07" class="nl nm iw bd nn no np nq nr ns nt nu nv kl nw km nx ko ny kp nz kr oa ks ob oc bi translated">1 加载并清理数据集</h1><p id="b2ea" class="pw-post-body-paragraph ll lm iw ln b lo od kg lq lr oe kj lt lu of lw lx ly og ma mb mc oh me mf mg ip bi translated">我下载了。XSLX 文件和我通过<code class="fe oi oj ok ol b">read_excel()</code>函数加载的熊猫数据帧:</p><pre class="kv kw kx ky gu om ol on oo aw op bi"><span id="5e16" class="oq nm iw ol b gz or os l ot ou">import pandas as pd</span><span id="efda" class="oq nm iw ol b gz ov os l ot ou">df = pd.read_excel('../sources/eu_live_births.xlsx', header=7, sheet_name="Sheet 1", na_values=':')<br/>df.head(10)</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj ow"><img src="../Images/cdd0ae9cb861234c5db39bade8029958.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kn3jNuDEWivhKwz-D82Tpw.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="2aa2" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">数据集非常脏，因此我通过只选择感兴趣的列来清理它。</p><pre class="kv kw kx ky gu om ol on oo aw op bi"><span id="a4a2" class="oq nm iw ol b gz or os l ot ou">df = df[['TIME', '2019', '2020']]<br/>df.head()</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj ox"><img src="../Images/c024cd05a6ecdefd6cf73a99c78f56f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IUJJr1CkOmJwkX54hGBT-Q.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="36ca" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我将<code class="fe oi oj ok ol b">TIME</code>列重命名为<code class="fe oi oj ok ol b">Country</code></p><pre class="kv kw kx ky gu om ol on oo aw op bi"><span id="78fc" class="oq nm iw ol b gz or os l ot ou">df.rename(columns={'TIME' : 'Country'}, inplace=True)</span></pre><p id="bdd3" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">然后我删除列 2020 和 2019 的<code class="fe oi oj ok ol b">NaN</code>值</p><pre class="kv kw kx ky gu om ol on oo aw op bi"><span id="a178" class="oq nm iw ol b gz or os l ot ou">df.dropna(subset=['2020'],inplace=True)<br/>df.dropna(subset=['2019'],inplace=True)</span></pre><p id="cd30" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我删除了前六行，它们是相对于整个欧洲的:</p><pre class="kv kw kx ky gu om ol on oo aw op bi"><span id="2102" class="oq nm iw ol b gz or os l ot ou">df = df.iloc[6:]</span></pre><h1 id="f101" class="nl nm iw bd nn no np nq nr ns nt nu nv kl nw km nx ko ny kp nz kr oa ks ob oc bi translated">2 建立一个基本的条形图</h1><p id="ace4" class="pw-post-body-paragraph ll lm iw ln b lo od kg lq lr oe kj lt lu of lw lx ly og ma mb mc oh me mf mg ip bi translated">现在我用 2020 年的数据构建了一个原始条形图:</p><pre class="kv kw kx ky gu om ol on oo aw op bi"><span id="016a" class="oq nm iw ol b gz or os l ot ou">import altair as alt<br/>bars = alt.Chart(df).mark_bar().encode(<br/>    x=alt.X('2020:Q'),<br/>    y=alt.Y('Country:N'),<br/>)</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj oy"><img src="../Images/99d0021d1d50d4d035e0c023a9126eb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*Tybgory4PxVD2HalNHmU0w.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="24dd" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">条形图很难阅读，因此我通过<code class="fe oi oj ok ol b">sort='-x'</code>参数订购 DESC 棒材(使用<code class="fe oi oj ok ol b">x</code>订购 ASC)。</p><pre class="kv kw kx ky gu om ol on oo aw op bi"><span id="0dfe" class="oq nm iw ol b gz or os l ot ou">bars = alt.Chart(df).mark_bar().encode(<br/>    x=alt.X('2020:Q'),<br/>    y=alt.Y('Country:N', sort='-x'),<br/>)</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj oy"><img src="../Images/4fbdf84dbc3544f0d980dc43a27da566.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*od6vT3gJb90ZY37b5THmnA.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="8589" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">截断到前 10 个国家是对该条形图的唯一改进。然而，<strong class="ln jg">截断数据并不是理解现象</strong>的最佳解决方案。因此，我遵循另一种策略，即把国家聚合到宏观区域(或地区)。</p><h1 id="9056" class="nl nm iw bd nn no np nq nr ns nt nu nv kl nw km nx ko ny kp nz kr oa ks ob oc bi translated">3 数据汇总</h1><p id="aec3" class="pw-post-body-paragraph ll lm iw ln b lo od kg lq lr oe kj lt lu of lw lx ly og ma mb mc oh me mf mg ip bi translated">我的原始数据集不包含任何聚合信息，因此我应该增加一个新列，包含每个国家的宏观区域。</p><p id="31d7" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我利用了从这个<a class="ae lk" href="https://www.schengenvisainfo.com/countries-in-europe/" rel="noopener ugc nofollow" target="_blank">网站</a>中提取的另一个数据集，它包含了每个国家及其地区和人口。</p><p id="d7dd" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我加载数据集:</p><pre class="kv kw kx ky gu om ol on oo aw op bi"><span id="8411" class="oq nm iw ol b gz or os l ot ou">df_regions = pd.read_csv('../sources/eu_regions.csv', sep=';')</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj oz"><img src="../Images/7b75ce7b6868a058f479f694f67eaf3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jawepFa7URjrE9H1cn6Dgg.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="c938" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我定义了一个函数，它接收一个国家作为输入，并返回它的子区域。该函数还管理异常。</p><pre class="kv kw kx ky gu om ol on oo aw op bi"><span id="eb7f" class="oq nm iw ol b gz or os l ot ou">def get_region(x):<br/>    south_exceptions = ['Cyprus', 'Turkey']<br/>    east_exceptions = ['Armenia', 'Azerbaijan']<br/>    if x in south_exceptions:<br/>        return 'Southern Europe'<br/>    if x in east_exceptions:<br/>        return 'Eastern Europe'<br/>    row = df_regions[df_regions['Country'] == x]<br/>    return row['Subregion'].iloc[0]</span></pre><p id="44ae" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">现在我丰富了我的原始数据集:</p><pre class="kv kw kx ky gu om ol on oo aw op bi"><span id="2ddb" class="oq nm iw ol b gz or os l ot ou">df['Region'] = df['Country'].apply(lambda x: get_region(x))</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj pa"><img src="../Images/c9a2a79209c913630f46b2d9f99b2547.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*fWi_WmBWqeG_hTZerMKRNg.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="0b4d" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">现在，我构建聚合条形图。我利用<code class="fe oi oj ok ol b">transform_aggregate()</code>函数来计算每个区域的平均值。我要感谢<a class="pb pc ep" href="https://medium.com/u/2cf6b549448?source=post_page-----e721f5c0ad87--------------------------------" rel="noopener" target="_blank">Soner y ldr RM</a>，他让我在题为<a class="ae lk" rel="noopener" target="_blank" href="/3-examples-to-show-python-altair-is-more-than-a-data-visualization-library-700e37cbf95b"> 3 个例子来展示 Python Altair 不仅仅是一个数据可视化库</a>的文章中发现了<code class="fe oi oj ok ol b">transform_aggregate()</code>函数。</p><pre class="kv kw kx ky gu om ol on oo aw op bi"><span id="150a" class="oq nm iw ol b gz or os l ot ou">bars = alt.Chart(df).mark_bar().encode(<br/>    x=alt.X('avg_value:Q'),<br/>    y=alt.Y('Region:N')<br/>).<strong class="ol jg">transform_aggregate</strong>(<br/>   avg_value = 'average(2020)', groupby = ['Region']<br/>)</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj pd"><img src="../Images/0787d47cc7fb8806dc3d1c56235d3bcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*9Wk3E3XfVGAKsq30VjxRcQ.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="5102" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">在比较数量时，绝对值不是最佳解决方案。因此，我计算了 2020 年相对于 2019 年的活产减少/增加百分比:</p><pre class="kv kw kx ky gu om ol on oo aw op bi"><span id="f132" class="oq nm iw ol b gz or os l ot ou">import math</span><span id="47d2" class="oq nm iw ol b gz ov os l ot ou">df['2020_2019'] = -(df['2020'] - df['2019'])/df['2019']</span></pre><p id="0e12" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我再次绘制条形图:</p><pre class="kv kw kx ky gu om ol on oo aw op bi"><span id="f9b4" class="oq nm iw ol b gz or os l ot ou">bars = alt.Chart(df).mark_bar().encode(<br/>    x=alt.X('avg_value:Q'),<br/>    y=alt.Y('Region:N')<br/>).transform_aggregate(<br/>   avg_value = 'average(2020_2019)', groupby = ['Region']<br/>)</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj pd"><img src="../Images/ecffea8246c2b053a1d242a47aaf3152.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*TdS8q6y4YEgkUbn6KCE42g.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="bd4c" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">图表很清楚:<strong class="ln jg">东欧经历了最大的百分比下降</strong>。这一方面可能是要讲的故事。</p><h1 id="4171" class="nl nm iw bd nn no np nq nr ns nt nu nv kl nw km nx ko ny kp nz kr oa ks ob oc bi translated">4 最终清理</h1><p id="3fd4" class="pw-post-body-paragraph ll lm iw ln b lo od kg lq lr oe kj lt lu of lw lx ly og ma mb mc oh me mf mg ip bi translated">现在，故事已经从数据中提取出来，我可以进一步整理图表。首先，我设置了图形标题:</p><pre class="kv kw kx ky gu om ol on oo aw op bi"><span id="eb67" class="oq nm iw ol b gz or os l ot ou">bars = alt.Chart(df).mark_bar().encode(<br/>    x=alt.X('avg_value:Q'),<br/>    y=alt.Y('Region:N')<br/>).transform_aggregate(<br/>   avg_value = 'average(2020_2019)', groupby = ['Region']<br/>)<strong class="ol jg">.properties(<br/>     height = 300<br/>)</strong></span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj pd"><img src="../Images/c7b5c68d63e09bcd89140cda8e95cdae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*2Qifa-UtPxNA0n0Wh_GpRw.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="72ec" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">然后，我把标签贴在栅栏附近:</p><pre class="kv kw kx ky gu om ol on oo aw op bi"><span id="4362" class="oq nm iw ol b gz or os l ot ou">bars = alt.Chart(df).mark_bar().encode(<br/>    x=alt.X('avg_value:Q'),<br/>    y=alt.Y('Region:N')<br/>).transform_aggregate(<br/>   avg_value = 'average(2020_2019)', groupby = ['Region']<br/>)</span><span id="cb3a" class="oq nm iw ol b gz ov os l ot ou"><strong class="ol jg">text = bars.mark_text(<br/>    align='left',<br/>    baseline='middle',<br/>    dx=3,<br/>    fontStyle='bold',<br/>    fontSize=20<br/>).encode(<br/>    text=alt.Text('avg_value:Q', format=",.3f")</strong><br/>)</span><span id="cbb0" class="oq nm iw ol b gz ov os l ot ou">final_bar = (bars + text).properties(<br/>     height = 300<br/>)</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj pe"><img src="../Images/4b0df869e9b8512e14c57c1355a31b1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*a4HsbtV5WsLRZXOJszUP_A.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="6aa9" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我移除轴:</p><pre class="kv kw kx ky gu om ol on oo aw op bi"><span id="feb1" class="oq nm iw ol b gz or os l ot ou">bars = alt.Chart(df).mark_bar().encode(<br/>    x=alt.X('avg_value:Q', <strong class="ol jg">axis=None</strong>),<br/>    y=alt.Y('Region:N', <strong class="ol jg">title=''</strong>)<br/>).transform_aggregate(<br/>   avg_value = 'average(2020_2019)', groupby = ['Region']<br/>)</span><span id="d0bb" class="oq nm iw ol b gz ov os l ot ou">text = bars.mark_text(<br/>    align='left',<br/>    baseline='middle',<br/>    dx=3,<br/>    fontStyle='bold',<br/>    fontSize=20<br/>).encode(<br/>    text=alt.Text('avg_value:Q', format=",.3f")<br/>)</span><span id="96f6" class="oq nm iw ol b gz ov os l ot ou">final_bar = (bars + text).properties(<br/>     height = 300<br/>)<br/>final_bar</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj pf"><img src="../Images/e1d649c9725c8be2b3661a511d6c7411.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*7IoEPSQIg5G-_IbVrX42Eg.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="a1d2" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我加上标题:</p><pre class="kv kw kx ky gu om ol on oo aw op bi"><span id="03ec" class="oq nm iw ol b gz or os l ot ou">bars = alt.Chart(df).mark_bar().encode(<br/>    x=alt.X('avg_value:Q', axis=None),<br/>    y=alt.Y('Region:N', title='')<br/>).transform_aggregate(<br/>   avg_value = 'average(2020_2019)', groupby = ['Region']<br/>)</span><span id="8fbc" class="oq nm iw ol b gz ov os l ot ou">text = bars.mark_text(<br/>    align='left',<br/>    baseline='middle',<br/>    dx=3,<br/>    fontStyle='bold',<br/>    fontSize=20<br/>).encode(<br/>    text=alt.Text('avg_value:Q', format=",.3f"),<br/>    <br/>)</span><span id="8206" class="oq nm iw ol b gz ov os l ot ou">final_bar = (bars + text).properties(<br/>    height = 300,<br/>    <strong class="ol jg">title = 'Percentage Decrease in Live Births (2020-2019)'</strong><br/>).<strong class="ol jg">configure_title(<br/>    fontSize=24<br/>)</strong></span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj pg"><img src="../Images/ada97a97158304a3110014dd7912c922.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*RfsV1Z_XH0ev7xE-9OT4HQ.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="ba53" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">最后，我将重点介绍一个地区(南欧)的情况:</p><pre class="kv kw kx ky gu om ol on oo aw op bi"><span id="38a0" class="oq nm iw ol b gz or os l ot ou">bars = alt.Chart(df).mark_bar().encode(<br/>    x=alt.X('avg_value:Q', axis=None),<br/>    y=alt.Y('Region:N', title=''),<br/>    <strong class="ol jg">color=alt.condition(alt.datum.Region == 'Southern Europe', alt.value('#8B0000'), alt.value('grey'))</strong><br/>).transform_aggregate(<br/>   avg_value = 'average(2020_2019)', groupby = ['Region']<br/>)</span><span id="8c06" class="oq nm iw ol b gz ov os l ot ou">text = bars.mark_text(<br/>    align='left',<br/>    baseline='middle',<br/>    dx=3,<br/>    fontStyle='bold',<br/>    fontSize=20<br/>).encode(<br/>    text=alt.Text('avg_value:Q', format=",.3f"),<br/>    <br/>)</span><span id="0f1a" class="oq nm iw ol b gz ov os l ot ou">final_bar = (bars + text).properties(<br/>    height = 300,<br/>    title = 'Percentage Decrease in Live Births (2020-2019)'<br/>).configure_title(<br/>    fontSize=24<br/>)</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj pg"><img src="../Images/c610b3c96af4a5433d4435981a270e08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*Kcqao1Dr8jwRT-maFnlsZA.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><h1 id="7e89" class="nl nm iw bd nn no np nq nr ns nt nu nv kl nw km nx ko ny kp nz kr oa ks ob oc bi translated">摘要</h1><p id="1a47" class="pw-post-body-paragraph ll lm iw ln b lo od kg lq lr oe kj lt lu of lw lx ly og ma mb mc oh me mf mg ip bi translated">在本文中，我举例说明了一个在 Altair 中整理条形图并使其可读性更好的实例。清理需要以下操作:</p><ul class=""><li id="7d83" class="mx my iw ln b lo lp lr ls lu mz ly na mc nb mg nc nd ne nf bi translated">为初步数据探索构建一个基本条形图</li><li id="d7a8" class="mx my iw ln b lo ng lr nh lu ni ly nj mc nk mg nc nd ne nf bi translated">聚合数据，如果聚合数据不可用，则搜索另一个数据集</li><li id="8871" class="mx my iw ln b lo ng lr nh lu ni ly nj mc nk mg nc nd ne nf bi translated">绘制聚合数据并提取故事</li><li id="8e53" class="mx my iw ln b lo ng lr nh lu ni ly nj mc nk mg nc nd ne nf bi translated">通过删除轴、添加标题和突出显示文章，执行最终的整理。</li></ul><p id="f6f0" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">如果你已经走到这一步来阅读，对我来说，今天已经有很多了。谢谢！你可以在本文中读到更多关于我的信息。</p><p id="d73f" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">您可以从我的<a class="ae lk" href="https://github.com/alod83/data-science/blob/master/DataVisualization/Altair/Altair%20Decluttering.ipynb" rel="noopener ugc nofollow" target="_blank"> Github 资源库</a>下载本教程的完整代码。</p><h1 id="9c06" class="nl nm iw bd nn no np nq nr ns nt nu nv kl nw km nx ko ny kp nz kr oa ks ob oc bi translated">相关文章</h1><div class="ph pi gq gs pj pk"><a rel="noopener follow" target="_blank" href="/how-to-run-animations-in-altair-and-streamlit-2a0624789ad"><div class="pl ab fp"><div class="pm ab pn cl cj po"><h2 class="bd jg gz z fq pp fs ft pq fv fx jf bi translated">如何在牛郎星和细流中运行动画</h2><div class="pr l"><h3 class="bd b gz z fq pp fs ft pq fv fx dk translated">一个准备运行的教程，它描述了如何建立一个动画折线图使用阿尔泰和细流。</h3></div><div class="ps l"><p class="bd b dl z fq pp fs ft pq fv fx dk translated">towardsdatascience.com</p></div></div><div class="pt l"><div class="pu l pv pw px pt py le pk"/></div></div></a></div><div class="ph pi gq gs pj pk"><a rel="noopener follow" target="_blank" href="/data-visualisation-principles-part-1-a-practical-example-in-altair-b6e16f665fc6"><div class="pl ab fp"><div class="pm ab pn cl cj po"><h2 class="bd jg gz z fq pp fs ft pq fv fx jf bi translated">数据可视化原理第 1 部分——阿尔泰中的一个实例</h2><div class="pr l"><h3 class="bd b gz z fq pp fs ft pq fv fx dk translated">这是一个实用的教程，介绍如何在 Python Altair 中构建、自定义简单条形图并向其添加注释</h3></div><div class="ps l"><p class="bd b dl z fq pp fs ft pq fv fx dk translated">towardsdatascience.com</p></div></div><div class="pt l"><div class="pz l pv pw px pt py le pk"/></div></div></a></div><div class="ph pi gq gs pj pk"><a rel="noopener follow" target="_blank" href="/data-visualisation-principles-part-1-white-space-text-and-colour-13f520f90ce9"><div class="pl ab fp"><div class="pm ab pn cl cj po"><h2 class="bd jg gz z fq pp fs ft pq fv fx jf bi translated">数据可视化原则第 1 部分:空白、文本和颜色</h2><div class="pr l"><h3 class="bd b gz z fq pp fs ft pq fv fx dk translated">从基本的平面设计原则开始。</h3></div><div class="ps l"><p class="bd b dl z fq pp fs ft pq fv fx dk translated">towardsdatascience.com</p></div></div><div class="pt l"><div class="qa l pv pw px pt py le pk"/></div></div></a></div></div></div>    
</body>
</html>