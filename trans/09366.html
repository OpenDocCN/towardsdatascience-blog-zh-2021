<html>
<head>
<title>How to Deploy a Flask API on AWS ECS (Part 3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在AWS ECS上部署Flask API(第3部分)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-deploy-a-flask-api-on-aws-ecs-part-3-c1ca552e65d?source=collection_archive---------6-----------------------#2021-08-31">https://towardsdatascience.com/how-to-deploy-a-flask-api-on-aws-ecs-part-3-c1ca552e65d?source=collection_archive---------6-----------------------#2021-08-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3840" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如何在AWS ECS上对接和部署Flask API的分步指南</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/01fb596aa2b31e3b149618b9ffdec544.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fcIX6Ns0coOGoa0D"/></div></div><p class="kx ky gj gh gi kz la bd b be z dk translated">照片由<a class="ae lb" href="https://unsplash.com/@dallasreedy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">达拉斯里德</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="2e88" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">数据科学领域的一个重要方面是你永远不会停止学习。一旦你对数据争论和机器学习感到舒适，下一步通常是学习如何让你的ML模型进入“生产”以供他人使用。下一步不仅需要你知道如何使用Flask、Django或FastAPI等工具构建API，还需要你了解Docker &amp; Cloud (AWS、Azure、GCP)栈。这篇文章旨在帮助你解决最后两个问题:Docker &amp; Cloud。</p><p id="9b93" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您一直在关注我的电影推荐引擎组合项目4部分系列，到目前为止，我们已经介绍了协作过滤的理论(第1部分)以及如何创建Flask API(第2部分):</p><ul class=""><li id="3ef3" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated"><a class="ae lb" rel="noopener" target="_blank" href="/user-to-user-vs-item-to-item-collaborative-filtering-explained-through-simple-examples-part-1-f133bec23a58">通过简单的例子解释用户对用户与项目对项目的协同过滤(第一部分)</a></li><li id="a2f6" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated"><a class="ae lb" rel="noopener" target="_blank" href="/build-a-movie-recommendation-engine-backend-api-in-5-minutes-part-2-851b840bc26d">在5分钟内构建一个电影推荐引擎后端API(第二部分)</a></li></ul><p id="95f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，我们将介绍如何在AWS上部署我们在第2部分中构建的Flask API。</p><p id="6baa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">教程结构</strong></p><ol class=""><li id="8ff0" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lq li lj lk bi translated">AWS上最流行的API部署选项的快速概述</li><li id="b4db" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lq li lj lk bi translated">克隆包含必要API文件的GitHub repo</li><li id="b176" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lq li lj lk bi translated">将API归档</li><li id="46f0" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lq li lj lk bi translated">将Docker图像推送到Amazon ECR</li><li id="2a81" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lq li lj lk bi translated">在AWS ECS上创建一个任务来运行API，并使用分配的公共url对其进行测试。</li></ol></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><ol class=""><li id="575c" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lq li lj lk bi translated"><strong class="jp ir">AWS上最流行的API部署选项的快速概述</strong></li></ol><p id="2835" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在决定如何在AWS上部署后端API时，我发现了两种主要方法:</p><p id="e5f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">I)带有API网关的AWS Lambda功能</p><p id="7d9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者</p><p id="c38b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ii)基于Docker映像在ECS上创建任务。</p><p id="8a63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">即使配置任务、负载平衡器、安全组等。与使用AWS Elastic Beanstalk相比，在AWS ECS上手动安装可能会更复杂，它使您能够更好地理解并根据您的项目需求正确设置每个组件。</p><p id="b66a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我之所以选择Docker Containers和ECS而不是Lambda函数来部署这个API，是因为Lambda函数要求您添加额外的层来配置库(如pandas ),以便与python运行时兼容，如果您不是严格在Linux操作系统上构建Docker映像，这可能会很麻烦。</p><p id="522b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们开始吧。</p><p id="75dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 2。克隆包含必要API文件的GitHub repo</strong></p><p id="116f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> a) </strong>克隆以下回购:</p><pre class="km kn ko kp gt ly lz ma mb aw mc bi"><span id="07c4" class="md me iq lz b gy mf mg l mh mi"><a class="ae lb" href="https://github.com/kuzmicni/movie-rec-engine-backend" rel="noopener ugc nofollow" target="_blank">https://github.com/kuzmicni/movie-rec-engine-backend</a></span></pre><p id="60de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> b) </strong>从&amp;下面的google drive下载我们在上一篇文章中创建的<strong class="jp ir"> movie_similarity.csv </strong>文件(<a class="ae lb" rel="noopener" target="_blank" href="/build-a-movie-recommendation-engine-backend-api-in-5-minutes-part-2-851b840bc26d"> <strong class="jp ir"> Part 2 </strong> </a>)粘贴到克隆回购的根目录下。</p><pre class="km kn ko kp gt ly lz ma mb aw mc bi"><span id="ffea" class="md me iq lz b gy mf mg l mh mi"><a class="ae lb" href="https://drive.google.com/drive/folders/1FH6bWCcw1OoRf4QJaFaf4gIegIGSEx9r?usp=sharing" rel="noopener ugc nofollow" target="_blank">https://drive.google.com/drive/folders/1FH6bWCcw1OoRf4QJaFaf4gIegIGSEx9r</a></span></pre><p id="971e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您的代码结构应该如下所示:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/f7a846fb5f98bc8039601544f79da939.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*LU3fi3EhMbHL95yyCve8lA.png"/></div></figure><p id="c800" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> c) </strong>创建虚拟环境&amp;安装<strong class="jp ir">必需的库</strong></p><pre class="km kn ko kp gt ly lz ma mb aw mc bi"><span id="a13d" class="md me iq lz b gy mf mg l mh mi">conda create --name py37_tut python=3.7<br/>conda activate py37_tut<br/>pip install Flask Flask-Cors pandas</span></pre><p id="3a8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行应用编程接口</p><pre class="km kn ko kp gt ly lz ma mb aw mc bi"><span id="e9e0" class="md me iq lz b gy mf mg l mh mi">python application.py</span></pre><p id="b79d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> e) </strong>在一个单独的终端中运行测试API</p><pre class="km kn ko kp gt ly lz ma mb aw mc bi"><span id="9b1c" class="md me iq lz b gy mf mg l mh mi">curl -X POST http://0.0.0.0:80/recms -H 'Content-Type: application/json' -d '{"movie_title":"Heat (1995)"}'</span></pre><p id="e101" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应该从API获得以下输出:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mk"><img src="../Images/713a8bb111fde674d5c2f83b5705f5ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XUHdOI5Qfx3ubrsLSHBpmg.png"/></div></div></figure><p id="cc64" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3。将API归档</strong></p><p id="db8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我假设您已经安装了docker，并且熟悉创建docker映像。让我们确保您安装了docker:</p><pre class="km kn ko kp gt ly lz ma mb aw mc bi"><span id="b86a" class="md me iq lz b gy mf mg l mh mi">docker version</span></pre><p id="27bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应该得到类似的东西:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/ced5a62db41441f4c044ff0d62bb0b9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:468/format:webp/1*thI0RPSyllYwjKxbgPv9sQ.png"/></div></figure><p id="c018" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们对API进行Docker化的方式实质上是基于名为<strong class="jp ir"> Dockerfile </strong>的模板构建Docker镜像，该模板包含关于哪些文件需要复制以及如何运行API的指令。</p><p id="cc02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Dockerfile:</p><pre class="km kn ko kp gt ly lz ma mb aw mc bi"><span id="8b18" class="md me iq lz b gy mf mg l mh mi">FROM python:3.7</span><span id="5be8" class="md me iq lz b gy mm mg l mh mi">COPY ./* ./app/</span><span id="2780" class="md me iq lz b gy mm mg l mh mi">WORKDIR /app/</span><span id="ef00" class="md me iq lz b gy mm mg l mh mi">RUN pip install -r requirements.txt</span><span id="d887" class="md me iq lz b gy mm mg l mh mi">EXPOSE 80</span><span id="b58a" class="md me iq lz b gy mm mg l mh mi">CMD ["python", "application.py"]</span></pre><p id="3a44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本质上，这个Docker文件(即蓝图)指示的是将我们当前目录中的所有文件复制到Docker image <strong class="jp ir"> /app/ </strong>文件夹中，安装<strong class="jp ir"> requirements.txt </strong>文件中指定的库，暴露<strong class="jp ir">端口80 </strong>并将Flask API作为服务器运行。</p><p id="87f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要构建名为<strong class="jp ir"> flask-api </strong>的Docker映像，请确保您与Docker文件在同一个目录中(即/movie-rec-engine-backed ),并在您的终端中执行:</p><pre class="km kn ko kp gt ly lz ma mb aw mc bi"><span id="d2e2" class="md me iq lz b gy mf mg l mh mi">docker build -t flask-api .</span></pre><p id="90dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应该得到:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/694df5c06282d6440e7c3a48a5287d29.png" data-original-src="https://miro.medium.com/v2/resize:fit:520/format:webp/1*7onBO4wUiDRkk5SKY-eSrg.png"/></div></figure><p id="9081" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们准备把它推送到AWS弹性容器注册中心(ECR)。</p><p id="7320" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 4。将Docker图像推送到亚马逊ECR </strong></p><p id="cd94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我假设您已经安装了aws-cli，并且已经通过<strong class="jp ir"> aws configure </strong>命令输入了您的访问密钥和密钥。</p><p id="55b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在ECR中创建一个存储库:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mo"><img src="../Images/7c7afa5d2c8927260ff6e692a26f9c0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aHY95fKql114kQTJNR1M-g.png"/></div></div></figure><p id="75e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单击“创建存储库”，保留默认的私有选项，并将您的存储库命名为“flask-api-repo”</p><p id="6434" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> b) </strong>将Docker图像推送到ECR</p><p id="14f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击创建的“flask-api-repo”并选择“查看推送命令”</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mp"><img src="../Images/c887219b4b5d23261eeacfb787127baf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x-oPuA2sEWcdEcENRc7WNA.png"/></div></div></figure><p id="a31c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在您的终端中运行所提供的说明，但步骤2除外，因为我们已经构建了映像:</p><pre class="km kn ko kp gt ly lz ma mb aw mc bi"><span id="2c25" class="md me iq lz b gy mf mg l mh mi">aws ecr get-login-password --region <strong class="lz ir">&lt;your-region&gt;</strong> | docker login --username AWS --password-stdin <strong class="lz ir">&lt;your-account-alias&gt;</strong>.dkr.ecr.<strong class="lz ir">&lt;your-region&gt;</strong>.amazonaws.com</span><span id="519c" class="md me iq lz b gy mm mg l mh mi">docker tag flask-api <strong class="lz ir">&lt;your-account-alias&gt;</strong>.dkr.ecr.<strong class="lz ir">&lt;your-region&gt;</strong>.amazonaws.com/flask-api-repo:latest</span><span id="7a2d" class="md me iq lz b gy mm mg l mh mi">docker push <strong class="lz ir">&lt;your-account-alias&gt;</strong>.dkr.ecr.<strong class="lz ir">&lt;your-region&gt;</strong>.amazonaws.com/flask-api-repo:latest</span></pre><p id="f8da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">推送映像后，您可以刷新repo，应该会看到以下内容:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mq"><img src="../Images/3a03dd307c5a12e16d68daa23a3b8c1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8tOM-rU-CfGwaVT9jmgd5Q.png"/></div></div></figure><p id="43e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 5。在AWS ECS上创建一个任务来运行API，并使用分配的公共url对其进行测试</strong></p><p id="f70a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是时候创建一个运行该图像的任务了！</p><p id="4c1c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到ECS。</p><p id="81f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> a)创建一个集群</strong></p><p id="d9ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择:“仅网络”选项</p><p id="25fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">集群名:flask-api-cluster</p><p id="fb02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择:创建VPC并保留默认选项</p><p id="7425" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击“创建”。</p><p id="ef5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> b)定义任务</strong></p><p id="e6fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在ECS中，单击任务定义</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mr"><img src="../Images/9ebfecf772843176568c56069e4cf8c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*elOt6j5FWt7sk89zAz4L_g.png"/></div></div></figure><p id="c983" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单击“创建新任务定义”按钮</p><p id="73c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择“FARGATE”</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ms"><img src="../Images/61f05c1a93acbb6b009ff2e25d6b2a43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QtUn8iZJIRV-lEf6ZSrwIg.png"/></div></div></figure><p id="77f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择“下一步”</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mt"><img src="../Images/6f63a6ac9f6357dceb19aeb92428b7c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S8v_oHZlEqSfcsmP75gTyQ.png"/></div></div></figure><p id="37e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输入任务定义名称:flask-api-task</p><p id="9fbf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择默认的“ecsTaskExecRole ”,或者您也可以在IAM中创建一个具有更多访问权限的新角色。</p><p id="d2b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">c)指定任务大小</p><p id="78c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">任务内存(GB): 1GB</p><p id="5bb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">任务CPU: 0.5 vCPU</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/da7dff9c2ff2233a1b08e76d197aac53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9DdUVCPTxg5QvnwiSnhv3Q.png"/></div></div></figure><p id="70c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> d)添加容器</strong></p><p id="7ce8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择“添加容器”</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mv"><img src="../Images/e989fe72c6d4f1bdc67f886b5fc38f91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-EBIa8U-UjvY0noOFBMvIA.png"/></div></div></figure><p id="aa1c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">容器名称:烧瓶-API-容器</p><p id="665b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于URI形象，我们需要抓住我们的URI形象。只需在新标签中重新打开aws控制台，导航到ECR flask-api-repo并复制图像URI:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mw"><img src="../Images/364fbc5d4e91777393eca4a95eb02cfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LMRFTVVcc3EKBrL5_L-v-Q.png"/></div></div></figure><p id="2280" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">返回并将URI粘贴到图像*字段中</p><p id="aac3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输入:</p><p id="a658" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">软限制:128</p><p id="5394" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">端口映射:80</p><p id="c886" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将其余部分保留为默认值，然后单击页面底部的“添加”按钮</p><p id="6e58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">向下滚动并点击“创建”</p><p id="6b13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你应该看看</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/88c2025c275cba08212167febde32ed5.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*_w43_vwvrMurG8l3sc41CA.png"/></div></figure><p id="df90" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单击“查看任务定义”</p><p id="7a25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> e)运行任务</strong></p><p id="dc34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，在“操作”中选择“运行任务”</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi my"><img src="../Images/7d189ef5023f893f3e7b06bd26654045.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*MkqoccWnzr7u641NwlvCCw.png"/></div></figure><p id="d1dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择“FARGATE”</p><p id="f6ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">任务数量:1</p><p id="e814" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于子网:选择两个选项(我选择a和b)</p><p id="b5ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了安全组*点击编辑</p><p id="f60e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择“创建新的安全组”</p><p id="67eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安全组名*: flask-api-sg</p><p id="0d1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击“保存”</p><p id="4fa2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们应该看到我们的新任务处于“PROVISIONING”状态。等一会儿，直到它变成“运行”</p><p id="eee4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击“任务”并向下滚动找到公共IP。现在将IP粘贴到您的浏览器中，您应该会看到:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/11f7053f78a2adbe7a6c0a9d4f13b0ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:498/format:webp/1*YH60_7MVfS_S4vonSX3r-w.png"/></div></figure><p id="567e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">测试部署的API </p><p id="d0ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们通过终端测试一下。</p><p id="0bab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设你得到的<strong class="jp ir">公共IP </strong>是<strong class="jp ir">1.2.3.4</strong>，那么在终端中，你可以运行:</p><pre class="km kn ko kp gt ly lz ma mb aw mc bi"><span id="b199" class="md me iq lz b gy mf mg l mh mi">curl -X POST <strong class="lz ir">1.2.3.4</strong>/recms -H 'Content-Type: application/json' -d '{"movie_title":"Heat (1995)"}'</span></pre><p id="08b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并且应该得到:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi na"><img src="../Images/539d3bf467295949eba2944d7560c178.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3IRtKxqjKlfFyo52Ni4SQg.png"/></div></div></figure><p id="b805" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这意味着您的API已成功部署！</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><p id="e92a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">结束语</strong></p><p id="e865" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">需要注意的事项:</p><p id="3ac9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可能需要试验您的EcsTaskRole，并确保安全组具有允许流量访问API的规则。</p><p id="8bec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将Docker映像推送到ECR并在ECS中创建任务<strong class="jp ir">会在您的AWS帐户上产生费用</strong>，因此请确保<strong class="jp ir">停止任务并删除所有相关资源</strong>。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><p id="9eff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们准备使用<strong class="jp ir">第四部分</strong>中的<strong class="jp ir"> Vue.js </strong>构建电影推荐引擎前端！</p></div></div>    
</body>
</html>