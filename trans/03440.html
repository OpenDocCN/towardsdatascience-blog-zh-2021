<html>
<head>
<title>Switch-Case Statements Are Coming to Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中出现了Switch-Case语句</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/switch-case-statements-are-coming-to-python-d0caf7b2bfd3?source=collection_archive---------0-----------------------#2021-03-19">https://towardsdatascience.com/switch-case-statements-are-coming-to-python-d0caf7b2bfd3?source=collection_archive---------0-----------------------#2021-03-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="35bb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">最新版本展示了新的逻辑</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0ec0dc99fb6fa824c7b2735b0629c0e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OfS9n8O6FQO6pnu1Wj_ksg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="e92b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi lu translated">ython 3.10开始加入许多迷人的新特性。其中一个特别引起了我的注意——结构模式匹配——或者我们大多数人都知道的switch/case语句。</p><p id="95eb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">尽管Switch语句是大多数语言的共同特征，但Python中却没有。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="34ca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">早在2006年，<a class="ae mf" href="https://www.python.org/dev/peps/pep-3103/" rel="noopener ugc nofollow" target="_blank"> PEP 3103 </a>被提出，建议实现switch-case语句。然而，在PyCon 2007上的投票没有得到对该特性的支持后，Python开发者放弃了它。</p><p id="619a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">快进到2020年，Python的创造者<a class="mg mh ep" href="https://medium.com/u/1ecea0006127?source=post_page-----d0caf7b2bfd3--------------------------------" rel="noopener" target="_blank">吉多·范·罗苏姆</a>提交了第一份展示新开关语句的文档，这些语句被命名为<strong class="la iu">结构模式匹配</strong>，如<a class="ae mf" href="https://www.python.org/dev/peps/pep-0634/" rel="noopener ugc nofollow" target="_blank"> PEP 634 </a>所示。</p><p id="479c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，正如我们将很快看到的那样，我们这里所拥有的远不止一个简单的switch-case语句(因此<strong class="la iu"> match </strong> -case)。</p><p id="4b90" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们来看看这个新逻辑是如何工作的。</p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="8a5e" class="mn mo it mj b gy mp mq l mr ms"><strong class="mj iu">&gt; Structural Pattern Matching</strong><br/>  - Intro<br/>  - Another Example<br/>  - Real Use-Case With JSON</span></pre></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="a21a" class="na mo it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">结构模式匹配</h1><p id="c7e1" class="pw-post-body-paragraph ky kz it la b lb nr ju ld le ns jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">模式匹配在<code class="fe nw nx ny mj b">match</code>之后取一个值，并允许我们写出几个潜在的情况，每个情况由<code class="fe nw nx ny mj b">case</code>定义。当我们发现<code class="fe nw nx ny mj b">match</code> - <code class="fe nw nx ny mj b">case</code>匹配时，我们将执行各自的代码。</p><p id="7a21" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如:</p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="4ff1" class="mn mo it mj b gy mp mq l mr ms">http_code = "418"</span><span id="4ea8" class="mn mo it mj b gy nz mq l mr ms"><strong class="mj iu">match http_code:<br/>    case "200":</strong><br/>        print("OK")<br/>        do_something_good()<br/><strong class="mj iu">    case "404":</strong><br/>        print("Not Found")<br/>        do_something_bad()<br/><strong class="mj iu">    case "418":</strong><br/>        print("I'm a teapot")<br/>        make_coffee()<br/><strong class="mj iu">    case _:</strong><br/>        print("Code not found")</span></pre><p id="da8b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里我们检查多个条件，并根据在<code class="fe nw nx ny mj b">http_code</code>中找到的值执行不同的操作。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/cb50950cddb1a161d6c8cb7383ad24fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WF9TFCJL9Cx78kVLNQ_ffQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">通过match-case语句的逻辑流。</p></figure><p id="630f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">很明显，是的，我们可以使用大量if-elif-else语句构建相同的逻辑:</p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="57b7" class="mn mo it mj b gy mp mq l mr ms">http_code = "418"</span><span id="9531" class="mn mo it mj b gy nz mq l mr ms">if http_code == "418":<br/>    print("OK")<br/>    do_something_good()<br/>elif http_code == "404":<br/>    print("Not Found")<br/>    do_something_bad()<br/>elif http_code == "418"<br/>    print("I'm a teapot")<br/>    make_coffee()<br/>else:<br/>    print("Code not found")</span></pre><p id="58d5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，通过使用match-case语句，我们删除了重复的<code class="fe nw nx ny mj b">http_code ==</code>,当测试许多不同的条件时，它看起来更清晰。</p><h2 id="0b14" class="mn mo it bd nb ob oc dn nf od oe dp nj lh of og nl ll oh oi nn lp oj ok np ol bi translated">另一个例子</h2><p id="2ae4" class="pw-post-body-paragraph ky kz it la b lb nr ju ld le ns jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">我们可以在<a class="ae mf" href="https://www.python.org/dev/peps/pep-0635/" rel="noopener ugc nofollow" target="_blank"> PEP 635 </a>中找到一些使用match-case语句来提高代码可读性的很好的例子。其中之一就是这个例子，它向我们展示了如何使用match-case来检查我们的主题的类型和结构:</p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="0602" class="mn mo it mj b gy mp mq l mr ms">match x:<br/>    case host, port:<br/>        mode = "http"<br/>    case host, port, mode:<br/>        pass</span></pre><p id="a95e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这里，我们希望接收元组格式的连接细节，并将给定值赋给正确的变量。</p><p id="471a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这种情况下，如果连接<code class="fe nw nx ny mj b">mode</code>没有在元组中定义(例如，只提供了两个值——<code class="fe nw nx ny mj b">host</code>和<code class="fe nw nx ny mj b">port</code>),我们假设连接模式是<em class="om">“http”</em>。</p><p id="b124" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，在其他情况下，我们可能期望模式是明确定义的。因此，我们可能会收到类似于<code class="fe nw nx ny mj b">(&lt;host&gt;, &lt;port&gt;, "ftp")</code>的元组——在这种情况下，我们不希望将<code class="fe nw nx ny mj b">mode</code>设置为<em class="om">“http”</em>。</p><p id="08ff" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，如果我们想使用if-else语句编写同样的逻辑，我们会得到这样的结果:</p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="d2d6" class="mn mo it mj b gy mp mq l mr ms">if isinstance(x, tuple) and len(x) == 2:<br/>    host, port = x<br/>    mode = "http"<br/>elif isinstance(x, tuple) and len(x) == 3:<br/>    host, port, mode = x</span></pre><p id="a099" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">哪个选项更受欢迎可能会有所不同，但对我来说，匹配用例实现看起来要干净得多。</p><h2 id="1f3b" class="mn mo it bd nb ob oc dn nf od oe dp nj lh of og nl ll oh oi nn lp oj ok np ol bi translated">JSON的真实用例</h2><p id="989a" class="pw-post-body-paragraph ky kz it la b lb nr ju ld le ns jx lg lh nt lj lk ll nu ln lo lp nv lr ls lt im bi translated">另一个有趣的用例是基于字典对象的结构不同地解析它们的能力。一个很好的测试用例是解析SQuAD 2数据集。</p><p id="74bd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">SQuAD 2数据集是一组非常受欢迎的问答对，用于训练机器学习模型进行问答。我们可以通过以下方式下载数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on me l"/></div></figure><p id="60b7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们看一下班的结构，显然有几个层次，这是我们在解析时需要考虑的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/13c2d6c189cdc280babe6433924200ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rNUeAIIGP5qxuEA9d6wbeA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">班2训练集的JSON格式。</p></figure><p id="9282" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们的问题是，并非所有的样本都使用相同的字典格式。</p><p id="03d3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们查看最后几个样本，我们会看到<code class="fe nw nx ny mj b">qas</code>列表包含了<code class="fe nw nx ny mj b">answers</code>和<code class="fe nw nx ny mj b">plausible_answers</code>——而之前的样本只包含了<code class="fe nw nx ny mj b">answers</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/482e1d0fdb24a549a330c6e547da5cc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d4yd8pjOM6ZtqzwMzg0FJQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">SQuAD 2训练集JSON中的最后一个条目显示了不同的字典格式(由整个文件中的几个条目共享)。</p></figure><p id="2428" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们尝试应用新的匹配情况语句来构建一个更简洁的替代方案，以取代处理这种情况所需的繁重的<em class="om"> if-else </em>逻辑。首先，我们加载数据:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/61fd302b1cb47ff573ed7993eef04f8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yuF6KaKwpIOM5HGrgWLxzA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们使用<strong class="bd or"> json.load </strong>加载数据。</p></figure><p id="9680" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">小队JSON包含多个层。访问<code class="fe nw nx ny mj b">squad['data']</code>后，我们需要遍历每个<code class="fe nw nx ny mj b">group</code>问题，然后遍历每个<code class="fe nw nx ny mj b">paragraph</code>，然后遍历每个<code class="fe nw nx ny mj b">qas</code>(问题-答案)——如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on me l"/></div></figure><p id="940d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这就是事情变得有趣的地方。使用<code class="fe nw nx ny mj b">if-else</code>逻辑，我们得到这样的东西:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on me l"/></div></figure><p id="3a14" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不算漂亮，但很管用。现在让我们用一些<code class="fe nw nx ny mj b">match-case</code>逻辑来重写这个:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on me l"/></div></figure><p id="8f56" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它看起来肯定没那么忙了，是原始版本解析逻辑的一个很酷的替代方案。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><p id="cca2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以上是对Python 3.10中引入的新结构模式匹配的快速浏览！预计将于2021年10月初全面发布。</p><p id="26ba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就我个人而言，我认为这个新语法看起来真的很好——尽管我现在对它有一半的兴趣。一旦更多的用户开始用match-case编码，我相信社区会很快建立共识和最佳实践。</p><p id="98d1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是现在，它看起来很酷——我很兴奋！</p><p id="448d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望你喜欢这篇文章。如果你有任何问题或建议，请通过<a class="ae mf" href="https://twitter.com/jamescalam" rel="noopener ugc nofollow" target="_blank">推特</a>或在下面的评论中告诉我！如果你对更多类似的内容感兴趣，我也会在<a class="ae mf" href="https://www.youtube.com/c/jamesbriggs" rel="noopener ugc nofollow" target="_blank"> YouTube </a>上发布。</p><p id="580e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读！</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><p id="5166" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您有兴趣阅读Python 3.10的其他一些新特性，请查看我的另一篇文章，其中介绍了一些最好的特性:</p><div class="os ot gp gr ou ov"><a rel="noopener follow" target="_blank" href="/new-features-in-python-3-10-66ac05e62fc7"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd iu gy z fp pa fr fs pb fu fw is bi translated">Python 3.10中的新功能</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">看看Python最新版本中包含的最佳特性</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">towardsdatascience.com</p></div></div><div class="pe l"><div class="pf l pg ph pi pe pj ks ov"/></div></div></a></div><p id="1393" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae mf" href="https://bit.ly/nlp-transformers" rel="noopener ugc nofollow" target="_blank">🤖《变形金刚》NLP课程70%的折扣</a></p></div></div>    
</body>
</html>