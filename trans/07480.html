<html>
<head>
<title>Causal Inference for Data Scientists: Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据科学家的因果推理:第1部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/causal-inference-for-data-scientists-part-1-f97fa8614143?source=collection_archive---------14-----------------------#2021-07-08">https://towardsdatascience.com/causal-inference-for-data-scientists-part-1-f97fa8614143?source=collection_archive---------14-----------------------#2021-07-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0e3b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">你不知道你需要的技术</h2></div><blockquote class="kf kg kh"><p id="0387" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">这篇文章是两部分系列文章的第一部分，讨论了Pearlian因果推理的基本概念和数学。第2部分将关注一个使用<a class="ae lf" href="https://github.com/microsoft/dowhy" rel="noopener ugc nofollow" target="_blank"> DoWhy </a>库的实际例子。如果您喜欢先从实现开始，当第2部分可用时，跳到第2部分，然后返回这里学习理论。</p></blockquote><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/a9aad98b12dfdf3c483e2943b8bea9c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zKhsYFFaW_TJQbEC6UeRaQ.jpeg"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">因果关系:由<a class="ae lf" href="https://unsplash.com/@nadir_syzygy?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">拍摄的照片</a>在<a class="ae lf" href="https://unsplash.com/s/photos/cause-and-effect?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上</p></figure><p id="583d" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi lz translated">近年来，澳大利亚推理经历了巨大的发展。这种激增与更广泛的数据科学(DS)的兴起同时发生，但它们在实践中仍然截然不同。虽然因果推理背后的科学受益于Judea Pearl、Donald Rubin、Susan Athey和许多其他人的最新工作，但他们发现的见解还没有进入主流DS，尽管这些技术的实现很容易获得。许多DS从业者根本不知道或不在他们的工作流程中使用因果推理，这可能有几个原因…</p><ol class=""><li id="655f" class="mi mj iq kl b km kn kp kq lw mk lx ml ly mm le mn mo mp mq bi translated">进入因果推理的假设，如贝叶斯模型，可以从周日开始以六种方式进行切片、切块和辩论。(感谢我的Linkedin联系人吉诺·阿尔蒙多提供的这一见解)</li><li id="98f6" class="mi mj iq kl b km mr kp ms lw mt lx mu ly mv le mn mo mp mq bi translated">人们认为相关性是自动因果的，它们本身就足够了。在你的工作场所找找看，你会惊讶它出现的频率。</li><li id="a98b" class="mi mj iq kl b km mr kp ms lw mt lx mu ly mv le mn mo mp mq bi translated">因果推理被认为是困难的。我们不喜欢硬的。</li></ol><p id="554d" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">这些观点都有不同程度的有效性，但最终都没有抓住要点。主要的一点是，虽然存在挑战，但我们手中有一套概念和技术，如果谨慎应用，将完全改变数据科学的实践和感知方式。我们可以利用领域知识进行可靠的推理。让我们先做一些准备来开始讨论。</p><h1 id="8879" class="mw mx iq bd my mz na nb nc nd ne nf ng jw nh jx ni jz nj ka nk kc nl kd nm nn bi translated">什么是因果？</h1><p id="4b1f" class="pw-post-body-paragraph ki kj iq kl b km no jr ko kp np ju kr lw nq ku kv lx nr ky kz ly ns lc ld le ij bi translated">在本文中，我们将采用干涉主义的方法来定义因果关系。我们对什么是因果关系都有一个直观的概念，但是要用数学语言来表达，我们需要一些更正式的东西。</p><blockquote class="kf kg kh"><p id="89ae" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">定义是，对于两个不同的事件A和B，如果A的变化对应于B的变化，则A导致B，其他都相等。</p></blockquote><p id="2658" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">大多数因果推理都是为了确保“其他一切都是平等的”这一部分。还有其他类似的定义，围绕着哪一个是最正确的有激烈的争论，但我们将决定这一个，并继续进行。</p><h1 id="00bd" class="mw mx iq bd my mz na nb nc nd ne nf ng jw nh jx ni jz nj ka nk kc nl kd nm nn bi translated">我们如何建立因果关系？</h1><p id="cfe8" class="pw-post-body-paragraph ki kj iq kl b km no jr ko kp np ju kr lw nq ku kv lx nr ky kz ly ns lc ld le ij bi translated">在近代因果复兴发生之前，建立因果联系的黄金标准是随机实验。<strong class="kl ir"> </strong>在很多方面他们仍然是。因此，让我们在随机实验的背景下讨论因果关系。</p><p id="7c8e" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">我们有一个我们想要测量的结果，名为y。我们想看看操纵特定的治疗X是否会引起y的明显变化。在随机试验中，如药物试验，我们将从更广泛的人群中随机获得足够大的人的样本(使用功效分析)<strong class="kl ir"/>。参与者将被随机分配药物或安慰剂。然后，我们将测量安慰剂组和药物组的差异，这被称为<strong class="kl ir">治疗效果，</strong>可以通过多种方式完成(参见cohen的d或CATE)。任何效应大小将仅来自治疗，而不是由于可能存在的任何其他因素或<strong class="kl ir">混杂因素</strong>。</p><h2 id="9b9d" class="nt mx iq bd my nu nv dn nc nw nx dp ng lw ny nz ni lx oa ob nk ly oc od nm oe bi translated">随机分配确保“所有其他条件相同”在总体上是正确的。</h2><h1 id="2526" class="mw mx iq bd my mz na nb nc nd ne nf ng jw nh jx ni jz nj ka nk kc nl kd nm nn bi translated">真实的世界</h1><p id="c960" class="pw-post-body-paragraph ki kj iq kl b km no jr ko kp np ju kr lw nq ku kv lx nr ky kz ly ns lc ld le ij bi translated">现在我们来看因果推理中面临的主要障碍。我们并不总是有时间和金钱去做随机实验来建立因果联系。即使我们这样做，也可能不符合道德。我们最终可能只有一组观察数据，以及我们从观察中建立起来的一些假设。我们能用非随机化的数据来检验它们吗？答案是肯定的，这就是我们的新工具包发挥作用的地方。我们将使用的技术将获取我们的<strong class="kl ir">观察</strong>数据集，并将其转换为所谓的<strong class="kl ir">介入</strong>数据集，从中我们可以得出因果推论。这里的关键是数据本身不足以建立因果关系(见<a class="ae lf" href="https://en.wikipedia.org/wiki/Simpson%27s_paradox" rel="noopener ugc nofollow" target="_blank">辛普森悖论</a>)。我们需要更多有力的理由。</p><p id="afc3" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">鉴于数据还不够，我们将绘制一幅世界的文字图，称为因果图，它编码了我们关于数据生成过程的<em class="kk">假设</em>。<strong class="kl ir">数据生成过程</strong>是我们试图了解其动态的系统。这将有助于我们构建我们的介入分布，并检验我们的模型是否有效。</p><p id="c684" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">我们在模仿科学过程。我们从一个假设开始，然后我们用因果图来模拟世界在这个假设下的行为。最后，我们用数据来检验我们的模型，这可能支持或不支持假设。此外，我们进一步测试模型，看看它对变化、未说明的混杂因素和其他问题有多敏感。重复直到你的理论符合事实。</p><h1 id="b68b" class="mw mx iq bd my mz na nb nc nd ne nf ng jw nh jx ni jz nj ka nk kc nl kd nm nn bi translated">更深入</h1><p id="b33e" class="pw-post-body-paragraph ki kj iq kl b km no jr ko kp np ju kr lw nq ku kv lx nr ky kz ly ns lc ld le ij bi translated">让我们定义几个术语…</p><p id="cff7" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated"><strong class="kl ir">干预:</strong>主动做X导致y的变化。</p><blockquote class="kf kg kh"><p id="4667" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">例子:如果我推我的朋克兄弟，他会生气吗？如果我给一个人用药，会让他们好起来吗？</p></blockquote><p id="395b" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated"><strong class="kl ir">反事实:</strong>如果我没有做X，Y还会发生吗？</p><blockquote class="kf kg kh"><p id="c614" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">例子:如果我没有推我的朋克兄弟，他会摔倒吗？如果没有给病人用药，他们会好转吗？</p></blockquote><p id="4b55" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">干预和反事实的推理反映了人类理解因果关系的正常方式。我们正在创造两个不同的世界，并比较两个世界的结果。如果我们有一个干预的案例，和它的反事实，我们可以建立因果关系。在一个随机实验中，我们在群体水平上已经有了这两个现成的例子。当分析的层次改变到个人时，我们就意识到我们试图解决的一个最基本的问题。我们发现我们有一个<strong class="kl ir">缺失数据</strong>的问题。我们手头没有反事实，因为个人的反事实并不存在。你不能同时接受治疗和未治疗。双胞胎研究接近了。幸运的是，我们有办法估计这种反事实，同时控制一切可能混淆我们分析的东西。请记住，我们试图保持所有其他平等，这就是为什么我们需要一个反事实。让我们深入数学来更好地理解发生了什么。</p><h1 id="d3b7" class="mw mx iq bd my mz na nb nc nd ne nf ng jw nh jx ni jz nj ka nk kc nl kd nm nn bi translated">派生</h1><p id="f3ff" class="pw-post-body-paragraph ki kj iq kl b km no jr ko kp np ju kr lw nq ku kv lx nr ky kz ly ns lc ld le ij bi translated">当我们获得观察数据时，无论数据是离散的还是连续的，我们得到的都是概率分布。两种主要类型是联合概率和条件概率。任何上过基础概率课程的人都会涉及到这些话题，但它们为我们构建因果公式提供了基础。下面是两个数据分布。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi of"><img src="../Images/14f59eacdad599e3e4df183c333a3b01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SZfjiY5ZhCcNCAtVVXo6GA.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">观察和干预图</p></figure><p id="d068" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">在左边，我们看到了观察模型，它显示了原始数据中变量之间的相互关系。根据我们对因果关系的定义，我们需要独立于其他因素，估计改变X对Y的影响。对于我们观察到的数据，我们无法使X的变化不对应于Z的变化，因此X的变化不表示y的因果变化。我们需要一种方法来理清Z对X的混淆效应，例如P(X|Z) = P(X)，或者换句话说，我们需要操纵观察到的数据以使两个变量独立。我们需要做图形手术。</p><p id="6530" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">右图显示了我们想要的状态，即手术后的状态。z和X不相连，因此其中一个的变化不会影响另一个。这被称为<strong class="kl ir">d-分离</strong>。而且由于X仍然在Y的上游，所以X的任何变化都会导致Y的因果变化，不管X是自发变化还是直接调整。</p><h2 id="b85a" class="nt mx iq bd my nu nv dn nc nw nx dp ng lw ny nz ni lx oa ob nk ly oc od nm oe bi translated">假设</h2><p id="961a" class="pw-post-body-paragraph ki kj iq kl b km no jr ko kp np ju kr lw nq ku kv lx nr ky kz ly ns lc ld le ij bi translated">现在我们继续推导，允许我们将我们的观察数据分布转换成我们的干预数据分布。我们从两者之间的三个联系开始推导。我们用p表示我们的观察数据分布，用Pₘ表示被操纵的干预数据分布。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi og"><img src="../Images/da96b96d32aab9338505d08ba3a27d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:494/format:webp/1*m2Lp20A16cRxZlz2QVrwBA.png"/></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">链接1</p></figure><p id="e95a" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">因为Y的引入效应在两个图之间保持不变，所以概率分布也是相同的。这是我们的第一个不变性链接。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/117da54a2f8f7fdd20f2c637fab3cb79.png" data-original-src="https://miro.medium.com/v2/resize:fit:322/format:webp/1*NFrLiAWu2q1CxfKMSZGFZQ.png"/></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">链接2</p></figure><p id="fa48" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">确定Z的过程不会因为去掉Z和x之间的联系而改变，这是我们的第二个不变性环节。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/727a00c8085da9579ae4cab8bf4afdf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/format:webp/1*uypl_7AotVhiiwG7I8EuVg.png"/></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">链接3</p></figure><p id="b4d0" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">在被操纵的模型中，Z和X是d分隔的，因此是独立的(在后一个模型中，关于Z的信息并不能告诉我们关于X的任何信息)。根据链接3，我们可以更进一步得到P(Z)。</p><p id="5f12" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">考虑到这些联系，我们从右边的因果图开始，定义我们的<strong class="kl ir"> do操作符</strong>。我们想知道，给定我干预X，用do(X)表示，Y的概率是多少。由此可见…</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi og"><img src="../Images/cf69ff90b21292a40fb34b53548cd42d.png" data-original-src="https://miro.medium.com/v2/resize:fit:494/format:webp/1*7GxKMq0NWEhzBwpdzBVj8g.png"/></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">(根据定义)</p></figure><p id="827a" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">接下来，我们扩展等式的右边来考虑Z</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/76ca72ba1a922691e75048ec158dc5ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:564/format:webp/1*hyw1iRPQb3IQBLN3XVft1w.png"/></div></figure><p id="02b6" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">根据全概率的<a class="ae lf" href="https://en.wikipedia.org/wiki/Law_of_total_probability" rel="noopener ugc nofollow" target="_blank">定律，我们在z上取P(Y|X)的加权平均值。这是我们控制z的影响的方法。这与控制混杂因素的逆概率加权和倾向评分加权技术相同。亚当·凯莱赫有一篇很棒的文章展示了等价性</a><a class="ae lf" href="https://medium.com/@akelleh/introducing-the-do-sampler-for-causal-inference-a3296ea9e78d" rel="noopener">在这里</a>，所以如果你有兴趣深入了解，一定要去看看。</p><p id="a891" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">接下来，我们使用Z和X的d分离原理来获得</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/6fda5e41ac6a71a3e94ecac8163acb2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/format:webp/1*oQ-MWdb5acTFyPBHl5dGlA.png"/></div></figure><p id="a785" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">最后，我们调用操纵分布和观测分布之间的不变性链接来得到</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/72edbe1a9a4092d696a730e952beb99a.png" data-original-src="https://miro.medium.com/v2/resize:fit:448/format:webp/1*Ws-MJXq6EnxE3UOXxmxUMA.png"/></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">调整公式</p></figure><p id="5be2" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">使用最后一个表达式，称为<strong class="kl ir">调整公式</strong>，我们现在已经定义了如何从干预前的观察数据中生成我们的干预分布P(Y|do(X))。这是对介入分布的广义定义，适用于连续和离散病例。</p><p id="ce87" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">对于我们的药物试验示例，它是一个离散的二元结果，使用我们导出的因果表达式来估计治疗效果，我们可以将平均治疗效果(ATE)定义为</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi om"><img src="../Images/60444f262c23c8870790728cf245a6d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*gQ_EYHQfCEYtLmkNabZj0Q.png"/></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">随机试验</p></figure><p id="4c48" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">因此，我们使用随机试验获得了与控制所有相关混杂因素(上面用Z表示)相同的结果。</p><p id="3a7b" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">顶部的第一项是观察到的治疗效果概率，第二项是反事实概率。假设Z代表Y和X的所有混杂因素，它们的差异确定了治疗X对结果Y的因果影响。请注意，Z本身可以是连续的或离散的，这并不重要。配方中有一个漂亮的灵活性。</p><h1 id="e1f8" class="mw mx iq bd my mz na nb nc nd ne nf ng jw nh jx ni jz nj ka nk kc nl kd nm nn bi translated">最终事项</h1><p id="703b" class="pw-post-body-paragraph ki kj iq kl b km no jr ko kp np ju kr lw nq ku kv lx nr ky kz ly ns lc ld le ij bi translated">这些是珀尔因果推理的基础。关于因果关系的其他讨论，请阅读<a class="ae lf" href="https://en.wikipedia.org/wiki/Rubin_causal_model" rel="noopener ugc nofollow" target="_blank">鲁宾的潜在结果框架</a>。如果你喜欢天才科学家之间的辩论，<a class="ae lf" href="https://statmodeling.stat.columbia.edu/2009/07/05/disputes_about/" rel="noopener ugc nofollow" target="_blank">这个</a>资源会让你开心。关于使用随机森林对高维数据集进行因果推理的应用，请参见<a class="ae lf" href="https://www.gsb.stanford.edu/faculty-research/faculty/susan-athey" rel="noopener ugc nofollow" target="_blank">苏珊·艾希的</a>最新作品<a class="ae lf" href="https://arxiv.org/pdf/1510.04342.pdf" rel="noopener ugc nofollow" target="_blank">这里</a>。Amit Sharma和Emre Kiciman的一本很棒的介绍书<strong class="kl ir">可以在这里找到<a class="ae lf" href="https://causalinference.gitlab.io/book/" rel="noopener ugc nofollow" target="_blank">。最后，仔细阅读后门标准，这是因果推理的下一个重要步骤，可以在这里阅读</a><a class="ae lf" href="http://bayes.cs.ucla.edu/BOOK-2K/ch3-3.pdf" rel="noopener ugc nofollow" target="_blank"/>。</strong></p><p id="4a0f" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">我们只是触及了将科学融入数据科学的强大概念的表面。我希望这有助于在实施之前建立理论。我也希望它引发了你的好奇心，让你想了解更多，并开始在工作中应用这些原则。本系列的第2部分将使用DoWhy软件包实际应用Pearlian do微积分解决医疗保健领域的一个因果问题。</p><p id="3b91" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lw kt ku kv lx kx ky kz ly lb lc ld le ij bi translated">敬请期待！感谢你的时间，上帝保佑你。</p></div></div>    
</body>
</html>