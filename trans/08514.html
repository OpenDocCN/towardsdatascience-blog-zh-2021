<html>
<head>
<title>How to Create a Photo Mosaic in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中创建照片马赛克</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-a-photo-mosaic-in-python-45c94f6e8308?source=collection_archive---------3-----------------------#2021-08-06">https://towardsdatascience.com/how-to-create-a-photo-mosaic-in-python-45c94f6e8308?source=collection_archive---------3-----------------------#2021-08-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ff4f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Python中照片马赛克的内幕</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/58ded2967c127abdd0483e1a5ccac7b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1uzNKl9Hj2UQQ9lZhFNNkQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由来自<a class="ae ky" href="https://www.pexels.com/photo/person-holding-yellow-black-eyed-susan-flowers-in-bloom-1697912/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae ky" href="https://www.pexels.com/@javon-swaby-197616?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Javon Swaby </a>拍摄的照片拼接而成</p></figure><p id="0a21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然许多在线网站可以生成照片马赛克，但在本文中，我们将深入了解照片马赛克，并创建一个可以创建照片马赛克的Python脚本。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0410" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">什么是照片马赛克？</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/c362423c1e88276703559050269733b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dcU1b6o8SXbMk4be"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Raimond Klavins 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="bb6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">马赛克是一种用灰泥固定的彩色小块组成的图案。它们通常被用作墙壁或地板上的装饰。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/ec4eeeec00c2845c731bd84e4c351433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*UiKluoXXY1blrzc6"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一张<a class="ae ky" href="https://commons.wikimedia.org/wiki/File:Franz_Marc_Blaues_Pferd_1911.jpg" rel="noopener ugc nofollow" target="_blank">蓝马I </a>的照片马赛克</p></figure><p id="b9de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，<strong class="lb iu">照片拼接</strong>是由较小的照片拼接而成的照片。</p><h1 id="b73c" class="mc md it bd me mf mw mh mi mj mx ml mm jz my ka mo kc mz kd mq kf na kg ms mt bi translated">它是如何工作的？</h1><p id="e8a0" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">要创建一个照片拼版，我们需要主照片和一系列平铺照片。为了获得更好的效果，拼贴照片应该具有不同的颜色和亮度级别。</p><p id="99fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，程序如下:</p><ol class=""><li id="d88b" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">像素化主照片。</li><li id="c859" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">将每个像素替换为颜色最接近的图块照片。</li></ol><p id="c64d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">听起来很简单，对吧？嗯，我们应该做更多的事情。但是我们将在下一节中讨论这个问题。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e099" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置</h1><p id="b117" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我们将把所有磁贴照片放在一个名为<code class="fe nu nv nw nx b">tiles</code>的文件夹中。</p><p id="be8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要导入一些模块。我们稍后会用到它们，并解释它们是做什么的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="2604" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们需要定义磁贴和主照片的路径，以及磁贴的大小。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><h1 id="eef5" class="mc md it bd me mf mw mh mi mj mx ml mm jz my ka mo kc mz kd mq kf na kg ms mt bi translated">导入照片</h1><p id="fc16" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">为了获取<code class="fe nu nv nw nx b">tiles</code>文件夹中的所有文件，我们将使用<strong class="lb iu"> glob </strong>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="805e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用<strong class="lb iu"> Pillow (PIL)的图像类</strong>导入图块并调整它们的大小。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><h1 id="d498" class="mc md it bd me mf mw mh mi mj mx ml mm jz my ka mo kc mz kd mq kf na kg ms mt bi translated">计算平均颜色</h1><p id="5d75" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">然后，我们计算每个瓷砖的平均颜色，并将其保存在一个数组中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="62df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了像素化主照片，我们将使用<strong class="lb iu"> Pillow的调整大小方法</strong>缩小它。我们将调整它的大小，以便调整后的照片中的每个像素都与原始照片中的图块大小完全相同。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><h1 id="158c" class="mc md it bd me mf mw mh mi mj mx ml mm jz my ka mo kc mz kd mq kf na kg ms mt bi translated">最接近的颜色？</h1><p id="8ac8" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">现在，我们需要为调整后的照片中的每个像素找到平均颜色最接近的图块。</p><p id="71ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们不会担心“接近”的数学定义以及什么是标准距离或T2距离。但是如果你感兴趣，颜色是3D矢量(RGB而不是XYZ)，所以它与3D空间中两点之间的距离相同。其可以被定义如下(欧几里德距离):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/f8e42bf4c5b055ab2abd408921c6748f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/0*aeurznimypsIodCu.png"/></div></figure><p id="de9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了有效地做到这一点，我们将使用一个<a class="ae ky" href="https://www.wikiwand.com/en/K-d_tree" rel="noopener ugc nofollow" target="_blank"> k-d树</a>(不需要理解它是如何工作的)，它是在<strong class="lb iu"> scipy的空间模块</strong>中实现的。</p><p id="8919" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们必须从我们的平均颜色列表中创建一个KDTree，然后使用<strong class="lb iu">查询</strong>方法进行搜索。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><h1 id="acd9" class="mc md it bd me mf mw mh mi mj mx ml mm jz my ka mo kc mz kd mq kf na kg ms mt bi translated">画瓷砖</h1><p id="f858" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">现在，我们只需将图块绘制成输出照片。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><h1 id="5776" class="mc md it bd me mf mw mh mi mj mx ml mm jz my ka mo kc mz kd mq kf na kg ms mt bi translated">结果</h1><div class="kj kk kl km gt ab cb"><figure class="ob kn oc od oe of og paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/5c4c08f4c1dc3dafdfd21b506cd5298d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*MKE4QgF0BdA6fPM_mx6bpg.jpeg"/></div></figure><figure class="ob kn oc od oe of og paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/db097cb2f22e6f49686e835fd7040b3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*8b1yTButSwhEu4OIFbUvrg.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk oh di oi oj translated">来自<a class="ae ky" href="https://www.pexels.com/photo/photo-of-stream-during-daytime-3225517/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">像素</a>的<a class="ae ky" href="https://www.pexels.com/@michael-block-1691617?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">迈克尔·布洛克</a>的原始照片(左)，照片拼接(右)(所有照片来自<a class="ae ky" href="http://www.pexels.com" rel="noopener ugc nofollow" target="_blank">像素</a>)</p></figure></div><p id="8038" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过改变设置来获得不同的结果。</p><div class="kj kk kl km gt ab cb"><figure class="ob kn oc od oe of og paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/fa7668ec79a758eaee320db95683ba2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*SZYPkAQ4VdofIQoiE9GYEg.jpeg"/></div></figure><figure class="ob kn oc od oe of og paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/ddddaa142d4edcfba62916692322e30c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*lrTBIzATD4_ZUMIJtfhBFA.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk oh di oi oj translated">平铺尺寸25×25(左)平铺尺寸50×50(右)(所有照片来自<a class="ae ky" href="http://www.pexels.com" rel="noopener ugc nofollow" target="_blank">像素</a>)</p></figure></div><h1 id="9f63" class="mc md it bd me mf mw mh mi mj mx ml mm jz my ka mo kc mz kd mq kf na kg ms mt bi translated">命令行界面</h1><p id="e707" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我们可以让我们的脚本直接从终端运行。我们将使用以下语法:</p><pre class="kj kk kl km gt ok nx ol om aw on bi"><span id="3c89" class="oo md it nx b gy op oq l or os">python3 mosaic.py main_photo_path tiles_path tile_width tile_height output_path</span></pre><p id="7913" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们必须将源代码和设置代码部分替换为:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="4e7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终的脚本变成了:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="0690" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经看到了如何用Python创建一个简单的照片马赛克。虽然它如预期的那样完美地工作，但我们可以通过在可能的情况下支持使用不同的磁贴照片，或者通过允许亮度/饱和度调整来改进它。</p></div></div>    
</body>
</html>