<html>
<head>
<title>Data Anonymization ETL on Azure using Presidio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Presidio的Azure数据匿名化ETL</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-anonymization-etl-on-azure-using-presidio-55323eba60e9?source=collection_archive---------19-----------------------#2021-04-21">https://towardsdatascience.com/data-anonymization-etl-on-azure-using-presidio-55323eba60e9?source=collection_archive---------19-----------------------#2021-04-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="59e2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">创建数据管道以从文本中移除私有数据</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/82653c04e90c8828834e4bb75b99460c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JSkpuVxemJnMjiOq"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">马库斯·斯皮斯克在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="ccc1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据匿名化或去标识化是某些系统的关键部分，也是许多组织的核心要求。通过用文本和图像中的模仿实体来屏蔽、散列甚至替换PII实体的能力所揭示的场景包括将数据移动到云或合作伙伴，从真实数据生成测试数据，存储数据以供AI/ML处理等。</p><p id="39af" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的文章演示了如何使用Azure和<a class="ae kv" href="https://github.com/microsoft/presidio" rel="noopener ugc nofollow" target="_blank"> Presidio </a>创建一个全功能的<a class="ae kv" href="https://en.wikipedia.org/wiki/Extract,_transform,_load" rel="noopener ugc nofollow" target="_blank"> ETL </a>流程，将一组文档从一个位置移动到另一个位置，同时对文本中的PII实体进行清理、替换、散列或加密。</p><h1 id="55b9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">普雷西迪奥和生态系统</h1><p id="5d20" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">一些读者可能已经知道了<a class="ae kv" href="https://github.com/microsoft/presidio" rel="noopener ugc nofollow" target="_blank"> Presidio </a>，这是一个PII身份识别和匿名库，由<a class="ae kv" href="https://devblogs.microsoft.com/cse/btc/" rel="noopener ugc nofollow" target="_blank">商业软件工程</a>小组作为微软开源项目维护。该团队最近发布了一个新版本V2.0，主要目标是简化Presidio的评估并支持集成到数据管道中。</p><p id="c07e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为V2.0版本的一部分，Presidio团队提供了不同的部署<a class="ae kv" href="https://github.com/microsoft/presidio/tree/main/docs/samples" rel="noopener ugc nofollow" target="_blank">示例</a>，如Kubernetes(presi dio V1本地且唯一的部署选项)、Azure App Service(该团队将其用于内部V2.0开发和生产环境)等。</p><p id="fb49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这篇文章将关注如何使用内置的“Presidio数据匿名化”模板将Presidio与Azure数据工厂集成，该模板是该团队与Azure数据工厂产品组合作开发的。它是为那些已经拥有Azure Data Factory实例和存储帐户的数据工程师准备的，他们希望匿名化PII数据的内容。</p><p id="02e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，Presidio生态系统包括<a class="ae kv" href="https://github.com/microsoft/presidio-research" rel="noopener ugc nofollow" target="_blank"> presidio-research </a>存储库，团队在其中维护使用presidio的高级场景。例如，presidio_evaluator库使用presidio在分析真实数据的基础上<a class="ae kv" href="https://github.com/microsoft/presidio-research/tree/master/presidio_evaluator/data_generator" rel="noopener ugc nofollow" target="_blank">生成假数据</a>。</p><h1 id="0dc5" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">Azure ETL的构建块</h1><p id="9dc0" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这篇文章中涉及的场景采用了一个通用类型的输入数据集，一个Azure存储blob容器，并使用Azure服务将该数据集移动到另一个位置，在那里文件的内容已经对所有PII实体进行了匿名化。</p><p id="92ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用的Azure服务有:</p><p id="b77e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://docs.microsoft.com/en-us/azure/data-factory/" rel="noopener ugc nofollow" target="_blank">Azure Data Factory</a>——一个基于云的ETL服务，它将托管转换管道。</p><p id="0f01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://docs.microsoft.com/en-us/azure/storage/" rel="noopener ugc nofollow" target="_blank"> Azure Storage </a> —提供ETL持久层。</p><p id="5c95" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://docs.microsoft.com/en-us/azure/key-vault/general/" rel="noopener ugc nofollow" target="_blank"> Azure Key-Vault </a> —以安全的方式存储Azure存储访问密钥，以便在ETL中使用。</p><p id="b9df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://docs.microsoft.com/en-us/azure/app-service/" rel="noopener ugc nofollow" target="_blank"> Azure App Service </a> —托管Presidio作为HTTP REST端点。</p><p id="c2e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下图显示了使用Presidio作为HTTP端点的ETL系统各部分之间的关系。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/badaa733fb39d396a49b49df3fd039ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/format:webp/1*FIuvsbG3yB40jVrM3oPfvg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">以Presidio为HTTP端点的数据匿名化ETL</p></figure><p id="013b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">1.从源读取数据集。</p><p id="2e8f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.从Azure Key Vault获取Azure存储的访问密钥。</p><p id="0869" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">3.将集合中每个文档的文本值发送给Presidio进行匿名处理。</p><p id="3dba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">4.将匿名文本保存到Azure Blob存储上随机命名的文本文件中。</p><p id="8456" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据匿名化管道的输入是一组包含PII文本的文档，例如:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/faa443bcacea521bd8c425dda7c6a46b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JHO-IpifcK6UQ7zExRJwMA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">文本输入文件</p></figure><p id="61c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">管道的输出文件应该如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/03476bd84185b3dc8b5c69beba6a7b01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PXeHx9aDsNQsvIbyy9SqCA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">文本输出文件</p></figure><h1 id="d58c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">提供Azure服务</h1><p id="1a35" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果你已经有一个Azure数据工厂实例，从<a class="ae kv" href="https://ms-adf.azure.com/" rel="noopener ugc nofollow" target="_blank"> Azure数据工厂UI </a>浏览到模板库，搜索名为“使用Presidio的数据匿名化”的模板。按照屏幕上的说明配置先决条件基础架构，并连接您的Azure存储输入容器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/e1db1584878588c2bb3eba3c64755af1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6iOgE_rZIbmE9WSsjnP_Sw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用预签名模板的数据匿名化</p></figure><p id="89cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您没有Azure数据工厂的实例，您可以继续使用Presidio <a class="ae kv" href="https://github.com/microsoft/presidio/blob/main/docs/samples/deployments/data-factory/presidio-data-factory.md" rel="noopener ugc nofollow" target="_blank">端到端</a>示例，展示Presidio到数据工厂的两种集成模式(作为HTTP端点和作为Databricks Spark作业)。这些示例还将提供Azure数据工厂并设置所需的管道，而不使用带有Presidio模板的数据匿名化。</p><h1 id="518a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">运行样本</h1><p id="9d37" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">从<a class="ae kv" href="https://ms-adf.azure.com/" rel="noopener ugc nofollow" target="_blank"> Azure数据工厂UI </a>打开名为Anonymize的管道。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/8c774165be267a08faea3e72ae55f60c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_23KqwNCllcsWo35AuC6Lw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">匿名化管道活动</p></figure><h2 id="feba" class="mu lt iq bd lu mv mw dn ly mx my dp mc lf mz na me lj nb nc mg ln nd ne mi nf bi translated">使用Presidio模板库进行数据匿名化</h2><ul class=""><li id="9c3c" class="ng nh iq ky b kz mk lc ml lf ni lj nj ln nk lr nl nm nn no bi translated"><strong class="ky ir">获取文件列表</strong> —从源容器中获取文件列表。</li><li id="93a1" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><strong class="ky ir"> FilterFiles </strong> —从列表中过滤目录，只处理文件。</li><li id="8b45" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><strong class="ky ir">foreach file</strong>—For-Each循环，包括数组中每个文档的执行子句。</li><li id="900d" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><strong class="ky ir"> GetSASToken </strong> —从Azure Key Vault获取SAS令牌。将在以后用于写入blob容器。</li><li id="5600" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><strong class="ky ir"> LoadFileContent — </strong>将文本文件的内容加载到数据集中。</li><li id="4b19" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><strong class="ky ir"> PresidioAnalyze </strong> —将文本发送到Presidio analyzer端点。</li><li id="91f6" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><strong class="ky ir">Presidio匿名化</strong> —将来自presidio分析器的响应发送到presi dio匿名化器端点。</li><li id="3865" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><strong class="ky ir"> UploadBlob </strong> —将来自Presidio的匿名响应保存到目标Azure Blob存储上的文本文件中。</li></ul><p id="24bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击调试按钮，并填写以下管道参数:</p><ul class=""><li id="6a08" class="ng nh iq ky b kz la lc ld lf nu lj nv ln nw lr nl nm nn no bi translated"><strong class="ky ir"> SourceStore_Location — </strong>源容器名称。</li><li id="0b30" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><strong class="ky ir">目标存储名称— </strong>目标帐户名称。</li><li id="0b61" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><strong class="ky ir">目标存储位置— </strong>目标容器名称。具有在提供ARM模板(presidio)期间创建的容器的默认值。</li><li id="6122" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><strong class="ky ir">密钥库名称— </strong> Azure密钥库名称。</li><li id="1419" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><strong class="ky ir"> Analyzer_Url — </strong> Analyzer应用程序服务Url。</li><li id="2b54" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><strong class="ky ir">匿名器_Url — </strong>匿名器应用服务Url。</li></ul><p id="e141" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随着管道的运行，您应该会看到在目标blob容器上创建的文件，其中的数据是匿名的PII内容。</p><h1 id="8f8a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="b7cf" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Presidio V2.0带来了巨大的变化，并为Presidio社区带来了比以前更多的利用平台的机会。</p><p id="db40" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文中详细描述的示例可以很容易地修改，以适应其他ETL场景，例如:</p><ul class=""><li id="8f76" class="ng nh iq ky b kz la lc ld lf nu lj nv ln nw lr nl nm nn no bi translated"><strong class="ky ir">更改匿名化方法</strong> —您可以将本示例中使用的匿名化机制从简单的替换实现更改为任何受支持的<a class="ae kv" href="https://github.com/microsoft/presidio/tree/main/presidio-anonymizer#anonymizer" rel="noopener ugc nofollow" target="_blank">匿名器</a>，作为所有实体类型或特定实体类型的默认匿名器。您也可以加密PII数据，并在以后使用解密重新打开它。</li><li id="7b14" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><strong class="ky ir">其他输入/输出</strong> —从MongoDB、Elasticsearch或其他来源读取JSON数组，并将清理后的数据移动到另一个实例。</li><li id="1872" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><strong class="ky ir">混合工作流</strong> —使用混合Azure数据工厂工作负载的<a class="ae kv" href="https://github.com/Azure/Azure-DataFactory/tree/main/SamplesV1/HybridPipelineWithOnPremisesHortonworksHadoop" rel="noopener ugc nofollow" target="_blank">预览和本地Hortonworks Hadoop集群，在数据离开组织场所之前对其进行匿名处理。</a></li><li id="2713" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><strong class="ky ir">流数据</strong> —更改笔记本以使用Spark-streaming来实现仅分析管道，该管道在传输中的消息从一个事件源传输到另一个事件源时对其执行。</li></ul><p id="94c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们邀请您加入不断发展的Presidio社区，贡献示例、文档、错误修复或问题，或者直接联系presidio@microsoft.com的团队。如果您有任何问题，或者想和我们谈谈您使用Presidio的大规模场景，我们非常乐意！</p></div></div>    
</body>
</html>