<html>
<head>
<title>Exploratory Data Analysis on DeFi Lending users Health</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DeFi贷款用户健康的探索性数据分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/exploratory-data-analysis-on-defi-lending-users-health-d8f8ff7cabbc?source=collection_archive---------38-----------------------#2021-03-22">https://towardsdatascience.com/exploratory-data-analysis-on-defi-lending-users-health-d8f8ff7cabbc?source=collection_archive---------38-----------------------#2021-03-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7ad3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Graph协议中的数据分析Aave和Compound用户的健康状况</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/657ebfdbddf549f30fac4b45ee9ba5d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*scdWThyTAuZqdwQ3"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">杰瑞米·多洛在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="9639" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">免责声明:本帖内容纯属信息性，不能视为投资建议。分析的数据可能包含错误</em></p><h1 id="cc74" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">介绍</h1><p id="5018" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在这篇文章中，我将围绕两个最著名的DeFi借贷协议的用户健康进行探索性的数据分析。如果你不熟悉用户的健康状况以及这个指标对避免清算的重要性，我写了<a class="ae ky" href="https://medium.com/coinmonks/creating-a-liquidation-script-for-aave-defi-protocol-ef584ad87e8f" rel="noopener">这篇文章</a>用一个在Aave上清算的例子来解释它。</p><h1 id="cccf" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">获取数据</h1><p id="b351" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">为了获取数据，我将使用我最喜欢的协议之一，Graph。在<a class="ae ky" href="https://medium.com/coinmonks/defi-protocol-data-how-to-query-618c934dbbe2" rel="noopener">上一篇文章</a>中，我解释了如何使用它们的子图获取数据。对于复合协议，所有数据直接来自子图，对于Aave，需要使用<a class="ae ky" href="https://github.com/aave/aave-js" rel="noopener ugc nofollow" target="_blank"> aavejs </a>库来转换一些数据。</p><p id="7709" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将成为数据集一部分的字段如下</p><ul class=""><li id="8a0c" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated"><strong class="lb iu">健康度</strong>:用户健康度，以总ETH抵押存款与总ETH借款之差计算，健康度值小于1时允许清算用户抵押。</li><li id="873e" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><strong class="lb iu">协议</strong>:用户已投资的协议。</li><li id="2f79" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><strong class="lb iu"> totalBorrowETH: </strong>用户借入的ETH总额，以ETH价格借入的所有资产的总和。</li><li id="618d" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><strong class="lb iu">Total deposites:</strong>用户存入的ETH总额，以ETH价格借入的所有资产的总和。</li><li id="72ff" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><strong class="lb iu"> assetsBorrowedCount: </strong>用户借入的资产数量。</li><li id="55fa" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><strong class="lb iu">assets depositedcount:</strong>用户存放的资产数量。</li><li id="0fa7" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><strong class="lb iu"> stableBorrowedCount: </strong>本金为稳定硬币的借款总额。</li><li id="cf34" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><strong class="lb iu"> stableDepositedCount: </strong>抵押品为稳定币的存款总额。</li><li id="0444" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><strong class="lb iu">count liked</strong>:用户被清算的次数。</li></ul><p id="9a0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择的用户应该是那些当前有多个有效借出的用户。</p><p id="6ca5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建数据集后，我们可以通过运行。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="d2a6" class="nm lx it ni b gy nn no l np nq">df_users.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/79a445d805be2eb543174abc995c8d60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sVE17qL0HqeJ3NpUfzpe5g.png"/></div></div></figure><h1 id="a756" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">清理数据</h1><p id="31e7" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">第一部分是清理数据和检测异常值，以查看健康数据是如何分布的。首先，我们可以运行</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="ecfa" class="nm lx it ni b gy nn no l np nq">df_users.health.describe()</span></pre><p id="6b61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将为健康变量返回以下值</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/435cd95207a44c6e76b45eb1d82dd80a.png" data-original-src="https://miro.medium.com/v2/resize:fit:562/format:webp/1*1asdbudz09BgrIVaGJzzFQ.png"/></div></figure><p id="59c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们所看到的，有一个最小值-1，这个值对于health变量是不可能的，所以我们要删除它，为此，我们可以运行</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="a0f4" class="nm lx it ni b gy nn no l np nq">df_users.drop(df_users[df_users['health']&lt;0].index, inplace=True)</span></pre><p id="b4f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">再次运行相同的命令，我们可以看到这个值不再是数据的一部分</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/25ca165f266d531b7dbe7630988cf9b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:572/format:webp/1*m6bzn_dfHJr8BbXMWMnABA.png"/></div></figure><p id="5d82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将检查数据集的大小，以及有多少用户从Aave借钱，有多少用户从compound借钱，我们可以用下面的代码来查看</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="52b1" class="nm lx it ni b gy nn no l np nq">aave_borrowers = df_users[df_users.protocol=='AAVE'].shape[0]<br/>compound_borrowers = df_users[df_users.protocol=='COMPOUND'].shape[0]<br/>user_size = df_users.shape[0]</span><span id="2227" class="nm lx it ni b gy nu no l np nq">print("Total users in the dataset {}".format(user_size))<br/>print("Number of Aave borrowers {}".format(aave_borrowers))<br/>print("Number of Compound borrowers {}".format(compound_borrowers))</span></pre><p id="bf01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果是</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="87a9" class="nm lx it ni b gy nn no l np nq">Total users in the dataset 8615<br/>Number of Aave borrowers 1145<br/>Number of Compound borrowers 7470</span></pre><h1 id="d474" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">检测异常值</h1><p id="7832" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">要查看用户的健康状况是分布的，我们可以使用箱线图来检测数据中的异常值，运行</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="256f" class="nm lx it ni b gy nn no l np nq">sns.boxplot(x=df_users['health'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/e5d012f4a3d1f48121c5a4fc5ef6a875.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*ewLOkW88fJiZ8Cwr6Vp2Ow.png"/></div></figure><p id="49d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到，有一些非常厌恶风险的用户可以被视为异常值，因此我们可以使用IQR方法来删除这些异常值，为此，我们可以执行</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="8f86" class="nm lx it ni b gy nn no l np nq">Q1 = df_users.health.quantile(0.25)<br/>Q3 = df_users.health.quantile(0.75)<br/>IQR = Q3 — Q1<br/>print(IQR)<br/>3.902646865965031</span></pre><p id="248a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并为数据集移除它们</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="69e5" class="nm lx it ni b gy nn no l np nq">df_users = df_users[~((df_users.health &lt; (Q1–1.5 * IQR)) |(df_users.health &gt; (Q3 + 1.5 * IQR)))]<br/>print(“Total users in the dataset after remove outliers {}”.format(df_users.shape[0]))</span><span id="6867" class="nm lx it ni b gy nu no l np nq">Total users in the dataset after remove outliers 7297</span></pre><p id="b369" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，我们可以看到已从数据集中删除，再次查看箱线图，我们可以看到大多数用户在1到3岁之间</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/476dbd08ef37b7869b364a7199ea3b52.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*ttR-lNt6Euo6s99CebmK-Q.png"/></div></figure><h1 id="1605" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">直方图</h1><p id="1cc3" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在清理数据并删除异常值后，我们有兴趣了解用户风险是如何分布的，了解用户是如何管理风险的，我们可以看到每个协议中的健康直方图</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="96fc" class="nm lx it ni b gy nn no l np nq">df_users['health'].hist(by=df_users['protocol'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/ff2913b0b50658264f0a0fbb3f6871e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*BhCdm3oTwTpUetkMfVLK8Q.png"/></div></figure><p id="21c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">他们中的大多数都接近清算限制，其中少数人的风险较低，为了更仔细地了解大多数用户的位置，可以运行相同的直方图，但通过运行以下内容按大多数用户的位置进行筛选</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="9ed7" class="nm lx it ni b gy nn no l np nq">df_users[df_users['health']&lt;4].health.hist(by=df_users['protocol'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/07ec00d61086ef76ec1499ec5bfec1f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1054/format:webp/1*CIVqRuWAtU2XhU-yNdnFGQ.png"/></div></figure><p id="6794" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到，它们大多数在1和2之间，为了证实这一点，可以在每个方案中使用该字段的箱线图</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="e73e" class="nm lx it ni b gy nn no l np nq">df_users.boxplot(column=’health’, by=’protocol’)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/c7c6b9b346455a76fb585f2f414dcf7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*mbB9LTU7VqsLLRJCmB6X6w.png"/></div></figure><h1 id="cb53" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">相关</h1><p id="e3d4" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">数据集的变量不是随机选择的，其想法是试图找到用户健康和他们在协议中的行为之间的某种相关性。一种策略可以是，使用稳定的硬币来降低波动风险，其他策略可以使用多种资产来分散抵押品和本金，并且还可以有趣地了解拥有高或低抵押品的用户是否更有风险，或者之前的清算是否会使用户更加厌恶风险。</p><p id="1d86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦所有这些变量都在数据集中，我们就可以使用热图来绘制变量之间的相关性，方法是运行</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="1b6c" class="nm lx it ni b gy nn no l np nq">corr = df_users.corr()<br/>sns.heatmap(corr)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/8f31e92120522922c8d6d42c4a20e353.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*JsYsciOA1Mat8f-46alKkA.png"/></div></figure><p id="a997" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些变量与用户健康之间没有很高的相关性，countLiquidated和stableDepositCount的值较高，这表明负相关，表明当用户存放不太稳定的硬币或被清算次数较多时，健康往往较高。</p><p id="f32c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了检验这些变量，我们可以通过运行</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="abd4" class="nm lx it ni b gy nn no l np nq">fig, ax = plt.subplots(figsize=(10,6))<br/>ax.scatter(df_users['health'], df_users['stableDepositedCount'])<br/>ax.set_xlabel('health')<br/>ax.set_ylabel('stableDepositedCount')<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/10d3c0502201f20c09e3cfcf9a26778d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mnPxVrab7NutuXPQuJPg0g.png"/></div></div></figure><p id="0186" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到，当用户存入更多稳定硬币时，健康通常更集中在1附近，借款稳定变量也是如此。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/3fe846dbe6a52534ce3d6b1deecdb9e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a8f3HWaCsrzpIUjefca4nw.png"/></div></div></figure><p id="46a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在清算计数的情况下，不存在明确的相关性，存在多次清算且同样承担高风险的用户，以及没有清算且风险较低的用户。我尊重那些有超过25次清算，但仍然接近一次健康清算的人。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/f74a449c4c149c986a212c88a44ffafb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ugl1rHQWdmssqNX96FISNA.png"/></div></div></figure><h1 id="cd93" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">结论</h1><p id="aff0" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">通过这种简单的分析，我们可以了解用户在租借协议中的行为，同样，我们可以看到从DeFi获取数据并对其进行分析是多么容易，而不仅仅是实际数据，在区块链中，我们在每个块中都保存了所有历史记录。</p></div></div>    
</body>
</html>