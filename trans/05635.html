<html>
<head>
<title>Introduction to Time Series Analysis — Data Wrangling and Transformation with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列分析简介—使用Python进行数据辩论和转换</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introduction-to-time-series-analysis-data-wrangling-and-transformation-with-python-4ad5063720f6?source=collection_archive---------27-----------------------#2021-05-19">https://towardsdatascience.com/introduction-to-time-series-analysis-data-wrangling-and-transformation-with-python-4ad5063720f6?source=collection_archive---------27-----------------------#2021-05-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="0328" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">准时系列</h2><div class=""/><div class=""><h2 id="bbe4" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">如何准备和分析时间序列数据</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/9fd56ff1a0027b9dacd45e8d32d94f38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-IW8KjTApgFeO5aS"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@thoughtcatalog?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">思想目录</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="f308" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">时间序列课程通常主要关注统计测试的应用和预测模型的创建。然而，我发现这在很大程度上假设了读者的能力水平。如果你和我一样，那么你可能只通过本科统计学课程和YouTube视频了解时间序列的概念。</p><p id="eb5a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在这篇文章中，我们将回顾你将如何处理数据和进行探索性的数据分析。</p><p id="59c3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们开始吧！</p><p id="108b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">一如既往，让我们导入所需的Python库。</p><pre class="kp kq kr ks gt mb mc md me aw mf bi"><span id="7583" class="mg mh iq mc b gy mi mj l mk ml">import numpy as np<br/>import pandas as pd<br/>import matplotlib.pyplot as plt<br/>import matplotlib.ticker as tkr</span></pre><p id="c430" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">很好，现在让我们加载数据。在这篇文章中，我们将利用贾斯汀·基金斯的鳄梨价格数据。这样的数据可以在<a class="ae le" href="https://www.kaggle.com/neuromusic/avocado-prices" rel="noopener ugc nofollow" target="_blank">这里找到。</a></p><p id="1ff5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们通过熊猫加载数据。</p><pre class="kp kq kr ks gt mb mc md me aw mf bi"><span id="c449" class="mg mh iq mc b gy mi mj l mk ml">df_av = pd.read_csv('avocado.csv')</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/413fe0a259f3322cf6294d0444163388.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*8MXgatQ2CrSjORZhIXwfAQ.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图一。原始数据</p></figure><p id="82ac" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们可以看到数据是<strong class="lh ja">而不是简单而干净的数据列</strong>，事实上实际上有多个时间序列变量。这将最终允许我们从事更丰富的分析；然而，让我们首先关注清理数据。</p><p id="5ff1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们可以看到数据有一个<strong class="lh ja">日期</strong>列。为了方便起见，让我们将该列分配给索引，并去掉未命名的列。</p><pre class="kp kq kr ks gt mb mc md me aw mf bi"><span id="13e5" class="mg mh iq mc b gy mi mj l mk ml">df_av = pd.read_csv('avocado.csv', index_col='Date')<br/>df_av.drop(df_av.columns[0],axis=1,inplace=True)<br/>df_av.head(5)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/6e2298e1147507a40d435ce15d417f98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*HiYD893qH9d8GnCn9kVjWg.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图二。更干净的数据</p></figure><p id="a6c4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这些数据现在更有用了，现在让我们绘制一个折线图(时间序列数据的一种常见的可视化选择)。为了简单起见，让我们只关注总体积。</p><pre class="kp kq kr ks gt mb mc md me aw mf bi"><span id="2524" class="mg mh iq mc b gy mi mj l mk ml">ax = df_av['Total Volume'].plot(figsize=(20,5))<br/>ax.set_title('Total Volume of Avocados', fontsize = 22)<br/>ax.set_xlabel('Year', fontsize = 15)<br/>ax.set_ylabel('Volume', fontsize = 15)<br/>plt.grid(True)<br/>plt.show()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mo"><img src="../Images/8904c76aa543bde360792fc31f7ce883.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HuMSexmEeVC2abDZjubSyQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图三。一段时间内鳄梨的总量</p></figure><p id="b857" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们可以看到曲线图nice绘出了这段时间内鳄梨的总量；然而，你们中的一些读者可能会认为这些数据看起来有点奇怪。如果你这么认为，那么恭喜你，你似乎对时间序列数据的本质有很好的直觉。</p><p id="758c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果我们再看一遍数据，我们就能真正看到发生了什么。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/e3792ad103e4185115072e5c9713264c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*kGVu_fa9iH-roYrHRLEZHw.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图4。再次查看数据</p></figure><p id="b588" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们可以看到数据本身是<strong class="lh ja">而不是纯粹的时间序列</strong>，有一个地理指示器标记为区域。我们拥有的数据实际上是统计学家和经济学家所说的面板数据。数据本身包含54个不同的地区，所有地区的数据量相同(新墨西哥州是明显的例外)。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/340031b8f21b403d33ce533b52eb6ad8.png" data-original-src="https://miro.medium.com/v2/resize:fit:300/format:webp/1*xlwGwugSa3fw5ZaWHvafFw.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图五。所有区域值的计数</p></figure><p id="9c20" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">面板数据完全是一种稍微不同的动物，所以为了继续，让我们选择一个单独的区域。就我而言，我选择把重点放在旧金山。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mr"><img src="../Images/09f756a2238dc4b9bca8bf5427f53ab7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UReEsFR6PYB32KWcQ7EdaQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图六。旧金山鳄梨的数量</p></figure><p id="5555" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们可以看到数据还是比较奇怪的。这是因为数据中列出了<strong class="lh ja">两种</strong>鳄梨，<strong class="lh ja">常规</strong>和<strong class="lh ja">有机</strong>。让我们把这两者分别画在不同的图上。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ms"><img src="../Images/108e137ad9a1d5e5339a305b82d82383.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EB2FQY1tACGSvTLABvxFqQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图7。分解旧金山的鳄梨产量</p></figure><p id="2b54" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们可以看到，常规牛油果的体积远远大于有机牛油果；然而，两者似乎呈现出相似的总体增长趋势。让我们继续关注传统鳄梨的数量。</p><p id="3c1e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们看看每月的平均交易量，而不是每天的交易量。要做到这一点，必须首先找到提取月份的方法。到目前为止，我们仅有的日期数据是索引数据。</p><pre class="kp kq kr ks gt mb mc md me aw mf bi"><span id="03af" class="mg mh iq mc b gy mi mj l mk ml">df_sfo_co = df_sfo[df_sfo['type'] == 'conventional']<br/>df_sfo_co.index</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/0d2a7a3c595455d94ab161144b51baa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*nEKVoxEx4d7dKCl2oPxRRg.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图8。索引数据</p></figure><p id="8b82" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们可以看到该索引包含月份数据。为了提取它，让我们使用列表理解。注意，出于本文的目的，我们将提取年和月。原因稍后将变得明显。</p><pre class="kp kq kr ks gt mb mc md me aw mf bi"><span id="fa9c" class="mg mh iq mc b gy mi mj l mk ml">[f"{i.split('-')[0]} - {i.split('-')[1]}" for i in df_av.index]</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/d763ff21212c771ae2866d36dd1482b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:262/format:webp/1*hi4y0Xrpbzlh3TOSd8yvng.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图九。提取年月标签</p></figure><p id="3e30" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">然后可以将数据放入原始数据帧中。</p><pre class="kp kq kr ks gt mb mc md me aw mf bi"><span id="79f0" class="mg mh iq mc b gy mi mj l mk ml">df_sfo_co['year_month'] = [f"{i.split('-')[0]} - {i.split('-')[1]}"  <br/>                           for i in df_sfo_co.index]<br/>df_sfo_co.index</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mv"><img src="../Images/5c0e3edc410fdea26c018535e1b1267c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-XG-ZCeuFZyr9t_OM6mZEQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图10。添加了年月列</p></figure><p id="1705" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">既然我们已经附加了<strong class="lh ja"> year_month </strong>数据，现在让我们通过获得<strong class="lh ja">月平均值</strong>而不是实际数量来折叠数据。</p><pre class="kp kq kr ks gt mb mc md me aw mf bi"><span id="ed9b" class="mg mh iq mc b gy mi mj l mk ml">df_sfo_co = df_sfo_co.groupby('year_month', as_index=False).agg({'Total Volume':'mean', 'year' : 'mean'})<br/>df_sfo_co</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/93dccffe9526eea20cd30a5f3669bced.png" data-original-src="https://miro.medium.com/v2/resize:fit:536/format:webp/1*_GESdggHet6q2gS5bUT_jw.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图11。年月合计</p></figure><p id="d104" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">太好了，这看起来更像你的典型时间序列数据，让我们画出来。</p><pre class="kp kq kr ks gt mb mc md me aw mf bi"><span id="ceab" class="mg mh iq mc b gy mi mj l mk ml">ax = df_sfo_co['Total Volume'].plot(figsize=(20,5))<br/>ax.set_title('Volume of Avocados', fontsize = 22)<br/>ax.set_xlabel('Month', fontsize = 15)<br/>ax.set_ylabel('Price', fontsize = 15)<br/>ax.set_xticks(np.arange(0, len(df_sfo_co['Total Volume'])+1, 2))   ax.get_yaxis().set_major_formatter(tkr.FuncFormatter(lambda x, p: format(int(x), ',')))</span><span id="ba73" class="mg mh iq mc b gy mx mj l mk ml">plt.grid(True)<br/>plt.show()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi my"><img src="../Images/3ac4627a3f60d6290023dffe18d7a539.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1-YmltC8CUv7oDFAxx7iiw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图12。月聚合线图</p></figure><p id="62e5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">最后，最好始终记住，时间序列数据不需要以上述格式呈现。我们还可以设置图表，使x轴只包含月份，用几条线代表几年。</p><p id="16e0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">关于这一点的争论相当广泛，但请容忍我。</p><pre class="kp kq kr ks gt mb mc md me aw mf bi"><span id="3481" class="mg mh iq mc b gy mi mj l mk ml">df_sfo_pivot = df_sfo_co.pivot(index='year_month',<br/>                            columns='year',<br/>                            values='Total Volume')</span><span id="8115" class="mg mh iq mc b gy mx mj l mk ml">shift_value = -12<br/>year_list = [2016, 2017, 2018]<br/>for i in year_list:<br/>    df_sfo_pivot[i] = df_sfo_pivot[i].shift(shift_value)<br/>    shift_value -= 12</span><span id="d5e2" class="mg mh iq mc b gy mx mj l mk ml">df_sfo_pivot.dropna(how = 'all', inplace = True)<br/>df_sfo_pivot.index = list([i.split('-')[1] for i in df_sfo_pivot.index])<br/>df_sfo_pivot</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/817808b197006a547ea600ff957fcf8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*zcqGa7klL5lX__t8Ld_Emw.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图13。争论和旋转的数据</p></figure><p id="2e2d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">很好，现在剩下的唯一任务就是绘制它。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi na"><img src="../Images/e0ff28eb5b3d72488d9cdc297f39247e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uKC24w_lWMCza0Vj1KtIpw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图14。堆积折线图</p></figure><p id="8ca7" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">上图让我们可以更好地看到不同年份之间的差异，以及不同年份之间是否存在季节性。从上面的图表中，我们可以清楚地看到每年<strong class="lh ja">2月</strong>需求出现峰值，随后在<strong class="lh ja">3月</strong>需求明显下降。然后似乎没有明显的季节性成分，直到2016年<strong class="lh ja">和2017年</strong>的<strong class="lh ja">12月</strong>需求上升。</p><p id="f05a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">总之</strong></p><p id="a69a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">时间序列分析对于任何参与发现趋势和分析市场(尤其是股票市场)的数据科学家来说都是一个强大的工具。虽然本文没有深入到具体的时间序列分析技术，但是我发现写一下实践中的数据争论和转换方面是谨慎的。这种技能不仅对时间序列分析至关重要，对每个处理数据的人也是如此。</p></div></div>    
</body>
</html>