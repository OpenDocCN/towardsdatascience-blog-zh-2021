<html>
<head>
<title>How to Interpret Models: PDP and ICE</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何解读模型:PDP和ICE</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-interpret-models-pdp-and-ice-eabed0062e2c?source=collection_archive---------6-----------------------#2021-09-10">https://towardsdatascience.com/how-to-interpret-models-pdp-and-ice-eabed0062e2c?source=collection_archive---------6-----------------------#2021-09-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="da0f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">确定每个特征对模型输出的贡献。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6c1efa56c245c3ac240ca08696931c8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aF3NSApJrmLVniBW"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@claybanks?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">粘土银行</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="5ccc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di"> M </span>模型的可解释性变得越来越有价值。然而，当处理具有复杂关系的大型模型时，解释并不总是一件容易的事情。</p><p id="b5db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">部分相关图(PDP)显示了不同特性对输出的边际贡献。它们用于显示单个特征或两个特征的贡献。</p><p id="87fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">部分相关图也与个体条件期望(ICE)图高度相关。ICE图显示了每个数据实例的预测变化。</p><p id="c77c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些图是模型不可知的，这意味着不管基础模型如何，它们都可以显示改变一个或两个特征如何影响模型的输出。</p><p id="7839" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于价格预测等任务，了解每个要素的PDP趋势对于理解模型如何使用新数据进行预测至关重要。理想情况下，这些PDP图应该可以解释和理解，以推动决策制定。</p><h1 id="df62" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated"><strong class="ak"> PDP和ICE </strong></h1><p id="92bd" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">两个图使用相同的机制来模拟预测变化。但是，如果PDP观察到一个或两个特征的总体趋势，ICE图会显示更细粒度级别的变化。</p><p id="db1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些图可以并行使用，以了解预测的整体趋势，并检查有问题的个案。因为PDP显示了总体水平上的输出变化，所以丢失了特定实例的较小变化。因此，最好是看两种变化。</p><p id="12dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当预测任务是回归模型时，输出中显示的变化直接是预测中的变化。然而，在分类期间，输出变化是类别的预测概率的变化。</p><p id="235c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于PDP，为了估计部分函数，使用蒙特卡罗方法用训练数据计算平均值:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/807f747b42abebc080dcc503b5cd840b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*892RB4ZKeSNg3Pad-j4c4Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">部分相关函数(作者图片)</p></figure></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="8487" class="me mf it bd mg mh nj mj mk ml nk mn mo jz nl ka mq kc nm kd ms kf nn kg mu mv bi translated"><strong class="ak">例子</strong></h1><p id="2bda" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">为了展示每一种方法，并浏览对图的解释，我使用了“鲍鱼”数据集。</p><p id="90e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个数据集是在开放数据共享公共领域奉献和许可(PDDL)下许可的。</p><div class="no np gp gr nq nr"><a href="https://datahub.io/machine-learning/abalone#readme" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">鲍鱼</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">这个数据集的资源可以在https://www.openml.org/d/183找到作者:来源:未知-请引用…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">数据中心. io</p></div></div><div class="oa l"><div class="ob l oc od oe oa of ks nr"/></div></div></a></div><p id="3be9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该数据集的目标是确定鲍鱼的年龄。通常，这是通过切开球果，给球果染色，然后用显微镜计数球果的数目来完成的。不幸的是，用这种方法测量年龄非常耗时、有创且费力。</p><p id="86fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相反，使用八个特征，可以有效地预测年龄。这些特征是性别、长度、直径、高度、总重量、去壳重量、内脏重量和壳重量。该数据有4177条记录和八个特征。</p><p id="8d60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">PDP和ICE图都可以从sklearn中的同一个包中生成。</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="fcb6" class="ol mf it oh b gy om on l oo op">from sklearn.inspection import plot_partial_dependence</span><span id="01f0" class="ol mf it oh b gy oq on l oo op"># PD Plots<br/>plot_partial_dependence(model, X, [feature_name])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/73af57cc77cacc8fcfae75055e48e8f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nIGuTU-ZtzSQL4ThRR6dnw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">部分相关图(图片由作者提供)</p></figure><p id="acef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相关图基于梯度推进树回归模型。</p><p id="960a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在图中，显示了“无壳重量”和“整体重量”的模型行为。鲍鱼的年龄预测值随着去壳重量的增加而降低。而对于“整体重量”，此特征的增加会增加预测年龄，但对于低值，预测不会改变。</p><p id="da82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，特征值的百分位数显示在每个图的底部。每个显著的黑色标记代表该特征的百分位数，增量为10。</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="dddc" class="ol mf it oh b gy om on l oo op"># ICE Plots<br/>plot_partial_dependence(model, X, [feature_name], kind='individual')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/5f1a633f6ed5cba4e797a7b097cd2541.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lBJdKktui3sZM11NNsjnyw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">部分相关和个体条件期望图(图片由作者提供)</p></figure><p id="25b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来是高度的PD图和ICE图。在PD图中，随着数值的增加，趋势不再是线性的。一旦身高超过0.3，身高就不再对整体年龄预测有贡献(用0的部分相关性指定)。</p><p id="7889" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在ICE图中，这种模式在所有实例中都是一致的。身高越低，预测年龄越小。然而，当高度增加时，预测增加，直到高度超过阈值。</p><p id="9f6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">高度的分布导致了这种奇怪的行为。作为参考，最大值为1.13，但在第75百分位，该值仅为0.165。</p><p id="bcd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些图试图在每个特征的值的范围内建模。但是当大多数特征值集中到值的子集时，模型不能很好地学习这个范围。</p><p id="9d9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，当新实例的高度值在此范围内时，我们无法确定。</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="8d94" class="ol mf it oh b gy om on l oo op">from sklearn.inspection import plot_partial_dependence</span><span id="8734" class="ol mf it oh b gy oq on l oo op"># PD Plots, 2-dimensional<br/>plot_partial_dependence(model, X, [(feature_1, feature_2)], kind='both')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/daab8ce71cc926c54df46e5f386be057.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v07hsBRQ_I8tPALWbX73kw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">部分相关图(图片由作者提供)</p></figure><p id="f8e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终部分相关性图观察到两个特征对最终输出的相互作用。这里显示了“整体重量”和“去皮重量”。</p><p id="925b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终输出值的变化用轮廓的颜色显示，每个特征的先前行为仍然存在。</p><p id="c4fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“整体体重”的增加一旦超过先前定义的阈值，预测的年龄就会增加。对于“去皮重量”，预测值随着值的增加而降低。所以对于这两个特性，并没有太多的交互。</p><h1 id="6b67" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">结论</h1><p id="8ff5" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">部分相关图和个别条件期望图是开始理解你的模型的好方法。此外，它们易于实现并适用于每种模型。</p><p id="0189" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">两个图都允许用户更好地理解他们的模型和暴露不一致的趋势以及不规则的模型行为。</p><p id="6499" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些图取决于监督学习任务中使用的基础模型。然而，它们揭示了整体和单个实例级别的模型行为。因此，它们允许你有效地解释你的模型。</p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><p id="a702" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有兴趣阅读关于新颖的数据科学工具和理解机器学习算法的文章，可以考虑在Medium上关注我。</p><p id="4f22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ou">如果你对我的写作感兴趣，想直接支持我，请通过以下链接订阅。这个链接确保我会收到你的会员费的一部分。</em></p><div class="no np gp gr nq nr"><a href="https://zjwarnes.medium.com/membership" rel="noopener follow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">通过我的推荐链接加入Medium-Zachary Warnes</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">阅读扎卡里·沃恩斯(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">zjwarnes.medium.com</p></div></div><div class="oa l"><div class="ov l oc od oe oa of ks nr"/></div></div></a></div></div></div>    
</body>
</html>