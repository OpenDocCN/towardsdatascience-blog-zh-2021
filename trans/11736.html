<html>
<head>
<title>Geocoding CSV in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 对 CSV 进行地理编码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/geocoding-csv-in-python-5d45bf01694e?source=collection_archive---------15-----------------------#2021-11-22">https://towardsdatascience.com/geocoding-csv-in-python-5d45bf01694e?source=collection_archive---------15-----------------------#2021-11-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1b33" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">2021 年德国巴登符腾堡州圣诞市场的一个例子</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/32516ffc7a3dce8ef78f5145aa22975b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8mK_Ax6ZDGDPcZP_"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@ydaniels?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">丹尼尔斯·乔菲</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="8773" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">地理编码是通过输入全球各地的地址数据来定位坐标的过程。在大多数地理数据分析过程中，这是一个非常基本的步骤。这篇简短的教程让您深入了解如何使用 Python 中的<strong class="lb iu"> geopy </strong>库进行地理编码。只需要几行 Python 脚本和几分钟就可以学会。本教程的用例是对德国巴登符腾堡州 2021 圣诞市场地址数据进行地理编码，数据以 CSV 格式提供。</p><h1 id="8a07" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">土工格栅的安装和基础。</strong></h1><p id="76bd" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">您可以使用以下脚本安装 geopy:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="4b7f" class="mx lw it mt b gy my mz l na nb"><strong class="mt iu">$ pip install geopy</strong></span><span id="f8c8" class="mx lw it mt b gy nc mz l na nb">or in Colab: <br/><strong class="mt iu">!pip install geocoder</strong></span></pre><p id="7b33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装 geopy 后，您可以通过导入这个 geopy 库来启动一个新的 Python 文件。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="e246" class="mx lw it mt b gy my mz l na nb">import geocoder</span></pre><p id="c0cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用 geopy 非常简单。它包括许多地理编码服务的地理编码器类，如<a class="ae ky" href="https://nominatim.org/" rel="noopener ugc nofollow" target="_blank">OpenStreetMap nomim</a>、<a class="ae ky" href="https://developers.google.com/maps/documentation/geocoding/" rel="noopener ugc nofollow" target="_blank"> Google Geocoding API (V3) </a>等等。例如，您可以使用以下脚本调用带有 osm 的地理编码器:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="82a8" class="mx lw it mt b gy my mz l na nb">g = geocoder.osm('Eiffel Tower')</span><span id="6f53" class="mx lw it mt b gy nc mz l na nb">&gt;&gt;&gt; g.osm</span><span id="9e12" class="mx lw it mt b gy nc mz l na nb">{<br/>   'x': 2.2944990543196795, <br/>   'y': 48.858260200000004, <br/>   'addr:housenumber': '5', <br/>   'addr:street': 'Avenue Anatole France', <br/>   'addr:city': 'Paris', <br/>   'addr:state': 'Île-de-France', <br/>   'addr:country': 'France', <br/>   'addr:postal': '75007'<br/>}</span></pre><h1 id="f36a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">将 CSV 读给熊猫数据框</h1><p id="c0de" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">现在，让我们尝试使用 geopy 对 CSV 表中的数据进行地理编码。我们可以从将 CSV 数据集导入熊猫数据帧开始。本例中的 CSV 将是德国 BW 的圣诞节市场地址，此处<a class="ae ky" href="https://icity.hft-stuttgart.de/christmas_market_2021/ChristmasMarketData.csv" rel="noopener ugc nofollow" target="_blank">公开提供</a>(由作者创建)。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="3b63" class="mx lw it mt b gy my mz l na nb">import pandas as pd<br/>df = pd.read_csv("ChristmasMarketData.csv")<br/>df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/801730dfbcf82fb7082c1d7d1141244e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XWVAPfLuQDHRkP5c9KkzFg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ne">圣诞市场地址数据示例</strong>(作者提供)</p></figure><h1 id="9d3e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">对数据帧进行地理编码</h1><p id="221a" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">现在，让我们对数据帧进行地理编码。在此之前，我们需要一个函数来返回必要的地理编码信息，即<code class="fe nf ng nh mt b">g.osm['x']</code>和<code class="fe nf ng nh mt b">g.osm['y']</code>，如下所示</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="d577" class="mx lw it mt b gy my mz l na nb">def geocoding(input_address):<br/>   g = geocoder.osm(input_address)<br/>   return g.osm['x'], g.osm['y']</span></pre><p id="c3f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以将这个函数应用于地址栏中的数据帧。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="2efe" class="mx lw it mt b gy my mz l na nb">df['locations'] = df['address'].apply(geocoding)<br/>df[['lon','lat']] = pd.DataFrame(df['locations'].tolist(),<br/>                                 index=df.index)<br/>df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/8c80f8a9bf296dc40b3aa7cac01b0239.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WohFznWFBE8MyvH2LF5dMQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ne">生成的地理编码圣诞市场地址</strong>(作者)</p></figure><p id="9dbe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">而且，大概就是这样。你可以在<a class="ae ky" href="https://icity.hft-stuttgart.de/christmas_market_2021" rel="noopener ugc nofollow" target="_blank">https://icity.hft-stuttgart.de/christmas_market_2021</a>查看可视化结果地理编码圣诞市场数据</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/047cc29a068a92c0eb1ba3c99251ff77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HDhybeTBmggsfzFjkytD_g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ne">地理编码圣诞市场地址的可视化</strong>(作者)</p></figure><p id="c0fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总之，本文概述了如何使用 geopy 库对 CSV 数据和 Pandas 数据帧进行地理编码。</p><p id="2d14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你喜欢它，并发现它对你的日常工作或项目有用。如果你有任何问题，请随时联系我。</p><p id="7890" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于我&amp;查看我所有的博客内容:<a class="ae ky" href="https://joets.medium.com/about-me-table-of-content-bc775e4f9dde" rel="noopener">链接</a></p><p id="9bea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">平安健康！</strong> <br/> <strong class="lb iu">感谢阅读。👋😄</strong></p></div></div>    
</body>
</html>