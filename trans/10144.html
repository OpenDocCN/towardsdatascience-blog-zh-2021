<html>
<head>
<title>Tips for Data Mapping and Replacing with Pandas and NumPy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Pandas和NumPy进行数据映射和替换的技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tips-for-data-mapping-and-replacing-with-pandas-and-numpy-f1e4e789ae80?source=collection_archive---------15-----------------------#2021-09-25">https://towardsdatascience.com/tips-for-data-mapping-and-replacing-with-pandas-and-numpy-f1e4e789ae80?source=collection_archive---------15-----------------------#2021-09-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a239" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">转换数据有助于您处理数据集、理解数据集并收集尽可能多的见解。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/07a5380ea5ee0ef8abac6e896500a400.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_lJMI3Atut7n3qgp"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">雄心勃勃的创意公司Rick Barrett在Unsplash上的照片</p></figure><h1 id="c715" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="36b8" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了总结主要特征、发现异常并可视化信息，您应该知道如何重新排列和转换数据集。换句话说，转换数据有助于您处理数据集，理解数据集，并收集尽可能多的见解。在本文中，我将向您展示一些我常用的处理数据的方法，希望这对您有所帮助。</p><h1 id="7b7d" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">资料组</h1><p id="02e2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我将创建一个简单的分数数据集，其中包含不同班级的分数信息。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="31d1" class="ms la it mo b gy mt mu l mv mw"><strong class="mo iu"><em class="mx">Input: <br/></em></strong>info = {'Class':['A1', 'A2', 'A3', 'A4','A5'],<br/>        'AverageScore':[3.2, 3.3, 2.1, 2.9, 'three']}</span><span id="0cb6" class="ms la it mo b gy my mu l mv mw">data = pd.DataFrame(info)</span></pre><p id="fb9c" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated"><strong class="lt iu"> <em class="mx">输出:</em> </strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/d6a1a03aacd1ccfdbcfdaeeed64fbd4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:408/format:webp/1*tLQ9hSO-tw9j4rJHu5zJcw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1:数据帧</p></figure><h1 id="b95a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">替换列中的值</h1><p id="6669" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">由于我们数据中A5类的平均分数是一个字符串对象，我想用一个相应的数字来替换它，以便于数据操作。将“三”替换为“3”的步骤如下:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="945c" class="ms la it mo b gy mt mu l mv mw"><strong class="mo iu"><em class="mx">Input:<br/></em></strong>data['AverageScore'] = data['AverageScore'].replace(['three'],'3')<br/>data['AverageScore'] = data['AverageScore'].astype('float')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/9522a935673f167719d30d04d9b2dc13.png" data-original-src="https://miro.medium.com/v2/resize:fit:428/format:webp/1*Mr5Uk-RwMK6Nm6q2JRmUMA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2:替换后的数据</p></figure><p id="05bc" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">上面是在特定列中用另一个值替换一个值的简单例子。更多参考，下面是一些更多的例子:</p><ul class=""><li id="0dcb" class="ng nh it lt b lu mz lx na ma ni me nj mi nk mm nl nm nn no bi translated">如果要用多个新值替换特定列的多个值，请使用:</li></ul><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="2b42" class="ms la it mo b gy mt mu l mv mw">data['column name'] = data['column name'].replace(['1st old value','2nd old value',...],['1st new value','2nd new value',...])</span></pre><ul class=""><li id="bcc6" class="ng nh it lt b lu mz lx na ma ni me nj mi nk mm nl nm nn no bi translated">如果要用新值替换特定列的多个值:</li></ul><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="9d15" class="ms la it mo b gy mt mu l mv mw">data['column name'] = data['column name'].replace(['1st old value','2nd old value',...],'new value')</span></pre><h1 id="46c1" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">映射数据列</h1><p id="ebf1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">假设我想添加一个评估分数好坏的列，我将写下每个分数到相应评估意见的映射。这可以通过使用<code class="fe np nq nr mo b">bins</code>、熊猫<code class="fe np nq nr mo b">cut()</code>功能、<code class="fe np nq nr mo b">np.digitize()</code>功能、<code class="fe np nq nr mo b">np.select()</code>或您自己的<code class="fe np nq nr mo b">if</code>功能以4种不同的方式完成。让我们看看我是如何处理每种方法的。</p><h2 id="528f" class="ms la it bd lb ns nt dn lf nu nv dp lj ma nw nx ll me ny nz ln mi oa ob lp oc bi translated">熊猫. cut()</h2><p id="2d35" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您只需要定义您的限制和类别名称，然后使用<code class="fe np nq nr mo b">pandas.cut()</code>将它们应用到数字列。在这种情况下，我将定义三个区间，对应于四个bin限制，以评估每个类的分数。详细来说:</p><ul class=""><li id="c64a" class="ng nh it lt b lu mz lx na ma ni me nj mi nk mm nl nm nn no bi translated">0 &lt; AverageScore ≤2: Below average</li><li id="386f" class="ng nh it lt b lu od lx oe ma of me og mi oh mm nl nm nn no bi translated">2 &lt; AverageScore ≤ 3.1: Average</li><li id="e2a7" class="ng nh it lt b lu od lx oe ma of me og mi oh mm nl nm nn no bi translated">3.1 &lt; AverageScore ≤5: Good</li></ul><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="1c31" class="ms la it mo b gy mt mu l mv mw"><strong class="mo iu"><em class="mx">Input:<br/></em></strong>bins = [0, 2, 3.1, 5]<br/>comment = ['Below Average', 'Average', 'Good']<br/>data['Evaluation'] = pd.cut(data['AverageScore'], bins, labels=comment)</span></pre><p id="0c2f" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated"><strong class="lt iu"> <em class="mx">输出:</em> </strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/e1df4a08cf496a66366dceb664382290.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*N6ftwJQp4Hekh-OfCaTCUw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3:使用panda.cut()映射数据</p></figure><h2 id="25ff" class="ms la it bd lb ns nt dn lf nu nv dp lj ma nw nx ll me ny nz ln mi oa ob lp oc bi translated">Numpy.digitize()</h2><p id="8f9b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe np nq nr mo b">Numpy.digitize()</code>的想法是获得每个值所属的仓的索引。类似地，在这种情况下，您也可以像使用<code class="fe np nq nr mo b">pd.cut()</code>一样定义您的bin边界和类别名称。区别在于创建一个额外的字典，并使用该字典来映射类别名称。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="e36d" class="ms la it mo b gy mt mu l mv mw"><strong class="mo iu"><em class="mx">Input:<br/></em></strong>bins = [0, 2, 3.1, 5]<br/>comment = ['Below Average', 'Average', 'Good']</span><span id="45b6" class="ms la it mo b gy my mu l mv mw">dictionary = dict(enumerate(comment, 1))</span><span id="3a48" class="ms la it mo b gy my mu l mv mw">data['Evaluation2'] = np.vectorize(dictionary.get)(np.digitize(data['AverageScore'], bins))</span></pre><p id="4a1b" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated"><strong class="lt iu"> <em class="mx">输出:</em> </strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/f3c0c7cfd660f0a20113663299ac2595.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*vxNLkvJi13UWIP0ZFHv7fg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4:使用Numpy.digitize()</p></figure><h2 id="359f" class="ms la it bd lb ns nt dn lf nu nv dp lj ma nw nx ll me ny nz ln mi oa ob lp oc bi translated"><code class="fe np nq nr mo b">Numpy.select()</code></h2><p id="c54d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe np nq nr mo b">Numpy.select(condition list, choice list)</code>方法根据列表中的条件，返回从选择列表中的元素中提取的数组。因此，我们可以很容易地通过陈述评估条件来获得所需的值，评估条件是三个有限制的区间，以及相应的选择列表值。参见下面的代码以供参考。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="e348" class="ms la it mo b gy mt mu l mv mw"><strong class="mo iu"><em class="mx">Input:<br/></em></strong>evaluate = [data['AverageScore'].between(0,2), data['AverageScore'].between(2,3.1), data['AverageScore'].between(3.1,5)]</span><span id="7fe6" class="ms la it mo b gy my mu l mv mw">values = ['Below Average', 'Average', 'Good']</span><span id="537d" class="ms la it mo b gy my mu l mv mw">data['Evaluate3'] = np.select(evaluate, values, 0)</span></pre><p id="4c57" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated"><strong class="lt iu"> <em class="mx">输出</em> </strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/57e188fcf5fc3630fa31b6e4bb50249a.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*rYHSCbBaSxHZA-334C7uOg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图5:使用Numpy.select()进行映射</p></figure><h2 id="c1a4" class="ms la it bd lb ns nt dn lf nu nv dp lj ma nw nx ll me ny nz ln mi oa ob lp oc bi translated"><code class="fe np nq nr mo b">Writing your function</code></h2><p id="0762" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">你甚至可以编写自己的函数来应用。逻辑其实很简单，正如你所见:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="dd43" class="ms la it mo b gy mt mu l mv mw"><strong class="mo iu"><em class="mx">Input: </em></strong></span><span id="c10f" class="ms la it mo b gy my mu l mv mw">def evaluate(values):<br/>    if values &gt;=0 and values &lt;=2:<br/>        return 'Below Average'<br/>    elif values &gt;2 and values &lt;= 3.1:<br/>        return 'Average'<br/>    else: <br/>        return 'Good'</span><span id="4b2a" class="ms la it mo b gy my mu l mv mw">#Applying function<br/>data['Evaluation4'] = data['AverageScore'].apply(lambda x: evaluate(x))</span></pre><p id="e8b0" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated"><strong class="lt iu"> <em class="mx">输出:</em> </strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/50c0acea951aeee325c10348ea6acd27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*JAitFUD4MUGWEHxtf42Qlg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图6:编写自己的函数</p></figure><p id="3e10" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">如您所见，所有四种解决方案都产生了相同的结果。我只想为您提供解决这个问题的不同方法，以便将来您可以在不同的场景中灵活地应用这些数据操作。</p><h1 id="0f70" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="08d8" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">以上是我的一些映射和替换数据的技巧。我想在这里传达的是，在某些情况下，当你做探索性数据分析时，你可能必须处理多种意想不到的情况，因此用多种方法解决问题是有用的。希望有一天我的文章能帮到你。祝你好运！</p></div></div>    
</body>
</html>