<html>
<head>
<title>End to End Case Study (Classification): Lending Club data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">端到端案例研究(分类):Lending Club数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/end-to-end-case-study-classification-lending-club-data-489f8a1b100a?source=collection_archive---------5-----------------------#2021-06-11">https://towardsdatascience.com/end-to-end-case-study-classification-lending-club-data-489f8a1b100a?source=collection_archive---------5-----------------------#2021-06-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1637dac221dd944ce4561cb1ae2c6760.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bUgPvHS9cIhrfIV0"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">Avinash Kumar 在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="8ea7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> Lending Club </strong>是一个借贷平台，它以基于信用记录和其他因素的利率将<strong class="kf ir">钱</strong>借给有需要的人。在这篇博客中，我们将分析这些数据，并根据我们的需要对其进行预处理，并建立一个机器学习模型，该模型可以根据他/她与Lending Club的交易历史来识别潜在的违约者。你可以在这里  找到数据<a class="ae kc" href="https://drive.google.com/drive/folders/1A74WpM8ayIfvzfrkFRFzFyBh27djL4YE?usp=sharing" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="lb">。</em></strong></a></p><p id="e8e6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该数据集包含42538行和144列。在这144列中，大多数列的值为空。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lg lh l"/></div></figure><p id="db72" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">事实上，总体数据中有63.15%的值是空值。因此，小心处理这些空值非常重要，因为它们会显著影响我们的结果。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lg lh l"/></div></figure><p id="b793" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">空值可视化绘图:</strong></p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lg lh l"/></div></figure><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi li"><img src="../Images/b9f7a1c9e4bf2e926a9478626f88f921.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*tK45NBSVSfQ5nni_8An6JQ.jpeg"/></div></figure><p id="de17" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">处理空值:</strong></p><p id="e18b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">处理空值是这里的一项重要任务。在下面的代码中，您可以看到144列中只有53列的空值小于40%。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lj lh l"/></div></figure><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/2276db390e5466c172bfea6064531620.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*x5VLcqO6joD9ze6z47wD4Q.jpeg"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">表1</p></figure><p id="02ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上表中，每行代表144列中空值少于特定百分比的列数。例如，行1表示有52列，每列中的空值不到10%。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lj lh l"/></div></figure><p id="7d5a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过考虑空值少于40%的列，我们能够将总列数从144减少到53。</p><p id="e702" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">了解特征</strong></p><p id="e596" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">理解特征/列很重要，因为数据中出现的一些分类列是以数值的形式出现的，反之亦然。我首先尝试检查每一列，但后来明白对所有53列执行这些操作会非常麻烦。因此，我决定首先删除那些不会给数据增加价值的列，然后分析每个字段。</p><p id="02ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检查对象:</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lg lh l"/></div></figure><p id="8f85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">丢弃不必要的对象:</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lj lh l"/></div></figure><p id="90aa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检查数字列:</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lg lh l"/></div></figure><p id="4b1b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">删除不必要的数字列:</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lj lh l"/></div></figure><p id="f6f7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在检查数据之后，我们已经删除了这53列中总共18列没有为我们的数据增加价值的数据。我们能够将列数从53列减少到35列，我们仍将努力减少列数。</p><p id="f8c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">将分类列转换为数字列:</strong></p><p id="2347" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们已经将分类列转换为数字列，方法是根据它们表示的数据类型执行一键编码或标签编码。例如，对<em class="lb"> ['home_ownership '，' verification_status '，' purpose ']【T1]列执行一个热编码，而对“grade”和“sub grade”列执行标签编码，因为它们本质上是序数。</em></p><p id="75da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一个热门编码:</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lg lh l"/></div></figure><p id="49ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">标签编码:</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lg lh l"/></div></figure><p id="eb99" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用标签编码值更新等级列:</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lg lh l"/></div></figure><p id="881c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">将日期时间列转换为数字列:</strong></p><p id="3c61" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">列<em class="lb"> ['issue_d '，' last_pymnt_d '，' last_credit_pull_d'] </em>是日期时间列，通过使用pandas日期时间模块进一步分为月和年。新列分别命名为<em class="lb">'发行日'，'发行日'，'发行日'，'最后一年'，'最后一年'，'最后一年'，'最后一年'，'最后一年'，'最后一年'，'最后一年'。</em></p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lg lh l"/></div></figure><p id="dd4f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">将对象转换为数字列:</strong></p><p id="5adf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">列<em class="lb"> int_rate </em>和<em class="lb"> term </em>被存储为对象。我们已经执行了必要的字符串操作，将它们转换成数字列。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lg lh l"/></div></figure><p id="be31" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">检查相关性:</strong>现在我们已经将所有列转换为数字列，我们将检查相关性。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lg lh l"/></div></figure><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ll"><img src="../Images/d79d384c94543831a6b52c13ae15687d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GNvxfuGmQPfnbJrDSsYojA.jpeg"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">相关热图</p></figure><p id="4ec5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有几列具有高相关性，但是在解决我们的问题时没有考虑这些列。例如，在尝试对贷款是否将由客户偿还进行分类时，我们不会考虑任何未来交易，如<em class="lb"> total_pymnt </em>和<em class="lb"> total_pymnt_inv </em>。因此，这里没有删除这些列。</p><p id="8e29" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">处理空值:</strong></p><p id="f612" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们在显著清理列之后检查是否有空值。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lg lh l"/></div></figure><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/da0e22c24edf454b7a6006903da73e57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*3PYa_leLf7DYQYK0WMaRgA.jpeg"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">空值图</p></figure><p id="058b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如我们所看到的，我们仍然可以在数据中找到一些空值。我们将检查这些空值并采取必要的措施。</p><p id="90cb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们检查空值百分比最高的列。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lj lh l"/></div></figure><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi ln"><img src="../Images/46b22c35bcde25d83924c21e76b3ffd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*nUjpv7Nl3p2tDM0cNcN5Jw.jpeg"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">空值的百分比</p></figure><p id="9741" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有些列的空值百分比非常小(不到1%)。在那里，我们可以用各自列的中值替换空值。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lg lh l"/></div></figure><p id="125e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于空值百分比很高的列，我们将在非空值的基础上运行模型，并预测相应列中缺少的值。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lg lh l"/></div></figure><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lj lh l"/></div></figure><p id="04fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于没有空值，我们将进入下一步，即建立机器学习模型。</p><h2 id="e5f9" class="lo lp iq bd lq lr ls dn lt lu lv dp lw ko lx ly lz ks ma mb mc kw md me mf mg bi translated">分类</h2><p id="b3d9" class="pw-post-body-paragraph kd ke iq kf b kg mh ki kj kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">我们分类任务的目标是确定客户(请求贷款的人)是否能够偿还贷款以及利息金额。因为我们有一些列包含贷款日期的未来交易信息(如贷款后每月支付贷款分期付款等。)，我们将它们从预处理的数据集中删除，以进行分类任务。</p><p id="8471" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们分类任务的目标是根据客户(请求贷款的客户)在获得贷款后与贷方的历史交易来确定其是否会违约。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lj lh l"/></div></figure><p id="1845" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们删除几个包含冲销贷款信息的列。<br/>分类中删除的列:<br/> <em class="lb"> ['total_pymnt '，' total_pymnt_inv '，' total_rec_prncp '，' total_rec_int '，' total_rec_late_fee '，' recoveries'] </em></p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lj lh l"/></div></figure><p id="d9a7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">“loan_status”列用作目标变量，根据记录对客户进行分类。“loan_status”列有4个唯一值，为了便于表示，所有值都用标签编码。该列的标签如下:</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lj lh l"/></div></figure><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lj lh l"/></div></figure><p id="5196" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用VIF检查要素之间的多重共线性，然后删除值高于阈值的列。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lj lh l"/></div></figure><p id="6f06" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们已经删除了具有高VIF因子(10或以上)的列。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lj lh l"/></div></figure><p id="0bb6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">模型建筑</strong></p><p id="e0a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在对目标变量进行标签编码后，我们将数据以70:30的比例拆分为训练和测试数据。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lj lh l"/></div></figure><p id="d69e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用了sklearn的cross_val_score和以得分为f1分的网格搜索cv来考察每个模型在每个折叠中的表现。下图显示了每个型号在3个折叠中的F1分数。橙色线代表每个模型的平均F1分数，而IQR代表这些分数的方差。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lj lh l"/></div></figure><p id="717d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从上图我们可以说<strong class="kf ir"> bagging分类器</strong>是最稳定的模型，加权F1得分的均值最高，方差最小。</p><p id="a1da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用bagging分类器建立模型。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lj lh l"/></div></figure><p id="5e4c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">装袋分级机的分类报告</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lj lh l"/></div></figure><p id="7072" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该模型的准确率为0.89，F1平均得分为0.75。</p><p id="ad38" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最终混淆矩阵:</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mm"><img src="../Images/241bed96a85238bb5206abe62b7198ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*el0JH_he-Enh3Q2ah3IiKA.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">Bagging分类器模型的混淆矩阵</p></figure><p id="2f7a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于bagging分类器没有特征重要性选项，我们使用决策树来寻找特征重要性。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/ec5d76fef5bbd58bc248023e3a57b5c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qZMrnS7vmoorrUTkkPspJQ.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">决策树模型的特征重要性</p></figure><p id="6bc4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">结论</strong>:</p><p id="8803" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇博客中，我们广泛地介绍了这些数据所需的预处理步骤，然后使用网格搜索和KFolds找到了最适合的模型。我希望这篇博客已经让你对解决分类问题有了一个总体的了解。更多详细代码，请参考<a class="ae kc" href="https://github.com/pawanreddy-u/lendingclub" rel="noopener ugc nofollow" target="_blank">https://github.com/pawanreddy-u/lendingclub9</a></p></div></div>    
</body>
</html>