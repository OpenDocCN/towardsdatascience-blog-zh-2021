<html>
<head>
<title>Automating Emails in Apache Airflow: A How-To Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Apache Airflow中的电子邮件自动化:操作指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automating-emails-in-apache-airflow-a-how-to-guide-1d2330a29d1e?source=collection_archive---------4-----------------------#2021-07-02">https://towardsdatascience.com/automating-emails-in-apache-airflow-a-how-to-guide-1d2330a29d1e?source=collection_archive---------4-----------------------#2021-07-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="28f6" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="82d9" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">编写一个单步DAG以使用Python的SMTP库、Gmail和Apache Airflow自动化电子邮件的简单演练</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/7a10cf6fa8bb483632aa2dc71601b491.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ohbwqwore805L3_LDcI9Q.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@brett_jordan?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">布雷特·乔丹</a>在<a class="ae lh" href="https://unsplash.com/s/photos/email-automation?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="0510" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi me translated">作为一名数据工程师，我做的一些工作包括定期从第三方来源为组织中的各个团队自动提取数据。尽管我倾向于认为员工总是能够意识到新的数据拉取何时发生(哈！)，我不能指望他们每次都记得。正因为如此，<a class="ae lh" href="https://airflow.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Airflow </a>是一项出色的服务，可以在数据管道完成和新数据集处理完毕时，向相关方发送电子邮件提醒。</p><p id="97d6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Airflow不仅出色地协调了数据拉取本身，而且与Python库(如SMTP)配合得很好，便于将电子邮件传输给适当的收件人。</p><p id="4dc0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">在下面的快速指南中，我将带您在Apache Airflow中建立您的第一个有向无环图(DAG ),它编排了这个电子邮件自动化流程！</strong></p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="8662" class="mu mv it bd mw mx my dn mz na nb dp nc lr nd ne nf lv ng nh ni lz nj nk nl iz bi translated">先决条件#1:对Apache气流有基本的了解</h2><p id="ee4a" class="pw-post-body-paragraph li lj it lk b ll nm kd ln lo nn kg lq lr no lt lu lv np lx ly lz nq mb mc md im bi translated">如果您不知道什么是Apache Airflow，可以先通读下面的资源，以便更好地理解它的一些用例。</p><ul class=""><li id="7d73" class="nr ns it lk b ll lm lo lp lr nt lv nu lz nv md nw nx ny nz bi translated"><strong class="lk jd">气流官方文档:</strong><a class="ae lh" href="https://airflow.apache.org/docs/apache-airflow/stable/index.html" rel="noopener ugc nofollow" target="_blank">https://air flow . Apache . org/docs/Apache-air flow/stable/index . html</a></li><li id="5b2e" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated"><strong class="lk jd">一篇关于气流的好中帖:</strong><a class="ae lh" href="https://medium.com/swlh/apache-airflow-in-5-minutes-c005b4b11b26" rel="noopener">https://Medium . com/swlh/Apache-air flow-in-5-minutes-c 005 B4 b 11 b 26</a></li></ul><p id="b350" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">主要是，您需要对任务、操作符和Airflow的文件结构有一个基本的了解。</p><h2 id="6326" class="mu mv it bd mw mx my dn mz na nb dp nc lr nd ne nf lv ng nh ni lz nj nk nl iz bi translated">先决条件#2:配置您的Gmail帐户以使用Python的SMTP库</h2><p id="f0d3" class="pw-post-body-paragraph li lj it lk b ll nm kd ln lo nn kg lq lr no lt lu lv np lx ly lz nq mb mc md im bi translated">此外，使用SMTP的Python中的电子邮件自动化依赖于正确配置的发件人电子邮件地址。虽然可以使用许多不同的电子邮件提供商，但我发现Gmail让这变得非常容易。</p><p id="cb4c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了让发件人的电子邮件正确地使用SMTP和Python，您需要按照这里的说明<a class="ae lh" href="https://realpython.com/python-send-email/" rel="noopener ugc nofollow" target="_blank"><strong class="lk jd"/></a>(在选项1:设置Gmail开发帐户下)。这应该是一个很快的步骤，你需要将其中一个安全设置更改为“<a class="ae lh" href="https://myaccount.google.com/lesssecureapps" rel="noopener ugc nofollow" target="_blank"> <em class="of">允许不太安全的应用程序</em>到</a><em class="of"/>”。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="ef17" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当这两个先决条件都满足时，您将需要着手在本地机器上安装气流(如果您还没有这样做的话)。</p><h2 id="014f" class="mu mv it bd mw mx my dn mz na nb dp nc lr nd ne nf lv ng nh ni lz nj nk nl iz bi translated"><strong class="ak">气流安装</strong></h2><p id="6a9a" class="pw-post-body-paragraph li lj it lk b ll nm kd ln lo nn kg lq lr no lt lu lv np lx ly lz nq mb mc md im bi translated">如果/当你对气流感到舒适，你会想确保它安装在本地。如果您在这个过程中需要一些帮助，这里有一些本地安装的入门指南:</p><ul class=""><li id="6069" class="nr ns it lk b ll lm lo lp lr nt lv nu lz nv md nw nx ny nz bi translated"><strong class="lk jd">在Mac上安装:</strong><a class="ae lh" href="https://arpitrana.medium.com/install-airflow-on-macos-guide-fc66399b2a9e" rel="noopener">https://arpitrana . medium . com/install-air flow-on-Mac OS-guide-fc 66399 b2a9e</a></li><li id="3a64" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated"><strong class="lk jd">通过Docker安装:</strong><a class="ae lh" href="https://medium.com/@itunpredictable/apache-airflow-on-docker-for-complete-beginners-cf76cf7b2c9a" rel="noopener">https://medium . com/@ itun predictable/Apache-air flow-on-Docker-for-complete-初学者-cf76cf7b2c9a </a></li><li id="c913" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated"><strong class="lk jd">Windows 10上的安装:</strong><a class="ae lh" href="https://medium.com/@ryanroline/installing-apache-airflow-on-windows-10-5247aa1249ef" rel="noopener">https://medium . com/@ ryanroline/installing-Apache-air flow-on-Windows-10-5247 aa 1249 ef</a></li></ul><p id="7aaa" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">简单地说，如果你计划在Windows上安装Airflow(没有Docker)，你需要创建一个Linux子系统。以上指南中的说明应该会有所帮助，但是可能需要对您的本地设置进行一些配置才能使其工作。</p><h2 id="6190" class="mu mv it bd mw mx my dn mz na nb dp nc lr nd ne nf lv ng nh ni lz nj nk nl iz bi translated"><strong class="ak">运行气流</strong></h2><p id="9b88" class="pw-post-body-paragraph li lj it lk b ll nm kd ln lo nn kg lq lr no lt lu lv np lx ly lz nq mb mc md im bi translated">一旦你安装了Airflow，并且很好地掌握了软件本身，我们就可以开始了。</p><p id="0a55" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您还没有启动web服务器，请在终端窗口中运行以下命令:</p><pre class="ks kt ku kv gt og oh oi oj aw ok bi"><span id="e2db" class="mu mv it oh b gy ol om l on oo">airflow webserver</span></pre><p id="c322" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此外，您可以在单独的终端窗口中启动气流调度程序:</p><pre class="ks kt ku kv gt og oh oi oj aw ok bi"><span id="efa4" class="mu mv it oh b gy ol om l on oo">airflow scheduler</span></pre><p id="7007" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，您应该能够导航到<a class="ae lh" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a>(或者您为本地web服务器配置的任何端点)，并找到您的UI。</p><p id="e34c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了避免与其他帖子重复，并减少文章的长度，我不会详细介绍上传Dag。最后，当您启动web服务器时，如果您的目录和环境结构正确，您应该看到您的Dag加载到UI中。如果你第一次启动你的网络服务器，如果你在你的<code class="fe op oq or oh b">airflow.cfg</code>文件中配置了这个选项，你可能会在用户界面中看到一些样例Dag。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="a7fa" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，随着web服务器在您的本地机器上运行，我们可以创建将发送电子邮件的DAG。为了帮助指导你完成这个过程，我在GitHub上发布了我的DAG文件:</p><p id="fb12" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><a class="ae lh" href="https://github.com/zachalexander/airflow-medium-post" rel="noopener ugc nofollow" target="_blank">【https://github.com/zachalexander/airflow-medium-post】T4</a></p><p id="41f4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请随意克隆存储库并同时完成这项工作，或者通读下面的指南，然后使用代码将其集成到您的Dag中！</p><p id="92b4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">重要提示:</strong>对于那些已经经常使用Airflow的人来说，由于DAG文件只包含一些函数，所以您可以将这些函数集成到您已经设置好的任何管道中(并将其作为任务添加)。但是，出于本演练的目的，为了简单起见，我将把它创建为一个单独的单步dag。</p><h2 id="bd76" class="mu mv it bd mw mx my dn mz na nb dp nc lr nd ne nf lv ng nh ni lz nj nk nl iz bi translated">创建DAG</h2><p id="a05a" class="pw-post-body-paragraph li lj it lk b ll nm kd ln lo nn kg lq lr no lt lu lv np lx ly lz nq mb mc md im bi translated">要创建我们的电子邮件自动化DAG，我们可以导航到您的Airflow项目中的dags文件夹，它的结构应该类似于我的GitHub repo。您可以使用我现有的“email_automation.py”文件，也可以创建自己的空白python文件。目录结构的示例如下:</p><pre class="ks kt ku kv gt og oh oi oj aw ok bi"><span id="d7b4" class="mu mv it oh b gy ol om l on oo">airflow<br/>  dags/<strong class="oh jd"><br/>    email_automation.py</strong></span></pre><p id="d705" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这个python文件中，您可以在顶部添加以下导入:</p><pre class="ks kt ku kv gt og oh oi oj aw ok bi"><span id="23e8" class="mu mv it oh b gy ol om l on oo">from airflow import DAG<br/>from airflow.operators.python_operator import PythonOperator<br/>from datetime import timedelta<br/>import smtplib, ssl<br/>from email.mime.text import MIMEText<br/>from email.mime.multipart import MIMEMultipart</span></pre><p id="e309" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">第一个导入允许在Airflow中使用DAG功能，第二个导入允许使用<a class="ae lh" href="https://airflow.apache.org/docs/apache-airflow/stable/howto/operator/python.html" rel="noopener ugc nofollow" target="_blank"> Airflow的Python操作符</a>，稍后我们将使用它来启动电子邮件。导入<code class="fe op oq or oh b">timedelta</code>将帮助我们在DAG运行时间过长时调整超时间隔(气流最佳实践)。然后，我们将导入一些电子邮件和SMTP库，它们对于将电子邮件发送给我们的收件人是必不可少的。</p><p id="238d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这之后，我们可以添加我们的第一个函数声明，它被命名为<code class="fe op oq or oh b">send_email_basic()</code>:</p><pre class="ks kt ku kv gt og oh oi oj aw ok bi"><span id="827b" class="mu mv it oh b gy ol om l on oo">def send_email_basic(sender, receiver, email_subject):</span><span id="1670" class="mu mv it oh b gy os om l on oo">port = 465  # For SSL<br/>smtp_server = "smtp.gmail.com"<br/>sender_email = sender  # Enter your address<br/>receiver_email = receiver  # Enter receiver address<br/>password = 'env variable' # Enter your gmail password</span><span id="2f2c" class="mu mv it oh b gy os om l on oo">email_html = """<br/>&lt;html&gt;<br/>  &lt;body&gt;<br/>    &lt;p&gt;Hello!&lt;/p&gt;<br/>    &lt;p&gt;Add any text you'd like to the body of the e-mail here!&lt;/p&gt;   &lt;br&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;<br/>"""</span><span id="31ba" class="mu mv it oh b gy os om l on oo">message = MIMEMultipart("multipart")</span><span id="b0ed" class="mu mv it oh b gy os om l on oo"># Turn these into plain/html MIMEText objects</span><span id="dadc" class="mu mv it oh b gy os om l on oo">part2 = MIMEText(email_html, "html")</span><span id="a3e4" class="mu mv it oh b gy os om l on oo"># Add HTML/plain-text parts to MIMEMultipart message<br/># The email client will try to render the last part first</span><span id="d578" class="mu mv it oh b gy os om l on oo">message.attach(part2)<br/>message["Subject"] = email_subject<br/>message["From"] = sender_email</span><span id="d15b" class="mu mv it oh b gy os om l on oo">## iterating through the receiver list</span><span id="c641" class="mu mv it oh b gy os om l on oo">for i, val in enumerate(receiver):<br/>message["To"] = val<br/>context = ssl.create_default_context()</span><span id="a67a" class="mu mv it oh b gy os om l on oo">with smtplib.SMTP_SSL(smtp_server, port, context=context) as server:<br/>server.login(sender_email, password)<br/>server.sendmail(sender_email, receiver_email, message.as_string())</span></pre><p id="ce39" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这项职能中，我们要做几件事:</p><ul class=""><li id="5653" class="nr ns it lk b ll lm lo lp lr nt lv nu lz nv md nw nx ny nz bi translated">我们正在识别SSL端口</li><li id="abee" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated">识别SMTP服务器</li><li id="a199" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated">将发件人和收件人地址以及发件人的电子邮件密码存储在变量中。</li><li id="0355" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated">为电子邮件正文创建一个包含自定义html的文本字符串，并将其保存到一个变量中</li><li id="4205" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated">将电子邮件标识为“多部分”电子邮件，并将正文文本附加到我们的电子邮件中</li><li id="dd90" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated">将“主题”和“发件人”参数附加到邮件中</li><li id="2035" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated">遍历我们的收件人列表(在电子邮件有多个收件人的情况下),以添加到消息的“to”参数中</li><li id="800d" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated">连接到我们的服务器，发送带有消息参数“收件人”、“发件人”、“主题”和“消息”的电子邮件。</li></ul><p id="4f3a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">虽然看起来有很多，但是函数调用非常简单。想了解更多关于上述电子邮件术语的信息，请点击这里阅读这个过程:<a class="ae lh" href="https://realpython.com/python-send-email/" rel="noopener ugc nofollow" target="_blank">https://realpython.com/python-send-email/</a>(和上面的文章一样，把你的Gmail账户设置成一个合适的发件人)。</p><p id="e48e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，我们可以声明我们的下一个函数:</p><pre class="ks kt ku kv gt og oh oi oj aw ok bi"><span id="7181" class="mu mv it oh b gy ol om l on oo">def init_email():</span><span id="55b7" class="mu mv it oh b gy os om l on oo">sender = "yourgmailaddress@gmail.com" # add the sender gmail address here</span><span id="917e" class="mu mv it oh b gy os om l on oo">recipients = ["email address 1", "email address 2"] # add your e-mail recipients here</span><span id="d412" class="mu mv it oh b gy os om l on oo">subject = "Subject Line" # add the subject of the e-mail you'd like here</span><span id="38b0" class="mu mv it oh b gy os om l on oo">send_email_basic(sender, recipients, subject)</span></pre><p id="a382" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们的Python操作者将使用这个函数<code class="fe op oq or oh b">init_email()</code>来触发我们的电子邮件。下面是对上述情况的分析:</p><ul class=""><li id="438a" class="nr ns it lk b ll lm lo lp lr nt lv nu lz nv md nw nx ny nz bi translated">我们将我们的发件人地址(即您将用来发送电子邮件的Gmail地址)保存在发件人变量中</li><li id="2111" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated">我们将收件人地址作为列表保存在recipients变量中。在这里，因为我们已经在前面的函数中设置了一个遍历这个列表的方法，所以我们可以在这里的列表中列出我们的电子邮件地址。</li><li id="72a8" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated">我们正在为主题行创建文本，并将其保存到主题变量中</li><li id="24d3" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated">最后，我们将把这些变量作为参数添加到初始的<code class="fe op oq or oh b">send_email_basic()</code>函数中</li></ul><p id="d0c9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，我们可以设置我们的气流语法来初始化这个DAG并添加所需的参数:</p><pre class="ks kt ku kv gt og oh oi oj aw ok bi"><span id="fb87" class="mu mv it oh b gy ol om l on oo">default_args = {<br/>  'owner': 'airflow',<br/>  'depends_on_past': False,<br/>  'start_date': 'trigger date',<br/>  'email': ['your Airflow email'],<br/>  'email_on_failure': True,<br/>  'email_on_retry': True,<br/>  'retries': 0<br/>}</span><span id="e6b0" class="mu mv it oh b gy os om l on oo">dag = DAG('email_automation',<br/>           default_args=default_args,<br/>           dagrun_timeout=timedelta(minutes=5),<br/>         # schedule_interval = '0 13 * * 1', # if you want to set up an automation schedule you can do that here<br/>           catchup=False<br/>)</span><span id="794b" class="mu mv it oh b gy os om l on oo">t1 = PythonOperator(<br/>     task_id='send_email',<br/>     python_callable=init_email,<br/>     dag=dag<br/>)</span><span id="3ee9" class="mu mv it oh b gy os om l on oo">t1</span></pre><p id="35e1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们正在做以下工作:</p><ul class=""><li id="cf2b" class="nr ns it lk b ll lm lo lp lr nt lv nu lz nv md nw nx ny nz bi translated">为DAG创建默认参数，类似于气流文档。</li><li id="0fc1" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated">创建我们的DAG()，将其命名为<code class="fe op oq or oh b">email_automation</code>。</li><li id="1eca" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated">使用PythonOperator()创建任务，调用我们的<code class="fe op oq or oh b">init_email</code> python函数。</li><li id="914e" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated">给我们的任务是<code class="fe op oq or oh b">t1</code>。</li></ul><p id="2259" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦这一切准备就绪，你的DAG文件应该都设置好了！通过运行:</p><pre class="ks kt ku kv gt og oh oi oj aw ok bi"><span id="ec6d" class="mu mv it oh b gy ol om l on oo">airflow init db</span></pre><p id="cfa6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，您应该能够看到一个新的dag作为<strong class="lk jd"> email_automation </strong>加载进来。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ot"><img src="../Images/1cd4727aac49d21b808225ffbc2e3611.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oN07mDeFNjMnjY3zGiAydA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">带有正确加载的email _ automation DAG | Image by author的气流用户界面</p></figure><h2 id="c8f7" class="mu mv it bd mw mx my dn mz na nb dp nc lr nd ne nf lv ng nh ni lz nj nk nl iz bi translated">为您自己的使用情形定制此DAG</h2><p id="45c5" class="pw-post-body-paragraph li lj it lk b ll nm kd ln lo nn kg lq lr no lt lu lv np lx ly lz nq mb mc md im bi translated">如果你已经做到了这一步，那么恭喜你！有了这个DAG示例，您现在可以做许多不同的事情:</p><ul class=""><li id="eb2b" class="nr ns it lk b ll lm lo lp lr nt lv nu lz nv md nw nx ny nz bi translated">如果您想真正实现自动化，可以每隔一段时间(例如每天、每周等)向收件人发送一封电子邮件。)，您可以在上面的DAG中取消注释“schedule_interval”语法。关于如何为这段代码创建语法的更多信息可以在<a class="ae lh" rel="noopener" target="_blank" href="/airflow-schedule-interval-101-bbdda31cc463"> <strong class="lk jd">这里</strong> </a>找到。</li><li id="d7a2" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated">此外，您可以通过调整“email_html”变量文本来编辑电子邮件正文。</li><li id="5cc4" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated">正如我在开篇中提到的，我已经将这个DAG中的这些函数作为一个更大的管道中的任务来使用。例如，我在数据拉取的末尾添加了一个电子邮件任务，向接收者发送通知，告知新数据已经加载，新文件已经创建，等等。假设您可以自定义电子邮件正文语言，您可以添加到最终数据源的链接，以及关于管道实例本身的任何其他重要信息。</li></ul><p id="7fbf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，Apache Airflow帮助数据工程师自动化了很多事情！我希望这个演练是一个有用的演示，展示了如何有效地使用SMTP库和Python来使电子邮件自动化成为一项简单的任务！</p><p id="ebfa" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">感谢阅读！如果您喜欢这篇文章，请随意访问我的其他文章，在那里我讨论了我从事的其他数据工程、数据科学和数据可视化项目。</p><p id="b2cf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此外，请查看我的投资组合:<a class="ae lh" href="https://zach-alexander.com" rel="noopener ugc nofollow" target="_blank"><strong class="lk jd">【zach-alexander.com】</strong></a>。</p></div></div>    
</body>
</html>