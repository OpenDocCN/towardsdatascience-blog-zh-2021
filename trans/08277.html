<html>
<head>
<title>The Easiest Way to Pull Stock Data into your Python Program: yfinance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将股票数据放入Python程序的最简单方法:yfinance</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-easiest-way-to-pull-stock-data-into-your-python-program-yfinance-82c304ae35dc?source=collection_archive---------4-----------------------#2021-07-30">https://towardsdatascience.com/the-easiest-way-to-pull-stock-data-into-your-python-program-yfinance-82c304ae35dc?source=collection_archive---------4-----------------------#2021-07-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c678" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于yfinance及如何设置的初步探讨。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7648480dfc7449f42f53148bf5289d36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HK2leFmiZgKoLapKLRLnGA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我最近在用yfinance做一个树莓Pi股票行情。请继续关注教程。(图片由作者提供)</p></figure><p id="cee9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最近我一直在做一个有趣的股票报价项目，我遇到了一些我以前从未想过的事情:<em class="lu">将当前和历史股票市场价格数据拉入我的Python程序的最佳方式是什么？</em></p><p id="e98d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">事实证明，对我来说，最好的选择是<strong class="la iu">y Finance</strong>——这是一个Python库，它给你提供来自雅虎财经的当前和历史股票市场价格数据，等等。最酷的是它完全免费，不需要API密匙，并且允许每小时2000个请求的相对较高的吞吐量。更酷的是你(是的，就是你！)可以很容易地将股票数据输入到Python程序中，就像我下面展示的这几个步骤一样简单。</p><h2 id="54a3" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">设置</h2><p id="8093" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">我使用的是Python 3.8，但是任何高于Python 3.4的版本都应该被支持。您可以在Linux、Mac或Windows上运行。(如果你使用Windows，我建议你<a class="ae mt" href="https://medium.com/@kombustion/a-modern-linux-setup-for-the-modern-windows-developer-b7e0c2ad212e" rel="noopener">看看WSL2，如何开始，以及它能做的一切</a>——如果你使用WSL2，一定要遵循Linux命令)</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><p id="7409" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我们要创建名为<code class="fe nb nc nd ne b">env</code>的Python虚拟环境，并激活它。</p><p id="2598" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">对于Linux/Mac终端</strong></p><pre class="kj kk kl km gt nf ne ng nh aw ni bi"><span id="21d5" class="lv lw it ne b gy nj nk l nl nm">python3 -m venv env</span><span id="b8e1" class="lv lw it ne b gy nn nk l nl nm">source env/bin/activate</span></pre><p id="91f5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">针对Windows PowerShell </strong></p><pre class="kj kk kl km gt nf ne ng nh aw ni bi"><span id="1937" class="lv lw it ne b gy nj nk l nl nm">python3 -m venv env</span><span id="1782" class="lv lw it ne b gy nn nk l nl nm">.\env\Scripts\Activate.ps1</span></pre></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><p id="52c8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们已经设置并激活了Python虚拟环境，让我们将yfinance安装到这个虚拟环境中，这样我们就可以使用它了。下一个命令对于任何平台都是一样的。</p><p id="f3d5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nb nc nd ne b">pip install yfinance</code></p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h2 id="e4bf" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">获取当前股票价格数据</h2><p id="c2ad" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">现在yfinance已经安装好了，我们准备写一些Python代码了！</p><p id="f061" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们试试yfinance的一些最基本，但可能是最常用的功能。</p><p id="62a0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我正在研究股票行情，所以我想知道股票的当前价格。让我们获取一只股票的当前价格和之前的收盘价——在这个Python例子中，我们将使用TSLA。</p><pre class="kj kk kl km gt nf ne ng nh aw ni bi"><span id="206a" class="lv lw it ne b gy nj nk l nl nm">import yfinance as yf</span><span id="9773" class="lv lw it ne b gy nn nk l nl nm">stock_info = yf.Ticker('TSLA').info<br/># stock_info.keys() for other properties you can explore</span><span id="aee8" class="lv lw it ne b gy nn nk l nl nm">market_price = stock_info['regularMarketPrice']<br/>previous_close_price = stock_info['regularMarketPreviousClose']</span><span id="4a2b" class="lv lw it ne b gy nn nk l nl nm">print('market price ', market_price)<br/>print('previous close price ', previous_close_price)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/e20c3ad613f8aef7cd7bbb27c2d213b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MEkJ0P1-ykpEj1gq6YXmaw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上面代码的输出。(图片由作者提供)</p></figure><p id="6c5b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好的，如果我们在股票市场开放的时间运行这个，价格信息会实时变化和更新。更新速度有多快？价格的变化和雅虎财经更新价格一样快，这对于我的目的来说已经足够快了。对于像高频交易机器人这样的东西来说，它可能不够快，但Python可能不是最好的。</p><h2 id="56eb" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">获取历史股票价格数据</h2><p id="1fdb" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">接下来我们来看一些历史数据。如果我们想要绘制它，我们将不得不安装一些额外的Python库来帮助我们——matplotlib来绘制，pendulum来为我们做一些简单的时间转换。</p><p id="75aa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nb nc nd ne b">pip install matplotlib pendulum</code></p><p id="c213" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在让我们看看TSLA过去2年的股价，每隔1个月。您可以看到这些数字非常灵活，可以根据您的使用情况进行更改。</p><pre class="kj kk kl km gt nf ne ng nh aw ni bi"><span id="6bb9" class="lv lw it ne b gy nj nk l nl nm">import yfinance as yf<br/>import pendulum<br/>import matplotlib.pyplot as plt</span><span id="ed7c" class="lv lw it ne b gy nn nk l nl nm">price_history = yf.Ticker('TSLA').history(period='2y', # valid periods: 1d,5d,1mo,3mo,6mo,1y,2y,5y,10y,ytd,max<br/>                                   interval='1wk', # valid intervals: 1m,2m,5m,15m,30m,60m,90m,1h,1d,5d,1wk,1mo,3mo<br/>                                   actions=False)</span><span id="7294" class="lv lw it ne b gy nn nk l nl nm">time_series = list(price_history['Open'])<br/>dt_list = [pendulum.parse(str(dt)).float_timestamp for dt in list(price_history.index)]</span><span id="5821" class="lv lw it ne b gy nn nk l nl nm">plt.style.use('dark_background')</span><span id="bff4" class="lv lw it ne b gy nn nk l nl nm">plt.plot(dt_list, time_series, linewidth=2)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/d7b5901cba12d47f70c852ce82488e61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v97dJpdsEBwqYa2Msdik7A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们从上面的代码中得到的情节。哇，价格涨了很多。(图片由作者提供)</p></figure><h2 id="be7f" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">结论</h2><p id="2492" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">我希望你能像我一样，发现yfinance库的建立和整合非常容易！这里有很多值得探索的地方，更多信息和例子可以在<a class="ae mt" href="https://pypi.org/project/yfinance/" rel="noopener ugc nofollow" target="_blank">https://pypi.org/project/yfinance/</a>找到。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><p id="eac7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> <em class="lu">来自《走向数据科学》编辑的提示:</em> </strong> <em class="lu">虽然我们允许独立作者根据我们的</em> <a class="ae mt" rel="noopener" target="_blank" href="/questions-96667b06af5"> <em class="lu">规则和指导方针</em> </a> <em class="lu">发表文章，但我们不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的</em> <a class="ae mt" rel="noopener" target="_blank" href="/readers-terms-b5d780a700a4"> <em class="lu">读者术语</em> </a> <em class="lu">。</em></p></div></div>    
</body>
</html>