<html>
<head>
<title>Time Series From Scratch — AutoRegression Theory and Implementation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从零开始的时间序列——自回归理论与实现</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-from-scratch-autoregression-theory-and-implementation-f8c614f738f2?source=collection_archive---------8-----------------------#2021-08-21">https://towardsdatascience.com/time-series-from-scratch-autoregression-theory-and-implementation-f8c614f738f2?source=collection_archive---------8-----------------------#2021-08-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="c0c8" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/time-series-from-scratch" rel="noopener" target="_blank">时间序列从无到有</a></h2><div class=""/><div class=""><h2 id="ec27" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">将回归应用于时间序列问题——如何做，值得这么麻烦吗？</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/eec8fabedc21730d6730be781c2b6b5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JAW0Ium6o8Bt6YuHhIf_Xw.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">Pawel Czerwinski 在<a class="ae lh" href="https://unsplash.com/s/photos/abstract?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="1213" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">到目前为止，你知道所有关于移动平均线的东西——不管是简单的还是指数加权的。现在是时候介绍自回归了，这是更高级预测模型的一个基本主题。</p><p id="04ba" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将在实现之前讨论基础理论，包括直觉和一些数学知识。一般来说，您应该熟悉<a class="ae lh" rel="noopener" target="_blank" href="/time-series-analysis-from-scratch-seeing-the-big-picture-2d0f9d837329">时间序列</a>，因此如果您对该主题不熟悉，请从头开始阅读该序列。前几篇文章的链接在这篇文章的末尾。</p><p id="724d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这篇文章的结构如下:</p><ul class=""><li id="9515" class="me mf it lk b ll lm lo lp lr mg lv mh lz mi md mj mk ml mm bi translated">自回归—理论和数学</li><li id="7cc8" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">自回归Python中的实现</li><li id="7a64" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">自回归-选择最佳参数值</li><li id="25fb" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">结论</li></ul></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="fd41" class="mz na it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">自回归—理论和数学</h1><p id="e9d3" class="pw-post-body-paragraph li lj it lk b ll nr kd ln lo ns kg lq lr nt lt lu lv nu lx ly lz nv mb mc md im bi translated">术语<em class="nw">自回归</em> (AR)与统计中的常规回归密切相关。唯一的问题是AR模型以滞后格式使用来自相同输入变量的数据——因此出现了<em class="nw">自回归</em>的<em class="nw">自动</em>部分。</p><p id="5533" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">自回归的预测能力有限，就像简单移动平均线T21一样。该算法使用过去值的线性组合来进行未来预测。</p><p id="ea05" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一般自回归模型用以下公式表示:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nx"><img src="../Images/c94837806de787ed7cfb1317c0dfef57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0G6zsTl1yi2YO-6TbvgVXQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片1-通用自回归模型公式(作者图片)</p></figure><p id="e44e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">其中<code class="fe ny nz oa ob b">c</code>为常数，<code class="fe ny nz oa ob b">phi</code>为达到<code class="fe ny nz oa ob b">p</code>阶的滞后系数，<code class="fe ny nz oa ob b">epsilon</code>为不可约误差(白噪声)。</p><p id="857d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用AR模型时，您只需指定参数<code class="fe ny nz oa ob b">p</code>的值。如果<code class="fe ny nz oa ob b">p=1</code>，那么AR模型公式简化为:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/e29bcd00123e9ce30e300b5ce2265782.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*7xPiknw1FB2v2UayGyOATw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片2 — AR(1)模型公式(图片由作者提供)</p></figure><p id="4fd5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">就这么简单！</p><p id="7e3f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">更高阶的<code class="fe ny nz oa ob b">p</code>往往会给出更好的预测结果，但仅限于某一点。稍后您将看到如何自动为<code class="fe ny nz oa ob b">p</code>选择最佳值。但是首先，让我们看看如何用Python实现自回归。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="0c64" class="mz na it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">自回归Python中的实现</h1><p id="93a1" class="pw-post-body-paragraph li lj it lk b ll nr kd ln lo ns kg lq lr nt lt lu lv nu lx ly lz nv mb mc md im bi translated">今天，您将创建自己的数据集。这是一条简单的加了一点噪声的直线:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="556a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">它看起来是这样的:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi of"><img src="../Images/728839d53d01522405e58847b234790a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1sMXKuOsR_DuRfW-1rjrbg.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片3-随机直线数据集(图片由作者提供)</p></figure><p id="c07b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下一步是将数据集分成训练和测试子集。如果你不熟悉这个过程，请阅读这篇文章。您将使用最后10个数据点进行测试，其他数据点用于训练:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="1077" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是两个数据集的样子:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi of"><img src="../Images/d34f80d1d6901ce6198bc26b5e30add4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0RQfO9liULutg5jIvdQeWA.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图4 —训练集和测试集(图片由作者提供)</p></figure><p id="102a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">整洁！接下来，您将声明一个用于训练和可视化AR模型的函数— <code class="fe ny nz oa ob b">train_and_plot(maxlag: int)</code>。这个函数是为了方便您避免一遍又一遍地复制粘贴几乎相同的代码。它在训练集上训练<code class="fe ny nz oa ob b">AR(p=maxlag)</code>模型，并以图形方式比较预测和测试集。</p><p id="3936" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">该函数还在绘图副标题中打印模型系数，因此如果您愿意，可以将它们与前面讨论的数学公式联系起来。</p><p id="91db" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">代码如下:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="90db" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您现在可以使用这个函数，通过在新的单元格中执行<code class="fe ny nz oa ob b">train_and_plot(maxlag=1)</code>来训练一个简单的AR(1)模型。它显示如下图:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi of"><img src="../Images/f0051d0873bff2449b3af5ded299fb6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vbyxZBrOhCMD6uo-INQ7KQ.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片5 — AR(1)模型(图片由作者提供)</p></figure><p id="93a3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可以将参数<code class="fe ny nz oa ob b">p</code>更改为您想要的任何值。例如，AR(2)模型的结果如下所示(<code class="fe ny nz oa ob b">train_and_plot(maxlag=2)</code>):</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi of"><img src="../Images/e125cb809038fb054a1b750674f6b075.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tVtucfxV-Od3c1-cwFN-sA.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片6 — AR(2)模型(图片由作者提供)</p></figure><p id="c76e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">问题依然存在— <strong class="lk jd">这个数据集的最佳AR模型阶数是多少？让我们在下一部分回答这个问题。</strong></p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="ad12" class="mz na it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">自回归-选择最佳参数值</h1><p id="32c9" class="pw-post-body-paragraph li lj it lk b ll nr kd ln lo ns kg lq lr nt lt lu lv nu lx ly lz nv mb mc md im bi translated">用AR(1)和AR(2)得到的预测看起来并不乐观。你总是想优化<code class="fe ny nz oa ob b">p</code>的值。一种方法是绘制自相关图和偏自相关图，并对其进行检查，但这工作量太大。</p><p id="42c0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">更好的方法是在一个循环中训练AR(1)到AR(n)模型，并跟踪测试集的性能。您可以使用RMSE或任何其他指标来实现这一点。</p><p id="6f72" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面是一个简单的代码片段:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="8291" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">以下是AR(1)至AR(10)模型的误差:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi og"><img src="../Images/0c5776a6aca1a790a3e73627bef0c651.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*W7ZKJvVXxHug-LMGNqWAtg.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图7 — AR模型在测试集上获得的错误(图片由作者提供)</p></figure><p id="96aa" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">看起来AR(5)模型在测试集上产生了最低的误差。以下是数据集和预测在此模型顺序中的样子:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi of"><img src="../Images/08160e431ac9107e460eca3b34738a2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rJfEwA1-fRlgINR2BuLqdg.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图8 —优化的AR模型预测(图片由作者提供)</p></figure><p id="11cb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用AIC度量进行评估也是很常见的，因为它更倾向于简单的模型而不是复杂的模型。这两个指标都表明AR(5)是最好的模型。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="e9c8" class="mz na it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">最后的话</h1><p id="c8a9" class="pw-post-body-paragraph li lj it lk b ll nr kd ln lo ns kg lq lr nt lt lu lv nu lx ly lz nv mb mc md im bi translated">总之，您可以使用AR模型来预测简单的数据集。该算法与移动平均模型结合使用时效果最佳，这是我们将在下一篇文章中讨论的主题。</p><p id="44ca" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你决定对像<em class="nw">航空乘客</em>这样的数据集应用AR模型，不管模型顺序如何，你都不会得到好的预测结果。让数据集保持平稳可能会有所帮助，但预测仍然没有使用<a class="ae lh" rel="noopener" target="_blank" href="/time-series-from-scratch-exponential-smoothing-theory-and-implementation-6683eb271bad">指数平滑法</a>预测的好。</p><p id="be1b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将在下一篇文章中探讨将自回归和移动平均结合成一个单一模型(ARMA)是否会有所帮助。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><p id="0537" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="nw">喜欢这篇文章吗？成为</em> <a class="ae lh" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="nw">中等会员</em> </a> <em class="nw">继续无限制学习。如果您使用以下链接，我将收取您的部分会员费，无需您支付额外费用:</em></p><div class="oh oi gp gr oj ok"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd jd gy z fp op fr fs oq fu fw jc bi translated">通过我的推荐链接加入Medium-Dario rade ci</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">medium.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy lb ok"/></div></div></a></div></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="83de" class="mz na it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">阅读整个系列</h1><ol class=""><li id="0978" class="me mf it lk b ll nr lo ns lr oz lv pa lz pb md pc mk ml mm bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/time-series-analysis-from-scratch-seeing-the-big-picture-2d0f9d837329">纵观全局</a></li><li id="6d35" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md pc mk ml mm bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/time-series-from-scratch-introduction-to-time-series-with-pandas-347ac9c6b451">熊猫时间序列介绍</a></li><li id="29ae" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md pc mk ml mm bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/time-series-from-scratch-white-noise-and-random-walk-5c96270514d3">白噪声和随机游走</a></li><li id="9cc1" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md pc mk ml mm bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/time-series-from-scratch-decomposing-time-series-data-7b7ad0c30fe7">分解时间序列数据</a></li><li id="4df1" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md pc mk ml mm bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/time-series-from-scratch-autocorrelation-and-partial-autocorrelation-explained-1dd641e3076f">自相关和偏自相关</a></li><li id="6754" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md pc mk ml mm bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/time-series-from-scratch-stationarity-tests-and-automation-14b02fa5ca4d">稳定性测试和自动化</a></li><li id="0f1a" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md pc mk ml mm bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/time-series-from-scratch-train-test-splits-and-evaluation-metrics-4fd654de1b37">培训/测试分割和评估指标</a></li><li id="2fb3" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md pc mk ml mm bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/time-series-from-scratch-moving-averages-ma-theory-and-implementation-a01b97b60a18">移动平均线(MA)理论与实现</a></li><li id="933b" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md pc mk ml mm bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/time-series-from-scratch-exponentially-weighted-moving-averages-ewma-theory-and-implementation-607661d574fe">指数加权移动平均线(EWMA)理论及实现</a></li><li id="88f9" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md pc mk ml mm bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/time-series-from-scratch-exponential-smoothing-theory-and-implementation-6683eb271bad">指数平滑理论及实现</a></li></ol></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="dc14" class="mz na it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">保持联系</h1><ul class=""><li id="31c1" class="me mf it lk b ll nr lo ns lr oz lv pa lz pb md mj mk ml mm bi translated">关注我在<a class="ae lh" href="https://medium.com/@radecicdario" rel="noopener">媒体</a>上的更多类似的故事</li><li id="ecae" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">注册我的<a class="ae lh" href="https://mailchi.mp/46a3d2989d9b/bdssubscribe" rel="noopener ugc nofollow" target="_blank">简讯</a></li><li id="2894" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">在<a class="ae lh" href="https://www.linkedin.com/in/darioradecic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上连接</li></ul></div></div>    
</body>
</html>