<html>
<head>
<title>SHAP: Explain Any Machine Learning Model in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SHAP:用Python解释任何机器学习模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/shap-explain-any-machine-learning-model-in-python-24207127cad7?source=collection_archive---------0-----------------------#2021-09-24">https://towardsdatascience.com/shap-explain-any-machine-learning-model-in-python-24207127cad7?source=collection_archive---------0-----------------------#2021-09-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="d6a4" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/getting-started" rel="noopener" target="_blank">入门</a></h2><div class=""/><div class=""><h2 id="0fda" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">SHAP和沙普利价值观综合指南</h2></div><h1 id="b873" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">动机</h1><p id="5364" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">想象一下，你正在试图训练一个机器学习模型来预测一个广告是否被特定的人点击。在收到一个人的一些信息后，模型预测一个人不会点击某个广告。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mf"><img src="../Images/c63271904023e26890376b35f4b71395.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5QQ_muWtxOg1wkJiwjCSBg.png"/></div></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><p id="92d8" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">但是为什么这个模型预测到了这一点呢？每个特征对预测的贡献有多大？如果您能看到一个如下图所示的曲线图，显示每个要素对预测的贡献大小，那不是很好吗？</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div class="gh gi na"><img src="../Images/0d99dce278251252a831885c2aa6dd0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*2S2UqB0tcMgowHbc9R9_mQ.png"/></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><p id="054d" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">这就是Shapley值派上用场的时候。</p><h1 id="5ab2" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">什么是沙普利值？</h1><p id="fbb1" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">Shapley值是博弈论中使用的一种方法，它涉及到将收益和成本公平地分配给联盟中的参与者。</p><p id="0736" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">由于每个参与者对联盟的贡献不同，沙普利值确保每个参与者<strong class="ll jd">根据他们贡献的多少得到公平的份额。</strong></p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi nb"><img src="../Images/b5bcc2cc65a2887fb5fe715deb1e9909.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qrtuTu4ZjA-SwdcGf-PkrA.png"/></div></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><h2 id="4e44" class="nc ks it bd kt nd ne dn kx nf ng dp lb ls nh ni ld lw nj nk lf ma nl nm lh iz bi translated">简单的例子</h2><p id="4a78" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">Shapley值广泛用于质疑一个组中每个工作者/特征的贡献的问题。为了理解Shapley value是如何工作的，让我们想象一下你的公司刚刚进行了A/B测试，他们测试了不同的广告策略组合。</p><p id="1371" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">每个策略在特定月份的收入如下:</p><ul class=""><li id="7e9d" class="nn no it ll b lm mv lp mw ls np lw nq ma nr me ns nt nu nv bi translated">没有广告:150美元</li><li id="572c" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">社交媒体:300美元</li><li id="20b1" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">谷歌广告:200美元</li><li id="9998" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">电子邮件营销:350美元</li><li id="fbba" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">社交媒体和谷歌广告320美元</li><li id="18f2" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">社交媒体和电子邮件营销:400美元</li><li id="ab0c" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">谷歌广告和电子邮件营销:350美元</li><li id="6802" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">电子邮件营销、谷歌广告和社交媒体:450美元</li></ul><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi ob"><img src="../Images/6544d769de1dd88011265c86922d07d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*USvWgOflrKaDd76tv_9eWA.png"/></div></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><p id="f931" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">使用三个广告和不使用广告的收入相差300美元。<strong class="ll jd">每个广告对这种差异的贡献有多大？</strong></p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi oc"><img src="../Images/ee249079e831fe8ce980e76fd47989c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ne7amGdQ7DOOS6ia0Kc_OA.png"/></div></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><p id="e051" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">我们可以通过计算每种广告的Shapley值来找出答案。<a class="ae od" rel="noopener" target="_blank" href="/shap-explained-the-way-i-wish-someone-explained-it-to-me-ab81cc69ef30">这篇文章</a>提供了一个计算Shap值的好方法。我在这里总结一下。</p><p id="3276" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">我们首先计算谷歌广告对公司收入的总贡献。谷歌广告的总贡献可以通过以下公式计算:</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi oe"><img src="../Images/0abbea1dd81f213060a480214fc596d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*w62Q_L1UEFTUO7hoAKu1EA.png"/></div></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><p id="79e4" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">让我们找出谷歌广告的边际贡献和权重。</p><h2 id="3729" class="nc ks it bd kt nd ne dn kx nf ng dp lb ls nh ni ld lw nj nk lf ma nl nm lh iz bi translated">寻找谷歌广告的边际贡献</h2><p id="5909" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">首先，我们会发现谷歌广告对以下群体的边际贡献:</p><ul class=""><li id="3835" class="nn no it ll b lm mv lp mw ls np lw nq ma nr me ns nt nu nv bi translated">没有广告</li><li id="aff8" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">谷歌广告+社交媒体</li><li id="2977" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">谷歌广告+电子邮件营销</li><li id="6ce6" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">谷歌广告+电子邮件营销+社交媒体</li></ul><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi ob"><img src="../Images/e8932db377d5b0fee658d2c9a02537f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G6T4jHXHy4xiNkyEoqc21Q.png"/></div></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><p id="19e7" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">谷歌广告对无广告的边际贡献是:</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi of"><img src="../Images/906a7180a2f6fade7cee956a7da25695.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*XGhu3qRfk2YCISHsuVz35g.png"/></div></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><p id="8f46" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">谷歌广告对谷歌广告和社交媒体集团的边际贡献是:</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi og"><img src="../Images/1fed27be53b53423d5df4af9b5d6c556.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*voNgbSUywO29r1inaUaqDw.png"/></div></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><p id="1e73" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">谷歌广告对谷歌广告和电子邮件营销集团的边际贡献是:</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/316b5c9455d70eaa51e31eef2e77e099.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*7P9uadSgX14kF6zU6hyXtA.png"/></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><p id="831f" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">谷歌广告对谷歌广告、电子邮件营销和社交媒体集团的边际贡献是:</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/04b113be90ef52d6fa468022b40f4485.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*BrlGpLuVFaDoohxg9J4VUQ.png"/></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><h2 id="f3fc" class="nc ks it bd kt nd ne dn kx nf ng dp lb ls nh ni ld lw nj nk lf ma nl nm lh iz bi translated">寻找重量</h2><p id="8a06" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">为了找到权重，我们将把不同广告策略的组合组织成多个层次，如下所示。每个级别对应于每个组合中广告策略的数量。</p><p id="95da" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">然后，我们将根据每个级别中的边数来分配权重。我们看到:</p><ul class=""><li id="9c36" class="nn no it ll b lm mv lp mw ls np lw nq ma nr me ns nt nu nv bi translated">第一层包含<strong class="ll jd"> 3条边</strong>，因此每条边的权重将是<strong class="ll jd">的1/3 </strong></li><li id="ec69" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">第二层包含<strong class="ll jd"> 6条边</strong>，因此每条边的权重为<strong class="ll jd"> 1/6 </strong></li><li id="2f67" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">第三层包含<strong class="ll jd"> 3条边</strong>，因此每条边的权重将为<strong class="ll jd"> 1/3 </strong></li></ul><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi ob"><img src="../Images/c9c9826270b635b8e316a8369e17e1b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6YxzTWyhMSiP_C3FlMS_5Q.png"/></div></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><h2 id="02df" class="nc ks it bd kt nd ne dn kx nf ng dp lb ls nh ni ld lw nj nk lf ma nl nm lh iz bi translated">找出谷歌广告的总贡献</h2><p id="ba42" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">现在我们已经准备好根据之前找到的权重和边际贡献来找到谷歌广告的总贡献了！</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi ob"><img src="../Images/7ae108d7abb5b05b58908ce6fad71eda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CfuMK37v-xBroLN_7WPrFQ.png"/></div></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/87c5e0abed832a7cd14ab801a6d7cfdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*-fEDnX3JSeHzZNUm7YMyDg.png"/></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><p id="0f78" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">酷！因此，谷歌广告为使用3种广告策略和不使用广告之间的总收入差异贡献了36.67美元。36.67是谷歌广告的Shapey值。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi oc"><img src="../Images/0d825026133b14e324654e8960a6b1cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FsOvcHrKEMXNTKxVSRvzgQ.png"/></div></div></figure><p id="33e1" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">对另外两种广告策略重复上述步骤，我们可以看到:</p><ul class=""><li id="7800" class="nn no it ll b lm mv lp mw ls np lw nq ma nr me ns nt nu nv bi translated">电子邮件营销贡献了151.67美元</li><li id="2d8d" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">社交媒体贡献了111.67美元</li><li id="cbf0" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">谷歌广告贡献36.67美元</li></ul><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi ok"><img src="../Images/1bf06b15484d98353469118ada95702b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*64XofqQSmiG7JcEMewRT3Q.png"/></div></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><p id="ecc2" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">他们共同贡献了300美元来区别使用3种不同类型的广告和不使用广告！很酷，不是吗？</p><p id="8ba0" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">现在我们已经了解了Shapley值，让我们看看如何使用它来解释机器学习模型。</p><h1 id="1424" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">SHAP——用Python解释任何机器学习模型</h1><p id="c6ec" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><a class="ae od" href="https://github.com/slundberg/shap" rel="noopener ugc nofollow" target="_blank"> SHAP </a>是一个Python库，它使用Shapley值来解释任何机器学习模型的输出。</p><p id="f5bf" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">要安装SHAP，请键入:</p><pre class="mg mh mi mj gt ol om on oo aw op bi"><span id="f468" class="nc ks it om b gy oq or l os ot">pip install shap</span></pre><h2 id="f0c3" class="nc ks it bd kt nd ne dn kx nf ng dp lb ls nh ni ld lw nj nk lf ma nl nm lh iz bi translated">训练模特</h2><p id="1b86" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">为了理解SHAP是如何工作的，我们将使用一个<a class="ae od" href="https://drive.google.com/file/d/1oMUOmXf67DxPe5CV6YJTiEm9TeozKK5H/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">广告数据集</a>进行实验:</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ow ov l"/></div></figure><p id="0cf0" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">我们将建立一个机器学习模型，根据用户的一些信息来预测用户是否点击了广告。</p><p id="cdf5" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">我们将使用<a class="ae od" rel="noopener" target="_blank" href="/patsy-build-powerful-features-with-arbitrary-python-code-bb4bb98db67a#3be4-4bcff97738cd"> Patsy </a>将数据帧转换成一个特性数组和一个目标值数组:</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="c494" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">将数据分为训练集和测试集:</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="9572" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">接下来，我们将使用XGBoost构建模型并进行预测:</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="a4ae" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">为了了解模型的表现，我们将使用F1分数:</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><pre class="mg mh mi mj gt ol om on oo aw op bi"><span id="ac5d" class="nc ks it om b gy oq or l os ot">0.9619047619047619</span></pre><p id="f36c" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">相当不错！</p><h2 id="a270" class="nc ks it bd kt nd ne dn kx nf ng dp lb ls nh ni ld lw nj nk lf ma nl nm lh iz bi translated">解释模型</h2><p id="1118" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">该模型在预测用户是否点击广告方面做得很好。但它是如何得出这样的预测的呢？<strong class="ll jd">每个特征对最终预测和平均预测之间的差异有多大贡献？</strong></p><p id="5ccd" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">请注意，这个问题与我们在文章开头提到的问题非常相似。</p><p id="4b31" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">这就是为什么找到每个特征的Shapley值可以帮助我们确定它们的贡献。获得特征I的重要性的步骤，其中I是特征的索引，与前面类似:</p><ul class=""><li id="162d" class="nn no it ll b lm mv lp mw ls np lw nq ma nr me ns nt nu nv bi translated">获取不包含特征I的所有子集</li><li id="a489" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">找出特征I对每个子集的边际贡献</li><li id="4563" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">合计所有边际贡献以计算特征I的贡献</li></ul><p id="0805" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">要使用SHAP找到Shapley值，只需将训练好的模型插入<code class="fe ox oy oz om b">shap.Explainer</code>:</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><h1 id="52f5" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">SHAP瀑布图</h1><p id="0e7c" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">想象第一个预言的解释:</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/5b711b646f8859b6a8a8f1fa295c0924.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*RvhPyLPwsk-02NBb35q9xw.png"/></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><p id="30b4" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">啊哈！现在我们知道了每个特征对第一次预测的贡献。对上图的解释:</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/88a76b7ef8dd22f5c48ea64b6fca527d.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*NcrbBLJsoHhOfwCgvf-htQ.png"/></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><ul class=""><li id="1f34" class="nn no it ll b lm mv lp mw ls np lw nq ma nr me ns nt nu nv bi translated">蓝色条显示特定特征降低预测值的程度。</li><li id="d791" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">红色条显示了特定特征对预测值的增加程度。</li><li id="06e4" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">负值意味着该人点击广告的概率小于0.5</li></ul><p id="2836" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">对于这些子集中的每一个，SHAP不会删除一个特征，然后重新训练模型，而是用该特征的平均值替换该特征，然后生成预测。</p><p id="ae7c" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">我们应该期望总贡献等于预测值和平均预测值之差。让我们检查一下:</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/8a60b71fec1b82f05bd7981a5ef5be37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*ZYpA7OKgStiOrU1B2b8GqQ.png"/></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><p id="49d0" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">酷！他们是平等的。</p><p id="8de5" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">想象第二个预言的解释:</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/d49daaa17ed921196d8810ea6e078591.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*dmAjzGRdQckP1uZuQJGMJw.png"/></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><h1 id="b7a0" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">SHAP汇总图</h1><p id="9cdf" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我们不需要查看每个单独的实例，而是可以使用SHAP汇总图直观显示这些功能对多个实例的总体影响:</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div class="gh gi of"><img src="../Images/7cf385a5cf0a2584c2ca00e6c7e9ae53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*_tqh_qc6IhIB1eT5zdfDGw.png"/></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><p id="3e5f" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">SHAP汇总图告诉我们最重要的要素及其对数据集的影响范围。</p><p id="8c8e" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">从上面的图中，我们可以对模型的预测获得一些有趣的见解:</p><ul class=""><li id="4715" class="nn no it ll b lm mv lp mw ls np lw nq ma nr me ns nt nu nv bi translated">用户的日常互联网使用对该用户是否点击广告有最大的影响。</li><li id="cca7" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">随着<strong class="ll jd">日常互联网使用</strong> <strong class="ll jd">的增加，</strong>用户点击广告<strong class="ll jd">的可能性<strong class="ll jd">降低。</strong></strong></li><li id="29bd" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">随着<strong class="ll jd">每天花在网站上的时间增加，</strong>用户点击广告的<strong class="ll jd">可能性降低</strong>。</li><li id="7ed9" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">随着<strong class="ll jd">地区收入的增加，</strong>用户<strong class="ll jd">点击广告<strong class="ll jd">的可能性</strong>降低。</strong></li><li id="0739" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">随着年龄的增加，用户更有可能点击广告。</li><li id="03a1" class="nn no it ll b lm nw lp nx ls ny lw nz ma oa me ns nt nu nv bi translated">如果用户<strong class="ll jd">是男性</strong>，那么这个用户<strong class="ll jd">不太可能</strong>点击广告<strong class="ll jd">。</strong></li></ul><h1 id="8944" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">SHAP条形图</h1><p id="dc3e" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我们还可以使用SHAP条形图来绘制全局特征重要性图。</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/ac04c98c32dc046e8ac78935225f287c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*pB2P_pfP9c15YWT86OAkNQ.png"/></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><h1 id="3a66" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">SHAP相关散点图</h1><p id="03c2" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我们可以使用SHAP相关散点图观察单个特征对模型做出的所有预测的影响。</p><h2 id="2e44" class="nc ks it bd kt nd ne dn kx nf ng dp lb ls nh ni ld lw nj nk lf ma nl nm lh iz bi translated">日常互联网使用</h2><p id="309f" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">日常互联网使用功能散点图:</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/dc7ca03b604cdbd4eb9936976a418529.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*UB4B_--Lk0IQw8StuTN1nA.png"/></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><p id="8b8f" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">从上面的图中，我们可以看到，随着每日互联网使用量的增加，每日互联网使用量的SHAP值减少。这证实了我们在早期情节中看到的。</p><p id="7f3c" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">我们还可以通过添加<code class="fe ox oy oz om b">color=shap_values</code>来观察日常互联网使用功能与同一情节中其他功能之间的交互。</p><p id="8589" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">散点图将试图挑选出与日常互联网使用(即每天花在网站上的时间)互动最强的功能栏。</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/729b7df5c87c078fc7608284e4f5efd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*VNBrOFhf2EHwQM7q3qMlXg.png"/></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><p id="e2af" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">酷！从上面的情节中，我们可以看到，一个每天使用互联网150分钟，并且每天在网站上花费少量时间的人更有可能点击广告。</p><p id="847f" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">让我们看看其他一些特征的散点图:</p><h2 id="00a5" class="nc ks it bd kt nd ne dn kx nf ng dp lb ls nh ni ld lw nj nk lf ma nl nm lh iz bi translated">每天在现场花费的时间</h2><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/4d281e2a2be409d3ea0bf38ad7da0f5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*cnBtJpXPkl27p4Ov6WStfQ.png"/></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><h2 id="9bfa" class="nc ks it bd kt nd ne dn kx nf ng dp lb ls nh ni ld lw nj nk lf ma nl nm lh iz bi translated">地区收入</h2><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/c4eaf9c27b421866b3de96ef0b5405f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*wZSeFVZc9IY4E9d0CkGz7w.png"/></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><h2 id="7f2d" class="nc ks it bd kt nd ne dn kx nf ng dp lb ls nh ni ld lw nj nk lf ma nl nm lh iz bi translated">年龄</h2><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/6ba544158c8ca56060861b73a5895c84.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*b1fwkKjAHb86MUZYNQA4cQ.png"/></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><h2 id="f601" class="nc ks it bd kt nd ne dn kx nf ng dp lb ls nh ni ld lw nj nk lf ma nl nm lh iz bi translated">性别</h2><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/f48fe75837ff819017e913883e8b37ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*MLqerZsZzFu84K-GsPjsyQ.png"/></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><h1 id="2557" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">SHAP相互作用图</h1><p id="60ca" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">您还可以通过SHAP交互值汇总图观察功能之间的<strong class="ll jd">交互矩阵。在该图中，主要效应在对角线上，交互效应在对角线外。</strong></p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi pj"><img src="../Images/26faa8712f52eb36084c42b222b0e7d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*3as8vo54ofqsHXt1E8Zagg.png"/></div></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">作者图片</p></figure><p id="8f0a" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">相当酷！</p><h1 id="1839" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">结论</h1><p id="5c4d" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">恭喜你！您刚刚学习了Shapey值以及如何使用它来解释机器学习模型。希望这篇文章能给你必要的知识，让你用Python解读自己的机器学习模型。</p><p id="0a94" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">我推荐查看SHAP的文档来了解更多关于SHAP的其他应用。</p><p id="1baf" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">您可以随意使用<a class="ae od" href="https://deepnote.com/project/Data-science-hxlyJpi-QrKFJziQgoMSmQ/%2FData-science%2Fdata_science_tools%2Fshapey_values%2Fshapey_values.ipynb" rel="noopener ugc nofollow" target="_blank">这个交互式笔记本</a>中的源代码，或者转到我的存储库:</p><div class="pk pl gp gr pm pn"><a href="https://github.com/khuyentran1401/Data-science/blob/master/data_science_tools/shapey_values/shapey_values.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="po ab fo"><div class="pp ab pq cl cj pr"><h2 class="bd jd gy z fp ps fr fs pt fu fw jc bi translated">数据科学/shapey _ values . ipynb at master khuyentran 1401/数据科学</h2><div class="pu l"><h3 class="bd b gy z fp ps fr fs pt fu fw dk translated">收集有用的数据科学主题以及代码和文章-Data-science/shapey _ values . ipynb at master…</h3></div><div class="pv l"><p class="bd b dl z fp ps fr fs pt fu fw dk translated">github.com</p></div></div><div class="pw l"><div class="px l py pz qa pw qb mp pn"/></div></div></a></div></div><div class="ab cl qc qd hx qe" role="separator"><span class="qf bw bk qg qh qi"/><span class="qf bw bk qg qh qi"/><span class="qf bw bk qg qh"/></div><div class="im in io ip iq"><p id="4c9c" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">我喜欢写一些基本的数据科学概念，并尝试不同的算法和数据科学工具。你可以在LinkedIn和Twitter上与我联系。</p><p id="5f9a" class="pw-post-body-paragraph lj lk it ll b lm mv kd lo lp mw kg lr ls mx lu lv lw my ly lz ma mz mc md me im bi translated">如果你想查看我写的所有文章的代码，请点击这里。在Medium上关注我，了解我的最新数据科学文章，例如:</p><div class="pk pl gp gr pm pn"><a rel="noopener follow" target="_blank" href="/how-to-solve-a-production-planning-and-inventory-problem-in-python-45c546f4bcf0"><div class="po ab fo"><div class="pp ab pq cl cj pr"><h2 class="bd jd gy z fp ps fr fs pt fu fw jc bi translated">如何用Python解决生产计划和库存问题</h2><div class="pu l"><h3 class="bd b gy z fp ps fr fs pt fu fw dk translated">为了使生产和库存成本最小化，你每天应该生产多少件？</h3></div><div class="pv l"><p class="bd b dl z fp ps fr fs pt fu fw dk translated">towardsdatascience.com</p></div></div><div class="pw l"><div class="qj l py pz qa pw qb mp pn"/></div></div></a></div><div class="pk pl gp gr pm pn"><a rel="noopener follow" target="_blank" href="/how-to-find-best-locations-for-your-restaurants-with-python-b2fadc91c4dd"><div class="po ab fo"><div class="pp ab pq cl cj pr"><h2 class="bd jd gy z fp ps fr fs pt fu fw jc bi translated">如何使用Python找到餐馆的最佳位置</h2><div class="pu l"><h3 class="bd b gy z fp ps fr fs pt fu fw dk translated">用CVXPY解决集合覆盖问题</h3></div><div class="pv l"><p class="bd b dl z fp ps fr fs pt fu fw dk translated">towardsdatascience.com</p></div></div><div class="pw l"><div class="qk l py pz qa pw qb mp pn"/></div></div></a></div><div class="pk pl gp gr pm pn"><a rel="noopener follow" target="_blank" href="/observe-the-friend-paradox-in-facebook-data-using-python-314c23fd49e4"><div class="po ab fo"><div class="pp ab pq cl cj pr"><h2 class="bd jd gy z fp ps fr fs pt fu fw jc bi translated">使用Python观察脸书数据中的朋友悖论</h2><div class="pu l"><h3 class="bd b gy z fp ps fr fs pt fu fw dk translated">平均来说，你的朋友比你的朋友多吗？</h3></div><div class="pv l"><p class="bd b dl z fp ps fr fs pt fu fw dk translated">towardsdatascience.com</p></div></div><div class="pw l"><div class="ql l py pz qa pw qb mp pn"/></div></div></a></div><div class="pk pl gp gr pm pn"><a rel="noopener follow" target="_blank" href="/how-to-detect-seasonality-outliers-and-changepoints-in-your-time-series-5d0901498cff"><div class="po ab fo"><div class="pp ab pq cl cj pr"><h2 class="bd jd gy z fp ps fr fs pt fu fw jc bi translated">如何检测时间序列中的季节性、异常值和变化点</h2><div class="pu l"><h3 class="bd b gy z fp ps fr fs pt fu fw dk translated">只需要Kats和几行代码</h3></div><div class="pv l"><p class="bd b dl z fp ps fr fs pt fu fw dk translated">towardsdatascience.com</p></div></div><div class="pw l"><div class="qm l py pz qa pw qb mp pn"/></div></div></a></div><h1 id="21f5" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">参考</h1><p id="7ad5" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">南马赞蒂(2021年4月21日)。<em class="qn"> SHAP解释道，我希望有人能给我解释一下</em>。中等。检索于2021年9月23日，来自<a class="ae od" rel="noopener" target="_blank" href="/shap-explained-the-way-i-wish-someone-explained-it-to-me-ab81cc69ef30.">https://towards data science . com/shap-explained-the-way-I-wish-someone-explained-it-to-me-ab 81 cc 69 ef 30。</a></p></div></div>    
</body>
</html>