<html>
<head>
<title>Feature Engineering of DateTime Variables for Data Science, Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于数据科学、机器学习的日期时间变量的特征工程</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/feature-engineering-of-datetime-variables-for-data-science-machine-learning-45e611c632ad?source=collection_archive---------17-----------------------#2021-04-28">https://towardsdatascience.com/feature-engineering-of-datetime-variables-for-data-science-machine-learning-45e611c632ad?source=collection_archive---------17-----------------------#2021-04-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f76a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何从日期时间类型变量中获取更有意义的特征，以供机器学习模型使用</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ed76657b6c63196b4a545db6438ff3dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DRhmCDkkdZMLZgcXCmRETQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">日期时间变量的特征工程。图片作者。</p></figure><h1 id="d893" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">介绍</h1><p id="f2b8" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">日期时间字段需要功能工程来将它们从数据转换为可以被我们的机器学习模型使用的有见地的信息。这篇文章分为三个部分和一个额外的部分。在最后，我们将结合使用内置的熊猫和NumPy函数以及我们的函数来提取有用的特性。</p><ul class=""><li id="27a1" class="mm mn it ls b lt mo lw mp lz mq md mr mh ms ml mt mu mv mw bi translated">第1部分—提取日期/时间部分</li><li id="6058" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">第2部分—创建布尔标志</li><li id="11ad" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">第3部分—计算日期/时间差异</li><li id="5c0d" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">奖励——使用<code class="fe nc nd ne nf b">fast_ml</code>在2行代码中实现工程功能</li></ul><h1 id="bcba" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">背景</h1><p id="624e" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">每当我处理与电子商务相关的数据时，以某种方式或其他数据集包含日期时间列。</p><ul class=""><li id="9ea6" class="mm mn it ls b lt mo lw mp lz mq md mr mh ms ml mt mu mv mw bi translated">用户注册日期-时间</li><li id="3c5b" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">用户登录日期-时间</li><li id="ffb3" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">交易日期时间</li><li id="733d" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">有争议的交易日期时间</li><li id="d76a" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">…以及更多</li></ul><p id="ecf9" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">一开始，这个日期字段给我们的只是时间线上的一个特定点。但是这些日期时间字段是潜在的数据宝库。如果使用得当，这些领域对于揭示模式是非常强大的。</p><p id="bd09" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">作为一名数据科学家，你的工作是将洞察力带到桌面上，为此，你需要提出正确的问题。为了前任。</p><ul class=""><li id="03ef" class="mm mn it ls b lt mo lw mp lz mq md mr mh ms ml mt mu mv mw bi translated"><strong class="ls iu">问题1 </strong> —你认为大多数购物车是在什么时候创建的？</li><li id="9823" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated"><strong class="ls iu">问题2 </strong> —你什么时候看到大多数手推车被遗弃？</li><li id="feea" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated"><strong class="ls iu">问题3 </strong> —您认为什么时候的欺诈交易最多？</li><li id="d226" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated"><strong class="ls iu">问题4 </strong> —什么时候订阅的用户最多？</li><li id="e042" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">某些商品在什么时候最常被购买？</li><li id="1121" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated"><strong class="ls iu">问题6 </strong> —注册用户发出第一个订单后多少天/小时？</li><li id="71e0" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated"><strong class="ls iu">问题7 </strong> —多少天不活动后，客户再也不会回到您的网站？</li><li id="6828" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">…等等</li></ul><p id="8b95" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">现在，要回答这些问题，您需要回到数据上来设计这些日期时间字段。然后可以发现大量的模式。</p><p id="97a1" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated"><strong class="ls iu">帖子的第1部分</strong>将为您提供特征工程步骤，以回答类似1、2 &amp; 3的问题</p><ul class=""><li id="9c85" class="mm mn it ls b lt mo lw mp lz mq md mr mh ms ml mt mu mv mw bi translated"><strong class="ls iu"> Ans 1 </strong> —您认为大多数购物车是在什么时候创建的？<strong class="ls iu"> <em class="nj">本月第一周</em> </strong></li><li id="a6fd" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated"><strong class="ls iu"> Ans 2 </strong> —你什么时候看到大多数手推车被丢弃？<strong class="ls iu"> <em class="nj">周三下午</em> </strong></li><li id="c9b8" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated"><strong class="ls iu"> Ans 3 </strong> —你什么时候看到的欺诈交易最多？<strong class="ls iu"> <em class="nj">周五晚</em> </strong></li></ul><p id="eb2d" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">本帖的第2部分将为你提供特征工程步骤来回答类似于第4部分的问题</p><ul class=""><li id="88c4" class="mm mn it ls b lt mo lw mp lz mq md mr mh ms ml mt mu mv mw bi translated"><strong class="ls iu"> Ans 4 </strong> —什么时候订阅用户最多？<strong class="ls iu"> <em class="nj">年初</em> </strong></li><li id="be09" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated"><strong class="ls iu">Ans 5</strong>——什么时候最常购买某些物品？<strong class="ls iu"> <em class="nj">月初</em> </strong></li></ul><p id="1e59" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">帖子的第3部分将为您提供特征工程步骤，以回答类似于6 &amp; 7中的问题</p><ul class=""><li id="4003" class="mm mn it ls b lt mo lw mp lz mq md mr mh ms ml mt mu mv mw bi translated"><strong class="ls iu"> Ans 6 </strong> —注册用户发出第一个订单后多少天/小时？<strong class="ls iu"><em class="nj">2小时内</em> </strong></li><li id="b0f4" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated"><strong class="ls iu"> Ans 7 </strong> —多少天不活动后，客户再也不会回到您的网站？<strong class="ls iu"><em class="nj">14天不活动后</em> </strong></li></ul><p id="ddf1" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">我使用了一个电子商务数据的例子，在这个例子中，我个人发现了许多用例，但是提取信息的范围决不仅仅与此相关。在这篇文章中，我们将会看到如何通过问正确的问题来学习一些行为。事实证明，在多个行业中，进行正确的特征工程对于解决各种问题是有用的。</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="76e0" class="ky kz it bd la lb nr ld le lf ns lh li jz nt ka lk kc nu kd lm kf nv kg lo lp bi translated">我们开始吧</h1><h1 id="8e9e" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">加载数据集</h1><pre class="kj kk kl km gt nw nf nx ny aw nz bi"><span id="3353" class="oa kz it nf b gy ob oc l od oe">import pandas as pd</span><span id="bd3a" class="oa kz it nf b gy of oc l od oe">df = pd.read_csv('/kaggle/input/loan-data/loan.csv', <br/>                 parse_dates = ['date_issued', 'date_last_payment'])</span></pre><p id="d9b6" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">Pandas提供了一种非常简单但非常强大的方法来处理与日期时间相关的变量，将它们解析为日期。您可以将参数<code class="fe nc nd ne nf b">parse_dates</code>中与日期时间相关的所有变量作为列表进行传递。</p><p id="ca03" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">假设您事先不知道日期时间变量，在调查数据后，您发现一些变量是日期时间。因此，pandas没有重新加载数据，而是提供了另一个有用的函数<code class="fe nc nd ne nf b">to_datetime</code>来将数据类型转换为DateTime。</p><pre class="kj kk kl km gt nw nf nx ny aw nz bi"><span id="3076" class="oa kz it nf b gy ob oc l od oe">df['date_issued'] = pd.to_datetime(df['date_issued'], <br/>                                   errors = 'coerce')</span></pre><h1 id="8e1b" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">第一部分。提取日期/时间部分</h1><p id="555b" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">如上例所示，我们可以从给定的日期-时间变量中提取日期-时间部分的组成部分(<code class="fe nc nd ne nf b">year</code>、<code class="fe nc nd ne nf b">quarter</code>、<code class="fe nc nd ne nf b">month</code>、<code class="fe nc nd ne nf b">day</code>、<code class="fe nc nd ne nf b">day_of_week</code>、<code class="fe nc nd ne nf b">day_of_year</code>、<code class="fe nc nd ne nf b">week_of_year</code>、<code class="fe nc nd ne nf b">time</code>、<code class="fe nc nd ne nf b">hour</code>、<code class="fe nc nd ne nf b">minute</code>、<code class="fe nc nd ne nf b">second</code>、<code class="fe nc nd ne nf b">day_part</code>)。下面的列表提供了几个可以使用pandas内置函数提取的组件。</p><h2 id="68ac" class="oa kz it bd la og oh dn le oi oj dp li lz ok ol lk md om on lm mh oo op lo oq bi translated">语法:</h2><p id="42e9" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">我们可以使用<code class="fe nc nd ne nf b">.dt</code>访问器提取所有这些组件。<a class="ae or" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/basics.html#basics-dt-accessors" rel="noopener ugc nofollow" target="_blank">在这里阅读更多关于日期访问器的信息</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/c1136c64a182ad958faf4baf144d686f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kU7vViqhXPQoHxjA7fKAwg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从日期时间变量issued_date中提取组件。作者图片</p></figure><p id="a36f" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">下面是如图所示的代码。所有其他成分也可以用类似的方法提取</p><pre class="kj kk kl km gt nw nf nx ny aw nz bi"><span id="4336" class="oa kz it nf b gy ob oc l od oe">#1<br/>df[‘date_issued:year’] = df[‘date_issued’].dt.year</span><span id="9ffb" class="oa kz it nf b gy of oc l od oe">#2<br/>df[‘date_issued:month’] = df[‘date_issued’].dt.month</span><span id="e934" class="oa kz it nf b gy of oc l od oe">#3<br/>df[‘date_issued:day_of_week’] = df[‘date_issued’].dt.day_of_week</span><span id="4bae" class="oa kz it nf b gy of oc l od oe">#4<br/>df[‘date_issued:week_of_year’] = df[‘date_issued’].dt.week_of_year</span><span id="618e" class="oa kz it nf b gy of oc l od oe">#5<br/>df[‘date_issued:hour’] = df[‘date_issued’].dt.hour</span></pre><p id="531e" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated"><strong class="ls iu">注:</strong></p><ul class=""><li id="56c4" class="mm mn it ls b lt mo lw mp lz mq md mr mh ms ml mt mu mv mw bi translated">周一:<code class="fe nc nd ne nf b">day_of_week = 0</code>，</li><li id="789a" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">周二:<code class="fe nc nd ne nf b">day_of_week=1</code>，</li><li id="2a37" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi">…</li><li id="da84" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">周日:<code class="fe nc nd ne nf b">day_of_week=6</code></li></ul><h2 id="fe63" class="oa kz it bd la og oh dn le oi oj dp li lz ok ol lk md om on lm mh oo op lo oq bi translated">创建日部分:</h2><pre class="kj kk kl km gt nw nf nx ny aw nz bi"><span id="f3c5" class="oa kz it nf b gy ob oc l od oe">#day_part function<br/>def day_part(hour):<br/>    if hour in [4,5]:<br/>        return "dawn"<br/>    elif hour in [6,7]:<br/>        return "early morning"<br/>    elif hour in [8,9,10]:<br/>        return "late morning"<br/>    elif hour in [11,12,13]:<br/>        return "noon"<br/>    elif hour in [14,15,16]:<br/>        return "afternoon"<br/>    elif hour in [17, 18,19]:<br/>        return "evening"<br/>    elif hour in [20, 21, 22]:<br/>        return "night"<br/>    elif hour in [23,24,1,2,3]:<br/>        return "midnight"<br/>    <br/>    <br/>#Run function with apply method<br/>df['date_issued:day_part'] = df['date_issued:hour'].apply(day_part)</span><span id="ea51" class="oa kz it nf b gy of oc l od oe">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/317287cfe4503590f65eae4fedf3f8fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C0lc2c-pzeAeTlvaSizUdw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">为日期时间变量issued_date创建日部分。作者图片</p></figure><h1 id="1647" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">第二部分。创建布尔标志</h1><p id="83b0" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">如上例所示，我们可以从给定的日期-时间变量中提取许多布尔标志(<code class="fe nc nd ne nf b">is_month_start</code>、<code class="fe nc nd ne nf b">is_month_end</code>、<code class="fe nc nd ne nf b">is_quarter_start</code>、<code class="fe nc nd ne nf b">is_quarter_end</code>、<code class="fe nc nd ne nf b">is_year_start</code>、<code class="fe nc nd ne nf b">is_year_end</code>、<code class="fe nc nd ne nf b">is_weekend</code>)。下面的列表提供了几个这样的组件，可以使用pandas内置的函数以及通过创建我们的一些函数来提取。</p><h2 id="49a7" class="oa kz it bd la og oh dn le oi oj dp li lz ok ol lk md om on lm mh oo op lo oq bi translated">语法:</h2><p id="a97d" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">同样，我们可以使用<code class="fe nc nd ne nf b">.dt</code>访问器来提取许多布尔标志。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/fd66c15e88a105492eedfee4b13cc196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f3LGb43hXj7yWX2l1u3alQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从日期时间变量issued_date中提取布尔标志。作者图片</p></figure><pre class="kj kk kl km gt nw nf nx ny aw nz bi"><span id="286a" class="oa kz it nf b gy ob oc l od oe">#1<br/>df['date_issued:is_year_start'] = df['date_issued'].dt.is_year_start</span><span id="0d65" class="oa kz it nf b gy of oc l od oe">#2<br/>df['date_issued:is_quarter_start'] = df['date_issued'].dt.is_quarter_start</span><span id="c11f" class="oa kz it nf b gy of oc l od oe">#3<br/>df['date_issued:is_month_start'] = df['date_issued'].dt.is_month_start</span><span id="8ef5" class="oa kz it nf b gy of oc l od oe">#4<br/>df['date_issued:is_month_end'] = df['date_issued'].dt.is_month_end</span></pre><h2 id="41ce" class="oa kz it bd la og oh dn le oi oj dp li lz ok ol lk md om on lm mh oo op lo oq bi translated">创建周末标志:</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/63ece92d70afc347f6edb06523cd4d7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uUoUwmrGXfMsGYWZLirfXA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">为日期时间变量issued_date创建周末标志。作者图片</p></figure><p id="ed89" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">如果我们查看日历，我们会发现2013年10月26日是星期六——周末。</p><pre class="kj kk kl km gt nw nf nx ny aw nz bi"><span id="0e1f" class="oa kz it nf b gy ob oc l od oe">df['date_issued:is_weekend'] = np.where(df['date_issued:day_of_week'].isin([5,6]), 1,0)</span></pre><h1 id="97d8" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">第三部分。计算日期/时间差异</h1><p id="2c42" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">通常你的问题/分析会与另一个参考点相关。比如，</p><ol class=""><li id="0a84" class="mm mn it ls b lt mo lw mp lz mq md mr mh ms ml ow mu mv mw bi translated">注册后多少天/小时后，用户发出第一个订单？<em class="nj">注册_日期&amp;首_订单_日期</em></li><li id="cac8" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml ow mu mv mw bi translated">客户投诉在多少天/小时内得到解决？<em class="nj">投诉_日期&amp;解决_日期</em></li><li id="27ec" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml ow mu mv mw bi translated">从今天开始，客户从您的网站订购了多久？<em class="nj">今天&amp;最后_订单_日期</em></li><li id="acdb" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml ow mu mv mw bi translated">…等等</li></ol><p id="c3df" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">在我们的示例数据集中，我们有两列date_last_payment &amp; date_issued。让我们看看当我们取这两列的差时会发生什么。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/f362baeaf377e6a64156665f312f8f8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PpVE4d0e1wR3tpWvw1wtoQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">计算熊猫的时差。图片作者。</p></figure><p id="d15f" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">默认情况下，熊猫提供“天”的差异。注意<code class="fe nc nd ne nf b">dtype: timedelta64[ns]</code>。</p><p id="40fa" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">来自numpy文档:</p><blockquote class="oy"><p id="9e66" class="oz pa it bd pb pc pd pe pf pg ph ml dk translated">因为NumPy的核心没有物理量系统，所以创建了timedelta64数据类型来补充datetime64</p></blockquote><p id="3bd9" class="pw-post-body-paragraph lq lr it ls b lt pi ju lv lw pj jx ly lz pk mb mc md pl mf mg mh pm mj mk ml im bi translated">现在，如果我们只想要数字部分而不是整个字符串<code class="fe nc nd ne nf b">947 days</code>，我们可以通过使用。dt访问器。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/3c653b6bc8ec87bc74d3f16c283e7e1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qFzsglBHvGDldpxLtK9uDA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">计算熊猫的时差。dt访问器。图片作者。</p></figure><p id="9909" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">不幸的是，我们不能以类似的方式得到月份。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi po"><img src="../Images/ee1239e7427690af4b9f647379587fa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZoqBYecmpyT-ZVuy_rARfQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">计算熊猫的时差。dt访问器不可伸缩。图片作者。</p></figure><p id="abf1" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">这里NumPy的<code class="fe nc nd ne nf b">timedelta64</code>变得非常有用。</p><h2 id="0c81" class="oa kz it bd la og oh dn le oi oj dp li lz ok ol lk md om on lm mh oo op lo oq bi translated">语法:</h2><p id="5fc5" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">为了得到贷款发放日期和最后一次付款日期之间的月数，我们将这样写</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/5ac7028de628a5dc6e59f849bc4c682b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0JCdFxXHZFKOFPbHZlip9A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用NumPy timedelta64计算熊猫的时差。图片作者。</p></figure><pre class="kj kk kl km gt nw nf nx ny aw nz bi"><span id="ef03" class="oa kz it nf b gy ob oc l od oe">(df['date_last_payment'] - df['date_issued'])/np.timedelta64(1, 'M')</span></pre><p id="cfc8" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">timedelta64可以采用以下参数来计算两个日期之间的差异:</p><ul class=""><li id="9041" class="mm mn it ls b lt mo lw mp lz mq md mr mh ms ml mt mu mv mw bi translated">d’→持续几天</li><li id="4c60" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">w’→数周</li><li id="eb28" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">' M' →几个月</li><li id="7b95" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">多年来</li><li id="0969" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">h’→数小时</li></ul></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="e0e2" class="ky kz it bd la lb nr ld le lf ns lh li jz nt ka lk kc nu kd lm kf nv kg lo lp bi translated">奖金！</h1><p id="11c4" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">您可以使用fast_ml来创建所有这些日期时间特性</p><p id="22da" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">首先，安装<code class="fe nc nd ne nf b">fast_ml</code>包</p><pre class="kj kk kl km gt nw nf nx ny aw nz bi"><span id="f719" class="oa kz it nf b gy ob oc l od oe">!pip install fast_ml — upgrade</span></pre><p id="9917" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">然后，从<code class="fe nc nd ne nf b">feature_engineering</code>模块导入工程日期时间特征的方法</p><pre class="kj kk kl km gt nw nf nx ny aw nz bi"><span id="c2c2" class="oa kz it nf b gy ob oc l od oe">from fast_ml.feature_engineering import FeatureEngineering_DateTime</span></pre><p id="117d" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">现在，这与sklearn的其他变形金刚、预处理器的工作方式完全相同。</p><ul class=""><li id="2930" class="mm mn it ls b lt mo lw mp lz mq md mr mh ms ml mt mu mv mw bi translated">例示</li><li id="2c1a" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">合适的</li><li id="c941" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">改变</li></ul><pre class="kj kk kl km gt nw nf nx ny aw nz bi"><span id="d294" class="oa kz it nf b gy ob oc l od oe">#Instantiate<br/>dt_fe = FeatureEngineering_DateTime()</span><span id="6643" class="oa kz it nf b gy of oc l od oe">#Fit<br/>dt_fe.fit(df, datetime_variables=['date_issued'], <br/>          prefix = 'date_issued:')</span><span id="4adb" class="oa kz it nf b gy of oc l od oe">#Transform<br/>df = dt_fe.transform(df)<br/>df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/c3df14de6d432f8d2b9c531129472864.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rn8mRXDZUbxCuC6fTQ8f4A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用Fast_ml对日期时间变量进行特征工程。图片作者。</p></figure><p id="e9aa" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">在屏幕截图中，所有的列都不可见。让我们只看数据集的列</p><pre class="kj kk kl km gt nw nf nx ny aw nz bi"><span id="7eb1" class="oa kz it nf b gy ob oc l od oe">df.columns</span><span id="2b4d" class="oa kz it nf b gy of oc l od oe">---Output---<br/>Index(['customer_id', 'disbursed_amount', 'interest', 'market', 'employment', 'time_employed', 'householder', 'income', 'date_issued', 'target', 'loan_purpose', 'number_open_accounts', 'date_last_payment', 'number_credit_lines_12',</span><span id="a524" class="oa kz it nf b gy of oc l od oe">(Notice from here -------&gt;)<br/>'date_issued:year', 'date_issued:quarter', 'date_issued:month', 'date_issued:day', 'date_issued:day_of_week', 'date_issued:day_of_year', 'date_issued:weekofyear', 'date_issued:is_month_end', 'date_issued:is_month_start', 'date_issued:is_quarter_end', 'date_issued:is_quarter_start', 'date_issued:is_year_end', 'date_issued:is_year_start', 'date_issued:time', 'date_issued:hour', 'date_issued:minute', 'date_issued:second', 'date_issued:is_weekend', 'date_issued:day_part'],<br/>dtype='object')</span></pre></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="9a2f" class="ky kz it bd la lb nr ld le lf ns lh li jz nt ka lk kc nu kd lm kf nv kg lo lp bi translated">感谢阅读！！</h1><ul class=""><li id="45e1" class="mm mn it ls b lt lu lw lx lz pq md pr mh ps ml mt mu mv mw bi translated">如果你喜欢这个，<a class="ae or" href="https://samarthagrawal86.medium.com" rel="noopener">在medium </a>上跟随我了解更多。</li><li id="6fe6" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">有兴趣合作吗？让我们在<a class="ae or" href="https://www.linkedin.com/in/samarth-agrawal-2501/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>上连线。</li><li id="de00" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">请随意写下您的想法/建议/反馈。</li><li id="b403" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated"><a class="ae or" href="https://www.kaggle.com/nextbigwhat/feature-engineering-datetime-variables" rel="noopener ugc nofollow" target="_blank">卡格尔链接</a></li><li id="7924" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated"><a class="ae or" href="https://pypi.org/project/fast-ml/" rel="noopener ugc nofollow" target="_blank"> Fast_ml链接</a></li></ul><p id="96f3" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz ng mb mc md nh mf mg mh ni mj mk ml im bi translated">笔记本可在以下位置获得，并附有完整的功能代码:</p><div class="pt pu gp gr pv pw"><a href="https://www.kaggle.com/nextbigwhat/feature-engineering-of-datetime-variables?scriptVersionId=61041780" rel="noopener  ugc nofollow" target="_blank"><div class="px ab fo"><div class="py ab pz cl cj qa"><h2 class="bd iu gy z fp qb fr fs qc fu fw is bi translated">日期时间变量的特征工程</h2><div class="qd l"><h3 class="bd b gy z fp qb fr fs qc fu fw dk translated">使用Kaggle笔记本探索和运行机器学习代码|使用来自loan_data的数据</h3></div><div class="qe l"><p class="bd b dl z fp qb fr fs qc fu fw dk translated">www.kaggle.com</p></div></div><div class="qf l"><div class="qg l qh qi qj qf qk ks pw"/></div></div></a></div></div></div>    
</body>
</html>