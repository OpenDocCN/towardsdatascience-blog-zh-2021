<html>
<head>
<title>Real-time facial recognition application to identify Computer Science students at the University of Sonora using Pytorch and Multi-task Cascaded Convolutional Neural Networks (MTCNN)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Pytorch和多任务级联卷积神经网络(MTCNN)识别Sonora大学计算机科学学生的实时面部识别应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/real-time-facial-recognition-application-to-identify-computer-science-students-at-the-university-of-253bc43d7c32?source=collection_archive---------35-----------------------#2021-05-19">https://towardsdatascience.com/real-time-facial-recognition-application-to-identify-computer-science-students-at-the-university-of-253bc43d7c32?source=collection_archive---------35-----------------------#2021-05-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e095" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">解释和使用，关于我们如何完成我们的工作</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9c7de5f32b684f21250ac44ffc898738.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zbPMmg3jYnNrkqr5q7jVng.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来自:<a class="ae kv" href="https://www.freepik.es/vector-gratis/hombre-cara-escanear-tecnologia-digital-biometrica_5597121.htm#page=1&amp;query=face%20recognition&amp;position=6" rel="noopener ugc nofollow" target="_blank"> Link de la imagen </a></p></figure><p id="6206" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">戴安娜·劳拉·巴列斯特罗斯·巴伦苏埃拉、埃利乌德·吉尔贝托·罗德里格斯·马丁内斯、乌戈·弗朗西斯科·卡诺·贝利斯、马丁·何塞·维加·诺列加</p><p id="9a45" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">索诺拉大学，埃莫西约，索诺拉<br/></p><p id="1057" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="mailto:mjvnor@outlook.com" rel="noopener ugc nofollow" target="_blank">mjvnor@outlook.com</a>，<a class="ae kv" href="mailto:dballesterosvalenzuela@gmail.com" rel="noopener ugc nofollow" target="_blank">dballesterosvalenzuela@gmail.com</a>，slabxcobra@gmail.com，eliud.giroma@gmail.com。</p><p id="1d3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">github:<a class="ae kv" href="https://github.com/MJVNOR/Real-time-facial-recognition-MTCNN/tree/main" rel="noopener ugc nofollow" target="_blank">https://github . com/MJVNOR/Real-time-face-recognition-mt CNN/tree/main</a></p><p id="c249" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">抽象。这个项目的目标是检测埃莫西约索诺拉州索诺拉大学的每个计算机科学学生，以便能够在能够识别他们面部的基础上开展其他项目。在这个项目中，我们使用带有神经网络的图像处理进行面部识别。我们实现了MTCNN，这是一种检测图像中的人脸和面部标志的神经网络，是当今最准确的工具之一。</p><p id="0730" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关键词:面部识别，神经网络，pytorch</p><h1 id="17e5" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak"> 1。简介</strong></h1><p id="c410" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">使用面部识别及其实现的机构的数量每天都在增加，这是因为它有许多好处，例如识别迷路的人，识别可能的小偷，识别哪些工人在某一天去工作，等等。面部识别是:给定一张“未知”人脸的图像，在一组“已知”图像中找到同一张人脸的图像。</p><p id="956b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">面部识别已经经历了几个取得进展的阶段。我们可以看到以前它只是一个虚构的东西，而今天我们可以在许多应用和地方找到它。</p><p id="1983" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">伍德罗·威尔逊·布莱索被认为是这项技术的先驱，因为他在1960年研究了一个对人脸特征进行分类的系统，尽管这个过程是非常手工的，但他使用触笔和坐标来精确定位人的眼睛、鼻子或嘴。</p><p id="6597" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">今天，我们可以看到面部识别是如何成为人工智能的一部分，使我们能够检测和识别人脸。</p><p id="6f39" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这项工作中，使用了人工智能领域的工具，能够实时识别人脸，并且如果该人脸是我们学生数据集的一部分，则能够识别该人</p><h1 id="1ab1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak"> 2。提议的工件</strong></h1><p id="7722" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">实时面部识别应用。</p><p id="615c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.1内容建模:</p><p id="367e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们做的第一件事是使用MTCNN网络来生成学生面部的数据集，并让它返回面部确实是面部(每张图像只有一个面部)和面部是张量形式的概率。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="eb1c" class="mu lt iq mq b gy mv mw l mx my">mtcnn0 = MTCNN(image_size=240, margin=0, keep_all=False, min_face_size=40)</span></pre><p id="abc3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们使用一个默认模型(vggface2)来输入我们的张量数据集，并返回每个人脸的最重要的数据(以矩阵形式)，这称为嵌入。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="a383" class="mu lt iq mq b gy mv mw l mx my">resnet = InceptionResnetV1(pretrained='vggface2'.eval()</span><span id="52e8" class="mu lt iq mq b gy mz mw l mx my">for img, idx in loader:<br/>    face, prob <strong class="mq ir">=</strong> mtcnn0(img, return_prob<strong class="mq ir">=</strong>True)<br/>    if face <strong class="mq ir">is</strong> <strong class="mq ir">not</strong> None <strong class="mq ir">and</strong> prob<strong class="mq ir">&gt;</strong>0.92:<br/>        emb <strong class="mq ir">=</strong> resnet(face.unsqueeze(0))<br/>        embedding_list.append(emb.detach())<br/>        name_list.append(idx_to_class[idx])</span><span id="dc34" class="mu lt iq mq b gy mz mw l mx my">data <strong class="mq ir">=</strong> [embedding_list, name_list]<br/>torch.save(data, 'data.pt')</span></pre><p id="9840" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在一个循环中，我们访问设备的摄像头以开始我们的识别。我们使用MTCNN类型的第二个网络，该网络用于检测是否有人脸(如果检测到人脸，它会在每个人脸周围打印/绘制一个方框)，并给出它确实是人脸的概率，但这一次该网络的输入将是我们相机的帧(澄清该网络可以在每个帧中一次检测多个人脸)。我们再次使用vggface2模型来嵌入我们检测到的人脸。</p><p id="5005" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用保存的人脸嵌入和使用我们相机的帧生成的嵌入，我们计算学生的人脸组与我们在我们的帧中检测到的人脸之间的距离，并且使用最小的距离，我们说这个人脸是某个学生的。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="b52f" class="mu lt iq mq b gy mv mw l mx my">load_data <strong class="mq ir">=</strong> torch.load('data.pt')<br/>embedding_list <strong class="mq ir">=</strong> load_data[0]<br/>name_list <strong class="mq ir">=</strong> load_data[1]</span><span id="a73b" class="mu lt iq mq b gy mz mw l mx my">cam <strong class="mq ir">=</strong> cv2.VideoCapture(0)</span><span id="d9cd" class="mu lt iq mq b gy mz mw l mx my">while True:<br/>    img <strong class="mq ir">=</strong> Image.fromarray(frame)<br/>    if img_cropped_list <strong class="mq ir">is</strong> <strong class="mq ir">not</strong> None:<br/>        boxes, _ <strong class="mq ir">=</strong> mtcnn.detect(img)<br/>        for i, prob in enumerate(prob_list):<br/>            if prob<strong class="mq ir">&gt;</strong>0.90:<br/>                emb <strong class="mq ir">= </strong>resnet(img_cropped_list[i].unsqueeze(0)).detach()<br/>                dist_list <strong class="mq ir">=</strong> [] <br/>                for idx, emb_db in enumerate(embedding_list):<br/>                    dist <strong class="mq ir">=</strong> torch.dist(emb, emb_db).item()<br/>                    dist_list.append(dist)</span><span id="90fe" class="mu lt iq mq b gy mz mw l mx my">min_dist <strong class="mq ir">=</strong> min(dist_list)<br/>                min_dist_idx <strong class="mq ir">=</strong> dist_list.index(min_dist) <br/>                name <strong class="mq ir">=</strong> name_list[min_dist_idx]</span><span id="f0d6" class="mu lt iq mq b gy mz mw l mx my">box <strong class="mq ir">=</strong> boxes[i]<br/>                original_frame <strong class="mq ir">=</strong> frame.copy()</span><span id="7334" class="mu lt iq mq b gy mz mw l mx my">if min_dist<strong class="mq ir">&lt;</strong>0.90:</span><span id="7e3b" class="mu lt iq mq b gy mz mw l mx my">frame <strong class="mq ir">=</strong> cv2.putText(frame, name<strong class="mq ir">+</strong>' '<strong class="mq ir">+</strong>str(min_dist), (box[0],box[1]), cv2.FONT_HERSHEY_SIMPLEX, 1, (63, 0, 252),1, cv2.LINE_AA)</span><span id="fc70" class="mu lt iq mq b gy mz mw l mx my">frame <strong class="mq ir">=</strong> cv2.rectangle(frame, (box[0],box[1]) , (box[2],box[3]), (13,214,53), 2)</span><span id="8b24" class="mu lt iq mq b gy mz mw l mx my">cv2.imshow("IMG", frame)</span></pre><h1 id="8288" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">3.MTCNN是如何工作的</h1><p id="9aa7" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">MTCNN模型是由张、张和智峰在论文“使用多任务级联卷积网络的联合人脸检测和对准”中提出的。该模型的主要目标是检测人脸及其特征，它由三级卷积网络组成。</p><p id="6de7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该模型基于利用多任务学习，以便划分面部和特征的检测任务，因为以多任务方式这样做通过利用包含在相关任务的信号训练中的域特定信息来提高概括，并且这是通过在使用信息的共享表示的同时并行训练任务来完成的。</p><p id="6d11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开始阶段之前的第一步是获取图像，并以不同的比例调整其大小，以建立图像金字塔，这是网络第一部分的入口。</p><p id="3917" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一阶段包括拥有一个全卷积网络(FCN)，我们用它代替CNN，因为它的架构中没有密集层。这个建议的网络被用于获得面和它们各自的包围盒。这个网络的输出给了我们所有可能的候选人脸。</p><p id="2a35" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在网络的第二阶段，第一阶段的输出被用作CNN网络的输入，这被称为“改进网络(R-Net)”，这减少了可能的候选的数量，校准边界框，并且进行非最大抑制(NMS)来联合我们的可能的候选。作为输出，它告诉我们输入是否是一张脸。</p><p id="1f1a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，第三个非常类似于R-Net，它给出了候选人眼睛、鼻子和嘴巴的位置。</p><h1 id="c73b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">4.我们如何计算距离</h1><p id="b023" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们使用欧几里德距离。欧几里德距离代表平面上两点之间的最小距离，它是两点之间的直线。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi na"><img src="../Images/58304190d0d2ed017e225e4c35eda1a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*tcA1gDE_Ckmq-JbOw9_M5w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="nb">法师作者</em></p></figure><p id="dbe0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个距离的计算方法是两个向量的元素之间的平方差之和的平方根，如前面的公式所示。</p><p id="375b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nc nd ne mq b">dist = torch.dist(emb,emb_db).item()</code></p><p id="70ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们给这个函数我们正在检测的人脸，我们从我们的数据库中获取每个人脸的距离，从那里我们保存所有的距离并取最短的一个。</p><h1 id="327a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">4.1.检测结果</h1><p id="5d44" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这个人并不存在，我们把他从thispersondoesnotexist.com带来，我们把他放在我们的数据库里，叫他Andrew来展示这个程序工作的例子。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/aa1c50116023b8bc40166a65ea868eab.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/0*SUeDQxwovHvhq_hd.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">“安德鲁”(不存在的人)</p></figure><p id="01d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们所看到的，程序检测到“Andrew”的距离大约为0.6237。距离值越低，那个人就越有可能是那个人。</p><h1 id="cf20" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">5.我们犯的错误和发现的错误</h1><p id="fbbc" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们发现，当我们在数据库中创建同事面部的嵌入时，一个同事的计算机内存不足，而另一个没有，换句话说，你必须有1gb以上的可用内存(ram)。</p><p id="e384" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们也尝试过实现多线程，结果惨败。</p><h1 id="fc81" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">6.结论和未来工作</h1><p id="7353" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们可以说，使用MTCNN并利用嵌入来获得距离给了我们非常精确的结果(即使每个人的人脸数量很少)，但负面的一面是，当它检测到人脸时，FPS会降低，当它检测到你是“确定”的人时，FPS会降低更多。</p><p id="5067" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们计划更改应用中的某些内容，以尽可能降低FPS(例如使用除计算距离之外的另一种方法)，并能够为项目添加更多功能，以便与我们自己的同事一起改进和利用技术。</p><h1 id="0c0a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">参考</h1><ol class=""><li id="6ef6" class="ng nh iq ky b kz mk lc ml lf ni lj nj ln nk lr nl nm nn no bi translated">张，张，张，李，乔，于(2016)。基于多任务级联卷积网络的联合人脸检测和对齐。IEEE信号处理快报，23(10)，1499–1503。李普舒茨，s，拉斯李普森，m:集合论:离散数学。麦格劳-希尔公司，第1–22页(2007年)</li><li id="0c70" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated">多任务学习。机器学习28，41–75(1997)。<a class="ae kv" href="https://doi.org/10.1023/A:1007379606734" rel="noopener ugc nofollow" target="_blank">https://doi.org/10.1023/A:1007379606734</a></li></ol></div></div>    
</body>
</html>