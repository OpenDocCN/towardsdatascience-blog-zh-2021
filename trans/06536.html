<html>
<head>
<title>Powerful Text Augmentation Using NLPAUG</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用NLPAUG的强大文本增强</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/powerful-text-augmentation-using-nlpaug-5851099b4e97?source=collection_archive---------9-----------------------#2021-06-12">https://towardsdatascience.com/powerful-text-augmentation-using-nlpaug-5851099b4e97?source=collection_archive---------9-----------------------#2021-06-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="82f3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用令人惊奇的NLPAug通过文本增强技术处理NLP分类问题中的类别不平衡</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/246f64c0d2c6dc28653d9c5277f98308.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*t-aeYaS27ns-ClR1"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">布雷特·乔丹在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="f241" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">什么是数据增强，我们为什么要关注它？</h1><p id="73b4" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">数据扩充是从现有数据中合成新数据的实践。这可以应用于从数字到图像的任何形式的数据。通常，增加的数据类似于已经可用的数据。在所有机器学习问题中，数据集决定了问题的解决程度。有时，我们没有足够的数据来建立稳健的模型，更常见的是数据中存在明显的阶级不平衡。假设我们正在构建一个预测两个类别之一的模型，但我们有一个类别的5000个样本进行训练，而另一个类别只有200个样本。在这种情况下，我们的模型将几乎总是预测具有更多样本的类别，因为它没有得到足够的数据来区分这两个类别。然后我们必须转向收集更多的数据，但如果我们不能呢？一种方法是生成我们拥有的200个数据样本的精确副本，并减少不平衡。虽然这确实提供了一些改进，但是模型仍然在学习相同的特性集！或许一些巧妙的调整可以提高我们现有数据的质量。</p><h1 id="331d" class="ld le iq bd lf lg mr li lj lk ms lm ln jw mt jx lp jz mu ka lr kc mv kd lt lu bi translated"><strong class="ak">为什么与其他形式的数据增强相比，文本增强很困难？</strong></h1><p id="41d8" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">想想看，为了增加图像，我们可以旋转、锐化或裁剪图像的不同区域，新数据仍然有一定的意义。</p><p id="dde5" class="pw-post-body-paragraph lv lw iq lx b ly mw jr ma mb mx ju md me my mg mh mi mz mk ml mm na mo mp mq ij bi translated">然而，扩充文本数据是非常困难的。例如，改变单词的顺序乍一看似乎是合理的，但有时这可能会完全改变句子的意思，比如说，<strong class="lx ir"> <em class="nb">我清洗了我的汽车</em> </strong>不同于<strong class="lx ir"> <em class="nb">我清洗了我的汽车。</em>T13】</strong></p><p id="c798" class="pw-post-body-paragraph lv lw iq lx b ly mw jr ma mb mx ju md me my mg mh mi mz mk ml mm na mo mp mq ij bi translated">幸运的是，马志威的<strong class="lx ir"/><a class="ae kv" href="https://github.com/makcedward/nlpaug" rel="noopener ugc nofollow" target="_blank"><strong class="lx ir">nlpaug</strong></a><strong class="lx ir"/>给了我们一些惊人的工具来快速扩充文本。下面就来说说其中的一些。</p><h1 id="53ae" class="ld le iq bd lf lg mr li lj lk ms lm ln jw mt jx lp jz mu ka lr kc mv kd lt lu bi translated">扩充文本数据的方法</h1><ol class=""><li id="e245" class="nc nd iq lx b ly lz mb mc me ne mi nf mm ng mq nh ni nj nk bi translated">用同义词替换几个单词。</li><li id="ee2a" class="nc nd iq lx b ly nl mb nm me nn mi no mm np mq nh ni nj nk bi translated"><strong class="lx ir">用与这些单词具有相似(基于余弦相似度)单词嵌入的单词(如word2vec或GloVe)替换一些单词。</strong></li><li id="90f9" class="nc nd iq lx b ly nl mb nm me nn mi no mm np mq nh ni nj nk bi translated"><strong class="lx ir">使用强大的变压器模型(BERT)根据上下文替换单词。</strong></li><li id="ed75" class="nc nd iq lx b ly nl mb nm me nn mi no mm np mq nh ni nj nk bi translated">使用反向翻译，即把一个句子翻译成另一种语言，然后再翻译回原文，有时会修改几个单词。</li></ol></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="7a8a" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">让我们看看第一个，并将其应用于一个问题，看看增强是否真的有效</h1><h2 id="0430" class="nq le iq bd lf nr ns dn lj nt nu dp ln me nv nw lp mi nx ny lr mm nz oa lt ob bi translated">定义问题</h2><p id="8f0f" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">我将使用来自<a class="ae kv" href="https://www.kaggle.com/sripaadsrinivasan/yelp-coffee-reviews" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>的Yelp咖啡评论数据集来分析一个情感分析问题。该数据集包含近7000条用户评论和评级。用户对咖啡店的评分从1到5，越高越好。为了制造一些不平衡，我放弃了中性评级(3)，并将所有大于3的评级标记为正面，所有小于3的评级标记为负面。下面是预处理前的一个示例回顾</p><h2 id="4912" class="nq le iq bd lf nr ns dn lj nt nu dp ln me nv nw lp mi nx ny lr mm nz oa lt ob bi translated"><strong class="ak">评估指标</strong></h2><p id="f9fc" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">当谈到不平衡分类时，我并不热衷于准确性度量，因此将主要查看<strong class="lx ir"> </strong> <a class="ae kv" rel="noopener" target="_blank" href="/understanding-auc-roc-curve-68b2303cc9c5"> <strong class="lx ir"> ROC曲线</strong> </a>下的面积作为评估度量。</p><h2 id="d8a1" class="nq le iq bd lf nr ns dn lj nt nu dp ln me nv nw lp mi nx ny lr mm nz oa lt ob bi translated"><strong class="ak">两种情况下使用的型号</strong></h2><p id="bc12" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">在一些文本预处理和清理之后，我使用了一个随机森林分类器，它有10个估值器。使用Tfidf矢量器对文本进行矢量化，并选择基于术语频率的最佳3000个特征向量作为分类器的输入特征。这个模型非常简单，我在下面链接了全部代码。对于那些想先查阅<a class="ae kv" href="https://github.com/rajlm10/NLPAUG_Usage/blob/main/YELP_NLPAUG.ipynb" rel="noopener ugc nofollow" target="_blank">代码的热心读者来说，它就在这里！</a></p><h1 id="0981" class="ld le iq bd lf lg mr li lj lk ms lm ln jw mt jx lp jz mu ka lr kc mv kd lt lu bi translated"><strong class="ak">没有文本增强的结果</strong></h1><p id="cb95" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">首先，我们来看看阶级不平衡。如你所见，正负之间的不平衡几乎是6.5 : 1的比例。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/983ff2ed4cb217788b4ea5352aa6165e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*A_sMD6juSpH9vsdZAHYVOA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">阶级之间的巨大不平衡(图片由作者提供)</p></figure><p id="9b15" class="pw-post-body-paragraph lv lw iq lx b ly mw jr ma mb mx ju md me my mg mh mi mz mk ml mm na mo mp mq ij bi translated">这是在数据集上训练RandomForest分类器后的结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/451aea64aa53b369489629b3d3fba3ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*GnHDJM0yH1v_oFcnc2K29w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">RandomForest(n=10)分类器的AUC</p></figure><p id="504f" class="pw-post-body-paragraph lv lw iq lx b ly mw jr ma mb mx ju md me my mg mh mi mz mk ml mm na mo mp mq ij bi translated">如您所见，曲线下的面积为0.85，为了证明模型仅在样本数量较少的类上表现不佳，请仔细查看分类报告。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/7e03826629fdc2b2ddec722ea56a08b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*oS9sgXhizgyD9lsFsgox_A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">详细分类报告</p></figure><p id="4509" class="pw-post-body-paragraph lv lw iq lx b ly mw jr ma mb mx ju md me my mg mh mi mz mk ml mm na mo mp mq ij bi translated">该车型的召回率和f1-在负类上的得分(标为0)绝对<strong class="lx ir"/><strong class="lx ir">可怕！这解释了为什么AUC是0.85。</strong>现在，我们将通过nlpaug以最小的努力提高AUC和f1分数。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="2415" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">增强后的结果</h1><h2 id="794c" class="nq le iq bd lf nr ns dn lj nt nu dp ln me nv nw lp mi nx ny lr mm nz oa lt ob bi translated">我们如何通过用同义词替换单词来扩充文本的例子</h2><p id="ae9a" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">请使用pip安装nlpaug。请参考我的笔记本来查看完整的代码。以下只是一个小片段。</p><pre class="kg kh ki kj gt of og oh oi aw oj bi"><span id="4159" class="nq le iq og b gy ok ol l om on">pip install nlpaug</span></pre><p id="895b" class="pw-post-body-paragraph lv lw iq lx b ly mw jr ma mb mx ju md me my mg mh mi mz mk ml mm na mo mp mq ij bi translated">在这之后，我将使用wordnet库来帮助处理同义词。</p><p id="3d6d" class="pw-post-body-paragraph lv lw iq lx b ly mw jr ma mb mx ju md me my mg mh mi mz mk ml mm na mo mp mq ij bi translated">让我们从数据集中挑出一句话——“<strong class="lx ir"><em class="nb">误导性评论。有史以来最糟糕的咖啡，非常令人失望。”</em> </strong></p><pre class="kg kh ki kj gt of og oh oi aw oj bi"><span id="8dc4" class="nq le iq og b gy ok ol l om on">import nlpaug<br/>import nlpaug.augmenter.word as naw<br/>aug = naw.SynonymAug(aug_src='wordnet',aug_max=2)<br/>aug.augment("Misleading reviews. Worst coffee ever had, and sorely disappointing vibe.",n=2)</span></pre><p id="9391" class="pw-post-body-paragraph lv lw iq lx b ly mw jr ma mb mx ju md me my mg mh mi mz mk ml mm na mo mp mq ij bi translated">在上面的代码<strong class="lx ir">中，aug_max </strong>表示我们想要用相应的同义词替换的单词的最大数量<strong class="lx ir">。在最后一行中，n=2表示我们想要生成两个扩充句子。</strong></p><p id="a6ba" class="pw-post-body-paragraph lv lw iq lx b ly mw jr ma mb mx ju md me my mg mh mi mz mk ml mm na mo mp mq ij bi translated">下面是惊人的结果！</p><p id="ad07" class="pw-post-body-paragraph lv lw iq lx b ly mw jr ma mb mx ju md me my mg mh mi mz mk ml mm na mo mp mq ij bi translated"><em class="nb">‘误导性评论文章’。这是有史以来最差的咖啡，非常令人失望。误导评论。这是有史以来最差的咖啡，令人非常不满意</em></p><p id="02ca" class="pw-post-body-paragraph lv lw iq lx b ly mw jr ma mb mx ju md me my mg mh mi mz mk ml mm na mo mp mq ij bi translated">在<strong class="lx ir">第一句</strong>和第二句<strong class="lx ir">误导</strong>和<strong class="lx ir">失望</strong>分别被替换为<strong class="lx ir">导致</strong> <strong class="lx ir">误入歧途</strong>和<strong class="lx ir">不满意</strong>。</p><h2 id="b6bf" class="nq le iq bd lf nr ns dn lj nt nu dp ln me nv nw lp mi nx ny lr mm nz oa lt ob bi translated">我如何决定扩充数据</h2><p id="e270" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">我决定为标签为0(属于少数类的负面评论)的训练集中的每个句子引入2个新的增强句子。在这些扩充的句子中，我决定用同义词替换最多3个单词。你可以自己摆弄这些参数，找点乐子。</p><p id="8f6c" class="pw-post-body-paragraph lv lw iq lx b ly mw jr ma mb mx ju md me my mg mh mi mz mk ml mm na mo mp mq ij bi translated">这是增加数据后的分布。随着一些新的有意义的数据的出现，少数派的人数增加了两倍！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/c9435452c1a2c8af2e12e5c05e3380e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*KyEQp1nF5sc8e9P_pAKONA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">(图片由作者提供)</p></figure><h2 id="e2cd" class="nq le iq bd lf nr ns dn lj nt nu dp ln me nv nw lp mi nx ny lr mm nz oa lt ob bi translated">现在是我们期待已久的高潮…</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/ba740da4ccc23c815f4e7d42cad78434.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*KatfxRVTinmDJuDdsgo_hg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">增强后的AUC！</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi op"><img src="../Images/c42f16a98517947b5b3954c1056e760c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*lJjeKK9m29POQVhQGuyKPA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">扩充后的分类报告</p></figure><p id="f461" class="pw-post-body-paragraph lv lw iq lx b ly mw jr ma mb mx ju md me my mg mh mi mz mk ml mm na mo mp mq ij bi translated"><strong class="lx ir">哇！我们将AUC从0.85提高到0.88，并将f1评分从0.7提高到0.76。</strong></p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="cb80" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">比较增强前后的ROC曲线</h1><div class="kg kh ki kj gt ab cb"><figure class="oq kk or os ot ou ov paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/f29e7838b7401f620b1e6a2faca41f0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*-zAdseL8ZXCS0OQCrCBARQ.png"/></div></figure><figure class="oq kk ow os ot ou ov paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/d02a6e4a6e848d82fad9eb1ba6a6a0c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*Z2XWFP5EYCkCBJ3SRGqTJw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk ox di oy oz translated">(左)-增强前数据的ROC曲线(右)-增强后数据的ROC曲线(图片由作者提供)</p></figure></div><p id="b85a" class="pw-post-body-paragraph lv lw iq lx b ly mw jr ma mb mx ju md me my mg mh mi mz mk ml mm na mo mp mq ij bi translated">虽然稍微，但是右边的ROC曲线覆盖的面积更大，效果更好。<strong class="lx ir">更棒的是，增强在一个CPU上只用了57秒。这显示了文本增强的益处。</strong></p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="5e00" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">注意事项</h1><ol class=""><li id="fc39" class="nc nd iq lx b ly lz mb mc me ne mi nf mm ng mq nh ni nj nk bi translated">在实验的任何时候，我们都没有改变模型或调整它，所有性能的提高完全是由于数据的增加。</li><li id="02cc" class="nc nd iq lx b ly nl mb nm me nn mi no mm np mq nh ni nj nk bi translated">nlpaug库使用单词嵌入、BERT变换器和反向翻译提供了更强大的扩充选项。就存储和执行速度而言，我们使用的是最便宜的选项！</li><li id="ad84" class="nc nd iq lx b ly nl mb nm me nn mi no mm np mq nh ni nj nk bi translated">CPU上的增强用了不到一分钟，这是相当快的。</li><li id="e3ad" class="nc nd iq lx b ly nl mb nm me nn mi no mm np mq nh ni nj nk bi translated">请浏览参考资料中的链接，了解更多增加数据的方法。</li><li id="5515" class="nc nd iq lx b ly nl mb nm me nn mi no mm np mq nh ni nj nk bi translated">最后，我们用很少的努力(就时间而言)和不到5行代码将AUC从0.85提高到0.88。</li></ol></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="a8c6" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated"><strong class="ak">参考文献</strong></h1><ol class=""><li id="4a3a" class="nc nd iq lx b ly lz mb mc me ne mi nf mm ng mq nh ni nj nk bi translated"><a class="ae kv" href="https://github.com/makcedward/nlpaug" rel="noopener ugc nofollow" target="_blank"> <strong class="lx ir"> nlpaug </strong> </a>的官方Github库，里面包含了示例笔记本</li></ol><p id="deca" class="pw-post-body-paragraph lv lw iq lx b ly mw jr ma mb mx ju md me my mg mh mi mz mk ml mm na mo mp mq ij bi translated">查看我的<strong class="lx ir"> G </strong> <a class="ae kv" href="https://github.com/rajlm10" rel="noopener ugc nofollow" target="_blank"> <strong class="lx ir"> itHub </strong> </a>的一些其他项目和整个<a class="ae kv" href="https://github.com/rajlm10/NLPAUG_Usage/blob/main/YELP_NLPAUG.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="lx ir">代码</strong> </a>。你可以在我的<a class="ae kv" href="https://rajsangani.me/" rel="noopener ugc nofollow" target="_blank"><strong class="lx ir"><em class="nb">w</em>ebsite</strong></a><strong class="lx ir"><em class="nb">上联系我。我希望在评论中得到一些反馈。感谢您的宝贵时间！</em></strong></p></div></div>    
</body>
</html>