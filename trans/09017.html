<html>
<head>
<title>Probabilistic Forecasts: Pinball Loss Function</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">概率预测:弹球损失函数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/probabilistic-forecasts-pinball-loss-function-baf86a5a14d0?source=collection_archive---------10-----------------------#2021-08-20">https://towardsdatascience.com/probabilistic-forecasts-pinball-loss-function-baf86a5a14d0?source=collection_archive---------10-----------------------#2021-08-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f346" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">概率预测对于优化供应链和库存目标至关重要。我们如何评估概率预测的质量？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2d69475207ce3d2735d1fa03923e692b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UsCBJB0m3kmNm4Mrw8V05A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.piqsels.com/en/public-domain-photo-frhpg" rel="noopener ugc nofollow" target="_blank">信用</a></p></figure><h1 id="d6ce" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">自我评估测验</h1><p id="df3f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">先问几个问题。在阅读文章之前，先阅读它们<em class="mn">。在你阅读结束时，你应该能够回答这些问题。(答案在最后提供<strong class="lt iu">以及一个Python实现</strong>)</em></p><ol class=""><li id="6d79" class="mo mp it lt b lu mq lx mr ma ms me mt mi mu mm mv mw mx my bi translated">你想预测你的产品的需求。具体来说，您希望预测一个需求有80%概率低于的值。高估或低估实际需求，哪种情况最糟糕？</li><li id="c6e0" class="mo mp it lt b lu mz lx na ma nb me nc mi nd mm mv mw mx my bi translated">您设计了一个减少绝对误差(或MAE)的预测模型。你的模型的目标是平均需求还是中间需求？</li><li id="d766" class="mo mp it lt b lu mz lx na ma nb me nc mi nd mm mv mw mx my bi translated">您做了一个95%分位数的需求预测，您的预测是150，而观察到的需求是120。你如何评估你的预测质量？</li><li id="f653" class="mo mp it lt b lu mz lx na ma nb me nc mi nd mm mv mw mx my bi translated">你销售高利润的产品。最糟糕的是什么:库存过多还是不足？设置安全库存目标时，您应该以高需求分位数还是低需求分位数为目标？</li></ol><div class="ne nf gp gr ng nh"><a rel="noopener follow" target="_blank" href="/probabilistic-forecasting-and-inventory-optimization-70edbb8f4a81"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd iu gy z fp nm fr fs nn fu fw is bi translated">概率预测和库存优化</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">预测只能帮助你做出正确的供应链决策。</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">towardsdatascience.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv ks nh"/></div></div></a></div><h1 id="e3b3" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">分位数预测</h1><p id="7209" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">分位数预测是针对特定需求分位数(或百分点)的概率预测。</p><p id="bb1b" class="pw-post-body-paragraph lr ls it lt b lu mq ju lw lx mr jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated"><strong class="lt iu">定义:分位数</strong></p><p id="ca0f" class="pw-post-body-paragraph lr ls it lt b lu mq ju lw lx mr jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">分位数α (α是一个百分比，0 </p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="1187" class="oe la it oa b gy of og l oh oi">P(x&lt;=Quantile) = α</span></pre><p id="39e5" class="pw-post-body-paragraph lr ls it lt b lu mq ju lw lx mr jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">In other words, the quantile is the distribution’s cumulative distribution function evaluated at α.</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="ffb3" class="oe la it oa b gy of og l oh oi">Quantile α = F^{-1}(α)</span></pre><p id="1760" class="pw-post-body-paragraph lr ls it lt b lu mq ju lw lx mr jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">In simple words, if you do an 80% quantile forecast of tomorrow’s weather, you would say, “There is an 80% probability that the temperature will be 20°C or lower.”</p><blockquote class="oj ok ol"><p id="7b20" class="lr ls mn lt b lu mq ju lw lx mr jx lz om nw mc md on nx mg mh oo ny mk ml mm im bi translated"><strong class="lt iu">边注:</strong>如果你习惯于库存优化和通常的安全库存公式</p><p id="bbe4" class="lr ls mn lt b lu mq ju lw lx mr jx lz om nw mc md on nx mg mh oo ny mk ml mm im bi translated">Ss = z * σ * √(R+L)</p><p id="10ec" class="lr ls mn lt b lu mq ju lw lx mr jx lz om nw mc md on nx mg mh oo ny mk ml mm im bi translated"><em class="it"> z </em>是高斯α分位数z=φ^(-1(α)。不知何故，您可以将安全库存公式视为风险范围内需求的α分位数预测。<br/> PS:记住<a class="ae ky" href="https://www.linkedin.com/posts/vandeputnicolas_inventorymanagement-inventorycontrol-inventoryoptimization-activity-6828222160515997696-I1Ca" rel="noopener ugc nofollow" target="_blank">在这个公式中包含评审期</a>。</p></blockquote><h1 id="2f30" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">不对称处罚</h1><p id="f9d3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们如何评估分位数预测的准确性？让我们再看一下上面的例子:你预测明天的第80个温度分位数是20摄氏度。第二天，温度是16摄氏度。</p><p id="c912" class="pw-post-body-paragraph lr ls it lt b lu mq ju lw lx mr jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">你的预测有多准确？</p><p id="3efe" class="pw-post-body-paragraph lr ls it lt b lu mq ju lw lx mr jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">在讨论数学之前，让我们直观地了解一下应该如何评估(或惩罚)分位数预测。不知何故，当我们说，“我们预测温度有80%的机会低于20摄氏度”，我们预计温度会低于20摄氏度，并会惊讶地发现温度会是25摄氏度。</p><p id="1695" class="pw-post-body-paragraph lr ls it lt b lu mq ju lw lx mr jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">换句话说，如果分位数预测低估了气温，那么它应该比高估气温受到更高的惩罚。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/70b2f06be84aae1551fd88d661feb3d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*V_5sOJ5Uq9SlnrXV52POWg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://supchains.com/" rel="noopener ugc nofollow" target="_blank">尼古拉斯·范德普特</a></p></figure><p id="a18f" class="pw-post-body-paragraph lr ls it lt b lu mq ju lw lx mr jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">此外，如上图所示，对于更高的分位数，过度预测的惩罚应该更高。例如，如果你的95%温度分位数预测是20摄氏度，如果实际温度是25摄氏度，你会<em class="mn">非常</em>惊讶</p><h1 id="ea1c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">弹球损失函数</h1><p id="b6b8" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们使用<strong class="lt iu">弹球损失函数</strong>(或者分位数损失函数)来形式化这个预测惩罚。</p><p id="e041" class="pw-post-body-paragraph lr ls it lt b lu mq ju lw lx mr jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">弹球损失函数<em class="mn"> L_α </em>针对分位数α、分位数预测<em class="mn"> f、</em>和需求<em class="mn"> d </em>计算如下</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="3948" class="oe la it oa b gy of og l oh oi">L_α (d,f) = (d-f) α    if d≥f<br/>            (f-d)(1-α) if f&gt;d</span></pre><p id="3154" class="pw-post-body-paragraph lr ls it lt b lu mq ju lw lx mr jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">该损失函数旨在提供一个预测，其低估需求的概率为α，高估需求的概率为(α-1)。</p><h2 id="63c6" class="oe la it bd lb oq or dn lf os ot dp lj ma ou ov ll me ow ox ln mi oy oz lp pa bi translated">直觉和例子</h2><p id="70ff" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们看看弹球函数在实践中是如何工作的。在下图中，您可以看到一个例子，其中d=100，α=90%(我们希望预测需求的第90个分位数)，弹球损失函数<em class="mn"> L_α </em>是针对不同的<em class="mn"> f </em>值计算的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/a1acec43cd06745e4d064696bd354ccd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*5BQmZ7ae1SrJgesMxtPObw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://www.amazon.com/Nicolas-Vandeput/e/B07KL86HMV" rel="noopener ugc nofollow" target="_blank">尼古拉斯·范德普特</a></p></figure><p id="2e18" class="pw-post-body-paragraph lr ls it lt b lu mq ju lw lx mr jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">正如你所看到的，弹球损失<em class="mn"> L_α </em>是高度不对称的:如果你超过预测(低惩罚)或低于预测(高惩罚)，它不会以相同的速度增加。</p><p id="efac" class="pw-post-body-paragraph lr ls it lt b lu mq ju lw lx mr jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">我们举个例子:多预测20台会造成10%|f-d|=2的损失(也就是说多预测并没有太大的惩罚)。但是，另一方面，少预测20个单位将导致90%的损失|f-d|=18。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/d88f706ae70741808075048512ecdbfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*OEmGPmt9pnTOvth0ccF4aQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:尼古拉斯·范德普特</p></figure><p id="2a51" class="pw-post-body-paragraph lr ls it lt b lu mq ju lw lx mr jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">基本上，预测不足会受到α|e|(其中e是预测误差)的惩罚，而预测过度则会受到(1-α)|e|的惩罚。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/025f06b2bcc1fab6fa5156404c9495f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*QximpTgZKtp3uAHAqFl-Ug.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://www.skuscience.com/" rel="noopener ugc nofollow" target="_blank">尼古拉斯·范德普特</a></p></figure><h2 id="4505" class="oe la it bd lb oq or dn lf os ot dp lj ma ou ov ll me ow ox ln mi oy oz lp pa bi translated">绝对平均误差</h2><p id="8baf" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我的<a class="ae ky" rel="noopener" target="_blank" href="/forecast-kpi-rmse-mae-mape-bias-cdc5703d242d">预测KPI文章</a>中，我强调了优化预测平均绝对误差(MAE)的最终目的是预测中值需求。</p><div class="ne nf gp gr ng nh"><a rel="noopener follow" target="_blank" href="/forecast-kpi-how-to-assess-the-accuracy-of-a-product-portfolio-bc38135a6d2a"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd iu gy z fp nm fr fs nn fu fw is bi translated">预测KPI:如何评估产品组合的准确性？</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">当您处理数千个SKU时，如何评估预测的准确性？</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">towardsdatascience.com</p></div></div><div class="nq l"><div class="pb l ns nt nu nq nv ks nh"/></div></div></a></div><p id="c979" class="pw-post-body-paragraph lr ls it lt b lu mq ju lw lx mr jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">如下图所示，50%分位数弹球损失函数对应于<em class="mn">常规</em>绝对误差——它们是可以互换的。请记住，根据定义，预测50%的需求分位数与预测需求中位数是一样的。这是另一个例子，说明优化MAE将导致针对需求中值的预测(和<em class="mn">而不是</em>需求平均值)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/eae4ef343e5ce1e9e4b57d21f612c8af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*EdhOP1J5wyLAO64bv7J5YQ.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/c41de08f0cf4d975881aee57c407363c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7iiuhN5jer1qCQOcREqNcg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">📘📙<a class="ae ky" href="https://supchains.com/downloads/" rel="noopener ugc nofollow" target="_blank">下载免费摘录</a></p></figure><h1 id="013d" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">自我评估解决方案</h1><ol class=""><li id="50a5" class="mo mp it lt b lu lv lx ly ma pd me pe mi pf mm mv mw mx my bi translated">你想预测你的产品的需求。具体来说，您希望预测一个需求有80%概率低于的值。高估或低估实际需求，哪种情况最糟糕？</li></ol><blockquote class="oj ok ol"><p id="ae94" class="lr ls mn lt b lu mq ju lw lx mr jx lz om nw mc md on nx mg mh oo ny mk ml mm im bi translated">低估需求是最糟糕的。如果您想要预测第80个分位数，您应该以可能高于观察值的值为目标。</p></blockquote><p id="9d91" class="pw-post-body-paragraph lr ls it lt b lu mq ju lw lx mr jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">2.您设计了一个减少绝对误差(或MAE)的预测模型。你的模型的目标是平均需求还是中间需求？</p><blockquote class="oj ok ol"><p id="be3d" class="lr ls mn lt b lu mq ju lw lx mr jx lz om nw mc md on nx mg mh oo ny mk ml mm im bi translated">优化平均绝对误差将最终导致预测预期中值需求，而不是预期平均需求。</p></blockquote><p id="6700" class="pw-post-body-paragraph lr ls it lt b lu mq ju lw lx mr jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">3.您做了一个95%分位数的需求预测，您的预测是150，而观察到的需求是120。你如何评估你的预测质量？</p><blockquote class="oj ok ol"><p id="9eab" class="lr ls mn lt b lu mq ju lw lx mr jx lz om nw mc md on nx mg mh oo ny mk ml mm im bi translated">您可以计算分位数预测的弹球损失。您的预测有30个单位的绝对误差(= | 150–120 |)，这是一个过度预测，因此您的弹球损失是1.5个单位(=30*0.05%)。</p></blockquote><p id="8011" class="pw-post-body-paragraph lr ls it lt b lu mq ju lw lx mr jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">4.你销售高利润的产品。最糟糕的是什么:库存过多还是不足？设置安全库存目标时，您应该以高需求分位数还是低需求分位数为目标？</p><blockquote class="oj ok ol"><p id="434d" class="lr ls mn lt b lu mq ju lw lx mr jx lz om nw mc md on nx mg mh oo ny mk ml mm im bi translated">你想拥有大量高利润产品的库存，所以库存不足是一个糟糕的决定。从今以后，在设定股票目标时，你应该瞄准一个高需求分位数。</p></blockquote><h1 id="6a77" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">🐍自己做</h1><p id="59cc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您可以很容易地在Python中用一个表达式实现弹球损失函数(与原始方程相比有一些修改)。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="0575" class="oe la it oa b gy of og l oh oi"><strong class="oa iu">def</strong> <strong class="oa iu">pinball_loss</strong>(d, f, alpha):</span><span id="06b1" class="oe la it oa b gy pg og l oh oi"><strong class="oa iu">return</strong> max(alpha*(d-f), (1-alpha)*(f-d))</span></pre></div></div>    
</body>
</html>