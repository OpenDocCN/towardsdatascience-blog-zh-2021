<html>
<head>
<title>Easy MLOps with PyCaret + MLflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PyCaret + MLflow轻松实现MLOps</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/easy-mlops-with-pycaret-mlflow-7fbcbf1e38c6?source=collection_archive---------5-----------------------#2021-04-28">https://towardsdatascience.com/easy-mlops-with-pycaret-mlflow-7fbcbf1e38c6?source=collection_archive---------5-----------------------#2021-04-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5922" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一个初学者友好的，一步一步的教程，使用PyCaret在你的机器学习实验中集成MLOps</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b59ab9fb0c0082f4edff78fac49d6734.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WSGn8A3YB42ALgSg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">阿迪·戈尔茨坦在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="9190" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">PyCaret</h1><p id="f6a3" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">PyCaret是一个开源的低代码机器学习库和端到端的模型管理工具，内置于Python中，用于自动化机器学习工作流。它以其易用性、简单性以及快速高效地构建和部署端到端ML原型的能力而闻名。</p><p id="a646" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">PyCaret是一个替代的低代码库，可以用几行代码代替数百行代码。这使得实验周期成倍地快速和有效。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/206f6e936ee58e81e11036edcf925ea7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IOqb01w3mfxSYsRi.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">py caret——Python中的开源、低代码机器学习库</p></figure><p id="779a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">要了解更多关于PyCaret的信息，你可以查看他们的<a class="ae kv" href="https://www.github.com/pycaret/pycaret" rel="noopener ugc nofollow" target="_blank"> GitHub </a>。</p><h1 id="05ba" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">MLflow</h1><p id="ea47" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">MLflow是一个管理ML生命周期的开源平台，包括实验、可复制性、部署和中央模型注册。MLflow目前提供四个组件:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/868ee3a08bb659a0034a04c4d1b945d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EQ48xHBYlnqBKoas54URpQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">MLflow是一个管理ML生命周期的开源平台</p></figure><p id="3786" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">要了解更多关于MLflow的信息，可以查看<a class="ae kv" href="https://github.com/mlflow/mlflow" rel="noopener ugc nofollow" target="_blank"> GitHub </a>。</p><h1 id="3edb" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">正在安装PyCaret</h1><p id="2b12" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">安装PyCaret非常容易，只需要几分钟。我们强烈建议使用虚拟环境来避免与其他库的潜在冲突。</p><p id="6c03" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">PyCaret的默认安装是pycaret的精简版本，只安装这里列出的硬依赖项<a class="ae kv" href="https://github.com/pycaret/pycaret/blob/master/requirements.txt" rel="noopener ugc nofollow" target="_blank"/>。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="e210" class="mw kx iq ms b gy mx my l mz na"><strong class="ms ir"># install slim version (default)<br/></strong>pip install pycaret</span><span id="9c73" class="mw kx iq ms b gy nb my l mz na"><strong class="ms ir"># install the full version</strong><br/>pip install pycaret[full]</span></pre><p id="7bd7" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">当您安装pycaret的完整版本时，这里列出的所有可选依赖项<a class="ae kv" href="https://github.com/pycaret/pycaret/blob/master/requirements-optional.txt" rel="noopener ugc nofollow" target="_blank">也会被安装。MLflow是PyCaret依赖项的一部分，因此不需要单独安装。</a></p><h1 id="b010" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">👉我们开始吧</h1><p id="1de5" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在我谈论MLOps之前，让我们从较高的层面来谈一谈机器学习生命周期:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/872b1027e874732992b79446404c702f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qYCj8HXZ0CUD4DROjU9MAg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">机器学习生命周期-按作者分类的图片(从左至右阅读)</p></figure><ul class=""><li id="5d3d" class="nd ne iq lq b lr mk lu ml lx nf mb ng mf nh mj ni nj nk nl bi translated"><strong class="lq ir">业务问题— </strong>这是机器学习工作流程的第一步。这可能需要几天到几周的时间来完成，这取决于用例以及问题的复杂性。正是在这个阶段，数据科学家与主题专家(SME)会面，以了解问题，采访关键利益相关者，收集信息，并设定项目的总体预期。</li><li id="2f60" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated"><strong class="lq ir">数据来源&amp; ETL — </strong>一旦理解了问题，接下来就要使用访谈中获得的信息从企业数据库中获取数据。</li><li id="ddb8" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated"><strong class="lq ir">探索性数据分析(EDA)——</strong>建模还没开始。EDA是分析原始数据的地方。您的目标是探索数据并评估数据质量、缺失值、特征分布、相关性等。</li><li id="09ad" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated"><strong class="lq ir">数据准备— </strong>现在该准备数据模型培训了。这包括将数据分成训练集和测试集、输入缺失值、一键编码、目标编码、特征工程、特征选择等。</li><li id="ef08" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated"><strong class="lq ir">模特培训&amp;选拔— </strong>这是每个人都为之兴奋的一步。这包括训练一系列模型、调整超参数、模型集合、评估性能指标、模型分析(如AUC、混淆矩阵、残差等),以及最终选择一个最佳模型部署到生产中以供业务使用。</li><li id="85dd" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated"><strong class="lq ir">部署&amp;监控— </strong>这是最后一步，主要是关于MLOps。这包括打包您的最终模型、创建docker映像、编写评分脚本，然后让它们一起工作，最后将其发布为API，可用于获得对通过管道传输的新数据的预测。</li></ul><p id="9e38" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">旧的方法非常麻烦、冗长，并且需要大量的技术知识，我可能无法在一个教程中涵盖它。然而，在本教程中，我将使用PyCaret来演示对于一个数据科学家来说，非常高效地完成所有这些工作是多么容易。在我们进入实际部分之前，让我们再多谈一点关于MLOps的内容。</p><h1 id="64a4" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">👉<strong class="ak">什么是MLOps？</strong></h1><p id="d2fc" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">MLOps是一门工程学科，旨在结合机器学习开发，即实验(模型训练、超参数调整、模型集成、模型选择等)。)，通常由ML工程和运营部门的数据科学家执行，以便标准化和简化生产中机器学习模型的持续交付。</p><p id="7d9e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果你是一个绝对的初学者，你可能不知道我在说什么。别担心。让我给你一个简单的、非技术性的定义:</p><blockquote class="nr ns nt"><p id="4c7e" class="lo lp nu lq b lr mk jr lt lu ml ju lw nv mm lz ma nw mn md me nx mo mh mi mj ij bi translated"><em class="iq">mlop是一系列技术工程和运营任务，允许您的机器学习模型被组织中的其他用户和应用程序使用。基本上，这是一种方式，通过这种方式，你的工作，即</em>机器学习模型<em class="iq">被在线发布，因此其他人可以使用它们并满足一些商业目标。</em></p></blockquote><p id="5338" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这是一个非常低调的定义。实际上，它涉及的工作和利益比这多一点，但如果你是新手，这是一个好的开始。</p><p id="9edc" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在让我们按照上图所示的工作流程做一个实际的演示，确保你已经安装了pycaret。</p><h1 id="bbe1" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">👉商业问题</h1><p id="07af" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在本教程中，我将使用达顿商学院发表在<a class="ae kv" href="https://hbsp.harvard.edu/product/UV0869-PDF-ENG" rel="noopener ugc nofollow" target="_blank">哈佛商业</a>上的一个非常受欢迎的案例研究。这个案子是关于两个未来将要结婚的人的故事。名叫<em class="nu">格雷格</em>的家伙想买一枚戒指向名叫<em class="nu">莎拉</em>的女孩求婚。问题是找到莎拉会喜欢的戒指，但在他的密友建议后，格雷格决定买一颗钻石，这样莎拉就可以决定她的选择。然后，格雷格收集了6000颗钻石的价格和切割、颜色、形状等属性数据。</p><h1 id="c1ee" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">👉数据</h1><p id="649e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在本教程中，我将使用一个数据集，该数据集来自达顿商学院的一个非常受欢迎的案例研究，发表在<a class="ae kv" href="https://hbsp.harvard.edu/product/UV0869-PDF-ENG" rel="noopener ugc nofollow" target="_blank">哈佛商业</a>上。本教程的目标是根据钻石的重量、切割、颜色等属性来预测钻石的价格。您可以从<a class="ae kv" href="https://github.com/pycaret/pycaret/tree/master/datasets" rel="noopener ugc nofollow" target="_blank"> PyCaret的存储库</a>下载数据集。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="7052" class="mw kx iq ms b gy mx my l mz na"><strong class="ms ir"># load the dataset from pycaret<br/></strong>from pycaret.datasets import get_data<br/>data = get_data('diamond')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/069a134f69d768fe9f2ee1bafb93ab5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1094/format:webp/0*rDRvbnmVe7vDGPVM.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数据中的样本行</p></figure><h1 id="0fe8" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">👉探索性数据分析</h1><p id="d9ef" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">让我们做一些快速可视化来评估独立特征(重量、切割、颜色、净度等)之间的关系。)与目标变量即<code class="fe nz oa ob ms b">Price</code></p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="7d0b" class="mw kx iq ms b gy mx my l mz na"><strong class="ms ir"># plot scatter carat_weight and Price</strong><br/>import plotly.express as px<br/>fig = px.scatter(x=data['Carat Weight'], y=data['Price'], <br/>                 facet_col = data['Cut'], opacity = 0.25, template = 'plotly_dark', trendline='ols',<br/>                 trendline_color_override = 'red', title = 'SARAH GETS A DIAMOND - A CASE STUDY')<br/>fig.show()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/5804ec6c03d897edfdd4134dd14edf41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Lo6mo1OUPjb-Cenm.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">莎拉得到了一份钻石案例研究</p></figure><p id="3ef0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们检查目标变量的分布。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="c14c" class="mw kx iq ms b gy mx my l mz na"><strong class="ms ir"># plot histogram</strong><br/>fig = px.histogram(data, x=["Price"], template = 'plotly_dark', title = 'Histogram of Price')<br/>fig.show()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/f08030a9182c918e839238d3917f8105.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VjW1-hOpd7hVBtIj.png"/></div></div></figure><p id="cc63" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">请注意，<code class="fe nz oa ob ms b">Price</code>的分布是右偏的，我们可以快速查看对数变换是否可以使<code class="fe nz oa ob ms b">Price</code>接近正态，从而给假设正态的算法一个机会。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="a979" class="mw kx iq ms b gy mx my l mz na">import numpy as np</span><span id="f760" class="mw kx iq ms b gy nb my l mz na"><strong class="ms ir"># create a copy of data</strong><br/>data_copy = data.copy()</span><span id="9615" class="mw kx iq ms b gy nb my l mz na"><strong class="ms ir"># create a new feature Log_Price</strong><br/>data_copy['Log_Price'] = np.log(data['Price'])</span><span id="a232" class="mw kx iq ms b gy nb my l mz na"><strong class="ms ir"># plot histogram</strong><br/>fig = px.histogram(data_copy, x=["Log_Price"], title = 'Histgram of Log Price', template = 'plotly_dark')<br/>fig.show()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/2dc0dec4c8c13e307328cee992a1163d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KfvEU2c6f8LdjUPS.png"/></div></div></figure><p id="58cb" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这证实了我们的假设。这种转换将帮助我们摆脱偏态，使目标变量接近正态。基于此，我们将在训练我们的模型之前转换<code class="fe nz oa ob ms b">Price</code>变量。</p><h1 id="ea63" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">👉数据准备</h1><p id="7ea2" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">对于PyCaret中的所有模块来说，<code class="fe nz oa ob ms b">setup</code>是任何使用PyCaret的机器学习实验中的第一步，也是唯一一步。该功能负责训练模型之前所需的所有数据准备。除了执行一些基本的默认处理任务，PyCaret还提供了一系列预处理功能。要了解PyCaret中所有预处理功能的更多信息，您可以查看这个<a class="ae kv" href="https://pycaret.org/preprocessing/" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="fad8" class="mw kx iq ms b gy mx my l mz na"><strong class="ms ir"># initialize setup</strong><br/>from pycaret.regression import *<br/>s = setup(data, target = 'Price', transform_target = True, log_experiment = True, experiment_name = 'diamond')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/b931e3f6e626893b6189f6920afb3340.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dCiKXVXfpXyYQiYd.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">pycaret.regression模块中的设置函数</p></figure><p id="c6a8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">当您在PyCaret中初始化<code class="fe nz oa ob ms b">setup</code>函数时，它会分析数据集并推断所有输入要素的数据类型。如果所有数据类型都推断正确，您可以按enter键继续。</p><p id="1f7b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">请注意:</p><ul class=""><li id="673f" class="nd ne iq lq b lr mk lu ml lx nf mb ng mf nh mj ni nj nk nl bi translated">我已经通过了<code class="fe nz oa ob ms b">log_experiment = True</code>和<code class="fe nz oa ob ms b">experiment_name = 'diamond'</code>，这将告诉PyCaret在建模阶段自动记录所有的度量、超参数和模型工件。由于与<a class="ae kv" href="https://www.mlflow.org" rel="noopener ugc nofollow" target="_blank"> MLflow </a>的集成，这是可能的。</li><li id="4a2d" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated">还有，我在<code class="fe nz oa ob ms b">setup</code>里面用过<code class="fe nz oa ob ms b">transform_target = True</code>。PyCaret将使用box-cox变换在后台转换<code class="fe nz oa ob ms b">Price</code>变量。它以类似于日志转换<em class="nu">(技术上不同)</em>的方式影响数据的分布。如果你想了解更多关于box-cox变换的知识，你可以参考这个<a class="ae kv" href="https://onlinestatbook.com/2/transformations/box-cox.html" rel="noopener ugc nofollow" target="_blank">链接</a>。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi og"><img src="../Images/a0316354dc30940eae55deda6972a555.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/0*b5w1YKkwK2G9n_YA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">设置的输出—为显示而截断</p></figure><h1 id="6fbf" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">👉模型训练和选择</h1><p id="5fa8" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在数据已经准备好进行建模，让我们使用<code class="fe nz oa ob ms b">compare_models</code>函数开始训练过程。它将训练模型库中所有可用的算法，并使用k-fold交叉验证评估多个性能指标。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="41b1" class="mw kx iq ms b gy mx my l mz na"><strong class="ms ir"># compare all models</strong><br/>best = compare_models()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/94ba47b57a471acde990033d3d742460.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FZAGMj-lU-C_kxRl.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">compare_models的输出</p></figure><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="8148" class="mw kx iq ms b gy mx my l mz na"><strong class="ms ir"># check the residuals of trained model</strong><br/>plot_model(best, plot = 'residuals_interactive')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/cb577612be227f11ba1f9a152aa377e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yOzbuZjSXY4s2v4Z.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">最佳模型的残差和QQ图</p></figure><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="b146" class="mw kx iq ms b gy mx my l mz na"><strong class="ms ir"># check feature importance</strong><br/>plot_model(best, plot = 'feature')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/0207b7dc96aebe32cd5f3545191692bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*m8k8VaglnYOkNx5x.png"/></div></div></figure><h2 id="1a58" class="mw kx iq bd ky ok ol dn lc om on dp lg lx oo op li mb oq or lk mf os ot lm ou bi translated">完成并保存管道</h2><p id="25dc" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在让我们最终确定最佳模型，即在包括测试集在内的整个数据集上训练最佳模型，然后将管道保存为pickle文件。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="5e79" class="mw kx iq ms b gy mx my l mz na"><strong class="ms ir"># finalize the model</strong><br/>final_best = finalize_model(best)</span><span id="1109" class="mw kx iq ms b gy nb my l mz na"><strong class="ms ir"># save model to disk<br/></strong>save_model(final_best, 'diamond-pipeline')</span></pre><p id="e90e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><code class="fe nz oa ob ms b">save_model</code>函数将把整个管道(包括模型)保存为本地磁盘上的pickle文件。默认情况下，它会将文件保存在笔记本或脚本所在的文件夹中，但是如果您愿意，也可以传递完整的路径:</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="7865" class="mw kx iq ms b gy mx my l mz na">save_model(final_best, 'c:/users/moez/models/diamond-pipeline'</span></pre><h1 id="5507" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">👉部署</h1><p id="3b15" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">记得我们在设置函数中通过了<code class="fe nz oa ob ms b">log_experiment = True</code>和<code class="fe nz oa ob ms b">experiment_name = 'diamond'</code>。让我们看看PyCaret在MLflow的帮助下在幕后实现了什么。让我们启动MLflow服务器来看看这个神奇的过程:</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="6ea5" class="mw kx iq ms b gy mx my l mz na"><strong class="ms ir"># within notebook (notice ! sign infront)<br/></strong>!mlflow ui</span><span id="e2ed" class="mw kx iq ms b gy nb my l mz na"><strong class="ms ir"># on command line in the same folder<br/></strong>mlflow ui</span></pre><p id="8589" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在打开浏览器，输入“localhost:5000”。它将打开这样一个用户界面:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/99da29b10c4dd93f69b2d9f5bd3442d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yZ4zThh0tnY0uW8SsLCpdw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">https://本地主机:5000</p></figure><p id="92d4" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">上表中的每个条目代表一个训练运行，该运行产生一个训练管道和一堆元数据，例如运行的日期时间、性能度量、模型超参数、标签等。让我们点击其中一个模型:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/cd218c01aadd20b5841b68a0d620e972.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TQEApDxCxDIoN6GWwvbBZw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">第一部分— CatBoost回归器</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/7acc1b4af046ae6133a998b743f3b842.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RVC18B9Zk8rJkLp28jHkjA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">第二部分— CatBoost回归器(续)</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/cab67d822585402ab3197f20aad21619.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1rsOUsPzyY3O0Djao2KlzQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">第二部分— CatBoost回归器(续)</p></figure><p id="01db" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">注意，您有一个<code class="fe nz oa ob ms b">logged_model</code>的地址路径。这是带有Catboost回归器的训练管道。您可以使用<code class="fe nz oa ob ms b">load_model</code>函数读取这个管道。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="dc6d" class="mw kx iq ms b gy mx my l mz na"><strong class="ms ir"># load model</strong><br/>from pycaret.regression import load_model<br/>pipeline = load_model('<!-- -->C:/Users/moezs/mlruns/1/b8c10d259b294b28a3e233a9d2c209c0/artifacts/model/model')</span><span id="bf9f" class="mw kx iq ms b gy nb my l mz na"><strong class="ms ir"># print pipeline<br/></strong>print(pipeline)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/0c51286b76fd7a7e9b939f2854762c45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E0dUApG1JQnddUfVHmCYvg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">打印输出(管道)</p></figure><p id="bc9a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在让我们使用这个管道来生成对新数据的预测</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="c100" class="mw kx iq ms b gy mx my l mz na"><strong class="ms ir"># create a copy of data and drop Price<br/></strong>data2 = data.copy()<br/>data2.drop('Price', axis=1, inplace=True)</span><span id="8273" class="mw kx iq ms b gy nb my l mz na"><strong class="ms ir"># generate predictions<br/></strong>from pycaret.regression import predict_model<br/>predictions = predict_model(pipeline, data=data2)<br/>predictions.head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/99c5391494e00f418432d8640d6d5896.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IVtFV6oRqcsgyNQTHbb3QA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">从管道生成的预测</p></figure><p id="d57a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">呜哇！我们现在从训练有素的管道中得到推论。恭喜，如果这是你的第一次。请注意，所有转换，如目标转换、一键编码、缺失值插补等。自动在幕后发生。你得到一个实际规模的预测数据框架，这就是你所关心的。</p><h1 id="55ce" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">即将推出！</h1><p id="688b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我今天展示的是在MLflow的帮助下，您可以在生产中使用PyCaret提供的经过培训的管道的许多方法之一。在下一篇教程中，我计划展示如何使用MLflow原生服务功能来注册您的模型，对它们进行版本化并作为API使用。</p></div><div class="ab cl pb pc hu pd" role="separator"><span class="pe bw bk pf pg ph"/><span class="pe bw bk pf pg ph"/><span class="pe bw bk pf pg"/></div><div class="ij ik il im in"><p id="9513" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">使用Python中的这个轻量级工作流自动化库，您可以实现的目标是无限的。如果你觉得这很有用，请不要忘记给我们GitHub库上的⭐️。</p><p id="1699" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">想了解更多关于PyCaret的信息，请在<a class="ae kv" href="https://www.linkedin.com/company/pycaret/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae kv" href="https://www.youtube.com/channel/UCxA1YTYJ9BEeo50lxyI_B3g" rel="noopener ugc nofollow" target="_blank"> Youtube </a>上关注我们。</p><p id="c255" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">加入我们的休闲频道。此处邀请链接<a class="ae kv" href="https://join.slack.com/t/pycaret/shared_invite/zt-p7aaexnl-EqdTfZ9U~mF0CwNcltffHg" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="0ea9" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">您可能还对以下内容感兴趣:</h1><p id="5c78" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><a class="ae kv" rel="noopener" target="_blank" href="/build-your-own-automl-in-power-bi-using-pycaret-8291b64181d">使用PyCaret 2.0 </a> <br/> <a class="ae kv" rel="noopener" target="_blank" href="/deploy-machine-learning-pipeline-on-cloud-using-docker-container-bec64458dc01">在Power BI中构建您自己的AutoML使用Docker </a> <br/> <a class="ae kv" rel="noopener" target="_blank" href="/deploy-machine-learning-model-on-google-kubernetes-engine-94daac85108b">在Azure上部署机器学习管道在Google Kubernetes引擎上部署机器学习管道</a> <br/> <a class="ae kv" rel="noopener" target="_blank" href="/deploy-machine-learning-pipeline-on-aws-fargate-eb6e1c50507">在AWS Fargate上部署机器学习管道</a> <br/> <a class="ae kv" rel="noopener" target="_blank" href="/build-and-deploy-your-first-machine-learning-web-app-e020db344a99">构建和部署您的第一个机器学习web应用</a> <br/> <a class="ae kv" rel="noopener" target="_blank" href="/deploy-pycaret-and-streamlit-app-using-aws-fargate-serverless-infrastructure-8b7d7c0584c2">使用AWS Fargate无服务器</a> <br/> <a class="ae kv" rel="noopener" target="_blank" href="/build-and-deploy-machine-learning-web-app-using-pycaret-and-streamlit-28883a569104">构建和部署机器</a></p><h1 id="2624" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">重要链接</h1><p id="9039" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><a class="ae kv" href="https://pycaret.readthedocs.io/en/latest/installation.html" rel="noopener ugc nofollow" target="_blank">文档</a> <br/> <a class="ae kv" href="https://medium.com/@moez_62905" rel="noopener">博客</a><br/><a class="ae kv" href="http://www.github.com/pycaret/pycaret" rel="noopener ugc nofollow" target="_blank">GitHub</a><br/><a class="ae kv" href="https://stackoverflow.com/questions/tagged/pycaret" rel="noopener ugc nofollow" target="_blank">stack overflow</a><br/><a class="ae kv" href="https://pycaret.readthedocs.io/en/latest/installation.html" rel="noopener ugc nofollow" target="_blank">安装PyCaret <br/> </a> <a class="ae kv" href="https://pycaret.readthedocs.io/en/latest/tutorials.html" rel="noopener ugc nofollow" target="_blank">笔记本教程<br/> </a> <a class="ae kv" href="https://pycaret.readthedocs.io/en/latest/contribute.html" rel="noopener ugc nofollow" target="_blank">投稿于PyCaret </a></p><h1 id="2cf3" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">想了解某个特定模块？</h1><p id="7e40" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">单击下面的链接查看文档和工作示例。</p><p id="c1fd" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><a class="ae kv" href="https://pycaret.readthedocs.io/en/latest/api/classification.html" rel="noopener ugc nofollow" target="_blank">分类<br/></a>T3】回归T5】T6】聚类 <br/> <a class="ae kv" href="https://pycaret.readthedocs.io/en/latest/api/anomaly.html" rel="noopener ugc nofollow" target="_blank">异常检测</a> <br/> <a class="ae kv" href="https://pycaret.readthedocs.io/en/latest/api/nlp.html" rel="noopener ugc nofollow" target="_blank">自然语言处理<br/> </a> <a class="ae kv" href="https://pycaret.readthedocs.io/en/latest/api/arules.html" rel="noopener ugc nofollow" target="_blank">关联规则挖掘</a></p></div></div>    
</body>
</html>