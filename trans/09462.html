<html>
<head>
<title>Azure ML and DevOps meet Titanic</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure ML和DevOps遇见泰坦尼克号</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/azure-ml-and-devops-meets-titanic-6a0aa748d5a8?source=collection_archive---------14-----------------------#2021-09-02">https://towardsdatascience.com/azure-ml-and-devops-meets-titanic-6a0aa748d5a8?source=collection_archive---------14-----------------------#2021-09-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="fa21" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Azure Machine Learning是一个云服务，用于加速和管理机器学习项目生命周期。它使您能够创建模型或使用从开源平台(如Pytorch、TensorFlow或scikit-learn)构建的模型。Azure ML补充了额外的MLOps工具，帮助您监控、重新训练和重新部署模型。</p><p id="72fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇博文中，我想展示如何使用Azure机器学习笔记本和计算实例进行开发，使用集群进行培训，使用容器网站进行生产，来构建、培训和部署一个模型。对于这个演示，我们将使用泰坦尼克号乘客数据(<a class="ae kl" href="https://raw.githubusercontent.com/pietheinstrengholt/Azure-ML-and-DevOps-meets-Titanic/main/Titanic.csv" rel="noopener ugc nofollow" target="_blank"> Titanic.csv </a>)，使用随机森林模型预测谁将幸存。</p><h1 id="520e" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">设置环境</h1><p id="00a1" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">如果你有一个Azure帐户，你可以去Azure门户网站创建一个机器学习工作区。你可以使用搜索栏找到机器学习，然后点击创建按钮。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/f381497e12c21004e688deaddcecb4a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3wm2GC6SuIUJQJUUb_1sMA.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">图片由Piethein Strengholt提供</p></figure><p id="d101" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，您需要填写项目细节，比如您的订阅ID、资源组名称和工作区名称。你可以从基础开始，所以点击“查看+创建”。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mf"><img src="../Images/a945ee84285c3de6330a91121ba19f6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q6KksbP2BNyObtTEQO9VXQ.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">图片由Piethein Strengholt提供</p></figure><p id="86ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">部署后，您可以使用资源组概述窗格检查所有新创建资源的结果。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mg"><img src="../Images/43e75803f1443397ee58a2fec6bd3cc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rQEvsUCyA1W1j8q70WWvOQ.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">图片由Piethein Strengholt提供</p></figure><p id="d878" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Azure机器学习服务自带默认存储账号。在我们的演示中，您将使用这个默认的存储帐户来使我们的Titanic数据可用。点击存储账号，点击默认的azureml-blobstore-xxx容器，使用上传按钮上传你的<a class="ae kl" href="https://raw.githubusercontent.com/pietheinstrengholt/Azure-ML-and-DevOps-meets-Titanic/main/Titanic.csv" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Titanic.csv </strong> </a>数据。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mh"><img src="../Images/9cb47c4d53970a8b45ef99ef2ea99fdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9gBx5tCUQQFLtqN0E3Hq6g.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">图片由Piethein Strengholt提供</p></figure><p id="f7be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本演示中，您还需要使用存储帐户<strong class="jp ir">访问密钥</strong>。点击返回并转到默认存储帐户。在左侧点击“访问密钥”，点击“显示密钥”，并将密钥信息复制到一个安全的位置供以后使用。</p><h2 id="6a45" class="mi kn iq bd ko mj mk dn ks ml mm dp kw jy mn mo la kc mp mq le kg mr ms li mt bi translated">服务主体认证</h2><p id="5ce0" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">为了将机器学习工作流设置为自动化过程，我推荐使用服务主体认证。这种方法将身份验证从任何特定的用户登录中分离出来，并允许管理访问控制。</p><p id="b2d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一步是创建服务主体。首先选择<strong class="jp ir"> Azure Active Directory </strong>和<strong class="jp ir"> App注册</strong>。然后选择+New application，给你的服务主体起个名字，比如<em class="mu">my-SVP-machine-learning</em>。您可以保持其他参数不变。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mv"><img src="../Images/cf282f1c14b935eb11cb65d2eb3ca2fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TbnSoJAcU62TqREz2DPCNg.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">图片由Piethein Strengholt提供</p></figure><p id="3eca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从您新创建的服务主体的页面中，复制<em class="mu">应用程序ID </em>和<em class="mu">租户ID </em>，因为稍后需要它们。然后选择<strong class="jp ir">证书&amp;秘密</strong>，和<strong class="jp ir">+新客户秘密</strong>为你的密钥写一个描述，并选择持续时间。然后点击<strong class="jp ir">添加</strong>，将<em class="mu">客户端机密</em>的值复制到安全位置以备后用。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mw"><img src="../Images/1318bfa3b22a74d067e7a60cf651fa6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cHDMVJUrSQrMnAQbm5N_AQ.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">图片由Piethein Strengholt提供</p></figure><p id="a9dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，您需要授予服务主体访问Azure ML工作空间的权限。导航到资源组，导航到机器学习工作区的资源组。然后选择访问控制(IAM)并添加角色分配。对于角色，指定需要授予的访问权限级别，例如参与者。开始输入您的服务主体名称，找到后，选择它，然后单击Save。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mx"><img src="../Images/9575eb772eeebeebea425f4d6cfe03c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JIlqHkoQUuePZK4vk22k1g.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">图片由Piethein Strengholt提供</p></figure><h1 id="5278" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak"> Azure机器学习</strong></h1><p id="2587" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">设置好一切后，我们就可以开始了。悬停回到机器学习服务并启动工作室。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi my"><img src="../Images/438d609e5711a3ba6e0c80e463615fa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2nb5NDTlwn5DQqXZfOFuXA.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">图片由Piethein Strengholt提供</p></figure><p id="3f2e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">启动studio环境后，您将看到一个包含许多框和控件的概览屏幕。让我给你一个组件的高层次理解，以及它们如何一起工作，以协助建立，部署和维护机器学习模型的过程。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mz"><img src="../Images/6f33cb5e9d80e7d6dc42d6202cc8607a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4uiKQPW1d-30oXx-S8x_Jw.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">图片由Piethein Strengholt提供</p></figure><ul class=""><li id="ca79" class="na nb iq jp b jq jr ju jv jy nc kc nd kg ne kk nf ng nh ni bi translated">一个<strong class="jp ir">工作区</strong>是集中所有服务和平台组件的地方。</li><li id="aff8" class="na nb iq jp b jq nj ju nk jy nl kc nm kg nn kk nf ng nh ni bi translated">一个<strong class="jp ir">计算目标</strong>是您用来运行您的培训脚本或托管您的服务部署的任何机器或一组机器(集群)。</li><li id="17ec" class="na nb iq jp b jq nj ju nk jy nl kc nm kg nn kk nf ng nh ni bi translated"><strong class="jp ir">数据集</strong>使访问和处理数据变得更加容易。通过创建数据集，可以创建对数据源位置的引用及其元数据的副本。</li><li id="7400" class="na nb iq jp b jq nj ju nk jy nl kc nm kg nn kk nf ng nh ni bi translated"><strong class="jp ir">环境</strong>是对你的机器学习模型进行训练或评分的环境的封装。</li><li id="d601" class="na nb iq jp b jq nj ju nk jy nl kc nm kg nn kk nf ng nh ni bi translated">一个<strong class="jp ir">实验</strong>是来自一个指定脚本的许多运行的分组。它总是属于一个工作区。提交运行时，您需要提供一个实验名称。</li><li id="b3ac" class="na nb iq jp b jq nj ju nk jy nl kc nm kg nn kk nf ng nh ni bi translated">一次<strong class="jp ir">运行</strong>是训练脚本的一次执行。一个实验通常包含多次运行。</li><li id="d6a5" class="na nb iq jp b jq nj ju nk jy nl kc nm kg nn kk nf ng nh ni bi translated">一个<strong class="jp ir">笔记本</strong>用来在集成的Jupyter笔记本服务器上编写和运行你自己的代码。</li></ul><h2 id="5129" class="mi kn iq bd ko mj mk dn ks ml mm dp kw jy mn mo la kc mp mq le kg mr ms li mt bi translated">设置计算实例</h2><p id="a166" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">为了开发新的模型，您需要有一个计算实例，这是一个包含为机器学习安装的多个工具和环境的容器。计算实例主要用于开发工作站。该计算实例还可以用作培训和推理作业的计算目标。在左侧，单击compute并创建一个新的计算实例。您现在可以保留默认设置，因此单击“Create”创建您的第一个计算实例。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi no"><img src="../Images/b3b3009bfdd71a7ea0771f765136d4c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D8Cl739UrtWUDuSh4L7-gA.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">图片由Piethein Strengholt提供</p></figure><h2 id="2681" class="mi kn iq bd ko mj mk dn ks ml mm dp kw jy mn mo la kc mp mq le kg mr ms li mt bi translated">构建您的第一台笔记本电脑</h2><p id="95ce" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">让我们继续我们的旅程，开发我们的泰坦尼克号生存预测模型。您将通过使用Jupyter笔记本来完成此操作。点击“笔记本”和“新建”,然后选择创建新笔记本。左侧的文件夹和文件结构将类似于您在下图中看到的内容。点击+新建。在我的例子中，我输入<strong class="jp ir"> Titanic.ipny </strong>作为我的第一个笔记本，但是你可以选择任何名字。请注意，这是为了开发和测试的目的。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi no"><img src="../Images/95cb9ae904bb0eb3c89f0261d156d96e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w08G9oNA9IE4xW5vifunTg.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">图片由Piethein Strengholt提供</p></figure><p id="3672" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于模型本身，我使用了来自towardsdatascience.com的<a class="ae kl" rel="noopener" target="_blank" href="/predicting-the-survival-of-titanic-passengers-30870ccc7e8">预测泰坦尼克号乘客生存的文章。我用额外的配置增强了代码，以将流程与Azure ML紧密集成。让我们一行一行地浏览脚本:</a></p><pre class="lq lr ls lt gt np nq nr ns aw nt bi"><span id="a127" class="mi kn iq nq b gy nu nv l nw nx"># importing necessary libraries</span><span id="0760" class="mi kn iq nq b gy ny nv l nw nx">from azureml.core import Workspace, Datastore, Dataset, Experiment, Model<br/>from azureml.data.dataset_factory import DataType</span><span id="6f4b" class="mi kn iq nq b gy ny nv l nw nx"># importing sklearn libraries</span><span id="4c2f" class="mi kn iq nq b gy ny nv l nw nx">import sklearn<br/>from sklearn import linear_model<br/>from sklearn.linear_model import LogisticRegression<br/>from sklearn.ensemble import RandomForestClassifier<br/>from sklearn import metrics<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.metrics import classification_report<br/>from sklearn.metrics import confusion_matrix<br/>from sklearn.preprocessing import MinMaxScaler<br/>from sklearn.tree import DecisionTreeClassifier<br/>from sklearn import preprocessing</span><span id="5fae" class="mi kn iq nq b gy ny nv l nw nx"># Useful for good split of data into train and test<br/>from sklearn.model_selection import train_test_split</span><span id="0250" class="mi kn iq nq b gy ny nv l nw nx"># import pandas<br/>import pandas as pd</span><span id="b889" class="mi kn iq nq b gy ny nv l nw nx"># linear algebra<br/>import numpy as np</span><span id="ea00" class="mi kn iq nq b gy ny nv l nw nx"># import re package<br/>import re</span><span id="4421" class="mi kn iq nq b gy ny nv l nw nx"># import joblib<br/>import joblib</span><span id="004f" class="mi kn iq nq b gy ny nv l nw nx"># import seaborn<br/>import seaborn as sns</span><span id="4838" class="mi kn iq nq b gy ny nv l nw nx"># import matplotlib<br/>%matplotlib inline<br/>from matplotlib import pyplot as plt</span></pre><p id="cd24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">导入所有必需的库需要第一个代码块。azureml.core包是与我们的azureml工作空间进行通信所必需的。我们的模型需要其余的包，比如sklearn。</p><pre class="lq lr ls lt gt np nq nr ns aw nt bi"><span id="addf" class="mi kn iq nq b gy nu nv l nw nx"># get existing workspace<br/>ws = Workspace.from_config()</span><span id="6560" class="mi kn iq nq b gy ny nv l nw nx"># set connection string settings<br/>blob_datastore_name='machinelearnin9342837683' <br/>container_name=os.getenv("BLOB_CONTAINER", "azureml-blobstore-867fb2e1-6f13-4490-bc45-291d19912ec0") <br/>account_name=os.getenv("BLOB_ACCOUNTNAME", "machinelearnin9763237684")<br/>account_key=os.getenv("BLOB_ACCOUNT_KEY", "ExMnf3yB6usdSLi96wo53MMDA/QX5E6WnccJHAq1ECawHDDb5WI1ATw9UUqS3lgHQm69oKfNwWIrUtlSXZ1RQA==")</span><span id="16c1" class="mi kn iq nq b gy ny nv l nw nx"># register blob storage account within AMLS<br/>datastore = Datastore.register_azure_blob_container(workspace=ws, <br/>                                                   datastore_name=blob_datastore_name, <br/>                                                        container_name=container_name, <br/>                                                         account_name=account_name,<br/>                                                         account_key=account_key,<br/>                                                         overwrite=True)</span><span id="b452" class="mi kn iq nq b gy ny nv l nw nx"># connect to the azure blob storage account<br/>try:<br/>    datastore = Datastore.get(ws, blob_datastore_name)<br/>    print("Found Blob Datastore with name: %s" % blob_datastore_name)<br/>except UserErrorException:<br/>    datastore = Datastore.register_azure_blob_container(<br/>        workspace=ws,<br/>        datastore_name=blob_datastore_name,<br/>        account_name=account_name, # Storage account name<br/>        container_name=container_name, # Name of Azure blob container<br/>        account_key=account_key,<br/>        protocol=http) # Storage account key<br/>    print("Registered blob datastore with name: %s" % blob_datastore_name)</span><span id="fd21" class="mi kn iq nq b gy ny nv l nw nx"># attach Titanic.csv file<br/>dataset = Dataset.Tabular.from_delimited_files(path=[(datastore, 'Titanic.csv')])</span></pre><p id="1d10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一个代码块需要访问我们的工作区，并从您的存储帐户和容器中检索大量数据。此脚本中的凭据用于将存储帐户注册为新的数据存储(从您的安全位置复制粘贴访问密钥)。一旦连接上，你就可以删除这些行项目，因为Azure ML会进一步处理这个问题。这允许您不在脚本中放置任何凭据。现在，就让它这样吧。</p><pre class="lq lr ls lt gt np nq nr ns aw nt bi"><span id="cd46" class="mi kn iq nq b gy nu nv l nw nx"># register Dataset as version 1<br/>dataset.register(workspace = ws, name = 'titanic', create_new_version = True)</span></pre><p id="3b0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一行项目是关于将该数据集注册为版本1。</p><pre class="lq lr ls lt gt np nq nr ns aw nt bi"><span id="be73" class="mi kn iq nq b gy nu nv l nw nx">experiment = Experiment(ws, "TitanicExperiment")<br/>run = experiment.start_logging(outputs=None, snapshot_directory=".")</span></pre><p id="04dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一步是你将注册你的泰坦尼克号实验。这很有用，因为通过实验，您可以查看所有使用的输入数据集、训练和测试数据、结果、日志记录信息等等。让我们跳到机器学习模型本身。</p><pre class="lq lr ls lt gt np nq nr ns aw nt bi"><span id="6478" class="mi kn iq nq b gy nu nv l nw nx"># convert dataset to pandas dataframe<br/>titanic_ds = dataset.to_pandas_dataframe()</span><span id="a292" class="mi kn iq nq b gy ny nv l nw nx">print("Examine titanic dataset")<br/>titanic_ds.info()</span><span id="2acc" class="mi kn iq nq b gy ny nv l nw nx">print("Show first records")<br/>titanic_ds.head(10)</span><span id="95a3" class="mi kn iq nq b gy ny nv l nw nx"># convert ‘Sex’ feature into numeric<br/>genders = {"male": 0, "female": 1}<br/>data = [titanic_ds]<br/>for dataset in data:<br/>    dataset['Sex'] = dataset['Sex'].map(genders)</span><span id="4004" class="mi kn iq nq b gy ny nv l nw nx"># since the most common port is Southampton the chances are that the missing one is from there<br/>titanic_ds['Embarked'].fillna(value='S', inplace=True)</span><span id="b40d" class="mi kn iq nq b gy ny nv l nw nx"># convert ‘Embarked’ feature into numeric<br/>ports = {"S": 0, "C": 1, "Q": 2}<br/>data = [titanic_ds]<br/>for dataset in data:<br/>    dataset['Embarked'] = dataset['Embarked'].map(ports)</span><span id="741a" class="mi kn iq nq b gy ny nv l nw nx"># convert ‘Survived’ feature into numeric<br/>ports = {False: 0, True: 1}<br/>data = [titanic_ds]<br/>for dataset in data:<br/>    dataset['Survived'] = dataset['Survived'].map(ports)</span><span id="0b32" class="mi kn iq nq b gy ny nv l nw nx"># a cabin number looks like ‘C123’ and the letter refers to the deck.<br/># therefore we’re going to extract these and create a new feature, that contains a persons deck. <br/>deck = {"A": 1, "B": 2, "C": 3, "D": 4, "E": 5, "F": 6, "G": 7, "U": 8}<br/>data = [titanic_ds]<br/>for dataset in data:<br/>    dataset['Cabin'] = dataset['Cabin'].fillna("U0")<br/>    dataset['Deck'] = dataset['Cabin'].map(lambda x: re.compile("([a-zA-Z]+)").search(x).group())<br/>    dataset['Deck'] = dataset['Deck'].map(deck)<br/>    dataset['Deck'] = dataset['Deck'].fillna(0)<br/>    dataset['Deck'] = dataset['Deck'].astype(int)</span><span id="70fd" class="mi kn iq nq b gy ny nv l nw nx"># drop cabin since we have a deck feature<br/>titanic_ds = titanic_ds.drop(['Cabin'], axis=1)</span><span id="eb85" class="mi kn iq nq b gy ny nv l nw nx"># fix age features missing values<br/>data = [titanic_ds]<br/>for dataset in data:<br/>    mean = titanic_ds["Age"].mean()<br/>    std = titanic_ds["Age"].std()<br/>    is_null = dataset["Age"].isnull().sum()<br/>    # compute random numbers between the mean, std and is_null<br/>    rand_age = np.random.randint(mean - std, mean + std, size = is_null)<br/>    # fill NaN values in Age column with random values generated<br/>    age_slice = dataset["Age"].copy()<br/>    age_slice[np.isnan(age_slice)] = rand_age<br/>    dataset["Age"] = age_slice<br/>    dataset["Age"] = titanic_ds["Age"].astype(int)</span><span id="09c9" class="mi kn iq nq b gy ny nv l nw nx"># convert ‘age’ to a feature holding a category<br/>data = [titanic_ds]<br/>for dataset in data:<br/>    dataset['Age'] = dataset['Age'].astype(int)<br/>    dataset.loc[ dataset['Age'] &lt;= 11, 'Age'] = 0<br/>    dataset.loc[(dataset['Age'] &gt; 11) &amp; (dataset['Age'] &lt;= 18), 'Age'] = 1<br/>    dataset.loc[(dataset['Age'] &gt; 18) &amp; (dataset['Age'] &lt;= 22), 'Age'] = 2<br/>    dataset.loc[(dataset['Age'] &gt; 22) &amp; (dataset['Age'] &lt;= 27), 'Age'] = 3<br/>    dataset.loc[(dataset['Age'] &gt; 27) &amp; (dataset['Age'] &lt;= 33), 'Age'] = 4<br/>    dataset.loc[(dataset['Age'] &gt; 33) &amp; (dataset['Age'] &lt;= 40), 'Age'] = 5<br/>    dataset.loc[(dataset['Age'] &gt; 40) &amp; (dataset['Age'] &lt;= 66), 'Age'] = 6<br/>    dataset.loc[ dataset['Age'] &gt; 66, 'Age'] = 6</span><span id="fa66" class="mi kn iq nq b gy ny nv l nw nx"># create titles<br/>data = [titanic_ds]<br/>titles = {"Mr": 1, "Miss": 2, "Mrs": 3, "Master": 4, "Rare": 5}</span><span id="1ae1" class="mi kn iq nq b gy ny nv l nw nx">for dataset in data:<br/>    # extract titles<br/>    dataset['Title'] = dataset.Name.str.extract(' ([A-Za-z]+)\.', expand=False)<br/>    # replace titles with a more common title or as Rare<br/>    dataset['Title'] = dataset['Title'].replace(['Lady', 'Countess','Capt', 'Col','Don', 'Dr',\<br/>                                            'Major', 'Rev', 'Sir', 'Jonkheer', 'Dona'], 'Rare')<br/>    dataset['Title'] = dataset['Title'].replace('Mlle', 'Miss')<br/>    dataset['Title'] = dataset['Title'].replace('Ms', 'Miss')<br/>    dataset['Title'] = dataset['Title'].replace('Mme', 'Mrs')<br/>    # convert titles into numbers<br/>    dataset['Title'] = dataset['Title'].map(titles)<br/>    # filling NaN with 0, to get safe<br/>    dataset['Title'] = dataset['Title'].fillna(0)</span><span id="5f28" class="mi kn iq nq b gy ny nv l nw nx"># drop name and title column since we have create a title<br/>titanic_ds = titanic_ds.drop(['Name','Ticket'], axis=1)</span><span id="9e1d" class="mi kn iq nq b gy ny nv l nw nx"># default missing fare rates<br/>titanic_ds['Fare'].fillna(value=titanic_ds.Fare.mean(), inplace=True)</span><span id="583c" class="mi kn iq nq b gy ny nv l nw nx"># convert fare to a feature holding a category<br/>data = [titanic_ds]<br/>for dataset in data:<br/>    dataset.loc[ dataset['Fare'] &lt;= 7.91, 'Fare'] = 0<br/>    dataset.loc[(dataset['Fare'] &gt; 7.91) &amp; (dataset['Fare'] &lt;= 14.454), 'Fare'] = 1<br/>    dataset.loc[(dataset['Fare'] &gt; 14.454) &amp; (dataset['Fare'] &lt;= 31), 'Fare']   = 2<br/>    dataset.loc[(dataset['Fare'] &gt; 31) &amp; (dataset['Fare'] &lt;= 99), 'Fare']   = 3<br/>    dataset.loc[(dataset['Fare'] &gt; 99) &amp; (dataset['Fare'] &lt;= 250), 'Fare']   = 4<br/>    dataset.loc[ dataset['Fare'] &gt; 250, 'Fare'] = 5<br/>    dataset['Fare'] = dataset['Fare'].astype(int)</span><span id="5499" class="mi kn iq nq b gy ny nv l nw nx"># create not_alone and relatives features<br/>data = [titanic_ds]<br/>for dataset in data:<br/>    dataset['relatives'] = dataset['SibSp'] + dataset['Parch']<br/>    dataset.loc[dataset['relatives'] &gt; 0, 'not_alone'] = 0<br/>    dataset.loc[dataset['relatives'] == 0, 'not_alone'] = 1<br/>    dataset['not_alone'] = dataset['not_alone'].astype(int)</span><span id="1a58" class="mi kn iq nq b gy ny nv l nw nx"># create age class<br/>data = [titanic_ds]<br/>for dataset in data:<br/>    dataset['Age_Class']= dataset['Age']* dataset['Pclass']</span><span id="e306" class="mi kn iq nq b gy ny nv l nw nx"># create fare per person<br/>data = [titanic_ds]<br/>for dataset in data:<br/>    dataset['Fare_Per_Person'] = dataset['Fare']/(dataset['relatives']+1)<br/>    dataset['Fare_Per_Person'] = dataset['Fare_Per_Person'].astype(int)</span><span id="9bcf" class="mi kn iq nq b gy ny nv l nw nx"># convert all data to numbers<br/>le = preprocessing.LabelEncoder()<br/>titanic_ds=titanic_ds.apply(le.fit_transform)</span><span id="59ec" class="mi kn iq nq b gy ny nv l nw nx">print("Show first records of all the features created")<br/>titanic_ds.head(10)</span></pre><p id="9a78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个演示中，我们将创建一个模型来预测泰坦尼克号沉没时谁会幸存(或死亡)。大块提供了准备数据的所有代码。总之，您将许多特征转换为数字和聚合数据，以提高模型的准确性。例如，您将年龄转换为一个类别，并根据名称编辑标题。此外，您还修复了丢失的值，并导出了其他要素的数据。最后一行显示了创建的所有特征的前10行。</p><pre class="lq lr ls lt gt np nq nr ns aw nt bi"><span id="b275" class="mi kn iq nq b gy nu nv l nw nx"># convert all data to numbers<br/>le = preprocessing.LabelEncoder()<br/>titanic_ds=titanic_ds.apply(le.fit_transform)</span><span id="d4e8" class="mi kn iq nq b gy ny nv l nw nx"># split our data into a test (30%) and train (70%) dataset<br/>test_data_split = 0.30<br/>msk = np.random.rand(len(titanic_ds)) &lt; test_data_split <br/>test = titanic_ds[msk]<br/>train = titanic_ds[~msk]</span><span id="1daf" class="mi kn iq nq b gy ny nv l nw nx"># drop ‘PassengerId’ from the train set, because it does not contribute to a persons survival probability<br/>train = train.drop(['PassengerId'], axis=1)</span><span id="5215" class="mi kn iq nq b gy ny nv l nw nx">X_train, X_test, Y_train, Y_test = train_test_split(train.drop("Survived", axis=1), train["Survived"],test_size=0.4,random_state=54,shuffle=True)</span></pre><p id="20ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来的几行确保所有数据都被转换成数字。接下来，您将我们的完整数据集分成测试和训练数据集。在我们的例子中，所有的乘客信息被合并到一个大的数据集中。接下来，数据被拆分为用于训练和验证模型的数据。从概念上讲，你可以看到我们在下面做了什么:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi nz"><img src="../Images/835bac4f5d4ad282813ad9875c230196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zAVW8ivAJtWyyXIMWTZKCQ.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated"><a class="ae kl" href="https://datascience.stackexchange.com/questions/61467/clarification-on-train-test-and-val-and-how-to-use-implement-it" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><pre class="lq lr ls lt gt np nq nr ns aw nt bi"><span id="9012" class="mi kn iq nq b gy nu nv l nw nx"># save data<br/>np.savetxt('download/train.csv', train, delimiter=',')<br/>np.savetxt('download/test.csv', test, delimiter=',')<br/>np.savetxt('download/X_train.csv', X_train, delimiter=',')<br/>np.savetxt('download/Y_train.csv', X_train, delimiter=',')<br/>np.savetxt('download/X_test.csv', X_train, delimiter=',')<br/>np.savetxt('download/Y_test.csv', X_train, delimiter=',')</span><span id="38e3" class="mi kn iq nq b gy ny nv l nw nx"># upload data to blob storage account<br/>datastore.upload_files(files=['download/train.csv', 'download/test.csv', 'download/X_train.csv', 'download/Y_train.csv', 'download/X_test.csv', 'download/Y_test.csv'],<br/>                       target_path='titanic_data/',<br/>                       overwrite=True)</span><span id="4c84" class="mi kn iq nq b gy ny nv l nw nx"># attach all datasets<br/>dataset_train = Dataset.Tabular.from_delimited_files(path=[(datastore, 'titanic_data/train.csv')])<br/>dataset_test = Dataset.Tabular.from_delimited_files(path=[(datastore, 'titanic_data/test.csv')])<br/>dataset_X_train = Dataset.Tabular.from_delimited_files(path=[(datastore, 'titanic_data/X_train.csv')])<br/>dataset_Y_train = Dataset.Tabular.from_delimited_files(path=[(datastore, 'titanic_data/Y_train.csv')])<br/>dataset_X_test = Dataset.Tabular.from_delimited_files(path=[(datastore, 'titanic_data/X_test.csv')])<br/>dataset_Y_test= Dataset.Tabular.from_delimited_files(path=[(datastore, 'titanic_data/Y_test.csv')])</span><span id="7a18" class="mi kn iq nq b gy ny nv l nw nx"># register datasets as version 1<br/>dataset_train.register(workspace = ws, name = 'train', create_new_version = True)<br/>dataset_test.register(workspace = ws, name = 'test', create_new_version = True)<br/>dataset_X_train.register(workspace = ws, name = 'X_train', create_new_version = True)<br/>dataset_Y_train.register(workspace = ws, name = 'Y_train', create_new_version = True)<br/>dataset_X_test.register(workspace = ws, name = 'X_test', create_new_version = True)<br/>dataset_Y_test.register(workspace = ws, name = 'Y_test', create_new_version = True)</span></pre><p id="79eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了在Azure ML中存储和管理我们所有的数据，你需要使用下面几行代码。在稍后阶段，您将注册您的版本化模型并将其链接到此版本化数据，包括所有其他元数据，如性能指标、准确性等。这对展示证据和保持控制很重要。</p><pre class="lq lr ls lt gt np nq nr ns aw nt bi"><span id="5612" class="mi kn iq nq b gy nu nv l nw nx"># Random Forest<br/>random_forest = RandomForestClassifier(n_estimators=100)<br/>random_forest.fit(X_train, Y_train)</span><span id="2ecc" class="mi kn iq nq b gy ny nv l nw nx"># Save model as pickle file<br/>joblib.dump(random_forest, "outputs/random_forest.pkl")</span><span id="c21b" class="mi kn iq nq b gy ny nv l nw nx"># Predict and get result<br/>Y_prediction = random_forest.predict(X_test)<br/>random_forest.score(X_train, Y_train)<br/>acc_random_forest = round(random_forest.score(X_train, Y_train) * 100, 2)</span><span id="731f" class="mi kn iq nq b gy ny nv l nw nx"># show the important features for the classification<br/>feature_imp = pd.Series(random_forest.feature_importances_, index=X_train.columns).sort_values(ascending=False)<br/>plt.figure(figsize=(10,6))<br/>sns.barplot(x=feature_imp, y=feature_imp.index)<br/># Add labels to your graph<br/>plt.xlabel('Feature Importance Score')<br/>plt.ylabel('Features')<br/>plt.title("Visualizing Important Features")<br/>plt.tight_layout()</span></pre><p id="3a4a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，您将使用随机森林模型，这是一种受监督的机器学习算法。它创建了一个决策树的森林，并使其具有一定的随机性。此外，您会看到一个显示模型中最主要特征的图。</p><pre class="lq lr ls lt gt np nq nr ns aw nt bi"><span id="e8b0" class="mi kn iq nq b gy nu nv l nw nx"># register model within workspace<br/>model_random_forest = Model.register(workspace=ws,<br/>                       model_name='random_forest',<br/>                       model_path='outputs/random_forest.pkl',<br/>                       model_framework=Model.Framework.SCIKITLEARN,<br/>                       model_framework_version=sklearn.__version__,<br/>                       sample_input_dataset=dataset_X_train,<br/>                       sample_output_dataset=dataset_Y_train,<br/>                       description='Titanic survival prediction using random forest.',<br/>                       datasets = [('train',dataset_train),('test',dataset_test),('X_train',dataset_X_train),('Y_train',dataset_Y_train),('X_test',dataset_X_test),('Y_test',dataset_Y_test)],<br/>                       tags={'type': 'regression'})</span></pre><p id="ab9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用上面的代码行，您将在Azure ML中注册您的模型。模型本身被序列化为pickle文件，这意味着它已经被转储以供以后使用。此外，您还将模型链接到了我们的训练数据集。</p><pre class="lq lr ls lt gt np nq nr ns aw nt bi"><span id="d20f" class="mi kn iq nq b gy nu nv l nw nx"># log plot image<br/>run.log_image('Feature Importance Score', plot=plt)</span><span id="e54b" class="mi kn iq nq b gy ny nv l nw nx"># complete run<br/>run.log("Random Forest accuracy", acc_random_forest)<br/>run.complete()</span></pre><p id="7f17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，您记录我们模型的准确性，并将运行标记为完成。</p><h2 id="7f03" class="mi kn iq bd ko mj mk dn ks ml mm dp kw jy mn mo la kc mp mq le kg mr ms li mt bi translated">MLOps功能</h2><p id="7fc6" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">在典型的开发流程中，开发模型只是第一步。最大的努力是让一切都准备好投入生产。这包括数据收集、数据准备、培训、服务和监控。您只是执行了这些最初的步骤，并在Azure ML中存储了所有相关的元数据信息。例如，您可以看到下面的绘图图像，它和我们的模型的其他信息，如实验、版本化数据集、日志记录信息等等。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi oa"><img src="../Images/fb696e5d3d15d3318e757f3578091fb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5SdSQ7YLvk_tudgLHuApbg.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">图片由Piethein Strengholt提供</p></figure><p id="7511" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最大的好处是，您可以将模型和实验与可靠且可重复的结果关联起来。团队成员可以轻松地观察、解释和改进模型行为和准确性，因为所有信息都集中在一个中心位置。</p><h2 id="156e" class="mi kn iq bd ko mj mk dn ks ml mm dp kw jy mn mo la kc mp mq le kg mr ms li mt bi translated">利用计算集群进行纵向扩展</h2><p id="bca7" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">下一步是在集群上训练模型，这对计算密集型处理很有用。例如，当使用大型数据集或复杂计算时。这项工作可以分配给几台机器。在计算部分，您可以创建和配置集群。在本演示中，您可以通过单击“下一步”来使用标准配置。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi ob"><img src="../Images/6bad3467dc2da97edc2c62b3f4595922.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6TiyD0Rda8BWvcMAtFw5TA.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">图片由Piethein Strengholt提供</p></figure><p id="0a41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了向我们的集群提交作业，您需要设置一些额外的脚本。第一个脚本名为<strong class="jp ir"> setup.sh </strong>，用于安装所需的软件包。</p><pre class="lq lr ls lt gt np nq nr ns aw nt bi"><span id="638a" class="mi kn iq nq b gy nu nv l nw nx">#!/bin/bash<br/>pip install azureml-sdk[notebooks]<br/>pip install azureml-core<br/>pip install azure-storage-blob<br/>pip install joblib</span></pre><p id="d0c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二个脚本叫做<strong class="jp ir"> script.py </strong>，它与我们的Azure ML工作空间交互，用于提交我们的作业。让我们检查下面的代码块。</p><pre class="lq lr ls lt gt np nq nr ns aw nt bi"><span id="49b5" class="mi kn iq nq b gy nu nv l nw nx">from azureml.core import ScriptRunConfig, Experiment<br/>from azureml.core import Workspace<br/>from azureml.core.compute import ComputeTarget, AmlCompute<br/>from azureml.core.compute_target import ComputeTargetException<br/>from azureml.core import Environment<br/>from azureml.widgets import RunDetails<br/>from azureml.core.authentication import ServicePrincipalAuthentication</span><span id="de8f" class="mi kn iq nq b gy ny nv l nw nx">svc_pr = ServicePrincipalAuthentication(<br/>    tenant_id="72f988bf-FDf1-41af-9Ab-2d7cd011Ab47",<br/>    service_principal_id="ef861c6f-b0FA-4895-8330-9b90Aea3bd1",<br/>    service_principal_password="~_V846CU~R36tP.UV4Sz78TtUAaeyF40C")</span><span id="ae65" class="mi kn iq nq b gy ny nv l nw nx">ws = Workspace(<br/>    subscription_id="3466fg5d-afda-4533-b3e2-c498g86a45aa",<br/>    resource_group="rg-machinelearning",<br/>    workspace_name="machinelearning",<br/>    auth=svc_pr<br/>    )</span><span id="95d0" class="mi kn iq nq b gy ny nv l nw nx"># create or load an experiment<br/>experiment = Experiment(ws, 'TitanicExperiment')</span><span id="3ccd" class="mi kn iq nq b gy ny nv l nw nx"># create or retrieve a compute target<br/>cluster = ws.compute_targets['cluster1']</span><span id="b85a" class="mi kn iq nq b gy ny nv l nw nx"># create or retrieve an environment<br/>env = Environment.get(ws, name='AzureML-sklearn-0.24.1-ubuntu18.04-py37-cpu-inference')</span><span id="c39f" class="mi kn iq nq b gy ny nv l nw nx"># configure and submit your training run<br/>src = ScriptRunConfig(source_directory='.',<br/>                        command=['bash setup.sh &amp;&amp; python train.py'],<br/>                        compute_target=cluster,<br/>                        environment=env)</span><span id="1921" class="mi kn iq nq b gy ny nv l nw nx">run = experiment.submit(config=src)<br/>run</span></pre><p id="630f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你还记得服务原则账户吗？服务原则帐户信息来自您之前使用的帐户信息。这允许您的集群与Azure ML进行交互。另一个重要的方面是推论。我正在使用一个<a class="ae kl" href="https://docs.microsoft.com/en-us/azure/machine-learning/concept-prebuilt-docker-images-inference" rel="noopener ugc nofollow" target="_blank">预构建的Docker容器</a>映像，它包含最流行的机器学习框架和Python包。</p><p id="945c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一个重要方面是命令参数。我用它来传入<strong class="jp ir"> setup.sh </strong>和<strong class="jp ir"> train.py </strong>脚本。setup.sh脚本安装所有必需的软件包。在我的示例机器学习模型脚本中，<strong class="jp ir"> train.py </strong>引用了与<strong class="jp ir"> Titanic.ipny </strong>相同的代码。在存储这些脚本并运行script.py之后，应该向集群提交一个作业，如下图所示。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mg"><img src="../Images/700ee2fb26439d0476c8a2c6156a6ff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jDLHgBR24_mdNEnlO6VTLw.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">图片由Piethein Strengholt提供</p></figure><p id="1385" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最大的好处是您可以轻松地纵向扩展。从在计算实例上开发的模型过渡到高性能的弹性集群相对容易。这只是用另一个(小的)脚本来包装你的实验。</p><h2 id="0116" class="mi kn iq bd ko mj mk dn ks ml mm dp kw jy mn mo la kc mp mq le kg mr ms li mt bi translated">使用Azure ML端点操作您的模型</h2><p id="ec3b" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">最后一步是操作您的模型，在我们的例子中是将模型部署为web服务。在Azure ML中，您可以部署实时或批处理服务。要将您的模型部署为实时web服务，请使用下面的代码:</p><pre class="lq lr ls lt gt np nq nr ns aw nt bi"><span id="663a" class="mi kn iq nq b gy nu nv l nw nx"># set service name<br/>service_name = 'titanic-service'<br/>service = Model.deploy(ws, service_name, [model_random_forest], overwrite=True)<br/>service.wait_for_deployment(show_output=True)</span></pre><p id="6992" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mu"> titanic-service </em>是指服务名。在我们的例子中,<strong class="jp ir"> model_random_forest </strong>指的是您在我们的工作空间中注册的模型。成功部署后，您应该在端点部分看到您的服务:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi oc"><img src="../Images/d629c6bcd71d7317b20d9af1168df00d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RLcubdm2FVNz1CWImweB0g.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">图片由Piethein Strengholt提供</p></figure><p id="8eb8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个REST端点可以与任何其他系统集成。让我们通过使用<a class="ae kl" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank"> postman </a>来验证服务。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi od"><img src="../Images/08bc57aadae1a22f7faf3b861b5ed156.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Hgds4ru-rjfb8LDS0NadA.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">图片由Piethein Strengholt提供</p></figure><p id="3846" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我通过提交13个数据属性进行API调用。第二和第三个属性是性别和年龄。数字1和1对应于年龄小于或等于11岁的女性。提交我们的请求后，你可以看到泰坦尼克号幸存的概率是88.5%。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi od"><img src="../Images/c7ec81b03e3d76e8c5f18c7e3b517c78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tONqsaD2KAKEWlWHOwyTQQ.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">图片由Piethein Strengholt提供</p></figure><p id="9835" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您将性别和年龄更改为0和6，这些值对应于年龄在44和66之间的男性。幸存的概率，如你所见，下降到了42.0%。</p><h1 id="c258" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">结论</h1><p id="81ef" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我们刚刚展示的是一个从数据收集和准备到模型部署和运作的自动化ML生产环境。合乎逻辑的下一步是将我们的所有代码存储到一个版本化的Git存储库中，并使用一个持续集成(CI)流程来自动化管道启动、培训和测试自动化、审查和批准流程。</p><p id="2d50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代码仓库:<a class="ae kl" href="https://github.com/pietheinstrengholt/Azure-ML-and-DevOps-meets-Titanic" rel="noopener ugc nofollow" target="_blank">https://github . com/pietheinstrengholt/Azure-ML-and-devo PS-meets-Titanic</a></p></div></div>    
</body>
</html>