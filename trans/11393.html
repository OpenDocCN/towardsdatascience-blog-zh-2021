<html>
<head>
<title>3 Ways to Deploy Machine Learning Models in Production</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在生产中部署机器学习模型的3种方式</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-ways-to-deploy-machine-learning-models-in-production-cdba15b00e?source=collection_archive---------0-----------------------#2021-11-09">https://towardsdatascience.com/3-ways-to-deploy-machine-learning-models-in-production-cdba15b00e?source=collection_archive---------0-----------------------#2021-11-09</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="9954" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">部署ML模型，并使它们对用户或项目的其他组件可用。</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/eb7fd713a8e52afefd8207463ad61375.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rN32is5na-YCZMUKOswAiQ.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">将机器学习模型部署到生产中——来自<a class="ae kz" href="https://www.pexels.com/photo/food-wood-man-people-9028914/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae kz" href="https://www.pexels.com/@kindelmedia?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Kindel Media </a>摄影</p></figure><p id="943a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">处理数据是一回事，但将机器学习模型部署到生产中则是另一回事。</p><p id="d92c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">数据工程师总是在寻找新的方法来将他们的机器学习模型部署到生产中。他们想要最好的性能，他们关心它的价格。</p><p id="6b37" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在你可以两者兼得了！</p><p id="b096" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们来看看部署过程，看看我们如何才能成功！</p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/python-web-apps-for-machine-learning-e29d075e6459"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">为Python APIs和ML模型创建Web UIs</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">快速制作原型并与其他人共享web应用程序。收集关于预测的反馈，以提高ML模型的性能。</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn kt lz"/></div></div></a></div><h1 id="1ff7" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">如何在生产中部署机器学习模型？</h1><p id="670a" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">大多数数据科学项目将机器学习模型部署为<strong class="lc iv">按需预测服务</strong>或<strong class="lc iv">批量预测</strong>模式。一些现代应用在边缘和移动设备中部署<strong class="lc iv">嵌入式模型</strong>。</p><p id="3202" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">每种模式都有自己的优点。例如，在批处理场景中，优化是为了<em class="nl">最小化模型计算成本</em>。对外部数据源和云服务的依赖<em class="nl">更少</em>。本地处理能力有时足以计算算法复杂的模型。</p><p id="5aa4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当<em class="nl">发生故障</em>或<em class="nl">调整超参数</em>时，调试离线模型也很容易，因为它运行在强大的服务器上。</p><p id="5901" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">另一方面，网络服务可以提供<em class="nl">更便宜的</em>和<em class="nl">接近实时的预测</em>。如果模型运行在集群或云服务上，CPU能力的可用性就不是问题。通过API调用等等，该模型可以很容易地用于其他应用程序。</p><p id="1ba5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">嵌入式机器学习的一个主要好处是，我们可以根据特定设备的<em class="nl">要求对其进行定制。</em></p><p id="e54d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们可以很容易地将模型部署到设备上，并且它的运行时环境不能被外部团体篡改。一个明显的缺点是设备需要有足够的计算能力和存储空间。</p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/secure-your-streamlit-app-with-django-bb0bee2a6519"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">使用Django保护您的Streamlit应用</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">围绕你的机器学习web应用建立一个灵活的认证系统</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="nm l mk ml mm mi mn kt lz"/></div></div></a></div><h1 id="2b1b" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">将机器学习模型部署为web服务。</h1><p id="9f77" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">部署机器学习模型的最简单方法是创建一个用于预测的web服务。在这个例子中，我们使用<a class="ae kz" href="https://flask.palletsprojects.com/en/2.0.x/" rel="noopener ugc nofollow" target="_blank"> Flask web框架</a>来包装一个用scikit-learn构建的简单的<a class="ae kz" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html" rel="noopener ugc nofollow" target="_blank">随机森林分类器</a>。</p><p id="2fb9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要创建机器学习web服务，至少需要三个步骤。</p><p id="56fc" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">第一步是创建一个机器学习模型，训练它并验证它的性能。以下脚本将训练一个随机森林分类器。<a class="ae kz" href="https://machinelearningmastery.com/difference-test-validation-datasets/" rel="noopener ugc nofollow" target="_blank">为了简单起见，这里不包括模型测试和验证</a>。但是请记住，这些是任何机器学习项目不可或缺的一部分。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nn no l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">为部署构建一个简单的机器学习模型。</p></figure><p id="4116" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在下一步中，我们需要持久化模型。我们部署应用程序的环境通常与我们培训他们的环境不同。培训通常需要不同的资源。因此，这种分离有助于组织优化他们的预算和工作。</p><p id="47a7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://scikit-learn.org/stable/modules/model_persistence.html" rel="noopener ugc nofollow" target="_blank"> Scikit-learn提供了python特有的序列化</a>，使得模型持久化和恢复变得毫不费力。下面是我们如何将训练好的模型存储在pickle文件中的一个例子。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nn no l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">使用scikit-learn的joblib实用程序将机器学习模型作为pickle文件持久化。</p></figure><p id="20b4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最后，我们可以使用web框架为持久模型提供服务。下面的代码使用Flask创建了一个REST API。该文件托管在不同的环境中，通常是在云服务器中。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nn no l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">使用Flask Python web框架部署用于在线预测(预测服务)的机器学习模型。</p></figure><p id="9fd3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">上面的代码通过<code class="fe np nq nr ns b"><a class="ae kz" href="https://localhost:8080/predict" rel="noopener ugc nofollow" target="_blank">https://localhost:8080/predict</a></code>接受POST请求中的输入，并在JSON响应中返回预测。</p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/the-quick-and-easy-guide-to-create-wordclouds-in-python-7a81813e4cd5"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">用Python创建单词云的快速简单指南</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">创建不同形状的单词云，以更好地传达信息。</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="nt l mk ml mm mi mn kt lz"/></div></div></a></div><h1 id="4a83" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">为批量预测部署机器学习模型。</h1><p id="a9b4" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">虽然在线模型可以提供预测，但按需批量预测有时更可取。</p><p id="198b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">离线模型可以进行优化，以处理大量的作业实例并运行更复杂的模型。在批量生产模式下，您也不需要担心扩展或管理服务器。</p><p id="cad1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">批量预测可以简单到用输入变量的数据集调用预测函数。下面的命令可以做到这一点。</p><pre class="kk kl km kn gu nu ns nv nw aw nx bi"><span id="a99f" class="ny mp iu ns b gz nz oa l ob oc">prediction = classifier.predict(UNSEEN_DATASET)</span></pre><p id="0d56" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">有时，您必须在批处理方法中安排训练或预测。有几种方法可以做到这一点。我最喜欢的是使用气流或提督自动化任务。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nn no l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">使用Prefect调度用于批量预测的机器学习模型。</p></figure><p id="5753" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">上述脚本计划从脚本执行后5秒开始每周进行预测。如果失败，提督将重试任务3次。</p><div class="lw lx gq gs ly lz"><a rel="noopener follow" target="_blank" href="/the-prefect-way-to-automate-orchestrate-data-pipelines-d4465638bac2"><div class="ma ab fp"><div class="mb ab mc cl cj md"><h2 class="bd iv gz z fq me fs ft mf fv fx it bi translated">自动化和编排数据管道的完美方式</h2><div class="mg l"><h3 class="bd b gz z fq me fs ft mf fv fx dk translated">我正在将我所有的ETL工作从Airflow迁移到这个超级酷的框架中</h3></div><div class="mh l"><p class="bd b dl z fq me fs ft mf fv fx dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="od l mk ml mm mi mn kt lz"/></div></div></a></div><p id="cdb6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然而，构建模型可能需要批处理框架中的多个阶段。您需要决定需要什么特性，以及应该如何为每个阶段构建模型。</p><p id="3d2a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在具有适当批处理框架的高性能计算系统上训练模型。</p><p id="233b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">通常，您将训练数据划分为一个接一个按顺序处理的数据段。您可以通过使用采样方案(例如，平衡采样、分层采样)或通过某种在线算法(例如，map-reduce)来分割数据集。</p><p id="f7e6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这些分区可以分布到多台机器上，但是它们必须装载相同的特性集。建议进行特征缩放。如果您对<a class="ae kz" rel="noopener" target="_blank" href="/transfer-learning-in-deep-learning-641089950f5d">迁移学习</a>使用了无监督的预训练(例如，自动编码器)，您必须撤销每个分区。</p><p id="ca42" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在执行完所有阶段之后，您可以通过在分区上顺序迭代，用得到的模型预测看不见的数据。</p><h1 id="c938" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">在边缘设备上部署机器学习模型作为嵌入式模型。</h1><p id="663f" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">近年来，在移动和物联网等边缘设备上进行计算变得非常流行。在边缘设备上部署机器学习模型的好处包括但不限于:</p><ul class=""><li id="7d04" class="oe of iu lc b ld le lg lh lj og ln oh lr oi lv oj ok ol om bi translated">减少延迟，因为设备可能比远处的服务器更靠近用户。</li><li id="6f42" class="oe of iu lc b ld on lg oo lj op ln oq lr or lv oj ok ol om bi translated">减少数据带宽消耗，因为我们将处理后的结果而不是原始数据发送回云中，原始数据需要很大的数据量，最终需要更多的带宽。</li></ul><p id="2d34" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">移动和物联网设备等边缘设备由于其硬件的性质而具有有限的计算能力和存储容量。我们不能简单地将机器学习模型直接部署到这些设备上，特别是如果我们的模型很大或者需要大量计算来对它们进行推理。</p><p id="a73a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">相反，我们应该使用量化和聚合等技术来简化模型，同时保持准确性。这些简化的模型可以高效地部署在计算、内存和存储有限的边缘设备上。</p><p id="01a3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们可以使用Android上的TensorFlow Lite库来简化我们的TensorFlow模型。TensorFlow Lite是一个面向移动和嵌入式设备的开源软件库，它试图做到顾名思义:在移动和嵌入式平台上运行TensorFlow模型。</p><p id="0e94" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">以下示例转换Keras TensorFlow模型。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nn no l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">将Keras深度学习模型转换为TensorFlow Lite模型，以部署在边缘物联网和移动设备上。</p></figure><p id="ac40" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你可以在你选择的任何平台上阅读新创建的<code class="fe np nq nr ns b">.tflite</code>文件。Tensorflow lite支持Android、iOS和Linux(包括Raspberry Pi)。</p><p id="0f2d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">有关在不同平台上部署的示例和教程，请查看<a class="ae kz" href="https://www.tensorflow.org/lite" rel="noopener ugc nofollow" target="_blank"> TensorFlow Lite文档</a>。</p><h1 id="21e8" class="mo mp iu bd mq mr ms mt mu mv mw mx my ka mz kb na kd nb ke nc kg nd kh ne nf bi translated">最后的想法</h1><p id="e6bb" class="pw-post-body-paragraph la lb iu lc b ld ng jv lf lg nh jy li lj ni ll lm ln nj lp lq lr nk lt lu lv in bi translated">训练机器学习模型只是数据科学项目的一个方面。数据科学家投入大量精力将它们部署到生产环境中。</p><p id="1856" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们已经讨论了部署机器学习模型的三种不同方法及其优点。根据您的应用，您可能需要选择一个可用的选项。</p><p id="6536" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当然，这个帖子只是冰山一角。但是我相信它会给你一个进一步探索的起点。</p><p id="6ad4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">生产中的ML模型有很多其他的善后工作，比如定期的模型评估。但它们是另一个职位的。</p></div><div class="ab cl os ot hy ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="in io ip iq ir"><blockquote class="oz pa pb"><p id="ba4d" class="la lb nl lc b ld le jv lf lg lh jy li pc lk ll lm pd lo lp lq pe ls lt lu lv in bi translated">感谢阅读的朋友！在<a class="ae kz" href="https://www.linkedin.com/in/thuwarakesh/" rel="noopener ugc nofollow" target="_blank"><strong class="lc iv">LinkedIn</strong></a><a class="ae kz" href="https://twitter.com/Thuwarakesh" rel="noopener ugc nofollow" target="_blank"><strong class="lc iv">Twitter</strong></a><a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener"><strong class="lc iv">Medium</strong></a>上跟我打招呼。</p><p id="61e2" class="la lb nl lc b ld le jv lf lg lh jy li pc lk ll lm pd lo lp lq pe ls lt lu lv in bi translated">还不是中等会员？请使用此链接<strong class="lc iv"> </strong> <a class="ae kz" href="https://thuwarakesh.medium.com/membership" rel="noopener"> <strong class="lc iv">成为会员</strong> </a>因为，在不为你额外付费的情况下，我为你引荐赚取一小笔佣金。</p></blockquote></div></div>    
</body>
</html>