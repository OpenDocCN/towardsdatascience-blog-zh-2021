<html>
<head>
<title>AutoSklearn at Scale with Kubeflow and Kale</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Kubeflow和羽衣甘蓝进行大规模AutoSklearn</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/autosklearn-at-scale-with-kubeflow-and-kale-bfd51f57a54f?source=collection_archive---------36-----------------------#2021-08-23">https://towardsdatascience.com/autosklearn-at-scale-with-kubeflow-and-kale-bfd51f57a54f?source=collection_archive---------36-----------------------#2021-08-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="726c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用Kale和AutoSklearn在Kubeflow上运行AutoML实验</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/910aae5c7e2e34a2d40254224c14ed42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kou1szRzKMxDerjv4_sRPQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@gohrhyyan?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Goh Rhy Yan </a>在<a class="ae ky" href="https://unsplash.com/s/photos/car-tableau?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="c3a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">给定一个任务、一个度量、一个训练数据集以及一个资源预算，AutoML系统可以自动地在一个测试数据集上产生一组预测。预算可能涉及计算资源，例如CPU和/或挂钟时间和内存使用。</p><p id="b238" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上一段是对AutoML的定义。简单地说，当您启动AutoML实验时，您提供了训练数据集和您期望的最终目标。用简单的英语来说，最终目标可能是这样的:给我找一个模型，当你将它用于这个训练数据集时，它可以在那个测试数据集上产生最佳的分类精度性能。此外，在半小时内完成。</p><p id="f77f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你会如何解决这个问题？最简单的方法是获取适用于该任务的每个Scikit学习预测器(例如，每个分类器)，对其进行拟合，并在半小时内返回产生最佳结果的预测器。</p><p id="cf5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，这种简单的方法是不够的。每个分类器都接受几个超参数，这些超参数可能会使其性能变好或变坏。此外，在拟合可能显著改变预测器性能的模型之前，您可以使用数十个数据处理函数。测试每一种可能的组合是不可能的。</p><p id="35cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是有一个更好的方法，包括元学习，我们最喜欢的Scikit Learn机器学习(ML)框架和Kubernetes。让我们把大枪拿出来！</p><blockquote class="lv lw lx"><p id="9f75" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><a class="ae ky" href="https://www.dimpo.me/newsletter?utm_source=medium&amp;utm_medium=article&amp;utm_campaign=automl" rel="noopener ugc nofollow" target="_blank"> Learning Rate </a>是一份时事通讯，面向那些对AI和MLOps世界感到好奇的人。你会在每周五收到我关于最新人工智能新闻和文章的更新和想法。订阅<a class="ae ky" href="https://www.dimpo.me/newsletter?utm_source=medium&amp;utm_medium=article&amp;utm_campaign=automl" rel="noopener ugc nofollow" target="_blank">这里</a>！</p></blockquote></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="0029" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">元学习</h1><p id="e128" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在深入研究代码之前，让我们先停止使用第一个术语。什么是元学习？我可以解释为学会学习，但对我来说听起来更困惑。所以，让我们再试一次:</p><p id="291d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">元学习方法将数据集和任务(例如，分类或回归)作为输入，并返回应用于该数据集的一组算法，其超参数是预先填充的。</p><p id="efd3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我认为这个高层次的解释做得更好。但是元学习是如何做到的呢？第一步，生成输入数据集的描述性模型。我说的模型，不是指ML模型。它只是一组数字，以某种方式捕捉数据集的各种核心特征。这也称为元特征向量。</p><p id="8ee9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些元特征可以是数据集代表值，例如维度、基数、维度之间的相关性、熵、互信息和稀疏性相关统计。</p><p id="10c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个向量旨在提供足够的信息，以便元学习系统可以计算数据集之间的相似性。这意味着，你可以将两个数据集转换成这些向量，比较这些向量，并找出数据集在某种意义上是否相似。</p><p id="84a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第二步中，元学习系统接收生成的数据集模型，并试图发现过去已经处理过的类似数据集。关于过去的数据集、对这些数据集执行的算法以及评估结果的信息存储在存储库中。</p><p id="778f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，通过计算手边的数据集和储存库中的其他数据集之间的相似性，系统可以检索一组算法及其超参数，这些算法在过去表现最好。</p><h1 id="550c" class="mj mk it bd ml mm ng mo mp mq nh ms mt jz ni ka mv kc nj kd mx kf nk kg mz na bi translated">简单的例子</h1><p id="3e9b" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">既然我们已经解决了各种流行词汇，您将从您的Jupyter笔记本开始创建一个AutoML工作流。此外，您将在Kubeflow上这样做，以便可以利用Kubernetes集群的强大功能。</p><h2 id="e208" class="nl mk it bd ml nm nn dn mp no np dp mt li nq nr mv lm ns nt mx lq nu nv mz nw bi translated">你需要什么</h2><p id="b256" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">首先，您需要一个正在运行的Kubeflow实例和一个Jupyter笔记本服务器。不要担心，我们将使用MiniKF，我们将立即拥有所有这些。要设置Kubeflow并启动笔记本服务器，请遵循以下指南:</p><div class="nx ny gp gr nz oa"><a rel="noopener follow" target="_blank" href="/kubeflow-is-more-accessible-than-ever-with-minikf-33484d9cb26b"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">有了MiniKF，Kubeflow比以往任何时候都更容易访问</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">10分钟入门Kubernetes最好的机器学习平台。</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">towardsdatascience.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo ks oa"/></div></div></a></div><p id="bd97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您更喜欢使用AWS，我们将为您提供:</p><div class="nx ny gp gr nz oa"><a rel="noopener follow" target="_blank" href="/mini-kubeflow-on-aws-is-your-new-ml-workstation-eb4036339585"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">AWS上的Mini Kubeflow是您的新ML工作站</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">通过AWS上的MiniKF加速您的机器学习模型开发</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">towardsdatascience.com</p></div></div><div class="oj l"><div class="op l ol om on oj oo ks oa"/></div></div></a></div><p id="167f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在文章中，您将看到要创建一个笔记本服务器，您需要选择<code class="fe oq or os ot b">jupyter-kale:v0.5.0–47-g2427cc9</code> Kale图像(注意图像标签可能不同)。然而，在我们的例子中，让我们选择<code class="fe oq or os ot b">gcr.io/arrikto/jupyter-kale-py36:kubecon21eu-automl-nightly</code>图像，因为这个特性仍然处于早期阶段。</p><p id="7790" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们准备好了。让我们建立我们的第一个例子！</p><h2 id="62cb" class="nl mk it bd ml nm nn dn mp no np dp mt li nq nr mv lm ns nt mx lq nu nv mz nw bi translated">卡格尔推土机比赛</h2><p id="3ad2" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">推土机蓝皮书是8年前举办的一场Kaggle竞赛。在这次比赛中，参与者被要求预测在拍卖会上出售的推土机的销售价格。</p><p id="05d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用这个数据集，因为同一个数据集用于测试流行的ML框架的性能，例如<code class="fe oq or os ot b">fastai</code>。<code class="fe oq or os ot b">fastai</code>有一个很棒的<code class="fe oq or os ot b">tabular</code>模块，专门解决结构化数据集(如CSV文件)的挑战。</p><p id="9e30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">他们在课程和书本上都使用推土机数据集来测试这个模块。他们实现了实际拍卖价格和预测拍卖价格之间的RMSLE(均方根对数误差)为0.226<a class="ae ky" href="https://github.com/fastai/fastbook/blob/master/09_tabular.ipynb" rel="noopener ugc nofollow" target="_blank">。这是使用神经网络实现的。</a></p><p id="ca29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了将我们的方法与<code class="fe oq or os ot b">fastai</code>的方法进行比较，我们需要使用相同的输入。因此，我们使用预处理管道<code class="fe oq or os ot b">fastai</code>来扩充数据集并转换分类值。</p><p id="5f03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">具体来说，我们使用<code class="fe oq or os ot b">add_datepart</code>方法来扩展数据集的<code class="fe oq or os ot b">saledate</code>字段。这意味着我们使用该字段中给出的信息创建新字段(例如，“今天是星期几？”，“是周末吗？”，“放假了吗？”等。).</p><p id="8e9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们使用<code class="fe oq or os ot b">TabularPandas</code>类将分类值转换成数字。在我们的例子中，我们没有在预处理管道中使用<code class="fe oq or os ot b">FillMissing</code>方法，因为我们期望我们的系统建议一个相关的估算器。</p><p id="15a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要获得示例，克隆Kale repo并检查相关分支:</p><pre class="kj kk kl km gt ou ot ov ow aw ox bi"><span id="30a8" class="nl mk it ot b gy oy oz l pa pb">git clone https://github.com/kubeflow-kale/kale -b kubecon21eu</span></pre><p id="233e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">克隆的存储库包含一系列带有数据和注释笔记本的精选示例。在侧边栏中，导航到文件夹<code class="fe oq or os ot b">kale/examples/bulldozers-kaggle-competition/</code>并打开笔记本<code class="fe oq or os ot b"><a class="ae ky" href="https://github.com/kubeflow-kale/kale/blob/kubecon21eu/examples/bulldozers-kaggle-competition/blue-book-bulldozers.ipynb" rel="noopener ugc nofollow" target="_blank">blue-book-bulldozers.ipynb</a></code>。</p><h2 id="1346" class="nl mk it bd ml nm nn dn mp no np dp mt li nq nr mv lm ns nt mx lq nu nv mz nw bi translated">进行实验</h2><p id="aff6" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">跟着笔记本的单元格跑实验。神奇的事情发生在下面的命令中:</p><pre class="kj kk kl km gt ou ot ov ow aw ox bi"><span id="fbcd" class="nl mk it ot b gy oy oz l pa pb">automl = kale_ml.run_automl(dataset,<br/>                            kale_ml.Task.REGRESSION,<br/>                            metric=metrics.mean_squared_log_error,<br/>                            number_of_configurations=4,<br/>                            max_parallel_configurations=1,<br/>                            tuner=tuner)</span></pre><p id="0ed8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以看到，我们调用了Kale提供的<code class="fe oq or os ot b">run_automl</code>函数，给出了一个数据集、一个任务和一个指标。<code class="fe oq or os ot b">number_of_configurations</code>参数指示系统将尝试多少ML管道配置。</p><p id="35a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们在这里暂停一下。我们之前说过，元学习返回一组应用于该数据集的算法，并填充了它们的超参数。然而，在我们的例子中，我们得到的不仅仅是一组算法。Kale在底层使用了<a class="ae ky" href="https://automl.github.io/auto-sklearn/master/" rel="noopener ugc nofollow" target="_blank"> AutoSklearn </a>，所以我们得到了一组完整的ML管道配置，数据和特征处理功能以及ML模型在顶层。这就更厉害了！</p><p id="d753" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，<code class="fe oq or os ot b">max_parallel_configurations</code>参数定义了并行运行的管道数量。最后但同样重要的是，调优器将在性能最佳的配置上运行超参数调优实验。</p><p id="19d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过观察协调一切的管道来监控实验的进度:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/e1e72dafc51edd92d02ea9097a0b0d12.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*3DztHHLpf-pVWW2XOXK2Og.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">AutoML编排管道—按作者分类的图像</p></figure><p id="2cae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，您可以在笔记本上完成:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/4e66dc369b9819548ae72d07e91bf896.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/format:webp/1*7vDdcuQ0Obk2eHrRUqEOZg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">自动监控—图片由作者提供</p></figure><p id="6c04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅仅经过四次尝试，并且没有对我们的选项做太多改动，我们得到了大约0.26的分数。几乎什么都不做也不错。我们至少可以用这个结果作为我们的基准！</p><h1 id="5470" class="mj mk it bd ml mm ng mo mp mq nh ms mt jz ni ka mv kc nj kd mx kf nk kg mz na bi translated">结论</h1><p id="d283" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在这个故事中，您创建了一个从原始数据开始自动发现和训练完整ML管道的机制。</p><p id="cac0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您了解了什么是AutoML和元学习，然后，从数据集开始，您使用Kale API实例化了一个流程，该流程将为输入数据搜索最合适的模型。然后，您使用最佳配置中的模型自动启动了超参数优化实验。</p><p id="ebd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关您需要的所有步骤的更详细的指南，请在此处进入代码实验室:</p><div class="nx ny gp gr nz oa"><a href="https://codelabs.arrikto.com/codelabs/minikf-kale-automl/index.html?index=..%2F..index#0" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">从笔记本到AutoML，使用Kubeflow和Kale</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">Kubeflow是Kubernetes的机器学习工具包。该项目致力于部署机器…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">codelabs.arrikto.com</p></div></div><div class="oj l"><div class="pe l ol om on oj oo ks oa"/></div></div></a></div><h1 id="88d3" class="mj mk it bd ml mm ng mo mp mq nh ms mt jz ni ka mv kc nj kd mx kf nk kg mz na bi translated">关于作者</h1><p id="b46a" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我的名字是<a class="ae ky" href="https://www.dimpo.me/?utm_source=medium&amp;utm_medium=article&amp;utm_campaign=automl" rel="noopener ugc nofollow" target="_blank">迪米特里斯·波罗普洛斯</a>，我是一名为<a class="ae ky" href="https://www.arrikto.com/" rel="noopener ugc nofollow" target="_blank">阿里克托</a>工作的机器学习工程师。我曾为欧洲委员会、欧盟统计局、国际货币基金组织、欧洲央行、经合组织和宜家等主要客户设计和实施过人工智能和软件解决方案。</p><p id="f855" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有兴趣阅读更多关于机器学习、深度学习、数据科学和数据操作的帖子，请关注我的<a class="ae ky" href="https://towardsdatascience.com/medium.com/@dpoulopoulos/follow" rel="noopener" target="_blank"> Medium </a>、<a class="ae ky" href="https://www.linkedin.com/in/dpoulopoulos/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或Twitter上的<a class="ae ky" href="https://twitter.com/james2pl" rel="noopener ugc nofollow" target="_blank"> @james2pl </a>。</p><p id="e782" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所表达的观点仅代表我个人，并不代表我的雇主的观点或意见。</p></div></div>    
</body>
</html>