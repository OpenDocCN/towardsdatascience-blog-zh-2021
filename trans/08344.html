<html>
<head>
<title>How to schedule a Python Script on Google Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Google Cloud上安排Python脚本</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-schedule-a-python-script-on-google-cloud-721e331a9590?source=collection_archive---------7-----------------------#2021-08-01">https://towardsdatascience.com/how-to-schedule-a-python-script-on-google-cloud-721e331a9590?source=collection_archive---------7-----------------------#2021-08-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cf0d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用Google Cloud Scheduler和Cloud Function安排一个递归Python脚本</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cdc74cdea98c57eec16984580543a9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LvzeVpT_SSe6ZgkA_P0Xag.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@beautyoftechnology?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">尼古拉·塔拉先科</a>在<a class="ae ky" href="https://unsplash.com/s/photos/macbook?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="6458" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没有在您的服务器中设置气流？没有任何设置cron作业来调度脚本的经验？别担心。今天我们将学习如何用最少的cron作业知识在Google云平台中调度您的Python脚本。</p><blockquote class="lv lw lx"><p id="e92b" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">Cloud Scheduler是一个受管理的<a class="ae ky" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> Google云平台</a> (GCP)产品，它允许您指定一个频率来计划一个重复的作业。简而言之，它是一个轻量级的托管任务调度程序。</p></blockquote><p id="06ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为什么我们需要一个调度程序？调度程序允许您在任何时间运行工作流。它在失败的情况下重试，甚至让你在凌晨3点运行一些东西，这样你就不需要在半夜醒来。</p><h1 id="5027" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">入门指南</h1><h2 id="6b95" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">创建云调度程序</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/447eec5a1ca8584d0af479cddaf003ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*WTxVgn4gxp6YWxI5Cn0e5Q.png"/></div></figure><p id="93b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从创建云调度程序开始。去<a class="ae ky" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a>找云调度器或者直接去这个<a class="ae ky" href="https://console.cloud.google.com/cloudscheduler" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><blockquote class="lv lw lx"><p id="41a4" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">注意:您必须设置您的计费帐户才能使用云调度程序。你将每月3个免费工作，每个计费帐户。更多详情，可以参考<a class="ae ky" href="https://cloud.google.com/scheduler/pricing" rel="noopener ugc nofollow" target="_blank">云调度器定价</a>。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/daf450f987c4e52a1322e600cd37be92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P1nkmSqW0Z6RDF4YKZO_dQ.png"/></div></div></figure><p id="bb37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从“安排工作”开始。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/fc3e4ed844505dc4ff9e263e8aeb1027.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*8P4m5RTjWU8T-hndMHG5XQ.png"/></div></figure><p id="78a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本例中，我将安排一个Python脚本来发送电子邮件，因此作业的名称将是<code class="fe nj nk nl nm b">schedule-email</code>。</p><p id="e2bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">计划频率采用unix-cron格式。如果不熟悉unx-cron，可以参考<a class="ae ky" href="https://crontab.guru/" rel="noopener ugc nofollow" target="_blank"> crontab guru网站</a>。我总是参考这个网站，以确保我设置了正确的时间表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/0d075441f2722d5f7dcb7e3f8da62e66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bMC5fwA1oqANVtCWNyBlmg.png"/></div></div></figure><p id="d840" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，<code class="fe nj nk nl nm b">30 8 * * *</code>表示该作业将在每天的08:30运行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/7bcb13236295d3857cbdabf84c2fc7a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vFgctBHV0eBbA_742v631w.png"/></div></div></figure><p id="011d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nj nk nl nm b">0 9 6 * *</code>表示该作业将在每月6日09:00运行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/f66a2bba5764b38286b42ed6894116dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mj-RoIGrgrsQdPIJ8msXqg.png"/></div></div></figure><p id="f067" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们必须配置作业的目标。在本例中，我们将使用发布/订阅作为目标类型。新主题<code class="fe nj nk nl nm b">schedule-email</code>为该作业创建了一个新主题。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/23ee45ac3f4d04f44aecf91673ec9aa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GO9Mz_BU4i6MbnOVrJKOBg.png"/></div></div></figure><p id="3252" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的高级设置是可选的。但是为了安全起见，让我们设置一个重试尝试。之后，让我们单击“创建”按钮来创建云调度程序。</p><h2 id="b026" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">创建云函数</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/a42fcdcbbfc4c3b1d21528cd822e858d.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/1*6s7icH14wPFsdXjjQP8Mcg.png"/></div></figure><p id="2d3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来我们去<a class="ae ky" href="https://console.cloud.google.com/functions" rel="noopener ugc nofollow" target="_blank">云函数</a>创建一个云函数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/392f6d2f82c42cbb68621263029a9037.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9zHedAXAnDHP6VzSVwpCkQ.png"/></div></div></figure><p id="7013" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用名称和地区来配置我们的云函数。触发器类型将是发布/订阅，主题将是我们刚刚创建的主题<code class="fe nj nk nl nm b">schedule-email</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/c1a5072af7f6d996b34ffcb2c6823264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KUn1-hU2CKWam_BhqK3ylQ.png"/></div></div></figure><p id="0c0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们必须用<code class="fe nj nk nl nm b">main.py</code>和<code class="fe nj nk nl nm b">requirement.txt</code>设置脚本。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="49b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本例中，我们将发送一封带有此调度程序的简单电子邮件。因此，这个脚本不需要额外的包/库。我将保持<code class="fe nj nk nl nm b">requirement.txt</code>不变。</p><p id="59dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有兴趣安排一封带附件的邮件，请参考我的另一篇文章。</p><div class="nw nx gp gr ny nz"><a rel="noopener follow" target="_blank" href="/how-to-send-email-with-attachments-by-using-python-41a9d1a3860b"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd iu gy z fp oe fr fs of fu fw is bi translated">如何使用Python发送带附件的电子邮件</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">作为一名数据分析师，我经常会收到这样的请求:“你能每周给我发一份报告吗？”或者…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">towardsdatascience.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on ks nz"/></div></div></a></div><p id="d989" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">入口点</strong>将是您定义在脚本中运行的函数，在本例中是<code class="fe nj nk nl nm b">schedule_email</code>。</p><p id="4093" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以选择配置分配的内存、超时和运行时环境变量。如果你运行一个很长的脚本，请记住分配更多的时间和内存。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/f81bc94c88a6d2dea36805fb4dbb5932.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*31W3wPc1QaWZM1OBrL7ZGg.png"/></div></div></figure><p id="c073" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">耶！邮件成功安排在晚上10点。</p><p id="2237" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你已经学会了如何使用Google Cloud Scheduler 来调度Python脚本。您可以将该调度器用于其他任务，如临时批处理作业、大数据处理作业或基础设施自动化工具。好的一面是云调度程序为您处理所有繁重的工作！</p><p id="c824" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以在我的<a class="ae ky" href="https://gist.github.com/chingjunetao/d175394d39420a79a3ad84ef35be4e8f" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> Github要诀</strong> </a>中查看<code class="fe nj nk nl nm b">main.py</code>。干杯！</p></div><div class="ab cl op oq hx or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="im in io ip iq"><p id="cc5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">如果你喜欢读这篇文章，你可能也会喜欢这些:</strong></p><div class="nw nx gp gr ny nz"><a rel="noopener follow" target="_blank" href="/how-to-rewrite-your-sql-queries-in-python-with-pandas-8d5b01ab8e31"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd iu gy z fp oe fr fs of fu fw is bi translated">如何用熊猫用Python重写SQL查询</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">在Python中再现相同的SQL查询结果</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">towardsdatascience.com</p></div></div><div class="oi l"><div class="ow l ok ol om oi on ks nz"/></div></div></a></div><div class="nw nx gp gr ny nz"><a rel="noopener follow" target="_blank" href="/how-to-style-your-dataframe-with-python-eabf376d1efd"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd iu gy z fp oe fr fs of fu fw is bi translated">如何用Python设计你的数据框架</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">如何使用Python高亮显示、格式化或着色您的数据框</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">towardsdatascience.com</p></div></div><div class="oi l"><div class="ox l ok ol om oi on ks nz"/></div></div></a></div><p id="f023" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">你可以在Medium上找到我其他作品的链接，关注我</strong> <a class="ae ky" href="https://medium.com/@chingjunetao" rel="noopener"> <strong class="lb iu">这里</strong> </a> <strong class="lb iu">。感谢阅读！</strong></p></div></div>    
</body>
</html>