<html>
<head>
<title>The Prefect Way to Automate &amp; Orchestrate Data Pipelines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自动化和编排数据管道的完美方式</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-prefect-way-to-automate-orchestrate-data-pipelines-d4465638bac2?source=collection_archive---------9-----------------------#2021-08-16">https://towardsdatascience.com/the-prefect-way-to-automate-orchestrate-data-pipelines-d4465638bac2?source=collection_archive---------9-----------------------#2021-08-16</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="f5b1" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">我正在将我所有的ETL工作从Airflow迁移到这个超级酷的框架中</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/d46397024d75d4f29c116579261594a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VTRH5WAotHAz_yKD-1XqWg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">从<a class="ae kz" href="https://undraw.co/illustrations" rel="noopener ugc nofollow" target="_blank">展开的插图</a></p></figure><p id="5984" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我是阿帕奇气流的忠实粉丝。即使在今天，我也没有太多抱怨。但是新的技术提督在许多方面让我感到惊讶，我忍不住将一切都迁移到它身上。</p><p id="b218" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">提督(和气流)是一个工作流程自动化工具。您可以编排单个任务来完成更复杂的工作。您可以管理任务相关性，在任务失败时重试任务，调度任务等。</p><p id="a58c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我相信工作流管理是每个数据科学项目的支柱。即使是小项目也可以通过像Prefect这样的工具获得显著的好处。它消除了大量重复性任务。更不用说，它还消除了复杂项目中的思维混乱。</p><p id="7f53" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这篇文章涵盖了一些关于提督的常见问题。它包括，</p><ul class=""><li id="1405" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">一个<a class="ae kz" href="#e6bf" rel="noopener ugc nofollow">简短介绍</a>提督的核心理念；</li><li id="e1f0" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">为什么我决定从气流迁移<a class="ae kz" href="#9e87" rel="noopener ugc nofollow">；</a></li><li id="8b64" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">提督令人难以置信的<a class="ae kz" href="#eea7" rel="noopener ugc nofollow">特性和与其他技术的集成</a>，以及；</li><li id="00db" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">如何在其<a class="ae kz" href="#b24d" rel="noopener ugc nofollow">云和内部</a>部署选项之间做出决定。</li></ul></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="e6bf" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">快速入门级。</h1><p id="a3b9" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">完美是一个最小的和完整的工作流管理工具。设置起来非常简单。然而，它可以做一切工具，如气流可以和更多。</p><p id="e55f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你可以使用PyPI，Conda，或者Pipenv来安装它，它已经准备好了。关于这一点，请参见气流部分。</p><pre class="kk kl km kn gu no np nq nr aw ns bi"><span id="c827" class="nt ms iu np b gz nu nv l nw nx">pip install prefect<br/># conda install -c conda-forge prefect<br/># pipenv install --pre prefect</span></pre><p id="ff81" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在我们开始使用Prefect之前，让我们先来看一个非托管工作流。它使得理解完美在工作流管理中的角色变得容易。</p><p id="e2eb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">下面的脚本查询一个API (Extract — E)，从中挑选相关字段(Transform — T)，并将它们附加到一个文件(Load — L)。它包含三个功能，分别执行提到的每项任务。这是工作流管理工具的一个简单而日常的用例——ETL。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">代码由<a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener">作者</a>编写。</p></figure><p id="02f2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">该脚本从OpenWeatherMap API下载天气数据，并将风速值存储在一个文件中。现实生活中的ETL应用程序可能很复杂。但是这个示例应用程序很好地涵盖了基本方面。</p><p id="34ba" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">注意:请用一个真实的API密钥替换它。你可以从https://openweathermap.org/api得到一个。</p><p id="9e31" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可以使用命令<code class="fe oa ob oc np b">python app.py</code>运行这个脚本，其中app.py是您的脚本文件的名称。这将在当前目录中用一个值创建一个名为windspeed.txt的新文件。这是你到达空气污染指数时马萨诸塞州波士顿的风速。如果您重新运行该脚本，它将向同一个文件追加另一个值。</p><h2 id="ebbb" class="nt ms iu bd mt od oe dn mx of og dp nb lj oh oi nd ln oj ok nf lr ol om nh on bi translated">您的第一个完美的ETL工作流。</h2><p id="32d3" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">上面的脚本运行良好。然而，它缺少完整ETL的一些关键特性，比如重试和调度。此外，如前所述，现实生活中的ETL在单个工作流中可能有数百个任务。其中一些可以并行运行，而一些依赖于一个或多个其他任务。</p><p id="2d8f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">想象一下，如果有一个临时的网络问题阻止您调用API。该脚本将立即失败，无需进一步尝试。在实时应用中，这样的停机时间并不是奇迹。它们的发生有几个原因—服务器停机、网络停机、服务器查询超出限制。</p><p id="b905" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">此外，每次更新windspeed.txt文件时，您都必须手动执行上述脚本。然而，在ETL工作流中，调度工作流在预定义的时间间隔内在特定的时间运行是很常见的。</p><p id="bdc7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这就是诸如Prefect和Airflow等工具的作用。以下是如何调整上述代码，使其成为一个完美的工作流程。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">代码由<a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener">作者</a>编写。</p></figure><p id="a21f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe oa ob oc np b">@task</code>装饰器将一个常规的python函数转换成一个完美的任务。可选参数允许您指定其重试行为。在上面的例子中，我们已经将该函数配置为在失败之前尝试三次。我们还将其配置为每次重试延迟三分钟。</p><p id="4911" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">有了这个新的设置，我们的ETL对我们前面讨论的网络问题具有弹性。</p><p id="0c61" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要测试它的功能，断开你的计算机与网络的连接，用<code class="fe oa ob oc np b">python app.py</code>运行脚本。您将看到一条消息，提示第一次尝试失败，下一次尝试将在接下来的3分钟内开始。在三分钟内，将您的计算机重新连接到互联网。已经运行的脚本现在将完成，没有任何错误。</p><h2 id="9874" class="nt ms iu bd mt od oe dn mx of og dp nb lj oh oi nd ln oj ok nf lr ol om nh on bi translated">使用提督计划工作流。</h2><p id="5532" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">重试只是ETL故事的一部分。许多工作流应用程序面临的另一个挑战是按照预定的时间间隔运行它们。对于任何Python程序员来说，Prefect的调度API都很简单。它是这样工作的。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">代码由<a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener">作者</a>编写。</p></figure><p id="8ace" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们已经创建了一个IntervalSchedule对象，它在脚本执行五秒钟后启动。我们还将其配置为以一分钟为间隔运行。</p><p id="417f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您使用<code class="fe oa ob oc np b">python app.py</code>运行脚本并监控windspeed.txt文件，您将每分钟在其中看到新的值。</p><p id="fafe" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">除了这种简单的调度，提督的调度API提供了更多的控制。您可以用类似cron的方法安排工作流，使用带时区的时钟时间，或者做一些更有趣的事情，比如只在周末执行工作流。我没有在这里一一介绍，但是关于这一点，提督的官方<a class="ae kz" href="https://docs.prefect.io/core/concepts/schedules.html#clocks" rel="noopener ugc nofollow" target="_blank">文件</a>是完美的。</p><h2 id="bc13" class="nt ms iu bd mt od oe dn mx of og dp nb lj oh oi nd ln oj ok nf lr ol om nh on bi translated">完美的用户界面。</h2><p id="1a3e" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">像Airflow(和许多其他产品)一样，Prefect也配备了一个具有漂亮用户界面的服务器。它允许您控制和可视化您的工作流执行。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oo"><img src="../Images/6e20a0db9e857b11d04bdf5be5d8a0bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8NlTnQoHvmtKYFidHbfYSA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">插图由<a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener">作者</a>。</p></figure><p id="21bc" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要运行这个，你需要在你的电脑上安装docker和docker-compose。但令人惊讶的是，启动它只是一个命令。</p><pre class="kk kl km kn gu no np nq nr aw ns bi"><span id="30ac" class="nt ms iu np b gz nu nv l nw nx"><strong class="np iv">$</strong> prefect server start</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj op"><img src="../Images/e66aab3d8fda61405dc28da319792d6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*hqErfnvjCAOwkU0WcSebcA.gif"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">作者插图<a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener">。</a></p></figure><p id="4e37" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这个命令将启动完美服务器，您可以通过您的web浏览器:<code class="fe oa ob oc np b"><a class="ae kz" href="http://localhost:8080/." rel="noopener ugc nofollow" target="_blank">http://localhost:8080/</a></code> <a class="ae kz" href="http://localhost:8080/." rel="noopener ugc nofollow" target="_blank">访问它。</a></p><p id="fd53" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然而，仅仅依靠完美服务器无法执行您的工作流。它的作用只是为你所有的完美活动提供一个控制面板。因为这个仪表板与应用程序的其余部分是分离的，所以您可以使用Prefect cloud来做同样的事情。我们稍后将详细讨论这一点。</p><p id="8644" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">为了执行任务，我们还需要一些东西。好消息是，它们也不复杂。</p><p id="00d7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因为服务器只是一个控制面板，我们需要一个代理来执行工作流。以下命令将启动一个本地代理。如果你的项目需要的话，你可以选择docker代理或者Kubernetes代理，而不是本地代理。</p><pre class="kk kl km kn gu no np nq nr aw ns bi"><span id="622c" class="nt ms iu np b gz nu nv l nw nx"><strong class="np iv">$</strong> prefect agent local start</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oq"><img src="../Images/19091f5c0459c4c0ead4675e3dc40047.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*LN65oSw6ekNSE7LXFVrkYA.gif"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">插图作者。</p></figure><p id="0b40" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">一旦服务器和代理正在运行，您就必须创建一个项目并向该项目注册您的工作流。为此，将执行该流的代码行更改为如下所示。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">代码由<a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener">作者</a>编写。</p></figure><p id="2999" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，在终端中，您可以使用<code class="fe oa ob oc np b">prefect create project &lt;project name&gt;</code>命令创建一个项目。然后重新运行脚本会将它注册到项目中，而不是立即运行它。</p><pre class="kk kl km kn gu no np nq nr aw ns bi"><span id="10a8" class="nt ms iu np b gz nu nv l nw nx"><strong class="np iv">$</strong> prefect create project 'Tutorial'<br/><strong class="np iv">$</strong> python app.py</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oq"><img src="../Images/0872a6d410f65e0055e18de41d075159.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0YKYt89OzjROFQCxqwkD4A.gif"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">作者插图。</p></figure><p id="ad30" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在网络用户界面中，你可以看到新项目“教程”在下拉列表中，我们的风速追踪器在流量列表中。该流已经计划并正在运行。如果您愿意，也可以手动运行它们。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oo"><img src="../Images/4bcdc28fe017f23f9a5aa1bb539cff52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sel2jiWuzTrZbplV_Ps7pw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">作者插图。</p></figure><h2 id="7cbb" class="nt ms iu bd mt od oe dn mx of og dp nb lj oh oi nd ln oj ok nf lr ol om nh on bi translated">使用参数运行工作流。</h2><p id="6dba" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">我们在上一个练习中创建的工作流是严格的。它只查询马萨诸塞州的波士顿，我们不能更改它。这是我们可以使用参数的地方。下面是我们如何调整代码以在运行时接受参数。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">代码由<a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener">作者</a>编写。</p></figure><p id="20c6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们已经更改了函数以接受city参数，并在API查询中动态设置它。在流内部，我们创建一个参数对象，默认值为' Boston ',并将其传递给提取任务。</p><p id="bcbb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您在UI中手动运行风速跟踪器工作流，您会看到一个名为“输入”的部分。您可以在这里设置每次执行的城市值。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj or"><img src="../Images/5c42650aa9cf55117d3e9bd750dc16a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*FkFidj7Co6utyMJ-duejhQ.gif"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">插图由<a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener">作者</a>提供。</p></figure><p id="76d2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这是运行工作流的一种便捷方式。在许多情况下，ETL和任何其他工作流都带有运行时参数。</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="9e87" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">为什么我决定从气流迁移到提督？</h1><p id="64c7" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">Airflow是一个非常棒的工作流管理平台。它在许多项目上为我节省了大量时间。然而，我们需要欣赏接管旧技术的新技术。气流和提督就是这种情况。</p><blockquote class="os"><p id="c8c9" class="ot ou iu bd ov ow ox oy oz pa pb lv dk translated">Airflow做对了很多事情，但是它的核心假设从未预见到已经出现的丰富多样的数据应用程序。</p><p id="beec" class="ot ou iu bd ov ow ox oy oz pa pb lv dk translated">—完善的文档。</p></blockquote><p id="1a19" class="pw-post-body-paragraph la lb iu lc b ld pc jv lf lg pd jy li lj pe ll lm ln pf lp lq lr pg lt lu lv in bi translated">如果你更喜欢气流，我在这里描述的不是死胡同。我们有解决大多数问题的方法。然而，它在Prefect中很方便，因为该工具本身就支持它们。</p><p id="953c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">与气流相比，提督的<strong class="lc iv">装置</strong>格外简单。对于训练有素的眼睛来说，可能不是问题。然而，对于任何想要开始工作流编排和自动化的人来说，这是一个麻烦。</p><p id="10bf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Airflow需要一个运行在后端的<strong class="lc iv">服务器</strong>来执行任何任务。然而，在Prefect中，服务器是可选的。这是使用Prefect的巨大好处。我有许多喜欢的项目作为服务在我的电脑上运行。早些时候，我必须在启动时就有一个气流服务器。因为提督可以独立运行，我不必再打开这个额外的服务器。</p><p id="b583" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Airflow不具备使用<strong class="lc iv">参数</strong>运行工作流(或Dag)的灵活性。我使用的解决方法是让应用程序从数据库中读取它们。对于如此简单的任务来说，这不是一种优秀的编程技术。提督的参数概念是在这方面的例外。</p><p id="cd60" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">提督允许同一工作流有不同的<strong class="lc iv">版本</strong>。每次将工作流注册到项目时，都会创建一个新版本。如果您需要运行以前的版本，您可以在下拉列表中轻松选择它。这在气流中是不可能的。</p><p id="968e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">提督还允许我们创建团队和基于角色的访问控制。每个团队都可以管理自己的配置。<strong class="lc iv">授权</strong>是每一个现代应用程序的关键部分，Prefect尽可能以最好的方式处理它。</p><p id="3b3b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最后，我发现提督的<strong class="lc iv"> UI </strong>更加直观和吸引人。Airflow的UI，尤其是它的任务执行可视化，一开始很难理解。</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="eea7" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">提督的生态系统以及与其他技术的整合。</h1><p id="46b0" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">Prefect内置了与许多其他技术的集成。它消除了大量的开销，使使用它们变得非常容易。</p><p id="8ef8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">实时项目经常需要处理几种技术。例如，当您的ETL失败时，您可能希望向维护人员发送一封电子邮件或一个Slack通知。</p><p id="23f4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在提督，发送这样的通知是毫不费力的。您可以使用级长任务库中的电子邮件任务，设置凭证，然后开始发送电子邮件。</p><p id="7009" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你可以在他们的<a class="ae kz" href="https://docs.prefect.io/core/task_library/overview.html#task-library-in-action" rel="noopener ugc nofollow" target="_blank">官方文档</a>中了解更多关于Prefect丰富的生态系统。在本文中，我们将了解如何发送电子邮件通知。</p><p id="5b06" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要发送电子邮件，我们需要让完美代理可以访问凭证。你可以通过在<code class="fe oa ob oc np b">$HOME/.prefect/config.toml</code>中创建下面的文件来实现。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">代码由<a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener">作者</a>编写。</p></figure><p id="03ab" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你的应用现在可以发送电子邮件了。下面是我们成功捕获风速测量值时发送通知的方式。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">代码由<a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener">作者</a>编写。</p></figure><p id="b9b6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在上面的代码中，我们创建了EmailTask类的一个实例。在启动过程中，我们已经使用了电子邮件配置的所有静态元素。然后在流内部，我们使用它来传递可变内容。</p><p id="4c9a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">上面的配置将发送一封包含捕获的风速测量值的电子邮件。但它的主题将永远是“捕捉到新的风速”</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="b24d" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">完美的云与本地服务器部署。</h1><p id="9cd0" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">我们已经了解了如何启动本地服务器。因为这个服务器只是一个控制面板，你可以很容易地使用云版本。要做到这一点，我们几乎没有额外的步骤。</p><ol class=""><li id="d4f7" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv ph mc md me bi translated">创建一个<a class="ae kz" href="https://cloud.prefect.io/" rel="noopener ugc nofollow" target="_blank">提督云</a>账号。</li><li id="1c49" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv ph mc md me bi translated">从<a class="ae kz" href="https://cloud.prefect.io/user/keys" rel="noopener ugc nofollow" target="_blank"> API密钥页</a>生成一个密钥。</li><li id="aca0" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv ph mc md me bi translated">在您的终端中，将后端设置为cloud: <code class="fe oa ob oc np b">prefect backend cloud</code>。</li><li id="ac28" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv ph mc md me bi translated">同样使用生成的密钥登录:<code class="fe oa ob oc np b">prefect auth login --key YOUR_API_KEY</code>。</li><li id="7827" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv ph mc md me bi translated">现在，像往常一样启动代理。<code class="fe oa ob oc np b">prefect agent local start</code>。</li></ol><p id="9481" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在云仪表板中，您可以管理之前在本地服务器上所做的一切。</p><p id="ce3f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在云版本和服务器版本之间选择的一个大问题是安全性。根据Prefect的文档，服务器只存储与工作流执行相关的数据和用户提供的自愿信息。由于本地计算机中的代理执行逻辑，因此您可以控制存储数据的位置。</p><p id="e555" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">云选项也是适合<strong class="lc iv">性能</strong>的原因。使用一个云服务器，您可以管理多个代理。因此，您可以毫不费力地扩展您的应用程序。</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="8480" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">最后的想法</h1><p id="793c" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">Airflow是我构建ETL和其他工作流管理应用程序的最终选择。然而，提督改变了我的想法，现在我把一切从气流迁移到提督。</p><p id="9317" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Prefect是一个简单的工具，可以灵活地扩展到超出气流所能做的范围。你甚至可以在Jupyter笔记本上运行它。此外，您可以将其作为一个完整的任务管理解决方案。</p><p id="0d81" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">除了工作流管理的核心问题之外，Prefect还解决了您在实际系统中可能经常遇到的其他几个问题。使用授权控制管理团队，发送通知就是其中的一些。</p><p id="c6c3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本文中，我们讨论了如何创建一个ETL</p><ul class=""><li id="5f3c" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">根据配置重试一些任务；</li><li id="3de0" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">按计划运行工作流；</li><li id="adfe" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">接受运行时参数，并且。</li><li id="7b49" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">完成后发送电子邮件通知。</li></ul><p id="21a1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们只是触及了级长能力的皮毛。我推荐阅读官方的<a class="ae kz" href="https://docs.prefect.io/core/" rel="noopener ugc nofollow" target="_blank">文档</a>以获取更多信息。</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><blockquote class="pi pj pk"><p id="8419" class="la lb pl lc b ld le jv lf lg lh jy li pm lk ll lm pn lo lp lq po ls lt lu lv in bi translated">感谢阅读，朋友！看来你和我有许多共同的兴趣。我很乐意在<a class="ae kz" href="https://www.linkedin.com/in/thuwarakesh/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>、<a class="ae kz" href="https://twitter.com/Thuwarakesh" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和<a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener"> Medium </a>上与你联系。</p></blockquote><p id="3a2a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">还不是中等会员？请使用此链接<a class="ae kz" href="https://thuwarakesh.medium.com/membership" rel="noopener"> <strong class="lc iv">成为</strong> </a>会员。你可以享受成千上万的有见地的文章，并支持我，因为我赚了一点佣金介绍你。</p></div></div>    
</body>
</html>