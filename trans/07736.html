<html>
<head>
<title>How to Scrape HTML Tables with Python Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Python熊猫刮HTML表格</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-scrape-html-tables-with-python-pandas-98d18d2129cb?source=collection_archive---------12-----------------------#2021-07-15">https://towardsdatascience.com/how-to-scrape-html-tables-with-python-pandas-98d18d2129cb?source=collection_archive---------12-----------------------#2021-07-15</a></blockquote><div><div class="fc ik il im in io"/><div class="ip iq ir is it"><h2 id="f307" class="iu iv iw bd b dl ix iy iz ja jb jc dk jd translated" aria-label="kicker paragraph">数据收集</h2><div class=""/><div class=""><h2 id="84ca" class="pw-subtitle-paragraph kc jf iw bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">一个现成的代码，它利用了Python熊猫库的read_html()函数</h2></div><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj ku"><img src="../Images/50c5a85df82166352a77ccdfb032c185.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BRY5bCUBJ9_zxQ8_KI6H0A.jpeg"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">图片由<a class="ae lk" href="https://pixabay.com/users/goumbik-3752482/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2717063" rel="noopener ugc nofollow" target="_blank"> Goumbik </a>从<a class="ae lk" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2717063" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>获得</p></figure><p id="003c" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">几乎所有在Python工作的数据科学家都知道Pandas库，几乎所有人都知道<code class="fe mh mi mj mk b">read_csv()</code>函数。但是，他们中只有很少人知道<code class="fe mh mi mj mk b">read_html()</code>的功能。</p><p id="7095" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated"><code class="fe mh mi mj mk b">read_html()</code>函数允许快速提取HTML页面中包含的表格。这个函数的基本版本提取HTML页面中包含的所有表格，而使用一些特定的参数可以提取非常特定的表格。</p><p id="ae9a" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">在本教程中，我将重点放在以下HTML页面上，其中包含2020年欧洲杯的各组比赛:</p><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj ml"><img src="../Images/894f31138d59dfb73432cc0f2dc08fdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KiojtdmVZVPvNBKGkjmWlg.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="b79e" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">每个表格都具有以下HTML结构:</p><pre class="kv kw kx ky gu mm mk mn mo aw mp bi"><span id="ba3b" class="mq mr iw mk b gz ms mt l mu mv">&lt;table class="table"&gt;</span><span id="1a6b" class="mq mr iw mk b gz mw mt l mu mv">  &lt;thead&gt;<br/>    &lt;tr&gt;<br/>      &lt;th title="Field #1"&gt;&lt;/th&gt;<br/>      &lt;th title="Field #2"&gt;P&lt;/th&gt;<br/>      &lt;th title="Field #3"&gt;+/-&lt;/th&gt;<br/>      &lt;th title="Field #4"&gt;Pts&lt;/th&gt;<br/>    &lt;/tr&gt;<br/>  &lt;/thead&gt;</span><span id="cfcb" class="mq mr iw mk b gz mw mt l mu mv">  &lt;tbody&gt;<br/>    &lt;tr&gt;<br/>      &lt;td&gt;&lt;span&gt;1&lt;/span&gt; &lt;/span&gt;ITA&lt;/span&gt;  &lt;span&gt;Italy&lt;/span&gt;&lt;/td<br/>      &lt;td&gt;3&lt;/td&gt;<br/>      &lt;td&gt;7&lt;/td&gt;<br/>      &lt;td&gt;9&lt;/td&gt;<br/>    &lt;/tr&gt;<br/>    &lt;tr&gt; <br/>      ...<br/>    &lt;/tr&gt;<br/>    &lt;tr&gt;<br/>       ...<br/>    &lt;/tr&gt;<br/>    &lt;tr&gt;<br/>       ...<br/>    &lt;/tr&gt;<br/>  &lt;/tbody&gt;<br/>&lt;/table&gt;</span></pre><h1 id="4b33" class="mx mr iw bd my mz na nb nc nd ne nf ng kl nh km ni ko nj kp nk kr nl ks nm nn bi translated">提取所有表格</h1><p id="a7f1" class="pw-post-body-paragraph ll lm iw ln b lo no kg lq lr np kj lt lu nq lw lx ly nr ma mb mc ns me mf mg ip bi translated">欧足联网站包含6张表格，每组一张(A-F)。我可以简单地通过将路径传递给<code class="fe mh mi mj mk b">read_html()</code>函数来提取所有的表</p><pre class="kv kw kx ky gu mm mk mn mo aw mp bi"><span id="e7a9" class="mq mr iw mk b gz ms mt l mu mv">import pandas as pd</span><span id="cee6" class="mq mr iw mk b gz mw mt l mu mv">df_list = pd.read_html("source/euro2020_groups.html")</span></pre><p id="ba89" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">该函数返回一个包含6个数据帧的列表，每组一个。例如，<code class="fe mh mi mj mk b">df_list[0]</code>包含第一个数据帧:</p><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj nt"><img src="../Images/dc52c452db6b92b97eb1f403941daee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*HM1j0pAv7VgghWY3Iv-v1g.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="1b7c" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">所有的数据帧都有相同的结构。我注意到第一列<code class="fe mh mi mj mk b">Unnamed: 0</code>没有被正确识别。因此，它需要一个清洁过程。</p><h1 id="e46d" class="mx mr iw bd my mz na nb nc nd ne nf ng kl nh km ni ko nj kp nk kr nl ks nm nn bi translated">将所有提取的表组合成一个表</h1><p id="c783" class="pw-post-body-paragraph ll lm iw ln b lo no kg lq lr np kj lt lu nq lw lx ly nr ma mb mc ns me mf mg ip bi translated">现在，我将所有提取的表组合成一个表。为了保持表之间的差异，我需要添加一个新列，存储每条记录所属的组。</p><p id="4181" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我定义了一个包含所有组(A-F)的列表:</p><pre class="kv kw kx ky gu mm mk mn mo aw mp bi"><span id="51e0" class="mq mr iw mk b gz ms mt l mu mv">import string</span><span id="3a96" class="mq mr iw mk b gz mw mt l mu mv">N = len(df_list)<br/>groups_names = list(string.ascii_uppercase[0:N])</span></pre><p id="0de0" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated"><code class="fe mh mi mj mk b">groups_names</code>变量包含以下值:</p><pre class="kv kw kx ky gu mm mk mn mo aw mp bi"><span id="4f69" class="mq mr iw mk b gz ms mt l mu mv">['A', 'B', 'C', 'D', 'E', 'F']</span></pre><p id="323b" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">现在我通过<code class="fe mh mi mj mk b">append()</code>函数将所有数据帧分组。首先我定义了一个空的数据帧，然后我将包含在<code class="fe mh mi mj mk b">df_list</code>变量中的所有数据帧添加到它上面。根据上下文，我还添加了<code class="fe mh mi mj mk b">Group</code>列，它指定了每条记录所属的组:</p><pre class="kv kw kx ky gu mm mk mn mo aw mp bi"><span id="5794" class="mq mr iw mk b gz ms mt l mu mv">df = pd.DataFrame()<br/>for i in range(0,N):<br/>    group_col = [groups_names[i]] * len(df_list[i])<br/>    df_list[i]['Group'] = group_col<br/>    df = df.append(df_list[i])</span></pre><p id="ec91" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">现在数据帧<code class="fe mh mi mj mk b">df</code>如下表所示:</p><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj nu"><img src="../Images/3513843724f56ac2a4a942ee1016de3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*gqXQ4HiiEhw9wlwcAFjm4w.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><h1 id="0297" class="mx mr iw bd my mz na nb nc nd ne nf ng kl nh km ni ko nj kp nk kr nl ks nm nn bi translated">清洁数据框</h1><p id="4ae4" class="pw-post-body-paragraph ll lm iw ln b lo no kg lq lr np kj lt lu nq lw lx ly nr ma mb mc ns me mf mg ip bi translated">数据帧<code class="fe mh mi mj mk b">df</code>看起来有点脏:事实上，列<code class="fe mh mi mj mk b">Unnamed: 0</code>是不正确的。首先，我把它改名为<code class="fe mh mi mj mk b">Team</code>:</p><pre class="kv kw kx ky gu mm mk mn mo aw mp bi"><span id="5f85" class="mq mr iw mk b gz ms mt l mu mv">df.rename(columns={"Unnamed: 0": "Team"}, inplace=True)</span></pre><p id="c0d7" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">然后我扩展了<code class="fe mh mi mj mk b">Team</code>列，将它分成许多列:</p><pre class="kv kw kx ky gu mm mk mn mo aw mp bi"><span id="abb9" class="mq mr iw mk b gz ms mt l mu mv">df_new = df['Team'].str.split(' ',expand=True)</span></pre><p id="59fb" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated"><code class="fe mh mi mj mk b">df_new</code>数据帧如下所示:</p><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj nv"><img src="../Images/65889d5e4153516ee37a3e9817b7dd60.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*_t3ncrEHgcivKcKBbVy1uw.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="7a76" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">唯一有趣的列是0、1和2。因此，我选择then，并将其分配给原始数据帧中的新列<code class="fe mh mi mj mk b">df</code>:</p><pre class="kv kw kx ky gu mm mk mn mo aw mp bi"><span id="00db" class="mq mr iw mk b gz ms mt l mu mv">df[['N', 'ID', 'Country']] = df_new[[0,1,2]]</span></pre><p id="6765" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我可以删除原来的<code class="fe mh mi mj mk b">Team</code>列:</p><pre class="kv kw kx ky gu mm mk mn mo aw mp bi"><span id="6b01" class="mq mr iw mk b gz ms mt l mu mv">df.drop(['Team'], axis=1, inplace=True)</span></pre><p id="864a" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated"><code class="fe mh mi mj mk b">df</code>数据帧如下所示:</p><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj nw"><img src="../Images/c8f3e9835a3b84f9a052d0844a136345.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*m0d9tUrD6ZQ8F7UR7h2ooA.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="5b67" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">表格是正确的，但是列的顺序是错误的。我需要首先移动组，然后是N，ID，Country，最后是剩余的列。我可以通过<code class="fe mh mi mj mk b">reindex()</code>函数对列进行重新排序，该函数接收精确的列顺序作为输入:</p><pre class="kv kw kx ky gu mm mk mn mo aw mp bi"><span id="1798" class="mq mr iw mk b gz ms mt l mu mv">df = df.reindex(columns=['Group','N', 'ID', 'Country', 'P', '+/-', 'Pts'])</span></pre><p id="9b13" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated"><code class="fe mh mi mj mk b">df</code>数据帧如下所示:</p><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj nx"><img src="../Images/22311e6e6d94e79f68a68dc7b2e89a8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*QQvFyQGdaKfYPvxHqOFM0w.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><h1 id="f29a" class="mx mr iw bd my mz na nb nc nd ne nf ng kl nh km ni ko nj kp nk kr nl ks nm nn bi translated">保存数据帧</h1><p id="6b25" class="pw-post-body-paragraph ll lm iw ln b lo no kg lq lr np kj lt lu nq lw lx ly nr ma mb mc ns me mf mg ip bi translated">现在，我可以将数据帧保存为CSV文件:</p><pre class="kv kw kx ky gu mm mk mn mo aw mp bi"><span id="fe65" class="mq mr iw mk b gz ms mt l mu mv">df.to_csv('euro_2020_groups.csv')</span></pre><h1 id="0620" class="mx mr iw bd my mz na nb nc nd ne nf ng kl nh km ni ko nj kp nk kr nl ks nm nn bi translated">摘要</h1><p id="054a" class="pw-post-body-paragraph ll lm iw ln b lo no kg lq lr np kj lt lu nq lw lx ly nr ma mb mc ns me mf mg ip bi translated">在本教程中，我用Python Pandas演示了一个从HTML页面中提取表格的简单机制。这可以通过<code class="fe mh mi mj mk b">read_html()</code>函数来实现，非常简单快捷。在大多数情况下，报废的桌子需要一些清理过程。</p><p id="39fb" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated"><code class="fe mh mi mj mk b">read_html()</code>函数还提供了一个有趣的输入参数，称为<code class="fe mh mi mj mk b">match</code>，可以用来提取复杂HTML页面中非常具体的表格。想深化这个参数敬请期待:)</p><p id="6763" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">本文中解释的所有代码都可以作为Jupyter笔记本从<a class="ae lk" href="https://github.com/alod83/data-science/blob/master/DataCollection/Web/Pandas%20read_html.ipynb" rel="noopener ugc nofollow" target="_blank"> my Github repository </a>下载。</p><p id="f3c1" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">如果你想了解我的研究和其他活动的最新情况，你可以在<a class="ae lk" href="https://twitter.com/alod83" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae lk" href="https://www.youtube.com/channel/UC4O8-FtQqGIsgDW_ytXIWOg?view_as=subscriber" rel="noopener ugc nofollow" target="_blank"> Youtube </a>和<a class="ae lk" href="https://github.com/alod83" rel="noopener ugc nofollow" target="_blank"> Github </a>上关注我。</p><h1 id="600e" class="mx mr iw bd my mz na nb nc nd ne nf ng kl nh km ni ko nj kp nk kr nl ks nm nn bi translated">相关文章</h1><div class="ny nz gq gs oa ob"><a rel="noopener follow" target="_blank" href="/scraping-data-from-nested-html-pages-with-python-selenium-c5f23065841f"><div class="oc ab fp"><div class="od ab oe cl cj of"><h2 class="bd jg gz z fq og fs ft oh fv fx jf bi translated">用Python Selenium从嵌套的HTML页面中抓取数据</h2><div class="oi l"><p class="bd b dl z fq og fs ft oh fv fx dk translated">towardsdatascience.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo le ob"/></div></div></a></div><div class="ny nz gq gs oa ob"><a rel="noopener follow" target="_blank" href="/how-to-extract-tables-from-pdf-using-python-pandas-and-tabula-py-c65e43bd754"><div class="oc ab fp"><div class="od ab oe cl cj of"><h2 class="bd jg gz z fq og fs ft oh fv fx jf bi translated">如何使用Python熊猫和tabula-py从PDF中提取表格</h2><div class="op l"><h3 class="bd b gz z fq og fs ft oh fv fx dk translated">一个从PDF中提取重复表格的快捷脚本</h3></div><div class="oi l"><p class="bd b dl z fq og fs ft oh fv fx dk translated">towardsdatascience.com</p></div></div><div class="oj l"><div class="oq l ol om on oj oo le ob"/></div></div></a></div><div class="ny nz gq gs oa ob"><a rel="noopener follow" target="_blank" href="/how-to-load-the-content-of-a-google-document-in-python-1d23fd8d8e52"><div class="oc ab fp"><div class="od ab oe cl cj of"><h2 class="bd jg gz z fq og fs ft oh fv fx jf bi translated">如何用Python加载Google文档的内容</h2><div class="oi l"><p class="bd b dl z fq og fs ft oh fv fx dk translated">towardsdatascience.com</p></div></div><div class="oj l"><div class="or l ol om on oj oo le ob"/></div></div></a></div><div class="ny nz gq gs oa ob"><a rel="noopener follow" target="_blank" href="/three-tricks-to-speed-up-and-optimise-your-python-d9b5d49d68a6"><div class="oc ab fp"><div class="od ab oe cl cj of"><h2 class="bd jg gz z fq og fs ft oh fv fx jf bi translated">加快和优化Python的三个技巧</h2><div class="op l"><h3 class="bd b gz z fq og fs ft oh fv fx dk translated">关于我在六月份的阅读中发现的三个Python技巧的评论。</h3></div><div class="oi l"><p class="bd b dl z fq og fs ft oh fv fx dk translated">towardsdatascience.com</p></div></div><div class="oj l"><div class="os l ol om on oj oo le ob"/></div></div></a></div></div></div>    
</body>
</html>