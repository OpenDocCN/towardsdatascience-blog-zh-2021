<html>
<head>
<title>Automatic Parallel Parking: Path Planning, Path Tracking &amp; Control</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自动平行泊车:路径规划、路径跟踪和控制</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automatic-parallel-parking-system-including-path-planning-path-tracking-and-parallel-parking-in-a-ece780b2e8e0?source=collection_archive---------18-----------------------#2021-07-27">https://towardsdatascience.com/automatic-parallel-parking-system-including-path-planning-path-tracking-and-parallel-parking-in-a-ece780b2e8e0?source=collection_archive---------18-----------------------#2021-07-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="eca0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用A *算法、B样条插值、车辆运动学和MPC控制器在2D环境中实现自动停车系统的Python。</h2></div></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/65254ab640a94872b13d50d9e1f8cdd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*3sl6WOkhtQeYZ7oDEF_ueg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="e03f" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">本文包含虚拟环境中自动平行泊车系统的python实现，包括路径规划、路径跟踪和平行泊车。代理在环境中导航其路线，并被MPC控制器指引到指定的停车位置。你可以在这里找到完整的项目<a class="ae lu" href="https://github.com/Pandas-Team/Automatic-Parking" rel="noopener ugc nofollow" target="_blank"/>。</p></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><h2 id="d00d" class="lv lw iq bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">环境</h2><p id="f2b6" class="pw-post-body-paragraph ky kz iq la b lb mo jr ld le mp ju lg lh mq lj lk ll mr ln lo lp ms lr ls lt ij bi translated">开发自动停车场系统的第一步是设计和开发一个能够使用<code class="fe mt mu mv mw b">OpenCV</code>库进行可视化渲染的环境。环境作为一个类在<code class="fe mt mu mv mw b">environment.py</code>中实现，并在开始<code class="fe mt mu mv mw b">env = Environment(obs)</code>时接收障碍。可以使用<code class="fe mt mu mv mw b">env.render(x,y,angle)</code>放置代理。</p><p id="1677" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">下面显示了一个环境示例。你可以从1号到24号选择停车位。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi mx"><img src="../Images/8afc23f0e0fd48aa3a8e5b9989b3a879.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UAS0oKS3JcO24_KqrPNqbQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><h2 id="3f19" class="lv lw iq bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">路径规划</h2><p id="4862" class="pw-post-body-paragraph ky kz iq la b lb mo jr ld le mp ju lg lh mq lj lk ll mr ln lo lp ms lr ls lt ij bi translated"><strong class="la ir"> A*算法</strong></p><p id="fa25" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">代理将使用*找到从起点到目标的路径。这个来自<a class="ae lu" href="https://pythonrobotics.readthedocs.io/en/latest/modules/path_planning.html" rel="noopener ugc nofollow" target="_blank"> PythonRobotics </a>的A*实现考虑了障碍物和机器人半径等参数。</p><p id="b2e3" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated"><strong class="la ir">用B样条插值路径</strong></p><p id="2a70" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">在离散的100*100空间中找到路径后，使用b样条将路径平滑并缩放到环境的1000*1000空间。结果是一组点来指导我们的代理！</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nc nd l"/></div></figure></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><h2 id="dc66" class="lv lw iq bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">路径跟踪</h2><p id="0f56" class="pw-post-body-paragraph ky kz iq la b lb mo jr ld le mp ju lg lh mq lj lk ll mr ln lo lp ms lr ls lt ij bi translated"><strong class="la ir">小车的运动学模型</strong>为:</p><pre class="kn ko kp kq gt ne mw nf ng aw nh bi"><span id="ca3f" class="lv lw iq mw b gy ni nj l nk nl">x' = v . cos(ψ)<br/>y' = v . sin(ψ)<br/>v' = a<br/>ψ' = v . tan(δ)/L</span></pre><p id="a8ad" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">a:加速度，δ:转向角，ψ:偏航角，L:轴距，x: x位置，y: y位置，v:速度</p><p id="e0f3" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated"><strong class="la ir">状态向量</strong>为:</p><pre class="kn ko kp kq gt ne mw nf ng aw nh bi"><span id="9e41" class="lv lw iq mw b gy ni nj l nk nl">z=[x,y,v,<!-- -->ψ<!-- -->]</span></pre><p id="69d9" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">x: x位置，y: y位置，v:速度，ψ:偏航角</p><p id="de65" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated"><strong class="la ir">输入向量</strong>为:</p><pre class="kn ko kp kq gt ne mw nf ng aw nh bi"><span id="9486" class="lv lw iq mw b gy ni nj l nk nl">u=[a,δ]</span></pre><p id="91aa" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">a:加速度，δ:转向角</p><p id="7b99" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated"><strong class="la ir">控制</strong></p><p id="11cf" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">MPC控制器基于模型控制车辆速度和转向，并引导车辆通过路径。MPC有一个使用线性化模型的选项。在这种情况下，MPC将工作点周围的运动学模型线性化，然后进行优化。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nc nd l"/></div></figure></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><h2 id="af0f" class="lv lw iq bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">自动停车</h2><p id="d55c" class="pw-post-body-paragraph ky kz iq la b lb mo jr ld le mp ju lg lh mq lj lk ll mr ln lo lp ms lr ls lt ij bi translated">这部分包括4条规则，代理人必须根据停车位置进行选择。这里我们来看看其中的一个。路径设计的规格如下图所示。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nm"><img src="../Images/e5f73b286682f0e249db31511ec4f0c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TzYC_S70HUw_9ZUuNDHNEA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4857" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">首先，代理将找到一条路径来停放车辆，然后计算到达角度。基于到达角度，代理选择2个坐标作为确保1 (x0，y0)和确保2 (x1，y1)点。这是起点和终点。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nn"><img src="../Images/ae231e92ee5858b0c808eae5b58fee60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JocFl_EgDUCg0wy70bJL-Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="89b4" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">此后，使用如下所述的2个圆方程来规划从确保1 (x0，y0)到确保2 (x1，y1)的停车路径。2条直线也被添加到路径上，以提供一个漂亮的停车路线。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi no"><img src="../Images/bcdaeddc20c661266fd5e03221ae5c31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sySfQ4_7l8e2bLj_hYxDZQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0dcf" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">MPC通过ensure2坐标中的路径和停车场控制代理。</p></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><h2 id="129a" class="lv lw iq bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">结论</h2><p id="c367" class="pw-post-body-paragraph ky kz iq la b lb mo jr ld le mp ju lg lh mq lj lk ll mr ln lo lp ms lr ls lt ij bi translated">您可以从<a class="ae lu" href="https://github.com/Pandas-Team/Automatic-Parking" rel="noopener ugc nofollow" target="_blank"> <em class="np"> G </em> ithub </a>下载整个项目，并使用以下命令运行代码:</p><pre class="kn ko kp kq gt ne mw nf ng aw nh bi"><span id="62e0" class="lv lw iq mw b gy ni nj l nk nl">$ python main_autopark.py --x_start 0 --y_start 90 --psi_start 0 --parking 7</span></pre><p id="d089" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">可以看出，汽车由MPC控制器引导，沿着它的路径行驶，直到它到达环境的停车点。最后，该车与其他车辆平行并停在指定位置。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/9b640d40d90dd692eb8db851c77e8b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*4OOYEcrdY6CYZKBZOqxnow.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><blockquote class="nr ns nt"><p id="7c20" class="ky kz np la b lb lc jr ld le lf ju lg nu li lj lk nv lm ln lo nw lq lr ls lt ij bi translated"><a class="ae lu" href="https://github.com/Pandas-Team" rel="noopener ugc nofollow" target="_blank"> <em class="iq">熊猫队</em> </a> <em class="iq">在2020-2021年全国自动驾驶汽车拉尼山竞赛中获得第一名。</em></p><p id="249c" class="ky kz np la b lb lc jr ld le lf ju lg nu li lj lk nv lm ln lo nw lq lr ls lt ij bi translated"><a class="ae lu" href="https://medium.com/@amirhosseinh77" rel="noopener">阿米尔侯赛因·海达里安</a>，艾达·穆罕默德·沙希<a class="ae lu" href="https://medium.com/@soltany.m.99" rel="noopener">，米拉德·索尔塔尼</a>，<a class="ae lu" href="https://medium.com/@abbasomidi77" rel="noopener">阿巴斯·奥米迪</a>，<a class="ae lu" href="https://medium.com/@amirhossein477" rel="noopener">阿米尔侯赛因·卡泽罗尼</a></p></blockquote></div></div>    
</body>
</html>