<html>
<head>
<title>The Most Popular Languages on Reddit after Analyzing ~1M Comments</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">分析约100万条评论后，Reddit上最受欢迎的语言</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-most-popular-languages-on-reddit-analyzed-with-snowflake-and-a-java-udtf-4e58c8ba473c?source=collection_archive---------9-----------------------#2021-10-27">https://towardsdatascience.com/the-most-popular-languages-on-reddit-analyzed-with-snowflake-and-a-java-udtf-4e58c8ba473c?source=collection_archive---------9-----------------------#2021-10-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5e24" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Reddit上最流行的语言(除了英语)会让你大吃一惊。为了构建这个图表，我用雪花和Java UDTF分析了将近一百万条Reddit评论(不到两分钟)。</h2></div><p id="a402" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Reddit上最受欢迎的语言，分析了1M评论后:英语，德语(！)，西班牙语，葡萄牙语，法语，意大利语，罗马尼亚语(！)，荷兰语(！)…</p><p id="33ff" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">与母语为英语的人数相比，结果令人惊讶:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/0171ea689962772640837a5ab0aca2d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2bLxhjDN3PNnH-Aj.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">Reddit上的热门语言— <a class="ae lr" href="https://i.imgur.com/GRGVyOW.png" rel="noopener ugc nofollow" target="_blank">全图</a> + <a class="ae lr" href="https://public.tableau.com/views/202110-redditlanguages-pub/Dashboard1?:language=en-US&amp;publish=yes&amp;:display_count=n&amp;:origin=viz_share_link" rel="noopener ugc nofollow" target="_blank">更新Tableau互动</a>(作者)</p></figure><p id="0589" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">德语是Reddit上第二受欢迎的语言——这可能是本周<a class="ae lr" href="https://www.redditinc.com/blog/hallo-and-guten-tag-reddit-is-coming-to-germany" rel="noopener ugc nofollow" target="_blank"> Reddit在柏林</a>开设办事处的一大原因:</p><blockquote class="ls lt lu"><p id="ed44" class="kf kg lv kh b ki kj jr kk kl km ju kn lw kp kq kr lx kt ku kv ly kx ky kz la ij bi translated">每天都有数百万德国用户涌向Reddit，与那些有相似兴趣的人一起寻找社区和归属感，随着47%的用户年增长率，德国现在是我们第五大用户群的所在地。今天，我们正式向我们在欧洲中心的朋友们问好，并通过地面上的专门团队打开我们在柏林的大门。</p></blockquote><p id="6ae0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本帖中，我们将在Snowflake中用Java UDF分析近百万条reddit评论的结果——不到两分钟。还有哪些语言、地区、话题在Reddit上有很高的代表性？</p><h1 id="ffa7" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">分析</h1><p id="8bca" class="pw-post-body-paragraph kf kg iq kh b ki mr jr kk kl ms ju kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">我从前40个子编辑之外的将近一百万条Reddit评论开始(在下面找到构建这个样本的确切规则)。一旦分析完成，就会发现只有约3%的评论是用英语以外的语言写的:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/4e1945d5b286aebe36aab1761cd3f754.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/1*0NbRAFjLpTlmxw4gaFxfAQ.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">约97%的Reddit分析评论是英文的</p></figure><p id="9132" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最受欢迎语言的排名令人惊讶:Reddit上第二受欢迎的语言是德语。第三个是西班牙语(没那么令人惊讶)，接下来是葡萄牙语、法语、意大利语、罗马尼亚语和荷兰语:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mx"><img src="../Images/fc5de4c1b121b326744f1a574b512bbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DZ_591FijOTcfYbBATEPgg.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">Reddit上除英语之外最受欢迎的语言(图片由作者提供)</p></figure><p id="dbb0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些结果令人惊讶，因为德语是世界上第12大流行语言。作为一种语言，法语甚至比德语更受欢迎，但德语社区在Reddit上发现了更多的吸引力。</p><p id="aa0e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据维基百科，这些是世界上使用最多的语言——这个列表与Reddit在其用户中看到的完全不同:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi my"><img src="../Images/d8883639a9373667494bde300288f2ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*HiKTRKI7YEAMtkZfXE70nA.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">维基百科:<a class="ae lr" href="https://en.wikipedia.org/wiki/List_of_languages_by_total_number_of_speakers" rel="noopener ugc nofollow" target="_blank">按使用者总数排列的语言列表</a></p></figure><h2 id="2d29" class="mz ma iq bd mb na nb dn mf nc nd dp mj ko ne nf ml ks ng nh mn kw ni nj mp nk bi translated">一种语言，许多子编辑</h2><p id="2ea2" class="pw-post-body-paragraph kf kg iq kh b ki mr jr kk kl ms ju kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated"><strong class="kh ir">德语subreddits: </strong>大多数德语注释位于/r/de中，即德国的subreddit，其次是/r/Austria，然后是/r/Finanzen中的金融对话。其次是德语版的/r/me_irl: <a class="ae lr" href="https://www.reddit.com/r/ich_iel/" rel="noopener ugc nofollow" target="_blank"> /r/ich_iel/ </a>。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nl"><img src="../Images/daca48fa59517c278b40846dd0047303.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jy3JX9q6GV-gRvtro8o3Mw.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">(图片由作者提供)</p></figure><p id="257e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">西班牙语subreddit:</strong>西班牙语中最大的subred dit是/r/argentina。这很令人惊讶，因为墨西哥的人口是他们的3倍，但是/r/mexico只有他们评论的1/3。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/583c359b9ed64234975bf03169a0bb98.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*1RMTC8I_YF8mTOQkI7fzYA.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">(图片由作者提供)</p></figure><p id="2ed9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">葡萄牙语subreddit:</strong>葡萄牙语中最大的subred dit是/r/brasil，其次是/r/portugal。这很令人惊讶，因为巴西的人口是他们的20倍，但/r/brasil的评论只有他们的1.5倍。他们最受欢迎的话题是告白、未经审查的内容、足球、投资和性。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/97dee63b2b263f29937f70b37590e014.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*zSykM74GKGGT0uswpSc-WQ.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">(图片由作者提供)</p></figure><p id="c1ee" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">法语subreddits: 令人惊讶的是/r/Quebec是仅次于/r/france的第二大法语sub。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi no"><img src="../Images/809536e65d70f7ceb85dc465edfd159a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*EX4ZtRygujF1q8pya9Tt2g.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">(图片由作者提供)</p></figure><p id="630d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">以此类推</strong>:列表继续</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi np"><img src="../Images/0b5d427f59d2694e4580814c6b4ba99f.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*7oLF5z5QqLOKhccOFuthjg.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">代表多种语言的子编辑(图片由作者提供)</p></figure><h2 id="5944" class="mz ma iq bd mb na nb dn mf nc nd dp mj ko ne nf ml ks ng nh mn kw ni nj mp nk bi translated">一个子编辑，多种语言</h2><p id="4076" class="pw-post-body-paragraph kf kg iq kh b ki mr jr kk kl ms ju kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">一些子编辑处理多种语言的内容。常见的组合是英语加上另一种语言，然后是/r/塞尔维亚，它将其注释分为波斯尼亚语、克罗地亚语和塞尔维亚语:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nq"><img src="../Images/0509a14cdf5a2ce435aba45e798ab4be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7KCXPKglnQu0jFhsEGJiPw.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">带有多语言注释的子编辑(图片由作者提供)</p></figure><h1 id="e954" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">操作方法</h1><p id="3bcc" class="pw-post-body-paragraph kf kg iq kh b ki mr jr kk kl ms ju kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">获取100万条reddit评论并在Snowflake中用Java UDF分析他们的语言并不困难，之前的帖子解释了这一点:</p><div class="nr ns gp gr nt nu"><a href="https://medium.com/snowflake/loading-reddit-comments-into-snowflake-44b9f2072a84" rel="noopener follow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">将261GB的reddit评论加载到雪花中</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">我曾经将reddit评论加载到BigQuery上，现在是时候将我的管道升级到雪花了。让我们开始吧…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">medium.com</p></div></div><div class="od l"><div class="oe l of og oh od oi ll nu"/></div></div></a></div><div class="nr ns gp gr nt nu"><a href="https://medium.com/snowflake/new-in-snowflake-java-udfs-with-a-kotlin-nlp-example-e52d94d33468" rel="noopener follow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">雪花中的新特性:Java UDFs(带有一个Kotlin NLP示例)</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">雪花现在让你轻松地创建Java UDFs，这是一个令人难以置信的强大和多才多艺的功能。让我们检查一下…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">medium.com</p></div></div><div class="od l"><div class="oj l of og oh od oi ll nu"/></div></div></a></div><h1 id="7fcb" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">疑问和注释</h1><h2 id="bf1f" class="mz ma iq bd mb na nb dn mf nc nd dp mj ko ne nf ml ks ng nh mn kw ni nj mp nk bi translated">用Java UDTF检测语言</h2><p id="39ae" class="pw-post-body-paragraph kf kg iq kh b ki mr jr kk kl ms ju kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">由于雪花最近宣布支持<a class="ae lr" href="https://docs.snowflake.com/en/developer-guide/udf/java/udf-java-tabular-functions.html" rel="noopener ugc nofollow" target="_blank"> Java表UDF</a>，我决定尝试一下。令人惊讶的是，表格UDF比我以前的Java UDF表现得更好。在下面的部分中可以找到关于这个的细节。</p><div class="nr ns gp gr nt nu"><a href="https://www.snowflake.com/blog/bringing-more-to-the-table-azure-and-udtf-support-with-snowpark/" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">带来更多:Azure和UDTF对Snowpark的支持</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">6月，我们宣布Java函数和Snowpark API可以在AWS中预览。今天，我们…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">www.snowflake.com</p></div></div><div class="od l"><div class="ok l of og oh od oi ll nu"/></div></div></a></div><p id="ee6d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">UDTFs能够读取表并将表输出回来。这是产生本文结果的UDTF实现:</p><pre class="lc ld le lf gt ol om on oo aw op bi"><span id="4de9" class="mz ma iq om b gy oq or l os ot">create or replace function detect_lang_udtf(v varchar)<br/>returns table(output_value varchar)<br/>language java<br/>imports = ('@~/lingua-1.1.0-with-dependencies.jar')<br/>handler='MyClass'<br/>target_path='@~/202110xx3.jar'<br/>as<br/>$$<br/>import java.util.stream.Stream;<br/>  <br/>import com.github.pemistahl.lingua.api.*;<br/>import static com.github.pemistahl.lingua.api.Language.*;</span><span id="3d59" class="mz ma iq om b gy ou or l os ot">class OutputRow {<br/>  public String output_value;</span><span id="1c22" class="mz ma iq om b gy ou or l os ot">  public OutputRow(String output_value) {<br/>      this.output_value = output_value;<br/>  }<br/>}</span><span id="e400" class="mz ma iq om b gy ou or l os ot">class MyClass {</span><span id="f6dc" class="mz ma iq om b gy ou or l os ot">  static LanguageDetector detector = LanguageDetectorBuilder.fromAllLanguages().withPreloadedLanguageModels().build();</span><span id="95bd" class="mz ma iq om b gy ou or l os ot">  public MyClass()  {<br/>  }</span><span id="9c06" class="mz ma iq om b gy ou or l os ot">  public static Class getOutputClass() {<br/>      return OutputRow.class;<br/>  }</span><span id="9d70" class="mz ma iq om b gy ou or l os ot">  public Stream&lt;OutputRow&gt; process(String input_value) {<br/>      String x = detector.detectLanguageOf(input_value).toString();<br/>      return Stream.of(new OutputRow(x));<br/>  }</span><span id="3608" class="mz ma iq om b gy ou or l os ot">  public Stream&lt;OutputRow&gt; endPartition() {<br/>      return Stream.empty();<br/>  }<br/>}</span><span id="afab" class="mz ma iq om b gy ou or l os ot">$$;</span></pre><h2 id="1b88" class="mz ma iq bd mb na nb dn mf nc nd dp mj ko ne nf ml ks ng nh mn kw ni nj mp nk bi translated">~百万条评论样本</h2><p id="3068" class="pw-post-body-paragraph kf kg iq kh b ki mr jr kk kl ms ju kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">规则:</p><ul class=""><li id="973c" class="ov ow iq kh b ki kj kl km ko ox ks oy kw oz la pa pb pc pd bi translated">从2020年12月1日至2021年12月14日之间的14天reddit评论开始(参见<a class="ae lr" href="https://medium.com/snowflake/loading-reddit-comments-into-snowflake-44b9f2072a84" rel="noopener">如何在雪花上加载reddit评论</a>)。</li><li id="5c11" class="ov ow iq kh b ki pe kl pf ko pg ks ph kw pi la pa pb pc pd bi translated">丢弃前40个子编辑中的评论(不需要分析每个语言，主要是英语)。</li><li id="02ed" class="ov ow iq kh b ki pe kl pf ko pg ks ph kw pi la pa pb pc pd bi translated">从评论中删除特殊字符、URL和链接。</li><li id="eeb1" class="ov ow iq kh b ki pe kl pf ko pg ks ph kw pi la pa pb pc pd bi translated">只允许超过200个字符的评论。</li><li id="4dc2" class="ov ow iq kh b ki pe kl pf ko pg ks ph kw pi la pa pb pc pd bi translated">丢弃90%的剩余评论，保留10%的随机样本。</li><li id="209c" class="ov ow iq kh b ki pe kl pf ko pg ks ph kw pi la pa pb pc pd bi translated">应用前面的规则后，只保留子编辑中超过50条注释的注释(采样前为500条)。</li><li id="b4fc" class="ov ow iq kh b ki pe kl pf ko pg ks ph kw pi la pa pb pc pd bi translated">有待分析的评论总数:3，860个子评论中的938，131条。</li></ul><pre class="lc ld le lf gt ol om on oo aw op bi"><span id="2787" class="mz ma iq om b gy oq or l os ot">create or replace temp table reddit_sample as <br/>    <br/>with top_subs as (<br/>    select count(*), v:subreddit subreddit<br/>    from reddit_comments_sample<br/>    group by 2 <br/>    order by 1 desc<br/>    limit 40<br/>)<br/>    <br/>select *<br/>from (<br/>    select *, v:subreddit subreddit<br/>        , regexp_replace(v:body, 'http[^ ]*', '') body_clean1<br/>        , regexp_replace(body_clean1, '&amp;[a-z][a-z]+;', '') body_clean2<br/>        , regexp_replace(body_clean2, '\\[[^\\]]*\\]', '') body_clean<br/>        , count(*) over(partition by subreddit) c_sub <br/>    from reddit_comments_sample<br/>    where v:author not in ('[deleted]', 'AutoModerator')<br/>    and subreddit not in (select subreddit from top_subs)<br/>    and length(body_clean) &gt; 200<br/>    and uniform(0::float, 1::float, random()) &lt; 0.1<br/>)<br/>where c_sub &gt; 50<br/>;</span></pre><p id="18da" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">用UDTF分析每个评论的语言</strong></p><p id="fae3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了优化，我们只给函数一个清理过的注释的前200个字符进行分析:</p><pre class="lc ld le lf gt ol om on oo aw op bi"><span id="c3fc" class="mz ma iq om b gy oq or l os ot">create table reddit_sample_languages_udtf<br/>as<br/>select *, output_value lang<br/>from reddit_sample a, table(detect_lang_udtf(substr(body_clean, 0, 200)))  x<br/>;</span></pre><h2 id="8342" class="mz ma iq bd mb na nb dn mf nc nd dp mj ko ne nf ml ks ng nh mn kw ni nj mp nk bi translated">算英语vs不算</h2><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/4e1945d5b286aebe36aab1761cd3f754.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/1*0NbRAFjLpTlmxw4gaFxfAQ.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">97%经过分析的reddit评论是英文的</p></figure><pre class="lc ld le lf gt ol om on oo aw op bi"><span id="6975" class="mz ma iq om b gy oq or l os ot">select count(*) comments<br/>    , ratio_to_report(comments) over() percent<br/>    , iff(lang='ENGLISH', 'English', 'Not English') language<br/>from reddit_sample_languages_udtf<br/>group by 3<br/>order by 1 desc</span></pre><h2 id="1d1b" class="mz ma iq bd mb na nb dn mf nc nd dp mj ko ne nf ml ks ng nh mn kw ni nj mp nk bi translated">UDF对UDTF的表演</h2><p id="92f6" class="pw-post-body-paragraph kf kg iq kh b ki mr jr kk kl ms ju kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">我以前的UDF用XL雪花仓库花了4分钟分析了100万条评论，而新的UDTF用了不到一半的时间就能做到。</p><p id="dbb5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当查看细节时，发现UDF和UDTF消耗的资源量相似——UDTF更快，因为雪花并行化更好地执行了这些调用。</p><p id="56a8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不要对此过于担心，因为雪花工程师目前正在努力改进这些情况。Java UDFs和UDTFs目前在Snowflake中处于预览模式，您很快就能体验到这些改进。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/6c2f5a8f5d6d00f2079885d4f6059746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*_JO3txnv6u6aPkQsVYYlHA.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">XL warehouse上Java UDF与UDTF的性能对比——UDTF在当前实现下执行了更好的并行化(改进正在进行中)</p></figure><pre class="lc ld le lf gt ol om on oo aw op bi"><span id="2fe8" class="mz ma iq om b gy oq or l os ot">select lang, count(*)<br/>from (<br/>    select *, detect_langs(substr(body_clean, 0, 200)) lang<br/>    from reddit_sample a<br/>)<br/>group by 1<br/>order by 2 desc<br/>--4:06 UDF xl<br/>;</span><span id="6f07" class="mz ma iq om b gy ou or l os ot">select lang, count(*)<br/>from (<br/>    select *, output_value lang<br/>    from reddit_sample a<br/>        , table(detect_lang_udtf(substr(body_clean, 0, 200)))  x<br/>)<br/>group by 1<br/>order by 2 desc</span><span id="8c43" class="mz ma iq om b gy ou or l os ot">- 1m58s UDTF xl <br/>;</span></pre><h2 id="2684" class="mz ma iq bd mb na nb dn mf nc nd dp mj ko ne nf ml ks ng nh mn kw ni nj mp nk bi translated">过滤和格式化结果</h2><p id="acdf" class="pw-post-body-paragraph kf kg iq kh b ki mr jr kk kl ms ju kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">此查询查看以前的结果，格式化标签，查看子编辑中检测到的语言之间的比率，并排除每个子编辑中表示少于2%的语言:</p><pre class="lc ld le lf gt ol om on oo aw op bi"><span id="f46f" class="mz ma iq om b gy oq or l os ot">select 'r/'||subreddit sub<br/>    , initcap(lang) language<br/>    , count(*) c<br/>    , ratio_to_report(c) over(partition by sub) ratio<br/>    , sum(iff(language!='English', c, 0)) over(partition by sub) total_not_english<br/>    , sum(c) over(partition by sub) total<br/>from reddit_sample_languages_udtf<br/>group by 1, 2<br/>qualify ratio &gt; .02<br/>order by total_not_english desc, c desc, 1, ratio desc</span></pre><h1 id="a2b7" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">信用</h1><ul class=""><li id="a2e5" class="ov ow iq kh b ki mr kl ms ko pk ks pl kw pm la pa pb pc pd bi translated"><a class="pn po ep" href="https://medium.com/u/3a16fa97630d?source=post_page-----4e58c8ba473c--------------------------------" rel="noopener" target="_blank">杰森·鲍姆加特纳</a>负责<a class="ae lr" href="https://medium.com/snowflake/loading-reddit-comments-into-snowflake-44b9f2072a84" rel="noopener">收集和分享Reddit的评论</a>。</li><li id="54c8" class="ov ow iq kh b ki pe kl pf ko pg ks ph kw pi la pa pb pc pd bi translated"><a class="ae lr" href="https://github.com/pemistahl" rel="noopener ugc nofollow" target="_blank"> Peter M. Stahl </a>为<a class="ae lr" href="https://github.com/pemistahl/lingua" rel="noopener ugc nofollow" target="_blank"> Lingua </a>项目检测Java中的语言。</li><li id="e1f3" class="ov ow iq kh b ki pe kl pf ko pg ks ph kw pi la pa pb pc pd bi translated">雪花使在UDF中运行Java代码变得容易。</li></ul><h1 id="cbb7" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">更新和评论</h1><figure class="lc ld le lf gt lg gh gi paragraph-image"><a href="https://www.reddit.com/r/dataisbeautiful/comments/qhhqoy/the_most_popular_languages_on_reddit_after/"><div class="gh gi pp"><img src="../Images/5ae1d5c84fdb4c950244c52a01e6df21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lb61luAs2kWwxT9-Tt-f5A.png"/></div></a><p class="ln lo gj gh gi lp lq bd b be z dk translated"><a class="ae lr" href="https://www.reddit.com/r/dataisbeautiful/comments/qhhqoy/the_most_popular_languages_on_reddit_after/" rel="noopener ugc nofollow" target="_blank">关于reddit的讨论</a></p></figure><ul class=""><li id="9c76" class="ov ow iq kh b ki kj kl km ko ox ks oy kw oz la pa pb pc pd bi translated">查看reddit 上的<a class="ae lr" href="https://www.reddit.com/r/dataisbeautiful/comments/qhhqoy/the_most_popular_languages_on_reddit_after/" rel="noopener ugc nofollow" target="_blank">评论，即:</a><a class="ae lr" href="https://www.reddit.com/r/dataisbeautiful/comments/qhhqoy/the_most_popular_languages_on_reddit_after/" rel="noopener ugc nofollow" target="_blank">/r/dataisbeautiful/[…]/the _ most _ popular _ languages _ on _ Reddit</a></li><li id="5370" class="ov ow iq kh b ki pe kl pf ko pg ks ph kw pi la pa pb pc pd bi translated"><a class="ae lr" href="https://public.tableau.com/views/202110-redditlanguages-pub/Dashboard1?:language=en-US&amp;publish=yes&amp;:display_count=n&amp;:origin=viz_share_link" rel="noopener ugc nofollow" target="_blank">更新了Tableau上的交互式仪表盘</a>。</li></ul><h1 id="b2a4" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">想要更多吗？</h1><ul class=""><li id="216b" class="ov ow iq kh b ki mr kl ms ko pk ks pl kw pm la pa pb pc pd bi translated">用一个<a class="ae lr" href="http://bit.ly/sf-free-trial" rel="noopener ugc nofollow" target="_blank">雪花免费试用</a>账户试试吧——你只需要一个电子邮件地址就可以开始了。</li></ul><p id="fa2b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我是Felipe Hoffa，雪花的数据云倡导者。谢谢你和我一起冒险。可以<a class="ae lr" href="https://twitter.com/felipehoffa" rel="noopener ugc nofollow" target="_blank">在Twitter </a>和<a class="ae lr" href="https://www.linkedin.com/in/hoffa/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>关注我。查看<a class="ae lr" href="https://www.reddit.com/r/snowflake/" rel="noopener ugc nofollow" target="_blank">reddit.com/r/snowflake</a>最有趣的雪花新闻。</p></div></div>    
</body>
</html>