<html>
<head>
<title>Extract Data from PayPal API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从 PayPal API 提取数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/extract-data-from-paypal-api-c25c76748746?source=collection_archive---------30-----------------------#2021-11-16">https://towardsdatascience.com/extract-data-from-paypal-api-c25c76748746?source=collection_archive---------30-----------------------#2021-11-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f511" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">或者使用 Serverless Node.js 从任意数据源 API 加载，并在加载到数据仓库之前执行任何 ETL/ELT</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/efe41497e0230f128302132cd739e623.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*aeXTD0orlTVMeMUZop8r_A.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="1f4b" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated"><a class="ae lu" href="https://github.com/mshakhomirov/pipelinetools" rel="noopener ugc nofollow" target="_blank">代码为</a>的 Github 库</h2><h1 id="ccf8" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">项目大纲</h1><h2 id="aab7" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">您将了解如何:</h2><h1 id="bd88" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">创建一个开发人员访问和沙箱和模拟测试交易的贝宝账户</h1><ul class=""><li id="0de8" class="mg mh it mi b mj mk ml mm lh mn ll mo lp mp mq mr ms mt mu bi translated">创建一个<strong class="mi iu">沙盒账户</strong>，在 PayPal 的测试环境中集成和测试代码。</li><li id="2f69" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">用一些事务数据填充您的测试环境</li><li id="3408" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">尝试从 PayPal 报告 API 中<strong class="mi iu">提取</strong>这些数据。</li></ul><h1 id="1f51" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">使用 AWS Lambda 创建 PayPal 数据连接器</h1><ul class=""><li id="7945" class="mg mh it mi b mj mk ml mm lh mn ll mo lp mp mq mr ms mt mu bi translated">连接到您的 PayPal 帐户，使用 PayPal API 授权令牌提取交易数据，例如，昨天的交易数据。</li><li id="ea47" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">使用名为<strong class="mi iu">的配置文件。/config.json </strong>，它将设置如何访问和保存你的数据。例如，您可能希望使用与数据仓库中的表名相同的前缀来命名文件。</li><li id="14cb" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">向<strong class="mi iu"> PayPal API </strong>发送 http 请求以获取交易数据，并将结果作为 JSON 文件保存到您的 AWS S3 存储桶中。</li><li id="8b0b" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">使用<strong class="mi iu"> npm 运行测试</strong>命令在本地运行</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/3eff5299718d3d29dafcce280e7429e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_tKcm5eS5rKnwpsy.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者@mshakhomirov</p></figure><h1 id="1e05" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">关于这个想法</h1><h1 id="31a2" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">构建数据仓库:</h1><p id="18fc" class="pw-post-body-paragraph nb nc it mi b mj mk ju nd ml mm jx ne lh nf ng nh ll ni nj nk lp nl nm nn mq im bi translated">通常，您会希望将您的数据仓库解决方案(BigQuery、Snowflake 或任何其他解决方案)放在图表的<strong class="mi iu">中心</strong>。</p><ol class=""><li id="6942" class="mg mh it mi b mj no ml np lh nq ll nr lp ns mq nt ms mt mu bi translated"><strong class="mi iu">轻松连接任何外部数据源，即设置管道从 PayPal API </strong>获取数据并保存到云中。</li><li id="bf83" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq nt ms mt mu bi translated">将数据加载到<strong class="mi iu"> BigQuery </strong> (AWS S3 到带有节点的 BigQuery 摄取管理器。JS)</li><li id="827d" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq nt ms mt mu bi translated">使用 Git、CI/CD 创建文档化的数据转换管道。例如，用<strong class="mi iu">数据表单</strong></li><li id="2797" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq nt ms mt mu bi translated">通过云形成或地形简化和自动化部署(<strong class="mi iu">基础设施代码</strong></li><li id="b8ca" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq nt ms mt mu bi translated">使用<strong class="mi iu"> Google Data Studio </strong>创建 BI 报告(例如，收入对账等。)</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/de018360c83c9d44c75cc6dd8ef0e4cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2WKM4P1I6k1GRG1z.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片<a class="nv nw ep" href="https://medium.com/u/e06a48b3dd48?source=post_page-----c25c76748746--------------------------------" rel="noopener" target="_blank">💡迈克·沙克霍米罗夫</a></p></figure><h1 id="3c02" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">现代数据堆栈工具(当然不是完整的列表):</h1><ul class=""><li id="46e6" class="mg mh it mi b mj mk ml mm lh mn ll mo lp mp mq mr ms mt mu bi translated">摄入:五川，缝合</li><li id="0c6c" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">仓储:雪花，大查询，红移</li><li id="5f5c" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">转换:dbt、数据流、API。</li><li id="6c94" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">BI: Looker，Mode，Periscope，Chartio，Metabase，Redash</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/a2d81d619ac8e5955f2dd919fff84460.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tYUXuvskPt4WPyeS.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者@mshakhomirov</p></figure><p id="b69b" class="pw-post-body-paragraph nb nc it mi b mj no ju nd ml np jx ne lh ny ng nh ll nz nj nk lp oa nm nn mq im bi translated">谈到<strong class="mi iu">数据提取和摄取</strong>您可能希望使用付费和托管工具，如<strong class="mi iu"> Fivetran </strong>或<strong class="mi iu"> Stitch </strong>从任意数据源(即支付商户提供商、汇率、地理编码数据库等)提取数据。)但是如果你遵循这个指南，你将完全有能力自己做这件事。</p><h1 id="e0bd" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">真实生活场景</h1><p id="251d" class="pw-post-body-paragraph nb nc it mi b mj mk ju nd ml mm jx ne lh nf ng nh ll ni nj nk lp nl nm nn mq im bi translated">假设你是一名数据工程师</p><p id="97ee" class="pw-post-body-paragraph nb nc it mi b mj no ju nd ml np jx ne lh ny ng nh ll nz nj nk lp oa nm nn mq im bi translated">您正在进行一个项目，将各种数据源连接到您在<strong class="mi iu"> BigQuery </strong>中的数据仓库。您的公司是一家手机游戏开发工作室，在 IOS 和 ANDROID 两个平台上销售各种产品。</p><h1 id="e719" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">你的筹码</h1><blockquote class="ob oc od"><p id="f2a7" class="nb nc oe mi b mj no ju nd ml np jx ne of ny ng nh og nz nj nk oh oa nm nn mq im bi translated"><em class="it">你的开发栈是混合的，包括</em><strong class="mi iu"><em class="it">AWS</em></strong><em class="it">和</em><strong class="mi iu"><em class="it">GCP</em></strong><em class="it">。你的团队经常使用 Node.js。</em></p><p id="e466" class="nb nc oe mi b mj no ju nd ml np jx ne of ny ng nh og nz nj nk oh oa nm nn mq im bi translated"><em class="it">数据科学团队使用 Python，但服务器和客户端数据管道是使用 Node 创建的。</em></p><p id="745d" class="nb nc oe mi b mj no ju nd ml np jx ne of ny ng nh og nz nj nk oh oa nm nn mq im bi translated"><em class="it">您的数据堆栈是现代的、事件驱动的和数据密集型的。</em></p><p id="5815" class="nb nc oe mi b mj no ju nd ml np jx ne of ny ng nh og nz nj nk oh oa nm nn mq im bi translated">数据仓库解决方案必须具有足够的成本效益和灵活性，以便您可以添加任何您需要的数据源。</p><p id="619c" class="nb nc oe mi b mj no ju nd ml np jx ne of ny ng nh og nz nj nk oh oa nm nn mq im bi translated"><em class="it">它必须能够轻松扩展，以满足您不断增长的数据。</em></p></blockquote><h1 id="393a" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">任务</h1><p id="de34" class="pw-post-body-paragraph nb nc it mi b mj mk ju nd ml mm jx ne lh nf ng nh ll ni nj nk lp nl nm nn mq im bi translated">所有数据来自各种数据表面的文件，即数据库、kinesis 消防水带流和各种通知服务。它以不同的格式(CSV、JSON、PARQUET 等)存储到您的云数据湖中。).</p><p id="7e67" class="pw-post-body-paragraph nb nc it mi b mj no ju nd ml np jx ne lh ny ng nh ll nz nj nk lp oa nm nn mq im bi translated">作为一名<strong class="mi iu">数据工程师</strong>，你的任务是创建一条新的数据管道，将来自<strong class="mi iu"> PayPal </strong>的财务数据输入数据仓库。财务团队将使用它来分析<strong class="mi iu">谷歌数据工作室</strong>每天的收入对账报告。</p><p id="91d6" class="pw-post-body-paragraph nb nc it mi b mj no ju nd ml np jx ne lh ny ng nh ll nz nj nk lp oa nm nn mq im bi translated">您决定使用<strong class="mi iu"> AWS Lambda </strong>函数和<strong class="mi iu"> Node.js </strong>每天从 PayPal 交易 API 提取数据，并首先保存到 AWS S3。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/ca1a01e77fc1e4fd0f48220724e7a0e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xm3cMa5lovuvXxJA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者@mshakhomirov</p></figure><blockquote class="ob oc od"><p id="97c5" class="nb nc oe mi b mj no ju nd ml np jx ne of ny ng nh og nz nj nk oh oa nm nn mq im bi translated"><em class="it">这个简单的管道将确保数据被保存，并准备加载到 BigQuery，在那里它将被组织成表。</em></p></blockquote><h1 id="ea44" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">先决条件、库和设置</h1><h1 id="e22b" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">工具</h1><ul class=""><li id="479a" class="mg mh it mi b mj mk ml mm lh mn ll mo lp mp mq mr ms mt mu bi translated">已安装 Node.js 和节点包管理器</li><li id="4227" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">对云计算(Amazon Web Services 帐户)、AWS CLI 和 AWS SDK 有基本的了解</li><li id="8a30" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">PayPal 开发者账户</li><li id="b72d" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">Shell(命令行界面)命令和脚本(高级)。</li></ul><h1 id="e818" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">技术</h1><ul class=""><li id="050f" class="mg mh it mi b mj mk ml mm lh mn ll mo lp mp mq mr ms mt mu bi translated">对 REST APIs 的理解。</li><li id="f6ab" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">良好的节点知识。JS(中级)。您将创建一个 Lambda 函数。</li><li id="c03d" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">你必须了解 Node。JS 基本概念，即异步函数、节点包和代码如何工作。</li><li id="0e86" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">基本调试(控制台、打印报表)</li><li id="170c" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">循环:即用于</li><li id="0960" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">分支:if、if/else、开关</li><li id="93f2" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">Shell 命令和脚本，就像您希望从命令行使用 AWS CLI 部署 Lambda 并能够在本地测试它一样。</li></ul><h1 id="2b28" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">我们开始吧</h1><h1 id="9f5a" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">第一步。创建一个开发人员访问和沙箱的贝宝帐户</h1><blockquote class="ob oc od"><p id="2374" class="nb nc oe mi b mj no ju nd ml np jx ne of ny ng nh og nz nj nk oh oa nm nn mq im bi translated"><em class="it">转到 developer.paypal.com</em><a class="ae lu" href="https://developer.paypal.com" rel="noopener ugc nofollow" target="_blank"><em class="it"/></a><em class="it">，创建一个</em> <strong class="mi iu"> <em class="it">应用</em> </strong> <em class="it">。这将是对 Node.js 应用程序的集成。</em></p><p id="2bd8" class="nb nc oe mi b mj no ju nd ml np jx ne of ny ng nh og nz nj nk oh oa nm nn mq im bi translated"><em class="it">创建一个</em> <strong class="mi iu"> <em class="it">沙盒账号</em> </strong> <em class="it">在 PayPal 的测试环境中集成和测试代码。</em></p><p id="7a67" class="nb nc oe mi b mj no ju nd ml np jx ne of ny ng nh og nz nj nk oh oa nm nn mq im bi translated"><em class="it">用一些交易数据填充您的测试环境</em></p><p id="87e9" class="nb nc oe mi b mj no ju nd ml np jx ne of ny ng nh og nz nj nk oh oa nm nn mq im bi translated"><em class="it">试着将</em> <strong class="mi iu"> <em class="it">收拢</em> </strong> <em class="it">这些数据从 PayPal 的 API 上报。</em></p></blockquote><p id="31cf" class="pw-post-body-paragraph nb nc it mi b mj no ju nd ml np jx ne lh ny ng nh ll nz nj nk lp oa nm nn mq im bi translated">如果这些步骤中的任何一个导致困难，请参考下面的<strong class="mi iu">帮助</strong>部分。</p><h1 id="0ce7" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">第二步。在你的机器上创建一个名为 bq-paypal-revenue 的本地 Node.js 应用。此应用程序将执行以下操作:</h1><blockquote class="ob oc od"><p id="f0c8" class="nb nc oe mi b mj no ju nd ml np jx ne of ny ng nh og nz nj nk oh oa nm nn mq im bi translated"><em class="it">连接到您的 PayPal 账户，使用 PayPal API 授权令牌提取交易数据，例如昨天的交易数据。</em></p><p id="b43b" class="nb nc oe mi b mj no ju nd ml np jx ne of ny ng nh og nz nj nk oh oa nm nn mq im bi translated"><em class="it">使用一个名为</em> <strong class="mi iu"> <em class="it">的配置文件。/config.json </em> </strong> <em class="it">其中将有所有设置如何访问和保存您的数据。例如，您可能希望使用与数据仓库中的表名相同的前缀来命名文件。</em></p><p id="1fd8" class="nb nc oe mi b mj no ju nd ml np jx ne of ny ng nh og nz nj nk oh oa nm nn mq im bi translated"><em class="it">发送</em><strong class="mi iu"><em class="it">http</em></strong><em class="it">请求到</em><strong class="mi iu"><em class="it">PayPal API</em></strong><em class="it">获取交易数据并将结果作为 JSON 文件保存到您的 AWS S3 桶中。</em></p><p id="381b" class="nb nc oe mi b mj no ju nd ml np jx ne of ny ng nh og nz nj nk oh oa nm nn mq im bi translated"><em class="it">本地运行用</em> <strong class="mi iu"> <em class="it"> npm 运行测试</em> </strong> <em class="it">命令</em></p></blockquote><h1 id="7b29" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">可交付的</h1><p id="6923" class="pw-post-body-paragraph nb nc it mi b mj mk ju nd ml mm jx ne lh nf ng nh ll ni nj nk lp nl nm nn mq im bi translated">该项目的可交付成果是一个工作的<strong class="mi iu"> Node.js </strong>应用程序，它将能够在本地运行，并作为<strong class="mi iu"> lambda 函数</strong>部署在<strong class="mi iu"> AWS </strong>帐户中。</p><p id="86eb" class="pw-post-body-paragraph nb nc it mi b mj no ju nd ml np jx ne lh ny ng nh ll nz nj nk lp oa nm nn mq im bi translated">感觉卡住了？</p><h1 id="d92d" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">帮助</h1><h1 id="548c" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">第一步:贝宝沙盒</h1><ul class=""><li id="2554" class="mg mh it mi b mj mk ml mm lh mn ll mo lp mp mq mr ms mt mu bi translated">使用访问令牌查询 PayPal API。如何获得访问令牌的更多信息可以在<a class="ae lu" href="https://developer.paypal.com/docs/api/reference/get-an-access-token/" rel="noopener ugc nofollow" target="_blank">这里</a>找到</li><li id="caba" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated"><a class="ae lu" href="https://developer.paypal.com/docs/api-basics/manage-apps/#create-or-edit-sandbox-and-live-apps" rel="noopener ugc nofollow" target="_blank"> PayPal API 基础知识</a>解释如何创建实时和沙盒 PayPal 账户。尝试创建一个沙盒。另一个有用的链接是<a class="ae lu" href="https://developer.paypal.com/docs/api-basics/sandbox/" rel="noopener ugc nofollow" target="_blank"> PayPal 沙盒测试指南</a>，它解释了测试过程，并提供了一些创建 PayPal 开发者账户的技巧。</li><li id="bb3d" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">使用您的沙箱<code class="fe oi oj ok ol b">client_id:secret</code>并将其添加到 CURL 请求中:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><ul class=""><li id="f2a4" class="mg mh it mi b mj no ml np lh nq ll nr lp ns mq mr ms mt mu bi translated">结果，您会看到类似这样的内容:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/bda1c48cdb8a2eaef7f4a304bc0a9a85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VSVf1-Vw02j8wMQT.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者@mshakhomirov</p></figure><ul class=""><li id="d072" class="mg mh it mi b mj no ml np lh nq ll nr lp ns mq mr ms mt mu bi translated">现在，您可以使用这个<strong class="mi iu">访问令牌</strong>创建另一个请求来提取交易或您需要的任何其他数据，例如发票等。重复使用访问令牌，直到它过期。然后，获得一个新的令牌。这个想法是自动化的过程，所以在<strong class="mi iu">步骤 2 </strong>中，我们将创建一个微服务，以编程方式从 PayPal 获取数据。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><ul class=""><li id="6376" class="mg mh it mi b mj no ml np lh nq ll nr lp ns mq mr ms mt mu bi translated">用上一步中的标记替换'<access-token>'。您将看到类似这样的内容:</access-token></li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/725ddf9859dce9ecc8cfc69ab583ad68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pt7psMp7xJQ3CYga.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片<a class="nv nw ep" href="https://medium.com/u/e06a48b3dd48?source=post_page-----c25c76748746--------------------------------" rel="noopener" target="_blank">💡迈克·沙克霍米罗夫</a></p></figure><ul class=""><li id="aec2" class="mg mh it mi b mj no ml np lh nq ll nr lp ns mq mr ms mt mu bi translated">您可以看到还没有交易。</li></ul><h1 id="3c11" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">第一步:如何模拟测试贝宝交易</h1><ul class=""><li id="e23a" class="mg mh it mi b mj mk ml mm lh mn ll mo lp mp mq mr ms mt mu bi translated">在您的沙箱中创建样本交易的最简单方法是使用<a class="ae lu" href="https://www.paypal.com/apex/home" rel="noopener ugc nofollow" target="_blank"> PayPal 产品 API 执行器</a></li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/bddeac3c81ed514024582bc9383aa489.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OEs4w4zE1yc9pLM5.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者@mshakhomirov</p></figure><p id="0709" class="pw-post-body-paragraph nb nc it mi b mj no ju nd ml np jx ne lh ny ng nh ll nz nj nk lp oa nm nn mq im bi translated">你想使用贝宝结账标准，并创建一个完整的交易流程将是:</p><ul class=""><li id="4016" class="mg mh it mi b mj no ml np lh nq ll nr lp ns mq mr ms mt mu bi translated">获取访问令牌</li><li id="8918" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">创建订单(授权和获取)。快速结帐的默认意图是<strong class="mi iu">捕获</strong>，并在交易被买方批准后立即捕获资金。点击此处了解更多关于<a class="ae lu" href="https://developer.paypal.com/docs/platforms/checkout/add-capabilities/auth-capture/" rel="noopener ugc nofollow" target="_blank">授权的信息。</a></li><li id="44f1" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">批准订单(买方批准订单并乐意付款)</li><li id="4a90" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">更新订单</li><li id="a084" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">获取订单付款</li><li id="b856" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">显示订单详细信息</li></ul><p id="2137" class="pw-post-body-paragraph nb nc it mi b mj no ju nd ml np jx ne lh ny ng nh ll nz nj nk lp oa nm nn mq im bi translated"><strong class="mi iu">让我们创建一个订单</strong>(用您的令牌替换“持票人”后的短语):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><ul class=""><li id="6d55" class="mg mh it mi b mj no ml np lh nq ll nr lp ns mq mr ms mt mu bi translated">因此，您将看到创建了一些示例事务:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/6a1191618baa97e4b9a193799cac3c3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RFIdK717ITY2dcBy.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者@mshakhomirov</p></figure><ul class=""><li id="af4e" class="mg mh it mi b mj no ml np lh nq ll nr lp ns mq mr ms mt mu bi translated">客户现在将接受并批准它:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/48c9deff9b11439a1ab4ff246076bb6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*M6nKghDPHZaLy_qx.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者@mshakhomirov</p></figure><p id="3b46" class="pw-post-body-paragraph nb nc it mi b mj no ju nd ml np jx ne lh ny ng nh ll nz nj nk lp oa nm nn mq im bi translated"><strong class="mi iu">重要提示:</strong>为了模仿 Sandox 客户，您需要在 paypal.developer.portal 中创建一个测试个人账户，该账户不同于您的测试企业账户。通过这样做，您将能够实际批准您的订单。前往 https://developer.paypal.com/developer/accounts/<a class="ae lu" href="https://developer.paypal.com/developer/accounts/" rel="noopener ugc nofollow" target="_blank">创建一个测试个人账户。然后登录并使用它来批准订单。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/aede1ccacec61680c216af6bad2daa17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yisAl0gzsekZwlOU.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者@mshakhomirov</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/e9949856fda51269c6b289d621403dac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*o1bZzrK96OvQwiRC.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者@mshakhomirov</p></figure><ul class=""><li id="dffb" class="mg mh it mi b mj no ml np lh nq ll nr lp ns mq mr ms mt mu bi translated">订单批准后，您可能需要更新它。下面的 CURL 将订单更新为已创建或已批准状态。您不能更新状态为已完成的订单。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><ul class=""><li id="c59b" class="mg mh it mi b mj no ml np lh nq ll nr lp ns mq mr ms mt mu bi translated">最后一步是获取付款。转到 APEX 或点击“捕获”或使用 CURL 和之前批准的订单 ID:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="c128" class="pw-post-body-paragraph nb nc it mi b mj no ju nd ml np jx ne lh ny ng nh ll nz nj nk lp oa nm nn mq im bi translated"><strong class="mi iu">重要提示:</strong>订单必须得到客户的批准才能获得付款，这是最棘手的部分，通常需要一些服务器开发，但您可以简单地使用 APEX 创建一个虚拟买家(使用个人沙盒帐户)来测试它。</p><ul class=""><li id="fb0e" class="mg mh it mi b mj no ml np lh nq ll nr lp ns mq mr ms mt mu bi translated">现在您可以查看订单详情:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><h1 id="60f8" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">步骤 1:使用报告 API 从 PayPal 获取历史交易</h1><p id="4635" class="pw-post-body-paragraph nb nc it mi b mj mk ju nd ml mm jx ne lh nf ng nh ll ni nj nk lp nl nm nn mq im bi translated">当您的<strong class="mi iu">沙箱</strong>中最终有了一些完成的事务时，您会想要使用一个<strong class="mi iu">报告 API </strong>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="320b" class="pw-post-body-paragraph nb nc it mi b mj no ju nd ml np jx ne lh ny ng nh ll nz nj nk lp oa nm nn mq im bi translated">输出应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/3d327f4bdf24eabe64a1ee2b7e95ee01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ed6Tx8Stp69SXaOq.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者@mshakhomirov</p></figure><p id="c366" class="pw-post-body-paragraph nb nc it mi b mj no ju nd ml np jx ne lh ny ng nh ll nz nj nk lp oa nm nn mq im bi translated">这个 JSON 响应包含您需要的选定日期范围内的所有事务。接下来，您可能希望以编程方式运行这个命令，并将数据保存到云存储中，例如 AWS S3。这是一个“数据湖”步骤，旨在安全地存储您的数据，以便您可以在加载到数据仓库之前检查或更改它。这当然会在<strong class="mi iu">云存储</strong>和<strong class="mi iu">数据仓库</strong>中创建您的数据的副本，但是我建议这样做，以便您可以轻松检查任何数据加载错误。在存储桶上设置一个<strong class="mi iu">过期策略</strong>将在一定天数后清理云存储。</p><h1 id="a05b" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">步骤 2:用 AWS Lambda 创建一个无服务器 Node.js 应用程序，从 PayPal API 中提取数据</h1><p id="20ce" class="pw-post-body-paragraph nb nc it mi b mj mk ju nd ml mm jx ne lh nf ng nh ll ni nj nk lp nl nm nn mq im bi translated">您可能希望使用以下 Node.js 模块:</p><ul class=""><li id="e74f" class="mg mh it mi b mj no ml np lh nq ll nr lp ns mq mr ms mt mu bi translated"><strong class="mi iu"> axios </strong>向 PayPal API 发出 HTTP 请求</li><li id="7b80" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated"><strong class="mi iu">时刻</strong>处理日期时间数据和参数</li><li id="19b5" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">将数据保存到 S3 的 aws-sdk</li><li id="1d41" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">在本地测试你的 lambda</li></ul><p id="f270" class="pw-post-body-paragraph nb nc it mi b mj no ju nd ml np jx ne lh ny ng nh ll nz nj nk lp oa nm nn mq im bi translated">初始化一个新的 Node.js 应用程序，这样你就有了这样一个<code class="fe oi oj ok ol b">./package.json</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="b036" class="pw-post-body-paragraph nb nc it mi b mj no ju nd ml np jx ne lh ny ng nh ll nz nj nk lp oa nm nn mq im bi translated">您的应用程序目录如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/91af14c60ff2bcd297c0f71b2dc705f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/0*lUGpKt6QESADIfKO.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者@mshakhomirov</p></figure><ul class=""><li id="34fe" class="mg mh it mi b mj no ml np lh nq ll nr lp ns mq mr ms mt mu bi translated">使用<code class="fe oi oj ok ol b">./config.json</code>来分隔您的真实环境和临时环境。例如:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><ul class=""><li id="2fc7" class="mg mh it mi b mj no ml np lh nq ll nr lp ns mq mr ms mt mu bi translated">创建一个文件来配置您的 PayPal 访问令牌凭证，并将“Basic *”替换为 Base64 编码的 client_id 和 secret 的组合，即:您还可以从本教程开始时获得 access_token 的一个 CURL 请求中复制并粘贴这个 Base64 编码的字符串。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><ul class=""><li id="d2c4" class="mg mh it mi b mj no ml np lh nq ll nr lp ns mq mr ms mt mu bi translated">您可能希望将 Base64 编码的字符串<code class="fe oi oj ok ol b">clien_id:client_secret</code>传递给授权头。例如，如果您使用 Postman，您会发现您的 client_id 和 client_secret 值附加到标题中的文本“Basic”中，如下所示:<code class="fe oi oj ok ol b">"Authorization": "Basic QWNxd2xIYT.....</code>使用它来获得带有<strong class="mi iu"> OAuth2.0 </strong>的访问令牌，然后在您的 PayPal API 调用中使用。点击阅读更多相关信息<a class="ae lu" href="https://learning.postman.com/docs/sending-requests/authorization/" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="ba09" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">现在创建一个名为<code class="fe oi oj ok ol b">app.js</code>的文件:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><ul class=""><li id="8ed3" class="mg mh it mi b mj no ml np lh nq ll nr lp ns mq mr ms mt mu bi translated">现在，您需要创建一个名为<code class="fe oi oj ok ol b">processEvent</code>的函数来处理一个事件，该事件将触发该函数从 PayPal 提取交易数据。</li></ul><p id="4983" class="pw-post-body-paragraph nb nc it mi b mj no ju nd ml np jx ne lh ny ng nh ll nz nj nk lp oa nm nn mq im bi translated"><strong class="mi iu">最终解决方案</strong></p><h2 id="241d" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">检查<a class="ae lu" href="https://github.com/mshakhomirov/pipelinetools" rel="noopener ugc nofollow" target="_blank"> Github 库</a></h2><ul class=""><li id="5f7b" class="mg mh it mi b mj mk ml mm lh mn ll mo lp mp mq mr ms mt mu bi translated">如果交易请求太大，PayPal 将对输出进行分页。所以<code class="fe oi oj ok ol b">processEvent</code>会先估算大小，然后从 PayPal API 中逐页提取数据。</li><li id="4791" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">要在您的机器上本地测试和运行，请使用:<code class="fe oi oj ok ol b">npm i</code>，然后使用命令<code class="fe oi oj ok ol b">npm run test</code>。</li><li id="9e42" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">使用<code class="fe oi oj ok ol b"><a class="ae lu" href="https://github.com/mshakhomirov/pipelinetools/blob/master/api-connectors/stack/bq-paypal-revenue/deploy.sh" rel="noopener ugc nofollow" target="_blank"> ./deploy.sh</a></code>在 AWS 中部署您的 Lambda。</li><li id="4646" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">当 Lambda 部署到 AWS 并正在执行时，例如，由<strong class="mi iu"> Cloudwatch </strong>事件触发。AWS Cloudwatch 事件将使用计划每天触发 Lambda。</li><li id="5f89" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">Lambda 将从。/token_config.json 并通过 PayPal 认证</li><li id="7f10" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">循环查看所需的每份 PayPal 报告(中的表格。/config.json) Lambda 会将每批交易以 json 格式保存到 AWS S3 中。</li><li id="f430" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">这将为您的数据仓库中的一个表提供数据，也就是说，如果您将该文件命名为与您的数据仓库表相同的名称，它可以通过编程方式加载到相关的表中。因此另一个微服务可以从那里获得它(不包括在这个项目中)</li><li id="4482" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">您可以通过运行以下脚本在 lambda 部署时手动调用它(需要 AWS CLI):</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><ul class=""><li id="c168" class="mg mh it mi b mj no ml np lh nq ll nr lp ns mq mr ms mt mu bi translated"><code class="fe oi oj ok ol b">app.js</code></li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><h1 id="7a6f" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">项目结论</h1><p id="ca94" class="pw-post-body-paragraph nb nc it mi b mj mk ju nd ml mm jx ne lh nf ng nh ll ni nj nk lp nl nm nn mq im bi translated">传统的 ETL，代表提取、转换和加载，现在已经发展到 ELT。数据从源系统中提取出来，加载到数据仓库中，然后在数据仓库中进行转换。这个实时项目帮助您管理“E”部分，即从外部数据源提取数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/823b9445621834befe4ce32bc1d1558b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JZaG-0C7xddtyDRX.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者@mshakhomirov</p></figure><ul class=""><li id="29a7" class="mg mh it mi b mj no ml np lh nq ll nr lp ns mq mr ms mt mu bi translated">无论您是一家初创企业还是一家全球性企业，您都已经学会了如何使用无服务器从任意的数据源中提取数据。</li><li id="26e0" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">您已经学习了数据湖、数据仓库和解耦数据存储的概念。</li><li id="0c8f" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">您已经学习了如何使用 AWS Lambda 函数创建简单可靠的数据提取管道。</li><li id="5ebc" class="mg mh it mi b mj mv ml mw lh mx ll my lp mz mq mr ms mt mu bi translated">所有这些都提供了一个思路或模板，可以很容易地扩展并重用于将来可能需要的任何其他任意数据源。</li></ul><h1 id="c8d8" class="lv kz it bd la lw lx ly ld lz ma mb lg jz mc ka lk kc md kd lo kf me kg ls mf bi translated">有用的资源</h1><p id="add6" class="pw-post-body-paragraph nb nc it mi b mj mk ju nd ml mm jx ne lh nf ng nh ll ni nj nk lp nl nm nn mq im bi translated">[1]<a class="ae lu" href="https://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/free-tier-limits.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/AWS count billing/latest/about v2/free-tier-limits . html</a></p><p id="0aeb" class="pw-post-body-paragraph nb nc it mi b mj no ju nd ml np jx ne lh ny ng nh ll nz nj nk lp oa nm nn mq im bi translated">[2]https://aws.amazon.com/lambda/<a class="ae lu" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"/></p><p id="521e" class="pw-post-body-paragraph nb nc it mi b mj no ju nd ml np jx ne lh ny ng nh ll nz nj nk lp oa nm nn mq im bi translated">[3]https://aws.amazon.com/cli/<a class="ae lu" href="https://aws.amazon.com/cli/" rel="noopener ugc nofollow" target="_blank"/></p><p id="b7ac" class="pw-post-body-paragraph nb nc it mi b mj no ju nd ml np jx ne lh ny ng nh ll nz nj nk lp oa nm nn mq im bi translated"><a class="ae lu" href="https://developer.paypal.com/docs" rel="noopener ugc nofollow" target="_blank">https://developer.paypal.com/docs</a></p></div><div class="ab cl ou ov hx ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="im in io ip iq"><p id="e906" class="pw-post-body-paragraph nb nc it mi b mj no ju nd ml np jx ne lh ny ng nh ll nz nj nk lp oa nm nn mq im bi translated"><em class="oe">最初发表于</em><a class="ae lu" href="https://mydataschool.com/blog/extract-paypal-data-from-api/" rel="noopener ugc nofollow" target="_blank"><em class="oe">https://mydataschool.com</em></a><em class="oe">。</em></p></div></div>    
</body>
</html>