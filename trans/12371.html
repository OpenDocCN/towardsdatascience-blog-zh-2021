<html>
<head>
<title>Construct the Matrix interaction network based on the movie script</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于电影剧本构建矩阵互动网络</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/construct-the-matrix-interaction-network-based-on-the-movie-script-738b4fa9b46d?source=collection_archive---------15-----------------------#2021-12-16">https://towardsdatascience.com/construct-the-matrix-interaction-network-based-on-the-movie-script-738b4fa9b46d?source=collection_archive---------15-----------------------#2021-12-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c49a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">结合网页抓取、OCR 和实体识别来构建和分析 Neo4j 中的矩阵交互网络</h2></div><p id="c82e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">圣诞节即将来临，随之而来的是最新的《黑客帝国》电影。我想不出比对第一部《黑客帝国》电影进行网络分析更好的等到电影上映的方法了。</p><h2 id="ddec" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">议程</h2><p id="a877" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">这篇博文将介绍如何结合 web 抓取、OCR 和 NLP 技术来构建矩阵交互网络。</p><ul class=""><li id="4675" class="ma mb iq kh b ki kj kl km ko mc ks md kw me la mf mg mh mi bi translated">用硒刮矩阵 fandom 页面</li><li id="0580" class="ma mb iq kh b ki mj kl mk ko ml ks mm kw mn la mf mg mh mi bi translated">使用 PyTesseract 阅读黑客帝国电影脚本 PDF</li><li id="5f44" class="ma mb iq kh b ki mj kl mk ko ml ks mm kw mn la mf mg mh mi bi translated">使用空间的基于规则的匹配器提取每个场景中的角色</li><li id="e1ba" class="ma mb iq kh b ki mj kl mk ko ml ks mm kw mn la mf mg mh mi bi translated">构建并分析 Neo4j 中人物的共现网络</li></ul><p id="14e9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我已经根据《T2》哈利波特系列进行了类似的分析，这次我们将使用《黑客帝国》电影剧本。</p><p id="310a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">和往常一样，我准备了一个<a class="ae lb" href="https://github.com/tomasonjo/blogs/blob/master/matrix/MatrixNLP.ipynb" rel="noopener ugc nofollow" target="_blank">谷歌协作笔记本</a>，你可以用它来学习这篇文章中的例子。</p><h2 id="23b7" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">用硒刮矩阵 Fandom 页面</h2><p id="137f" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">我们将从抓取<a class="ae lb" href="https://matrix.fandom.com/wiki/Main_Page" rel="noopener ugc nofollow" target="_blank"> Matrix Fandom 页面</a>开始，获取电影中出现的角色列表。如前所述，我们将使用<a class="ae lb" href="https://selenium-python.readthedocs.io/" rel="noopener ugc nofollow" target="_blank"> Selenium 库</a>来实现这一点。fandom 页面的内容在 CC BY 4.0 许可下可用。</p><p id="b5dd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一步，我们将提取出第一部《黑客帝国》电影中出现的角色的名字和链接。</p><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="90dc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正因为可以，我们也会从人物的个人页面中提取详细信息。</p><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="5ef2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在继续之前，我们将把角色信息存储到 Neo4j 中。如果你使用的是 Colab 笔记本，那么最简单的方法就是创建一个免费的<a class="ae lb" href="https://neo4j.com/sandbox/" rel="noopener ugc nofollow" target="_blank"> Neo4j 沙箱</a>或者免费的<a class="ae lb" href="https://neo4j.com/cloud/aura/" rel="noopener ugc nofollow" target="_blank"> Aura 数据库实例</a>来存储结果。</p><p id="e195" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦你创建了沙盒或光环环境，只需将连接细节复制到笔记本中。</p><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="1f62" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在您已经定义了到 Neo4j 实例的连接，接下来您可以导入角色的信息。</p><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="f208" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了感受我们刚刚存储在 Neo4j 数据库中的信息，我准备了以下在 Neo4j Bloom 中制作的可视化。</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mv"><img src="../Images/355cd78b5025877fc7e9d5b90d9d6a3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZhxX61eGFGIOA-QshqNglQ.png"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">人物信息在 Neo4j Bloom 中的可视化。图片由作者提供。</p></figure><p id="974c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此时此刻，数据库中没有任何连接，只有孤独和孤立的节点。如果您愿意，您可以重构一些节点属性，比如将<strong class="kh ir">配偶</strong>重构为一个关系。然而，我们将跳过这一部分，继续根据电影剧本构建共现网络。</p><h2 id="e8a2" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">使用 PyTesseract 阅读黑客帝国电影脚本 PDF</h2><p id="0604" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">电影剧本可以在<a class="ae lb" href="https://www.dailyscript.com/" rel="noopener ugc nofollow" target="_blank">每日剧本网页</a>上以 PDF 格式获得。虽然没有明确的许可声明，但网页上说这些脚本可用于教育目的，所以我们可以开始了。</p><p id="3cfc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将使用<a class="ae lb" href="https://github.com/madmaze/pytesseract" rel="noopener ugc nofollow" target="_blank"> PyTesseract 库</a>将 PDF 转换成文本格式。</p><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="18f2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个过程大约需要 15 分钟，所以你可以利用这段时间休息一下，也许还可以伸伸腿。</p><p id="b5f9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在进入角色提取步骤之前，我们将执行一个简单的文本清理，并按场景分割脚本。</p><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="daa0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">既然我们已经预处理了文本，我们将继续识别在特定场景中出现的所有字符。既然我们已经知道粉丝收集过程中会出现哪些角色，我们将使用<a class="ae lb" href="https://spacy.io/usage/rule-based-matching" rel="noopener ugc nofollow" target="_blank"> SpaCy 的基于规则的匹配器</a>来识别角色。</p><p id="3a60" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">角色名可以以两种形式出现。首先，如果角色在说话，它的名字在文本中是大写的。第二种形式是有标题的版本，其中一个角色被其他人提到或在场景描述中提到。SpaCy 使得描述这两种模式变得非常容易。</p><p id="81cf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还将从模式定义中省略<strong class="kh ir">和</strong>两个字。例如，fandom 页面包含字符<strong class="kh ir">甲骨文</strong>。因此，我们将跳过单词<strong class="kh ir">和</strong>，只搜索<strong class="kh ir">甲骨文</strong>模式<strong class="kh ir">。</strong></p><p id="8188" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面的代码将构造 SpaCy 的 matcher 对象，用于下一步识别字符。</p><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="c9a7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们已经准备好了文本和实体匹配器。我们会对场景进行迭代，识别出里面出现的所有角色，一步到位直接把结果存入 Neo4j。</p><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="5164" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从电影脚本中提取信息并将输出存储到 Neo4j 中就是这么简单。</p><p id="6974" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们将继续本博客的网络分析部分。首先，我们将评估所有没有出现在任何场景中的角色。</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="f921" class="lc ld iq nh b gy nl nm l nn no">MATCH (n:Character) WHERE NOT (n)--()<br/>RETURN n.name AS character</span></pre><p id="6934" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="np">结果</em></p><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="2a49" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">12 个角色在任何一个场景中都没有被辨认出来。除了那个穿红衣服的女人，我不记得任何角色。可能她在文本中被称为红衣女子或类似的东西，所以我们的模式匹配器没有识别出她。当然，我们可以对模式进行微调，以包含这些类型的异常，但总的来说，主要角色似乎已经确定。</p><p id="3b04" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们将检查在大多数场景中出现的角色。</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="f8d5" class="lc ld iq nh b gy nl nm l nn no">MATCH (s:Scene)<br/>WITH count(s) as countOfScenes<br/>MATCH (n:Character)<br/>WITH  n.name AS character,<br/>      size((n)-[:IN_SCENE]-&gt;()) as scenes,<br/>      countOfScenes<br/>RETURN character,<br/>       scenes,<br/>       round(toFloat(scenes) / countOfScenes * 100, 2) AS scenePercentage<br/>ORDER BY scenes DESC<br/>LIMIT 5</span></pre><p id="e7b1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="np">结果</em></p><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="6090" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里没什么令人震惊的。尼欧出现在超过一半的场景中，其次是墨菲斯和崔妮蒂。只有埃米尔·埃夫林出人意料地从这份名单中消失了。</p><p id="e38d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以将同现事件定义为出现在同一场景中的一对人物。在这种情况下，共现也可以理解为一种相互作用。角色阿朵出现的场景越多，他们在电影中的互动就越多。</p><p id="99ca" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过执行下面的 Cypher 语句来评估哪些角色交互最多。</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="e33a" class="lc ld iq nh b gy nl nm l nn no">MATCH (n1:Character)-[:IN_SCENE]-&gt;()&lt;-[:IN_SCENE]-(n2:Character)<br/>WHERE id(n1) &lt; id(n2)<br/>RETURN n1.name AS character1,<br/>       n2.name AS character2,<br/>       count(*) AS count<br/>ORDER BY count DESC<br/>LIMIT 5</span></pre><p id="5b3c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结果</p><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="f1fb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">大多数互动发生在尼奥、墨菲斯、三一和坦克之间。如果你看过这部电影，这一切都是有道理的。</p><p id="9476" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们可以推断出字符之间的共现网络，并对其进行网络分析。我们将简单地计算一对角色之间的交互次数，并将信息存储为一个关系。</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="a59a" class="lc ld iq nh b gy nl nm l nn no">MATCH (n1:Character)-[:IN_SCENE]-&gt;()&lt;-[:IN_SCENE]-(n2:Character)<br/>WHERE id(n1) &lt; id(n2)<br/>WITH n1, n2, count(*) AS count<br/>MERGE p=(n1)-[r:INTERACTS]-(n2)<br/>SET r.weight = count<br/>RETURN p</span></pre><p id="1152" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="np">结果</em></p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nq"><img src="../Images/6e9411378111fbdd7672e33bbbb421bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VHRtgcOScmE33FoktEJanQ.png"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">矩阵共生网络。图片由作者提供。</p></figure><h2 id="b94a" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">图形数据科学图书馆</h2><p id="5631" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">Neo4j 具有一个<a class="ae lb" href="https://neo4j.com/docs/graph-data-science/current/" rel="noopener ugc nofollow" target="_blank">图形数据科学库</a>，其中有 50 多种图形算法，包括中心性、社区检测和节点嵌入类别。</p><p id="65f9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将使用 PageRank 来评估节点重要性，使用 Louvain 来确定推断的共现网络的社区结构。我们不是分别检查每个算法结果，而是存储结果，并构建一个网络可视化，以可视化节点重要性和社区结构。</p><p id="8b1f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们必须投影内存中的图形，以便能够在其上执行图形算法。请注意，我们将共现关系投影为无向关系。例如，如果 Neo 与 Trinity 互动，这直接暗示 Trinity 也与 Neo 互动。</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="4d6b" class="lc ld iq nh b gy nl nm l nn no">CALL gds.graph.create("matrix", "Character", <br/>  {INTERACTS: {orientation:"UNDIRECTED", properties:"weight"}})</span></pre><p id="b262" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以继续执行加权 PageRank 算法，并将结果存储回 Neo4j。</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="c0b6" class="lc ld iq nh b gy nl nm l nn no">CALL gds.pageRank.write("matrix", {relationshipWeightProperty:"weight", writeProperty:"pagerank"})</span></pre><p id="552f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们执行加权 Louvain 算法来推断社区结构，并将结果存储在数据库中。</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="e4e4" class="lc ld iq nh b gy nl nm l nn no">CALL gds.louvain.write("matrix", {relationshipWeightProperty:"weight", writeProperty:"louvain"})</span></pre><p id="bc65" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以使用 Neo4j Bloom 生成一个网络可视化，根据社区 id 为节点着色，并根据其 PageRank 得分计算节点大小。</p><p id="3f39" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">查看<a class="ae lb" href="https://neo4j.com/docs/bloom-user-guide/current/" rel="noopener ugc nofollow" target="_blank">官方文档</a>了解如何在 Neo4j Bloom 中开发基于规则的可视化。</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nr"><img src="../Images/46223006895b7bf0fcfbd3d807276947.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oxg7OgBpeYAOo0N5gKexEw.png"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">矩阵共生网络的网络可视化。节点的大小基于它们的 Pagerank 分数，颜色基于它们的社区。图片由作者提供。</p></figure><p id="6cb0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结果比我预期的要好。黄色团体是尼布甲尼撒帮，尼欧、崔妮蒂和墨菲斯是最重要的成员。紫色社区由母体代理人组成，他们是尼布甲尼撒团伙的敌人。我们必须引入某种时间线来观察塞弗是如何从一个好人变成倒戈加入黑暗面的。最后，橙色社区由神谕、女祭司和勺子男孩组成，他们帮助尼奥超越了现实。</p><h2 id="2775" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">结论</h2><p id="804e" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">我希望我们都同意，使用简单的假设作为共现交互可以产生令人难以置信的结果，可以帮助解释单一网络可视化中潜在的 150 页 PDF。所以今天就打开<a class="ae lb" href="https://neo4j.com/sandbox/" rel="noopener ugc nofollow" target="_blank"> Neo4j 沙盒</a>自己试试吧。如果你在数据管道中发现任何能产生更好或更准确结果的调整，请告诉我。</p><p id="0191" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">节日快乐！</p><p id="5a1d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">和往常一样，代码可以在<a class="ae lb" href="https://github.com/tomasonjo/blogs/blob/master/matrix/MatrixNLP.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p></div></div>    
</body>
</html>