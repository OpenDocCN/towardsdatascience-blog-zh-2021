<html>
<head>
<title>Optimize SQL Queries with CASE Expressions in Unexpected Ways</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以意想不到的方式使用CASE表达式优化SQL查询</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/optimize-sql-queries-with-case-expressions-in-unexpected-ways-52a8641814c5?source=collection_archive---------12-----------------------#2021-08-23">https://towardsdatascience.com/optimize-sql-queries-with-case-expressions-in-unexpected-ways-52a8641814c5?source=collection_archive---------12-----------------------#2021-08-23</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><h2 id="ed2a" class="ip iq ir bd b dl is it iu iv iw ix dk iy translated" aria-label="kicker paragraph">辅导的</h2><div class=""/><div class=""><h2 id="d57c" class="pw-subtitle-paragraph jx ja ir bd b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dk translated">是时候通过嵌套的Case表达式将您的SQL技能从一般提高到非凡了</h2></div><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj kp"><img src="../Images/97b586e0002293cb97aafc3ff4740e83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q_jAVkVjcP8imzfKKpo_Zg.jpeg"/></div></div><p class="lb lc gk gi gj ld le bd b be z dk translated">杰斯·斯洛顿，佩克斯</p></figure><blockquote class="lf lg lh"><p id="1906" class="li lj lk ll b lm ln kb lo lp lq ke lr ls lt lu lv lw lx ly lz ma mb mc md me ik bi translated">是那些意想不到的事情改变了我们的生活。—珊达·瑞姆斯</p></blockquote><p id="d380" class="pw-post-body-paragraph li lj ir ll b lm ln kb lo lp lq ke lr mf lt lu lv mg lx ly lz mh mb mc md me ik bi translated">我是<strong class="ll jb">黑人</strong>，我在一个有<strong class="ll jb">帮派</strong>的街区长大。和我一起长大的大多数朋友都死了，在监狱里，嗑药了，或者<strong class="ll jb">只是卡住了</strong>。他们一直将我就读的学校排在最后一名。现在，我正在给一群像我一样的数据极客写技术文章，他们发现生活是一个有待解决的数据问题的未解之谜。<strong class="ll jb">真是意想不到。</strong></p><p id="debc" class="pw-post-body-paragraph li lj ir ll b lm ln kb lo lp lq ke lr mf lt lu lv mg lx ly lz mh mb mc md me ik bi translated">如果你读过我的其他教程，你会意识到现在我把编程看作是一种艺术努力。挫折中的冒险。每条码线都有自己的<strong class="ll jb">色相</strong>，美感和质感。它反映了<strong class="ll jb">在<strong class="ll jb">痛苦的</strong>检查或反思的几个小时里对编码器的一个</strong>贴心的选择。编码员在<strong class="ll jb">画布</strong>上描绘她的解决方案<strong class="ll jb">宽广</strong>，反映了她的视角和经验。在写这些教程时，我避开了所有技术复杂性的伪装。真是意想不到。我不会使用过于复杂的术语或例子。我喜欢分享知识，所以我尽量使用通俗易懂的语言。因此，像其他教程一样，本教程向编码人员的<strong class="ll jb">库</strong>添加了一个工具。</p><p id="1dd2" class="pw-post-body-paragraph li lj ir ll b lm ln kb lo lp lq ke lr mf lt lu lv mg lx ly lz mh mb mc md me ik bi translated">储存库是大量储存贵重物品的<strong class="ll jb">百宝箱</strong>。<strong class="ll jb">案例表达式</strong>应该是SQL编码人员百宝箱的一部分。所以，我正在写一系列关于以<strong class="ll jb">意想不到的</strong>方式使用Case表达式的文章。这是<strong class="ll jb">系列的第二部</strong>:</p><ul class=""><li id="b21f" class="mi mj ir ll b lm ln lp lq mf mk mg ml mh mm me mn mo mp mq bi translated">第一部分:<a class="ae mr" rel="noopener" target="_blank" href="/sql-window-functions-64c26bd643fd"> <strong class="ll jb">案例</strong>表达式和窗口函数</a></li><li id="78c0" class="mi mj ir ll b lm ms lp mt mf mu mg mv mh mw me mn mo mp mq bi translated">第二部分:<strong class="ll jb">嵌套案例</strong>表达式</li><li id="a990" class="mi mj ir ll b lm ms lp mt mf mu mg mv mh mw me mn mo mp mq bi translated">第3部分:子查询和<strong class="ll jb">案例</strong>表达式(<strong class="ll jb"> <em class="lk">即将推出</em> </strong>)</li></ul><p id="ae3f" class="pw-post-body-paragraph li lj ir ll b lm ln kb lo lp lq ke lr mf lt lu lv mg lx ly lz mh mb mc md me ik bi translated">这些方法可以让你从平庸走向卓越。所以，系好安全带，享受<strong class="ll jb">旅程</strong>。</p><h1 id="00d9" class="mx my ir bd mz na nb nc nd ne nf ng nh kg ni kh nj kj nk kk nl km nm kn nn no bi translated">嵌套Case表达式</h1><p id="f076" class="pw-post-body-paragraph li lj ir ll b lm np kb lo lp nq ke lr mf nr lu lv mg ns ly lz mh nt mc md me ik bi translated"><strong class="ll jb">嵌套CASE </strong>表达式扩展了<strong class="ll jb"> CASE </strong>表达式的功能和精度。<strong class="ll jb">案例</strong>表达式具有以下特征:</p><ul class=""><li id="adf3" class="mi mj ir ll b lm ln lp lq mf mk mg ml mh mm me mn mo mp mq bi translated"><strong class="ll jb"> CASE </strong>表达式遍历所有条件，并在满足第一个条件时返回值(类似于if-then-else语句)。所以，一旦条件为真，它将停止读取并返回值。</li><li id="4e7f" class="mi mj ir ll b lm ms lp mt mf mu mg mv mh mw me mn mo mp mq bi translated"><strong class="ll jb"> CASE </strong>允许你显示一列中实际值的替代值。</li><li id="438d" class="mi mj ir ll b lm ms lp mt mf mu mg mv mh mw me mn mo mp mq bi translated"><strong class="ll jb"> CASE </strong>的一个常见用法是用更可读的值替换代码或缩写。</li><li id="4ae1" class="mi mj ir ll b lm ms lp mt mf mu mg mv mh mw me mn mo mp mq bi translated">一个<strong class="ll jb">案例</strong>可以用计算好的指标构建列。</li></ul><p id="6fa4" class="pw-post-body-paragraph li lj ir ll b lm ln kb lo lp lq ke lr mf lt lu lv mg lx ly lz mh mb mc md me ik bi translated">或者，<strong class="ll jb">嵌套CASE </strong>表达式具有以下特征:</p><ul class=""><li id="ae85" class="mi mj ir ll b lm ln lp lq mf mk mg ml mh mm me mn mo mp mq bi translated"><strong class="ll jb">嵌套案例</strong>包含了<strong class="ll jb">案例</strong>的所有特征。</li><li id="22f7" class="mi mj ir ll b lm ms lp mt mf mu mg mv mh mw me mn mo mp mq bi translated">使用<strong class="ll jb">嵌套案例，</strong>您可以将数据分成子组或段。不同的逻辑可以应用于每个子组。</li></ul><h1 id="6d3c" class="mx my ir bd mz na nb nc nd ne nf ng nh kg ni kh nj kj nk kk nl km nm kn nn no bi translated"><strong class="ak">嵌套CASE表达式语法</strong></h1><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj nu"><img src="../Images/76c69d7bd79d7762d8752bbe676e1e8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w4EqdAy9yfh-SKAU_2qL4w.jpeg"/></div></div><p class="lb lc gk gi gj ld le bd b be z dk translated">作者，大小写语法</p></figure><p id="4e16" class="pw-post-body-paragraph li lj ir ll b lm ln kb lo lp lq ke lr mf lt lu lv mg lx ly lz mh mb mc md me ik bi translated">在<strong class="ll jb">嵌套CASE </strong>表达式中，外层语句执行，直到满足一个条件。一旦满足条件，内部的<strong class="ll jb"> CASE </strong>表达式就会执行并返回一个结果。如果外部语句中不满足条件，<strong class="ll jb"> CASE </strong>表达式<strong class="ll jb"> </strong>返回<strong class="ll jb"> ELSE </strong>语句中的值。</p><h2 id="159f" class="nv my ir bd mz nw nx dn nd ny nz dp nh mf oa ob nj mg oc od nl mh oe of nn ix bi translated">使用案例</h2><p id="8a32" class="pw-post-body-paragraph li lj ir ll b lm np kb lo lp nq ke lr mf nr lu lv mg ns ly lz mh nt mc md me ik bi translated">我们虚构的公司在美国有四个分部。该公司希望在每个部门测试不同的定价策略。活动经理要求为每个部门提供一份符合以下要求的数据文件:</p><ul class=""><li id="02bf" class="mi mj ir ll b lm ln lp lq mf mk mg ml mh mm me mn mo mp mq bi translated"><strong class="ll jb">东</strong>:如果顾客是F <strong class="ll jb">女</strong>住在<strong class="ll jb">纽约</strong>或<strong class="ll jb">新泽西</strong>的话，顾客会收到19.99美元的产品报价。留在北方的其他客户获得29.99美元的标准报价。</li><li id="117a" class="mi mj ir ll b lm ms lp mt mf mu mg mv mh mw me mn mo mp mq bi translated"><strong class="ll jb">南</strong>:如果顾客是住在<strong class="ll jb">佛罗里达州</strong>或<strong class="ll jb">佐治亚州</strong>的M <strong class="ll jb"> ale </strong>的顾客，顾客会收到25.99美元的产品报价。留在北方的其他客户获得35.99美元的标准报价。</li><li id="ff08" class="mi mj ir ll b lm ms lp mt mf mu mg mv mh mw me mn mo mp mq bi translated"><strong class="ll jb">西</strong>:如果顾客是<strong class="ll jb">女</strong>住在<strong class="ll jb">加州</strong>或内华达州<strong class="ll jb">的话，顾客会收到29.99美元的产品报价。留在北方的其他客户收到39.99美元的标准报价。</strong></li><li id="4cbb" class="mi mj ir ll b lm ms lp mt mf mu mg mv mh mw me mn mo mp mq bi translated"><strong class="ll jb">中西部</strong>:西部:如果顾客是<strong class="ll jb">男</strong>住在<strong class="ll jb">爱荷华</strong>或<strong class="ll jb">南达科他，顾客会收到21.99美元的产品报价。留在北方的其他客户收到31.99美元的标准报价。</strong></li></ul><h2 id="4553" class="nv my ir bd mz nw nx dn nd ny nz dp nh mf oa ob nj mg oc od nl mh oe of nn ix bi translated">数据:动手操作</h2><p id="4d63" class="pw-post-body-paragraph li lj ir ll b lm np kb lo lp nq ke lr mf nr lu lv mg ns ly lz mh nt mc md me ik bi translated">请访问<a class="ae mr" href="https://github.com/bensondavies/DataFiles.git" rel="noopener ugc nofollow" target="_blank"> Github </a>或<a class="ae mr" href="https://drive.google.com/drive/folders/1TBR3UqqYjpWwxSIZY79hzFE06flPZ_S3?usp=sharing" rel="noopener ugc nofollow" target="_blank"> Google Drive </a>上的数据和SQL代码，以便跟进。我使用Postgres数据库构建了这个解决方案。因此，您需要将数据上传到Postgres数据库。或者，您可以更改语法并使用另一个数据库，如MySQL、Redshift、Oracle或SQL Server。</p><h2 id="6a35" class="nv my ir bd mz nw nx dn nd ny nz dp nh mf oa ob nj mg oc od nl mh oe of nn ix bi translated">解决方案</h2><p id="7160" class="pw-post-body-paragraph li lj ir ll b lm np kb lo lp nq ke lr mf nr lu lv mg ns ly lz mh nt mc md me ik bi translated">当我<strong class="ll jb">没有经验</strong>的时候，我会查看这些类型的<strong class="ll jb">需求</strong>和<strong class="ll jb">以我的</strong>方式找到解决方案。我可以想象使用单独的<code class="fe og oh oi oj b">WHERE</code>子句分割数据，然后使用一系列的<code class="fe og oh oi oj b">UNION</code>查询合并数据。最后，通过<code class="fe og oh oi oj b">CREATE</code>和<code class="fe og oh oi oj b">UPDATE</code>表格陈述得出解决方案。我会为我花了两天时间来完成“挑战”而感到骄傲。作为一名伟大的SQL战士，我杀死了另一个敌人。我觉得我的努力是英勇的，值得为T21鼓掌。回想起来，他们既不是<strong class="ll jb">也不是</strong>。只是因为缺乏经验，所以缺乏想象力或创造力。下面显示的<strong class="ll jb">更好的解决方案</strong>使用了一个<strong class="ll jb">嵌套CASE </strong>表达式。</p><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj ok"><img src="../Images/671daa5c88c4e4b36fd0a1c728908ff5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DtUerBnv4MB853Z-BjHFlA.jpeg"/></div></div><p class="lb lc gk gi gj ld le bd b be z dk translated">作者，嵌套Case表达式解决方案</p></figure><p id="3531" class="pw-post-body-paragraph li lj ir ll b lm ln kb lo lp lq ke lr mf lt lu lv mg lx ly lz mh mb mc md me ik bi translated"><strong class="ll jb">嵌套CASE </strong>表达式将数据分割成多个部分。一旦细分完成，我们将根据州和性别应用单独的业务需求。结果是一个<code class="fe og oh oi oj b">promotion_price</code>栏目在一两个小时内完成。没有斗争，不眠之夜或争论。真是意想不到。</p><p id="472b" class="pw-post-body-paragraph li lj ir ll b lm ln kb lo lp lq ke lr mf lt lu lv mg lx ly lz mh mb mc md me ik bi translated">最后，获得优秀SQL技能的途径包括掌握<strong class="ll jb"> CASE </strong>表达式以及通用表表达式(CTE的)、窗口函数和派生表。我将在接下来的教程中分享更多关于这些的内容。不断学习，不断成长，不断分享。那是意料之中的。</p><h2 id="401b" class="nv my ir bd mz nw nx dn nd ny nz dp nh mf oa ob nj mg oc od nl mh oe of nn ix bi translated">如果你喜欢这篇文章，这里有一篇你可能会喜欢的系列文章:</h2><div class="ol om gq gs on oo"><a rel="noopener follow" target="_blank" href="/sql-window-functions-64c26bd643fd"><div class="op ab fp"><div class="oq ab or cl cj os"><h2 class="bd jb gz z fq ot fs ft ou fv fx ja bi translated">SQL嵌套窗口函数</h2><div class="ov l"><h3 class="bd b gz z fq ot fs ft ou fv fx dk translated">嵌套的Case表达式:无限可能</h3></div><div class="ow l"><p class="bd b dl z fq ot fs ft ou fv fx dk translated">towardsdatascience.com</p></div></div><div class="ox l"><div class="oy l oz pa pb ox pc kz oo"/></div></div></a></div><p id="f27b" class="pw-post-body-paragraph li lj ir ll b lm ln kb lo lp lq ke lr mf lt lu lv mg lx ly lz mh mb mc md me ik bi translated"><strong class="ll jb"> <em class="lk">分享的灵感</em> </strong> <em class="lk">:每次分享的教训，都让我想起朱利叶斯·邓肯先生。我记得第一天</em><strong class="ll jb"><em class="lk"/></strong><em class="lk">我遇见了他。穿着</em> <strong class="ll jb"> <em class="lk">白大褂</em> </strong> <em class="lk">朝我们家门口走来，我以为他是医生。相反，他是我见过的</em><strong class="ll jb"><em class="lk"/></strong><em class="lk">和</em> <strong class="ll jb"> <em class="lk">最伟大的人</em> </strong> <em class="lk">。为了帮助单身母亲，他接受了低于成本的工作。他慷慨地分享他的时间、信仰和资源。对他来说，支付大学课本或以其他方式帮助是很平常的事。当他去世时，排队致敬的队伍持续了一个多小时。他是一个普通的</em> <strong class="ll jb"> <em class="lk">英雄</em> </strong> <em class="lk">。</em><strong class="ll jb"><em class="lk"/></strong><em class="lk"/><strong class="ll jb"><em class="lk">黑暗</em> </strong> <em class="lk">。不断分享并激励他人变得比他们想象的更伟大。</em></p><p id="c2eb" class="pw-post-body-paragraph li lj ir ll b lm ln kb lo lp lq ke lr mf lt lu lv mg lx ly lz mh mb mc md me ik bi translated">[1] Chris Fehily，SQL的《可视化入门指南》(2008年)。</p></div></div>    
</body>
</html>