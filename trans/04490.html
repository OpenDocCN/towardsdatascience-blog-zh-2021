<html>
<head>
<title>Extract Tables from PDF file in a single line of Python Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用一行Python代码从PDF文件中提取表格</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/extract-tables-from-pdf-file-in-a-single-line-of-python-code-5b572cd9fbe5?source=collection_archive---------9-----------------------#2021-04-17">https://towardsdatascience.com/extract-tables-from-pdf-file-in-a-single-line-of-python-code-5b572cd9fbe5?source=collection_archive---------9-----------------------#2021-04-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="17d7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用Camelot从pdf提取表格并将其转换为Pandas数据框架</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/45eb8dd3ab2650b767c386f127860977.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ciaS2KoaHIx8F2vsa6Oxfg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=5000691" rel="noopener ugc nofollow" target="_blank">皮克斯拜</a>的<a class="ae ky" href="https://pixabay.com/users/megan_rexazin-6742250/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=5000691" rel="noopener ugc nofollow" target="_blank">梅根·雷扎辛</a>拍摄</p></figure><p id="134b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据科学中的一个标准原则是，更多数据的存在会导致训练更好的模型。数据可以以任何格式呈现，数据收集和数据准备是模型开发流程的重要组成部分。任何案例研究所需的数据都可以以任何格式呈现，数据科学家的任务是将数据转换成所需的格式，以继续进行数据预处理和管道中的其他组件。</p><p id="7001" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">许多结构化/半结构化或非结构化数据可以在基于文本的PDF文档中以表格格式和图像格式呈现。开发定制的表提取模型需要大量的时间和精力。在本文中，我们将讨论如何使用开源库Camelot，仅用一行Python代码从PDF文档中提取所有可用的表格。</p><h1 id="e6f7" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">卡梅洛特是什么？</h1><p id="0bdd" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Camelot是一个开源的Python库，使开发人员能够从PDF文档中提取所有表格，并将其转换为Pandas Dataframe格式。提取的表格还可以以结构化形式导出，如CSV、JSON、Excel或其他格式，并可用于建模。</p><p id="b36e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Camelot有一个限制，因为它只能处理基于文本的pdf，而不能处理扫描的文档。</p><h1 id="0109" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">卡梅洛特是如何运作的？</h1><p id="621f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Camelot使用两种表格解析技术，即Stream和Lattice，从PDF文档中提取表格。人们可以在两种表解析技术之间进行选择。</p><h2 id="d363" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">流:</h2><p id="82f6" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Stream是一种解析技术，它使用PDFMiner的功能根据空白或边距将字符分组到单词或句子中。流解析技术就像一种基于猜测的技术。</p><h2 id="5684" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">晶格:</h2><p id="7cdc" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Lattice是另一种解析技术，它不依赖于猜测，而是找到表格中的水平线和垂直线来解析PDF文档中的多个表格。Lattice只能解析单元格之间有分界线的表格。在PDF文档中查找表格的格子算法步骤是:</p><ol class=""><li id="4267" class="ne nf it lb b lc ld lf lg li ng lm nh lq ni lu nj nk nl nm bi translated">使用Ghostscript将PDF文档转换为图像。</li><li id="3025" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">应用基于OpenCV的形态学变换来获得转换图像中表格的水平和垂直线段。</li><li id="ed09" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">然后，通过对线段(从点2开始)和表格像素强度进行“与”运算来检测线交点。</li><li id="23db" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">通过取线段(从点2开始)和它们的像素强度的或来检测表格边界线。</li><li id="2aa9" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">通过使用线交点和线段来检测跨越单元或合并单元。</li><li id="2567" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">然后，由于图像和PDF中的尺寸可能不同，检测到的表格的线段和边界线被缩放并映射到PDF文档。</li><li id="1262" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">将表格的线段和边界线放置在适当的(x，y)坐标中后，在表格的像元上找到的单词将被检测并映射到数据框。</li></ol><blockquote class="ns nt nu"><p id="5424" class="kz la nv lb b lc ld ju le lf lg jx lh nw lj lk ll nx ln lo lp ny lr ls lt lu im bi translated">要可视化上述每个步骤，请遵循Camelot的<a class="ae ky" href="https://camelot-py.readthedocs.io/en/master/user/advanced.html" rel="noopener ugc nofollow" target="_blank">高级使用文档页面</a>。</p></blockquote><h1 id="8fc0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">安装:</h1><p id="844a" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">可以使用以下命令从PyPl安装Camelot和Ghostscript:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="0740" class="ms lw it oa b gy oe of l og oh"><strong class="oa iu">!pip install "camelot-py[cv]"<br/>!apt install python3-tk ghostscript</strong></span></pre><p id="e463" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装后，可以使用以下方式导入Camelot:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="677a" class="ms lw it oa b gy oe of l og oh"><strong class="oa iu">import camelot</strong></span></pre><h1 id="6901" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">用法:</h1><p id="d6d7" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">导入必要的模块后，使用<code class="fe oi oj ok oa b"><strong class="lb iu">camelot.read_pdf()</strong></code> <strong class="lb iu"> </strong>功能读取PDF文件。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="ed94" class="ms lw it oa b gy oe of l og oh"><strong class="oa iu">tables = camelot.read_pdf('table.pdf')</strong></span></pre><p id="645e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，Camelot只解析pdf文档的第一页，要解析文档多页中的表格，请使用<code class="fe oi oj ok oa b"><strong class="lb iu">read_pdf </strong></code>函数中的<code class="fe oi oj ok oa b"><strong class="lb iu">pages </strong></code>参数。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="645b" class="ms lw it oa b gy oe of l og oh"><strong class="oa iu"># pass comma seperated page numbers or page ranges<br/>tables = camelot.read_pdf('table.pdf', pages='1,2,3,5-7,8')</strong></span></pre><p id="b556" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Camelot还可以从受密码保护的PDF文档中提取表格，只需绕过所需的密码。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="d805" class="ms lw it oa b gy oe of l og oh"><strong class="oa iu">tables = camelot.read_pdf('table.pdf', password='*******')</strong></span></pre><p id="0bfc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe oi oj ok oa b"><strong class="lb iu">camelot.read_pdf</strong></code> <strong class="lb iu"> </strong>是唯一的一行Python代码，需要从PDF文件中提取所有表格。现在，所有的表都以Tablelist格式提取，并可以通过其索引进行访问。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="edd5" class="ms lw it oa b gy oe of l og oh"><strong class="oa iu">#Access the ith table as Pandas Data frame<br/>tables[i].df</strong></span></pre><p id="de50" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要将表格导出为所需格式，可以使用<code class="fe oi oj ok oa b"><strong class="lb iu">camelot.export() </strong></code>功能，并使用参数<code class="fe oi oj ok oa b"><strong class="lb iu">f=’csv’</strong></code>、<code class="fe oi oj ok oa b"><strong class="lb iu">f=’excel’</strong></code>、<code class="fe oi oj ok oa b"><strong class="lb iu">f=’html’</strong></code>或<code class="fe oi oj ok oa b"><strong class="lb iu">f=’sqlite’</strong></code>、<strong class="lb iu">、</strong>。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="0182" class="ms lw it oa b gy oe of l og oh"><strong class="oa iu">tables.export('name.csv', f='csv')</strong></span></pre><p id="cccf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">获取关于数据提取情况的解析报告或指标报告</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="efd9" class="ms lw it oa b gy oe of l og oh"><strong class="oa iu">tables[i].parsing_report</strong></span><span id="acc1" class="ms lw it oa b gy ol of l og oh"><strong class="oa iu"># Output: </strong><br/>{'accuracy': 99.27, 'order': 1, 'page': 1, 'whitespace': 13.89}</span></pre><h2 id="2f37" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">代码:</h2><blockquote class="ns nt nu"><p id="34e2" class="kz la nv lb b lc ld ju le lf lg jx lh nw lj lk ll nx ln lo lp ny lr ls lt lu im bi translated">下图中使用的PDF文档是从<a class="ae ky" href="https://www.w3.org/WAI/WCAG20/Techniques/working-examples/PDF20/table.pdf" rel="noopener ugc nofollow" target="_blank">表</a>、<a class="ae ky" href="https://s16458.pcdn.co/wp-content/uploads/2017/01/sample1.pdf" rel="noopener ugc nofollow" target="_blank">表1 </a>下载的。</p></blockquote><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><h1 id="f2ec" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论:</h1><p id="7226" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在本文中，我们讨论了如何从PDF文档中提取表格，并将其转换为Pandas Dataframe，以便进一步用于建模。有各种开源库，包括Tabula、pdftables、pdf-table-extract、pdfplumber，它们提供了与Camelot类似的功能。</p><p id="f599" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">卡梅洛特比它的替代品更好，阅读<a class="ae ky" href="https://github.com/camelot-dev/camelot/wiki/Comparison-with-other-PDF-Table-Extraction-libraries-and-tools" rel="noopener ugc nofollow" target="_blank">这篇文章</a>来比较卡梅洛特和它的竞争对手的图书馆的结果。</p><h1 id="2bfb" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">参考资料:</h1><p id="8465" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">[1]卡梅洛特文献:【https://camelot-py.readthedocs.io/en/master/ T2】</p><blockquote class="oo"><p id="a28e" class="op oq it bd or os ot ou ov ow ox lu dk translated">感谢您的阅读</p></blockquote></div></div>    
</body>
</html>