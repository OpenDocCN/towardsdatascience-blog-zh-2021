<html>
<head>
<title>Data Analysis at Its Finest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">最佳数据分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-analysis-at-its-finest-69b8624ae988?source=collection_archive---------30-----------------------#2021-03-25">https://towardsdatascience.com/data-analysis-at-its-finest-69b8624ae988?source=collection_archive---------30-----------------------#2021-03-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a113" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个能让你更喜欢R的例子</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/14e8bb060ebc4b11ccfcd79a22bdf47a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TKmwsvjO1-aN-qwFSJt4Mw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@americanheritagechocolate?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">美国传统巧克力</a>在<a class="ae ky" href="https://unsplash.com/s/photos/finest?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="abc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python和R是数据科学生态系统中的主流语言。它们都提供了大量的库来执行有效的数据争论和分析。</p><p id="cc64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">说到数据分析，熊猫一直是我的首选。然而，我觉得我的一些偏好可能会因为R包的出色功能而改变。</p><p id="1262" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将使用R包完成一个稍微复杂的任务。我会一步步讲解，让每一步的操作都清晰明了。最后，您将看到每个步骤是如何组合在一起，在一大步中完成任务的。</p><p id="589b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">值得注意的是，同样的操作也可以在熊猫身上进行。事实上，我也将提供熊猫代码，这样你就有机会做一个比较。</p><p id="4caa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用Kaggle上<a class="ae ky" href="https://www.kaggle.com/shivamb/netflix-shows" rel="noopener ugc nofollow" target="_blank">网飞</a>数据集的一部分。我们从导入库和读取数据集开始。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d8bd" class="ma mb it lw b gy mc md l me mf">library(data.table)<br/>library(stringr)</span><span id="ec1d" class="ma mb it lw b gy mg md l me mf">netflix &lt;- fread(<br/>   "~/Downloads/netflix_titles.csv", select = c("type", "title", <br/>   "date_added", "duration", "release_year", "country")<br/>)</span><span id="fa95" class="ma mb it lw b gy mg md l me mf">head(netflix)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/8aa7b779d24ca1f6236132f0c05a3753.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ASYaCT09sR4NQhfxyupCDg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="2881" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该数据集包含网飞电视节目和电影的一些特征，例如类型、长度、国家等等。</p><p id="e1d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">任务是找到电影中平均电影长度排名前5的国家。作为一个附加条件，我想筛选出少于10个标题的国家。</p><p id="daf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一步是创建一个包含电影长度(以分钟为单位)的列。我们可以通过从duration列中提取数字部分来获得它。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="94ad" class="ma mb it lw b gy mc md l me mf">netflix$duration_qty &lt;- as.numeric(str_split_fixed(netflix$duration, " ", 2)[,1])</span></pre><p id="2c04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用stringr包的str_split_fixed函数来拆分空格字符处的值。然后我们用as.numeric函数将第一部分转换成一个数字。</p><p id="1d87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是过滤电影标题，因为我们对电视节目不感兴趣。使用data.table包进行过滤可以按如下方式进行:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="e572" class="ma mb it lw b gy mc md l me mf">netflix[type == "Movie"]</span></pre><p id="b1d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">平均电影长度可以按如下方式计算:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="9af9" class="ma mb it lw b gy mc md l me mf">netflix[<br/>   type == "Movie", <br/>   .(avg_length = mean(duration_qty)<br/>]</span></pre><p id="c55b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，我们希望分别计算国家/地区列中每个类别的平均电影长度。此任务涉及“分组依据”操作。我们可以使用by参数来实现它。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8ca1" class="ma mb it lw b gy mc md l me mf">netflix[<br/>   type == "Movie", <br/>   .(avg_length = mean(duration_qty), <br/>   by = "country"<br/>]</span></pre><p id="35c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们想过滤掉电影数量少于10部的国家，所以我们需要一个变量来保存数量信息。这可以通过添加count (N)函数来轻松实现。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8591" class="ma mb it lw b gy mc md l me mf">netflix[<br/>   type == "Movie", <br/>   .(avg_length = mean(duration_qty, .N), <br/>   by = "country"<br/>]</span></pre><p id="357d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该任务的剩余部分是:</p><ul class=""><li id="368d" class="mi mj it lb b lc ld lf lg li mk lm ml lq mm lu mn mo mp mq bi translated">过滤少于10部电影的国家</li><li id="68c1" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated">按照电影平均长度降序排列国家</li><li id="723d" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated">选择前5个</li></ul><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="160e" class="ma mb it lw b gy mc md l me mf">[N&gt;10]                                       # filter<br/>[order(avg_length, decreasing = TRUE)]       # sort<br/>[1:5]                                        # select</span></pre></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><p id="eeaf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以将每个步骤合并到一个操作中。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a4d1" class="ma mb it lw b gy mc md l me mf">netflix[, duration_qty := as.numeric(str_split_fixed(netflix$duration, " ", 2)[,1])][type == "Movie", .(avg_length = mean(duration_qty), .N), by='country'][N&gt;10][order(avg_length, decreasing = TRUE)][1:5]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/b06341597a4412c3942bff3798eeb2e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ttfzp9qBT3s9RNmaExMbKA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="78b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是如何用pandas完成相同的任务(首先需要导入Pandas并将数据集读入dataframe)。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="3262" class="ma mb it lw b gy mc md l me mf">netflix["duration_qty"] = netflix.duration.str.split(" ")\<br/>.str.get(0).astype('int')</span><span id="d08f" class="ma mb it lw b gy mg md l me mf">netflix[netflix["type"] == "Movie"].groupby("country")\<br/>.agg(avg_length = ("duration_qty", "mean"), <br/>     N = ('duration_qty', 'count'))\<br/>.query("N &gt; 10")\<br/>.sort_values(by="avg_length", ascending=False)[:5]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/cb35970e949b033c2dd16a2e8b2526fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QJFEpMhlmh6eXdZ-QRuj4A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h2 id="0b19" class="ma mb it bd nd ne nf dn ng nh ni dp nj li nk nl nm lm nn no np lq nq nr ns nt bi translated">结论</h2><p id="d7bd" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">Pandas和data.table库都允许链接多个操作。因此，我们可以将一个复杂的任务分解成几个小步骤，然后将它们组合起来。这种模块化还提供了很大的灵活性，我认为这对于某些数据争论任务非常重要。</p><p id="b5ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两个库都非常强大，能够成功完成高度复杂的操作。因此，您可以选择其中任何一个来进行数据争论和分析过程。</p><p id="03ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管我使用Pandas的次数更多，但data.table的语法似乎更吸引我。</p><p id="23fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>