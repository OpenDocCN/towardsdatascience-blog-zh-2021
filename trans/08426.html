<html>
<head>
<title>Analysis of Variance — ANOVA with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python进行方差分析——ANOVA</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/analysis-of-variance-anova-8dc889d2fc3a?source=collection_archive---------19-----------------------#2021-08-03">https://towardsdatascience.com/analysis-of-variance-anova-8dc889d2fc3a?source=collection_archive---------19-----------------------#2021-08-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3577" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用Python实现大学统计</h2></div><h1 id="7e88" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">介绍</h1><p id="5986" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在一系列的每周文章中，我将会涉及一些重要的统计学主题。</p><p id="1642" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">目标是使用Python来帮助我们获得对复杂概念的直觉，从经验上测试理论证明，或者从零开始构建算法。在本系列中，您将会看到涵盖随机变量、抽样分布、置信区间、显著性检验等主题的文章。</p><p id="6ec5" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">在每篇文章的最后，你可以找到练习来测试你的知识。解决方案将在下周的文章中分享。</p><p id="4b7f" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">迄今发表的文章:</p><ul class=""><li id="fbec" class="mb mc it lc b ld lw lg lx lj md ln me lr mf lv mg mh mi mj bi translated"><a class="ae mk" rel="noopener" target="_blank" href="/bernoulli-and-binomial-random-variables-d0698288dd36">伯努利和二项随机变量与Python </a></li><li id="a180" class="mb mc it lc b ld ml lg mm lj mn ln mo lr mp lv mg mh mi mj bi translated"><a class="ae mk" rel="noopener" target="_blank" href="/geometric-and-poisson-random-variables-with-python-e5dcb63d6b55">用Python从二项式到几何和泊松随机变量</a></li><li id="b1df" class="mb mc it lc b ld ml lg mm lj mn ln mo lr mp lv mg mh mi mj bi translated"><a class="ae mk" rel="noopener" target="_blank" href="/sampling-distributions-with-python-f5a5f268f636">用Python实现样本比例的抽样分布</a></li><li id="83d3" class="mb mc it lc b ld ml lg mm lj mn ln mo lr mp lv mg mh mi mj bi translated"><a class="ae mk" rel="noopener" target="_blank" href="/confidence-intervals-with-python-bfa28ebb81c">Python的置信区间</a></li><li id="5eab" class="mb mc it lc b ld ml lg mm lj mn ln mo lr mp lv mg mh mi mj bi translated"><a class="ae mk" rel="noopener" target="_blank" href="/significance-or-hypothesis-tests-with-python-7ed35e9ac9b6">使用Python进行显著性测试</a></li><li id="b25d" class="mb mc it lc b ld ml lg mm lj mn ln mo lr mp lv mg mh mi mj bi translated"><a class="ae mk" rel="noopener" target="_blank" href="/two-sample-inference-for-the-difference-between-groups-with-python-de91fbee32f9">用Python进行组间差异的双样本推断</a></li><li id="b3e9" class="mb mc it lc b ld ml lg mm lj mn ln mo lr mp lv mg mh mi mj bi translated"><a class="ae mk" rel="noopener" target="_blank" href="/inference-for-categorical-data-9f3c6034aa57">分类数据的推断</a></li><li id="5520" class="mb mc it lc b ld ml lg mm lj mn ln mo lr mp lv mg mh mi mj bi translated"><a class="ae mk" rel="noopener" target="_blank" href="/advanced-regression-f74090014f3">高级回归</a></li><li id="f139" class="mb mc it lc b ld ml lg mm lj mn ln mo lr mp lv mg mh mi mj bi translated"><a class="ae mk" rel="noopener" target="_blank" href="/analysis-of-variance-anova-8dc889d2fc3a">方差分析— ANOVA </a></li></ul><p id="d51b" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">像往常一样，代码可以在我的<a class="ae mk" href="https://github.com/luisroque/College_Statistics_with_Python" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p><h1 id="aae1" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">逐步方差分析</h1><p id="264e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们再一次用数据科学家的薪水工作。在这种情况下，我们对基于一些独立特征预测工资不感兴趣。我们重点了解具有不同背景的3组数据科学家的平均工资是否存在差异:第一组是来自计算机科学专业毕业生的样本，第二组是经济学专业毕业生的样本，第三组是信息工程专业毕业生的样本(请注意，工资单位是10，000€)。</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mq"><img src="../Images/a01cc9196d3faed408b864a9ecd81662.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IQFs98-bIbzpc8jc"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">图1:数据科学是结合了领域专业知识、编程技能以及数学和统计知识的研究领域，用于从数据中提取有意义的见解；<a class="ae mk" href="https://unsplash.com/photos/AxAPuIRWHGk" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><pre class="mr ms mt mu gt ng nh ni nj aw nk bi"><span id="e11f" class="nl kj it nh b gy nm nn l no np">import pandas as pd<br/>import numpy as np<br/>from scipy.stats import f</span><span id="dc21" class="nl kj it nh b gy nq nn l no np">df = pd.DataFrame.from_dict({'g1': [5,9,10,12,8,8,9], <br/>                        'g2': [5,4, 4, 5,5,4,8], <br/>                        'g3': [9,8, 5, 6,7,7,6]})<br/><br/>df</span></pre><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div class="ab gu cl nr"><img src="../Images/50541bc25bc60c8270d4b3c86d14e007.png" data-original-src="https://miro.medium.com/v2/format:webp/1*17miFzPSRvccF1cmUQ5kBw.png"/></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">表1:不同背景的3组数据科学家的万人薪酬。</p></figure><p id="f749" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">执行ANOVA测试的第一步是计算SST(总平方和)、SSW(总内平方和)、SSB(总间平方和)以及相应的自由度。他们计算如下:</p><ul class=""><li id="9405" class="mb mc it lc b ld lw lg lx lj md ln me lr mf lv mg mh mi mj bi translated">SST是每个数据点和数据集平均值之间的平方距离之和。在这种情况下，自由度是组数<em class="ns"> m </em>乘以每组中数据点数<em class="ns"> n </em>，然后我们减去1，即m<strong class="lc iu">n-1。</strong></li><li id="033c" class="mb mc it lc b ld ml lg mm lj mn ln mo lr mp lv mg mh mi mj bi translated">SSW是每个数据点和相应组平均值之间的平方距离之和。自由度是组数乘以数据点数减1，即m<strong class="lc iu"/>(n-1)。</li><li id="c4d3" class="mb mc it lc b ld ml lg mm lj mn ln mo lr mp lv mg mh mi mj bi translated">SSB是每个组平均值和每个数据点的数据集平均值之间的平方距离之和。自由度是组数减1，即m -1。</li></ul><pre class="mr ms mt mu gt ng nh ni nj aw nk bi"><span id="d22a" class="nl kj it nh b gy nm nn l no np">m = df.shape[1]<br/>n = df.shape[0]</span><span id="a7b4" class="nl kj it nh b gy nq nn l no np">SST = np.sum(np.sum((df - np.mean(np.mean(df)))**2))<br/>SST</span><span id="7b7a" class="nl kj it nh b gy nq nn l no np">98.57142857142858</span><span id="46b7" class="nl kj it nh b gy nq nn l no np">df_sst = m*n-1<br/>df_sst</span><span id="7440" class="nl kj it nh b gy nq nn l no np">20</span><span id="7e4c" class="nl kj it nh b gy nq nn l no np">SSW = np.sum(np.sum((df - np.mean(df))**2))<br/>SSW</span><span id="b237" class="nl kj it nh b gy nq nn l no np">50.28571428571429</span><span id="5cc4" class="nl kj it nh b gy nq nn l no np">df_ssw = m*(n-1)<br/>df_ssw</span><span id="238f" class="nl kj it nh b gy nq nn l no np">18</span><span id="0729" class="nl kj it nh b gy nq nn l no np">SSB = np.sum(np.sum((np.tile(np.mean(df), (3,1)) - np.mean(np.mean(df)))**2))<br/>SSB</span><span id="9511" class="nl kj it nh b gy nq nn l no np">20.6938775510204</span><span id="e0cf" class="nl kj it nh b gy nq nn l no np">df_ssb = m-1<br/>df_ssb</span><span id="d650" class="nl kj it nh b gy nq nn l no np">2</span></pre><h1 id="4a23" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">假设检验</h1><p id="cb44" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们定义我们的假设检验。我们的零假设是背景没有影响的情况。相比之下，我们的另一个假设是，背景会影响数据科学家的薪酬。</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/4cef30b2cece3355cab831a3f02f5e2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:410/format:webp/1*8eIXQEhBS8mnEfmkt5gcwA.png"/></div></figure><p id="5785" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">像往常一样，我们将假设我们的零假设是正确的，并计算出得到一个极端统计数据或比我们从观察到的数据得到的数据更极端的概率。为此，我们将使用F统计量，它基本上是两个卡方统计量的比率。它实际上是上面计算的两个指标除以各自自由度的比率:</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/1022383d23b8259ff048e5a7a1fc51d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:428/format:webp/1*1mpnEoIqRP8puarYACu_PA.png"/></div></figure><p id="45d7" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">这个想法是，如果分子明显大于分母，这应该让我们相信，在真正的人口均值之间存在差异。相反，如果分母明显较大，则意味着与样本之间的差异相比，每个样本内的差异占总差异的百分比较大。因此，我们可以观察到的任何均值差异可能只是随机的结果。</p><pre class="mr ms mt mu gt ng nh ni nj aw nk bi"><span id="e94b" class="nl kj it nh b gy nm nn l no np">F = (SSB/df_ssb)/(SSW/df_ssw)<br/>F</span><span id="1cb2" class="nl kj it nh b gy nq nn l no np">3.703733766233764</span><span id="60a6" class="nl kj it nh b gy nq nn l no np">f.ppf(0.95, dfn=df_ssb, dfd=df_ssw)</span><span id="3bda" class="nl kj it nh b gy nq nn l no np">3.554557145661787</span></pre><p id="03b3" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">现在，我们可以计算我们的p值。让我们使用0.1的显著性水平。</p><pre class="mr ms mt mu gt ng nh ni nj aw nk bi"><span id="84fd" class="nl kj it nh b gy nm nn l no np">p_value = (1 - f.cdf(F, dfn=df_ssb, dfd=df_ssw))*2<br/>p_value</span><span id="5525" class="nl kj it nh b gy nq nn l no np">0.08991458167840971</span><span id="5a06" class="nl kj it nh b gy nq nn l no np">if p_value&lt;0.1:<br/>    print('Reject H_0')<br/>else:<br/>    print('Accept H_0')</span><span id="9dce" class="nl kj it nh b gy nq nn l no np">Reject H_0</span></pre><p id="768c" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">我们看到p值小于显著性水平，这使我们拒绝零假设。有足够的证据来接受群体间均值的差异，这种差异并不仅仅来自于偶然或每个群体内的差异。说了这么多，我们可以得出结论，一个数据科学家的工资是不同的，取决于毕业背景。</p><h1 id="88af" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">结论</h1><p id="4a31" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">本文介绍了方差分析(ANOVA)，这是一组比较不同组的多个平均值的方法。我们还引入了一个新的统计量，称为F统计量，我们用它来对我们组的均值差异进行假设检验。</p><p id="7001" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">这是“使用Python进行大学统计”系列的最后一篇文章我希望你喜欢它！</p><p id="3951" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">保持联系:<a class="ae mk" href="https://www.linkedin.com/in/luisbrasroque/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a></p><h2 id="aa2b" class="nl kj it bd kk nv nw dn ko nx ny dp ks lj nz oa ku ln ob oc kw lr od oe ky of bi translated">上周的答案</h2><ol class=""><li id="eaef" class="mb mc it lc b ld le lg lh lj og ln oh lr oi lv oj mh mi mj bi translated">Márcia收集了便携式电脑随机样本的电池寿命和价格数据。根据下面提供的数据，总体斜率为0的零假设的检验统计量是什么？</li></ol><pre class="mr ms mt mu gt ng nh ni nj aw nk bi"><span id="b6ff" class="nl kj it nh b gy nm nn l no np">data = {'Intercept': [200.312, 92.618],<br/>             'Battery': [7.546,4.798]}</span><span id="ef11" class="nl kj it nh b gy nq nn l no np">df = pd.DataFrame.from_dict(data, columns=['Coef', 'SE Coef'], orient='index')<br/>df</span></pre><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div class="ab gu cl nr"><img src="../Images/5fc7af1f045214cb83df298011725afa.png" data-original-src="https://miro.medium.com/v2/format:webp/1*1lFGf-l_4aNeTk4gNpkWbQ.png"/></div></figure><pre class="mr ms mt mu gt ng nh ni nj aw nk bi"><span id="bca7" class="nl kj it nh b gy nm nn l no np">t = (df['Coef'][1]-0)/df['SE Coef'][1]<br/>t</span><span id="25cc" class="nl kj it nh b gy nq nn l no np">1.5727386411004585</span></pre><p id="dfa7" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">2.芮随机抽取了一些同事，注意到他们的年龄和他们昨天步行的公里数成正比。回归线斜率的95%置信区间为(15.4，155.2)。芮想用这个区间在5%的显著性水平上检验H_0: β=0 vs. H_1: β ≠ 0。假设推断的所有条件都已满足。芮应该得出什么结论？</p><p id="c2a2" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">芮应该拒绝H_0，即数据提示年龄和昨天走的公里数成线性关系。</p></div></div>    
</body>
</html>