<html>
<head>
<title>6 Examples to Master SQL Joins with PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PostgreSQL掌握SQL连接的6个示例</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/6-examples-to-master-sql-joins-with-postgresql-db56de76d27e?source=collection_archive---------23-----------------------#2021-04-26">https://towardsdatascience.com/6-examples-to-master-sql-joins-with-postgresql-db56de76d27e?source=collection_archive---------23-----------------------#2021-04-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0218" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">PostgreSQL:世界上最先进的开源关系数据库</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0c1770511f514f9aa2862acee0cb9e10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lr6N43i0JEwc1_znjOPNLQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com/s/photos/share?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的<a class="ae ky" href="https://unsplash.com/@mineragua?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Mineragua苏打水</a></p></figure><p id="409b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL提供了许多函数和方法来管理以表格形式存储的数据。关系数据库管理系统(RDBMS)是一个使用SQL来管理存储在关系数据库中的数据的程序。</p><p id="e89d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关系数据库包含许多通过共享列相互关联的表。有许多不同的RDBMSs，如MySQL、PostgreSQL、SQL Server等等。</p><p id="de0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将通过6个例子来演示SQL连接是如何执行的。如果您想从SQL和PostgreSQL的基本介绍开始，这里有我以前写的两篇介绍性文章:</p><ul class=""><li id="9d7d" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/practical-introduction-to-postgresql-5f73d3d394e">PostgreSQL实用介绍</a></li><li id="75e5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/hands-on-postgresql-basic-queries-a5f1249bba78">动手操作PostgreSQL:基本查询</a></li></ul><p id="823d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL连接允许从多个表中检索数据。我们基本上是根据相关表的公共列中的值来组合多个表。然后我们可以从这些表格中提取任何信息。</p><p id="8ea3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我使用Kaggle上的墨尔本住房数据集<a class="ae ky" href="https://www.kaggle.com/anthonypino/melbourne-housing-market" rel="noopener ugc nofollow" target="_blank">中的数据创建了两个表格。这些表的名称是houses和location，它们基于“houseid”列相关联。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/0823bfb5237a5808f1bf3f7dd324ae5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XeYEOaIA3MDCmIZdKM0QhA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">房屋表的前5行(图片由作者提供)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mk"><img src="../Images/9bc1cce033e615fb6021bd4220989e4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0I0FqnaBKEt86C_v7genIQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">位置表的前5行(作者图片)</p></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="d8da" class="ms mt it bd mu mv mw dn mx my mz dp na li nb nc nd lm ne nf ng lq nh ni nj nk bi translated">示例1</h2><p id="6755" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">查找2017年4月3日发布的房屋地址。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="c3d8" class="ms mt it nr b gy nv nw l nx ny">select location.address, houses.date                                                                    from location                                                                                                    join houses                                                                                                      on location.houseid = houses.houseid                                                                             where houses.date = '2017-04-03'                                                                                 limit 5;</span><span id="1b16" class="ms mt it nr b gy nz nw l nx ny">address          |    date<br/>-----------------+------------<br/>5 Charles St     | 2017-04-03<br/>40 Federation La | 2017-04-03<br/>50 Bedford St    | 2017-04-03<br/>23 Hart St       | 2017-04-03<br/>1/80 Hawker St   | 2017-04-03</span></pre><p id="ab98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先指定要选择的列及其表名。第二行和第三行包含表名。然后，我们指定用于匹配表间行的条件。最后，where语句用于筛选行。Limit关键字，顾名思义，限制要显示的行数。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="cf1f" class="ms mt it bd mu mv mw dn mx my mz dp na li nb nc nd lm ne nf ng lq nh ni nj nk bi translated">示例2</h2><p id="5663" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">找出北部大都市地区h型房屋的数量。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="fb60" class="ms mt it nr b gy nv nw l nx ny">SELECT COUNT(1)                                                                                         FROM location                                                                                                    JOIN houses                                                                                                      ON location.houseid = houses.houseid                                                                             WHERE type = 'h' AND regionname = 'Northern Metropolitan';</span><span id="a1d8" class="ms mt it nr b gy nz nw l nx ny">count<br/>-------<br/>2754</span><span id="b0ff" class="ms mt it nr b gy nz nw l nx ny">(1 row)</span></pre><p id="e844" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有2754套房子符合我们的条件。您可能会注意到，我们不必为where语句中使用的列编写表名。这是允许的，除非表中没有同名的列。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="04c0" class="ms mt it bd mu mv mw dn mx my mz dp na li nb nc nd lm ne nf ng lq nh ni nj nk bi translated">示例3</h2><p id="a793" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">找出北部大都市地区每种类型的房屋数量。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="334a" class="ms mt it nr b gy nv nw l nx ny">SELECT type, COUNT(1) AS number_of_houses<br/>FROM houses<br/>JOIN location<br/>ON houses.houseid = location.houseid<br/>WHERE regionname = 'Northern Metropolitan'<br/>GROUP BY type;</span><span id="33c4" class="ms mt it nr b gy nz nw l nx ny">type | number_of_houses<br/>-----+------------------<br/>t    |              307<br/>h    |             2754<br/>u    |              829</span><span id="f8d4" class="ms mt it nr b gy nz nw l nx ny">(3 rows)</span></pre><p id="0838" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个例子和上一个很相似。我们使用类型列对观测值(即行)进行分组，然后对每组中的房屋进行计数，而不是只对h类型的房屋进行计数。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="6aa8" class="ms mt it bd mu mv mw dn mx my mz dp na li nb nc nd lm ne nf ng lq nh ni nj nk bi translated">实例4</h2><p id="751f" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">找出每个郊区的平均房价，并根据平均价格显示前5个郊区。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="e0a4" class="ms mt it nr b gy nv nw l nx ny">SELECT suburb, AVG(Price) AS avg_house_price                                                            FROM location                                                                                                    JOIN houses                                                                                                      ON location.houseid = houses.houseid                                                                             GROUP BY suburb                                                                                                  ORDER BY avg_house_price DESC                                                                                    LIMIT 5;</span><span id="f41d" class="ms mt it nr b gy nz nw l nx ny">suburb      |  avg_house_price<br/>------------+--------------------<br/>Kooyong     |            2185000<br/>Canterbury  | 2180240.7407407407<br/>Middle Park | 2082529.4117647058<br/>Albert Park |  1941355.072463768<br/>Brighton    |            1930158</span><span id="59a2" class="ms mt it nr b gy nz nw l nx ny">(5 rows)</span></pre><p id="2b51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它类似于前面示例中的group by操作。在本例中，我们还基于聚合列(avg_house_price)对结果进行排序。默认情况下，结果按升序排序，但可以使用desc关键字进行更改。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="c844" class="ms mt it bd mu mv mw dn mx my mz dp na li nb nc nd lm ne nf ng lq nh ni nj nk bi translated">实例5</h2><p id="a092" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">到目前为止，我们已经在join子句中交替使用了表名。桌子的顺序并不重要。“从房屋连接位置”与“从位置连接房屋”相同。</p><p id="582e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">顺序无关紧要的原因是我们使用了所谓的“内部连接”。仅选择在两个表中具有匹配值的行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/1c1a605d4f03058de64cfca7c62499c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*16iNYOTNOS9quMAUN8kSlg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="71ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们执行左连接时，我们从左侧获取整个表(即join子句中的第一个表)，然后只从右侧表中获取匹配的行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/31db4ce1cb42378d53a46aef94d4c80f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jJIp_o9SjriuumHtLf70Kg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="1a3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们找出每个地区房屋的平均土地面积。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="51d6" class="ms mt it nr b gy nv nw l nx ny">SELECT regionname, ROUND(AVG(landsize)) AS avg_landsize                                                 FROM location                                                                                                    INNER JOIN houses                                                                                                ON location.houseid = houses.houseid                                                                             GROUP BY regionname;</span><span id="789d" class="ms mt it nr b gy nz nw l nx ny">regionname                 | avg_landsize<br/>---------------------------+--------------<br/>Eastern Metropolitan       |          634<br/>Western Metropolitan       |          494<br/>South-Eastern Metropolitan |          614<br/>Southern Metropolitan      |          509<br/>Western Victoria           |          656<br/>Eastern Victoria           |         2950<br/>Northern Metropolitan      |          569<br/>Northern Victoria          |         3355</span></pre><p id="a8e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">语法是一样的，只是我们写的是“左连接”而不是“连接”。请记住，当我们使用left或right join时，join子句中表名的顺序很重要。</p><p id="ff7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没有必要明确提到右连接，因为只需切换表名就可以将它转换为左连接。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="e8e3" class="ms mt it bd mu mv mw dn mx my mz dp na li nb nc nd lm ne nf ng lq nh ni nj nk bi translated">实例6</h2><p id="d6b3" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">我们还有“完全外部连接”，它包括两个表中匹配的行，也包括不匹配的行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/4566caffe335eef8e23134617597037d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ty4KETfEHPvOO3WrYI2M0g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="6257" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们查找地址中包含“公园”一词并且有4个以上房间的房子的价格。</p><pre class="kj kk kl km gt nq nr ns nt aw nu bi"><span id="edbe" class="ms mt it nr b gy nv nw l nx ny">sonery=# SELECT (price/1000000) AS price_million, address                                                        FROM houses                                                                                                      FULL OUTER JOIN location                                                                                         ON houses.houseid = location.houseid                                                                             WHERE address LIKE '%Park%' AND rooms &gt;4;</span><span id="dac2" class="ms mt it nr b gy nz nw l nx ny">price_million  |   address<br/>---------------+-------------<br/>           2.1 | 21 Park Rd<br/>           2.3 | 119 Park St<br/>             2 | 52 Park Rd</span></pre><p id="b3c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的例子中，连接的类型实际上并不重要，因为两个表都包含每个房屋id。然而，有些情况下我们需要使用左连接或外连接。因此，了解它们是如何工作的很重要。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="84c7" class="ms mt it bd mu mv mw dn mx my mz dp na li nb nc nd lm ne nf ng lq nh ni nj nk bi translated">结论</h2><p id="9a43" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">我们已经做了6个例子来演示连接是如何工作的。我们需要从关系数据库中检索的数据通常分布在多个表中。因此，全面理解SQL连接非常重要。</p><p id="a7e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>