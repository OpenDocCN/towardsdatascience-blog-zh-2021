<html>
<head>
<title>Power BI: Create a Stacked Funnel Chart</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Power BI:创建堆积漏斗图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/power-bi-create-a-stacked-funnel-chart-90c41106fa58?source=collection_archive---------11-----------------------#2021-04-02">https://towardsdatascience.com/power-bi-create-a-stacked-funnel-chart-90c41106fa58?source=collection_archive---------11-----------------------#2021-04-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="98a6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Power BI不支持堆积漏斗图。使用这个技巧，你可以创造一个。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/13ab4095b20eacd15c68989ccb66cd06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H3IvTUccAqQcej1rbfmHbA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">资料来源:Pexels.com</p></figure><h1 id="a6e9" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">问题是</h1><p id="e8ab" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">Power BI提供多种可视化功能来满足您的数据需求。尽管Power BI总体上是一个非常成熟的产品，但它的大部分局限仍然在可视化部分。这些限制之一是漏斗图。</p><p id="6cc0" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">Power BI具有内置的漏斗图功能，但是不能向漏斗图添加类别。换句话说，每个条形只能有一种颜色，如下图所示。</p><p id="b280" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">在官方Power BI社区的<a class="ae mo" href="https://community.powerbi.com/t5/Desktop/Create-a-quot-stacked-funnel-quot-visual/td-p/783661" rel="noopener ugc nofollow" target="_blank">帖子</a>中，你可以看到其中一个用户请求类似的解决方案。在本教程中，我将使用他的图表作为灵感。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/821b7fa7be6bd92b70ea5c9cd991520d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2L1O8nCdScoJYmnU"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">本机漏斗图目前不支持类别颜色。</p></figure><p id="0842" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">尽管第三方视觉或D3可能是可行的，但我的客户不想使用其中任何一个，所以我不得不自己想出一个解决方案。</p><h1 id="98f1" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">修复</h1><p id="c3b7" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在这次演示中，我将使用如下数据。为了便于演示，我简化了结构，但是您可以使用不同的结构，或者在Power Query中简单地转换数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/0a5bcfb1ac54e7a03e1771e81328e3c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/0*lEj17_ECw05Me8Ia"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">原始数据。</p></figure><h2 id="5bdc" class="mr kw iq bd kx ms mt dn lb mu mv dp lf lw mw mx lh ma my mz lj me na nb ll nc bi translated">第一步:计算总数。</h2><p id="d4d6" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我们需要做的第一件事是添加一个计算总数的列，这样我们就知道条形的总宽度。这可以通过一个简单的公式来实现，如下所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/44920cfcbd34503b262cce02ccce2944.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/0*eytO-Mn3QBUSFJb0"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">添加了包含所有类别合计的计算列。</p></figure><h2 id="8cfb" class="mr kw iq bd kx ms mt dn lb mu mv dp lf lw mw mx lh ma my mz lj me na nb ll nc bi translated">第二步:计算余数</h2><p id="c542" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这个解决方案的诀窍是，我们实际上是在构建一个规则的堆积条形图，但是我们通过隐藏“剩余”类别使它看起来像一个漏斗图。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/4baca4b1efac1da63e7d0e133f7d32bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-AeWTjH1C2cE6jZ0"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">粉红色区域已被隐藏，使图表看起来像漏斗图。</p></figure><p id="6e8d" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">使用这个DAX脚本，我们可以计算余数(左图中的粉色区域)。</p><p id="dab7" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated"><code class="fe nf ng nh ni b">Remainder = <br/>VAR longest_bar = CALCULATE ( MAX ( Recruitment[Total] ), ALL ( Recruitment ) )<br/>RETURN( longest_bar — MAX ( Recruitment[Total] ) ) / 2</code></p><h2 id="22f8" class="mr kw iq bd kx ms mt dn lb mu mv dp lf lw mw mx lh ma my mz lj me na nb ll nc bi translated">第三步:制作图表。</h2><p id="fb1f" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">现在我们要做的就是把这些碎片拼在一起。只是一个具有以下字段设置的堆积条形图；</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/218787cb98fe41799d52129fdfac95b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*piKP6JU2T9blGl0E"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">“字段”窗格中的“剩余部分”已被重命名为“城市”。</p></figure><p id="acea" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">现在剩下的就是将剩余的颜色改为白色，将其名称改为您的标题图例，瞧:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/490b525371520f442e2c9092c83e7123.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/0*VHvZhfXqJ0eTXu_p"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">最后的结果。</p></figure><h1 id="597a" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">结论</h1><p id="b8db" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">像所有的软件解决方案一样，Power BI也有它的局限性，但是只要有点创造力，就有可能绕过其中的大部分。使用这个“技巧”,您可以为您的数据解决方案创建一个堆积漏斗图。</p><p id="5232" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">但是请记住，这种粗糙的解决方案有一些限制；</p><ul class=""><li id="deb2" class="nl nm iq lp b lq mj lt mk lw nn ma no me np mi nq nr ns nt bi translated">您的用户将能够点击隐藏类别</li><li id="d9f9" class="nl nm iq lp b lq nu lt nv lw nw ma nx me ny mi nq nr ns nt bi translated">DAX需要额外的资源(尽管在这种情况下非常少)</li><li id="cc3f" class="nl nm iq lp b lq nu lt nv lw nw ma nx me ny mi nq nr ns nt bi translated">您可能需要转换您的数据</li></ul><p id="ae4a" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">总之，这似乎是一个不错的解决方案，我的客户终端用户很高兴。希望也能帮到你。如果你知道任何更好的解决方法，请在评论中告诉我。</p><p id="78f2" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">关于我:我叫布鲁诺，是一名数据科学顾问。你可以通过我的网址与我联系:<a class="ae mo" href="https://www.zhongtron.me/" rel="noopener ugc nofollow" target="_blank">https://www . zhongtron . me</a></p></div></div>    
</body>
</html>