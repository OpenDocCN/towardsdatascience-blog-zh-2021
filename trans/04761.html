<html>
<head>
<title>Raspberry Pi Gardening: Monitoring a Vegetable Garden using a Raspberry Pi — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">树莓派园艺:使用树莓派监控菜园—第1部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/raspberry-pi-gardening-monitoring-a-vegetable-garden-using-a-raspberry-pi-part-1-fd231c7c6275?source=collection_archive---------29-----------------------#2021-04-25">https://towardsdatascience.com/raspberry-pi-gardening-monitoring-a-vegetable-garden-using-a-raspberry-pi-part-1-fd231c7c6275?source=collection_archive---------29-----------------------#2021-04-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="9528" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><h1 id="34ff" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">介绍</h1><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ku"><img src="../Images/abd936174b5e6f8d3bd42b21e0a65a4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s5cDup0Lzv5TIGpR.png"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated"><em class="lk">项目之旅；</em>CC BY-SA 3.0/【chollinger.com/blog T4】</p></figure><p id="7afd" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在2020/2021年左右的某个时期，像许多其他人一样(如果你在3000年你的“古代美国历史”课上，在北极的一个拱顶上读到这封全息磁带，我说的是新冠肺炎)，我和我的SO都在园艺和种植蔬菜中找到了乐趣。</p><p id="8acc" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">虽然种植植物的爱好在理论上可能是一种快乐，但我认为我听到的对园艺的最佳描述是“80%的痛苦，15%的担忧，5%的胜利和满足，以及100%的等待”。你需要考虑很多事情——阳光照射、土壤的pH值、土壤中的养分、害虫、真菌、松鼠、鹿、鸟(以及各种各样的动物)——当然，每种植物的所有这些都是不同的。</p><p id="39c5" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">因为这种内在的复杂性，已经有了很多与成长事物的斗争。萝卜，我没有适当地薄，产生悲伤的小棍子，而不是性感的球茎；黄瓜，西红柿和南瓜被枯萎病吃掉，松鼠攻击并挖出种子，蚜虫像圣经中的瘟疫一样降临到所有多叶和绿色的东西上，霜冻损害了原本不应该对可怜的芦荟造成任何损害的地方，猴草(短葶山麦冬)占据了凸起的床，植物生长成奇怪的形状，最终由于缺乏阳光而死去。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi mk"><img src="../Images/47f49a8ebbffa3004f6ff90605aada36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kVIJv5-RnKuag1in.jpg"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">悲伤的灯泡(作者<a class="ae ll" href="https://chollinger.com/blog/2021/04/raspberry-pi-gardening-monitoring-a-vegetable-garden-using-a-raspberry-pi-part-1/" rel="noopener ugc nofollow" target="_blank">作者</a></p></figure><p id="f291" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">对于其中的许多问题，我们已经找到了模拟解决方案:在PVC管框架上用扎带、阿兰·杰克逊歌曲和廉价啤酒建造一个鸟笼(信不信由你，它实际上是有效的，你可以在上面的“悲伤灯泡”图片中看到)。螳螂卵对抗蚜虫。针对山麦冬和其他杂草的杂草屏障。抗真菌铜杀真菌剂。</p><p id="faf7" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">然而，有些事情仍然困扰着我，让我夜不能寐。自然，对此只有一个解决方案:在不该使用技术的地方使用技术，在不需要收集数据的地方使用技术，当然，尽可能以最过度设计的方式完成所有这些工作。</p><h1 id="b8e9" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">范围</h1><p id="30d3" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">那我们要做什么？</p><h1 id="b7f3" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">总体思路</h1><p id="4b28" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">我抓住了这个半真实需求的机会，最终在物理电子和微控制器的世界里把手弄脏了。<strong class="lo ja">这对我来说是一个全新的话题</strong>，鉴于我是你能想到的最糟糕的“边做边学”型的人，没有比这更好的机会来随意地将一些电路焊接在一起以收集数据。</p><p id="f898" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">因此，如果你在阅读这篇文章时，至少在电子、微控制器或园艺领域有一点经验，就此而言——我的投诉邮件可以在我的网站上找到。</p><p id="2460" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">不过，如果你更像我一样，根本没有涉足过电子学的<em class="mq">现实世界</em>，你可能会觉得这很有趣。</p><h1 id="2d68" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">体系结构</h1><p id="8b14" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">无论如何，数据是我在这里追求的——关于阳光照射、土壤湿度和温度的数据。这实际上是一个有点有趣的问题，因为这些指标是高度本地化的，可能在几英尺之外就完全不同。</p><p id="4dd3" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">因此，我们将收集土壤湿度、阳光照射紫外线等指标，以及设备ID和时间戳等元数据，使用REST API ( <a class="ae ll" href="https://chollinger.com/blog/2019/04/building-a-home-server/" rel="noopener ugc nofollow" target="_blank"> bigiron.local </a>，当然)将其发送到网络上的服务器，将其存储在MariaDB中，并使用Grafana进行分析。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi mr"><img src="../Images/9413f3c0946cd27c49081c9eff1c5e8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ixBAC98LYiu8nCdY.png"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">建筑(作者)</p></figure><h1 id="5c5c" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">数据点</h1><p id="ad34" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">以下是我们总共6张加高床中的3张的布局(完全不按比例):</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ms"><img src="../Images/4a1c1a6d74299833174e6782b5ff5c46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mOWN0kEKgw0YRpBa.png"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">真实世界布局(作者)</p></figure><p id="b666" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这些床在南边，但也位于两辆车、一个甲板和一个工具棚之间，两侧是树木。虽然从理论上讲，这些床应该得到充足的阳光，但很难估计它们实际得到了多少阳光。去年，我们在那里种植了“半日照”的草本植物，比如薰衣草，它们很快就死掉了。不过，你可以种植甜椒——就像辣椒中的辣椒一样，它们实际上也需要相当多的阳光。</p><p id="893e" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">土壤湿度也令人惊讶地难以测量:你可能会把手指伸进土壤，但这并不一定意味着它实际上是“年轻的胡萝卜”——湿的。可能只是“柑橘树不在乎”——湿了。量化这一点将是一个额外的收获。</p><p id="9d0a" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">温度和湿度是非常明显的——实际上，我在iPhone上用“快捷方式”应用程序做了一个小东西来提醒我们冷锋的到来:</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi mt"><img src="../Images/5e9bcdce9913d606e22ea9a0f684ee1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jwnLorrA0zDsPC3f.jpg"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">iOS快捷方式(按作者)</p></figure><p id="2056" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">但是当然，这种<em class="mq">方式太简单了</em>。</p><h1 id="e065" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">成分</h1><p id="41a6" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">这个想法非常简单:一个Raspberry Pi驱动的(仅仅因为我有几个)机器可以捕获这些指标并将其发送到服务器，这样我们就可以使用良好的ole数据工程工具箱来了解关于遥远的真实世界的所有信息。</p><p id="60e1" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">为此，我选择了以下组件:</p><ul class=""><li id="19c3" class="mu mv iq lo b lp lq lt lu lx mw mb mx mf my mj mz na nb nc bi translated"><strong class="lo ja">温度</strong> : <a class="ae ll" href="https://www.adafruit.com/product/1782" rel="noopener ugc nofollow" target="_blank"> MCP9808高精度I2C温度传感器</a>——4.95美元</li><li id="0ef8" class="mu mv iq lo b lp nd lt ne lx nf mb ng mf nh mj mz na nb nc bi translated"><strong class="lo ja">紫外线</strong> : <a class="ae ll" href="https://www.adafruit.com/product/1777" rel="noopener ugc nofollow" target="_blank"> SI1145数字紫外线指数/红外/可见光传感器</a>——9.95美元</li><li id="6361" class="mu mv iq lo b lp nd lt ne lx nf mb ng mf nh mj mz na nb nc bi translated">或者<a class="ae ll" href="https://www.adafruit.com/product/2899" rel="noopener ugc nofollow" target="_blank"> Adafruit VEML6070紫外线指数传感器插座</a>——5.95美元</li><li id="0284" class="mu mv iq lo b lp nd lt ne lx nf mb ng mf nh mj mz na nb nc bi translated"><strong class="lo ja">灯</strong> : <a class="ae ll" href="https://www.adafruit.com/product/4162" rel="noopener ugc nofollow" target="_blank">阿达果VEML7700 </a>(最高120k勒克斯)——4.95美元</li><li id="d938" class="mu mv iq lo b lp nd lt ne lx nf mb ng mf nh mj mz na nb nc bi translated">或者<a class="ae ll" href="https://www.adafruit.com/product/1980" rel="noopener ugc nofollow" target="_blank"> Adafruit TSL2591 </a>(最高88k lux)——6.95美元</li><li id="446d" class="mu mv iq lo b lp nd lt ne lx nf mb ng mf nh mj mz na nb nc bi translated">或者是<a class="ae ll" href="https://smile.amazon.com/NOYITO-MAX44009-Intensity-Interface-Development/dp/B07HFRS8XX" rel="noopener ugc nofollow" target="_blank">NOYITO max 44009</a>——5.99美元</li><li id="d3ac" class="mu mv iq lo b lp nd lt ne lx nf mb ng mf nh mj mz na nb nc bi translated"><strong class="lo ja">湿度</strong> : <a class="ae ll" href="https://smile.amazon.com/gp/product/B076DDWDJK/ref=ppx_yo_dt_b_asin_image_o01_s00?ie=UTF8&amp;psc=1" rel="noopener ugc nofollow" target="_blank">任何电阻式湿度传感器</a>——4.99美元——8美元</li><li id="ee82" class="mu mv iq lo b lp nd lt ne lx nf mb ng mf nh mj mz na nb nc bi translated">你身边的任何一款树莓派，比如<a class="ae ll" href="https://www.microcenter.com/product/486498/zero-v13-development-board---camera-ready?storeid=041" rel="noopener ugc nofollow" target="_blank">树莓Zero </a>或者花哨的<a class="ae ll" href="https://www.microcenter.com/product/609038/raspberry-pi-4-model-b-4gb-ddr4" rel="noopener ugc nofollow" target="_blank">树莓PI 4 Model B</a>——或者小巧的<a class="ae ll" href="https://www.raspberrypi.org/products/raspberry-pi-pico/" rel="noopener ugc nofollow" target="_blank">Pico</a>——4.99美元到54.99美元</li><li id="69de" class="mu mv iq lo b lp nd lt ne lx nf mb ng mf nh mj mz na nb nc bi translated">烙铁、跳线、发光二极管、分线板等。</li></ul><p id="ceae" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">当然，这里有大量的选择——但通过最少的设置，我们可以以大约25美元一个的价格(当然，如果批量订购，价格会更低)制造一个这样的传感器。我将在下面介绍不同类型的传感器。</p><p id="8690" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我个人并不太关心这一迭代的成本——尽管一直部署一个会很有趣，但这也需要有线电源连接(或锂电池)、互联网连接和防水外壳。所有这些事情可能使我值得购买一台3D打印机(并从中挤出另一篇文章)，但就本文的范围而言，我将专注于实际构建它。</p><h1 id="23a4" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">模拟电路</h1><p id="9558" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">但是在我们做这些之前:我个人从中学开始就没有涉足过电子，所以已经有一段时间了。</p><p id="2294" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">很自然地，我“回归基础”，开始构建一个非常简单的电路:给LED供电。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi mk"><img src="../Images/e7b70f69aa28f23b5248d8fd0582b3ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*h_NVMmQ5qkssssUY.jpg"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">一个简单的LED电路(作者)</p></figure><p id="1e0f" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这是一个记住一些基本原则的好练习。标准LED电路如下所示:</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/ab24902e228289710e592968f875db7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/0*iskyLXix8Cd4IfEC.png"/></div><p class="lg lh gj gh gi li lj bd b be z dk translated">简单的LED电路图(<a class="ae ll" href="https://en.wikipedia.org/wiki/LED_circuit" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/LED_circuit</a>)</p></figure><p id="6f0f" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">因为我们需要用一个电阻来限制到达LED的电流，以防止它烧毁。</p><p id="bb76" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">为了找到正确的阻力，我们可以使用:</p><p id="3f74" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><code class="fe nj nk nl nm b">R = (V_power - V_led) / I_led</code></p><p id="49a8" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">其中<code class="fe nj nk nl nm b">R</code>是以欧姆为单位的电阻，<code class="fe nj nk nl nm b">V_power</code>是以伏特为单位的电源电压，<code class="fe nj nk nl nm b">V_led</code>是以伏特为单位的LED正向压降，<code class="fe nj nk nl nm b">I_led</code>是以安培为单位的LED期望电流。</p><p id="f0ab" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">对于红色LED，我们将在20mA电流下观察2–2.2V，即在5V电源下(如上所示)，一个93ω电阻就可以了(我最接近的电阻是一个100ω电阻)。对于蓝色LED，我们会看到3.2–3.4V，因此电阻为54ω(以此类推)。</p><p id="0ffa" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">玩这个很有趣——但为了记录，我对你将看到的大多数图片都使用了330ω。</p><p id="555b" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">此外，你在图片上看到的小电源非常漂亮(一个<a class="ae ll" href="https://www.cafago.com/en/p-e8575.html" rel="noopener ugc nofollow" target="_blank"> HW-131 </a>售价2美元)，因为它可以通过PSU、电池或USB获得3.3V和5V的电源。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi nn"><img src="../Images/27621feffe8a7630327561a149fbbb8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ARU95hGqRCMiP19Y.jpg"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">万用表(作者)</p></figure><h1 id="dbdb" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">使用树莓和GPIO</h1><p id="0af6" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">一旦我们开始通过树莓控制这个东西，真正的乐趣就开始了。然而，在“控制”部分开始之前，我们可以简单地将a 3.3或5V引脚连接到同一电路。</p><h1 id="5579" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">引脚布局</h1><p id="5233" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">对于这个<a class="ae ll" href="https://pinout.xyz/" rel="noopener ugc nofollow" target="_blank"> pinout.xyz </a>是一个方便的资源:它显示了你各自的覆盆子的布局。一般来说，看起来是这样的:</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi no"><img src="../Images/ce126905be0c5cba023dc31bdb4225c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*k5d9JoKV_egVhzEK.png"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">从<a class="ae ll" href="https://pinout.xyz/" rel="noopener ugc nofollow" target="_blank">引脚排列xyz </a></p></figure><p id="7881" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">Adafruit看到了一个非常方便的小连接器，<a class="ae ll" href="https://www.adafruit.com/product/2028" rel="noopener ugc nofollow" target="_blank"> T-Cobbler </a>，它可以扩展这些引脚，并将它们标记在试验板上使用。</p><p id="69e0" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">有了这方面的知识，我们可以连接第1、2、4或17针以及我们选择的地线，获得漂亮的灯光:</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi mk"><img src="../Images/13e2c6b73b449c4257db8d391ce166ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oE4BGaMTjRiJQ40g.jpg"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">数字输入/输出(按作者)</p></figure><p id="d00b" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">然而，这仍然是模拟的，只是从计算机中获取电源。为了通过软件控制它，我们将使用GPIO，或“通用输入/输出”。这个名副其实的库可以寻址所有的GPIO引脚。</p><p id="a087" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">解决这些问题的最简单方法是给出两个输入之一:<code class="fe nj nk nl nm b">GPIO.HIGH</code> (3.3V)或<code class="fe nj nk nl nm b">GPIO.LOW</code> (0V)。</p><h1 id="8bce" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">练习:莫尔斯电码</h1><p id="49c1" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">我用这些知识做过一个有趣的小练习，就是用GPIO和下面的电路写一个莫尔斯电码发送器:</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ku"><img src="../Images/b478a4496ad5d2594f7a1dc2e7771fd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Py_AFrGQG5cNGZUn.png"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">莫尔斯电码电路(作者)</p></figure><p id="62fa" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这与LED显示器几乎相同，只是增加了一个扬声器和一个UV LED，用于指示完整的“发送”。下面gif中的版本还包括一个毫无意义的“发送完毕”信号LED。</p><p id="e417" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">结果是这样的:</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi np"><img src="../Images/844834a6eed393dd0c1f8186b546c5d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/0*tHfKCPjceGJ7_D7q.gif"/></div><p class="lg lh gj gh gi li lj bd b be z dk translated">莫尔斯电码在行动(作者)</p></figure><p id="d497" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">垃圾代码在这里，如果你关心的话:</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="ffe8" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这真的没有意义，但看到它的运行很有趣——它只是将莫尔斯字母表翻译成定义的长度和中断，并发送一个<code class="fe nj nk nl nm b">GPIO.HIGH</code>信号，然后是一个睡眠定时器，和一个<code class="fe nj nk nl nm b">GPIO.LOW</code>信号来关闭它。</p><p id="ff57" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在，我们从给LED供电发展到通过代码控制LED和扬声器——非常简单！</p><h1 id="3460" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">分线板和I2C</h1><p id="a2a3" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">有了这些基础知识，我们终于可以看看分线板了——带有数字或模拟输出的小电路，我们可以通过软件与之对话(而不仅仅是说“通电”/“断电”)。从软件的角度来看，事情变得更有趣了。</p><p id="2b53" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们将看看这一系列传感器中最简单的传感器，<code class="fe nj nk nl nm b">MCP9808</code>温度传感器。</p><h1 id="1c3a" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">焊接</h1><p id="4bb7" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">无论您选择哪种电路板，第一步都应该将电路板焊接到(通常提供的)插头连接器上，否则就不可能获得稳定的连接。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi nn"><img src="../Images/c7c061235dc87088e7154489a1a9ad0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9mBdX9AWvpa_KufJ.jpg"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">焊料#1(作者)</p></figure><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi nn"><img src="../Images/ec73d840f22ac61fc2302e406b358b76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ftqr0sk4GEgyBd-A.jpg"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">焊料#1(显然是作者写的)</p></figure><p id="efca" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我对此没有任何建议——我得到的最好的建议是使用比你需要的更多的焊丝，并确保工件放在稳定的底座上(如试验板)。这符合“PVC管和防松鼠的鸟网”式的生活方式，但它确实有效。</p><p id="1803" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">然而，Adafruit上面有一个很棒的<a class="ae ll" href="https://learn.adafruit.com/adafruit-guide-excellent-soldering" rel="noopener ugc nofollow" target="_blank">指南</a>。</p><h1 id="ee14" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">I2C</h1><p id="ecf0" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">从那里，我们实际上可以开始使用<code class="fe nj nk nl nm b">I2C</code>:</p><blockquote class="ns nt nu"><p id="d29e" class="lm ln mq lo b lp lq lr ls lt lu lv lw nv ly lz ma nw mc md me nx mg mh mi mj ij bi translated"><strong class="lo ja"><em class="iq"/></strong><em class="iq">(</em><strong class="lo ja"><em class="iq">Inter-Integrated Circuit</em></strong><em class="iq">)，读作I-squared-C，是飞利浦半导体(现为恩智浦半导体)于1982年发明的同步、多主、多从、分组交换、单端、串行通信总线。它广泛用于在短距离板内通信中将低速外设IC连接到处理器和微控制器。或者，I2C有时被拼写为I2C(发音为I-two-C)或IIC(发音为I-I-C)。</em></p><p id="8034" class="lm ln mq lo b lp lq lr ls lt lu lv lw nv ly lz ma nw mc md me nx mg mh mi mj ij bi translated"><a class="ae ll" href="https://en.wikipedia.org/wiki/I%C2%B2C" rel="noopener ugc nofollow" target="_blank"><em class="iq">https://en.wikipedia.org/wiki/I%C2%B2C</em></a></p></blockquote><p id="eadc" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">简单地说，I2C能做的不仅仅是告诉我们的电路“通电”和“断电”。这是一个低级的消息总线。</p><p id="8243" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">I2C使用2条线— <code class="fe nj nk nl nm b">SCL</code>和<code class="fe nj nk nl nm b">SDA</code>。<code class="fe nj nk nl nm b">SCL</code>同步数据，而<code class="fe nj nk nl nm b">SDA</code>发送和接收数据。除此之外，另外2根导线承载电源和接地。作为一条消息总线，I2C也遵循主从模式:我们可以使用许多连接到一条消息总线的设备。设备可以使用寄存器，这些寄存器可以是用户可寻址的。</p><h1 id="e8f5" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">从头开始实施MCP9808通信</h1><p id="4dac" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">物理通信由各个芯片的供应商概述。例如，小的<a class="ae ll" href="https://www.microchip.com/wwwproducts/en/MCP9808" rel="noopener ugc nofollow" target="_blank"> MCP9808 </a>在其<a class="ae ll" href="https://ww1.microchip.com/downloads/en/DeviceDoc/MCP9808-0.5C-Maximum-Accuracy-Digital-Temperature-Sensor-Data-Sheet-DS20005095B.pdf" rel="noopener ugc nofollow" target="_blank">规范</a>中精确地解释了它是如何工作的。</p><p id="6f5a" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们需要先连接它:</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ny"><img src="../Images/4c673c955ea941c8c9791e16c696109d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ev7-jXor4nU74uBn.png"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated"><a class="ae ll" href="https://learn.adafruit.com/assets/58808" rel="noopener ugc nofollow" target="_blank">资料来源</a>，Kattni Rembor，CC BY-SA 3.0</p></figure><p id="8779" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">或者身体上:</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi nn"><img src="../Images/f70d043b1be94eb78dcde027a950cf64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0dewK8EUJTgHs_J6.jpg"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">意大利面(作者)</p></figure><p id="ff54" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">使用<code class="fe nj nk nl nm b">i2cdetect</code>，我们可以观察连接的i2c设备:</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="3e70" class="od jx iq nm b gy oe of l og oh">pi @ 4g-raspberrypi ➜  ~  sudo i2cdetect -y 1<br/><br/>     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f<br/>00:          -- -- -- -- -- -- -- -- -- -- -- -- -- <br/>10: -- -- -- -- -- -- -- -- 18 -- -- -- -- -- -- -- <br/>20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- <br/>30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- <br/>40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- <br/>50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- <br/>60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- <br/>70: -- -- -- -- -- -- -- --</span></pre><p id="05ef" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果我们现在想从获取温度，我们知道默认的<em class="mq">地址</em>是<code class="fe nj nk nl nm b">0x18</code>，寄存器映射如下:</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi oi"><img src="../Images/5b16f425ea9e42c0d185dca5d2ceb78a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5qhpUpkEoPELelvESP5GKQ.png"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">引出线(按作者)</p></figure><p id="49b4" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">其中<code class="fe nj nk nl nm b">TA</code>或<code class="fe nj nk nl nm b">0x05</code>是当前温度的寄存器(该寄存器是只读的)。</p><p id="df4a" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">电路物理连接后，我们可以通过软件检查状态:</p><p id="74a6" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果我们只是使用<a class="ae ll" href="https://pypi.org/project/smbus2/" rel="noopener ugc nofollow" target="_blank"> smbus2库</a>在<code class="fe nj nk nl nm b">Python</code>中读取它们:</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="7070" class="od jx iq nm b gy oe of l og oh">from smbus2 import SMBus<br/>import time<br/><br/>registers = {<br/>    'CONFIG': 0x01,<br/>    'TUPPER': 0x02,<br/>    'TLOWERL': 0x03,<br/>    'TCRIT': 0x04,<br/>    'TA': 0x05,<br/>    'MANUFACTURER_ID': 0x06,<br/>    'DEVICE_ID': 0x07,<br/>    'RESOLUTION': 0x08,<br/>}<br/><br/>bus = SMBus(1)<br/>address = 0x18<br/><br/>for k in registers:<br/>    dat = bus.read_word_data(0x18, registers[k])<br/>    print('{} -&gt; {}'.format(k, dat))</span></pre><p id="bdf7" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们会看到:</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="37b9" class="od jx iq nm b gy oe of l og oh">CONFIG -&gt; 0<br/>TUPPER -&gt; 0<br/>TLOWERL -&gt; 0<br/>TCRIT -&gt; 0<br/>TA -&gt; 26817<br/>MANUFACTURER_ID -&gt; 21504<br/>DEVICE_ID -&gt; 4<br/>RESOLUTION -&gt; 259</span></pre><p id="627a" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这显然还不是有用的值。</p><p id="d78f" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在，自然地，我们需要解析这些数据来理解它。</p><blockquote class="ns nt nu"><p id="e3e6" class="lm ln mq lo b lp lq lr ls lt lu lv lw nv ly lz ma nw mc md me nx mg mh mi mj ij bi translated"><em class="iq">数字字载入16位只读环境温度寄存器(TA ),该寄存器包含13位二进制补码格式的温度数据</em></p><p id="4180" class="lm ln mq lo b lp lq lr ls lt lu lv lw nv ly lz ma nw mc md me nx mg mh mi mj ij bi translated"><em class="iq">……</em></p><p id="4a52" class="lm ln mq lo b lp lq lr ls lt lu lv lw nv ly lz ma nw mc md me nx mg mh mi mj ij bi translated"><em class="iq">要将TA位转换为十进制温度，必须输出高三位边界位(TA &lt; 15:13 &gt;)。然后，确定符号位(位12)以检查正或负温度，相应地移位这些位，并合并16位寄存器的高字节和低字节。</em></p><p id="6ce4" class="lm ln mq lo b lp lq lr ls lt lu lv lw nv ly lz ma nw mc md me nx mg mh mi mj ij bi translated"><em class="iq">高位字节包含温度高于+32°C的数据，而低位字节包含温度低于+32°C的数据，包括分数数据。</em></p><p id="de95" class="lm ln mq lo b lp lq lr ls lt lu lv lw nv ly lz ma nw mc md me nx mg mh mi mj ij bi translated"><em class="iq">组合高位和低位字节时，高位字节必须右移4位(或乘以2⁴),低位字节必须左移4位(或乘以2⁴).</em></p><p id="abba" class="lm ln mq lo b lp lq lr ls lt lu lv lw nv ly lz ma nw mc md me nx mg mh mi mj ij bi translated"><em class="iq">将移位值的结果相加得到十进制格式的温度数据(见等式5–1)。</em></p><p id="31a4" class="lm ln mq lo b lp lq lr ls lt lu lv lw nv ly lz ma nw mc md me nx mg mh mi mj ij bi translated"><em class="iq">(</em><a class="ae ll" href="https://ww1.microchip.com/downloads/en/DeviceDoc/MCP9808-0.5C-Maximum-Accuracy-Digital-Temperature-Sensor-Data-Sheet-DS20005095B.pdf" rel="noopener ugc nofollow" target="_blank"><em class="iq">https://ww1 . microchip . com/downloads/en/device doc/MCP 9808-0.5C-Maximum-Accuracy-Digital-Temperature-Sensor-Data-Sheet-ds 20005095 b . pdf</em></a><em class="iq">)</em></p></blockquote><p id="ff81" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果我们想保持简单，我们需要做的就是遵循文档:</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="dfde" class="od jx iq nm b gy oe of l og oh"># Parse temp<br/>v = bus.read_word_data(0x18, 0x05)<br/># Split in 2-complements<br/>ub=v &amp; 0xFF<br/>lb=(v &gt;&gt; 8) &amp; 0xFF<br/># Clear flags / take lower 13<br/>ub = ub &amp; 0x1F<br/># Check for negative values<br/>if (ub &amp; 0x10) == 0x10:<br/>    ub = ub &amp; 0x0F<br/>    t = 256 - (ub * 16 + lb/16)<br/>else:<br/>    t = ub * 16 + lb / 16<br/>print('Current temp: {}C'.format(t))</span></pre><p id="a045" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们得到<code class="fe nj nk nl nm b">22.6875C</code>，72.8华氏度，和房间里的其他温度计一致。</p><p id="b6d1" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在，如果你和我一样，从大学开始你就没有做过很多移位，但这里是我最好的尝试来解释在这里做什么，在哪里做，为什么:</p><ul class=""><li id="9eca" class="mu mv iq lo b lp lq lt lu lx mw mb mx mf my mj mz na nb nc bi translated">原始读数是十进制的<code class="fe nj nk nl nm b">27585</code>，所以是二进制的<code class="fe nj nk nl nm b">110 1011 1100 0001</code></li><li id="55b8" class="mu mv iq lo b lp nd lt ne lx nf mb ng mf nh mj mz na nb nc bi translated"><code class="fe nj nk nl nm b">v &amp; 0xFF</code>是相对于<code class="fe nj nk nl nm b">1111 1111</code>的位掩码(<code class="fe nj nk nl nm b">XOR</code>)，用于获取高8位(因为我们得到一个包含整数和小数部分的16位寄存器)。<code class="fe nj nk nl nm b">&amp;</code>是一个逻辑<code class="fe nj nk nl nm b">XOR</code>(异或)运算，用于位屏蔽(提取位，如果你愿意的话)。</li></ul><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="239c" class="od jx iq nm b gy oe of l og oh">1	1	0	1	0	1	1	1	1	0	0	0	0	0	1 XOR 1	1	1	1	1	1	1	1 1	1	0	0	0	0	0	1</span><span id="45c0" class="od jx iq nm b gy oj of l og oh">1	1	0	1	0	1	1	1	1	0	0	0	0	0	1 &gt;&gt; 8 0	1	1	0	1	0	1	1 XOR 1	1	1	1	1	1	1	1 0	1	1	0	1	0	1	1</span><span id="167c" class="od jx iq nm b gy oj of l og oh">1	1	0	0	0	0	0	1 XOR 1	1	1	1	1 1</span></pre><p id="d346" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们现在可以用它乘以2⁴=16，得到一个浮点结果:<code class="fe nj nk nl nm b">t = ub * 16 + lb / 16</code></p><p id="e21b" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">或者使用更多的按位逻辑并将结果作为整数:<code class="fe nj nk nl nm b">(lb &gt;&gt; 4) + (ub &lt;&lt; 4)</code></p><p id="b1af" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">Tadaa！只用了一个<em class="mq">位</em>的逐位数学来读取电路板的传感器。当然，我们也可以写入寄存器，但我离题了。</p><h1 id="f604" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">使用图书馆</h1><p id="f3c5" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">现在，虽然这无疑对我有教育意义，让我了解供应商如何实现这些芯片，如何解决它们的“低级”问题，并自己编写代码，自然，几乎总是有可用的驱动程序和/或库。</p><p id="4357" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><a class="ae ll" href="https://github.com/adafruit/Adafruit_MCP9808_Library" rel="noopener ugc nofollow" target="_blank">这里的</a>是C++中的一个，这里的<a class="ae ll" href="https://github.com/adafruit/Adafruit_CircuitPython_MCP9808" rel="noopener ugc nofollow" target="_blank">这里的</a>是Adafruit当前的Python实现，它简化了很多:</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="a4e6" class="od jx iq nm b gy oe of l og oh">from board import *<br/>import busio<br/>import adafruit_mcp9808<br/><br/># Do one reading<br/>with busio.I2C(SCL, SDA) as i2c:<br/>    t = adafruit_mcp9808.MCP9808(i2c)<br/><br/>    # Finally, read the temperature property and print it out<br/>    print(t.temperature)</span></pre><p id="30f1" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这就是我们未来将使用的工具。</p><h1 id="594c" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">光传感器</h1><p id="a731" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">上面的练习涵盖了温度——无论我们自己做数学还是依靠图书馆，我们都可以得到温度。阳光是一个不同的问题。</p><h1 id="92c0" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">紫外线指数与光照水平和总日射表</h1><p id="41b7" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">因为我们在研究植物维护，所以我们在寻找“阳光照射”这一抽象指标，从家得宝到当地苗圃的每一包种子和每一株植物都提到了这个指标。</p><p id="6df8" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这个指标的问题在于，它非常主观且不科学，至少对于面向消费者的产品来说是如此。一般来说，我们想看看<code class="fe nj nk nl nm b">W/sqm</code>的太阳辐照度，但我们马上就会明白为什么这并不简单。</p><p id="e588" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们能不能把紫外线，一种经常被测量和报道的东西(因此可以作为便宜的电路板)作为一种替代物？</p><blockquote class="ns nt nu"><p id="db20" class="lm ln mq lo b lp lq lr ls lt lu lv lw nv ly lz ma nw mc md me nx mg mh mi mj ij bi translated"><em class="iq">紫外线指数是一个与地球表面某一点产生晒伤的紫外线辐射强度成线性关系的数字。</em></p><p id="fb6f" class="lm ln mq lo b lp lq lr ls lt lu lv lw nv ly lz ma nw mc md me nx mg mh mi mj ij bi translated"><em class="iq">它不能简单地与辐照度(以W/m2为单位测量)相关，因为最受关注的紫外线占据了295至325纳米的波长光谱，当它们到达地球表面时，更短的波长已经被吸收了很多</em></p><p id="14e8" class="lm ln mq lo b lp lq lr ls lt lu lv lw nv ly lz ma nw mc md me nx mg mh mi mj ij bi translated"><a class="ae ll" href="https://en.wikipedia.org/wiki/Ultraviolet_index" rel="noopener ugc nofollow" target="_blank"><em class="iq">https://en.wikipedia.org/wiki/Ultraviolet_index</em></a></p></blockquote><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ok"><img src="../Images/a28cbb2f2e96955cf02b03e59469fb0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_jdSpGo_Ahoi11BE.png"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated"><a class="ae ll" href="https://en.wikipedia.org/wiki/Ultraviolet_index" rel="noopener ugc nofollow" target="_blank"><em class="lk">https://en.wikipedia.org/wiki/Ultraviolet_index</em></a></p></figure><p id="1fd4" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们所知道的是:植物<em class="mq">确实会对紫外线或紫外线辐射做出反应，特别是UV-B(280-320纳米)和UV-A(320-400纳米)，与人类一样——它会导致细胞损伤，并且有人假设植物可以预测紫外线模式并做出相应的反应。[1] [2] [3]</em></p><p id="9dff" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">紫外线指数从0到12不等，实际上是为了让我们了解晒太阳对人类有多大风险。</p><p id="73cd" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">也就是说，紫外线是植物生长所需的<em class="mq">阳光</em>的副作用(或者子集)——紫外线-A约占太阳能的4.9%，而紫外线-B约占0.1%，在冬季几乎无法测量。[4]</p><p id="b780" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们真正想知道的是<em class="mq">太阳强度</em>。为了测量太阳强度，人们使用一种称为<em class="mq">日射强度计</em>的设备，这是一种(昂贵的)机器，使用硅光电池(想想光伏电池)，补偿太阳角度，并产生一种确定太阳辐照度的确定性方法，通常以W/sqm为单位。[5]</p><p id="fe05" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">日射强度计(顺便说一下，它的意思是“天空火测量”，这是一种很好的金属)的问题是它们的超级利基用例，因此成本巨大——即使是业余气象学家最便宜的也要超过100美元。我只想种些辣椒。</p><p id="b5a0" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">[1]<a class="ae ll" href="https://www.frontiersin.org/articles/10.3389/fpls.2014.00474/full" rel="noopener ugc nofollow" target="_blank">https://www . frontiersin . org/articles/10.3389/fpls . 2014.00474/full</a>【2】<a class="ae ll" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC160223/pdf/041353.pdf" rel="noopener ugc nofollow" target="_blank">https://www . NCBI . NLM . NIH . gov/PMC/articles/PMC 160223/pdf/041353 . pdf</a>【3】<a class="ae ll" href="https://www.rs-online.com/designspark/the-importance-of-ultraviolet-in-horticultural-lighting" rel="noopener ugc nofollow" target="_blank">https://www . RS-online . com/design spark/the-importance-of-ultraviolet-of</a></p><h1 id="0efd" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">紫外线传感器</h1><p id="4841" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">正如我之前一直回避的那样，对于紫外线传感器，我看了两个选项:<a class="ae ll" href="https://www.adafruit.com/product/1777" rel="noopener ugc nofollow" target="_blank"> SI1145 </a>或<a class="ae ll" href="https://www.adafruit.com/product/2899" rel="noopener ugc nofollow" target="_blank"> VEML6070 </a>，前者是更贵的选项。</p><p id="2a31" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><code class="fe nj nk nl nm b">VEML6070</code>包含一个实际的UV-A传感器。</p><p id="e265" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">另一方面，<code class="fe nj nk nl nm b">SI1145</code>可以计算紫外线指数，但是<em class="mq">不包含实际的紫外线传感器。根据产品说明，它使用可见光和红外光来计算紫外线指数。</em></p><p id="94db" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">让<code class="fe nj nk nl nm b">SI1145</code>有趣的是，我们可以用它来绕过它的卖点，即紫外读数，获得可见光和红外(IR)光读数。</p><p id="4274" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">使用<a class="ae ll" href="https://github.com/THP-JOE/Python_SI1145" rel="noopener ugc nofollow" target="_blank">库</a>，我们可以收集<a class="ae ll" href="https://cdn-shop.adafruit.com/datasheets/Si1145-46-47.pdf" rel="noopener ugc nofollow" target="_blank">度量</a>如下:</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="283b" class="od jx iq nm b gy oe of l og oh">import SI1145.SI1145 as SI1145<br/><br/>sensor = SI1145.SI1145()<br/>vis = sensor.readVisible()<br/>IR = sensor.readIR()<br/>UV = sensor.readUV()<br/>uvIndex = UV / 100.0<br/>print('Visible:  {}'.format(vis))<br/>print('IR:       {}'.format(IR))<br/>print('UV Index: {}'.format(uvIndex))</span></pre><p id="1980" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">遗憾的是，这些都是相对指标，本身并没有太大意义——但这是收集紫外线指数(主要针对园丁)和某种可见光和红外光指标的开始。</p><h1 id="c6cc" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">勒克斯传感器</h1><p id="f436" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">对于种植植物来说，W/sqm的“下一个最好的东西”(至少是我能想到的)是SI单位lux:</p><blockquote class="ns nt nu"><p id="6696" class="lm ln mq lo b lp lq lr ls lt lu lv lw nv ly lz ma nw mc md me nx mg mh mi mj ij bi translated">它等于每平方米一流明。在光度学中，这被用作人眼所感知的、撞击或穿过表面的光的强度的量度。它类似于辐射单位瓦特每平方米，但每个波长的功率根据光度函数加权，光度函数是人类视觉亮度感知的标准化模型。在英语中，“lux”既有单数形式也有复数形式。</p><p id="2af4" class="lm ln mq lo b lp lq lr ls lt lu lv lw nv ly lz ma nw mc md me nx mg mh mi mj ij bi translated"><a class="ae ll" href="https://en.wikipedia.org/wiki/Lux" rel="noopener ugc nofollow" target="_blank">T3【https://en.wikipedia.org/wiki/Lux】T5</a></p></blockquote><p id="72d6" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">虽然这测量的是可见光，而不是用于光合作用的“原始”能量，但除了观察“相对”可见光和紫外线之外，它仍然是一个很好的指标。换句话说，虽然它可能会给我们一个稀释的指标(因为它与可见光的光谱一致)，但它仍然可以与其他指标结合使用。</p><p id="2aa8" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">为此，我找到了3个传感器:<a class="ae ll" href="https://www.adafruit.com/product/4162" rel="noopener ugc nofollow" target="_blank"> Adafruit VEML7700 </a>(最高120k lux)<a class="ae ll" href="https://www.adafruit.com/product/1980" rel="noopener ugc nofollow" target="_blank">Adafruit tsl 2591</a>(最高88k lux)，以及<a class="ae ll" href="https://smile.amazon.com/NOYITO-MAX44009-Intensity-Interface-Development/dp/B07HFRS8XX" rel="noopener ugc nofollow" target="_blank"> NOYITO MAX44009 </a>(最高188k lux)。当然，还有其他选择。</p><p id="ab95" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">明亮的阳光可以达到100，000勒克斯以上，所以列表中的第一个和最后一个传感器可能更好。</p><p id="093f" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><strong class="lo ja">注意</strong> : <em class="mq">在撰写本文时，两个lux传感器都还没有到达。您将在下面读到的大多数内容因此仅支持来自UV传感器</em>的可见光的相对测量。</p><h1 id="9ee8" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">模拟传感器和土壤湿度</h1><p id="7dd1" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">我们以前使用的传感器都是带有数字输出的I2C传感器。但是模拟呢？</p><p id="6ff7" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">嗯，不用担心——我买的电阻式土壤湿度传感器提供数字和模拟输出。然而，亚马逊的评论抱怨说，“手动和数字输出是有限的，模拟工作还好”。那么，如何读取模拟数据呢？</p><p id="05b3" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">当然是用ADC！对于那些对高保真感兴趣的人来说，你可能拥有一个DAC(顺便说一下，Schiit生产的很棒的DAC起价为99美元)——一个数模转换器。然而，在这个用例中，我们需要一个模数转换器。</p><p id="1764" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我使用的是带SPI接口的<a class="ae ll" href="https://www.adafruit.com/product/856" rel="noopener ugc nofollow" target="_blank"> MCP3008 8通道10位ADC。它使用SPI或串行外设接口，而不是I2C。虽然我不是这两方面的专家，但正如本文所证明的，SPI和I2C是相似的，但SPI使用更多的引脚:</a></p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/ec1da0a3eceae7ae75636976e558791d.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/0*9lhcNU80XhVFqXX1.gif"/></div><p class="lg lh gj gh gi li lj bd b be z dk translated"><a class="ae ll" href="https://learn.adafruit.com/assets/1222" rel="noopener ugc nofollow" target="_blank">来源</a>，迈克尔·斯克拉尔，CC BY-SA 3.0</p></figure><p id="df84" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这意味着我们可以这样连接它:</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ku"><img src="../Images/5944ad639ebba2fee12279aaad803613.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BG9PdpE0y_tZlODD.png"/></div></div></figure><p id="ea02" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">连接，它看起来像这样，使用这个非常可爱的长颈鹿锅作为主题:</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi nn"><img src="../Images/f26029bd794183e2a6509d9fea01f2a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Y4Dx5Ud0yRLmGGu_.jpg"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">长颈鹿博士(作者)</p></figure><p id="d58d" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">(请忽略电工胶带，我在高度专业的标准下操作)</p><p id="b4b2" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们试图读取的是电阻——如果两个探针之间的电阻上升，土壤就更干燥。当然，这种测量有点主观，所以我们必须校准它。</p><p id="023c" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">对于从板I/O引脚25上的引脚0数字读取原始数据(持续60秒)，我们可以使用以下代码片段:</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="c033" class="od jx iq nm b gy oe of l og oh">import busio<br/>import digitalio<br/>import board<br/>import adafruit_mcp3xxx.mcp3008 as MCP<br/>from adafruit_mcp3xxx.analog_in import AnalogIn<br/> <br/># create the spi bus<br/>spi = busio.SPI(clock=board.SCK, MISO=board.MISO, MOSI=board.MOSI)<br/> <br/># create the cs (chip select)<br/>cs = digitalio.DigitalInOut(board.25)<br/> <br/># create the mcp object<br/>mcp = MCP.MCP3008(spi, cs)<br/> <br/># create an analog input channel on pin 0<br/>chan0 = AnalogIn(mcp, MCP.P0)<br/><br/>readings = []<br/>i = 0<br/>for x in range(0,60):<br/>    i += 1<br/>    val = chan0.value<br/>    volt = chan0.voltage<br/>    readings.append(volt)<br/>    if int(val) != 0:<br/>        print('Raw ADC Value: {}'.format(val))<br/>        print('ADC Voltage: {} V'.format(chan0.voltage))<br/>    time.sleep(1)<br/><br/>avg = statistics.mean(readings)<br/>print('Avg voltage: {}'.format(avg))</span></pre><p id="321f" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这给了我们每秒一个原始读数。</p><p id="fa3f" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在一个相当潮湿的长颈鹿罐子里，我们得到的读数大约是</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="a83b" class="od jx iq nm b gy oe of l og oh">Raw ADC Value: 30144<br/>ADC Voltage: 1.5146715495536736 V</span></pre><p id="6ba2" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">或者平均来说是1.5144。</p><p id="826d" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在，请记住，如果你没有连接一个东西，这也会给你读数:</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="d2f9" class="od jx iq nm b gy oe of l og oh"># Reading on an unconnected channel P2<br/>Raw ADC Value: 448<br/>ADC Voltage: 0.0 V<br/>Raw ADC Value: 512<br/>ADC Voltage: 0.0 V<br/>Avg voltage: 0.004619211108567941</span></pre><p id="9b1c" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">但是你可以忽略那些读数。我认为这是任何ADC的自然产物——电流的自然波动+ Python固有的<code class="fe nj nk nl nm b">float</code>不精确性。</p><p id="5c22" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果在不同的通道上连接一个电位器(上图可以看到！)，您实际上可以看到这些波动，从技术上讲，电压应该保持不变，但事实并非如此:</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="ce3b" class="od jx iq nm b gy oe of l og oh">readings = [3.2968276493476765, 3.280714122224765, 3.280714122224765, 3.280714122224765, 3.2839368276493475, 3.280714122224765, 3.280714122224765, 3.2936049439230946, 3.2839368276493475, 3.2839368276493475, 3.277491416800183, 3.280714122224765, 3.280714122224765, 3.277491416800183, 3.2936049439230946, 3.28715953307393, 3.280714122224765, 3.277491416800183, 3.2936049439230946, 3.277491416800183, 3.2839368276493475, 3.28715953307393, 3.280714122224765, 3.280714122224765, 3.2839368276493475, 3.280714122224765, 3.2839368276493475, 3.28715953307393, 3.280714122224765, 3.280714122224765, 3.280714122224765, 3.2839368276493475, 3.280714122224765, 3.277491416800183, 3.2936049439230946, 3.2710460059510185, 3.2839368276493475, 3.280714122224765, 3.290382238498512, 3.280714122224765, 3.277491416800183, 3.280714122224765, 3.28715953307393, 3.2839368276493475, 3.280714122224765, 3.280714122224765, 3.28715953307393, 3.2839368276493475, 3.2839368276493475, 3.2839368276493475, 3.2839368276493475, 3.2839368276493475, 3.2742687113756004, 3.290382238498512, 3.2936049439230946, 3.28715953307393, 3.277491416800183, 3.280714122224765, 3.28715953307393, 3.290382238498512]<br/>statistics.stdev(v)<br/># 0.0051783580637861605</span></pre><p id="0c59" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">stdev只有0.005178，但是它在那里。湿度传感器正以0.002305的标准偏差引入同样强的波动。</p><p id="1311" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在任何情况下，同样的实验在干土罐上产生的平均电压为2.6。</p><p id="a6ac" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">所以我们可以得出结论:</p><ul class=""><li id="7f26" class="mu mv iq lo b lp lq lt lu lx mw mb mx mf my mj mz na nb nc bi translated"><strong class="lo ja">干土</strong> : 2.6V</li><li id="d4f1" class="mu mv iq lo b lp nd lt ne lx nf mb ng mf nh mj mz na nb nc bi translated"><strong class="lo ja">潮湿土壤</strong> : 1.5V</li><li id="6183" class="mu mv iq lo b lp nd lt ne lx nf mb ng mf nh mj mz na nb nc bi translated"><strong class="lo ja">一杯水</strong>:0.77伏</li></ul><h1 id="d958" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">把所有的放在一起</h1><p id="695d" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">总装！</p><h1 id="7216" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">最终试验板布局</h1><p id="ca2f" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">连接所有传感器后，布局如下:</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ku"><img src="../Images/ee7c13fe974c78a43cc976de1447514b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VZd86TF5yuOsRwSC.png"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">最终布局(作者)</p></figure><h1 id="773c" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">一个简单的REST API就可以做到</h1><p id="e19c" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">我们可以通过网络发送收集的数据。有人可能会想出一个奇特的消息队列，但我认为一个简单的本地化REST API目前就能解决问题——<code class="fe nj nk nl nm b">AWS Greengrass</code>、Meme-Microservices、<code class="fe nj nk nl nm b">Kafka</code>等其他应用程序还需要等待。我们每10秒钟发送一个数据包，并将其存储在这样的数据库中:</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="4427" class="od jx iq nm b gy oe of l og oh">CREATE OR REPLACE TABLE `sensors`.`data` (<br/>    `sensorId`	            TEXT,<br/>    `TempC`	                FLOAT,<br/>    `VisLight`	            FLOAT,<br/>    `IrLight`               FLOAT,<br/>    `UvIx`                  FLOAT,<br/>    `RawMoisture`           FLOAT,<br/>    `VoltMoisture`          FLOAT,<br/>    `MeasurementTs`         TIMESTAMP,<br/>    `lastUpdateTimestamp`   TIMESTAMP<br/>);</span></pre><p id="59cd" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">REST端点用<code class="fe nj nk nl nm b">go</code>编写，并为<code class="fe nj nk nl nm b">x86</code>而不是<code class="fe nj nk nl nm b">ARM</code>编译，并部署在远程服务器上，这样我们就可以支持许多只需要偶尔发送数据的小型微控制器。</p><p id="6c44" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">像往常一样，你可以在<a class="ae ll" href="https://github.com/chollinger93/raspberry-gardener" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到完整的代码，所以我只说一些值得注意的点(这些是通用的<code class="fe nj nk nl nm b">go</code>主题，但值得一提)。</p><p id="c58e" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">首先，使用<a class="ae ll" href="https://github.com/jmoiron/sqlx" rel="noopener ugc nofollow" target="_blank">github.com/jmoiron/sqlx</a>和<a class="ae ll" href="https://github.com/Masterminds/squirrel" rel="noopener ugc nofollow" target="_blank">github.com/Masterminds/squirrel</a>，其设置类似于一个大型<code class="fe nj nk nl nm b">CloudSQL</code>实例所使用的设置类型，这让我感觉很好- <code class="fe nj nk nl nm b">sqlx</code>极好地扩展了<code class="fe nj nk nl nm b">go</code>的常规<code class="fe nj nk nl nm b">sql</code>接口，并且<code class="fe nj nk nl nm b">squirrel</code>可以用来自动执行一些数据库I/O任务。</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="b81e" class="od jx iq nm b gy oe of l og oh">type Sensor struct {<br/>	SensorId     string<br/>	TempC        float32<br/>	VisLight     float32<br/>	IrLight      float32<br/>	UvIx         float32<br/>	RawMoisture  float32<br/>	VoltMoisture float32<br/>    MeasurementTs string<br/>}<br/><br/>func (a *App) storeData(sensors []Sensor) error {<br/>	q := squirrel.Insert("data").Columns("sensorId", "tempC", "visLight", "irLight", "uvIx", "rawMoisture", "voltMoisture", "measurementTs", "lastUpdateTimestamp")<br/>	for _, s := range sensors {<br/>        // RFC 3339<br/>		measurementTs, err := time.Parse(time.RFC3339, s.MeasurementTs)<br/>		if err != nil {<br/>			zap.S().Errorf("Cannot parse TS %v to RFC3339", err)<br/>			continue<br/>		}<br/>		q = q.Values(s.SensorId, s.TempC, s.VisLight, s.IrLight, s.UvIx, s.RawMoisture, s.VoltMoisture, measurementTs, time.Now())<br/>	}<br/>	sql, args, err := q.ToSql()<br/>	if err != nil {<br/>		return err<br/>	}<br/><br/>	res := a.DB.MustExec(sql, args...)<br/>	zap.S().Info(res)<br/>	return nil<br/>}</span></pre><p id="a136" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我也开始越来越多地使用<a class="ae ll" href="https://github.com/uber-go/zap" rel="noopener ugc nofollow" target="_blank">go.uber.org/zap</a>，因为<code class="fe nj nk nl nm b">go</code>的标准日志记录接口让<em class="mq">有很多</em>需要改进的地方。</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="2f38" class="od jx iq nm b gy oe of l og oh">// Logger<br/>logger, _ := zap.NewDevelopment()<br/>defer logger.Sync() // flushes buffer, if any<br/>zap.ReplaceGlobals(logger)</span></pre><p id="0d4c" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">除此之外，代码是一个非常标准的REST API——<code class="fe nj nk nl nm b">App</code>struct保持一个指向DB连接池的指针(跨线程共享),秘密通过环境变量处理，而不是必须实现配置文件和<code class="fe nj nk nl nm b">viper</code>(可能在将来)。</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="f81e" class="od jx iq nm b gy oe of l og oh">type App struct {<br/>	Router *mux.Router<br/>	DB     *sqlx.DB<br/>}<br/><br/>func initTCPConnectionPool() (*sqlx.DB, error) {<br/>	var (<br/>		dbUser    = mustGetenv("DB_USER")<br/>		dbPwd     = mustGetenv("DB_PASS")<br/>		dbTCPHost = mustGetenv("DB_HOST")<br/>		dbPort    = mustGetenv("DB_PORT")<br/>		dbName    = mustGetenv("DB_NAME")<br/>	)<br/><br/>	var dbURI string<br/>	dbURI = fmt.Sprintf("%s:%s@tcp(%s:%s)/%s?parseTime=true", dbUser, dbPwd, dbTCPHost, dbPort, dbName)<br/><br/>	dbPool, err := sqlx.Open("mysql", dbURI)<br/>	if err != nil {<br/>		return nil, fmt.Errorf("sql.Open: %v", err)<br/>	}<br/><br/>	configureConnectionPool(dbPool)<br/>	return dbPool, nil<br/>}</span></pre><p id="37ea" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如此构建:</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="2956" class="od jx iq nm b gy oe of l og oh"># For x86<br/>GOARCH=amd64 GOOS=linux go build -o /tmp/sensor-server *.go <br/>sudo mkdir -p /opt/raspberry-gardener<br/>sudo cp /tmp/sensor-server /opt/raspberry-gardener<br/>sudo cp ./.env.sh /opt/raspberry-gardener/<br/>sudo sed -i 's/export //g' /opt/raspberry-gardener/.env.sh</span></pre><p id="1ee1" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">然后我们可以安装一个<code class="fe nj nk nl nm b">systemd</code>服务:</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="349e" class="od jx iq nm b gy oe of l og oh">[Unit]<br/>After=network.target<br/>Wants=network-online.target<br/><br/>[Service]<br/>Restart=always<br/>EnvironmentFile=/opt/raspberry-gardener/.env.sh<br/>WorkingDirectory=/opt/raspberry-gardener<br/>ExecStart=/opt/raspberry-gardener/sensor-server <br/><br/>[Install]<br/>WantedBy=multi-user.target</span></pre><p id="e250" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">并部署:</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="9816" class="od jx iq nm b gy oe of l og oh"># Install `systemd` service:<br/>sudo cp raspberry-gardener.service /etc/systemd/system/<br/>sudo systemctl start raspberry-gardener<br/>sudo systemctl enable raspberry-gardener # Autostart</span></pre><p id="8af5" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">并检查:</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="ac50" class="od jx iq nm b gy oe of l og oh">christian @ bigiron ➜  raspberry-gardener  sudo systemctl status raspberry-gardener<br/>   Loaded: loaded (/etc/systemd/system/raspberry-gardener.service; disabled; vendor preset: enabled)<br/>   Active: active (running) since Sat 2021-04-24 14:12:56 EDT; 17min ago<br/> Main PID: 12312 (sensor-server)<br/>    Tasks: 7 (limit: 4915)<br/>   Memory: 3.0M</span></pre><p id="0cdb" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们将对下面的传感器客户端做同样的事情——详见GitHub。</p><h1 id="e51e" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">一个脚本来统治他们所有人</h1><p id="5b0d" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">为了将发送部分放在一起，我们需要做的就是组合每个传感器的所有单独脚本，混合SPI和I2C，然后发送数据。</p><p id="ae69" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">导入和收集数据非常简单:</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="3a75" class="od jx iq nm b gy oe of l og oh">from board import *<br/>import busio<br/>import adafruit_mcp9808<br/>import SI1145.SI1145 as SI1145<br/>import os<br/>import time<br/>import busio<br/>import digitalio<br/>import board<br/>import adafruit_mcp3xxx.mcp3008 as MCP<br/>from adafruit_mcp3xxx.analog_in import AnalogIn<br/>import platform<br/>import getmac<br/>import requests<br/>import logging<br/>import json<br/>import argparse<br/><br/># mcp9808<br/>def read_temp() -&gt; int:<br/>    with busio.I2C(SCL, SDA) as i2c:<br/>        t = adafruit_mcp9808.MCP9808(i2c)<br/>        return t.temperature<br/><br/># SI1145<br/>def read_uv(sensor: object) -&gt; set:<br/>    vis = sensor.readVisible()<br/>    IR = sensor.readIR()<br/>    UV = sensor.readUV() <br/>    uvIndex = UV / 100.0<br/>    return (vis, IR, uvIndex)<br/><br/># HD-38 (Aliexpress/Amazon)<br/>def read_moisture(spi_chan: object) -&gt; tuple:<br/>    val = spi_chan.value<br/>    volt = spi_chan.voltage<br/>    return (val, volt)</span></pre><p id="a15f" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">由于我们希望每个传感器都有一个唯一的ID(如果我们部署了多个传感器)，因此我们将主机名和网络MAC地址组合成一个字符串:</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="4b54" class="od jx iq nm b gy oe of l og oh">def get_machine_id():<br/>    return '{}-{}'.format(platform.uname().node, getmac.get_mac_address())</span></pre><p id="498d" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">收集循环创建所有访问对象，缓冲数据，过滤无效数据，并将其发送给REST API:</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="8b07" class="od jx iq nm b gy oe of l og oh">def main(rest_endpoint: str, frequency_s=1, buffer_max=10, spi_in=0x0):<br/>    buffer=[]<br/>    ## UV<br/>    uv_sensor = SI1145.SI1145()<br/><br/>    ## SPI<br/>    # create the spi bus<br/>    spi = busio.SPI(clock=board.SCK, MISO=board.MISO, MOSI=board.MOSI)<br/>    # create the cs (chip select)<br/>    cs = digitalio.DigitalInOut(board.CE0)<br/>    # create the mcp object<br/>    mcp = MCP.MCP3008(spi, cs)<br/>    # create an analog input channel on pin 0<br/>    chan0 = AnalogIn(mcp, spi_in)<br/><br/>    while True:<br/>        try:<br/>            # Read<br/>            temp_c = read_temp()<br/>            vis, ir, uv_ix = read_uv(uv_sensor)<br/>            raw_moisture, volt_moisture = read_moisture(chan0)<br/><br/>            # Write<br/>            # temp_c,vis_light,ir_light,uv_ix,raw_moisture,volt_moisture<br/>            reading = {<br/>                'sensorId': get_machine_id(),<br/>                'tempC': temp_c,<br/>                'visLight': vis,<br/>                'irLight': ir,<br/>                'uvIx': uv_ix,<br/>                'rawMoisture': raw_moisture,<br/>                'voltMoisture': volt_moisture,<br/>                'measurementTs': datetime.now(timezone.utc).isoformat() # RFC 333<br/>            }<br/><br/>            # Only send if we have all <br/>            # UV sensor sometimes doesn't play along<br/>            if int(vis) == 0 or int(ir) == 0 or int(volt_moisture) == 0:<br/>                logger.warning('No measurements: {}'.format(reading))<br/>                continue<br/><br/>            buffer.append(reading)<br/>            logger.debug(reading)<br/>            if len(buffer) &gt;= buffer_max:<br/>                logger.debug('Flushing buffer')<br/>                # Send<br/>                logger.debug('Sending: {}'.format(json.dumps(buffer)))<br/>                response = requests.post(rest_endpoint, json=buffer)<br/>                logger.debug(response)<br/>                # Reset<br/>                buffer = []<br/>        except Exception as e:<br/>            logger.exception(e)<br/>        finally:<br/>            time.sleep(frequency_s)</span></pre><p id="082e" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">尽管有缓冲区，它使用了大约16MB的内存，所以我们应该准备好了！</p><h1 id="30cb" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">物理部署</h1><p id="308f" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">通常，当我写软件时，它在这里结束:我写了软件。现在运行它。走开。</p><p id="7662" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">然而，在这个小实验中，还涉及到实际部署它的组件。由于必须在室外，PI和电路板的外壳至少需要半防水，即使只是来自地面的环境湿气。</p><h1 id="8c01" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">愚蠢的问题需要一个Dremel</h1><p id="daf1" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">由于我没有3D打印机(甚至没有更小的试验板)，但我有旧的宜家塑料盒和dremel，所以解决方案很明显:移除Pi鹅卵石，直接连接一些杜邦电缆，将它们放在塑料盒中，钻孔，使用电工胶带“密封”它，然后从以太网转换为WiFi。简单而优雅(需要引用)。我还连接了相机，尽管我还没有对它进行编程。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi om"><img src="../Images/42c9b74b85b1576aa60d59abf90cf250.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JTp0RhqcP3CrEkdW.jpg"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">雄伟的盒子#1(作者)</p></figure><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi nn"><img src="../Images/ba07b0096b01d2b5f1d3ad65a83e8943.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WnvHJQ-44On1eIcH.jpg"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">雄伟的盒子#2(作者)</p></figure><h1 id="d85a" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">第一项户外测试:甲板</h1><p id="f18c" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">然后，在一个阳光明媚的日子里，我把它搬到外面的甲板上(在一场暴风雨后)，迎来了它在野外的第一个大日子(四月！):</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi nn"><img src="../Images/af4d6bb1d4d02fb1ab719f712bf4e8bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ygNc0vCjoOe8UeoZ.jpg"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">部署#1(按作者)</p></figure><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi nn"><img src="../Images/3791723ca28e2eaeacd55912fce42759.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3puDg8YZt0bCQl4x.jpg"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">紫外线传感器(作者)</p></figure><p id="4ff8" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">对于相机拍摄的照片(我是通过SSH触发的):</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi on"><img src="../Images/0d5a810f5c2b4a0e40c231faf98f8673.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZEzfZU6sei6_-v9Z.jpg"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">天空照相机(作者)</p></figure><p id="f3e1" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">然后我启动了两个<code class="fe nj nk nl nm b">systemd</code>服务，等了一会儿。</p><h1 id="850a" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">分析初步数据</h1><p id="5772" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">因为这实际上只运行了很短的时间，所以以下查询就足够了:</p><pre class="kv kw kx ky gt nz nm oa ob aw oc bi"><span id="108a" class="od jx iq nm b gy oe of l og oh">SELECT *, TIMESTAMPDIFF(MINUTE, startTS, endTs) as totalMinMeasured,<br/>CASE WHEN avgVoltMoisture &lt;= 0.90 THEN "wet" <br/>WHEN avgVoltMoisture &gt; 0.9 AND avgVoltMoisture &lt;= 1.7 THEN "moist"<br/>ELSE "dry"  END AS avgWetness<br/>FROM (<br/>	SELECT AVG(TempC) AS avgTemp, AVG(VisLight) AS avgVisLight, AVG(UvIx) as avgUvIx, AVG(VoltMoisture) as avgVoltMoisture,<br/>	MAX(MeasurementTs) as endTS, MIN(MeasurementTs) as startTs<br/>	FROM `sensors`.`data` as d<br/>	WHERE d.MeasurementTs &lt;= TIMESTAMP('2021-04-25 18:25:00')<br/>) e</span></pre><p id="7c31" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这产生了意料之中的结果:</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi oo"><img src="../Images/ba215c6689552b1c15154416c8a2e1ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0SmwjG-Hi9-W4sbf6J74Jg.png"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">部署#1结果(按作者)</p></figure><p id="66c7" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">下午2点左右，甲板上阳光明媚，经过前一天晚上的暴雨，植物是湿的。</p><p id="bbd0" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">但这只是为了确保它的工作！</p><h1 id="faba" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">第二项户外测试:花坛</h1><p id="0463" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">一旦确认一切正常，就该上花园床了。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi nn"><img src="../Images/91edd897dd21317a8396903bebbd16ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1UzWDoXPi5_gtiOc.jpg"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">部署#2(按作者)</p></figure><p id="a8dc" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">相机现在也有了一个更有趣的视角:</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi on"><img src="../Images/59797117b6ef8708e20b872d35ed7ee4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*G6WcRbfpmChb4J0q.jpg"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">天空和一棵树(作者)</p></figure><h1 id="c05b" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">分析:第2部分(w/ Grafana)</h1><p id="e629" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">公平地说，对这个数据集的分析看起来不会有太大的不同——让它运行得更久一点，让我们能够使用Grafana来可视化它:</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi op"><img src="../Images/7958adb313346f3d4e87fffc12f09b8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*f0rh2HFR61lazO8t.png"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">Grafana #1(作者)</p></figure><p id="6fed" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">(<em class="mq">14:20左右</em>传感器从阳光充足的甲板上移到花园的花坛上)</p><p id="2ed5" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我也曾通过SSH手动拍照:</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi on"><img src="../Images/6a41f5b61756449042e58d4fe7fa35c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BvUQ9Rr8stHRFVJq.jpg"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">天空和树#2(作者)</p></figure><p id="057b" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这张照片是在格拉夫纳图的尾端拍摄的(大约1800小时)，而上面这张照片是在大约1430时拍摄的。毫无疑问，你可以在图表上找到这种模式。</p><p id="1815" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">另一个光线指数和紫外线(以及温度)的峰值可以在1700小时左右观测到——这是太阳没有被树木遮挡的时候。</p><p id="522f" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">另一张拍摄于19:30的照片——你可以在照片的左下方看到太阳在植物上的角度发生了变化，但在上面的图表中，其他指标没有太大变化。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi on"><img src="../Images/3f2b3429a8dd8eeea1f3cb5a72edc468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OwG8Zr_8K6EZ7DrV.jpg"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">天空和树#3(作者)</p></figure><p id="4e62" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">尽管缺少Lux传感器，我们也可以在这里对“部分阴影”与“全日照”进行一些有根据的猜测——在这里比较光线和紫外线指数:</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi oq"><img src="../Images/e51067f3a489e82b94b2226564f5df2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LGnsixHCUd_bVYnq.png"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">Grafana #2(作者)</p></figure><p id="0202" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">知道传感器在1420小时左右被移动，我们可以比较明显阳光充足的甲板和床之间的峰值——两者的峰值都在1.65-1.5k”光单位(“来自传感器的可见光”)。</p><p id="3f25" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这也与温度相关:</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi or"><img src="../Images/c165b43961e1136c18d10c9b9713def0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ux5giMkj4Csa_uSH.png"/></div></div><p class="lg lh gj gh gi li lj bd b be z dk translated">Grafana #3(作者)</p></figure><p id="1617" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在下午晚些时候的“高太阳”期间，您可以看到高达约29摄氏度(84.2华氏度)的峰值，甲板上的峰值可达40摄氏度(104华氏度)。</p><p id="f374" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">有趣的是，温度与iPhone天气应用程序记录的温度不符——那应该是恒定的72华氏度(或22.2摄氏度)，而在非高强度时期，床徘徊在18-19度左右。c(64.4–67F)！</p><p id="d19b" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我认为可以公平地说:至少这个特殊的花园床可以称得上是“部分遮阴”,不会像房子的其他部分那样受到强烈的阳光照射。</p><p id="6d36" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">当然，理想情况下，你会想在不同的条件下观察几天——但令人惊讶的是，我现在还不太相信我的特百惠电工胶带盒。但这是一个开始！</p><h1 id="e4d2" class="jw jx iq bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">后续步骤和结论</h1><p id="2991" class="pw-post-body-paragraph lm ln iq lo b lp ml lr ls lt mm lv lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">这是第一部分——虽然它对我来说非常有趣(看到最后的图表真是令人愉快)，我甚至不会假装这个项目非常有用、经济，甚至是<em class="mq">必需的</em>(我的办公室窗户朝向花园……)，但我们仍然有很多事情可以做得更好！</p><ul class=""><li id="b8a4" class="mu mv iq lo b lp lq lt lu lx mw mb mx mf my mj mz na nb nc bi translated">使用便宜得多的电路板，例如Raspberry Zero</li><li id="0613" class="mu mv iq lo b lp nd lt ne lx nf mb ng mf nh mj mz na nb nc bi translated">焊接连接，构建一个紧凑的封装</li><li id="79b0" class="mu mv iq lo b lp nd lt ne lx nf mb ng mf nh mj mz na nb nc bi translated">3D打印出一个真正防水的外壳</li><li id="97e2" class="mu mv iq lo b lp nd lt ne lx nf mb ng mf nh mj mz na nb nc bi translated">部署其中几个并收集一周左右的数据</li><li id="9b19" class="mu mv iq lo b lp nd lt ne lx nf mb ng mf nh mj mz na nb nc bi translated">实现摄像机代码</li><li id="55fa" class="mu mv iq lo b lp nd lt ne lx nf mb ng mf nh mj mz na nb nc bi translated">实施勒克斯传感器(见上文)</li><li id="0199" class="mu mv iq lo b lp nd lt ne lx nf mb ng mf nh mj mz na nb nc bi translated">部署更长的时间以收集更多的数据</li><li id="f97a" class="mu mv iq lo b lp nd lt ne lx nf mb ng mf nh mj mz na nb nc bi translated">微调一些收集参数——目前每小时收集3600个数据点，这可能是不必要的</li><li id="4e7c" class="mu mv iq lo b lp nd lt ne lx nf mb ng mf nh mj mz na nb nc bi translated">对来自摄像机的结构化+非结构化数据运行某种形式的ML模型</li></ul><p id="c1d7" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">所以第二部分可能是合适的——但是我觉得第一部分已经够长了。</p><p id="8706" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">无论如何，我希望您喜欢这个小小的旅程，从复习中学物理，到I2C和SPI的基础知识，到无缘无故地手动移位，到编写REST API和SQL查询，到将一个边上有孔的塑料盒搬到院子里，最后使用一些更普通的数据争论工具集来研究它。我知道我很开心！</p><p id="0c43" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><em class="mq">所有代码在</em> <a class="ae ll" href="https://github.com/chollinger93/raspberry-gardener" rel="noopener ugc nofollow" target="_blank"> <em class="mq"> GitHub </em> </a> <em class="mq">上都有。</em> <em class="mq">所有的开发和基准测试都是在GNU/Linux下完成的【PopOS！在2019 System76 Gazelle笔记本电脑上使用12个英特尔i7–9750h v cores @ 4.5 GHz和16GB RAM，以及Raspberry Pi 4 Model B，使用</em><a class="ae ll" href="https://chollinger.com/blog/2019/04/building-a-home-server/" rel="noopener ugc nofollow" target="_blank"><em class="mq">bigiron . local</em></a><em class="mq">作为端点</em></p></div><div class="ab cl os ot hu ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="ij ik il im in"><p id="722f" class="pw-post-body-paragraph lm ln iq lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><em class="mq">原载于2021年4月25日https://chollinger.com</em><em class="mq">的</em> <a class="ae ll" href="https://chollinger.com/blog/2021/04/raspberry-pi-gardening-monitoring-a-vegetable-garden-using-a-raspberry-pi-part-1/" rel="noopener ugc nofollow" target="_blank"> <em class="mq">。</em></a></p></div></div>    
</body>
</html>