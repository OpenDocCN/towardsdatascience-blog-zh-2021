<html>
<head>
<title>Data Science on Blockchain with R. Part I: Reading the blockchain</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">r .区块链上的数据科学第一部分:阅读区块链</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-science-on-blockchain-with-r-afaf09f7578c?source=collection_archive---------10-----------------------#2021-06-14">https://towardsdatascience.com/data-science-on-blockchain-with-r-afaf09f7578c?source=collection_archive---------10-----------------------#2021-06-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1448" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">数据科学家进入区块链的窗口。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/5c65d28f8ec7c873539a7a8e38338a30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*Ay7deuIIAMLCR3mkMezQNw.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">密码朋克是NFTs的最早版本(<a class="ae kr" href="http://www.larvalabs.com/cryptopunks" rel="noopener ugc nofollow" target="_blank">www.larvalabs.com/cryptopunks</a>)。图片由https://commons.wikimedia.org/wiki/File:Cryptopunks.png的<a class="ae kr" href="https://commons.wikimedia.org/wiki/File:Cryptopunks.png" rel="noopener ugc nofollow" target="_blank">修改而来。</a></p></figure><p id="bcb2" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><em class="lo">Thomas de March in(pharm Alex统计和数据科学高级经理)和Milana Filatenkova(pharm Alex统计和数据科学经理)</em></p><h1 id="d19b" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated"><strong class="ak">简介</strong></h1><p id="dec5" class="pw-post-body-paragraph ks kt iq ku b kv mh jr kx ky mi ju la lb mj ld le lf mk lh li lj ml ll lm ln ij bi translated"><strong class="ku ir"> <em class="lo">什么是区块链:</em> </strong>区块链是一个不断增长的记录列表，称为块，它们使用加密技术链接在一起。它用于记录交易、跟踪资产以及在参与方之间建立信任。区块链主要以比特币和加密货币应用而闻名，现在几乎用于所有领域，包括供应链、医疗保健、物流、身份管理……数百个区块链存在，它们有自己的规范和应用:比特币、以太坊、Tezos……</p><p id="97ae" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><strong class="ku ir"> <em class="lo">什么是NFT:</em></strong>不可替换的令牌用来表示唯一物品的所有权。他们让我们将艺术品、收藏品、甚至房地产等事物符号化。他们一次只能有一个官方所有者，并且他们受到区块链的保护，没有人可以修改所有权记录或复制/粘贴新的NFT。你可能听说过艺术家皮普尔，他以6900万美元的价格卖出了他的一件NFT艺术品。</p><p id="eda2" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><strong class="ku ir"> <em class="lo">什么是R: </em> </strong> R语言在统计学家和数据挖掘者中被广泛用于开发数据分析软件。</p><p id="f869" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><strong class="ku ir"> <em class="lo">为什么在区块链做数据科学:</em> </strong>随着区块链技术的蓬勃发展，越来越需要能够阅读、理解和总结这类信息的工具和人员。</p><p id="1dcf" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><strong class="ku ir"> <em class="lo">什么是API:</em></strong>API是一种软件中介，允许两个应用程序相互对话。API旨在帮助开发人员向另一个软件发出请求(即下载信息)，并以预定义的易读格式获得结果，而不必了解该软件的工作原理。</p><p id="fcba" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在R中已经有几篇关于区块链数据分析的文章，但是大部分集中在价格预测上。获取加密货币价格的数据非常简单，互联网上有许多数据库。但是如何真正读懂区块链呢？在这篇文章中，我们将重点阅读区块链交易。并非所有交易，但特别是与NFTs相关的交易。我们将阅读以太坊区块链，可能是用来交易非功能性交易的顶级场所。有几个市场可以作为NFTs的交易平台:OpenSea，Rarible……我们将在这里集中讨论OpenSea，目前NFT最大的交易平台。</p><p id="2a11" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">阅读区块链的原著是可能的，但是很难。首先，您必须设置一个节点并下载区块链的内容(在撰写本文时大约7TB)。同步可能需要一段时间…其次，数据是按顺序存储的，这需要开发特定的工具来跟踪事务。第三，块的结构特别难读。例如，以太坊网络上的典型交易如下所示。每个块有200到300个事务，在编写本文时，我们处于块12586122。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mm"><img src="../Images/0a15fca7e5bb0d6e93022b22891a3734.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YGv-A8PExl_zOl1zbJDH9w.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">图1:链中的每个块都包含一些数据和一个“哈希”，即使用加密技术从块中包含的数据生成的数字指纹。每个块还包括来自前一个块的散列。这成为用于创建较新块的散列的数据集的一部分，这就是块被组装成链的方式。图片来自ig.com。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mr"><img src="../Images/9886ba4d24e040da151ea38314034bdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S5WXwIziBopShjtySer8Hg.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">图2:事务的结构。</p></figure><p id="27ba" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">幸运的是，有一些API可以方便我们的工作。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="7426" class="mx lq iq mt b gy my mz l na nb"><em class="lo"># First, let's load a few useful packages</em><br/><strong class="mt ir">library</strong>(tidyverse)<br/><strong class="mt ir">library</strong>(httr)<br/><strong class="mt ir">library</strong>(jsonlite)<br/><strong class="mt ir">library</strong>(scales)<br/><strong class="mt ir">library</strong>(waffle) <!-- -->#install.packages("waffle", repos = "<a class="ae kr" href="https://cinc.rud.is" rel="noopener ugc nofollow" target="_blank">https://cinc.rud.is</a>")<br/><strong class="mt ir">library</strong>(ggrepel)</span></pre><h1 id="e63c" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated">OpenSea API</h1><p id="b57c" class="pw-post-body-paragraph ks kt iq ku b kv mh jr kx ky mi ju la lb mj ld le lf mk lh li lj ml ll lm ln ij bi translated">OpenSea提供了一个API，用于根据一组查询参数获取不可替换的ERC721资产。让我们来看看:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="5446" class="mx lq iq mt b gy my mz l na nb"><em class="lo"># Retrieve sold NFTs </em><br/>resOpenSea &lt;- GET("https://api.opensea.io/api/v1/events",<br/>          query = list(limit=300, <em class="lo">#number of events to retrieve</em><br/>                       event_type="successful", <em class="lo">#retrieve only the sales</em><br/>                       only_opensea="true")) <em class="lo">#retrieve only sales from the opensea website</em><br/><br/><em class="lo"># Convert the raw unicode (not human friendly) into JSON format </em><br/><em class="lo"># Don't forget the option flatten=TRUE, otherwise the objects will be a complex list of list of list, impossible to work with</em><br/>dataOpenSea &lt;- fromJSON(rawToChar(resOpenSea$content), flatten=TRUE)[[1]] <br/><br/><em class="lo"># There are a lot of columns. We have to clean a bit.</em><br/><em class="lo"># Let's start removing the one containing only NA values</em><br/>dataOpenSea &lt;- dataOpenSea %&gt;% <br/>  select_if(~!all(is.na(.)))</span></pre><p id="f18e" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">OpenSea网站上并没有太多关于这个数据集内容的解释。因此，我选择了几个似乎包含有趣信息的专栏(至少是我能理解的)。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="77e2" class="mx lq iq mt b gy my mz l na nb"><em class="lo"># Let's select a few columns with interesting information</em><br/>dataOpenSea &lt;- dataOpenSea %&gt;% select("collection_slug", <br/>                                      "contract_address", <br/>                                      "id", "quantity", <br/>                                      "payment_token.name", <br/>                                      "total_price", <br/>                                      "seller.address", <br/>                                      "transaction.timestamp", <br/>                                      "winner_account.address", <br/>                                      "payment_token.usd_price", <br/>                                      "payment_token.eth_price", <br/>                                      "asset.asset_contract.schema_name") <br/><em class="lo">#"asset.asset_contract.address", "asset.asset_contract.asset_contract_type", "asset.asset_contract.created_date", "asset.asset_contract.name"</em><br/><br/><em class="lo"># Get a glimpse of the data </em><br/>glimpse(dataOpenSea)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nc"><img src="../Images/c2b2cf6ce1dd598dbe19c01a235daf2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*exKVKS-4t7FBweOOhD3i7g.png"/></div></div></figure><p id="5e71" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我的猜测是——这里我们有:</p><ul class=""><li id="9f59" class="nd ne iq ku b kv kw ky kz lb nf lf ng lj nh ln ni nj nk nl bi translated"><strong class="ku ir"> collection_slug: </strong>项目所属的集合</li><li id="f8c2" class="nd ne iq ku b kv nm ky nn lb no lf np lj nq ln ni nj nk nl bi translated"><strong class="ku ir"> contract_address: </strong>所有的销售都由一个合同(一段代码/一个软件)来管理，它将NFT发送给中标者。这是公海合同的地址。我们可以看到，所有销售只有一个地址，这意味着所有销售都由同一个合同管理。</li><li id="2024" class="nd ne iq ku b kv nm ky nn lb no lf np lj nq ln ni nj nk nl bi translated"><strong class="ku ir"> id: </strong>每笔交易的唯一标识符</li><li id="b660" class="nd ne iq ku b kv nm ky nn lb no lf np lj nq ln ni nj nk nl bi translated"><strong class="ku ir">数量:</strong>每笔交易售出的商品数量(参见下面的可替代/半可替代)。和在超市一样，你可以买1个苹果或者20个。</li><li id="f3cc" class="nd ne iq ku b kv nm ky nn lb no lf np lj nq ln ni nj nk nl bi translated"><strong class="ku ir"> payment_token.name: </strong>用于购买物品的加密货币。</li><li id="dcd8" class="nd ne iq ku b kv nm ky nn lb no lf np lj nq ln ni nj nk nl bi translated"><strong class="ku ir"> total_price: </strong>中奖者支付的费用。对乙醚来说，这是用乙醚的最小单位卫来表示的。1以太= 10亿魏(10</li><li id="6d4b" class="nd ne iq ku b kv nm ky nn lb no lf np lj nq ln ni nj nk nl bi translated"><strong class="ku ir">卖家地址:</strong>卖家的地址</li><li id="d5b6" class="nd ne iq ku b kv nm ky nn lb no lf np lj nq ln ni nj nk nl bi translated"><strong class="ku ir">交易.时间戳:</strong>交易的日期</li><li id="d1a8" class="nd ne iq ku b kv nm ky nn lb no lf np lj nq ln ni nj nk nl bi translated"><strong class="ku ir"> winner_account.address: </strong>买家地址</li><li id="52ca" class="nd ne iq ku b kv nm ky nn lb no lf np lj nq ln ni nj nk nl bi translated"><strong class="ku ir"> payment_token.usd_price: </strong>用于以美元进行交易的代币价格</li></ul><p id="fe10" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">让我们来看看货币的分布:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="0668" class="mx lq iq mt b gy my mz l na nb">dataOpenSea %&gt;% <br/>  group_by(payment_token.name) %&gt;% <br/>  summarise(n=n())</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/9af343ae9da14e842c8de97afd9cda97.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*kycOUj0XLo5AgUvoLEHHMQ.png"/></div></figure><p id="8bc4" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我们看到大多数销售是在乙醚中进行的(注意，包裹的乙醚可以被认为与乙醚相同)，让我们在文章的其余部分重点关注这些乙醚销售。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="cda6" class="mx lq iq mt b gy my mz l na nb"><em class="lo"># Change the format of some columns to something more adapted than character</em><br/>dataOpenSea &lt;- dataOpenSea %&gt;% <br/>  mutate(quantity=as.numeric(quantity), <br/>         total_price=as.numeric(total_price), <br/>         transaction.timestamp=as.Date(transaction.timestamp), <br/>         payment_token.usd_price=as.numeric(payment_token.usd_price)) <br/><br/><em class="lo"># filter on sales in ETH</em><br/>dataOpenSea &lt;- dataOpenSea %&gt;% <br/>  filter(payment_token.name %<strong class="mt ir">in</strong>% c("Ether", "Wrapped Ether"))<br/><br/><em class="lo"># Convert the price in Ether and then USD. We divide by the quantity as one sale can contain multiple items and then divide by 10^18 to convert the price from Wei to ETH (see above).</em><br/>dataOpenSea &lt;- dataOpenSea %&gt;% mutate(priceUSD = total_price / 10^18 * payment_token.usd_price / quantity)<br/><br/><em class="lo"># Let's visualize this</em><br/><em class="lo"># Histogram of the price distribution (with a log scale as prices are quite spread)</em><br/>pHistoOpenSea &lt;- ggplot(dataOpenSea, aes(priceUSD)) + <br/>  geom_histogram() + <br/>  labs(x="Price (USD)") + <br/>  scale_x_log10(labels = comma)<br/>ggsave("figures/histoOpenSea.png", pHistoOpenSea, height=7, width=7)<br/>pHistoOpenSea</span><span id="2598" class="mx lq iq mt b gy ns mz l na nb"><em class="lo"># Pie chart </em><br/>dataOpenSea$cut &lt;- cut(dataOpenSea$priceUSD, breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),<br/>                       labels = c("0-10USD", "10-100USD", "100-1000USD", "1000-10000USD", "10000-100000USD", "100000-1000000USD"), include.lowest = TRUE)<br/><br/>dataPieChartOpenSea &lt;- dataOpenSea %&gt;% <br/>  group_by(cut) %&gt;% <br/>  count() %&gt;% <br/>  ungroup() %&gt;% <br/>  mutate(percent=`n`/sum(`n`)) %&gt;% <br/>  arrange(desc(cut)) %&gt;%<br/>  mutate(label=scales::percent(percent))<br/><br/>pPieChartOpenSea &lt;- ggplot(dataPieChartOpenSea, aes(x="", y=percent, fill=cut))+<br/>geom_bar(width = 1, stat = "identity") +<br/>  coord_polar("y", start=0) +<br/>  geom_text_repel(aes(y = cumsum(percent) - percent/2, label=label)) +<br/>  theme_void()<br/>ggsave("figures/pieChartOpenSea.png", pPieChartOpenSea, height=7, width=7)<br/>pPieChartOpenSea</span><span id="3d99" class="mx lq iq mt b gy ns mz l na nb"><em class="lo"># Waffle chart</em><br/>pWaffleOpenSea &lt;- waffle(dataPieChartOpenSea, rows = 8, reverse=TRUE)<br/>ggsave("figures/waffleChartOpenSea.png", pWaffleOpenSea, height=5, width=7)<br/>pWaffleOpenSea</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nt"><img src="../Images/3057f89d1fd271c60ce289dced7a58b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jQag1jV4zUB4oiQrATuwrg.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">图3:每笔销售价格的直方图。来自OpenSea API的数据。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nt"><img src="../Images/19d0503dcb70eefd8e47003ef6184786.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GIERYGnZMi9eg0xlUviTiQ.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">图4:每笔销售价格的饼图。来自OpenSea API的数据。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nt"><img src="../Images/ae883d969c0ead00038d391965937c1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ie0NN1Ey64WIskQbCasbXg.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">图5:每笔销售价格的华夫饼图表。来自OpenSea API的数据。</p></figure><p id="f36c" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这看起来很好，但有一个很大的缺点… OpenSea API限制事件的数量为最后300个事务。如果我们使用他们的API，我们对此无能为力。此外，下载的交易是由OpenSea预处理的数据，而不是区块链本身。这已经是获得关于事务的信息的良好开端，但是如果我们想要读取块呢？我们之前已经看到，直接从区块链检索数据可能相当复杂。希望有像以太扫描这样的服务，让你以一种简单的方式探索以太坊街区。你猜怎么着？他们还开发了一个API！</p><h1 id="a8f7" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated">以太扫描API</h1><p id="f300" class="pw-post-body-paragraph ks kt iq ku b kv mh jr kx ky mi ju la lb mj ld le lf mk lh li lj ml ll lm ln ij bi translated">以太网扫描是一个块浏览器，它允许用户查看提交给以太坊区块链的交易信息，验证合同代码，可视化网络数据…因此我们可以用它来读取任何涉及NFTs的交易！EtherScan在其免费版本中将事务数量限制为10000，这比OpenSea API好得多，如果需要更多，您仍然可以订阅。</p><p id="465f" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我们从哪里开始？我们再来关注一下OpenSea:从上面提取的数据中，我们看到他们的合同地址是“0 x7be 8076 f 4 ea 4a 4 ad 08075 c 2508 e 481d 6 c 946d 12 b”。如果我们在以太网扫描中输入该地址，并过滤已完成的交易(即通过网络验证的交易，而不是等待批准的交易)，<a class="ae kr" href="https://etherscan.io/txs?a=0x7be8076f4ea4a4ad08075c2508e481d6c946d12b" rel="noopener ugc nofollow" target="_blank">https://etherscan.io/txs?a = 0 x7be 8076 f 4 ea 4a 4 ad 08075 c 2508 e 481 D6 c 946d 12 b</a>，我们看到了不可思议的数量(撰写本文时为848，965。)当然也不全是和销售有关的。</p><p id="cc2f" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">让我们看看我们能利用这些数据做些什么。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="55ba" class="mx lq iq mt b gy my mz l na nb"># EtherScan requires a token, have a look at their website<br/>EtherScanAPIToken &lt;- "Your token"</span><span id="717f" class="mx lq iq mt b gy ns mz l na nb"><em class="lo"># Retrieve the last 10000 transactions (maximum allowed by Etherscan) from the OpenSea contract</em><br/>resEtherScan &lt;- GET("https://api.etherscan.io/api",<br/>          query = list(module="account", <br/>                       action="txlist", <br/>                       address="0x7Be8076f4EA4A4AD08075C2508e481d6C946D12b",<br/>                       sort="desc",<br/>                       apikey=EtherScanAPIToken))<br/><br/><em class="lo"># Convert the raw unicode (not human friendly) into JSON format </em><br/><em class="lo"># Don't forget the option flatten=TRUE, otherwise the objects will be a complex list of list of list, impossible to work with</em><br/>dataEtherScan &lt;- fromJSON(rawToChar(resEtherScan$content), flatten=TRUE)$result<br/><br/>dataEtherScan &lt;- dataEtherScan %&gt;% <br/>  mutate(value=as.numeric(value), <em class="lo"># Convert price in numeric</em><br/>         timeStamp=as.POSIXct(as.numeric(timeStamp), origin="1970-01-01")) <em class="lo"># Convert the timestamp to a date</em><br/><br/><em class="lo"># There are many transactions with a value of 0 ether. Among them, not all are directly linked to sales. We won't go into details here, but there are many other types of actions that can be recorded as transactions (publishing a sale, maintenance of the contract...). Among those that are linked to sales, some involve a token transfer (wrapped ETH for instance) instead of ether directly. To keep things simple, let's keep only transactions involving transfer of some ether.</em><br/>dataEtherScan &lt;- dataEtherScan %&gt;% <br/>  filter(value&gt;0) <br/><br/><em class="lo"># Convert ETH price in USD</em><br/><em class="lo"># For this, we first need to obtain the last USD price</em><br/>resEtherScanPrice &lt;- GET("https://api.etherscan.io/api",<br/>          query = list(module="stats", <br/>                       action="ethprice", <br/>                       apikey=EtherScanAPIToken))<br/>dataEtherScanPrice &lt;- fromJSON(rawToChar(resEtherScanPrice$content), flatten=TRUE)$result$ethusd %&gt;% as.numeric()<br/> <br/>dataEtherScan &lt;- dataEtherScan %&gt;%<br/>  mutate(value=value/10^18) %&gt;% <em class="lo">#We divide by 10^18 to convert the price from Wei to ETH (see above). </em><br/>  mutate(priceUSD=value*dataEtherScanPrice) <em class="lo"># convert in USD </em><br/><br/><em class="lo"># Let's visualize this</em><br/><em class="lo"># Histogram of the price distribution (with a log scale as prices are quite spread)</em><br/>pHistoEtherScan &lt;- ggplot(dataEtherScan, aes(priceUSD)) + <br/>  geom_histogram() + <br/>  labs(x="Price (USD)") + <br/>  scale_x_log10(labels = comma)<br/>ggsave("figures/histoEtherScan.png", pHistoEtherScan, height=7, width=7)<br/>pHistoEtherScan</span><span id="f0f5" class="mx lq iq mt b gy ns mz l na nb"><em class="lo"># Pie chart</em><br/>dataEtherScan$cut &lt;- cut(dataEtherScan$priceUSD, breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),<br/>                       labels = c("0-10USD", "10-100USD", "100-1000USD", "1000-10000USD", "10000-100000USD", "100000-1000000USD"), include.lowest = TRUE)<br/><br/>dataPieChartEtherScan &lt;- dataEtherScan %&gt;% <br/>  group_by(cut) %&gt;% <br/>  count() %&gt;% <br/>  ungroup() %&gt;% <br/>  mutate(percent=`n`/sum(`n`)) %&gt;% <br/>  arrange(desc(cut)) %&gt;%<br/>  mutate(label=scales::percent(percent))<br/><br/>pPieChartEtherScan &lt;- ggplot(dataPieChartEtherScan, aes(x="", y=percent, fill=cut)) +<br/>geom_bar(width = 1, stat = "identity") + <br/>  coord_polar("y", start=0) +<br/>  geom_text_repel(aes(y = cumsum(percent) - percent/2, label=label)) +<br/>  theme_void()<br/>ggsave("figures/pieChartEtherScan.png", pPieChartEtherScan, height=7, width=7)<br/>pPieChartEtherScan</span><span id="7c29" class="mx lq iq mt b gy ns mz l na nb"><em class="lo"># Waffle chart</em><br/>dataPieChartEtherScan &lt;- dataPieChartEtherScan %&gt;%<br/>  mutate(n=n/20)<br/>pWaffleEtherScan &lt;- waffle(dataPieChartEtherScan, <br/>                  rows = 10, <br/>                  reverse=TRUE,<br/>                  xlab = "1 square = 20 sales") <br/>ggsave("figures/waffleChartEtherScan.png", pWaffleEtherScan, height=5, width=7)<br/>pWaffleEtherScan</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nt"><img src="../Images/6db889a100119beb78e22f037c4d970f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QSjxYpcrDorJtU-hZFEoiQ.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">图6:每笔销售价格的直方图。来自以太扫描API的数据。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nt"><img src="../Images/69a7380038b37677f7c8d0d99263eae3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ocm28lfrvA7AtxrIfL4pUQ.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">图7:每笔销售价格的饼状图。来自以太扫描API的数据。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nt"><img src="../Images/70bede04974379c4485b2e05d0822b16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pWogP7RW-xnxRmBGNQGDYQ.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">图8:每笔销售价格的华夫饼图表。来自以太扫描API的数据。</p></figure><p id="665c" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">请注意，从ETH到USD的价格转换并不完全正确。我们使用当前的ETH/USD价格，而一些交易是在一段时间以前完成的。即使在一天之内，价格也会有很大的变化！这可以通过检索历史ETH/USD价格轻松解决，但这需要一个EtherScan Pro帐户。</p><h1 id="1f9d" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated">结论</h1><p id="b309" class="pw-post-body-paragraph ks kt iq ku b kv mh jr kx ky mi ju la lb mj ld le lf mk lh li lj ml ll lm ln ij bi translated">本文介绍了如何阅读区块链并获得可以分析和可视化的事务数据。这里，我们展示了一个简单分析区块链交易的例子——NFT销售价格的分布图。这是一个良好的开端，但我们还可以做得更多！在第二部分中，我们将研究如何更进一步。例如，我们可以跟踪特定的非功能性食物，探索它们在释放后被占有的时间以及它们随后被重新获得的比率。请让我知道你可能会对哪些属性感兴趣。</p><p id="bc14" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><strong class="ku ir">注意，用于生成本文的代码在我的Github上有:</strong><a class="ae kr" href="https://github.com/tdemarchin/DataScienceOnBlockchainWithR-PartI" rel="noopener ugc nofollow" target="_blank"><strong class="ku ir">https://Github . com/tdemarchin/datascienceonblockschainwithr-PartI</strong></a></p><p id="bff2" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><strong class="ku ir">如果你想帮助我订阅一个EtherScan Pro帐户，并能够检索更多的交易，请不要犹豫，向我的ETH地址捐款:0 xf 5 fc 137 e 7428519969 a52c 710d 64406038319169</strong></p><h1 id="f709" class="lp lq iq bd lr ls lt lu lv lw lx ly lz jw ma jx mb jz mc ka md kc me kd mf mg bi translated">参考</h1><p id="c04d" class="pw-post-body-paragraph ks kt iq ku b kv mh jr kx ky mi ju la lb mj ld le lf mk lh li lj ml ll lm ln ij bi translated"><a class="ae kr" href="https://docs.opensea.io/reference" rel="noopener ugc nofollow" target="_blank">https://docs.opensea.io/reference</a></p><p id="4bba" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><a class="ae kr" href="https://www.dataquest.io/blog/r-api-tutorial/" rel="noopener ugc nofollow" target="_blank">https://www.dataquest.io/blog/r-api-tutorial/</a></p><p id="3684" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><a class="ae kr" href="https://ethereum.org/en/nft" rel="noopener ugc nofollow" target="_blank">https://ethereum.org/en/nft</a></p><p id="47b3" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><a class="ae kr" href="https://influencermarketinghub.com/nft-marketplaces" rel="noopener ugc nofollow" target="_blank">https://influencermarketinghub.com/nft-marketplaces</a></p><p id="f673" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><a class="ae kr" href="https://www.r-bloggers.com/" rel="noopener ugc nofollow" target="_blank">https://www.r-bloggers.com/</a></p><p id="230a" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><a class="ae kr" href="https://etherscan.io/" rel="noopener ugc nofollow" target="_blank">https://etherscan.io/</a></p><p id="4951" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><a class="ae kr" href="https://en.wikipedia.org/wiki/Blockchain" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Blockchain</a></p></div></div>    
</body>
</html>