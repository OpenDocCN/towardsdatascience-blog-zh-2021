<html>
<head>
<title>Here’s the most efficient way to iterate through your Pandas Dataframe</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">这是遍历熊猫数据框架的最有效的方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/heres-the-most-efficient-way-to-iterate-through-your-pandas-dataframe-4dad88ac92ee?source=collection_archive---------0-----------------------#2021-07-19">https://towardsdatascience.com/heres-the-most-efficient-way-to-iterate-through-your-pandas-dataframe-4dad88ac92ee?source=collection_archive---------0-----------------------#2021-07-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3d53" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">数据帧迭代速度提高280倍</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/96be211d7e071b29a48079acd0d84824.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8NlEYjNJFGQr1Sb4Y-WRWA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="c97e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Pandas是数据科学社区中最受欢迎的Python库之一，因为它为数据探索和可视化提供了大量具有灵活数据结构的API。Pandas是清理、转换、操作和分析数据的首选库。</p><p id="6dcf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">庞大API的存在使Pandas易于使用，但当处理大规模数据集时，它无法在所有CPU核心上扩展计算。Dask、Vaex是开源库，它们可以缩放计算以加快工作流程。</p><p id="9b81" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要素工程和要素探索需要遍历数据框。有多种方法可以遍历数据框，<code class="fe lu lv lw lx b"><strong class="la iu">iterrows()</strong></code>是其中之一。使用<code class="fe lu lv lw lx b"><strong class="la iu">iterrows()</strong></code>遍历数据帧的计算时间较慢。</p><p id="c83f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有时候，仅仅为了加快迭代过程，从Pandas转移到其他可扩展的库是一项单调乏味的任务。在本文中，我们将讨论各种数据帧迭代技术，并对它们的时间数进行基准测试。</p><h1 id="fa72" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">Iterrows():</h1><p id="545c" class="pw-post-body-paragraph ky kz it la b lb mq ju ld le mr jx lg lh ms lj lk ll mt ln lo lp mu lr ls lt im bi translated">Iterrows()是Pandas的内置函数，用于遍历数据框。应该完全避免使用它，因为与其他迭代技术相比，它的性能非常慢。Iterrows()在迭代时进行多次函数调用，并且迭代的每一行都具有数据框的属性，这使得它更慢。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/f26e7ae218f777cccaf8bb867ae5c4cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*_2Eg3i9oQuqKnMUE0UP7cA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)，Iterrows()用法</p></figure><p id="5627" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">iterrows()花费<strong class="la iu"> 790秒</strong>遍历一个有<strong class="la iu">1000万</strong>条记录的数据帧。</p><p id="a0d5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有各种各样的技术(将在下面讨论)比iterrows()表现得更好。</p><h1 id="fa4c" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">Itertuples():</h1><p id="e727" class="pw-post-body-paragraph ky kz it la b lb mq ju ld le mr jx lg lh ms lj lk ll mt ln lo lp mu lr ls lt im bi translated">Itertuples() 是Pandas的内置函数，用于遍历数据框。与iterrows()相比，Itertuples()调用函数的次数相对较少，并且开销也小得多。Itertuples()通过将每一行数据转换为元组列表来遍历数据帧。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/9a170afe5d1ed8de957864d3ed4d1d4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*j5ClRI0K9G4mc9xft-DN2Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)，Itertuples()用法</p></figure><p id="a8bc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">itertuples()花费<strong class="la iu"> 16秒</strong>遍历一个包含1000万条记录的数据帧，比iterrows()大约快<strong class="la iu">50倍</strong>。</p><blockquote class="mx my mz"><p id="ea9e" class="ky kz na la b lb lc ju ld le lf jx lg nb li lj lk nc lm ln lo nd lq lr ls lt im bi translated">阅读下面提到的文章，深入理解为什么iterrows()比itertuples()慢</p></blockquote><div class="ne nf gp gr ng nh"><a href="https://medium.com/swlh/why-pandas-itertuples-is-faster-than-iterrows-and-how-to-make-it-even-faster-bc50c0edd30d" rel="noopener follow" target="_blank"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd iu gy z fp nm fr fs nn fu fw is bi translated">为什么Pandas itertuples()比iterrows()快，以及如何使它更快</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">面向数据科学家的代码剖析教程</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">medium.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv ks nh"/></div></div></a></div><h1 id="f6a6" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">Numpy数组迭代:</h1><p id="f989" class="pw-post-body-paragraph ky kz it la b lb mq ju ld le mr jx lg lh ms lj lk ll mt ln lo lp mu lr ls lt im bi translated">迭代打败了使用熊猫的整个目的。矢量化永远是最佳选择。熊猫自带的<code class="fe lu lv lw lx b"><strong class="la iu">df.values()</strong></code>功能可以将数据帧转换成列表格式的列表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/abf86c52ac4feb0685d3a941b2740961.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*YsGyVBB9n0ckqozWACZyMw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)，Numpy数组迭代</p></figure><p id="3aee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">花了14秒</strong>遍历一个包含1000万条记录的数据帧，比<strong class="la iu">的iterrows()快了56倍</strong>。</p><h1 id="d3c0" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">字典迭代:</h1><p id="db3a" class="pw-post-body-paragraph ky kz it la b lb mq ju ld le mr jx lg lh ms lj lk ll mt ln lo lp mu lr ls lt im bi translated">现在，让我们来看看遍历数据框的最有效的方法。熊猫自带<code class="fe lu lv lw lx b"><strong class="la iu">df.to_dict('records')</strong></code>函数，将数据帧转换成字典键值格式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/c9b89ac518a5a68a40d1cff211cd97cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*r8l14E9bOpTMoz6FlwhCkQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)，字典迭代</p></figure><p id="2990" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">遍历一个包含1000万条记录的数据帧花费了<strong class="la iu"> 8.8秒</strong>，比iterrows()快了大约<strong class="la iu">90倍</strong>。</p><h1 id="ebe4" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">基准:</h1><p id="0d1d" class="pw-post-body-paragraph ky kz it la b lb mq ju ld le mr jx lg lh ms lj lk ll mt ln lo lp mu lr ls lt im bi translated">我比较了使用上述技术遍历数据帧的基准时间数。</p><blockquote class="mx my mz"><p id="7e70" class="ky kz na la b lb lc ju ld le lf jx lg nb li lj lk nc lm ln lo nd lq lr ls lt im bi translated">这一表演被记录在谷歌的一个实验室里。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/45cf9dd9c4f29044dfe7573e1b9c9a12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zFE9RBWxMLbtHAljuXpZVA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)，基准迭代时间</p></figure></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><h1 id="37d9" class="ly lz it bd ma mb of md me mf og mh mi jz oh ka mk kc oi kd mm kf oj kg mo mp bi translated">结论:</h1><p id="37b9" class="pw-post-body-paragraph ky kz it la b lb mq ju ld le mr jx lg lh ms lj lk ll mt ln lo lp mu lr ls lt im bi translated">不建议使用<code class="fe lu lv lw lx b"><strong class="la iu">itertools()</strong></code>来遍历数据帧，因为它会带来很大的开销并进行大量的函数调用。Itertuples将数据帧转换为元组列表，然后遍历它，这使得它相对更快。</p><p id="c9b1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">矢量化永远是首选和最佳选择。您可以将数据框转换为NumPy数组或字典格式，以加快迭代工作流。遍历字典的键-值对是最快的方法，对于2000万条记录，速度提高了大约280倍。</p><blockquote class="mx my mz"><p id="e73b" class="ky kz na la b lb lc ju ld le lf jx lg nb li lj lk nc lm ln lo nd lq lr ls lt im bi translated">参考我关于加速Python工作流的其他文章:</p></blockquote><ul class=""><li id="8d08" class="ok ol it la b lb lc le lf lh om ll on lp oo lt op oq or os bi translated"><a class="ae ot" rel="noopener" target="_blank" href="/25x-times-faster-python-function-execution-in-a-few-lines-of-code-4c82bdd0f64c">用几行代码将Python函数执行速度提高30倍</a></li><li id="df6c" class="ok ol it la b lb ou le ov lh ow ll ox lp oy lt op oq or os bi translated"><a class="ae ot" rel="noopener" target="_blank" href="/10x-times-faster-pandas-apply-in-a-single-line-change-of-code-c42cb5e82f6d">速度快10倍的熊猫应用程序只需更改一行代码</a></li></ul><h1 id="ee23" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">参考资料:</h1><p id="22ff" class="pw-post-body-paragraph ky kz it la b lb mq ju ld le mr jx lg lh ms lj lk ll mt ln lo lp mu lr ls lt im bi translated">[1]<a class="ae ot" href="https://medium.com/swlh/why-pandas-itertuples-is-faster-than-iterrows-and-how-to-make-it-even-faster-bc50c0edd30d" rel="noopener">https://medium . com/swlh/why-pandas-ITER tuples-is-fast-than-ITER rows-and-how-to-make-it-even-fast-BC 50 c 0 edd 30d</a></p></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><p id="403b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">喜欢这篇文章吗？成为 <a class="ae ot" href="https://satyam-kumar.medium.com/membership" rel="noopener"> <em class="na">中等会员</em> </a> <em class="na">继续无限制学习。如果你使用下面的链接，我会收到你的一小部分会员费，不需要你额外付费。</em></p><div class="ne nf gp gr ng nh"><a href="https://satyam-kumar.medium.com/membership" rel="noopener follow" target="_blank"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd iu gy z fp nm fr fs nn fu fw is bi translated">加入我的推荐链接-萨蒂扬库马尔媒体</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">satyam-kumar.medium.com</p></div></div><div class="nq l"><div class="oz l ns nt nu nq nv ks nh"/></div></div></a></div><blockquote class="pa"><p id="f598" class="pb pc it bd pd pe pf pg ph pi pj lt dk translated">感谢您的阅读</p></blockquote></div></div>    
</body>
</html>