<html>
<head>
<title>NLP: Text Data Visualization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NLP:文本数据可视化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/nlp-text-data-visualization-5d5c64c86019?source=collection_archive---------8-----------------------#2021-03-27">https://towardsdatascience.com/nlp-text-data-visualization-5d5c64c86019?source=collection_archive---------8-----------------------#2021-03-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b97161918c08146ae8efb7797c633854.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vs_RFpJWO97IG9FIs3hITw.jpeg"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">图像<a class="ae kc" href="https://unsplash.com/photos/jrh5lAq-mIs?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditShareLink" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="7b4a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">“如果你愿意倾听，数据会和你说话。”吉姆·柏格森</p><p id="9dd5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">文本数据可视化有许多优势，如快速获得最常用的词以理解文本是关于什么的，所有数据的正面和负面评论的数量由图表表示，加上词性之间的用户和产品关系，等等。</p><p id="2ad2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在让我们看看如何去做。亚马逊是一个大零售品牌，我们可以看到它有很多关于产品的评论。让我们从Kaggle获得这个数据集，然后开始。</p><p id="c1e1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此任务导入几个重要的库:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="b314" class="lk ll iq lg b gy lm ln l lo lp">import numpy as np<br/>import pandas as pd<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns</span><span id="b4b8" class="lk ll iq lg b gy lq ln l lo lp">import string<br/>from wordcloud import WordCloud</span></pre><p id="df8c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据点评CSV制作数据框:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="ccf0" class="lk ll iq lg b gy lm ln l lo lp">df = pd.read_csv('../input/amazon-fine-food-reviews/Reviews.csv')</span></pre><p id="c2d7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们将数据可视化:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="3fec" class="lk ll iq lg b gy lm ln l lo lp">df.head(10)</span></pre><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/9c1d99035cc3e6b7f46a7adea8df795e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sv8jZb7wQNlrASQvu-ShtQ.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">作者图片</p></figure><p id="13a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">删除空值(如果有):</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="d275" class="lk ll iq lg b gy lm ln l lo lp">print(df.shape)<br/>print(df.isnull().values.any())<br/>df.dropna(axis = 0 , inplace = True)<br/>print(df.shape)</span></pre><p id="8f9a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">删除重复项:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="8210" class="lk ll iq lg b gy lm ln l lo lp">df.drop_duplicates(subset=['Score','Text'],keep='first',inplace=True)<br/>print(df.shape)<br/>df.head(10)</span></pre><p id="d0de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可视化分数总数:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="8ae2" class="lk ll iq lg b gy lm ln l lo lp">plt.figure(figsize=(10,10))<br/>ax = sns.countplot(x=df["Score"],  data=df, order = df["Score"].value_counts().index )<br/>for p, label in zip(ax.patches, df["Score"].value_counts()):   <br/>    ax.annotate(label, (p.get_x()+0.25, p.get_height()+0.5))</span></pre><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/07b043a38d82d2ff29abefa870ebd92d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*Nz7Y_ev67op51lIruR5B_Q.png"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">作者图片</p></figure><p id="396c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">按超过400种产品的产品Id分组:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="25d2" class="lk ll iq lg b gy lm ln l lo lp">df.groupby('ProductId').count()<br/>df_products = df.groupby('ProductId').filter(lambda x: len(x) &gt;= 400)<br/>df_product_groups = df_products.groupby('ProductId')</span><span id="127f" class="lk ll iq lg b gy lq ln l lo lp">#Count of products and groups<br/>print(len(df_products))<br/>print(len(df_product_groups))</span></pre><p id="3b1e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">绘制产品方面的分数</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="6779" class="lk ll iq lg b gy lm ln l lo lp">plt.figure(figsize=(20,20))<br/>sns.countplot(y="ProductId",  hue="Score", data=df_products);</span></pre><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lt"><img src="../Images/b059d4f7bdeb5637ec89f6dbdf5f6b0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zpgH_Hs9Ti66Ipx3PG9kJg.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">作者图片</p></figure><p id="ce56" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">按给出100条以上评论的用户Id分组:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="f5f7" class="lk ll iq lg b gy lm ln l lo lp">df.groupby('UserId').count()</span><span id="3817" class="lk ll iq lg b gy lq ln l lo lp">df_users = df.groupby('UserId').filter(lambda x: len(x) &gt;= 100)<br/>df_userGroup = df_users.groupby('UserId')<br/>print("Number of Users:"+ str(len(df_userGroup)))<br/>df_products = df_users.groupby('ProductId')<br/>print("Number of products:"+ str(len(df_products)))</span></pre><p id="74db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据给定的分数等级绘制用户:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lu"><img src="../Images/0adb8f9d7afe9eeb7939c97a8ce48bb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cISmnbYgHc7dlsLRnuVL9A.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">作者图片</p></figure><p id="bde9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们来看看哪些是正面评价用得最多的词，哪些是负面评价用得最多的词。</p><p id="d1df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于此导入库进行数据清理:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="30f6" class="lk ll iq lg b gy lm ln l lo lp">from nltk.tokenize import word_tokenize<br/>from nltk.tokenize import sent_tokenize<br/>from nltk.stem import WordNetLemmatizer <br/>from nltk.corpus import stopwords</span></pre><p id="47b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为停用词的移除、词条整理和文本清理创建函数:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="e31f" class="lk ll iq lg b gy lm ln l lo lp">def remove_Stopwords(text ):<br/>    stop_words = set(stopwords.words('english')) <br/>    words = word_tokenize( text.lower() ) <br/>    sentence = [w for w in words if not w in stop_words]<br/>    return " ".join(sentence)<br/>    </span><span id="3270" class="lk ll iq lg b gy lq ln l lo lp">def lemmatize_text(text):<br/>    wordlist=[]<br/>    lemmatizer = WordNetLemmatizer() <br/>    sentences=sent_tokenize(text)<br/>    for sentence in sentences:<br/>        words=word_tokenize(sentence)<br/>        for word in words:<br/>            wordlist.append(lemmatizer.lemmatize(word))<br/>    return ' '.join(wordlist) </span><span id="d8ac" class="lk ll iq lg b gy lq ln l lo lp">def clean_text(text ): <br/>    delete_dict = {sp_character: '' for sp_character in string.punctuation} <br/>    delete_dict[' '] = ' ' <br/>    table = str.maketrans(delete_dict)<br/>    text1 = text.translate(table)<br/>    textArr= text1.split()<br/>    text2 = ' '.join([w for w in textArr]) <br/>    <br/>    return text2.lower()</span></pre><p id="db40" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">分离正面和负面评论:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="d3e5" class="lk ll iq lg b gy lm ln l lo lp">mask = (df["Score"] == 1) | (df["Score"] == 2)<br/>df_rating1 = df[mask]<br/>mask = (df["Score"]==4) | (df["Score"]==5) | (df["Score"]==3)<br/>df_rating2 = df[mask]<br/>print(len(df_rating1))<br/>print(len(df_rating2))</span></pre><p id="9879" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">清理<a class="ae kc" rel="noopener" target="_blank" href="/nlp-easy-explanation-of-common-terms-with-python-dc7c323a4691">停用词</a>、<a class="ae kc" rel="noopener" target="_blank" href="/nlp-easy-explanation-of-common-terms-with-python-dc7c323a4691">的文本，对</a>进行词条化，并清理标点符号:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="62e8" class="lk ll iq lg b gy lm ln l lo lp">df_rating1['Text'] = df_rating1['Text'].apply(clean_text)<br/>df_rating1['Text'] = df_rating1['Text'].apply(remove_Stopwords)<br/>df_rating1['Text'] = df_rating1['Text'].apply(lemmatize_text)<br/></span><span id="ee23" class="lk ll iq lg b gy lq ln l lo lp">df_rating2['Text'] = df_rating2['Text'].apply(clean_text)<br/>df_rating2['Text'] = df_rating2['Text'].apply(remove_Stopwords)<br/>df_rating2['Text'] = df_rating2['Text'].apply(lemmatize_text)</span><span id="0be4" class="lk ll iq lg b gy lq ln l lo lp">df_rating1['Num_words_text'] = df_rating1['Text'].apply(lambda x:len(str(x).split())) <br/>df_rating2['Num_words_text'] = df_rating2['Text'].apply(lambda x:len(str(x).split()))</span></pre><p id="cfd2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">WordCloud对负面评论的看法:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="4e85" class="lk ll iq lg b gy lm ln l lo lp">wordcloud = WordCloud(background_color="white",width=1600, height=800).generate(' '.join(df_rating1['Summary'].tolist()))<br/>plt.figure( figsize=(20,10), facecolor='k')<br/>plt.imshow(wordcloud)</span></pre><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lv"><img src="../Images/48e15156f466e0321059c1f8719e2ff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKof8K5I4BWhn_iQO3niGw.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">作者图片</p></figure><p id="9f98" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">WordCloud对正面评论的看法:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="3bf4" class="lk ll iq lg b gy lm ln l lo lp">wordcloud = WordCloud(background_color="white",width=1600, height=800).generate(' '.join(df_rating2['Summary'].tolist()))<br/>plt.figure( figsize=(20,10), facecolor='k')<br/>plt.imshow(wordcloud)<br/>plt.axis("off")</span></pre><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lw"><img src="../Images/01b09daf7eb1a359fc5f0a782911ba7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g3xbzpernIim1tPpVEoQuw.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">作者图片</p></figure><p id="91d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们看看如何把词类之间的关系形象化。</p><p id="5dcb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于这个进口空间</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="239e" class="lk ll iq lg b gy lm ln l lo lp">import spacy<br/>nlp=spacy.load('en_core_web_sm')<br/>from spacy import displacy<br/>doc=nlp(u'The blue pen was over the oval table.')</span></pre><p id="56c2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如下图所示:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="3647" class="lk ll iq lg b gy lm ln l lo lp">displacy.render(doc, style='dep')</span></pre><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/d31581ba81bc49a23e039099a5fac921.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nGwcTGokfzI9EBDIhGbv8g.png"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">作者图片</p></figure><p id="167d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在让我们用一些选项为这个表示填充一些颜色:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="e3d6" class="lk ll iq lg b gy lm ln l lo lp">doc1=nlp(u'I am Namrata Kapoor and I love NLP.')<br/>options={'distance':110,'compact':'True', 'color':'white','bg':'#FF5733','font':'Times'}<br/>displacy.render(doc1, style='dep',options=options)</span></pre><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/0ac82ac5f8bbfc77fc0525532e79dc29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*aaK7snWyD0lM53QbWxfXTw.png"/></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">作者图片</p></figure><p id="33f7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">结论</strong></p><p id="e975" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在这里已经看到了一些使用WordCloud、SNS和matplotlib的文本可视化技术。一旦情感分析被用于它，有更多的事情可以被探索，我们用一些规则更深入地挖掘，这些规则清楚地定义了评论是为产品还是交付而给出的。</p><p id="1a54" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，像“not”这样的停用词会改变单词的意思，在应用停用词和在词云中可视化之前，必须用反义词替换它们。</p><p id="0edf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些是可以优化我所做的一些事情。</p><p id="c1ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢阅读！</p><p id="1675" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ly">原载于2021年3月27日https://www.numpyninja.com</em><em class="ly">的</em> <a class="ae kc" href="https://www.numpyninja.com/post/nlp-text-data-visualization" rel="noopener ugc nofollow" target="_blank"> <em class="ly">。</em></a></p></div></div>    
</body>
</html>