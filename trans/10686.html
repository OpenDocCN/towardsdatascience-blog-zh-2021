<html>
<head>
<title>13 ways to access data in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python访问数据的13种方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/13-ways-to-access-data-in-python-bac5683e0063?source=collection_archive---------0-----------------------#2021-10-14">https://towardsdatascience.com/13-ways-to-access-data-in-python-bac5683e0063?source=collection_archive---------0-----------------------#2021-10-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8c42" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何从本地文件、数据库、API和数据访问库中获取数据到您的Python环境中</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/030484439198b4889d599d0f8e41a26e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tYWM6La6f02Sh5AOTQMAmw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">兰斯·格兰达尔在<a class="ae kv" href="https://unsplash.com/photos/nShLC-WruxQ" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的图片</p></figure><h1 id="d194" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="8fe6" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">大多数Python分析都是从将数据导入环境开始的。但是，如果这些数据滞留在数据库中，该怎么办呢？还是背后一个API？还是在一堆小文件里？</p><p id="7ace" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">幸运的是，Python非常灵活，有很多用于访问和处理数据的开源库。在本教程中，我们将学习13种将数据放入熊猫数据框的方法，之后可以对数据进行清理、分析和可视化。我们可以将这些方法分为四大类:</p><ol class=""><li id="4961" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated">本地文件</li><li id="a98d" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">数据库</li><li id="f674" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">蜜蜂</li><li id="fd1d" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">数据集访问库</li></ol><p id="cc09" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">唯一的主要需求是安装<code class="fe nd ne nf ng b">pandas</code>库:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="3817" class="nl kx iq ng b gy nm nn l no np">$ pip install pandas</span></pre><p id="e393" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">好了，让我们开始吧！</p><h1 id="1855" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">📁本地文件</h1><p id="6477" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">通常，您需要的数据存储在计算机的本地文件中。根据您运行Python环境的位置，您可以将文件名指定为相对路径<a class="ae kv" href="https://www.earthdatascience.org/courses/intro-to-earth-data-science/python-code-fundamentals/work-with-files-directories-paths-in-python/" rel="noopener ugc nofollow" target="_blank">或绝对路径</a>:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="06bd" class="nl kx iq ng b gy nm nn l no np"># Absolute path<br/>file1 = "~/Users/johnreid/Documents/my_project/data/example.csv"</span><span id="529d" class="nl kx iq ng b gy nq nn l no np"># Relative path, assuming current working directory is my_project<br/>file2 = "./data/example.csv"</span></pre><h2 id="9f94" class="nl kx iq bd ky nr ns dn lc nt nu dp lg lx nv nw li mb nx ny lk mf nz oa lm ob bi translated">1.CSV文件</h2><p id="baaa" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">CSV是存储表格数据的流行选择，也是最简单的入门方式。让我们假设您已经从数据中的<a class="ae kv" href="https://ourworldindata.org/grapher/population-by-country" rel="noopener ugc nofollow" target="_blank">我们的世界下载了这个人口数据集:</a></p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="afc3" class="nl kx iq ng b gy nm nn l no np">import pandas as pd</span><span id="e624" class="nl kx iq ng b gy nq nn l no np">csv_file = "/Users/johnreid/Downloads/population-by-country.csv"<br/>df_from_csv = pd.read_csv(csv_file)<br/>df_from_csv.info()</span></pre><p id="e735" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">导入数据后，运行<code class="fe nd ne nf ng b">df.info()</code>有助于了解数据的结构，例如有多少行、列和非空值。运行该代码会产生以下输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/0e9121386f0580897f8405e1ff6d6ccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*d4s8_fQhg1dGrbUt"/></div></div></figure><p id="86a5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这种方法也适用于通过URL访问的文件，比如公共Github repo中的公共Google Sheet或CSV文件。另外，如果你一直得到一个<code class="fe nd ne nf ng b">FileNotFoundError</code>，那么尝试重命名你的文件名，用下划线代替空格，例如“Financial Sample.xlsx”变成“Financial_Sample.xlsx”。</p><h2 id="eb42" class="nl kx iq bd ky nr ns dn lc nt nu dp lg lx nv nw li mb nx ny lk mf nz oa lm ob bi translated">2.Excel文件</h2><p id="7f93" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">您需要对Excel文件更加小心，因为它们可能包含不止一张数据和复杂的视觉格式，例如额外的标题行。除此之外，语法非常相似——下面是一个<a class="ae kv" href="https://go.microsoft.com/fwlink/?LinkID=521962" rel="noopener ugc nofollow" target="_blank">财务数据</a>的例子:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="1549" class="nl kx iq ng b gy nm nn l no np">import pandas as pd</span><span id="481b" class="nl kx iq ng b gy nq nn l no np">excel_file = "/Users/johnreid/Downloads/Financial_Sample.xlsx"<br/>df_from_excel = pd.read_excel(excel_file, sheet_name = "Sheet1")<br/>df_from_excel.info()</span></pre><h2 id="e22c" class="nl kx iq bd ky nr ns dn lc nt nu dp lg lx nv nw li mb nx ny lk mf nz oa lm ob bi translated">3.文本文件</h2><p id="ff39" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">文本文件通常需要更多的数据处理——首先看看数据是如何存储的，以及您希望如何在Python中表示它。从那里，您可以编写代码将文本输入转换成数据帧。让我们用一个购物清单的例子，每一行包含一个项目和数量:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/79f4bc84b9e5a056376ffa45d3e48c3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FMBg56mcfWMB1t8p"/></div></div></figure><p id="4803" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">要将其转换为数据帧，可以运行以下命令:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="9b40" class="nl kx iq ng b gy nm nn l no np">shopping_list = "/Users/johnreid/Downloads/shopping_list.txt"</span><span id="8bbe" class="nl kx iq ng b gy nq nn l no np">results = []</span><span id="e88e" class="nl kx iq ng b gy nq nn l no np">with open(shopping_list) as f:<br/>    line = f.readline()</span><span id="549e" class="nl kx iq ng b gy nq nn l no np">    while line:<br/>        results.append(line.strip().split(" "))<br/>        line = f.readline()</span><span id="f647" class="nl kx iq ng b gy nq nn l no np">f.close()</span><span id="a942" class="nl kx iq ng b gy nq nn l no np">df_from_textfile = pd.DataFrame(results, columns = ["Item", "Quantity"])</span></pre><p id="a635" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们一行一行地读，去掉多余的空格，把这一行分成两部分。当我们创建一个数据帧时，我们还需要指定列名。</p><h2 id="ad6e" class="nl kx iq bd ky nr ns dn lc nt nu dp lg lx nv nw li mb nx ny lk mf nz oa lm ob bi translated">4.多个文件/文件夹</h2><p id="20ae" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果需要从多个存储的文件中提取数据会怎么样？让我们结合我们学到的一些东西，从<a class="ae kv" href="http://mlg.ucd.ie/datasets/bbc.html" rel="noopener ugc nofollow" target="_blank"> BBC体育文本数据集</a>中提取数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/c5e5f72b357f6d653599d22d00879386.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aBaD94EclppmxPA4"/></div></div></figure><p id="7fd6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们有5个子文件夹，每个大约有100个文件。每个文件都以标题开始，然后是文章的正文。我们的目标是将所有这些文件合并成一个具有“标题”、“副标题”、“正文”和“流派”列的单一数据框架。这里的<code class="fe nd ne nf ng b">glob</code>库列出了所有可能的文件名，非常方便:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="3525" class="nl kx iq ng b gy nm nn l no np">import glob<br/>import pandas as pd</span><span id="817e" class="nl kx iq ng b gy nq nn l no np">base_path = "/Users/johnreid/Downloads/bbcsport/"<br/>genres = ["athletics", "cricket", "football", "rugby", "tennis"]</span><span id="1070" class="nl kx iq ng b gy nq nn l no np">def read_and_split_file(filename):<br/>    with open(filename, 'r', encoding="latin-1") as f:<br/>        lines = f.readlines() # Get lines as a list of strings<br/>        lines = list(map(str.strip, lines)) # Remove /n characters<br/>        lines = list(filter(None, lines)) # Remove empty strings</span><span id="1c93" class="nl kx iq ng b gy nq nn l no np">    return lines</span><span id="abbe" class="nl kx iq ng b gy nq nn l no np">def get_df_from_genre(path, genre):<br/>    files = glob.glob(path + genre + "/*.txt")<br/>    titles = []<br/>    subtitles = []<br/>    bodies = []</span><span id="85c6" class="nl kx iq ng b gy nq nn l no np">    for f in files:<br/>        lines = read_and_split_file(f)<br/>        titles.append(lines[0]) # First line is the title<br/>        subtitles.append(lines[1]) # Second line is the subtitle<br/>        bodies.append(' '.join(lines[2:])) # Combine all the rest</span><span id="546a" class="nl kx iq ng b gy nq nn l no np">    return(pd.DataFrame({<br/>        'genre': genre,<br/>        'title': titles,<br/>        'subtitle': subtitles,<br/>        'body': bodies<br/>        })<br/>    )</span><span id="a648" class="nl kx iq ng b gy nq nn l no np">final_df = pd.concat([get_df_from_genre(base_path, g) for g in genres])</span><span id="2ad3" class="nl kx iq ng b gy nq nn l no np">final_df</span></pre><p id="816b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们在glob中使用<code class="fe nd ne nf ng b">*</code>操作符来获取所有可能以<code class="fe nd ne nf ng b">.txt</code>结尾的文件名。注意，您可以使用<code class="fe nd ne nf ng b">pd.concat</code>将多个数据帧连接在一起。运行该代码会产生以下输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/f3e43fafcdbb18ffb0edd1ea6297084d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DMVCrpt-MdsotIxv"/></div></div></figure><h1 id="128c" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">🗄数据库</h1><p id="8c9d" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">大多数组织将他们的业务关键数据存储在类似Postgres或MySQL的关系数据库中，你需要知道结构化语言来访问或更新存储在那里的数据。数据库有很多优点，比如数据标准化</p><h2 id="2f7e" class="nl kx iq bd ky nr ns dn lc nt nu dp lg lx nv nw li mb nx ny lk mf nz oa lm ob bi translated">5.SQLite</h2><p id="7146" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">SQLite是一个存储为单个文件的嵌入式数据库，所以它是开始测试查询的好地方。这里我们将展示一个连接到<a class="ae kv" href="https://github.com/lerocha/chinook-database" rel="noopener ugc nofollow" target="_blank"> Chinook </a>数据库的SQLite文件的例子:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="6994" class="nl kx iq ng b gy nm nn l no np">import pandas as pd<br/>import sqlite3 as sql</span><span id="cd84" class="nl kx iq ng b gy nq nn l no np">conn = sql.connect('/Users/johnreid/Downloads/chinook.db')</span><span id="4417" class="nl kx iq ng b gy nq nn l no np"># First pattern - turn query directly into dataframe:<br/>df1 = pd.read_sql_query("SELECT * FROM invoice", conn)</span><span id="4647" class="nl kx iq ng b gy nq nn l no np"># Second pattern - get row-level data, but no column names<br/>cur = conn.cursor()<br/>results = cur.execute("SELECT * FROM invoice LIMIT 5").fetchall()<br/>df2 = pd.DataFrame(results)</span></pre><p id="ad7d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果你有兴趣，可以在这里阅读我关于使用SQL构建交互式仪表板的完整教程:</p><div class="og oh gp gr oi oj"><a rel="noopener follow" target="_blank" href="/building-an-interactive-python-dashboard-using-sql-and-datapane-46bd92294fd3"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd ir gy z fp oo fr fs op fu fw ip bi translated">使用SQL和Datapane构建交互式Python仪表板</h2><div class="oq l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">towardsdatascience.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow kp oj"/></div></div></a></div><h2 id="8ccf" class="nl kx iq bd ky nr ns dn lc nt nu dp lg lx nv nw li mb nx ny lk mf nz oa lm ob bi translated">6.远程数据库</h2><p id="a311" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">连接到远程数据库(如Postgres、Redshift或SQLServer)使用几乎相同的语法，但需要访问凭证。出于安全原因，最好将这些凭证存储在一个配置文件中，并将其加载到Python脚本中。您可以使用以下信息创建一个单独的<code class="fe nd ne nf ng b">.py</code>文件:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="e6f0" class="nl kx iq ng b gy nm nn l no np">host = "localhost"<br/>database= "suppliers"<br/>user = "postgres"<br/>password = "SecurePas$1"</span></pre><p id="34ae" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">然后将其导入Python脚本，如下所示(您还需要<code class="fe nd ne nf ng b">psychopg2</code>库):</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="0644" class="nl kx iq ng b gy nm nn l no np">import psycopg2<br/>import config</span><span id="59eb" class="nl kx iq ng b gy nq nn l no np">conn = psycopg2.connect(<br/>    host=config.host,<br/>    database=config.database,<br/>    user=config.user,<br/>    password=config.password)</span><span id="3167" class="nl kx iq ng b gy nq nn l no np">df1 = pd.read_sql_query("SELECT * FROM invoice", conn)</span></pre><p id="88de" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">确保保存好你的<code class="fe nd ne nf ng b">config.py</code>文件，不要把它上传到其他地方——你可以把它添加到你的<code class="fe nd ne nf ng b">.gitignore</code>中，以确保它不会包含在git提交中。</p><h2 id="df27" class="nl kx iq bd ky nr ns dn lc nt nu dp lg lx nv nw li mb nx ny lk mf nz oa lm ob bi translated">7.SQLAlchemy</h2><p id="f921" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果您想要一种更“pythonic化”的方式来查询数据库，可以尝试一下<a class="ae kv" href="https://www.sqlalchemy.org/" rel="noopener ugc nofollow" target="_blank"> SQLAlchemy </a>库，它是一个对象关系映射器。它通常用于应用程序，这样开发人员就不必编写纯SQL来更新他们的数据库，但是您也可以使用它来查询数据！</p><p id="f705" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面是一个使用相同Chinook音乐商店数据库的示例:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="a21b" class="nl kx iq ng b gy nm nn l no np">import sqlalchemy as db</span><span id="9b80" class="nl kx iq ng b gy nq nn l no np">engine = db.create_engine('sqlite:///chinook.db')<br/>connection = engine.connect()<br/>metadata = db.MetaData()</span><span id="adf0" class="nl kx iq ng b gy nq nn l no np">invoice = db.Table('invoice', metadata, autoload=True, autoload_with=engine)</span><span id="bdd7" class="nl kx iq ng b gy nq nn l no np"># Get the first 10 invoices from the USA<br/>query = (db.select([invoice])<br/>    .filter_by(billing_country = 'USA')<br/>    .limit(10)<br/>        )</span><span id="4040" class="nl kx iq ng b gy nq nn l no np">df = pd.read_sql(query, engine)</span></pre><p id="e831" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在这段代码中，我们连接到数据库，然后在SQLAlchemy中设置一些表和元数据。一旦定义好了，我们就可以用一种更“pythonic化”的方式编写一个查询，并将结果直接读取到Pandas数据帧中。运行该代码会产生以下输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/e97a5dd60299fad5af00634136d83ce8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ny184a5Zzl-foqOheejl1g.png"/></div></div></figure><h1 id="3db6" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">📶蜜蜂</h1><p id="d15e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">有时候，你需要从你公司使用的特定平台获取数据，比如Hubspot、Twitter或Trello。这些平台通常有一个公共API，您可以直接在Python环境中从中提取数据。</p><p id="3942" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">基本思想是向端点发送一个请求(可能包括查询参数和访问凭证)。该端点将返回一个响应代码和您请求的数据(希望如此)。您需要查看API文档来了解哪些数据字段是可用的。数据通常以JSON格式返回，这允许深度嵌套的数据。</p><h2 id="b67d" class="nl kx iq bd ky nr ns dn lc nt nu dp lg lx nv nw li mb nx ny lk mf nz oa lm ob bi translated"><strong class="ak"> 8。没有证件</strong></h2><p id="dc72" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">让我们使用<a class="ae kv" href="http://open-notify.org/Open-Notify-API/People-In-Space/" rel="noopener ugc nofollow" target="_blank"> OpenNotify </a> API来做一个最小的例子，它跟踪当前在空间中的所有人:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="7467" class="nl kx iq ng b gy nm nn l no np">import requests</span><span id="a177" class="nl kx iq ng b gy nq nn l no np">response = requests.get("http://api.open-notify.org/astros.json")</span><span id="2c79" class="nl kx iq ng b gy nq nn l no np">print(response.status_code)<br/>print(response.json())</span><span id="7b42" class="nl kx iq ng b gy nq nn l no np">res = pd.DataFrame(response.json()["people"])</span><span id="2c6a" class="nl kx iq ng b gy nq nn l no np">res.head()</span></pre><p id="609d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">运行该代码会产生以下输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/ed79b00054e24aa39d4560a15f7ae77b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2xCpCjNjI4IFWm1r"/></div></div></figure><p id="efe8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">响应代码告诉您API调用的结果——根据<a class="ae kv" href="https://www.dataquest.io/blog/python-api-tutorial/" rel="noopener ugc nofollow" target="_blank"> Dataquest </a>最常见的是:</p><ul class=""><li id="98a0" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj oz mv mw mx bi translated">一切顺利，结果已经返回(如果有的话)。</li><li id="2851" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj oz mv mw mx bi translated"><code class="fe nd ne nf ng b">301</code>:服务器正在将您重定向到不同的端点。当公司切换域名或端点名称更改时，可能会发生这种情况。</li><li id="3a8f" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj oz mv mw mx bi translated"><code class="fe nd ne nf ng b">400</code>:服务器认为你提出了一个错误的请求。当你没有发送正确的数据时，就会发生这种情况。</li><li id="7cd8" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj oz mv mw mx bi translated"><code class="fe nd ne nf ng b">403</code>:你试图访问的资源被禁止:你没有查看它的权限。</li><li id="bf20" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj oz mv mw mx bi translated"><code class="fe nd ne nf ng b">404</code>:在服务器上找不到您试图访问的资源。</li><li id="469b" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj oz mv mw mx bi translated"><code class="fe nd ne nf ng b">503</code>:服务器未准备好处理请求。</li></ul><h2 id="3402" class="nl kx iq bd ky nr ns dn lc nt nu dp lg lx nv nw li mb nx ny lk mf nz oa lm ob bi translated">9.使用凭据和查询参数</h2><p id="7c2f" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">有时您可能需要来自API的更具体的信息，或者必须进行身份验证。有几种方法可以做到这一点，但是最常用的一种方法是在请求中添加URL参数。</p><p id="d39e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">假设我们有一个包含API密钥的<code class="fe nd ne nf ng b">config.py</code>文件:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="cb3a" class="nl kx iq ng b gy nm nn l no np">personal_api_key = "wouldntyouliketoknow"</span></pre><p id="2646" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">然后我们为所有的参数创建一个字典(这是一个虚构的例子)并传递它:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="3565" class="nl kx iq ng b gy nm nn l no np">import config<br/>import pandas as pd<br/>import requests</span><span id="8178" class="nl kx iq ng b gy nq nn l no np">parameters = {<br/>    "personal_api_key": config.personal_api_key, <br/>    "date": "2021-09-22"<br/>}</span><span id="8652" class="nl kx iq ng b gy nq nn l no np">response = requests.get(url, params = parameters)<br/>    <br/>print(response.status_code)<br/>print(response.json())<br/>    <br/>res = pd.DataFrame(response.json()["people"])<br/>res.head()</span></pre><p id="29ff" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果你不想处理JSON，你可以尝试搜索该API的Python库——这些库通常是开源的，由公司或第三方维护。</p><h1 id="e620" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">📚数据集访问库</h1><p id="e86c" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果您需要一些参考数据来进行比较或添加上下文，该怎么办？有许多库可以将公共数据集直接下载到您的环境中——可以把它想象成从API中提取，而不必管理所有额外的复杂性。</p><h2 id="ba33" class="nl kx iq bd ky nr ns dn lc nt nu dp lg lx nv nw li mb nx ny lk mf nz oa lm ob bi translated">10.熊猫_datareader</h2><p id="9cfa" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><a class="ae kv" href="https://pandas-datareader.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank"> Pandas_datareader </a>是一种将数据从互联网提取到Python环境中的好方法。它特别适合金融数据，但也有一些世界银行的数据源。要了解Zoom过去几年的每日股价，请尝试以下方法:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="a519" class="nl kx iq ng b gy nm nn l no np">from pandas_datareader import data<br/>import datetime as dt</span><span id="bdd6" class="nl kx iq ng b gy nq nn l no np">zm = data.DataReader(<br/>    "ZM",<br/>    start='2019-1-1',<br/>    end=dt.datetime.today(),<br/>    data_source='yahoo'<br/>).reset_index()</span><span id="1566" class="nl kx iq ng b gy nq nn l no np">zm.head()</span></pre><p id="ab56" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">运行该代码会产生以下输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/c21a79123bd06588ce232883aaa09a9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wJaAtxjh1n9wMxVT"/></div></div></figure><h2 id="e7c6" class="nl kx iq bd ky nr ns dn lc nt nu dp lg lx nv nw li mb nx ny lk mf nz oa lm ob bi translated">11.数据共享</h2><p id="884c" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><a class="ae kv" href="https://datacommons.org/" rel="noopener ugc nofollow" target="_blank"> Datacommons </a>是谷歌的一个项目，提供对标准化和清洁的公共数据集的访问。底层数据以图表的形式呈现，这使得查询和连接来自许多不同数据源的数据变得非常容易，例如美国人口普查局、世界银行、维基百科、疾病控制中心等等。这里有一个基本的例子:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="ca8b" class="nl kx iq ng b gy nm nn l no np">!pip install datacommons datacommons_pandas --upgrade --quiet</span><span id="771e" class="nl kx iq ng b gy nq nn l no np">import datacommons_pandas as dc<br/>import pandas as pd</span><span id="b4b5" class="nl kx iq ng b gy nq nn l no np">city_dcids = dc.get_property_values(["CDC500_City"], "member", limit=500)["CDC500_City"]</span><span id="4fae" class="nl kx iq ng b gy nq nn l no np">cdc500_df = dc.build_multivariate_dataframe(<br/>    city_dcids,<br/>    ["Percent_Person_Obesity",  # Prevalence of obesity from CDC<br/>    "Median_Income_Person",<br/>    "Median_Age_Person",<br/>    "UnemploymentRate_Person",  # Unemployment rate from BLS<br/>    "Count_Person_BelowPovertyLevelInThePast12Months",  # Persons living below the poverty line from Census<br/>    "Count_Person",  # Total population from Census<br/>    ],<br/>)</span><span id="41e6" class="nl kx iq ng b gy nq nn l no np">cdc500_df.info()</span></pre><p id="d9d8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">运行该代码会得到以下结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pb"><img src="../Images/45fb498b570fa11c1240e11c0fa240c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LS0A_CNMmPEpBxJl"/></div></div></figure><p id="3a2e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果你想学习如何使用DataCommons，请在这里阅读我的完整教程:</p><div class="og oh gp gr oi oj"><a rel="noopener follow" target="_blank" href="/exploring-datacommons-the-api-powering-google-search-afc366ec242b"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd ir gy z fp oo fr fs op fu fw ip bi translated">探索数据共享——支持谷歌搜索的API</h2><div class="pc l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">访问公开可用数据集的新范式</h3></div><div class="oq l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">towardsdatascience.com</p></div></div><div class="or l"><div class="pd l ot ou ov or ow kp oj"/></div></div></a></div><h2 id="3d7c" class="nl kx iq bd ky nr ns dn lc nt nu dp lg lx nv nw li mb nx ny lk mf nz oa lm ob bi translated">12.PyTrends(谷歌趋势)</h2><p id="4f7b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">PyTrends 是一个非官方但很有用的库，用于查询<a class="ae kv" href="https://trends.google.com/trends/explore?date=today%205-y&amp;q=oat%20milk,soy%20milk,almond%20milk" rel="noopener ugc nofollow" target="_blank"> Google Trends </a>数据——这里有一个简单的例子:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="9d80" class="nl kx iq ng b gy nm nn l no np">import pandas as pd</span><span id="2bf8" class="nl kx iq ng b gy nq nn l no np">from pytrends.request import TrendReq</span><span id="dfcd" class="nl kx iq ng b gy nq nn l no np">pytrends = TrendReq()<br/>keywords = ["oat milk", "soy milk", "almond milk"]</span><span id="d55a" class="nl kx iq ng b gy nq nn l no np">pytrends.build_payload(keywords, cat=0, geo='', gprop='') # Get data from the last 5 years</span><span id="65ca" class="nl kx iq ng b gy nq nn l no np">top_queries = pytrends.interest_over_time()[keywords]</span><span id="7758" class="nl kx iq ng b gy nq nn l no np">top_queries.head()</span></pre><p id="1ffa" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">运行该代码会产生以下输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pe"><img src="../Images/42dff0556a84ef75ffe175cc572be6af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WuUEWgBmU6n2EcRo"/></div></div></figure><h2 id="12d1" class="nl kx iq bd ky nr ns dn lc nt nu dp lg lx nv nw li mb nx ny lk mf nz oa lm ob bi translated">13.卡格尔</h2><p id="d5d7" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">Kaggle是一个数据科学社区，它拥有大量学习Python的数据集和竞赛。您可以通过命令行界面下载其中的一些数据集进行实验(注意:您需要注册一个Kaggle帐户)。例如，假设我们想要下载一些<a class="ae kv" href="https://www.kaggle.com/zillow/zecon" rel="noopener ugc nofollow" target="_blank"> Zillow economics数据</a>，我们可以在我们的终端中运行以下命令(Jupyter用户:用Python代码中的<code class="fe nd ne nf ng b">!</code>替换<code class="fe nd ne nf ng b">$</code>:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="fc9b" class="nl kx iq ng b gy nm nn l no np">$ pip install kaggle<br/>$ export KAGGLE_USERNAME=datadinosaur<br/>$ export KAGGLE_KEY=xxxxxxxxxxxxxx<br/>$ kaggle datasets download zillow/zecon<br/>$ unzip zecon.zip</span></pre><p id="96b4" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这将下载数据集的压缩文件，然后解压缩它们。从那里，您可以将它们作为熊猫的本地文件打开:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="dbff" class="nl kx iq ng b gy nm nn l no np">import pandas as pd</span><span id="e2ab" class="nl kx iq ng b gy nq nn l no np">csv_file = "/Users/johnreid/Downloads/Zip_time_series.csv"<br/>df_from_csv = pd.read_csv(csv_file)<br/>df_from_csv.info()</span></pre><p id="24d6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">要了解更多信息，请查看<a class="ae kv" href="https://github.com/Kaggle/kaggle-api" rel="noopener ugc nofollow" target="_blank"> Kaggle API文档</a>。</p><h1 id="d979" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak">结论</strong></h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pf pg l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来自<a class="ae kv" href="https://giphy.com/gifs/angry-spongebob-squarepants-strong-D7z8JfNANqahW" rel="noopener ugc nofollow" target="_blank"> Giphy </a></p></figure><p id="088c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">你成功了！现在，您可以使用新获得的能力来访问多个数据源，并使用<code class="fe nd ne nf ng b">pd.merge</code>或<code class="fe nd ne nf ng b">pd.concat</code>将它们连接在一起，然后使用Altair、Pandas或leav等交互式库来可视化它们。</p><p id="7108" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">有没有我漏掉的方法？请在评论中告诉我。</p></div></div>    
</body>
</html>