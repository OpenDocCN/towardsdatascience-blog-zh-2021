<html>
<head>
<title>Use Rattle to Help You Learn R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用拨浪鼓来帮助你学习R</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/use-rattle-to-help-you-learn-r-d495c0cc517f?source=collection_archive---------17-----------------------#2021-04-02">https://towardsdatascience.com/use-rattle-to-help-you-learn-r-d495c0cc517f?source=collection_archive---------17-----------------------#2021-04-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="22b3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">初学者指南</h2></div><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="kk kl l"/></div><p class="km kn gj gh gi ko kp bd b be z dk translated">来自@ Giphy.com的thebossbaby</p></figure><p id="e129" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">不，不是那种拨浪鼓——尽管有时你似乎需要一个。</p><p id="4d59" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">“rattle”包为R功能提供了一个GUI界面——比RStudio提供的更多。下面是从r内部运行rattle()时得到的结果。</p><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi lm"><img src="../Images/e21ff298ee41bcaf3dac3278ccc25717.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XGfO5bnG1BBYFY5UuAn89A.png"/></div></div><p class="km kn gj gh gi ko kp bd b be z dk translated">作者的拨浪鼓截图</p></figure><p id="a463" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">拨浪鼓对很多事情都有用。如果你想运行一个快速和肮脏的模型？太棒了。想看看你的数据是什么样的吗？这对那个也有好处。但是对于尝试学习R的R程序员新手来说，最有用的方面可能是“Log”选项卡。每次你告诉Rattle做某件事的时候，log标签都会记录它用来做这件事的代码。有了这个特性，你可以使用Rattle在R中做一些事情，然后查看Log选项卡，看看它是如何做到的，这样你就可以学习做同样的事情。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="84c3" class="ma mb iq bd mc md me dn mf mg mh dp mi kz mj mk ml ld mm mn mo lh mp mq mr ms bi translated">装置</h2><p id="affe" class="pw-post-body-paragraph kq kr iq ks b kt mt jr kv kw mu ju ky kz mv lb lc ld mw lf lg lh mx lj lk ll ij bi translated">我假设此时您已经安装了R——也许还有RStudio。这个你不需要后者，但是不疼。要安装拨浪鼓，您需要拨浪鼓包。这将安装大多数依赖项。现在，您需要单独安装RGtk2软件包。然后加载库并运行Rattle。</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="ad33" class="ma mb iq mz b gy nd ne l nf ng">install.packages("rattle")<br/>install.packages("RGtk2")<br/>library(rattle)<br/>rattle()</span></pre><p id="b0fc" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">第一次运行Rattle，它会问你要不要安装GTK+(是的，再来一遍)。选择确定。当您尝试使用Rattle中的某些功能时，会出现类似的弹出窗口，告诉您需要安装相关的软件包才能继续。</p><p id="b469" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">(我听说有些人在MAC上使用GTK+有问题。我用的是PC，所以从来没出过问题，但是YMMV。)</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="b87f" class="ma mb iq bd mc md me dn mf mg mh dp mi kz mj mk ml ld mm mn mo lh mp mq mr ms bi translated">使用拨浪鼓</h2><p id="e71a" class="pw-post-body-paragraph kq kr iq ks b kt mt jr kv kw mu ju ky kz mv lb lc ld mw lf lg lh mx lj lk ll ij bi translated">在你做任何事情之前，你需要载入一些数据。Rattle带有几个内置的数据集。对于本文，我们将使用天气数据集。这是Rattle的默认数据集，如果你不告诉它加载其他东西，它就会加载这个数据集。要使用它，只需点击“执行”按钮(确保您仍在数据选项卡上)。Rattle会注意到你没有指定数据集，所以它会问你是否要加载天气数据集。说“是”。</p><p id="3aba" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">数据集的其他选项包括从文件加载、从ODBC数据库加载、从R加载您已经在处理的数据集(我最喜欢的选项)等。</p><p id="8f5c" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">顺便说一下，在Rattle中选择执行按钮是您需要习惯的事情。每次你做某件事时，你需要按下那个按钮来告诉Rattle<em class="nh">实际上</em>去做。当你不这样做的时候，奇怪的事情就会发生。</p><p id="4b49" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">加载数据集后，您将看到数据集中存在的变量的摘要，以及一些设置选项。这是天气数据集中变量的部分截图。</p><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi ni"><img src="../Images/1cf3ef46e2b0faea5b102398cc7928d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_aaH0bhTTM57q_scVDafaw.png"/></div></div><p class="km kn gj gh gi ko kp bd b be z dk translated">作者截图</p></figure><p id="d5a3" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">请注意，对于每个变量，您将看到Rattle已经推断出数据类型、变量的用途(输入、目标等。)，以及变量的唯一值的数量和缺失值的数量的摘要。</p><p id="2e35" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">数据类型字段经常错误地将类别变量归类为数字。这是因为许多数据集使用数字来表示类别。例如，一个收入变量可能有10个类别，等级为1-10。如果您想将类型从数字更改为类别(或者进行其他更改)，您可以在Transform选项卡上完成。如果我有足够的兴趣，我会在另一篇文章中介绍。</p><p id="4753" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">目标变量的识别也可能是偶然的。浏览数据，确保所有东西都被正确分类。如果不是，请选择正确的单选按钮。如果您想同时更改一组变量，请选择它们(使用ctrl-select或shift-select)，然后单击代表输入或忽略的红灯或绿灯。</p><p id="31c3" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">除此之外，您可以决定是否要对数据进行分区(训练/验证/测试),并选择您想要使用的种子。我喜欢默认的42。毕竟，它是对生命、宇宙和一切的终极问题的答案。(如果你不知道我在说什么，不要慌！去读读道格拉斯·亚当斯的《银河系漫游指南》。记住，永远带着你的毛巾。)</p><p id="f8e8" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">让我们继续对数据进行分区。使用默认的70/15/15。然后单击执行。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="dae2" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">在我们深入讨论日志选项卡之前，我应该指出格式可能有点复杂。Rattle做的一些事情是为了Rattle自己的目的。我不知道它为什么会做一些事情。关键是看Rattle用的代码，试着理解它是做什么的，根据自己的目的修改它。R help()命令将是您的好朋友。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="1671" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">现在我们已经读入并准备好了数据集，让我们看看Log选项卡，看看Rattle为我们做了什么。往下跳一点，你会看到:</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="bc24" class="ma mb iq mz b gy nd ne l nf ng">crv$seed &lt;- 42</span></pre><p id="69e6" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">您将在整个日志中看到“crv$”和“crs$”。Rattle创建一个环境变量，其中包含您将使用的所有单个变量。一般来说，如果你想复制代码，如果你把那部分去掉，就不会那么混乱。我会的，从现在开始。</p><p id="7769" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">有两个与种子相关的命令。第一个创建一个变量作为种子，而第二个(屏幕下方一点)实际上是<em class="nh">设置</em>种子。这样，如果您想要更改种子值，您只需要在一个地方修改代码。</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="a3bd" class="ma mb iq mz b gy nd ne l nf ng">seed &lt;- 42<br/>set.seed(seed)</span></pre><p id="7f8b" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">在这两个命令之间，您将看到Rattle是如何加载数据集的。</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="4541" class="ma mb iq mz b gy nd ne l nf ng">fname &lt;- system.file("csv", "weather.csv", package = "rattle")<br/>dataset &lt;- read.csv(fname, encoding = "UTF-8")</span></pre><p id="a744" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">如您所见，代码对于我们的目的来说过于复杂。在R中加载嵌入的数据集时，使用data()函数更容易:</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="c8cc" class="ma mb iq mz b gy nd ne l nf ng">data("weather")</span></pre><p id="21a1" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">这将创建名为“天气”的数据集。Rattle方法是一个很好的内部过程，允许它使用变量名“dataset”来引用它正在处理的任何数据集。(这是和设置种子类似的概念，就在上面。)</p><p id="38ce" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">接下来，我们可以看到Rattle用来对数据集进行分区的代码。</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="2732" class="ma mb iq mz b gy nd ne l nf ng">nobs &lt;- nrow(dataset)<br/>train &lt;- sample(nobs, 0.7 * nobs) # the training set<br/>nobs %&gt;% <br/>    seq_len() %&gt;%<br/>    setdiff(train) %&gt;%<br/>    sample(0.15 * nobs) -&gt;<br/>  validate                        # the validation set<br/>nobs %&gt;%<br/>    seq_len() %&gt;%<br/>    setdiff(train) %&gt;%<br/>    setdiff(validate) -&gt;<br/>  test                            # the testing set</span></pre><p id="8a67" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">同样，这有点不合常规。正常方法会将新变量放在第一位，如:</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="ed1c" class="ma mb iq mz b gy nd ne l nf ng">validate &lt;- nobs %&gt;%<br/>    seq_len() %&gt;%<br/>    setdiff(train) %&gt;%<br/>    sample(0.15 * nobs)</span></pre><p id="3abb" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">顺便说一下，如果您还不理解这段代码，那么%&gt;%是一个“管道”操作符(可以在magrittr和dplyr包中找到)，它使用管道前面的部分作为管道后面的函数的第一个参数。所以这相当于:</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="28eb" class="ma mb iq mz b gy nd ne l nf ng">validate &lt;- sample(setdiff(seq_len(nobs), train), 0.15* nobs)</span></pre><p id="d07e" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">使用管道可以使你的代码更容易阅读。R中有很多括号需要正确放置。然而，这并不意味着是关于管道的教程。</p><p id="b297" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">这样做的目的是创建一个随机的数字列表，其中包含从1到nobs (seq_len(nobs))的15%的整数，而不包含已经是train的一部分的数字(setdiff)。然后，这可以用作数据帧的索引，如下所示:</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="505c" class="ma mb iq mz b gy nd ne l nf ng">weather[train,]<br/>weather[validate,]<br/>weather[test,]</span></pre><p id="212c" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">“测试”索引是以同样的方式创建的，但是这一次，setdiff()使用了两次:一次用于删除训练索引，另一次用于删除验证索引。</p><p id="f087" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">此时日志文件的大部分内容实际上只供Rattle内部使用——定义输入变量和目标变量，以及数字变量和类别变量。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="e21e" class="ma mb iq bd mc md me dn mf mg mh dp mi kz mj mk ml ld mm mn mo lh mp mq mr ms bi translated">建模</h2><p id="5aed" class="pw-post-body-paragraph kq kr iq ks b kt mt jr kv kw mu ju ky kz mv lb lc ld mw lf lg lh mx lj lk ll ij bi translated">让我们尝试一些建模。首先，我们要做一个决策树。转到模型选项卡，选择树，然后点击执行。Rattle将创建一个具有标准参数集的决策树，根据数据集创建一组规则来预测明天是否会下雨。</p><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi lm"><img src="../Images/3d133d70ea80d96c7a295f164b4a1f63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0t_oGtHZNrWVN4YoMYSbKg.png"/></div></div><p class="km kn gj gh gi ko kp bd b be z dk translated">Rattle中的决策树模型(作者截图)</p></figure><p id="9128" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">这里有很多信息，但是我将不得不在另一篇文章中讨论。决策树的关键部分就在中心上方。这些是决策树创建的规则。</p><ol class=""><li id="da48" class="nj nk iq ks b kt ku kw kx kz nl ld nm lh nn ll no np nq nr bi translated">如果下午3点的云量小于6.5，那么就不会下雨。</li><li id="7ed1" class="nj nk iq ks b kt ns kw nt kz nu ld nv lh nw ll no np nq nr bi translated">否则，它仍然可能不会下雨，但检查气压。</li><li id="e16a" class="nj nk iq ks b kt ns kw nt kz nu ld nv lh nw ll no np nq nr bi translated">如果下午3点气压至少1016毫巴，就不会下雨。</li><li id="d58f" class="nj nk iq ks b kt ns kw nt kz nu ld nv lh nw ll no np nq nr bi translated">否则很可能会下雨，不过下午3点查一下风向</li><li id="9b64" class="nj nk iq ks b kt ns kw nt kz nu ld nv lh nw ll no np nq nr bi translated">如果风向是ESE，SSE，W，WNW，或者WSW，那么就不会下雨。</li><li id="1ab6" class="nj nk iq ks b kt ns kw nt kz nu ld nv lh nw ll no np nq nr bi translated">否则，会下雨。</li></ol><p id="9b0f" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">决策树的主要优点是它们创建的规则易于理解。</p><p id="a782" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">要查看这是如何编码的，我们可以转到Log选项卡并滚动到底部。这里我们看到下面的代码(为了清楚起见，我将决策树变量的名称从“rpart”改为“tree”):</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="7b75" class="ma mb iq mz b gy nd ne l nf ng">library(rpart) # provides the code to create the decision tree</span><span id="fcf4" class="ma mb iq mz b gy nx ne l nf ng">tree &lt;- rpart(RainTomorrow ~ .,<br/>    data = dataset[train, c(input, target)],<br/>    method = "class",<br/>    parms = list(split = "information"), <br/>    control = rpart.control(usesurrogate=0, maxsurrogate= 0),<br/>    model = TRUE)</span><span id="de55" class="ma mb iq mz b gy nx ne l nf ng">print(tree)<br/>printcp(tree)<br/></span></pre><p id="539c" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">现在我们已经看到了代码，我们可以回到R(或RStudio)并找出所有这些参数的含义。</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="df5c" class="ma mb iq mz b gy nd ne l nf ng">?rpart</span></pre><p id="cee9" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">您还可以使用Rattle Model选项卡上的参数来查看它如何影响代码。例如，在我为四个默认数字参数中的每一个选择了不同的值之后，Rattle会生成以下代码:</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="6932" class="ma mb iq mz b gy nd ne l nf ng">tree &lt;- rpart(RainTomorrow ~ .,<br/>    data=dataset[train, c(input, target)],<br/>    method="class",<br/>    parms=list(split="information"),<br/>      control=rpart.control(minsplit=15,<br/>           minbucket=6,<br/>           maxdepth=20,<br/>           cp=0.001000,<br/>        usesurrogate=0, <br/>        maxsurrogate=0),<br/>    model=TRUE)<br/></span></pre><p id="5fec" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">我们还可以通过单击右边的两个按钮来获得决策树的规则以及树的图形表示。规则将显示在异响屏幕中(比之前显示的格式更好)。但是，Rattle生成的所有图都将进入RStudio Plots窗口(如果使用RStudio ),否则将进入R图形设备。</p><p id="ff33" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">回到Log选项卡，我们可以找到用于创建绘图的代码。</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="0ade" class="ma mb iq mz b gy nd ne l nf ng">fancyRpartPlot(tree, main = "Decision Tree weather.csv $ Raintomorrow")</span></pre><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi ny"><img src="../Images/6ce88559e5878eb446cfc5cd69dcbcd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aajitwnnFNHrBv90iwulqA.png"/></div></div><p class="km kn gj gh gi ko kp bd b be z dk translated">Rattle创建的决策树(作者截图)</p></figure><p id="e085" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">现在我们知道了如何创建一个图形化的决策树，包括图形标题。底部的文本是fancyRpartPlot创建的默认副标题，但这也是可编辑的。查看fancyRpartPlot()函数的文档以了解一些选项。请随意使用这些选项，看看它们能做些什么。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="9b4e" class="ma mb iq bd mc md me dn mf mg mh dp mi kz mj mk ml ld mm mn mo lh mp mq mr ms bi translated">模型评估</h2><p id="2533" class="pw-post-body-paragraph kq kr iq ks b kt mt jr kv kw mu ju ky kz mv lb lc ld mw lf lg lh mx lj lk ll ij bi translated">最后，我们将评估我们刚刚创建的模型。转到评估选项卡:</p><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi nz"><img src="../Images/ecdfd1a761ce7989aaa9fa4793b2469b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nRrvLvzxjRHIzZHFwcyXrQ.png"/></div></div><p class="km kn gj gh gi ko kp bd b be z dk translated">Rattle评估选项卡(作者截图)</p></figure><p id="1e13" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">首先，让我们为模型生成一个误差矩阵。已经选择了错误矩阵，所以点击执行。</p><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi oa"><img src="../Images/f67b716281eead6eb3724c958bf02c7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2u-KDN8q1-yjpgyBfr19pQ.png"/></div></div><p class="km kn gj gh gi ko kp bd b be z dk translated">天气决策树模型的误差矩阵(作者截图)</p></figure><p id="685f" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">这个模型预测“无雨”相当准确，但“下雨”就不那么准确了。这并不奇怪，因为在这个模型中下雨是非常罕见的。如果我们更关心预测什么时候<em class="nh">下雨</em>而不是什么时候<em class="nh">不下雨</em>，那么我们可以调整模型上的损失矩阵参数，以有利于真正的正面而不是真正的负面。但那是以后的事了。</p><p id="b80a" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">现在，回到Log选项卡，看看误差矩阵是如何创建的。</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="2677" class="ma mb iq mz b gy nd ne l nf ng">pr &lt;- predict(tree, newdata = dataset[validate, c(input, target)],<br/>    type = "class")</span><span id="6899" class="ma mb iq mz b gy nx ne l nf ng"># Generate error matrix with counts<br/>rattle::errorMatrix(dataset[validate, c(input, target)$RainTomorrow, <br/>    pr, count = TRUE))</span><span id="9c1b" class="ma mb iq mz b gy nx ne l nf ng"># Generate error matrix with proportions<br/>(per &lt;- rattle::errorMatrix(dataset[validate, c(input,<br/>      target)$RainTomorrow, pr))</span><span id="58ab" class="ma mb iq mz b gy nx ne l nf ng">#Calculate and display errors<br/>cat(100 - sum(diag(per), na.rm = TRUE)<br/>cat(mean(per[,"Error"], na.rm = TRUE)</span></pre><p id="d4cc" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">让我们画一个ROC曲线。在Evaluate选项卡上，选择ROC单选按钮，然后点击Execute。同样，最终的情节不会显示在Rattle中，所以请返回R或RStudio查看。AUC(曲线下面积)值允许我们给模型分配一个“等级”。一个好的经验法则是使用AUC值，就像你在学校里用分数一样。超过90%是A，80–90%是B，等等。</p><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi ob"><img src="../Images/827c4017e9ac8a211d457a668d49cef6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xcnYkmCw0CofuBU3aSGtyg.png"/></div></div><p class="km kn gj gh gi ko kp bd b be z dk translated">天气决策树的ROC曲线(作者截图)</p></figure><p id="c0d1" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">并再次返回到Log选项卡，查看生成该图的代码。亲爱的读者，我将把这个留给你去解读。记住，help()命令是你的朋友。</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="1ddd" class="ma mb iq mz b gy nd ne l nf ng"># ROC Curve: requires the ROCR package.<br/>library(ROCR)</span><span id="38aa" class="ma mb iq mz b gy nx ne l nf ng"># ROC Curve: requires the ggplot2 package.<br/>library(ggplot2, quietly=TRUE)</span><span id="10cb" class="ma mb iq mz b gy nx ne l nf ng"># Generate an ROC Curve for the rpart model on weather.csv [validate].<br/>pr &lt;- predict(tree, newdata=dataset[validate, <br/>    c(input, target)])[,2]</span><span id="8a89" class="ma mb iq mz b gy nx ne l nf ng"># Remove observations with missing target.<br/>no.miss &lt;- na.omit(dataset[validate, c(input, <br/>    target)]$RainTomorrow)<br/>miss.list &lt;- attr(no.miss, "na.action")<br/>attributes(no.miss) &lt;- NULL</span><span id="1122" class="ma mb iq mz b gy nx ne l nf ng">if (length(miss.list))<br/>{<br/>  pred &lt;- prediction(pr[-miss.list], no.miss)<br/>} else<br/>{<br/>  pred &lt;- prediction(pr, no.miss)<br/>}</span><span id="7fca" class="ma mb iq mz b gy nx ne l nf ng">pe &lt;- performance(pred, "tpr", "fpr")<br/>au &lt;- performance(pred, "auc")<a class="ae oc" href="http://twitter.com/y" rel="noopener ugc nofollow" target="_blank">@y</a>.values[[1]]<br/>pd &lt;- data.frame(fpr=unlist(pe@x.values), tpr=unlist(pe@y.values))<br/>p &lt;- ggplot(pd, aes(x=fpr, y=tpr))<br/>p &lt;- p + geom_line(colour="red")<br/>p &lt;- p + xlab("False Positive Rate") + ylab("True Positive Rate")<br/>p &lt;- p + ggtitle("ROC Curve Decision Tree weather.csv [validate] <br/>    RainTomorrow")<br/>p &lt;- p + theme(plot.title=element_text(size=10))<br/>p &lt;- p + geom_line(data=data.frame(), aes(x=c(0,1), y=c(0,1)), <br/>    colour="grey")<br/>p &lt;- p + annotate("text", x=0.50, y=0.00, hjust=0, vjust=0, size=5,<br/>                   label=paste("AUC =", round(au, 2)))<br/>print(p)</span><span id="fee7" class="ma mb iq mz b gy nx ne l nf ng"># Calculate the area under the curve for the plot.<br/># Remove observations with missing target.</span><span id="32dd" class="ma mb iq mz b gy nx ne l nf ng">no.miss &lt;- na.omit(dataset[validate, c(input,    <br/>    target)]$RainTomorrow)<br/>miss.list &lt;- attr(no.miss, "na.action")<br/>attributes(no.miss) &lt;- NULL</span><span id="1b4d" class="ma mb iq mz b gy nx ne l nf ng">if (length(miss.list))<br/>{<br/>  pred &lt;- prediction(pr[-miss.list], no.miss)<br/>} else<br/>{<br/>  pred &lt;- prediction(pr, no.miss)<br/>}<br/>performance(pred, "auc")</span></pre></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="e915" class="ma mb iq bd mc md me dn mf mg mh dp mi kz mj mk ml ld mm mn mo lh mp mq mr ms bi translated">结论</h2><p id="3dcd" class="pw-post-body-paragraph kq kr iq ks b kt mt jr kv kw mu ju ky kz mv lb lc ld mw lf lg lh mx lj lk ll ij bi translated">正如我前面提到的，Rattle日志中的许多代码更多地是为内部使用而设计的，而不是供用户复制供自己使用。因此，如果没有其他原因，您可能会希望修改代码以提高可读性。尽管如此，通过充分使用R help，您应该能够使用Rattle的日志来帮助您编写自己的代码。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="048a" class="ma mb iq bd mc md me dn mf mg mh dp mi kz mj mk ml ld mm mn mo lh mp mq mr ms bi translated">进一步阅读</h2><p id="5b90" class="pw-post-body-paragraph kq kr iq ks b kt mt jr kv kw mu ju ky kz mv lb lc ld mw lf lg lh mx lj lk ll ij bi translated"><strong class="ks ir">拨浪鼓</strong></p><p id="2e06" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><a class="ae oc" href="https://cran.r-project.org/web/packages/rattle/rattle.pdf" rel="noopener ugc nofollow" target="_blank">https://cran.r-project.org/web/packages/rattle/rattle.pdf</a></p><div class="od oe gp gr of og"><a href="https://data-mining-tutorials.blogspot.com/2011/08/data-mining-with-r-rattle-package.html" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd ir gy z fp ol fr fs om fu fw ip bi translated">用R - The Rattle包进行数据挖掘</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">r(http://www.r-project.org/)是近几年来最令人兴奋的免费数据挖掘软件项目之一。它…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">data-mining-tutorials.blogspot.com</p></div></div></div></a></div><div class="od oe gp gr of og"><a href="https://www.amazon.com/gp/product/1441998896/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=1441998896&amp;linkCode=as2&amp;tag=medium0074-20&amp;linkId=a23f7684a456aed8c215fc0ca095ca83" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd ir gy z fp ol fr fs om fu fw ip bi translated">使用Rattle和R的数据挖掘:为知识发现挖掘数据的艺术(使用R！)</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">Amazon.com:使用Rattle和R的数据挖掘:为知识发现挖掘数据的艺术(使用R！) (8582569999992)…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">www.amazon.com</p></div></div><div class="op l"><div class="oq l or os ot op ou lr og"/></div></div></a></div><p id="940d" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">(上面这本书的链接是附属链接。)</p><p id="12f8" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="ks ir">管道</strong></p><p id="af3a" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><a class="ae oc" href="https://www.datacamp.com/community/tutorials/pipe-r-tutorial" rel="noopener ugc nofollow" target="_blank">https://www . data camp . com/community/tutorials/pipe-r-tutorial</a></p></div></div>    
</body>
</html>