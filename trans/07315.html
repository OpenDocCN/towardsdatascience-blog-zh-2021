<html>
<head>
<title>Raspberry Pi Gardening: Monitoring a Vegetable Garden using a Raspberry Pi — Part 2: 3D Printing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">树莓派园艺:使用树莓派监测菜园—第2部分:3D打印</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/raspberry-pi-gardening-monitoring-a-vegetable-garden-using-a-raspberry-pi-part-2-3d-printing-40471bd061dc?source=collection_archive---------12-----------------------#2021-07-03">https://towardsdatascience.com/raspberry-pi-gardening-monitoring-a-vegetable-garden-using-a-raspberry-pi-part-2-3d-printing-40471bd061dc?source=collection_archive---------12-----------------------#2021-07-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7130" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">向我花园里的胡椒植物扔覆盆子馅饼的第二部分:关于3D打印、更多糟糕的焊接工作、I2C、SPI、Python、go、SQL和CAD失败的话题</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/fcd04c03eff46e3ab017ee0fcdac5b72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SZQRTcL6ObWBmkr7.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">项目之旅(作者)</p></figure><h1 id="3350" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">介绍</h1><p id="3dd3" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在这个项目的最后一次迭代中，我向你们展示了我的旅程，我把一个树莓派扔进了我的花园，以监测阳光和水的暴露。在本文中，我们将对原型进行改进，使之可以在室内和室外使用。</p><p id="46b1" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">正如上一篇文章一样，第2部分将回顾我经历的所有步骤，并记录我的一些学习经历。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/304335a3fb329ba5e1a0bc58d5477891.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dEd1R7pfoZPpDUOJ.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">你隐藏了什么秘密？(作者)</p></figure><h1 id="ae47" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">版本1的问题</h1><p id="37d0" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">版本1很有趣——而且很有效！但是它也不是没有问题。让我们快速回顾一下这里需要改进的地方。</p><h1 id="ce6f" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">费用</h1><p id="a5e1" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">一个相当令人望而却步的事情是成本——作为原型，它使用了一个结实的树莓Pi 4 (4GB)，一台零售价为55美元的机器<a class="ae mj" href="https://www.adafruit.com/product/4296" rel="noopener ugc nofollow" target="_blank"/>。然而，实际上，我们希望以大约30美元(按消费价格计算)的价格制造同样的盒子！)，所以我们可以从里到外部署多个。</p><p id="7c8f" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">这是一个简单的解决办法——<a class="ae mj" href="https://www.raspberrypi.org/products/raspberry-pi-zero-w/" rel="noopener ugc nofollow" target="_blank">Raspberry Pi Zero W</a>配有WiFi(这将比[PoE]以太网<em class="mq">【0】</em>更便宜、更普遍)，只需10美元(如果你能找到那个价格的话)。廉价的微型SD卡零售价为3美元，廉价的微型usb电缆和电源插头也是如此，但我认为每个人都有许多电缆和适配器。我们将使用小的试验板，但是如果你想玩短路游戏，你也可以把铜焊接在一起。为可焊接试验板增加大约2美元——继续阅读，看看为什么这可能是一个好主意。</p><p id="88ad" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">回到<code class="fe mr ms mt mu b">Zero W</code>:这是一个神奇的小棒:1Ghz，一个核心，512MB内存，40 PIN GPIO头，摄像头连接器，BLE /蓝牙4.1和802.11 b/g/n WiFi。10美元。不带WiFi 5美元。这大约是我第一台个人电脑的CPU能力的7.7倍，体积大约是它的1/1000！</p><p id="cc00" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">公平地说，它很小，大约是空格键的一半大小(如果这是一个测量单位的话？):</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a16dfa7bf304f5e3a9aba18bac00839d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bJTv3Si2w2Ll1f9b.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">树莓零W在鸭子空格键上，在樱桃MX蓝调床上(作者)</p></figure><p id="d50a" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">当然——一些ESP32可能会更便宜——但树莓也有明显的优势，它不是一个微控制器，而是一台完全成熟的计算机。对于不完全是嵌入式工程师的人来说，学习曲线没有那么陡峭。小RasPis还支持USB，很利落！</p><p id="d830" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated"><em class="mq">【0】</em><a class="ae mj" href="https://buzzert.net/posts/2021-05-09-doorbell" rel="noopener ugc nofollow" target="_blank">这里的</a>是一个有趣的阅读，它依赖于PoE，因此可以使用更简单的设计。</p><h1 id="9d6e" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">功率消耗</h1><p id="e113" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">使用一个<code class="fe mr ms mt mu b">Raspberry</code>和一个<code class="fe mr ms mt mu b">ESP32</code>确实有它的缺点，尽管功耗是其中之一。假设我们想无线收集48小时的数据:</p><p id="b7ea" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">以前使用的<code class="fe mr ms mt mu b">Raspberry Pi 4</code>在怠速时将消耗大约<em class="mq">500-600毫安</em>。在5V电源下，我们可以看到48小时约3W或约144Wh的电流。</p><p id="6dc0" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">提醒:</p><blockquote class="mv mw mx"><p id="ef00" class="ln lo mq lp b lq mk jr ls lt ml ju lv my mm ly lz mz mn mc md na mo mg mh mi ij bi translated"><em class="iq">功率(如</em><strong class="lp ir"><em class="iq">W</em></strong><em class="iq">att</em><strong class="lp ir"><em class="iq">h</em></strong><em class="iq">our)=电压(如</em><strong class="lp ir"><em class="iq">V</em></strong><em class="iq">olts)/电流(如</em><strong class="lp ir"><em class="iq">A</em></strong><em class="iq">MPs)</em></p><p id="269b" class="ln lo mq lp b lq mk jr ls lt ml ju lv my mm ly lz mz mn mc md na mo mg mh mi ij bi translated"><em class="iq"> W =电压*安培*小时</em></p></blockquote><p id="28ab" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">WiFi上的一个<code class="fe mr ms mt mu b">Raspberry Pi Zero W</code>在3.3V上应该在<em class="mq"> 150 - 180 mA </em>左右，板载稳压器支持5V PSUs所以48小时大约0.55W或26.64Wh(大约<em class="mq">一个Pi 4的功耗</em>的18.5%！).</p><p id="f45a" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">然而，另一方面,<a class="ae mj" href="https://www.espressif.com/sites/default/files/documentation/esp32-wroom-32_datasheet_en.pdf" rel="noopener ugc nofollow" target="_blank"> ESP32-WROOM-32 </a>在主动发送数据时，在2.2至3.6V(48小时内低至10.5瓦时)下的范围约为<em class="mq"> 100毫安</em>，而在空闲时几乎没有:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/8d8f9c4d0d502aea7060dcd0ac548c46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WrLPBnd-vvR12x2s.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae mj" href="https://www.espressif.com/sites/default/files/documentation/esp32_datasheet_en.pdf" rel="noopener ugc nofollow" target="_blank">https://www . espressif . com/sites/default/files/documentation/esp32 _ data sheet _ en . pdf</a></p></figure><p id="88f3" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">客观地说，一个AA锂电池的时钟大约为<em class="mq">~ 3000ma</em>，尽管只有3.7V。当然，电源组配备了电源转换器——根据<code class="fe mr ms mt mu b">Pi Zero W</code>的估计消耗和48小时的最低运行时间，一个10，000mAh (10A)和3.7V(这是锂的典型电压)的小型电源组可以为一个Pi供电，在没有转换损耗和低效率的理想情况下，大约为<strong class="lp ir">67小时</strong> (37Wh假设有50%的效率，10Ah可以让我们用大约1.5天，这并不惊人。</p><p id="a229" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">成本也是一个令人望而却步的因素——即使是廉价的(或多或少)电源组或直接的锂电池也几乎是一个单位成本的两倍，最终几乎没有什么好处。例如，<a class="ae mj" href="https://www.pisugar.com/" rel="noopener ugc nofollow" target="_blank"> PiSugar </a>项目的1200毫安时电池价格为39.99美元，预计运行时间为5-6小时——这与上面的计算结果相符(<code class="fe mr ms mt mu b">1.2A*3.7V=4.44Wh</code>、<code class="fe mr ms mt mu b">4.44/0.55Wh*.5=4.3hrs</code>，效率为50%)。</p><p id="d032" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">因此，尽管这并不理想，我们将采取效率增益，但现在放弃电池的话题。</p><h1 id="6404" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">传感器和新零件清单</h1><p id="4177" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">上一个项目也使用了许多不同的传感器来找出哪些效果最好——这一次，我们已经知道我们需要哪些传感器。</p><p id="bec1" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">这是更新后的零件清单:</p><ul class=""><li id="8a92" class="nc nd iq lp b lq mk lt ml lw ne ma nf me ng mi nh ni nj nk bi translated"><strong class="lp ir">棋盘</strong> : <a class="ae mj" href="https://www.raspberrypi.org/products/raspberry-pi-zero-w/" rel="noopener ugc nofollow" target="_blank">树莓派零W</a>——10美元</li><li id="29f3" class="nc nd iq lp b lq nl lt nm lw nn ma no me np mi nh ni nj nk bi translated">SD卡:任何便宜的8-16GB的卡都可以——3美元</li><li id="6794" class="nc nd iq lp b lq nl lt nm lw nn ma no me np mi nh ni nj nk bi translated"><strong class="lp ir">湿度</strong> : <a class="ae mj" href="https://smile.amazon.com/gp/product/B076DDWDJK/ref=ppx_yo_dt_b_asin_image_o01_s00?ie=UTF8&amp;psc=1" rel="noopener ugc nofollow" target="_blank">任何电阻式湿度传感器</a> — $5</li><li id="eb3b" class="nc nd iq lp b lq nl lt nm lw nn ma no me np mi nh ni nj nk bi translated"><strong class="lp ir">温度</strong> : <a class="ae mj" href="https://www.adafruit.com/product/1782" rel="noopener ugc nofollow" target="_blank"> MCP9808高精度I2C温度传感器</a>——4.95美元</li><li id="ce8e" class="nc nd iq lp b lq nl lt nm lw nn ma no me np mi nh ni nj nk bi translated"><strong class="lp ir">光</strong> : <a class="ae mj" href="https://smile.amazon.com/NOYITO-MAX44009-Intensity-Interface-Development/dp/B07HFRS8XX" rel="noopener ugc nofollow" target="_blank"> NOYITO MAX44009 </a>(高达188k lux)——$ 4.95(<em class="mq">撰写本报告时价格上涨</em>)</li><li id="04c7" class="nc nd iq lp b lq nl lt nm lw nn ma no me np mi nh ni nj nk bi translated"><strong class="lp ir"> ADC </strong> : <a class="ae mj" href="https://www.adafruit.com/product/856" rel="noopener ugc nofollow" target="_blank"> MCP3008 8通道10位ADC，带SPI接口</a>——3.75美元</li></ul><p id="43d8" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">这使得我们的开发板总成本从将近100美元增加到大约31.60美元。如果你想要一个更坚固的设计，可焊接的试验板大约需要2美元，一些跳线可能需要0.10美元。</p><p id="7250" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我会称之为成功，因为我可以从全球速卖通以大约一半的价格获得所有零件(不包括Pi ),比如1.50美元的MCP3008。但即使在国内，从Adafruit、Microcenter和Amazon这样的地方，每单位的总成本似乎也是合理的。</p><h1 id="4d6d" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">尺寸、外壳和布局</h1><p id="2300" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">然而，上一次迭代的更大和更明显的限制是尺寸:由于我的天才计划使用Dremel在宜家的一个巨大的(尽管很薄)盒子上钻孔，最终的盒子既巨大又不实用。一个经典的双输局面，正是我喜欢的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/967204833d56cccfff6317ab208b2890.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rmfFs385Mb4gY66h.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">原始案例(作者)</p></figure><p id="8531" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">它还依赖于一个试验板，大量的杜邦电缆，并且通常没有经过深思熟虑——其中的所有东西都应该适合一个小得多的占地面积。</p><p id="29a5" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">改善布局应该是一个相对简单的任务:因为我们知道我们需要的传感器，我们可以优化空间。我们将在下一步做这件事。</p><p id="85b6" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">然而，这是另一个不同的话题。我们现在就来谈这个。</p><h1 id="2c8e" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">简介:3D打印机</h1><p id="9bb2" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我上次已经提到过了，我正在利用这个机会购买一台3D打印机。我选择了<a class="ae mj" href="https://www.creality.com/goods-detail/ender-3-v2-3d-printer" rel="noopener ugc nofollow" target="_blank"> Creality Ender 3 V2 </a>，这可能是PLA和ABS最推荐的预算3D打印机，价格在250美元左右。</p><p id="96e1" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">这是我的第一台3D打印机，至少可以说是一次有趣的学习经历。</p><p id="1f39" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated"><em class="mq">你会发现所有照片的背景都发生了很大变化，因为我们在房子里移动了这个大约19x19英寸的东西——我最后为它买了一个大约22x22英寸的宜家Lack拉克桌子，以防你好奇。</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f0182200368e4e1b63128ffbeeabe85c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JpxSL8FDfwtwWgc8.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">这座房子以前被称为“漂亮部分”的部分(作者)</p></figure><h1 id="f26f" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">构建3D打印机</h1><p id="b2e8" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">Creality自己的网站(！)提供了以下建议:</p><blockquote class="mv mw mx"><p id="573b" class="ln lo mq lp b lq mk jr ls lt ml ju lv my mm ly lz mz mn mc md na mo mg mh mi ij bi translated">当然，它远非完美。</p><p id="9423" class="ln lo mq lp b lq mk jr ls lt ml ju lv my mm ly lz mz mn mc md na mo mg mh mi ij bi translated"><em class="iq">但在这个较低的价格下，它提供了一个体面的打印量，易于组装和改进，并可以产生高质量的打印。</em></p><p id="c6c2" class="ln lo mq lp b lq mk jr ls lt ml ju lv my mm ly lz mz mn mc md na mo mg mh mi ij bi translated"><em class="iq">(</em><a class="ae mj" href="https://www.creality.com/goods-detail/ender-3-v2-3d-printer" rel="noopener ugc nofollow" target="_blank"><em class="iq">)https://www.creality.com/goods-detail/ender-3-v2-3d-printer</em></a><em class="iq">)</em></p></blockquote><p id="6674" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">因此，在网上阅读后，我很清楚一个“标准”的Ender 3 v2无法满足它——太多关于人们在基本功能上挣扎的报道。所以，我在开始第一次打印之前安装了一些更新。那不是一个非常聪明的举动——我应该先试印一份。</p><h2 id="7294" class="nr kw iq bd kx ns nt dn lb nu nv dp lf lw nw nx lh ma ny nz lj me oa ob ll oc bi translated">铝挤压机、0.4毫米喷嘴和Capricorn PTFE波顿管</h2><p id="f6ac" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">第一批更新属于“预防性维护”，即我可能不会注意到的事情，直到我用了一堆打印机，但它似乎是一个很好的更换，因为打印机不是组装好的。我很快意识到那是一个错误。</p><p id="b509" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">第一次升级是铝挤出机:与塑料挤出机相比，这是一个更坚固的版本，可以将细丝移动到热端(熔化细丝的部分)，具有更强的弹簧，以在挤出过程中保持更好的张力。这确保了细丝总是均匀地流动。它也不太可能破裂。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/31f9885cf35984a54f6b5a4f8c59ec48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lVYSVthxTjSvEvJ1.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">升级的挤出机(作者)</p></figure><p id="e123" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">然而，我没有意识到的是，这个过程可能会搞乱打印机的校准，其中要求的细丝长度和挤出的细丝长度不同步，导致温床上的汇集和畸形的打印:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3383e2e438a219d5a53246acc13a2b56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LbNPsUJFe3tMn-Js.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">印刷错误#1(作者)</p></figure><p id="5fb8" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">多亏了一个真正了解3D打印的朋友(因为我只是一个卑微的新手)，我们能够按照这个神奇的网站上的步骤重新校准它。尽管这不是唯一的根本原因，但在许多失败的印刷之后，还是发生了这种情况。无论如何，听从他的建议，把这个网站加入书签吧——这会节省你很多时间。</p><p id="a5b1" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">出于同样的原因，我还安装了更新的管道、喷嘴和连接器——我不相信我会很快遇到问题，但这些升级是最容易做到的，因为其他一切都已经被拆开了。</p><h2 id="80fb" class="nr kw iq bd kx ns nt dn lb nu nv dp lf lw nw nx lh ma ny nz lj me oa ob ll oc bi translated">自动调平</h2><p id="c53c" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">3D打印最重要的事情之一是找平——这是像上面这样的混乱打印的主要问题之一——手动找平一些东西，特别是在1949年的房子里(直到1972年才发明水平地板，有趣的事实)肯定是痛苦的，如果不是完全不可能的话。</p><p id="1e80" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">因此，售价约40美元的<a class="ae mj" href="https://smile.amazon.com/Creality-BLTouch-Upgraded-Leveling-Mainboard/dp/B08L9DHP5R" rel="noopener ugc nofollow" target="_blank"> Creality BLTouch V3.1 </a>是一个了不起的小发明:它不是依赖人类手动移动Z轴，而是为你探测表面。</p><p id="ce21" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">安装它相对简单:你用BLTouch替换常规的Z限制器电缆(这需要你移除主板盖)，沿着管道布线，并用螺栓将其连接到打印头。</p><p id="e81b" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">此时，建议记下主板版本，因为我们需要在下一步进行固件升级:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/6ad2a10c2310ab5bd0fa1225087f5046.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*z4RcqlXiZ7cVDJ8G.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">v 4.2.2(作者)</p></figure><p id="8b8a" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">安装后，它看起来像这样:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ea46ccbc48e3a51599d12fe18b5992e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9WjoR2aTIYZil85A.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">BLTouch(作者)</p></figure><p id="7b52" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我安装的另一件东西是一套<a class="ae mj" href="https://smile.amazon.com/Marketty-Printer-Compression-Actually-Perfectly/dp/B07MTGXYLW" rel="noopener ugc nofollow" target="_blank">更新的弹簧</a>，所以床一旦被调平就能保持水平。</p><h2 id="822a" class="nr kw iq bd kx ns nt dn lb nu nv dp lf lw nw nx lh ma ny nz lj me oa ob ll oc bi translated">新固件</h2><p id="bab0" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">安装完这些更新后，下一步是安装固件——否则，BLTouch什么也做不了。Ender 3 v2对此有一个<em class="mq">有趣的</em>过程——你把一个<code class="fe mr ms mt mu b">.bin</code>文件放到一个空的SD卡上，它就会安装它。</p><p id="de71" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我使用了一个预编译的<a class="ae mj" href="https://github.com/mriscoc/Marlin_Ender3v2" rel="noopener ugc nofollow" target="_blank">马林</a>固件来完成这个任务。</p><p id="6271" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">然而，如果你选择了一个错误的固件，显示器会一直黑屏或者机器会发出可怕的声音。</p><p id="1842" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我想知道它如何验证真实性，如果它只是执行随机代码。我认为是后者。</p><h2 id="753f" class="nr kw iq bd kx ns nt dn lb nu nv dp lf lw nw nx lh ma ny nz lj me oa ob ll oc bi translated">八字印刷</h2><p id="565d" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">虽然所有这些改进都很棒，但在Ender 3上打印任何东西的过程如下:</p><ol class=""><li id="9f6b" class="nc nd iq lp b lq mk lt ml lw ne ma nf me ng mi od ni nj nk bi translated">查找或设计CAD模型</li><li id="03c2" class="nc nd iq lp b lq nl lt nm lw nn ma no me np mi od ni nj nk bi translated">使用切片器，如<a class="ae mj" href="https://ultimaker.com/software/ultimaker-cura" rel="noopener ugc nofollow" target="_blank"> Cura </a>，将你的CAD转换成你的打印机可以理解的g代码切片</li><li id="e0e4" class="nc nd iq lp b lq nl lt nm lw nn ma no me np mi od ni nj nk bi translated">把它移到SD卡上</li><li id="0f8e" class="nc nd iq lp b lq nl lt nm lw nn ma no me np mi od ni nj nk bi translated">将SD卡插入打印机</li><li id="a080" class="nc nd iq lp b lq nl lt nm lw nn ma no me np mi od ni nj nk bi translated">打印，每10分钟带着打印机跑一趟房间，检查一下不可避免的故障</li></ol><p id="54c9" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">然而，有一个很棒的软件，叫做<a class="ae mj" href="https://octoprint.org/" rel="noopener ugc nofollow" target="_blank"> Octoprint </a>，它可以用来通过树莓Pi远程控制你的打印机(或者说，从本地网络)!</p><p id="ab43" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">首先，我打印了一个树莓派的附件(使用迷人的“彩虹丝”，这解释了，嗯，<em class="mq">有趣的</em>颜色组合):</p><ul class=""><li id="c88e" class="nc nd iq lp b lq mk lt ml lw ne ma nf me ng mi nh ni nj nk bi translated"><a class="ae mj" href="https://www.thingiverse.com/thing:4192636" rel="noopener ugc nofollow" target="_blank">安德3双轨覆盆子4表壳</a></li><li id="8145" class="nc nd iq lp b lq nl lt nm lw nn ma no me np mi nh ni nj nk bi translated"><a class="ae mj" href="https://www.thingiverse.com/thing:3417079" rel="noopener ugc nofollow" target="_blank"> Ender 3 Pi凸轮动臂带旋转/倾斜</a></li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1695f32de61bca385fe0522a20417133.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*q60x96kXCo9qN35U.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">附件打印(按作者)</p></figure><p id="0002" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">并安装了它:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/20d13a05e78d4bdc075eb9d83388c0c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ARgVXjxYmMC4QWX5.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">八字印刷案例(作者)</p></figure><p id="aee8" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">然后使用<code class="fe mr ms mt mu b">docker-compose</code>安装Octoprint，告诉DHCP服务器和Pi在WiFi上保持静态IP:</p><pre class="kg kh ki kj gt oe mu of og aw oh bi"><span id="9978" class="nr kw iq mu b gy oi oj l ok ol">version: '2.4'<br/><br/>services:<br/>  octoprint:<br/>    image: octoprint/octoprint<br/>    restart: always<br/>    ports:<br/>      - "80:80"<br/>    devices:<br/>      - /dev/ttyUSB0:/dev/ttyACM0<br/>      - /dev/video0:/dev/video0<br/>    volumes:<br/>     - octoprint:/octoprint<br/>    # uncomment the lines below to ensure camera streaming is enabled when<br/>    # you add a video device<br/>    environment:<br/>      - ENABLE_MJPG_STREAMER=true<br/>  <br/>volumes:<br/>  octoprint:</span></pre><p id="672e" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">(在这里你真正需要检查的是你的<code class="fe mr ms mt mu b">dev</code>ices——容器认为它在和一个串口通信，而实际上，它是第一个USB设备)。</p><p id="4313" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">一旦它开始运行，就可以上传g代码并实时监控指纹:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/25d3bc6494929b7bdf6a3bb636e76a25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0z3fG5MXGMaJZ-rr.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Octoprint用户界面(按作者)</p></figure><p id="0a88" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">您还可以实时查看打印机的各个步骤:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/2827c8390d7e31758237ff8158a0b209.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HYOhtiJH6G84snJZ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Octoprint GCode查看器(按作者)</p></figure><h2 id="6fa1" class="nr kw iq bd kx ns nt dn lb nu nv dp lf lw nw nx lh ma ny nz lj me oa ob ll oc bi translated">找平和埃尔默胶水</h2><p id="6966" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">前面，我提到了调配是需要做的关键事情之一，否则，他们会做出意大利面条:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/fca3745b09d503ebc4ab16cc2649ef4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dQtCFJvAlN6ZKscS.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">印刷错误#2(作者)</p></figure><p id="e91f" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">幸运的是，Octoprint有一个<a class="ae mj" href="https://plugins.octoprint.org/plugins/bedlevelvisualizer/" rel="noopener ugc nofollow" target="_blank">插件</a>我们可以用来支持这一点。</p><p id="0a17" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我使用了以下GCODE:</p><pre class="kg kh ki kj gt oe mu of og aw oh bi"><span id="130f" class="nr kw iq mu b gy oi oj l ok ol">G28<br/>M155 S30<br/>@ BEDLEVELVISUALIZER<br/>G29 T<br/>M155 S3</span><span id="0f2d" class="nr kw iq mu b gy oo oj l ok ol">G28<br/>M155 S30<br/>@ BEDLEVELVISUALIZER<br/>G29 T<br/>M155 S3</span></pre><p id="b247" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">这是之前手动调平后的结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi op"><img src="../Images/75947f5e660a6871856066c88be7d503.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/0*wZ5sdZ09FrGWgJVQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">八行体水平(按作者)</p></figure><p id="99e3" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">然而，这个过程花了我很长时间——对于你在上面的图片上看到的一些印刷品，我使用了埃尔默胶水来增加附着力，以避免印刷品移动。我并不是说我推荐它——然而，它确实会使没有支撑的印刷品粘在不太平整的床上。</p><h1 id="ddf2" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">测试打印和进度</h1><p id="fbaa" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这是第一张照片:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/0421a889eb65ffc549f9cbf23c30078c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oscqgO8sW60fwf22.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">印刷错误#3(作者)</p></figure><p id="e2fb" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">这是后来的一个模型——你可以看到我试图找出的不完美之处——但它比第一次尝试的混乱要好很多:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/fdb3bde3246f8a7455d60d3869b26880.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1gAz4mZ1PpaQBSqd.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">巨大的龙猫考验(摘自《龙猫》/ となりのトト) / [Thingverse 4515916](作者)</p></figure><p id="ff2a" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">到目前为止，一切顺利！</p><h1 id="833e" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">新的组件布局</h1><p id="3d3f" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">现在我们可以打印任何东西，从动漫人物的测试立方体到围栏，让我们再来看看最初原型的布局。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/839365c982c19e3a65824ae6607c20ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*A0Ni35Aw9tKR6HET.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">原始布局(作者)</p></figure><h1 id="670c" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">设计新布局</h1><p id="21d6" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这种布局自然浪费了大量空间。使用与之前相同的布线，但使用20引脚试验板(因为我不会蚀刻PCB，所以这是肯定的),而不是60引脚试验板，去掉了补钉，我们只剩下这个9x6.5cm的小布局:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/0ba2864271e1a4da09783c3ab32c463a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wVfk1KniF4poaaBp.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">新布局(按作者)</p></figure><p id="913e" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我承认，在这种外形下保持这种状态并不容易，拼接5V通道可能也不太明智，但不要让它过载。许多串联设备可能会有问题(由于同一总线上的电阻)，但最终，我不认为这将是一个问题。这不是超级优雅的，但它应该工作。</p><p id="e18c" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">在任何情况下，在这个烧结图中，布局是二维的——一旦我们为<code class="fe mr ms mt mu b">Pi Zero W</code>设计了外壳，我们就可以开始堆叠组件，甚至节省更多空间。我们将在下面看到。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/64416f7d5340431cca09468d4b258eaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*D6j3126W2IO4fVCQ.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">新布局汇编(早期版本)(作者)</p></figure><h1 id="b792" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">新组件</h1><p id="10b9" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我们还用一个新的勒克司传感器，微型<code class="fe mr ms mt mu b">NOYITO MAX44009</code>取代了紫外线。该传感器照常连接到I2C(电源、GND、SCL、SDA)，这就是为什么我们在板上重复使用相同的通道。它也确实很小，对于紧凑的设计来说很好。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0f472f6776c404e5419c170f0a5c57fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ly54RX0bz0ugC8w4.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">焊接后的MAX44009(作者)</p></figure><h1 id="db69" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">软件更新</h1><p id="cdd0" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">接下来要重访的是软件。</p><h2 id="79b8" class="nr kw iq bd kx ns nt dn lb nu nv dp lf lw nw nx lh ma ny nz lj me oa ob ll oc bi translated"><code class="fe mr ms mt mu b">MAX44009</code>和对<code class="fe mr ms mt mu b">0x4B</code>的追求</h2><p id="02a6" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">自然，我们需要以某种方式集成新的传感器。这个东西的文档可以在<a class="ae mj" href="https://www.maximintegrated.com/en/products/interface/sensor-interface/MAX44009.html" rel="noopener ugc nofollow" target="_blank">这里</a>得到，但是没有现成的<code class="fe mr ms mt mu b">pip3</code>依赖。</p><p id="528e" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">人们拿到文档，算出了转换数学公式<a class="ae mj" href="https://github.com/ControlEverythingCommunity/MAX44009/blob/master/Python/MAX44009.py" rel="noopener ugc nofollow" target="_blank">这里</a>和<a class="ae mj" href="https://github.com/rcolistete/MicroPython_MAX44009_driver/blob/master/max44009.py" rel="noopener ugc nofollow" target="_blank">这里</a>——如果你有兴趣从头开始做，请<a class="ae mj" href="https://chollinger.com/blog/2021/04/raspberry-pi-gardening-monitoring-a-vegetable-garden-using-a-raspberry-pi-part-1/#implementing-mcp9808-communications-from-scratch" rel="noopener ugc nofollow" target="_blank">看一下第1部分</a>。</p><p id="a097" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">不过，这款传感器有一个缺点——每份文档都提到它使用I2C地址<code class="fe mr ms mt mu b">0x4A</code>，但在我的例子中，它使用<code class="fe mr ms mt mu b">0x4B</code>、<em class="mq">但不一致</em>:</p><pre class="kg kh ki kj gt oe mu of og aw oh bi"><span id="eacf" class="nr kw iq mu b gy oi oj l ok ol">sudo i2cdetect -y 1<br/>     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f<br/>00:          -- -- -- -- -- -- -- -- -- -- -- -- -- <br/>10: -- -- -- -- -- -- -- -- 18 -- -- -- -- -- -- -- <br/>20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- <br/>30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- <br/>40: -- -- -- -- -- -- -- -- -- -- -- 4b -- -- -- -- <br/>50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- <br/>60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- <br/>70: -- -- -- -- -- -- -- --</span></pre><p id="ac5c" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">亚马逊评论是这样说的:</p><blockquote class="mv mw mx"><p id="325b" class="ln lo mq lp b lq mk jr ls lt ml ju lv my mm ly lz mz mn mc md na mo mg mh mi ij bi translated"><em class="iq">这些有可选的I2C地址0x4a或0x4b。但是请注意，我收到的模块上的地址不是由制造商设置的。</em></p><p id="30b8" class="ln lo mq lp b lq mk jr ls lt ml ju lv my mm ly lz mz mn mc md na mo mg mh mi ij bi translated"><em class="iq">因此，你需要以某种方式将跳线焊盘焊接在电路板上，否则地址将不是确定的，可能会在不同的使用之间改变。(我吃了苦头才发现)。</em></p></blockquote><p id="fa5f" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">官方文档上的CTRL+F不会产生<code class="fe mr ms mt mu b">0x4B</code>的结果，示例代码也默认为0x4A:</p><pre class="kg kh ki kj gt oe mu of og aw oh bi"><span id="2eff" class="nr kw iq mu b gy oi oj l ok ol">class MAX44009 : public i2cSensor<br/>{<br/><br/>    /** ######### Register-Map ################################################################# */<br/><br/>#define MAX_ADDRESS 				0x4a<br/><br/>#define INT_STATUS_REG				0x00<br/>#define INT_ENABLE_REG              0x01<br/>#define CONFIGURATION_REG           0x02<br/>#define   CONFIG_CONT_MASK          (bit(7))  // CONTINOUS MODE<br/>#define     CONFIG_CONT_ON          (1&lt;&lt;7)<br/>#define     CONFIG_CONT_OFF         (0)<br/>#define   CONFIG_MANUAL_MASK        (bit(6))  // MANUAL Set CDR and TIME</span></pre><p id="7a25" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">那不是<em class="mq">好玩</em>吗？！(╯ □ )╯︵ ┻━┻</p><p id="287a" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">无论如何，我只是创建了一个定制版本，它使用了第一次迭代的现有代码库和我奇怪的地址屏蔽:</p><pre class="kg kh ki kj gt oe mu of og aw oh bi"><span id="a4ea" class="nr kw iq mu b gy oi oj l ok ol">from smbus2 import SMBus<br/>import time<br/><br/>class MAX44009:<br/>    # Thanks to https://github.com/rcolistete/MicroPython_MAX44009_driver/blob/master/max44009.py<br/>    # With slight adjustments by chollinger93 for Python3 etc.<br/>    MAX44009_I2C_DEFAULT_ADDRESS = 0x4A<br/>    MAX44009_I2C_FALLBACK_ADDRESS = 0x4B<br/><br/>    MAX44009_REG_CONFIGURATION = 0x02<br/>    MAX44009_REG_LUX_HIGH_BYTE = 0x03<br/>    MAX44009_REG_LUX_LOW_BYTE  = 0x04<br/>    <br/>    MAX44009_REG_CONFIG_CONTMODE_DEFAULT     = 0x00    # Default mode, low power, measures only once every 800ms regardless of integration time<br/>    MAX44009_REG_CONFIG_CONTMODE_CONTINUOUS  = 0x80    # Continuous mode, readings are taken every integration time<br/>    MAX44009_REG_CONFIG_MANUAL_OFF           = 0x00    # Automatic mode with CDR and Integration Time are are automatically determined by autoranging<br/>    MAX44009_REG_CONFIG_MANUAL_ON            = 0x40    # Manual mode and range with CDR and Integration Time programmed by the user<br/>    MAX44009_REG_CONFIG_CDR_NODIVIDED        = 0x00    # CDR (Current Division Ratio) not divided, all of the photodiode current goes to the ADC<br/>    MAX44009_REG_CONFIG_CDR_DIVIDED          = 0x08    # CDR (Current Division Ratio) divided by 8, used in high-brightness situations<br/>    MAX44009_REG_CONFIG_INTRTIMER_800        = 0x00    # Integration Time = 800ms, preferred mode for boosting low-light sensitivity<br/>    MAX44009_REG_CONFIG_INTRTIMER_400        = 0x01    # Integration Time = 400ms<br/>    MAX44009_REG_CONFIG_INTRTIMER_200        = 0x02    # Integration Time = 200ms<br/>    MAX44009_REG_CONFIG_INTRTIMER_100        = 0x03    # Integration Time = 100ms, preferred mode for high-brightness applications<br/>    MAX44009_REG_CONFIG_INTRTIMER_50         = 0x04    # Integration Time = 50ms, manual mode only<br/>    MAX44009_REG_CONFIG_INTRTIMER_25         = 0x05    # Integration Time = 25ms, manual mode only<br/>    MAX44009_REG_CONFIG_INTRTIMER_12_5       = 0x06    # Integration Time = 12.5ms, manual mode only<br/>    MAX44009_REG_CONFIG_INTRTIMER_6_25       = 0x07    # Integration Time = 6.25ms, manual mode only<br/><br/>    def __init__(self, bus=None) -&gt; None:<br/>        if not bus:<br/>            bus = SMBus(1)<br/>        self.bus = bus<br/>        self.addr = self.MAX44009_I2C_DEFAULT_ADDRESS<br/>        self.configure()<br/><br/>    def configure(self):<br/>        try:<br/>            self.bus.write_byte_data(self.addr, <br/>                self.MAX44009_REG_CONFIGURATION, <br/>                self.MAX44009_REG_CONFIG_MANUAL_ON)<br/>        except Exception as e:<br/>            print(e)<br/><br/>    def _convert_lumen(self, raw) -&gt; float:<br/>        exponent = (raw[0] &amp; 0xF0) &gt;&gt; 4<br/>        mantissa = ((raw[0] &amp; 0x0F) &lt;&lt; 4) | (raw[1] &amp; 0x0F)<br/>        return ((2 ** exponent) * mantissa) * 0.045<br/><br/>    def read_lumen(self)-&gt; float:<br/>        data = self.bus.read_i2c_block_data(self.addr,<br/>            self.MAX44009_REG_LUX_HIGH_BYTE, 2)<br/>        return self._convert_lumen(data)<br/>    <br/>    def _switch_addr(self):<br/>        if self.addr == self.MAX44009_I2C_DEFAULT_ADDRESS:<br/>            self.addr = self.MAX44009_I2C_FALLBACK_ADDRESS<br/>        else:<br/>            self.addr = self.MAX44009_I2C_DEFAULT_ADDRESS<br/><br/>    def read_lumen_with_retry(self):<br/>        # To avoid 121 I/O error<br/>        # Sometimes, the sensor listens on 0x4A,<br/>        # sometimes, on 0x4B (ಠ.ಠ)<br/>        try:<br/>            return self.read_lumen()<br/>        except Exception as e:<br/>            print(f'Error reading lumen on {self.addr}, retrying')<br/>            self._switch_addr()<br/>            self.configure()<br/>            return self.read_lumen_with_retry()<br/><br/>if __name__ == '__main__':<br/>    # Get I2C bus<br/>    bus = SMBus(1)<br/>    # Let I2C settle<br/>    time.sleep(0.5)<br/>    MAX44009 = MAX44009(bus)<br/>    # Convert the data to lux<br/>    luminance = MAX44009.read_lumen_with_retry()<br/><br/>    # Output data to screen<br/>    print(f'Ambient Light luminance : {luminance} lux')</span></pre><h1 id="aa28" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">重写客户端</h1><p id="f663" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">除此之外，我对主代码进行了一点更新，使其更加灵活，使用了一个类层次结构，允许来自库、自定义代码、SPI等的各种传感器实现。</p><p id="b9fc" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">这并不完全是工程学上的奇迹——但比以前要好。像往常一样，完整的代码在<a class="ae mj" href="https://github.com/chollinger93/raspberry-gardener" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上。</p><pre class="kg kh ki kj gt oe mu of og aw oh bi"><span id="236d" class="nr kw iq mu b gy oi oj l ok ol">from board import *<br/># ...<br/><br/>class Sensor():<br/>    def __init__(self, sensor: object) -&gt; None:<br/>        self.sensor = sensor<br/><br/>    def read_metric(self) -&gt; dict:<br/>        """Implemented in each sensor<br/><br/>        Returns a `dict` of readings, mapping to the SQL schema.<br/><br/>        Return None if no reading. Equals NULL in DB.<br/><br/>        Returns:<br/>            dict: Column -&gt; Reading<br/>        """<br/>        pass<br/><br/># Temp<br/>class MCP9808_S(Sensor):<br/>    def read_metric(self):<br/>        with busio.I2C(SCL, SDA) as i2c:<br/>            t = adafruit_mcp9808.MCP9808(i2c)<br/>            return {<br/>                'tempC': t.temperature<br/>            }<br/><br/># UV<br/>class SI1145_S(Sensor):<br/>    def read_metric(self):<br/>        vis = self.sensor.readVisible()<br/>        IR = self.sensor.readIR()<br/>        UV = self.sensor.readUV() <br/>        uvIndex = UV / 100.0<br/>        # UV sensor sometimes doesn't play along<br/>        if int(vis) == 0 or int(IR) == 0:<br/>            return None<br/><br/>        return {<br/>            'visLight': vis,<br/>            'irLight': IR,<br/>            'uvIx': uvIndex<br/>        }<br/><br/># Moisture: HD-38 (Aliexpress/Amazon)<br/># pass spi_chan<br/>class HD38_S(Sensor):<br/>    def read_metric(self):<br/>        raw_moisture = self.sensor.value<br/>        volt_moisture = self.sensor.voltage<br/>        if int(raw_moisture) == 0:<br/>            return None<br/>        return {<br/>            'rawMoisture': raw_moisture, <br/>            'voltMoisture': volt_moisture<br/>        }<br/><br/># Lumen: pass MAX44009<br/>class MAX44009_S(Sensor):<br/>    def read_metric(self):<br/>        return {<br/>            'lumen': self.sensor.read_lumen_with_retry()<br/>            }<br/><br/>__sensor_map__ = {<br/>    'uv': SI1145_S,<br/>    'temp': MCP9808_S,<br/>    'lumen': MAX44009_S,<br/>    'moisture': HD38_S<br/>}<br/><br/>def get_machine_id():<br/>    return '{}-{}'.format(platform.uname().node, getmac.get_mac_address())<br/><br/>def main(rest_endpoint: str, frequency_s=1, buffer_max=10, spi_in=0x0, disable_rest=False, *sensor_keys):<br/>    if disable_rest:<br/>        logger.warning('Rest endpoint disabled')<br/>    buffer=[]<br/><br/>    # Create sensor objects<br/>    sensors =  {}<br/>    for k in sensor_keys:<br/>        if k == 'uv':     <br/>            # UV<br/>            sensor = SI1145.SI1145()<br/>        elif k == 'temp':<br/>            # TODO: library behaves oddly<br/>            sensor = None <br/>        elif k == 'lumen':<br/>            sensor = m4.MAX44009(SMBus(1))<br/>        elif k == 'moisture':<br/>            ## SPI<br/>            # create the spi bus<br/>            spi = busio.SPI(clock=board.SCK, MISO=board.MISO, MOSI=board.MOSI)<br/>            # create the cs (chip select)<br/>            cs = digitalio.DigitalInOut(board.CE0)<br/>            # create the mcp object<br/>            mcp = MCP.MCP3008(spi, cs)<br/>            # create an analog input channel on pin 0<br/>            sensor = AnalogIn(mcp, spi_in)<br/>        else:<br/>            logger.error(f'Unknown sensor key {k}')<br/>            continue<br/>        # Create<br/>        sensors[k] = __sensor_map__[k](sensor=sensor)<br/>    <br/>    while True:<br/>        try:<br/>            # Target JSON<br/>            reading = {<br/>                'sensorId': get_machine_id(),<br/>                # Metrics will come from Sensor object<br/>                'tempC': None,<br/>                'visLight': None,<br/>                'irLight': None,<br/>                'uvIx': None,<br/>                'rawMoisture': None,<br/>                'voltMoisture': None,<br/>                'lumen': None,<br/>                'measurementTs': datetime.now(timezone.utc).isoformat() # RFC 3339<br/>            }<br/><br/>            # Read all<br/>            for k in sensors:<br/>                try:<br/>                    sensor = sensors[k]<br/>                    logger.debug(f'Reading {sensor}')<br/>                    metrics = sensor.read_metric()<br/>                    if not metrics:<br/>                        logger.error(f'No data for sensor {k}')<br/>                        continue<br/>                except Exception as e:<br/>                    logger.error(f'Error reading sensor {k}: {e}')<br/>                    continue<br/>                # Combine <br/>                reading = {**reading, **metrics}<br/><br/>    <br/>            # Only send if its not disabled       <br/>            if not disable_rest:<br/>                buffer.append(reading)<br/>                logger.debug(reading)<br/>                if len(buffer) &gt;= buffer_max:<br/>                    logger.debug('Flushing buffer')<br/>                    # Send<br/>                    logger.debug('Sending: {}'.format(json.dumps(buffer)))<br/>                    response = requests.post(rest_endpoint, json=buffer)<br/>                    logger.debug(response)<br/>                    # Reset<br/>                    buffer = []<br/>            else:<br/>                logger.info(reading)<br/>        except Exception as e:<br/>            logger.exception(e)<br/>        finally:<br/>            time.sleep(frequency_s)<br/><br/><br/>if __name__ == '__main__':<br/>    # Args<br/>    parser = argparse.ArgumentParser(description='Collect sensor data')<br/>    # ...<br/><br/>    # Start<br/>    logger.warning('Starting')<br/>    main(args.rest_endpoint, args.frequency_s, args.buffer_max, args.spi_in, args.disable_rest, *args.sensors)</span></pre><p id="61e7" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">整个<code class="fe mr ms mt mu b">if</code> / <code class="fe mr ms mt mu b">else</code>的切换当然可以避免，例如用一个插件模型，就像我在这里为另一个RasPi项目 <code class="fe mr ms mt mu b"><a class="ae mj" href="https://github.com/chollinger93/scarecrow/tree/master/scarecrow_core/plugins" rel="noopener ugc nofollow" target="_blank">scarecrow-cam</a></code>写的<a class="ae mj" href="https://github.com/chollinger93/scarecrow/tree/master/scarecrow_core/plugins" rel="noopener ugc nofollow" target="_blank">。但这比我现在愿意付出的努力要多一点。</a></p><p id="aa2d" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">无论如何，我们可以在本地测试:</p><pre class="kg kh ki kj gt oe mu of og aw oh bi"><span id="5ec6" class="nr kw iq mu b gy oi oj l ok ol">python3 monitor.py --disable_rest --rest_endpoint na --sensors temp lumen moisture</span></pre><p id="b8aa" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">并更新<code class="fe mr ms mt mu b">systemd</code>服务。</p><h1 id="8c3b" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">更新后端</h1><p id="aa88" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">当然，传感器的添加需要模式更新，这在<code class="fe mr ms mt mu b">go</code>中很容易，因为<code class="fe mr ms mt mu b">go</code>有<code class="fe mr ms mt mu b">structs</code>并且不讨厌你:</p><pre class="kg kh ki kj gt oe mu of og aw oh bi"><span id="5461" class="nr kw iq mu b gy oi oj l ok ol">type Sensor struct {<br/>	SensorId      string<br/>	TempC         float32<br/>	VisLight      int32<br/>	IrLight       int32<br/>	UvIx          float32<br/>	RawMoisture   int32<br/>	VoltMoisture  float32<br/>	Lumen         float32<br/>	MeasurementTs string<br/>}<br/><br/>func (a *App) storeData(sensors []Sensor) error {<br/>	q := squirrel.Insert("data").Columns("sensorId", "tempC", "visLight", "irLight", "uvIx", "rawMoisture", "voltMoisture", "lumen", "measurementTs", "lastUpdateTimestamp")<br/>	for _, s := range sensors {<br/>		// RFC 3339<br/>		measurementTs, err := time.Parse(time.RFC3339, s.MeasurementTs)<br/>		if err != nil {<br/>			zap.S().Errorf("Cannot parse TS %v to RFC3339", err)<br/>			continue<br/>		}<br/>		q = q.Values(s.SensorId, s.TempC, s.VisLight, s.IrLight, s.UvIx, s.RawMoisture, s.VoltMoisture, s.Lumen, measurementTs, time.Now())<br/>	}<br/>	sql, args, err := q.ToSql()<br/>	if err != nil {<br/>		return err<br/>	}<br/><br/>	res := a.DB.MustExec(sql, args...)<br/>	zap.S().Info(res)<br/>	return nil<br/>}</span></pre><p id="b3ec" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">这同样适用于<code class="fe mr ms mt mu b">SQL</code>接口/DDL——一个相当标准的练习。</p><h1 id="14af" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">添加新功能</h1><p id="3b55" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">除了收集数据，另一个有用的功能是通知园丁任何问题。为此，我在<code class="fe mr ms mt mu b">go</code>实现了一个简单的通知系统，也就是在服务器上。</p><p id="2323" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">实现很简单，我们为阈值定义常数:</p><pre class="kg kh ki kj gt oe mu of og aw oh bi"><span id="0327" class="nr kw iq mu b gy oi oj l ok ol">// Hard coded alert values for now<br/>const MIN_TEMP_C = 5<br/>const MAX_TEMP_C = 40<br/>const LOW_MOISTURE_THRESHOLD_V = 2.2<br/><br/><br/>func (a *App) checkSensorThresholds(sensor *Sensor) bool {<br/>	if sensor.VoltMoisture &gt;= LOW_MOISTURE_THRESHOLD_V || sensor.TempC &lt;= MIN_TEMP_C || sensor.TempC &gt;= MAX_TEMP_C {<br/>		return true<br/>	}<br/>	return false<br/>}</span></pre><p id="767e" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated"><em class="mq">使用阈值作为</em> <code class="fe mr ms mt mu b"><em class="mq">const</em></code> <em class="mq">的蚂蚁，平心而论，就像重新编译你的内核进行一次</em> <code class="fe mr ms mt mu b"><em class="mq">ulimit</em></code> <em class="mq">的调整——但我在努力避免</em> <code class="fe mr ms mt mu b"><em class="mq">config</em></code> <em class="mq">的文件。</em></p><p id="6a79" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">为了不在每次传感器触发时发送通知，我们还实现了一个定时器，为了简单起见，它使用了一个全局<code class="fe mr ms mt mu b">map</code>和一个<code class="fe mr ms mt mu b">mutex</code>:</p><pre class="kg kh ki kj gt oe mu of og aw oh bi"><span id="aa83" class="nr kw iq mu b gy oi oj l ok ol">// Simple mutex pattern to avoid race conditions<br/>var mu sync.Mutex<br/>var notificationTimeouts = map[string]time.Time{}<br/><br/>const NOTIFICATION_TIMEOUT = time.Duration(12 * time.Hour)<br/><br/><br/>func (a *App) validateSensor(sensor *Sensor) error {<br/>	// Check the values first<br/>	if !a.checkSensorThresholds(sensor) {<br/>		zap.S().Debugf("Values for %s are below thresholds", sensor.SensorId)<br/>		return nil<br/>	}<br/>	// Otherwise, notify<br/>	mu.Lock()<br/>	// If we already have the sensor stored in-memory, check whether its time to notify again<br/>	if lastCheckedTime, ok := notificationTimeouts[sensor.SensorId]; ok {<br/>		if time.Now().Sub(lastCheckedTime) &lt; NOTIFICATION_TIMEOUT {<br/>			// Not time yet<br/>			zap.S().Debug("Timeout not reached")<br/>			return nil<br/>		}<br/>	}<br/>	// Reset the timer<br/>	notificationTimeouts[sensor.SensorId] = time.Now()<br/>	// Otherwise, notify<br/>	err := a.notifyUser(sensor)<br/>	// Release the mutex late<br/>	mu.Unlock()<br/>	return err<br/>}</span></pre><p id="813e" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">通过<code class="fe mr ms mt mu b">smtp</code>发送通知，与前面的迭代类似，我们将秘密保存在环境变量中，而不是配置文件中——为了简单起见，再一次:</p><pre class="kg kh ki kj gt oe mu of og aw oh bi"><span id="c3ee" class="nr kw iq mu b gy oi oj l ok ol">type SmtpConfig struct {<br/>	smtpUser              string<br/>	smtpPassword          string<br/>	smtpAuthHost          string<br/>	smtpSendHost          string<br/>	notificationRecipient string<br/>}<br/><br/>func NewSmtpConfig() *SmtpConfig {<br/>	return &amp;SmtpConfig{<br/>		smtpUser:              mustGetenv("SMTP_USER"),<br/>		smtpPassword:          mustGetenv("SMTP_PASSWORD"),<br/>		smtpAuthHost:          mustGetenv("SMTP_AUTH_HOST"),<br/>		smtpSendHost:          mustGetenv("SMTP_SEND_HOST"),<br/>		notificationRecipient: mustGetenv("SMTP_NOTIFICATION_RECIPIENT"),<br/>	}<br/>}</span></pre><p id="4ad3" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">发送部分可以在<code class="fe mr ms mt mu b">go</code>中本地完成:</p><pre class="kg kh ki kj gt oe mu of og aw oh bi"><span id="f44d" class="nr kw iq mu b gy oi oj l ok ol">func (a *App) notifyUser(sensor *Sensor) error {<br/>	header := fmt.Sprintf("To: %s \r\n", a.SmtpCfg.notificationRecipient) +<br/>		fmt.Sprintf("Subject: Sensor %v reached thresholds! \r\n", sensor.SensorId) +<br/>		"\r\n"<br/>	msg := header + fmt.Sprintf(`Sensor %s encountered the following threshold failure at %v:<br/>	Temperature: %v (Thresholds: Min: %v / Max: %v)<br/>	Moisture: %v (Thresholds: Min: %v / Max: N/A)`, sensor.SensorId, sensor.MeasurementTs,<br/>		sensor.TempC, MIN_TEMP_C, MAX_TEMP_C, sensor.VoltMoisture, LOW_MOISTURE_THRESHOLD_V)<br/>	zap.S().Warn(msg)<br/>	// Get config<br/>	// Auth to mail server<br/>	auth := smtp.PlainAuth("", a.SmtpCfg.smtpUser, a.SmtpCfg.smtpPassword, a.SmtpCfg.smtpAuthHost)<br/>	err := smtp.SendMail(a.SmtpCfg.smtpSendHost, auth, a.SmtpCfg.smtpUser,<br/>		[]string{a.SmtpCfg.notificationRecipient}, []byte(msg))<br/>	if err != nil {<br/>		zap.S().Errorf("Error sending notification email: %v", err)<br/>		return err<br/>	}<br/>	return nil<br/>}</span></pre><p id="0fce" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">它会发出这样的信息:</p><blockquote class="mv mw mx"><p id="0ca8" class="ln lo mq lp b lq mk jr ls lt ml ju lv my mm ly lz mz mn mc md na mo mg mh mi ij bi translated"><em class="iq">传感器单元测试在2021–07–01t 10:00:00遇到以下阈值故障:温度:4(阈值:最小值:5 /最大值:40)湿度:1.5(阈值:最小值:2.2 /最大值:不适用)</em></p></blockquote><p id="b406" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">有用！正如我们将在下面看到的，40摄氏度是相当低的，但总是可以调整的。</p><h1 id="d38f" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">重新部署<code class="fe mr ms mt mu b">Pi Zero W</code></h1><p id="0722" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">现在我们所有的软件都是最新的，是时候设置一个新的<code class="fe mr ms mt mu b">Raspberry Pi Zero W</code>了。</p><h1 id="223e" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">物理装配</h1><p id="8c8e" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这个很简单:我在它上面放了一个铝制散热器(可能没有意义，但我确实有这些——我不知道外面会有多热)，并将I2C接头焊接到一些引脚上。</p><p id="1e9d" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated"><code class="fe mr ms mt mu b">Pi Zero</code>如此便宜的部分原因是你需要自己焊接引脚——为了节省最终设计的空间，我将<code class="fe mr ms mt mu b">Pi Zero</code>倒过来焊接(就像将<code class="fe mr ms mt mu b">Pi</code>放在试验板上一样)。这里的想法是将试验板拍在板的背面，而不妨碍APU，因此不会给小Pi造成热噩梦。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cc7c484315a6a1fc4368f9a86e01a4f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kWqqLjz7bgjv9lnK.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">圆周率为零——我用完了所有的针(作者)</p></figure><p id="9eea" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">当然，人们可以直接在Pi上焊接电缆，但我想为将来可能的调整留有余地。你马上就会看到，这是一个明智的选择。</p><h1 id="3f06" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">软件部署</h1><p id="4de2" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">当然，现在我正在考虑编写一个实际的部署管道，或者甚至构建Docker映像——但是当面临“在湖上钓鱼而无所事事”和“从头配置CI/CD”之间的冲突时，前者(幸运地)胜出。</p><p id="79b7" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">首先，使用<a class="ae mj" href="https://www.raspberrypi.org/blog/raspberry-pi-imager-imaging-utility/" rel="noopener ugc nofollow" target="_blank"> Raspi成像仪</a>安装一个<code class="fe mr ms mt mu b">Raspbian</code>操作系统。这将把<code class="fe mr ms mt mu b">boot</code>和<code class="fe mr ms mt mu b">root</code>安装到你的电脑上。</p><p id="b47e" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated"><code class="fe mr ms mt mu b"><em class="mq">chroot</em></code> <em class="mq">，如果你不熟悉的话，就像</em> <code class="fe mr ms mt mu b"><em class="mq">docker</em></code> <em class="mq">，只是不像潮人。:)</em></p><p id="16fc" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">首先，通过在<code class="fe mr ms mt mu b">boot</code>的挂载点上执行<code class="fe mr ms mt mu b">touch ssh</code>来启用ssh。</p><p id="3110" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">然后，要启用WiFi，将您现有的<code class="fe mr ms mt mu b">/etc/wpa_supplicant/wpa_supplicant.conf</code>复制到同一个分区。如果您没有或使用macOS/Windows，请对此进行自定义:</p><pre class="kg kh ki kj gt oe mu of og aw oh bi"><span id="78e3" class="nr kw iq mu b gy oi oj l ok ol">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev<br/>update_config=1<br/>country=US<br/><br/>network={<br/>       ssid="YourNetworkSSID"<br/>       psk="Password"<br/>       key_mgmt=WPA-PSK<br/>    }</span></pre><p id="e0cc" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">然后，<code class="fe mr ms mt mu b">chroot</code>主分区:</p><pre class="kg kh ki kj gt oe mu of og aw oh bi"><span id="53ea" class="nr kw iq mu b gy oi oj l ok ol">sudo proot -q qemu-arm -S /media/$USER/rootfs</span></pre><p id="5fc2" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">并运行以下安装脚本:</p><pre class="kg kh ki kj gt oe mu of og aw oh bi"><span id="280d" class="nr kw iq mu b gy oi oj l ok ol">#!/bin/bash<br/><br/>if [[ $EUID -ne 0 ]]; then <br/>    echo "This script must be run as root"<br/>    exit 1<br/>fi<br/><br/>if [[ -z "${PI_IP}" || -z ${PI_DNS} || -z ${REST_ENDPOINT} || -z ${PI_ROUTER} ]]; then <br/>    echo "Usage: PI_IP=192.168.1.2 PI_ROUTER=192.168.1.1 PI_DNS=8.8.8.8 REST_ENDPOINT=http://server.local:7777 ./setup_pi_zero.sh"<br/>fi <br/><br/># Install dependencies<br/>apt-get update<br/>apt-get install git python3 python3-pip python3-venv i2c-tools vim ntpdate<br/><br/># Enable I2C, SPI<br/>echo "Enable I2C and SPI manually by running raspi-config over ssh"<br/>#raspi-config <br/><br/># Static IP<br/>echo "interface wlan0" &gt;&gt; /etc/dhcpcd.conf<br/>echo "static ip_address=${PI_IP}/24" &gt;&gt; /etc/dhcpcd.conf<br/>echo "static routers=${PI_ROUTER}" &gt;&gt; /etc/dhcpcd.conf<br/>echo "static domain_name_servers=${PI_DNS} 1.1.1.1 fd51:42f8:caae:d92e::1" &gt;&gt; /etc/dhcpcd.conf<br/>echo "nameserver ${PI_DNS}" &gt;&gt; /etc/resolv.conf <br/><br/># Time<br/>timedatectl set-timezone America/New_York<br/>timedatectl set-ntp True<br/><br/># Clone code <br/>cd /home/pi<br/>mkdir -p /home/pi/workspace<br/>cd /home/pi/workspace<br/>git clone https://github.com/chollinger93/raspberry-gardener<br/>cd raspberry-gardener/client<br/>SENSORS="temp lumen moisture" # Customize<br/><br/># Install <br/>mkdir -p /opt/raspberry-gardener<br/>touch /opt/raspberry-gardener/.env.sensor.sh<br/>echo "REST_ENDPOINT=$REST_ENDPOINT" &gt; /opt/raspberry-gardener/.env.sensor.sh<br/>echo "SENSORS=$SENSORS" &gt;&gt; /opt/raspberry-gardener/.env.sensor.sh<br/>cp monitor.py /opt/raspberry-gardener/<br/>cp -r max44009/ /opt/raspberry-gardener/<br/><br/># Install packages as sudo if the sensor runs as sudo<br/>pip3 install -r requirements.txt<br/><br/># Systemd<br/>mkdir -p /var/log/raspberry-gardener/<br/>cp garden-sensor.service /etc/systemd/system/<br/>systemctl start garden-sensor<br/>systemctl enable garden-sensor # Autostart<br/><br/># logrotate.d<br/>cat &gt; /etc/logrotate.d/raspberry-gardener.conf &lt;&lt; EOF<br/>/var/log/raspberry-gardener/* {<br/>    daily<br/>    rotate 1<br/>    size 10M<br/>    compress<br/>    delaycompress<br/>}<br/>EOF</span></pre><p id="1a8c" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">并运行:</p><pre class="kg kh ki kj gt oe mu of og aw oh bi"><span id="14a6" class="nr kw iq mu b gy oi oj l ok ol">export PI_IP=192.168.1.2 <br/>export PI_DNS=8.8.8.8 <br/>export REST_ENDPOINT=http://server.local:7777 <br/>./setup_pi_zero.sh</span></pre><p id="b215" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">当然，您也可以通过SSH来实现这一点——这样会更容易，但速度会更慢。然而，<code class="fe mr ms mt mu b">raspi-config</code>必须在实际设备上运行，因为它加载内核模块。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/e5440f07ab3da4abe2c732c61a882f7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xG5X1Q2fQvxZshtX.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">raspi-config(作者)</p></figure><p id="1965" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">您可能还想定制<code class="fe mr ms mt mu b">/etc/logrotate.d</code>中的<code class="fe mr ms mt mu b">logrotate</code>配置:</p><pre class="kg kh ki kj gt oe mu of og aw oh bi"><span id="ed7c" class="nr kw iq mu b gy oi oj l ok ol">/var/log/raspberry-gardener/* {<br/>    daily<br/>    rotate 1<br/>    size 10M<br/>    compress<br/>    delaycompress<br/>}</span></pre><p id="c7e8" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我们只需要运行一次，然后将整个SD卡<code class="fe mr ms mt mu b">dd</code>到另一个<code class="fe mr ms mt mu b">Pi</code>上，或者在每个<code class="fe mr ms mt mu b">Pi</code>上运行它——这实际上没有什么区别。</p><p id="5fd8" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">如果你想<code class="fe mr ms mt mu b">dd</code>，我建议你在启动<code class="fe mr ms mt mu b">Pi</code>并运行<code class="fe mr ms mt mu b">sudo raspi-config</code>之后再做:</p><pre class="kg kh ki kj gt oe mu of og aw oh bi"><span id="d7e8" class="nr kw iq mu b gy oi oj l ok ol">s<!-- -->udo umount /media/$USER/rootfs<br/>sudo umount /media/$USER/boot<br/><br/>sudo dd of=$HOME/$(date --iso)_raspberry_rootfs.img if=/dev/mmcblk0p2 bs=4M<br/>sudo dd of=$HOME/$(date --iso)_raspberry_boot.img if=/dev/mmcblk0p1 bs=4M</span></pre><p id="4f6b" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">拥有一个图像是很有用的，所以一旦它起作用了，你可能就想这么做了。</p><h1 id="001b" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">快速测试</h1><p id="36d4" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">此时，建议测试整个设置，例如查看负载:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/dcf242f041fe366ee8d491a264d8175c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*08976zQibB-RxE0-.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Pi空载(作者)</p></figure><p id="aff4" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">也许还可以看看Grafana，因为一旦你通过<code class="fe mr ms mt mu b">raspi-config</code>启用<code class="fe mr ms mt mu b">I2C</code>和<code class="fe mr ms mt mu b">SPI</code>，服务就会开始运行。</p><h1 id="561a" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">建造新的围墙</h1><p id="34f0" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">让我们开始建立一个新的案例！</p><p id="523e" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">最初，我想“重新组合”(派生)一个现有的Pi Zero外壳，就像<a class="ae mj" href="https://www.thingiverse.com/thing:2171313" rel="noopener ugc nofollow" target="_blank">这个</a>一样，但很快发现我的CAD技能太新，无法在实际功能模型上工作。所以我从零开始。</p><h1 id="63fe" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">测试组件</h1><p id="caaf" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在做任何事情之前，我们必须在没有外壳的情况下组装整个组件，以了解所有组件是如何组合在一起的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c4ab6c7fa034dbb0e046226d011f7c20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZJ1LcUhTlgFwCKuz.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">试验板组件(作者提供)</p></figure><h1 id="3bc3" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">进行测量</h1><p id="0d67" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">接下来，我用一些相当精确的卡尺来测量所有的尺寸，并在纸上画出一些粗略的想法。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/b185315eb78e02b7eba4d3037c634778.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CXEjRJa1EpcsBCFL.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">测量值(按作者)</p></figure><p id="adc6" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我不会让你看到草图的。</p><h1 id="6655" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">涉足CAD</h1><p id="6414" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">当谈到CAD时，有很多选项可用——但我选择了Autodesk的免费<a class="ae mj" href="https://www.tinkercad.com" rel="noopener ugc nofollow" target="_blank"> Tinkercad </a>，因为它非常简单。Fusion 360确实有个人使用的免费版本，但是不能在Linux上运行。</p><p id="80aa" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">虽然我不能忍受基于浏览器的工具(电子网络应用程序)的T4，但它们有时比试图强迫其他软件与Linux和谐相处更容易。就像他们说的，事情就是这样。</p><p id="40e0" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">不管怎么说，Tinkercad是针对业余爱好者和学生的，它有一个丰富多彩的教程，连我都懂。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/18afb573bc827080ce24057b68674418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mgSSD3k2aDLLY7Oe.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Tinkercad(作者)</p></figure><h1 id="a81d" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">设计(1.0版)</h1><p id="1e53" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我的设计非常非常简单——但这可能是因为这是我的第一个CAD设计——我通常是那种测量一次，切割两次的类型。</p><p id="05dd" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">有趣的事实:在我的棚子里有一小块2x4的木板，上面用sharpie写着尺寸。它们与2x4的尺寸完全不匹配。这就是你应该知道的全部——但是，它通常会解决。毕竟，我在这片土地上建造了所有的高架床！</p><p id="e0a5" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">事实证明，计算机辅助设计比圆锯需要更高的精确度。这种设计背后的想法与其他商业保护套没有太大的不同:4个大头针粘在一起将保护套固定在一起。小切口支持我需要的电缆的准确放置——只是比商业案例的切口更少。此外，该案件有更多的浪费空间比它需要的，以支持杜邦电缆，而不需要焊接的东西直接到头部。</p><p id="90a1" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">一旦我有了基于这些想法和测量的类似模型的东西，我就导出<code class="fe mr ms mt mu b">.stl</code>文件，将其加载到Cura并开始打印。</p><p id="7c01" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">很自然地，我弄乱了打印设置，高估了打印机的能力(这最终取决于切片机的设置)——小小的支撑梁变成了意大利面条。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/4ba452b2ff4d5638253d31d8fbc15255.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/0*wy8m5XpqldMp5oBh.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">正在打印(按作者)</p></figure><p id="297e" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我还意识到，我测量的公差对于我在Cura中设置的打印设置来说有点太详细了，我完全搞乱了其他测量——换句话说，设计不是很好。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/915b591a06b69d8b4dd5d9d099435ece.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jWx8EqP8-P88rGt6.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">那不符合(作者)</p></figure><h1 id="dedc" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">设计(2.0版)</h1><p id="416c" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">第二个设计遵循了一个不同的理念:更大的公差可以在以后填充。</p><p id="cca9" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">它还避免了脆弱的支撑梁，依靠一个比底部稍小的顶部。它还将湿度传感器的切口移到了顶部，给fit更多的空间。</p><p id="a362" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">最后但同样重要的是，它为码头本身增加了两个支撑金字塔，所以它可以安全地坐落在围栏的底部。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/e185a478726708579600034b66ece64e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*D36OdGwa2uQLwfTx.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">第二次设计(作者)</p></figure><h1 id="819c" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">防水问题</h1><p id="07df" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">不幸的是，这种设计没有解决一个问题:防水(或防风雨)。</p><p id="d4e6" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">现在，虽然一个专门制造的箱子无疑比任何商业箱子都更合适(如果你能找到适合所有组件的话)，但设计和打印需要密封并且公差很小的东西不在我目前的CAD技能范围内。</p><p id="f772" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">然而，还有其他选择——也就是指甲油和电工胶带，我上次已经大量使用了。指甲油不导电，能形成良好的密封，但不耐热——据说要到120摄氏度(248华氏度)左右。鉴于这将只适用于2个外部传感器，我不太担心这一部分——我不认为我的辣椒是热安全的。</p><p id="dbb0" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">虽然我不打算将整个Pi浸在指甲油中，但我们可以在某种程度上防止传感器受天气影响，这些传感器<em class="mq">有</em>在外壳外面，以进行精确测量。传感器和外壳之间的连接足够精确，可以密封，你猜对了！，电工胶带。</p><p id="91df" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">已经进行了许多聪明的实验，将指甲油视为保形涂层的替代物——据我所知，它是有效的，但由于没有标准的指甲油配方(正如我在当地的Kroger发现的那样)，一些添加剂可能会干扰PCB上的塑料。</p><p id="6259" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">当然，如果你预见到再也不用接触Pi，你也可以把整个东西浸在树脂或硅树脂里——但是我们现在坚持用指甲油。</p><h1 id="e9e7" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">装配</h1><p id="2997" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">随着第二个设计打印出来，组装相对简单:只需把所有东西都扔进去，暂时接受一些设计缺陷，并使用更多的电工胶带来保持它的位置，并将传感器放入顶部切口。</p><p id="2f6c" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">很自然，试验板上的所有东西都会引起一个问题，这是每个以前做过台式电脑的人都知道的——电缆管理。退一步说，标准长度的电缆很紧:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/521064c43584080b9a4f22c20a1205b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1d-eNRLLSB_VcoWB.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">第一次装配(按作者)</p></figure><p id="d69b" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">这里的选择包括自己卷曲一些微小的电缆或购买更小的电缆。或者，当然，红脖子工程学院总是有帮助的:解开电缆，用烙铁在末端镀锡，直到它适合试验板的插槽(信不信由你，这是可行的)。一卷24AWG电线也可以。</p><p id="9941" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">虽然我不想告诉你如何生活，但我也许可以提供一句忠告:不值得花一个小时试图将电缆组装在一起，并在这样做的同时吸入大量有害气体，只是为了节省10美元买一把电线。我听说是这样。下面的3.0版本注意到了一些建议。</p><p id="94f8" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">一个相关的问题是湿度传感器——我没有考虑到长杜邦端件在这一点上。所以我做了任何正常人都会做的事情，只是解开一些电缆，直接焊接到PC上，而不是再打印4个多小时~ 5毫米。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/9442da39fe57f4cea5f3fb6dea9c095b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cmstgq9ruoNIDK9h.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">It works(作者)</p></figure><h1 id="d7b1" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">户外测试</h1><p id="1f32" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">所有这些都解决了，新的后端服务也部署好了(停止<code class="fe mr ms mt mu b">systemd</code>服务，从<code class="fe mr ms mt mu b">git</code>重新编译，复制新的二进制文件，重新启动服务——如果你想要电子邮件，调整<code class="fe mr ms mt mu b">.env.sh</code>文件)，我们已经准备好测试了！</p><h1 id="caeb" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">寻找一个地方</h1><p id="7f9f" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在这个测试中，我首先把这个小盒子搬到了甲板上，以观察我们的一些辣椒植物，即一种非常快乐的中国辣椒“Habanero”(如果你是一个正常人，也称为“Habanero Pepper”)。</p><p id="6e35" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">剩下的唯一问题仍然是供电问题——我没有防水的USB电源插头。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a8766e49030d58f61dcdddb393d0e78c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-BY_lhwnAn38CoHo.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">首次室外测试(作者)</p></figure><p id="ce3f" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated"><em class="mq">(忽略胶带—见上面的电缆注释—下一次迭代就不需要了)</em></p><p id="2065" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">无论如何，我在中午时分把盒子扔了出去，然后去买杀虫剂，试图挽救大约30棵花椰菜免受虫害，以及10立方英尺的覆盖物，因为显然，花园之旅永远不会停止。</p><p id="ffba" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">不过，在离开之前，对数据库的快速浏览显示，这个小盒子一通电就开始收集数据，这要归功于<code class="fe mr ms mt mu b">systemd</code>服务(我称之为“即插即用”)。</p><p id="61f5" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">大约2小时后，我们可以找到光线和温度的良好数据:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/11fc84048c44f3753d0fe6d2531da5f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*i8hA7-VgII9bsCbk.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">甲板上的卢蒙(作者)</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/b359c43552022395fc55040b890296f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YtZswmL13vOxs6E2.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">甲板上的温度(作者)</p></figure><p id="3129" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我们可以在这里看到一些非常令人印象深刻的峰值——在阳光直射下超过60摄氏度(140华氏度)(远远高于我们在后端配置的40摄氏度峰值！).这并不令人惊讶——停在阳光下的汽车可以达到类似的温度(事后看来，这可以解释为什么我的卡车似乎每天都试图煮沸我的太阳镜)。</p><p id="7c9b" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">然而，我们可以看到ADC没有收集数据:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/463b599184a66e6b4977b260e580ea72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iWWZJ3Ah10SrMzzU.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">破损的湿度传感器(作者)</p></figure><p id="ea87" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">结果证明，这是<code class="fe mr ms mt mu b">MCP3008</code>上的无效引脚布线——所以我们得到电压波动读数作为数据。请参见<a class="ae mj" href="https://chollinger.com/blog/2021/04/raspberry-pi-gardening-monitoring-a-vegetable-garden-using-a-raspberry-pi-part-1/#analog-sensors--soil-moisture" rel="noopener ugc nofollow" target="_blank">第1部分</a>深入了解——总结就是，ADC将始终报告值，即使它们并不真正基于任何东西。</p><h1 id="ccf0" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">微调和故障排除</h1><p id="8d87" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在修复了这个错误之后，我还将顶部的外壳再加高了10毫米，尽管这并没有解决所有问题——外壳仍然非常紧，一些印刷缺陷使得将两部分装配在一起变得不容易。</p><p id="375e" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">在组装过程中，一些杜邦线缆脱落的情况也经常发生——只有当整个过程都在发送数据时，你才会意识到这一点。</p><p id="e660" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">I2C和SPI在这方面也特别有魅力，因为一旦数据或同步线路上有电流，它们就会显示为连接，尽管传感器上可能没有电源(因为电缆决定脱落)。10-20厘米电缆的巨大尺寸经常碍事。</p><p id="9123" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">这不行。</p><h1 id="21e9" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">3.0版和部署</h1><p id="bcc5" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这将是本文的最终版本。</p><h1 id="e629" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">装配</h1><p id="5cec" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我可以用来优化这一点的唯一方法是直接用常规标准24 AWG导线将所有东西焊接在一起，并使用大约50毫米的杜邦电缆，减少不在试验板本身上的所有连接周围的导线长度和密度(因为这里很容易使用跳线)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8c05a2c2588fdac1b6df0d06b020cbb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Kgw11be4U_iosLFU.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">最终装配(由作者完成)</p></figure><p id="fb5e" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">稍后会详细介绍。</p><h1 id="ac77" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">室内最终测试</h1><p id="e549" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">最后，这个小盒子已经准备好部署在(文字)领域了。不过，在这之前，我让它连着厨房里的一个弱光设备运行了一夜，以确保最后一次一切正常:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e2cab53694cd0cd0621500c984aed2af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kLHr5PGl-iEFxPeH.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">室内测试(作者)</p></figure><p id="6661" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我很高兴我这么做了，因为如果你短了<code class="fe mr ms mt mu b">SDA</code>和<code class="fe mr ms mt mu b">SCL</code>，这就是<code class="fe mr ms mt mu b">i2detect</code>所做的:</p><pre class="kg kh ki kj gt oe mu of og aw oh bi"><span id="6900" class="nr kw iq mu b gy oi oj l ok ol">pi@raspberrypi:/var/log/raspberry-gardener $ sudo i2cdetect -y 1<br/>     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f<br/>00:          03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f <br/>10: 10 11 12 13 14 15 16 17 18 19 1a 1b 1c 1d 1e 1f <br/>20: 20 21 22 23 24 25 26 27 28 29 2a 2b 2c 2d 2e 2f <br/>30: 30 31 32 33 34 35 36 37 38 39 3a 3b 3c 3d 3e 3f <br/>40: 40 41 42 43 44 45 46 47 48 49 4a 4b 4c 4d 4e 4f <br/>50: 50 51 52 53 54 55 56 57 58 59 5a 5b 5c 5d 5e 5f <br/>60: 60 61 62 63 64 65 66 67 68 69 6a 6b 6c 6d 6e 6f <br/>70: 70 71 72 73 74 75 76 77</span></pre><p id="a3df" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">哦好吧。ヽ( ー` )┌</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/ac68cf3adc878eaf10a57690fbdbe767.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aEuDkauVV4q_PG_n.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">室内监控(作者)</p></figure><p id="d590" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">在室内，尤其是在晚上，唯一有点相关的指标是温度——25C/77F在晚上关闭空调的情况下似乎是合理的——和土壤湿度，后者不会变化那么快。上一篇文章我们还记得，1.5V是“湿土”。有用！</p><p id="d400" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">然而，流明始终为零——请参见下面中的<a class="ae mj" href="https://chollinger.com/blog/2021/07/raspberry-pi-gardening-monitoring-a-vegetable-garden-using-a-raspberry-pi-part-2-3d-printing/#data-analysis--reminders" rel="noopener ugc nofollow" target="_blank">试图解释这一点。</a></p><h1 id="1ded" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">户外部署和数据收集</h1><p id="100b" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">第二天早上8:30左右，我终于把这个绿色的小盒子放在了我的胡萝卜和黄瓜之间:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/93fe80675ce65a85facf43b6da0aab11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gbcAeWEhVl2l6ekO.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">室外部署#1(作者)</p></figure><p id="9225" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">一路顺风，小家伙！</p><h1 id="fe57" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">数据分析和提醒</h1><p id="80d0" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这是多么美好的一天！在和许多神奇的萤火虫度过了一个美妙的夜晚后，我在晚上10:30左右关掉了RasPi:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a9a36ee8c7332e31afd1811591601e1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*K596U7grheYH-uaH.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">小派上床睡觉前不久(作者)</p></figure><p id="314f" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">因此，让我们来看看全天的所有指标！</p><h2 id="6573" class="nr kw iq bd kx ns nt dn lb nu nv dp lf lw nw nx lh ma ny nz lj me oa ob ll oc bi translated">流明/光</h2><p id="48af" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这个真的很有趣——你可以看到峰值在900勒克斯左右。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/d0f67f55a2eda9a09343bbce5c4183f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oT58fLzWON2_tRg2.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">灯光(作者)</p></figure><p id="3028" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">现在看维基，900勒克斯大致是个“阴天”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/1fc7f8c43540b07d47dfb38994929d11.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/0*09KjHi6TvwIwXlG1.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae mj" href="https://en.wikipedia.org/wiki/Lux" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Lux</a></p></figure><p id="0b6c" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">整个刻度是对数的，所以看数值&lt;= 0 is a bit of a challenge with Grafana — we can, however, find those values on the database. However, looking at the sensor’s <a class="ae mj" href="https://datasheets.maximintegrated.com/en/ds/MAX44009.pdf" rel="noopener ugc nofollow" target="_blank">规格表</a>，我不认为数值&lt; = 0应该被认为是有效的(因为<code class="fe mr ms mt mu b">Pi</code>上的<code class="fe mr ms mt mu b">python</code>程序以相当标准的设置运行)。</p><p id="b2ef" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">还有-</p><blockquote class="mv mw mx"><p id="230d" class="ln lo mq lp b lq mk jr ls lt ml ju lv my mm ly lz mz mn mc md na mo mg mh mi ij bi translated"><em class="iq">光源在垂直于光源方向的表面上提供的照度是从该位置感知的光源强度的量度。</em></p><p id="de91" class="ln lo mq lp b lq mk jr ls lt ml ju lv my mm ly lz mz mn mc md na mo mg mh mi ij bi translated">例如，一颗视星等为0的恒星在地球表面提供2.08微勒(μlx)。</p><p id="a5f7" class="ln lo mq lp b lq mk jr ls lt ml ju lv my mm ly lz mz mn mc md na mo mg mh mi ij bi translated"><em class="iq">一颗几乎察觉不到的6星等恒星提供8纳勒克斯(nlx)。无遮挡的太阳在地球表面提供高达100千勒克斯(klx)的照度，确切值取决于一年中的时间和大气条件。</em></p><p id="72df" class="ln lo mq lp b lq mk jr ls lt ml ju lv my mm ly lz mz mn mc md na mo mg mh mi ij bi translated"><em class="iq">这种直接法向照度与日光照度常数Esc相关，等于128000勒克斯(见日光和日光常数)</em></p></blockquote><p id="9bd9" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">所以角度——平行于地面——可能起了相当大的作用。由于I2C传感器的任何测量本质上都是相对的，所以让我们来看看…</p><h2 id="b896" class="nr kw iq bd kx ns nt dn lb nu nv dp lf lw nw nx lh ma ny nz lj me oa ob ll oc bi translated">温度</h2><p id="7d4f" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">….温度，看看我们能否将两者关联起来，以补偿不太理想的校准。iOS天气应用程序显示白天温度为84–86华氏度(29–30摄氏度)，这在这里是一个相当普通的夏天。</p><p id="f8f8" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">查看传感器的度量，我们会发现高达50C (122F)的峰值，这与流明中的峰值相关，但远不如它们在甲板上(如果您还记得第1部分，甲板就在观察到的凸起床上)时那么强:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pb"><img src="../Images/7df2acc6bbeee7824d7c2f36dc0ce79d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*efLC-du2KWlUF6D1.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">温度(作者)</p></figure><p id="fce7" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">因此，我们可以合理地得出结论:被观察的胡萝卜、黄瓜和甜椒并没有得到每天6小时的全日照(通常的“全日照”标准)，而是接近3小时，这将被称为“部分日照”。然而，所有的辣椒都要应对60摄氏度以上和1.5千流明的高温——这可能解释了为什么它们以目前的速度生长，与其他植物只有几英尺的距离。</p><h2 id="4488" class="nr kw iq bd kx ns nt dn lb nu nv dp lf lw nw nx lh ma ny nz lj me oa ob ll oc bi translated">水分</h2><p id="a7e3" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这个很无聊——虽然我在下午5:30左右给花坛浇水，但考虑到表土的巨大体积(毕竟它们是凸起的花坛),几加仑50平方英尺的水可能不会有什么影响:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pc"><img src="../Images/28c276cf50b0acb20395f4763240609a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*K7GS82AoffZd2YRi.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">水分(按重量)</p></figure><p id="5e36" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">除非你给叉子所在的特定位置浇水，否则测量结果不会有太大变化，除非整个床都干了，此时你可能不应该看着Grafana，而是拿着喷壶或水管出去。</p><p id="11f1" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">然而，它们在小盆上工作得很好——在高架床上，也许一种不同的方法可能是合适的。</p><h1 id="c09c" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">批评和下一步措施</h1><p id="d2ca" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在所有这些改进之后，让我们再来一次回顾——或者至少是类似的东西。</p><p id="6665" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">新的外壳有点像弗兰肯斯坦——我确实有一些可焊接的迷你试验板，但在撰写本文时，我还没有——所以它是焊接电缆、半固定连接和电工胶带的混合。连接丢失并导致问题，很难找出原因，因为一根铜线就可以短路。尤其是车道一直都很松。</p><p id="9011" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">但盒子最终关闭，由于缺乏精度(PLA @ 210C的0.2/0.4毫米印刷)，粘在一起非常非常紧(这很好！).不过，很难判断它是否开着——一个状态LED将是一个很好的补充。</p><p id="7faf" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">我这里也只有一个<code class="fe mr ms mt mu b">MCP9808</code>,所以除了将引脚或焊线拆下来，我不得不在这里使用更多的杜邦线缆。虽然它确实工作得相当好，因为它们将传感器保持在适当的位置，而没有特殊的外壳。</p><p id="f024" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">除了电缆的组合之外，新的Pi还有点摇晃，需要用胶带固定，因为我的小金字塔间隔器只能从底部施加压力，我的精确测量、设计和打印技能太差，无法完成任何复杂的工作。然而，有更多经验的人已经建立了一些惊人的案例——所以有些事情需要努力。</p><p id="bdbe" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">总的来说，这离完美还很远，但考虑到我的起步位置，还是相当不错的。但是就像许多事情一样，我们总是可以越来越远地优化。</p><p id="7f28" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">在这种<em class="mq">情况下</em>(嘿)，我可能会尝试开发一个4.0版本，但主要是为了我自己的享受。就功能而言，它已经存在:它适合在一起，它可以工作，它很小，只有75.8 x 54.7 x 57.5毫米，在传感器点周围有一点密封剂，我很确定它可以抵御天气。</p><p id="24b0" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">说到软件，我其实没什么好抱怨的(除了代码质量，这不是这个项目的重点)。我们之前构建的SD卡上的基础映像非常好用(我用一个新的Pi对焊接版本进行了测试)，Pi在启动时启动服务，不会热运行，因此不会使用大量资源，只是做它被告知的事情。</p><p id="fd1d" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">所以，总的来说，最终的4.0版本应该-</p><ul class=""><li id="63d3" class="nc nd iq lp b lq mk lt ml lw ne ma nf me ng mi nh ni nj nk bi translated">有点地位的领导</li><li id="eac0" class="nc nd iq lp b lq nl lt nm lw nn ma no me np mi nh ni nj nk bi translated">无论在哪里，都不要依赖杜邦连接器</li><li id="50ce" class="nc nd iq lp b lq nl lt nm lw nn ma no me np mi nh ni nj nk bi translated">使用焊接连接，不使用试验板</li><li id="8046" class="nc nd iq lp b lq nl lt nm lw nn ma no me np mi nh ni nj nk bi translated">让<code class="fe mr ms mt mu b">Pi</code>号安全就位</li><li id="d7f7" class="nc nd iq lp b lq nl lt nm lw nn ma no me np mi nh ni nj nk bi translated">可能会为传感器本身提供更多专用外壳</li><li id="4469" class="nc nd iq lp b lq nl lt nm lw nn ma no me np mi nh ni nj nk bi translated">并且整体更加坚固</li></ul><h1 id="fa6a" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">结论</h1><p id="51a4" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">嗯，我必须说，我很喜欢这个项目，可能比以前的项目更喜欢。诚然(我以前说过)，我不会确切地把它描述为<em class="mq">必要的</em>——但我也敢打赌，种植那么多蔬菜，然后把它们变成泡菜(因为两个人吃不了那么多)，或者乳酸发酵辣椒变成辣酱(出于同样的原因)，或者熏制我自己的培根(因为商店买的培根相当平淡无奇)是<em class="mq">必要的</em>，特别是如果你在离家10分钟的地方有一家杂货店的话。</p><p id="7557" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">然而，如果我们忽略花在它上面的时间和金钱，最终的绿色盒子实际上是非常有用的:它确实从园艺工作中去掉了许多猜测。当然，它没有解决许多其他问题，比如可怜的糖豌豆被真菌杀死了——但它确实提供了有趣的数据。</p><p id="ba11" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">比如，看看这些人:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/046af53587c48eee8284b10a4e262c1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tACWSD3deggjPPKk.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">小胡萝卜(作者)</p></figure><p id="a8b4" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated"><em class="mq">在这张照片拍摄前10-20天，胡萝卜应该已经成熟，即大约5英寸长，1 1/2英寸宽。胡萝卜享受充足的阳光——而在它们被播种的地方，它们可能得不到充足的阳光。凭借科技的力量，我可能不会再把它们种在那里了，因为我现在知道，它们得不到它们需要的6小时的充足阳光。</em></p><p id="ef98" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">然而，从更广泛的层面来看，这也是一次令人惊叹的学习经历。如果你的日常工作是软件工程师(或任何模糊相关的工作)，无论是初级还是高级，你可能会和我一样:你不知道电子、计算机辅助设计、焊接、中学物理、I2C/SPI或以上任何东西是如何工作的。这根本不是日常工作的一部分，尽管从技术上来说与日常工作密切相关。</p><p id="17da" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">然而，正如本文最后几节所展示的，整个过程也非常(我讨厌自己使用这个词)<em class="mq">敏捷</em>。产品永远不会完成，但是在某一点上(在我的案例中，接近我的居家度假结束时)，一个MVP必须被交付——即使我有很多要抱怨的(即，很多要改进的)。至少在我看来，拥有这种特殊的心态是一名优秀工程师的核心特征。</p><p id="ea59" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">在阅读本文时，你可能会注意到这种迭代方法，因为我在从事这项工作后不久就写了一些章节，而不是在最后提供一个总结——所以如果你愿意，你可以继续这个旅程。</p><p id="fa13" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">经历这样一个项目，意味着从零开始，随着事情的进展把事情搞清楚，一直到把它与已知的技术集成(从数据工程的角度来看，特别是<code class="fe mr ms mt mu b">go</code>、<code class="fe mr ms mt mu b">SQL</code>、<code class="fe mr ms mt mu b">python</code>)只是……<em class="mq">整洁</em>。这是一种使用现有技能、增强现有技能并在此过程中学习许多全新事物的有趣方式，比“仅仅”一个软件项目要有趣得多(除非是<code class="fe mr ms mt mu b">TempleOS</code>，也许)。</p><p id="ab31" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">无论如何——我希望你也学到了一些东西，或者至少，我发现阅读这段旅程和建造它一样有趣。</p><p id="909a" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated">如果你想自己构建一个:所有代码都可以在<a class="ae mj" href="https://github.com/chollinger93/raspberry-gardener" rel="noopener ugc nofollow" target="_blank"> GitHub </a>获得。你也可以在那里找到所有的<a class="ae mj" href="https://github.com/chollinger93/raspberry-gardener/tree/master/cad" rel="noopener ugc nofollow" target="_blank"> CAD </a>文件。</p><p id="e06c" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated"><em class="mq">所有的开发和基准测试都是在GNU/Linux [PopOS！2019 System76 Gazelle笔记本电脑上的12个英特尔i7–9750h v cores @ 4.5 GHz和16GB RAM，以及一个Raspberry Pi Zero W，使用</em><a class="ae mj" href="https://chollinger.com/blog/2019/04/building-a-home-server/" rel="noopener ugc nofollow" target="_blank"><em class="mq">bigiron . local</em></a><em class="mq">作为端点</em></p></div><div class="ab cl pd pe hu pf" role="separator"><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi"/></div><div class="ij ik il im in"><p id="077a" class="pw-post-body-paragraph ln lo iq lp b lq mk jr ls lt ml ju lv lw mm ly lz ma mn mc md me mo mg mh mi ij bi translated"><em class="mq">原载于2021年7月3日https://chollinger.com</em><em class="mq">T21</em><a class="ae mj" href="https://chollinger.com/blog/2021/07/raspberry-pi-gardening-monitoring-a-vegetable-garden-using-a-raspberry-pi-part-2-3d-printing/" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>