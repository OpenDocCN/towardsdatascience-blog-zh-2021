<html>
<head>
<title>How to query database connections in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中查询数据库连接</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-query-database-connections-in-python-f76fb955f7a?source=collection_archive---------20-----------------------#2021-10-07">https://towardsdatascience.com/how-to-query-database-connections-in-python-f76fb955f7a?source=collection_archive---------20-----------------------#2021-10-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1885" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用pandas.real_sql</h2></div><p id="40d0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了便于浏览，下面是用于从雪花中查询数据的最终代码。在下面的文章中，我将分析每个步骤的原因，以及如何以同样的方式查询MySQL和PostgreSQL数据库。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="lj lk l"/></div></figure></div><div class="ab cl ll lm hx ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="im in io ip iq"><h1 id="f7c8" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">导入详细信息</h1><p id="3b2d" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">我选择从一个单独的文件中导入连接详细信息的原因是，我可以将该文件添加到<code class="fe mp mq mr ms b">.gitignore</code>中，以确保没有信息被提交给在线回购。这样，即使回购变得公开，私有连接细节也保持隐藏。</p><p id="6d66" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意，这些键的命名与<code class="fe mp mq mr ms b">snowflake.connector.connect</code>函数所需的参数完全相同。</p><p id="16e7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这从例如yaml文件创建了一个python字典。</p><pre class="le lf lg lh gt mt ms mu mv aw mw bi"><span id="a7e0" class="mx lt it ms b gy my mz l na nb">user: anthony<br/>account: account.region<br/>authenticator: externalbrowser<br/>warehouse: DEV<br/>database: DEV</span></pre><p id="d2dd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于json文件，上面的要点将改为使用:</p><pre class="le lf lg lh gt mt ms mu mv aw mw bi"><span id="a889" class="mx lt it ms b gy my mz l na nb">import json</span><span id="06f6" class="mx lt it ms b gy nc mz l na nb">with open("snowflake_details.json", 'r') as stream:<br/>     snowflake_details = json.load(stream)</span></pre></div><div class="ab cl ll lm hx ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="im in io ip iq"><h1 id="96f6" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">创建连接器</h1><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/02721cbffd88fd1859078f92c4f6cb78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mg0fgGt8Ld3u74nu"/></div></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">照片由<a class="ae no" href="https://unsplash.com/@othentikisra?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">以色列总统府</a>在<a class="ae no" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="291d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在创建<code class="fe mp mq mr ms b">snowflake_connection</code>连接器对象时，通过使用<code class="fe mp mq mr ms b">**</code>字典解包操作符，细节被用作函数参数。卸载的细节的键值必须与函数的参数相匹配(例如，对于MySQL连接，将需要<code class="fe mp mq mr ms b">host</code>参数)。</p><p id="df9b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于MySQL连接，上面的要点将改为使用:</p><pre class="le lf lg lh gt mt ms mu mv aw mw bi"><span id="4fc4" class="mx lt it ms b gy my mz l na nb">import pymysql</span><span id="f4df" class="mx lt it ms b gy nc mz l na nb">mysql_connection = pymysql.connect(host='', user='', password='',<br/>                                   db='' port='')</span></pre><p id="e790" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">或者对于PostgreSQL连接:</p><pre class="le lf lg lh gt mt ms mu mv aw mw bi"><span id="f0ce" class="mx lt it ms b gy my mz l na nb">import psycopg2</span><span id="65c7" class="mx lt it ms b gy nc mz l na nb">postgresql_connection = psycopg2.connect(host='', user='',<br/>                                        password='', db='', port='')</span></pre></div><div class="ab cl ll lm hx ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="im in io ip iq"><h1 id="079a" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">查询数据库</h1><p id="54a3" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">为了便于阅读，为我们想要运行的查询创建一个字符串变量通常更容易。对于更大的查询，使用三个双引号<code class="fe mp mq mr ms b">"""query"""</code>而不仅仅是双引号<code class="fe mp mq mr ms b">"query”</code>，使得查询能够像上面的要点一样整齐地跨越多行。</p><p id="f76a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们可以使用<code class="fe mp mq mr ms b"><a class="ae no" href="https://pandas.pydata.org/docs/reference/api/pandas.read_sql.html" rel="noopener ugc nofollow" target="_blank">pd.read_sql</a></code>从一个查询和一个连接中立即创建一个熊猫数据帧。</p><pre class="le lf lg lh gt mt ms mu mv aw mw bi"><span id="0e93" class="mx lt it ms b gy my mz l na nb">df = pd.read_sql(query, connection)</span></pre><p id="6cb1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这比首先使用游标获取数据，然后使用该信息构建pandas数据框架的方法要干净得多，后者只需要更多的步骤。</p><pre class="le lf lg lh gt mt ms mu mv aw mw bi"><span id="d492" class="mx lt it ms b gy my mz l na nb">with connection.cursor() as cursor:<br/>	sql = """<br/>              select * <br/>              from table 1 <br/>              limit 10<br/>              """<br/>	cursor.execute(sql)<br/>	result = cursor.fetchall()<br/>	fieldnames = [i[0] for i in cursor.description]<br/>connection.close()</span><span id="be13" class="mx lt it ms b gy nc mz l na nb">df = pd.DataFrame(list(result), columns=field_names)</span></pre></div><div class="ab cl ll lm hx ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="im in io ip iq"><h1 id="1f83" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">最后的想法</h1><p id="fc66" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">我写这篇文章的主要原因是，了解了<code class="fe mp mq mr ms b">pd.read_sql</code>之后，用Python查询数据库连接对我来说变得容易多了。我希望除了像三个双引号和<code class="fe mp mq mr ms b">**</code>操作符这样的技巧之外，这篇文章也能帮助其他人。</p></div></div>    
</body>
</html>