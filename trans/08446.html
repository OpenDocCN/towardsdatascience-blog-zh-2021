<html>
<head>
<title>Understanding Autocorrelation in Time Series Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">理解时间序列分析中的自相关</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/understanding-autocorrelation-in-time-series-analysis-322ad52f2199?source=collection_archive---------6-----------------------#2021-08-04">https://towardsdatascience.com/understanding-autocorrelation-in-time-series-analysis-322ad52f2199?source=collection_archive---------6-----------------------#2021-08-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e19d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">对于初学者来说，理解自相关是如何工作的是非常重要的，这样可以使他们的时间序列分析之旅更加容易。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/30fe90a694598f08f66b7666c0df2e8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IWKTDXElpzLDMMnFLdn4Zw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">克里斯·利维拉尼在<a class="ae kv" href="https://unsplash.com/s/photos/stock-market?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="27ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">两年前我开始了我的时间序列分析之旅。最初，我开始通过YouTube视频学习，在那里我遇到了自相关，这是时间序列分析的一个基本概念。根据一些视频，自相关的定义是时间序列与其先前版本的关系/相关性。很少有人说，因为我们需要两个变量来计算相关性，但在一个时间序列中我们只有一个变量，我们需要计算时间序列与其自身第k个滞后版本的相关性。</p><h2 id="0917" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated"><strong class="ak">什么是第k个滞后？</strong></h2><p id="9d30" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">这是我想到的第一个问题。随着我的继续，我知道了一个有第k个滞后的时间序列(y)是它在时间上落后第t-k个周期的版本。具有滞后(k=1)的时间序列是原始时间序列在时间上落后一个周期的版本，即y(t-1)。</p><p id="f793" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些视频大多以股票市场每日价格为例来解释时间序列分析。这些价格每天都有记录。他们解释说，股票价格的自相关性是当前价格与过去“k”个时期价格的相关性。所以，具有滞后(k=1)的自相关是与今天的价格y(t)和昨天的价格y(t-1)的相关性。类似地，对于k=2，计算y(t)和y(t-2)之间的自相关。</p><h2 id="e2c0" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated"><strong class="ak">现在主要问题来了</strong></h2><p id="aced" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我们如何计算今天的价格与昨天的价格的相关性(甚至协方差)？因为相关性只能在具有多个值的变量之间计算。如果我试图计算两个单值之间的相关性，我会得到一个“NaN”。另外，这两个变量必须有相同的长度(值的个数)，所以，我甚至不能计算y(起点到t)和y(起点到t-1)之间的相关性。</p><p id="b92e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我开始寻找自相关的理论解释，偶然发现了如下所示的自相关公式。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/0d65726a2b9c21f41fe1b130f96ddd40.png" data-original-src="https://miro.medium.com/v2/resize:fit:476/1*ZbVu3HMeFq4MhloqJ3s7-Q.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/ef770ac537c7b2bbd3f7c791466b9430.png" data-original-src="https://miro.medium.com/v2/resize:fit:486/1*BxHY6US8q8C6zPxxLmU9eQ.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="1f86" class="ms lt iq bd lu mt mu mv lx mw mx my ma jw mz jx md jz na ka mg kc nb kd mj nc bi translated"><strong class="ak">理解公式</strong></h1><ul class=""><li id="5681" class="nd ne iq ky b kz ml lc mm lf nf lj ng ln nh lr ni nj nk nl bi translated">自相关公式与相关公式相似(但不完全相同)。</li><li id="434b" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">分子类似于时间序列的当前版本和滞后版本之间的协方差(但没有“N-1”作为分母)。对分子的两个组成部分进行更仔细的检查表明，从它们中减去的是原始时间序列的平均值，即mean(y)，而不是分别减去mean(y(t))和mean(y(t-k))。这使得公式的分子与协方差有点不同。</li><li id="a188" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">分母类似于原始时间序列的标准差(也称为方差)的平方(但没有“N-1”作为分母)。</li></ul><p id="7bba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">让我们来回答这个问题，如何计算自相关？通过用Python实现它</strong></p><p id="7c6b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用Nifty(跟踪50只股票的印度股票指数)从2007年9月17日到2021年7月30日的收盘价数据。这些数据以csv格式从雅虎财经下载。我们将首先为时间序列分析准备数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/30b3f898e5347da5ed098aa0e8882a34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sLBS2c3n9ZLXtxLyij9ekw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">俏皮的时间序列情节(作者图片)</p></figure><p id="4e0f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将定义一个名为“autocorr”的函数，通过将时间序列数组和第k个滞后值作为输入，返回单个滞后的自相关(acf)。此函数将嵌套在另一个名为“my_auto_corr”的函数中，该函数通过调用“autocorr”函数来计算每个滞后值的acf，从而返回滞后[k，0]的acf。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="5e26" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们通过传递‘nifty’时间序列数据帧和nlags=10作为参数来调用‘my _ auto _ corr’函数。我们还将比较' my_auto_corr '函数和' statsmodels '的' acf '方法的输出。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/7d477c4d567d20362772566208592a93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*76RF-Ynv6LDezBvTfZcHqA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="6c39" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“my_auto_corr”的结果与“statsmodels”的“acf”方法的结果相同。让我们再来看一下我们之前看到的自相关公式，并试着去理解它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/0d65726a2b9c21f41fe1b130f96ddd40.png" data-original-src="https://miro.medium.com/v2/resize:fit:476/1*ZbVu3HMeFq4MhloqJ3s7-Q.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><ul class=""><li id="75e2" class="nd ne iq ky b kz la lc ld lf nv lj nw ln nx lr ni nj nk nl bi translated">分母非常简单，它类似于原始时间序列的方差，但分母中没有“N-1”。<strong class="ky ir">它在代码中用‘分母’变量来表示。</strong></li><li id="51da" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">如前所述，分子类似于时间序列的当前版本和滞后版本之间的协方差(没有N-1作为分母)。让我们来了解一下如何计算分子。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/d5c91a5af782bf9ec56585c8a4f72464.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jEGClS1yQA-dU2aDuZ9HvQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><ul class=""><li id="65fd" class="nd ne iq ky b kz la lc ld lf nv lj nw ln nx lr ni nj nk nl bi translated"><strong class="ky ir">棕色</strong>矩形代表分子第一部分的<strong class="ky ir"> y(t) </strong>。从原始时间序列的平均值中减去<strong class="ky ir"> mean(y) </strong>。<strong class="ky ir">第一部分由公式中的代码&amp; y(t)-mean(y)中的‘分子_ P1’表示。</strong> y(t)固定在底部，滞后(k)每增加一个单位，其顶部向下移动1。</li><li id="5a17" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">同样，<strong class="ky ir">绿色</strong>矩形代表分子第二部分的<strong class="ky ir"> y(t-k) </strong>。它也是从原始时间序列的平均值中减去的，<strong class="ky ir"> mean(y)。第二部分由代码&amp; y(t-k)中的‘分子_ p2’——公式</strong>中的均值(y)表示。y(t-k)在顶部是固定的，滞后(k)每增加一个单位，其底部就向上移动1。</li></ul><p id="b2ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，正如我们前面看到的，公式的分子与协方差并不完全相同。然而，分母类似于原始时间序列的方差，但分母中没有“N-1”。因此，计算棕色和绿色矩形的协方差并除以原始时间序列的方差并不能得到自相关系数。</p><p id="a7e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将自相关公式分解成片段并在Python中实现有助于我们更好地理解它。我们看到了分子中的协方差是如何在时间序列的当前版本和滞后版本之间计算的。因此，为了更好地理解一个概念，无论是机器学习算法还是统计学中的一个概念，了解其本质是很重要的。</p></div></div>    
</body>
</html>