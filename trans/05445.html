<html>
<head>
<title>Install XGBoost and LightGBM on Apple M1 Macs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在苹果M1 MAC电脑上安装XGBoost和LightGBM</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/install-xgboost-and-lightgbm-on-apple-m1-macs-cb75180a2dda?source=collection_archive---------5-----------------------#2021-05-14">https://towardsdatascience.com/install-xgboost-and-lightgbm-on-apple-m1-macs-cb75180a2dda?source=collection_archive---------5-----------------------#2021-05-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="138f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在苹果M1 MAC上安装arm64原生版XGBoost和LightGBM</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/32bb992f14cfe5f9846af29c111ca1dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*36YA4HRu_EnBT5LTSC27hQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片</p></figure><p id="894e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这篇<a class="ae lu" rel="noopener" target="_blank" href="/tensorflow-2-4-on-apple-silicon-m1-installation-under-conda-environment-ba6de962b3b8"> <strong class="la iu">上一篇文章</strong> </a>中，我解释了如何安装<a class="ae lu" href="https://github.com/apple/tensorflow_macos" rel="noopener ugc nofollow" target="_blank"> TensorFlow </a>、<a class="ae lu" href="https://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank"> Scikit-Learn </a>以及其他几个原生为苹果M1 (arm64)编译的包。</p><p id="565a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这里我一步一步的解释如何安装两个最强大的<a class="ae lu" href="https://en.wikipedia.org/wiki/Gradient_boosting" rel="noopener ugc nofollow" target="_blank">渐变增强</a>包:<a class="ae lu" href="https://xgboost.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank"> XGBoost </a>和<a class="ae lu" href="https://lightgbm.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> LightGBM </a>。请注意，在撰写本文时，<a class="ae lu" href="https://catboost.ai/" rel="noopener ugc nofollow" target="_blank"> CatBoost </a>还不能安装在M1上。</p><p id="22ec" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">LightGBM可以直接从Conda miniforge安装，但是XGBoost还没有本地版本。以下步骤可以正确编译它。</p><h2 id="7dbe" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">步骤1: Xcode命令行工具</h2><p id="d67a" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">通过从<a class="ae lu" href="https://developer.apple.com/" rel="noopener ugc nofollow" target="_blank">苹果开发者</a>下载或键入以下命令来安装<a class="ae lu" href="https://developer.apple.com/download/more/?=command%20line%20tools" rel="noopener ugc nofollow" target="_blank"> Xcode命令行工具</a>:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="a2d3" class="lv lw it mu b gy my mz l na nb">xcode-select --install</span></pre><h2 id="1f59" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">第二步:小型锻造</h2><p id="6fcd" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">从<a class="ae lu" href="https://github.com/conda-forge/miniforge" rel="noopener ugc nofollow" target="_blank"> miniforge github </a>安装<em class="nc">用于arm64(苹果硅)</em>的miniforge。</p><p id="a3c9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Miniforge支持安装为苹果芯片原生编译的python包，包括<a class="ae lu" href="https://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank"> scikit-learn </a>。</p><h2 id="46f0" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">步骤3:安装Brew</h2><p id="3c65" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">Brew现在与M1兼容，并在本地软件包存在时安装它们。转到<a class="ae lu" href="https://brew.sh/index_fr" rel="noopener ugc nofollow" target="_blank">家酿</a>网站，将安装命令复制/粘贴到您的终端。</p><h2 id="0373" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">步骤4:从Brew安装必要的库</h2><p id="8a4c" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">必须从Brew安装两个库才能编译XGBoost。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="12c0" class="lv lw it mu b gy my mz l na nb">brew install cmake libomp</span></pre><h2 id="6410" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">步骤5:创建康达环境</h2><p id="4a65" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated"><em class="nc">不要忘记打开一个新的会话或获取您的。在安装miniforge之后，在完成这个步骤之前。</em></p><p id="1f73" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">创建一个空的Conda环境，然后激活它并安装python 3.8和所有需要的包。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="75d8" class="lv lw it mu b gy my mz l na nb">conda create -n boost<br/>conda activate boost<br/>conda install python=3.8.8<br/>conda install numpy scipy scikit-learn</span></pre><p id="4159" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意<code class="fe nd ne nf mu b">numpy</code>和<code class="fe nd ne nf mu b">scipy</code>是XGBoost的依赖项。在从pip安装XGBoost之前从Conda (conda-forge)安装它们是非常重要的，因为它确保在环境中有这些包的arm64版本。</p><p id="2c1e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当加载并编译<code class="fe nd ne nf mu b">scipy</code>的pip版本时，尝试从pip直接安装XGBoost失败。</p><h2 id="191f" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">步骤6:安装LightGBM</h2><p id="e550" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">LightGBM在<a class="ae lu" href="https://conda-forge.org/" rel="noopener ugc nofollow" target="_blank"> conda-forge </a>下已经有了预编译的arm64版本。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="cfea" class="lv lw it mu b gy my mz l na nb">conda install lightgbm</span></pre><h2 id="a9f6" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">第7步:安装XGBoost</h2><p id="9243" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">由于XGBoost原生arm64版本在<a class="ae lu" href="https://conda-forge.org/" rel="noopener ugc nofollow" target="_blank"> conda-forge </a>中尚不可用，必须从pip安装。在步骤5之后，所有依赖项都已经安装在本机版本中。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="7585" class="lv lw it mu b gy my mz l na nb">pip install xgboost</span></pre><p id="14c7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本环境下编译安装XGBoost。</p><h2 id="c9c1" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">现在你可以测试了</h2><p id="46ea" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">以下脚本使用LightGBM和XGBoost训练和测试二进制分类器。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="6ac2" class="lv lw it mu b gy my mz l na nb">import numpy as np<br/>from sklearn.datasets import make_classification<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.metrics import accuracy_score<br/>import time</span><span id="8870" class="lv lw it mu b gy ng mz l na nb">from lightgbm import LGBMClassifier<br/>from xgboost import XGBClassifier</span><span id="5c72" class="lv lw it mu b gy ng mz l na nb">print('make classification ...')</span><span id="3c70" class="lv lw it mu b gy ng mz l na nb">X,y = make_classification(n_samples=1000000,<br/>                         n_features=50,<br/>                         n_informative=30,<br/>                         n_redundant=5,<br/>                         n_repeated=0,<br/>                         n_classes=2,<br/>                         n_clusters_per_class=2,<br/>                         class_sep=1,<br/>                         flip_y=0.01,<br/>                         weights=[0.5,0.5],<br/>                         random_state=17)</span><span id="8c94" class="lv lw it mu b gy ng mz l na nb">X_train, X_test, y_train, y_test = train_test_split(X,y,test_size=0.3,random_state=1000)</span><span id="d379" class="lv lw it mu b gy ng mz l na nb">print(f'X_train shape: {X_train.shape}')<br/>print(f'Train LGBM classifier ...')<br/>clf = LGBMClassifier(n_estimators=100,<br/>                     num_leaves=64,<br/>                     max_depth=5,<br/>                     learning_rate=0.1,<br/>                     random_state=1000,<br/>                     n_jobs=-1)</span><span id="bc47" class="lv lw it mu b gy ng mz l na nb">start = time.time()<br/>clf.fit(X_train,y_train)<br/>elapsed = time.time() - start<br/>print(f'LGBM Training ran in {elapsed:.5f} seconds')</span><span id="e1c8" class="lv lw it mu b gy ng mz l na nb">y_pred = clf.predict(X_test)<br/>print(f'Test Accuracy: {accuracy_score(y_test,y_pred):.2f}')</span><span id="cb7f" class="lv lw it mu b gy ng mz l na nb">print(f'Train XGB classifier ...')<br/>clf = XGBClassifier(n_estimators=100,<br/>                     max_depth=5,<br/>                     max_leaves=64,<br/>                     eta=0.1,<br/>                     reg_lambda=0,<br/>                     tree_method='hist',<br/>                     eval_metric='logloss',<br/>                     use_label_encoder=False,<br/>                     random_state=1000,<br/>                     n_jobs=-1)<br/>start = time.time()<br/>clf.fit(X_train,y_train)<br/>elapsed = time.time() - start<br/>print(f'XGB Training ran in {elapsed:.5f} seconds')</span><span id="4cb1" class="lv lw it mu b gy ng mz l na nb">y_pred = clf.predict(X_test)<br/>print(f'Test Accuracy: {accuracy_score(y_test,y_pred):.2f}')</span></pre><h2 id="7c52" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">演出</h2><p id="3744" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">这个非常简单的测试给出了MacBook Air M1与Core i5 iMac和Xeon Platinum实例相比的以下培训时间。</p><p id="4046" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">MacBook Air M1 2020 8GB/512 GB</strong></p><p id="3133" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">LightGBM训练:3.44秒<br/> XGBoost训练:4.59秒</p><p id="e719" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> 2017款iMac 27英寸酷睿i5 @ 3.8GHz / 40GB内存</strong></p><p id="7eb6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">LightGBM训练:5.03秒<br/> XGBoost训练:6.90秒</p><p id="5db4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> 8核英特尔至强白金处理器@ 2.5 GHz实例</strong></p><p id="9e12" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">LightGBM训练:5.27秒<br/> XGBoost训练:6.26秒</p><p id="554a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">XGBoost和LightGBM在Mac M1上运行并具有出色的性能。</p><p id="0400" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请注意，由于这些软件包的开发团队尚未发布正式的苹果芯片版本，因此没有优化，也没有使用GPU。</p><p id="89f6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>