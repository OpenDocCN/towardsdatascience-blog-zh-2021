<html>
<head>
<title>Orchestrate a Data Science Project in Python With Prefect</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Prefect编制Python中的数据科学项目</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/orchestrate-a-data-science-project-in-python-with-prefect-e69c61a49074?source=collection_archive---------0-----------------------#2021-11-06">https://towardsdatascience.com/orchestrate-a-data-science-project-in-python-with-prefect-e69c61a49074?source=collection_archive---------0-----------------------#2021-11-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="a266" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="f1dc" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">用几行代码优化您的数据科学工作流程</h2></div><h1 id="a832" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">动机</h1><p id="67c1" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">作为一名数据科学家，您为什么应该关注优化您的数据科学工作流程？让我们从一个基础数据科学项目的例子开始。</p><p id="5de9" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">假设您正在处理虹膜数据集。您从构建处理数据的函数开始。</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="d64e" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">定义函数后，执行它们。</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="120e" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">您的代码运行良好，并且您没有看到输出有任何错误，因此您认为工作流足够好。然而，像上面这样的线性工作流程有很多缺点。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/0c6f28d69f974bf70e1a1d439d04ef22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1dE70akxwDPMtw2s1LyHpQ.png"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">作者图片</p></figure><p id="d776" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">缺点是:</p><ul class=""><li id="77f8" class="nc nd it ll b lm mf lp mg ls ne lw nf ma ng me nh ni nj nk bi translated">如果函数<code class="fe nl nm nn no b">get_classes</code>出现错误，函数<code class="fe nl nm nn no b">encode_categorical_columns</code>产生的输出将会丢失，工作流需要从头开始。如果执行<code class="fe nl nm nn no b">encode_categorical_columns</code>功能需要很长时间，这可能会令人沮丧。</li></ul><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi np"><img src="../Images/a554405af5ff849e6739fd956e60fc38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b6hmvPxzWYr9GAX2Q2Sdvw.png"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">作者图片</p></figure><ul class=""><li id="8816" class="nc nd it ll b lm mf lp mg ls ne lw nf ma ng me nh ni nj nk bi translated">由于功能<code class="fe nl nm nn no b">encode_categorical_columns</code>和<code class="fe nl nm nn no b">get_classes</code>互不依赖，因此可以同时执行以节省时间:</li></ul><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi nq"><img src="../Images/aee6a9043c14ea4f604dab0c6dce65e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iuzgmRBi2iMsCsF9IOkABw.png"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">作者图片</p></figure><p id="c2ef" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">以这种方式运行函数还可以防止在不起作用的函数上浪费不必要的时间。如果功能<code class="fe nl nm nn no b">get_classes</code>出现错误，工作流程将立即重启，无需等待功能<code class="fe nl nm nn no b">encode_categorical_columns</code>完成。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi nq"><img src="../Images/2048a3cce3f50bab3082b589b07bb2ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X40DYs9p2UPcXasHTQ62mQ.png"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">作者图片</p></figure><p id="38d7" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">现在，你可能会同意我的观点，优化不同职能部门的工作流程非常重要。然而，手动管理工作流可能会有大量的工作。</p><p id="b664" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">有没有一种方法可以让你通过增加几行代码来自动优化工作流程？这时候提督就派上用场了。</p><h1 id="1884" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">什么是提督？</h1><p id="36fd" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><a class="ae nr" href="https://www.prefect.io/" rel="noopener ugc nofollow" target="_blank">perfect</a>是一个用Python构建工作流的开源框架。Prefect使大规模构建、运行和监控数据管道变得容易。</p><p id="6cc1" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">要安装提督，请键入:</p><pre class="mk ml mm mn gt ns no nt nu aw nv bi"><span id="3ada" class="nw ks it no b gy nx ny l nz oa">pip install prefect</span></pre><h1 id="7d50" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">使用Prefect构建您的工作流程</h1><p id="cddc" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">为了了解Prefect是如何工作的，让我们用Prefect封装文章开头的工作流。</p><h2 id="4560" class="nw ks it bd kt ob oc dn kx od oe dp lb ls of og ld lw oh oi lf ma oj ok lh iz bi translated">第一步—创建任务</h2><p id="d9c5" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">一个<code class="fe nl nm nn no b">Task</code>是一个完整流程中的离散动作。从使用装饰器<code class="fe nl nm nn no b">prefect.task</code>将上面定义的功能转化为任务开始:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><h2 id="33ae" class="nw ks it bd kt ob oc dn kx od oe dp lb ls of og ld lw oh oi lf ma oj ok lh iz bi translated">第二步—创建流程</h2><p id="8967" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">一个<code class="fe nl nm nn no b">Flow</code>通过管理任务之间的依赖关系来表示整个工作流。要创建一个流，只需在<code class="fe nl nm nn no b">with Flow(...)</code>上下文管理器中插入运行函数的代码。</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="4a52" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">请注意，在运行上面的代码时，这些任务都不会执行。Prefect允许您立即运行流程，也可以安排在以后运行。</p><p id="9805" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">让我们尝试使用<code class="fe nl nm nn no b">flow.run()</code>立即执行这个流程:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="1d94" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">运行上面的代码将会得到类似如下的输出:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="248a" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">为了理解Prefect创建的工作流，让我们将整个工作流可视化。</p><p id="6301" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">从安装<code class="fe nl nm nn no b">prefect[viz]</code>开始:</p><pre class="mk ml mm mn gt ns no nt nu aw nv bi"><span id="1fa7" class="nw ks it no b gy nx ny l nz oa">pip install "prefect[viz]"</span></pre><p id="4cc8" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">然后将方法<code class="fe nl nm nn no b">visualize</code>添加到代码中:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="8523" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">您应该会看到如下所示的<code class="fe nl nm nn no b">data-engineer</code>工作流的可视化效果！</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi ol"><img src="../Images/e3f8459b9d1a31170d05cf33000d349e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JzMfqTsK9EZ09GnhgQm1lA.png"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">作者图片</p></figure><p id="fd23" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">请注意，Prefect会自动管理任务的执行顺序，从而优化工作流。对于一些额外的代码来说，这非常酷！</p><h2 id="e801" class="nw ks it bd kt ob oc dn kx od oe dp lb ls of og ld lw oh oi lf ma oj ok lh iz bi translated">第三步-添加参数</h2><p id="85b6" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">如果您发现自己经常尝试一个变量的不同值，那么理想的做法是将该变量转换成一个<code class="fe nl nm nn no b">Parameter</code>。</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="3a08" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">您可以将<code class="fe nl nm nn no b">Parameter</code>视为<code class="fe nl nm nn no b">Task</code>，除了它可以在流程运行时接收用户输入。要将变量转换成参数，只需使用<code class="fe nl nm nn no b">task.Parameter</code>。</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="be47" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated"><code class="fe nl nm nn no b">Parameter</code>的第一个参数指定了参数的名称。<code class="fe nl nm nn no b">default</code>是可选参数，指定参数的默认值。</p><p id="fdff" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">再次运行<code class="fe nl nm nn no b">flow.visualize</code>将给出如下输出:</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi om"><img src="../Images/45f85816ed6faa74e0582c61aae2bcb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DlV8AkZmuVrPlo9hm1P93Q.png"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">作者图片</p></figure><p id="24e3" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">您可以通过以下方式覆盖每次运行的默认参数:</p><ul class=""><li id="bbc0" class="nc nd it ll b lm mf lp mg ls ne lw nf ma ng me nh ni nj nk bi translated">将参数<code class="fe nl nm nn no b">parameters</code>添加到<code class="fe nl nm nn no b">flow.run()</code>:</li></ul><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><ul class=""><li id="666c" class="nc nd it ll b lm mf lp mg ls ne lw nf ma ng me nh ni nj nk bi translated">或者使用完美的CLI:</li></ul><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><ul class=""><li id="76f9" class="nc nd it ll b lm mf lp mg ls ne lw nf ma ng me nh ni nj nk bi translated">或者使用JSON文件:</li></ul><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="69dd" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">您的JSON文件应该如下所示:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="7786" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">您还可以使用Prefect Cloud更改每次运行的参数，这将在下一节中介绍。</p><h1 id="538e" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">监控您的工作流程</h1><h2 id="6468" class="nw ks it bd kt ob oc dn kx od oe dp lb ls of og ld lw oh oi lf ma oj ok lh iz bi translated">概观</h2><p id="bf23" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">Prefect还允许您在Prefect Cloud中监控您的工作流程。按照本说明为完美云安装相关依赖项。</p><p id="5b4e" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">在安装和设置了所有依赖项之后，通过运行以下命令在Prefect上创建一个项目:</p><pre class="mk ml mm mn gt ns no nt nu aw nv bi"><span id="80de" class="nw ks it no b gy nx ny l nz oa">$ prefect create project "Iris Project"</span></pre><p id="dab0" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">接下来，启动一个本地代理，在单台机器上本地部署我们的流:</p><pre class="mk ml mm mn gt ns no nt nu aw nv bi"><span id="f82b" class="nw ks it no b gy nx ny l nz oa">$ prefect agent local start</span></pre><p id="74a5" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">然后补充:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="c5f6" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">…在你文件的末尾。</p><p id="d675" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">运行该文件后，您应该会看到类似下面的内容:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="f583" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">单击输出中的URL，您将被重定向到一个概述页面。概览页面显示了您的流程的版本、创建时间、流程的运行历史及其运行摘要。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi on"><img src="../Images/78dbdb439aabffcb3df34789b2d4bac0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*olT8irSQON3D2N3g9K-wzg.png"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">作者图片</p></figure><p id="c641" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">您还可以查看其他运行的摘要、执行时间及其配置。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/0cb49e7cd38f51190c71a453112f6cad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*Jce9rCOQURyNJPBNye0c-Q.png"/></div><p class="my mz gj gh gi na nb bd b be z dk translated">作者图片</p></figure><p id="ba20" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">Perfect自动跟踪这些重要信息的方式非常酷！</p><h2 id="d05b" class="nw ks it bd kt ob oc dn kx od oe dp lb ls of og ld lw oh oi lf ma oj ok lh iz bi translated">使用默认参数运行工作流</h2><p id="a267" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">请注意，工作流已注册到Prefect Cloud，但尚未执行。要使用默认参数执行工作流程，请单击右上角的快速运行。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi op"><img src="../Images/b75ce46406bdc3da2f374cd5fad94c18.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*kSdZ7ILVXcMurXJc-1n6Dw.png"/></div><p class="my mz gj gh gi na nb bd b be z dk translated">作者图片</p></figure><p id="d67b" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">单击创建的管路。现在，您将能够实时看到新流程运行的活动！</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi oq"><img src="../Images/b91649c25f5730b6241a96ee7f245429.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*JbKeDKz2sN_9cQP89yXVvg.gif"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">作者图片</p></figure><h2 id="9999" class="nw ks it bd kt ob oc dn kx od oe dp lb ls of og ld lw oh oi lf ma oj ok lh iz bi translated">使用自定义参数运行工作流</h2><p id="b2b9" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">要使用自定义参数运行工作流，请单击运行选项卡，然后在输入下更改参数。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi or"><img src="../Images/b01712020b9e66dd5989838d89f11a78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4FD_0vEttydd1pvivVEpjw.png"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">作者图片</p></figure><p id="517b" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">当您对参数感到满意时，只需单击Run按钮即可开始运行。</p><h2 id="7257" class="nw ks it bd kt ob oc dn kx od oe dp lb ls of og ld lw oh oi lf ma oj ok lh iz bi translated">查看工作流程的图表</h2><p id="38d4" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">单击示意图将为您提供整个工作流程的图表。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi os"><img src="../Images/5c0f08bb2b88b43a2b257ae58dd281c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Inj8ey1ZWrMiVtmDPCYGyQ.png"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">作者图片</p></figure><h1 id="a5a5" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">其他功能</h1><p id="b519" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">除了上面提到的一些基本功能，提督还提供了一些其他很酷的功能，将大大提高您的工作流程的效率。</p><h2 id="f9e1" class="nw ks it bd kt ob oc dn kx od oe dp lb ls of og ld lw oh oi lf ma oj ok lh iz bi translated">输入缓存</h2><p id="abe0" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">还记得我们在文章开头提到的问题吗？通常，如果函数<code class="fe nl nm nn no b">get_classes</code>失败，函数<code class="fe nl nm nn no b">encode_categorical_columns</code>创建的数据将被丢弃，整个工作流需要从头开始。</p><p id="6b35" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">然而，使用提督，<code class="fe nl nm nn no b">encode_categorical_columns</code>的输出被存储。下次重新运行工作流时，下一个任务<strong class="ll jd">将使用<code class="fe nl nm nn no b">encode_categorical_columns</code>的输出，而不重新运行</strong>任务<code class="fe nl nm nn no b">encode_categorical_columns</code>。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi ot"><img src="../Images/11d9f7e59bf1dd71844f1ba5a94b70a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WN5iFz3QunvTDNc8ijpizg.png"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">作者图片</p></figure><p id="55d6" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">这可以大大减少运行工作流所需的时间。</p><h2 id="c548" class="nw ks it bd kt ob oc dn kx od oe dp lb ls of og ld lw oh oi lf ma oj ok lh iz bi translated">持续输出</h2><p id="6ea0" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">有时，您可能希望将任务数据导出到外部位置。这可以通过向任务函数插入保存数据的代码来完成。</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="5e5c" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">然而，这样做会使测试功能变得困难。</p><p id="25a4" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">Prefect使每次运行时保存任务的输出变得很容易，方法是:</p><ul class=""><li id="625a" class="nc nd it ll b lm mf lp mg ls ne lw nf ma ng me nh ni nj nk bi translated">将检查点设置为<code class="fe nl nm nn no b">True</code></li></ul><pre class="mk ml mm mn gt ns no nt nu aw nv bi"><span id="cad5" class="nw ks it no b gy nx ny l nz oa">$ export PREFECT__FLOWS__CHECKPOINTING=true</span></pre><ul class=""><li id="0257" class="nc nd it ll b lm mf lp mg ls ne lw nf ma ng me nh ni nj nk bi translated">并将<code class="fe nl nm nn no b">result = LocalResult(dir=...))</code>添加到装饰器<code class="fe nl nm nn no b">@task</code>中。</li></ul><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="d784" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">现在任务<code class="fe nl nm nn no b">split_data</code>的输出将被保存到目录<code class="fe nl nm nn no b">data/processed</code>中！该名称类似于以下内容:</p><pre class="mk ml mm mn gt ns no nt nu aw nv bi"><span id="a24f" class="nw ks it no b gy nx ny l nz oa">prefect-result-2021-11-06t15-37-29-605869-00-00</span></pre><p id="832e" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">如果你想定制你的文件名，你可以添加参数<code class="fe nl nm nn no b">target</code>到<code class="fe nl nm nn no b">@task</code>:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="37a3" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">提督还提供了其他的<code class="fe nl nm nn no b">Result</code>职业，比如<code class="fe nl nm nn no b">GCSResult</code>和<code class="fe nl nm nn no b">S3Result</code>。你可以点击查看结果<a class="ae nr" href="https://docs.prefect.io/api/latest/engine/results.html" rel="noopener ugc nofollow" target="_blank">的API文档。</a></p><h2 id="5e41" class="nw ks it bd kt ob oc dn kx od oe dp lb ls of og ld lw oh oi lf ma oj ok lh iz bi translated">将另一个流的输出用于当前流</h2><p id="94ef" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">如果您正在处理多个流，例如，<code class="fe nl nm nn no b">data-engineer</code>流和<code class="fe nl nm nn no b">data-science</code>流，您可能希望将<code class="fe nl nm nn no b">data-engineer</code>流的输出用于<code class="fe nl nm nn no b">data-science</code>流。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi ou"><img src="../Images/c94240a02c62132e2ea0bdabdbf19cf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hl_8w9TqtGTzMKW_RygsDw.png"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">作者图片</p></figure><p id="3069" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">将<code class="fe nl nm nn no b">data-engineer</code>流的输出保存为文件后，您可以使用<code class="fe nl nm nn no b">read</code>方法读取该文件:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><h2 id="70e2" class="nw ks it bd kt ob oc dn kx od oe dp lb ls of og ld lw oh oi lf ma oj ok lh iz bi translated">连接相关流</h2><p id="6be8" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">想象一下这个场景:您创建了两个相互依赖的流。流程<code class="fe nl nm nn no b">data-engineer</code>需要在流程<code class="fe nl nm nn no b">data-science</code>之前执行</p><p id="0599" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">看了你的工作流程的人不理解这两个流程之间的关系。结果他们同时执行流程<code class="fe nl nm nn no b">data-science</code>和流程<code class="fe nl nm nn no b">data-engineer </code>遇到错误！</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi ov"><img src="../Images/632b1dc90969b86056cd999aab2c6eec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J7-kWMCMm3332B-Ff0D6JA.png"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">作者图片</p></figure><p id="803b" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">为了防止这种情况发生，我们应该指定流之间的关系。幸运的是，提督使我们更容易做到这一点。</p><p id="d967" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">从使用<code class="fe nl nm nn no b">StartFlowRun</code>抓取两个不同的流开始。将<code class="fe nl nm nn no b">wait=True</code>添加到参数中，以便仅在上游流程完成执行后执行下游流程。</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="49f2" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">接下来，调用<code class="fe nl nm nn no b">with Flow(...)</code>上下文管理器下的<code class="fe nl nm nn no b">data_science_flow</code>。使用<code class="fe nl nm nn no b">upstream_tasks</code>指定在执行<code class="fe nl nm nn no b">data-science</code>流程之前将要执行的任务/流程。</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="549c" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">现在，两个流连接如下:</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/9e51b03a731a6d607e5b903dfd7f4fd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*X1ck_cQSkmpJ3G9CBaw18g.png"/></div><p class="my mz gj gh gi na nb bd b be z dk translated">作者图片</p></figure><p id="7318" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">相当酷！</p><h2 id="0f38" class="nw ks it bd kt ob oc dn kx od oe dp lb ls of og ld lw oh oi lf ma oj ok lh iz bi translated">安排你的流程</h2><p id="1fb1" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">Prefect还使得在某个时间或某个时间间隔执行一个流变得无缝。</p><p id="68d5" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">例如，为了每1分钟运行一个流，您可以初始化类<code class="fe nl nm nn no b">IntervalSchedule</code>并将<code class="fe nl nm nn no b">schedule</code>添加到<code class="fe nl nm nn no b">with Flow(...)</code>上下文管理器中:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="0d23" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">现在，您的流量将每1分钟重新运行一次！</p><p id="f281" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">点击了解更多安排你心流的不同方式<a class="ae nr" href="https://docs.prefect.io/core/concepts/schedules.html#overview" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="3f91" class="nw ks it bd kt ob oc dn kx od oe dp lb ls of og ld lw oh oi lf ma oj ok lh iz bi translated">记录</h2><p id="c1cc" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">只需将<code class="fe nl nm nn no b">log_stdout=True</code>添加到<code class="fe nl nm nn no b">@task</code>中，就可以记录任务中的打印语句:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="8159" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">执行任务时，您应该会看到如下输出:</p><pre class="mk ml mm mn gt ns no nt nu aw nv bi"><span id="3108" class="nw ks it no b gy nx ny l nz oa">[2021-11-06 11:41:16-0500] INFO - prefect.TaskRunner | Model accuracy on test set: 93.33</span></pre><h1 id="d53a" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">结论</h1><p id="55f3" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">恭喜你！您刚刚学习了Prefect如何用几行Python代码优化您的数据科学工作流。从长远来看，代码中的小优化可以大大提高效率。</p><p id="a132" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">随意发挥，并在这里叉这篇文章的源代码:</p><div class="ox oy gp gr oz pa"><a href="https://github.com/khuyentran1401/Data-science/tree/master/data_science_tools/prefect_example" rel="noopener  ugc nofollow" target="_blank"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd jd gy z fp pf fr fs pg fu fw jc bi translated">数据科学/数据科学工具/完美范例</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">收集有用的数据科学主题以及代码和文章-Data-science/Data _ science _ tools/prefect _ example…</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">github.com</p></div></div><div class="pj l"><div class="pk l pl pm pn pj po mw pa"/></div></div></a></div></div><div class="ab cl pp pq hx pr" role="separator"><span class="ps bw bk pt pu pv"/><span class="ps bw bk pt pu pv"/><span class="ps bw bk pt pu"/></div><div class="im in io ip iq"><p id="e5cd" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">我喜欢写一些基本的数据科学概念，并尝试不同的数据科学工具。你可以通过<a class="ae nr" href="https://www.linkedin.com/in/khuyen-tran-1ab926151/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae nr" href="https://twitter.com/KhuyenTran16" rel="noopener ugc nofollow" target="_blank"> Twitter </a>与我联系。</p><p id="24ad" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">如果你想查看我写的所有文章的代码，请点击这里。在Medium上关注我，了解我的最新数据科学文章，例如:</p><div class="ox oy gp gr oz pa"><a rel="noopener follow" target="_blank" href="/great-expectations-always-know-what-to-expect-from-your-data-51214866c24"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd jd gy z fp pf fr fs pg fu fw jc bi translated">远大的期望:永远知道从你的数据中可以期待什么</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">使用Python确保数据按预期工作</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">towardsdatascience.com</p></div></div><div class="pj l"><div class="pw l pl pm pn pj po mw pa"/></div></div></a></div><div class="ox oy gp gr oz pa"><a rel="noopener follow" target="_blank" href="/kedro-a-python-framework-for-reproducible-data-science-project-4d44977d4f04"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd jd gy z fp pf fr fs pg fu fw jc bi translated">kedro——可再生数据科学项目的Python框架</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">使用Kedro创建可维护的模块化数据科学管道</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">towardsdatascience.com</p></div></div><div class="pj l"><div class="px l pl pm pn pj po mw pa"/></div></div></a></div><div class="ox oy gp gr oz pa"><a rel="noopener follow" target="_blank" href="/introduction-to-weight-biases-track-and-visualize-your-machine-learning-experiments-in-3-lines-9c9553b0f99d"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd jd gy z fp pf fr fs pg fu fw jc bi translated">权重和偏差介绍:用3条线跟踪和可视化你的机器学习实验…</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">无缝比较不同的实验，并使用Python重现您的机器学习实验</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">towardsdatascience.com</p></div></div><div class="pj l"><div class="py l pl pm pn pj po mw pa"/></div></div></a></div><div class="ox oy gp gr oz pa"><a rel="noopener follow" target="_blank" href="/introduction-to-datapane-a-python-library-to-build-interactive-reports-4593fd3cb9c8"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd jd gy z fp pf fr fs pg fu fw jc bi translated">Datapane简介:构建交互式报表的Python库</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">创建精美报告并与您的团队分享分析结果的简单框架</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">towardsdatascience.com</p></div></div><div class="pj l"><div class="pz l pl pm pn pj po mw pa"/></div></div></a></div></div></div>    
</body>
</html>