<html>
<head>
<title>Accelerated Materials Design Using Multi-Target Regression Neural Network and Shapley Values</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于多目标回归神经网络和 Shapley 值的加速材料设计</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/accelerated-materials-design-using-multi-target-regression-neural-network-and-shapley-values-e3172027bf57?source=collection_archive---------30-----------------------#2021-12-29">https://towardsdatascience.com/accelerated-materials-design-using-multi-target-regression-neural-network-and-shapley-values-e3172027bf57?source=collection_archive---------30-----------------------#2021-12-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8d33" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">多目标回归分析在材料发现中的意义</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/72c02a116814e65dd4bf05b04a40b650.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qqxfXxl_8Tz94PogKvd6dQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@robertbye?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Robert Bye </a>在<a class="ae kv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="510b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">简介</strong></p><p id="5577" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文是我上一篇文章<a class="ae kv" rel="noopener" target="_blank" href="/shapley-value-aided-recipe-for-materials-design-d122fb851cef"> <strong class="ky ir"> Shapley 值辅助材料设计配方</strong> </a>的延伸，这篇文章解释了 Shapley 值在提取特征重要性方面的用法，以及它们对单个目标变量的影响，从而为材料设计绘制蓝图。然而，为了创新和制造新材料，我们需要考虑决定性能的几种性质的协同效应。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/7ecb47cd129843a595542cccd33cb5d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RP7aSlcDKezieVs-6J5RmQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">丹尼尔·罗梅罗在<a class="ae kv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="22bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，用于智能手机和平板电脑的康宁大猩猩玻璃，拥有硬度、亮度和耐刮擦性等属性的适当平衡。有无数这样的例子表明材料具有特定应用领域的综合性能。因此，有必要建立具有多个紧密结合的目标的预测模型。</p><p id="7db0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">案例研究</strong></p><p id="62cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我用一个人工神经网络(ANN)来说明上述观点，该网络被建模来预测两个相互依赖的目标的重要性程度。在这里，我将使用前两篇文章中使用的相同数据集，包括 204 种热电材料、它们的元素组成以及它们的两个重要属性——热导率(kappa)和与电导率相关的功率因数(PF)。kappa 和 PF 的正确组合决定了性能。这些材料导热性差，但同时又是良好的电导体，根据物理定律，这非常具有挑战性。它们可用于发电和制冷。这些热电材料的一个值得注意的应用是它用作火星漫游车的电源，<em class="lt">、【好奇号】、【毅力号】</em>。</p><p id="d6dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">问题是我们如何找到具有最佳属性集的最佳产品。答案在于建立一个稳健的回归模型，该模型可以连接所有必要的参数，并确定最重要的特征组合。这里我们讨论建立这样一个模型的过程。</p><p id="083e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">建立双输出的人工神经网络回归模型</strong></p><p id="c902" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">使用 Matminer 和 Pymatgen 等 python 库对材料数据进行</strong>预处理后，在我的帖子“<a class="ae kv" rel="noopener" target="_blank" href="/uncovering-the-potential-of-materials-data-using-matminer-and-pymatgen-83126fadde1c">T5】使用 Matminer 和 Pymatgen  </a> <strong class="ky ir">发掘材料数据的潜力”中有所描述，</strong>细化后的数据集如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lu"><img src="../Images/82f65cccc4d01e2e7a735185e84a0c49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EQByu8HWt4zv4TBTwYvBXw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">为深度学习清理数据集</p></figure><p id="495c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个干净的数据集包含 49 个预测值或 X 和 2 个目标值或 y。预测值都是材料成分的单个元素。而‘kappa’和‘PF’是两个目标(y)。</p><p id="59ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="lt">识别 X 和 y </em> </strong></p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="24a7" class="ma mb iq lw b gy mc md l me mf">X = ds_RT.iloc[:, 1: 50]<br/>y = ds_RT.iloc[:,50:]</span></pre><p id="d2c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们将数据分成训练集和测试集。</p><p id="6e97" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="lt">拆分数据</em> </strong></p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="7870" class="ma mb iq lw b gy mc md l me mf">from sklearn.model_selection import train_test_split</span><span id="8a39" class="ma mb iq lw b gy mg md l me mf">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.2, random_state = 0)</span></pre><p id="eb38" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="lt">缩放数据</em> </strong></p><p id="e359" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一般来说，描述符或预测符(X)因其值的范围较宽而被缩放。然而，在这种情况下，所有的预测因子都是元素周期表的元素，它们的数据代表从 0 到 1 的元素分数。</p><p id="5ce0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">相反，由于这些目标变量的范围分布很广，因此需要应用 Sklearn 的 MinMaxScaler 函数对 y 进行缩放。</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="5b4a" class="ma mb iq lw b gy mc md l me mf">from sklearn.preprocessing import MinMaxScaler<br/>sc = MinMaxScaler()<br/>y_train = sc.fit_transform(y_train)<br/>y_test = sc.transform(y_test)</span></pre><p id="11b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">是时候构建 ANN 层了。</p><p id="40d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="lt">序贯层和优化安模型</em> </strong></p><p id="c8a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我安排了三个密集或完全连接的层，第一层具有 49 的输入维度，表示预测器的数量，最后一层具有用于 2 个目标的 2 个输出神经元。下面的代码片段显示了图层及其属性。</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="b645" class="ma mb iq lw b gy mc md l me mf">from keras.models import Sequential<br/>from keras.layers import Dense<br/>model = Sequential()</span><span id="2e05" class="ma mb iq lw b gy mg md l me mf">model.add(Dense(25, input_dim=49, kernel_initializer='he_uniform', activation='relu'))</span><span id="b421" class="ma mb iq lw b gy mg md l me mf">model.add(Dense(25, kernel_initializer='he_uniform', activation='relu'))</span><span id="23d8" class="ma mb iq lw b gy mg md l me mf">model.add(Dense(2))</span></pre><p id="1c36" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基于随机梯度下降的自适应矩估计算法 ADAM 用于模型优化，损失函数用平均绝对误差估计。在编译模型之后，拟合训练数据集，并相应地计算损失函数。</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="f603" class="ma mb iq lw b gy mc md l me mf">model.compile(loss ='mae', optimizer = 'adam')<br/>model.summary()<br/>history = model.fit(X_train, y_train, verbose = 'auto',epochs = 400)</span><span id="5aa2" class="ma mb iq lw b gy mg md l me mf">from sklearn.metrics import mean_absolute_error<br/>mae = mean_absolute_error<br/>mae(y_test, y_pred)</span></pre><p id="2512" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="lt">分析预测因素对目标变量的影响程度</em> </strong></p><p id="119d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们借助 Shapley 值深入研究预测因素对这些目标变量的影响。这种影响分析对于每个数据集理解和解释任何机器学习模型都是至关重要的，否则这些模型是无法理解的。</p><p id="4b94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随着几个 XAI ( <strong class="ky ir"> E </strong>可解释的<strong class="ky ir"> A </strong>人工<strong class="ky ir"> I </strong>智能)算法的出现，我们可以更精确地测量超参数的调整，从而产生更有意义的预测。</p><p id="a933" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们看看 Shapley 值在这个热电数据集示例中的作用。让这些数据接受深度学习算法并计算预测器对目标的贡献(以 Shapley 值的形式)的整体思想是提取它们之间的有用相关性。当参数之间的相互关系变得越来越复杂时，这些相关性非常重要。</p><p id="1fca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在安装了 SHAP(<em class="lt">【SHapley Additive exPlanations】</em>)包之后，<em class="lt"> </em> KernelExplainer 函数在这种情况下用于计算特征/预测因子的贡献。我正在分享同样的代码片段。</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="98eb" class="ma mb iq lw b gy mc md l me mf">pip install shap<br/>import shap</span><span id="906f" class="ma mb iq lw b gy mg md l me mf">explainer = shap.KernelExplainer(model = model, data = X_train,link = 'identity' )<br/>shap_values = explainer.shap_values(X_train)</span></pre><p id="7bf3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="lt">根据训练数据</em> </strong>绘制并解释 Shap 值</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="8f35" class="ma mb iq lw b gy mc md l me mf">class_names = y.columns<br/>shap.summary_plot(shap_values, feature_names = X_train.columns)</span></pre><p id="26b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">kappa 和 PF 这两个目标变量分别用红色和蓝色进行颜色编码。形状图在 X 轴上具有特征，在 Y 轴上具有绝对形状值或贡献。从这个柱状图中，我们可以立即了解每个特征对单个目标变量的贡献程度。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/3b11b2a8e7f4663b56dd0b2385db2d52.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*DwUhUX6YNiyfylgUjajRNQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示两个目标贡献的条形图</p></figure><p id="cb01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我通过考虑一些元素/特征来解释，例如 Zn(锌)和 Sb(锑)，以及它们对 kappa 和 PF 的贡献。我们可以很快估算出，对于 Zn 来说，kappa(红色条)的贡献要比 PF(蓝色条)大得多。另一方面，Sb 对 kappa 和 PF 的影响几乎相等。现在，由于该汇总图仅显示绝对 Shap 值，它并未捕捉目标上特征的影响方向(正相关或负相关)。</p><p id="721f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="lt">解释特征与特定目标之间的相关性</em> </strong></p><p id="08dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了理清 kappa 和 PF 与特征之间的关系，我绘制了汇总图，每次选取一个目标。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mi"><img src="../Images/ebd8796227cba8db55b350e07d4ca7df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Fl-5IwNVxRgSxcTLPPLug.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Shapley 汇总图显示了元素对 kappa 和 PF 的影响</p></figure><p id="d11e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些图揭示了相关性的<strong class="ky ir">符号:正、负或零</strong>。<em class="lt">红色表示高影响，而“蓝色”表示低影响。</em>以锌和锑为例，可推断出以下内容:</p><p id="d2bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">- <em class="lt">锌与 kappa 的正相关大于与 PF 的正相关。</em></p><p id="1f52" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">- <em class="lt"> Sb 与 PF 呈高度正相关，与 kappa 呈高度负相关。</em></p><p id="86b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本研究中，材料的类别要求特征分别与 PF 和 kappa 的正相关和负相关共存。例如，Sb 就展示了这样一个理想的组合。预先知道特征对目标的影响方向，确实有助于为所需应用的任何类型的材料提出设计想法。</p><p id="fc8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这里 得到<strong class="ky ir">整码</strong> <a class="ae kv" href="https://github.com/Bjoyita/SHAP_MaterialsDesign/blob/main/ANN_PF_kappa_multitarget_GH.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">。</strong></a></p><p id="ce3c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">参考</strong>到<strong class="ky ir">数据可用性</strong>:<a class="ae kv" href="https://www.nature.com/articles/s41524-021-00564-y" rel="noopener ugc nofollow" target="_blank">https://www.nature.com/articles/s41524-021-00564-y.</a></p><p id="b854" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">关键要点</strong></p><p id="7bf5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">-建立能够同时处理多个目标的机器学习和深度学习模型，是释放有价值的信息以实现创新和发展的一步。它们有助于理解目标和预测者之间的相互依赖关系。</p><p id="8e58" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">-一起考虑所有目标变量的好处是<em class="lt">节省时间</em>和<em class="lt">与一次拟合一个目标相比，计算成本更低</em>。</p><p id="5997" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">-使用 XAIs 的多目标拟合和分析为调整影响目标变量的预测因子的超参数提供了更好的清晰度。</p><p id="434f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">- <em class="lt">拟合多个响应</em>在<em class="lt">回归和分类</em>算法中都是可能的。当回答是数字时，进行多目标回归，而在分类目标变量的情况下，进行多标签或多类分类。</p><p id="dd6d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，应该鼓励训练机器为特定目的回收和重用具有多个目标的数据，因为它揭示了最终输出之间相互关系的本质。这增强了任何机器学习模型的预测和可靠性，从而在现实世界的应用中实现更富有成效的部署。</p><p id="39e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">快乐阅读！</p></div></div>    
</body>
</html>