<html>
<head>
<title>10 Tricks for Converting Numbers and Strings to Datetime in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Pandas中将数字和字符串转换为日期时间的10个技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/10-tricks-for-converting-numbers-and-strings-to-datetime-in-pandas-82a4645fc23d?source=collection_archive---------3-----------------------#2021-04-20">https://towardsdatascience.com/10-tricks-for-converting-numbers-and-strings-to-datetime-in-pandas-82a4645fc23d?source=collection_archive---------3-----------------------#2021-04-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cd17" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">熊猫帮助你开始数据分析的提示和技巧</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/28014bc0b9efae00a6535c0108a665be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pdxGsI1xfkNnEyIFQEf-EA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Sanah Suvarna 在<a class="ae ky" href="https://unsplash.com/s/photos/time?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="04e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在进行数据分析时，确保正确的数据类型非常重要。否则，您可能会得到意外的结果或错误。Datetime是数据科学项目中常见的数据类型，数据通常保存为数字或字符串。在数据分析过程中，您可能需要将它们显式转换为datetime类型。</p><p id="3c0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文将讨论如何将数字和字符串转换为日期时间类型。更具体地说，您将学习如何使用Pandas内置方法<code class="fe lv lw lx ly b">to_datetime()</code>和<code class="fe lv lw lx ly b">astype()</code>来处理以下常见问题:</p><ol class=""><li id="539d" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu me mf mg mh bi translated">将数字转换为日期时间</li><li id="59ee" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">将字符串转换为日期时间</li><li id="96ff" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">处理第一天格式</li><li id="29a5" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">处理自定义日期时间格式</li><li id="53d5" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">处理分析错误</li><li id="59f5" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">处理缺失值</li><li id="edaf" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">从多个列组装日期时间</li><li id="c131" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">一次转换多列</li><li id="a2cd" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">读取CSV文件时解析日期列</li><li id="1ec0" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated"><code class="fe lv lw lx ly b">astype()</code>和<code class="fe lv lw lx ly b">to_datetime()</code>的区别</li></ol><p id="7dc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">源代码请查看<a class="ae ky" href="https://github.com/BindiChen/machine-learning/blob/master/data-analysis/037-pandas-change-data-to-datetime/change-data-to-datetime.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="4a20" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">1.将数字转换为日期时间</h1><p id="3802" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">Pandas有两个内置方法<code class="fe lv lw lx ly b">astype()</code>和<code class="fe lv lw lx ly b">to_datetime()</code>，可以用来将数字转换成日期时间。例如，要将表示秒的数字转换为日期时间:</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="2103" class="nv mv it ly b gy nw nx l ny nz">df = pd.DataFrame({<strong class="ly iu">'date': [1470195805, 1480195805, 1490195805]</strong>,<br/>                   'value': [2, 3, 4]})</span></pre><p id="67f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe lv lw lx ly b">to_datetime()</code>时，我们需要从Pandas调用它，并设置参数<code class="fe lv lw lx ly b">unit='s'</code>:</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="d279" class="nv mv it ly b gy nw nx l ny nz">&gt;&gt;&gt; <strong class="ly iu">pd.to_datetime(df['date'], unit='s')</strong></span><span id="d028" class="nv mv it ly b gy oa nx l ny nz">0   2016-08-03 03:43:25<br/>1   2016-11-26 21:30:05<br/>2   2017-03-22 15:16:45<br/>Name: date, dtype: datetime64[ns]</span></pre><p id="ffad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe lv lw lx ly b">astype()</code>时，我们需要从一个序列中调用它(<strong class="lb iu">日期</strong>列)并传入<code class="fe lv lw lx ly b">'datetime[s]'</code>:</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="7904" class="nv mv it ly b gy nw nx l ny nz">&gt;&gt;&gt; df['date'].astype(<strong class="ly iu">'datetime64[s]'</strong>)</span><span id="159f" class="nv mv it ly b gy oa nx l ny nz">0   2016-08-03 03:43:25<br/>1   2016-11-26 21:30:05<br/>2   2017-03-22 15:16:45<br/>Name: date, dtype: datetime64[ns]</span></pre><p id="ae49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，我们可以将表示其他单位的数字(<code class="fe lv lw lx ly b">D</code>、<code class="fe lv lw lx ly b">s</code>、<code class="fe lv lw lx ly b">ms</code>、<code class="fe lv lw lx ly b">us</code>、<code class="fe lv lw lx ly b">ns</code>)转换为日期时间，例如，数字表示日期</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="43b8" class="nv mv it ly b gy nw nx l ny nz">df = pd.DataFrame({<strong class="ly iu">'date': [1470, 1480, 1490],</strong><br/>                   'value': [2, 3, 4]})</span><span id="5c14" class="nv mv it ly b gy oa nx l ny nz">&gt;&gt;&gt; pd.to_datetime(df['date'], <strong class="ly iu">unit='D'</strong>)</span><span id="38f1" class="nv mv it ly b gy oa nx l ny nz">0   1974-01-10<br/>1   1974-01-20<br/>2   1974-01-30<br/>Name: date, dtype: datetime64[ns]</span><span id="0b3f" class="nv mv it ly b gy oa nx l ny nz">&gt;&gt;&gt; df['date'].astype(<strong class="ly iu">'datetime64[D]'</strong>)</span><span id="928c" class="nv mv it ly b gy oa nx l ny nz">0   1974-01-10<br/>1   1974-01-20<br/>2   1974-01-30<br/>Name: date, dtype: datetime64[ns]</span></pre><h1 id="db12" class="mu mv it bd mw mx ob mz na nb oc nd ne jz od ka ng kc oe kd ni kf of kg nk nl bi translated">2.将字符串转换为日期时间</h1><p id="fb5a" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">通常，您会发现日期被表示为字符串。在熊猫中，字符串显示为<strong class="lb iu">对象</strong>，这是熊猫内部的行话，表示<strong class="lb iu">字符串</strong>。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="b5a5" class="nv mv it ly b gy nw nx l ny nz">&gt;&gt;&gt; df = pd.DataFrame({<strong class="ly iu">'date':['3/10/2015','3/11/2015','3/12/2015']</strong>,<br/>                       'value': [2, 3, 4]})<br/>&gt;&gt;&gt; df.dtypes</span><span id="0a1f" class="nv mv it ly b gy oa nx l ny nz"><strong class="ly iu">date     object</strong><br/>value     int64<br/>dtype: object</span></pre><p id="02fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">to_datetime()</code>和<code class="fe lv lw lx ly b">astype()</code>都可以用来将字符串转换成日期时间。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="6b90" class="nv mv it ly b gy nw nx l ny nz">&gt;&gt;&gt; pd.<strong class="ly iu">to_datetime(df['date'])</strong></span><span id="b4e6" class="nv mv it ly b gy oa nx l ny nz">0   2015-03-10<br/>1   2015-03-11<br/>2   2015-03-12<br/>Name: date, dtype: datetime64[ns]</span><span id="ec3a" class="nv mv it ly b gy oa nx l ny nz">&gt;&gt;&gt; df['date'].<strong class="ly iu">astype('datetime64')</strong></span><span id="cd3f" class="nv mv it ly b gy oa nx l ny nz">0   2015-03-10<br/>1   2015-03-11<br/>2   2015-03-12<br/>Name: date, dtype: datetime64[ns]</span></pre><h1 id="79aa" class="mu mv it bd mw mx ob mz na nb oc nd ne jz od ka ng kc oe kd ni kf of kg nk nl bi translated">3.处理第一天格式</h1><p id="5f58" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">默认情况下，<code class="fe lv lw lx ly b">to_datetime()</code>会先解析月(<strong class="lb iu"> MM/DD </strong>、<strong class="lb iu"> MM DD、</strong>或<strong class="lb iu"> MM-DD </strong>)格式的字符串，这种安排在美国是比较独特的。</p><p id="9192" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在世界上大多数其他地方，首先写的是日期(<strong class="lb iu"> DD/MM </strong>、<strong class="lb iu"> DD MM </strong>或<strong class="lb iu"> DD-MM </strong>)。如果你想让熊猫先考虑日子而不是月份，你可以将参数<code class="fe lv lw lx ly b">dayfirst</code>设置为<code class="fe lv lw lx ly b">True</code>。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="4b26" class="nv mv it ly b gy nw nx l ny nz">df = pd.DataFrame({<strong class="ly iu">'date': ['3/10/2000', '3/11/2000', '3/12/2000']</strong>,<br/>                   'value': [2, 3, 4]})</span><span id="0858" class="nv mv it ly b gy oa nx l ny nz">df['date'] = pd.to_datetime(df['date'], <strong class="ly iu">dayfirst=True</strong>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/026af5098edbad2ea71bb31b2ba1d323.png" data-original-src="https://miro.medium.com/v2/resize:fit:552/format:webp/1*_mW2IiaH-93uwn_BghK6lw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3c6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，您可以将自定义格式传递给参数<code class="fe lv lw lx ly b">format</code>。</p><h1 id="3da5" class="mu mv it bd mw mx ob mz na nb oc nd ne jz od ka ng kc oe kd ni kf of kg nk nl bi translated">4.处理自定义日期时间格式</h1><p id="2b45" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">默认情况下，使用来自<code class="fe lv lw lx ly b">dateutil.parser.parse</code>的Pandas内置解析器解析字符串。有时，您的字符串可能是自定义格式，例如，<strong class="lb iu"> YYYY-d-m HH:MM:SS </strong>。Pandas <code class="fe lv lw lx ly b">to_datetime()</code>有一个名为<code class="fe lv lw lx ly b">format</code>的参数，允许您传递自定义格式:</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="6810" class="nv mv it ly b gy nw nx l ny nz">df = pd.DataFrame({<strong class="ly iu">'date': ['2016-6-10 20:30:0', <br/>                            '2016-7-1 19:45:30', <br/>                            '2013-10-12 4:5:1']</strong>,<br/>                   'value': [2, 3, 4]})</span><span id="e4b2" class="nv mv it ly b gy oa nx l ny nz">df['date'] = pd.to_datetime(df['date'], <strong class="ly iu">format="%Y-%d-%m %H:%M:%S"</strong>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/b0b579111b8d4ba812a23dd8d13837c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*KS_c6MDijIo13bI5E1CxfA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="d922" class="mu mv it bd mw mx ob mz na nb oc nd ne jz od ka ng kc oe kd ni kf of kg nk nl bi translated">4.处理分析错误</h1><p id="5d2a" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">如果一个日期不符合<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-timestamp-limits" rel="noopener ugc nofollow" target="_blank">时间戳限制</a>，我们将在转换时得到一个<strong class="lb iu"> ParseError </strong>。例如，一个无效的字符串<code class="fe lv lw lx ly b">a/11/2000</code>:</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="7a06" class="nv mv it ly b gy nw nx l ny nz">df = pd.DataFrame({'date': ['3/10/2000', <strong class="ly iu">'a/11/2000'</strong>, '3/12/2000'],<br/>                   'value': [2, 3, 4]})</span><span id="3b9e" class="nv mv it ly b gy oa nx l ny nz"># Getting ParseError<br/>df['date'] = pd.to_datetime(df['date'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/84a4c8914af95ef64e1a9bb12a58c426.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nm0BO6TSay799Y64zWdrPg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="1d19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">to_datetime()</code>有一个名为<code class="fe lv lw lx ly b">errors</code>的参数，允许您忽略错误或将无效值强制给<code class="fe lv lw lx ly b">NaT</code>。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="9418" class="nv mv it ly b gy nw nx l ny nz">df['date'] = pd.to_datetime(df['date'], <strong class="ly iu">errors='ignore'</strong>)<br/>df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/849161d757162593a298d45eb49c21ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/1*vaRlPEDMK-o2VAcaMDcDqw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="e624" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并将无效值强制到<code class="fe lv lw lx ly b">NaT</code>:</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="c2bb" class="nv mv it ly b gy nw nx l ny nz">df['date'] = pd.to_datetime(df['date'], <strong class="ly iu">errors='coerce'</strong>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/27bf739a642e8ae5862e55472cc3bb6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:676/format:webp/1*JrE0UANgCTjnOdOTJfN5cg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="0999" class="mu mv it bd mw mx ob mz na nb oc nd ne jz od ka ng kc oe kd ni kf of kg nk nl bi translated">6.处理缺失值</h1><p id="a283" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">在Pandas中，缺失值被赋予值<code class="fe lv lw lx ly b">NaN</code>，这是“不是一个数字”的缩写。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="aaff" class="nv mv it ly b gy nw nx l ny nz">df = pd.DataFrame({'date': ['3/10/2000', <strong class="ly iu">np.nan</strong>, '3/12/2000'],<br/>                   'value': [2, 3, 4]})</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/fb68071e169b2eba833d9f5c897ff541.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/format:webp/1*KCkyWGzvBmSg8EyT9ce2qA.png"/></div></figure><p id="7077" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当将缺少值的列转换为日期时间时，to_datetime()和astype()都将Numpy的<code class="fe lv lw lx ly b">NaN</code>更改为Pandas的<code class="fe lv lw lx ly b">NaT</code>，这允许它成为日期时间。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="1f9b" class="nv mv it ly b gy nw nx l ny nz">&gt;&gt;&gt; df['date']<strong class="ly iu">.astype('datetime64')</strong></span><span id="a0fe" class="nv mv it ly b gy oa nx l ny nz">0   2000-03-10<br/>1          <strong class="ly iu">NaT</strong><br/>2   2000-03-12<br/>Name: date, dtype: datetime64[ns]</span><span id="6c83" class="nv mv it ly b gy oa nx l ny nz">&gt;&gt;&gt; pd.<strong class="ly iu">to_datetime(df['date'])</strong></span><span id="1f88" class="nv mv it ly b gy oa nx l ny nz">0   2000-03-10<br/>1          <strong class="ly iu">NaT</strong><br/>2   2000-03-12<br/>Name: date, dtype: datetime64[ns]</span></pre><p id="8d37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，我们可以用另一个值替换Numpy <code class="fe lv lw lx ly b">NaN</code>(例如用<code class="fe lv lw lx ly b"> '3/11/2000'</code>替换<code class="fe lv lw lx ly b">NaN</code>)</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="4f72" class="nv mv it ly b gy nw nx l ny nz">df = pd.DataFrame({'date': ['3/10/2000', np.nan, '3/12/2000'],<br/>                   'value': [2, 3, 4]})</span><span id="9eac" class="nv mv it ly b gy oa nx l ny nz">df['date'] = df['date'].fillna('3/11/2000').astype('datetime64[ns]')</span></pre><p id="0795" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">了解有关使用缺失值的更多信息</p><div class="om on gp gr oo op"><a rel="noopener follow" target="_blank" href="/working-with-missing-values-in-pandas-5da45d16e74"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">处理熊猫中缺失的值</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">关于Pandas中缺失值以及如何使用内置方法处理它们的教程</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">towardsdatascience.com</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd ks op"/></div></div></a></div><h1 id="7674" class="mu mv it bd mw mx ob mz na nb oc nd ne jz od ka ng kc oe kd ni kf of kg nk nl bi translated">7.从多个列组合日期时间</h1><p id="6641" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated"><code class="fe lv lw lx ly b">to_datetime()</code>也可以用于从多个列组合一个日期时间。键(列标签)可以是常见的缩写，如<strong class="lb iu"> ['年'，'月'，'日'，'分钟'，'秒'，'毫秒'，'美国'，' ns']) </strong>或相同的复数。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="f1b5" class="nv mv it ly b gy nw nx l ny nz">df = pd.DataFrame({'year': [2015, 2016],<br/>                   'month': [2, 3],<br/>                   'day': [4, 5],<br/>                   'hour': [10,11]<br/>                  })</span></pre><p id="5169" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从列的子集创建日期时间列</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="886d" class="nv mv it ly b gy nw nx l ny nz">&gt;&gt;&gt; pd.to_datetime(<strong class="ly iu">df[['month','day','year']]</strong>)</span><span id="e9c4" class="nv mv it ly b gy oa nx l ny nz">0   2015-02-04<br/>1   2016-03-05<br/>dtype: datetime64[ns]</span></pre><p id="1910" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从整个数据帧创建日期时间列</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="8f3b" class="nv mv it ly b gy nw nx l ny nz">&gt;&gt;&gt; pd.<strong class="ly iu">to_datetime(df)</strong></span><span id="fc2e" class="nv mv it ly b gy oa nx l ny nz">0   2015-02-04 10:00:00<br/>1   2016-03-05 11:00:00<br/>dtype: datetime64[ns]</span></pre><h1 id="f293" class="mu mv it bd mw mx ob mz na nb oc nd ne jz od ka ng kc oe kd ni kf of kg nk nl bi translated">8.一次转换多列</h1><p id="c7be" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">到目前为止，我们一直在一次一列地转换数据类型。有一个DataFrame方法也叫做<code class="fe lv lw lx ly b">astype()</code>，它允许我们一次转换多个列数据类型。当您有一大堆要更改的列时，这样可以节省时间。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="7cc8" class="nv mv it ly b gy nw nx l ny nz">df = df.astype({<br/>    <strong class="ly iu">'date_start': 'datetime64',<br/>    'date_end': 'datetime64'</strong><br/>})</span></pre><h1 id="ed7e" class="mu mv it bd mw mx ob mz na nb oc nd ne jz od ka ng kc oe kd ni kf of kg nk nl bi translated">9.读取CSV文件时解析日期列</h1><p id="a4f2" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">如果您想在读取CSV文件时设置每一列的数据类型，您可以在使用<code class="fe lv lw lx ly b">read_csv()</code>加载数据时使用参数<code class="fe lv lw lx ly b">parse_date</code>:</p><p id="0688" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意数据类型<code class="fe lv lw lx ly b">datetime64</code>不被<code class="fe lv lw lx ly b">dtype</code>支持，我们应该使用<code class="fe lv lw lx ly b">parse_dates</code>参数。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="7098" class="nv mv it ly b gy nw nx l ny nz">df = pd.read_csv(<br/>    'dataset.csv',<br/>    dtype={<br/>        <strong class="ly iu"># datetime64[ns] is not supported</strong><br/>        'value': 'float16'<br/>    },<br/>    <strong class="ly iu">parse_dates=['date']</strong><br/>)</span></pre><p id="07e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要了解更多关于用Pandas <code class="fe lv lw lx ly b">read_csv()</code>解析日期列的信息:</p><div class="om on gp gr oo op"><a rel="noopener follow" target="_blank" href="/4-tricks-you-should-know-to-parse-date-columns-with-pandas-read-csv-27355bb2ad0e"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">您应该知道的用Pandas read_csv()解析日期列的4个技巧</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">一些最有用的熊猫把戏</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">towardsdatascience.com</p></div></div><div class="oy l"><div class="pe l pa pb pc oy pd ks op"/></div></div></a></div><h1 id="fbbf" class="mu mv it bd mw mx ob mz na nb oc nd ne jz od ka ng kc oe kd ni kf of kg nk nl bi translated">10.<code class="fe lv lw lx ly b">astype('datetime64')</code>和<code class="fe lv lw lx ly b">to_datetime()</code>的区别</h1><p id="36b5" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated"><code class="fe lv lw lx ly b">astype()</code>是将数据类型从一种转换到另一种的常用方法。Pandas DataFrame和Series都支持该方法。如果您需要转换一组列，那么<code class="fe lv lw lx ly b">astype()</code>应该是首选，因为它:</p><ul class=""><li id="27eb" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu pf mf mg mh bi translated">可以一次转换多列</li><li id="57d6" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pf mf mg mh bi translated">具有最佳性能(如下图所示)</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/b1b475bfcd77972441d6187d61b7f7ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IGgFf8djOTdKn0svWa4Fdw.png"/></div></div></figure><p id="4445" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，<code class="fe lv lw lx ly b">astype()</code>对于包含无效数据的列不起作用。例如，无效的日期字符串<code class="fe lv lw lx ly b">a/11/2000</code>。如果我们尝试使用<code class="fe lv lw lx ly b">astype()</code>，我们会得到一个<strong class="lb iu"> ParseError </strong>。从Pandas 0.20.0开始，这个错误可以通过设置参数<code class="fe lv lw lx ly b">errors='ignore',</code>来抑制，但是您的原始数据将原封不动地返回。</p><p id="3d5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas <code class="fe lv lw lx ly b">to_datetime()</code>函数可以更好地处理这些值。与其失败，我们可以设置参数<code class="fe lv lw lx ly b">errors='coerce'</code>来强制无效值为<code class="fe lv lw lx ly b">NaT</code>。</p><p id="baf0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，在处理自定义日期时间格式时，使用<code class="fe lv lw lx ly b">astype()</code>可能会非常困难。熊猫<code class="fe lv lw lx ly b">to_datetime()</code>有一个叫<code class="fe lv lw lx ly b">format</code>的说法，在习俗转换的方式上提供了更多的可能性。</p><h1 id="bdc1" class="mu mv it bd mw mx ob mz na nb oc nd ne jz od ka ng kc oe kd ni kf of kg nk nl bi translated">结论</h1><p id="12b0" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">我们已经看到了如何使用<code class="fe lv lw lx ly b">astype()</code>和<code class="fe lv lw lx ly b">to_datetime()</code>将Pandas数据列转换为datetime类型。<code class="fe lv lw lx ly b">to_datetime()</code>是最简单的方法，在自定义转换的方式中提供了错误处理和更多的可能性，而<code class="fe lv lw lx ly b">astype()</code>具有更好的性能，可以一次转换多个列。</p><p id="efd3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇文章能帮助你节省学习熊猫的时间。我建议您查看一下<code class="fe lv lw lx ly b">astypes()</code>和<code class="fe lv lw lx ly b">to_datetime()</code> API的文档，并了解您可以做的其他事情。</p><p id="bce1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。请查看<a class="ae ky" href="https://github.com/BindiChen/machine-learning/blob/master/data-analysis/037-pandas-change-data-to-datetime/change-data-to-datetime.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>获取源代码，如果您对机器学习的实用方面感兴趣，请继续关注。</p><h2 id="86d3" class="nv mv it bd mw ph pi dn na pj pk dp ne li pl pm ng lm pn po ni lq pp pq nk pr bi translated">你可能会对我的其他一些熊猫文章感兴趣:</h2><ul class=""><li id="02e4" class="lz ma it lb b lc nm lf nn li ps lm pt lq pu lu pf mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/converting-data-to-a-numeric-type-in-pandas-db9415caab0b">在Pandas中把数据转换成数字类型的10个技巧</a></li><li id="22d8" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pf mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/all-pandas-json-normalize-you-should-know-for-flattening-json-13eae1dfb7dd">熊猫json_normalize()你应该知道的扁平化JSON </a></li><li id="2eea" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pf mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/all-pandas-cut-you-should-know-for-transforming-numerical-data-into-categorical-data-1370cf7f4c4f">所有熊猫切()你应该知道把数值数据转换成分类数据</a></li><li id="c8de" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pf mf mg mh bi translated"><a class="ae ky" href="https://medium.com/@bindiatwork/using-pandas-method-chaining-to-improve-code-readability-d8517c5626ac" rel="noopener">使用熊猫方法链接提高代码可读性</a></li><li id="7f18" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pf mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/how-to-do-a-custom-sort-on-pandas-dataframe-ac18e7ea5320">如何对熊猫数据帧进行自定义排序</a></li><li id="53ba" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pf mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/all-the-pandas-shift-you-should-know-for-data-analysis-791c1692b5e">数据分析你应该知道的所有熊猫移位()</a></li><li id="d040" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pf mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/when-to-use-pandas-transform-function-df8861aa0dcf">何时使用Pandas transform()函数</a></li><li id="c588" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pf mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/pandas-concat-tricks-you-should-know-to-speed-up-your-data-analysis-cd3d4fdfe6dd">你应该知道的熊猫串联()招数</a></li><li id="f698" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pf mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/all-the-pandas-merge-you-should-know-for-combining-datasets-526b9ecaf184">所有的熊猫合并()你应该知道</a></li><li id="befc" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pf mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/working-with-datetime-in-pandas-dataframe-663f7af6c587">在熊猫数据帧中处理日期时间</a></li><li id="1914" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pf mf mg mh bi translated"><a class="ae ky" href="https://medium.com/@bindiatwork/all-the-pandas-read-csv-you-should-know-to-speed-up-your-data-analysis-1e16fe1039f3" rel="noopener">熊猫阅读_csv()你应该知道的招数</a></li><li id="4a66" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pf mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/4-tricks-you-should-know-to-parse-date-columns-with-pandas-read-csv-27355bb2ad0e">用Pandas read_csv() </a>解析日期列应该知道的4个技巧</li></ul><p id="0b3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更多教程可以在我的<a class="ae ky" href="https://github.com/BindiChen/machine-learning" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到</p></div></div>    
</body>
</html>