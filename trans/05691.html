<html>
<head>
<title>Twitchverse: A network analysis of Twitch universe using Neo4j Graph Data Science</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Twitchverse:使用Neo4j图形数据科学对Twitch宇宙的网络分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/twitchverse-a-network-analysis-of-twitch-universe-using-neo4j-graph-data-science-d7218b4453ff?source=collection_archive---------8-----------------------#2021-05-21">https://towardsdatascience.com/twitchverse-a-network-analysis-of-twitch-universe-using-neo4j-graph-data-science-d7218b4453ff?source=collection_archive---------8-----------------------#2021-05-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e0e4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过实例了解如何使用图论和算法从关联数据中获得有价值的见解</h2></div><p id="12ae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">图表数据科学侧重于分析数据中的联系和关系，以获得有价值的见解。每天都会产生海量的数据，但是数据点之间的联系往往在数据分析中被忽略。随着图形数据科学工具的兴起，分析联系的能力不再局限于像谷歌这样的大型科技公司。在这篇博文中，我将介绍如何在您的计算机上设置<a class="ae lb" href="https://neo4j.com/developer/graph-data-science/" rel="noopener ugc nofollow" target="_blank"> Neo4j Graph Data Science </a>环境，并带您完成您的(第一次)网络分析。我们将使用Twitch网络数据集。在我的<a class="ae lb" rel="noopener" target="_blank" href="/twitchverse-constructing-a-twitch-knowledge-graph-in-neo4j-78f03276c1f7">前一篇博文</a>中，我已经展示了如何从<a class="ae lb" href="https://dev.twitch.tv/docs/api/" rel="noopener ugc nofollow" target="_blank">官方Twitch API </a>获取信息并将其存储到Neo4j graph数据库中。您可以选择直接从Twitch API获取信息，或者加载我已经准备好的<a class="ae lb" href="https://drive.google.com/file/d/1ZR_SBEyEmOmxd6v-02kOARlnbq-VVpl_/view?usp=sharing" rel="noopener ugc nofollow" target="_blank"> Neo4j数据库转储</a>。数据库转储中的数据是在2021年5月7日至10日之间擦除的。</p><h2 id="4b08" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">Neo4j图形数据科学环境</h2><p id="830b" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">首先你需要下载安装<a class="ae lb" href="https://neo4j.com/download/" rel="noopener ugc nofollow" target="_blank"> Neo4j桌面应用</a>。打开Neo4j桌面应用程序后，您应该会看到以下屏幕:</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ma"><img src="../Images/8594f22e782ca5ab5dc8f2d891441b26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P5Wuqq7OyF5sKm0pGsAH3w.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">Neo4j桌面应用。图片由作者提供。</p></figure><p id="bbc8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要跟踪这篇博文并获得相同的结果，您应该加载我准备的数据库转储。从<a class="ae lb" href="https://drive.google.com/file/d/1ZR_SBEyEmOmxd6v-02kOARlnbq-VVpl_/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">这个链接</a>下载，然后添加到下图所示的Neo4j桌面环境中。简单说明一下，数据库转储有1.6GB大，包含1000万个节点，所以要确保有足够的可用磁盘。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mq"><img src="../Images/02751c6f97547024ade285bf20cce463.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QBD3NDzaD791TgbrKCmWsQ.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">向Neo4j桌面项目添加文件。图片由作者提供。</p></figure><p id="1549" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如图所示，点击<strong class="kh ir">添加</strong>按钮，选择<strong class="kh ir">文件</strong>选项。这应该需要几秒钟，然后文件名应该出现在文件选项卡下。要恢复数据库转储，请将鼠标悬停在文件上，然后单击右上角的三个点。接下来，选择<strong class="kh ir">从转储创建新的DBMS</strong>选项。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mr"><img src="../Images/3c0729ac6e4c7d55ec3c1545f4809187.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LnDjR74YdV5EA1iwZn62Cg.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">从数据库转储创建新的DBMS。图片由作者提供。</p></figure><p id="b993" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在下一个屏幕中，您需要定义密码并选择Neo4j数据库版本。我建议你总是使用最新的数据库版本。目前，版本4.2.6是最新的。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/2e979b205099ef04d07f4305fa2f5103.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*qvfFgDX7BgvaJYGRaai-dA.png"/></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">选择密码和数据库版本。图片由作者提供。</p></figure><p id="a7a6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">数据库恢复应该只需要几秒钟。现在，在开始网络分析之前，我们只需安装APOC和图形数据科学插件。幸运的是，我们只需几次点击就可以安装这两个插件。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mt"><img src="../Images/bdc58be7ac4815a2678a258d6b1b99d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xpeQplkIL5UBh-U__V2p2Q.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">安装APOC和GDS插件。图片由作者提供。</p></figure><p id="a6c1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要安装插件，点击<strong class="kh ir">项目</strong>选项卡下创建的数据库实例。通过单击选择创建的数据库后，右侧会出现一个新的选项卡。选择<strong class="kh ir">插件</strong>标签，点击<strong class="kh ir">安装</strong>按钮，安装<strong class="kh ir"> APOC </strong>和<strong class="kh ir">图形数据科学</strong>库。</p><p id="907b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后但并非最不重要的一点是，在处理像我们正在处理的这种稍微大一点的图形时，增加堆内存是明智的。您可以通过单击创建的数据库的三个点并选择<strong class="kh ir">设置来定义堆分配。</strong></p><figure class="mb mc md me gt mf gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/f6dcf96cbe6456a31edeaf04ec2f8a4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*-4ba1lyjVuDHTkfIFTnLoQ.png"/></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">Neo4j Desktop中数据库实例的访问设置。图片由作者提供。</p></figure><p id="f4d0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在设置中，搜索下面两行并增加堆内存分配。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="7064" class="lc ld iq mw b gy na nb l nc nd">dbms.memory.heap.initial_size=4G<br/>dbms.memory.heap.max_size=4G</span></pre><p id="b5e2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">默认的堆内存分配是1GB，在本例中，我将它增加到4GB。我建议您也这样做，以避免在执行一些图形算法时出现OOM错误。</p><p id="931d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">既然已经加载了数据库转储并安装了必要的插件，那么就可以开始启动数据库实例了。我已经准备了一个<a class="ae lb" href="https://github.com/tomasonjo/blogs/blob/master/twitch_analysis/Twitch%20analysis.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本，里面有这篇博文中将要执行的所有Cypher查询</a>，但是您也可以将Cypher查询复制到Neo4j浏览器环境中。</p><h2 id="78be" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">抽动网络模式</h2><p id="ef40" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">我们将从Twitch网络模型的简短回顾开始。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ne"><img src="../Images/3d74673b90e6fb9f3c034e4e90346791.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*el3TPeLEhwpWk0YSMSfJpg.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">抽动网络的图形模式。图片由作者提供。</p></figure><p id="0406" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Twitch社交网络由用户组成。这些用户中的一小部分通过直播流广播他们的游戏或活动。在我们的图表模式中，使用实时流的用户被标记为二级标签<strong class="kh ir"> Stream </strong>。我们知道他们属于哪个团队，他们在流上玩哪些游戏，以及他们用哪种语言呈现他们的内容。我们还知道他们在抓取的时候有多少追随者，有史以来的历史观看次数，以及他们何时创建了他们的用户帐户。另一方面，我们知道哪些用户参与了流媒体工具的聊天。我们可以区分在流中聊天的用户是普通用户(CHATTER关系)、流的版主(版主关系)还是流的VIP。</p><p id="caf7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请记住，数据库转储中的数据是在2021年5月7日和10日之间收集的，因此只有在那个周末流式传输的streamer才会显示在数据库中。类似地，只有在那个周末聊天的用户才会出现在网络中。</p><p id="bb3e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将首先使用<em class="nf"> apoc.meta.stats </em>过程计算数据库中的节点数。执行以下Cypher查询，按标签检查节点数。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="6ed6" class="lc ld iq mw b gy na nb l nc nd">CALL apoc.meta.stats()<br/>YIELD labels</span></pre><p id="93fc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">结果</em></p><figure class="mb mc md me gt mf gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/19fce4fd0d87d53377e0dd8d67ba153d.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*uup4Xu8wBcpzB8Mfru4Tow.png"/></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">apoc.meta.stats程序的结果。图片由作者提供。</p></figure><p id="435c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以观察到图中几乎所有的节点都是用户。有1050万用户，其中只有大约6000人是流媒体用户。这些彩带已经播放了594场比赛，用29种不同的语言播出。</p><h2 id="d1de" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">探索性图形分析</h2><p id="9f71" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">在深入研究图形算法之前，我喜欢先熟悉手边的图形。<br/>我们将通过执行几个Cypher查询来执行探索性的图形分析，以了解有关网络的更多信息。这篇博文中的所有条形图都是在<a class="ae lb" href="https://seaborn.pydata.org/" rel="noopener ugc nofollow" target="_blank"> Seaborn库</a>的帮助下创建的。我准备了一个<a class="ae lb" href="https://github.com/tomasonjo/blogs/blob/master/twitch_analysis/Twitch%20analysis.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本</a>，里面包含了所有的代码，可以帮助你理解这篇博文。首先，我们将根据历史观看次数检索前十名。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="d879" class="lc ld iq mw b gy na nb l nc nd">MATCH (u:Stream)<br/>WHERE exists(u.total_view_count)<br/>RETURN u.name as streamer,<br/>       u.total_view_count as total_view_count<br/>ORDER BY total_view_count DESC <br/>LIMIT 10;</span></pre><p id="cd34" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">结果</em></p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nh"><img src="../Images/6373b39b1b863cf860c320f43a71c89f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YZaQ5p3za7nQJmVMD-cMIQ.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">前十名的所有时间观看计数飘带。图片由作者提供。</p></figure><p id="9a42" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我被Twitch领域的专家攻击之前，我想指出，我们只分析了在5月7日和10日之间直播的Twitch流。可能有其他具有更高的总观看计数的流。在我们的图表中，前三个有史以来最高观看次数的飘带似乎是一个飘带团队，而不是一个个体。我不熟悉提到的溪流。我只知道esl_csgo几乎全天候播放《反恐精英:全球攻势》。接下来，我们将调查关注人数最多的前十条横幅。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="51bb" class="lc ld iq mw b gy na nb l nc nd">MATCH (u:Stream)<br/>WHERE exists(u.followers)<br/>RETURN u.name as streamer,<br/>       u.followers as followers<br/>ORDER BY followers DESC <br/>LIMIT 10;</span></pre><p id="01dc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">结果</em></p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ni"><img src="../Images/9b7af1f48999b87c7a8cd8dc5d4f8eb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_PuabMzXfL7KxLOnrNX5sw.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">十大跟风。图片由作者提供。</p></figure><p id="0a3b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有趣的是，我们得到了一组与前一个查询完全不同的streamers。除了裹尸布，他在有史以来的浏览量类别中排名第四，在最高粉丝数中排名第二。当一个流上线时，每个关注者都会收到一个通知。当Rubius上线时，几乎无法想象有900万人收到通知；当Pokimane开始播放时，几乎无法想象有800万人收到通知。我很想知道这些溪流已经存在了多久。我们将按照用户创建日期合计流的数量。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="67b1" class="lc ld iq mw b gy na nb l nc nd">MATCH (u:Stream)<br/>WHERE exists(u.createdAt)<br/>RETURN u.createdAt.year as year, <br/>      count(*) as countOfNewStreamers<br/>ORDER BY year;</span></pre><p id="def1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">结果</em></p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nj"><img src="../Images/6a2994a2194970fb9e1da037374979ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fkO4ukAIazEgT52zofDZqQ.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">按年份对创建的流进行计数。图片由作者提供。</p></figure><p id="6ce2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里我需要再补充一条免责声明。我们是按照用户帐户创建的日期而不是他们第一次开始流式传输的日期进行聚合的。不幸的是，我们没有第一次流的日期。从结果来看，至少有一些彩带已经在Twitch上工作了十年。另一个令人震惊的事实，至少对我来说。我们可以离开飘带，调查一下大多数飘带都玩哪些游戏。请注意，一个流注可以玩多个游戏，因此他们可能会被计入多个游戏中。我们的数据是在周五和周日之间收集的，所以流民可能更喜欢在周五玩Valorant，在周日玩扑克。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="e49e" class="lc ld iq mw b gy na nb l nc nd">MATCH (g:Game)<br/>RETURN g.name as game,<br/>       size((g)&lt;--()) as number_of_streamers<br/>ORDER BY number_of_streamers DESC<br/>LIMIT 10</span></pre><p id="8e87" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">结果</em></p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nk"><img src="../Images/e521eb7730cd33b42632a76e8fcff4ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6suF0oNBv3Ixtw8bkd5d4Q.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">大多数彩带玩的游戏。图片由作者提供。</p></figure><p id="b0d7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">到目前为止，最受欢迎的是聊天类别。聊天类别流行的原因可能是因为它用于所有不玩特定视频游戏的流。这可能包括从烹饪节目到“现实生活”流的任何内容，在“现实生活”流中，流手拿着相机在世界各地行走。不然看来生化危机村，GTA V，英雄联盟才是最受流光欢迎的游戏。</p><p id="4ed8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">大多数横幅属于一个或两个团队。我们可以调查哪些团队拥有最高的成员数，以及团队成员广播的所有游戏。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="1d24" class="lc ld iq mw b gy na nb l nc nd">MATCH (t:Team)<br/>WITH t, size((t)&lt;--()) as count_of_members<br/>ORDER BY count_of_members DESC LIMIT 10<br/>MATCH (t)&lt;-[:HAS_TEAM]-(member)-[:PLAYS]-&gt;(game)<br/>RETURN t.name as team,<br/>       count_of_members,<br/>       collect(distinct member.name) as members, <br/>       collect(distinct game.name) as games</span></pre><p id="1e80" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">结果</em></p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nl"><img src="../Images/247c1ddaddd127eea323d7f64df84973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AWmmrKeiZJKjwvcdgN9-2A.png"/></div></div></figure><p id="e697" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">g燃料团队在2021年5月7日至10日的周末有64名成员。其成员涵盖了Twitch上34个不同的游戏类别。在我们深入网络分析之前，让我们检查一下哪些用户是大多数流的重要用户。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="6c4b" class="lc ld iq mw b gy na nb l nc nd">MATCH (u:User)<br/>RETURN u.name as user, size((u)-[:VIP]-&gt;()) as number_of_vips<br/>ORDER BY number_of_vips DESC LIMIT 10;</span></pre><p id="85b8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">结果</em></p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nm"><img src="../Images/90c6dbb3c8010b5cfea015f5f29e01ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yvauqVItMGPavPCnOMLqQQ.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">VIP数量最多的用户。图片由作者提供。</p></figure><p id="23c6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我敢说Nightbot和Supibot都是机器人。让机器人成为贵宾似乎有点奇怪。我一直认为机器人是聊天的主持人，有能力删除带有链接的消息等。我们还可以检查哪些用户正在调节最高数量的流。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="26f7" class="lc ld iq mw b gy na nb l nc nd">MATCH (u:User)<br/>RETURN u.name as user, size((u)-[:MODERATOR]-&gt;()) as number_of_mods<br/>ORDER BY number_of_mods DESC LIMIT 10;</span></pre><p id="e12e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">结果</em></p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nn"><img src="../Images/918bd0f282b5e8e6dc3d2b986d730f01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ua5bZ0gPWeKUOs0niJZ95A.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">在不同的流上具有最高数量的版主角色的用户。图片由作者提供。</p></figure><p id="b052" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如所料，拥有最高版主角色数的前十名用户最有可能是机器人，其中Nightbot最受欢迎。</p><h2 id="5733" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">用户网络分析</h2><p id="aea2" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">您可能还记得，在我们的图表中，1000万用户中只有大约6000人是流媒体用户。如果我们从这个角度来看，只有0.06%的用户是流媒体用户。我们数据库中的其他用户是在其他streamers的广播中聊天的用户。到目前为止，我们在探索性图形分析中完全忽略了它们。也就是说，直到现在。图形数据科学侧重于分析网络中实体之间的连接。是时候戴上图表数据科学的帽子，研究网络中用户之间的关系了。作为对图结构的一个简单提醒，让我们设想一个用户网络的小子图。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="21c3" class="lc ld iq mw b gy na nb l nc nd">MATCH (s:Stream)<br/>WITH s LIMIT 1<br/>CALL {<br/>    WITH s<br/>    MATCH p=(s)--(:Stream)<br/>    RETURN p<br/>    LIMIT 5</span><span id="7ebd" class="lc ld iq mw b gy no nb l nc nd">    UNION</span><span id="35e5" class="lc ld iq mw b gy no nb l nc nd">    WITH s<br/>    MATCH p=(s)--(:User)<br/>    RETURN p<br/>    LIMIT 5<br/>}</span><span id="b6cd" class="lc ld iq mw b gy no nb l nc nd">RETURN p</span></pre><p id="65ac" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">结果</em></p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi np"><img src="../Images/5367a33b547b147179c2aaec46e08aa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FLHafe2CMIiZDKwc9-PZ1A.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">单个流的示例用户网络。图片由作者提供。</p></figure><p id="6e0e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如在<a class="ae lb" rel="noopener" target="_blank" href="/twitchverse-constructing-a-twitch-knowledge-graph-in-neo4j-78f03276c1f7">之前的博客文章</a>中提到的，流媒体工具的行为就像普通用户一样。他们可以主持其他广播，可以参与他们的聊天，或获得VIP身份。这就是促使图模型决定用二级标签流将流表示为常规用户的原因。我们不希望图中的两个节点代表一个真实的实体。</p><p id="54bb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们将评估节点度分布。节点度就是每个节点拥有的关系的数量。这里，我们正在处理一个有向网络，因为关系方向具有语义值。如果Aimful是Itsbigchase流的版主，这并不自动意味着Itsbigchase是Aimful流的版主。在处理有向网络时，可以将节点度分布分为入度分布和出度分布，入度分布用于计算传入关系，出度分布用于计算传出连接。首先，我们将检查出度分布。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="a4ce" class="lc ld iq mw b gy na nb l nc nd">MATCH (u:User)<br/>WITH u, size((u)-[:CHATTER|VIP|MODERATOR]-&gt;()) as node_outdegree<br/>RETURN node_outdegree, count(*) as count_of_users<br/>ORDER BY node_outdegree ASC</span></pre><p id="09d9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">结果</em></p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nq"><img src="../Images/e5b8f44331eb69dc90bbcdf1b4b62a3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8NC5RCMZBnkEezJpdEqq0A.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">用户网络的外向度分布。图片由作者提供。</p></figure><p id="cb08" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">双对数图显示了出度分布。两个轴都有对数刻度。在总共一千万用户中，大约有六百万用户只有一个外向关系，这意味着他们只在单个流中聊天。绝大多数用户的传出连接少于10个。几个用户有超过100个外发链接，但我大胆猜测他们很可能是机器人。一些数学家可能会考虑遵循<a class="ae lb" href="https://en.wikipedia.org/wiki/Power_law" rel="noopener ugc nofollow" target="_blank">幂律分布</a>的出度。现在，我们来看看入学位分布。我们已经知道，只有飘带的入度大于0。只有广播其流的用户才能让用户参与他们的聊天。因此，大约99.999%的用户的入度值为0。你几乎可以把这个网络视为一个<a class="ae lb" href="https://en.wikipedia.org/wiki/Bipartite_graph#:~:text=In%20the%20mathematical%20field%20of,the%20parts%20of%20the%20graph." rel="noopener ugc nofollow" target="_blank">二分图</a>，除了在飘带之间也有关系。我们将只为拖缆可视化入度分布。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="fe87" class="lc ld iq mw b gy na nb l nc nd">MATCH (u:Stream)<br/>WITH u, size((u)&lt;-[:CHATTER|VIP|MODERATOR]-()) as node_indegree<br/>RETURN node_indegree, count(*) as count_of_users<br/>ORDER BY node_indegree ASC</span></pre><p id="0d47" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">结果</em></p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nr"><img src="../Images/1ac52417bffc68eb90e4c2d1be5ded8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aygknWH8wYCANydzPC2r6w.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">用户网络的入度分布。图片由作者提供。</p></figure><p id="6643" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">观察到入度分布也遵循幂律分布是非常有趣的。大多数飘带在周末有不到1000个活跃的聊天者，而一些飘带有超过15000个活跃的聊天者。</p><h2 id="cdbf" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">图形数据科学图书馆</h2><p id="9570" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">现在是时候执行一些图形算法了。<a class="ae lb" href="https://neo4j.com/docs/graph-data-science/current/" rel="noopener ugc nofollow" target="_blank">Neo4j Graph Data Science</a>library(GDS)拥有50多种图形算法，从集中到社区检测和节点嵌入算法。首先，我们需要更新GDS图书馆的工作方式。</p><blockquote class="ns nt nu"><p id="92e6" class="kf kg nf kh b ki kj jr kk kl km ju kn nv kp kq kr nw kt ku kv nx kx ky kz la ij bi translated">为了尽可能高效地运行算法，Neo4j图形数据科学库使用专门的内存图形格式来表示图形数据。因此，有必要将Neo4j数据库中的图形数据加载到内存图形目录中。加载的数据量可以通过所谓的图形投影来控制，图形投影还允许例如在节点标签和关系类型上过滤，以及其他选项。</p></blockquote><p id="af3d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">引自</em> <a class="ae lb" href="https://neo4j.com/docs/graph-data-science/current/introduction/" rel="noopener ugc nofollow" target="_blank"> <em class="nf">官方文件</em> </a> <em class="nf">。</em></p><p id="2c81" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">GDS库在专门的内存图形格式上执行图形算法，以提高图形算法的性能和规模。使用<a class="ae lb" href="https://neo4j.com/docs/graph-data-science/current/management-ops/" rel="noopener ugc nofollow" target="_blank">本地或cypher投影</a>，我们可以将数据库中存储的图形投影为内存中的图形格式。在执行任何图形算法之前，我们必须将存储的图形视图投影为内存中的图形格式。我们可以过滤我们想要投影的图形部分。不需要添加将不被用作图算法的输入的节点和关系。我们将从规划所有用户和流节点以及它们之间可能的关系开始，它们是CHATTER、版主和VIP。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="b2d9" class="lc ld iq mw b gy na nb l nc nd">CALL gds.graph.create('twitch', <br/>  ['User', 'Stream'], <br/>  ['CHATTER', 'VIP', 'MODERATOR'])</span></pre><h2 id="36df" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">弱连通分量</h2><p id="4ed2" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">弱连接组件算法(WCC)用于在给定网络中寻找不同的岛或节点组件。当您忽略关系方向时，一个节点可以到达同一组件中的所有其他节点。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/d8ccff7d1ed0c8c6bdc104f4d3d17876.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*B61YqPRqPtn1rPN5SMUEfQ.png"/></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">样本图中的可视化弱连通分量。图片由作者提供。</p></figure><p id="66ba" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">节点Thomas、Amy和Michael形成弱连通分量。如上所述，WCC算法忽略了关系方向，实际上将网络视为无向网络。</p><p id="bb8b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用下面的Cypher查询在我们之前在内存中投影的Twitch网络上执行弱连接组件算法。当我们只对算法结果的高级统计感兴趣时，使用算法的<em class="nf">统计</em>方法<em class="nf"> </em>。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="e781" class="lc ld iq mw b gy na nb l nc nd">CALL gds.wcc.stats('twitch')<br/>YIELD componentCount, componentDistribution</span></pre><p id="3d13" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">结果</em></p><figure class="mb mc md me gt mf gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/40a4b9e38ffc331eb7281a7ae66d1c18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*Caxa0XA9TW3gm9ppwHsP-Q.png"/></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">WCC算法在整个投影用户图上的结果。图片由作者提供。</p></figure><p id="ae86" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有趣的是，用户网络仅由一个相连的组件组成。例如，您可以在观看日语流的用户和观看匈牙利语流的用户之间找到一条无向路径。从图中移除机器人并重新运行WCC算法可能会很有趣。我有一种预感，Nightbot和其他bot有助于将网络的不同部分连接成一个单一的连接组件。</p><p id="f9e1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了当前内存中的图形投影，我们还可以在算法执行时过滤节点或关系。在下一个例子中，我选择只考虑流节点和它们之间的连接。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="88ea" class="lc ld iq mw b gy na nb l nc nd">CALL gds.wcc.stats('twitch', {nodeLabels:['Stream']})<br/>YIELD componentCount, componentDistribution</span></pre><p id="bb03" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">结果</em></p><figure class="mb mc md me gt mf gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/e7b64fb16709c5c012ab8c5494732933.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*wsGL_0i566W8u2zGsUtsyw.png"/></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">仅考虑图中的流节点时WCC算法的结果。图片由作者提供。</p></figure><p id="fee7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过WCC算法的这种变化，我们可以有效地查看流之间的聊天通信。只考虑流节点，因此，只有流节点之间的关系被用作WCC算法的输入。streamer网络中共有1902个独立组件。最大的组件包含大约65%的所有流节点。然后，我们主要处理单节点组件，其中一个流在数据被抓取的特定周末没有在其他流的广播中聊天。</p><h2 id="3945" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">PageRank</h2><p id="cd19" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">PageRank可能是最著名的图算法之一。它用于通过考虑节点的入站关系以及链接到它的节点的重要性来计算节点重要性。PageRank最初是Google用来计算网站重要性的，但是可以用在很多不同的场景中。</p><p id="a024" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用下面的Cypher查询在整个用户网络上执行PageRank算法。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="87bc" class="lc ld iq mw b gy na nb l nc nd">CALL gds.pageRank.stream('twitch')<br/>YIELD nodeId, score<br/>WITH nodeId, score<br/>ORDER BY score<br/>DESC LIMIT 10<br/>RETURN gds.util.asNode(nodeId).name as user, score</span></pre><p id="0679" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">结果</em></p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ob"><img src="../Images/81b2fdfb766ca429f38f9ddc6cc81fa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-HaXc85AzRUNgEUDMmdUFA.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">PageRank算法在整个用户网络上的结果。图片由作者提供。</p></figure><p id="b34d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你在其他时候使用了Twitch API，结果可能会有很大的不同。在该分析中，仅考虑了5月7日和10日之间的聊天参与度。我的假设是，具有最高PageRank分数的流很可能具有参与他们聊天的其他流的最高计数。我们可以通过在网络的streamer子集上运行PageRank算法来轻松验证这一假设。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="2a15" class="lc ld iq mw b gy na nb l nc nd">CALL gds.pageRank.stream('twitch', {nodeLabels:['Stream']})<br/>YIELD nodeId, score<br/>WITH nodeId, score<br/>ORDER BY score<br/>DESC LIMIT 10<br/>WITH gds.util.asNode(nodeId) as node,score<br/>RETURN node.name as streamer,<br/>       score,<br/>       size((node)&lt;--(:Stream)) as relationships_from_streamers,<br/>       size((node)&lt;--(:User)) as relationships_from_users</span></pre><p id="e859" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">结果</em></p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="oc od l"/></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">流子图上PageRank算法的结果。</p></figure><p id="8816" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们考虑所有用户或者当我们仅考虑Twitch网络的流时，按PageRank分数排名的前十个流几乎是相同的。我发现令人惊讶的是，Yassuo在第一位只有16个来自其他流媒体工具的入站关系和22000个来自普通用户的关系。我大胆猜测，从PageRank得分来看，Yassuo广播中聊天的横幅本身也很重要。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="8b2f" class="lc ld iq mw b gy na nb l nc nd">MATCH (s:Stream{name:"yassuo"})&lt;--(o:Stream)<br/>RETURN collect(o.name) as other_streamers</span></pre><p id="8af1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">结果</em></p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi oe"><img src="../Images/f4023755ac12f92fa561240f79bfb5c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e9_NqrSx66qZjte-iP4jhg.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">亚索直播流里聊天的飘带结果。图片由作者提供。</p></figure><p id="c9b5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">似乎我的假设有一些优点。在亚索之流聊天的飘带中有loltyler1，trainwreckstv，benjyfishy。这些飘带也被PageRank评为前10名。关系的数量并不重要，质量也很重要。</p><h2 id="b37b" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">社区检测</h2><p id="93c9" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">我们要看的最后一类图算法是社区检测类。社区检测或聚类算法用于推断给定网络的社区结构。社区被模糊地定义为网络中的节点组，它们彼此之间的连接比与其他节点的连接更紧密。我们可以尝试检查整个用户网络的社区结构，但这并不能产生一个漂亮的结果网络可视化。首先，我们将从内存中释放现有的项目网络。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="b7c5" class="lc ld iq mw b gy na nb l nc nd">CALL gds.graph.drop("twitch")</span></pre><p id="1209" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我有时喜欢看象棋或扑克彩带。让我们分析一个包含扑克和象棋飘带的子图的社区结构。为了方便我们进一步的查询，我们将首先用一个额外的节点标签来标记相关的节点。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="0412" class="lc ld iq mw b gy na nb l nc nd">MATCH (s:Stream)-[:PLAYS]-&gt;(g:Game)<br/>WHERE g.name in ["Chess", "Poker"]<br/>SET s:PokerChess</span></pre><p id="815e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">总共有63条彩带在他们的频道上播放国际象棋或扑克。让我们快速想象一下streamer网络，以便更好地了解它的外观。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi of"><img src="../Images/c7730f8c6e83aa7d0b1d4eb61139e8d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oEQuGdJZjf9VOcDm8CnR0g.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">棋牌飘带网。图片由作者提供。</p></figure><p id="591b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很明显，我们正在处理一个大的连接组件和大多数孤立的节点。如果您只打算运行单个图表算法，可以使用匿名图表功能，在该功能中，您可以在一个步骤中设计并执行一个图表算法。这里，我们将使用Louvain模块性算法来推断这个子图的社区结构。我们也将此网络视为无向网络。我会说，如果一个流人参与另一个流人的聊天，他们可能是朋友，通常，友谊关系是双向的。这次我们将把Louvain模块性算法的结果存储回存储的图中，这样我们就可以在可视化中使用社区结构信息。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="533c" class="lc ld iq mw b gy na nb l nc nd">CALL gds.louvain.write({<br/>    nodeProjection:'PokerChess',<br/>    relationshipProjection:{<br/>        ALL:{orientation:'UNDIRECTED', type:'*'}<br/>    },<br/>    writeProperty:'louvain_chesspoker'<br/>})</span></pre><p id="0d0f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以在<a class="ae lb" href="https://neo4j.com/product/bloom/" rel="noopener ugc nofollow" target="_blank"> Neo4j Bloom应用程序</a>中检查社区结构算法的结果。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi og"><img src="../Images/91cea5e2b36ac63903a526f7abc74118.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fVsFQ9xM4uF6gUpN-VwxXw.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">棋牌飘带子图的社区结构。图片由作者提供。</p></figure><p id="c58b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">节点颜色表示节点属于哪个社区。我忽略了没有参与其他流聊天的流，所以没有孤立的节点。我必须再次强调，我们只是在看Twitch网络的3天快照，所以结果可能并不完美，因为一些streamers喜欢周末休息等等。</p><p id="f9e5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我想向您展示在Neo4j中您可以做的最后一件很酷的事情。我们可以检查哪些飘带共享它们的观众，而不是看哪些飘带相互影响。我们的数据库中没有所有的观众，但我们有在streamers的广播中聊天的观众。首先，我们将标记有不止一个传出关系的用户。这将有助于我们加快观众比较过程。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="f344" class="lc ld iq mw b gy na nb l nc nd">CALL apoc.periodic.iterate("<br/>    MATCH (u:User)<br/>    WHERE NOT u:Stream AND size((u)--&gt;(:Stream)) &gt; 1 <br/>    RETURN u",<br/>    "SET u:Audience",<br/>    {batchSize:50000, parallel:true}<br/>)</span></pre><p id="ff64" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们可以运行社区检测算法之前，我们需要推断一个新的网络来描述哪些流共享它们的观众。首先，我们必须投影一个内存中的图形。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="1406" class="lc ld iq mw b gy na nb l nc nd">CALL gds.graph.create('shared-audience', <br/>  ['PokerChess', 'Audience'],<br/>  {CHATTERS: {type:'*', orientation:'REVERSE'}})</span></pre><p id="837f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们将使用<a class="ae lb" href="https://neo4j.com/docs/graph-data-science/current/algorithms/node-similarity/" rel="noopener ugc nofollow" target="_blank">节点相似度算法</a>来推断共享受众网络。节点相似性算法使用<a class="ae lb" href="https://en.wikipedia.org/wiki/Jaccard_index" rel="noopener ugc nofollow" target="_blank">JAC card相似性系数</a>来比较一对节点的相似程度。我们将假设，如果两个飘带共享至少5%的观众，我们将在它们之间创建一个关系。算法的变异模式将结果存储回内存中的投影图。这样，我们可以将一个算法的结果作为另一个图算法的输入。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="4df1" class="lc ld iq mw b gy na nb l nc nd">CALL gds.nodeSimilarity.mutate('shared-audience',<br/> {similarityCutoff:0.05, topK:15, mutateProperty:'score', mutateRelationshipType:'SHARED_AUDIENCE'})</span></pre><p id="051b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们可以在扑克和象棋流之间的共享观众网络上运行社区检测算法Louvain。</p><pre class="mb mc md me gt mv mw mx my aw mz bi"><span id="1b0b" class="lc ld iq mw b gy na nb l nc nd">CALL gds.louvain.write('shared-audience', <br/>       { nodeLabels:['PokerChess'],<br/>         relationshipTypes:['SHARED_AUDIENCE'], <br/>         relationshipWeightProperty:'score',<br/>         writeProperty:'louvain_shared_audience'})</span></pre><p id="93d7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我将在Neo4j Bloom中可视化streamers之间共享观众的社区结构的结果。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi oh"><img src="../Images/73e2783a53dc46d4d99feb5138a0d3e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1PejNtgr-K0nrapRBBJjMA.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">基于共享观众关系的扑克和象棋横幅的社区结构。图片由作者提供。</p></figure><p id="2aaf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">结论</strong></p><p id="e8f7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我希望这篇博文能让你对图形数据科学产生兴趣。如果您想让我写一个特定的用例或数据集，请告诉我。如果您在图形数据科学库代码方面需要一些帮助，您可以随时使用<a class="ae lb" href="https://neo4j.com/developer/graph-data-science/neuler-no-code-graph-algorithms/" rel="noopener ugc nofollow" target="_blank">Neo4j Graph Algorithms Playground</a>应用程序，它将为您生成执行图形算法所需的代码。</p><p id="2e47" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">和往常一样，代码可以在<a class="ae lb" href="https://github.com/tomasonjo/blogs/blob/master/twitch_analysis/Twitch%20analysis.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p></div></div>    
</body>
</html>