<html>
<head>
<title>How to calculate Heikin Ashi candles in Python for trading</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中计算用于交易的Heikin Ashi蜡烛</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-calculate-heikin-ashi-candles-in-python-for-trading-cff7359febd7?source=collection_archive---------2-----------------------#2021-04-22">https://towardsdatascience.com/how-to-calculate-heikin-ashi-candles-in-python-for-trading-cff7359febd7?source=collection_archive---------2-----------------------#2021-04-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3874" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们看看如何在Python中使用这个强大的交易工具</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/827ed54a0c8a9a493daaf6f0d7ae221b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IbnfMx9-0GLIEvj8CMYf3w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Heikin Ashi烛台图表示例。图片由作者提供。</p></figure><p id="9baa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> <em class="lu">注来自《走向数据科学》的编辑:</em> </strong> <em class="lu">虽然我们允许独立作者根据我们的</em> <a class="ae lv" rel="noopener" target="_blank" href="/questions-96667b06af5"> <em class="lu">规则和指导方针</em> </a> <em class="lu">发表文章，但我们不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的</em> <a class="ae lv" rel="noopener" target="_blank" href="/readers-terms-b5d780a700a4"> <em class="lu">读者术语</em> </a> <em class="lu">。</em></p><p id="85ba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">定量交易者知道他们需要从价格图表中提取尽可能多的信息。价格波动是发现交易机会的一种非常有用的技术，但有时很难读懂，因为蜡烛图可能很乱或很嘈杂。所以，交易者需要一个工具来平滑价格波动并消除噪音。Heikin Ashi蜡烛可以帮助我们。让我们看看怎么做。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="dbfb" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">什么是Heikin Ashi蜡烛？</h1><p id="d79b" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">Heiken Ashi蜡烛图(有时称为Heiken Ashi)是一种特殊的蜡烛图，试图消除价格波动的噪音。特别是，在这种图表中，没有间隙。</p><p id="ef91" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们看一张有普通烛台的标准普尔500图表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/fc2ebb51ef8b25efe9f467ca907f7155.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F03Da1R10ZwBYt4wlOjSFA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">标准普尔500海图。图片由作者提供。</p></figure><p id="439d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如你所看到的，每天都有很多缺口，蜡烛的影子有时很宽，让你很难决定该做什么。</p><p id="1f1c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Heikin Ashi蜡烛是这样计算的:</p><ul class=""><li id="179b" class="nb nc it la b lb lc le lf lh nd ll ne lp nf lt ng nh ni nj bi translated"><strong class="la iu">打开</strong>:(打开(前一根蜡烛)+关闭(前一根蜡烛))/2</li><li id="572b" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><strong class="la iu">关闭</strong>:(开+低+关+高)/4</li><li id="10e7" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><strong class="la iu">高</strong>:与实际蜡烛相同</li><li id="461d" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><strong class="la iu">低</strong>:与实际蜡烛相同</li></ul><p id="8213" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如您所见，计算今天的HA蜡烛图使用了今天和昨天的蜡烛图数据。这样，哈蜡烛顺利价格行动。</p><p id="da9a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">应用于同一图表的结果是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/827ed54a0c8a9a493daaf6f0d7ae221b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IbnfMx9-0GLIEvj8CMYf3w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">标准普尔500图表与黑金阿什蜡烛。作者图片</p></figure><p id="78de" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如您所见，没有间隙，图表更容易阅读。</p><h1 id="22b9" class="md me it bd mf mg np mi mj mk nq mm mn jz nr ka mp kc ns kd mr kf nt kg mt mu bi translated">如何使用Heikin Ashi图表？</h1><p id="7748" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">使用HA图表非常简单。首先，我们可以看到，在一个重要的反转之前，我们可以检测到一些旋转的顶部形态，即具有非常小的真实形体和几乎相同大小的大阴影的蜡烛。这是检测趋势反转的重要方法。</p><p id="fb61" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，我们可以看到，当趋势强劲时，对面的阴影几乎不存在(即在强劲的看涨趋势中，下部阴影是看不见的，而在强劲的看跌趋势中，上部阴影是看不见的)。这给了我们一个趋势强度的清晰概述。最后，颜色的变化经常被用来确认趋势已经改变了方向，也可以作为一个操作信号。</p><p id="26cc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些都是建立交易策略的有用工具，我们不需要像蜡烛图一样捕捉几种模式，但我们只需要发现旋转顶部和颜色变化。</p><p id="bef8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Heikin Ashi蜡烛线的缺点是，像任何其他类型的移动平均线一样，它们捕捉趋势反转有一些延迟。所以，他们的信号总是对已经发生的事情的确认。因此，只有当你需要长期策略时，它们才是有用的，因为信号的延迟会让你很晚进场和出场。然而，HA蜡烛是一个非常有用的工具，特别是当你处理倒票和需要平滑非常嘈杂的价格行为时。就像任何其他指标一样，将它与另一个信号一起使用是很有用的，例如移动平均线。</p><p id="1530" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在让我们看看如何在Python中计算Heikin Ashi蜡烛。</p><h1 id="a40a" class="md me it bd mf mg np mi mj mk nq mm mn jz nr ka mp kc ns kd mr kf nt kg mt mu bi translated">Python中的示例</h1><p id="1197" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">对于本例，我们将分析2020年12月15日至2021年4月15日的标准普尔500数据。你可以在GitHub的这里找到完整的代码。</p><p id="1389" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，让我们安装一些有用的库:</p><pre class="kj kk kl km gt nu nv nw nx aw ny bi"><span id="287c" class="nz me it nv b gy oa ob l oc od">!pip install yfinance<br/>!pip install mpl_finance</span></pre><p id="ceac" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，让我们导入它们并应用一些图形增强:</p><pre class="kj kk kl km gt nu nv nw nx aw ny bi"><span id="97b6" class="nz me it nv b gy oa ob l oc od">import pandas as pd<br/>import yfinance<br/>from mpl_finance import candlestick_ohlc<br/>import matplotlib.pyplot as plt</span><span id="9895" class="nz me it nv b gy oe ob l oc od">plt.rcParams['figure.figsize'] = [12, 7]</span><span id="0fc1" class="nz me it nv b gy oe ob l oc od">plt.rc('font', size=14)</span></pre><p id="d121" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们可以下载标准普尔500的数据，并用一个连续的索引代替日期</p><pre class="kj kk kl km gt nu nv nw nx aw ny bi"><span id="2690" class="nz me it nv b gy oa ob l oc od">name = 'SPY'<br/>ticker = yfinance.Ticker(name)<br/>df = ticker.history(interval="1d",start="2020-12-15",end="2021-04-15")</span><span id="8d66" class="nz me it nv b gy oe ob l oc od">df['Date'] = range(df.shape[0])<br/>df = df.loc[:,['Date', 'Open', 'High', 'Low', 'Close']]</span></pre><p id="4c37" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们创建一个简单的函数来绘制数据框的图表:</p><pre class="kj kk kl km gt nu nv nw nx aw ny bi"><span id="ac0b" class="nz me it nv b gy oa ob l oc od">def plot_chart(df):<br/>  fig, ax = plt.subplots()</span><span id="c518" class="nz me it nv b gy oe ob l oc od">  candlestick_ohlc(ax,df.values,width=0.6, \<br/>                   colorup='green', colordown='red', alpha=0.8)</span><span id="0d2f" class="nz me it nv b gy oe ob l oc od">  fig.tight_layout()</span><span id="fcea" class="nz me it nv b gy oe ob l oc od">fig.show()</span></pre><p id="4e89" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，让我们看看最初的烛台图表:</p><pre class="kj kk kl km gt nu nv nw nx aw ny bi"><span id="1d79" class="nz me it nv b gy oa ob l oc od">plot_chart(df)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/64d981a586a7df0082ebaa4eb62bd4a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HnVRBlclu6mpCMD78WiPxA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0e40" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如你所见，它充满了缺口和长尾。</p><p id="88ce" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，让我们根据原来的公式来计算Heikin Ashi蜡烛。由于我们需要检查前一根蜡烛，我们必须跳过第一行。</p><p id="f2ce" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将把结果存储在一个名为<em class="lu"> df_ha </em>的新数据帧中。我们复制蜡烛线的原始数据，以便保持相同的高点和低点。然后，我们删除第一行。</p><pre class="kj kk kl km gt nu nv nw nx aw ny bi"><span id="eb83" class="nz me it nv b gy oa ob l oc od">df_ha = df.copy()</span><span id="5ce1" class="nz me it nv b gy oe ob l oc od">for i in range(df_ha.shape[0]):<br/>  if i &gt; 0:<br/>    df_ha.loc[df_ha.index[i],'Open'] = (df['Open'][i-1] + df['Close'][i-1])/2<br/>  <br/>  df_ha.loc[df_ha.index[i],'Close'] = (df['Open'][i] + df['Close'][i] + df['Low'][i] +  df['High'][i])/4</span><span id="fe15" class="nz me it nv b gy oe ob l oc od">df_ha = df_ha.iloc[1:,:]</span></pre><p id="caa3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们现在可以画出结果:</p><pre class="kj kk kl km gt nu nv nw nx aw ny bi"><span id="39ba" class="nz me it nv b gy oa ob l oc od">plot_chart(df_ha)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/019d1dfa5c807f1185a74d7b7a43e824.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U37oeyeGbJSG9tCyYe5uhQ.png"/></div></div></figure><p id="959d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如我们所看到的，缺口消失了，旋转的顶部HA蜡烛线能够很好地预测趋势反转。</p><h1 id="df4c" class="md me it bd mf mg np mi mj mk nq mm mn jz nr ka mp kc ns kd mr kf nt kg mt mu bi translated">结论</h1><p id="4329" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">Heikin Ashi蜡烛对于任何类型的交易者来说都是非常有用的工具，它必须出现在每个投资者的工具箱中。只是不要忘记平滑的价格行为是有延迟信号的代价的。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="880d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="lu">吉安卢卡·马拉托是意大利数据科学家和小说作家。他是数据科学、机器学习和数据分析在线学校</em><a class="ae lv" href="https://www.yourdatateacher.com/" rel="noopener ugc nofollow" target="_blank"><em class="lu">【YourDataTeacher.com</em></a><em class="lu">的创始人。</em></p></div></div>    
</body>
</html>