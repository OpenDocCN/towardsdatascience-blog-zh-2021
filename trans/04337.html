<html>
<head>
<title>How to Train a Model to Predict Next-Day Rain with Google BigQuery ML</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Google BigQuery ML训练一个模型来预测第二天的降雨</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-train-a-model-to-predict-next-day-rain-with-google-bigquery-ml-d2231c05dcd8?source=collection_archive---------46-----------------------#2021-04-12">https://towardsdatascience.com/how-to-train-a-model-to-predict-next-day-rain-with-google-bigquery-ml-d2231c05dcd8?source=collection_archive---------46-----------------------#2021-04-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3f87" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用大家都非常熟悉的SQL语法预测未来，速度快得惊人，而且简单。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/97b82b1d74ab8741d6249ad340cf9d8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IB8oCAOu5pcL-ajNdwWuVA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="kv">照片由</em> <a class="ae kw" href="https://unsplash.com/@ak1?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> <em class="kv">安娜·阿特金斯</em></a><em class="kv"/><a class="ae kw" href="https://unsplash.com/s/photos/rain?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"><em class="kv">Unsplash</em></a></p></figure><p id="41d5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">预计会下雨。只有两个简单的词，但有时赌注可能比明天出门前拿一把伞要高得多。雨水可能会破坏野餐计划，也可能会给急于拯救遭受旱灾的农作物的农民带来巨大的快乐。</p><p id="6b14" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">学习如何预测第二天的降雨是用Google BigQuery探索机器学习的一种简单实用的方法。所以，让我们来看看如何让它发生。</p><p id="0140" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">在这篇文章中，你会发现:</strong></p><ol class=""><li id="688a" class="lt lu iq kz b la lb ld le lg lv lk lw lo lx ls ly lz ma mb bi translated">为什么机器学习要用BigQuery ML？</li><li id="ea51" class="lt lu iq kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">如何将数据集摄取并拆分成训练集和测试集？</li><li id="e485" class="lt lu iq kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">如何训练和评估一个分类模型？</li><li id="8236" class="lt lu iq kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">如何预测第二天的降雨？</li></ol></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="8fd5" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">为什么机器学习要用BigQuery ML？</h1><p id="d35a" class="pw-post-body-paragraph kx ky iq kz b la ng jr lc ld nh ju lf lg ni li lj lk nj lm ln lo nk lq lr ls ij bi translated">想象一下，作为一名生活在SQL中的数据分析师，您了解BigQuery数据仓库中存储了哪些数据。你可能最近学习了一些关于机器学习的基础知识，但绝不是一个可以闭着眼睛写Python代码的狂热的ML专家。</p><p id="eb19" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">然而，你<strong class="kz ir">想要用BigQuery数据集建立一个机器学习模型，来预测某些可能对你的业务有价值的行为</strong>。你需要尽快得到它，因为在商界，时间不等人。</p><p id="c15c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果你不太了解复杂的ML框架，比如TensorFlow或Keras，你应该如何在短时间内实现它呢？在不疯狂使用Python或Java编程的情况下，如何编写完整的ML解决方案呢？</p><p id="86ea" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这也是BigQuery ML真正能够大放异彩的地方。简而言之，它允许你使用标准的SQL查询在BigQuery中创建和训练机器学习模型。这种方法有3个主要好处。</p><ul class=""><li id="b809" class="lt lu iq kz b la lb ld le lg lv lk lw lo lx ls nl lz ma mb bi translated">你不需要花费太多的时间去尝试用各种各样的新工具从你的BigQuery数据仓库中导出数据</li><li id="f24a" class="lt lu iq kz b la mc ld md lg me lk mf lo mg ls nl lz ma mb bi translated">如果有法律限制或合规性要求严格控制如何导出数据并将其转移到进行分析和机器学习，您就不必寻求大量批准(当然，遵守访问控制政策和常识在这里仍然适用。)</li><li id="bc86" class="lt lu iq kz b la mc ld md lg me lk mf lo mg ls nl lz ma mb bi translated">你不需要把自己逼疯去用Python/ Java创建一个ML解决方案，也不需要加入长长的等待名单去麻烦别人(甚至整个团队)来帮你。</li></ul><p id="1bc4" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">那么，这对企业到底意味着什么呢？这意味着<strong class="kz ir">一种更简单、更快速的方式来利用机器学习来预测未来可能发生的事情，以及企业应该如何应对，以有效抓住机遇或减轻风险。</strong></p><p id="4879" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">提醒一句，目前BigQuery ML on支持一系列特定的模型。它们包括线性回归、逻辑回归、K均值聚类、张量流、矩阵分解、XGBoost、深度神经网络和基于ARIMA的时间序列模型。</p><p id="c3d4" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我个人认为可用的选项足以为常见的ML用例快速构建基线模型。但是请务必查看<a class="ae kw" href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create-boosted-tree" rel="noopener ugc nofollow" target="_blank"> BigQuery文档</a>以获得最新的产品列表。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="0d33" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">开始之前</h1><h2 id="ff74" class="nm mp iq bd mq nn no dn mu np nq dp my lg nr ns na lk nt nu nc lo nv nw ne nx bi translated">我们的目标和游戏计划</h2><p id="1d17" class="pw-post-body-paragraph kx ky iq kz b la ng jr lc ld nh ju lf lg ni li lj lk nj lm ln lo nk lq lr ls ij bi translated">在进入BigQuery之前，这里是我们想要实现的:给定今天关于风向、降雨量、最低温度、最高温度、云量等等的观测数据，我们能预测明天是否会下雨吗？</p><p id="583b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们拥有的是一个<a class="ae kw" href="https://www.kaggle.com/jsphyg/weather-dataset-rattle-package" rel="noopener ugc nofollow" target="_blank"> Kaggle数据集</a>，包含了2007年至2017年间澳大利亚选定地点的10年天气观测数据。下面是我们关于如何将数据集转化为分类模型的游戏计划，我们可以用它来预测2021年的第二天降雨。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/89701ae591dfbbbf35015d0a6c16765a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*e8yfvzqz5ewxcwCR"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="cd5a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">诚然，我们正试图创建一个非常简化的降雨预报，它无处不在，以至于人们很容易忽视它的巨大价值:从大量数据中预测未来的能力。但是，不要被它的简单性所迷惑，因为预测能力是唯一重要的东西，而不是花哨的ML算法或脑筋急转弯技术！</p><h2 id="ad2f" class="nm mp iq bd mq nn no dn mu np nq dp my lg nr ns na lk nt nu nc lo nv nw ne nx bi translated">初始设置</h2><p id="2b6c" class="pw-post-body-paragraph kx ky iq kz b la ng jr lc ld nh ju lf lg ni li lj lk nj lm ln lo nk lq lr ls ij bi translated">在我们为那些令人兴奋的机器学习的东西疯狂之前，这里有3件你需要设置的事情。</p><ol class=""><li id="a728" class="lt lu iq kz b la lb ld le lg lv lk lw lo lx ls ly lz ma mb bi translated">在谷歌云平台上创建一个项目</li><li id="c647" class="lt lu iq kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">在BigQuery上创建数据集</li><li id="4a10" class="lt lu iq kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">从我的<a class="ae kw" href="https://github.com/Skye-Tran/BigQueryML-AUSRainPrediction.git" rel="noopener ugc nofollow" target="_blank"> GitHub </a>下载以下2个CSV文件，然后<a class="ae kw" href="https://cloud.google.com/storage/docs/uploading-objects" rel="noopener ugc nofollow" target="_blank">将它们</a>上传到Google云存储</li></ol><ul class=""><li id="f27a" class="lt lu iq kz b la lb ld le lg lv lk lw lo lx ls nl lz ma mb bi translated">weatherAUS.csv:可以从<a class="ae kw" href="https://www.kaggle.com/jsphyg/weather-dataset-rattle-package" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>下载。我们用它来训练和测试ML模型</li><li id="6ade" class="lt lu iq kz b la mc ld md lg me lk mf lo mg ls nl lz ma mb bi translated">apr10_predict.csv:可从我的<a class="ae kw" href="https://github.com/Skye-Tran/BigQueryML-AUSRainPrediction.git" rel="noopener ugc nofollow" target="_blank"> GitHub </a> &amp;下载，包含2021年4月10日的天气观测。我们用它来预测4月11日是否会下雨</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/c2bd5f2520f9e22cc0066ac4d26e8bbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zm7rhHvaLmIo-zDqpv3w-w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="kv">新项目“澳大利亚铁路”&amp;数据集“降雨预测”已创建(图片由作者提供)</em></p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/d6cfef8f703a97579d5ef2897d1eb676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c4TqgAJLD2jIZHTq"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="kv">上传到云存储的2个CSV文件(图片由作者提供)</em></p></figure></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="773f" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">摄取和分割数据集</h1><h2 id="75ab" class="nm mp iq bd mq nn no dn mu np nq dp my lg nr ns na lk nt nu nc lo nv nw ne nx bi translated">摄取数据集</h2><p id="83b6" class="pw-post-body-paragraph kx ky iq kz b la ng jr lc ld nh ju lf lg ni li lj lk nj lm ln lo nk lq lr ls ij bi translated"><strong class="kz ir">第一步。将云存储中的2个CSV文件加载到BigQuery </strong></p><p id="7115" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">由于weatherAUS数据集将空值写成“NA”字符串，所以我将使用bq load命令通过null_marker选项直接将“NA”字符串作为空值导入。下面是怎么做的。</p><p id="b63c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在GCP控制台上，单击页面顶部的激活云外壳按钮来配置您的Google云外壳计算机。给它一分钟左右的加载时间。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/12d4406f641956a7df58f34aed8d06fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EPPlXF-yH2I1XpGk"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="fdb6" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">要加载weatherAUS数据集，请输入下面的命令<strong class="kz ir"> <em class="oa">，但要记住更新云存储URI(以gs://开头，以。因为您的csv文件将位于不同的位置</em> </strong>。</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="1d54" class="nm mp iq oc b gy og oh l oi oj">bq load --autodetect --null_marker="NA" --source_format=CSV rainprediction.weatherAUS gs://australia_rain_input/weatherAUS.csv</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/9d16e2084d47899fd6a17282108dc92c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1a2RaQGAYYJouix_"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="0a80" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">当看到要求授权云壳的弹出窗口时，点击<strong class="kz ir">授权</strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/7c50da142c1a5052e8c1fb24a1953bac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*llWRZNbYZbdqKlDQ"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="0a55" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">等到看到当前状态:DONE，然后输入下一个命令来加载apr10_predict数据集。<strong class="kz ir"> <em class="oa">但是也别忘了更新云存储URI。</em>T19】</strong></p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="117c" class="nm mp iq oc b gy og oh l oi oj">bq load --autodetect --source_format=CSV rainprediction.apr10_predict gs://australia_rain_input/apr10_predict.csv</span></pre><p id="cfcc" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">看到当前状态:完成此加载作业后，刷新您的浏览器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/eb86b27e6910d707c3116f7b71f6ec3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OEgqC5XvrS8u1Sp4"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="a9bb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">仔细检查是否可以在BigQuery中新创建的数据集下看到两个名为weatherAUS和apr10_predict的新表。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/6828121b8a1bc2b4801323bef9dc5efd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YudgM6EJqrIT3m5o"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="8f78" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">步骤二。查看加载到BigQuery </strong>中的数据</p><p id="76a5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">weatherAUS表的快速预览<strong class="kz ir">显示有145，460行数据。标签(即我们试图预测的)是RainTomorrow，所有其他列是预测器(即我们可能用来预测第二天是否下雨的变量)。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/d5c24a30619767c38c3bbb139bad0f1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Em-a-gYsVCjiF-tf"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="e7df" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">不要忘记查看<strong class="kz ir">模式</strong>来验证数据类型。在BigQuery ML中，确保每一列的数据类型正确总是有好处的。</p><p id="88ae" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为什么这样因为不同的数据类型会导致非常不同的数据预处理处理，这些处理是由BigQuery ML自动执行的。简而言之，混合数据类型可能导致次优的数据处理，最终阻碍ML模型的准确性。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/788754aa33bc352e9085838c43b6b8a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NHGk6y1LfLGyJrys"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="2239" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在我们的例子中，MinTemp、MaxTemp、rainbow、Sunshine等数值使用字符串类型似乎有点奇怪。请记住这一点，因为我们将在下一节中解决它。</p><h2 id="e467" class="nm mp iq bd mq nn no dn mu np nq dp my lg nr ns na lk nt nu nc lo nv nw ne nx bi translated">将数据集分成训练集和测试集</h2><p id="3954" class="pw-post-body-paragraph kx ky iq kz b la ng jr lc ld nh ju lf lg ni li lj lk nj lm ln lo nk lq lr ls ij bi translated">接下来，我们将把数据集分成训练集和测试集。</p><ul class=""><li id="3012" class="lt lu iq kz b la lb ld le lg lv lk lw lo lx ls nl lz ma mb bi translated">训练集:训练一个分类模型，把给定的天气观测映射到规定的标签(即RainTomorrow)。</li><li id="2d2b" class="lt lu iq kz b la mc ld md lg me lk mf lo mg ls nl lz ma mb bi translated">测试集:严格用于评估最大似然模型是否可以用该模型以前没有见过的新数据进行预测</li></ul><p id="ae00" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">第一步。创建一个假的唯一ID列，并更正数值的数据类型</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/bf297e23802e8a252301d7d2ce01b3f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*S7iFL5y5ZTOkOtoR"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="77ee" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">第二步。基于伪唯一ID列(UUID)分割数据集</strong></p><p id="4156" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了获得我的训练和测试集的可重复数据采样，我使用了下面由<a class="ae kw" rel="noopener" target="_blank" href="/lessons-learned-using-google-cloud-bigquery-ml-dfd4763463c"> Christy Bergman </a>编写的BigQuery代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/4bd03160ea99b972a8156d2ac950d714.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nkP9C5yZGF1mQY4p"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">训练集(图片由作者提供)</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/f2730ac6c1aa57c83d52c5853402c7a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Au6Yn497K2akdv8Z"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">测试集(图片由作者提供)</p></figure></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="0593" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">训练和评估分类模型</h1><h2 id="beb9" class="nm mp iq bd mq nn no dn mu np nq dp my lg nr ns na lk nt nu nc lo nv nw ne nx bi translated">使用创建模型训练ML模型</h2><p id="43cb" class="pw-post-body-paragraph kx ky iq kz b la ng jr lc ld nh ju lf lg ni li lj lk nj lm ln lo nk lq lr ls ij bi translated"><strong class="kz ir">训练一个简单的逻辑回归模型</strong></p><p id="7dd3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">现在最激动人心的部分来了！让我们创建一个逻辑回归模型，这是分类问题的最简单的模型类型。大伙儿，击鼓吧！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/65076f761141ac8a7cfae8f43d916a0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7vyWZi68HLxgONAH"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="dcb8" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在BigQuery中运行上述语句后，我们将获得第一个分类模型，该模型将天气观测结果映射为明天下雨是或否。哒哒！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/c98b9474a86a072e2853c179ae6b59e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3-zQmCUvs3FZ3Eu7"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="5d34" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">定制逻辑回归模型</strong></p><p id="5e15" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">众所周知，许多精明的ML工程师在优化他们的模型时喜欢自由选择。但另一方面，如果你是一名ML新手或在关键时刻，必须做出如此多的选择(例如，学习速度，如何以及以什么比例将输入数据分成训练集和评估集等等)可能会令人生畏。</p><p id="7aae" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">幸运的是，<strong class="kz ir"> BigQuery ML已经将某些设置作为默认设置</strong>。从上面的例子可以看出，不需要处理无数的选择，只需要几行代码就可以相对容易地建立并运行一个像样的ML模型。</p><p id="a949" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">但是如果我们想要定制某些设置来满足我们的需求呢？让我们尝试定制我们的逻辑回归模型来反映3个变化。</p><ol class=""><li id="39b6" class="lt lu iq kz b la lb ld le lg lv lk lw lo lx ls ly lz ma mb bi translated">随机抽取20%的训练数据用于评估(目前BigQuery ML仅使用10，000行进行评估，因为我们的数据集超过50，000行。)</li><li id="c0d1" class="lt lu iq kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">纠正不平衡的训练数据集(默认选项是不平衡权重。)</li><li id="ebb6" class="lt lu iq kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">应用L2正则化来惩罚复杂性，从而控制过度拟合(默认选项是没有L2正则化。)</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/0a7f2f394d7342232802bd4dc17b3117.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZeW66i0mCzB5P5mq"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="0931" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">哦，等等！是不是意味着我们可以定制任何东西，任何东西？没有。至少现在不会，但是可以随时查看<a class="ae kw" href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create-boosted-tree" rel="noopener ugc nofollow" target="_blank"> BigQuery文档</a>来了解您不能定制的内容，并尝试您可以定制的内容。</p><h2 id="729f" class="nm mp iq bd mq nn no dn mu np nq dp my lg nr ns na lk nt nu nc lo nv nw ne nx bi translated">用ML评估分类模型。评价</h2><p id="b43d" class="pw-post-body-paragraph kx ky iq kz b la ng jr lc ld nh ju lf lg ni li lj lk nj lm ln lo nk lq lr ls ij bi translated">是时候使用测试数据集来验证我们第一个简单的逻辑回归模型的性能了。让我们看看这样一个简单的模型(没有任何花哨的微调)能够用前所未见的新数据预测明天的降雨。</p><p id="b032" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这个查询再简单不过了。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/56867429639e7e6282a3f7e9c8d5a521.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WL1qtMIVMtIhb6Iu"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="8ecb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">由于测试集的ROC _ AUC(0.878)与训练集的ROC _ AUC(0.880)几乎相同，因此我们的模型没有过拟合。0.85的精度看起来也还过得去。当然，可以用<a class="ae kw" href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-preprocessing-functions" rel="noopener ugc nofollow" target="_blank">转换条款</a>做更多的功能工程来提高F1_score，但是现在，让我们坚持现有的。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="d0da" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">用分类模型预测第二天的降雨</h1><p id="5f45" class="pw-post-body-paragraph kx ky iq kz b la ng jr lc ld nh ju lf lg ni li lj lk nj lm ln lo nk lq lr ls ij bi translated">在apr10_predict表中，我收集了2021年4月10日澳大利亚几个地方的<a class="ae kw" href="http://www.bom.gov.au/climate/dwo/" rel="noopener ugc nofollow" target="_blank">每日天气观测</a>。接下来，我们将使用逻辑回归模型来预测2021年4月11日是否会下雨。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/2cc2568f06a2bd53a63da67b40579ea5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jVvMprkkySr1wRbb"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="a127" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我解释一下上面的截图是怎么回事。</p><ol class=""><li id="2f22" class="lt lu iq kz b la lb ld le lg lv lk lw lo lx ls ly lz ma mb bi translated"><strong class="kz ir"><em class="oa">predicted _ rain tomorrow</em></strong>根据我选择的0.6阈值显示4月11日是否可能下雨。只要“下雨”的概率超过0.6，模型就会预测第二天“明天下雨”。</li><li id="b51f" class="lt lu iq kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">接下来的两列<strong class="kz ir"><em class="oa">predicted _ rain tomorrow _ probs . label</em></strong>和<strong class="kz ir"><em class="oa">predicted _ rain tomorrow _ probs . prob</em></strong>显示了BigQuery如何得出预测。在第一行中，模型计算出悉尼“不下雨”的概率是0.75，而“下雨”的概率只有0.25。因为“下雨”的概率低于阈值0.6，所以对第二天下雨的预测是“不”。</li><li id="67f7" class="lt lu iq kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">红色的最后一栏是我添加到截图中的，这样你可以很容易地比较预测和4月11日的实际降雨。这不是模型在执行查询时会给你的。</li></ol><p id="1094" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果你仍然想知道阈值在分类模型中意味着什么，看看这个<a class="ae kw" href="https://developers.google.com/machine-learning/crash-course/classification/thresholding" rel="noopener ugc nofollow" target="_blank">简单的解释</a>。但是就预测而言，我们只对达尔文的预测是错误的。我会说这并不坏，因为我们只花很少的时间在Google BigQuery中编写简单的查询。</p><p id="1735" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">当时间是最重要的，并且您的数据在BigQuery中随时可用时，就是这样了——big query ML是您的最佳选择！</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="db4f" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">包扎</h1><p id="16ca" class="pw-post-body-paragraph kx ky iq kz b la ng jr lc ld nh ju lf lg ni li lj lk nj lm ln lo nk lq lr ls ij bi translated">现在，您可以快速浏览如何训练和评估分类模型，以及如何使用BigQuery ML预测第二天的降雨量！BigQuery ML能否取代其他类似Tensorflow、Keras等行业标准的机器学习框架？可能不是因为让ML在现实生活中发挥作用是一系列相互竞争的目标之间的权衡，如速度、简单性和准确性。</p><p id="d928" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果你是一个精明的ML工程师，<strong class="kz ir">更喜欢大量的自由来试验各种ML模型和不同的数据预处理技术，以实现极其精确的预测，你可能最好去别处看看</strong>。这是因为BigQuery ML目前提供的选择有限，因为它保留了它的简单性和速度。</p><p id="3c02" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">然而，作为一个欣赏<strong class="kz ir">快速测试一个新想法或者创建一个足够好的ML基线模型</strong>的人，我确实看到了BigQuery ML的价值。<strong class="kz ir">我不必为尝试从数据仓库导出数据而烦恼</strong>，因为我正在BigQuery(数据仓库本身)中训练和部署ML模型。此外，没有必要使用Python或Java构建一个完整的ML管道，因为我可以使用SQL用几行代码创建一个模型。有什么不喜欢的？</p><p id="b5f2" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">感谢您的阅读。对我如何能做得更好有反馈，或者只是想聊天？在评论里告诉我或者在<a class="ae kw" href="https://www.linkedin.com/in/skyetran/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上找到我。祝大家这周过得愉快！</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><p id="cc29" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><em class="oa">原载于2021年4月12日http://thedigitalskye.com</em><a class="ae kw" href="http://thedigitalskye.com/2021/04/13/how-to-train-a-classification-model-to-predict-next-day-rain-with-google-bigquery-ml/" rel="noopener ugc nofollow" target="_blank"><em class="oa"/></a><em class="oa">。</em></p></div></div>    
</body>
</html>