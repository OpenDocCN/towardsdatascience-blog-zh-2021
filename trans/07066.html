<html>
<head>
<title>Matplotlib Animations in Jupyter Notebook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jupyter笔记本中的Matplotlib动画</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/matplotlib-animations-in-jupyter-notebook-4422e4f0e389?source=collection_archive---------2-----------------------#2021-06-27">https://towardsdatascience.com/matplotlib-animations-in-jupyter-notebook-4422e4f0e389?source=collection_archive---------2-----------------------#2021-06-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="422c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用matplotlib <code class="fe ki kj kk kl b">FuncAnimation</code>在Jupyter笔记本中创建动画图形</h2></div><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/6cf40e1bf7659afc21fa6401d4559a54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pv2AJGKWmqbFC9NjAWXuCg.jpeg"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">照片由<a class="ae lc" href="https://unsplash.com/@isaacmsmith?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Isaac Smith </a>在<a class="ae lc" href="https://unsplash.com/s/photos/data-visualization?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="af6a" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">Matplotlib 是用于探索性数据分析的最流行的绘图库之一。它是Pandas中默认的绘图后端，其他流行的绘图库也是基于它，例如seaborn。在大多数情况下，绘制静态图应该很好，但当您运行模拟或进行时间序列数据分析时，基本图可能并不总是足够的。您可能希望展示一个动画来帮助您理解状态如何随时间变化。</p><p id="3f0e" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">在本文中，您将学习如何在Jupyter Notebook中使用matplotlib创建动画。这篇文章的结构如下:</p><ol class=""><li id="85dc" class="lz ma it lf b lg lh lj lk lm mb lq mc lu md ly me mf mg mh bi translated">朱庇特笔记本中的互动情节</li><li id="35d7" class="lz ma it lf b lg mi lj mj lm mk lq ml lu mm ly me mf mg mh bi translated">Jupyter笔记本中的嵌入式HTML5视频</li></ol><blockquote class="mn"><p id="20bc" class="mo mp it bd mq mr ms mt mu mv mw ly dk translated">请查看<a class="ae lc" href="https://github.com/BindiChen/machine-learning/blob/master/data-visualization/0001-matplotlib-animation/matplotlib-animation-notebook.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>获取源代码。</p></blockquote><p id="2692" class="pw-post-body-paragraph ld le it lf b lg mx ju li lj my jx ll lm mz lo lp lq na ls lt lu nb lw lx ly im bi translated">为了演示，我们将创建一个移动的正弦波，下面是一个帧示例:</p><pre class="kn ko kp kq gt nc kl nd ne aw nf bi"><span id="bdd5" class="ng nh it kl b gy ni nj l nk nl">import matplotlib.pyplot as plt<br/>import numpy as np</span><span id="5245" class="ng nh it kl b gy nm nj l nk nl">x = np.linspace(0, 2*np.pi, 100)<br/>y = np.sin(x)</span><span id="c76d" class="ng nh it kl b gy nm nj l nk nl">plt.plot(x, y)<br/>plt.show()</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nn"><img src="../Images/2286fa8b3f6785dfdfe5ce497a618a95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gorfKhE_Fb-Bq3_maJ6Vyw.png"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">作者图片</p></figure></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><h1 id="827f" class="nv nh it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">1.朱庇特笔记本中的互动情节</h1><p id="b910" class="pw-post-body-paragraph ld le it lf b lg om ju li lj on jx ll lm oo lo lp lq op ls lt lu oq lw lx ly im bi translated">为了在Jupyter Notebook中创建交互式绘图，您首先需要启用交互式绘图，如下所示:</p><pre class="kn ko kp kq gt nc kl nd ne aw nf bi"><span id="1694" class="ng nh it kl b gy ni nj l nk nl"># Enable interactive plot<br/><strong class="kl iu">%matplotlib notebook</strong></span></pre><p id="7efa" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">之后，我们导入所需的库。尤其是可以用来给你制作动画的<code class="fe ki kj kk kl b">FuncAnimation</code>类。</p><pre class="kn ko kp kq gt nc kl nd ne aw nf bi"><span id="ab64" class="ng nh it kl b gy ni nj l nk nl">import matplotlib.pyplot as plt<br/>from matplotlib.animation import <strong class="kl iu">FuncAnimation</strong></span></pre><p id="664e" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">接下来，我们需要创建动画人物的初始状态。我们调用<code class="fe ki kj kk kl b">subplots()</code>不带任何参数地创建一个图形<code class="fe ki kj kk kl b">fig</code>和一个单轴<code class="fe ki kj kk kl b">ax</code>。我们将x范围设置为<code class="fe ki kj kk kl b">(0, 2*Pi)</code>，将y范围设置为<code class="fe ki kj kk kl b">(-1.1,1.1)</code>，以避免它们不断变化。</p><pre class="kn ko kp kq gt nc kl nd ne aw nf bi"><span id="6a2a" class="ng nh it kl b gy ni nj l nk nl"><strong class="kl iu">fig, ax = plt.subplots()</strong></span><span id="16d5" class="ng nh it kl b gy nm nj l nk nl"><strong class="kl iu">line</strong>, = ax.plot([])     # A tuple unpacking to unpack the only plot</span><span id="6eec" class="ng nh it kl b gy nm nj l nk nl">ax.<strong class="kl iu">set_xlim</strong>(0, 2*np.pi)<br/>ax.<strong class="kl iu">set_ylim</strong>(-1.1, 1.1)</span></pre><p id="25ad" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">然后我们创建一个函数<code class="fe ki kj kk kl b">animate()</code>，它将被<code class="fe ki kj kk kl b">FuncAnimation</code>调用。该函数接受一个参数<code class="fe ki kj kk kl b">frame_num</code>——当前帧号。这里我们要做的是根据帧号改变我们行的数据。</p><pre class="kn ko kp kq gt nc kl nd ne aw nf bi"><span id="5364" class="ng nh it kl b gy ni nj l nk nl">def animate(frame_num):<br/>    y = np.sin(<strong class="kl iu">x + 2*np.pi * frame_num/100</strong>)<br/>    line.set_data((x, y))<br/>    return line</span></pre><p id="bb43" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">最后，我们通过调用带有4个参数的<code class="fe ki kj kk kl b">FuncAnimation</code>来创建动画对象</p><ul class=""><li id="98ec" class="lz ma it lf b lg lh lj lk lm mb lq mc lu md ly or mf mg mh bi translated">第一个参数<code class="fe ki kj kk kl b">fig</code>是对我们创建的图形的引用</li><li id="b566" class="lz ma it lf b lg mi lj mj lm mk lq ml lu mm ly or mf mg mh bi translated">第二个参数<code class="fe ki kj kk kl b">animate</code>是我们创建的在每一帧调用以更新绘图的函数。</li><li id="77c4" class="lz ma it lf b lg mi lj mj lm mk lq ml lu mm ly or mf mg mh bi translated">第三个参数是<code class="fe ki kj kk kl b">frames=100</code>，它定义了“一轮动画”的帧数</li><li id="9ddd" class="lz ma it lf b lg mi lj mj lm mk lq ml lu mm ly or mf mg mh bi translated">最后，<code class="fe ki kj kk kl b">interval=20</code>参数设置帧之间的延迟(毫秒)。<code class="fe ki kj kk kl b">20</code>相当于<code class="fe ki kj kk kl b">50FPS</code> (1000ms / 20 = 50 FPS)。如果数字太大，你会等很长时间，如果数字太小，你会看不到它的速度。一般来说，我们需要大于16的FPS来实现流畅的动画(人眼只能接收10–12帧[1])。</li></ul><pre class="kn ko kp kq gt nc kl nd ne aw nf bi"><span id="e24a" class="ng nh it kl b gy ni nj l nk nl">anim = FuncAnimation(fig, animate, frames=100, interval=20)</span><span id="e6d3" class="ng nh it kl b gy nm nj l nk nl">plt.show()</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi os"><img src="../Images/b86a2f51e2ee02e2ab5786e199830d9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*2FoSb3vhp6qyZj2SatauBA.gif"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">作者图片</p></figure><blockquote class="mn"><p id="9eb7" class="mo mp it bd mq mr ms mt mu mv mw ly dk translated">请查看笔记本<a class="ae lc" href="https://github.com/BindiChen/machine-learning/blob/master/data-visualization/0001-matplotlib-animation/matplotlib-animation-notebook.ipynb" rel="noopener ugc nofollow" target="_blank">获取源代码</a></p></blockquote><h1 id="e4c8" class="nv nh it bd nw nx ot nz oa ob ou od oe jz ov ka og kc ow kd oi kf ox kg ok ol bi translated">2.Jupyter笔记本中的嵌入式HTML5视频</h1><p id="2ddd" class="pw-post-body-paragraph ld le it lf b lg om ju li lj on jx ll lm oo lo lp lq op ls lt lu oq lw lx ly im bi translated">在前面的例子中，我们已经创建了一个很好的正弦波动画。然而，只有当代码运行时，绘图才是动态的。当然，我们可以截屏，但当你想在网上分享你的Jupyter笔记本时，这不是很有效。</p><p id="3bfe" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们能做的就是把动画转换成HTML5视频，嵌入Jupyter笔记本。我们将使用FFmpeg进行转换。如果没有，首先需要按照说明<a class="ae lc" href="https://ffmpeg.org/download.html" rel="noopener ugc nofollow" target="_blank">下载FFmpeg </a>并解压。</p><p id="fd37" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">之后，我们导入所需的库，并将<code class="fe ki kj kk kl b"><strong class="lf iu">'ffmpeg_path'</strong></code> <strong class="lf iu"> </strong>设置为本地<strong class="lf iu"> ffmpeg </strong>可执行文件的路径:</p><pre class="kn ko kp kq gt nc kl nd ne aw nf bi"><span id="d46d" class="ng nh it kl b gy ni nj l nk nl">import matplotlib.pyplot as plt<br/>from matplotlib.animation import FuncAnimation<br/>from IPython import display</span><span id="9607" class="ng nh it kl b gy nm nj l nk nl"><strong class="kl iu">plt.rcParams['animation.ffmpeg_path'] = '/path_to_your/ffmpeg'</strong></span></pre><p id="21e5" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">创建动画与前面的示例相同。</p><pre class="kn ko kp kq gt nc kl nd ne aw nf bi"><span id="3c17" class="ng nh it kl b gy ni nj l nk nl">fig, ax = plt.subplots()</span><span id="e5c2" class="ng nh it kl b gy nm nj l nk nl">line, = ax.plot([])   # A tuple unpacking to unpack the only plot</span><span id="c717" class="ng nh it kl b gy nm nj l nk nl">ax.set_xlim(0, 2*np.pi)<br/>ax.set_ylim(-1.1, 1.1)</span><span id="9259" class="ng nh it kl b gy nm nj l nk nl">def animate(frame_num):<br/>    y = np.sin(x + 2*np.pi * frame_num/100)<br/>    line.set_data((x, y))<br/>    return line</span><span id="def8" class="ng nh it kl b gy nm nj l nk nl">anim = FuncAnimation(fig, animate, frames=100, interval=20)</span></pre><p id="a5f1" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">但是我们没有用<code class="fe ki kj kk kl b">plt.show()</code>来绘制它，而是调用<code class="fe ki kj kk kl b">anim.to_html5_video()</code>方法来将动画结果转换成HTML5视频。然后，我们需要获取为该视频进行嵌入的HTML代码，这是通过调用IPython <code class="fe ki kj kk kl b">display.HTML(video)</code>来完成的。最后，我们调用<code class="fe ki kj kk kl b">display.display(html)</code>将HTML代码嵌入Jupyter Notebook。</p><pre class="kn ko kp kq gt nc kl nd ne aw nf bi"><span id="6107" class="ng nh it kl b gy ni nj l nk nl">video = anim.to_html5_video()<br/>html = display.HTML(video)<br/>display.display(html)<br/>plt.close()                   # avoid plotting a spare static plot</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi os"><img src="../Images/7dcecbf74e9c0a2d0eb4f76e2322b385.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*d1Q8t3bATR-1n9Iqgrmm0g.gif"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">作者图片</p></figure><blockquote class="mn"><p id="6586" class="mo mp it bd mq mr ms mt mu mv mw ly dk translated">请查看笔记本获取源代码</p></blockquote><h1 id="ed0e" class="nv nh it bd nw nx ot nz oa ob ou od oe jz ov ka og kc ow kd oi kf ox kg ok ol bi translated">结论</h1><p id="815a" class="pw-post-body-paragraph ld le it lf b lg om ju li lj on jx ll lm oo lo lp lq op ls lt lu oq lw lx ly im bi translated">在本文中，我们学习了在Jupyter笔记本中创建matplotlib动画的两种方法。创建动画图可以帮助您运行模拟和进行时序数据分析。</p><p id="26a8" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">希望这篇文章能帮助你节省学习matplotlib的时间。我建议你查看一下<a class="ae lc" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.animation.FuncAnimation.html" rel="noopener ugc nofollow" target="_blank">文档</a>以获得更多选项&amp;设置，并了解你可以做的其他事情。</p><p id="79d7" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">感谢阅读。请查看<a class="ae lc" href="https://github.com/BindiChen/machine-learning/blob/master/data-visualization/0001-matplotlib-animation/matplotlib-animation-notebook.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>获取源代码，如果你对机器学习的实用方面感兴趣，请继续关注。</p><h2 id="1e6f" class="ng nh it bd nw oy oz dn oa pa pb dp oe lm pc pd og lq pe pf oi lu pg ph ok pi bi translated">您可能对我的其他一些数据可视化和熊猫文章感兴趣:</h2><ul class=""><li id="8c7e" class="lz ma it lf b lg om lj on lm pj lq pk lu pl ly or mf mg mh bi translated"><a class="ae lc" rel="noopener" target="_blank" href="/python-interactive-data-visualization-with-altair-b4c4664308f8"> Python与Altair的交互数据可视化</a></li><li id="7a38" class="lz ma it lf b lg mi lj mj lm mk lq ml lu mm ly or mf mg mh bi translated"><a class="ae lc" rel="noopener" target="_blank" href="/interactive-data-visualization-for-exploring-coronavirus-spreads-f33cabc64043">探索冠状病毒传播的交互式数据可视化</a></li><li id="ad18" class="lz ma it lf b lg mi lj mj lm mk lq ml lu mm ly or mf mg mh bi translated"><a class="ae lc" rel="noopener" target="_blank" href="/10-tricks-for-converting-numbers-and-strings-to-datetime-in-pandas-82a4645fc23d">在Pandas中把数字和字符串转换成日期时间的10个技巧</a></li><li id="5bf2" class="lz ma it lf b lg mi lj mj lm mk lq ml lu mm ly or mf mg mh bi translated"><a class="ae lc" rel="noopener" target="_blank" href="/all-pandas-json-normalize-you-should-know-for-flattening-json-13eae1dfb7dd">所有熊猫json_normalize()你应该知道的扁平化JSON </a></li><li id="95a7" class="lz ma it lf b lg mi lj mj lm mk lq ml lu mm ly or mf mg mh bi translated"><a class="ae lc" href="https://medium.com/@bindiatwork/using-pandas-method-chaining-to-improve-code-readability-d8517c5626ac" rel="noopener">使用熊猫方法链接提高代码可读性</a></li><li id="0e68" class="lz ma it lf b lg mi lj mj lm mk lq ml lu mm ly or mf mg mh bi translated"><a class="ae lc" rel="noopener" target="_blank" href="/how-to-do-a-custom-sort-on-pandas-dataframe-ac18e7ea5320">如何对熊猫数据帧进行自定义排序</a></li><li id="854a" class="lz ma it lf b lg mi lj mj lm mk lq ml lu mm ly or mf mg mh bi translated"><a class="ae lc" rel="noopener" target="_blank" href="/all-the-pandas-shift-you-should-know-for-data-analysis-791c1692b5e">为了数据分析你应该知道的所有熊猫移位()</a></li></ul><p id="5e34" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">更多教程可以在我的<a class="ae lc" href="https://github.com/BindiChen/machine-learning" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到</p><h2 id="1f47" class="ng nh it bd nw oy oz dn oa pa pb dp oe lm pc pd og lq pe pf oi lu pg ph ok pi bi translated">参考</h2><ul class=""><li id="6f43" class="lz ma it lf b lg om lj on lm pj lq pk lu pl ly or mf mg mh bi translated"><a class="ae lc" href="https://stopmotionmagazine.com/why-your-frame-rate-fps-matters-in-animation/" rel="noopener ugc nofollow" target="_blank">https://stopmotionmagazine . com/why-your-frame-rate-fps-matters-in-animation/</a></li></ul></div></div>    
</body>
</html>