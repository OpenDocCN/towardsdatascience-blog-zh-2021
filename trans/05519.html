<html>
<head>
<title>Tips and tricks for building a price estimation model for used cars</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">建立二手车价格评估模型的技巧和诀窍</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tip-and-tricks-for-building-a-price-estimation-model-for-used-cars-ac0953e194c4?source=collection_archive---------22-----------------------#2021-05-16">https://towardsdatascience.com/tip-and-tricks-for-building-a-price-estimation-model-for-used-cars-ac0953e194c4?source=collection_archive---------22-----------------------#2021-05-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ab15" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">创建稳健的汽车价格机器学习预测模型的挑战和解决方案</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cfd77a678084867366a6a5de4c8d33d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UYzAaVXN41VGTwnE"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@campful?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">坎贝尔</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="7602" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最近，我发表了一篇短篇<a class="ae kv" href="https://medium.com/elca-data-science/building-a-robust-price-prediction-model-for-used-cars-da1ce2643cbe" rel="noopener"> Medium story </a>，其中我介绍了促使<a class="ae kv" href="https://www.elca.ch/en?gclid=CjwKCAjw2bmLBhBREiwAZ6ugowuw0ITiAetPePNudMPfMl4RJRN8Z96E8W37wlcduKU7vlWcg_zXbRoCHnQQAvD_BwE" rel="noopener ugc nofollow" target="_blank"> ELCA </a>数据科学团队开发机器学习(ML)模型以准确估计瑞士市场上二手车价格的动机、目标和挑战。价格预测任务一直受到机器学习社区的极大关注，各种二手物品在线市场的兴起增加了对自动化工具的需求，以准确预测合理的价格标签。</p><p id="5527" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本笔记中，我将简要介绍我们模型的架构，以及我们用来应对以下关键挑战的一些策略:</p><ul class=""><li id="8866" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">如何处理和编码<strong class="ky ir">分类变量</strong>在这个设置中，</li><li id="ff30" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">如何弥补<strong class="ky ir">汽车模型数据样本数量不足</strong></li><li id="b972" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">如何实现一种<strong class="ky ir">异常值检测</strong>方法来保护我们的训练过程免受噪声数据的影响。</li></ul><p id="1e6b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">特别是，我们的<strong class="ky ir">跨市场实体嵌入解决方案</strong>是一种<em class="mg">转移学习</em>方法，它将我们模型的预测精度提高了大约<strong class="ky ir"> 4.3% </strong>。</p><h1 id="b38f" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">数据集和任务形式化</h1><p id="bab6" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">我们使用了三个不同的汽车数据集，这些数据集由来自不同的瑞士和欧洲数字市场的汽车销售公告组成。</p><ul class=""><li id="eca5" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><a class="ae kv" href="https://www.autoscout24.ch/fr" rel="noopener ugc nofollow" target="_blank"><em class="mg">autoscout 24-CH</em></a>数据集包含119’414个公告，用于训练和验证目的。</li><li id="b364" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><em class="mg"> AutoScout24-DE </em>是一套558'295德国销售公告(摘自<a class="ae kv" href="https://www.autoscout24.com/" rel="noopener ugc nofollow" target="_blank">欧洲网站版本</a>)。这个更大的数据集用于我们的迁移学习方法。</li><li id="8988" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">第三个瑞士数据集(<a class="ae kv" href="https://www.comparis.ch/carfinder/default" rel="noopener ugc nofollow" target="_blank"> <em class="mg"> Comparis-CH </em> </a>，111972个样本)用作测试集，以评估模型的泛化能力</li></ul><p id="6f2d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将自己限制在一组小而简单的汽车特征上，这些特征为普通大众所知，并且易于为大多数二手车收集。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/5b6505812d5e6e8f23f3c62fe64e47bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*NXSYnX8F0t943U116XDDbQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们作为汽车建模方法采用的一组特征。图片作者。</p></figure><p id="0a38" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">目标是使用这个特性集执行标准的<em class="mg">回归任务</em>，其中目标数量是汽车<em class="mg"> x_n </em>的销售价格<em class="mg"> y_n </em>以瑞士法郎(CHF)表示，除以训练集中相应汽车模型的平均价格。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/61793a2914dc8980715989e335ab4b06.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*x0SAgUBQN3omdcJ57VvFoQ.png"/></div></figure><p id="6532" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个简单的操作使目标成为一个相对量，并稳定了优化过程。以瑞士法郎计算的估计价格是通过简单地缩减预测得出的。<em class="mg">均方根误差</em> r ( <strong class="ky ir"> RMSE </strong>)是选择的损失函数。出于可解释性的原因，我们报告了CHF中的原始目标。</p><h1 id="8d74" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">模型架构</h1><p id="5033" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">我们确定并验证了一个<strong class="ky ir"> XGBoost </strong>回归器作为我们预测管道的最佳模型。<a class="ae kv" href="https://xgboost.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank"> XGBoost </a>是一个流行且强大的框架，它实现了<em class="mg">梯度增强</em>技术。其核心是一种<em class="mg">集成方法</em>，它结合了弱决策树。所有的模型搜索和优化实验都是按照标准的机器学习程序进行的，在<em class="mg"> AutoScout24-CH </em>数据集上使用<strong class="ky ir"> 10重分层交叉验证</strong>。下图显示了最终的预测管道。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/bb4f7bfab1ac06c50624ae29c3975727.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*8wPVc3b_xMncVV7-RJTLbw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们的价格预测渠道。图片作者。</p></figure><h1 id="59a5" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">编码分类变量</h1><p id="394e" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">制造商(<em class="mg">制造商</em>)和汽车型号(<em class="mg">型号</em>)特征编码了关于新车价格等级的大部分可用信息。数据集包含37个不同的汽车制造商和211个汽车型号。由于这些是<strong class="ky ir">分类特征</strong>(与连续特征相反)，我们需要<em class="mg">对它们进行编码，然后才能将它们与其余特征连接起来，并使用它们来训练模型。最简单的编码方法是标准的<em class="mg"> one-hot scheme </em>，其中我们创建的二进制变量与每个字段中的类一样多。这种方法几乎相当于为每个类训练一个不同的回归模型。鉴于许多汽车模型的数据都很少，这种编码方案是不够的。将变量映射到单个连续空间的方法是更好的，因为它允许模型利用类之间的相似性。</em></p><p id="f7b0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">实现这一目标的一个简单的表示选择是用两个连续值来表示分类变量:训练数据中类的平均价格及其标准差。直观地说，这种编码方法用关于起始价格和折旧范围的近似信息丰富了汽车表示向量。然而，它不提供了解每种汽车类别折旧模式的更精细细节的可能性。</p><p id="e059" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mg">实体嵌入</em> (EE)方法由<a class="ae kv" href="https://arxiv.org/abs/1604.06737" rel="noopener ugc nofollow" target="_blank"> C. Guo和F. Berkhan于2016年</a>提出，并显示在下面的模式中，这是一种更复杂的方法，它使用一个小的<strong class="ky ir">神经网络</strong>来学习从每个变量的一个热点表示到一个潜在表示的映射。这种映射由每个变量的编码<em class="mg"> EE层</em>表示，其权重与价格预测任务相关的模型的其余部分一起训练。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/b892e8b9f72f08586d91b4616db9925b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Riek8tDF0Y-gIKaNr4Z1Cw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ni">实体嵌入层(EE)的图示，对应于每个独热编码输入之上的额外层。图像由</em> <a class="ae kv" href="https://arxiv.org/abs/1604.06737" rel="noopener ugc nofollow" target="_blank"> <em class="ni"> C .郭和</em></a><em class="ni">f . Berkahn组成。</em></p></figure><p id="ff10" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这三种编码方法提供了以下平均验证性能。具有平均分类价格和标准偏差的变量替代略优于EE方法。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/95697116110789779234e1d49a2086fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*OohvUrgJDJCA90gE_r0zXw.png"/></div></figure><h1 id="c58f" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">数据稀缺:知识转移拯救世界</h1><p id="0bc8" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">一些汽车模型缺乏足够的数据样本可能解释了EE方法令人失望的结果。有些模型在<em class="mg"> AutoScout24-CH </em>中出现不到100次，这不允许学习足够精确的映射。因此，我们在更大的<em class="mg"> AutoScout24-DE </em>数据集上训练EE网络，因为德国汽车市场呈现出与瑞士相似的分布。因此，潜在EE空间中轿厢等级的相对距离应该是<strong class="ky ir">可转移的</strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/e119053371911a1cbaa97285939b0120.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*EnLFnw8Ahp0E9QgSgEO2ew.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们的跨市场实体嵌入方法克服了数据稀缺问题。EE编码层在德国数据上训练，然后转移到我们的瑞士模型。图片作者。</p></figure><p id="3f49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种跨市场迁移学习方法在瑞士RMSE上提供了大约<strong class="ky ir"> 4.3% </strong>的性能提升，使得EE方法优于其他编码方案:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/5bbb9827b59c21d48d704be98d62b8c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*utgD7mNobjS965ZfPUuzPA.png"/></div></div></figure><h1 id="56dc" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">可能的定价趋势培训:异常值检测</h1><p id="a188" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">对数据集的进一步分析让我们认识到，销售公告可能并不总是价格的可靠依据。对标价的不准确性没有控制或限制，甚至更是如此，因为我们不考虑汽车配件和许多其他重要的汽车功能。很明显，我们需要“看穿噪音”,只根据符合每个汽车制造商/车型的<strong class="ky ir">一般定价趋势</strong>的样本来训练模型。</p><p id="bbb7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的解决方案是对每款车型分别应用一个相当激进的<strong class="ky ir">异常值剔除程序</strong>。我们在特征-目标空间的三个独立的二维子空间中执行基于密度的异常值检测:<em class="mg">价格-里程</em>、<em class="mg">价格-年龄、</em>和<em class="mg">价格-功率。</em>里程和车龄是我们的两个磨损水平指标，也是折旧的两个主要原因。我们还发现了一组不可忽略的样品，其价格相对于列出的功率等级异常高。如果样本在三个平面中的任何一个被检测为异常值，则将其从数据集中移除。我们使用<a class="ae kv" href="https://www.dbs.ifi.lmu.de/Publikationen/Papers/LOF.pdf" rel="noopener ugc nofollow" target="_blank">局部异常值因子(LOF) </a>算法，通过测量异常数据点相对于邻居的局部密度偏差来发现异常数据点。以下模式阐明了这种方法:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/5d839b9d638b3daaee2b0e4fec817858.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*trzz2Fu3o4cjtTRnw2P9cw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">所提出的离群点检测方法，基于局部离群因子(LOF)方法，适用于三个不同的特征目标子空间。图片作者。</p></figure><p id="72b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们移除了大约<strong class="ky ir"> 12.5%的训练数据</strong>，并在新数据集上训练整个模型(包括德国EE层)。这极大地提高了性能:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/8cab65f8d234ca9a9b03f459a4ad9fed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*jP8S5yJb3pHa4wKYz7mKmA.png"/></div></figure><h1 id="2b9d" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">成果和业绩</h1><p id="2f0f" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">我们报告了在所有汽车模型上计算的ML模型的最终验证/测试RMSE和平均绝对误差。对于绝大多数汽车，平均估计误差小于训练数据中特定汽车型号价格可变性的<strong class="ky ir"> 20%。鉴于我们的汽车建模方法相对简单，我们的方法的性能非常令人满意。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/6a6404d30825562b3d5dc459b1f674d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*THcMG8RiHtJVOT7c0ZOSAA.png"/></div></figure><p id="f712" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过<a class="ae kv" href="https://car-price-demo.azurewebsites.net/" rel="noopener ugc nofollow" target="_blank">这个演示界面</a>可以查询我们的型号。用户可以插入汽车的特征，并从预测器获得价格估计，以及置信区间和关于模型在训练期间已经看到的相同模型汽车的数量的信息。我们希望这份关于我们在这项任务上的实验的<strong class="ky ir">快速概述</strong>以及我们采用的<strong class="ky ir">成功解决方案</strong>对于任何打算从机器学习角度解决类似问题的人来说都是一份有用的读物。</p><h2 id="d7c4" class="np mi iq bd mj nq nr dn mn ns nt dp mr lf nu nv mt lj nw nx mv ln ny nz mx oa bi translated">参考</h2><ul class=""><li id="2aaf" class="ls lt iq ky b kz mz lc na lf ob lj oc ln od lr lx ly lz ma bi translated">【1】c .签名人:<a class="ae kv" href="https://www.semanticscholar.org/paper/Is-the-Price-Right-Bachelor-thesis-Signer/33d929141ace83bdf34ba0c77201fdd537d1a8d1" rel="noopener ugc nofollow" target="_blank">价格合适吗？</a> (2016)</li><li id="6ce6" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">[2] N. Pal等人，<a class="ae kv" href="https://arxiv.org/abs/1711." rel="noopener ugc nofollow" target="_blank">我的车值多少钱？使用Random force</a>t(2017)预测二手车价格的方法</li><li id="39e4" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">[3] K. Noor and S. Jan，<a class="ae kv" href="https://www.semanticscholar.org/paper/Vehicle-Price-Prediction-System-using-Machine-Noor-Jan/fc87ead6754b188b1b8629db77badf361fd24a22" rel="noopener ugc nofollow" target="_blank">基于机器学习技术的车辆价格预测系统</a> (2017)</li><li id="b6c9" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">[4] S. Pudaruth，<a class="ae kv" href="https://www.semanticscholar.org/paper/Predicting-the-Price-of-Used-Cars-using-Machine-Pudaruth/dc148913b7271b65d221d2c41f77a9e41750c867" rel="noopener ugc nofollow" target="_blank">利用机器学习技术预测二手车价格</a> (2014)</li><li id="5903" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">[5]郭，伯克翰，<a class="ae kv" href="https://arxiv.org/abs/1604.06737" rel="noopener ugc nofollow" target="_blank">分类变量的实体嵌入</a> (2016)</li><li id="c944" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">[6] M. Breunig，<a class="ae kv" href="https://www.researchgate.net/publication/221214719_LOF_Identifying_Density-Based_Local_Outliers" rel="noopener ugc nofollow" target="_blank"> LOF:识别基于密度的局部异常值</a>，(2000)</li><li id="0915" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">[7] T. Albergoni，<a class="ae kv" href="https://mojito.switzerlandnorth.cloudapp.azure.com/car-price/" rel="noopener ugc nofollow" target="_blank">瑞士市场二手车价格预测，演示界面</a> (2020)</li></ul></div></div>    
</body>
</html>