<html>
<head>
<title>Stop Building Your Models One Step at a Time. Automate the Process with Pipelines!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">停止一步一步地构建你的模型。利用管道实现流程自动化！</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-pipelines-in-sci-kit-learn-516aa431dcc5?source=collection_archive---------32-----------------------#2021-10-01">https://towardsdatascience.com/using-pipelines-in-sci-kit-learn-516aa431dcc5?source=collection_archive---------32-----------------------#2021-10-01</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="b184" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">在Sci-kit学习中使用管道</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/06118f93505a9d59dd517963f19fe771.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yKIJibpWR-llPqCR"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@frostroomhead?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Rodion Kutsaev </a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="c327" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">为什么是管道？</h1><p id="006d" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">当我开始在Sklearn中构建模型时，我会将每个预处理步骤分解到它的单元或代码块中。这是一个很好的开始方式，因为您可以很容易地将这些步骤分解成可读的块。然而，虽然它更容易阅读，但缺乏可重复性。下一次用新数据表示模型时，在对新数据运行模型之前，您必须运行转换数据的所有步骤，这带来了许多问题。例如，如果在一次热编码过程中创建了新的列，数据的维度可能会发生变化。</p><p id="3312" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">答案？<a class="ae kz" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" rel="noopener ugc nofollow" target="_blank">管道</a></p><h1 id="0fd3" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">管道解剖</h1><p id="aa2f" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">首先，像往常一样，导入需要运行这个脚本。</p><pre class="kk kl km kn gu mt mu mv bn mw mx bi"><span id="5912" class="my lb iu mu b be mz na l nb nc">from sklearn.pipeline import Pipeline<br/>from sklearn.compose import make_column_selector as selector<br/>from sklearn.compose import ColumnTransformer<br/>from sklearn. pre-processing import MinMaxScaler<br/>from sklearn. pre-processing import OneHotEncoder<br/>from sklearn.ensemble import RandomForestRegressor</span></pre><h1 id="1211" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">柱式变压器</h1><p id="d8b6" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">接下来是一个制作列转换器的函数。我更喜欢通过一个函数来调用它，以使代码更加可重用。</p><p id="5bab" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">列转换器允许您将任意数量的预处理步骤合并到一个转换器中。在下面的例子中，我们有一个用于数字列的<code class="fe nd ne nf mu b">MinMaxScaler</code>和一个用于分类值的<code class="fe nd ne nf mu b">OneHotEncoder</code>。您可以在这些步骤中包括来自Sklearn的任何转换器。</p><p id="3b88" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">他们的文档中有一个很好的例子:<br/> <a class="ae kz" href="https://scikit-learn.org/stable/auto_examples/compose/plot_column_transformer_mixed_types.html#sphx-glr-auto-examples-compose-plot-column-transformer-mixed-types-py" rel="noopener ugc nofollow" target="_blank">混合类型的柱式变压器</a></p><p id="1af9" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">除了演示数字列和分类列之外，还展示了<a class="ae kz" href="https://scikit-learn.org/stable/modules/generated/sklearn.compose.make_column_selector.html" rel="noopener ugc nofollow" target="_blank">列选择器</a>，它允许您根据不同的标准选择列。通过<code class="fe nd ne nf mu b">selector(dtype_exclude="object")</code>选择数字列。下面演示了通过名称选择列作为一个简单的python列表。您可以将这些精选的样式与您提供的不同变压器相结合。此外，您在下面命名您的变压器，如<code class="fe nd ne nf mu b">num</code>和<code class="fe nd ne nf mu b">cat; see</code>，以便稍后在您的fit模型中识别。</p><pre class="kk kl km kn gu mt mu mv bn mw mx bi"><span id="1630" class="my lb iu mu b be mz na l nb nc">def make_coltrans():<br/>    column_trans = ColumnTransformer(transformers=<br/>            [('num', MinMaxScaler(), selector(dtype_exclude="object")),<br/>             ('cat', OneHotEncoder(dtype='int', handle_unknown='ignore'), ['CAT_FIELD_ONE', 'CAT_FIELD_TWO'])],<br/>            remainder='drop')<br/><br/>    return column_trans</span></pre><h1 id="5be9" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">管道</h1><p id="1ca4" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">在创建列转换器之后，现在创建管道是一个非常简单的步骤。您所需要做的就是根据您通常采取的步骤的逻辑顺序对管道序列进行排序。这里我们有两个步骤，列转换器和分类器。我们在下面的列转换器中将这些步骤命名为<code class="fe nd ne nf mu b">prep</code>和<code class="fe nd ne nf mu b">clf</code>。</p><pre class="kk kl km kn gu mt mu mv bn mw mx bi"><span id="b3db" class="my lb iu mu b be mz na l nb nc">def create_pipe(clf):<br/>    '''Create a pipeline for a given classifier.  <br/>       The classifier needs to be an instance<br/>       of the classifier with all parameters needed specified.'''<br/><br/>    # Each pipeline uses the same column transformer.  <br/>    column_trans = make_coltrans()<br/><br/>    pipeline = Pipeline([('prep',column_trans),<br/>                         ('clf', clf)])<br/><br/>    return pipeline</span></pre><h1 id="a8f6" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">创建和拟合模型</h1><p id="c6b9" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">最后，我们可以创建分类器的实例，并将其传递给上面创建管道的函数。</p><pre class="kk kl km kn gu mt mu mv bn mw mx bi"><span id="48a6" class="my lb iu mu b be mz na l nb nc"># Create the classifier instance and build the pipeline.<br/>clf = RandomForestClassifier(random_state=42, class_weight='balanced')<br/>pipeline = create_pipe(clf)<br/><br/># Fit the model to the training data<br/>pipeline.fit(X_train, y_train)</span></pre><h1 id="cd17" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">摘要</h1><p id="fc79" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">上面演示了设置管道的简单性。第一次这样做时，与独立完成每一步相比，可能会有些困惑。好处是，每当您想要将它应用到一个新模型，或者更好的是，针对您的fit模型运行新数据时，所有的数据转换都会自动发生。</p><p id="06ee" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">如果你喜欢阅读这样的故事，并想支持我成为一名作家，可以考虑报名成为一名媒体成员。一个月5美元，让你可以无限制地访问成千上万篇文章。如果你使用<a class="ae kz" href="https://medium.com/@broepke/membership" rel="noopener">我的链接</a>注册，我会赚一小笔佣金，不需要你额外付费。</p></div></div>    
</body>
</html>