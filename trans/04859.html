<html>
<head>
<title>What is Dask and How Does it Work?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是Dask，它是如何工作的？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/what-is-dask-and-how-does-it-work-aa99770a31cf?source=collection_archive---------29-----------------------#2021-04-27">https://towardsdatascience.com/what-is-dask-and-how-does-it-work-aa99770a31cf?source=collection_archive---------29-----------------------#2021-04-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div class="gh gi io"><img src="../Images/7fa68dc9c5c1b0686736a38e9f6a7358.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*w5ymtkHv5G6ijnBpdhwXHg.jpeg"/></div><p class="iv iw gj gh gi ix iy bd b be z dk translated">作者原创作品</p></figure><div class=""/><div class=""><h2 id="b332" class="pw-subtitle-paragraph jy ja jb bd b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dk translated">Dask是一个开源的Python库，它可以让你在任意大的数据集上工作，并显著提高你的计算速度。</h2></div><p id="3dae" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">本文将首先说明Dask的特殊之处，然后更详细地解释Dask是如何工作的。那么:是什么让达斯克与众不同？</p><ul class=""><li id="bdd8" class="lm ln jb ks b kt ku kw kx kz lo ld lp lh lq ll lr ls lt lu bi translated">熟悉的界面</li><li id="6912" class="lm ln jb ks b kt lv kw lw kz lx ld ly lh lz ll lr ls lt lu bi translated">需要时的灵活性</li><li id="302d" class="lm ln jb ks b kt lv kw lw kz lx ld ly lh lz ll lr ls lt lu bi translated">Python一直往下</li></ul><h1 id="ebb9" class="ma mb jb bd mc md me mf mg mh mi mj mk kh ml ki mm kk mn kl mo kn mp ko mq mr bi translated">熟悉的界面</h1><p id="aea5" class="pw-post-body-paragraph kq kr jb ks b kt ms kc kv kw mt kf ky kz mu lb lc ld mv lf lg lh mw lj lk ll ij bi translated"><em class="mx">达斯克没有多此一举。</em></p><p id="de4a" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">Python拥有丰富的数据科学库生态系统，包括数组的numpy、数据帧的pandas、nd-data的xarray和机器学习的scikit-learn。Dask匹配那些库。</p><p id="2021" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">这意味着:</p><ul class=""><li id="91ce" class="lm ln jb ks b kt ku kw kx kz lo ld lp lh lq ll lr ls lt lu bi translated">你不必学习一组新的参数来传递给<code class="fe my mz na nb b">read_csv</code></li><li id="1758" class="lm ln jb ks b kt lv kw lw kz lx ld ly lh lz ll lr ls lt lu bi translated">开始使用Dask时，您不必进行大规模的代码重组。</li></ul><h1 id="4f1f" class="ma mb jb bd mc md me mf mg mh mi mj mk kh ml ki mm kk mn kl mo kn mp ko mq mr bi translated">需要时的灵活性</h1><p id="1c59" class="pw-post-body-paragraph kq kr jb ks b kt ms kc kv kw mt kf ky kz mu lb lc ld mv lf lg lh mw lj lk ll ij bi translated">有时，您的数据不能整齐地放入数据帧或数组中。或者可能你已经写了一整段管道，你只是想让它更快。这就是<code class="fe my mz na nb b">dask.delayed</code>的作用。用<code class="fe my mz na nb b">dask.delayed</code>装饰器包装任何函数，它将并行运行。</p><h1 id="97f2" class="ma mb jb bd mc md me mf mg mh mi mj mk kh ml ki mm kk mn kl mo kn mp ko mq mr bi translated">Python一直往下</h1><p id="5310" class="pw-post-body-paragraph kq kr jb ks b kt ms kc kv kw mt kf ky kz mu lb lc ld mv lf lg lh mw lj lk ll ij bi translated">这个很简单。Dask是用Python写的，为想用Python写和用Python排错的人运行Python。</p><h1 id="5508" class="ma mb jb bd mc md me mf mg mh mi mj mk kh ml ki mm kk mn kl mo kn mp ko mq mr bi translated">它是如何工作的？</h1><p id="5737" class="pw-post-body-paragraph kq kr jb ks b kt ms kc kv kw mt kf ky kz mu lb lc ld mv lf lg lh mw lj lk ll ij bi translated">有三个主要部分组合在一起，让Dask以最少的工作量有效地运行分布式代码。</p><ul class=""><li id="a956" class="lm ln jb ks b kt ku kw kx kz lo ld lp lh lq ll lr ls lt lu bi translated">逐块算法在数据碎片上并行运行</li><li id="39bc" class="lm ln jb ks b kt lv kw lw kz lx ld ly lh lz ll lr ls lt lu bi translated">任务图组织任务并实现优化</li><li id="e99f" class="lm ln jb ks b kt lv kw lw kz lx ld ly lh lz ll lr ls lt lu bi translated">调度器决定潜在的多节点集群中的哪个工作者获得哪个任务。</li></ul><h1 id="89d9" class="ma mb jb bd mc md me mf mg mh mi mj mk kh ml ki mm kk mn kl mo kn mp ko mq mr bi translated">分块算法</h1><p id="9319" class="pw-post-body-paragraph kq kr jb ks b kt ms kc kv kw mt kf ky kz mu lb lc ld mv lf lg lh mw lj lk ll ij bi translated">Dask数组可能看起来像numpy，Dask数据帧可能看起来像熊猫，但是每个方法的实际实现都被重写以并行工作。这意味着:</p><ul class=""><li id="5326" class="lm ln jb ks b kt ku kw kx kz lo ld lp lh lq ll lr ls lt lu bi translated">您的数据不一定要放入内存。</li><li id="1897" class="lm ln jb ks b kt lv kw lw kz lx ld ly lh lz ll lr ls lt lu bi translated">你可以同时操作它的不同部分——这样更快。</li></ul><h1 id="2c69" class="ma mb jb bd mc md me mf mg mh mi mj mk kh ml ki mm kk mn kl mo kn mp ko mq mr bi translated">它是如何工作的</h1><p id="8e7a" class="pw-post-body-paragraph kq kr jb ks b kt ms kc kv kw mt kf ky kz mu lb lc ld mv lf lg lh mw lj lk ll ij bi translated">在内部，Dask数组是一组特定模式的numpy数组。Dask实现了分块操作，因此Dask可以单独处理每个数据块，然后将结果组合起来。</p><p id="5d91" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">让我们考虑一个4x4的数组，从1到16，分成4个2x2的块。</p><p id="c8ed" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">当您获取数组的总和(<code class="fe my mz na nb b">a.sum()</code>)时，Dask首先获取每个块的总和，只有在每个块都完成之后，才获取每个块的结果总和。</p><figure class="nd ne nf ng gt is gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nc"><img src="../Images/4644d68bdb20ec2dc29e574fd6632dd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NtYP_zYS2SWKbRuB.jpg"/></div></div><p class="iv iw gj gh gi ix iy bd b be z dk translated">从区块到组合再到聚合的数据聚合的表示</p></figure><p id="e2bd" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">通过让每个工人分别做一道算术题，然后最后合并，Dask的运算速度比只有一个工人独自完成的情况快了大约4倍。</p><h1 id="40aa" class="ma mb jb bd mc md me mf mg mh mi mj mk kh ml ki mm kk mn kl mo kn mp ko mq mr bi translated">任务图</h1><p id="4e3c" class="pw-post-body-paragraph kq kr jb ks b kt ms kc kv kw mt kf ky kz mu lb lc ld mv lf lg lh mw lj lk ll ij bi translated">除非你告诉它，否则Dask不会做任何事情——它很懒。</p><p id="6d49" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">当你在一个Dask对象上调用方法——比如<code class="fe my mz na nb b">a.sum()</code>——时，Dask所做的只是构造一个图。调用<code class="fe my mz na nb b">.compute()</code>使Dask开始处理图表。</p><p id="04a9" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">等到你真正需要答案的时候，Dask就有机会优化图表。所以Dask只需要读取需要的数据就可以得到你想要的结果。由于懒惰，达斯克做的工作越来越少！这通常比Dask必须在调用原始函数时进行所有计算要快。</p><h1 id="e94a" class="ma mb jb bd mc md me mf mg mh mi mj mk kh ml ki mm kk mn kl mo kn mp ko mq mr bi translated">它是如何工作的</h1><p id="f2b8" class="pw-post-body-paragraph kq kr jb ks b kt ms kc kv kw mt kf ky kz mu lb lc ld mv lf lg lh mw lj lk ll ij bi translated">每个块上的每个操作都表示为一个任务。这些任务连接在一起形成一个图表，这样每个任务在运行之前都知道必须发生什么。</p><p id="52a7" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">这是上面描述的<code class="fe my mz na nb b">a.sum()</code>操作的任务图。</p><figure class="nd ne nf ng gt is gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/35a37bccb83438cb62b3fe929a55948c.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/0*l1Ha8RDlaXTNdz5w.png"/></div><p class="iv iw gj gh gi ix iy bd b be z dk translated">使用` a.sum()用graphviz创建的任务图形绘制。visualize()`</p></figure><p id="bf3e" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">Dask通过向图中添加层来将操作串在一起。该图被表示为一个类似dict的对象，其中每个节点包含一个到其依赖项的链接。</p><p id="fbc6" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">在计算图表之前，有一个优化步骤，可以将许多任务合并成一个任务(<code class="fe my mz na nb b">fuse</code>，丢弃不再需要的任务(<code class="fe my mz na nb b">cull</code>)。您甚至可以定义自己的自定义优化。</p><h1 id="8d00" class="ma mb jb bd mc md me mf mg mh mi mj mk kh ml ki mm kk mn kl mo kn mp ko mq mr bi translated">调度程序决定谁得到什么</h1><blockquote class="nm nn no"><p id="6418" class="kq kr mx ks b kt ku kc kv kw kx kf ky np la lb lc nq le lf lg nr li lj lk ll ij bi translated"><em class="jb">按需分配……—卡尔·马克思</em></p></blockquote><p id="66b1" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">触发任务图上的计算告诉Dask将图发送给调度器。在那里，每个任务被分配给一个工人。根据您的设置，您的个人电脑上可能有4名员工，或者您的HPC系统或云上可能有40名员工。调度程序试图最小化数据传输，最大化每个工作人员的利用率。</p><p id="a4f8" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">这是调度程序(这里显示为紫色)向每个工人(显示为橙色和黄色)发送<code class="fe my mz na nb b">a.sum()</code>操作的样子。</p><figure class="nd ne nf ng gt is gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ns"><img src="../Images/73767a5b9907a6105d3e988f37784680.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rplJPCnheIhJlKjU.gif"/></div></div><p class="iv iw gj gh gi ix iy bd b be z dk translated">dask dashboard中的集群图—在4个工作集群上运行“a.sum()”。</p></figure><p id="f8d4" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">由于有4个工人，每个块上的<code class="fe my mz na nb b">sum</code>并行发生。这是最终让Dask如此快速的原因。每个工作人员每次只需要接收一小部分数据，并且可以在其他工作人员处理其他数据时对其进行操作。</p><p id="302e" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">至关重要的是，这意味着任何一个工作线程都不会读取整个数据集。因此，您的数据可以任意大，但仍有可能使用它。</p><h1 id="6de0" class="ma mb jb bd mc md me mf mg mh mi mj mk kh ml ki mm kk mn kl mo kn mp ko mq mr bi translated">结论</h1><p id="3e08" class="pw-post-body-paragraph kq kr jb ks b kt ms kc kv kw mt kf ky kz mu lb lc ld mv lf lg lh mw lj lk ll ij bi translated">有时你的数据是一个合理的大小，你可以愉快地使用普通的numpy和pandas。其他时候不是，你也不能。这就是达斯克的用武之地。</p><p id="5066" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">在dask.org了解更多信息。</p><p id="e3bf" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><em class="mx">免责声明:我在</em> <a class="ae nt" href="https://www.saturncloud.io/s/freehosted/?utm_source=julia%20dask%20blog&amp;utm_medium=try%20saturn" rel="noopener ugc nofollow" target="_blank"> <em class="mx">土星云</em> </a> <em class="mx">工作，为Dask的维护做贡献。其他公司也参与维护Dask，包括Anaconda、Capital One、Coiled、Nvidia、Prefect和Quansight。</em></p></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="b816" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><em class="mx">原载于2021年4月27日</em><a class="ae nt" href="https://www.saturncloud.io/blog/what-is-dask/" rel="noopener ugc nofollow" target="_blank"><em class="mx">https://www . Saturn cloud . io</em></a><em class="mx">。</em></p></div></div>    
</body>
</html>