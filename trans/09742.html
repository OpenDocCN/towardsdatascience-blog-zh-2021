<html>
<head>
<title>How to add git hooks for your python projects using the pre-commit framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用预提交框架为您的python项目添加git挂钩</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-add-git-hooks-for-your-python-projects-using-the-pre-commit-framework-773acc3b28a7?source=collection_archive---------8-----------------------#2021-09-12">https://towardsdatascience.com/how-to-add-git-hooks-for-your-python-projects-using-the-pre-commit-framework-773acc3b28a7?source=collection_archive---------8-----------------------#2021-09-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/d0770f79ae8441a079546e0282f263cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JNXG7niZ6gJp7QyilGIm6w.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">PC:维基媒体(【https://commons.wikimedia.org/wiki/File:Fish-hook.JPG】T2</p></figure><h2 id="8924" class="kg kh it bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">为什么我们需要饭桶挂钩？</h2><p id="ab97" class="pw-post-body-paragraph lc ld it le b lf lg lh li lj lk ll lm kp ln lo lp kt lq lr ls kx lt lu lv lw im bi translated">作为开发人员，我们需要确保我们正在编写的程序的可读性、可写性和可靠性。如果我们采取git repo，多个贡献者每天编写或修改数百行代码，新的贡献者进来，很少人出去。所以为了使代码库一致，我们必须遵循一定的标准。例如，某些代码格式样式(黑色)或林挺样式(flake8)等。通常，这些健全性检查发生在提交(提交)代码以供审查之前，也可能有提交之后需要完成的操作，比如维护内部日志。</p><p id="6677" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">在深潜之前，让我告诉你我们今天要看什么，</p><ol class=""><li id="2e26" class="mc md it le b lf lx lj ly kp me kt mf kx mg lw mh mi mj mk bi translated">什么是Git钩子？</li><li id="a009" class="mc md it le b lf ml lj mm kp mn kt mo kx mp lw mh mi mj mk bi translated">什么是预提交框架？</li><li id="75d5" class="mc md it le b lf ml lj mm kp mn kt mo kx mp lw mh mi mj mk bi translated">如何在python项目中使用预提交框架？</li></ol></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h2 id="2f26" class="kg kh it bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">什么是Git钩子？</h2><p id="e1da" class="pw-post-body-paragraph lc ld it le b lf lg lh li lj lk ll lm kp ln lo lp kt lq lr ls kx lt lu lv lw im bi translated">正如我在上面提到的，当开发工作流中发生事件时，我们需要执行某些动作(任务)，这就是所谓的钩子。</p><p id="282e" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated"><em class="mx"> Git挂钩是每当Git存储库中发生特定事件时自动运行的脚本。</em></p><p id="c62a" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">例如，在每次提交之前运行黑色格式化和薄片8林挺。实际上，我们可以在git事件的不同阶段添加钩子。</p><ul class=""><li id="e306" class="mc md it le b lf lx lj ly kp me kt mf kx mg lw my mi mj mk bi translated">预提交:-在提交前运行特定的钩子，如果失败，则中止提交</li><li id="d4f0" class="mc md it le b lf ml lj mm kp mn kt mo kx mp lw my mi mj mk bi translated">预合并-提交:-在合并前运行某个钩子，如果失败，中止合并</li><li id="cc55" class="mc md it le b lf ml lj mm kp mn kt mo kx mp lw my mi mj mk bi translated">预推送:-在推送至远程存储库之前运行某个挂钩，如果失败，则中止推送</li><li id="3a88" class="mc md it le b lf ml lj mm kp mn kt mo kx mp lw my mi mj mk bi translated">提交后:-在成功提交后立即运行钩子</li><li id="2ca9" class="mc md it le b lf ml lj mm kp mn kt mo kx mp lw my mi mj mk bi translated">结帐后:-从一个分支结帐后立即运行挂钩</li><li id="39a6" class="mc md it le b lf ml lj mm kp mn kt mo kx mp lw my mi mj mk bi translated">合并后:-在成功合并后立即运行挂钩</li><li id="1960" class="mc md it le b lf ml lj mm kp mn kt mo kx mp lw my mi mj mk bi translated">等等</li></ul><p id="0f0b" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">当我们做<code class="fe mz na nb nc b">git init</code>时，它将最常用的git钩子添加到<code class="fe mz na nb nc b">.git/hooks/</code>，<a class="ae kf" href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks" rel="noopener ugc nofollow" target="_blank">中，我们可以使用最常用的脚本语言编写自己的钩子。</a>但今天我们将看到一个旨在简化这一过程的框架。</p><h2 id="6805" class="kg kh it bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">什么是预提交框架？</h2><p id="ce4e" class="pw-post-body-paragraph lc ld it le b lf lg lh li lj lk ll lm kp ln lo lp kt lq lr ls kx lt lu lv lw im bi translated">这是一个管理和维护多语言git挂钩的框架。你可能会有一个问题，为什么我们需要一个钩子的框架。</p><p id="2e86" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">随着我们创建更多的库和项目，我们可能会发现跨项目共享我们的预提交钩子是痛苦的。我们不得不从一个项目到另一个项目复制和粘贴笨拙的bash脚本，并且不得不手动改变钩子以适应不同的项目结构。有时我们需要的一些好的linters或其他测试工具，可能不是用我们项目中使用的语言编写的。</p><p id="280f" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">预提交是一个用于预提交挂钩的多语言包管理器。我们可以简单地指定我们想要的钩子列表，预提交管理任何用任何语言编写的钩子的安装和执行，而不需要任何root权限。</p><h2 id="5209" class="kg kh it bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">如何在python项目中使用预提交框架？</h2><ol class=""><li id="71bf" class="mc md it le b lf lg lj lk kp nd kt ne kx nf lw mh mi mj mk bi translated">安装提交前框架</li></ol><pre class="ng nh ni nj gt nk nc nl nm aw nn bi"><span id="d1c1" class="kg kh it nc b gy no np l nq nr">pip install pre-commit</span><span id="b2b5" class="kg kh it nc b gy ns np l nq nr">or</span><span id="7e80" class="kg kh it nc b gy ns np l nq nr">conda install -c conda-forge pre-commit</span></pre><p id="3936" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">将<code class="fe mz na nb nc b">.pre-commit-config.yaml</code>添加到项目的根文件夹中。在这个例子中，我将展示如何为每次提交和推送添加黑色格式和林挺。</p><figure class="ng nh ni nj gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="cbc3" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">让我们在这里分解每个组件，</p><ul class=""><li id="5ecb" class="mc md it le b lf lx lj ly kp me kt mf kx mg lw my mi mj mk bi translated">default_stages:-钩子的stages属性的配置级默认值。这只会覆盖不设置阶段的单个挂钩。</li><li id="0884" class="mc md it le b lf ml lj mm kp mn kt mo kx mp lw my mi mj mk bi translated">default_language_version:-如果没有为各个挂钩设置language_version，则应该使用的默认语言版本。</li><li id="3bc4" class="mc md it le b lf ml lj mm kp mn kt mo kx mp lw my mi mj mk bi translated">仓库:-仓库映射列表</li><li id="28d0" class="mc md it le b lf ml lj mm kp mn kt mo kx mp lw my mi mj mk bi translated">repo:-git clone的存储库URL，钩子的代码将从这里获取。</li><li id="13d8" class="mc md it le b lf ml lj mm kp mn kt mo kx mp lw my mi mj mk bi translated">版本:-需要使用哪个版本的回购(标签)</li><li id="9296" class="mc md it le b lf ml lj mm kp mn kt mo kx mp lw my mi mj mk bi translated">钩子:-钩子映射的列表，钩子映射允许用户从repo中选择需要使用哪个钩子，并允许定制。</li><li id="a389" class="mc md it le b lf ml lj mm kp mn kt mo kx mp lw my mi mj mk bi translated">id:回购中的挂钩名称。</li><li id="2dbe" class="mc md it le b lf ml lj mm kp mn kt mo kx mp lw my mi mj mk bi translated">args:需要为该钩子传递命令行参数。</li><li id="9c0a" class="mc md it le b lf ml lj mm kp mn kt mo kx mp lw my mi mj mk bi translated">exclude:- regex表示要为该挂钩排除的文件/文件夹名称。</li><li id="1f09" class="mc md it le b lf ml lj mm kp mn kt mo kx mp lw my mi mj mk bi translated">类型:-该钩子要考虑的文件类型。</li></ul><p id="3e8d" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated"><a class="ae kf" href="https://pre-commit.com/#pre-commit-configyaml---repos" rel="noopener ugc nofollow" target="_blank">还有很多组件，可以自定义钩子。</a></p><p id="cecf" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">2.添加配置文件后，运行下面的命令来安装钩子</p><pre class="ng nh ni nj gt nk nc nl nm aw nn bi"><span id="d342" class="kg kh it nc b gy no np l nq nr">pre-commit install --hook-type pre-commit hook-type pre-post</span></pre><p id="ac2b" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">这将安装应该在提交和推送之前运行的挂钩。</p><p id="cf4f" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">3.修改项目中的任何文件，并尝试提交它们</p><figure class="ng nh ni nj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/9ffcb8561ee84729937997eb3e0fe9c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GkdqbIm4XBnXvyDGU5jO8g.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">失败的预提交(PC:作者)</p></figure><p id="b472" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">这里，由于一些代码重新格式化和lint错误，我的钩子失败了。注意，如果任何挂钩失败，那么提交将被中止。解决问题并重新提交。</p><figure class="ng nh ni nj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nw"><img src="../Images/3206fe3fe82b63853ddf3a5ef2ebbeb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2lOD_nSHd-IuHGXXxkZXnQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">成功的预提交(PC:作者)</p></figure><p id="ff44" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">如果您已经配置了任何预推挂钩，这将是相同的。</p><figure class="ng nh ni nj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nx"><img src="../Images/40f88f94dfa3c7c88a5484e5017b70ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1EK4mFWZQungS4lFU1SuZA.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">成功的预推送(PC:作者)</p></figure><p id="abba" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">你可以在这里找到完整的源代码，<a class="ae kf" href="https://github.com/Mathanraj-Sharma/python_boilerplate" rel="noopener ugc nofollow" target="_blank">https://github.com/Mathanraj-Sharma/python_boilerplate</a></p><p id="10a6" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">总之，git钩子就是我们希望在git事件发生时触发的任何脚本。它有助于自动化重复性工作，以保持所编写代码的一致性。在早期阶段，它可能看起来不太有效，但是随着项目的增长和更多贡献者的加入，我们可以感受到git挂钩的好处。</p><p id="1b5c" class="pw-post-body-paragraph lc ld it le b lf lx lh li lj ly ll lm kp lz lo lp kt ma lr ls kx mb lu lv lw im bi translated">编码快乐！！！</p></div></div>    
</body>
</html>