<html>
<head>
<title>Deploying AWS Lamba Function &amp; Layer with Serverless Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用无服务器框架部署AWS Lamba功能和层</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploying-aws-lamba-function-layer-with-serverless-framework-f3f4fab1b7e9?source=collection_archive---------5-----------------------#2021-07-26">https://towardsdatascience.com/deploying-aws-lamba-function-layer-with-serverless-framework-f3f4fab1b7e9?source=collection_archive---------5-----------------------#2021-07-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2fc4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于在AWS Lambda层上安装依赖项并从通过无服务器框架开发和部署的AWS Lambda功能扩展它们的教程。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cd9759089eaec8bafc783413ddc550b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s_CHti-J1FsdcPA51xUUQQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图一。AWS Lambda、API网关、无服务器框架|作者图片</p></figure><p id="e51a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">无服务器环境已经成为在云实例中部署应用程序的一种破坏性替代方案，无需配置、管理、操作和维护<em class="lu">传统服务器。</em></p><p id="7908" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本教程中，我们将看到一个关于如何开发、配置、集成和部署Lambda函数[ <a class="ae lv" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> 1 </a> ]的示例，该函数通过无服务器框架[ <a class="ae lv" href="https://www.serverless.com/" rel="noopener ugc nofollow" target="_blank"> 3 </a> ]扩展Lambda层[ <a class="ae lv" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html" rel="noopener ugc nofollow" target="_blank"> 2 </a> ]的功能。</p><p id="ef9b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本博客将分为以下几个部分:</p><ul class=""><li id="da81" class="lw lx it la b lb lc le lf lh ly ll lz lp ma lt mb mc md me bi translated"><strong class="la iu"> AWS Lambda功能&amp;层</strong></li><li id="b675" class="lw lx it la b lb mf le mg lh mh ll mi lp mj lt mb mc md me bi translated"><strong class="la iu">无服务器框架</strong></li><li id="b700" class="lw lx it la b lb mf le mg lh mh ll mi lp mj lt mb mc md me bi translated"><strong class="la iu">我们要做什么</strong></li><li id="fc62" class="lw lx it la b lb mf le mg lh mh ll mi lp mj lt mb mc md me bi translated"><strong class="la iu">安装无服务器框架</strong></li><li id="ff47" class="lw lx it la b lb mf le mg lh mh ll mi lp mj lt mb mc md me bi translated"><strong class="la iu">部署AWS Lambda层</strong></li><li id="8e5e" class="lw lx it la b lb mf le mg lh mh ll mi lp mj lt mb mc md me bi translated"><strong class="la iu">部署AWS Lambda功能</strong></li></ul><p id="82f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您已经熟悉AWS Lambda和无服务器框架，可以跳过接下来的两节，直接看例子。</p><p id="974b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们喝杯咖啡，享受☕️吧！</p><h1 id="2537" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">AWS Lambda函数和层</h1><p id="fb46" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">AWS Lambda是一种计算服务，允许您在不需要配置和管理服务器的情况下运行代码。要使用AWS Lambda，您只需要打包您的代码以及您将需要的依赖项(作为一个<code class="fe nh ni nj nk b">.zip</code>文件或一个<code class="fe nh ni nj nk b">docker image</code>)并将它们组织在一个Lambda函数中。</p><p id="6a8d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在图2中，我们看到了Lambda函数中元素组织的典型描述。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/6dcc41fea17e1f328547dd695652dd27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-r95lmGS52u7_NUOB9S96g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图二。Lambda函数|作者图片</p></figure><p id="9ae2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如上图所示，每个Lambda函数都是一个独立的环境，也就是说，本质上它们不能直接与另一个Lambda函数共享或扩展功能。而这也是Lambda Layer出现的原因之一。</p><p id="042b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Lambda Layer是一个AWS Lambda扩展，可以直接使用Lambda函数。Lambda层的目标是包含应用程序、需求、依赖项，甚至可以从Lambda函数扩展的自定义运行时组件。</p><p id="feb5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在图3中，我们看到了一个Lambda层与一对Lambda函数集成的描述。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/8e32be5c61327c09b7cbfe3b471f9689.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u1e5eHbOL5ai5cM1Y_ruUg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3。Lambda图层和功能|作者图片</p></figure><p id="b62c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如我们从上图中看到的，Lambda层的实现有利于通过Lambda函数共享和扩展的组件的组织。此外，Lambda层的使用有助于减少Lambda函数的大小，因为不必多次打包依赖项(如图2所示)。</p><p id="c114" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，在实践中，定义和配置一个或多个Lambda功能，以及与一个或多个Lambda层集成，可能是一个费力而乏味的过程，因为AWS Lambda通常与不同的服务集成，如亚马逊API Gateway、亚马逊S3、亚马逊SQS、亚马逊SNS等等。这就是<code class="fe nh ni nj nk b">Serverless Framework</code>占据中心舞台的地方。</p><h1 id="dced" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">无服务器框架</h1><p id="3b12" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">无服务器框架是一个工具，它简化了AWS Lambda的定义和配置，以及与其他AWS服务的集成。简而言之，无服务器框架简化了AWS Lambda的开发、集成和部署过程。</p><p id="c2b7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Serverless是一个与云无关的框架，也就是说，它允许通过定义一个<code class="fe nh ni nj nk b">YAML</code>文件和使用CLI来为不同的云提供商(如AWS、Azure、Google Cloud、Knative等)开发和部署服务。</p><p id="fec6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦我们明确了AWS Lambda Function &amp; Layer之间的关系以及无服务器框架在云服务开发和部署中的相关性，让我们直接进入教程。</p><p id="cbf3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">别忘了倒满你的咖啡，☕️！</p><h1 id="1320" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">我们要做什么</h1><p id="6f6b" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">我们将创建一个Lambda函数和一个Lambda层。Lambda层将只包含numpy库。lambda函数将从Lambda层扩展numpy库，并在其main方法中实现它。整个开发和部署过程将通过无服务器框架。</p><p id="bf9d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦定义了上下文，我们就开始吧！</p><h1 id="aad2" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">安装无服务器框架</h1><p id="552c" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">要安装无服务器，我们首先需要有<code class="fe nh ni nj nk b">node.js</code>。要在macOS上安装<code class="fe nh ni nj nk b">node.js</code>:</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="6fa3" class="nr ml it nk b gy ns nt l nu nv">$ brew install node</span></pre><p id="c3de" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">用于在Ubuntu上安装<code class="fe nh ni nj nk b">node.js</code>:</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="8e41" class="nr ml it nk b gy ns nt l nu nv">$ sudo apt install nodejs<br/>$ sudo apt install npm</span></pre><p id="2544" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">或者如果你愿意，可以直接去<a class="ae lv" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank">官方节点站点</a>下载。一旦安装了<code class="fe nh ni nj nk b">node.js</code>并且启用了<code class="fe nh ni nj nk b">npm</code>管理器，我们就开始安装无服务器:</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="eafe" class="nr ml it nk b gy ns nt l nu nv">$ npm install -g serverless</span></pre><p id="c0f2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您对通过<code class="fe nh ni nj nk b">npm</code>管理器进行的安装有任何问题，您可以遵循官方的<a class="ae lv" href="https://www.serverless.com/framework/docs/getting-started/" rel="noopener ugc nofollow" target="_blank">无服务器安装指南</a>来安装独立的二进制文件。</p><p id="7bae" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于我们将在本例中开发并部署到AWS，您需要添加AWS帐户的凭证，如下所示:</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="e5b6" class="nr ml it nk b gy ns nt l nu nv">$ serverless config credentials --provider aws \<br/>                                --key &lt;access_key&gt; \<br/>                                --secret &lt;secret_key&gt;</span></pre><p id="6aca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦安装了无服务器并配置了凭证，我们就可以开始有趣的部分了，让我们开始吧！</p><h1 id="10ec" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">部署AWS Lambda层</h1><p id="47a0" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">首先，让我们用<code class="fe nh ni nj nk b">serverless</code> CLI为我们的Lambda层创建一个模板，我们称之为<code class="fe nh ni nj nk b">lambda-layer</code>。</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="830f" class="nr ml it nk b gy ns nt l nu nv">(venv) $ serverless create --template aws-python3 \<br/>                           --name layer-numpy \<br/>                           --path layer-numpy</span></pre><p id="5370" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面的命令将生成一个名为<code class="fe nh ni nj nk b">lambda-layer</code>的目录，其中包含<code class="fe nh ni nj nk b">handler.py</code>和<code class="fe nh ni nj nk b">serverless.yml</code>文件。</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="1c71" class="nr ml it nk b gy ns nt l nu nv">(venv) $ tree<br/>.<br/>└── layer-numpy<br/>    ├── handler.py<br/>    └── serverless.yml</span></pre><p id="a183" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本质上，<code class="fe nh ni nj nk b">handler.py</code>文件包含了将在AWS Lambda上运行的代码。<code class="fe nh ni nj nk b">serverless.yml</code>文件包含Lambda函数或层的定义，以及部署服务所需的所有配置。</p><p id="2c5d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">神经衰弱，因为在这种情况下我们想要部署一个只包含一个库的Lambda层，所以<code class="fe nh ni nj nk b">handler.py</code>文件是不必要的。相反，我们需要的文件是<code class="fe nh ni nj nk b">requirements.txt</code>，它将包含Lambda层将托管的库。</p><p id="45da" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，删除<code class="fe nh ni nj nk b">handler.py</code>文件并添加<code class="fe nh ni nj nk b">requirements.txt</code>文件，我们的目录如下所示:</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="c276" class="nr ml it nk b gy ns nt l nu nv">(venv) $ tree<br/>.<br/>└── layer-numpy<br/>    ├── requirements.txt<br/>    └── serverless.yml</span></pre><p id="a123" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">其中<code class="fe nh ni nj nk b">requirements.txt</code>文件仅包含对<code class="fe nh ni nj nk b">numpy</code>库的引用:</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="b4ef" class="nr ml it nk b gy ns nt l nu nv">(venv) $ cat requirements.txt <br/>numpy==1.21.0</span></pre><p id="d013" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了通过<code class="fe nh ni nj nk b">serverless</code>部署<code class="fe nh ni nj nk b">requirements.txt</code>文件的内容，我们将需要<code class="fe nh ni nj nk b">serverless-python-requirements</code>插件，该插件允许<code class="fe nh ni nj nk b">serverless</code>访问<code class="fe nh ni nj nk b">requirements.txt</code>文件的内容并为部署做准备。</p><p id="1254" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要安装<code class="fe nh ni nj nk b">serverless-python-requirements</code>插件，我们键入:</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="d540" class="nr ml it nk b gy ns nt l nu nv">(venv) $ sls plugin install -n serverless-python-requirements</span></pre><p id="9dec" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">安装插件时，通过添加已安装插件的定义来更新<code class="fe nh ni nj nk b">serverless.yml</code>文件。我们的<code class="fe nh ni nj nk b">serverless.yml</code>的默认内容如下面的代码片段所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码片段1。serverless.yml |默认版本</p></figure><p id="82e2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如我们所看到的，在第10行中，我们有一个默认创建的Lambda函数的定义，但是对于Lambda层部署，我们不需要它。另一方面，在第14行中，我们引用了上一步中安装的插件。</p><p id="cfae" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们的<code class="fe nh ni nj nk b">serverless.yml</code>文件，在为我们的Lambda层的部署做了修改之后，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码片段2。serverless.yml |准备部署</p></figure><p id="c5b4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如我们所看到的，从第13行开始我们的Lambda层的定义，它是类型<code class="fe nh ni nj nk b">pythonRequirements</code>，其内容将是<code class="fe nh ni nj nk b">dockerized</code>。我们的Lambda层被称为<code class="fe nh ni nj nk b">python-numpy</code>，与<code class="fe nh ni nj nk b">python 3.8</code>运行时兼容。</p><p id="a95a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">值得一提的是，因为我们启用了需求的<code class="fe nh ni nj nk b">dockerization</code>，所以有必要将<code class="fe nh ni nj nk b">docker</code>安装在我们的本地机器上，从这里我们将执行部署。</p><p id="c9f7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">很好，一旦我们有了<code class="fe nh ni nj nk b">requirements.txt</code>文件，定制了<code class="fe nh ni nj nk b">serverless.yml</code>文件并安装了<code class="fe nh ni nj nk b">plugin</code>，我们就可以开始部署了。对于部署，我们仅键入:</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="3c6a" class="nr ml it nk b gy ns nt l nu nv">(venv) $ sls deploy</span></pre><p id="30bb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就是这样！我们的Lambda层应该可以从AWS控制台看到，如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/bb03d7ee066cf11526c25bb915a9d707.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YkO-er2BbhlmRtPb9kt9_w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图二。AWS控制台中的Lambda层“python-numpy”|作者图片</p></figure><p id="bee7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦我们的Lambda层被部署，就有必要识别相关的<code class="fe nh ni nj nk b">ARN</code>，因为它需要引用我们的Lambda函数的定义。</p><p id="8298" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">太好了，我们已经部署了我们的Lambda层。现在让我们看看如何部署扩展Lambda层依赖关系的Lambda函数。</p><p id="db7a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们去吧！</p><h1 id="f443" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">部署AWS Lambda函数</h1><p id="498c" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">首先，我们将为我们的Lambda函数生成一个<code class="fe nh ni nj nk b">aws-python3</code>模板，我们将其命名为<code class="fe nh ni nj nk b">test-function</code>。</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="570b" class="nr ml it nk b gy ns nt l nu nv">(venv) $ serverless create --template aws-python3 \<br/>                           --name test-function \<br/>                           --path test-function</span></pre><p id="11cc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上述命令将生成一个名为<code class="fe nh ni nj nk b">test-function</code>的目录，其中包含两个文件<code class="fe nh ni nj nk b">handler.py</code>和<code class="fe nh ni nj nk b">serverless.yml</code>。<code class="fe nh ni nj nk b">handler.py</code>文件将包含AWS Lambda将运行的代码。<code class="fe nh ni nj nk b">serverless.yml</code>文件将包含部署的定义。</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="d785" class="nr ml it nk b gy ns nt l nu nv">(venv) $ tree<br/>.<br/>└── test-function<br/>    ├── handler.py<br/>    └── serverless.yml</span></pre><p id="f2e7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，让我们修改一下<code class="fe nh ni nj nk b">handler.py</code>文件。因为我们假设我们将从上一节创建的Lambda层扩展<code class="fe nh ni nj nk b">numpy</code>库，所以我们在这里要做的就是导入<code class="fe nh ni nj nk b">numpy</code>并声明一些基本功能。最后，我们的<code class="fe nh ni nj nk b">handler.py</code>文件应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码片段3。handler.py |从Lambda层扩展numpy库</p></figure><p id="1512" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们将更新<code class="fe nh ni nj nk b">serverless.yml</code>文件。基本上，我们将定义3个主要的东西:Lambda函数、Lambda层扩展和一个API网关方法(我们将用它来请求我们的Lambda函数)。最后，<code class="fe nh ni nj nk b">serverless.yml</code>文件看起来像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码片段4。从Lamba层扩展numpy的Lambda函数的定义</p></figure><p id="8a68" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在第12行我们定义了函数的名称(<code class="fe nh ni nj nk b">hello</code>)，在第13行我们定义了将从<code class="fe nh ni nj nk b">handler.py</code>文件中执行的方法。在第15行我们定义了Lambda层的扩展(这是我们使用前一节中创建的Lambda层的<code class="fe nh ni nj nk b">ARN</code>的地方)，最后在第19行我们定义了一个<code class="fe nh ni nj nk b">GET</code>方法来请求我们的Lambda函数。</p><p id="8958" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就这样，我们准备好部署了！</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="1ef3" class="nr ml it nk b gy ns nt l nu nv">(venv) $ sls deploy</span></pre><p id="358a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦我们的Lambda函数被部署，我们就可以在AWS控制台中看到它了。在下图中，我们看到了从控制台部署的AWS Lambda函数的特征。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/0da34f44469fb989f1cabdbe38e0c69c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lMfGl450ahlhyGvwq-O59w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3。AWS控制台中的Lambda函数“测试函数”</p></figure><p id="3aa7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如我们所看到的，我们的Lambda函数有一个Lambda层，它有一个API网关作为触发器。</p><p id="6f2b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，为了测试我们的Lambda函数，我们使用如下的<code class="fe nh ni nj nk b">serverless</code> CLI:</p><pre class="kj kk kl km gt nn nk no np aw nq bi"><span id="e65b" class="nr ml it nk b gy ns nt l nu nv">(venv) $ sls invoke -f hello <br/>{<br/>    "statusCode": 200,<br/>    "body": "\"Random number: 17. Numpy version: 1.21.0\""<br/>}</span></pre><p id="9cc6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就是这样！我们的AWS Lambda函数从Lambda层扩展了<code class="fe nh ni nj nk b">numpy</code>库，整个开发和部署过程都是通过无服务器框架完成的。</p><h1 id="fcf0" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">参考</h1><p id="cd10" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">[1] <a class="ae lv" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda功能</a></p><p id="48d9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">[2]<a class="ae lv" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html" rel="noopener ugc nofollow" target="_blank">AWSλ层</a></p><p id="3947" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">[3] <a class="ae lv" href="https://www.serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a></p></div></div>    
</body>
</html>