<html>
<head>
<title>Contingency Tables, Chi-Squared and Cramer’s V</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">列联表、卡方检验和克拉默 V</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/contingency-tables-chi-squared-and-cramers-v-ada4f93ec3fd?source=collection_archive---------1-----------------------#2021-12-02">https://towardsdatascience.com/contingency-tables-chi-squared-and-cramers-v-ada4f93ec3fd?source=collection_archive---------1-----------------------#2021-12-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6001" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><strong class="ak">如何轻松检查类别之间的关联</strong></h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0f67703793c7e0b9339ce563256b50a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JsXCIDbSUgnCSjk10lF5Ew.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="188d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">简介</strong></p><p id="2765" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在最近的一个项目过程中，我不得不检查一个特性与多个其他特性的关联(缺乏独立性)。为了方便起见，我编写了几个函数来执行并帮助解释这些分类特征之间的关联测试。在这篇文章中，我将演示这一过程，并提供代码示例，读者可以使用自己的数据。</p><p id="6996" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">数据</strong></p><p id="09e1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本次演示的数据集是开放大学学习分析数据集。数据集由 7 个 csv 文件组成，包含学生人口统计、评估和注册数据；以及表格形式的课程、课程评估和学习环境数据。我们将查看来自<em class="lr"> </em> studentInfo.csv 文件的两个分类特征，<em class="lr"> final_result </em>和<em class="lr">higher _ education，</em>。本演示假设该数据已经加载到数据帧<em class="lr"> df </em>中。</p><p id="8437" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">测试的特性</strong></p><p id="8789" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="lr"> final_result </em>特征是授予该课程的最终成绩(未通过、退出、通过、优秀)，而<em class="lr"> highest_education </em>是学生完成的最高教育水平。这些(英国)教育资格类别的排名如下(从最低到最高):无正式资格，低于 A 级，A 级，he 资格，研究生资格。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/b3d5b86754b43d2d65e28134b8db427a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EZWoMyAZurlwstYPHSDJgQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="1f6f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从图表中可以看出，较低的教育水平与退缩和失败的结果正相关，而较高的教育水平与通过和优秀正相关。我们想测试和量化这些概念，如果可能的话，使用统计方法。</p><p id="3529" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">列联表</strong></p><p id="859d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将通过使用<a class="ae lt" href="https://pandas.pydata.org/pandas-docs/version/0.23/generated/pandas.crosstab.html" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir">pandas . crosstab</strong></a>为我们的数据创建一个<a class="ae lt" href="https://en.wikipedia.org/wiki/Contingency_table" rel="noopener ugc nofollow" target="_blank">列联表</a>来开始我们的研究，并实例化一个<a class="ae lt" href="https://www.statsmodels.org/stable/contingency_tables.html" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir">stats models . stats . table</strong></a><strong class="kx ir"/>对象来为我们提供查找和显示任何关联的便利方法。Table 类使用<a class="ae lt" href="https://en.wikipedia.org/wiki/Pearson%27s_chi-squared_test" rel="noopener ugc nofollow" target="_blank">皮尔森卡方检验</a>来评估任何关联。</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="f573" class="lz ma iq lv b gy mb mc l md me"># <em class="lr">creating crosstab data frame</em></span><span id="8fb2" class="lz ma iq lv b gy mf mc l md me">tabs = pd.crosstab(df.highest_education, df.final_result)</span><span id="fa53" class="lz ma iq lv b gy mf mc l md me"># creating a statsmodels table object</span><span id="4b6d" class="lz ma iq lv b gy mf mc l md me">table = sm.stats.Table(tabs)</span></pre><p id="b220" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="lr"> table_orig </em>方法<em class="lr">T3】将返回一个原始数据的列联表。列联表中的数字单元格表示相应行和列对的观察次数。</em></p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="4280" class="lz ma iq lv b gy mb mc l md me">table.table_orig</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mg"><img src="../Images/6ba16c28f20e87071aff55a04ab60e47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H3t1-fzRAAOo1k6D7zFZ8w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="a04f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="lr"> fittedvalues </em>方法<em class="lr"> </em>将从数据的最佳拟合独立分布中返回值的列联表。</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="71ec" class="lz ma iq lv b gy mb mc l md me">table.fittedvalues</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mh"><img src="../Images/8b5712098f2eb3b6bb279a3baec9286d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*POLU4kxBk5BiUhu2Ji7GYQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="4d13" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="lr"> resid_pearson </em>方法返回残差表，该表将揭示数据中存在的任何关联。如果要素是独立的，正值表示观察值比预期值多，负值表示观察值少。</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="887a" class="lz ma iq lv b gy mb mc l md me">table.resid_pearson</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0f67703793c7e0b9339ce563256b50a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JsXCIDbSUgnCSjk10lF5Ew.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="866f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从列联表中可以看出，一般来说，成绩和及格与教育水平直接相关。学生的受教育程度越高，就越有可能通过或以优异成绩通过。相反，退缩和失败与教育水平成反比。一般来说，学生的教育水平越低，越有可能失败或退学。</p><p id="041a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们将执行假设检验来验证我们的结果。</p><p id="5d4f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">假设检验</strong></p><p id="7f5d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将使用<a class="ae lt" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.chi2_contingency.html" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir">scipy . stats . chi2 _ contingency</strong></a>测试独立性。与 Table 类类似，chi2_contingency 使用<a class="ae lt" href="https://en.wikipedia.org/wiki/Pearson%27s_chi-squared_test" rel="noopener ugc nofollow" target="_blank">皮尔逊卡方检验</a>来评估数据中的任何关联。</p><p id="941a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们首先定义测试的无效假设和替代假设，并指定显著性水平。</p><p id="0739" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Ho = <em class="lr">最高学历</em>和<em class="lr">最终成绩</em>是独立的。</p><p id="757a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Ha = <em class="lr">最高 _ 学历</em>和<em class="lr">最终 _ 成绩</em>不是独立的。</p><p id="23fc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">显著性水平α= 0.05。</p><p id="8225" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">既然我们已经准备好了，我们就来进行测试。我写了一个小函数，可以很好的打印结果。</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="257c" class="lz ma iq lv b gy mb mc l md me">def chi_sq_test(cross_tabs):<br/>    """<br/>    Prints the Chi-Squared Statistic, p-value, and degress of freedom from a Chi-Squared test.<br/>    <br/>    Args:<br/>        cross_tabs: A crosstab dataframe.<br/>    """<br/>    chi2, p, dof, con_table = stats.chi2_contingency(cross_tabs)<br/>    print(f'chi-squared = {chi2}\np value= {p}\ndegrees of freedom = {dof}')</span></pre><p id="c6b2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">将该函数应用于交叉表数据框会返回:</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="6e95" class="lz ma iq lv b gy mb mc l md me">chi-squared = 962.2117100356752<br/>p value= 2.4827414817328365e-198<br/>degrees of freedom = 12</span></pre><p id="cbc8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">由于返回的 p 值小于我们的 alpha，我们拒绝零假设，并得出结论<em class="lr">最高学历</em>和<em class="lr">最终结果</em>不是独立的，从而证实了我们上面的发现。</p><p id="413c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，我们将检查我们的功能的影响大小。</p><p id="f289" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">效果大小</strong></p><p id="ced2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae lt" href="https://en.wikipedia.org/wiki/Effect_size" rel="noopener ugc nofollow" target="_blank">效果大小</a>是对两个特征之间关联强度的度量。我们将使用我编写的函数来测量影响大小，以计算和显示数据的<a class="ae lt" href="https://en.wikipedia.org/wiki/Cram%C3%A9r%27s_V" rel="noopener ugc nofollow" target="_blank">克莱姆 V </a>值、克莱姆 V 自由度和影响大小<a class="ae lt" href="https://peterstatistics.com/CrashCourse/3-TwoVarUnpair/NomNom/NomNom-2c-Effect-Size.html" rel="noopener ugc nofollow" target="_blank">阈值</a>。</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="0fdd" class="lz ma iq lv b gy mb mc l md me">def cramers_v(cross_tabs):<br/>    """<br/>    Prints the degrees of freedom, effect size thresholds, and Cramer's V value.<br/>    <br/>    Args:<br/>        cross_tabs: A crosstab dataframe.<br/>    """<br/>    <br/>    # <em class="lr">effect size data frame for cramer's v function</em><br/>    data = np.array([[1, .1, .3, .5],<br/>       [2, .07, .21, .35],<br/>       [3, .06, .17, .29],<br/>       [4, .05,.15,.25],<br/>       [5, .04, .13, .22]])<br/>    sizes = pd.DataFrame(data, columns=['Degrees of Freedom', 'Small Effect', 'Medium Effect', 'Large Effect']) <br/>    <br/>    # <em class="lr">getting the chi sq. stat</em><br/>    chi2 = stats.chi2_contingency(cross_tabs)[0]</span><span id="a3bd" class="lz ma iq lv b gy mf mc l md me">    # <em class="lr">calculating the total number of observations</em><br/>    n = cross_tabs.sum().sum()</span><span id="826d" class="lz ma iq lv b gy mf mc l md me">    # <em class="lr">getting the degrees of freedom</em><br/>    dof = min(cross_tabs.shape)-1</span><span id="abc9" class="lz ma iq lv b gy mf mc l md me">    # <em class="lr">calculating cramer's v</em><br/>    v = np.sqrt(chi2/(n*dof))</span><span id="7a08" class="lz ma iq lv b gy mf mc l md me">    # <em class="lr">printing results</em><br/>    print(f'V = {v}')<br/>    print(f'Cramer\'s V Degrees of Freedom = {dof}')<br/>    print(f'\nEffect Size Thresholds\n{sizes}\n')</span></pre><p id="3dd3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">将该函数应用于交叉表数据会返回:</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="4925" class="lz ma iq lv b gy mb mc l md me">V = 0.10148164448653103<br/>Cramer's V Degrees of Freedom = 3<br/><br/>Effect Size Thresholds<br/>   Degrees of Freedom  Small Effect  Medium Effect  Large Effect<br/>0                 1.0          0.10           0.30          0.50<br/>1                 2.0          0.07           0.21          0.35<br/>2                 3.0          0.06           0.17          0.29<br/>3                 4.0          0.05           0.15          0.25<br/>4                 5.0          0.04           0.13          0.22</span></pre><p id="11b7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">根据自由度进行调整后，Cramer 的 V 结果表明<em class="lr">最高教育程度</em>对<em class="lr">最终结果</em>有微小的、统计上显著的影响。</p><p id="1e86" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">结论</strong></p><p id="10b6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">希望这个演示能让我们了解一个简单而强大的例程来检查关联的分类特征。为了您的方便，请随意使用和修改上述功能。特别感谢 Sgr Folge 在我的原始帖子中指出了 Cramer 的 V 代码块中的一个遗漏。</p><p id="cfe2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">来源</strong></p><p id="a06a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">开放大学学习分析数据集。Sci 数据 4，170171(2017)<a class="ae lt" href="https://doi.org/10.1038/sdata.2017.171" rel="noopener ugc nofollow" target="_blank">https://doi.org/10.1038/sdata.2017.171</a>。</p><p id="7c08" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">该数据集可以通过 CC-BY 4.0 许可在<a class="ae lt" href="https://analyse.kmi.open.ac.uk/open_dataset" rel="noopener ugc nofollow" target="_blank">https://analyse.kmi.open.ac.uk/open_dataset</a>免费获得。</p></div></div>    
</body>
</html>