<html>
<head>
<title>OpenStreetMap: From Browser Querying to Python+R Manipulation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OpenStreetMap:从浏览器查询到Python+R操作</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/openstreetmap-from-browser-querying-to-python-r-manipulation-c8e4504ad709?source=collection_archive---------10-----------------------#2021-03-28">https://towardsdatascience.com/openstreetmap-from-browser-querying-to-python-r-manipulation-c8e4504ad709?source=collection_archive---------10-----------------------#2021-03-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3a95" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">数据科学家简明指南</h2></div><p id="7b9c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">OpenStreetMap (OSM)有多个用户，例如，网站应用程序开发人员可以将OSM地图集成到他们的在线工具和服务中，数据科学家在很大程度上使用OSM数据来创建空间分析和构建模型。本指南面向希望快速开始使用OSM数据的数据科学家；为此，它提供了三项基本技能:</p><ol class=""><li id="b17d" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated">直接在网络浏览器中查询OSM数据，</li><li id="491e" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la lg lh li lj bi translated">使用python通过API请求OSM数据，以及</li><li id="764f" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la lg lh li lj bi translated">用r探索请求结果。</li></ol></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="82be" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">OSM数据基础</h1><p id="50b8" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">OpenStreetMap是一套开源工具，存储并允许访问通过众包标记的地理空间数据。该工具集包括:</p><p id="06e0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">数据库和API </strong>访问OpenStreetMap数据库有几个选项。本演练主要关注<a class="ae mt" href="https://wiki.openstreetmap.org/wiki/Overpass_API" rel="noopener ugc nofollow" target="_blank">天桥API </a>，它提供只读API访问。</p><p id="665f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">查询语言</strong>要在天桥API中查询数据，必须熟悉<a class="ae mt" href="https://wiki.openstreetmap.org/wiki/Overpass_API/Overpass_QL" rel="noopener ugc nofollow" target="_blank">天桥QL </a>。这是一种专门为OpenStreetMap数据模型创建的查询语言。</p><p id="7f9c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">交互式访问</strong> <a class="ae mt" href="https://wiki.openstreetmap.org/wiki/Overpass_turbo" rel="noopener ugc nofollow" target="_blank">立交桥涡轮</a>是一个基于网络的界面，允许使用立交桥QL探索OpenStreetMap数据库。查询结果显示在交互式地图上。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="5822" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">用天桥turbo查询OSM数据</h1><p id="7fd5" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">OpensStreetMap数据模型由<a class="ae mt" href="https://wiki.openstreetmap.org/wiki/Node" rel="noopener ugc nofollow" target="_blank">节点</a>和<a class="ae mt" href="https://wiki.openstreetmap.org/wiki/Way" rel="noopener ugc nofollow" target="_blank">路径</a>组成。</p><ul class=""><li id="f6e9" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la mu lh li lj bi translated">一个<strong class="kh ir"> OSM节点</strong>代表空间中的一个点，需要两个标签，它的<em class="mv">纬度</em>和<em class="mv">经度</em>。</li><li id="8ded" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la mu lh li lj bi translated">一条<strong class="kh ir"> OSM路</strong>代表线路(道路、河流),它们是节点的有序列表。一个<a class="ae mt" href="https://wiki.openstreetmap.org/wiki/Area" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir">区域</strong> </a>是一条“封闭”的路，应该用<code class="fe mw mx my mz b">isarea=true</code>标记。</li></ul><p id="54d9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一个OSM的数据模型<a class="ae mt" href="https://wiki.openstreetmap.org/wiki/Elements" rel="noopener ugc nofollow" target="_blank">元素</a>是一个<a class="ae mt" href="https://wiki.openstreetmap.org/wiki/Relation" rel="noopener ugc nofollow" target="_blank">关系</a>。</p><ul class=""><li id="484e" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la mu lh li lj bi translated"><strong class="kh ir"> OSM关系</strong>用于分配国家、县、命名多边形(地标)和路线的边界。</li></ul><p id="3678" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们从打开<code class="fe mw mx my mz b"><a class="ae mt" href="https://overpass-turbo.eu/?lat=30.30&amp;lon=-97.75&amp;zoom=11" rel="noopener ugc nofollow" target="_blank">https://overpass-turbo.eu/?lat=30.30&amp;lon=-97.75&amp;zoom=11</a></code>开始熟悉OSM元素，这是德克萨斯州奥斯汀市中心的立交桥视图。</p><figure class="nb nc nd ne gt nf gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi na"><img src="../Images/1ea1a5ea1c95eea6eb98f158b5b4aaa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nvYG67M1TaWXD2Hwxph59g.png"/></div></div></figure><p id="494f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在左侧，主视图包含一个文本框，其中输入了跨QL查询。在右边，结果显示在地图上。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h2 id="2e73" class="nm lx iq bd ly nn no dn mc np nq dp mg ko nr ns mi ks nt nu mk kw nv nw mm nx bi translated">查询1</h2><p id="4b17" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">下面的代码返回奥斯汀地区的餐馆。这个区域是一个由两点定义的盒子:西南角<code class="fe mw mx my mz b">(30.20, -97.85)</code>和东北角<code class="fe mw mx my mz b">(30.40, -97.65)</code>。</p><pre class="nb nc nd ne gt ny mz nz oa aw ob bi"><span id="ab45" class="nm lx iq mz b gy oc od l oe of">node[amenity=restaurant]<br/>  (30.20, -97.85, 30.40, -97.65); <br/>out;</span></pre><p id="062f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些是在地图上查询的结果。</p><figure class="nb nc nd ne gt nf gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi og"><img src="../Images/b87bacbb6ed8ace7e0097204ca725fdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*II7CBw2wgUMHleircbvs-w.png"/></div></div></figure><p id="39f6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">输出是xml格式的，每个节点的标签代表一家餐馆。</p><pre class="nb nc nd ne gt ny mz nz oa aw ob bi"><span id="7717" class="nm lx iq mz b gy oc od l oe of">&lt;node id="358532482" lat="30.3221769" lon="-97.6932173"&gt;<br/>    &lt;tag k="amenity" v="restaurant"/&gt;<br/>    &lt;tag k="created_by" v="Potlatch 0.10f"/&gt;<br/>    &lt;tag k="name" v="La Palapa"/&gt;<br/>  &lt;/node&gt;<br/>  &lt;node id="358669465" lat="30.3231224" lon="-97.7037688"&gt;<br/>    &lt;tag k="amenity" v="restaurant"/&gt;<br/>    &lt;tag k="created_by" v="Potlatch 0.10f"/&gt;<br/>    &lt;tag k="name" v="China Star Buffet"/&gt;<br/>  &lt;/node&gt;<br/>  &lt;node id="358693667" lat="30.3253747" lon="-97.7048159"&gt;<br/>    &lt;tag k="amenity" v="restaurant"/&gt;<br/>    &lt;tag k="created_by" v="Potlatch 0.10f"/&gt;<br/>    &lt;tag k="name" v="Pappadeaux"/&gt;<br/>  &lt;/node&gt;<br/>  &lt;node id="359344991" lat="30.3269188" lon="-97.7048810"&gt;<br/>    &lt;tag k="amenity" v="restaurant"/&gt;<br/>    &lt;tag k="created_by" v="Potlatch 0.10f"/&gt;<br/>    &lt;tag k="name" v="Pappasitos"/&gt;</span></pre><p id="a6f6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过QL，语句将它们的结果写入集合，然后这些集合可以作为后续语句的输入。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h2 id="d677" class="nm lx iq bd ly nn no dn mc np nq dp mg ko nr ns mi ks nt nu mk kw nv nw mm nx bi translated">查询2</h2><pre class="nb nc nd ne gt ny mz nz oa aw ob bi"><span id="d4b7" class="nm lx iq mz b gy oc od l oe of">[out:json];<br/>    (<br/>      node[amenity=restaurant]({{bbox}});<br/>      node[amenity=school]({{bbox}});<br/>    );<br/>    out;</span></pre><p id="4694" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该查询返回两种类型的便利设施的位置，即餐馆和学校。该声明包含:</p><ul class=""><li id="608e" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la mu lh li lj bi translated">分号<code class="fe mw mx my mz b">;</code>分隔并结束语句的每一部分。</li><li id="bc23" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la mu lh li lj bi translated">一个联合块，由一对括号内的语句组成<code class="fe mw mx my mz b">().</code></li><li id="8c79" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la mu lh li lj bi translated"><code class="fe mw mx my mz b">[out:&lt;format&gt;] </code>一对方括号<code class="fe mw mx my mz b">[]</code>和一个<code class="fe mw mx my mz b">out</code>语句，它们决定输出的格式(在本例中，是json格式)。</li><li id="20c5" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la mu lh li lj bi translated">完成搜索的边界框。<code class="fe mw mx my mz b">({{bbox}})</code>表示将结果过滤到当前地图视图。</li></ul></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><p id="ff3d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">到目前为止，示例中的查询将结果过滤到由坐标或当前地图视图定义的有界框中。在一个城市或一个县内请求结果是一个常见的用例。为此，需要管理边界区域的<code class="fe mw mx my mz b">id</code>。例如，德克萨斯州奥斯汀市的OSM关系的<code class="fe mw mx my mz b">id</code>是<code class="fe mw mx my mz b">113314</code>。</p><p id="2325" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae mt" href="https://wiki.openstreetmap.org/wiki/Nominatim" rel="noopener ugc nofollow" target="_blank">nomist im</a>是允许按名称搜索OpenStreetMap数据的工具，可在<code class="fe mw mx my mz b"><a class="ae mt" href="https://nominatim.openstreetmap.org/ui/search.html" rel="noopener ugc nofollow" target="_blank">https://nominatim.openstreetmap.org/ui/search.html</a></code>访问。下一张图片是搜索‘奥斯汀’后的nomim截图。搜索结果是OpenStreetMap数据库中的元素，其标签与搜索关键字相关。</p><figure class="nb nc nd ne gt nf gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi oh"><img src="../Images/a9134aab94141fe2889af3252f87425a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eI0upFxhqiR9Ba4poQHAKQ.png"/></div></div></figure><h2 id="3f09" class="nm lx iq bd ly nn no dn mc np nq dp mg ko nr ns mi ks nt nu mk kw nv nw mm nx bi translated">查询3</h2><p id="b186" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">下一个查询在德克萨斯州的奥斯汀市执行搜索。请注意，区域id由数字3600000000和OSM关系id之和确定(在本例中为3600113314 = 3600000000 + 113314)。如果感兴趣的区域是OSM路，则将数字2400000000添加到其OSM id [ <a class="ae mt" href="https://janakiev.com/blog/openstreetmap-with-python-and-overpass-api/" rel="noopener ugc nofollow" target="_blank"> 1 </a> ]中。</p><pre class="nb nc nd ne gt ny mz nz oa aw ob bi"><span id="3b1f" class="nm lx iq mz b gy oc od l oe of">area(3600113314);<br/>node[amenity=restaurant](area);<br/>out;</span></pre></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="1f6b" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">使用Python直接发出请求</h1><p id="bbda" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">通过在<code class="fe mw mx my mz b"><a class="ae mt" href="http://overpass-api.de/api/interpreter?data=`" rel="noopener ugc nofollow" target="_blank">http://overpass-api.de/api/interpreter?data=</a></code>之后添加一个天桥QL查询，可以向天桥API发出请求。以下Python代码将返回与上一节中的<em class="mv">查询3 </em>示例相同的结果。</p><pre class="nb nc nd ne gt ny mz nz oa aw ob bi"><span id="a767" class="nm lx iq mz b gy oc od l oe of"># %python</span><span id="6bf3" class="nm lx iq mz b gy oi od l oe of">import requests<br/>import json</span><span id="1653" class="nm lx iq mz b gy oi od l oe of">overpass_url = "<a class="ae mt" href="http://overpass-api.de/api/interpreter" rel="noopener ugc nofollow" target="_blank">http://overpass-api.de/api/interpreter</a>"<br/>overpass_query = "[out:json];area(3600113314);node[amenity=restaurant](area);out;"</span><span id="fb76" class="nm lx iq mz b gy oi od l oe of">response = requests.get(overpass_url, params={'data': overpass_query})<br/>response = response.json()</span></pre><p id="017a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">API请求返回一个json，它是列表和字典的组合。<code class="fe mw mx my mz b">elements</code>项包含所有提取节点的列表。这是前五个条目:</p><pre class="nb nc nd ne gt ny mz nz oa aw ob bi"><span id="0525" class="nm lx iq mz b gy oc od l oe of">&gt;&gt;&gt; <!-- -->response[‘elements’][1:5]</span><span id="4281" class="nm lx iq mz b gy oi od l oe of">[{'type': 'node', 'id': 358669465, 'lat': 30.3231224, 'lon': -97.7037688, 'tags': {'amenity': 'restaurant', 'created_by': 'Potlatch 0.10f', 'name': 'China Star Buffet'}}, {'type': 'node', 'id': 358693667, 'lat': 30.3253747, 'lon': -97.7048159, 'tags': {'amenity': 'restaurant', 'created_by': 'Potlatch 0.10f', 'name': 'Pappadeaux'}}, {'type': 'node', 'id': 359344991, 'lat': 30.3269188, 'lon': -97.704881, 'tags': {'amenity': 'restaurant', 'created_by': 'Potlatch 0.10f', 'name': 'Pappasitos'}}, {'type': 'node', 'id': 359354860, 'lat': 30.3288301, 'lon': -97.7049325, 'tags': {'amenity': 'restaurant', 'created_by': 'Potlatch 0.10f', 'name': 'Japon Sushi'}}]</span></pre><p id="2f20" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">定义节点的(元)值是<code class="fe mw mx my mz b">type</code>、<code class="fe mw mx my mz b">node</code>、<code class="fe mw mx my mz b">id</code>、<code class="fe mw mx my mz b">lat</code>和<code class="fe mw mx my mz b">lon</code>。元素是一个嵌套的字典。如何使用<code class="fe mw mx my mz b">pd.json_normalize</code>展平嵌套字典的示例如下所示[ <a class="ae mt" rel="noopener" target="_blank" href="/how-to-parse-json-data-with-python-pandas-f84fbd0b10"> 2 </a> ]。在这种情况下，选择了<code class="fe mw mx my mz b">amenity</code>、<code class="fe mw mx my mz b">name</code>和<code class="fe mw mx my mz b">cuisine</code>标签。</p><pre class="nb nc nd ne gt ny mz nz oa aw ob bi"><span id="723e" class="nm lx iq mz b gy oc od l oe of"># %python</span><span id="fc1c" class="nm lx iq mz b gy oi od l oe of">import pandas as pd<br/>import numpy as np</span><span id="4ee8" class="nm lx iq mz b gy oi od l oe of">restaurants = (<br/>  pd.json_normalize(<br/>    response,<br/>    record_path = 'elements'<br/>    ) <br/>)[['type', 'id', 'lat', 'lon', 'tags.amenity', 'tags.name', 'tags.cuisine']]</span><span id="6607" class="nm lx iq mz b gy oi od l oe of"># since NaNs are not defined for characters in R (only for numeric)<br/># we need to replace NaNs for temporary 'NA' strings in python and<br/># then convert them to actual NAs in R</span><span id="f64c" class="nm lx iq mz b gy oi od l oe of">restaurants = restaurants.replace(np.nan, "NA")</span></pre><p id="ff1b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">产生的<code class="fe mw mx my mz b">restaurants</code>数据帧可以很容易地导出到r。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="65a3" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">用R探索OSM数据</h1><p id="68c3" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">R中的“传单”库可用于探索我们之前用Python获得的数据帧。除了通过“传单”实现OSM元素的空间可视化之外，“sf”库还提供了处理GIS数据的功能。</p><p id="bb19" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在移动到R之前，Travis县(奥斯汀市)的人口普查区块组将使用Python从<a class="ae mt" href="https://www2.census.gov/geo/tiger/" rel="noopener ugc nofollow" target="_blank"> Tiger/Line ftp </a>中提取。在这种情况下，下载的shapefile存储在本地文件夹<code class="fe mw mx my mz b">/tmp</code>中。</p><pre class="nb nc nd ne gt ny mz nz oa aw ob bi"><span id="5529" class="nm lx iq mz b gy oc od l oe of"># %python</span><span id="9e21" class="nm lx iq mz b gy oi od l oe of">import wget<br/>from zipfile import ZipFile</span><span id="ae10" class="nm lx iq mz b gy oi od l oe of">import os<br/>cwd = os.getcwd()</span><span id="a5df" class="nm lx iq mz b gy oi od l oe of"># census block groups<br/>url = '<a class="ae mt" href="https://www2.census.gov/geo/tiger/TIGER2020PL/STATE/48_TEXAS/48453/tl_2020_48453_bg20.zip'" rel="noopener ugc nofollow" target="_blank">https://www2.census.gov/geo/tiger/TIGER2020PL/STATE/48_TEXAS/48453/tl_2020_48453_bg20.zip'</a><br/>wget.download(url, '/tmp')<br/>file_name = '/tmp/tl_2020_48453_bg20.zip'<br/>ZipFile(file_name, 'r').extractall('./tmp')</span></pre><p id="128a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用R中加载的<code class="fe mw mx my mz b">restaurants</code>数据框和手边的人口普查区块组形状文件，可以获得一个两层地图:</p><ul class=""><li id="c10b" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la mu lh li lj bi translated">包含以蓝点表示的餐馆的图层。</li><li id="a15a" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la mu lh li lj bi translated">带有表示人口普查区块组(cbg)的多边形的图层。</li></ul><pre class="nb nc nd ne gt ny mz nz oa aw ob bi"><span id="d2f5" class="nm lx iq mz b gy oc od l oe of"># %r</span><span id="4625" class="nm lx iq mz b gy oi od l oe of">library(leaflet)<br/>library(sf)</span><span id="c595" class="nm lx iq mz b gy oi od l oe of">cbg_sf = st_read("/tmp/tl_2020_48453_bg20.shp")<br/>cbg_sp &lt;- as(cbg_sf, "Spatial")</span><span id="da3e" class="nm lx iq mz b gy oi od l oe of">leaflet() %&gt;% <br/>  addProviderTiles(providers$OpenStreetMap) %&gt;% <br/>  addPolygons(data = cbg_sp, color = "black", weight = 0.5, <br/>              ) %&gt;% <br/>  addCircles(data = restaurants, <br/>             ~lon, ~lat, popup = ~tags.name)</span></pre><figure class="nb nc nd ne gt nf gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi oj"><img src="../Images/0195e03e05f6a8cb59ea5d8ddc5cb01e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-oZyCyWiRjHlE7D50ZRvWw.png"/></div></div></figure><p id="b568" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了完成本指南，下一个代码块包含计算每个cbg [ <a class="ae mt" href="https://mattherman.info/blog/point-in-poly/" rel="noopener ugc nofollow" target="_blank"> 3 </a> ]中餐馆数量的命令。</p><pre class="nb nc nd ne gt ny mz nz oa aw ob bi"><span id="3dee" class="nm lx iq mz b gy oc od l oe of"># %r</span><span id="dea9" class="nm lx iq mz b gy oi od l oe of">library(tidyverse)</span><span id="d43d" class="nm lx iq mz b gy oi od l oe of">restaurants_sf = st_as_sf(restaurants, coords = c("lon","lat"), crs = "NAD83")</span><span id="01d3" class="nm lx iq mz b gy oi od l oe of">st_join(restaurants_sf, cbg_sf, join = st_within) %&gt;% <br/>  as.data.frame() %&gt;% <br/>  select(GEOID20) %&gt;% <br/>  group_by(GEOID20) %&gt;% <br/>  summarise(n = n()) %&gt;% <br/>  arrange(desc(n))</span></pre><p id="41fa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，cbg餐厅计数可用作监督模型的协变量，或用于估计空间分布。</p><p id="14d6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于如何在R中使用地理空间数据的其他学习材料可在其他地方找到:</p><ul class=""><li id="ecbe" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la mu lh li lj bi translated"><a class="ae mt" href="https://datacarpentry.org/organization-geospatial/" rel="noopener ugc nofollow" target="_blank">地理空间概念的数据木工介绍</a></li><li id="b64f" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la mu lh li lj bi translated"><a class="ae mt" href="https://www.earthdatascience.org/courses/earth-analytics/spatial-data-r/intro-vector-data-r/" rel="noopener ugc nofollow" target="_blank">地球实验室:地球分析课程</a></li><li id="2d13" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la mu lh li lj bi translated"><a class="ae mt" href="https://r-spatial.github.io/sf/articles/sf1.html" rel="noopener ugc nofollow" target="_blank"> sf(简单功能)打包文章</a>，或者也可以运行<code class="fe mw mx my mz b">methods(class = “sf”)</code>快速访问所有sf方法。</li></ul></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><p id="c03b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">虽然在Python和R中存在带有OSM数据提取内置函数的包(如<a class="ae mt" href="https://osmnx.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> OSMnx </a>或<a class="ae mt" href="https://cran.csiro.au/web/packages/osmdata/vignettes/osmdata.html#2_The_overpass_API" rel="noopener ugc nofollow" target="_blank"> osmdata </a>)，但本指南提供了这些函数背后的基本概念。了解OSM数据、python API请求和R空间操作的基础知识，最终使数据科学家能够根据手头应用问题的需求轻松调整他们的工作流程(并且可以使用OSM数据的应用问题是无限的！).</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><p id="d34f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">[1] Nikolai Janakiev，<a class="ae mt" href="https://janakiev.com/blog/openstreetmap-with-python-and-overpass-api/" rel="noopener ugc nofollow" target="_blank">使用Python和立交桥API从OpenStreetMap加载数据</a> (2018)，个人博客</p><p id="280a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">[2] Ankit Goel，<a class="ae mt" rel="noopener" target="_blank" href="/how-to-parse-json-data-with-python-pandas-f84fbd0b1025">如何用Python熊猫解析JSON数据？</a> (2020)，走向数据科学</p><p id="0971" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">[3]马特·赫尔曼，<a class="ae mt" href="https://mattherman.info/blog/point-in-poly/" rel="noopener ugc nofollow" target="_blank">带sf的多边形中的点</a> (2018)，个人博客</p></div></div>    
</body>
</html>