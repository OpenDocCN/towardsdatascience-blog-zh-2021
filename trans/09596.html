<html>
<head>
<title>Importing CSVs in PostgreSQL and Conducting Regression Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在PostgreSQL中导入CSV并进行回归分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/importing-csvs-in-postgresql-and-conducting-regression-analysis-77ff92f5a283?source=collection_archive---------31-----------------------#2021-09-06">https://towardsdatascience.com/importing-csvs-in-postgresql-and-conducting-regression-analysis-77ff92f5a283?source=collection_archive---------31-----------------------#2021-09-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8fd7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何将数据集导入PostgreSQL并进行回归分析</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5606d8628627db2976b8b613b81d7bb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eurKCeTLUQworsZS_vSGnA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:图片由<a class="ae ky" href="https://pixabay.com/users/geralt-9301/" rel="noopener ugc nofollow" target="_blank"> geralt </a>从<a class="ae ky" href="https://pixabay.com/photos/data-computer-internet-online-www-2899901/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>拍摄</p></figure><p id="230d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为数据科学家，我们通常更喜欢用Python和r进行回归分析——当然也包括几乎所有形式的分析。</p><p id="8881" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也就是说，虽然跨小型数据集或在辅助项目中使用CSV文件是很常见的，但任何实际大小的真实世界数据几乎总是存储在SQL数据库中。</p><p id="2e34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，将整个表导入Python或R(取决于其大小)是不切实际的。</p><p id="461b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们希望对从SQL数据库导入的特定数据集进行回归分析。据我们所知，对该数据集进行回归分析的结果可能是虚假的，这意味着提取数据进行更高级的分析浪费了宝贵的时间和资源。</p><p id="38f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在将数据导入外部程序进行更高级的分析之前，用SQL进行一些初步的分析不是更有效吗？</p><p id="419d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嗯，使用SQL进行简单的回归分析确实是可能的。让我们来看看这是如何做到的。</p><h1 id="65c4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">数据集和从CSV导入</h1><p id="6357" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">考虑一个汽车销售数据集(<a class="ae ky" href="https://github.com/MGCodesandStats/datasets/blob/master/cars.csv" rel="noopener ugc nofollow" target="_blank">可从我的GitHub </a>获得)，其中提供了特定车辆的<strong class="lb iu">售价</strong>，以及诸如购买者的月<strong class="lb iu">收入</strong>水平、他们的总<strong class="lb iu">债务</strong>以及每月驾驶的平均<strong class="lb iu">英里数</strong>等因素。</p><p id="4a03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然数据可能已经在SQL数据库的一个表中提供了，但我们经常希望从CSV文件中导入数据。让我们看看如何做到这一点。</p><p id="0cda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先要确保SQL具有访问CSV文件的适当权限。例如，假设您正在使用LibreOffice Calc(我是一个Linux用户)，您将需要通过右键单击CSV文件，选择Properties，并切换到permissions来确保权限是允许的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/ec9fddfc6978f357dc12b811972beade.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*TMIpbMlJ4OumZSVUgB1wbQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">资料来源:图书馆办公室计算</p></figure><p id="d964" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在导入CSV文件之前，需要创建数据库和表，并在后者中定义适当的变量。</p><p id="b25d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建并打开数据库(在本例中称为<strong class="lb iu">车辆</strong>，输入以下内容:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="0409" class="my lw it mu b gy mz na l nb nc">sudo -u postgres createdb vehicles<br/>sudo -u postgres psql vehicles</span></pre><p id="8626" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，名为<strong class="lb iu">汽车</strong>的表格被创建:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="085b" class="my lw it mu b gy mz na l nb nc">vehicles=# create table cars (<br/>vehicles(# age decimal(8,2),<br/>vehicles(# gender decimal(8,2),<br/>vehicles(# miles decimal(8,2),<br/>vehicles(# debt decimal(8,2),<br/>vehicles(# income decimal(8,2),<br/>vehicles(# sales decimal(8,2)<br/>vehicles(# );</span></pre><p id="036f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建表格后，我们现在可以将数据从CSV文件导入表格:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="8306" class="my lw it mu b gy mz na l nb nc">vehicles=# copy cars (age, gender, miles, debt, income, sales)<br/>vehicles-# from '/home/Desktop/cars.csv'<br/>vehicles-# DELIMITER ','<br/>vehicles-# CSV HEADER;<br/>COPY 963</span></pre><p id="26b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于数据集中的963个条目，<strong class="lb iu"> COPY 963 </strong>消息表明这些值被正确传输。</p><p id="761f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以通过从表中选择前10个观察值来验证这些值是否存在:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="dec0" class="my lw it mu b gy mz na l nb nc">vehicles=# select * from cars limit 10;<br/>  age  | gender | miles |   debt   | income  |  sales   <br/>-------+--------+-------+----------+---------+----------<br/> 28.00 |   0.00 | 23.00 |     0.00 | 4099.00 |   620.00<br/> 26.00 |   0.00 | 27.00 |     0.00 | 2677.00 |  1792.00<br/> 30.00 |   1.00 | 58.00 | 41576.00 | 6215.00 | 27754.00<br/> 26.00 |   1.00 | 25.00 | 43172.00 | 7626.00 | 28256.00<br/> 20.00 |   1.00 | 17.00 |  6979.00 | 8071.00 |  4438.00<br/> 58.00 |   1.00 | 18.00 |     0.00 | 1262.00 |  2102.00<br/> 44.00 |   1.00 | 17.00 |   418.00 | 7017.00 |  8520.00<br/> 39.00 |   1.00 | 28.00 |     0.00 | 3282.00 |   500.00<br/> 44.00 |   0.00 | 24.00 | 48724.00 | 9980.00 | 22997.00<br/> 46.00 |   1.00 | 46.00 | 57827.00 | 8163.00 | 26517.00<br/>(10 rows)</span></pre><h1 id="d601" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">相关系数和回归分析</h1><p id="6aa7" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">现在数据已经导入，让我们开始进行一些分析。</p><p id="8b53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">特别是，我们想确定哪些变量对每辆车的销售价格有特别的影响。如上所述，在考虑更高级的分析之前，我们希望通过使用SQL来确定是否有特别相关的发现。</p><h2 id="69de" class="my lw it bd lx nd ne dn mb nf ng dp mf li nh ni mh lm nj nk mj lq nl nm ml nn bi translated">相关系数</h2><p id="ad46" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">首先，让我们生成以下变量之间的相关系数(衡量两个变量之间关系的强度):</p><ul class=""><li id="27ac" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">销售和收入</li><li id="55f7" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">销售和债务</li><li id="7f2f" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">销售额和里程</li></ul><p id="1824" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了计算销售和收入之间的相关系数，我们将输入以下内容，首先输入Y(因变量),然后输入X(自变量):</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="f71b" class="my lw it mu b gy mz na l nb nc">vehicles=# select corr(sales, income) as correlation from cars;<br/>    correlation    <br/>-------------------<br/> 0.674685436054842<br/>(1 row)</span></pre><p id="6657" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分析得出的相关系数为0.67，表明这两个变量之间存在正相关。</p><p id="ee70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为参考，相关系数1表示完全正相关，-1表示完全负相关，而0表示不相关。</p><p id="3975" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是其他变量的相关系数:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="bf03" class="my lw it mu b gy mz na l nb nc">vehicles=# select corr (sales, debt) as correlation from cars;<br/>   correlation    <br/>------------------<br/> 0.83554132018907<br/>(1 row)</span><span id="cfd2" class="my lw it mu b gy oc na l nb nc">vehicles=# select corr (sales, miles) as correlation from cars;<br/>    correlation    <br/>-------------------<br/> 0.636675650108261<br/>(1 row)</span></pre><p id="aa0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有趣的是，我们看到销售额和债务在0.83处有最强的相关性。这可能向我们表明，持有更多债务的客户更有可能贷款购买汽车。直觉上，这是有道理的——因为更昂贵的汽车通常是通过债务融资，而不是现金购买。</p><h2 id="bb5e" class="my lw it bd lx nd ne dn mb nf ng dp mf li nh ni mh lm nj nk mj lq nl nm ml nn bi translated">回归分析</h2><p id="7192" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了更深入，让我们进行一个回归分析。</p><p id="8d01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将首先根据收入回归销售额:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="21fb" class="my lw it mu b gy mz na l nb nc">vehicles=# select round(regr_slope(sales, income)::numeric, 2) as slope, round(regr_intercept(sales, income)::numeric, 2) as y_intercept from cars;<br/> slope | y_intercept <br/>-------+-------------<br/>  1.86 |      205.29<br/>(1 row)</span></pre><p id="87db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分析得出的斜率为1.86，表明收入每增加1美元，销售额就会增加1.86美元。在这种情况下，截距有些虚假，但本质上代表了如果客户的收入为0美元时的最小销售额。</p><p id="8deb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们对其他变量进行回归分析:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="bc3e" class="my lw it mu b gy mz na l nb nc">vehicles=# select round(regr_slope(sales, debt)::numeric, 2) as slope, round(regr_intercept(sales, debt)::numeric, 2) as y_intercept from cars;<br/> slope | y_intercept <br/>-------+-------------<br/>  0.41 |     5892.27<br/>(1 row)</span><span id="c069" class="my lw it mu b gy oc na l nb nc">vehicles=# select round(regr_slope(sales, miles)::numeric, 2) as slope, round(regr_intercept(sales, miles)::numeric, 2) as y_intercept from cars;<br/> slope  | y_intercept <br/>--------+-------------<br/> 427.69 |     -158.93<br/>(1 row)</span></pre><ul class=""><li id="4677" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">债务每增加1美元，销售额就增加0.41美元。截距表明，如果债务为0美元，最小销售数将为5，892.27美元。</li><li id="98da" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">每天平均行驶里程每增加1英里，销售价格就会增加427.69美元。这与我们的预期相反——我们认为汽车行驶的里程越多，销售价格就越低。然而，在这种情况下,<strong class="lb iu">平均每天行驶的英里数</strong>才是问题中的变量——而不是总英里数。在这种情况下，从建模的角度来看，这个变量很可能是虚假的，并不能真正告诉我们对销售价格的具体影响。</li></ul><h2 id="9389" class="my lw it bd lx nd ne dn mb nf ng dp mf li nh ni mh lm nj nk mj lq nl nm ml nn bi translated">r平方</h2><p id="1ea3" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了更好地衡量这些读数的意义，让我们来看看一个被称为<strong class="lb iu"> R平方</strong>的统计数据。</p><p id="a875" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本质上，任何因变量(在这种情况下，销售)都受模型中的自变量和这些变量没有拾取的随机变量的影响。</p><p id="6019" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">R-Squared用于衡量模型在多大程度上解释了因变量的总变化。R平方值介于0和1之间，0表示模型考虑了因变量的<strong class="lb iu">无</strong>变化，而1表示模型考虑了因变量的<strong class="lb iu">所有</strong>变化。</p><p id="f7eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是对相关变量的R平方计算:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="8275" class="my lw it mu b gy mz na l nb nc">vehicles=# select round(regr_r2(sales, income)::numeric, 3) as r_squared from cars;<br/> r_squared <br/>-----------<br/>     0.455<br/>(1 row)</span><span id="c628" class="my lw it mu b gy oc na l nb nc">vehicles=# select round(regr_r2(sales, debt)::numeric, 3) as r_squared from cars;<br/> r_squared <br/>-----------<br/>     0.698<br/>(1 row)</span><span id="62d3" class="my lw it mu b gy oc na l nb nc">vehicles=# select round(regr_r2(sales, miles)::numeric, 3) as r_squared from cars;<br/> r_squared <br/>-----------<br/>     0.405<br/>(1 row)</span></pre><p id="3729" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到，销售额对债务的回归具有最高的R平方，接近70%，这意味着债务变量几乎占销售额总变化的70%。</p><h1 id="916c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="0af0" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这是对PostgreSQL中回归分析使用的介绍。您还看到了如何导入CSV格式的数据集，并将其传输到SQL表中。</p><p id="e732" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我推荐阅读Anthony DeBarros的《实用SQL 》,更深入地了解如何使用SQL实现回归分析和其他分析工具。</p><p id="b99e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如前所述，在对特定数据集进行“快速而粗略”的分析时，SQL非常有用——这可以极大地帮助确定是否需要使用外部程序(如Python或r)进行进一步的分析。</p><p id="73c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然更深入的回归分析(如t-test计算)可能难以在SQL中实现(通常不推荐)，但在数据库表本身中进行初步分析总是有其优势的。</p><p id="2c87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">非常感谢您的宝贵时间，非常感谢您的任何问题或反馈。你可以在<a class="ae ky" href="https://www.michael-grogan.com/" rel="noopener ugc nofollow" target="_blank">michael-grogan.com</a>找到更多我的内容。</p><h1 id="d4a9" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">参考</h1><ul class=""><li id="19ed" class="no np it lb b lc mn lf mo li od lm oe lq of lu nt nu nv nw bi translated"><a class="ae ky" href="https://www.postgresqltutorial.com/import-csv-file-into-posgresql-table/" rel="noopener ugc nofollow" target="_blank"> postgresqltutorial.com:将CSV文件导入PostgreSQL表</a></li><li id="81c4" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated"><a class="ae ky" href="https://www.practicalsql.com/" rel="noopener ugc nofollow" target="_blank">Anthony DeBarros的实用SQL</a></li><li id="935d" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated"><a class="ae ky" href="https://stackoverflow.com/questions/54031813/i-am-trying-to-copy-a-file-but-getting-error-message" rel="noopener ugc nofollow" target="_blank">stackoverflow.com</a></li></ul><p id="146e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="og">免责声明:本文是在“原样”的基础上编写的，没有任何担保。它旨在提供数据科学概念的概述，不应被解释为专业建议。本文中的发现和解释是作者的发现和解释，不被本文中提到的任何第三方认可或隶属于任何第三方。作者与本文提及的任何第三方无任何关系。</em></p></div></div>    
</body>
</html>