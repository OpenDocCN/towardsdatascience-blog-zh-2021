<html>
<head>
<title>Time Series Anomaly Detection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列异常检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-anomaly-detection-b10fdb542974?source=collection_archive---------9-----------------------#2021-04-22">https://towardsdatascience.com/time-series-anomaly-detection-b10fdb542974?source=collection_archive---------9-----------------------#2021-04-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8649" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">模型和系统架构:ARMA，LSTM-VAE，SR-CNN</h2></div><h1 id="5d2f" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">介绍</h1><p id="c27b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在现实世界中，我们经常关心监控关键信号，以确保它们遵循预期的行为模式，如果发生了意想不到的事情，我们希望能够解释它。这种性质的信号被称为时间序列，有几种方法可以预测和检测时间序列信号中的异常。时间序列的例子多种多样，从关键绩效指标，如销售量，到个人财务预算，再到股票市场收盘价。我们将研究三个模型，从经典的ARMA模型开始，然后是两个现代的深度学习方法LSTM-VAE和SR-CNN。除了模型本身，我们还将触及系统架构，并研究系统和模型之间的相互作用。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi lt"><img src="../Images/da29afa78dc505cc303acaa03fd674eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eAD3MJ3ntP2o8UqFHC-S9w.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">时间序列信号。图片由Canva提供。免费图像许可证。</p></figure><h1 id="bda4" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">ARMA</h1><p id="8896" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">作为热身，让我们从时间序列数据的经典模型开始:自回归移动平均(ARMA)模型。设X_t是我们在时间t的信号X，我们假设X_t线性依赖于前面的值X_{t-1}，…，X_{t-p}其中p是自回归的阶。因此，AR(p)定义为:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/942be66cf44a508e0eacac002833ba5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:618/format:webp/1*3zfXuGhX5dhveaJ-Ew3ccA.png"/></div></figure><p id="871f" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">其中，\phi_1，...，\phi_p是可以基于历史数据学习的自回归参数，用于预测或查找相似的时间序列，c是常数，\epsilon_t ~ N(0，\sigma)是高斯噪声。</p><p id="932e" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">q阶移动平均(MA)模型对噪声项进行回归，因此MA(q)定义为:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/772b123b5730790eb38b37a05ae47093.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*h8t6RWPeyxdwujuja_tOIQ.png"/></div></figure><p id="4ee3" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">其中\theta_1，…,\theta_q是模型的可学习参数，\mu是X_t的期望值，\epsilon_{t-i} ~ N(0，\sigma)是iid高斯噪声项。</p><p id="e333" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">我们可以将X_t建模的两种互补观点结合到一个等式中，得到ARMA(p，q)模型:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/873f0b0db512536e95ffce1198167d76.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*ue0eJmUnXXzLbi9XWUmkAQ.png"/></div></figure><p id="e30e" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">使用历史数据，我们可以选择ARMA(p，q)模型中的p和q，并学习模型系数{\theta}和{\phi}，基于此我们可以做出未来预测。时间序列异常中与预测结果的实质性偏差。我们可以将实质性定义为x的移动平均值的两个标准偏差。模型参数{\theta}和{\phi}通过statsmodels包[1]中实施的最大似然估计(MLE)进行学习。考虑到模型的简单性，它对于许多应用可能是足够的。</p><h1 id="a28b" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">LSTM-VAE</h1><p id="143c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们来看看一个更复杂的模型:LSTM-VAE，变分自动编码器(VAE)，带有LSTM编码器和解码器模块，用于表示时间序列数据。该模型的架构如图1所示。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/3738e45afd11cbceb1b475f8a3ad1a0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*zp8Fi7gBnoAcGrkSuqB7dw.png"/></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">图1:异常检测LSTM-VAE模型架构。图片由Vadim Smolyakov提供。</p></figure><p id="d76f" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">输入由n个信号x_1，…，x_n组成，输出是在正常(非异常)训练参数下观察输入x_i的对数概率。这意味着以无监督的方式在非异常数据上训练模型，并且当在给定的输入x_i上确实发生异常时，相应的对数似然log p(x_i |{\mu_i，\sigma_i})将下降，并且我们可以对所产生的下降进行阈值处理以发出异常信号。</p><p id="76db" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">我们假设高斯似然，因此每个传感器都有两个自由度{\mu，\sigma}来表示异常。因此，对于n个输入传感器，我们学习2n个输出参数(平均值和方差),这些参数能够区分异常和正常行为。</p><p id="5878" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">当输入信号相互独立时，它们通过采样层的VAE嵌入到一个联合潜在空间中。嵌入被构造为高斯型，通过最小化KL散度来逼近标准法线N(0，1)。</p><p id="00a4" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">该模型以无监督的方式用目标函数训练，该目标函数实现两个目标:1)它最大化在传感器上平均的模型的对数似然输出，以及2)它构造嵌入空间以逼近N(0，1):</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi ms"><img src="../Images/c30c5e1d48efc6e3cac96b34cdbf8e76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ju8VT5bmfComF0umnL3MIA.png"/></div></div></figure><p id="3ae6" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">让我们看看如何以可扩展和模块化的方式实现这个模型。我们将把我们的异常检测模型Docker化，并创建许多支持性的微服务，如数据摄取、训练、推理和通知服务，这些服务都作为Docker容器实现，并由Kubernetes编排。除了用于任何所需存储的NoSQL数据库之外，我们将使用Kafka消息总线来接收传感器输入数据并输出通知。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/0e1db3f5b16141782f8e69be85c006d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*gb3s6ThrIWmQdump0NKODw.png"/></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">图3:微服务软件架构。图片作者:Vadim Smolyakov</p></figure><p id="d653" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">图3显示了微服务、多容器软件架构。作为输入连接的是三个传感器:一个计算房间内人数的摄像机，一个输出db级声音振幅的音频传感器和一个用作多样化信号发生器的raspberry pi设备。输出是一个通知接收器，它通知时序异常。</p><p id="72b1" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">作为一个简单的例子，考虑一个方波输入，其尖峰指示异常。如图4所示，我们可以检测到对数似然性的下降，并设定阈值以发出异常信号。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/6bad2f49974d8c6dd61940dbefaf723f.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*wWG-gYDPGhe2L7mVY-qUYA.png"/></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">图4:检测到尖峰异常，如对数似然下降所示。图片由Vadim Smolyakov提供。</p></figure><p id="c03d" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">总之，最先进的深度学习与微服务、多容器软件架构相结合，带来了实时异常检测的可扩展和模块化解决方案。</p><h1 id="2e8b" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">有线电视新闻网</h1><p id="4214" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">光谱残差(SR) CNN [3]从计算机视觉的角度看待异常检测问题。SR-CNN是一种从视觉显著性检测领域借用SR模型并将其应用于时间序列异常检测的新算法[3]。图5显示了深度学习架构。引用作者的话:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mv"><img src="../Images/3f4efe06b9130cf4d9117ff93e3aa12c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PqtNYI50ebDe94qfJRpyyg.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">图5:异常检测SR-CNN模型架构[3]。图片由论文作者提供[3]。</p></figure><blockquote class="mw mx my"><p id="c3cc" class="kx ky mz kz b la mk jr lc ld ml ju lf na mm li lj nb mn lm ln nc mo lq lr ls ij bi translated">“谱残差(SR)算法由三个主要步骤组成:1)傅里叶变换以获得对数幅度谱，2)计算谱残差[wrt平均谱]以及3)逆傅里叶变换，将时间序列变换回空间域…谱残差作为序列的压缩表示，而原始序列的创新部分变得更加重要。”</p></blockquote><p id="1fc7" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">产生的转换称为显著图，如图6所示。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nd"><img src="../Images/85f147aff55cef80131faad8ce8c6fe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wM4EoaYZUl1dSntlca1vIw.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">图6:光谱残差(SR)显著图[3]。图片由论文作者提供[3]。</p></figure><p id="d681" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">显著图被馈送到两个1-D卷积层，随后是两个完全连接的层，滤波器大小等于滑动窗口大小。该模型被训练为使用随机梯度下降最小化交叉熵损失函数。它以监督的方式被训练，并且需要异常标签。该模型在不同的基准测试中取得了较高的F-1分数(详见[3])。</p><p id="b979" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">整个系统由三个主要部分组成:数据摄取、在线计算和实验平台。摄取工作人员将时间序列摄取到influxDB和Kafka中，吞吐量从10K到每秒100K个数据点不等。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi ne"><img src="../Images/7b2b4555b3350711cdf14e84ba4a5636.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fAIWkbGi3QEakpBrcumcCA.png"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">图7: SR-CNN系统架构[3]。图片由论文作者提供[3]。</p></figure><p id="ebd3" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">在在线计算模块中，异常检测处理器在线计算输入时序信号的异常状态，而警报处理器在异常发生时发出通知。最后，在实验平台中，在部署之前对模型性能进行评估。此外，为用户提供了标记时间序列数据中异常区域的服务。实验平台建立在Azure机器学习服务之上。</p><p id="9b7c" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">总之，SR-CNN模型为时间序列异常检测问题提供了一种计算机视觉视角。它具有高度可扩展性，能够从生产中的数百万个信号中准确检测异常。</p><h1 id="44ce" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">结论</h1><p id="a507" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">人类天生被模式所吸引。我们喜欢创建我们在时间序列数据中发现的模式的心理模型，同时受时间限制，只查看最重要的信号。AI通过采用可扩展的软件架构和最先进的深度学习模型，帮助将异常检测扩展到数百万个信号。我们从基本的ARMA模型开始，并将我们的理解扩展到具有时间序列数据潜在表示的概率LSTM-VAE模型。我们还通过显著图和卷积神经网络的巧妙结合，从计算机视觉的角度研究了异常检测。在这两种情况下，我们发现无论我们是在模式中寻找可预测性，还是试图发现新的物理定律，人工智能都可以帮助异常检测。</p><h1 id="3932" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">参考</h1><p id="2f3f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">[1] S .西博尔德和j .佩克托尔德，“statsmodels:用python进行计量经济学和统计建模”:<a class="ae nf" href="https://www.statsmodels.org/" rel="noopener ugc nofollow" target="_blank">https://www.statsmodels.org/</a></p><p id="ed6f" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">[2] Park等人，“使用基于LSTM的变分自动编码器的机器人辅助喂食的多模态异常检测器”，arXiv 2018:【https://arxiv.org/pdf/1711.00614.pdf】T2</p><p id="8089" class="pw-post-body-paragraph kx ky iq kz b la mk jr lc ld ml ju lf lg mm li lj lk mn lm ln lo mo lq lr ls ij bi translated">[3]韩生任等。艾尔，“微软的时间序列异常检测服务”，KDD 2019:<a class="ae nf" href="https://arxiv.org/abs/1906.03821" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/abs/1906.03821</a></p></div></div>    
</body>
</html>