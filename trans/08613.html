<html>
<head>
<title>Using Azure Functions Core Tools to fetch app settings for local development</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure Functions核心工具获取本地开发的应用程序设置</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-azure-functions-core-tools-to-fetch-app-settings-for-local-development-c657866fb783?source=collection_archive---------11-----------------------#2021-08-09">https://towardsdatascience.com/using-azure-functions-core-tools-to-fetch-app-settings-for-local-development-c657866fb783?source=collection_archive---------11-----------------------#2021-08-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f3c3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Azure Function Core工具，我们可以从函数中检索设置，以简化我们的本地开发和调试工作！</h2></div><p id="000b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在部署我们的Azure功能之前，最好在本地调试我们的功能，以确保它按预期工作。本地运行我们的函数需要一个<em class="lb"> local.settings.json </em>文件来存储我们的应用程序设置。</p><p id="c7ac" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们第一次在Visual Studio中创建函数时，会为我们生成一个local.settings.json文件。但是，如果我们从一个库克隆一个功能app，这个文件就不会被克隆了！(<em class="lb">希望</em>它不会被克隆。最好不要把这个文件提交给你的回购，因为它有应用程序的秘密！).</p><p id="d004" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">幸运的是，我们可以使用Azure Function Core Tools创建一个local.settings.json文件，并将我们的函数设置导入到该文件中，这样我们就可以在本地运行我们的函数，就像我们在那个环境中运行它一样！</p><h1 id="6e3c" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">我们为什么要这么做？</h1><p id="fdbb" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">比方说，如果我们有多个环境(开发、测试、UAT等),我们希望使用这些环境设置在本地调试一个功能，我们可以使用Azure Function Core工具来简化这些设置的检索。尤其是对于有很多设置的函数。我们不想浪费时间复制和粘贴所有这些设置！</p><h1 id="1901" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">开始之前</h1><p id="9fb6" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">你需要确保你的机器上已经安装了<a class="ae lz" href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-run-local?tabs=windows%2Ccsharp%2Cportal%2Cbash%2Ckeda" rel="noopener ugc nofollow" target="_blank"> Azure功能核心工具</a>。Azure Functions核心工具包括一个支持Azure Functions运行时的相同运行时版本，我们可以在我们的机器上运行它。</p><p id="a8ad" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">虽然我们将只关注获取我们的应用程序设置，但函数核心工具附带了允许我们创建函数、部署函数等命令！</p><p id="df36" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您还没有安装这些工具，请查看本文档开始安装。</p><h1 id="1b99" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">我们开始吧</h1><p id="d9d8" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">对于本教程，我从GitHub克隆了一个现有项目。我已经把这个功能部署到Azure和我的。gitignore文件排除了我创建项目时生成的local.settings.json文件。</p><p id="e0f8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了帮助我进行本地调试，我将使用Function Core工具来帮助从Azure获取我的应用程序设置。为了验证本地设置文件不在我的项目目录中，这里有一个屏幕截图:</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/b4c46a85bc3986b478deeee87ac903f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/0*PbvMeeSjzHQ5gAyo.png"/></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">图片作者:Will Velida</p></figure><p id="2b72" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要创建一个JSON文件来写入我们的应用程序设置。为此，右键单击Functions项目并创建一个新文件。创建一个<em class="lb"> JavaScript JSON配置文件</em>，命名为<em class="lb"> local.settings.json </em></p><h1 id="32bd" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">步骤1:设置我们的Azure订阅</h1><p id="b7ad" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">如果你使用多个Azure订阅，我们需要使用AZ CLI来设置它，以确保当我们运行我们的功能核心工具时，它在正确的位置。</p><p id="6bfd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在您的计算机上打开命令行或PowerShell，并通过运行以下命令登录到您的Azure帐户:</p><pre class="mb mc md me gt mm mn mo mp aw mq bi"><span id="dae4" class="mr ld iq mn b gy ms mt l mu mv">az login</span></pre><p id="d018" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">登录后，您应该会看到您有权访问的订阅列表。要设置托管您的函数的订阅，请运行以下命令:</p><pre class="mb mc md me gt mm mn mo mp aw mq bi"><span id="6726" class="mr ld iq mn b gy ms mt l mu mv">az account set -s "&lt;subscription-name-or-id&gt;"</span></pre><p id="1f48" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">-s是订阅的简写参数。</p><h1 id="e41e" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">步骤2:获取我们的应用程序设置</h1><p id="c798" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">现在，我们可以从Azure的功能应用程序中获取应用程序设置。确保您位于项目的目录中，并在终端中运行以下命令:</p><pre class="mb mc md me gt mm mn mo mp aw mq bi"><span id="883f" class="mr ld iq mn b gy ms mt l mu mv">func azure functionapp fetch-app-settings '&lt;function-name&gt;' --output-file local.settings.json</span></pre><p id="5c00" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您应该会在终端中看到类似如下的输出:</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/bff65ede47c9126d74149ce86b9d563a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HmGG09A6fMS-e-7-.png"/></div></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">图片作者:Will Velida</p></figure><p id="8cbf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">回到Visual Studio中的项目，并签出您的<em class="lb"> local.settings.json </em>文件。我们可以看到，我们的函数设置已经被检索并写入我们的本地设置文件！</p><p id="64fe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，只有一个问题…</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/a7256d7d850c894745f5ae57004fe1d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WkMrg9sCFemOPfJE.png"/></div></div><p class="mi mj gj gh gi mk ml bd b be z dk translated">图片作者:Will Velida</p></figure><p id="3577" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的设置被加密了！当在本地运行我们的函数时，这对我们没有帮助！函数应用程序设置在存储时是加密的，只有在启动时被注入函数的进程内存之前才会被解密。</p><p id="29f9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要了解Azure Functions中应用程序设置的更多信息，请查看这篇<a class="ae lz" href="https://docs.microsoft.com/en-us/azure/azure-functions/security-concepts#application-settings" rel="noopener ugc nofollow" target="_blank">文章</a>。</p><h1 id="6106" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">第三步:解密我们的设置。</h1><p id="a1c6" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">谢天谢地，我们可以使用Azure Function Core工具解密我们的设置！在您的终端中，运行以下命令:</p><pre class="mb mc md me gt mm mn mo mp aw mq bi"><span id="dc4b" class="mr ld iq mn b gy ms mt l mu mv">func settings decrypt</span></pre><p id="210a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">回到Visual Studio，您将看到您的设置已经被解密，并准备好用于您的本地调试需要！</p><p id="c6fa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">(<em class="lb">当然我不会给你那个的截图！这是秘密！</em>😂😉).</p><p id="e3ba" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在可以在本地启动我们的功能，就像我们在Azure环境中运行它一样！</p><p id="f57e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里要注意一点！如果您在Key Vault中存储了一些应用程序设置(您应该这样做！)，则当您检索该设置时，您可能只能获得存储该机密的密钥库URL。要使用实际值，您需要从密钥库中检索它。</p><h1 id="ea4e" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">包扎</h1><p id="59dc" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">正如你所看到的，使用Azure Function Core工具可以帮助我们快速检索功能应用设置，从而加快我们的开发过程。</p><p id="ebac" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您想了解更多信息，请查看以下资源:</p><ul class=""><li id="d4a1" class="nb nc iq kh b ki kj kl km ko nd ks ne kw nf la ng nh ni nj bi translated"><a class="ae lz" href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-run-local?tabs=windows%2Ccsharp%2Cportal%2Cbash%2Ckeda" rel="noopener ugc nofollow" target="_blank">使用Azure功能核心工具</a></li><li id="888f" class="nb nc iq kh b ki nk kl nl ko nm ks nn kw no la ng nh ni nj bi translated"><a class="ae lz" href="https://github.com/Azure/azure-functions-core-tools" rel="noopener ugc nofollow" target="_blank"> Azure功能核心工具GitHub </a></li></ul><p id="1338" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您有任何问题，请随时在<a class="ae lz" href="https://twitter.com/willvelida" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上联系我或在评论中提问！</p><p id="3e78" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">编码快乐！👨‍💻👩‍💻💻</p></div></div>    
</body>
</html>