<html>
<head>
<title>The F1 score</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">F1的分数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-f1-score-bec2bbc38aa6?source=collection_archive---------0-----------------------#2021-08-31">https://towardsdatascience.com/the-f1-score-bec2bbc38aa6?source=collection_archive---------0-----------------------#2021-08-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6dcd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">你所需要知道的关于机器学习中的F1分数。其中有一个在Python中应用F1分数的示例。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6c39308cc541c31a257e6f5606c5d0b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*maNaKtE1pZzZgX38aUJ68Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">F1分数。Jonathan Chng 在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><h1 id="9f42" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍F1分数</h1><p id="55ef" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这篇文章中，你会发现F1的分数。F1分数是可以在分类模型中使用的机器学习度量。尽管分类模型有许多度量标准，但在本文中，您将发现F1分数是如何计算的，以及何时使用它有附加值。</p><p id="d272" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">f1分数是对两个更简单的性能指标的改进。因此，在深入了解F1分数的细节之前，让我们先回顾一下F1分数背后的那些指标。</p><h1 id="a449" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">准确(性)</h1><p id="427a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">准确性是分类模型的一个度量标准，它将正确的预测数作为所做预测总数的百分比来衡量。举个例子，如果你的预测有90%是正确的，那么你的准确率就是90%。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/f373f9465709ad47795bf8ddc4f562e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*M42uBmrCkkRlccOWSPvGRg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">准确度公式。作者配图。</p></figure><p id="1a43" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">只有当您的分类中有相等的类分布时，精确度才是一个有用的度量标准。这意味着，如果您在一个用例中观察到一个类的数据点比另一个类的数据点多，那么准确性就不再是一个有用的度量了。让我们看一个例子来说明这一点:</p><h2 id="7dff" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">不平衡数据示例</h2><p id="a029" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><em class="nf">想象你正在处理一个网站的销售数据。你知道99%的网站访问者不买东西，只有1%的访问者买东西。你正在建立一个分类模型来预测哪些网站访问者是买家，哪些只是旁观者。</em></p><p id="d13a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在想象一个不太好用的模型。它预测100%的访问者只是旁观者，0%的访问者是买家。这显然是一个非常错误和无用的模型。</p><blockquote class="ng"><p id="97c7" class="nh ni it bd nj nk nl nm nn no np mm dk translated">当你的班级不平衡时，准确性不是一个好的衡量标准。</p></blockquote><p id="cfa6" class="pw-post-body-paragraph lr ls it lt b lu nq ju lw lx nr jx lz ma ns mc md me nt mg mh mi nu mk ml mm im bi translated">如果我们在这个模型上使用精度公式会发生什么？你的模型只预测了1%的错误:所有的购买者都被错误地归类为外貌特征。因此，正确预测的百分比是99%。这里的问题是，99%的准确率听起来是一个很好的结果，而你的模型表现很差。总之:当你的班级不平衡时，准确性不是一个好的衡量标准。</p><h2 id="9b0e" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">通过重采样解决不平衡数据</h2><p id="0447" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">解决类不平衡问题的一个方法是<strong class="lt iu">在你的样本</strong>上工作。使用特定的采样方法，您可以对数据集进行重新采样，使数据不再不平衡。然后，您可以再次使用准确性作为衡量标准。<a class="ae ky" rel="noopener" target="_blank" href="/smote-fdce2f605729">在本文中，您可以了解如何使用欠采样、过采样和SMOTE数据扩充等方法。</a></p><h2 id="11db" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">通过指标解决不平衡的数据</h2><p id="5579" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">解决类别不平衡问题的另一种方法是使用<strong class="lt iu">更好的准确性指标，如F1分数</strong>，它不仅考虑了你的模型产生的预测错误的数量，还考虑了所产生的错误的类型。</p><h1 id="5ab0" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">精确度和召回率:F1分数的基础</h1><p id="cc3b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">精确度和召回率是考虑类别不平衡的两个最常见的度量。<strong class="lt iu">他们是</strong>也是<strong class="lt iu">F1成绩</strong>的基础！在下一部分<strong class="lt iu">将精确度和召回率结合到F1分数</strong>之前，让我们更好地了解一下精确度和召回率。</p><h1 id="f84d" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">精确度:F1分数的第一部分</h1><p id="591f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">精确度是F1分数的第一部分。它也可以用作单独的机器学习度量。它的公式如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/8769c6b1ef6812d2a9f91cf389d65641.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*hIPkZ3Su21sUdwi_A-arUg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">精确公式。作者配图。</p></figure><p id="ae5f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">你可以这样解释这个公式。<strong class="lt iu">在所有被预测为肯定的事物中，precision计算正确的百分比:</strong></p><ul class=""><li id="3413" class="nw nx it lt b lu mn lx mo ma ny me nz mi oa mm ob oc od oe bi translated">一个<strong class="lt iu">不精确的模型</strong>可能会发现很多阳性，但是它的选择方法是有噪音的:它也会错误地检测出很多实际上并不是阳性的阳性。</li><li id="3de0" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated">一个<strong class="lt iu">精确的模型</strong>是非常“纯粹”的:也许它没有找到所有的肯定，但是模型归类为肯定的那些很可能是正确的。</li></ul><h1 id="6e11" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">回忆:F1分数的第二部分</h1><p id="5519" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">回忆是F1分数的第二个组成部分，尽管回忆也可以用作单独的机器学习指标。召回的公式如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/c745dd7b24859562e4f5d0bb5a38953f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*8kzRR5Pl1SI2tRUa3CvNsA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">回忆公式。作者配图。</p></figure><p id="34e9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">你可以这样解释这个公式。<strong class="lt iu">在所有实际为正的事物中，模型成功找到了多少:</strong></p><ul class=""><li id="56a1" class="nw nx it lt b lu mn lx mo ma ny me nz mi oa mm ob oc od oe bi translated">具有<strong class="lt iu">高召回率</strong>的模型成功地在数据中找到所有<strong class="lt iu">阳性病例</strong>，即使它们也可能错误地将一些阴性病例识别为阳性病例。</li><li id="d517" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated">具有<strong class="lt iu">低召回率</strong>的模型不能在数据中找到所有(或大部分)阳性病例。</li></ul><h1 id="face" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">精确度与召回率</h1><p id="112f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了澄清，想一想下面的例子，一家超市出售了有问题的产品，他们需要召回它:他们只对确保他们找到所有有问题的产品感兴趣。如果客户退回一些没有问题的产品，这对他们来说并不重要，所以超市对精确度不感兴趣。</p><h2 id="fbc2" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">精确召回权衡</h2><p id="063c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">理想情况下，我们希望两者兼而有之:一个模型是<strong class="lt iu">识别我们所有的阳性病例</strong>，同时<strong class="lt iu">只识别阳性病例</strong>。</p><p id="0280" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">不幸的是，在现实生活中，我们不得不处理所谓的<strong class="lt iu">精确回忆权衡。</strong></p><p id="a039" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">精确度-召回率的权衡代表了这样一个事实，即在许多情况下，您可以调整模型以降低召回率为代价来提高精确度，或者另一方面以降低精确度为代价来提高召回率。</p><h1 id="af8b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">F1分数:精确度和召回率的结合</h1><p id="3464" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">精确度和召回率是F1分数的两个组成部分。F1分数的目标是<strong class="lt iu">将精度和召回指标合并成一个指标。</strong>与此同时，F1的分数被设计为<strong class="lt iu">在不平衡数据</strong>上工作良好。</p><h2 id="db3a" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">F1得分公式</h2><p id="68d1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">F1分数定义为精确度和召回率的调和平均值<strong class="lt iu">。</strong></p><p id="f8e0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><em class="nf">简单提醒一下，</em> <a class="ae ky" href="https://en.wikipedia.org/wiki/Harmonic_mean" rel="noopener ugc nofollow" target="_blank"> <em class="nf">调和平均值</em> </a> <em class="nf">是更常见算术平均值的替代指标。在计算平均比率时，它通常很有用。</em></p><p id="4f56" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在F1的分数中，我们计算<strong class="lt iu">的平均精确度和召回率</strong>。它们都是比率，因此使用调和平均值是一个合理的选择。F1得分公式如下所示:</p><p id="0f44" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这使得F1分数的公式如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/7e41c3adbe2d53ec19c361cce260223f.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*5V5OEP51o26FzwuEgqHojw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">F1得分公式。作者配图。</p></figure><p id="ee8c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">由于F1分数是精确度和召回率的平均值，这意味着<strong class="lt iu">F1分数给予精确度和召回率同等的权重:</strong></p><ul class=""><li id="9198" class="nw nx it lt b lu mn lx mo ma ny me nz mi oa mm ob oc od oe bi translated">如果精确度和召回率都很高，模型将获得高F1分数</li><li id="e2f4" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated">如果精确度和召回率都低，模型将获得低F1分数</li><li id="9912" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated">如果精度和召回率中的一个较低而另一个较高，模型将获得中等F1分数</li></ul><h1 id="72dd" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">F1分数应该取代其他指标吗？</h1><p id="dcb6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在整篇文章中，您已经看到了许多定义。在开始用Python实现F1分数之前，让我们总结一下何时使用F1分数，以及如何根据其他指标对其进行基准测试。</p><h2 id="a304" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">准确度与精确度和召回率</h2><p id="7100" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">准确度是最简单的分类标准。它只是衡量机器学习模型做出的正确预测的百分比。您已经看到，在不平衡数据的情况下，<strong class="lt iu">准确性是一个糟糕的指标，因为它无法区分特定类型的错误(假阳性和假阴性)。</strong></p><p id="5e58" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">精度和召回率是在数据不平衡时更适用的性能指标，因为它们允许考虑模型产生的错误类型(误报或漏报)。</p><h2 id="622a" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">F1分数与精确度和召回率</h2><p id="174d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">F1分数将精确度和召回率结合成了<strong class="lt iu">一个单一的指标</strong>。在许多情况下，像<a class="ae ky" rel="noopener" target="_blank" href="/gridsearch-the-ultimate-machine-learning-tool-6cd5fb93d07">自动基准测试，或者网格搜索</a>，只有一个性能指标比多个更方便。</p><h2 id="37ec" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">你应该使用F1的分数吗？</h2><p id="ed5e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">总之，当你有可能这样做的时候，你绝对应该<strong class="lt iu">查看你尝试的每个模型的多个指标</strong>。每个指标都有优点和缺点，每个都会给你关于你的模型的优点和缺点的具体信息。</p><p id="5581" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">真正的选择困难发生在进行自动模型训练时，或者使用<a class="ae ky" rel="noopener" target="_blank" href="/gridsearch-the-ultimate-machine-learning-tool-6cd5fb93d07">网格搜索调整模型</a>时。在这些情况下，您需要<strong class="lt iu">指定一个您想要优化的指标</strong>。</p><p id="58bc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这种情况下，我的建议是好好看看一个或几个样本模型的多个不同的度量。然后，当您<strong class="lt iu">理解您的特定用例</strong>的含义时，您可以选择一个指标进行优化或调整。</p><p id="f5b1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您<strong class="lt iu">将您的模型投入生产</strong>以供长期使用，您应该定期回来进行<strong class="lt iu">模型维护</strong>并验证模型是否仍能正常工作。</p><h1 id="69df" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">Python中的F1分数</h1><p id="5413" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在让我们来看一个例子，在这个例子中，我们将了解F1分数的附加值。我们将使用一个包含大量网站访问者数据的示例数据集。</p><p id="b332" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">本练习的目标是建立一个简单的分类模型，该模型使用四个独立变量来预测游客是否会买东西。我们将看到如何使用不同的指标，我们将看到不同的指标将如何给我们不同的结论。</p><p id="d716" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><em class="nf">在</em> <a class="ae ky" rel="noopener" target="_blank" href="/smote-fdce2f605729"> <em class="nf">中使用了相同的数据集，本文提出使用SMOTE上采样技术来提高模型性能</em> </a> <em class="nf">。</em></p><p id="10a5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们在这里不使用SMOTE，因为我们的目标是演示F1的分数。然而，如果您对处理不平衡的数据感兴趣，将这两种方法结合起来绝对是值得的。</p><h2 id="b975" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated"><strong class="ak">数据</strong></h2><p id="cc70" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您可以直接从<a class="ae ky" rel="noopener" target="_blank" href="/all-you-need-to-know-before-starting-with-github-ada7cf62dae2"> GitHub </a>将数据导入Python。以下代码允许您直接读取原始文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">F1分数。导入数据</p></figure><p id="9eb5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您将获得如下所示的数据帧:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/8763d801c640d8916baa17783e7dfa20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*-_tIfMZiMdvq9V_9s4c5Tg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">F1分数。数据集。作者配图。</p></figure><p id="c57e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这个数据集中，我们有以下五个变量:</p><ul class=""><li id="0d0e" class="nw nx it lt b lu mn lx mo ma ny me nz mi oa mm ob oc od oe bi translated">兴趣这个变量告诉我们游客是否最终购买了我们新的山地运动产品。</li><li id="b423" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated"><code class="fe op oq or os b">time_on_page</code>:访问者在页面上花费的时间</li><li id="db16" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated"><code class="fe op oq or os b">pages_viewed</code>:访问者浏览过我们网站的页数</li><li id="8e2a" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated"><code class="fe op oq or os b">interest_ski</code>:客户关系数据库中的一个变量，告诉我们游客之前是否购买过任何与滑雪相关的物品。</li><li id="03a3" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated"><code class="fe op oq or os b">interest_climb</code>`:客户关系数据库中的一个变量，告诉我们游客之前是否购买过任何与登山相关的物品。</li></ul><h2 id="4710" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">验证类别不平衡</h2><p id="c332" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我们的数据集中，我们只有很小比例的买家。如果您愿意，可以使用以下代码验证这一点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用条形图验证类别分布</p></figure><p id="20a0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您将获得以下条形图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/b7c16b0b323ac7d9ce835f43ff197c7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*_boFrThHmZ5wt6oXAKe43g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">F1分数。验证数据确实不平衡。作者配图。</p></figure><p id="e220" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">你可以在这里看到，与其他游客相比，买家非常少。这是为电子商务以及欺诈检测等其他类型的模型构建模型时经常发生的事情。这证实了F1的分数可能会派上用场。</p><h2 id="dcb9" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">列车测试分层</h2><p id="1535" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在构建任何模型之前，我们应该创建一个训练/测试分割。如果你不熟悉机器学习中的训练/测试方法，我建议你先看看这篇文章。</p><p id="5a97" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然而，<strong class="lt iu">当存在严重的类别不平衡时，进行标准的随机训练/测试分割是有风险的。</strong>由于阳性案例的数量非常少，您可能最终得到一个具有非常不同的类分布的训练集和测试集。您甚至可能在您的测试集中以接近零的阳性案例结束。</p><p id="755c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">分层抽样是一种避免扰乱样本中类别平衡的抽样方法。它允许您使用与原始数据中完全相同的类平衡来生成训练和测试集。您可以使用以下代码在scikitlearn中执行分层训练/测试采样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">F1分数。训练和测试数据的分层抽样。</p></figure><p id="2e5f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您愿意，可以使用与前面相同的代码来生成显示类分布的条形图。它将确认总数据中的类别分布与训练集和测试集中的类别分布完全相同。</p><h2 id="ec98" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">基线模型</h2><p id="96a1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">作为基线模型，我们将创建一个非常糟糕的模型，预测没有人购买任何东西。这归结为生成一个全为0的预测列表。您可以这样做:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">F1分数。创建一个非常糟糕的基线模型。</p></figure><p id="e1b4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">虽然我们已经知道这个模型很糟糕，但是我们还是要试着找出这个模型的准确性。您可以按如下方式使用scikitlearn的精确度功能:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">F1分数。使用精确度来评估我们的不良基线模型。</p></figure><p id="4210" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">我们非常坏的模型准确率高的惊人:95%！如果你从一开始就跟着做，你可能会明白为什么。在测试数据中，我们知道买家很少。该模型预测没有人购买任何东西。因此，它只对购买者(数据集的5%)是错误的。</strong></p><p id="53a8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这正是我们需要担心召回率和精确度的确切原因。让我们使用下面的代码来计算这个模型的召回率和精确度:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">F1分数。使用精度和召回来评估我们的坏基线模型。</p></figure><p id="0f99" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">请记住，Precision将告诉您正确预测的买家占预测买家总数的百分比。在这个非常糟糕的模型中，没有一个人被识别为买家，因此<strong class="lt iu">精度为0！</strong></p><p id="1161" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">另一方面，回忆告诉你在所有实际买家中你能找到的买家的百分比。由于你的模型还没有找到一个买家，<strong class="lt iu">召回也是0！</strong></p><p id="201c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们使用下面的代码来看看最终的F1分数是多少:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">F1分数。计算我们糟糕基线模型的F1分数。</p></figure><p id="b55b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">结果并不令人惊讶。由于F1分数是精确度和召回率的调和平均值，因此<strong class="lt iu"> F1分数也是0 </strong>。</p><p id="a4fb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这个例子中的模型根本不是一个智能模型。然而，这个例子表明<strong class="lt iu">在不平衡数据集</strong>上使用准确性作为衡量标准是非常危险的。这个模型实际上根本不是性能型的，性能评估为0是唯一公平的评估。在这个例子中，精确度、召回率和F1分数都被证明是更好的例子。</p><h2 id="1f26" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">更好的模型</h2><p id="7942" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">由于上一个例子中的模型非常简单，让我们用一个真实的模型重做另一个例子。对于第二个例子，我们将使用逻辑回归模型。让我们使用以下代码构建模型，看看会发生什么:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="0bcb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们对预测做一个详细的检验。在二元分类中(如我们示例中的具有两种结果的分类)，您可以使用混淆矩阵来区分四种类型的预测:</p><ul class=""><li id="7597" class="nw nx it lt b lu mn lx mo ma ny me nz mi oa mm ob oc od oe bi translated">真阳性(买家正确预测为买家)</li><li id="11fd" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated">误报(非买家被错误地预测为买家)</li><li id="9ce7" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated">真实否定(非买家被正确预测为非买家</li><li id="eab7" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated">假阴性(买家被错误地预测为非买家)</li></ul><p id="90d8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您可以在scikitlearn中获得混淆矩阵，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">F1分数。获得混淆矩阵。</p></figure><p id="78ac" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">结果如下:</p><ul class=""><li id="6001" class="nw nx it lt b lu mn lx mo ma ny me nz mi oa mm ob oc od oe bi translated">真实底片:280张</li><li id="f439" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated">误报:5</li><li id="4a9e" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated">假阴性:10</li><li id="7b3a" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated">真阳性:5</li></ul><p id="043e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这个模型评估数据非常详细。当然，将这一点纳入一个单一的性能指标会更容易。准确性是最简单的性能指标，因此让我们看看这个示例的准确性得分是多少:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">F1分数。在更好的模型上计算精度。</p></figure><p id="504e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">有趣的是，逻辑回归的准确率为95%:与我们非常糟糕的基线模型完全相同！</p><p id="6471" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们来看看Precision和Recall对此有何看法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">F1分数。在较优模型上计算精度和召回率。</p></figure><p id="a547" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们最终得到了以下精确度和召回率指标:</p><ul class=""><li id="564e" class="nw nx it lt b lu mn lx mo ma ny me nz mi oa mm ob oc od oe bi translated">精度为:0.5</li><li id="bb17" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated">回忆是:0.33</li></ul><p id="11da" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们也使用scikitlearn的f1分数来检查F1分数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">F1分数。在更好的模型上计算F1分数。</p></figure><p id="560a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">得到的F1分是0.4。</strong></p><h2 id="62be" class="mt la it bd lb mu mv dn lf mw mx dp lj ma my mz ll me na nb ln mi nc nd lp ne bi translated">哪个模型和度量更好？</h2><p id="b741" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">因此，精确度告诉我们，逻辑回归与糟糕的基线模型一样好，但是精确度和回忆告诉我们，逻辑回归更好。让我们试着理解为什么:</p><ul class=""><li id="f041" class="nw nx it lt b lu mn lx mo ma ny me nz mi oa mm ob oc od oe bi translated">两个模型的错误总数是一样的。因此<strong class="lt iu">精度</strong>是相同的。</li><li id="5c40" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated">第二个模型实际上能够找到(至少一些)正面案例(买家)，而第一个模型在数据中没有找到一个买家。因此，第二个模型的<strong class="lt iu">召回</strong>更高(逻辑回归为0.33，而不是第一个模型的0)。</li><li id="cfae" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated">第一个模型没有找到任何买家，因此精度自动为零。逻辑回归确实找到了一些买家，所以我们可以计算出一个精确度。<strong class="lt iu">精度</strong>显示了有多少预测的买家实际上是正确的。这个最后是50%。</li><li id="1e98" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated">F1分数<strong class="lt iu">是我们真正感兴趣的指标。该示例的目标是展示其对于不平衡数据建模的附加价值。第一款车型</strong>的<strong class="lt iu"> F1分数为0:我们对这个分数很满意，因为这是一款非常糟糕的车型。</strong></li><li id="90f1" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated">第二款的<strong class="lt iu"> F1分为0.4。这表明，第二个模型虽然远非完美，但至少是第一个模型的重大改进。这是有价值的信息，我们无法使用准确性作为衡量标准来获得，因为两个模型的准确性是相同的。</strong></li></ul><h1 id="be9b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="a081" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在本文中，F1分数被显示为模型性能指标。当处理数据集不平衡的分类模型时，F1值变得特别有价值。</p><p id="6111" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您已经看到F1分数将精确度和召回率结合成一个指标。这使得在网格搜索或自动优化中使用它很容易。</p><p id="f886" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在Python示例中，您已经看到了分类模型中不平衡数据集的情况。您已经看到了准确性是如何误导人的，因为它给了一个糟糕的模型一个很高的分数。在上一部分中，您已经看到F1分数在评估机器学习模型的性能方面效果更好。</p><p id="1e95" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我希望这篇文章对你有用。感谢阅读！</p></div></div>    
</body>
</html>