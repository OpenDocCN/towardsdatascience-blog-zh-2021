<html>
<head>
<title>What If Standard Is Not the Best</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如果标准不是最好的呢</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/what-if-standard-is-not-the-best-534fab31dc3e?source=collection_archive---------33-----------------------#2021-10-25">https://towardsdatascience.com/what-if-standard-is-not-the-best-534fab31dc3e?source=collection_archive---------33-----------------------#2021-10-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/adf05f31a01ffeb110064f8d1d2bfe98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PBkO08Xd1xp1Yevm"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">莎伦·麦卡琴在<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><div class=""/><div class=""><h2 id="5200" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">简单的解决方案并不总是最好的</h2></div><p id="aec5" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在研究过程中，在某些时候，我需要在<strong class="kx jh">大矩形矩阵</strong>上评估一个特定的度量(<a class="ae jd" href="https://en.wikipedia.org/wiki/Diversity_index" rel="noopener ugc nofollow" target="_blank">多样性指数</a>)。这与这个故事无关，但我说的是单细胞RNA测序数据。</p><p id="60e2" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在实践中，这有助于估计在群体中发现的<strong class="kx jh">不同</strong>成分的数量(例如，一本书中不同单词的数量)，并且<a class="ae jd" href="https://arxiv.org/abs/2103.09143" rel="noopener ugc nofollow" target="_blank">可以解释</a> [3]在许多复杂系统中出现的特殊幂律分布[1，2，4]。</p><h1 id="88da" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">熊猫</h1><p id="cd58" class="pw-post-body-paragraph kv kw jg kx b ky mj kh la lb mk kk ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">给定存储在文件中的数据，测量这个度量的问题可以使用著名的pandas库在一行Python代码中解决。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="8734" class="mx ls jg mt b gy my mz l na nb">pd.read_csv().apply(lambda x: len(np.unique(x)))</span></pre><div class="ip iq gp gr ir nc"><a href="https://pandas.pydata.org" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd jh gy z fp nh fr fs ni fu fw jf bi translated">熊猫</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">pandas是一个快速、强大、灵活且易于使用的开源数据分析和操作工具，构建于…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">pandas.pydata.org</p></div></div><div class="nl l"><div class="nm l nn no np nl nq ix nc"/></div></div></a></div><p id="09b6" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这对于许多应用来说是很好的，并且不需要数据科学家付出任何努力来实现它是非常直接的，但是..</p><p id="43c7" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我需要在大桌子上测量这个数量(单细胞数据有几十万个样本)，这个简单的任务对熊猫来说很慢。pandas方法需要很多时间将数据加载到内存中，然后在每一行上评估函数。</p><p id="e9f4" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一种更快的方法是在将行加载到内存中时立即处理它们，然后丢弃它们(节省内存是一个额外的好处)，所以我在scartch中实现了它。</p><h1 id="62f9" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">C++解决方案</h1><p id="94eb" class="pw-post-body-paragraph kv kw jg kx b ky mj kh la lb mk kk ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">我对这个特殊问题的解决方案使用了<em class="nr">标准模板库</em>和Boost。</p><h2 id="555c" class="mx ls jg bd lt ns nt dn lx nu nv dp mb le nw nx md li ny nz mf lm oa ob mh oc bi translated">这个想法</h2><p id="cac3" class="pw-post-body-paragraph kv kw jg kx b ky mj kh la lb mk kk ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">如上所述，这个想法是在这些行可用时尽快解析它们。我定义了一个<a class="ae jd" href="https://en.cppreference.com/w/cpp/thread/thread" rel="noopener ugc nofollow" target="_blank">线程</a>，<strong class="kx jh">读取</strong>文件，<strong class="kx jh">将其存储</strong>在<a class="ae jd" href="https://en.cppreference.com/w/cpp/container/queue" rel="noopener ugc nofollow" target="_blank">缓冲区</a>中，其他线程<strong class="kx jh">解析可用的读取行</strong>。因为我的度量是在列上估计的，所以我需要多个线程同时解析不同的行<strong class="kx jh">而不是</strong>到<strong class="kx jh">重叠</strong>，这是用一个<a class="ae jd" href="https://en.cppreference.com/w/cpp/thread/mutex" rel="noopener ugc nofollow" target="_blank">互斥</a>数组解决的(每列一个)。</p><h2 id="cd1b" class="mx ls jg bd lt ns nt dn lx nu nv dp mb le nw nx md li ny nz mf lm oa ob mh oc bi translated">有约束力的</h2><p id="81ac" class="pw-post-body-paragraph kv kw jg kx b ky mj kh la lb mk kk ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">使用<em class="nr">升压。Python </em>我能够将我新创建的模块加载到一个Python模块中，所以使用它会像熊猫一样容易。</p><div class="ip iq gp gr ir nc"><a href="https://boost.org" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd jh gy z fp nh fr fs ni fu fw jf bi translated">Boost C++库</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">Boost提供免费的同行评审的可移植C++源代码库。我们强调与C++配合良好的库…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">boost.org</p></div></div><div class="nl l"><div class="od l nn no np nl nq ix nc"/></div></div></a></div><p id="ad02" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面是一个绑定函数的例子</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="4d40" class="mx ls jg mt b gy my mz l na nb">#include &lt;boost/python.hpp&gt; </span><span id="e593" class="mx ls jg mt b gy oe mz l na nb">BOOST_PYTHON_FUNCTION_OVERLOADS(loadFile_overloads, loadFile&lt;long&gt;, 1, 3) </span><span id="56d3" class="mx ls jg mt b gy oe mz l na nb">BOOST_PYTHON_MODULE(pydiversity){    <br/>    namespace bp = boost::python;<br/>    using namespace bp;<br/>     def("diversity", loadFile&lt;long&gt;, loadFile_overloads(bp::args("file", "nThreads", "verbose", "out_filename")));<br/>}</span></pre><p id="baaa" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">它可以很容易地导入到python中</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="45d5" class="mx ls jg mt b gy my mz l na nb">import pydiversity<br/>pydiversity.diversity("mainTable.csv")</span></pre><h1 id="ae86" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">基准</h1><p id="65a8" class="pw-post-body-paragraph kv kw jg kx b ky mj kh la lb mk kk ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">我测量了解析一个有10000列和20000行的表的时间(你可以猜猜<a class="ae jd" href="https://bionumbers.hms.harvard.edu/bionumber.aspx?id=100310&amp;ver=9&amp;trm=number+of+genes+in+mouse&amp;org=" rel="noopener ugc nofollow" target="_blank">为什么</a>)，看起来我的解决方案比简单的熊猫<em class="nr">应用</em>的<strong class="kx jh">快60%。此外，我的解决方案可以利用运行它的机器的全部能力，在一台<strong class="kx jh">多核</strong>机器上，相对于Python实现，加速比为<strong class="kx jh"> 90% </strong>。</strong></p><h2 id="4a4c" class="mx ls jg bd lt ns nt dn lx nu nv dp mb le nw nx md li ny nz mf lm oa ob mh oc bi translated">英国泰晤士报(1785 年创刊)</h2><ul class=""><li id="cab3" class="of og jg kx b ky mj lb mk le oh li oi lm oj lq ok ol om on bi translated">Python使用<em class="nr">熊猫</em> : (8.05 0，11)s</li><li id="2f4e" class="of og jg kx b ky oo lb op le oq li or lm os lq ok ol om on bi translated">Python绑定单线程:(3.3 0，4)s</li><li id="524c" class="of og jg kx b ky oo lb op le oq li or lm os lq ok ol om on bi translated">使用多线程的Python绑定:(0，71 0，14)s</li><li id="52aa" class="of og jg kx b ky oo lb op le oq li or lm os lq ok ol om on bi translated">纯C++单线程:(3.2 0，3)s</li><li id="3efa" class="of og jg kx b ky oo lb op le oq li or lm os lq ok ol om on bi translated">纯C++多线程:(0，66 0，11)s</li></ul><h2 id="4def" class="mx ls jg bd lt ns nt dn lx nu nv dp mb le nw nx md li ny nz mf lm oa ob mh oc bi translated">加速</h2><p id="f91b" class="pw-post-body-paragraph kv kw jg kx b ky mj kh la lb mk kk ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">因为我的解决方案可以是多线程的，所以我测量了用越来越多的线程运行时的增益。我在一台6核机器上测量了加速比(1倍/(最慢时间))，有一个可感知的增益。</p><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ot"><img src="../Images/e2f8604073028bc3064e56b2535033e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oiw-_gEMXYaWCfqFGogUmQ.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">在6核机器上加速。图片作者。</p></figure><h1 id="f580" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">结论</h1><p id="1636" class="pw-post-body-paragraph kv kw jg kx b ky mj kh la lb mk kk ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">除了这个特殊的问题，我希望能激励人们不断深入研究，并在可能的情况下实施更有效的解决方案。很多次我听到“因为这是Python做这件事的方式”，但作为数据科学家，我认为我们应该提高自己，总是实施新的解决方案，我们不应该每次都接受最简单的解决方案。</p><h1 id="abfa" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">密码</h1><div class="ip iq gp gr ir nc"><a href="https://github.com/fvalle1/fastDiverse/" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd jh gy z fp nh fr fs ni fu fw jf bi translated">GitHub-f Valle 1/fast diversity:大表上多样性估计的快速实现</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">以快速有效的方式估计矩形矩阵中不同元素的数量。这很容易做到…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">github.com</p></div></div><div class="nl l"><div class="ou l nn no np nl nq ix nc"/></div></div></a></div><h1 id="fa05" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">参考</h1><ol class=""><li id="c203" class="of og jg kx b ky mj lb mk le oh li oi lm oj lq ov ol om on bi translated">Lazzardi S，Valle F，Mazzolini A，等<a class="ae jd" href="https://doi.org/10.1101/2021.06.16.448706" rel="noopener ugc nofollow" target="_blank">单细胞转录组数据中出现的统计规律。</a>(2021)bioRxiv 2021 . 06 . 16 . 448706。</li></ol><p id="04be" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">2.马佐利尼A，格拉尔迪M，卡塞尔M，等<a class="ae jd" href="https://doi.org/10.1103/PhysRevX.8.021023" rel="noopener ugc nofollow" target="_blank">复杂组分系统中共享组分的统计。</a> (2018)体检X</p><p id="1f46" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">3.Mazzarisi O，de Azevedo-Lopes A，阿伦松·JJ，Corberi F <a class="ae jd" href="https://arxiv.org/abs/2103.09143" rel="noopener ugc nofollow" target="_blank">极大多样性和齐夫定律。(2021) arXiv:210309143</a></p><p id="1495" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">4.语言学中的统计规律。 (2016)施普林格国际出版公司。</p></div></div>    
</body>
</html>