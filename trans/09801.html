<html>
<head>
<title>Power BI and Synapse, Part 2: What Synapse brings to a table?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Power BI和Synapse，第2部分:Synapse带来了什么？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/power-bi-and-synapse-part-1-the-art-of-the-im-possible-b561bb8f82ce?source=collection_archive---------5-----------------------#2021-09-14">https://towardsdatascience.com/power-bi-and-synapse-part-1-the-art-of-the-im-possible-b561bb8f82ce?source=collection_archive---------5-----------------------#2021-09-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0474" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在本系列的第2部分中，了解Synapse为Power BI开发人员带来了什么，以及如何利用这两种工具获得无限多的用例！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1925b0639731e71be835c1fba76f50c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BmWG7rbgno3oc1bXq9Q2mw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/photos/9HGPvHThNME" rel="noopener ugc nofollow" target="_blank">通过比较未溅上的纤维进行成像</a></p></figure><p id="67a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">通过在2019年底推出Azure Synapse Analytics，在数据处理方面开创了一个全新的视角。一些核心概念，如传统的数据仓库，受到了更多的审查，而在数据爱好者意识到Synapse带来的新功能后，各种新方法开始涌现。</em></p><p id="4b12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">【Synapse不仅对数据接收、转换和存储选项产生了巨大影响，它还为数据服务和可视化提供了全新的可能性！</p><p id="cd56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，在这一系列博文中，我将尝试探索Power BI如何与新平台协同工作。作为Power BI开发人员，我们在使用Synapse时有哪些选择？在哪些数据分析场景中，Synapse将发挥优势，帮助您实现(im)可能性？什么时候您想利用Synapse中的创新解决方案，什么时候您会更好地坚持使用更传统的方法？使用Power BI — Synapse combo的最佳实践是什么，在最终决定采用哪种方法之前，您应该评估哪些参数。</p><p id="fb70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">完成后，我相信您应该会更好地理解Power BI和Synapse之间集成时每个可用选项的“优缺点”。</em></p><ul class=""><li id="564d" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/power-bi-synapse-part-1-the-art-of-im-possible-b2bdb4d7c866"><em class="lv">Power BI&amp;Synapse Part 1—(im)可能的艺术！</em>T13】</a></li></ul><p id="9edb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们在本系列的<a class="ae ky" rel="noopener" target="_blank" href="/power-bi-synapse-part-1-the-art-of-im-possible-b2bdb4d7c866">上一篇</a>打下了扎实的理论基础，对Azure Synapse Analytics有了更多的了解之后，我相信是Power BI跳上舞台的时候了。</p><h1 id="11e8" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">面向Power BI开发人员的Synapse</h1><p id="c9cc" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li mz lk ll lm na lo lp lq nb ls lt lu im bi translated">正如在上一篇文章中已经强调的，微软使Synapse Analytics成为所有数据相关任务的一站式商店。也就是说，人们会期望Synapse和Power BI之间的紧密集成，因为Power BI被(正确地)视为表达数据和为用户提供各种业务见解的终极工具。</p><p id="a307" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Synapse与Power BI协同工作，反之亦然，不负众望！</p><p id="64d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们深入研究这两者之间的不同集成层之前，让我简要地向您介绍一下作为Power BI开发人员，您可能想要考虑使用Synapse的场景:</p><ul class=""><li id="7061" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated"><strong class="lb iu"> <em class="lv"> DirectQuery </em> </strong> —我已经详细写过<a class="ae ky" rel="noopener" target="_blank" href="/direct-query-in-power-bi-what-when-why-8180825812d2">direct query</a>，解释了它是什么，以及在哪些场景下应该考虑使用DQ。您可能还记得那篇文章，当涉及到报告性能时，DirectQuery绝不是最佳选择，因为每个可视化将生成至少一个对数据源的查询。但是，在特定情况下，除了使用DirectQuery，您将没有其他选择，Synapse可以在这些情况下成为您的朋友！稍后，我们将通过一个真实的例子来验证这在现实中是如何工作的…</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/019d4439c6b1d5884af7e17f113f3308.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*na4FTG813fEfrEXhIBQ6kA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">斯科特·韦伯在Unsplash上拍摄的照片</p></figure><ul class=""><li id="2e4b" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated"><strong class="lb iu"> <em class="lv">安全性</em> </strong> —如果您想到通过Azure Active Directory (AAD)进行Power BI身份验证，这也是Synapse的推荐标准，您可以很容易地想象在Synapse内的数据层级别处理Power BI解决方案的安全性的场景。这对于依赖DirectQuery选项的Power BI解决方案尤其重要，因为在使用导入模式时，您可能仍然希望实现行级安全性</li><li id="9679" class="lw lx it lb b lc nc lf nd li ne lm nf lq ng lu mb mc md me bi translated"><strong class="lb iu"> <em class="lv">数据整形</em> </strong> — Power BI有自己的一套用于执行数据整形的工具——最引人注目的——Power查询、数据流和DAX计算列和表。然而，这些都无法与Synapse中企业级的数据转换和准备功能相提并论。首先，Synapse附带了Azure Data Factory，这可能是数据编排任务最强大的工具。这意味着您可以在源端执行整体数据整形，因此您的Power BI报告可以从使用现成的解决方案中受益</li><li id="9af1" class="lw lx it lb b lc nc lf nd li ne lm nf lq ng lu mb mc md me bi translated"><strong class="lb iu"><em class="lv"/></strong>真理的单一来源——如果你正在处理数据，你可能会多次听到这句话。从本质上说，这是我们所有人的最终目标。因为从Synapse的一个角度来看，它代表了Azure SQL数据仓库的合法继承者，所以您可以利用这一点，将来自Synapse的数据用于您的Power BI报告，确信数据来自集中且经过批准的位置</li></ul><h1 id="0991" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">简而言之，电源BI存储模式</h1><p id="26a7" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li mz lk ll lm na lo lp lq nb ls lt lu im bi translated">在我们进一步研究Power BI如何受益于Synapse Analytics的协同作用之前，我们需要了解Power BI本身不同类型的存储模式。</p><p id="9bcb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经在本文中写了关于表格模型中的<a class="ae ky" rel="noopener" target="_blank" href="/how-to-reduce-your-power-bi-model-size-by-90-76d7c4377f2d">存储引擎，并详细解释了如何通过应用一些能够使VertiPaq实现最佳数据压缩的最佳实践来</a><a class="ae ky" rel="noopener" target="_blank" href="/how-to-reduce-your-power-bi-model-size-by-90-76d7c4377f2d">优化您的数据模型大小</a>。</p><p id="f3b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，这里对存储模式的简要概述将有助于更好地理解使用Synapse时的各种功能:</p><ul class=""><li id="b046" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated"><strong class="lb iu"> <em class="lv">导入模式</em> </strong> —基于VertiPaq。表数据作为快照存储在内存中。数据可以定期刷新</li><li id="d5b7" class="lw lx it lb b lc nc lf nd li ne lm nf lq ng lu mb mc md me bi translated"><strong class="lb iu"> <em class="lv">直接查询模式</em> </strong> —在查询时从数据源中检索数据。在查询执行之前、期间和之后，数据都驻留在其原始源中</li><li id="88d2" class="lw lx it lb b lc nc lf nd li ne lm nf lq ng lu mb mc md me bi translated"><strong class="lb iu"> <em class="lv">双模</em> </strong> —前两个选项的组合。表中的数据被加载到内存中，但是在查询时也可以直接从源中检索</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8198870a351a808434ea31953b7fd8a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*prTh5lzUxIlQzVw1vAns-g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/photos/AuztPcaE6CY" rel="noopener ugc nofollow" target="_blank">杰里米·贝赞格在Unsplash上拍摄的照片</a></p></figure><h1 id="8063" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">Synapse在这里适合做什么？</h1><p id="4d98" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li mz lk ll lm na lo lp lq nb ls lt lu im bi translated">好吧，现在你可能会问自己，当谈到Power BI开发时，Synapse带来了什么？</p><p id="3f6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将研究处理来自Synapse分析引擎的数据时的各种场景。您可能还记得上一篇文章，Synapse中有三个不同的分析引擎:无服务器SQL池、专用SQL池和Apache Spark池。</p><p id="c024" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每一种都有自己的优点和实际使用案例。但是，它们都有一个共同点，那就是它们很容易与Power BI集成！</p><p id="68dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我提到的，处理Apache Spark分析引擎将不在本博客系列中讨论。然而，如果你有兴趣了解Spark Analytic Engine如何与Power BI协同工作，你可以查看<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/hdinsight/spark/apache-spark-use-bi-tools" rel="noopener ugc nofollow" target="_blank">本教程</a>以了解更多细节。</p><p id="9bc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为本系列的下一篇文章将详细介绍Power BI和专用SQL池之间的集成，所以让我们在这里将重点放在使用无服务器SQL池作为Power BI报告的数据源上。</p><h1 id="3b00" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">别说了，演示时间到了！</h1><p id="3168" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li mz lk ll lm na lo lp lq nb ls lt lu im bi translated">现在，是时候尝试使用Synapse的分析引擎来存储Power BI消耗的数据，并评估不同的场景了。</p><p id="25db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，首先。在我们继续之前，您应该理解Synapse中链接服务的概念。基本上，使用链接服务，您可以利用Synapse之外存在的一整套不同的功能和服务，如Azure Data Lake、CosmosDB、Amazon Redshift、MongoDB等……其中之一是Azure HDInsight，如果您计划使用Apache Spark分析引擎的话。并且，通过链接它们，它们成为你的Synapse生态系统的一部分！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/dc9e41e8dacb73915fd600e659cf0bc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z4klUca93iaH1XhUZIN9RA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a45a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，在“管理”选项和“链接的服务”下，我已经链接了我的Power BI工作区，这意味着我可以直接从Synapse Analytics Studio立即开始开发我的Power BI报告！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/27b706d773e143fd691fb9c4a0ece8d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bjZAipeoKiUKW7LBittYuQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0544" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我单击Power BI下的开发时，我会看到我的工作区和可用的Power BI数据集和报告。目前还没有，所以我将单击新的Power BI数据集:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/2643cd9ce2b465a879f4ae90e3146806.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6JflYjAGfbrXLxAN2x6HIw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="70b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上一篇文章中，我展示了如何编写普通的T-SQL来查询来自parquet文件(以及CSV和JSON文件)的数据！并且，使用OPENROWSET函数，我创建了一个包含纽约市出租车乘坐数据的视图。这个数据集大约有15亿行，所以让我们看看如何在Power BI中可视化这个庞大数据集的数据。</p><p id="063c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">一个额外的提示</em> </strong>:如果某些AAD用户没有权限在数据库中创建对象，因此他们不能像我一样创建视图，他们仍然可以通过直接在Power BI中编写T-SQL查询，使用无服务器SQL池作为Power BI报告的数据源！</p><p id="5a3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只需选择Azure SQL数据库作为你的数据源，放入你的Synapse工作区的URL(这个可以在Serverless SQL Endpoint下找到)，输入数据库名称(如果没有数据库，输入:master)，直接在查询窗口写T-SQL就可以把你的数据导入Power BI！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/057915dc9ce7c7b1942b727afd67c4e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ox76spFQifL_TKQ8wrD1WQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6a35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个很棒的特性，并且打开了无数用例的大门！</p><p id="1297" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们不会深入讨论性能、优化、成本等细节。本演示的目的只是为了强调Synapse Analytics和Power BI之间集成的灵活性。</p><p id="b284" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于您在创建Synapse Analytics工作区时将获得默认提供的无服务器SQL池，因此我将选择我的无服务器SQL池作为数据源，然后下载自动创建的。pbids文件。一旦提供了专用SQL池或Apache Spark池，您也可以使用它们作为数据源(我将在下一篇文章中向您展示如何使用专用SQL池作为数据源)，但是为了简单起见，在本例中我将使用无服务器SQL池。</p><p id="6e8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我在Power BI Desktop中打开这个文件，我的数据就可以开始运行了！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/da449ac519d78e2b91698eaacd47e5f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5-2tXPvO71XfxZlOK944Rw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a0b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将使用DirectQuery来演示如何利用Synapse和Power BI的集成来处理海量数据。我只在我的报告画布上放置了一个视觉效果:显示以下度量的计算的卡片视觉效果:</p><p id="2015" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记录总数= COUNTROWS(nycYellow)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/adc7d05ef4824960bcfb813b632bbe94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4DZwMhRyjrMalAFEeQr7JA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="744e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您所看到的，我们正在使用我们最喜欢的报告工具——Power BI——查询一个巨大的数据集！而且，我们的用户连后台是什么都不知道。他们无法想象他们正在切割来自拼花文件的数据！而且，我们使用常规的T-SQL实现了它，不需要“物理地”传输和存储数据！本质上，我们在Synapse无服务器SQL池的帮助下创建了一个“虚拟”数据仓库。最后，由于这些数据是“普通”SQL视图的形式，我们能够在Power BI中与它进行交互，就像与本地SQL Server或Synapse专用SQL池中的任何其他视图进行交互一样！</p><p id="d6d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，不要忘记，我们在一个环境中执行了所有必需的步骤——Azure Synapse Studio！我们甚至直接从Synapse连接到Power BI Desktop这就是我一直强调的Synapse和Power BI之间的集成，这使得这两个乍一看完全不同的工具紧密结合在一起！</p><p id="ef2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Power BI Desktop中完成工作后，我可以将报告发布到Power BI工作区:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/a2007d0605de59a1b3c5da8aa351cade.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t-tTeHxTA6A40ereTT8zQQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="06eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">而且，由于我已经将我的Power BI工作区链接到Synapse Analytics Studio，我可以从那里直接访问我的报告！不仅如此，我还可以与报告进行交互，如果我想进行一些更改，我甚至可以直接从Synapse Analytics Studio中保存它！多酷啊！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/a8a8fd06de3bec762ee110902be4fa31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PyKpNaPKHM7fXnnpHOSdHA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="edda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是本博客系列的关键要点——当Synapse和Power BI一起使用时，可以释放校准数据工作负载的无限可能性！</p><h1 id="3e40" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">专用SQL池—保持传统！</h1><p id="1d0c" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li mz lk ll lm na lo lp lq nb ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">小测验问题:</em> </strong>你知道Azure Synapse Analytics的继任者是谁吗？是的，我知道，如果你看过<a class="ae ky" rel="noopener" target="_blank" href="/power-bi-synapse-part-1-the-art-of-im-possible-b2bdb4d7c866">系列的第一部</a>，答案就在那里。但是，如果你跳过了介绍部分(是的，你真可耻，回到那里从头开始读)，一个快速的答案将是:Azure SQL数据仓库。</p><p id="30f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正式来说，Synapse Analytics是在2019年底作为SQL DW的合法继任者推出的。然而，在你容易得出Synapse只是“SQL DW更名”的错误结论之前，你应该记住，Synapse不仅仅是另一个“传统的数据仓库”。通过包含无服务器SQL池和Apache Spark专用池，Synapse实质上成为了一种适用于各种不同数据工作负载的无限分析服务！</p><p id="8417" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在前一部分中，我们只触及了表面，解释了如何快速利用Synapse中的无服务器SQL池与Power BI协同工作，以快速了解驻留在传统数据仓库之外的数据。此外，您可能还记得，您不需要提供任何资源——使用普通的T-SQL，您可以直接从Azure Data Lake Gen2中查询数据！</p><p id="ac3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以利用Synapse中的Apache Spark分析引擎，但这超出了本系列文章的范围。</p><p id="6f48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Synapse中集成了这两个(无服务器SQL池和Apache Spark池)之后，人们可以假设旧的、传统的数据仓库已经死亡……而且，这将是一个快速而错误的结论。在许多场景和用例中，一个好的旧数据仓库将是最佳解决方案。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/b20f615e486628359587ef8082567ee9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*otUyt_Jgsb-Zh1bozahlMw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/photos/8ZQNDtD4oXw" rel="noopener ugc nofollow" target="_blank">图片由iStrfry Marcus在Unsplash上拍摄</a></p></figure><p id="717e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将研究具有关系数据的各种工作负载，这些数据存储在配置的分析引擎(专用SQL池)上，因此您可以认为，或多或少，我们正在后台处理一个很好的旧SQL服务器。</p><p id="185a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">说实话，专用SQL池是基于不同的架构，获得了使用MPP架构的好处。</p><p id="de5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我不会深入介绍<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/synapse-analytics/sql-data-warehouse/massively-parallel-processing-mpp-architecture" rel="noopener ugc nofollow" target="_blank"> MPP及其工作原理</a> —我只想强调，这种架构能够实现巨大的灵活性，因为您可以根据当前工作负载的数量和性质快速横向扩展您的资源。</p><p id="e28e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，与本地SQL Server相比，Synapse带来了一些额外的潜在性能提升，例如<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/synapse-analytics/sql-data-warehouse/performance-tuning-result-set-caching" rel="noopener ugc nofollow" target="_blank">结果集缓存</a>和<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/synapse-analytics/sql-data-warehouse/performance-tuning-materialized-views" rel="noopener ugc nofollow" target="_blank">物化视图</a>。同样，我不会深入讨论这两个特性的细节——如果你对详细了解物化视图感兴趣，我强烈建议你阅读Niko Neugebauer的博客<a class="ae ky" href="http://www.nikoport.com/2020/01/01/azure-sql-dw-materialized-views-part-1/" rel="noopener ugc nofollow" target="_blank">上的一系列文章。但是，您应该知道物化视图，因为我们将在这里的演示中使用它们…</a></p><p id="b31c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不要再说了，现在是演示时间！T13】</p><p id="6650" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在是时候动手使用Synapse的专用SQL池来存储Power BI所消耗的数据，并评估不同的场景了。</p><p id="8e9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，首先。与创建Synapse工作区时默认创建的无服务器SQL池相反，需要手动创建一个专用的SQL池。因此，我开始创建我的专用SQL池，并为其分配默认大小(DW100c ):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/de34adba3dc0377bce7a87ef4cbc533b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*d33h6A8a3g0_OLpzthEC1A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6322" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像往常一样，在处理Power BI时，我使用一个示例Contoso数据库进行演示。我已经在我的专用SQL池中提供了这个数据库，并为factOnlineSales表和两个维度表导入了数据:dimDate和dimProduct。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/829956ee79573fa7ae54f1459cefa305.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*LSKfeTiC2VPqH-tx-t0QfQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="1699" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，在“管理”选项和“链接的服务”下，我已经链接了我的Power BI工作区，这意味着我可以直接从Synapse Analytics Studio立即开始开发我的Power BI报告！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/b3a6cdec81d0a3a8af9bcea3d26823e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*v7iIepYUupI0axl59Tmu-Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="fb2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我单击Power BI下的开发时，我会看到我的工作区和可用的Power BI数据集和报告。目前还没有，所以我将单击新的Power BI数据集:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/0c46774b44e9985eebc54510b09ad030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*B_7DNv15LALMVEczi_yo7A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="dc77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将选择我的专用SQL池作为数据源，然后下载自动创建的。pbids文件。一旦我在Power BI Desktop中打开这个文件，我的数据就可以开始运行了！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/35dbdc76a7585f8d17e91ba2a14bfc78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*jizjLJAqZarVQMguilW7mA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b4fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，实际上，我的事实表有大约1200万行，这在容量上没什么特别的——我的意思是，Power BI应该能够毫无问题地处理这个问题。但是，让我们假设我们的事实表有12亿行，因此在现有粒度级别上导入整个表是不可行的。我们将使用DirectQuery来演示如何利用Synapse和Power BI的集成来处理专用SQL池中的海量数据。</p><p id="d186" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我创建了一个用于计算销售额总和的<a class="ae ky" rel="noopener" target="_blank" href="/understanding-explicit-vs-implicit-measures-in-power-bi-e35b578808ca">显式度量</a>，并在报告画布上放置了三个简单的视觉效果:一个显示每年的总销售额，另一个显示每个品牌的总销售额，最后一个显示按品牌和年份细分的销售额:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/296e3405665e41dcd8b6bdf21a720da9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*DlTsSQ1frNRg02DttY88Rw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="f18f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我将连接到一个<a class="ae ky" href="https://daxstudio.org/" rel="noopener ugc nofollow" target="_blank"> DAX工作室</a>，这样我可以更深入地了解后台正在发生的事情。如果我从顶部功能区打开服务器计时，我可以粘贴我的DAX代码并检查在后台生成的SQL查询，以及检索结果所用的总时间:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/b3b1248caa23ea5d4c2759c971dec766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*fXhKZnh4kPXWsGQvSJKBJA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="f668" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，这与SQL Server的工作方式非常相似。现在不要离开，我保证我们会添加更多的成分来改善指标。那么，为了加快数据检索，我们能做些什么呢？</p><p id="fd66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一点也是最重要的一点是:<strong class="lb iu"> <em class="lv">您需要了解您的分析工作量！</em> </strong>这意味着，如果您知道有很多针对这三个表的查询，并且请求相同的数字(每个品牌/年的销售额)，您可以做两件事:</p><ul class=""><li id="87d8" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">创建一个<strong class="lb iu"> <em class="lv">聚合表，并将其设置为导入模式</em> </strong>，享受使用复合模型的好处。这是最理想的场景，只要聚合表能够适合Power BI中的数据模型大小，就应该使用它。使用这一概念，您的聚合表将存储在Power BI高速缓存中，经过优化压缩，而包含所有详细信息的巨大表将继续驻留在Synapse专用SQL池中</li><li id="48e6" class="lw lx it lb b lc nc lf nd li ne lm nf lq ng lu mb mc md me bi translated">在Synapse专用SQL池 中创建一个<strong class="lb iu"> <em class="lv">物化视图。本质上，您也可以聚合数据，但是您不会在Power BI中导入它，因为您将使用DirectQuery模式来定位这个视图。实体化视图只不过是一个虚拟表，但与“标准”视图(每次使用时都会计算数据)不同，实体化视图会像普通表一样在专用的SQL池中预先计算、存储和维护其数据！因此，您可以为最频繁的工作负载获得更快的性能，但作为一种代价，您要为额外的存储付出代价</em></strong></li></ul><p id="48c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我已经在我的Synapse专用SQL池中创建了一个物化视图，使用了以下T-SQL代码:</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="57f1" class="np mg it nl b gy nq nr l ns nt">CREATE MATERIALIZED VIEW mvwSalesAmtBrandYear WITH (DISTRIBUTION=HASH(BrandName)) AS<br/>SELECT  SUM(f.[SalesAmount]) AS [SalesAmount]<br/>       ,p.[BrandName]<br/>       ,YEAR(d.[DateKey]) AS [Year]<br/>FROM    [cso].[FactOnlineSales] AS f<br/>INNER JOIN    [cso].[DimProduct] AS p ON f.[ProductKey] = p.[ProductKey]<br/>INNER JOIN    [cso].[DimDate]    AS d on f.[DateKey] = d.[DateKey]<br/>GROUP BY p.[BrandName]<br/>        ,YEAR(d.[DateKey])</span></pre><p id="cf0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们转到Power BI Desktop，将这个视图添加到我们的数据模型中，并将我们的视觉效果切换到所需数据的物化视图。现在，如果我在DAX Studio中检查服务器计时，我可以注意到显著的改进:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/1c3fd906ea3c01ecb63f5b8de13b5245.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*FwfdtVXYBIMpktC0w6BkcQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a0bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你所注意到的，我们得到了完全相同的数字，完全相同的视觉效果，快了10倍！仅仅因为我们在Synapse专用的SQL池中有预聚合的数据。</p><p id="bd87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后要检查的是，如果我们在Power BI中导入物化视图会发生什么:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/479737497bb01882354c0879b08fdb08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*CSxKMIaijLQvasXH-AOoUw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="d2da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我刷新图像，我会得到以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/f714e4d97de38255287964ec7478787f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*U3junTl8f-qqZdLBuwHOMA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="9db5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与第一次运行的3.505毫秒相比，我的视觉效果现在只需要9毫秒就可以呈现出来了！我将让您自己来计算…在最后一次运行中，右边的窗口中没有“常规的”SQL查询，因为现在数据是直接从Power BI的表格模型中存储和检索的。</p><p id="6a56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我已经提到的，您也可以在Power BI桌面模型视图中处理聚合，但是这是一个完全不同的主题，超出了本系列的范围。</p><p id="1edc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本演示中，我想向您展示如何无缝集成Synapse Analytics专用SQL池和Power BI。</p><p id="2d2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Power BI Desktop中完成工作后，我可以将报告发布到Power BI工作区:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/4b50ac6818f7a7df3cb5a97bc1a4d122.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*felV6s5LSTjpgc4g8crpjw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6712" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能还记得我们之前的演示，因为我已经将Power BI工作区链接到Synapse Analytics Studio，所以我可以从那里直接访问我的报告！不仅如此，我还可以与报告进行交互，如果我想进行一些更改，我甚至可以直接从Synapse Analytics Studio中保存它！多牛逼啊！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/f2e7c0b21ee5b7bc083ce2e7bf784379.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*YFAkk-rLuP-Mg_4ZVi0EBA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="c125" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我再次强调本博客系列的关键要点——当Synapse和Power BI一起使用时，可以释放校准数据工作负载的无限可能性！</p><p id="ad57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">结论</em> </strong></p><p id="3038" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们研究了Synapse Analytics和Power BI之间的不同集成方式，在这些场景中，您正在处理以传统数据仓库的典型方式存储的关系数据。</p><p id="dd2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们证明了您不需要放弃传统，即使您计划将工作负载转移到Synapse。相反，您可以利用它，并基于已建立并经过数十年验证的传统数据仓库概念构建一个现代数据解决方案。如果您有兴趣了解更多关于使用专用SQL池作为Power BI报告数据源的最佳实践，您可以参考<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/synapse-analytics/sql-data-warehouse/sql-data-warehouse-best-practices" rel="noopener ugc nofollow" target="_blank">这篇文章</a>。</p><p id="7d03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一篇文章中，我们将深入关注Power BI和Synapse之间的不同集成层，在处理半结构化(存储在文件中的数据)方面，使用Synapse Analytics中的无服务器SQL池。</p><p id="0256" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p><p id="71d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">成为会员，阅读媒体上的每一个故事！</p></div></div>    
</body>
</html>