<html>
<head>
<title>Geographical plotting of maps with Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Plotly绘制地图的地理图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/geographical-plotting-of-maps-with-plotly-4b5a5c95f02a?source=collection_archive---------10-----------------------#2021-06-13">https://towardsdatascience.com/geographical-plotting-of-maps-with-plotly-4b5a5c95f02a?source=collection_archive---------10-----------------------#2021-06-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5b3f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Plotly创建交互式地图来显示您的数据。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a862ddca04b0520c91d229c66c6b337c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*y2yO8gtk3XuyePOI"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Marjan Blan | @marjanblan 在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="a4f2" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak">什么是地理标图？</strong></h1><p id="75a1" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">地理绘图是一种显示全球范围以及一个国家各州数据的方法，通常以丰富多彩的方式显示。它在数据分析和可视化中起着重要的作用。它通常在构建仪表板以呈现广泛的数据时使用。</p><p id="abac" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为了创建交互式地图，我们使用python的plotly库。Plotly用于制作交互式图形，以及创建其他可视化。</p><p id="a834" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">点击<a class="ae kv" href="https://medium.com/swlh/principles-of-plotly-e7c9abb88528" rel="noopener">此处</a>了解更多关于plotly的信息。</p><p id="e34c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们把这个教程分成两部分。在第一部分中，我们将关注基于国家的地理绘图数据，在我们的例子中，这将是美国的农业出口。在第二部分，我们将使用一个随机的全球GDP数据集。这两个数据集都可以在<a class="ae kv" href="https://github.com/jendcruz22/Medium-articles/tree/master/Geographical%20plotting%20with%20plotly" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h2 id="e185" class="mp kx iq bd ky mq mr dn lc ms mt dp lg lx mu mv li mb mw mx lk mf my mz lm na bi translated"><strong class="ak">先决条件:</strong></h2><p id="080f" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">对python编程的基本理解。特别是python的<a class="ae kv" rel="noopener" target="_blank" href="/visualizations-with-matplotlib-4809394ea223"> matplotlib </a>和<a class="ae kv" href="https://medium.com/swlh/principles-of-plotly-e7c9abb88528" rel="noopener"> plotly </a>库。</p><p id="88d8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">首先导入以下模块:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="4c67" class="mp kx iq nc b gy ng nh l ni nj">import pandas as pd<br/>import chart_studio.plotly as py<br/>import plotly.offline as po<br/>import plotly.graph_objs as pg<br/>import matplotlib.pyplot as plt<br/>%matplotlib inline</span></pre><p id="4f5e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">你需要启动plotly的笔记本模式来显示笔记本里面的情节。这将允许您离线生成图形并将它们保存在本地机器中。</p><p id="82ad" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这可以通过以下方式完成:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="c483" class="mp kx iq nc b gy ng nh l ni nj">po.init_notebook_mode(connected = True)</span></pre><p id="1473" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们加载了基于美国农业出口的第一个数据集。</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="a313" class="mp kx iq nc b gy ng nh l ni nj">AE = pd.read_csv(‘AgriculturalExport.csv’)<br/>AE.head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/1323efe3fa24b48442e72c481ad2b92e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hEFTHi56a5_FdAf-EfLG_w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="fd73" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在这里，州代码是至关重要的，因为当我们绘制地理图时，它可以帮助我们定位。</p><p id="de52" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在绘制数据时，您需要考虑几个因素，例如:您需要什么样的输出？要显示哪些位置？每个位置需要显示的值是什么？最后但同样重要的是，需要什么样的颜色、样式或文字？所有这些基本值都在我们的数据变量(即字典)下。您可以使用不同的地图类型。这里我们使用的是choropleth，这是一个不需要任何其他库的基本图形。然后我们有位置，即位置代码。接下来，我们需要locationmode，它告诉我们计划指定位置的方法。在我们的示例中，我们将位置模式设置为usa-states。现在我们需要位置的值，然后当鼠标悬停在每个提到的位置上时显示文本。</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="dd05" class="mp kx iq nc b gy ng nh l ni nj">data = dict(type = ‘choropleth’, <br/> locations = [‘AL’, ‘AK’, ‘AR’, ‘CA’], <br/> locationmode = ‘USA-states’, <br/> z = [1,2,30,40,50], <br/> text = [‘alabama’, ‘alaska’, ‘arizona’, ‘pugger’, ‘california’])</span></pre><p id="aa30" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在布局变量中，我们只需要用geo表示的范围。确保美国不是用大写字母写的，因为那会导致错误。</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="4696" class="mp kx iq nc b gy ng nh l ni nj">layout = dict(geo = {'scope':'usa'})</span></pre><p id="f249" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">x变量使用我们之前导入的plotly.graph_objs模块来绘制状态的结构。在我们的例子中，那是美国。我们向x传递两个参数:数据和布局。数据表示在特定范围上表示的数据；布局定义了我们在那里使用什么样的范围。</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="27dc" class="mp kx iq nc b gy ng nh l ni nj">x = pg.Figure(data = [data] ,<br/>layout = layout)<br/>po.iplot(x)</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="da0c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在，我们只需要根据数据集中可用的值来更改布局和数据。我们编写AE['code']从我们的数据集中调用州代码，而不是键入每个州的代码。类似地，z将表示每个州的总出口，如下所示。谈到文本变量，我们的数据集包括一个名为text的列，显示每个州的农业出口的所有数据，因此我们没有将文本变量更改为州名，而是编写AE['text']。从而显示每个州的所有导出信息。</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="a3a2" class="mp kx iq nc b gy ng nh l ni nj">data = dict(type = 'choropleth', <br/>            locations = AE['code'], <br/>            locationmode = 'USA-states', <br/>            z = AE['total exports'], <br/>            text = AE['text'])</span></pre><p id="ddb1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">至于布局，我们现在讨论的不仅仅是范围，所以我们可以添加显示湖和标题，如下所示:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="088a" class="mp kx iq nc b gy ng nh l ni nj">layout = dict(title = 'USAs Agricultural Exports', <br/>              geo = dict(scope = 'usa' , <br/>                         showlakes = True, <br/>                         lakecolor = 'rgb(0,191,255)'))</span><span id="94ee" class="mp kx iq nc b gy nn nh l ni nj">x = pg.Figure(data = [data], <br/>              layout = layout)<br/>po.iplot(x)</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="caf8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">您可以使用不同的色标，如波特兰、绿色等，甚至可以为您的数据添加颜色条，如下所示:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="b0c7" class="mp kx iq nc b gy ng nh l ni nj">data = dict(type = 'choropleth', <br/>            locations = AE['code'], <br/>            locationmode = 'USA-states', <br/>            z = AE['total exports'], <br/>            text = AE['text'], <br/>            colorscale = 'Greens', <br/>            colorbar = {'title' : 'colorbar'})</span><span id="6275" class="mp kx iq nc b gy nn nh l ni nj">layout = dict(title = 'USAs Agricultural Exports with the lakes', <br/>              geo = dict(scope='usa' , <br/>                       showlakes = True, <br/>                       lakecolor = 'rgb(0,191,255)'))</span><span id="0839" class="mp kx iq nc b gy nn nh l ni nj">x = pg.Figure(data = [data], <br/>              layout = layout)<br/>po.iplot(x)</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="dd31" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们现在已经到了文章的第二部分，我们将绘制全球范围的地理图表。为此我们将使用我们的<a class="ae kv" href="https://github.com/jendcruz22/Medium-articles/blob/master/Geographical%20plotting%20with%20plotly/GlobalGDP.csv" rel="noopener ugc nofollow" target="_blank">全球GDP数据集</a>。</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="7232" class="mp kx iq nc b gy ng nh l ni nj">G_GDP = pd.read_csv('GlobalGDP.csv')<br/>G_GDP.head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/07bc9b3234a45b80c7a48fcccabb7b1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:696/format:webp/1*GFyMdhqbwvhrbd47HLKgEQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="a74b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">所以，让我们再次定义数据和布局。</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="fae5" class="mp kx iq nc b gy ng nh l ni nj">data = dict(type='choropleth', <br/>            locations = G_GDP['CODE'], <br/>            z = G_GDP['GDP (BILLIONS)'], <br/>            text = G_GDP['COUNTRY'])</span></pre><p id="40f2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">当我们在全球范围内绘制地图时，布局现在将由投影属性而不是范围组成。</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="6297" class="mp kx iq nc b gy ng nh l ni nj">layout = dict(title = 'Global GDP - hammer projection',<br/>              geo = dict( projection = {'type':'<strong class="nc ir">hammer</strong>'},<br/>                         showlakes = True, <br/>                         lakecolor = 'rgb(0,191,255)'))</span><span id="7936" class="mp kx iq nc b gy nn nh l ni nj">x = pg.Figure(data = [data], <br/>              layout = layout)<br/>po.iplot(x)</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="b0be" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这些图的有趣之处在于，您可以方便地放大、浏览和查看绘制在全球各地的数据。这是因为我们的投影类型:锤子。我们可以使用其他投影类型查看相同的数据，如自然地球、罗宾逊、墨卡托、立体投影等。下面给出了一些投影类型的代码和输出。</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="ed55" class="mp kx iq nc b gy ng nh l ni nj">layout = dict(title = 'Global GDP - robinson projection', <br/>              geo = dict( projection = {'type':'<strong class="nc ir">robinson</strong>'}, <br/>                         showlakes = True, <br/>                         lakecolor = 'rgb(0,191,255)'))</span><span id="30ea" class="mp kx iq nc b gy nn nh l ni nj">x = pg.Figure(data = [data], <br/>              layout = layout) <br/>po.iplot(x)</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="383a" class="mp kx iq nc b gy ng nh l ni nj">layout = dict(title = 'Global GDP - natural earth projection', <br/>              geo = dict( projection = {'type':'<strong class="nc ir">natural earth</strong>'}, <br/>                         showlakes = True, <br/>                         lakecolor = 'rgb(0,191,255)'))<br/>x = pg.Figure(data = [data], <br/>              layout = layout)<br/>po.iplot(x)</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="acdb" class="mp kx iq nc b gy ng nh l ni nj">layout = dict(title = 'Global GDP - mercator projection', <br/>              geo = dict(projection = {'type':'<strong class="nc ir">mercator</strong>'}, <br/>                       showlakes = True, <br/>                       lakecolor = 'rgb(0,191,255)'))</span><span id="272c" class="mp kx iq nc b gy nn nh l ni nj">x = pg.Figure(data = [data], <br/>              layout = layout)<br/>po.iplot(x)</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="3fbc" class="mp kx iq nc b gy ng nh l ni nj">layout = dict(title = 'Global GDP - stereographic projection', <br/>              geo = dict(projection = {'type':'<strong class="nc ir">stereographic</strong>'}, <br/>                       showlakes = True, <br/>                       lakecolor = 'rgb(0,191,255)'))</span><span id="fc24" class="mp kx iq nc b gy nn nh l ni nj">x = pg.Figure(data = [data], <br/>              layout = layout)<br/>po.iplot(x)</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="1e6d" class="mp kx iq nc b gy ng nh l ni nj">layout = dict(title = 'Global GDP - orthographic projection', <br/>              geo = dict( projection = {'type':'<strong class="nc ir">orthographic</strong>'}, <br/>                       showlakes = True, <br/>                       lakecolor = 'rgb(0,191,255)'))</span><span id="0be1" class="mp kx iq nc b gy nn nh l ni nj">x = pg.Figure(data = [data], <br/>              layout = layout)<br/>po.iplot(x)</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="0627" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">您可以移除投影的边界，如下所示:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="c972" class="mp kx iq nc b gy ng nh l ni nj">layout = dict(title = 'Global GDP - robinson projection without borders', <br/>              geo = dict(showframe = False, <br/>                       projection = {'type':'robinson'}, <br/>                       showlakes = True, <br/>                       lakecolor = 'rgb(0,191,255)'))</span><span id="f801" class="mp kx iq nc b gy nn nh l ni nj">x = pg.Figure(data = [data], layout = layout)<br/>po.iplot(x)</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="d784" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">要了解更多关于Plotly的地图配置和样式，你可以参考它的<a class="ae kv" href="https://plotly.com/python/maps/" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="0b96" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这篇文章的全部代码可以在<a class="ae kv" href="https://github.com/jendcruz22/Medium-articles/tree/master/Geographical%20plotting%20with%20plotly" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="a86f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我希望这个快速教程是有帮助的。谢谢你阅读它！</p><blockquote class="np nq nr"><p id="7d37" class="lo lp ns lq b lr mk jr lt lu ml ju lw nt mm lz ma nu mn md me nv mo mh mi mj ij bi translated">你可以在这里联系我<a class="ae kv" href="https://jennysresume.netlify.app/portfolio/contact.html" rel="noopener ugc nofollow" target="_blank"/>。</p></blockquote></div></div>    
</body>
</html>