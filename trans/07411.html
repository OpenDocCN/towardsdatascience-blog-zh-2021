<html>
<head>
<title>A Simple HDR Implementation on OpenCV Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OpenCV Python上一个简单的HDR实现</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-simple-hdr-implementation-on-opencv-python-2325dbd9c650?source=collection_archive---------12-----------------------#2021-07-06">https://towardsdatascience.com/a-simple-hdr-implementation-on-opencv-python-2325dbd9c650?source=collection_archive---------12-----------------------#2021-07-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="66bf" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何使用Python和OpenCV创建高动态范围(HDR)图像</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5522672c3e3b11263bf03c78b5a70fdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Gs1coATrZ38FdwvG"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kv" href="https://unsplash.com/@thevantagepoint718?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Lerone Pieters </a>拍摄</p></figure><p id="a670" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">HDR图像包含了不同曝光的多幅图像的信息。在光源不均匀的场景中，单次拍摄可能会使图像的某些区域过度曝光，并且由于亮度增加，细节会丢失。相反，这张照片也可能出现曝光不足的区域，这也将导致信息丢失。</p><p id="a21e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要创建HDR图像，您需要:</p><ol class=""><li id="6d74" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">用不同的曝光量拍照。最少2个，通常3个，你可以使用3个以上的图像，但这将占用大量的CPU资源。</li><li id="1429" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">对齐图像。即使你使用三脚架，你也需要执行这一步(我们说的是像素级对齐)。没有正确对齐您的图像将导致您的HDR图像中的伪像和“幽灵”。</li><li id="ea3a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">将对齐的图像合并为一个。</li><li id="ea14" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">对合并的图像执行色调映射。在自然界中，最小的可能亮度是零，但最大值不限于255，事实上没有限制，它可以是无穷大。为此，我们需要将第三步中获得的图像映射到(0，255)范围。这可以通过色调映射来实现。</li></ol><h1 id="5b45" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">例子</h1><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="a51a" class="nd mh iq mz b gy ne nf l ng nh">import cv2 as cv</span><span id="1768" class="nd mh iq mz b gy ni nf l ng nh">import numpy as np</span><span id="abe8" class="nd mh iq mz b gy ni nf l ng nh"># Loading exposure images into a list</span><span id="9523" class="nd mh iq mz b gy ni nf l ng nh">img_fn = [r"C:\Users\felipe.cunha\Documents\venv\HDRTest\100.jpg", r"C:\Users\felipe.cunha\Documents\venv\HDRTest\250.jpg", r"C:\Users\felipe.cunha\Documents\venv\HDRTest\500.jpg"]</span><span id="25c7" class="nd mh iq mz b gy ni nf l ng nh">img_list = [cv.imread(fn) for fn in img_fn]</span><span id="d2a5" class="nd mh iq mz b gy ni nf l ng nh">exposure_times = np.array([100, 250, 500], dtype=np.float32)</span><span id="f792" class="nd mh iq mz b gy ni nf l ng nh"># Merge exposures to HDR image</span><span id="e0cf" class="nd mh iq mz b gy ni nf l ng nh">merge_debevec = cv.createMergeDebevec()</span><span id="9d60" class="nd mh iq mz b gy ni nf l ng nh">hdr_debevec = merge_debevec.process(img_list, times=exposure_times.copy())</span><span id="e6db" class="nd mh iq mz b gy ni nf l ng nh">merge_robertson = cv.createMergeRobertson()</span><span id="9968" class="nd mh iq mz b gy ni nf l ng nh">hdr_robertson = merge_robertson.process(img_list, times=exposure_times.copy())</span><span id="02de" class="nd mh iq mz b gy ni nf l ng nh"># Tonemap HDR image</span><span id="1fb4" class="nd mh iq mz b gy ni nf l ng nh">tonemap1 = cv.createTonemap(gamma=2.2)</span><span id="22c9" class="nd mh iq mz b gy ni nf l ng nh">res_debevec = tonemap1.process(hdr_debevec.copy())</span><span id="e675" class="nd mh iq mz b gy ni nf l ng nh"># Exposure fusion using Mertens</span><span id="2695" class="nd mh iq mz b gy ni nf l ng nh">merge_mertens = cv.createMergeMertens()</span><span id="4920" class="nd mh iq mz b gy ni nf l ng nh">res_mertens = merge_mertens.process(img_list)</span><span id="ec9a" class="nd mh iq mz b gy ni nf l ng nh"># Convert datatype to 8-bit and save</span><span id="3546" class="nd mh iq mz b gy ni nf l ng nh">res_debevec_8bit = np.clip(res_debevec*255, 0, 255).astype('uint8')</span><span id="4702" class="nd mh iq mz b gy ni nf l ng nh">res_mertens_8bit = np.clip(res_mertens*255, 0, 255).astype('uint8')</span><span id="d5a5" class="nd mh iq mz b gy ni nf l ng nh">cv.imwrite(r"C:\Users\felipe.cunha\Documents\venv\HDRTest\ldr_debevec.jpg", res_debevec_8bit)</span><span id="36ca" class="nd mh iq mz b gy ni nf l ng nh">cv.imwrite(r"C:\Users\felipe.cunha\Documents\venv\HDRTest\fusion_mertens.jpg", res_mertens_8bit)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/499ed35b1a6e28a39948b6e54a43f160.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H4HjBXXmPS6pyYCNmeqxPA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">德贝韦克方法。看看这些细节！</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/88b403d0de628ad17119cbff040841d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G-8RVWa3jNJC5gCUfTy06g.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">默滕斯方法。</p></figure><h1 id="0189" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">结论</h1><p id="938b" class="pw-post-body-paragraph kw kx iq ky b kz nl jr lb lc nm ju le lf nn lh li lj no ll lm ln np lp lq lr ij bi translated">我们已经介绍了HDR的基本情况。当您需要在曝光不足和曝光过度的大视场中定位特征时，此技术特别有用。</p><p id="aa2f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">希望这能对你的计算机视觉项目有所帮助。</p><p id="23f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想要一篇关于这个话题的更深入的文章，请在评论中告诉我。</p><p id="9f57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">谢谢！</p></div></div>    
</body>
</html>