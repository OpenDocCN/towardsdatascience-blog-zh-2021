<html>
<head>
<title>How I created an app for Live Stream Highlight Detection for Twitch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何为Twitch创建一个实时流精彩检测应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-i-created-an-app-for-live-stream-highlight-detection-for-twitch-532f4027987e?source=collection_archive---------24-----------------------#2021-05-26">https://towardsdatascience.com/how-i-created-an-app-for-live-stream-highlight-detection-for-twitch-532f4027987e?source=collection_archive---------24-----------------------#2021-05-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d666" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">内部源代码</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8d6c6a0ce6ec03fe8747615e321d8324.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_3uQtpfvyPpbVBbZ"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/photos/HUBNTCzE-R8" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/HUBNTCzE-R8</a></p></figure><h1 id="57a7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="d5fb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在Twitch上直播期间，许多流媒体和电子竞技组织都很难从海量的流媒体数据中提取有趣的瞬间。对于大型电子竞技组织来说，让员工在直播过程中找到精彩内容也是非常昂贵的。除了这个问题之外，另一个问题出现了，现场直播通常持续相当长的时间，有时直播者需要休息，在这些时刻观众从流中流出。在此期间显示有趣的精彩片段可能是让观众继续观看视频流的潜在解决方案。<br/>在亮点检测领域，积极的工作正在进行中。最近，已经提出了大量的解决方案，一些大公司和初创公司也试图提供现成的解决方案。不幸的是，大多数服务都没有为这个问题提供开源解决方案。到目前为止，还没有现成的解决方案可以推出和测试，几家处理类似问题的初创公司被迫关闭。也许这一领域发展如此不成功的根本原因是任务的复杂性，甚至一个人也不能够准确地阐述有趣时刻的定义。除其他外，这项工作旨在更准确地制定这一定义，并努力改善现有的研究和开发成果。</p><h1 id="12b7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">机器学习模块开发</h1><p id="9273" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了解决在直播流中找到有趣时刻的问题，我决定将问题分成更小的部分，因此，结合使用了几种机器学习算法。首先，我从直播流中提取了10秒钟的剪辑，对于每个剪辑，我从聊天+音频+视频数据中提取了以下信息:</p><ul class=""><li id="e539" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm mu mv mw mx bi translated">通过当前时刻的情感和评论数量来评估剪辑；</li><li id="40de" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">使用陈盼CNN进行音频标记，通过音量和检测到的声音信号来评估剪辑；</li><li id="b554" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">利用密集光流和卷积神经网络，通过帧与帧之间的运动量来评估剪辑；</li></ul><p id="9e82" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">然后元模型使用这些特征对每个片段进行独立评分。以下是机器学习工作流程的粗略架构:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/3e54417482150423555d0055936bae76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ifpxUkyTpm_aZRIyOU1JLA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">机器学习模块的工作流程</p></figure><p id="984b" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">现在，让我们分别深入研究机器学习模块的每个组件。</p><h2 id="809a" class="nh la it bd lb ni nj dn lf nk nl dp lj ma nm nn ll me no np ln mi nq nr lp ns bi translated">1.Twitch聊天功能</h2><p id="457f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了从Twitch聊天中提取数据，我们选择使用以下聊天功能:</p><ol class=""><li id="7429" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm nt mv mw mx bi translated">10秒钟片段的消息总数</li><li id="3f19" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm nt mv mw mx bi translated">在10秒钟的剪辑中，积极情绪的消息总数</li><li id="002f" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm nt mv mw mx bi translated">在10秒钟的剪辑中，带有负面情绪的消息总数</li></ol><p id="9951" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">出于这个目的，我使用了出色的<a class="ae ky" href="https://huggingface.co/transformers/quicktour.html" rel="noopener ugc nofollow" target="_blank">变形金刚库</a>，在那里，情感分析可以在几行代码中完成。</p><h2 id="cdf0" class="nh la it bd lb ni nj dn lf nk nl dp lj ma nm nn ll me no np ln mi nq nr lp ns bi translated">2.运动特征</h2><p id="99a4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">随着运动估计变得更加有趣，为了更好地理解光流概念，你可能想看看我的<a class="ae ky" href="https://artkulakov.com/2020/12/29/how-i-created-the-workout-movement-counting-app-using-deep-learning-and-optical-flow-algorithm/" rel="noopener ugc nofollow" target="_blank">帖子</a>关于使用光流进行运动计数。</p><p id="d36b" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">也就是说，运动估计模型基于光流算法，该算法突出显示图像的每个像素，使得在一个方向上移动的像素以相同的颜色突出显示。可以配置光流，使其对像素进行分组并突出显示整个区域，由于这一技巧，具有大量运动的帧会呈现以下外观:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/cbcecb670fd3ad429d58a311c75846e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*OF3PTGnpomo3GFUQ3rFy0Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用光流算法编码的具有大量运动的帧</p></figure><p id="51ae" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">移动次数少的帧会呈现以下外观:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/78b6aaca326e575e2e6f1deda31d425f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*59rpjlWjycNw24VXRBPapg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用光流算法编码的低运动量帧</p></figure><p id="6350" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">正如你所看到的，区分一种类型的图像和另一种类型的图像是非常容易的；为了让这一功能在应用中发挥作用，使用了简单的卷积神经网络(CNN)的架构。网络的任务是将通过光流编码的图像识别为具有大量运动的图像(类别1)和具有少量运动的图像(类别0)。这么简单的任务，即使是架构最简单的CNN也表现的很好。</p><h2 id="e3bb" class="nh la it bd lb ni nj dn lf nk nl dp lj ma nm nn ll me no np ln mi nq nr lp ns bi translated">3.声音特征</h2><p id="fdee" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">几种方法同时被用来从声音中提取数据。首先，对于每个剪辑，提取最大声音值。其次，使用<a class="ae ky" href="https://github.com/qiuqiangkong/audioset_tagging_cnn" rel="noopener ugc nofollow" target="_blank">陈盼CNN进行音频标记</a>，可以在音频中找到特定的声音，然后从中提取必要的数据。以下是模型提取的声音特征列表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/27bc43440a77cf3a8e2b81d209873adf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*CMMowZnpnQszBN_WXoVT3A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">陈盼CNN模型提取的声音特征</p></figure><h2 id="46b6" class="nh la it bd lb ni nj dn lf nk nl dp lj ma nm nn ll me no np ln mi nq nr lp ns bi translated">4.元模型！</h2><p id="236e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">由于人们很难找到有趣的时刻，以及“有趣的时刻”这一概念的模糊性，因此决定创建一个元模型，它可以总结出哪些特征对于从数据中识别有趣的时刻是重要的。<br/>元模型获取由音频、动作和聊天组件提取的关于Twitch广播的所有数据。然后，它根据提供的特征预测该时刻成为有趣时刻的概率。<br/>从直播中提取所有数据后，以下一组特征被输入到元模型的输入中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/cf3d2fc35a3d682d5088e2de80e15c04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O_uq5Bl80PDbebtlC2zVtQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">元模型使用的所有特性</p></figure><p id="ce7c" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">经典的监督学习方法用于训练元模型。为此，收集并标记了直播样本。为了标记每个广播，我使用了<a class="ae ky" href="https://supervise.ly/" rel="noopener ugc nofollow" target="_blank"> supervise.ly </a>平台，这对于数据标记来说非常方便！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/5406520ff718e8c2937e746812770bac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*N1Lz54uEaVhXdwjvikm1zw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">supervise.ly视频标注界面截图</p></figure><p id="b103" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">为了标记直播，使用了来自我的应用程序的现成代码库。已卸载所选直播的所有功能。每个广播都被切成连续的10秒钟的片段。对于每个广播，获得以下数据表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/a4e26156579d8f3118f05ac4e6caa693.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*VkClmhjCb-jAtaiAuIaFOw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">元模型使用的数据集示例</p></figure><p id="0755" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">在所有的类标签被标记之后，训练元模型的过程就开始了。根据两个标签进行类别预测的问题是一个常见的二分类问题。为了解决这个问题，我使用了scikit-learn库中的模型。最佳模型(可解释性、速度和f1值)是逻辑回归，F1值为<strong class="lt iu"> 0.44 </strong>。以下是逻辑回归模型(系数)的特征重要性:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/17e01a260eb231a33bbfacfe17d13f34.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/1*6mslJkFvxrEcAIMlxJqo5w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">逻辑回归模型中的特征重要性</p></figure><p id="37a2" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">在训练元模型并可视化特征的重要性之后，人们可以看到模型能够从数据中提取的几个有趣的模式:<br/>确定类“有趣时刻”的最重要标准:</p><ul class=""><li id="95de" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm mu mv mw mx bi translated">音量(声音响度)</li><li id="0507" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">(机关枪的)射击声</li><li id="a970" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">笑声。</li></ul><p id="8632" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">确定班级“无趣时刻”的最重要标准:</p><ul class=""><li id="c1f4" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm mu mv mw mx bi translated">背景音乐(音乐)</li><li id="b681" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">演讲(演讲，男性演讲)</li><li id="113d" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">单发射击(枪响、枪声)</li></ul><p id="a830" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">不影响模型结果的特征:</p><ul class=""><li id="58ea" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm mu mv mw mx bi translated">脚步声</li><li id="0c26" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">聊天中正面消息的数量</li><li id="da24" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">一个女人的声音。</li></ul><p id="300a" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">一个有趣的事实是，该模型将女性的声音归类为不重要，尽管这不是真的。事实是，男性的声音在训练样本中占主导地位，正因为如此，模型得出女性的声音不重要的结论，这是一个经典的“人工智能中的偏见”问题</p><h1 id="f458" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">实施细节</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/468b54d984cd3066a7d8fa966d296724.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*6i4wYVsDqOy2XKAnM7XXFw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">应用架构</p></figure><p id="6172" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">该应用程序由两个主要部分组成:<br/>Web应用程序，用户与主界面<br/>服务器进行交互，在此进行视频流处理和精彩片段检测<br/>在与应用程序前端部分的交互过程中，用户上传一个到直播的链接，他希望在那里找到精彩片段，然后该链接连同用户的元数据一起被发送到服务器。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/67832c254befb1a3404fa939a2ac0792.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*cXF3wdsfr6Zfvk5Gmx7MtQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">向应用程序添加新的实时流</p></figure><p id="4614" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">在服务器上，直播及其评论被持续加载到本地存储器中，同时在直播中检测有趣的时刻。一旦发现新的有趣时刻，就会将其保存在谷歌云存储中，并将包含该有趣时刻的视频链接发送回web应用程序。</p><p id="5b2a" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">应用程序的两个部分(web应用程序和服务器)都位于谷歌云平台上，当启动时，会收到它们的公共IP地址，您可以连接到这些地址。</p><p id="7ac8" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">这是该应用的一个快速展示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><h1 id="79f2" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="1982" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我希望这篇文章能帮助你更好地理解我的高光检测管道。我在我的<a class="ae ky" href="https://github.com/artkulak/twitch-stream-highlights-detection" rel="noopener ugc nofollow" target="_blank"> GitHub简介</a>上发布了所有代码，所以请随意查看并将其用于您自己的项目！</p><p id="9d37" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated"><strong class="lt iu">你可能喜欢在我的</strong> <a class="ae ky" href="http://artkulakov.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">网站</strong> </a> <strong class="lt iu">上查看其他帖子，别忘了订阅:)</strong></p></div></div>    
</body>
</html>