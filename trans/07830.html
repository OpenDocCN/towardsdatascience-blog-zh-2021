<html>
<head>
<title>How to Speed up Python Data Pipelines up to 91X?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Python数据管道加速到91X？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-speed-up-python-data-pipelines-up-to-91x-80d7accfe7ec?source=collection_archive---------8-----------------------#2021-07-18">https://towardsdatascience.com/how-to-speed-up-python-data-pipelines-up-to-91x-80d7accfe7ec?source=collection_archive---------8-----------------------#2021-07-18</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="c96d" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">一个5分钟的教程可以为您的大数据项目节省数月时间。</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/4140b6e2fad570cf72afced6e475fa8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RdBnleNQCklPactq"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@vicky_yu?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Vicky Yu </a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="354e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">作为一名数据科学家，令人沮丧的事情是等待大数据管道完工。</p><p id="9f7c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">尽管python是数据科学家的浪漫语言，但它不是最快的。这种脚本语言在执行时被解释，使得它很慢，并行执行很困难。可悲的是，并不是每个数据科学家都是C++专家。</p><p id="afc7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果有一种并行执行，以编译代码的速度运行python代码的方法会怎样？这就是Tuplex正在解决的问题。</p><p id="8956" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Tuplex是用Python编写的并行大数据处理框架。如果您曾经在Apache Spark中工作过，这可能对您来说很熟悉。然而，与spark不同，Tuplex不调用Python解释器。它优化管道并将其转换为LLVM字节码，以极快的速度运行，与手工优化的C++代码一样快。</p><p id="f784" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Python使用多重处理库来并行执行。这个库的缺点是它不能在任何REPL环境下工作。然而，我们数据科学家喜欢Jupyter笔记本。在幕后，多重处理甚至不是一种并行执行技术。它只启动多个子进程，操作系统负责它的并行执行。事实上，不能保证操作系统会并行运行它们。</p><p id="a782" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本文中，我们将讨论:</p><ul class=""><li id="cd71" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">如何安装Tuplex</li><li id="fe0d" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">如何运行琐碎的数据管道；</li><li id="a10e" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">Tuplex中便捷的异常处理:</li><li id="fb13" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">高级配置如何帮助您，以及；</li><li id="9ee3" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">将它与普通的python代码进行对比。</li></ul><p id="e926" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我确信这将是一次公园散步。</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="e45a" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">启动并运行Tuplex。</h1><p id="5f6a" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">尽管它很有用，但Tuplex的设置非常简单。PyPI做到了。</p><pre class="kk kl km kn gu no np nq nr aw ns bi"><span id="4473" class="nt ms iu np b gz nu nv l nw nx">pip install tuplex</span></pre><p id="0c64" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">虽然在Linux上推荐使用这种方法，但是在Mac上可能必须使用docker容器。</p><p id="ae60" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这里有一点需要注意的是，它还没有在Windows电脑上测试过。至少<a class="ae kz" href="https://tuplex.cs.brown.edu/gettingstarted.html" rel="noopener ugc nofollow" target="_blank"> Tuplex的文档</a>没有提到。请分享你的Windows电脑体验。</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="37cc" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">你的第一条数据管道。</h1><p id="02a1" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">一旦安装了Tuplex，运行并行任务就很容易了。这是来自Tuplex官方文档页面的例子。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">来自<a class="ae kz" href="https://tuplex.cs.brown.edu/gettingstarted.html" rel="noopener ugc nofollow" target="_blank"> Tuplex文档</a>的片段。</p></figure><p id="84a9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">首先，您必须创建一个复合上下文。您可以通过从Tuplex模块导入它来做到这一点。</p><p id="6379" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">从这里开始，运行并行函数执行只需要三个步骤；并行化、映射和收集。</p><p id="367a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Tuplex上下文对象的并行化方法是您的起点。它将输入值列表作为参数传递给函数。该列表中的每个元素都将通过函数与其他元素并行运行。</p><p id="dc09" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可以传递一个用户定义的函数，该函数使用map函数转换每个输入。最后，使用collect方法收集所有并行执行的输出。</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="b16d" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">Tuplex中方便的异常处理。</h1><p id="df13" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">我最喜欢Tuplex的一点是它在管理异常方面的便利性。数据管道中的错误处理是一种令人畏惧的体验。想象一下，花几个小时处理一个数据流，却发现一个被零除的细微错误扼杀了你所做的一切。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">来自<a class="ae kz" href="https://tuplex.cs.brown.edu/gettingstarted.html" rel="noopener ugc nofollow" target="_blank"> Tuplex文档</a>的片段。</p></figure><p id="684c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">上面的代码会产生一个被零除的错误。如果您使用spark或任何标准python模块来处理这个问题，至少情况是这样的。</p><p id="1986" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在Tuplex中，错误处理是自动的。它会忽略有错误的那个并返回其余的。上面的代码将返回[2，-4]，因为列表中的第一个和第三个输入无法执行。</p><p id="15b3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是，忽略错误有时是有问题的。通常你必须以不同的方式处理它们，而Tuplex的API足够灵活，可以做到这一点。事实上，Tuplex方法很方便。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">来自<a class="ae kz" href="https://tuplex.cs.brown.edu/gettingstarted.html" rel="noopener ugc nofollow" target="_blank"> Tuplex文档</a>的片段。</p></figure><p id="4bdf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Tuplex使错误处理变得毫不费力。您必须在“map”和“collect”方法之间链接一个“resolve”方法。在上面的例子中，我们已经传入了ZeroDivisionError类型，并通过替换零来处理它。</p><p id="8e4e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">resolve方法的第二个参数是一个函数。有了这个函数，您可以告诉Tuplex在出现这种类型的错误时应该做什么。</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="6e3a" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">为高级用例配置Tuplex。</h1><p id="3401" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">您可以用两种方式配置Tuplex。第一种是直截了当的解决方案；只需将字典传递给上下文初始化。下面是一个将执行内存设置为较高值的示例。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">来自<a class="ae kz" href="https://tuplex.cs.brown.edu/gettingstarted.html" rel="noopener ugc nofollow" target="_blank"> Tuplex文档</a>的片段。</p></figure><p id="95c1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Tuplex还支持在YAML文件中传递配置。在生产环境中，您可能必须将配置存储在文件中。YAML文件是处理不同配置并在开发和测试团队之间传递的一种很好的方式。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">来自<a class="ae kz" href="https://tuplex.cs.brown.edu/gettingstarted.html" rel="noopener ugc nofollow" target="_blank"> Tuplex文档</a>的片段。</p></figure><p id="2945" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">下面是一个配置文件的例子，它包含了您可以从Tuplex文档中进行的所有不同的定制。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">来自<a class="ae kz" href="https://tuplex.cs.brown.edu/gettingstarted.html" rel="noopener ugc nofollow" target="_blank"> Tuplex文档</a>的片段。</p></figure></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="ea18" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">性能基准</h1><p id="fe22" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">Tuplex的承诺耐人寻味。是时候看看它的性能提升了。</p><p id="7a3d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这次基准测试中，我使用了这个简单的质数计数器函数。我首先使用for循环运行这个函数，然后使用python内置的多处理模块，最后使用Tuplex。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">作者的片段。</p></figure><h2 id="6446" class="nt ms iu bd mt oa ob dn mx oc od dp nb lj oe of nd ln og oh nf lr oi oj nh ok bi translated">用标准Python执行密集型任务。</h2><p id="2e4f" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">在for循环中运行函数是最简单的。我使用Jupyter笔记本中的“%%time”助手来跟踪执行时间。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">由<a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener">作者</a>摘录。</p></figure><p id="723f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">多次运行上述代码平均需要51.2秒才能完成。</p><p id="05ef" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在for循环执行中，执行速度会很慢。但是让我们用python内置的多处理模块来做同样的尝试。下面的代码不能在REPL的like Jupyter笔记本上运行。你必须把它放在一个. py文件中，然后<a class="ae kz" href="https://realpython.com/run-python-scripts/" rel="noopener ugc nofollow" target="_blank">在命令行</a>中执行它。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">由<a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener">作者</a>摘录。</p></figure><p id="1fc0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">运行这个多处理脚本的平均时间为30.76秒。与for-loop方式相比减少了20.44秒。</p><h2 id="4724" class="nt ms iu bd mt oa ob dn mx oc od dp nb lj oe of nd ln og oh nf lr oi oj nh ok bi translated">并行处理密集型任务。</h2><p id="bee4" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">最后，我们执行相同的素数计数器函数，这次是用Tuplex。下面这段简洁的代码平均花费了0.000040秒，并产生了相同的结果。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">由<a class="ae kz" href="https://thuwarakesh.medium.com/" rel="noopener">作者</a>摘录。</p></figure><p id="89ac" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">与其他标准python方式相比，Tuplex的性能提升非常显著。这个小例子的执行时间比多处理短769k倍，比普通for循环快1280k倍。</p><p id="dc2c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们会…让我们坚持Tuplex团队的5–91X承诺。然而，Tuplex敦促我在编写另一个for循环之前要三思。</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="a3da" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">结论</h1><p id="6dec" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">Tuplex是一个易于安装的python包，可以为您节省大量时间。它通过将数据转换成字节码并并行执行来加速数据管道。</p><p id="9db1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">性能基准测试表明，它对代码执行的改进是深远的。然而，它的设置非常简单，语法和配置非常灵活。</p><p id="3de2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Tuplex最酷的部分是它方便的异常处理。数据管道中的错误处理从未如此简单。它与交互式shells和Jupiter笔记本集成得很好。编译语言通常不是这种情况。甚至python本身也不能像Jupyter notebook那样在REPL内部处理并行处理。</p><p id="d098" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Tuplex在提升Python性能方面取得了显著的成功。但是与Python传统的高性能计算方法相比，它的性能如何呢？这里有一篇文章将它与Cython进行了对比。</p><div class="ol om gq gs on oo"><a rel="noopener follow" target="_blank" href="/challenging-cython-the-python-module-for-high-performance-computing-2e0f874311c0"><div class="op ab fp"><div class="oq ab or cl cj os"><h2 class="bd iv gz z fq ot fs ft ou fv fx it bi translated">挑战cy thon——高性能计算的Python模块。</h2><div class="ov l"><h3 class="bd b gz z fq ot fs ft ou fv fx dk translated">现代的替代方案看起来很有希望，Python可以以闪电般的速度运行。</h3></div><div class="ow l"><p class="bd b dl z fq ot fs ft ou fv fx dk translated">towardsdatascience.com</p></div></div><div class="ox l"><div class="oy l oz pa pb ox pc kt oo"/></div></div></a></div></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><blockquote class="pd pe pf"><p id="0a16" class="la lb pg lc b ld le jv lf lg lh jy li ph lk ll lm pi lo lp lq pj ls lt lu lv in bi translated">谢谢你的阅读，朋友。看来你和我有许多共同的兴趣。一定要看看我的个人博客。</p><p id="2f7d" class="la lb pg lc b ld le jv lf lg lh jy li ph lk ll lm pi lo lp lq pj ls lt lu lv in bi translated"><strong class="lc iv"> <em class="iu">向我问好</em> </strong>上<a class="ae kz" href="https://www.linkedin.com/in/thuwarakesh/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a><a class="ae kz" href="https://twitter.com/Thuwarakesh" rel="noopener ugc nofollow" target="_blank">Twitter</a><a class="ae kz" href="https://thuwarakesh.medium.com/subscribe" rel="noopener">中</a>。我会为你打破僵局。</p></blockquote><p id="167f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">还不是中等会员？请使用此链接<a class="ae kz" href="https://thuwarakesh.medium.com/membership" rel="noopener"> <strong class="lc iv">成为</strong> </a>会员。你可以享受成千上万的有见地的文章，并支持我，因为我赚了一点佣金介绍你。</p></div></div>    
</body>
</html>