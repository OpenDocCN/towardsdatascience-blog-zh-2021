<html>
<head>
<title>SQLFluff — The Linter For Modern SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL fluff——现代SQL的缩写</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/sqlfluff-the-linter-for-modern-sql-8f89bd2e9117?source=collection_archive---------2-----------------------#2021-05-13">https://towardsdatascience.com/sqlfluff-the-linter-for-modern-sql-8f89bd2e9117?source=collection_archive---------2-----------------------#2021-05-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="d0a8" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">SQL也值得一提</h2><div class=""/><div class=""><h2 id="9b28" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">为什么我相信SQLFluff有潜力为好🧹 ✨解决SQL林挺</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/f2c27892521c1d24097c9502cf0e1a8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1XQ5CocAoD-FqCJiCSQaWw.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">布雷特·乔丹在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="814a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">几个月前，我的团队开始大量使用<a class="ae lh" href="https://www.getdbt.com/" rel="noopener ugc nofollow" target="_blank"> dbt </a>，因此我发现自己在编写了很长时间的<a class="ae lh" href="https://spark.apache.org/" rel="noopener ugc nofollow" target="_blank"> Spark </a> Scala之后，大部分时间都在编写SQL。每次当我从通用编程语言转换到SQL时，我都会怀念使用成熟的linter。我害怕再次花时间在“风格”上，害怕在拉取请求上吹毛求疵。</p><p id="492b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我偶然发现这个整洁的<em class="me">小(当时)</em>工具叫做<a class="ae lh" href="https://www.sqlfluff.com/" rel="noopener ugc nofollow" target="_blank"> SQLFluff </a>。我认为这个设计很有前途，(稍后我会谈到<strong class="lk jd">为什么</strong>)，所以我开始在这个项目上投入一些时间。其他人也开始定期投稿，SQLFluff的势头越来越大。2020年10月，<a class="ae lh" href="https://github.com/alanmcruickshank" rel="noopener ugc nofollow" target="_blank"> Alan Cruickshank </a>(该项目的创建者)，成立了GitHub组织，并邀请我们中的一些人成为维护者。当时，这个项目有大约180颗星，现在已经超过三倍，成为GitHub上最受欢迎的SQL linter🌟。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mf"><img src="../Images/9c66b30b792a140e2f078dca2f3b8ca0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ts9MqamOJlPL8YChhV3KYw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">GitHub星随时间推移，生成于<a class="ae lh" href="https://star-history.t9t.io/#sqlfluff/sqlfluff" rel="noopener ugc nofollow" target="_blank">https://star-history.t9t.io/#sqlfluff/sqlfluff</a></p></figure><p id="9ad8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这篇文章中，我将带你了解:</p><ul class=""><li id="a94f" class="mg mh it lk b ll lm lo lp lr mi lv mj lz mk md ml mm mn mo bi translated">棉绒的不同角色以及我们(维护者)如何看待它们。</li><li id="0078" class="mg mh it lk b ll mp lo mq lr mr lv ms lz mt md ml mm mn mo bi translated">林挺现代SQL面临的挑战以及SQLFluff如何应对这些挑战。</li><li id="d040" class="mg mh it lk b ll mp lo mq lr mr lv ms lz mt md ml mm mn mo bi translated">SQLFluff的<strong class="lk jd">未来</strong>是什么样子。</li><li id="0b34" class="mg mh it lk b ll mp lo mq lr mr lv ms lz mt md ml mm mn mo bi translated">如何让<strong class="lk jd">为SQLFluff贡献</strong>。</li></ul></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nb"><img src="../Images/ccbafb34fb29ff4966fa04188187603b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zJyDsETYjjfpjGkHBBPSAw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">在此阅读关于标志<a class="ae lh" href="http://designingoverload.com/2020/04/19/a-logo-for-sqlfluff/" rel="noopener ugc nofollow" target="_blank">的信息</a></p></figure><h1 id="b8dc" class="nc nd it bd ne nf ng nh ni nj nk nl nm ki nn kj no kl np km nq ko nr kp ns nt bi translated">林挺工具的作用</h1><h2 id="1301" class="nu nd it bd ne nv nw dn ni nx ny dp nm lr nz oa no lv ob oc nq lz od oe ns iz bi translated">💅风格</h2><p id="55f5" class="pw-post-body-paragraph li lj it lk b ll of kd ln lo og kg lq lr oh lt lu lv oi lx ly lz oj mb mc md im bi translated">linter的作用之一是在你的代码上执行修饰性的规则。这些规则不会改变代码的行为方式，只会改变它的外观。</p><p id="df34" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">没有一致风格的代码库很难阅读和使用，因为它们的结构<strong class="lk jd">不可预测</strong>。读者没有机会习惯能让他们快速浏览逻辑的模式。</p><p id="4db2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">强制执行一个没有短打的<strong class="lk jd">一致的</strong>风格是很难的，因为“风格”规则可能非常<strong class="lk jd">主观，</strong>喜欢“前导”逗号而不是“尾随”逗号。没有短评，这种主观性导致了许多充满吹毛求疵的谈话和公关评论。</p><p id="d7b3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">没有人喜欢在公关评论中挑剔风格，也没有人喜欢得到这些评论。这不仅对参与其中的每个人来说都是糟糕的体验，而且还会妨碍围绕业务逻辑、架构和测试的重要对话。</p><p id="e774" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你习惯了像<a class="ae lh" href="https://github.com/psf/black" rel="noopener ugc nofollow" target="_blank"> black </a> (Python)或者<a class="ae lh" href="https://scalameta.org/scalafmt/" rel="noopener ugc nofollow" target="_blank"> scalafmt </a> (Scala)这样的linters，你就习惯了不用担心风格的编写代码，因为它们都可以自动重新格式化你的代码。我们的目标是用SQLFluff提供相同的体验——我们认为提出样式问题是一个好的开始，但是自动执行它们是让开发人员真正忘记格式化的原因。</p><p id="c4af" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">SQL改造示例:</strong></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ok"><img src="../Images/b08ba0b60e8294fb919b33a30f86f444.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TRie2fMfT9fDVNj05CnHtg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">通过VSCode SQLFluff插件链接的样式错误的有效查询</p></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ok"><img src="../Images/519e48b4ca84aae883e830912f09163d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rIY-t5NfrtZjjhdLmCb5DA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">“sqlfluff fix”之后的相同查询，使用默认配置</p></figure><h2 id="df55" class="nu nd it bd ne nv nw dn ni nx ny dp nm lr nz oa no lv ob oc nq lz od oe ns iz bi translated">👃代码气味</h2><p id="f0f9" class="pw-post-body-paragraph li lj it lk b ll of kd ln lo og kg lq lr oh lt lu lv oi lx ly lz oj mb mc md im bi translated">除了“丑陋的”代码，还有另一类“有问题的”代码。据说不是<em class="me">的代码是无效的</em>，但可能表明逻辑中有问题。例如，在通用语言中:我们可能会以定义了但从未使用过的变量、冗余导入和隐藏变量而告终。</p><p id="3707" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在SQLFluff中，我最喜欢的例子是<a class="ae lh" href="https://docs.sqlfluff.com/en/stable/rules.html#sqlfluff.core.rules.Rule_L037" rel="noopener ugc nofollow" target="_blank">规则L037 </a>，当“ORDER BY”显式地定义了一列的升序或降序，但却隐含了其他列的顺序时，它会发出警告。默认情况下，该行为被隐式设置为升序，但通常会对这种隐式行为感到惊讶。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ok"><img src="../Images/5f21cd4118f093f04f603afe1f22bced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kMop1KfxM9JoJdsvkdKlIQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">通过升序进行隐式排序，通过VSCode SQLFluff插件进行链接</p></figure><p id="dcca" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可能会错误地认为所有三列的结果都是按降序排列的，而实际上column_a和column_b是按升序排列的，column_c只有<strong class="lk jd">是按降序排列的</strong></p><p id="25ef" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这种情况下，fix <em class="me">例程</em>通过重写查询在column_a和column_b上添加ASC关键字，使隐式行为显式化。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ok"><img src="../Images/33e5ec12fb113320cad884d8cc511a7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eeqMtw6M20ZzZwB2BOzfmw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">asc/desc订购的明确订单</p></figure><p id="6507" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在Scala中，编译器将这些问题作为警告提出，而在Python中，通常使用<a class="ae lh" href="https://flake8.pycqa.org/en/latest/" rel="noopener ugc nofollow" target="_blank"> flake8 </a>。在SQLFluff中，这些问题与样式规则没有什么不同，它们也经常实现修复。</p><h2 id="4c9c" class="nu nd it bd ne nv nw dn ni nx ny dp nm lr nz oa no lv ob oc nq lz od oe ns iz bi translated">📖最佳实践库</h2><p id="7076" class="pw-post-body-paragraph li lj it lk b ll of kd ln lo og kg lq lr oh lt lu lv oi lx ly lz oj mb mc md im bi translated">对于试图<strong class="lk jd">学习</strong>一种新的编码语言及其最佳实践的人来说，记录良好的规则可以成为一个很好的伙伴。</p><p id="57f6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在SQLFluff中，我们用一个“反模式”、“最佳实践”和一个简短的描述来记录我们的规则，该描述解释了<em class="me">为什么</em>一个规则存在——灵感来自<a class="ae lh" href="https://www.flake8rules.com/" rel="noopener ugc nofollow" target="_blank"> flake8rules </a>。</p><p id="8226" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">随着时间的推移，该项目成为SQL中最佳实践和反模式的知识库。它聚集并提炼了互联网上存在的所有信息:SQL参考文档、StackOverflow、沮丧的Tweets以及经验丰富的SQL程序员的集体想法。</p><p id="b71b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">看一下<a class="ae lh" href="https://docs.sqlfluff.com/en/stable/rules.html#sqlfluff.core.rules.Rule_L015" rel="noopener ugc nofollow" target="_blank"> Rule_L015 </a>:它强调“DISTINCT”不是一个函数，使用带有“function”语法的关键字可能会产生误导。您可以在这个<a class="ae lh" href="https://stackoverflow.com/a/31679169" rel="noopener ugc nofollow" target="_blank"> StackOverflow答案</a>中找到相同信息，但是这个规则引起了您的注意。“<em class="me">不知道自己不知道的东西</em>”是学习一门新语言的挑战之一，linter可以帮助你注意到这些怪癖，这样你就可以很快发现它们。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ol"><img src="../Images/13bcd4385670b3f6a17fe0dc24477817.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XYDXpraLalXA_4VfLZsVBw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://docs.sqlfluff.com/en/stable/rules.html#sqlfluff.core.rules.Rule_L015" rel="noopener ugc nofollow" target="_blank">https://docs . SQL fluff . com/en/stable/rules . html # SQL fluff . core . rules . rule _ L015</a></p></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="e64e" class="nc nd it bd ne nf om nh ni nj on nl nm ki oo kj no kl op km nq ko oq kp ns nt bi translated">林挺现代SQL的挑战</h1><p id="5989" class="pw-post-body-paragraph li lj it lk b ll of kd ln lo og kg lq lr oh lt lu lv oi lx ly lz oj mb mc md im bi translated">许多流行的通用语言中都有现成的linters，但SQL没有。在我看来，这是由于许多方言的存在，以及模板化或动态SQL的使用。</p><h2 id="e98f" class="nu nd it bd ne nv nw dn ni nx ny dp nm lr nz oa no lv ob oc nq lz od oe ns iz bi translated">🗣方言</h2><p id="2c2c" class="pw-post-body-paragraph li lj it lk b ll of kd ln lo og kg lq lr oh lt lu lv oi lx ly lz oj mb mc md im bi translated">SQL有许多方言通常与特定的SQL引擎相关联:比如Redshift、BigQuery和Snowflake。由于方言之间的差异，构建特定于一种方言的linter似乎是正确的事情。然而，在我看来，这些项目将很难建立一个足够大的社区来维持创建一个强大的linter所需要的工作。当用户或维护人员切换到不同的引擎时，他们会对项目失去兴趣，造成用户和贡献者的流失。</p><p id="9908" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，我理解为什么迄今为止构建的大多数linters都是特定于方言的:SQL引擎很少共享它们的解析逻辑，所以需要构建特定的解析器来理解每种方言。Spark SQL有一个<a class="ae lh" href="https://www.antlr.org/" rel="noopener ugc nofollow" target="_blank">ANTLR</a>T3】规范，可以用来生成一个解析器，但是这是规则的例外！</p><p id="beab" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">幸运的是，大多数方言都有一些<strong class="lk jd">相似之处</strong>，例如Redshift / Postgres、Presto/Spark SQL——我们在SQLFluff中利用了这一点。</p><p id="e00c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在SQLFluff中，我们定义了一个<em class="me">基础</em>方言，它不依赖于任何特定的引擎，而是松散地基于ANSI，我们从这个基础中派生出特定于数据库的方言。解析器的结构尽可能地被重用，但是可以添加或替换父方言的元素来处理方言之间的差异。</p><p id="a9f0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，MySQL接受文字的双引号，所以我们<a class="ae lh" href="https://github.com/sqlfluff/sqlfluff/blob/b410b4803c5fa4d1dfdb1df0be3e0c479dab8ca8/src/sqlfluff/dialects/dialect_mysql.py#L43" rel="noopener ugc nofollow" target="_blank">将它添加到解析器</a>的“LiteralGrammar”部分。</p><p id="2a59" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">另一个例子:BigQuery方言接受通配符表达式中的<a class="ae lh" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/query-syntax#modifiers_for_operator" rel="noopener ugc nofollow" target="_blank"> EXCEPT和REPLACE子句，因此我们</a><a class="ae lh" href="https://github.com/sqlfluff/sqlfluff/blob/b410b4803c5fa4d1dfdb1df0be3e0c479dab8ca8/src/sqlfluff/dialects/dialect_bigquery.py#L234" rel="noopener ugc nofollow" target="_blank">将这些情况添加到“WildcardExpressionSegment”</a>。</p><p id="b0fe" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">将方言抽象成可组合的解析器是SQLFluff最强的特性之一——它允许我们从相似的父方言中派生出一种方言。得到的解析结构<strong class="lk jd">不依赖于任何特定的数据库引擎</strong>，使我们能够拥有与方言<em class="me">无关的规则</em>。</p><p id="31f2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面是<code class="fe or os ot ou b">sqlfluff parse my_file.sql --code-only --format yaml</code>输出的部分结构:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ok"><img src="../Images/d805e5d9a8ecf522c70e3960ec3c659a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OSxftghnP6BYbTXeKDQDrQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">SQLFluff能够以json、yaml或“人类”格式输出它解析的结构</p></figure><p id="e65b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="me">在撰写本文时，SQLFluff实现了以下方言:BigQuery、Exasol、MySQL、Postgres、Snowflake、Teradata。</em></p><h2 id="f9ed" class="nu nd it bd ne nv nw dn ni nx ny dp nm lr nz oa no lv ob oc nq lz od oe ns iz bi translated">✨模板</h2><p id="2dcf" class="pw-post-body-paragraph li lj it lk b ll of kd ln lo og kg lq lr oh lt lu lv oi lx ly lz oj mb mc md im bi translated">像<a class="ae lh" href="http://airflow.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Airflow </a>和<a class="ae lh" href="https://docs.getdbt.com/" rel="noopener ugc nofollow" target="_blank"> dbt </a>这样的大规模流行工具已经使模板化SQL成为标准。这两个工具都使用Python库<a class="ae lh" href="https://jinja.palletsprojects.com/en/2.11.x/" rel="noopener ugc nofollow" target="_blank"> Jinja </a>作为它们的模板引擎，这使得:</p><ul class=""><li id="ecc2" class="mg mh it lk b ll lm lo lp lr mi lv mj lz mk md ml mm mn mo bi translated">将<strong class="lk jd">变量</strong>注入SQL代码。</li><li id="797c" class="mg mh it lk b ll mp lo mq lr mr lv ms lz mt md ml mm mn mo bi translated">定义生成SQL(宏)的<strong class="lk jd">函数</strong>。</li><li id="163c" class="mg mh it lk b ll mp lo mq lr mr lv ms lz mt md ml mm mn mo bi translated"><strong class="lk jd">对于循环和宏，通过使用变量避免重复</strong>。</li></ul><p id="2329" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这些特性允许SQL开发人员编写更多<strong class="lk jd">可维护的</strong>代码，并且更有<strong class="lk jd">生产力</strong>，所以我们认为这是linter支持的一个重要特性。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mf"><img src="../Images/0ca527ead398a20b6e27e0fb3f8b06af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NTEjVfpYLWONaOUC_Jjf2g.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">用Jinja模板化的查询示例</p></figure><p id="2061" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">SQLFluff以模块化的方式支持模板化。今天，我们支持关闭模板，使用Jinja，或者使用在内部重用dbt编译器的dbt模板。</p><p id="e733" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">支持模板也带来了挑战！例如，大多数用户不关心模板化部分中的样式<strong class="lk jd">问题，所以我们必须找到一种方法来忽略它们(错误，而不是用户)😅).Alan实现了“源代码映射”，报告用户看到的行号(模板化前)，而不是模板化后。我们有时也会看到修复规则<em class="me">会将</em>泄漏到模板化部分的问题。</strong></p><p id="08bc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我认为该项目正在快速解决所有这些特定于模板的困难，我非常兴奋地看到SQLFluff中模板支持的发展，如预模板代码上规则的实现，例如应用于Jinja标签的<a class="ae lh" href="https://docs.sqlfluff.com/en/stable/rules.html#sqlfluff.core.rules.Rule_L046" rel="noopener ugc nofollow" target="_blank"> Rule_L046 </a>。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="7433" class="nc nd it bd ne nf om nh ni nj on nl nm ki oo kj no kl op km nq ko oq kp ns nt bi translated">SQLFluff的未来</h1><h2 id="9cca" class="nu nd it bd ne nv nw dn ni nx ny dp nm lr nz oa no lv ob oc nq lz od oe ns iz bi translated">🤔超越风格和代码气味的规则</h2><p id="3943" class="pw-post-body-paragraph li lj it lk b ll of kd ln lo og kg lq lr oh lt lu lv oi lx ly lz oj mb mc md im bi translated">我们最近在SQLFluff中添加了<a class="ae lh" href="https://docs.sqlfluff.com/en/stable/developingplugins.html" rel="noopener ugc nofollow" target="_blank">插件</a>，允许用户在自己的公司中开发自定义规则，而不必与社区共享。</p><p id="8834" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我希望它将允许用户试验非常特定于他们用例的规则，这些规则不容易被共享。</p><p id="128c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，我们可能开始看到强制执行与GDPR相关的限制的规则，比如“不要使用这个列，使用这个新的匿名列”。我很高兴看到社区对这一功能所做的工作，以及我们将来会看到的规则。</p><h2 id="4d78" class="nu nd it bd ne nv nw dn ni nx ny dp nm lr nz oa no lv ob oc nq lz od oe ns iz bi translated">sqlfluff的不同接口</h2><p id="a3f2" class="pw-post-body-paragraph li lj it lk b ll of kd ln lo og kg lq lr oh lt lu lv oi lx ly lz oj mb mc md im bi translated">如果你在GitHub上查看<a class="ae lh" href="https://github.com/sqlfluff" rel="noopener ugc nofollow" target="_blank"> SQLFluff组织</a>，你会看到几个项目。其中包括:</p><ul class=""><li id="8e5a" class="mg mh it lk b ll lm lo lp lr mi lv mj lz mk md ml mm mn mo bi translated"><a class="ae lh" href="https://github.com/sqlfluff/sqlfluff-online" rel="noopener ugc nofollow" target="_blank"> sqlfluff-online </a>允许用户在网站上获得他们的SQL链接。</li><li id="a735" class="mg mh it lk b ll mp lo mq lr mr lv ms lz mt md ml mm mn mo bi translated"><a class="ae lh" href="https://github.com/sqlfluff/vscode-sqlfluff" rel="noopener ugc nofollow" target="_blank"> vscode-sqlfluff </a>实现一个vscode插件。</li><li id="977e" class="mg mh it lk b ll mp lo mq lr mr lv ms lz mt md ml mm mn mo bi translated"><a class="ae lh" href="https://github.com/sqlfluff/sqlfluff-github-actions" rel="noopener ugc nofollow" target="_blank"> sqlfluff-github-actions </a>有github动作。</li></ul><p id="44bd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">还有<a class="ae lh" href="https://docs.sqlfluff.com/en/stable/production.html" rel="noopener ugc nofollow" target="_blank">文档</a>介绍如何在CI中使用SQLFluff和<a class="ae lh" href="https://github.com/Bachmann1234/diff_cover" rel="noopener ugc nofollow" target="_blank"> diff-quality </a>或<a class="ae lh" href="https://pre-commit.com/" rel="noopener ugc nofollow" target="_blank">预提交</a>。</p><p id="8a76" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">理想情况下，我们会看到更多的ide与SQLFluff集成，有更多的方式在CI上运行它，甚至有供应商在他们的SQL编辑器中使用SQLFluff。</p><h2 id="d720" class="nu nd it bd ne nv nw dn ni nx ny dp nm lr nz oa no lv ob oc nq lz od oe ns iz bi translated">🤖类型检查</h2><p id="905c" class="pw-post-body-paragraph li lj it lk b ll of kd ln lo og kg lq lr oh lt lu lv oi lx ly lz oj mb mc md im bi translated">目前，SQLFluff不使用来自SQL引擎的元数据。</p><p id="047f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果是这样的话，我们可以用每一列的类型和表的模式来丰富解析后的SQL。它将开启一整类的规则！例如，当对错误类型的列调用函数时，或者当选择了源表中不存在的列时，规则可能会失败。</p><p id="ef66" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在SQL中实现<strong class="lk jd">类型安全</strong>将是一个伟大的里程碑。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="1bb6" class="nc nd it bd ne nf om nh ni nj on nl nm ki oo kj no kl op km nq ko oq kp ns nt bi translated">贡献给SQLFluff</h1><p id="6365" class="pw-post-body-paragraph li lj it lk b ll of kd ln lo og kg lq lr oh lt lu lv oi lx ly lz oj mb mc md im bi translated">为项目做贡献的方式有很多，没有必要写代码做有意义的贡献！</p><ul class=""><li id="5acb" class="mg mh it lk b ll lm lo lp lr mi lv mj lz mk md ml mm mn mo bi translated">使用项目和<a class="ae lh" href="https://github.com/sqlfluff/sqlfluff/issues/new/choose" rel="noopener ugc nofollow" target="_blank">报告你遇到的问题</a>。</li><li id="2b46" class="mg mh it lk b ll mp lo mq lr mr lv ms lz mt md ml mm mn mo bi translated">帮助回答社区关于<a class="ae lh" href="https://join.slack.com/t/sqlfluff/shared_invite/zt-o1f4x0e8-pZzarAIlQmKj_6ZwD16w0g" rel="noopener ugc nofollow" target="_blank">我们的Slack </a>的问题，在<a class="ae lh" href="https://github.com/sqlfluff/sqlfluff/issues" rel="noopener ugc nofollow" target="_blank"> GitHub issues </a>或者<a class="ae lh" href="https://community.getdbt.com/" rel="noopener ugc nofollow" target="_blank"> dbt Slack </a>的#tools-sqlfluff频道。</li><li id="85cf" class="mg mh it lk b ll mp lo mq lr mr lv ms lz mt md ml mm mn mo bi translated">编写<a class="ae lh" href="https://github.com/sqlfluff/sqlfluff/tree/master/docs" rel="noopener ugc nofollow" target="_blank">文档</a>。</li><li id="9f37" class="mg mh it lk b ll mp lo mq lr mr lv ms lz mt md ml mm mn mo bi translated">尝试在您的团队中推出SQLFluff。</li><li id="d648" class="mg mh it lk b ll mp lo mq lr mr lv ms lz mt md ml mm mn mo bi translated">谈论/写SQLFluff。</li></ul><p id="019f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您决定编写代码，您可以参与项目的不同领域:</p><ul class=""><li id="3036" class="mg mh it lk b ll lm lo lp lr mi lv mj lz mk md ml mm mn mo bi translated"><strong class="lk jd">方言</strong>:多为解析逻辑。</li><li id="0229" class="mg mh it lk b ll mp lo mq lr mr lv ms lz mt md ml mm mn mo bi translated"><strong class="lk jd">规则</strong>:文档，添加新规则，添加规则的自动修复。</li><li id="4091" class="mg mh it lk b ll mp lo mq lr mr lv ms lz mt md ml mm mn mo bi translated"><strong class="lk jd">模板</strong>:支持新的模板引擎，改进现有的模板以及它们如何与代码的其余部分交互，比如当一个规则被应用了一个补丁时。</li><li id="9383" class="mg mh it lk b ll mp lo mq lr mr lv ms lz mt md ml mm mn mo bi translated"><strong class="lk jd">性能</strong>:速度，cpu，内存使用。</li></ul><p id="4c07" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当然，对开发工作流程的改进，以及重现GitHub问题中出现的bug的测试总是受欢迎的！</p><h1 id="049f" class="nc nd it bd ne nf ng nh ni nj nk nl nm ki nn kj no kl np km nq ko nr kp ns nt bi translated">结论</h1><p id="52f1" class="pw-post-body-paragraph li lj it lk b ll of kd ln lo og kg lq lr oh lt lu lv oi lx ly lz oj mb mc md im bi translated">感谢您阅读并对该项目感兴趣！我希望你能很快成为这个社区的一员😀。</p><p id="f936" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我要感谢<a class="ae lh" href="https://github.com/alanmcruickshank" rel="noopener ugc nofollow" target="_blank"> Alan Cruickshank </a>创建了这个项目，投入了这么多时间，并邀请我们(维护者)更直接地为SQLFluff做出贡献。</p><p id="f513" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当然，通过这个项目，我认识了很多不可思议的人，我从他们身上学到了东西，并喜欢和他们一起工作。</p><p id="f79c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当你和人们的大部分互动都是通过拉式请求评审，而你最终还是喜欢他们的时候，你知道他们是好人😁。</p><p id="eeb4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">社区非常友好和支持，Slack / GitHub上的每一次互动都非常积极。🙇‍♂️</p><p id="42b3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，下面是Alan在Coalesce 2020上关于SQLFluff的演讲:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="5268" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Niall Woodward (维护者)写了一篇博客，讲述了他一年来为开源做贡献的经历:</p><div class="ox oy gp gr oz pa"><a href="https://www.niallrees.com/posts/lessons-from-a-year-of-open-source" rel="noopener  ugc nofollow" target="_blank"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd jd gy z fp pf fr fs pg fu fw jc bi translated">一年来为开源做出贡献的经验教训</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">一年前，我决定2020年的首要任务是找到一个开源项目。在这篇文章中，我…</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">www.niallrees.com</p></div></div><div class="pj l"><div class="pk l pl pm pn pj po lb pa"/></div></div></a></div></div></div>    
</body>
</html>