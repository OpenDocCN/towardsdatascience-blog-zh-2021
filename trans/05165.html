<html>
<head>
<title>Interactive Mass Spectra with Bokeh</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有散景的交互式质谱</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/interactive-mass-spectra-with-bokeh-3b9163881b12?source=collection_archive---------21-----------------------#2021-05-06">https://towardsdatascience.com/interactive-mass-spectra-with-bokeh-3b9163881b12?source=collection_archive---------21-----------------------#2021-05-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e056" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在Python中创建动态的信息可视化</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ab8005ccc1346cfe0abb28b08bc334dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hQFXJE3luJRkUWa_"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">非pythonic式散景。亚历克斯·伊比在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="d6fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">质谱(MS)数据在概念上很简单。简而言之，就是一个有强制质荷值<em class="ls"> (m/z) </em>和对应的非强制信号强度、电荷状态等的表格。但是一名质谱分析人员内心深处渴望<strong class="ky ir">真正</strong>查看她的数据，在该领域的背景下，这意味着目视检查<em class="ls"> m/z </em>和强度值的分布。质谱传统上被表示为离散光谱的一系列垂直线或未处理数据的平滑连续线，x轴上的<strong class="ky ir"><em class="ls">m/z</em></strong>和y轴上的<strong class="ky ir">强度</strong>。两个轴上的值的范围通常非常宽，因此在检查光谱时，缩放功能会很方便。准确的<em class="ls"> m/z </em>值对观察者来说通常很重要，这使得数字标签很方便。</p><p id="d248" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">研究人员经常使用专有的供应商软件来查看质谱，但是拥有简单的开源选项不是很好吗？在Python发布的内容中，<a class="ae kv" href="https://github.com/bittremieux/spectrum_utils" rel="noopener ugc nofollow" target="_blank"> spectrum_utils </a> [1]包提供了基于<a class="ae kv" href="https://altair-viz.github.io/" rel="noopener ugc nofollow" target="_blank"> Altair可视化库</a>显示交互式质谱的能力。在这篇文章中，我将分享使用<a class="ae kv" href="https://bokeh.org/" rel="noopener ugc nofollow" target="_blank">散景</a>绘制交互式MS可视化的方法，在我看来，它在创建交互式绘图和仪表板的简单性和灵活性之间提供了惊人的平衡。</p><p id="0176" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">散景可视化可以在HTML文档中嵌入所有必要的数据和交互功能(<strong class="ky ir">独立</strong>图)，或者它们可以连接到正在运行的Python实例，提供对几乎无限的自定义数据处理的访问。独立的散景图可以保存并在网络浏览器中查看，或者嵌入到Jupyter笔记本中。如果你有Bokeh (2.3.1)和<a class="ae kv" href="https://jupyter.org/" rel="noopener ugc nofollow" target="_blank"> JupyterLab </a> (3.0.14)的新版本(截至2021年5月)，<a class="ae kv" href="https://docs.bokeh.org/en/latest/docs/user_guide/jupyter.html" rel="noopener ugc nofollow" target="_blank">通过pip或conda安装jupyter_bokeh扩展</a>应该足够了。有了扩展，只需调用output_notebook()，一旦调用show()命令，绘图就会出现在笔记本中。此外，如果要将绘图保存为HTML文件，请添加命令output_file('file name.html ')。</p><p id="49bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们从加载库开始，打开带有与单个肽谱对应的<em class="ls"> m/z </em>和强度值的表格。代码和数据示例可以在GitHub repo 中找到。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lt lu l"/></div></figure><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="f39f" class="ma mb iq lw b gy mc md l me mf">(477, 2)</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="499e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">既然质谱传统上显示为一束垂直线，为什么我们不使用<strong class="ky ir"> vbar </strong>绘图命令创建一个图呢？首先，我们将构造一个ColumnDataSource，它是Bokeh中的一个强大结构，支持可视化之间的交互性和连接性。其次，我们应该指定工具提示，每当光标悬停在信号上时，该工具提示将显示强度和小数点后有4位数的<em class="ls"> m/z </em>值。然后，我们使用定制的工具集创建所需尺寸的图形，包括限制在x轴上的平移和滚轮缩放，最后添加垂直条。下面我粘贴了动画GIF图像，展示了结果图的交互功能:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lt lu l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mg"><img src="../Images/b6a0674b8b17ccd4857821d6c3c3ccdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*TBMVG0QlVPFsS2cpBKMzdQ.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="fce0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看起来令人鼓舞，但有一些明显的不足之处。条形具有固定的宽度，我们希望用非常细的条形/线条来分隔一些非常接近但可区分的<em class="ls"> m/z </em>值。这导致在现代超高分辨率屏幕上很难看到非常细的线条。我认为，不管缩放比例如何，光谱将受益于具有恒定厚度的更大线条。此外，悬停工具不能正常工作，因为条形非常细，即使我们已经正确指定了工具。</p><p id="2e1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个<strong class="ky ir">线图</strong>是另一个选项，但是我们需要稍微修改数据，以便得到垂直的条，而不是实验数据点之间的最短的线。让我们将强度为零的点添加到每个原始信号中，这将使它们看起来像一条垂直线:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lt lu l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="db3c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在可以把光谱表示成一条连续的线。让我们也介绍一下轴标签，并添加一条特殊的线来显示前体离子的<em class="ls"> m/z </em>和电荷(参见<a class="ae kv" href="https://egor-pro.medium.com/missing-with-out-a-trace-da186405e02b" rel="noopener">我之前的博客文章</a>关于前体和碎片)，这是质谱学家会喜欢的一条附加信息:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lt lu l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mg"><img src="../Images/17abe4617fd78691cd43d2c4c52635ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*26xWJ30v3b9MlKAX3jRxlg.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="03b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这样好多了！请注意悬停工具在所有缩放级别的表现，每当我们将光标移过该行时，都会显示注释。</p><p id="d9c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果信号有标注，用颜色突出标注的类别会很酷。我们可以通过为每个类别创建一个单独的行来实现这一点。此外，可以用figure.legend.click_policy属性指定交互行为，这样，当单击相应的图例项时，信号将静音或隐藏。让我们加载带注释的表格，将其转换为“垂直”信号，然后创建复合线图:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lt lu l"/></div></figure><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="7430" class="ma mb iq lw b gy mc md l me mf">array(['Unknown', 'Identified', 'Contaminant'], dtype=object)</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lt lu l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lt lu l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mh"><img src="../Images/e356920f4fb3ccd50dbb0f2df49bf492.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*9xRCCAfc3kKN0MbjfoegMw.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h2 id="d896" class="ma mb iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">结论</h2><p id="2393" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">我们已经使用散景创建了一个交互式注释质谱。可视化可以作为HTML文档保存和共享，或者嵌入到Jupyter笔记本中。代码和数据示例可在<a class="ae kv" href="https://github.com/dev-ev/ms-interactive-viz" rel="noopener ugc nofollow" target="_blank">GitHub repo</a>中找到。</p><h2 id="010a" class="ma mb iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">参考</h2><p id="728c" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">[1] Wout Bittremieux。<a class="ae kv" href="https://pubs.acs.org/doi/10.1021/acs.analchem.9b04884" rel="noopener ugc nofollow" target="_blank"> spectrum_utils:用于质谱数据处理和可视化的Python包</a>。分析化学(2020)，92(1)659–661。</p></div></div>    
</body>
</html>