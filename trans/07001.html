<html>
<head>
<title>Understanding Depthwise Separable Convolutions and the efficiency of MobileNets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">理解深度可分卷积和移动网络的效率</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/understanding-depthwise-separable-convolutions-and-the-efficiency-of-mobilenets-6de3d6b62503?source=collection_archive---------5-----------------------#2021-06-25">https://towardsdatascience.com/understanding-depthwise-separable-convolutions-and-the-efficiency-of-mobilenets-6de3d6b62503?source=collection_archive---------5-----------------------#2021-06-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bcaa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">移动网和深度可分卷积的解释</h2></div><h2 id="e546" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">简介:</h2><p id="1df2" class="pw-post-body-paragraph le lf it lg b lh li ju lj lk ll jx lm kr ln lo lp kv lq lr ls kz lt lu lv lw im bi translated">在卷积神经网络(CNN)中，2D卷积是最常用的卷积层。MobileNet是一种CNN架构，速度更快，模型更小，使用了一种新的卷积层，称为深度方向可分离卷积。由于模型的尺寸较小，这些模型被认为对于在移动和嵌入式设备上实现非常有用。因此得名MobileNet。</p><p id="088d" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">关于MobileNets的原始论文可在此处获得— <a class="ae mc" href="https://arxiv.org/pdf/1704.04861.pdf" rel="noopener ugc nofollow" target="_blank"> MobileNets:用于移动视觉应用的高效卷积神经网络</a></p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi md"><img src="../Images/b46e5504cbe9b135998c704e9e396279.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*oIJtvbsHhXuKPKKl-f3L6g.png"/></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">表1。MobileNet与GoogleNet和VGG 16的参数和准确性比较(来源:原始论文中的表格)</p></figure><p id="75fb" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">表1清楚地显示了即使是最深入的MobileNet架构也比著名的CNN架构具有更少的参数。较小的MobileNets只有130万个参数。此外，模型的大小明显更小。虽然VGG16型号可以占用高达500 MB的磁盘空间，但MobileNet只需要16–18MB。这使得它非常适合在移动设备上加载。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mp"><img src="../Images/0548da784908f0bb306e839f054c7469.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j-gTGI3JyFUrje9QmhZ0Pw.png"/></div></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">图一。MobileNets可以用于移动设备上的对象检测、分类、属性检测，甚至是地标识别(来源:图片来自原论文)</p></figure><h2 id="955d" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">深度方向卷积；</h2><p id="74cc" class="pw-post-body-paragraph le lf it lg b lh li ju lj lk ll jx lm kr ln lo lp kv lq lr ls kz lt lu lv lw im bi translated"><em class="mu">差异</em> —</p><p id="4099" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">2D卷积和深度卷积之间的主要区别在于，2D卷积是在所有/多个输入通道上执行的，而在深度卷积中，每个通道保持分离。</p><p id="f3ed" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated"><em class="mu">接近</em> —</p><ol class=""><li id="b6e5" class="mv mw it lg b lh lx lk ly kr mx kv my kz mz lw na nb nc nd bi translated">3维输入张量被分成单独的通道</li><li id="4885" class="mv mw it lg b lh ne lk nf kr ng kv nh kz ni lw na nb nc nd bi translated">对于每个通道，输入与滤波器(2D)进行卷积</li><li id="9902" class="mv mw it lg b lh ne lk nf kr ng kv nh kz ni lw na nb nc nd bi translated">然后将每个通道的输出叠加在一起，得到整个3D张量的输出</li></ol><p id="ea3e" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated"><em class="mu">图形描述</em> —</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nj"><img src="../Images/309ed56d629ff4e954655a1713d127b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*itR3tHcH9orxQqtC4CHu0A.png"/></div></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">图二。深度方向卷积的图解说明(来源:图片由作者创建)</p></figure><h2 id="11b9" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">深度方向可分离卷积；</h2><p id="425b" class="pw-post-body-paragraph le lf it lg b lh li ju lj lk ll jx lm kr ln lo lp kv lq lr ls kz lt lu lv lw im bi translated">深度方向卷积通常与另一个步骤(深度方向可分离卷积)结合使用。这包含两个部分— 1 .过滤(所有前面的步骤)和2。组合(根据需要，组合3个颜色通道以形成“n”个通道——在下面的示例中，我们将看到如何组合3个通道以形成1个通道输出)。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nk"><img src="../Images/ab15f8335900dedede3d12e29e487afe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xxhZrJBY23Px3nbAJiFanQ.png"/></div></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">图3。深度方向可分离卷积的图解说明(来源:图片由作者创建)</p></figure><h2 id="cf49" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">为什么深度可分卷积如此高效？</h2><p id="9be9" class="pw-post-body-paragraph le lf it lg b lh li ju lj lk ll jx lm kr ln lo lp kv lq lr ls kz lt lu lv lw im bi translated"><em class="mu">深度方向卷积是</em> -所有通道上的1x1卷积</p><p id="495b" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">假设我们有一个大小为8x8x3的输入张量，</p><p id="af5b" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">并且期望的输出张量的大小是8×8×256</p><p id="da5f" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated"><strong class="lg iu">在2D回旋</strong>——</p><p id="ae66" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">所需的乘法次数—(8×8)x(5x5x 3)x(256)=<strong class="lg iu"><em class="mu">1，228，800 </em> </strong></p><p id="c267" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated"><strong class="lg iu">在深度方向可分离卷积中</strong></p><p id="5592" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">所需的乘法次数:</p><p id="76b0" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">a.<strong class="lg iu">滤波</strong> —分成单通道，所以需要5x5x1滤波器来代替5x5x3，由于有三个通道，所以需要的5x5x1滤波器总数为3，所以，</p><p id="7180" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">(8x8)x(5x5x 1)x(3)= 3800</p><p id="6813" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">b.<strong class="lg iu">合并</strong> —所需通道总数为256，因此，</p><p id="027b" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">(8x8) x (1x1x3) x (256) = 49，152</p><p id="c289" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">乘法总数= 3800+49152 =<strong class="lg iu"><em class="mu">53952</em></strong></p><p id="22ca" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">因此，2D卷积需要1，228，800次乘法运算，而深度方向可分离卷积只需要53，952次乘法运算即可达到相同的输出。</p><p id="745a" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">最后，</p><p id="7e6d" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated"><strong class="lg iu"> 1，228，800/53，952 = 23倍减去所需乘法运算</strong></p><blockquote class="nl nm nn"><p id="5786" class="le lf mu lg b lh lx ju lj lk ly jx lm no lz lo lp np ma lr ls nq mb lu lv lw im bi translated"><em class="it">因此深度方向可分卷积的效率很高。这些是在MobileNet架构中实现的层，用于减少计算数量并降低功耗，以便它们可以在没有强大图形处理单元的移动/嵌入式设备上运行。</em></p></blockquote></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><h1 id="16f3" class="ny kj it bd kk nz oa ob kn oc od oe kq jz of ka ku kc og kd ky kf oh kg lc oi bi translated">MobileNet</h1><ol class=""><li id="aeae" class="mv mw it lg b lh li lk ll kr oj kv ok kz ol lw na nb nc nd bi translated">使用<strong class="lg iu"> <em class="mu">深度方向可分离卷积</em> </strong></li><li id="00b2" class="mv mw it lg b lh ne lk nf kr ng kv nh kz ni lw na nb nc nd bi translated">使用两个<strong class="lg iu"> S <em class="mu">收缩超参数</em>T25】:</strong></li></ol><p id="ef8e" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">a.<em class="mu">调整通道数量的宽度乘数</em></p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi om"><img src="../Images/5de553f8c07fcf5e79692c24bc810709.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*piBs84ei2ToZuZhYJOI3NA.png"/></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">表二。MobileNet中的宽度乘数(来源:原始论文中的表格)</p></figure><p id="a920" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">b.<em class="mu">分辨率倍增器</em>，调整特征图和输入图像的空间尺寸</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi on"><img src="../Images/63979da5cede6e3fed00f62c21cbd9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*8dLSOP2MPqpF5jB0XysAdQ.png"/></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">表3。MobileNet中的分辨率乘数(来源:原始论文中的表格)</p></figure><p id="6cfe" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated"><em class="mu">架构</em>—MobileNet的第一层是全卷积，而所有后续层都是深度方向可分离的卷积层。所有层之后是批量标准化和ReLU激活。最终分类层具有softmax激活。完整的架构如表4所示。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi md"><img src="../Images/2dec829626f86555923712e90882cc8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*MSHQ5Dh3O2dPWrg7xDnpTg.png"/></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">表4。MobileNet架构(来源:原始论文中的表格)</p></figure><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/c4e8067e7a7f02d7db89e37486650a7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*Vnr18uaV6khM69nD35aHIA.png"/></div><p class="ml mm gj gh gi mn mo bd b be z dk translated">图4。左:标准卷积层，右:MobileNet中深度方向可分离的卷积层(来源:图片来自原论文)</p></figure><p id="db7f" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">图4显示了普通CNN模型和MobileNets在架构流程上的区别。在图像的左侧，我们看到一个3x3卷积层，后面是批归一化和ReLU，而在右侧，我们看到深度方向可分离卷积层，由一个3x3深度方向卷积和一个批范数和ReLU组成，后面是一个1x1点方向卷积，再后面是一个批范数和ReLU。</p><h2 id="4c9a" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">结论:</h2><p id="64b7" class="pw-post-body-paragraph le lf it lg b lh li ju lj lk ll jx lm kr ln lo lp kv lq lr ls kz lt lu lv lw im bi translated">MobileNets是专门为移动设备设计的非常高效的小型深度学习架构。由于尺寸较小，与较大的全卷积架构相比，精度会有所下降，但这种情况非常微小。例如，在Stanford dogs数据集上，Inception V3模型的准确率为84%，而最大的MobileNet的准确率为83.3%。但是如果我们看看每个模型架构的参数数量，Inception V3有2320万个参数，而MobileNet只有330万个参数。此外，仅仅通过使用宽度倍增器或分辨率倍增器，就可以制作更小更快的MobileNet版本。这使得MobileNets成为移动和嵌入式设备上非常受欢迎的深度学习模型。</p><p id="e6a2" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated">接下来，我打算展示如何使用TensorFlow在python中从头开始创建MobileNet架构。</p></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><p id="a908" class="pw-post-body-paragraph le lf it lg b lh lx ju lj lk ly jx lm kr lz lo lp kv ma lr ls kz mb lu lv lw im bi translated"><strong class="lg iu">参考文献:</strong></p><ol class=""><li id="a6c6" class="mv mw it lg b lh lx lk ly kr mx kv my kz mz lw na nb nc nd bi translated">Howard，A. G .，Zhu，m .，Chen，b .，Kalenichenko，d .，Wang，w .，Weyand，t .，Andreetto，m .和Adam，H. (2017)。MobileNets:用于移动视觉应用的高效卷积神经网络</li></ol></div></div>    
</body>
</html>