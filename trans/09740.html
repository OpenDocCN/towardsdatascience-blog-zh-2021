<html>
<head>
<title>Simple Guide on using Supervised Learning Model to forecast for Time-Series Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用监督学习模型预测时间序列数据的简单指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/simple-guide-on-using-supervised-learning-model-to-forecast-for-time-series-data-a570720add84?source=collection_archive---------6-----------------------#2021-09-12">https://towardsdatascience.com/simple-guide-on-using-supervised-learning-model-to-forecast-for-time-series-data-a570720add84?source=collection_archive---------6-----------------------#2021-09-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4c0e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用XGBoost预测时间序列数据的未来值</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8d19628ee2cd50083334d831b8c13586.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hmESnb4FfvDxlCm_tLviUw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@cgower" rel="noopener ugc nofollow" target="_blank">克里斯托弗·高尔</a>拍摄自<a class="ae ky" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="8bc4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">时间序列预测已经成为一个热门领域，因为许多预测问题涉及预测未来的时间，以允许更好的决策和更有效地管理资源。</p><p id="876e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将发现如何使用监督学习模型XGBoost来预测未来的销售值，该模型使用的数据集来自<a class="ae ky" href="https://console.cloud.google.com/bigquery(cameo:product/iowa-department-of-commerce/iowa-liquor-sales)?project=sue-gcp-learning-env" rel="noopener ugc nofollow" target="_blank">谷歌大查询-爱荷华州酒类零售预测的公共数据。(资料来源:爱荷华酒精饮料部)</a></p><p id="41eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">目录:</strong></p><ul class=""><li id="835a" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">什么是时间序列数据？</li><li id="abd1" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">监督学习简介</li><li id="be63" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">了解我们的数据集(EDA)</li><li id="46d6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">预处理/格式化数据集</li><li id="de78" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">时间序列数据的特征工程</li><li id="8648" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">拟合模型</li></ul><h2 id="624a" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">什么是时间序列数据？</h2><p id="4414" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">时间序列数据通常由大多数公司生成，如销售数据、库存数据、财务数据、股票价格等。<a class="ae ky" href="https://www.investopedia.com/terms/t/timeseries.asp" rel="noopener ugc nofollow" target="_blank">时间序列通常是指在一段时间内连续产生的数据序列</a>，基于时间的属性在时间序列数据集中起着重要的作用。</p><p id="08b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个简单的时间序列数据如下图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/dd0a84a3a0c92495037b01a54810ee29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ghR3zawxuouOlCj-LgUKA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">时间序列示例(图片由作者提供)</p></figure><ul class=""><li id="c541" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">时间戳列指示收集值的时间。</li><li id="9756" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">Sales列是当时产生的值。</li></ul><p id="e247" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">预测模型将使用历史数据的知识来预测未来不同时间段会发生什么。有许多方法可以利用时间序列数据进行预测，如SARIMA萨里玛(自回归综合移动平均，季节性自回归综合移动平均)，指数平滑模型，神经网络模型-如LSTM(长短期记忆)，以及机器学习方法，如决策树，SVM(支持向量机)，XGBoost等。上述所有方法都是时间序列预测的常用方法。现在，让我们来理解监督学习的概念。</p><h2 id="9a6e" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">监督学习简介</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/ac3ad8e8535dde3975a35017d3e605de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wj7sHpqT7ZQ_s1W6DhmpjA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">监督学习图解(图片由作者提供)</p></figure><p id="c584" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">监督学习模型的目标是学习输入数据和输出数据(目标变量)之间的关系。<a class="ae ky" href="https://searchenterpriseai.techtarget.com/definition/supervised-learning" rel="noopener ugc nofollow" target="_blank">模型将根据与已知输出一起提供的数据进行训练，并进行多次迭代训练，直到模型能够检测到输入数据和输出数据之间的潜在模式，从而使模型能够以高精度预测未知数据</a>。</p><p id="4e9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上图是预测这是什么动物的监督学习问题的简单例子。输入数据是动物的图像和细节，如大小、长度、颜色、耳朵长度等。连同输出值，以便模型可以知道兔子应该如何。</p><p id="8385" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种相同的方法可以应用于时间序列数据，方法是重新构建数据集，使其看起来像一个监督学习问题，例如时间序列数据集中以前的值将用作预测未来值的输入变量。</p><h2 id="7eb5" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">了解我们的数据集:</h2><p id="8c61" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">如前所述，我们将使用一组来自<a class="ae ky" href="https://console.cloud.google.com/bigquery(cameo:product/iowa-department-of-commerce/iowa-liquor-sales)?project=sue-gcp-learning-env" rel="noopener ugc nofollow" target="_blank">谷歌大查询公共数据——爱荷华州酒类销售预测的数据。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/e23f29380f342de594dbf217c3fe2e5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*PZWtq6DeMVhHYmGEulS7zQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">谷歌大查询公共数据—爱荷华州酒类销售预测</p></figure><p id="e519" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们来看看数据集——“2020 _销售_培训”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/035317513189326a4c1ac75054758ba5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2onJJCBXSIDWPAsYZOtikA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">训练数据集的示例视图(作者提供的图片)</p></figure><p id="046b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个数据集，包含2020年爱荷华州每周批发购买的酒。如上图中训练数据的示例视图所示，我们可以注意到每周的零售额已经按县、邮政编码、城市和商店名称进行了细分。让我们执行一些简单的数据探索，以更好地了解我们在Big Query中的数据集。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/a39f4c1b0d4d57dd98e1fae26506add3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BBzMHnRPuY1EVKP_YUVpXw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">县、城市、邮政编码和商店数量的细分(图片由作者提供)</p></figure><p id="28d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过对数据集的简单查询，我们可以看到共有119个县的1881家不同的商店。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/4f46cea3970b53e9c7eab70db48e6bd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lK-eQ08ik14m5HMtF-hAYg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">按国家/地区划分的总销售额—前10名(按作者划分的图片)</p></figure><p id="bf23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">按国家对总销售额的进一步细分显示，“波尔克”的销售额在所有县中最高，其次是“林恩”和“斯科特”。我们将通过预测每周所有商店的总销售额来简化本教程，而不是预测每个商店、城市、邮政编码或商店的总销售额。下面是用于计算每周总销售额的SQL查询。</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="fc9a" class="mj mk it no b gy ns nt l nu nv">With Table_A as (<br/>SELECT date,<br/>EXTRACT(ISOYEAR FROM date) AS isoyear,<br/>EXTRACT(ISOWEEK FROM date) AS isoweek,<br/>sum(sale_dollars) as Total_Sales FROM `bigquery-public-data.iowa_liquor_sales_forecasting.2020_sales_train`<br/>group by date, EXTRACT(ISOYEAR FROM date), EXTRACT(ISOWEEK FROM date)<br/>order by date)<br/>select min(date) as Week_date, isoyear, isoweek, sum(Total_Sales) as Total_Sales_dollars from Table_A<br/>group by isoyear,isoweek<br/>order by min(date)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/38e3e9bb5112cbfdc0b09809af1f2326.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*mNk75AjJMoSN9y99y3BHJw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">每周总销售额</p></figure><p id="9652" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上图显示了所有商店每周的总销售额。周值是根据ISO周编号从日期列中提取的。现在，让我们画出2020年每周的总销售量</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/efaa5c528ff5841aa8e732da93e32978.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bEqbBXU5eHIkslSP9ABCbA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">每周总销售额(图片由作者提供)</p></figure><p id="a22f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从上面的图中，我们可以看出全年的总销售额没有任何季节性趋势，但我们也注意到销售量随着时间的推移在逐渐增加。</p><blockquote class="ny nz oa"><p id="44ce" class="kz la ob lb b lc ld ju le lf lg jx lh oc lj lk ll od ln lo lp oe lr ls lt lu im bi translated">“季节性是在一段时间内重复的模式，具有影响时间序列信号的长期相关性。”</p></blockquote></div><div class="ab cl of og hx oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="im in io ip iq"><p id="d4a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们从预处理数据集开始，并确定我们可以为模型构建什么特征。由于我们使用的是监督学习模型方法，我们需要将数据框定为监督学习问题。</p><h2 id="01b6" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">预处理/格式化数据集</h2><p id="ddd3" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">首先，让我们进行最基本的检查，看看数据集中是否有缺失值。</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="1ae4" class="mj mk it no b gy ns nt l nu nv">print(Train_Table.isnull().sum())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/874fadc5c67844dfdd0de6f28734ab18.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*qoxIIXBe4Ni9Q3RyLuXx6A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">空记录的数量(按作者排列的图片)</p></figure><p id="25e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从上面的结果中，我们可以看到数据集在所有列中都没有缺失值。接下来，如果您查看所提供数据的数据类型，您会注意到我们的日期列(“Week_date”)是字符串格式的。通过将数据类型更改为“日期”来格式化此列</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="129c" class="mj mk it no b gy ns nt l nu nv">Train_Table['Week_date'] = pd.to_datetime(Train_Table['Week_date'], errors="coerce")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/6a699c6876a36104543d688b4b156b93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r3c9WkOnVyHIwkAdXekmZw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将Week_date列从“字符串”类型转换为“日期时间”(图片由作者提供)</p></figure><p id="bbcb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">日期列(“Week_Date”)是基于时间的列，需要转换为DateTime对象。使用正确的数据列格式，我们可以基于日期列索引数据框。</p><h2 id="4848" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">时间序列数据的特征工程</h2><p id="f503" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在构建模型之前，我们需要使用一组要素/输入变量(x)和输出变量(y目标)来重新构建数据集。以下是在时间序列数据集上生成的常见特征:</p><ul class=""><li id="9eef" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">滞后期</strong> : <em class="ob">滞后值</em> <em class="ob">(如昨天、上周、上月等。)</em></li></ul><p id="98ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个例子中，因为我们的数据集是按周的，所以数量值滞后一周。</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="7fd7" class="mj mk it no b gy ns nt l nu nv">#Python shift() function <br/>Train_Table['Total_Sales_Dollars_lag1'] = Train_Table['Total_Sales_dollars'].shift(1)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/69706ce42312028bf0e65678ee9a4518.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*gXEW21UVAX8FISffao96rg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">“Total_Sales_Dollars_lag1”功能已创建(图片由作者提供)</p></figure><ul class=""><li id="9aab" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">移动平均滞后期</strong> : <em class="ob">过去X小时/天/周的移动平均</em></li></ul><p id="9c1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建移动平均特征是为了消除特定时间段内异常值和波动的值和影响。在本例中，我们创建了一个滞后1周的滚动2周平均值，以避免数据泄漏。</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="007b" class="mj mk it no b gy ns nt l nu nv">#Python rolling().mean() function <br/>Train_Table['Total_Sales_Dollar_MA2_lag1'] = Train_Table['Total_Sales_dollars'].rolling(2).mean().shift(1).reset_index(0,drop=True)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/441b13473372fd7c0f3509642be7d4f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*PKKZvxSKHx73uB4kn4miOQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">“Total_Sales_Dollar_MA2_lag1”功能已创建(图片由作者提供)</p></figure><p id="696d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">差异</strong> : <em class="ob">当前小时/日/周/月值减去前一小时/日/周/月值(例如，昨天的值与上周同一天的值的差异)</em></p><p id="c2e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">计算与先前值之差的要素被视为趋势要素。在本例中，我们计算了本周与前一周的差值，相差1周。</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="91fe" class="mj mk it no b gy ns nt l nu nv">#Python diff() function <br/>def difference(data, feature):<br/>    # assume data is already sorted<br/>    return data[feature] - data['Total_Sales_dollars'].shift(1)</span><span id="376f" class="mj mk it no b gy oq nt l nu nv">Train_Table['Total_Sales_Dollar_Difference_lag1'] = difference(Train_Table,'Total_Sales_dollars').shift(1)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/fefd3c6c9d90c30a6117c9d5dc9cb3f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gODcR2-GW-_RQDmFXuYAjA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">“Total _ Sales _ Dollar _ Difference _ la G1”功能已创建(图片由作者提供)</p></figure><p id="2ca4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除此之外，我们还可以创建计算当前值和以前值之间的百分比变化的特性。在本例中，我们将计算当前周与前一周相差1周的百分比变化。</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="0687" class="mj mk it no b gy ns nt l nu nv">def difference_in_percentage(data, feature):<br/>    # assume data is already sorted<br/>    lag_by_1 = data[feature].shift(1)</span><span id="6f4a" class="mj mk it no b gy oq nt l nu nv">return (data[feature] - lag_by_1)/(lag_by_1)</span><span id="4e49" class="mj mk it no b gy oq nt l nu nv">Train_Table['Total_Sales_Dollar_Difference_in_Percent_Lag1'] = difference_in_percentage(Train_Table,'Total_Sales_dollars').shift(1)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/83da798e00cbdc2cd0dd48c84f3a6328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yrLMjRZ64EcK7dRgRQrQsQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">“Total _ Sales _ Dollar _ Difference _ in _ Percent _ la G1”功能已创建(图片由作者提供)</p></figure><ul class=""><li id="31df" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">时间戳分解</strong> : <em class="ob">一周中的某天、一月中的某天、一年中的某月、工作日或周末。</em></li></ul><p id="83e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">日期中的年、月、周和日的值也可以用作数字特征。在本例中，我们已经使用SQL查询提取了周和年。但是如果我们要使用python来执行，我们可以通过以下方法来实现:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="d8df" class="mj mk it no b gy ns nt l nu nv">Train_Table['week'] =Train_Table['Week_date'].dt.week<br/>Train_Table['month'] =Train_Table['Week_date'].dt.month<br/>Train_Table['year'] =Train_Table['Week_date'].dt.year</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/b9a561ecbabe59d98b6d41b664615dc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*tJi7X8GQvRizwOJR1zfQIw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建了“年”、“月”、“周”功能(图片由作者提供)</p></figure><p id="7e0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以创建的其他特征是— <strong class="lb iu">统计值，例如</strong> <em class="ob">昨天、上周、前两周等的最小值、最大值、平均值、标准偏差值。</em></p><p id="ca66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，我们应该已经生成了一组供模型使用的特性。现在让我们进入下一步——拟合模型。</p><h2 id="a172" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">拟合模型</h2><p id="af40" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">首先，确定哪些是可以使用的特性，哪些应该被索引。在此处的示例中，我不会采用“Year”特性，因为培训数据属于同一年，并且将对“Week_date”列进行索引。</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="8dd4" class="mj mk it no b gy ns nt l nu nv">Train_Table = Train_Table [['Week_date', 'Total_Sales_dollars', 'Total_Sales_Dollars_lag1','Total_Sales_Dollar_MA2_lag1','Total_Sales_Dollar_Difference_lag1','Total_Sales_Dollar_Difference_in_Percent_Lag1', 'month','week']]</span><span id="e570" class="mj mk it no b gy oq nt l nu nv">Train_Table = Train_Table.fillna(0)</span><span id="2d88" class="mj mk it no b gy oq nt l nu nv">Table = Train_Table.set_index('Week_date')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/3769605c486202b4804d198bff2f390f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qQPQD0A2RreGinX2M-5F-g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">按“周日期”选择的功能和索引(图片由作者提供)</p></figure><p id="431f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将根据80:20规则将数据分为训练集和测试集。</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="576c" class="mj mk it no b gy ns nt l nu nv">from sklearn.model_selection import train_test_split</span><span id="7934" class="mj mk it no b gy oq nt l nu nv">training_data, testing_data = train_test_split(Table, test_size=0.2)<br/>print(f"No. of training examples: {training_data.shape[0]}")<br/>print(f"No. of testing examples: {testing_data.shape[0]}")</span></pre><p id="2e85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将数据分为x_train、y_train、x_test和y_test —输入(x)和输出(y)</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="5eae" class="mj mk it no b gy ns nt l nu nv">x_train, y_train = training_data.drop("Total_Sales_dollars", axis=1), training_data['Total_Sales_dollars']<br/>x_test, y_test   = testing_data.drop("Total_Sales_dollars", axis=1) , testing_data['Total_Sales_dollars']</span></pre><p id="cb67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将数据集分为输入(x)和输出(y)后，我们可以导入XGBoost模型库，并用训练集拟合模型。</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="0d70" class="mj mk it no b gy ns nt l nu nv">import xgboost as xgb<br/>from sklearn.metrics import mean_absolute_error</span><span id="5fbf" class="mj mk it no b gy oq nt l nu nv">model = xgb.XGBRegressor(n_estimators=1000)<br/>model.fit(x_train, y_train,<br/>        eval_set=[(x_train, y_train), (x_test, y_test)],<br/>        early_stopping_rounds=50, #stop if 50 consequent rounds without decrease of error<br/>        verbose=False) </span></pre><p id="190f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">模型定型后，将模型应用于测试集并评估模型性能。这里使用的性能指标是平均绝对误差(MAE)。MAE是基于预测误差值的平均值计算的，误差值被转换为正值。有许多不同的性能指标可供使用，如误差比、均方误差。如果你感兴趣，你可以参考这篇文章，它列出了不同的性能指标——时间序列预测的各种性能指标<a class="ae ky" href="https://machinelearningmastery.com/time-series-forecasting-performance-measures-with-python/" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="7f18" class="mj mk it no b gy ns nt l nu nv">preds = pd.DataFrame(model.predict(x_test))</span></pre><p id="57fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">衡量模型性能:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="5dfd" class="mj mk it no b gy ns nt l nu nv">from sklearn.metrics import mean_absolute_percentage_error</span><span id="6438" class="mj mk it no b gy oq nt l nu nv">mean_absolute_percentage_error(y_test, preds)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/357da756cae5426efb072f6da0ce0a7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*c2uJQrbrd2crMGZ7SJFGGg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">MAE错误率(图片由作者提供)</p></figure><p id="60d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了获得更好的准确性，我们可以在维持集(模型看不到的另一个测试集)上测试我们的模型。我们可以使用在同一个Google大查询公开数据集下已经提供和可用的数据—<a class="ae ky" href="https://console.cloud.google.com/bigquery(cameo:product/iowa-department-of-commerce/iowa-liquor-sales)?project=sue-gcp-learning-env" rel="noopener ugc nofollow" target="_blank">“2021销售预测”</a>。在将模型应用于测试集之前，应用相同的数据转换并创建用于训练模型的相同特征集。</p><p id="ba04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在对维持数据集应用模型后，我们还可以绘制一个图表来比较实际值和预测值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/73b54c569de0dd46f3686d234672e9a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Qd3SzvirLJelZX_zQWeEQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">实际与预测的对比图(图片由作者提供)</p></figure><p id="7e64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你在上面的图中看到的，我们在2021年有几个星期的时间来测试模型。从图中，我们可以看到，模型预测在开始的几周并不匹配，但在接下来的几周内紧随其后，并在三月底偏离实际。模型表现不佳有几个原因，其中之一可能是由于训练数据不足，因为我们仅使用一年的数据来构建模型，并且没有足够的稳健特征供模型学习。</p><p id="538b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">恭喜，我们已经理解了如何使用监督学习模型来构建时间序列预测。请注意，这只是一个简单的指南，现实生活中的示例将会更加复杂，您需要考虑创建许多不同的要素，例如用于捕捉假期/季节性趋势的alpha变量，从其他驾驶员的数据中生成有助于预测的要素，等等。</p><h2 id="3972" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">结论:</h2><p id="d3b8" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">本文介绍了对时间序列数据特征的基本理解，以及如何将时间序列数据准备成可以应用监督机器学习模型(如XGBoost)的预测问题。</p><p id="5c56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您阅读本文，希望本文对您有所帮助，能够帮助您踏上数据科学之旅的任何一步。</p><h2 id="5b96" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">参考和链接:</h2><p id="4d9d" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">[1]https://www.investopedia.com/terms/t/timeseries.asp<a class="ae ky" href="https://www.investopedia.com/terms/t/timeseries.asp" rel="noopener ugc nofollow" target="_blank"/></p><p id="d6ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[2]<a class="ae ky" href="https://machinelearningmastery.com/xgboost-for-time-series-forecasting/" rel="noopener ugc nofollow" target="_blank">https://machine learning mastery . com/xgboost-for-time-series-forecasting/</a></p><p id="2ce8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[3]<a class="ae ky" href="https://machinelearningmastery.com/time-series-forecasting-supervised-learning/" rel="noopener ugc nofollow" target="_blank">https://machine learning mastery . com/time-series-forecasting-supervised-learning/</a></p><p id="32a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[4]<a class="ae ky" href="https://searchenterpriseai.techtarget.com/definition/supervised-learning" rel="noopener ugc nofollow" target="_blank">https://search enterprise ai . tech target . com/definition/supervised-learning</a></p><p id="2b9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[5]<a class="ae ky" rel="noopener" target="_blank" href="/everything-you-need-to-know-about-time-series-5fa1834d5b18">https://towards data science . com/everything-you-need-known-to-know-about-time-series-5fa 1834 d5b 18</a></p><p id="9490" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[6]<a class="ae ky" href="https://console.cloud.google.com/bigquery(cameo:product/iowa-department-of-commerce/iowa-liquor-sales)" rel="noopener ugc nofollow" target="_blank">https://console . cloud . Google . com/big query(cameo:product/Iowa-department-of-commerce/Iowa-liquid-sales)</a></p></div></div>    
</body>
</html>