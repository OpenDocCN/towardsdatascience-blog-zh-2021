<html>
<head>
<title>From Redshift to Google Spreadsheet Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python从Redshift到Google电子表格</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/from-redshift-to-google-spread-sheet-using-python-fd4b50131940?source=collection_archive---------14-----------------------#2021-07-30">https://towardsdatascience.com/from-redshift-to-google-spread-sheet-using-python-fd4b50131940?source=collection_archive---------14-----------------------#2021-07-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a7a2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">读取、写入和格式化电子表格的简化工作流程</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/8c0259055319fa4866e3c169f494422b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*E5O24W2h9LA6YlvMDblEhw.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><p id="c9d7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最近，我试图从亚马逊红移数据库中提取数据，并使用Python脚本将其推送到谷歌电子表格中。该脚本的目的是从Amazon redshift数据库中读取数据，应用一些业务规则，并将其写入google电子表格。</p><p id="bf7a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我已经在我的python脚本中使用了<a class="ae ln" href="https://docs.gspread.org/en/v3.7.0/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> gspread </strong> </a>库，它只不过是用于google sheets的python API。使用它，我们可以非常容易地读取、写入和格式化电子表格。</p><p id="5a6d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要与Google API交互，第一步是在<a class="ae ln" href="https://console.cloud.google.com/apis/dashboard?ref=https:%2F%2Fwww.google.com%2F&amp;pli=1&amp;project=test-rebike&amp;folder=&amp;organizationId=" rel="noopener ugc nofollow" target="_blank"> Google开发控制台</a>中创建一个项目并启用API。</p><ol class=""><li id="8fce" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated">创建一个项目(<a class="ae ln" href="https://console.cloud.google.com/projectcreate?previousPage=%2Fiam-admin%2Fserviceaccounts%2Fdetails%2F109825980442063387913;edit%3Dtrue%2Fkeys%3Fproject%3Dglossy-protocol-321412%26supportedpurview%3Dproject&amp;folder=&amp;organizationId=0&amp;supportedpurview=project" rel="noopener ugc nofollow" target="_blank">点击这里</a>):</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi lx"><img src="../Images/4e0b93f7eae499d10acd87f2083bd3cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bln8bfJsir77AzElqazIWw.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><p id="161f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">2.给项目命名:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/8afe4f1bb3b9555a6133bd5a495ad3de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*MYs_D2Zw785dzwKewF9bjg.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><p id="df97" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">3.转到项目仪表板，点击+启用API和服务:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi md"><img src="../Images/e25af5cbebe2ae05a41f66624cd7bc3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*y_w8jiXF8qje1FY0e-ieyQ.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><p id="04b1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">4.搜索Google Drive API，点击它并启用它。执行相同的过程来启用Google电子表格API:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi me"><img src="../Images/1f2b1a62f8940d99affaa71ffb11faba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZRurbB5l5DCc07tJVAQyoQ.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><div class="kg kh ki kj gt ab cb"><figure class="mf kk mg mh mi mj mk paragraph-image"><img src="../Images/67e47f2c18a9e24962933dad368ee412.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*fXMgeBP_g1P4ZD6XCHkLRg.png"/></figure><figure class="mf kk ml mh mi mj mk paragraph-image"><img src="../Images/af2c4f99e4aceafecbb093418bebe5de.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*voTi2mJqlWTT47ZCn26bAA.png"/></figure></div><p id="06f4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">5.点击创建凭证:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi mm"><img src="../Images/a37c2010a4899733d60182039ce232ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_86Hy4ZH_vD8QY6glP58mg.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/ef22407b818d644d65d74c9ce896a2a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*rqh2GgkjKrtSwlakAwbL7Q.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><p id="d130" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">6.选择参数并点击<strong class="kt ir">我需要什么凭证？</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/c056c4d43f83b87e0554bff4d34dc70c.png" data-original-src="https://miro.medium.com/v2/resize:fit:676/format:webp/1*7y-HwtggwSrn2dzpc6WedQ.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><p id="0770" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">7.输入服务帐户名并选择角色:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/0088fb8ce161266013d03b055e1d12d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*f1ms1vedL1WSaFJg3se9Aw.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><p id="f595" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">8.现在单击KEYS并创建一个json格式的新密钥:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/5e0e9e6bf891740927a68db8fbed2c76.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*HsuodiTIAs4CocBh4h593A.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><p id="3b24" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">将下载一个JSON文件。我们的脚本中需要这个JSON文件。因此将该文件重命名为<strong class="kt ir"><em class="mr">client _ secret key . JSON</em></strong>。</p><p id="c7de" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在转到你的Google Drive，创建一个Google Sheet，命名为<strong class="kt ir">redshift-to-Google-Sheet</strong>。从上面下载的JSON文件中复制<strong class="kt ir"> <em class="mr"> client_email </em> </strong>值，并将该Google Sheet共享给此<strong class="kt ir"> <em class="mr"> client_email </em> </strong>并具有编辑权限。</p><p id="e5a1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">至此，我们已经设置好了一切，现在让我们编写Python脚本。要使用python脚本与电子表格交互，我们必须安装gspread Python库。因此，打开终端并运行以下命令。oauth2client是一个python库，用于访问受OAuth 2.0保护的资源。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="41d9" class="mx my iq mt b gy mz na l nb nc">pip install gspread<br/>pip install oauth2client</span></pre><p id="fc75" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在创建一个Python文件，并将其命名为redshift_to_spradsheet <strong class="kt ir">。</strong> py。复制并粘贴下面的代码。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="c6e9" class="mx my iq mt b gy mz na l nb nc">import gspread<br/>from oauth2client.service_account import ServiceAccountCredentials</span><span id="b2cb" class="mx my iq mt b gy nd na l nb nc">scope = ["https://spreadsheets.google.com/feeds", "https://www.googleapis.com/auth/spreadsheets",<br/>         "https://www.googleapis.com/auth/drive.file", "https://www.googleapis.com/auth/drive"]</span><span id="9f55" class="mx my iq mt b gy nd na l nb nc">credentials = ServiceAccountCredentials.from_json_keyfile_name('client_secretkey.json', scope)<br/>client = gspread.authorize(credentials)</span></pre><p id="abec" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在让我们添加连接到红移数据库的代码。我使用了<strong class="kt ir"> sqlalchemy </strong>库，它方便了Python程序和数据库之间的通信。</p><p id="97bf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要安装sqlalchemy，请键入以下内容:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="bb82" class="mx my iq mt b gy mz na l nb nc">pip install sqlalchemy</span></pre><p id="4ea4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在将sqlalchemy导入到python脚本中，并使用create_engine建立数据库连接。在连接字符串之后，编写select查询(或任何其他DML)来获取数据并将其存储到pandas数据帧中。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="3b5e" class="mx my iq mt b gy mz na l nb nc">from sqlalchemy <strong class="mt ir">import</strong>  create_engine<br/>import pandas as pd</span><span id="f103" class="mx my iq mt b gy nd na l nb nc"><em class="mr"># Connecting to postgresql</em><br/>engine = create_engine('postgresql://user:password@host:5439/database')<br/>data_frame = pd.read_sql('SELECT * FROM article_sales;', engine)</span></pre><p id="58c3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要将此数据框写入google电子表格，我们必须安装df2gspread python库。要安装df2gspread，请键入以下内容:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="4576" class="mx my iq mt b gy mz na l nb nc">pip install df2gspread</span></pre><p id="abf8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在将df2gspread导入到python脚本中，并创建一个名为write_googlesheet的函数，如下所示:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="46fe" class="mx my iq mt b gy mz na l nb nc">from df2gspread import df2gspread as d2g</span><span id="5b57" class="mx my iq mt b gy nd na l nb nc">def write_googlesheet(df, spreadsheet_key, sheet_title, starting_cell, overwrite):<br/>    d2g.upload(df, spreadsheet_key, sheet_title, credentials=credentials, col_names=overwrite, row_names=True, start_cell = starting_cell, clean=overwrite)</span></pre><p id="9832" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个d2g.upload函数将给定的熊猫数据帧上传到Google Drive，并返回gspread工作表对象。这里我已经从电子表格的url传递了电子表格键，工作表标题作为电子表格名称(即工作表1、工作表2)。要了解更多关于函数参数的信息，请<a class="ae ln" href="https://df2gspread.readthedocs.io/en/latest/examples.html" rel="noopener ugc nofollow" target="_blank">点击此处</a>。</p><p id="0356" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">github链接:<a class="ae ln" href="https://github.com/FrennyMacwan/redshift_to_spreadsheet/blob/main/redshift_spreadsheet.py" rel="noopener ugc nofollow" target="_blank"> redshift_spreadsheet.py </a></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="c72a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在运行Python脚本，在浏览器中打开<strong class="kt ir">红移到Google-Sheet </strong> Google Sheet。您将看到您的Google表单已更新了内容。</p><h1 id="2a79" class="ng my iq bd nh ni nj nk nl nm nn no np jw nq jx nr jz ns ka nt kc nu kd nv nw bi translated">结论</h1><p id="fab4" class="pw-post-body-paragraph kr ks iq kt b ku nx jr kw kx ny ju kz la nz lc ld le oa lg lh li ob lk ll lm ij bi translated">这篇文章的目的是让人们了解这种类型的实现。可以有许多不同的策略，但我发现它不太复杂，对于天真的开发人员来说容易理解。</p></div></div>    
</body>
</html>