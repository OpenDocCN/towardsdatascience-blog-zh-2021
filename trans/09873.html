<html>
<head>
<title>Integrate Trained Machine Learning Model to a DialogFlow Chatbot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将经过训练的机器学习模型集成到对话流聊天机器人中</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/integrate-trained-machine-learning-model-with-dialogflow-chatbot-8f5a0bc575c5?source=collection_archive---------13-----------------------#2021-09-16">https://towardsdatascience.com/integrate-trained-machine-learning-model-with-dialogflow-chatbot-8f5a0bc575c5?source=collection_archive---------13-----------------------#2021-09-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="40da" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何构建、训练和存储机器学习模型。使用Google的Dialogflow构建一个聊天机器人，它使用经过训练的自定义ML模型来回答用户的查询。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7d8fca3b080db8a58f962ee871784074.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-1REh38g3mexmSZtoMRh2w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://pixabay.com/users/mohamed_hassan-5229782/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3936760" rel="noopener ugc nofollow" target="_blank">穆罕默德·哈桑</a>来自<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3936760" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure><h2 id="2e83" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">问题陈述</h2><p id="6361" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">我们将首先创建一个基本的机器学习(ML)模型，该模型将在数据集上进行训练。将使用pickle模块保存训练好的模型。此后，flask应用程序将利用训练好的模型，并根据过去的数据回答诸如一年的人均收入是多少之类的查询。</p><p id="127a" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">你也可以在这里看到这段录音:<a class="ae ky" href="https://youtu.be/hpQga6tGTLY" rel="noopener ugc nofollow" target="_blank">链接</a></p><h2 id="e24d" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">安装:</h2><p id="1603" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">这个应用是基于Windows 10机器的Python。我用chrome作为默认浏览器，用VS Code编辑代码。您还需要安装这些python包:flask、pickle、json、numpy、pandas和sklearn。</p><h2 id="5c1b" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">资料组</h2><p id="362f" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">出于演示目的，使用了<a class="ae ky" href="https://www.kaggle.com/gurdit559/canada-per-capita-income-single-variable-data-set" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上提供的加拿大人均收入单变量数据集。数据集只有两个属性“年份”和“人均收入(美元)”。</p><h2 id="062b" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">机器学习模型</h2><p id="fe0b" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">请注意，目前的重点不是建立一个准确的模型。这篇博客展示了如何通过聊天机器人(Dialogflow)利用一个训练好的模型来回答用户的查询。</p><p id="0812" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">下载上述数据集并使用以下代码创建一个模型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="bba1" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">下一步是保存上面训练的模型。同样，我们根本不关心预测的准确性。这里展示了端到端的项目集成。</p><p id="c436" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">使用下面几行代码，你可以存储训练好的模型(在我们的例子中是<em class="mv"> linearmodel.pkl </em>)，现在它已经可以在任何应用程序中独立使用了。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3136" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">上述代码执行后，将在项目目录中创建一个“linearmodel.pkl”文件。</p><h2 id="6644" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">烧瓶应用</h2><ol class=""><li id="595e" class="mw mx it lx b ly lz mb mc li my lm mz lq na mn nb nc nd ne bi translated">让我们创建一个目录(“演示”)。移动此目录中的linearmodel.pkl</li><li id="d125" class="mw mx it lx b ly nf mb ng li nh lm ni lq nj mn nb nc nd ne bi translated">在同一个目录下创建一个文件，比如说“app.py”。</li><li id="6dfa" class="mw mx it lx b ly nf mb ng li nh lm ni lq nj mn nb nc nd ne bi translated">您可以使用您最喜欢的IDE来编辑代码。我用的是VS代码。</li><li id="daaa" class="mw mx it lx b ly nf mb ng li nh lm ni lq nj mn nb nc nd ne bi translated">app.py将包含如下代码。如果你不能马上理解代码，那也没关系。只是跟随更多的解释。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="00f0" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">在本地执行应用程序</h2><ol class=""><li id="a226" class="mw mx it lx b ly lz mb mc li my lm mz lq na mn nb nc nd ne bi translated">在项目目录中，运行以下命令:“python app.py”</li><li id="d78f" class="mw mx it lx b ly nf mb ng li nh lm ni lq nj mn nb nc nd ne bi translated">如果没有错误，您应该能够在本地主机上看到应用程序</li><li id="897d" class="mw mx it lx b ly nf mb ng li nh lm ni lq nj mn nb nc nd ne bi translated">但你只能看到“你好，世界。我是Swati”。</li><li id="36b8" class="mw mx it lx b ly nf mb ng li nh lm ni lq nj mn nb nc nd ne bi translated">在下一节中，我们将使用ngrok为本地运行的应用程序创建一个公共的HTTPS URL。</li></ol><h2 id="721a" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">公开执行应用程序</h2><ol class=""><li id="333e" class="mw mx it lx b ly lz mb mc li my lm mz lq na mn nb nc nd ne bi translated">下载<a class="ae ky" href="https://ngrok.com/download" rel="noopener ugc nofollow" target="_blank"> ngrok </a></li><li id="ccdf" class="mw mx it lx b ly nf mb ng li nh lm ni lq nj mn nb nc nd ne bi translated">提取并打开文件夹，找到“ngrok.exe”文件</li><li id="3c11" class="mw mx it lx b ly nf mb ng li nh lm ni lq nj mn nb nc nd ne bi translated">运行这个exe文件并键入“ngrok http 5000”</li><li id="afc0" class="mw mx it lx b ly nf mb ng li nh lm ni lq nj mn nb nc nd ne bi translated">复制下面标记的网址并粘贴到你的浏览器上<em class="mv">瞧</em>！你的应用程序是公开可用的(但只有2小时)。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/eae312ffa144e0e6fe4724c7589a33af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OaQaZy6AGKMfQIwEdBCtDg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1: ngrok cmd(图片由作者提供)</p></figure><h2 id="5db3" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">DialogFlow聊天机器人</h2><ol class=""><li id="b16b" class="mw mx it lx b ly lz mb mc li my lm mz lq na mn nb nc nd ne bi translated">前往<a class="ae ky" href="https://dialogflow.cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> Dialogflow </a>并创建一个账户。</li><li id="afe7" class="mw mx it lx b ly nf mb ng li nh lm ni lq nj mn nb nc nd ne bi translated">按照以下步骤设置代理和非常简单的跟进意向:</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/d3dc447a01044ee2a29d1f5d121e7180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ToWRxWLUodhMnVv55Mi8kw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Gif 1:创建对话流聊天机器人意图(图片由作者提供)</p></figure><p id="474d" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">一旦你完成了，你的机器人就可以问候用户并询问问题。此时，它将无法做出任何预测。让我们看看接下来的部分！</p><h2 id="b60b" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">带有实现URL的对话流聊天机器人</h2><p id="a2c6" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">现在让我们后退一步，理解Dialogflow在幕后是如何工作的。下图显示了各种元素如何相互链接以满足用户查询。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/d69c0587b8ec4df7c4d83ee85b057f5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k07_CbGbFeYwT1_ZhUEbuA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2:当前项目的典型架构(图片由作者提供)</p></figure><p id="588e" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">一个用户发出类似于“<em class="mv">告诉我1972年的人均收入</em>”的请求。查询在内部被转换为请求正文，如下所示:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="154c" class="kz la it no b gy ns nt l nu nv">{<br/>  "responseId": "xyz-unique-id",<br/>  "<strong class="no iu">queryResult</strong>": {<br/>    "queryText": "Tell me per capita income in the year 1972",<br/>    "action": "DefaultWelcomeIntent.DefaultWelcomeIntent-yes",<br/>    "<strong class="no iu">parameters</strong>": {<br/>      "<strong class="no iu">yearinput</strong>": <strong class="no iu">1972</strong><br/>    },<br/>    "allRequiredParamsPresent": true,<br/>    "fulfillmentMessages": [<br/>      {<br/>        "text": {<br/>          "text": [<br/>            ""<br/>          ]<br/>        }<br/>      }<br/>    ],<br/>..........<br/>..........<br/>..........<br/>}</span></pre><p id="92de" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">如果指定，上述请求正文将通过HTTP POST请求发送到实现URL。<strong class="lx iu"> app.py </strong>是处理传入请求并使用训练好的ML模型进行预测或计算的应用程序。然后以下列形式发回响应:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/a49a59ebd3e553883fad19e31f32e83b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*2yloadotTQ29MxTa39za6g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3:应用程序发送的响应，即履行URL的响应(图片由作者提供)</p></figure><h2 id="9c1e" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">履行URL</h2><ol class=""><li id="9ea3" class="mw mx it lx b ly lz mb mc li my lm mz lq na mn nb nc nd ne bi translated">返回到DialogFlow控制台，打开我们创建的操作</li><li id="f06d" class="mw mx it lx b ly nf mb ng li nh lm ni lq nj mn nb nc nd ne bi translated">在DataYear跟进意向中，在“fulfillment”下启用“webhook call for this intent”，如下面的Gif所示。</li><li id="eb32" class="mw mx it lx b ly nf mb ng li nh lm ni lq nj mn nb nc nd ne bi translated">单击左侧导航窗格中的“实现”</li><li id="69ec" class="mw mx it lx b ly nf mb ng li nh lm ni lq nj mn nb nc nd ne bi translated">启用webhook选项</li><li id="c526" class="mw mx it lx b ly nf mb ng li nh lm ni lq nj mn nb nc nd ne bi translated">粘贴ngrok URL并在末尾附加“/webhook ”,然后单击保存:</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/6a1bd3e157d80a6f0df065e44606a5eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*YPSNjB5eThpxNNOpSE2_sA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Gif 2:在应用程序中添加ngrok URL并实时测试(图片由作者提供)</p></figure><h2 id="d6ad" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">测试聊天机器人:</h2><p id="c646" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">最简单的方法是Dialogflow控制台右侧的测试窗格。我个人非常喜欢这个功能，因为它可以让你立即测试你的聊天机器人！</p><p id="826f" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">Dialogflow聊天机器人可以与许多平台集成，如slack、Telegram、Messenger、line等。下面我展示了网络演示集成。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/26b3803a0aed19d6e6b4a5025b78b95a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*La6ddm8kARgnCnT4KP7uqw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Gif 3:聊天机器人的网络演示(图片由作者提供)</p></figure><h2 id="9cd7" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h2><p id="05af" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">那是篇很长的文章！然而，我真诚地希望它对你有所帮助。本文中展示的集成是许多可能性之一。下一步，尝试创建更复杂的聊天机器人，并将应用部署在一些云应用平台上，如Heroku或Azure web app，然后与Dialogflow集成。</p><p id="cba7" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">还有，你可以在<a class="ae ky" href="https://twitter.com/SwatiRajwal" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和<a class="ae ky" href="https://www.linkedin.com/in/swati-r-84682b12b/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上问我一个问题！</p><h2 id="a12b" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">参考</h2><p id="499e" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">[1]<em class="mv">dialog flow Documentation |</em>。(未注明)。谷歌云。于2021年9月16日从<a class="ae ky" href="https://cloud.google.com/dialogflow/docs" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/dialogflow/docs</a>检索</p><p id="0c05" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">[2]<em class="mv">dialog flow入门</em>。(2019年2月5日)。YouTube。<a class="ae ky" href="https://www.youtube.com/watch?v=Ov3CDTxZRQc&amp;ab_channel=GoogleCloudTech" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=Ov3CDTxZRQc&amp;ab _ channel = Google cloud tech</a></p></div></div>    
</body>
</html>