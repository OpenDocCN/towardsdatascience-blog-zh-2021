<html>
<head>
<title>How to Forecast Time Series Data Using Deep Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何利用深度学习预测时间序列数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deep-learning-for-time-series-data-ed410da30798?source=collection_archive---------4-----------------------#2021-08-04">https://towardsdatascience.com/deep-learning-for-time-series-data-ed410da30798?source=collection_archive---------4-----------------------#2021-08-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2dd0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">亚马逊开发的自回归递归神经网络</h2></div><p id="eec0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">时间序列(TS)预测是出了名的挑剔。也就是说，直到现在。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/bc494af38f4fbd7cf5a2aabbdcc0f452.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L2vZrjITElWiYCZu2435nQ.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图1:基于这个<a class="ae lr" href="https://calvinfeng.gitbook.io/machine-learning-notebook/sagemaker/time_series_forecast" rel="noopener ugc nofollow" target="_blank">教程</a>的DeepAR训练输出。图片作者。</p></figure><p id="eb29" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2019年，亚马逊的研究团队开发了一种名为DeepAR的深度学习方法，相对于最先进的ts预测模型，该方法的准确率提高了约15%。它是健壮的开箱即用的，可以从许多不同的时间序列中学习，所以如果你有许多不稳定的数据，DeepAR可能是一个有效的解决方案。</p><p id="1482" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从实现的角度来看，DeepAR在计算上比其他TS方法更复杂。它还需要比传统的TS预测方法如ARIMA或脸书的先知更多的数据。</p><p id="c055" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">也就是说，如果你有大量复杂的数据，并且需要非常准确的预测，DeepAR无疑是最可靠的解决方案。</strong></p><h1 id="ab28" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">技术TLDR</h1><p id="bec5" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">简而言之，DeepAR是一个LSTM RNN，带有一些附加功能来提高复杂数据的准确性。相对于传统的TS预测方法，DeepAR有4个主要优势…</p><ol class=""><li id="4274" class="mp mq iq kh b ki kj kl km ko mr ks ms kw mt la mu mv mw mx bi translated"><strong class="kh ir"> DeepAR在学习季节性依赖关系方面很有效，只需要很少的调整。</strong>这种开箱即用的性能使该模型成为TS预测的良好起点。</li><li id="d26a" class="mp mq iq kh b ki my kl mz ko na ks nb kw nc la mu mv mw mx bi translated">DeepAR可以使用几乎没有训练历史的协变量。通过利用<em class="nd">相似的</em>观察值和加权重采样技术，<em class="nd"> </em>该模型可以有效地确定不频繁协变量的行为。</li><li id="e50e" class="mp mq iq kh b ki my kl mz ko na ks nb kw nc la mu mv mw mx bi translated"><strong class="kh ir"> DeepAR做概率预测。</strong>这些概率以蒙特卡洛样本的形式，可用于开发分位数预测。</li><li id="30f9" class="mp mq iq kh b ki my kl mz ko na ks nb kw nc la mu mv mw mx bi translated"><strong class="kh ir"> DeepAR支持广泛的似然函数。</strong>如果您的因变量呈现非正态或非连续分布，您可以指定相关的似然函数。</li></ol><p id="c9a2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该模型受到了很多关注，目前在PyTorch中得到支持。教程和代码链接在评论里。</p><h1 id="0f43" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">但是，到底是怎么回事呢？</h1><p id="2f58" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">好吧，让我们慢一点，讨论一下亚马逊的DeepAR模型实际上是如何工作的…</p><h2 id="9c36" class="ne lt iq bd lu nf ng dn ly nh ni dp mc ko nj nk me ks nl nm mg kw nn no mi np bi translated">传统时间序列预测</h2><p id="9c28" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">让我们从头开始。</p><p id="e3ee" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如上所述，时间序列预测是出了名的困难，主要有两个原因。首先，大多数时间序列模型需要大量的主题知识。如果你用传统的TS模型模拟股票价格，重要的是要知道什么协变量影响价格，这些协变量的影响是否有延迟，价格是否表现出季节性趋势，等等。</p><p id="bffe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">工程师通常缺乏创建有效功能所需的主题知识。</p><p id="3496" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个原因是TS建模是一个相当小众的技能组合。给定时间步长的先前输出是下一个时间步长的输入，因此我们不能使用通常的建模技术或评估标准。</p><p id="c9fa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，工程师不仅需要对数据有深入的了解，还必须对TS建模技术有深刻的理解。</p><h2 id="8a81" class="ne lt iq bd lu nf ng dn ly nh ni dp mc ko nj nk me ks nl nm mg kw nn no mi np bi translated">传统的递归神经网络</h2><p id="0650" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">机器学习可以为传统的TS预测提供替代方案，这些方案通常更准确且更容易构建。支持顺序数据的最简单的ML算法是递归神经网络。</p><p id="8642" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">rnn本质上是一堆堆叠在一起的神经网络。如图2所示，h <em class="nd"> 1 </em>处模型的输出馈入下一个<em class="nd"> h2 </em>处的模型。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nq"><img src="../Images/fef1d8e87f359868201229196c168d77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ENY_yH2HIWsjVQY9D6jXxA.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图2:递归神经网络的图示。图片作者。</p></figure><p id="4f97" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里，蓝色的<em class="nd"> x </em>是预测变量，黄色的<em class="nd"> h </em>是隐藏层，绿色的<em class="nd"> y </em>是预测值。这个模型架构自动处理我们上面讨论的许多挑战。</p><p id="30b0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是即使是rnn在某些领域也有不足。首先，他们对于什么应该被传递到下一个隐藏层的假设过于简单。RNN的更高级的组件，如长短期记忆(LSTM)和门循环单元(GRU)层提供了过滤器，用于过滤沿链传递的信息。它们通常比普通的rnn提供更好的预测，但遗憾的是，它们也有不足之处。</p><p id="c3be" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">亚马逊的DeepAR模型是LSTM的最新版本，解决了它的两个主要缺点:</p><ol class=""><li id="7602" class="mp mq iq kh b ki kj kl km ko mr ks ms kw mt la mu mv mw mx bi translated"><strong class="kh ir">由于均匀采样分布，异常值拟合不佳。</strong>DeepAR的优势之一是它从许多时间序列中聚合信息，从而为单个单位(如用户)开发预测。如果所有单位都有相同的机会被采样，异常值将被平滑，我们的预测值将变得不那么极端(可能也不那么准确)。</li><li id="bad6" class="mp mq iq kh b ki my kl mz ko na ks nb kw nc la mu mv mw mx bi translated"><strong class="kh ir"> RNN不能很好地处理时间缩放。</strong>随着时间的推移，时间序列数据通常会表现出整体趋势——想想你在COVID期间最喜欢(或最不喜欢)的股票。这些时间趋势使得拟合我们的模型变得更加困难，因为在拟合时必须移除这种趋势，然后将其添加回我们的模型输出。那是许多不必要的工作。</li></ol><p id="d0fe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">DeepAR解决了这两个问题。</p><h1 id="3893" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">DeepAR是如何工作的？</h1><p id="300f" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">基于RNN架构，DeepAR使用LSTM单元来拟合我们的预测变量和我们感兴趣的变量。以下是如何…</p><h2 id="8ebf" class="ne lt iq bd lu nf ng dn ly nh ni dp mc ko nj nk me ks nl nm mg kw nn no mi np bi translated">序列对序列编码器-解码器</h2><p id="7d53" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">首先，为了使我们的数据更有用，我们利用一个序列来排序编码器-解码器。该方法采用一组<em class="nd"> n个</em>输入，用神经网络对这些输入进行编码，然后输出<em class="nd"> m个</em>解码值。</p><p id="587e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有趣的事实——它们是所有语言翻译算法的支柱，比如谷歌翻译。因此，使用下面的图3，让我们从将英语翻译成西班牙语的角度来思考这个方法。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nr"><img src="../Images/43b3d6c3b5ca76e6e3e2e766420f771c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yyrViRqrLhbRLszQS4vOmw.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图3:序列对序列编码器-解码器的图形表示。图片作者。</p></figure><p id="9c09" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里，蓝色的每个<em class="nd"> x_n </em>值是我们模型的输入，即英语单词。它们被依次送入RNN，后者对它们的信息进行编码，并将其作为编码器矢量(黄色)输出。编码器向量的信息被表示为隐藏状态的权重向量。从那里，我们的编码器向量被送入我们的解码器，这是一个RNN。最后的输出是西班牙语单词，用绿色标记为<em class="nd"> y_n </em>。</p><p id="44c3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很酷，对吧？</p><h2 id="b806" class="ne lt iq bd lu nf ng dn ly nh ni dp mc ko nj nk me ks nl nm mg kw nn no mi np bi translated">根据我们的数据进行扩展</h2><p id="255f" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">其次，我们解决了使基本LSTMs不如DeepAR的两个问题:均匀采样和时间缩放。</p><p id="3083" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这两者都使用比例因子来处理。比例因子是用户指定的超参数，但推荐值只是给定时间序列的平均值:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/65dd08f681bbf5b8c2e0ca408d10ba01.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*J_q5w7WQzxXAFczEiHS-SA.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图DeepAR中使用的默认比例因子的公式——单个时间序列的平均值。图片作者。</p></figure><p id="43f9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了处理极值的不均匀采样，我们使采样概率与<em class="nd"> v_i </em>成比例。因此，如果给定时间序列的平均值较高，则更有可能被采样，反之亦然。</p><p id="07a3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了处理时间缩放，我们将每个LSTM单元的输入除以<em class="nd"> v_i </em>。通过在将我们的值输入到每个单元格之前缩小它们，我们的模型可以专注于我们的预测器和结果变量之间的关系，而不是拟合时间趋势。在单元适合我们的数据后，我们将其输出乘以<em class="nd"> v_i </em>以将我们的数据返回到其原始比例。</p><p id="0a50" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">没那么酷，但还是很酷。只剩最后一节了…</p><h2 id="7de3" class="ne lt iq bd lu nf ng dn ly nh ni dp mc ko nj nk me ks nl nm mg kw nn no mi np bi translated">使用似然函数拟合</h2><p id="5065" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">第三，也是最后一点，处理完所有错综复杂的数据后，我们通过最大化因变量的条件概率来拟合给定的预测值和模型参数(图5)。这种估计量称为最大似然估计量(MLE)。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/497c0b3961d1516e353b2dc7263471ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*FxfNQI9Nj6d1vNTL9J7rkQ.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图5:简化的DeepAR似然函数。图片作者。</p></figure><p id="edce" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的简化表达式是我们希望最大化的——我们希望找到最大化因变量(<em class="nd"> z </em>)概率的模型参数(<em class="nd"> θ </em>)。我们还以协变量(<em class="nd"> x_t </em>)和前一个节点的输出(<em class="nd"> z_t-1 </em>)为条件。</p><p id="e914" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">因此，给定我们的协变量和前一时间步的预测值，我们可以找到在给定参数的情况下最大化观察可能性的参数值。</strong></p><p id="8f5c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，可能性还包括数据转换步骤，但是从理解和实现的角度来看，它并不是非常重要。如果你好奇，可以看看评论中链接的论文。</p><p id="be85" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在你知道了——简而言之就是DeepAR。在你走之前，这里有一些关于实现这个方法的实用技巧…</p><h1 id="31be" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">实施说明</h1><ul class=""><li id="d52a" class="mp mq iq kh b ki mk kl ml ko nu ks nv kw nw la nx mv mw mx bi translated">作者建议将协变量标准化，即减去平均值并除以标准差。</li><li id="eb99" class="mp mq iq kh b ki my kl mz ko na ks nb kw nc la nx mv mw mx bi translated">缺失数据对DeepAR来说可能是个大问题。作者建议通过从条件预测分布中抽样来输入缺失数据。</li><li id="c307" class="mp mq iq kh b ki my kl mz ko na ks nb kw nc la nx mv mw mx bi translated">对于论文中引用的例子，作者创建了对应于时间信息的协变量。一些例子是<em class="nd">年龄</em>(以天为单位)和<em class="nd">星期几</em>。</li><li id="8f26" class="mp mq iq kh b ki my kl mz ko na ks nb kw nc la nx mv mw mx bi translated">使用网格搜索优化参数是调整模型的有效方法。然而，学习速率和编码器/解码器长度是特定于主题的，应该手动调整。</li><li id="d8e6" class="mp mq iq kh b ki my kl mz ko na ks nb kw nc la nx mv mw mx bi translated">为了确保模型不是基于我们在TS中因变量的指数拟合的，作者建议在我们的开始阶段之前根据“空”数据训练模型。就用一堆零作为我们的因变量。</li></ul></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><p id="cf71" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nd">感谢阅读！我将再写41篇文章，将“学术”研究引入DS行业。查看我关于构建DeepAR模型的链接/教程的评论。</em></p></div></div>    
</body>
</html>