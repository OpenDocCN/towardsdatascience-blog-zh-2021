<html>
<head>
<title>Introducing Azure Databricks for Data Science</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向数据科学的Azure Databricks简介</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introducing-azure-databricks-for-data-science-547e2784fa49?source=collection_archive---------19-----------------------#2021-04-30">https://towardsdatascience.com/introducing-azure-databricks-for-data-science-547e2784fa49?source=collection_archive---------19-----------------------#2021-04-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9db9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解Azure Databricks服务功能对于大数据处理和实施机器学习解决方案的重要性。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b769c8b9bf2175302ad89bc82bbfd594.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VPr7F9Lt5y8KJy9B"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">约翰·马特丘克在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="95fc" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="f1e7" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这篇文章将简要描述Azure Databricks托管服务的丰富特性及其功能。作为一名机器学习工程师，如果你配备了这个工具库，那么它将把你的开发技能带到新的高度。</p><p id="16b6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们首先了解一下微软Azure的Databricks即服务产品是什么。</p><p id="6efb" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Azure Databricks是微软Azure提供的全托管平台服务，简而言之，它是一个大数据和机器学习平台。它融合了Apache Spark和微软团队的共同努力。该服务是大数据处理和机器学习的单一平台。</p><p id="dc24" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Azure Databricks使您作为数据工程师能够运行大规模Spark工作负载，因为Azure的底层大规模可扩展计算能力，因此它们可以通过自动扩展、缓存、索引和查询优化在云中匹配无与伦比的性能和成本效益。</p><blockquote class="mp mq mr"><p id="4a2e" class="lo lp ms lq b lr mk jr lt lu ml ju lw mt mm lz ma mu mn md me mv mo mh mi mj ij bi translated">本文假设您已经熟悉了Spark框架，并且掌握了PySpark知识。</p></blockquote><div class="mw mx gp gr my mz"><a href="https://www.linkedin.com/in/p-jainani/" rel="noopener  ugc nofollow" target="_blank"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd ir gy z fp ne fr fs nf fu fw ip bi translated">Pankaj Jainani -云解决方案架构师</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">我是云解决方案架构师、人工智能工程师、DevOps顾问、Scrum Master、技术经理……</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">www.linkedin.com</p></div></div><div class="ni l"><div class="nj l nk nl nm ni nn kp mz"/></div></div></a></div></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><h1 id="7cb0" class="kw kx iq bd ky kz nv lb lc ld nw lf lg jw nx jx li jz ny ka lk kc nz kd lm ln bi translated">Azure数据块</h1><p id="d164" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">Databricks由Apache Spark、Delta Lake和MLflow &amp; Spark创建，这是一个统一的处理引擎，可以使用SQL、机器学习、图形处理或实时流分析来分析大数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/eb45e540a14adb99d0b90a55b5ddecec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qAMTiUmvuet74I74Peo7Nw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd ob"> Azure Databricks架构</strong> -自定义图像</p></figure><p id="0a2d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Azure Databricks架构的核心是Databricks运行时引擎，它针对优化的数据访问层引擎优化了Spark产品、Delta Lake和Databricks I/O。这一核心引擎为数据科学工作负载提供了强大的处理能力。它还提供了与不同Azure数据服务的原生集成能力，如Azure Data Factory和Synapse Analytics。它还提供了各种ML运行时环境，比如<em class="ms">tensor flow</em>&amp;<em class="ms">py torch</em>。笔记本可以与MLFlow + <a class="ae kv" rel="noopener" target="_blank" href="/azure-machine-learning-service-part-1-an-introduction-739620d1127b"> Azure机器学习服务</a>集成。</p><h2 id="098c" class="oc kx iq bd ky od oe dn lc of og dp lg lx oh oi li mb oj ok lk mf ol om lm on bi translated">引擎盖下——它的火花</h2><p id="ce72" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">Azure Databricks服务是一个面向笔记本的<em class="ms"> Apache Spark即服务</em>工作环境。它为大规模数据处理和机器学习提供了分析引擎。真正意义上，它可以处理大容量、高速度、多种多样的大数据。Apache Spark集群是一组计算机，它们被视为一台计算机，处理从笔记本发出的命令的执行。这个集群有一个<em class="ms">驱动</em>来将<em class="ms">任务</em>分配给它的<em class="ms">执行器</em>，并通过可用的<em class="ms">插槽</em>来处理它们。此外，驱动程序将任务分配给执行程序来执行任务，并对其数据进行划分，该任务被划分为多个阶段并按顺序流执行。作业每个阶段的结果都会发送给驱动程序进行整合。这就是Spark处理架构的要点。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/a66225892327a83aa88f3b80692aadb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PBxpfKRmbawu-B5P2GOFTg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd ob"> Spark Cluster:逻辑架构</strong> —来源微软文档</p></figure><p id="c15d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">作为一名Azure Databricks工程师，你只需要关注:</p><ul class=""><li id="4e25" class="op oq iq lq b lr mk lu ml lx or mb os mf ot mj ou ov ow ox bi translated">我的数据被划分成多少个分区。</li><li id="50df" class="op oq iq lq b lr oy lu oz lx pa mb pb mf pc mj ou ov ow ox bi translated">我拥有的用于并行执行的槽数。</li><li id="b7b6" class="op oq iq lq b lr oy lu oz lx pa mb pb mf pc mj ou ov ow ox bi translated">我触发了多少工作？</li><li id="ad02" class="op oq iq lq b lr oy lu oz lx pa mb pb mf pc mj ou ov ow ox bi translated">最后是这些工作被划分的阶段。</li></ul><h1 id="d53c" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak"> Azure Databricks正在运行</strong></h1><p id="0474" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">假设您已经在订阅中创建了Azure Databricks工作区。</p><h2 id="077d" class="oc kx iq bd ky od oe dn lc of og dp lg lx oh oi li mb oj ok lk mf ol om lm on bi translated">读取数据</h2><p id="2481" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">作为开发人员，它使您能够从不同的来源提取任何格式的数据，CSV、JSON或parquet，并在并行、分布式和可伸缩的spark环境中处理它们。为此，它使用scala、R或python APIs。</p><p id="7221" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面的代码片段使用<em class="ms"> Spark会话</em>来创建一个使用<code class="fe pd pe pf pg b">read()</code>函数的<em class="ms">数据帧</em>。它链接<code class="fe pd pe pf pg b">csv()</code>函数从CSV文件中读取数据。</p><pre class="kg kh ki kj gt ph pg pi pj aw pk bi"><span id="40ba" class="oc kx iq pg b gy pl pm l pn po">bostonDF = (spark.read<br/>  .option("HEADER", True)<br/>  .option("inferSchema", True)<br/>  .csv("/mnt/training/bostonhousing/bostonhousing/bostonhousing.csv")<br/>)</span><span id="91d3" class="oc kx iq pg b gy pp pm l pn po">display(bostonDF)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pq"><img src="../Images/f9abd736d04914e4f4a13b8fb1fbe36a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*niVdTlPtS1PER4iXi1ZPHg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">上一段代码的输出</p></figure><h2 id="ce66" class="oc kx iq bd ky od oe dn lc of og dp lg lx oh oi li mb oj ok lk mf ol om lm on bi translated">添加新功能</h2><p id="e47b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果作为一名开发人员，你是Spark的新手，那么你需要知道，Spark不同于许多其他机器学习框架，因为我们在包含我们所有特征的向量的单个列上训练我们的模型。通过创建一个名为<code class="fe pd pe pf pg b">features</code>的列来准备数据，该列包含平均房间数、犯罪率和贫困率。这是通过使用<a class="ae kv" href="http://spark.apache.org/docs/latest/api/python/pyspark.ml.html?highlight=vectorassembler#pyspark.ml.feature.VectorAssembler" rel="noopener ugc nofollow" target="_blank"> PySpark的VectorAssembler </a>对象汇编器创建新的列特性来实现的，如下面的代码片段所示:</p><pre class="kg kh ki kj gt ph pg pi pj aw pk bi"><span id="09e8" class="oc kx iq pg b gy pl pm l pn po">from pyspark.ml.feature import VectorAssembler</span><span id="f762" class="oc kx iq pg b gy pp pm l pn po">featureCols = ["indus", "age", "dis"]<br/>assembler = VectorAssembler(inputCols=featureCols, outputCol="newFeatures")</span><span id="e398" class="oc kx iq pg b gy pp pm l pn po">bostonFeaturizedDF2 = assembler.transform(bostonDF)</span><span id="bd5b" class="oc kx iq pg b gy pp pm l pn po">display(bostonFeaturizedDF2)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pr"><img src="../Images/300b1f52adcbe58018a24e6109261eb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*32L1tNJyI_r59X-CsBdXtQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">上一段代码的输出</p></figure><blockquote class="mp mq mr"><p id="bb3e" class="lo lp ms lq b lr mk jr lt lu ml ju lw mt mm lz ma mu mn md me mv mo mh mi mj ij bi translated">参见<a class="ae kv" href="https://spark.apache.org/docs/latest/mllib-data-types.html" rel="noopener ugc nofollow" target="_blank">ml lib文档了解更多关于<code class="fe pd pe pf pg b">features</code>栏中稀疏向量符号的</a>，这将在特征章节中详细介绍。</p></blockquote><h2 id="f181" class="oc kx iq bd ky od oe dn lc of og dp lg lx oh oi li mb oj ok lk mf ol om lm on bi translated">火车模型</h2><p id="d99b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">一旦数据准备好了，我们就可以训练我们的模型了，这是通过下面的代码完成的，这是一个简单的<a class="ae kv" href="http://spark.apache.org/docs/latest/api/python/pyspark.ml.html?highlight=vectorassembler#pyspark.ml.regression.LinearRegression" rel="noopener ugc nofollow" target="_blank">线性回归</a>模型:</p><pre class="kg kh ki kj gt ph pg pi pj aw pk bi"><span id="bf1e" class="oc kx iq pg b gy pl pm l pn po">from pyspark.ml.regression import LinearRegression</span><span id="d7a1" class="oc kx iq pg b gy pp pm l pn po">lrNewFeatures = LinearRegression(labelCol="medv", featuresCol="newFeatures")</span><span id="ace5" class="oc kx iq pg b gy pp pm l pn po">lrModelNew = lrNewFeatures.fit(bostonFeaturizedDF2)</span></pre><h2 id="89ef" class="oc kx iq bd ky od oe dn lc of og dp lg lx oh oi li mb oj ok lk mf ol om lm on bi translated">获得预测</h2><p id="750e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">模型定型后，将按如下方式获取预测:</p><pre class="kg kh ki kj gt ph pg pi pj aw pk bi"><span id="1b15" class="oc kx iq pg b gy pl pm l pn po">from pyspark.ml.linalg import Vectors</span><span id="e7b2" class="oc kx iq pg b gy pp pm l pn po">data = [(Vectors.dense([11., 68., 4.]), ),<br/>        (Vectors.dense([6., 35., 2.]), ),<br/>        (Vectors.dense([19., 74., 8.]), )]<br/>newDataDF = spark.createDataFrame(data, ["newFeatures"])<br/>predictionsDF = lrModelNew.transform(newDataDF)<br/>display(predictionsDF)<br/></span></pre><p id="5ec7" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><code class="fe pd pe pf pg b">lrModelNew</code>是一个训练有素的估计器，我们可以使用它的<code class="fe pd pe pf pg b">.transform()</code>方法转换数据，因此它也计算预测值。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ps"><img src="../Images/811b4bad820c8c8afc78e2e7c8363861.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MrolD2RdGlQ7EVMHhnrgzA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">上一段代码的输出</p></figure><h1 id="7531" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">结论</h1><p id="b5c1" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">简要描述Azure Databricks服务的本质、架构及其核心Spark引擎功能。我只是通过实现一个虚拟的ML模型给出了一个蹩脚的例子，试图触及表面。在随后的文章中，我会谈到Azure Databricks服务的另一个方面。</p><h1 id="f104" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">参考</h1><p id="a15b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">[1]微软文档| <a class="ae kv" href="https://docs.microsoft.com/en-us/azure/databricks/scenarios/what-is-azure-databricks-ws" rel="noopener ugc nofollow" target="_blank"> Azure Databricks服务</a><br/>【2】Azure data bricks |<a class="ae kv" href="https://docs.microsoft.com/en-us/azure/databricks/scenarios/quickstart-create-databricks-workspace-portal?tabs=azure-portal" rel="noopener ugc nofollow" target="_blank">入门</a><br/>【3】<a class="ae kv" href="https://docs.microsoft.com/en-us/azure/databricks/notebooks/" rel="noopener ugc nofollow" target="_blank">Azure data bricks笔记本</a></p><blockquote class="mp mq mr"><p id="3530" class="lo lp ms lq b lr mk jr lt lu ml ju lw mt mm lz ma mu mn md me mv mo mh mi mj ij bi translated">在<a class="ae kv" href="https://www.linkedin.com/in/p-jainani/" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir"> LinkedIn </strong> </a>上与我联系，进一步讨论</p></blockquote><div class="mw mx gp gr my mz"><a href="https://www.linkedin.com/in/p-jainani/" rel="noopener  ugc nofollow" target="_blank"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd ir gy z fp ne fr fs nf fu fw ip bi translated">Pankaj Jainani -云解决方案架构师</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">我是云解决方案架构师、人工智能工程师、DevOps顾问、Scrum Master、技术经理……</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">www.linkedin.com</p></div></div><div class="ni l"><div class="nj l nk nl nm ni nn kp mz"/></div></div></a></div></div></div>    
</body>
</html>