<html>
<head>
<title>How to Host Multiple Websites with Apache Virtual Hosts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Apache虚拟主机托管多个网站</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-host-multiple-website-with-apache-virtual-hosts-4423bd0aefbf?source=collection_archive---------0-----------------------#2021-05-25">https://towardsdatascience.com/how-to-host-multiple-website-with-apache-virtual-hosts-4423bd0aefbf?source=collection_archive---------0-----------------------#2021-05-25</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="e25f" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">使用Ubuntu 20.04托管网站，包括子域</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/d6760707ee52f2894227a6b783ac5349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-UNtN_xczezJHYgA"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@wocintechchat?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克里斯蒂娜@ wocintechchat.com</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="64eb" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">介绍</h1><p id="9538" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">Apache的虚拟主机可以在一台服务器上运行多个网站。在这篇文章中，你将学习如何托管多个网站，包括子域。</p><p id="5176" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">我的Ubuntu 20.04服务器在<code class="fe mt mu mv mw b">/etc/apache2/sites-available</code>目录下有一些文件。我们将在该目录中创建更多文件，以创建多个虚拟主机。</p><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="acf5" class="nb lb iu mw b gz nc nd l ne nf">$ ls /etc/apache2/sites-available<br/>000-default.conf       000-default-le-ssl.conf  default-ssl.conf<br/>000-default.conf.dpkg-dist</span></pre><h1 id="84ec" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">创建新的虚拟主机</h1><p id="94d1" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">让我们为<code class="fe mt mu mv mw b">example.com</code>创建一个虚拟主机。(你需要把example.com改成你的域名。我们把文件存放在<code class="fe mt mu mv mw b">/var/www/example.com/public_html</code>目录下。如果你想使用Git部署你的网站，请参考本文“<a class="ae kz" rel="noopener" target="_blank" href="/how-to-create-a-git-hook-to-push-to-your-server-and-github-repo-fe51f59122dd"> <strong class="lu iv">如何创建一个Git Hook推送到你的服务器和Github Repo </strong> </a>”。</p><h2 id="d92a" class="nb lb iu bd lc ng nh dn lg ni nj dp lk mb nk nl lm mf nm nn lo mj no np lq nq bi translated">步骤1 —创建一个配置文件</h2><p id="7500" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">复制<code class="fe mt mu mv mw b">000-default.com.conf</code>在<code class="fe mt mu mv mw b">/etc/apache2/sites-available</code>新建一个文件:</p><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="ad59" class="nb lb iu mw b gz nc nd l ne nf">$ cd /etc/apache2/sites-available<br/>$ sudo cp 000-default.com.conf example.com.conf</span></pre><h2 id="5082" class="nb lb iu bd lc ng nh dn lg ni nj dp lk mb nk nl lm mf nm nn lo mj no np lq nq bi translated">步骤2-修改新的配置文件</h2><p id="9a78" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">在<code class="fe mt mu mv mw b">example.com.conf</code>中:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nr ns l"/></div></figure><p id="f559" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">第2行:为ServerAdmin添加您的电子邮件。第4行:将www添加到ServerAlias的域名中。<br/>第5行&amp; 6:添加DocumentRoot的文件目录。</p><h2 id="9a8f" class="nb lb iu bd lc ng nh dn lg ni nj dp lk mb nk nl lm mf nm nn lo mj no np lq nq bi translated">步骤3 —启用虚拟主机</h2><p id="c38c" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated"><code class="fe mt mu mv mw b">a2ensite</code>启用<code class="fe mt mu mv mw b">apache2</code>配置中的指定站点。它在<code class="fe mt mu mv mw b">/etc/apache2/sites-enabled</code>中创建一个符号链接(不支持站点)。</p><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="745e" class="nb lb iu mw b gz nc nd l ne nf">$ sudo a2ensite example.com.conf</span></pre><p id="dcf4" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">上面的命令将在<code class="fe mt mu mv mw b">/etc/apache2/sites-enabled</code>目录中创建一个符号链接<code class="fe mt mu mv mw b">example.com.conf</code>。</p><h2 id="c67f" class="nb lb iu bd lc ng nh dn lg ni nj dp lk mb nk nl lm mf nm nn lo mj no np lq nq bi translated">步骤4—启用SSL</h2><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="c8f9" class="nb lb iu mw b gz nc nd l ne nf">$ sudo certbot --apache -d example.com -d www.example.com</span></pre><p id="6a72" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">这将在<code class="fe mt mu mv mw b">/etc/apache2/sites-available</code>中查找相同的文件名。如果找不到，它会要求您选择conf文件。</p><p id="a6a0" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">这将创建<code class="fe mt mu mv mw b">example.com-le-ssh.conf</code>。</p><h2 id="8d3d" class="nb lb iu bd lc ng nh dn lg ni nj dp lk mb nk nl lm mf nm nn lo mj no np lq nq bi translated">步骤5—重新启动apache</h2><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="b6c0" class="nb lb iu mw b gz nc nd l ne nf">$ sudo systemctl restart apache2</span></pre><p id="227b" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">如果您的DNS配置正确，您应该能够看到您的域。</p><h1 id="357e" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">子域</h1><p id="08da" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">我们将为一个子域创建一个虚拟主机。该过程与上一节相同。</p><p id="f2a1" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">我们将web文件存储在<code class="fe mt mu mv mw b">/var/www/newsletter.example.com/public_html</code>中。</p><p id="78a1" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">我们复制<code class="fe mt mu mv mw b">000-default.com.conf</code>来创建一个新文件<code class="fe mt mu mv mw b">newsletter.example.com.conf</code>。</p><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="9239" class="nb lb iu mw b gz nc nd l ne nf">$ sudo cp 000-default.com.conf newsletter.example.com.conf</span></pre><p id="b444" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">编辑<code class="fe mt mu mv mw b">newsletter.example.com.conf</code>:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nr ns l"/></div></figure><p id="0236" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">与前一个示例的不同之处在于向ServerName、ServerAlias、DocumentRoot和Directory添加了一个子域。</p><h2 id="e2ce" class="nb lb iu bd lc ng nh dn lg ni nj dp lk mb nk nl lm mf nm nn lo mj no np lq nq bi translated">启用虚拟主机和SSL</h2><p id="dec4" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">让我们为这个子域启用虚拟主机和SSL。</p><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="6c2a" class="nb lb iu mw b gz nc nd l ne nf">sudo a2ensite newsletter.example.com.conf<br/>sudo certbot --apache -d newsletter.example.com -d www.newsletter.example.com</span></pre><h2 id="9b33" class="nb lb iu bd lc ng nh dn lg ni nj dp lk mb nk nl lm mf nm nn lo mj no np lq nq bi translated">向DNS服务添加记录</h2><p id="0c49" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">如果您使用的是namecheap.com，请转到域列表&gt;高级DNS并添加新记录。</p><p id="1fce" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">可能需要24-48小时。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nt"><img src="../Images/8e4605b9915d4630ab21bc10216098d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xGj1A0LQceKfp_9oHvJ_1g.png"/></div></div></figure><h2 id="5b8d" class="nb lb iu bd lc ng nh dn lg ni nj dp lk mb nk nl lm mf nm nn lo mj no np lq nq bi translated">重新启动apache</h2><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="f4e8" class="nb lb iu mw b gz nc nd l ne nf">$ sudo systemctl restart apache2</span></pre><h2 id="7258" class="nb lb iu bd lc ng nh dn lg ni nj dp lk mb nk nl lm mf nm nn lo mj no np lq nq bi translated">确认您的DNS</h2><p id="ed9e" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">使用<a class="ae kz" href="https://www.whatsmydns.net/" rel="noopener ugc nofollow" target="_blank">https://www.whatsmydns.net/</a>检查您的DNS。如果您配置正确，它会显示您的IP地址。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nu"><img src="../Images/65417def745247afa614022c9198a9a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*UR46vnUz14t7ARz_hs2gTw.png"/></div></figure><h1 id="2863" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated"><code class="fe mt mu mv mw b">etc/apache2/sites-available</code></h1><p id="3f5c" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">现在您在<code class="fe mt mu mv mw b">sites-available</code>目录中有了以下文件。</p><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="6492" class="nb lb iu mw b gz nc nd l ne nf">ls /etc/apache2/sites-available/<br/>000-default.conf              000-default.conf.dpkg-dist<br/>default-ssl.conf              000-default-le-ssl.conf <br/>example.com.conf              example.com-le-ssl.conf <br/>newsletter.example.com.conf   newsletter.example.com-le-ssl.conf</span></pre><p id="a0f9" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated"><code class="fe mt mu mv mw b">xxxx-le-ssl.conf</code>文件用于您的SSL。</p><h1 id="355e" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">如何删除虚拟主机</h1><p id="b7bd" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">使用<code class="fe mt mu mv mw b">a2dissite</code>命令禁用现有的虚拟主机。</p><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="b112" class="nb lb iu mw b gz nc nd l ne nf">$ sudo a2dissite 000-default.conf<br/>$ sudo a2dissite 000-default-le-ssl.conf</span></pre><p id="3f7f" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">在这里，您正在禁用<code class="fe mt mu mv mw b">000-default.conf</code>及其SSL虚拟主机。</p><h1 id="f7c3" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">结论</h1><p id="49d7" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">现在您知道了如何在您的服务器上创建虚拟主机。这允许你在一台服务器上托管尽可能多的网站。</p></div><div class="ab cl nv nw hy nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="in io ip iq ir"><p id="966e" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated"><strong class="lu iv">通过</strong> <a class="ae kz" href="https://blog.codewithshin.com/membership" rel="noopener ugc nofollow" target="_blank"> <strong class="lu iv">成为</strong> </a> <strong class="lu iv">会员，获得媒体上所有故事的访问权限。</strong></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj oc"><img src="../Images/0be3ee559fee844cb75615290e4a8b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*DjTM9iFtVc2wlcWcOms7VQ.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><a class="ae kz" href="https://blog.codewithshin.com/subscribe" rel="noopener ugc nofollow" target="_blank">请订阅。</a></p></figure><h1 id="6ed0" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">参考</h1><ul class=""><li id="c48c" class="od oe iu lu b lv lw ly lz mb of mf og mj oh mn oi oj ok ol bi translated"><a class="ae kz" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-apache-virtual-hosts-on-ubuntu-18-04" rel="noopener ugc nofollow" target="_blank">如何在Ubuntu 18.04上设置Apache虚拟主机</a></li><li id="0672" class="od oe iu lu b lv om ly on mb oo mf op mj oq mn oi oj ok ol bi translated"><a class="ae kz" href="https://www.digitalocean.com/community/tutorials/apache-configuration-error-ah00558-could-not-reliably-determine-the-server-s-fully-qualified-domain-name" rel="noopener ugc nofollow" target="_blank"> Apache配置错误AH00558:无法可靠地确定服务器的完全限定域名</a></li></ul></div></div>    
</body>
</html>