<html>
<head>
<title>How I Built CI/CD For Data Pipelines in Apache Airflow on AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何在AWS上为Apache Airflow中的数据管道构建CI/CD</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-i-built-ci-cd-for-data-pipelines-in-apache-airflow-on-aws-aae029fe557e?source=collection_archive---------11-----------------------#2021-05-04">https://towardsdatascience.com/how-i-built-ci-cd-for-data-pipelines-in-apache-airflow-on-aws-aae029fe557e?source=collection_archive---------11-----------------------#2021-05-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6cb6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">现代数据工程需要自动化部署流程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/22f6b22111f1efd261503a8104c809e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A8sufOHQCx96fv1NX_ViAg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://www.pexels.com/photo/photo-of-skyline-at-night-3075993/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a> | <a class="ae ky" href="https://www.annageller.com/disclosure" rel="noopener ugc nofollow" target="_blank">品牌内容披露</a></p></figure><p id="f54a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di"> A </span> pache Airflow是构建数据工程工作负载的常用平台。部署气流的方式如此之多，以至于很难提供一个简单的答案来说明如何建立一个持续的部署过程。在本文中，我们将重点关注作为“DAG存储”的S3，并演示一种实现健壮的CI/CD管道的简单方法。</p><p id="2bdc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">目录</strong></p><p id="df53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="#bb6a" rel="noopener ugc nofollow">在AWS上创建Apache Airflow环境</a> <br/> <a class="ae ky" href="#f490" rel="noopener ugc nofollow"> Git存储库</a> <br/> <a class="ae ky" href="#dd3a" rel="noopener ugc nofollow">为数据管道构建简单的CI/CD</a><br/><a class="ae ky" href="#25f1" rel="noopener ugc nofollow">在Airflow中测试数据管道的CI/CD流程</a> <br/> <a class="ae ky" href="#1669" rel="noopener ugc nofollow">我们如何让CI/CD管道在生产中更加健壮？</a><br/><a class="ae ky" href="#eb8d" rel="noopener ugc nofollow">Buddy如何处理代码的变更？</a> <br/> <a class="ae ky" href="#0d3d" rel="noopener ugc nofollow">数据管道自动化部署流程的优势</a> <br/> <a class="ae ky" href="#bc15" rel="noopener ugc nofollow">如果您使用不同于Apache Airflow的工作流编排解决方案会怎样？</a><br/>T34】结论</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="bb6a" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">演示:在AWS上创建Apache气流环境</h1><p id="c2f3" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">自2020年12月起，AWS为阿帕奇气流提供名为MWAA的全面托管服务。在本演示中，我们将构建一个MWAA环境和一个持续交付流程来部署数据管道。如果您想了解更多关于AWS上的托管Apache气流的信息，请阅读下面的文章:</p><div class="ni nj gp gr nk nl"><a rel="noopener follow" target="_blank" href="/managed-apache-airflow-on-aws-new-aws-service-for-data-pipelines-91908ee9e5fc"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">AWS上的托管Apache气流—针对数据管道的新AWS服务</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">面向Apache Airflow (MWAA)的AWS托管工作流现已推出，值得一试吗？</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">towardsdatascience.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz ks nl"/></div></div></a></div><p id="10ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们从<strong class="lb iu">在AWS管理控制台中创建一个气流环境</strong>开始。整个过程是自动化的，你只需要点击一个按钮来部署一个CloudFormation堆栈，它将<strong class="lb iu">创建一个VPC </strong>和所有相关的组件，然后填充一些关于<strong class="lb iu">你想要构建的实际环境</strong>的细节。环境类，工人节点的最大数量)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/8f96f9ca4575e162dbde42d7edead28c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F8HxcmOzQbGNWTn-Nvs4Qg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在自动气象站上配置MWAA气流环境—图片由作者提供</p></figure><p id="ce25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦创建了环境，我们就可以通过构建一个连续的交付流程来开始部署我们的数据管道，该流程会自动将Dag推送到适当的S3位置。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="f490" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">Git储存库</h1><p id="eee5" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">对于这个演示，我们将使用一个简单的设置，它将只包括开发和主分支。这样，在推送到<code class="fe oc od oe of b">dev</code>分支时，我们可以自动部署到我们的AWS开发环境。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/c25d3f0bfd590a16838f41f592bd86f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5pzp3OMuK1Hm5Q6tQ5OmSQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">演示Git存储库—作者图片</p></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="dd3a" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">为数据管道构建简单的CI/CD</h1><p id="14c7" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">要在短短五分钟内构建一个CD进程，我们将使用<a class="ae ky" href="https://buddy.works/" rel="noopener ugc nofollow" target="_blank"> Buddy </a>。如果你想试试，自由层允许<a class="ae ky" href="https://buddy.works/pricing" rel="noopener ugc nofollow" target="_blank">最多五个项目</a>。</p><p id="e216" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">#1.创建一个<strong class="lb iu">新项目</strong>并选择您的Git托管提供商。对我们来说，是Github:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/354d32a8d17e00b916bcf5fff62b8721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*_A4OBviatH6Uu4ebSdz3mA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在Buddy中构建CI/CD管道—作者图片</p></figure><p id="bd84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">#2.添加一条<strong class="lb iu">新管道</strong>。这表明在同一个项目中可以有几个管道。例如，您可以有一个部署到<strong class="lb iu">开发(dev) </strong>的管道，一个部署到<strong class="lb iu">用户验收测试(uat) </strong>的管道，以及一个部署到<strong class="lb iu">生产(prod) </strong>环境的管道。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/3f1437bcb01462c7811e9a4c77f77549.png" data-original-src="https://miro.medium.com/v2/resize:fit:818/format:webp/1*xeMVaXHosYzwYtOOFVDziw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://buddy.works/" rel="noopener ugc nofollow" target="_blank"> Buddy </a>中建立CI/CD管道—图片由作者提供</p></figure><p id="9c40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">#3.配置<strong class="lb iu">时</strong>管道应<strong class="lb iu">触发</strong>。对于这个演示，我们希望代码在每个<strong class="lb iu">推</strong>到<code class="fe oc od oe of b">dev</code>分支时被部署到S3。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/c6347d464a126b59af6075bbafef625c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tZuWzv1s7dkOLxCtAHkiIw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://buddy.works/" rel="noopener ugc nofollow" target="_blank">好友</a>中构建CI/CD管道—图片由作者提供</p></figure><p id="d96c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">#4.新增一个<strong class="lb iu">动作</strong>。在这里，我们可以为部署流程添加所有构建阶段。对于这个演示，我们只需要一个将代码<strong class="lb iu">上传到S3桶</strong>的过程，但是你可以从各种动作<a class="ae ky" href="https://buddy.works/actions" rel="noopener ugc nofollow" target="_blank">中选择</a>来包含额外的单元和集成测试等等。现在，我们选择动作<em class="oa">“将文件传输到Amazon S3 bucket”</em>，并配置从Git文件夹<code class="fe oc od oe of b">dags</code>对Python文件的任何更改都应该触发到我们选择的S3 bucket的部署。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/cfbdf55531596a9aaa8ae35f4eb82376.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*SmFLO2bIodxBdjwUuckINg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">配置“操作”将代码上传到S3 —图片由作者提供</p></figure><p id="3ce1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">#5.配置附加的<strong class="lb iu">“选项”</strong>以确保正确的文件类型将被上传到正确的S3子文件夹。对于此演示，我们希望我们的DAG文件将部署到文件夹<code class="fe oc od oe of b">dags</code>中，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/43a4e4623dd5191ca137cf8e91534187.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PEDfTkFqoFWGot7DJG4HCA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">S3位置—作者图片</p></figure><p id="39b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过使用相同的<em class="oa">动作</em>，转到右侧的<strong class="lb iu">“选项”</strong>选项卡，在S3上配置远程路径:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/7dcac8f19e4dab3ffafe1e9fe5ea87ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*uQaCLfLbelUeBKFRdO1yzA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://buddy.works/" rel="noopener ugc nofollow" target="_blank"> Buddy </a>中构建CI/CD管道—图片由作者提供</p></figure><p id="6765" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择适当的S3路径后，我们可以测试并保存动作。</p><p id="1f21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可选地，我们可以指定<strong class="lb iu">忽略特定的文件类型</strong>。例如，我们可能想要排除单元测试(<em class="oa"> test* </em>)和文档降价文件(<em class="oa"> *)。md </em>):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/481fdec56798d9aa4e129d316cccd41c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*X1WzPbqcpK83qNbJBi7aSA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://buddy.works/" rel="noopener ugc nofollow" target="_blank"> Buddy </a>中建立CI/CD管道—图片由作者提供</p></figure><p id="f3d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">#6.这一步是可选的，但是如果在部署过程中出现问题，通知<strong class="lb iu">是很有用的。我们可以配置几个动作，如果CI/CD管道出现问题，就会触发这些动作。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/e71f8a5c16ed509467369592c1cd9446.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*5WK1PmWXbX157bCQNxaIHw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://buddy.works/" rel="noopener ugc nofollow" target="_blank">好友</a>中建立CI/CD管道—图片由作者提供</p></figure><p id="0004" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们选择在行动失败时通过电子邮件获得通知:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/b3a782cdf433b4d1977f98e84c853335.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*ydcXaQgQ-EQPyHiZWox_2w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://buddy.works/" rel="noopener ugc nofollow" target="_blank">好友</a>中发送失败通知——图片由作者提供</p></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="25f1" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">在气流中测试数据管道的CI/CD过程</h1><p id="5b53" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">我们现在准备将一个示例数据管道推到我们的环境中。我们可以看到，最初，我们没有Dag。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/7e204d7b976ea954249055aa5d0dda3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YYv5IGY3I1ILuOKZA7IN3Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">气流image图片作者</p></figure><p id="3b5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在将两个新文件推送到<code class="fe oc od oe of b">dev</code>分支——其中一个是<strong class="lb iu"> DAG文件</strong>，另一个是应当排除的<strong class="lb iu"> markdown文件</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/d60b655414147e63b238646db4f3e09e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p4IjHU3cqsgxrKx5MpT2og.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">测试CI/CD管道的初始推送—图片由作者提供</p></figure><p id="9ab3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们是分别提交和推送的，所以我们可以看到，每次Git推送都会触发一次管道:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/acb36fb9b2643c6a4105e21079afecf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VUZTpodwe89-Y4ezyOTVKg.png"/></div></div></figure><div class="kj kk kl km gt ab cb"><figure class="ot kn ou ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/035ac9b0b26924a1c23c1bad51ed6bed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*bgW-n-ikMkhfbaohS9LOrg.png"/></div></figure><figure class="ot kn oz ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/8c31207ec4d77d3ecc12ad2bc2080c24.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*CjeD6k-LkG_IWsOSpD5U6w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk pa di pb pc translated">在<a class="ae ky" href="https://buddy.works/" rel="noopener ugc nofollow" target="_blank">好友</a>中触发的CI/CD管道—图片由作者提供</p></figure></div><p id="5d80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以确认只有Python文件被推送到S3:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/470b4c5c76d6a0085fab4ec6d0661df1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zrib_JvW7wDqltLy_k5emw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">AWS上气流数据管道的CI/CD管道—图片由作者提供</p></figure><p id="3b13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">AWS上的MWAA气流环境自动选择了来自S3的DAG:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/7ab185fe65e57730d43b7745f6097769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fXznsXih0-YsvOuQGdXhAA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">AWS上气流数据管道的CI/CD管道—图片由作者提供</p></figure><p id="f1e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的演示到此结束。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="1669" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">我们如何让CI/CD渠道在生产中变得更加强大？</h1><p id="b26c" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">如果您想在您的管道中包含一个额外的批准步骤，您可以在代码被推送到S3之前，在Buddy中添加一个相应的<strong class="lb iu">“等待批准”</strong>动作。为了更方便，我们还可以添加一个动作给负责生产环境的高级开发人员发送一封关于构建过程的电子邮件。然后，代码只有在事先批准后才能部署。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/ce65b2a59ce76776b68e8f25657afc8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*sSxcnvzmiVhT0kmpDwOjvQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">添加两个附加操作来通知构建过程，并添加手动批准步骤—按作者分类的图像</p></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="eb8d" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">Buddy如何处理代码的更改？</h1><p id="fa62" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">你可能会问:Buddy是如何处理代码变更的？每次我们对存储库进行任何更改时，它会重新上传您的所有Dag吗？答案是否定的。<strong class="lb iu">初始</strong> CI/CD管道的执行将从指定的存储库路径上传所有文件。然而，每个后续的执行都使用<strong class="lb iu">“git diff”</strong>来创建变更集。基于<code class="fe oc od oe of b">diff</code>，在S3中只有被添加、修改或删除的文件才会被更改。</p><p id="cab9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">删除是一个特例，Buddy允许我们配置在Git中删除一个文件是否也应该删除远程服务器(S3)上的代码。对于这个演示，我们选择删除文件，以确保所有东西(<em class="oa">包括Dag</em>的删除)都通过Git。但是您可以根据自己的意愿自由配置它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/a214b934ab0d3f421ff1cc38eac546ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fbjbwp4kzUiurAkGQ3EWcw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如何处理Git存储库中删除的文件——作者图片</p></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="0d3d" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">数据管道自动化部署流程的优势</h1><p id="1bec" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">由于Apache Airflow在撰写本文时不提供DAG <strong class="lb iu">版本控制</strong>,这种CI/CD管道方法允许您通过Git提交历史记录跟踪对DAG所做的任何更改。此外，您还获得了一个标准化的、<strong class="lb iu">可重复的流程</strong>，该流程消除了手动部署中的<strong class="lb iu">人为错误</strong>，并确保除非在您的Git存储库中进行了版本控制，否则不会部署任何东西。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="bc15" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">如果您使用不同于Apache Airflow的工作流编排解决方案会怎样？</h1><p id="0a12" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">如果您喜欢使用开源工作流编排工具而不是Airflow，您也可以使用<a class="ae ky" href="https://buddy.works/" rel="noopener ugc nofollow" target="_blank"> Buddy </a>来管理这些数据管道的构建过程。例如，Prefect或Dagster都利用GraphQL并支持容器化环境，这使得自动化数据工程工作负载的部署变得简单。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="268b" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">结论</h1><p id="8c5f" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">本文研究了如何在Apache Airflow中为数据管道构建CI/CD流程。现代数据工程需要自动化部署流程。始终使用版本控制系统来管理您的代码并基于您的Git工作流自动化构建过程是一个很好的实践。</p><p id="1c8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">感谢您的阅读！如果这篇文章有用，</strong> <a class="ae ky" href="https://medium.com/@anna.anisienia" rel="noopener"> <strong class="lb iu">关注我</strong> </a> <strong class="lb iu">看我下一篇帖子。</strong></p></div></div>    
</body>
</html>