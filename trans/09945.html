<html>
<head>
<title>Deploying python functions on Google Cloud Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在谷歌云函数上部署python函数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploying-python-functions-with-google-cloud-functions-557517865ba7?source=collection_archive---------8-----------------------#2021-09-19">https://towardsdatascience.com/deploying-python-functions-with-google-cloud-functions-557517865ba7?source=collection_archive---------8-----------------------#2021-09-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fc6f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">部署python函数从未如此简单</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3b5efb0fc933e28ba9703057ca45dbf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MKS1gJ8yyNhq45Re"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">安德里克·朗菲尔德在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="44e7" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="c451" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">部署应用程序总是一个需要分析的过程。应用程序的复杂性、大小等等都是影响应用程序部署位置和方式的因素。</p><p id="1394" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">当您的应用程序很小，并且不需要大量资源时，如大型数据库查询和硬处理，您可以使用Google Cloud功能来部署它。不需要设置一个虚拟机和使用气流(举例来说),你只需要准备你的代码并把它发送到GCF，google会处理所有需要的资源来部署和运行你的功能。</p><p id="9458" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">总之，GCF是一个工具，它允许您部署“可伸缩随用随付功能即服务(FaaS ),无需服务器管理就能运行您的代码。”一些功能包括:</p><ul class=""><li id="5047" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated">没有要供应、管理或升级的服务器；</li><li id="db67" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">根据负载自动缩放；</li><li id="0183" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">集成监控、记录和调试功能；</li><li id="af90" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">基于最小特权原则的角色和每个功能级别的内置安全性；</li><li id="7422" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">针对混合云和多云场景的关键网络功能；</li><li id="0bdd" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">一个不错的免费层，允许你免费使用它；</li></ul><h1 id="50ec" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">部署</h1><h2 id="7f2e" class="nd kx iq bd ky ne nf dn lc ng nh dp lg lx ni nj li mb nk nl lk mf nm nn lm no bi translated">设置功能</h2><p id="07a8" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">使用谷歌云功能进行部署的方式有很多种。我将在本文中展示更简单的方法，在下一篇文章中，我将展示我更喜欢的方法(通过与github的持续集成)。</p><ol class=""><li id="5230" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj np mv mw mx bi translated">首先，进入谷歌控制台，在左边栏选择云函数，然后点击创建一个函数。应该会出现下面的模式</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/f96ed587c9ed2c3d790cbbccf57ad18e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*qPJRoieUOp_QGxpXDXjvmw.png"/></div></figure><p id="4c6c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这里有些字段应该解释一下:</p><ul class=""><li id="52e6" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated"><strong class="lq ir">功能名称:</strong>您要部署的功能的名称。选择合适的名称很重要，因为它将帮助您在需要时找到您的功能。</li><li id="2c09" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">区域:</strong>将部署该功能的地方。将函数的区域设置为应用程序的相同区域。</li><li id="61b1" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">触发器:</strong>你的函数将如何被调用。有很多方法可以调用你的函数。这里我会选择HTTP，这是最通用的一个。</li><li id="7de8" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir"> URL: </strong>你的功能在google上的地址；</li><li id="9be1" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">验证:</strong>您的函数是否需要验证才能被调用。我将在这里检查允许未经验证的调用。</li></ul><p id="58e0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">之后，单击保存，然后单击运行时、构建、连接…</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/187e73a3a9a386927aa39ced39104800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*UsOgY2mkE-tF90Uc_H5Xgg.png"/></div></figure><p id="da12" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这里我们有很多字段，每个字段可能需要一篇文章。我将尝试只对内存，超时和自动缩放。在接下来的文章中，我们将深入讨论其他领域。</p><ul class=""><li id="ecc7" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated"><strong class="lq ir">分配的内存:</strong>为运行该功能而分配的ram内存。最大值是8 Gb，这就指向了我上面说的事实:GCF不是针对需要很多资源的函数。我会把它设置在256 Mb。这对我们的测试来说足够了</li><li id="fd59" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">超时</strong>:允许运行您的功能的最长时间。<br/>“如果云功能在超时期限内没有完成，那么该功能将被终止。默认值为60秒，但可以在1秒到540秒(9分钟)之间。一般来说，我将它设置为最大值，因为GCF具有冷启动功能，第一次调用该函数会比接下来的调用慢得多。”</li><li id="7cdc" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">自动缩放</strong>:你是否会为你的函数创建更多的实例，以允许多个调用同时进行。"为了提高性能，您可以将最小实例数设置为大于0。您还可以为用例设置最大实例数，例如限制成本。突然的流量高峰可能会导致暂时超出限制。留空或设置为0可清除此控件，并根据需要自动创建新实例。</li></ul><h2 id="28e6" class="nd kx iq bd ky ne nf dn lc ng nh dp lg lx ni nj li mb nk nl lk mf nm nn lm no bi translated">源代码</h2><p id="0849" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">之后，单击下一步，应该会出现如下页面:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/4ea78d86f82e38250096d0e92cf95766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ILbOz_OlGDEOXvZCX2nmA.png"/></div></div></figure><ul class=""><li id="ebcd" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated"><strong class="lq ir">运行时:</strong>源代码的语言。将其更改为您在函数中使用的python版本。</li><li id="0e46" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">入口点:</strong>代码执行过程中首先调用的python函数。</li><li id="93c3" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">源代码:</strong>你的代码的来源。让我们在这个例子中使用内联编辑器，但是在第二篇文章中我们将使用云存储库。</li></ul><p id="73a8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们在部署函数之前检查一下代码:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/1850815bf823b321b1e1f9545d13b93d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c20nvhyU-WuRdORbV-tsZw.png"/></div></div></figure><p id="1fe9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">正如我们所见，默认情况下我们有两个文件，main.py和requirements.txt。在requirements中，我们需要编写运行代码所需的库及其版本。在main.py中，该示例接收一个HTTP请求，并检查请求中是否存在字段消息。如果是，它将返回消息(和文本)。否则，它返回Hello World。</p><p id="e198" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在，点击按钮<strong class="lq ir">展开</strong>，等待展开过程结束。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/c8e9d00b638b2402b5c67748bb96cc09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CczulXkNIPEENDwcvHLtaQ.png"/></div></div></figure><h2 id="2974" class="nd kx iq bd ky ne nf dn lc ng nh dp lg lx ni nj li mb nk nl lk mf nm nn lm no bi translated">允许未经授权的访问</h2><p id="66e3" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在我们需要允许任何人调用这个函数:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/0a9ed0f08376847e8515dc66f19e2332.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g2qoE0letBsYN7G7TxGVEQ.png"/></div></div></figure><p id="455a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">点击页面左侧的复选框选择您的功能。点击权限后。</p><p id="fded" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">点击添加委托人，输入<strong class="lq ir"> allUsers </strong>，在<strong class="lq ir">选择角色</strong>，选择<strong class="lq ir">云函数调用者</strong>，如下图。这样做，你将允许互联网上的任何人访问你的功能。有很多方法可以让这个过程更安全，但是我们暂时先不做。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/91fb405e729aa146aa37f4399c60b7b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pJ6CfzkOS_8pziHKJw1gFg.png"/></div></div></figure><p id="30c8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">之后，会出现一个窗口。点击<strong class="lq ir">允许..</strong></p><h2 id="ba61" class="nd kx iq bd ky ne nf dn lc ng nh dp lg lx ni nj li mb nk nl lk mf nm nn lm no bi translated">测试它</h2><p id="a139" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在，让我们使用一个简单的脚本来测试它，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/ef5a4f0ccd4277fdc7fc49e7b39e1d55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9KC_FZRFUXku3xk0fjcCqw.png"/></div></div></figure><p id="c342" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">URL保存了我们函数的地址。可以在gcp控制台点击我们的功能。</p><p id="d6bb" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">代码的第一部分只是一个<strong class="lq ir"> get请求</strong>，所以它不发送任何信息。因此，request_json(来自main.py)为空，因此我们的函数返回Hello World！。在代码的第二部分，我们发出一个<strong class="lq ir"> post请求</strong>，并通过json发送一条消息。在这种情况下，我们的函数返回了消息，这是正确的，因为现在request_json不再是空的，并且具有字段message。</p><h1 id="c46b" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">结论</h1><p id="e1f9" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">Google cloud functions是一项让简单功能的部署过程变得更加简单的服务。部署一个功能的完整过程可以在不到1小时的时间内完成，当您需要设置一个简单功能的快速部署时，这是一个很好的工具。在通过GCF部署一个功能的过程中，可以配置很多东西，但是大多数都很容易理解和配置。</p><p id="f407" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在下一篇文章中，我们将讨论使用git hub在google云功能上的持续集成。在那里见！</p><h1 id="adef" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">参考</h1><p id="bc24" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">【https://cloud.google.com/functions T4】</p></div></div>    
</body>
</html>