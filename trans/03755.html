<html>
<head>
<title>Understanding List Comprehensions in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">理解Python中的列表理解</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/understanding-list-comprehensions-in-python-6de57e26631c?source=collection_archive---------16-----------------------#2021-03-28">https://towardsdatascience.com/understanding-list-comprehensions-in-python-6de57e26631c?source=collection_archive---------16-----------------------#2021-03-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="cb19" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">本文讨论了Python中的列表理解，以及如何使用它们来提高代码的效率和Python性。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5c63acf00277c662fb96b2ff7fafea0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1X0-98EiQNkwBJj2vnTTqQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由<a class="ae kv" href="https://unsplash.com/@cdr6934?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克里斯里德</a>在<a class="ae kv" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="d826" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">列表理解帮助你用最少的代码(通常只有一行代码)执行基本的列表操作。这使得您的代码高效且Pythonic化。让我们看一个例子来使列表理解的概念更清楚。</p><p id="114c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们创建一个从0到9的整数列表，并将列表中的每个元素乘以2。这可以通过使用for循环遍历列表中的每个元素并将其乘以2并将其追加到一个空列表中来实现。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="3897" class="lx ly iq lt b gy lz ma l mb mc">x = list(range(10))<br/>x</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi md"><img src="../Images/ced9f13889f69c17003339e0f8d862b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*7v6KFnBEQb2S9KM-lOicWQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="a2fe" class="lx ly iq lt b gy lz ma l mb mc">x_doubled = []</span><span id="b593" class="lx ly iq lt b gy me ma l mb mc">for i in x:<br/>    x_doubled.append(i * 2)<br/>    <br/>x_doubled</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/20458da438ee7b770b254c56a90a8cb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*aCRcp-iCcdsb_s3jrkMtdg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="62a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们尝试将变量‘x’乘以2，就像我们处理Numpy数组和Pandas系列一样。将Numpy数组或Pandas系列乘以一个数字，再将它们的每个元素乘以该数字。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="8b62" class="lx ly iq lt b gy lz ma l mb mc">x_arr = np.array(x)<br/>list(x_arr * 2)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/20458da438ee7b770b254c56a90a8cb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*aCRcp-iCcdsb_s3jrkMtdg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="6424" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如上所述，将数组乘以2等于将数组的每个元素乘以2。但是列表不会发生这种情况，因为数组和序列的行为类似于向量。让我们将列表乘以2，看看会发生什么。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="0658" class="lx ly iq lt b gy lz ma l mb mc">x * 2</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/f4bf8b7bd55cef8e50d8630f7f178fb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*TfhBLkHHbrqqtXm3sjnm-w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="3c5f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将列表乘以2没有得到预期的结果。它通过将列表“x”追加到自身来扩展它。这和x + x是一样的。让我们用一行代码来执行这个操作。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="ca2c" class="lx ly iq lt b gy lz ma l mb mc">[i * 2 for i in x]</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/20458da438ee7b770b254c56a90a8cb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*aCRcp-iCcdsb_s3jrkMtdg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="eede" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用list comprehension已经用一行代码执行了所需的操作。让我们看看每个方法执行所花费的时间。我们可以使用“timeit”魔法命令来实现。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="187f" class="lx ly iq lt b gy lz ma l mb mc">%%timeit<br/>x_doubled = []</span><span id="b86e" class="lx ly iq lt b gy me ma l mb mc">for i in x:<br/>    x_doubled.append(i * 2)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/c84b3263526ca0fef25574c010c65eba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*bcT74Bg5k3Oty4inCy7Emg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="1292" class="lx ly iq lt b gy lz ma l mb mc">%%timeit<br/>[i * 2 for i in x]</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/3a904b4f3e8136bd6c3faef77b600bbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*qBXeel6PR84FHknBW1bmlg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="1330" class="lx ly iq lt b gy lz ma l mb mc">%%timeit<br/>x_arr = np.array(x)<br/>x_doubled = list(x_arr * 2)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/36ba41aac20d0c87cce08a5acf9061e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*aS1lZ26YtOb0Op55-ZztYw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="7a0d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到，与其他两种方法相比，列表理解减少了代码行数和执行时间。让我们更深入地理解列表，看看一些高级操作。</p><p id="7da6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在下面的例子中，我们将尝试只将偶数乘以2并返回它们。我们将看到如何使用for循环和列表理解来实现这一点。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="3dca" class="lx ly iq lt b gy lz ma l mb mc">x_even_doubled = []</span><span id="3c54" class="lx ly iq lt b gy me ma l mb mc">for i in x:<br/>    if i % 2 == 0:<br/>        x_even_doubled.append(i * 2)<br/>        <br/>x_even_doubled</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/2c900ad6b21201a09885b39cdf7f3111.png" data-original-src="https://miro.medium.com/v2/resize:fit:318/format:webp/1*ZMIxYJxReDEq3PUT7SKb2w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用for循环输出</p></figure><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="8bdb" class="lx ly iq lt b gy lz ma l mb mc">[i * 2 for i in x if i % 2 == 0]</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/2c900ad6b21201a09885b39cdf7f3111.png" data-original-src="https://miro.medium.com/v2/resize:fit:318/format:webp/1*ZMIxYJxReDEq3PUT7SKb2w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用列表理解输出</p></figure><p id="08ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们试着把偶数乘以2，奇数原样返回。我们将看到如何使用for循环和列表理解来实现这一点。我们将在list comprehension中使用三元运算符来执行这个操作。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="1b5d" class="lx ly iq lt b gy lz ma l mb mc">x_new = []</span><span id="d85d" class="lx ly iq lt b gy me ma l mb mc">for i in x:<br/>    if i % 2 == 0:<br/>        x_new.append(i * 2)<br/>    else:<br/>        x_new.append(i)<br/>        <br/>x_new</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/e06f099e6bdc16163ea1f7520029566a.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*w0kGXoYO2cBR0vXWcadl6Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用for循环输出</p></figure><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="0582" class="lx ly iq lt b gy lz ma l mb mc">[i * 2 if i % 2 == 0 else i for i in x]</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/e06f099e6bdc16163ea1f7520029566a.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*w0kGXoYO2cBR0vXWcadl6Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用列表理解输出</p></figure><p id="7af4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们试着把偶数乘以2，奇数原样返回，去掉0。我们将看到如何使用for循环和列表理解来实现这一点。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="c923" class="lx ly iq lt b gy lz ma l mb mc">x_new = []</span><span id="5adc" class="lx ly iq lt b gy me ma l mb mc">for i in x:<br/>    if i % 2 == 0:<br/>        x_new.append(i * 2)<br/>    else:<br/>        x_new.append(i)<br/>        <br/>x_new.remove(0)</span><span id="f3a0" class="lx ly iq lt b gy me ma l mb mc">x_new</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/b7b443920fd39ffbe8c8b2fe9df9b1fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:542/format:webp/1*CW78ejNesTNU1Q07mhVrSw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用for循环输出</p></figure><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="0bf3" class="lx ly iq lt b gy lz ma l mb mc">[i * 2 if i % 2 == 0 else i for i in x if i != 0]</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/b7b443920fd39ffbe8c8b2fe9df9b1fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:542/format:webp/1*CW78ejNesTNU1Q07mhVrSw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用列表理解输出</p></figure><p id="f74a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看嵌套列表的理解。我们将尝试将列表中的偶数乘以2，并保留奇数。然后，我们将偶数除以2，得到原始列表。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="fe6e" class="lx ly iq lt b gy lz ma l mb mc">[int(i / 2) if i % 2 == 0 else i for i in <br/> [i * 2 if i % 2 == 0 else i for i in x]]</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/779ce7784f2e059f291c8c4900e4ef4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:560/format:webp/1*OsQTGsjUKOS7KsZdUwxoNQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">嵌套列表理解的输出</p></figure><p id="a841" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们试着将两个列表组合成如下所示的嵌套列表。我们将看到如何使用for循环、zip函数和list comprehension来实现这一点。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="0bda" class="lx ly iq lt b gy lz ma l mb mc"># Method 1: Using for loop<br/>nested_list = []</span><span id="60e2" class="lx ly iq lt b gy me ma l mb mc">for i in x:<br/>    nested_list.append([i,i])<br/>    <br/>nested_list</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/4c1955d42e089400e8b170b27ba749a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:188/format:webp/1*ST3sLce_Adn4AOtJScRzsA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用for循环输出</p></figure><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="456f" class="lx ly iq lt b gy lz ma l mb mc"># Method 2: Using zip function<br/>list(zip(x, x))</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/6e51338bcc4b5f08e8c3b1bd209534dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:182/format:webp/1*lmj-JW5hdJiRcZWM2yC58Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用zip函数输出</p></figure><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="81a9" class="lx ly iq lt b gy lz ma l mb mc"># Method 3: List comprehension<br/>[[i,i] for i in x]</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/4c1955d42e089400e8b170b27ba749a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:188/format:webp/1*ST3sLce_Adn4AOtJScRzsA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用列表理解输出</p></figure><p id="d5dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到for循环和list comprehension返回的是列表的列表，而zip函数返回的是元组的列表。让我们尝试使用for循环和列表理解来创建列表元素的排列。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="8c21" class="lx ly iq lt b gy lz ma l mb mc">x = list(range(3))<br/>x</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/e7ba0737f76420ae045d6f7091415e2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:194/format:webp/1*aZew27cDQqgtViaqH3AXKg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="b17e" class="lx ly iq lt b gy lz ma l mb mc">perm_list = []</span><span id="aa18" class="lx ly iq lt b gy me ma l mb mc">for i in x:<br/>    for j in x:<br/>        perm_list.append([i, j])<br/>        <br/>perm_list</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/15440aedd736ccb6b217eeaf880fd314.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*5M7c-xHB9vBALHCTYy9uEA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用for循环输出</p></figure><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="b1d8" class="lx ly iq lt b gy lz ma l mb mc">[[i,j] for i in x for j in x]</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/15440aedd736ccb6b217eeaf880fd314.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*5M7c-xHB9vBALHCTYy9uEA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用列表理解输出</p></figure><p id="c7a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我个人在从网上搜集数据时使用列表理解。让我们尝试从网页中提取URL及其文本。我们将创建一个名为“html”的变量来存储一小段html代码，并从“HTML”变量中提取URL及其文本，然后将它们存储在一个以文本为键、以URL为值的字典中。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="a6f7" class="lx ly iq lt b gy lz ma l mb mc">from bs4 import BeautifulSoup</span><span id="2710" class="lx ly iq lt b gy me ma l mb mc"># Variable storing a small HTML code snippet<br/>html = '''<br/>&lt;html&gt;<br/>&lt;head&gt;head&lt;/head&gt;<br/>&lt;body&gt;<br/>&lt;a href="<a class="ae kv" href="https://www.abc.com" rel="noopener ugc nofollow" target="_blank">https://www.abc.com</a>"&gt;abc.com&lt;/a&gt;<br/>&lt;a href="<a class="ae kv" href="https://www.xyz.com" rel="noopener ugc nofollow" target="_blank">https://www.xyz.com</a>"&gt;xyz.com&lt;/a&gt;<br/>&lt;a href="<a class="ae kv" href="https://www.qwerty.net" rel="noopener ugc nofollow" target="_blank">https://www.qwerty.net</a>"&gt;qwerty.com&lt;/a&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;<br/>'''</span><span id="2f57" class="lx ly iq lt b gy me ma l mb mc">bs = BeautifulSoup(html)</span><span id="2886" class="lx ly iq lt b gy me ma l mb mc"># Finding the 'a' tags<br/>a = bs.find_all('a')</span><span id="6970" class="lx ly iq lt b gy me ma l mb mc"># Using list comprehension to extract 'href'<br/>url = [i.get('href') for i in a]</span><span id="8024" class="lx ly iq lt b gy me ma l mb mc"># Using list comprehension to extract text<br/>txt = [i.text for i in a]</span><span id="fa55" class="lx ly iq lt b gy me ma l mb mc"># Using dictionary comprehension to store output<br/>{i: j for i,j in zip(txt, url)}</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/5a5eda15b7eef5da688d393fabf4fff2.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*fTKdSc4mdU9DE5er1hPJLg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="2088" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些是列表理解的一些应用。与for循环相比，它们效率更高，并且还减少了执行操作所需的代码行数。</p></div></div>    
</body>
</html>