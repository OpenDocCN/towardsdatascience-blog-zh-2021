<html>
<head>
<title>How to Build An Object Detection Model Using IceVision</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用IceVision建立对象检测模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-build-an-object-detection-model-using-icevision-36f01472362e?source=collection_archive---------21-----------------------#2021-11-25">https://towardsdatascience.com/how-to-build-an-object-detection-model-using-icevision-36f01472362e?source=collection_archive---------21-----------------------#2021-11-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4d6c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用几行代码构建您的对象检测模型</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/aeca54fda1432e50db78d70ca998544a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mtvw6Ig5LPUSm-tfQyfk0g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@goosegrease?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Derek Oyen </a>拍照</p></figure><h1 id="b34d" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="23c2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">计算机视觉多年来一直在进步。有了它，我们可以自动完成任务，看到我们眼睛看不到的东西。</p><p id="51e3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">对象检测是现有的计算机视觉应用之一。在这个任务中，我们不仅要对图像进行分类，还要检测目标的位置。之后，模型会创建一个包围它的边界框。</p><p id="7588" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">听起来很酷，对吧？但不幸的是，实现对象检测是具有挑战性的，并且需要时间。对于一个新人，我可以保证他们会变得不知所措。然后，IceVision来到了互联网。</p><p id="9c50" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">IceVision是一个计算机视觉库，用于直接实现对象检测模型。您不必担心数据准备和模型实现，因为IceVision会处理这些问题。因此，您可以通过使用对象检测来专注于解决问题。</p><p id="25ed" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在本文中，我将向您展示如何使用IceVision实现一个对象检测模型。事不宜迟，我们开始吧！</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="4f44" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">履行</h1><h2 id="ab0e" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">下载库</h2><p id="6560" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们需要做的第一步是下载库。为了下载这个库，我们到GitHub上的IceVision存储库，下载名为icevision_install.sh的shell脚本。</p><p id="eb9c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">请记住，IceVision库只能在Linux和Mac OS上运行。对于Windows用户，您可以使用Google Colab来继续学习本教程。你可以在这里 访问GitHub库<a class="ae ky" href="https://github.com/airctic/icevision" rel="noopener ugc nofollow" target="_blank">T5。</a></p><p id="f01f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，您可以通过下面的链接下载shell脚本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="8f30" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下载脚本后，您可以使用bash运行脚本，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="5db5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">安装完库后，您可以使用下面的代码重新启动笔记本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="e6a2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在您可以加载库了。下面是实现这一点的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><h2 id="32e4" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">获取并准备数据</h2><p id="65ed" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我们下载并加载库之后，下一步是获取数据。在本教程中，我们将使用牛津大学IIIT分校的Pets数据集中的一个例子。</p><p id="b876" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">该数据集包含大约7400幅图像，它们被分为37类。对于这个数量的类，每个类包含大约200个图像。在 这里可以看到关于数据集<a class="ae ky" href="https://www.robots.ox.ac.uk/~vgg/data/pets/" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">的详细信息。</strong></a></p><blockquote class="ns nt nu"><p id="ce6d" class="lr ls nv lt b lu mn ju lw lx mo jx lz nw mp mc md nx mq mg mh ny mr mk ml mm im bi translated">免责声明:<br/>数据集是在知识共享署名-共享4.0国际(CC BY-SA 4.0)许可下许可的。这个许可意味着每个人都可以出于任何目的访问和使用数据，包括本文的教程。你可以在这里 了解更多关于<a class="ae ky" href="https://creativecommons.org/licenses/by-sa/4.0/" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">牌照的信息。</strong></a></p></blockquote><p id="2ab7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们回到主题。现在让我们加载数据。幸运的是，Icedata库提供了数据集。您可以运行以下代码来加载数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="532f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">加载数据后，下一步是创建用于定型和测试模型的数据拆分器。在这种情况下，我们将对训练数据使用80%的比例，对测试数据使用20%的比例。下面是实现这一点的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="ee84" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这样做之后，下一步是解析数据集。这样做的原因是为了准备数据。因此，它更容易被模型读取。之后，我们根据之前我们的比例将数据拆分成训练集和测试集。下面是实现这一点的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="1789" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您想查看类名及其标签，可以运行以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="d9ff" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您想查看数据集的预览，可以运行这行代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="f4ba" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">获得数据后，下一步是初始化Dataset对象。但在此之前，我们需要实现图像增强。这样做的原因是通过给图像一些修改来提高模型的性能。</p><p id="f057" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们将应用的增强技术是归一化图像值，并将它们裁剪成所需的图像大小。下面是实现这一点的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="ec0c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在我们可以初始化数据集对象。下面是实现这一点的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="4f3e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要确保对象正常工作，请运行这行代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><h2 id="4a6f" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">建立模型</h2><p id="192b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们的数据已经加载完毕。现在让我们建立模型。对于本教程，我们将使用RetinaNet作为架构。对于主干，我们使用ResNet-50作为模型的特征提取器。下面是实现这一点的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="21ac" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在您加载模型之后，现在让我们初始化模型。下面是实现这一点的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="1fe8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">初始化模型后，下一步是为数据集创建一个加载器。之所以这么做，是因为模型要批量训练。在每次迭代中，模型将获得一批数据集，并在模型上对其进行训练。</p><p id="a301" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">对于测试数据集，我们不会打乱批次，因为我们没有训练数据。我们测试它只是为了看看它的性能。下面是实现这一点的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="2257" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要验证数据加载器是否已初始化，您可以运行这行代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><h2 id="5045" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">训练模型</h2><p id="910d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在你有了数据和模型。下一步是训练模型。让我们为我们的模型初始化度量。</p><p id="0ff1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这种情况下，我们将使用COCO指标以及损失或错误的数量。编写以下代码行来初始化指标:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="579c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">IceVision库有两种训练模型的方法。有Fast.ai法和PyTorch闪电法。对于本教程，我只给大家展示Fast.ai方法。</p><p id="d2be" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">其原因是因为这种方法已经准备了一些可视化，以便更容易地理解我们的模型的进展。让我们使用这行代码初始化Fast.ai学习器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="e336" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在我们训练模型之前，分析使用哪个学习率是一个更好的步骤。为此，您可以运行以下代码行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="4707" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">从上面可以看出，学习率为0.001的模型损失最低。因此，我们将使用该值作为训练模型的参数。现在让我们微调模型。下面是实现这一点的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="b441" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">因为我们使用了<a class="ae ky" href="http://fast.ai/" rel="noopener ugc nofollow" target="_blank"> Fast.ai </a>函数，所以可以看到一个表格。它由亏损次数和可可指标组成。从上面可以看出，该模型的COCO指标约为0.708。损失值对预测真的很好。</p><h2 id="5f28" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">保存模型</h2><p id="8bfb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在我们有了最好的模型。让我们通过使用save_icevision_checkpoint函数来保存模型。下面是实现这一点的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz nr l"/></div></figure><h2 id="0611" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">测试模型</h2><p id="fc66" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">最后，让我们在测试数据上测试模型。在这种情况下，我们使用之前分割的验证数据。</p><p id="84c7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了测试我们前面的函数，让我们尝试使用model_from_checkpoint函数加载模型。下面是实现这一点的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="077b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">似乎没有出现错误。让我们通过运行以下几行代码来验证它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="f1e0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">不错！似乎没有发生任何错误。让我们通过使用这行代码来加载模型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="5652" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在我们来试试这个模型。请运行以下几行代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="6187" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后一步，让我们看看结果如何。请运行这行代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><h1 id="32d7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结束语</h1><p id="68cf" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">干得好！现在，您已经学习了如何使用IceVision实现对象检测模型。我希望你能在这里学到新的东西。还有，希望这篇文章可以帮助你针对自己的问题建立一个对象检测模型。</p><p id="99bb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你对我的文章感兴趣，你可以在Medium上关注我。对于那些还不是Medium成员的人，您可以使用下面的链接订阅Medium:</p><div class="oa ob gp gr oc od"><a href="https://medium.com/@irfanalghani11/membership" rel="noopener follow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">通过我的推荐链接加入Medium-Irfan Alghani Khalid</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">medium.com</p></div></div><div class="om l"><div class="on l oo op oq om or ks od"/></div></div></a></div><p id="f2f9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您有任何问题，可以通过<a class="ae ky" href="https://www.linkedin.com/in/alghaniirfan/" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> LinkedIn </strong> </a>联系我。</p><p id="4ab2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">谢谢你看我的文章！</p></div></div>    
</body>
</html>