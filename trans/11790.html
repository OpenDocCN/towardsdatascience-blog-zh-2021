<html>
<head>
<title>The Most Efficient Way to Organize Dbt Models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">组织Dbt模型的最有效方式</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-most-efficient-way-to-organize-dbt-models-244e23c17072?source=collection_archive---------5-----------------------#2021-11-24">https://towardsdatascience.com/the-most-efficient-way-to-organize-dbt-models-244e23c17072?source=collection_archive---------5-----------------------#2021-11-24</a></blockquote><div><div class="fc ij ik il im in"/><div class="io ip iq ir is"><div class=""/><div class=""><h2 id="c20a" class="pw-subtitle-paragraph js iu iv bd b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj dk translated">命名约定、yml文件和文件夹结构</h2></div><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/fa966cbbda4bbc272887bbf78534438b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*97vwzj5UXOJMXrsXwBlQsA.jpeg"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated"><a class="ae la" href="https://unsplash.com/@shawnanggg?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> @shawnanggg </a>在<a class="ae la" href="https://unsplash.com/s/photos/organization?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="491c" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">Dbt是分析界的热门工具，而且只会越来越受欢迎。分析师和分析工程师都使用它来以更快、更可靠的方式运行模块化代码。</p><p id="16f0" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">组织是以对团队有效的方式使用dbt的关键组成部分。它的用处取决于您的dbt项目结构的组织程度。</p><p id="56e1" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">对于那些从未使用过dbt的人来说，这可能是相当吓人的。幸运的是，这个工具背后的团队已经彻底地<a class="ae la" href="https://docs.getdbt.com/docs/building-a-dbt-project/documentation" rel="noopener ugc nofollow" target="_blank">记录了</a>他们用于个人客户的结构。</p><p id="c4ed" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">虽然我使用他们的结构作为建立我的模型的指南，但是组织的很多部分依赖于你自己的用例以及你所支持的团队。</p><p id="051e" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">一种制度不适合所有人。这在很大程度上是一门艺术，要弄清楚什么最适合你的分析团队。</p><h2 id="6397" class="lx ly iv bd lz ma mb dn mc md me dp mf lk mg mh mi lo mj mk ml ls mm mn mo mp bi translated">文件夹结构</h2><p id="1d53" class="pw-post-body-paragraph lb lc iv ld b le mq jw lg lh mr jz lj lk ms lm ln lo mt lq lr ls mu lu lv lw io bi translated">dbt的团队建议将你的模型组织到两个不同的文件夹中- <strong class="ld iw"> staging </strong>和<strong class="ld iw"> marts </strong>。</p><p id="260a" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">暂存模型是那些从原始数据文件中读取并涉及数据清理的模型。有时需要连接和更复杂的转换。</p><p id="a395" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">Dbt建议在组织您的模型时，将阶段模型和基础模型包含在这个类别中。基本模型也从源数据中读取数据，但要简单得多，包括对列的转换和重命名。</p><p id="6307" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">集市模型是包含聚合、连接和复杂逻辑的更高级的模型。这实际上是包含最终产品的文件夹。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi mv"><img src="../Images/9aa62a9d940977644c964d3f5565ff92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NcEukuQBBGIcsLmZYq3WAg.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</p></figure><p id="d520" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">当我使用这个文件夹结构作为设置模型的指南时，我添加了一些其他的文件夹来帮助保持事情更加有条理。我们的模型非常复杂，所以有许多中间模型组成了每个核心模型。如果没有额外的文件夹，文件会在风暴中丢失。</p><p id="c298" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">我为这些中间模型创建了一个单独的文件夹，这样当我需要它们时，我可以很容易地找到最重要的模型。在这个中间文件夹中是每个核心模型的文件夹(那些存在于marts文件夹中的)，所以我可以跟踪哪些模型与每个核心模型相关。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/feaaf854b910e783d7a3dcd079b449a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*FqOVZcOHuJ_m7k5NfUUDDg.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</p></figure><p id="e129" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">您还可以遵循dbt文档中的建议，在staging文件夹下包含一个嵌套的中间模型文件夹。</p><p id="6113" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><code class="fe mx my mz na b">staging/&lt;source&gt;/intermediate/</code></p><p id="ebe0" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">此外，我们只有一个用于基本模型的文件夹，而不是暂存文件夹。它们都相当简单，只需要转换和重命名，所以不需要阶段模型。</p><p id="0762" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">在基本文件夹中，每个数据源都有一个文件夹，其中包含每个数据表的SQL文件。这些SQL文件中的每一个都从不同的数据源和表中读取。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/ffcb4036cb47517daaf6f5cbc696791d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*jnPMQz1NSs6ND1KrnD5QzA.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</p></figure><p id="1d8a" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">此外，每个文件夹都有自己的yml文件，所以没有一个大的yml文件用于所有的基础模型。我想让东西尽可能地容易阅读和理解。有时候一个地方的信息太多会让人不知所措。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/a261f1b64fb8f165a2b6c3b6f2a6a590.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*g30XqKwHLqGRNqaNunxYYA.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</p></figure><p id="a3db" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">下面是我遵循的结构的快速概述:</p><ul class=""><li id="d68f" class="nd ne iv ld b le lf lh li lk nf lo ng ls nh lw ni nj nk nl bi translated">基础</li><li id="f439" class="nd ne iv ld b le nm lh nn lk no lo np ls nq lw ni nj nk nl bi translated">媒介的</li><li id="a1a4" class="nd ne iv ld b le nm lh nn lk no lo np ls nq lw ni nj nk nl bi translated">市场/核心</li></ul><p id="6ead" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">在基本文件夹中，它看起来像:</p><ul class=""><li id="b8a6" class="nd ne iv ld b le lf lh li lk nf lo ng ls nh lw ni nj nk nl bi translated"><data source="" name="">(文件夹)</data></li><li id="e5ae" class="nd ne iv ld b le nm lh nn lk no lo np ls nq lw ni nj nk nl bi translated"><data source="" table="" name="">(文件)</data></li></ul><p id="67e1" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">在中间文件夹中，它看起来像:</p><ul class=""><li id="7527" class="nd ne iv ld b le lf lh li lk nf lo ng ls nh lw ni nj nk nl bi translated"><core model="" name="">(文件夹)</core></li><li id="e731" class="nd ne iv ld b le nm lh nn lk no lo np ls nq lw ni nj nk nl bi translated"><intermediary model="" name="">(文件)</intermediary></li></ul><p id="0331" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">最后，在mart文件夹中，它看起来像:</p><ul class=""><li id="6cdb" class="nd ne iv ld b le lf lh li lk nf lo ng ls nh lw ni nj nk nl bi translated"><core model="" name="">(档案)</core></li></ul><h2 id="5e65" class="lx ly iv bd lz ma mb dn mc md me dp mf lk mg mh mi lo mj mk ml ls mm mn mo mp bi translated">命名规格</h2><p id="85d7" class="pw-post-body-paragraph lb lc iv ld b le mq jw lg lh mr jz lj lk ms lm ln lo mt lq lr ls mu lu lv lw io bi translated">既然我们已经讨论了文件夹结构，让我们深入实际模型的命名约定。</p><p id="6aa6" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">dbt团队建议在您的模型名称中使用前缀。根据模型的类型，您应该遵循以下格式:</p><blockquote class="nr"><p id="067f" class="ns nt iv bd nu nv nw nx ny nz oa lw dk translated"><dbt folder="" name="" type=""> _ <model name=""/></dbt></p></blockquote><p id="ecc2" class="pw-post-body-paragraph lb lc iv ld b le ob jw lg lh oc jz lj lk od lm ln lo oe lq lr ls of lu lv lw io bi translated"><strong class="ld iw">暂存/基本型号</strong></p><p id="c69b" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">Dbt建议遵循格式<em class="og"> stg_ &lt;源&gt; _ &lt;对象&gt;。用于所有暂存模型的sql </em>。就我个人而言，我发现在我们的基本模型中，给每个模型添加一个base前缀是非常多余的，并且会使模型名变得很长。</p><p id="8926" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">而是按照格式<em class="og"> &lt;来源&gt; _ &lt;对象&gt;。基本模型的sql </em>。因为它们都被组织在基本文件夹下，所以从来没有混淆过。</p><p id="7994" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">在这种情况下，Source是数据源，如脸书、Shopify、谷歌广告或Snapchat。对象是SQL文件从中读取的数据表的名称。</p><p id="b267" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><strong class="ld iw">中介模式</strong></p><p id="dd51" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">虽然dbt对于中间模型没有任何明确的命名约定，但这是我如何命名我的模型的。我发现这些是最重要的组织模型，因为它们太多了(至少当你有很多数据的时候)。</p><p id="b1cc" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">我有每个核心模型的简短版本，我用它作为中间模型的前缀。然后，按照dbt的建议，我将这些模型基于它们的功能。</p><blockquote class="nr"><p id="fe52" class="ns nt iv bd nu nv nw nx ny nz oa lw dk translated"><core model="" short="" name=""> _ <model function="">。结构化查询语言</model></core></p></blockquote><p id="0a55" class="pw-post-body-paragraph lb lc iv ld b le ob jw lg lh oc jz lj lk od lm ln lo oe lq lr ls of lu lv lw io bi translated">例如，我的一个核心模型名为<em class="og"> order_details </em>，因此它的一个中间模型名为<em class="og">order _ margins _ calculated . SQL</em>。<em class="og"> order_details </em>的简称是order，模型的功能是计算产品利润。</p><p id="b763" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><strong class="ld iw">集市型号</strong></p><p id="5974" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">Dbt对mart模型有一些不同的建议。他们建议在这些模型中使用两种前缀选项:</p><ul class=""><li id="492f" class="nd ne iv ld b le lf lh li lk nf lo ng ls nh lw ni nj nk nl bi translated"><em class="og"> fct _ &lt;动词&gt; </em></li><li id="1c7f" class="nd ne iv ld b le nm lh nn lk no lo np ls nq lw ni nj nk nl bi translated"><em class="og"> dim_ &lt;名词&gt;T28】</em></li></ul><p id="3459" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">dbt文档将<em class="og"> fct </em>表定义为“一个又高又窄的表，表示已经发生或正在发生的真实世界的流程。这些模型的核心通常是不可变的事件流:会话、交易、订单、故事、投票”。</p><p id="b329" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">相比之下，他们将<em class="og"> dim </em> tables定义为，“一张又宽又短的桌子，每一行都是一个人、一个地方或一件东西；在识别和描述组织的实体时，这是事实的最终来源。它们是可变的，尽管在慢慢变化:客户、产品、候选人、建筑、员工”。</p><p id="f4ba" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">我们没有太多关于<em class="og"> fct </em>表格的应用，但是我们确实使用<em class="og"> dim </em>表格。然而，并非我们所有的型号都属于这一类别。我们只将<em class="og"> dim </em>表用于将几个不同的表连接在一起的更基本的模型。</p><p id="3ff3" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">例如，我们有一个模型<em class="og"> dim_products </em>，它将所有与产品相关的表连接在一起。这些类型的模型使我们的分析师的工作变得容易得多，因为他们不必担心每次需要编写分析时将所有的表连接在一起。</p><p id="3005" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">我们的其他核心模型是根据它们包含的数据命名的。我发现以它们所提供的功能命名它们，并使用后缀<em class="og"> details </em>很好地解释了模型<em class="og">。</em>但这都是个人喜好！</p><h2 id="3122" class="lx ly iv bd lz ma mb dn mc md me dp mf lk mg mh mi lo mj mk ml ls mm mn mo mp bi translated">Yml源文件</h2><p id="f778" class="pw-post-body-paragraph lb lc iv ld b le mq jw lg lh mr jz lj lk ms lm ln lo mt lq lr ls mu lu lv lw io bi translated">保持dbt模型有组织的最后一个关键部分是编写yml源文件。这些包含所有与您的模型相关的文档。它们详细描述了模型名称、描述和列。</p><p id="f073" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">这些文件中的完整文档是理解您的数据和传达您构建的每个模型的价值的关键。这将成为您所有dbt模型的数据字典(字面上的意思)。确保你正确使用它！</p><p id="7f5e" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">使用命令<em class="og"> dbt docs serve将这些yml文件<a class="ae la" href="https://docs.getdbt.com/reference/commands/cmd-docs" rel="noopener ugc nofollow" target="_blank">作为dbt文档</a>提供。</em> Dbt将以创建一个完整网站的方式组织这些文件，您的文档可以在该网站上保存，并且组织中的任何人都可以轻松访问。</p><p id="8c93" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">我建议用它们所在的文件夹来命名这些yml文件。例如，如果文件位于核心文件夹中，它将被命名为<em class="og"> core.yml </em>。这个yml文件将包含核心模型的所有描述和列。</p><p id="fca0" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">当您在每个yml文件中构建模型时，请确保完整地记录您的模型。构建时包含的细节越多，将来就越容易理解模型。</p><h2 id="8c01" class="lx ly iv bd lz ma mb dn mc md me dp mf lk mg mh mi lo mj mk ml ls mm mn mo mp bi translated">结论</h2><p id="62f3" class="pw-post-body-paragraph lb lc iv ld b le mq jw lg lh mr jz lj lk ms lm ln lo mt lq lr ls mu lu lv lw io bi translated">请记住，您的dbt项目是按照您制定的约定来组织的。随着您的数据团队的成长以及多人开始访问您的模型，命名约定和文件夹结构变得越来越重要。</p><p id="2776" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">我强烈建议整理一份风格指南，详细介绍我们刚刚讨论过的所有信息。这不仅便于你将来参考，也便于你的团队参考。</p><p id="876a" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">请记住，如果您发现某些东西不工作，您可以随时更改这些东西。只是要确保在深入构建模型之前尽早这样做。当你认识到问题的时候，在问题开始的时候解决问题要比在问题已经造成太多损害的时候解决问题容易得多。</p><p id="b52b" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">快乐大厦！</p><p id="54f1" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><a class="ae la" href="https://mailchi.mp/e04817c8e57e/learn-analytics-engineering" rel="noopener ugc nofollow" target="_blank">通过订阅我的电子邮件列表，了解更多关于其他流行的现代数据堆栈工具的信息。</a></p></div></div>    
</body>
</html>