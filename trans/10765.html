<html>
<head>
<title>Python Code Formatting Made Simple With Git Pre-commit Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Git预提交挂钩简化Python代码格式化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-code-formatting-made-simple-with-git-pre-commit-hooks-9233268cdf64?source=collection_archive---------12-----------------------#2021-10-18">https://towardsdatascience.com/python-code-formatting-made-simple-with-git-pre-commit-hooks-9233268cdf64?source=collection_archive---------12-----------------------#2021-10-18</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="8aa7" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">编写每个人都会爱上的代码</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/b56ca540701b4c9fe97cf3adff4216dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8yVYlSkHn5ZFxrKD"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">使用Black、Isort和Autoflake的预提交钩子自动格式化python代码。——<a class="ae kz" href="https://unsplash.com/@thdrkqwn?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">黑暗女王</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="eb03" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Python因其优雅的语法而成为世界上最流行的编程语言。但是仅仅这样并不能保证代码清晰可读。</p><p id="89b0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Python社区已经发展到创建标准，使不同程序员创建的代码库看起来像是同一个人开发的。后来，像Black这样的包被创建来自动格式化代码库。然而，问题只解决了一半。Git <a class="ae kz" href="https://pre-commit.com/" rel="noopener ugc nofollow" target="_blank">预提交</a>钩子完成剩下的工作。</p><p id="9d78" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">什么是预提交挂钩？</p><p id="f19a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">预提交钩子是在git提交之前自动运行的有用的git脚本。如果预提交挂钩失败，git推送将被中止，并且取决于您如何设置它，您的CI软件也可能失败或根本不触发。</p><p id="8932" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，在设置提交前挂钩之前，请确保您具备以下条件。</p><ul class=""><li id="c51f" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">您需要git版本&gt; = v.0.99(您可以使用git — version检查这一点)</li><li id="a528" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">你需要安装Python(因为它是git钩子使用的语言。)</li></ul></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="a0fb" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">安装提交前挂钩</h1><p id="330b" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">您可以使用单个pip命令轻松安装预提交包。但是要将它附加到您的项目中，您还需要一个文件。</p><pre class="kk kl km kn gu no np nq nr aw ns bi"><span id="5561" class="nt ms iu np b gz nu nv l nw nx">pip install pre-commit</span></pre><p id="2570" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="ny">。pre-commit-config.yaml </em>文件包含项目所需的所有配置。您可以在这里告诉预提交在每次提交之前需要执行什么操作，并在需要时覆盖它们的默认值。</p><p id="bd4e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">以下命令将生成一个示例配置文件。</p><pre class="kk kl km kn gu no np nq nr aw ns bi"><span id="bf7a" class="nt ms iu np b gz nu nv l nw nx">pre-commit sample-config &gt; .pre-commit-config.yaml</span></pre><p id="eafb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">下面是一个示例配置，它在每次提交更改之前对requirements.txt文件进行排序。将它放在项目目录的根目录下，或者编辑使用上一步生成的目录。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure><p id="e5c2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们已经安装了预提交包，并配置了它应该如何工作。现在，我们可以使用下面的命令对这个存储库启用预提交挂钩。</p><p id="4c26" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">厉害！现在将下面的requirements.txt文件添加到您的项目中，并进行提交。请参见预提交钩子的作用。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure><p id="45c7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在提交之前，git将从存储库中下载指令，并使用需求修复模块来清理文件。生成的文件将如下所示。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="cc09" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">黑色带有预提交挂钩，可以自动格式化Python代码。</h1><p id="0cc9" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated"><a class="ae kz" href="https://github.com/psf/black" rel="noopener ugc nofollow" target="_blank"> Black </a>是一个流行的包，帮助Python开发者维护一个干净的代码库。</p><p id="2c37" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">大多数代码编辑器都有键盘快捷键，您可以将其绑定到黑色，这样您就可以随时清理代码。例如，Linux上的VSCode使用Ctrl + Shift + I，在第一次使用该快捷键时，VScode会提示使用哪个代码格式化程序。您可以选择黑色(或autopep8)来启用它。</p><p id="fc07" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是，如果按快捷键困扰你，你可以把它放在预提交钩子上。下面的代码片段可以达到这个目的。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure><p id="714e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，这比以前的设置更多。这里，除了使用黑色，我们还覆盖了它的默认值。我们使用args选项配置black来设置120个字符的最大行长度。</p><p id="c0ed" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们看看git提交钩子如何与black一起工作，Black的文档中给出了一个例子。用以下内容创建一个python文件(名称不重要，只要是. py文件即可)。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure><p id="4884" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">提交后的上述文件将如下所示。这个相比上一个更标准。它很容易阅读，代码审查人员也喜欢这样看。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="8660" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">配置预提交挂钩来查找本地存储库</h1><p id="5daf" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">有时，您希望从本地安装包运行预提交挂钩。让我们尝试使用本地安装的<a class="ae kz" href="https://github.com/PyCQA/isort" rel="noopener ugc nofollow" target="_blank"> isort包</a>来对python导入进行排序。</p><p id="0ea3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可以使用以下命令安装isort。</p><pre class="kk kl km kn gu no np nq nr aw ns bi"><span id="0f2e" class="nt ms iu np b gz nu nv l nw nx">pip install isort</span></pre><p id="bfab" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在编辑。pre-commit-config.yaml文件并插入下面的代码片段。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure><p id="bab6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要了解这一点，请创建一个包含多个导入的python文件。这里有一个样本。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure><p id="a6fa" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">提交后，相同的文件将如下所示。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="506f" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">使用Black、Isort和Autoflake预提交钩子来获得更整洁的python代码库。</h1><p id="452d" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">这是我在几乎所有项目中使用的预提交钩子模板。我们已经在这个列表中讨论了两个钩子，Black和Isort。<a class="ae kz" href="https://github.com/myint/autoflake" rel="noopener ugc nofollow" target="_blank"> Autoflake </a>是另一个有用的钩子，可以移除未使用的变量、空白和导入。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure><p id="3d04" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">由于该模板使用本地包，请确保您已经安装了它们。您可以运行下面的命令一次性安装它们，并设置对git存储库的预提交。</p><pre class="kk kl km kn gu no np nq nr aw ns bi"><span id="aaed" class="nt ms iu np b gz nu nv l nw nx">pip install isort autoflake black pre-commit<br/>pre-commit install</span></pre></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="444c" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">最后的想法</h1><p id="dc15" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">Git预提交在很多方面都是革命性的。它们主要在CI/CD管道中用于触发活动。另一个主要用例是将它们用于自动代码格式化。</p><p id="7c32" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对于不同的人来说，格式良好的代码易于阅读和理解，因为它遵循社区中共享的通用准则。Python有一个名为PEP8的标准，Black、Isort和Autoflake等工具可以帮助开发人员自动化这个标准化过程。</p><p id="4722" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然而，记住这一点并每次手动使用该工具可能会很麻烦。预提交钩子快速地把它放到代码审查清单中，并在每次提交前自动运行它。</p><p id="4759" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这篇文章中，我们讨论了如何从远程存储库和本地安装包中使用预提交钩子。</p><p id="f249" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我希望你会喜欢它。</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><blockquote class="ob oc od"><p id="8e27" class="la lb ny lc b ld le jv lf lg lh jy li oe lk ll lm of lo lp lq og ls lt lu lv in bi translated">朋友，谢谢你的阅读。看来你和我有许多共同的兴趣。 <strong class="lc iv"> <em class="iu">跟我打招呼</em> </strong> <em class="iu">上</em> <a class="ae kz" href="https://www.linkedin.com/in/thuwarakesh/" rel="noopener ugc nofollow" target="_blank"> <em class="iu">领英</em></a><em class="iu"/><a class="ae kz" href="https://twitter.com/Thuwarakesh" rel="noopener ugc nofollow" target="_blank"><em class="iu">推特</em></a><em class="iu"/><a class="ae kz" href="https://thuwarakesh.medium.com/subscribe" rel="noopener"><em class="iu">中</em> </a> <em class="iu">。我会为你打破僵局。</em></p></blockquote><p id="f202" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">还不是中等会员？请使用此链接<a class="ae kz" href="https://thuwarakesh.medium.com/membership" rel="noopener"> <strong class="lc iv">成为会员</strong> </a> <strong class="lc iv"> </strong>因为我为你免费推荐赚取佣金。</p></div></div>    
</body>
</html>