<html>
<head>
<title>An Interactive CO2 Emissions Dashboard with Plotly and Streamlit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">具有Plotly和Streamlit的交互式二氧化碳排放仪表板</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/an-interactive-co2-emissions-dashboard-with-plotly-and-streamlit-b0bd4ae80cc8?source=collection_archive---------30-----------------------#2021-12-06">https://towardsdatascience.com/an-interactive-co2-emissions-dashboard-with-plotly-and-streamlit-b0bd4ae80cc8?source=collection_archive---------30-----------------------#2021-12-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="395b" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a>，数据可视化</h2><div class=""/><div class=""><h2 id="ea02" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">借助Plotly charts和Streamlit灵活的输入、布局和主题化选项，您可以从实时数据构建一个出色的交互式数据可视化应用程序</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/25bd11f8331f8ec0886c661e2a47a026.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Z0ZieIuBVNsyFXl0AGtmA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">示例应用程序—作者图片</p></figure><p id="ec84" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">Streamlit没有最全面的用户界面组件，但它们易于使用，只要有点想象力，就可以组合出良好的效果。</p><p id="f855" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们将看看如何在Streamlit中使用主题化和各种交互式输入和布局选项，以及Plotly图表，来制作一个有吸引力的、有希望提供信息的web应用程序。</p><p id="6c8e" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">要阅读本文，您需要对Streamlit和Plotly有所了解。文章中的大部分代码会以要点的形式显示，在文章的最后还有完整代码的要点以及下载链接。</p><p id="b794" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">上面的图片可能看起来不像一个典型的Streamlit应用程序，因为你看到的大多数应用程序都是用默认的light主题制作的。这一个利用了配置工具来选择默认的黑暗主题，但是其他定制的主题也是可能的。</p><p id="6063" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">你可以看到的图表是由<a class="ae md" href="https://ourworldindata.org/" rel="noopener ugc nofollow" target="_blank"> <em class="me">我们的世界在数据</em></a>(CC BY license)中提供的定期更新数据Plotly创建的。这些图表跟踪全球二氧化碳(CO2)排放水平以及各个国家或地区(如欧盟或全世界)的人均排放量。</p><p id="b096" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">因为它们是Plotly应用程序，所以它们是交互式的，你可以用鼠标悬停在它们上面来查看更多细节。除此之外，Streamlit滑块和多种选择输入设备让您能够更好地控制显示内容。</p><p id="28db" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在下面的截图中，左边的图表显示了一张根据每个国家的二氧化碳排放水平而着色的地图。它有一个用于选择年份的滑块，当你移动滑块时，你会看到地图的颜色发生变化(随着排放量的增加，它们通常会随着时间的推移而变暗)。</p><p id="feab" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">右边的图表显示了单个国家或地区(如全球或欧盟)的人均排放量。设置了一些默认国家，但单击控件会显示一个下拉菜单，您可以在其中选择或取消选择任何有可用数据的国家。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mf"><img src="../Images/a87026bf8ffaf5fed861aaa30f54097d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vz9NlEMFW28p2pPY1rJSfA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</p></figure><p id="8f94" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">上面的截图是应用程序屏幕的上半部分，使用两列来显示图表。</p><p id="11ad" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">下半部分，如下图所示，试图通过对比两个图表来显示二氧化碳排放量的增加和全球变暖之间的相关性。它使用了三列两列用于图表，一列用于文本描述。</p><p id="6436" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">然而，为了在图表之间建立适当的分隔，在应用程序的上部和下部，在包含图表的列之间插入窄的空白列。我们很快就会看到它是如何工作的。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mg"><img src="../Images/1d4c8035793c7d4f453c5fe3c5ce2a52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VFmqxze8g8EpOD2m-gNXVQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</p></figure><p id="2b51" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">希望你现在能看到这个应用程序的样子，以及它的基本结构。那么，现在让我们来看看它是如何放在一起的。</p><h1 id="a632" class="mh mi it bd mj mk ml mm mn mo mp mq mr ki ms kj mt kl mu km mv ko mw kp mx my bi translated">获取数据</h1><p id="0e2f" class="pw-post-body-paragraph lh li it lj b lk mz kd lm ln na kg lp lq nb ls lt lu nc lw lx ly nd ma mb mc im bi translated">我们在data的Github存储库中检索来自我们世界的数据。所有OWID的数据都是在CC的许可下提供的，这意味着只要OWID有信用，它就可以按照你想要的方式使用。</p><p id="fd43" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们使用两个文件，一个是关于二氧化碳和温室气体排放的OWID数据，另一个是关于气候变化影响的OWID数据。</p><blockquote class="ne nf ng"><p id="a24a" class="lh li me lj b lk ll kd lm ln lo kg lp nh lr ls lt ni lv lw lx nj lz ma mb mc im bi translated">更新:第二个数据集似乎已经从OWID存储库中删除，因此应用程序中依赖于此的部分将不再工作。</p></blockquote><p id="807c" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">两者都是csv文件，我们把它们读入熊猫数据帧。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="a724" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如你所见，有三个函数<code class="fe nm nn no np b">get_data</code>、<code class="fe nm nn no np b">get co2_data</code>和<code class="fe nm nn no np b">get_warming_data</code>。第一个函数从url返回一个dataframe，而另外两个函数实际上设置了适当的url并从第一个函数返回dataframe结果。</p><p id="832e" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">还有两件事需要注意。</p><p id="94da" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">首先，当返回<em class="me"> warming </em>数据帧时，我们过滤数据帧，只返回那些包含小于2021年的年份并且“实体”(即国家或地区)是“世界”的行。这样做的原因是，首先我们只对changedata感兴趣，其次year列中的条目肯定不是真实的年份。老实说，我不知道他们代表什么，但他们的数字远远高于今年。所以我们忽略这些数据。</p><p id="c3ca" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">(仔细想想，<code class="fe nm nn no np b">&gt;=2021</code>可能应该更高一些，比如说<code class="fe nm nn no np b">&gt;=3000</code>，否则这款应用在今年之后就没什么用了！)</p><h2 id="613a" class="nq mi it bd mj nr ns dn mn nt nu dp mr lq nv nw mt lu nx ny mv ly nz oa mx iz bi translated">贮藏</h2><p id="14ae" class="pw-post-body-paragraph lh li it lj b lk mz kd lm ln na kg lp lq nb ls lt lu nc lw lx ly nd ma mb mc im bi translated">第二件要注意的事情是Python装饰器<code class="fe nm nn no np b">@st.cache</code>用在了每个函数上。这个装饰器确保函数的结果被缓存，并且在应用程序的生命周期中不会不必要地调用函数。</p><p id="1887" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这样做的原因是，每次进行更改时，Streamlit应用程序都会完整地从上到下运行。因此，在我们的应用程序中，移动滑块或选择一个新的国家将导致应用程序重新运行。我们使用的数据不会经常更改，因此为了获得最佳性能，我们希望避免每次更改时都下载数据，而是使用之前缓存的数据。</p><p id="449d" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果我们要使用变化非常快的数据，比如股票行情，那么缓存数据是不合适的，因为我们会错过应用程序运行期间的更新。但其后果将是应用程序运行得更慢。</p><h1 id="fdc0" class="mh mi it bd mj mk ml mm mn mo mp mq mr ki ms kj mt kl mu km mv ko mw kp mx my bi translated">布局</h1><p id="ea2d" class="pw-post-body-paragraph lh li it lj b lk mz kd lm ln na kg lp lq nb ls lt lu nc lw lx ly nd ma mb mc im bi translated">应用程序的基本布局如下所示，其中未标记的列是空白的，用作其他列之间的填充。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ob"><img src="../Images/ae899233ecf723271372a973bdc484e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*18mb_i9yKfWXBBZ-8e1iLQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</p></figure><p id="d1f2" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这是在Streamlit中实现的，如下面的代码大纲所示。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nk nl l"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">大纲代码—不用于复制！</p></figure><p id="50e8" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我使用<code class="fe nm nn no np b">with col2</code>符号，因为我认为它使代码的布局更容易理解。</p><p id="c0fa" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这里唯一需要注意的是标有<code class="fe nm nn no np b">space</code>的列。这些仅用作填充。所以，这一行代码</p><pre class="ks kt ku kv gt oc np od oe aw of bi"><span id="10cf" class="nq mi it np b gy og oh l oi oj">col2, space2, col3 = st.column((10,1,10))</span></pre><p id="9ce4" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">创建三列。最外面的两个<code class="fe nm nn no np b">col2</code>和<code class="fe nm nn no np b">col3</code>宽度相同，将包含图表，而中间的一个<code class="fe nm nn no np b">space2</code>是另外两个的十分之一，并且是空白的。这在外柱之间提供了合适的间隙。</p><h1 id="04fb" class="mh mi it bd mj mk ml mm mn mo mp mq mr ki ms kj mt kl mu km mv ko mw kp mx my bi translated">制作图表</h1><p id="ce0b" class="pw-post-body-paragraph lh li it lj b lk mz kd lm ln na kg lp lq nb ls lt lu nc lw lx ly nd ma mb mc im bi translated">这四张图表都是用Plotly制作的。第一个是在<code class="fe nm nn no np b">col2</code>中，但是这里我们从滑块组件开始，它允许你在1750年和2020年之间选择一年。选择的结果存储在变量<code class="fe nm nn no np b">year</code>中。</p><p id="7494" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">接下来，我们创建一个Plotly choropleth(基本上是一个带有彩色区域的地图)，其中颜色由CO2水平决定，数据帧由滑块设置的年份过滤。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="fe37" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">第二张图是一个折线图，每个国家一张，显示了该国一段时间内的人均二氧化碳排放量。我们再次从输入控件开始，这次是多选框。默认国家名称列表与唯一的国家列表一起设置。除非选择了其他国家，否则multiselect控件将返回一组默认值。</p><p id="e364" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">然后，选定的国家用于设置图表上线条的颜色。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="44d8" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">最终的图表很简单，不需要输入控件。第一个是全球海洋温度随时间变化的散点图。在此基础上，使用lowess平滑绘制趋势线。</p><p id="3495" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">第二张图表是全球排放量的折线图。</p><p id="8303" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">将平滑线放在第一个图表上的想法是为了让你看到它与排放线有多相似，从而试图显示两个测量值之间的相关性。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h1 id="ce38" class="mh mi it bd mj mk ml mm mn mo mp mq mr ki ms kj mt kl mu km mv ko mw kp mx my bi translated">黑暗主题</h1><p id="8014" class="pw-post-body-paragraph lh li it lj b lk mz kd lm ln na kg lp lq nb ls lt lu nc lw lx ly nd ma mb mc im bi translated">在Streamlit中你可以做很多主题化的工作，但是要简单地启用<em class="me">黑暗模式</em>你只需要在你的工作文件夹中创建一个名为<code class="fe nm nn no np b">.streamlit</code>的文件夹，并在其中放一个名为<code class="fe nm nn no np b">config.toml</code>的文件。在<code class="fe nm nn no np b">config.toml </code>文件中输入以下代码。</p><pre class="ks kt ku kv gt oc np od oe aw of bi"><span id="820e" class="nq mi it np b gy og oh l oi oj">[theme]<br/>base = "dark"</span></pre><p id="bb66" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">现在，下次你运行你的应用程序时，它将处于黑暗模式！</p><p id="d64e" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果你想创建一个自定义的主题，其他的主题设置会放在同一个文件中，但是我们现在就把它放在这里。</p><h1 id="e692" class="mh mi it bd mj mk ml mm mn mo mp mq mr ki ms kj mt kl mu km mv ko mw kp mx my bi translated">就这些了</h1><p id="e5b8" class="pw-post-body-paragraph lh li it lj b lk mz kd lm ln na kg lp lq nb ls lt lu nc lw lx ly nd ma mb mc im bi translated">我希望从编码的角度来看这是有用的，但是我们也可以从这里展示的数据中学到一些东西。</p><p id="3aad" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果你想试验代码，下面有完整代码的要点，或者你可以从我的<a class="ae md" href="https://alanjones2.github.io/Alan-Jones-article-code/" rel="noopener ugc nofollow" target="_blank"> Github库</a>下载(向下滚动直到你看到文章的标题——链接会在那里)。</p><p id="fde0" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这里有一个这个应用<a class="ae md" href="http://ajco2.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">的现场版</a>。</p></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><p id="c2ae" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">一如既往地感谢阅读，如果你想知道我什么时候发表新文章，请考虑在这里<a class="ae md" href="https://alan-jones.medium.com/subscribe" rel="noopener">注册一个电子邮件提醒</a>。我也偶尔在<a class="ae md" href="https://technofile.substack.com/" rel="noopener ugc nofollow" target="_blank">子栈</a>上发布免费的时事通讯。请在下面留下任何评论，或者您可以通过<a class="ae md" href="https://www.linkedin.com/in/alan-jones-032699100" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或<a class="ae md" href="https://twitter.com/MrAlanJones" rel="noopener ugc nofollow" target="_blank"> Twitter </a>联系。</p><h2 id="aa0f" class="nq mi it bd mj nr ns dn mn nt nu dp mr lq nv nw mt lu nx ny mv ly nz oa mx iz bi translated">完全码</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nk nl l"/></div></figure><div class="or os gp gr ot ou"><a href="https://alanjones2.github.io/" rel="noopener  ugc nofollow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd jd gy z fp oz fr fs pa fu fw jc bi translated">AlanJones:编码、科学和技术</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">我为数据可视化和类似的主题撰写文章、实践教程和应用程序——大部分是用Python写的(参见一些……</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">alanjones2.github.io</p></div></div><div class="pd l"><div class="pe l pf pg ph pd pi lb ou"/></div></div></a></div></div></div>    
</body>
</html>