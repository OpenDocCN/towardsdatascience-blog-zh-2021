<html>
<head>
<title>From Messy to Neat with Python Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从凌乱到整洁与蟒蛇熊猫</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/from-messy-to-neat-with-python-pandas-91bc98b95d7f?source=collection_archive---------19-----------------------#2021-03-18">https://towardsdatascience.com/from-messy-to-neat-with-python-pandas-91bc98b95d7f?source=collection_archive---------19-----------------------#2021-03-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5e33" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">实用教程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f01519ada38fb7013d5763aa8b6d70d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Vwe5KVOHHzc-7l366B5gA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@erol?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Erol Ahmed </a>在Unsplash上拍摄</p></figure><p id="531f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现实生活中的数据通常是混乱的。它不是最吸引人的分析格式。项目的大量时间花费在数据争论上。</p><p id="685e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只有在数据采用适当的格式后，我们才能开始数据分析并推断出有意义的见解。幸运的是，Pandas提供了许多功能和技术来加速数据清理过程。</p><p id="aa5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将采用一个关于肥胖率的<a class="ae ky" href="https://www.kaggle.com/amanarora/obesity-among-adults-by-country-19752016" rel="noopener ugc nofollow" target="_blank">数据集</a>，它看起来杂乱无章，但我们将把它转换成一个漂亮而干净的格式。每一步都涉及不同的熊猫功能，所以它也像一个实用教程。</p><p id="c3a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从导入库和读取数据集开始。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="b4ec" class="ma mb it lw b gy mc md l me mf">import numpy as np<br/>import pandas as pd</span><span id="376d" class="ma mb it lw b gy mg md l me mf">df = pd.read_csv("/content/data.csv")</span><span id="00fb" class="ma mb it lw b gy mg md l me mf">df.shape<br/>(198, 127)</span></pre><p id="ba0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据集包含198行和127列。下面是前5行和前5列的屏幕截图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/4ed5661f394221908420a1e6dc638745.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kukOaxtKNl31TlTJQaveqw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="9e7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了前3行，各列包含1975年至2016年的肥胖率。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="9de8" class="ma mb it lw b gy mc md l me mf">df.columns[-5:]  # last 5 columns</span><span id="1d29" class="ma mb it lw b gy mg md l me mf">Index(['1976.1', '1976.2', '1975', '1975.1', '1975.2'], dtype='object')</span></pre><p id="0e83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">前3行似乎与后面的行不一致。让我们检查这些行中的值。unique函数返回行或列中的唯一值。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="9db8" class="ma mb it lw b gy mc md l me mf"># First row<br/>df.iloc[0,:].unique()</span><span id="e090" class="ma mb it lw b gy mg md l me mf">array([nan,        'Prevalence of obesity among adults, BMI &amp;GreaterEqual; 30 (age-standardized estimate) (%)'],       dtype=object)<br/></span><span id="da44" class="ma mb it lw b gy mg md l me mf"># Second row<br/>df.iloc[1,:].unique()</span><span id="29f7" class="ma mb it lw b gy mg md l me mf">array([nan, '18+  years'], dtype=object)</span></pre><p id="7565" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">前两行似乎定义了整个数据集，而不是单独的列。前2行中只有一个唯一值和一个NaN值，因此我们可以删除它们。</p><p id="6a47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">drop函数可用于根据轴参数值删除行或列。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="18b2" class="ma mb it lw b gy mc md l me mf">df.drop([0,1], axis=0, inplace=True)</span></pre><p id="a55c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们通过传递相关联的标签来指定要删除的行。inplace参数用于保存数据帧中的更改。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="1e02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每年有3栏，包含男性、女性的肥胖率以及两者的平均值。由于我们可以很容易地从男性和女性值中获得平均值，因此最好删除指示平均值的列。</p><p id="b3cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一种方法是将一个列列表传递给dropped。这是一种单调乏味的方式，因为要删除42列。Pandas提供了一个更实用的方法，允许我们从列表中选择每三个项目。</p><p id="7360" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">df.columns方法返回列的索引。我们可以从索引1开始选择每隔三个项目，如下所示:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4b4f" class="ma mb it lw b gy mc md l me mf">df.columns[1::3]<br/>Index(['2016', '2015', '2014', '2013', '2012', '2011', '2010', '2009', '2008', '2007', '2006', '2005', '2004', '2003', '2002', '2001', '2000', '1999', '1998', '1997', '1996', '1995', '1994', '1993', '1992', '1991', '1990', '1989', '1988', '1987', '1986', '1985', '1984', '1983', '1982', '1981','1980', '1979', '1978', '1977', '1976', '1975'],       <br/>dtype='object')</span></pre><p id="6e0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以将这个列表传递给drop函数。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ef3f" class="ma mb it lw b gy mc md l me mf">df.drop(df.columns[1::3], axis=1, inplace=True)</span></pre></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="5e38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是数据帧现在的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/a966fc5503dcc84845609b5045c209d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YEDxVnOl8vfKuyU2pYe-ag.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="e666" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经知道1代表男性，2代表女性。因此，我们可以将第一列重命名为“Country ”,并删除第一行。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="eda3" class="ma mb it lw b gy mc md l me mf">df.rename(columns={'Unnamed: 0': 'Country'}, inplace=True)</span><span id="9147" class="ma mb it lw b gy mg md l me mf">df.drop([2], axis=0, inplace=True)</span></pre><p id="9e29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据集是宽格式的。用长格式进行分析会更容易，在长格式中，年份用一列表示，而不是用单独的列表示。</p><p id="c663" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">融化功能就是为了这个任务。下面是我们如何将这个数据帧从宽格式转换成长格式。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1151" class="ma mb it lw b gy mc md l me mf">df = df.melt(<br/>   id_vars='Country', var_name='Year', value_name='ObesityRate'<br/>)</span><span id="e67a" class="ma mb it lw b gy mg md l me mf">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/3a54990f604a9f7ee821039ec4132609.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*twXXuPBThX7gueX_yQIa1A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="b873" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个年份-国家组合在单独的行中表示。</p><p id="484d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">肥胖率栏包括平均值和值范围。我们需要把它们分开，用数字来表示。例如，我们可以有三列，分别是平均值、下限和上限。</p><p id="8094" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">str访问器下的函数可用于提取下限和上限。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="64ea" class="ma mb it lw b gy mc md l me mf">df['AvgObesityRate'] = df.ObesityRate.str.split(' ', expand=True)[0]</span><span id="5acd" class="ma mb it lw b gy mg md l me mf">df['LowerLimit'] = df.ObesityRate.str.split(' ', expand=True)[1].str.split('-', expand=True)[0].str[1:]</span><span id="ef46" class="ma mb it lw b gy mg md l me mf">df['UpperLimit'] = df.ObesityRate.str.split(' ', expand=True)[1].str.split('-', expand=True)[1].str[:-1]</span></pre><p id="ecbc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先在分隔范围和平均值的空间字符处分割肥胖率列。然后，我们在“-”字符处分割范围，并使用索引来提取极限值。</p><p id="0b99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以删除肥胖率列，因为我们已经提取了每条信息。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="9404" class="ma mb it lw b gy mc md l me mf">df.drop('ObesityRate', axis=1, inplace=True)</span><span id="8a82" class="ma mb it lw b gy mg md l me mf">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/bf5e5a1f14bd63ae135580c3d4de4b86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ux_ME11QAWjsMiC7u1wvBg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="f215" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一步是添加性别信息。在当前格式中，年份列表示性别(1表示男性，2表示女性)。我们可以从年份中分离出1和2，并相应地替换它们。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="cbcf" class="ma mb it lw b gy mc md l me mf">df['Gender'] = df['Year'].str.split('.', expand=True)[1].replace({'1': 'Male', '2': 'Female'})</span><span id="da03" class="ma mb it lw b gy mg md l me mf">df['Year'] = df['Year'].str.split('.', expand=True)[0]</span></pre><p id="1d20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经像上一步一样使用了split函数。在replace函数中使用字典可以一次替换多个值。</p><p id="b16e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是数据集的最终版本:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/3ead4a848651083e99a03d4d820f3f47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2GpRTlQx731t6I62urfk-Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="2a3e" class="ma mb it bd mq mr ms dn mt mu mv dp mw li mx my mz lm na nb nc lq nd ne nf ng bi translated">结论</h2><p id="2b8b" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">我们将一个混乱格式的数据集转换成一个整洁干净的格式。数据集中的信息保持不变，但格式对于执行高效的数据分析至关重要。</p><p id="7964" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas是一个数据操作和数据分析库。在本文中，我们主要关注数据操作部分。熊猫灵活多样的功能加速了数据争论的过程。</p><p id="e500" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>