<html>
<head>
<title>How to Use GETDATE() for Reports</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在报告中使用GETDATE()</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-use-getdate-for-reports-d8cdc504a261?source=collection_archive---------33-----------------------#2021-08-28">https://towardsdatascience.com/how-to-use-getdate-for-reports-d8cdc504a261?source=collection_archive---------33-----------------------#2021-08-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b4e5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">不再需要手动调节！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e26c5a210ca1663a3ede09c712b039f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BH7IgWuH7yu9Lt_XD5e-7Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由Manavita S via Unsplash拍摄</p></figure><blockquote class="ky kz la"><p id="b3fc" class="lb lc ld le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">只需复制并粘贴这个查询，转到WHERE子句，将其更改为上周，然后运行它。这很简单！”—一些你可能认识的人</p></blockquote><p id="50d2" class="pw-post-body-paragraph lb lc it le b lf lg ju lh li lj jx lk ly lm ln lo lz lq lr ls ma lu lv lw lx im bi translated">每天/每周/每月手动更改查询中的值可能会非常痛苦。这也为人为错误打开了大门。我们将回顾SQL的GETDATE()函数的强大功能，如何将它包含在查询中(例如，也许您有一个总是上周数据的报告)，以及非常重要的是，如何避免日期/周范围的一些问题。</p><h1 id="de0d" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">这东西到底有什么用？</h1><p id="ba48" class="pw-post-body-paragraph lb lc it le b lf mt ju lh li mu jx lk ly mv ln lo lz mw lr ls ma mx lv lw lx im bi translated">和所有工具一样，理解一个函数的作用是非常有帮助的。今天的日期是2021年8月27日。让我们看看运行一个GETDATE会给我们带来什么(格式为' yyyy-MM-dd '):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi my"><img src="../Images/baa432b26e09476852ff86528bb5e53b.png" data-original-src="https://miro.medium.com/v2/resize:fit:396/format:webp/1*JpreTgRWiPhiJi7ZSr3fxg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片</p></figure><p id="1373" class="pw-post-body-paragraph lb lc it le b lf lg ju lh li lj jx lk ly lm ln lo lz lq lr ls ma lu lv lw lx im bi translated">它会得到执行的日期。当你在《第六感》中发现布鲁斯·威利斯一直都死了的时候，你可能不会有那种惊天动地的震惊……但也很接近了。</p><h1 id="d769" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">自动化上周的报告</h1><p id="da14" class="pw-post-body-paragraph lb lc it le b lf mt ju lh li mu jx lk ly mv ln lo lz mw lr ls ma mx lv lw lx im bi translated">因此，假设您每周一都有需要提取的数据。该报告只包括前一周的数据。不包括上周或部分当前周之前的周。</p><p id="2567" class="pw-post-body-paragraph lb lc it le b lf lg ju lh li lj jx lk ly lm ln lo lz lq lr ls ma lu lv lw lx im bi translated">为此，你需要一些日历表。在其中，理想情况下，您将拥有一个一年一周的组合列。请在年和周之间包含某种分隔符。如果你的公司还没有这个，我假设你正在你自己的电脑/手机上阅读这篇文章，因为你的公司可能还没有电脑。</p><p id="d66f" class="pw-post-body-paragraph lb lc it le b lf lg ju lh li lj jx lk ly lm ln lo lz lq lr ls ma lu lv lw lx im bi translated">现在，很明显，查看今天的日期不会给出我们所说的上周的信息。让我们来看一个表格，其中包含本周和上周的“日历日期”和“年份周”列。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/a67347a0b17b88c676466f8dc284c2cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:590/format:webp/1*75kDF0EBfH9DYezT26cqgQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片</p></figure><h1 id="9320" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">GETDATE() — 7？</h1><p id="0a83" class="pw-post-body-paragraph lb lc it le b lf mt ju lh li mu jx lk ly mv ln lo lz mw lr ls ma mx lv lw lx im bi translated">您可能习惯于使用DATEADD函数，其中一个参数是数字，另一个参数是间隔类型(年、日等)。).当使用GETDATE时，你可以简单地说“-7”来获得一周前的日期。现在让我们看看当我们从“calendar_table”中选择GETDATE()和GETDATE( ) — 7时会得到什么。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/a38d14d44f4f36233c48742cd33c51d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*NXhokwX921YdAiNc4IK5qg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片</p></figure><p id="8a1b" class="pw-post-body-paragraph lb lc it le b lf lg ju lh li lj jx lk ly lm ln lo lz lq lr ls ma lu lv lw lx im bi translated">假设我们在星期一运行它。在本例中，我们可以选择2021–08–16作为上周的星期一，并提取“year_week”等于“calendar_table”中的值的所有数据，在本例中也是“2021–33”。如果我们在周日运行，上周周日的“year_week”将是我们要使用的变量，仍然是“2021–33”。周六也可以。你明白了。事情正在好转。</p><blockquote class="ky kz la"><p id="6ecf" class="lb lc ld le b lf lg ju lh li lj jx lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们在赚钱，恰恰，恰，恰。我们在赚钱，恰恰，恰，恰。我们在赚钱，恰恰，恰，恰。恰恰，恰，恰，恰，恰，恰，恰，正！—帕梅拉·普金</p></blockquote><h1 id="ee92" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">齐心协力</h1><p id="057d" class="pw-post-body-paragraph lb lc it le b lf mt ju lh li mu jx lk ly mv ln lo lz mw lr ls ma mx lv lw lx im bi translated">有多种方法可以做到这一点。我们可以使用子查询来选择“year_week ”,并将该子查询放在WHERE子句中。我们可以将需要的日期内联。我们甚至可以创建一个变量来存放这个值。</p><p id="e334" class="pw-post-body-paragraph lb lc it le b lf lg ju lh li lj jx lk ly lm ln lo lz lq lr ls ma lu lv lw lx im bi translated">对于这个例子，我推荐使用变量route，因为当您开始进入更多的临时表、CTE或子查询以引入多个表时，命名一个变量并将其包含在每个表的WHERE子句中可以节省时间。从长远来看，它还减少了代码行数。</p><p id="6a0e" class="pw-post-body-paragraph lb lc it le b lf lg ju lh li lj jx lk ly lm ln lo lz lq lr ls ma lu lv lw lx im bi translated">现在我们有了“daily_sales”表，我们只想提取上周的行。下面是结果，后面是代码，最后是使用“year_flag”列的有用信息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/404c97b29f54b689638322a0c92db2e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*-ZzaRBz9urjpSt_XYC54fg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="3d36" class="pw-post-body-paragraph lb lc it le b lf lg ju lh li lj jx lk ly lm ln lo lz lq lr ls ma lu lv lw lx im bi translated">注意，例如，如果我们想要包含一个滚动的6周期间，我们可以创建两个变量。另一个变量可以设置为GETDATE之前的不同天数。然后，我们可以在两个“year_week”值之间提取行。</p><h1 id="5efd" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">为什么前导零很重要？</h1><p id="b2c0" class="pw-post-body-paragraph lb lc it le b lf mt ju lh li mu jx lk ly mv ln lo lz mw lr ls ma mx lv lw lx im bi translated">当创建这个“year_week”列时，非常需要使用一个前导0来表示一位数的周。本质上，这些值将像字母一样被读取，0 =A，1 = B，等等。按字母顺序思考这个问题，我们可以看到如果没有前导0，拉取和排序结果会是什么样子。在本例中，我们提取了“2021–1”和“2021–3”之间的值。</p><p id="51d5" class="pw-post-body-paragraph lb lc it le b lf lg ju lh li lj jx lk ly lm ln lo lz lq lr ls ma lu lv lw lx im bi translated">请注意，第10周、第105周(只是为了展示)、第11周和第12周都包括在内。在我们的“日历表”中，我们只有第1–12周(加上105周)。不包括13周以上。如果是这样的话，10到29之间的所有星期都会出现。第30周不会出现，因为那是D后面的DA。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/67528a8eced16603867a156f6694fc32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*4h4MkkaINReNS5PZmsQQNA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片</p></figure><p id="747e" class="pw-post-body-paragraph lb lc it le b lf lg ju lh li lj jx lk ly lm ln lo lz lq lr ls ma lu lv lw lx im bi translated">在本例中，我们可以看到，如果我们按“year_week”或“year_week_alpha”排序，我们会得到相同的结果。</p><h1 id="4578" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">天空是无限的！</h1><p id="b6c0" class="pw-post-body-paragraph lb lc it le b lf mt ju lh li mu jx lk ly mv ln lo lz mw lr ls ma mx lv lw lx im bi translated">我们不仅限于按天或按周划分范围。我们可以发挥创意，使用季度或年度。我们可以设置像年初至今这样的事情。</p><p id="aff1" class="pw-post-body-paragraph lb lc it le b lf lg ju lh li lj jx lk ly lm ln lo lz lq lr ls ma lu lv lw lx im bi translated">我们甚至可以使用一些规则，比如“总是在输出中包括至少10周(如果需要的话，返回到上一年)，但是在新的一年的第10周之后，然后包括本年度的所有周并删除去年的周”。当新的一年开始，人们不希望在Power BI报告中看到可视化的一周的数据时，类似这样的东西会很有帮助。</p><p id="cc50" class="pw-post-body-paragraph lb lc it le b lf lg ju lh li lj jx lk ly lm ln lo lz lq lr ls ma lu lv lw lx im bi translated">关于连接和联合的更多信息，请查看这篇更详细的文章。一如既往，有趣的可视化和超级爸爸笑话包括在内。</p><h1 id="48f2" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">最后的想法</h1><p id="933e" class="pw-post-body-paragraph lb lc it le b lf mt ju lh li mu jx lk ly mv ln lo lz mw lr ls ma mx lv lw lx im bi translated">SQL是一个强大的工具，它让生活变得更加简单。如果使用得当，它可以节省大量时间。当使用常规查询时，GETDATE()函数是一个包裹在温暖的小狗模糊闪光云中的祝福。</p><p id="812c" class="pw-post-body-paragraph lb lc it le b lf lg ju lh li lj jx lk ly lm ln lo lz lq lr ls ma lu lv lw lx im bi translated">这是我们今天的课。一如既往，继续学习！</p></div></div>    
</body>
</html>