<html>
<head>
<title>Deploying Docker Containerised ML Models on AWS Elastic Beanstalk</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 AWS 弹性豆茎上部署 Docker 集装箱 ML 模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploying-docker-containerised-ml-models-on-aws-elastic-beanstalk-67cbfbb2def4?source=collection_archive---------6-----------------------#2021-12-24">https://towardsdatascience.com/deploying-docker-containerised-ml-models-on-aws-elastic-beanstalk-67cbfbb2def4?source=collection_archive---------6-----------------------#2021-12-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="57ca" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在 AWS 上为您的模型提供服务的银碟指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c5ec0f619cee9cf0db309e8c975ced46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oAJ7uFIg0gH_ytr0"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">基拉·奥德·海德在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><h1 id="eea1" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="f452" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">iPhone 照片库、亚马逊购物篮和网飞主页有什么共同点？</p><p id="26c5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir"> <em class="mp">以这样或那样的方式，这些应用程序中的每一个都与机器学习模型进行交互，以改善用户体验，并更好地服务于最终用户。</em> </strong></p><p id="6fce" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">毫无疑问，机器学习已经从根本上改变了我们今天与技术的互动方式，并将在未来几年继续如此。</p><p id="efe8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我进入数据科学世界的旅程告诉我，训练一个 ML 模型实际上只是任何 ML 解决方案的一部分。大多数数据爱好者都有能力训练一个模型，但部署该模型以使其有用则是一个完全不同的挑战。</p><p id="da8b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在本指南结束时，我将帮助你回答我无数次问自己的问题:</p><blockquote class="mq"><p id="3b7e" class="mr ms iq bd mt mu mv mw mx my mz mj dk translated">我如何部署我的机器学习模型？</p><p id="10d9" class="mr ms iq bd mt mu mv mw mx my mz mj dk translated">我如何为我的模特服务？</p></blockquote><p id="afd0" class="pw-post-body-paragraph lo lp iq lq b lr na jr lt lu nb ju lw lx nc lz ma mb nd md me mf ne mh mi mj ij bi translated">我将向您展示如何在 Docker 容器内在 AWS 上部署 ML 模型，从而帮助您迈出进入不断增长的机器学习工程领域的第一步。以下是我们将在 AWS Elastic Beanstalk 上部署模型的关键步骤。</p><ol class=""><li id="d354" class="nf ng iq lq b lr mk lu ml lx nh mb ni mf nj mj nk nl nm nn bi translated">训练随机森林分类器。</li><li id="203c" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">用 API 端点构建一个简单的 Flask 应用程序。</li><li id="21ee" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">使用 Docker 封装我们的应用程序。</li><li id="9e90" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">在 AWS elastic beanstalk 上部署容器化的应用程序。</li><li id="b2a2" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">将我们的模型作为 API。</li></ol></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><h1 id="79d7" class="kw kx iq bd ky kz oa lb lc ld ob lf lg jw oc jx li jz od ka lk kc oe kd lm ln bi translated">为什么是 AWS 弹性豆茎？</h1><p id="70d3" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">AWS Elastic Beanstalk 是您可以部署模型的许多方式之一，了解没有一种尺寸适合所有解决方案是很重要的。</p><p id="ef48" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">尽管如此，在云中部署模型时，AWS Elastic Beanstalk 提供了几个优势。</p><p id="9c61" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">首先，Elastic Beanstalk 通过消除与管理 web 服务底层基础设施相关的复杂性，使开发人员能够快速、轻松地在 web 中部署应用程序。在 Elastic Beanstalk 中，AWS 服务(如 EC2 实例、弹性负载平衡和系统健康监控)的配置和供应是自动化的。这让开发者可以专心开发。其次，Elastic Beanstalk 广泛支持许多语言，如 Java。NET、PHP、Node.js、Python、Ruby、Go 以及最重要的 Docker 容器。</p><p id="670e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">和任何技术一样，总有缺点。需要记住的一点是，您的应用程序将全天候运行。根据项目要求，应用程序的 24/7 实施可能是一项优势，也可能是一项巨大的成本负担。与 AWS Lambdas 不同，在 Elastic Beanstalk 上没有“按需”实现应用程序的选项。此外，Elastic Beanstalk 上缺少日志文件会使失败的部署难以调试，因此，开发会更加困难。</p><p id="1529" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">还在吗？那我们开始吧。</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><h1 id="4ec0" class="kw kx iq bd ky kz oa lb lc ld ob lf lg jw oc jx li jz od ka lk kc oe kd lm ln bi translated">内容</h1><ul class=""><li id="4abc" class="nf ng iq lq b lr ls lu lv lx of mb og mf oh mj oi nl nm nn bi translated">先决条件</li><li id="d69e" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj oi nl nm nn bi translated">模特培训</li><li id="39b8" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj oi nl nm nn bi translated">构建烧瓶 API</li><li id="62ab" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj oi nl nm nn bi translated">码头集装箱化</li><li id="b210" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj oi nl nm nn bi translated">测试烧瓶应用程序</li><li id="2a36" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj oi nl nm nn bi translated">设置 AWS CLI 凭据</li><li id="788c" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj oi nl nm nn bi translated">在 AWS 弹性豆茎上展开</li><li id="613f" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj oi nl nm nn bi translated">将我们的模型作为 API</li><li id="8b23" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj oi nl nm nn bi translated">AWS 资源终止</li><li id="fae1" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj oi nl nm nn bi translated">结束语</li></ul></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><h1 id="c701" class="kw kx iq bd ky kz oa lb lc ld ob lf lg jw oc jx li jz od ka lk kc oe kd lm ln bi translated">先决条件</h1><p id="aed7" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在继续前进之前，您需要满足一些关键的先决条件。我们将使用相当多的工具，所以请花一些时间安装先决条件。</p><ol class=""><li id="ebc0" class="nf ng iq lq b lr mk lu ml lx nh mb ni mf nj mj nk nl nm nn bi translated">你需要一个<a class="ae kv" href="https://aws.amazon.com/free/?trk=ps_a131L0000085DtTQAU&amp;trkCampaign=acq_paid_search_brand&amp;sc_channel=ps&amp;sc_campaign=acquisition_UK&amp;sc_publisher=google&amp;sc_category=core&amp;sc_country=UK&amp;sc_geo=EMEA&amp;sc_outcome=Acquisition&amp;sc_detail=create%20aws%20account&amp;sc_content=Account_e&amp;sc_matchtype=e&amp;sc_segment=433803620870&amp;sc_medium=ACQ-P%7CPS-GO%7CBrand%7CDesktop%7CSU%7CAWS%7CCore%7CUK%7CEN%7CText&amp;s_kwcid=AL!4422!3!433803620870!e!!g!!create%20aws%20account&amp;ef_id=Cj0KCQiA5OuNBhCRARIsACgaiqUNTdHnQXzC6JwMM1j7ql2AsqnwnnibvUzn2xXgEfz-O02YoK-nzl4aAh4_EALw_wcB:G:s&amp;s_kwcid=AL!4422!3!433803620870!e!!g!!create%20aws%20account&amp;all-free-tier.sort-by=item.additionalFields.SortRank&amp;all-free-tier.sort-order=asc&amp;awsf.Free%20Tier%20Types=*all&amp;awsf.Free%20Tier%20Categories=*all" rel="noopener ugc nofollow" target="_blank"> AWS </a>账户。您可以注册免费层，该层将在注册时自动应用。</li><li id="c0df" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">导航命令行的一些技术知识。</li><li id="b3a0" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated"><a class="ae kv" href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb-cli3-install.html#eb-cli3-install.scripts" rel="noopener ugc nofollow" target="_blank"> AWS 弹性豆茎 CLI </a></li><li id="f708" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated"><a class="ae kv" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank">码头工人</a></li><li id="2032" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">Python 3.9.7</li><li id="55d3" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">VS 代码或任何您喜欢的 Python IDE。</li><li id="4c15" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">诗歌——Python 包管理工具(阅读我的<a class="ae kv" href="https://python.plainenglish.io/poetic-simplification-of-python-virtual-environments-dc2ebf12b1a4" rel="noopener ugc nofollow" target="_blank">上一篇关于诗歌入门的文章</a>)</li><li id="f8e9" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">Python 库:scikit-learn、numpy、requests、pandas、flask、joblib 和 json。您可以使用 poem 安装我当前的 python 版本，或者将<code class="fe oj ok ol om b">requirements.txt</code>文件包含在 Git 存储库中。</li><li id="12f6" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">这个项目使用的所有代码都可以在 GitHub 链接<a class="ae kv" href="https://github.com/lloydhamilton/AWS_ElasticBeanstalk_deploy" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</li></ol><pre class="kg kh ki kj gt on om oo op aw oq bi"><span id="0279" class="or kx iq om b gy os ot l ou ov">AWS_ElasticBeanstalk_deploy<br/>├── Dockerfile<br/>├── README.md<br/>├── documentation.ipynb<br/>├── models<br/>│   └── rf_clf.joblib<br/>├── poetry.lock<br/>├── pyproject.toml<br/>├── requirements.txt<br/>└── scripts<br/>    ├── eb_predict.py<br/>    ├── flask_api.py<br/>    ├── predict.py<br/>    └── train_iris_rf.py</span></pre><p id="c976" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">太好了！注册 AWS 并安装所有先决条件后，您可以继续本指南的设置部分。</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><h1 id="d2fd" class="kw kx iq bd ky kz oa lb lc ld ob lf lg jw oc jx li jz od ka lk kc oe kd lm ln bi translated">构建一个简单的 Flask API</h1><p id="6be3" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在我们都设置好了，让我们开始编码。总的来说，下面是我们将在 AWS 上部署模型的步骤。</p><ol class=""><li id="5b1e" class="nf ng iq lq b lr mk lu ml lx nh mb ni mf nj mj nk nl nm nn bi translated">训练随机森林分类器。</li><li id="c8d4" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">用暴露的 API 端点构建一个简单的 Flask 应用程序。</li><li id="3357" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">使用 Docker 容器封装我们的应用程序。</li><li id="81ec" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">在 AWS Elastic Beanstalk 上部署容器化的应用程序。</li><li id="d51c" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">将我们的模型作为 API。</li></ol><p id="4725" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir"> 1。模特培训</strong></p><p id="e972" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们用 Iris 数据集训练一个非常简单的 RandomForest 分类器，并用 Flask API 为它服务。</p><p id="3d29" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们将使用 sklearn python 库来加载 Iris 数据集并训练我们的模型。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="f554" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">模型将用<code class="fe oj ok ol om b">joblib</code>序列化并保存在模型文件夹中，该文件夹可在 Flask 应用程序中调用。</p><h2 id="8ab3" class="or kx iq bd ky oy oz dn lc pa pb dp lg lx pc pd li mb pe pf lk mf pg ph lm pi bi translated">2.构建一个 Flask API</h2><p id="9af5" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">接下来，让我们构建一个带有<code class="fe oj ok ol om b">/predict</code>端点的 Flask API 应用程序。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="0b6c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如下面的主代码块所示，<code class="fe oj ok ol om b">/predict</code>端点将执行<code class="fe oj ok ol om b">predict_endpoint()</code>函数，该函数调用随机森林模型并返回预测作为响应。更详细地说，<code class="fe oj ok ol om b">predict_endpoint()</code>函数将一个<code class="fe oj ok ol om b">json</code>对象解析成一个<code class="fe oj ok ol om b">numpy</code>数组，进行预测，并将响应作为<code class="fe oj ok ol om b">json</code>返回。</p><pre class="kg kh ki kj gt on om oo op aw oq bi"><span id="ca88" class="or kx iq om b gy os ot l ou ov">@app.route('/predict', methods=['POST'])<br/>def predict_endpoint():    <br/>   test_data = request.get_json()    <br/>   test_data = np.array(test_data)    <br/>   predictions = model.predict(test_data)    <br/>   response = json.dumps(predictions.tolist())    <br/>   return Response(response, <br/>                   status=200,    <br/>                   mimetype="application/json")</span></pre><p id="fbd8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在 Flask app 初始化之前，执行<code class="fe oj ok ol om b">if __name__ == ‘__main__':</code>块中的代码。因此，加载序列化模型的代码将从这里的<code class="fe oj ok ol om b">model = joblib.load('rf_clf.joblib')</code>开始。</p><pre class="kg kh ki kj gt on om oo op aw oq bi"><span id="d11a" class="or kx iq om b gy os ot l ou ov">if __name__ == '__main__':<br/>   model = joblib.load('rf_clf.joblib')<br/>   app.run(host='0.0.0.0', port=8080)</span></pre><h2 id="4803" class="or kx iq bd ky oy oz dn lc pa pb dp lg lx pc pd li mb pe pf lk mf pg ph lm pi bi translated">3.码头集装箱化</h2><p id="5cec" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们将使用 Docker 封装 Flask 应用程序。使用 Docker 有很多好处。一个是跨机器维护构建环境的一致性。</p><p id="79a6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这种一致性允许您在本地机器上测试您的 containerised 化应用程序，并在 Docker 运行的任何系统上部署它，因为您知道它将完全像在本地测试时那样执行。</p><p id="e18c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我还将在 Docker 中使用诗歌来锁定包的依赖关系，以确保相同的构建在机器间得到镜像。我不会对 Docker 中的命令进行过多的详细描述，但一般来说，这些都是<code class="fe oj ok ol om b">Dockerfile</code>中列出的步骤。</p><ol class=""><li id="4439" class="nf ng iq lq b lr mk lu ml lx nh mb ni mf nj mj nk nl nm nn bi translated">从官方 Docker 映像库加载 Python:3.9。</li><li id="d6ca" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">安装诗歌(1.1.11)。</li><li id="9dd6" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">设置工作目录。</li><li id="3bdb" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">安装<code class="fe oj ok ol om b">poetry.lock</code>和<code class="fe oj ok ol om b">pyproject.toml</code>中定义的必要依赖项。</li><li id="6119" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">将必要的 Python 文件复制到 Docker 映像中。</li><li id="5e91" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">暴露端口 8080。</li><li id="dff6" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj nk nl nm nn bi translated">设置 Docker 映像初始化时要执行的入口点或文件。</li></ol><p id="15d2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir">注意:</strong> <em class="mp">要在 Docker 中实现一个工作缓存层，应该在安装完诗歌之后，添加任何其他文件之前插入</em> <code class="fe oj ok ol om b"><em class="mp">COPY poetry.lock pyproject.toml /deploy/</em></code> <em class="mp">。这确保了只有在两次构建之间发生更改时才重新安装依赖项。</em></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ow ox l"/></div></figure><h2 id="1220" class="or kx iq bd ky oy oz dn lc pa pb dp lg lx pc pd li mb pe pf lk mf pg ph lm pi bi translated">4.测试烧瓶应用程序</h2><p id="47ee" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">让我们构建应用程序的 docker 映像，并在部署之前在本地测试它。请注意此处链接的<a class="ae kv" href="https://github.com/lloydhamilton/AWS_ElasticBeanstalk_deploy" rel="noopener ugc nofollow" target="_blank">当前项目的文件夹结构。<code class="fe oj ok ol om b">Dockerfile</code>需要位于构建过程的根文件夹中。</a></p><pre class="kg kh ki kj gt on om oo op aw oq bi"><span id="6963" class="or kx iq om b gy os ot l ou ov">AWS_ElasticBeanstalk_deploy<br/>├── Dockerfile<br/>├── README.md<br/>├── documentation.ipynb<br/>├── models<br/>│   └── rf_clf.joblib<br/>├── poetry.lock<br/>├── pyproject.toml<br/>├── requirements.txt<br/>└── scripts<br/>    ├── eb_predict.py<br/>    ├── flask_api.py<br/>    ├── predict.py<br/>    └── train_iris_rf.py</span></pre><p id="63d4" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在“终端”中，导航到您的文件夹并使用描述性标签构建 docker 图像:</p><pre class="kg kh ki kj gt on om oo op aw oq bi"><span id="a45d" class="or kx iq om b gy os ot l ou ov">docker build -t flask-api:latest .</span></pre><p id="aa94" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">然后在分离模式<code class="fe oj ok ol om b">-d</code>下运行 docker 镜像，用<code class="fe oj ok ol om b">-p option</code>暴露端口<code class="fe oj ok ol om b">8080</code>。</p><pre class="kg kh ki kj gt on om oo op aw oq bi"><span id="6e1e" class="or kx iq om b gy os ot l ou ov">docker run -d -p 8080:8080 flask_api:latest</span></pre><p id="7644" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Docker 容器现在将在<code class="fe oj ok ol om b">http://localhost:8080/predict</code>上运行，我们可以通过运行<code class="fe oj ok ol om b">predict.py</code>脚本在本地调用 API 来测试。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pj"><img src="../Images/e64c10d88e9fac037b49816edbae5eae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YsFOTu-zaHzB3eJOFIfjEg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">predict.py 脚本的执行调用 localhost:8080/predict API 端点</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="e924" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">要查看正在运行的容器列表:</p><pre class="kg kh ki kj gt on om oo op aw oq bi"><span id="d72e" class="or kx iq om b gy os ot l ou ov">docker ps</span></pre><p id="0915" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">要停止容器:</p><pre class="kg kh ki kj gt on om oo op aw oq bi"><span id="8d2e" class="or kx iq om b gy os ot l ou ov">docker stop &lt;NAME_OF_CONTAINER&gt;</span></pre><h2 id="6347" class="or kx iq bd ky oy oz dn lc pa pb dp lg lx pc pd li mb pe pf lk mf pg ph lm pi bi translated">5.在 AWS ElasticBeanstalk 上部署</h2><p id="49dd" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">一旦应用程序经过 Docker 测试，在 AWS 上部署就相对简单了，我们知道它运行起来没有错误。</p><p id="f34d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">首先，我们必须在 AWS 上创建一个新用户，并在从我们的机器部署到 AWS 之前分配正确的权限。让我们一步一步来。</p><p id="2676" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir"> a) </strong>登录<a class="ae kv" href="https://aws.amazon.com/console/" rel="noopener ugc nofollow" target="_blank"> AWS 控制台</a>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/b4db16dc0f3e01f0d70385dea4345a46.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*PRNXXGtgBSGa8NjCdi6onA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">AWS 登录控制台</p></figure><p id="436d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir"> b) </strong>在你的控制台中，选择<strong class="lq ir">所有服务</strong>然后是<strong class="lq ir">安全，身份&amp;合规</strong>然后是<strong class="lq ir"> IAM。</strong></p><p id="1dc4" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir"> c) </strong>在左侧选项卡上，选择<strong class="lq ir">用户。</strong>如果您没有看到左侧选项卡，请单击左上角 AWS 徽标正下方的三个后栏。</p><p id="d128" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir"> d) </strong>选择<strong class="lq ir">添加用户</strong>并给用户一个用户名。确保选择<strong class="lq ir">访问键—编程访问</strong>复选框，然后点击<strong class="lq ir">下一步</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pl"><img src="../Images/3e255b0d1053b672a9bc906fd455216c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MBhoqjS2GtXn4cEUYAlXag.png"/></div></div></figure><p id="1b7b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir"> e) </strong>让我们给这个用户 AWS Elastic Beanstalk 资源的管理员权限。将策略<code class="fe oj ok ol om b">AdministratorAccess-AWSElasticBeanstalk</code>附加到权限列表。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pm"><img src="../Images/e740cec5d6e7448334b25b1395dde2b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U5_9S0VYXZlck1rnDnwfYw.png"/></div></div></figure><p id="93a7" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir"> f) </strong>跳过<strong class="lq ir">添加标签</strong>部分，在查看部分创建用户</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pn"><img src="../Images/0f7d005d785bc773bd5c39e91805ceda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A3zntYD30tzwcry77R27yA.png"/></div></div></figure><p id="9c07" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir"> g) </strong>创建成功后，将<strong class="lq ir">访问密钥 ID </strong>和<strong class="lq ir">秘密访问密钥</strong>复制到记事本上或下载<code class="fe oj ok ol om b">.csv</code>进行安全保存。我们需要这些键来完成 AWS Elastic Beanstalk CLI 的设置。</p><p id="a819" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在终端中，导航到项目目录，并使用以下命令初始化 Elastic Beanstalk CLI:</p><pre class="kg kh ki kj gt on om oo op aw oq bi"><span id="88f4" class="or kx iq om b gy os ot l ou ov">eb init</span></pre><p id="634b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">根据提示输入您的<strong class="lq ir">访问密钥 id </strong>和<strong class="lq ir">秘密访问密钥</strong>。这些是我在具体项目中使用的设置。根据您的位置和延迟，地区会有所不同。</p><ul class=""><li id="5165" class="nf ng iq lq b lr mk lu ml lx nh mb ni mf nj mj oi nl nm nn bi translated">默认区域:16</li><li id="0ecc" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj oi nl nm nn bi translated">选择要使用的应用程序:3[创建新应用程序]</li><li id="c5e9" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj oi nl nm nn bi translated">应用名称:flask-api</li><li id="23da" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj oi nl nm nn bi translated">码头工人:Y</li><li id="4c79" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj oi nl nm nn bi translated">选择平台分支:1 (Docker 运行在 64 位 Amazon Linux 2 上)</li><li id="15b3" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj oi nl nm nn bi translated">代码提交:n</li><li id="a8d2" class="nf ng iq lq b lr no lu np lx nq mb nr mf ns mj oi nl nm nn bi translated">宋承宪:n</li></ul><p id="2baa" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir">注意</strong> <em class="mp">:您会注意到 AWS Elastic Beanstalk CLI 已经创建了一个</em> <code class="fe oj ok ol om b"><em class="mp">.elasticbeanstalk</em></code> <em class="mp">文件夹，其中包含一个详细描述部署配置的</em> <code class="fe oj ok ol om b"><em class="mp">config.yml</em></code> <em class="mp">。</em></p><p id="e732" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">初始化后，使用以下命令在 AWS Elastic Beanstalk 上创建一个应用程序:</p><pre class="kg kh ki kj gt on om oo op aw oq bi"><span id="e55e" class="or kx iq om b gy os ot l ou ov">eb create</span></pre><p id="e2c9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">按照屏幕上出现的提示操作。对于这个项目，所有选项的默认值就足够了。</p><p id="dec1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Elastic Beanstalk 将自动处理帮助您部署项目所需的所有基础设施部署，因此您可以专注于开发代码库。它将自动创建所有必要的资源，例如启动 EC2 实例、设置负载平衡器、自动扩展组和路由以服务于您的应用程序。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi po"><img src="../Images/573286a6322a8fd2cae3a1a45bd37a78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CXLDEwBPhTYiyrqqA4l-Sg.png"/></div></div></figure><p id="4459" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">成功部署后，Elastic Beanstalk 将返回一个应用程序可用的地址。在本例中，该应用程序可在<code class="fe oj ok ol om b">http://flask-api-dev.eu-west-2.elasticbeanstalk.com</code>获得。</p><h2 id="cded" class="or kx iq bd ky oy oz dn lc pa pb dp lg lx pc pd li mb pe pf lk mf pg ph lm pi bi translated">6.将我们的模型作为 API</h2><p id="02e3" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在我们的应用程序部署在云中，我们可以像以前在本地测试应用程序时一样访问它。这次唯一的主要区别是我们将访问 API 的地址。</p><p id="ed96" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">由于该应用程序是在 Docker 容器中测试的，我们可以预期我们之前的代码会在一些小的调整后工作。用您的应用程序的网址替换网址<code class="fe oj ok ol om b"><a class="ae kv" href="http://localhost:8080/predict" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/predict</a></code>。在这种情况下，我将用<code class="fe oj ok ol om b"><a class="ae kv" href="http://flask-api-dev.eu-west-2.elasticbeanstalk.com" rel="noopener ugc nofollow" target="_blank">http://flask-api-dev.eu-west-2.elasticbeanstalk.com</a></code>代替它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pp"><img src="../Images/2f28e73b3e3b4eabf69d1d715bcbba1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YbG_31XphrT0ihz5qDl-Iw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">EB _ preview . py 脚本的执行调用预测 API 端点</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="a2f8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果一切正常，你应该会得到一个回复，上面有一个预测列表和一个准确率分数。</p><p id="179e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">恭喜🎉🎉🎉您已经成功地在云中部署了一个机器学习模型，您可以使用 API 在任何机器上访问该模型。</p><h1 id="ea97" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">AWS 资源终止</h1><p id="8197" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在项目结束时终止资源是很重要的。查看所有当前运行资源的最简单方法之一是登录您的 AWS 控制台。</p><p id="3e03" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在<strong class="lq ir">服务</strong>下选择<strong class="lq ir">弹力豆茎</strong>然后选择<strong class="lq ir">环境</strong>。您可以在这里找到目前部署在 AWS 弹性 Benstalk 上的所有活动环境。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pq"><img src="../Images/721265f562785635e040b9b6d4e80762.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uewFT9t1rYvVJeuMk6ESeg.png"/></div></div></figure><p id="c35b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">要终止，请<strong class="lq ir">选择您的环境</strong>，并在<strong class="lq ir">操作</strong>选项卡<strong class="lq ir">下选择</strong> <strong class="lq ir">终止环境</strong>。您需要通过键入环境名称进行确认。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pr"><img src="../Images/4a71d7107d51a4bb425d99c519670a15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0FwU1TFYYOmY6xRPqhBqxA.png"/></div></div></figure><p id="b2e8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">删除应用程序的过程与您希望删除应用程序的过程相似。</p><h1 id="79e6" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">结束语</h1><p id="001d" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">您如何部署您的应用程序将对开发构建周期和与维护它相关的成本有许多影响。为了最好地服务于您的模型，理解您的项目和最终用户的需求总是很重要的。AWS 弹性豆茎是众多为模型提供服务的方式之一，理解没有一种适合所有尺寸的解决方案很重要。</p><blockquote class="mq"><p id="7b3c" class="mr ms iq bd mt mu mv mw mx my mz mj dk translated">它是关于为正确的工作使用正确的工具。</p></blockquote><p id="72f3" class="pw-post-body-paragraph lo lp iq lq b lr na jr lt lu nb ju lw lx nc lz ma mb nd md me mf ne mh mi mj ij bi translated">我们在本指南中完成了一些工作。我们首先用 Iris 数据训练了一个 RandomForest 分类器，我们把它打包在一个 flashboard 应用程序中作为一个 API。接下来，我们将 flashboard 应用程序包含在 Docker 容器中，并在部署前对其进行本地测试。最后，我们在 AWS 弹性豆茎上部署了容器化的应用程序，作为一个可以通过 URL 访问的 API。</p><p id="a794" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">需要注意的是，这里所采取的在弹性豆茎上部署的步骤适用于任何 Docker 容器 web 应用程序。</p><p id="a9a7" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果你已经读完了这篇指南，我希望你已经学到了一些新的东西。更多数据科学相关内容，请务必在 Medium 和 Twitter ( <a class="ae kv" href="https://twitter.com/iLloydHamilton" rel="noopener ugc nofollow" target="_blank"> @iLloydHamilton </a>)上关注我。</p><p id="47ff" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">注意这个空间。</p></div></div>    
</body>
</html>