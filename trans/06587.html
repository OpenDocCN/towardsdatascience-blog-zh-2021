<html>
<head>
<title>Visualizing Output Of Machine Learning Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">机器学习模型的可视化输出</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualizing-output-of-machine-learning-model-9a87136ccdbf?source=collection_archive---------29-----------------------#2021-06-13">https://towardsdatascience.com/visualizing-output-of-machine-learning-model-9a87136ccdbf?source=collection_archive---------29-----------------------#2021-06-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9523" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Shap进行机器学习可视化</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7ce1ed8dc68a93785908d62617d7c918.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aok46ja4cbeGp3Aw"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@pietrozj?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Pietro Jeng </a>拍摄</p></figure><p id="8a53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">解释一个机器学习模型是一项艰巨的任务，因为我们并不真正知道这个模型在那个黑匣子里是如何工作的。需要进行解释，以便我们能够为我们的数据选择最佳模型，并使其稳健。</p><p id="1036" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Shap是一个用于解释模型的开源python库。它可以创建多种类型的可视化，帮助解释模型和解释模型是如何工作的。</p><p id="494b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将看到不同类型的机器学习模型可视化，可以使用Shap创建。</p><p id="2d0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们开始吧…</p><h1 id="c445" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">安装所需的库</h1><p id="f03c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们将从使用pip安装Shap开始。下面给出的命令可以做到这一点。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="c875" class="mx lw it mt b gy my mz l na nb">pip install shap</span></pre><h1 id="383b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">导入所需的库</h1><p id="fcd5" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在这一步中，我们将导入加载数据、创建模型以及创建该模型的可视化所需的库。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="7f0e" class="mx lw it mt b gy my mz l na nb">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import shap<br/>from sklearn.model_selection import train_test_split<br/>import xgboost as xgb</span></pre><h1 id="66b6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建模型</h1><p id="bf24" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在这一步，我们将创建机器学习模型。对于本文，我将创建一个XGBoost模型，但是您可以选择自己喜欢的任何模型。我们将在这个模型中使用的数据集是著名的糖尿病数据集，可以从Kaggle下载。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="1729" class="mx lw it mt b gy my mz l na nb">df = pd.read_csv('/content/Diabetes.csv')<br/>features = ['Pregnancies', 'Glucose','BloodPressure','SkinThickness','Insulin','BMI','DiabetesPedigreeFunction','Age']<br/>Y = df['Outcome']<br/>X =  df[features]<br/>X_train, X_test, Y_train, Y_test = train_test_split(X, Y, test_size = 0.2, random_state = 1234)<br/>xgb_model = xgb.XGBRegressor(random_state=42)<br/>xgb_model.fit(X_train, Y_train)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/4a13af0221776108b6fb3143f02c7857.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*tdVuruzmdeKIukDukKaD_Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">模型(来源:作者)</p></figure><h1 id="ba75" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建可视化</h1><p id="627b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">现在，我们将为shap创建解释器，找出模型的形状值，并使用它们创建可视化效果。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="c191" class="mx lw it mt b gy my mz l na nb">explainer = shap.Explainer(xgb_model)<br/>shap_values = explainer(X_test)</span></pre><ol class=""><li id="0f7c" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated"><strong class="lb iu">酒吧剧情</strong></li></ol><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="ddaa" class="mx lw it mt b gy my mz l na nb">shap.plots.bar(shap_values, max_display=10)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/9e1ccaa7fa280dee5f7ac9969473f18b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*HgeaDkaTtgbEu9ozJ3DwfQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">条形图形状值(来源:作者)</p></figure><p id="6642" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.<strong class="lb iu">组群图</strong></p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="570e" class="mx lw it mt b gy my mz l na nb">shap.plots.bar(shap_values.cohorts(2).abs.mean(0))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/8a611557322146a48dd66cd28c77c381.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*4g6FbiX7fwkxo2Nxi_ky8A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">群组图(来源:作者)</p></figure><p id="8e80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.<strong class="lb iu">热图</strong></p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="e892" class="mx lw it mt b gy my mz l na nb">shap.plots.heatmap(shap_values[1:100])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/6023d719248f67d124031aec222ebe5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7PBL2J-pV50uPKaUliKHEw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">热图(来源:作者)</p></figure><p id="f0a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.<strong class="lb iu">瀑布图</strong></p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="0e3f" class="mx lw it mt b gy my mz l na nb">shap.plots.waterfall(shap_values[0]) # For the first observation</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/555acf0008c7e6a2e90a8f12073992db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yeuml_ea4wUOkFFC4uqm3g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">瀑布P{lot(来源:作者)</p></figure><p id="605d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.<strong class="lb iu">力图</strong></p><p id="b2f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个情节，我们还需要初始化“js”。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="6244" class="mx lw it mt b gy my mz l na nb">shap.initjs()<br/>explainer = shap.TreeExplainer(xgb_model)<br/>shap_values = explainer.shap_values(X_test)<br/>def p(j):<br/>    return(shap.force_plot(explainer.expected_value, shap_values[j,:], X_test.iloc[j,:]))<br/>p(0)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/6c5ac99fff87c47a05d989d781a0776c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZX0yeHGbrTHjr6foT0zaMg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">力情节(来源:作者)</p></figure><p id="8560" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">6.<strong class="lb iu">决定情节</strong></p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="2ec7" class="mx lw it mt b gy my mz l na nb">shap_values = explainer.shap_values(X_test)[1]<br/>print("The expected value is ", expected_value)<br/>print("The final prediction is ", xgb_model.predict(X_test)[1])<br/>shap.decision_plot(expected_value, shap_values, X_test)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/ea697846d2a6ed038695b8b9c861f88d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*5dxTfbWkGNuC2Tb8KR4jhg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">决定情节(来源:作者)</p></figure><p id="bbe1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是如何使用Shap来创建与机器学习模型相关的可视化并分析它们。继续尝试不同的数据集和机器学习模型，并让我知道你在回复部分的评论。</p><p id="2e83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文是与<a class="ns nt ep" href="https://medium.com/u/40808d551f5a?source=post_page-----9a87136ccdbf--------------------------------" rel="noopener" target="_blank">皮尤什·英格尔</a>合作完成的。</p><h1 id="1e0b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">在你走之前</h1><p id="05a9" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><strong class="lb iu"> <em class="nu">感谢</em> </strong> <em class="nu">的阅读！如果你想与我取得联系，请随时通过hmix13@gmail.com联系我或我的</em> <a class="ae ky" href="http://www.linkedin.com/in/himanshusharmads" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> <em class="nu"> LinkedIn个人资料</em> </strong> </a> <em class="nu">。可以查看我的</em><a class="ae ky" href="https://github.com/hmix13" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="nu">Github</em></strong><em class="nu"/></a><em class="nu">简介针对不同的数据科学项目和包教程。还有，随意探索</em> <a class="ae ky" href="https://medium.com/@hmix13" rel="noopener"> <strong class="lb iu"> <em class="nu">我的简介</em> </strong> </a> <em class="nu">，阅读我写过的与数据科学相关的不同文章。</em></p></div></div>    
</body>
</html>