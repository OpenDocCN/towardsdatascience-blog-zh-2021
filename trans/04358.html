<html>
<head>
<title>How to Set up a Machine Learning Model for Legal Contract Review — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为法律合同审查建立机器学习模型—第二部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-set-up-a-machine-learning-model-for-legal-contract-review-part-2-6ecbbe680ba?source=collection_archive---------17-----------------------#2021-04-13">https://towardsdatascience.com/how-to-set-up-a-machine-learning-model-for-legal-contract-review-part-2-6ecbbe680ba?source=collection_archive---------17-----------------------#2021-04-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="871c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">克服臭名昭著的512令牌限制</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5e428abca26f2b70e4053f174d4562cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3AAUjFDrHbxE2hER"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@raphaelphotoch?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Raphael Schaller </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><h1 id="567d" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">这是怎么回事？</h1><p id="a2ce" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在<a class="ae kv" rel="noopener" target="_blank" href="/how-to-set-up-a-machine-learning-model-for-legal-contract-review-fe3b48b05a0e">之前的一篇博文</a>中，我们看了如何开始使用新发布的<a class="ae kv" href="https://github.com/TheAtticusProject/cuad/" rel="noopener ugc nofollow" target="_blank"> CUAD数据集</a>，它有助于自动化合同审查。我们加载了模型，并对一份合同的简短摘录(前100个单词)进行了第一次预测。正如文章中提到的，我们用于这项任务的NLP模型通常有512个单词的限制。这意味着我们建立的模型不能扫描整个合同的信息。相反，它只限于少于512个字的合同摘录。</p><p id="f43e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在这篇博文中，我们将看看如何克服这一限制，以便该模型可以在整个合同中搜索律师感兴趣的关键信息。</p><blockquote class="mp mq mr"><p id="dac3" class="lo lp ms lq b lr mk jr lt lu ml ju lw mt mm lz ma mu mn md me mv mo mh mi mj ij bi translated"><strong class="lq ir">边注</strong>:技术上来说，限制不是512个字，而是512个<em class="iq">令牌</em>。记号是自然语言的组成部分，因此也是NLP模型的组成部分。它们通常通过将单词分成子单词来表示:</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/2464f514491bb2f9dd9c0a8b3dda6665.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*7STRXyk81f2bO06j1_m76A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">单词“Highlight”的标记。第一个和最后一个标记是特殊的标记，用于标识文本的开始和结束。</p></figure><blockquote class="mp mq mr"><p id="089e" class="lo lp ms lq b lr mk jr lt lu ml ju lw mt mm lz ma mu mn md me mv mo mh mi mj ij bi translated">出于我们的目的，这种技术上的区别在很大程度上是不相关的，我将在本文中互换使用术语<em class="iq">令牌</em>和<em class="iq">单词</em>。</p></blockquote></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="4c3a" class="kw kx iq bd ky kz ne lb lc ld nf lf lg jw ng jx li jz nh ka lk kc ni kd lm ln bi translated">我们试图解决的问题是什么？</h1><p id="6d78" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">上次我们在合同的前100个字内搜索了一条特定的信息(合同日期)。这很有效，因为我们在512字的限制之内。但是，如果我们试图在整个合同中查找这些信息，我们将会超出这个限制。在这种情况下，我们会收到如下所示的错误消息:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/3272ea76f2f3c5683c76a9cf3332f720.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fF6ltCRVGnhWXr6_-Jg9Hw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">合同过长时的错误消息</p></figure><p id="80b9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">错误消息通知我们，合同的令牌数(7，548)超过了该模型允许的最大长度512。</p><p id="9ef5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">对于许多类似的问答(Q&amp;A)模型来说，这不是问题。这是因为这些问答对中的相关段落要么少于512个单词，要么这些段落被截断以符合单词限制，而不会丢失关键信息。这些类型的问答任务的示例可以在<a class="ae kv" href="https://rajpurkar.github.io/SQuAD-explorer/" rel="noopener ugc nofollow" target="_blank">斯坦福问答数据集(SQUAD) </a>中找到。比如<a class="ae kv" href="https://rajpurkar.github.io/SQuAD-explorer/explore/v2.0/dev/Southern_California.html" rel="noopener ugc nofollow" target="_blank">这些关于南加州的段落</a>都短于512个字。</p><h1 id="fc5f" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">一份合同有多少字？</h1><p id="4e09" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">对于法律合同，情况就大不相同了。查看CUAD数据集中包含的合同，我们发现只有3.1%的合同短于512个单词。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nk nl l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">标识有多少合同短于512个字的代码。对于CUAD数据集，这将是3.1%。</p></figure><p id="bd43" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们还可以看到，通过绘制合同长度直方图，我们将遇到大多数合同的512字限制:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/0999db66b7362cb7ae4fd38e80d464a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mezHg0_9X6w4LztxJFNVLA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">按长度划分的合同</p></figure></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="c924" class="kw kx iq bd ky kz ne lb lc ld nf lf lg jw ng jx li jz nh ka lk kc ni kd lm ln bi translated">克服512字的限制</h1><p id="68b1" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">为了克服这个限制，合同必须被分成512个单词的几个部分。然后，该模型可以单独分析每个部分，并汇总结果以得出最终预测。幸运的是，当模型在CUAD数据集中的合同上训练时，程序员们必须克服同样的挑战。这意味着，通过识别训练代码中的相关代码段，我们可以对我们的预测任务使用相同的逻辑。我已经用一个<a class="ae kv" href="https://github.com/marshmellow77/cuad-demo/blob/main/scripts/predict.py" rel="noopener ugc nofollow" target="_blank"> Python脚本</a>编译了相关的代码片段。在这一节中，我将介绍这个脚本的关键部分。</p><p id="6c56" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">将问题和契约转换成模型接受的特性的函数是一个名为<em class="ms">squad _ convert _ examples _ to _ features()的函数。</em>它的<a class="ae kv" href="https://huggingface.co/transformers/main_classes/processors.html#transformers.data.processors.squad.squad_convert_examples_to_features" rel="noopener ugc nofollow" target="_blank">文档</a>和它的<a class="ae kv" href="https://huggingface.co/transformers/_modules/transformers/data/processors/squad.html" rel="noopener ugc nofollow" target="_blank">实现</a>可以在<a class="ae kv" href="https://huggingface.co/" rel="noopener ugc nofollow" target="_blank"> Huggingface网站</a>找到。正如我们从文档中看到的，该函数将一系列问题和合同转换为模型的特性:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nk nl l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="nn">将问题和合同转换为模型的特征</em></p></figure><p id="2a86" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">然后将生成的要素加载到数据加载器中，并批量输入到模型中。该模型预测开始和结束逻辑，就像我们在第一篇博文中看到的例子一样:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nk nl l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">对合同块进行预测</p></figure><p id="e5c5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">由此产生的开始和结束逻辑适用于合同的各个部分，必须总结为一个最终的模型预测。为此，我们可以利用函数<a class="ae kv" href="https://github.com/huggingface/transformers/blob/ffe0761777a3d9dd562697a5ab1cec51f5c493d4/src/transformers/data/metrics/squad_metrics.py#L384" rel="noopener ugc nofollow" target="_blank"><em class="ms">compute _ predictions _ logits()</em></a><em class="ms">:</em></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nk nl l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">为了最终的预测，把所有的东西集合在一起</p></figure></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="fc53" class="kw kx iq bd ky kz ne lb lc ld nf lf lg jw ng jx li jz nh ka lk kc ni kd lm ln bi translated">结论</h1><p id="e059" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在这篇博文中，我们克服了合同评审NLP模型的512字限制。这很重要，因为律师在合同中寻找的关键信息可能在文件中的任何地方，正如我们所看到的，大多数合同都比512个字长得多。</p><p id="d800" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">克服这一限制的代码封装在<a class="ae kv" href="https://github.com/marshmellow77/cuad-demo/blob/main/scripts/predict.py" rel="noopener ugc nofollow" target="_blank">这个脚本</a>中。在本<a class="ae kv" href="https://github.com/marshmellow77/cuad-demo/blob/main/3_predictions.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>中可以找到一个示例，说明如何利用该脚本来回答关于<a class="ae kv" href="https://github.com/marshmellow77/cuad-demo/blob/main/output/contract.txt" rel="noopener ugc nofollow" target="_blank">样本合同</a>的CUAD数据集的所有<a class="ae kv" href="https://github.com/marshmellow77/cuad-demo/blob/main/output/questions.txt" rel="noopener ugc nofollow" target="_blank"> 41个问题</a>。该笔记本的输出包含所有41个问题和相应的模型预测。它相当长，所以我将模型预测保存在这个<a class="ae kv" href="https://github.com/marshmellow77/cuad-demo/blob/main/output/predictions.txt" rel="noopener ugc nofollow" target="_blank">文本文件</a>中，以便于查看。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/db5145f97d7293a63270e5577a81856d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pIbWeEvuiDw2rNYlcGaiOg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">前5个问题和模型预测</p></figure><p id="311f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">有了这些资源，你现在可以自己设计一个法律合同评审模型了。您可以上传一个文本格式的合同，然后运行模型来查找合同中的关键信息，就像我们在这里所做的一样。</p><p id="f6c9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在以后的博客文章中，我们将看看如何用<a class="ae kv" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>建立一个合同评审的演示网站。这将使得上传合同和使用易于使用的web界面运行模型变得更加容易，非常类似于这个例子。</p></div></div>    
</body>
</html>