<html>
<head>
<title>How to Create a Git Hook to Push to Your Server and Github Repo</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建一个Git钩子来推送到你的服务器和Github Repo</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-a-git-hook-to-push-to-your-server-and-github-repo-fe51f59122dd?source=collection_archive---------7-----------------------#2021-05-14">https://towardsdatascience.com/how-to-create-a-git-hook-to-push-to-your-server-and-github-repo-fe51f59122dd?source=collection_archive---------7-----------------------#2021-05-14</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="42ba" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">对Git推送做出反应以更新您的远程服务器</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/e61a35e98d748b8333ae3d5faa7601be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XThes_Kcz1MwG6Fv"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">蒂姆·莫斯霍尔德在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="4282" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">介绍</h1><p id="7910" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">Git挂钩是Git在提交、推送和接收之前或之后执行的脚本。设置Git挂钩使您的开发和部署变得容易。</p><p id="d29f" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">在本文中，您将学习如何创建一个在使用<code class="fe mt mu mv mw b">git push</code>命令时执行的接收后Git挂钩。</p><p id="78f6" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">我使用<code class="fe mt mu mv mw b">$</code>作为本地终端提示，使用<code class="fe mt mu mv mw b">#</code>作为远程服务器提示。同样为了简单起见，我使用<strong class="lu iv">约翰</strong>作为用户名和Github用户名，使用<strong class="lu iv">yourdomain.com</strong>作为我们的域名。</p><h1 id="0d9c" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">先决条件</h1><p id="bac1" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">在您的本地机器上已经有了一个工作的Git存储库。我们称之为<code class="fe mt mu mv mw b"><strong class="lu iv">newsletter</strong></code>。你的网站有一个Linux服务器(我用的是Ubuntu 20.04)，你可以使用ssh从你的本地计算机连接到你的远程服务器。</p><h1 id="ea2f" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">步骤1:在远程服务器上创建工作目录</h1><h2 id="d7ea" class="mx lb iu bd lc my mz dn lg na nb dp lk mb nc nd lm mf ne nf lo mj ng nh lq ni bi translated"><strong class="ak">/首页/约翰/简讯</strong></h2><p id="4490" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">我假设你<a class="ae kz" href="https://betterprogramming.pub/how-to-build-a-successful-self-hosted-email-newsletter-platform-4e2ec11eeec4#766f" rel="noopener ugc nofollow" target="_blank">保护了你的服务器</a>并且在你的服务器上设置了<a class="ae kz" href="https://betterprogramming.pub/how-to-build-a-successful-self-hosted-email-newsletter-platform-4e2ec11eeec4#94c0" rel="noopener ugc nofollow" target="_blank">防火墙</a>。您可以使用SSH连接到您的服务器。</p><p id="d07e" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">让我们连接到您的服务器:</p><pre class="kk kl km kn gu nj mw nk nl aw nm bi"><span id="0544" class="mx lb iu mw b gz nn no l np nq">$ ssh <strong class="mw iv">john@yourdomain.com<br/></strong>// or use your IP address<strong class="mw iv"><br/></strong>$ ssh john@167.99.123.45</span></pre><p id="4905" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">一旦你在远程服务器上，创建一个新的目录，时事通讯:</p><pre class="kk kl km kn gu nj mw nk nl aw nm bi"><span id="0f62" class="mx lb iu mw b gz nn no l np nq"># pwd<br/>/home/john<br/># mkdir newsletter<br/># cd newsletter</span></pre><p id="f146" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">在新目录中初始化一个空的Git存储库:</p><pre class="kk kl km kn gu nj mw nk nl aw nm bi"><span id="a8b3" class="mx lb iu mw b gz nn no l np nq"># git init --bare</span></pre><p id="9931" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">这将省略工作目录，但创建我们需要的目录和文件。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nr"><img src="../Images/7699e6ba5a170bf8b3c6e6783e858207.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/1*rNcyrfC_QpcdJm00bN9ElQ.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">git init —裸结构。图片作者。</p></figure><h2 id="cc5c" class="mx lb iu bd lc my mz dn lg na nb dp lk mb nc nd lm mf ne nf lo mj ng nh lq ni bi translated">/var/www/时事通讯/public_html</h2><p id="24d4" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">在<code class="fe mt mu mv mw b">/var/www</code>下新建一个目录。我们将把所有文件重定向到这个目录。</p><pre class="kk kl km kn gu nj mw nk nl aw nm bi"><span id="8c05" class="mx lb iu mw b gz nn no l np nq"># sudo mkdir /var/www/newsletter/public_html</span></pre><h1 id="d6eb" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">步骤2:在本地Gitrepo上设置多个远程URL</h1><p id="7cb9" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">使用<code class="fe mt mu mv mw b">git remote set-url</code>允许您设置多个Git repo URLs。</p><p id="53ce" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">使用<code class="fe mt mu mv mw b">git remote -v</code>命令找出您当前的远程配置:</p><pre class="kk kl km kn gu nj mw nk nl aw nm bi"><span id="5b33" class="mx lb iu mw b gz nn no l np nq">$ git remote -v<br/>origin git@github.com:<strong class="mw iv">john</strong>/newsletter.git (fetch)<br/>origin git@github.com:<strong class="mw iv">john</strong>/newsletter.git (push)</span></pre><p id="4381" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">让我们设置远程URL。一个用于我们的远程服务器，一个用于我们的Github repo。</p><pre class="kk kl km kn gu nj mw nk nl aw nm bi"><span id="9c99" class="mx lb iu mw b gz nn no l np nq">$ git remote set-url --add --push origin <strong class="mw iv">john</strong><a class="ae kz" href="mailto:shin@okadia.net" rel="noopener ugc nofollow" target="_blank"><strong class="mw iv">@y</strong></a><strong class="mw iv">ourdomain.com</strong>:/home/<strong class="mw iv">john</strong>/newsletter<br/>$ git remote set-url --add --push origin git@github.com:<strong class="mw iv">john</strong>/newsletter.git</span></pre><p id="73f6" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">你需要像上面一样运行两次<code class="fe mt mu mv mw b">git remote set-url</code><strong class="lu iv"/>，因为第一次运行会覆盖当前的。</p><p id="9c54" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">现在您应该有一个获取和两个推送:</p><pre class="kk kl km kn gu nj mw nk nl aw nm bi"><span id="f2e1" class="mx lb iu mw b gz nn no l np nq">$ git remote -v<br/>origin git@github.com:<strong class="mw iv">john</strong>/newsletter.git (fetch)<br/>origin <strong class="mw iv">john@yourdomain.com</strong>:/home/<strong class="mw iv">john</strong>/newslette (push)<br/>origin git@github.com:<strong class="mw iv">john</strong>/newsletter.git (push)</span></pre><h1 id="043e" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">步骤3-创建接收后文件</h1><p id="dcc6" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">在远程服务器上，创建一个文件<code class="fe mt mu mv mw b">~/newsletter/hooks/post-receive</code>。</p><pre class="kk kl km kn gu nj mw nk nl aw nm bi"><span id="8afe" class="mx lb iu mw b gz nn no l np nq"># cd ~/newsletter/hooks<br/># touch post-receive</span></pre><p id="02d7" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">添加以下内容:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ns nt l"/></div></figure><p id="edad" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">我们需要使文件可执行:</p><pre class="kk kl km kn gu nj mw nk nl aw nm bi"><span id="b1b1" class="mx lb iu mw b gz nn no l np nq"># <!-- -->chmod +x post-receive<br/># <!-- -->$ ls -Al ~/newsletter/hooks<br/>total 56<br/>-rwxrwxr-x 1 shin shin  478 Apr 24 03:07 applypatch-msg.sample<br/>-rwxrwxr-x 1 shin shin  896 Apr 24 03:07 commit-msg.sample<br/>-rwxrwxr-x 1 shin shin 3079 Apr 24 03:07 fsmonitor-watchman.sample<br/><strong class="mw iv">-rwxrwxr-x 1 shin shin  732 May  3 00:58 post-receive<br/></strong>-rwxrwxr-x 1 shin shin  189 Apr 24 03:07 post-update.sample<br/>-rwxrwxr-x 1 shin shin  424 Apr 24 03:07 pre-applypatch.sample<br/>...</span></pre><p id="a165" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated"><code class="fe mt mu mv mw b">post-receive</code>文件模式应该有<code class="fe mt mu mv mw b">-rwxrwxr-x</code>。</p><h1 id="1fc6" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">测试它</h1><p id="a1e2" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">在您的本地机器上，运行<code class="fe mt mu mv mw b">git push origin main</code>:</p><pre class="kk kl km kn gu nj mw nk nl aw nm bi"><span id="7f09" class="mx lb iu mw b gz nn no l np nq">$ git push origin main<br/>Enumerating objects: 5, done.<br/>Counting objects: 100% (5/5), done.<br/>Delta compression using up to 4 threads<br/>Compressing objects: 100% (3/3), done.<br/>Writing objects: 100% (3/3), 303 bytes | 303.00 KiB/s, done.<br/>Total 3 (delta 2), reused 0 (delta 0), pack-reused 0<br/>remote: Push received! Deploying branch: main...<br/>remote: Already on 'main'<br/>To okadia.net:/home/john/newsletter<br/>   2b35421..aa80729  main -&gt; main<br/>Enumerating objects: 5, done.<br/>Counting objects: 100% (5/5), done.<br/>Delta compression using up to 4 threads<br/>Compressing objects: 100% (3/3), done.<br/>Writing objects: 100% (3/3), 303 bytes | 303.00 KiB/s, done.<br/>Total 3 (delta 2), reused 0 (delta 0), pack-reused 0<br/>remote: Resolving deltas: 100% (2/2), completed with 2 local objects.<br/>To github.com:john/newsletter.git<br/>   2b35421..aa80729  main -&gt; main</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nu"><img src="../Images/a36bc13403b691444b6218d723aa8831.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/1*MO8AjyahpKDdGQQ54IIZ4g.gif"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">使用我的服务器的例子。图片作者。</p></figure><h1 id="00c4" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">结论</h1><p id="a495" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">Git hook，<code class="fe mt mu mv mw b">post-receive</code>，对于经常使用服务器的开发人员来说是一个非常好的工具。Git有更多的客户端和服务器端挂钩工具供您使用。开始在你的项目中使用它怎么样？</p></div><div class="ab cl nv nw hy nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="in io ip iq ir"><p id="35d1" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated"><strong class="lu iv">通过</strong> <a class="ae kz" href="https://blog.codewithshin.com/membership" rel="noopener ugc nofollow" target="_blank"> <strong class="lu iv">成为</strong> </a> <strong class="lu iv">会员，获得媒体上所有故事的访问权限。</strong></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj oc"><img src="../Images/0be3ee559fee844cb75615290e4a8b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*DjTM9iFtVc2wlcWcOms7VQ.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><a class="ae kz" href="https://blog.codewithshin.com/subscribe" rel="noopener ugc nofollow" target="_blank">https://blog.codewithshin.com/subscribe</a></p></figure><h1 id="fbda" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">资源</h1><ul class=""><li id="d411" class="od oe iu lu b lv lw ly lz mb of mf og mj oh mn oi oj ok ol bi translated"><a class="ae kz" href="https://www.git-scm.com/docs/githooks" rel="noopener ugc nofollow" target="_blank"> Githooks </a></li><li id="9e16" class="od oe iu lu b lv om ly on mb oo mf op mj oq mn oi oj ok ol bi translated"><a class="ae kz" href="https://macarthur.me/posts/deploying-code-with-a-git-hook" rel="noopener ugc nofollow" target="_blank">用Git钩子在DigitalOcean Droplet上部署代码</a></li></ul></div></div>    
</body>
</html>