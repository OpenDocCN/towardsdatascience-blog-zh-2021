<html>
<head>
<title>Level Up Your Data Visualizations with Trend Lines in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python中的趋势线提升数据可视化水平</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/level-up-your-data-visualizations-with-trend-lines-in-python-6ad4a8253d6?source=collection_archive---------8-----------------------#2021-10-01">https://towardsdatascience.com/level-up-your-data-visualizations-with-trend-lines-in-python-6ad4a8253d6?source=collection_archive---------8-----------------------#2021-10-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="9b7a" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">大蟒</h2><div class=""/><div class=""><h2 id="0bbd" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用Plotly库轻松可视化数据趋势</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/98430531ef78cbb05f0d37521e00535d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IhUudnmzAt-YHmagCnEGYw.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">我才华横溢的姐姐的作品</p></figure><p id="eee1" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">数据可视化是数据分析的关键部分。与只看表格上的数字相比，可视化数据使人们更容易理解数据集中的趋势。其中一部分包括选择正确的图表类型，以搭配您试图展示的正确数据类型，比如对时间序列数据使用折线图。</p><p id="6729" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">除此之外，您还可以添加一些修饰性的更改，如颜色和字体，使重要的数据点突出。此外，趋势线有助于清晰地勾勒出数据集在其所有数据点上的大致方向。您还可以实现静态趋势线，使您选择的值成为图表上的水平线或垂直线，以便轻松查看数据集中的值是高于还是低于静态线。</p><p id="a534" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在本文中，我们将看看如何使用Python中的Plotly库实现两种形式的趋势线，以实现数据可视化。我们还将使用Pandas进行一些初始数据预处理，所以请确保您已经安装了这两个包。然后，导入以下内容，并准备好跟随！</p><pre class="ks kt ku kv gt md me mf mg aw mh bi"><span id="7caf" class="mi mj it me b gy mk ml l mm mn">import pandas as pd<br/>import plotly.express as px<br/>import random</span></pre><p id="1d65" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们开始吧！</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="da8a" class="mv mj it bd mw mx my mz na nb nc nd ne ki nf kj ng kl nh km ni ko nj kp nk nl bi translated">使用Plotly创建带有平均趋势线的折线图</h1><p id="43ab" class="pw-post-body-paragraph lh li it lj b lk nm kd lm ln nn kg lp lq no ls lt lu np lw lx ly nq ma mb mc im bi translated">让我们首先生成一些样本数据。为此，请运行以下代码。</p><pre class="ks kt ku kv gt md me mf mg aw mh bi"><span id="bb40" class="mi mj it me b gy mk ml l mm mn">expense_data = {<br/>    "Person": random.choices(["A", "B"], k=20),<br/>    "Amount": random.sample(range(100, 200), 10) + random.sample(range(0, 99), 10),<br/>    "Category": ["Groceries"] * 10 + ["Restaurant"] * 10,<br/>    "Date": pd.to_datetime(pd.date_range('2020-01-01','2020-10-01', freq='MS').tolist() * 2)<br/>}<br/>df = pd.DataFrame(data=expense_data)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/2fa143f1d8cdffc0667408500fc16375.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*ZcarGhHH5S_xNVP30pjx6w.png"/></div></figure><p id="b7e3" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们将要可视化的数据将基于一些随机生成的个人支出数据。从上面可以看到，我们只是随机创建了10个月的费用数据，并将其加载到Pandas数据框架中。上面的代码应该输出20行数据。</p><p id="a10d" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj jd">在这篇文章中，我们数据分析的第一个目标是比较每个类别的平均月支出与该类别中每个月的支出。</strong></p><p id="b8ce" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">因此，让我们用一些熊猫来对每个类别每月的总支出进行分组。</p><pre class="ks kt ku kv gt md me mf mg aw mh bi"><span id="43cb" class="mi mj it me b gy mk ml l mm mn">df_grouped = df.groupby(by=[pd.Grouper(key="Date", freq="1M"), "Category"])["Amount"]<br/>df_grouped = df_grouped.sum().reset_index()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/d0f9b0afd88bf51733031e854ac26fd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*jnedXUfMRMt2hG-o30-6XQ.png"/></div></figure><p id="4518" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">现在，我们可以开始创建图表了。</p><p id="e996" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">由于我们希望为每个消费类别创建一个图表，其中包含每个月的数据点和一条静态平均趋势线，因此我们可以从在数据框架中创建一个类别列表开始。</p><pre class="ks kt ku kv gt md me mf mg aw mh bi"><span id="b627" class="mi mj it me b gy mk ml l mm mn">categories = df["Category"].unique().tolist()</span></pre><p id="af6f" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">然后，我们将遍历所有类别，并使用以下代码为每个类别创建一个图表。</p><pre class="ks kt ku kv gt md me mf mg aw mh bi"><span id="d0a2" class="mi mj it me b gy mk ml l mm mn">for category in categories:<br/>    df_category = df_grouped.loc[df_grouped["Category"] == category].copy()<br/>    df_category["Average Spending"] = round(df_category["Amount"].mean(), 2)<br/>    category_graph = px.line(<br/>        df_category, <br/>        x="Date", <br/>        y=["Amount", "Average Spending"], <br/>        title=f"{category} Spending with Average Trend Line"<br/>    )<br/>    category_graph.show()</span></pre><p id="611a" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这段代码首先创建一个新的DataFrame，在每个循环中只包含具有所需类别的行。然后，我们创建一个新的列“Average Spending ”,它简单地对数据帧中的“Amount”列使用<code class="fe nt nu nv me b">mean</code>方法，返回一个只包含平均支出值的列。</p><p id="a8ad" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">最后，我们使用Plotly Express库用新的数据框架创建一个折线图。您会注意到我们将一个列表传递给了<code class="fe nt nu nv me b">y</code>参数，这将在折线图中给出两行。这段代码的结果如下图所示。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/434bb91add4fad6ccd89fee3735252db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F3HuHjYeA5x2Ix-lWGtMHQ.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/8b8f9692d2e6eacdaf804ae253516b0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4xM5y_tMEk4eUfPSGMIW0Q.png"/></div></div></figure><p id="5fb1" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">使用这些图表，您可以很容易地看到哪些月份超出了该类别的平均支出，哪些月份低于平均支出。这将有助于人们长期管理他们的财务，这样他们就可以相应地每月做预算，并检查他们是否每个月都达到他们的计划。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="42c3" class="mv mj it bd mw mx my mz na nb nc nd ne ki nf kj ng kl nh km ni ko nj kp nk nl bi translated">用Plotly实现图形上的线性和非线性趋势线</h1><p id="85e6" class="pw-post-body-paragraph lh li it lj b lk nm kd lm ln nn kg lp lq no ls lt lu np lw lx ly nq ma mb mc im bi translated">接下来，让我们来看看如何使用Plotly来<strong class="lj jd">创建数据集</strong>中每月总支出的趋势线。为此，我们将创建一个新的分组数据帧，只是这次我们只需要按月分组。</p><pre class="ks kt ku kv gt md me mf mg aw mh bi"><span id="8097" class="mi mj it me b gy mk ml l mm mn">df_sum = df.groupby(by=[pd.Grouper(key="Date", freq="1M")])["Amount"]<br/>df_sum = df_sum.sum().reset_index()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/9eb231f500782cb2753c66b5399fde83.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*On7RUEK_E1_EFDUiveJLZw.png"/></div></figure><p id="204c" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">Plotly允许您创建线性或非线性趋势线。您可以使用普通最小二乘(OLS)线性回归或局部加权散点图平滑(非线性)趋势线。</p><p id="4ad1" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">类似于我们为前面的部分创建图表的方式，我们现在将创建一个可能的趋势线列表，并使用另一个for循环创建散点图。</p><pre class="ks kt ku kv gt md me mf mg aw mh bi"><span id="ea43" class="mi mj it me b gy mk ml l mm mn">trend_lines = ["ols", "lowess"]</span><span id="efe6" class="mi mj it me b gy ny ml l mm mn">for trend_line in trend_lines:<br/>    fig = px.scatter(<br/>        df_sum, <br/>        x="Date",<br/>        y="Amount",<br/>        trendline=trend_line,<br/>        title=f"{trend_line} Trend Line"<br/>    )<br/>    fig.show()</span></pre><p id="cdf4" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">代码和以前差不多，我们将数据帧和适当的列传递给Plotly Express散点图。为了添加趋势线，我们将我们定义的列表中的每个趋势线值传递到<code class="fe nt nu nv me b">trendline</code>参数中。运行上面的代码会得到下面的图形。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/877e38a65f66cc8021c9810f0b849ff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eMBmO8OBtsaLBPmqS8waCg.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/9d4ddfe0aae6943669a99a3c397399e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lNxgwoLz5iPHV7Ab0l9j-w.png"/></div></div></figure><p id="a15b" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj jd">根据您的数据集，线性或非线性趋势线可以更好地拟合数据点。这就是为什么尝试不同的趋势线来看哪条更符合数据是有用的。此外，仅仅因为有趋势线并不一定意味着趋势真的存在(就像相关性不等于因果关系一样)。您还可以使用以下代码访问模型参数(对于带有OLS趋势线的图表)。</strong></p><pre class="ks kt ku kv gt md me mf mg aw mh bi"><span id="de90" class="mi mj it me b gy mk ml l mm mn">results = px.get_trendline_results(fig)<br/>results.px_fit_results.iloc[0].summary()</span></pre><p id="d444" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">请注意，上面的<code class="fe nt nu nv me b">fig</code>对象是在图形表达式<code class="fe nt nu nv me b">scatter</code>中的<code class="fe nt nu nv me b">trendline</code>参数被设置为“ols”时创建的图形。汇总的结果可以为您提供用于创建您在图表中看到的趋势线的参数的说明，这可以帮助您理解趋势线的意义。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nz"><img src="../Images/1fafb840d5628c8b70474118aa1bcf83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q4zJhz_5Log06FjEqiS-LQ.png"/></div></div></figure><p id="744d" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在我们随机生成数据的例子中，很难真正看到一个显著的趋势。您将看到非常低的R平方值和小于20的样本大小估算出低相关性(如果有的话)。</p><p id="5bf9" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">然而，对于一个普通人的支出数据来说，当你查看每月的支出时，如果能看到一条基本平坦的趋势线就太好了。如果你注意到你每月支出的R平方值较高的高斜率正趋势线，你会知道你可能随着时间的推移增加了支出，因此支出超过了你的每月预算分配(除非你可能加薪并决定故意挥霍)。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="d2b9" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">仅此而已！</p><p id="9833" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我希望你会发现这个关于Python中Plotly趋势线的快速介绍对你的数据分析很有用。Plotly库，特别是当你使用Plotly Express时，使你只需插入一个Pandas数据框架就可以直接可视化你的数据。重要的是要记住，你选择显示数据的方式会影响其他人对它的看法，所以要确保当你做出改变时，比如添加趋势线，你是以真正代表基础数据的方式这样做的，而不是为了提出一个任意的观点。</p><p id="ae74" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">再次感谢你的阅读！如果你正在考虑成为Medium的付费会员，如果你使用我下面的推荐链接注册，我会非常感激！这会让直接收到你的一部分会费，所以这将是一个很大的帮助。</p><div class="oa ob gp gr oc od"><a href="https://byrondolon.medium.com/membership" rel="noopener follow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd jd gy z fp oi fr fs oj fu fw jc bi translated">通过我的推荐链接加入Medium—Byron Dolon</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">byrondolon.medium.com</p></div></div><div class="om l"><div class="on l oo op oq om or lb od"/></div></div></a></div><pre class="ks kt ku kv gt md me mf mg aw mh bi"><span id="95c1" class="mi mj it me b gy mk ml l mm mn"><strong class="me jd">More by me:<br/></strong>- <a class="ae os" rel="noopener" target="_blank" href="/check-for-a-substring-in-a-pandas-dataframe-column-4b949f64852?sk=bfb5bbab11ae45c47bfb316d931c3b56">Check for a Substring in a Pandas DataFrame</a><br/>- C<a class="ae os" rel="noopener" target="_blank" href="/conditional-selection-and-assignment-with-loc-in-pandas-2a5d17c7765b?sk=e5672d859a3964c1453a1c09edca22cf">onditional Selection and Assignment With .loc in Pandas</a><br/>- <a class="ae os" rel="noopener" target="_blank" href="/2-easy-ways-to-get-tables-from-a-website-with-pandas-b92fc835e741?sk=9981ddaf0785a79be893b5a1dd3e03dd">2 Easy Ways to Get Tables From a Website With Pandas</a><br/>- <a class="ae os" rel="noopener" target="_blank" href="/top-4-repositories-on-github-to-learn-pandas-1008cb769f77?source=friends_link&amp;sk=d3acc38062490a86ecb46875342224e6">Top 4 Repositories on GitHub to Learn Pandas</a><br/>- <a class="ae os" rel="noopener" target="_blank" href="/better-data-visualization-with-dual-axis-graphs-in-python-a7f35a493558?sk=4e080437f9d29818e25120e287fa550d">Better Data Visualization with Dual Axis Graphs in Python</a></span></pre></div></div>    
</body>
</html>