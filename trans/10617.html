<html>
<head>
<title>How to generate training data: Faster and better</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何更快更好地生成训练数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-generate-training-data-faster-and-better-e84d05884dc0?source=collection_archive---------24-----------------------#2021-10-11">https://towardsdatascience.com/how-to-generate-training-data-faster-and-better-e84d05884dc0?source=collection_archive---------24-----------------------#2021-10-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4f4a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">作为机器学习工程师，提高工作效率的最佳实践</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a56e85b51b75b0ee9bce502cbd26a0eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h9OEvO869ztWErB3UKSvjg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://www.pexels.com/photo/athletes-running-on-track-and-field-oval-in-grayscale-photography-34514/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">像素</a>的<a class="ae ky" href="https://www.pexels.com/@pixabay?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">皮克斯拜</a>拍摄</p></figure><p id="b243" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你在现实世界中创建机器学习模型时，与在线课程或Kaggle风格的比赛相反，你需要自己生成训练数据。</p><p id="a29f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是任何ML项目的第一步。尽管这很重要，但却是我们最容易忽视的一点。</p><p id="910a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名自由ML工程师，我经常接受新的项目，并且一次又一次地面临同样的问题:我如何更快更好地生成训练数据？</p><p id="9caa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我想分享我在这个过程中发现的一些最佳实践，并帮助您提高工作效率。</p><p id="83ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这个<a class="ae ky" href="https://github.com/Paulescu/how-to-generate-training-data-faster-and-better" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">资源库</strong> </a>中找到所有的代码。</p><h1 id="dd58" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">问题</h1><p id="f309" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">开发机器学习模型的第一步是获取训练数据。</p><p id="83ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在现实世界的ML项目中，通常情况下，您不会<strong class="lb iu"> <em class="ms">获得</em> </strong>数据。你<strong class="lb iu"> <em class="ms">生成</em> </strong>它。除非你在非常精通ML的公司工作，这些公司拥有先进的数据工程基础设施(例如谷歌、脸书、亚马逊等等)，否则这一步绝不是无足轻重的。作为初创公司的人工智能/人工智能顾问，我需要生成自己的培训数据。每次都是。</p><p id="ae04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在大多数情况下，这些数据是表格形式的，即有行(样本/观测值)和列(特征和目标)的数据。这些数据存储在数据库中，如Redshift或BigQuery集群，甚至是SQL server或Postgress。您可以使用SQL查询这些数据。</p><p id="2ab0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">理想情况下，您应该编写一个SQL查询，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="efb5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后运行一次，导出一个包含训练数据的CSV文件，进入数据探索和模型构建阶段。</p><p id="093b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，在现实中，事情要复杂一点，因为:</p><h1 id="deff" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">1.那个奇妙的桌子不存在</h1><p id="0ddd" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">相反，您最终会编写一个更复杂的SQL查询，从不同的表中获取、聚合和连接数据。</p><p id="0598" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大概是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="3cb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你写长SQL时，你一定会犯错误。要么是语法错误(很容易修复)，要么是根本错误(很难修复)，这些错误来自于对数据库中每个表和字段所代表的含义的误解。</p><p id="a533" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能需要花几天时间，与负责数据库的人员(数据库管理员或理想情况下的数据工程师)来回通话，以了解在哪里可以找到您需要输入到模型中的每一位数据，编写查询，运行它，并祈祷能够获得您开始ML工作所需的黄金数据集。</p><p id="2c78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为第二个问题，这不是大多数情况下会发生的。</p><h1 id="ad22" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">2.我的SQL查询不执行</h1><p id="c63e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">您完成了长SQL查询的编写，并将其发送执行。</p><p id="9f59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">等待…等待…0%进度…仍在等待中…</p><p id="6082" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，在你意识到它不会执行之后。</p><p id="21b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我去过那里无数次。试图得到该死的数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8d0f4ec65699fd785bf16027992d508a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZvRXEKnVtMLXBKMcm7HkDw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">凯拉·伯顿从<a class="ae ky" href="https://www.pexels.com/photo/desperate-screaming-young-boy-6624327/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">派克斯</a>拍摄的照片</p></figure><p id="5b44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">问题是你试图一次获取<em class="ms">太多的</em>数据。</p><p id="3740" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一种快速解决方法是只查询一小部分数据。你可以在项目的最开始这样做，来排除障碍，并获得问题的基线表现。但是，当您想要改进模型时，您可能会意识到有一些有用的特性没有包含在查询中。这就把你带到了第三个问题。</p><h1 id="7ae5" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">3.我的SQL查询需要调整(通常需要很多次)</h1><p id="8685" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">你可以用自己的方式获得一个初始数据集。然而，这种方法从长远来看是行不通的，这就是为什么:</p><ul class=""><li id="cc20" class="mv mw it lb b lc ld lf lg li mx lm my lq mz lu na nb nc nd bi translated">在构建机器学习模型的原型时，您需要在数据库中的训练数据中添加额外的功能。因此，您需要编辑并重新运行该查询。又来了。</li><li id="f8d7" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">当您将您的模型转移到生产(顺便说一下，这是您工作的最终目标)时，您将需要实现一个再培训管道，以避免模型漂移。您需要每天、每周或每月重新生成一次培训数据。</li></ul><p id="1de5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">生成训练数据是您需要迭代的关键步骤。像我描述的手动方法(遗憾的是，这是ML工程师和数据科学家在实践中最常用的方法)并不是最佳的。</p><p id="2381" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有没有更好的方法解决问题1，2，3，更好更快的生成训练数据？</p><p id="3432" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没错。</p><h1 id="b5de" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">解决方案</h1><p id="1971" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我想到的解决方案是基于<em class="ms">划分</em> ( <em class="ms">自动化</em>的原理🤖)和<em class="ms">征服</em>。</p><h1 id="b4e6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">步骤1:将SQL查询拆分成更小的查询</h1><p id="56e8" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">试图通过一次查询执行获取所有训练数据的问题有两个方面:</p><ul class=""><li id="3a30" class="mv mw it lb b lc ld lf lg li mx lm my lq mz lu na nb nc nd bi translated">这个查询很可能不起作用，因为您想要一次获得的数据量太大，DB无法处理。</li><li id="dd31" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">即使查询今天运行，也不能保证它明天(当您重新训练模型时)也能运行，因为数据大小会更大。或者后天。或者另一个。最终，这将打破。</li></ul><p id="ca1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的朋友，数据工程师，经常使用的一个技巧是聪明地查询数据。我们运行<em class="ms"> N </em>个查询来提取<em class="ms"> N </em>个块中的数据，而不是一个查询提取所有数据。</p><p id="c451" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，一个电子商务站点的数据库至少有一个包含所有历史订单的表，以及一些参数，如购买的商品id、支付的金额等。以及购买的<strong class="lb iu">时间</strong>。不是一次获取所有数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="a58c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过一系列查询在<em class="ms"> N </em>个步骤中获取相同的数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="7096" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行N个较小的查询是可伸缩的，并且消除了数据库中的容量瓶颈。但是，如何自动执行N个查询呢？我猜您不希望将N个查询复制并粘贴到您的DB IDE或CLI来获取数据，对吗？</p><p id="15cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将我们带到解决方案的第2步。</p><h1 id="1026" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">步骤2:用python自动执行查询</h1><p id="d44c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Python是你可能在你的机器学习项目中使用的语言。它也是一种很好的语言，可以快速地自动完成一些枯燥的事情，比如将数据从数据库中提取到CSV文件中。</p><p id="a1a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python还有一个丰富的DB客户端库生态系统，允许您从Python脚本对DB运行查询。我过去广泛使用的一些是用于MySQL服务器的<a class="ae ky" href="https://pypi.org/project/pyodbc/" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="ms">py odbc</em></strong></a>或用于postr press/Redshift的<a class="ae ky" href="https://pypi.org/project/psycopg2/" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="ms">psycopg 2</em></strong></a>。</p><p id="f983" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">话虽如此，自动执行N个查询的一个简单方法是将一个查询字符串模板和一个简单的<em class="ms"> for循环</em>放在一个<code class="fe nj nk nl nm b">data.py</code>脚本中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="aaba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个解决方案是可行的。但是，它也重复了很多不必要的工作人员。以前下载并存储在CSV文件中的数据不应重新下载，除非SQL查询中有错误或更改。</p><p id="b239" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们在最后一步处理这些细节。</p><h1 id="dc8b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">第三步:包起来</h1><p id="232f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了避免重新处理日期，我们可以添加一个<code class="fe nj nk nl nm b">overwrite</code>参数。</p><p id="3ce9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有时您想要强制覆盖。例如，您在SQL查询中发现了一个错误，想要重新生成所有文件。在这种情况下，你设置<code class="fe nj nk nl nm b">overwrite=True</code>。</p><p id="a6e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有时，您只想下载缺失日期的文件，以扩展您的培训数据。例如，当您在生产中重新训练模型时，您不需要重新下载所有日期的数据，而只需要重新下载您训练模型时的前一个日期的数据。在这种情况下<code class="fe nj nk nl nm b">overwrite=False</code>。</p><p id="5375" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="ee77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我是<code class="fe nj nk nl nm b">tqdm</code>图书馆的忠实粉丝。它可以让您打印出令人惊叹的进度条，为您提供关于迭代速度和预计完成时间的反馈。</p><p id="871b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">再加一个吧😊</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="b543" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这个<a class="ae ky" href="https://github.com/Paulescu/how-to-generate-training-data-faster-and-better" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">库中找到所有的代码</strong> </a> <strong class="lb iu"> </strong>🎁</p><h1 id="7f16" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="2239" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">所以，这是我作为ML工程师提高生产力的策略之一。</p><p id="2667" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这个漂亮的<code class="fe nj nk nl nm b">data.py</code>脚本，您将能够:</p><ul class=""><li id="9080" class="mv mw it lb b lc ld lf lg li mx lm my lq mz lu na nb nc nd bi translated">更快地将新功能添加到您的训练集中。</li><li id="fd21" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">更快地调试和重新生成数据集。</li><li id="87b7" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">并最终更快更好的训练ML模型，创造产品。</li></ul><p id="96a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这有所帮助，乡亲们。如果有任何问题，请随时联系。</p><p id="93fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想了解更多真实世界的ML技巧和提示，并成为一名更好的机器学习开发者，请订阅我的简讯。</p><p id="ed7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我很乐意帮助你成为一名更好的机器学习开发者。</p><p id="3e33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">祝你愉快</p></div></div>    
</body>
</html>