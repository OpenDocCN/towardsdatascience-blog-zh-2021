<html>
<head>
<title>Let’s Build Feature Flag Hooks for React &amp; Azure App Configuration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们为React和Azure应用程序配置构建功能标志挂钩</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/lets-build-feature-flag-hooks-for-react-azure-app-configuration-bc7417f24e94?source=collection_archive---------13-----------------------#2021-04-02">https://towardsdatascience.com/lets-build-feature-flag-hooks-for-react-azure-app-configuration-bc7417f24e94?source=collection_archive---------13-----------------------#2021-04-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="97e2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">连接React到Azure应用配置的自定义挂钩，以访问功能标志和动态配置。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/02bfccca7b4f6c3c4d24ab7ec0c5f53f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dcR_ZOn4_VcibeOS"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">尼古拉·约翰尼·米尔科维奇在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="cfca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有两样东西我很喜欢，<a class="ae ky" href="https://azure.microsoft.com" rel="noopener ugc nofollow" target="_blank">微软Azure </a>(我的首选云)和<a class="ae ky" href="https://reactjs.org" rel="noopener ugc nofollow" target="_blank"> React.js </a>用于构建可扩展的web应用。</p><p id="9472" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最近，我发现有必要向我的应用程序添加动态配置，并将其视为更详细地探索<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/azure-app-configuration/overview" rel="noopener ugc nofollow" target="_blank"> Azure应用程序配置服务</a>的机会。</p><h2 id="7dad" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">什么是Azure App配置？</h2><p id="d116" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">补充的<a class="ae ky" href="https://azure.microsoft.com/services/key-vault/" rel="noopener ugc nofollow" target="_blank"> Azure Key Vault </a>(用于存储应用程序机密)应用程序配置使得实现以下场景更加容易:</p><ul class=""><li id="ccd8" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">集中管理和分发不同环境和地理位置的分层配置数据</li><li id="5dc7" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">无需重新部署或重启应用程序，即可动态更改应用程序设置</li><li id="570f" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">实时控制功能可用性</li></ul></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="19fe" class="no lw it bd lx np nq nr ma ns nt nu md jz nv ka mg kc nw kd mj kf nx kg mm ny bi translated">我们来建吧！</h1><p id="bdc6" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated"><strong class="lb iu">场景:</strong>我有一个登录页面，在这个登录页面的顶部是一个简单的可忽略的横幅警告，看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/fe659821ca152a7b3c5de9520eaf6fd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nq7Hi9rJhLSR0PTEU9qKbA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">登录页面上可见的警报</p></figure><p id="7f5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">我的目标:</strong>我想利用功能标志和动态配置来:</p><ol class=""><li id="f058" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu oa mz na nb bi translated">每当我想向我的用户传达系统消息时显示此警报。</li><li id="bf39" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu oa mz na nb bi translated">更改此警报中的文本，以反映我希望传达的信息。</li></ol><h2 id="c13d" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">步骤0:在Azure中创建应用配置服务</h2><p id="01aa" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">为了简洁起见，我假设您已经在Azure中创建了一个应用配置服务。在这种情况下，请导航到:<strong class="lb iu">设置</strong> &gt; <strong class="lb iu">访问键</strong>并复制主只读<strong class="lb iu">连接字符串</strong>以备后用。</p><h2 id="0de2" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">步骤1:创建功能标志和配置</h2><ol class=""><li id="ceb7" class="mt mu it lb b lc mo lf mp li ob lm oc lq od lu oa mz na nb bi translated">导航到<em class="oe">特征管理器</em>并点击<em class="oe">添加</em>创建一个新标志。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/3697e9d6b023b1c541e8012e7bbf357c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j4Y7hyjH_miLjvjXLHWPdg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">选择“添加”以创建</p></figure><p id="2000" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.添加以下属性并启用标志，然后点击<em class="oe">应用保存。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/0d17046557f7411861d21b4fa63fb04e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5qkI6qcwrtVJxkt8gTIm4A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">命名功能标志</p></figure><p id="5561" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.导航到<em class="oe">配置浏览器</em>并选择<em class="oe">创建</em>来添加一个新的键值配置(注意:也有一个引用密钥库秘密的选项，但是记住React可能会在客户端暴露这一点)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/defef5682a1f1c6b0f12473ebc29fc32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lD5wiaMnXvc_fcBflpz59Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建新配置</p></figure><p id="3ee5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.添加以下配置细节，然后点击<em class="oe">应用</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/d023c40cdff32b54cfdedc47e16ee17c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3UicB6xWgwZeI6LUAJtzCQ.png"/></div></div></figure><h2 id="23d7" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">步骤2:安装NPM软件包</h2><p id="96d3" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">使用以下命令安装<a class="ae ky" href="https://www.npmjs.com/package/@azure/app-configuration" rel="noopener ugc nofollow" target="_blank"><em class="oe">@ azure/app-configuration</em></a>NPM包:</p><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="89b2" class="lv lw it oi b gy om on l oo op">npm i <a class="ae ky" href="https://www.npmjs.com/package/@azure/app-configuration" rel="noopener ugc nofollow" target="_blank"><em class="oe">@azure/app-configuration</em></a></span></pre><h2 id="958e" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">步骤3:创建useFeatureFlag挂钩</h2><p id="0e71" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在React项目中，创建一个名为<em class="oe"> useFeatureFlag.js </em>的新文件，并在其中粘贴以下代码片段。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从Azure应用配置中提取功能和配置的挂钩</p></figure><p id="136f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">函数<em class="oe"> useFeatureFlag </em>接受一个密钥，该密钥与我们之前在App Configuration portal中配置的密钥相匹配，如果该标志被启用，则返回true，如果被禁用，则返回false。</p><p id="a1b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">类似地，函数<em class="oe"> useConfiguration </em>接受一个键，它匹配我们之前设置的配置，并返回配置字符串。</p><h2 id="a162" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">步骤4:渲染横幅</h2><p id="cbed" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在登录页面上，我们现在可以导入两个挂钩，用Azure门户中定义的给定消息有条件地呈现我们的警报。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="72e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们只需打开或关闭该标志，就可以看到生产中反映的变化，而不需要我们重新部署应用程序:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/d6ecc92c3ee7a37908ab626f50f72b86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O0jqtGV7LPQLV6pOIR5rpg.png"/></div></div></figure></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><p id="6d13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">搞定了。👊🏻</p><p id="2514" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果这篇文章帮助你开始使用Azure中的功能标志(或者你成功地用我的自定义钩子实现了一个不同的提供商的SDK)，请随意在下面留下评论，然后<a class="ae ky" href="https://www.buymeacoffee.com/olafwrieden" rel="noopener ugc nofollow" target="_blank">用咖啡打发我的一天</a>。</p></div></div>    
</body>
</html>