<html>
<head>
<title>Interactive Face Recognition Application through Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Docker的交互式人脸识别应用</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/interactive-face-recognition-application-through-docker-85e86ad0ffa6?source=collection_archive---------16-----------------------#2021-09-19">https://towardsdatascience.com/interactive-face-recognition-application-through-docker-85e86ad0ffa6?source=collection_archive---------16-----------------------#2021-09-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="dbff" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一种同时利用相机设备、交互式GUI、Docker、GPU和深度学习的方法。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0811d6da296f56c601d80cb8d4218fc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HEAP4IMEgxcN6TC7"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">丹尼尔·库切列夫在<a class="ae kv" href="https://unsplash.com" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="fe75" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi ls translated"><span class="l lt lu lv bm lw lx ly lz ma di"> T </span>这篇文章将介绍如何开发一个交互式应用程序，利用Adam Geitgey的框架<a class="ae kv" href="https://github.com/ageitgey/face_recognition" rel="noopener ugc nofollow" target="_blank">人脸识别</a>，从一个人的相机或网络摄像头设备中识别人脸。为了创建一个交互式应用程序，我们将使用Tkinter，并使用Docker来确保一个包含所有必要依赖项的隔离环境。这篇文章可以作为您自己项目的起点，因为使用哪个框架和库并不重要。了解如何通过Docker创建一个利用相机设备、GPU加速和深度学习框架的交互式应用程序有许多可能性。</p><p id="f84d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果只是想通过Docker运行GUI，我写了这篇文章，你可以参考:</p><div class="mb mc gp gr md me"><a rel="noopener follow" target="_blank" href="/empowering-docker-using-tkinter-gui-bf076d9e4974"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd ir gy z fp mj fr fs mk fu fw ip bi translated">使用Tkinter GUI增强Docker的能力</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">通过Docker的GUI对于许多应用程序来说是至关重要的。</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">towardsdatascience.com</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms kp me"/></div></div></a></div></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><p id="553d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您想立即运行应用程序，可以下载我的<a class="ae kv" href="https://github.com/KasperSHenriksen/face_recognition_gui" rel="noopener ugc nofollow" target="_blank"> Github资源库</a>，并遵循本文末尾的“运行应用程序”一节。</p><h1 id="ebfc" class="na nb iq bd nc nd ne nf ng nh ni nj nk jw nl jx nm jz nn ka no kc np kd nq nr bi translated">阅读指南</h1><p id="f5d4" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">在整篇文章中，我们将介绍应用程序中的脚本，之后将介绍运行应用程序的指南。本文将遵循以下顺序。</p><h2 id="7d95" class="nx nb iq bd nc ny nz dn ng oa ob dp nk lf oc od nm lj oe of no ln og oh nq oi bi translated">目录</h2><ol class=""><li id="3613" class="oj ok iq ky b kz ns lc nt lf ol lj om ln on lr oo op oq or bi translated">先决条件</li><li id="6c12" class="oj ok iq ky b kz os lc ot lf ou lj ov ln ow lr oo op oq or bi translated">应用概述</li><li id="8771" class="oj ok iq ky b kz os lc ot lf ou lj ov ln ow lr oo op oq or bi translated">码头工人</li><li id="c9e7" class="oj ok iq ky b kz os lc ot lf ou lj ov ln ow lr oo op oq or bi translated">Tkinter</li><li id="e26a" class="oj ok iq ky b kz os lc ot lf ou lj ov ln ow lr oo op oq or bi translated">摄像设备</li><li id="1698" class="oj ok iq ky b kz os lc ot lf ou lj ov ln ow lr oo op oq or bi translated">计算机视觉</li><li id="5e5c" class="oj ok iq ky b kz os lc ot lf ou lj ov ln ow lr oo op oq or bi translated">命令过程</li><li id="627b" class="oj ok iq ky b kz os lc ot lf ou lj ov ln ow lr oo op oq or bi translated">运行应用程序</li><li id="1dcf" class="oj ok iq ky b kz os lc ot lf ou lj ov ln ow lr oo op oq or bi translated">结论</li></ol></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="630b" class="na nb iq bd nc nd ox nf ng nh oy nj nk jw oz jx nm jz pa ka no kc pb kd nq nr bi translated">先决条件</h1><p id="6998" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">这个应用程序只在Linux上测试过，但是，它应该和其他一些参数可能不同的操作系统一样工作，例如当运行Docker时。</p><p id="76ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于先决条件，你应该有一个摄像头或网络摄像头，Docker，CUDA和CuDNN安装。我已经使用以下工具测试了该应用程序:</p><ul class=""><li id="45b8" class="oj ok iq ky b kz la lc ld lf pc lj pd ln pe lr pf op oq or bi translated">20.10.8</li><li id="795e" class="oj ok iq ky b kz os lc ot lf ou lj ov ln ow lr pf op oq or bi translated">CUDA 11.4</li><li id="0c1a" class="oj ok iq ky b kz os lc ot lf ou lj ov ln ow lr pf op oq or bi translated">CuDNN 8.2.2</li><li id="1fe2" class="oj ok iq ky b kz os lc ot lf ou lj ov ln ow lr pf op oq or bi translated">操作系统:Manjaro 21.1.2 Phavo</li><li id="b154" class="oj ok iq ky b kz os lc ot lf ou lj ov ln ow lr pf op oq or bi translated">GPU:英伟达GeForce GTX 1080 Ti</li><li id="b633" class="oj ok iq ky b kz os lc ot lf ou lj ov ln ow lr pf op oq or bi translated">摄像设备:罗技网络摄像头C930e</li></ul><h2 id="3692" class="nx nb iq bd nc ny nz dn ng oa ob dp nk lf oc od nm lj oe of no ln og oh nq oi bi translated">目录结构</h2><p id="9674" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">该项目的目录结构如下所示。你可以预先创建这些文件或者直接从我的<a class="ae kv" href="https://github.com/KasperSHenriksen/face_recognition_gui" rel="noopener ugc nofollow" target="_blank"> Github库</a>下载所有文件。此外，您需要在数据集目录中创建自己的目录，并插入所需的图像。在我的例子中，如下所示，我在Kasper目录中添加了四个图像。你添加的同一个人在不同场景下的图像越多，你的预测就越准确。关于脚本，它们的内容将贯穿整篇文章。</p><p id="00f0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="pg">注:</em></strong><em class="pg"/><code class="fe ph pi pj pk b"><em class="pg">encodings.pkl</em></code><em class="pg">会在后面自动生成。</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/c3613f6a27ffa9a2c12587b1ba32b2a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:408/format:webp/1*jIR7Q4SC3p3l813SMSDbfA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">应用程序的目录结构。</p></figure></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="b7d9" class="na nb iq bd nc nd ox nf ng nh oy nj nk jw oz jx nm jz pa ka no kc pb kd nq nr bi translated">应用概述</h1><p id="efdf" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">该应用程序包含一个GUI，它有一个用于显示相机设备输出的面板。此外，还有一个启动/关闭面部识别的按钮。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/df0f8a80440b488e19e619fa929a339c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*OHCDF0-KNBrx7MJwj8iniw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">当前打开人脸识别的应用程序。</p></figure></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="87b7" class="na nb iq bd nc nd ox nf ng nh oy nj nk jw oz jx nm jz pa ka no kc pb kd nq nr bi translated">码头工人</h1><p id="1a5c" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">为了创建一个安装人脸识别、OpenCV、Dlib、Python等的隔离环境，使用了Docker的以下代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pn po l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">docker文件来创建我们的隔离环境。</p></figure></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="d6ed" class="na nb iq bd nc nd ox nf ng nh oy nj nk jw oz jx nm jz pa ka no kc pb kd nq nr bi translated">Tkinter</h1><p id="cab1" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">为了创建可由用户控制的交互式GUI来启用和禁用人脸识别，使用了Tkinter库。下面的代码创建了之前显示的GUI。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pn po l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">主脚本，它创建一个GUI并允许人脸识别。</p></figure></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="1756" class="na nb iq bd nc nd ox nf ng nh oy nj nk jw oz jx nm jz pa ka no kc pb kd nq nr bi translated">摄像设备</h1><p id="948a" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">为了从相机设备获取图像并更新Tkinter GUI，可以使用以下脚本。在第7行，它使用了OpenCV的VideoCapture函数，其中的参数应该与您的设备相对应。默认的相机id通常是0，但是，如果它不起作用，您可以尝试使用1或-1。如果您希望使用视频，您应该能够将设备id替换为视频路径，但是可能需要进行一些其他调整。在第26行，它在一毫秒后再次调用函数本身。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pn po l"/></div></figure><h1 id="bd7a" class="na nb iq bd nc nd ne nf ng nh ni nj nk jw nl jx nm jz nn ka no kc np kd nq nr bi translated">计算机视觉</h1><p id="906b" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">与大多数计算机视觉应用相反，在大多数计算机视觉应用中，你可以通过提供数百个类别的示例来训练模型对所需的类别进行分类，而在人脸识别中，你可以使用深度度量学习。通过深度度量学习，你可以训练一个模型来描述所需的对象，而不是预测它是哪个类。在我们的例子中，我们用它来提供一个特征向量，一个128维的编码，用实数描述每张脸。教导模型来描述面部而不是预测特定的人是一个优点，因为如果想要识别一个新人，就不必重新训练模型。相反，我们应该简单地保存这个新的人的编码，这个编码对于这个模型来说是可以达到的。我们将在本文后面获得这些编码。有了人脸识别框架，我们不必从头开始训练模型，而是使用通过人脸识别提供的已经训练好的模型。如果希望进一步探索人脸识别领域,《人脸识别框架》的作者Adam Geitgey详细阐述了这个主题:</p><div class="mb mc gp gr md me"><a href="https://medium.com/@ageitgey/machine-learning-is-fun-part-4-modern-face-recognition-with-deep-learning-c3cffc121d78" rel="noopener follow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd ir gy z fp mj fr fs mk fu fw ip bi translated">机器学习很好玩！第4部分:具有深度学习的现代人脸识别</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">更新:本文是系列文章的一部分。查看完整系列:第1部分、第2部分、第3部分、第4部分、第5部分、第6部分…</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">medium.com</p></div></div><div class="mn l"><div class="pp l mp mq mr mn ms kp me"/></div></div></a></div><h2 id="2ff9" class="nx nb iq bd nc ny nz dn ng oa ob dp nk lf oc od nm lj oe of no ln og oh nq oi bi translated">数据集和编码器</h2><p id="045f" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">为了使模型能够识别人脸，需要一个包含人脸编码的pickle文件。为了实现这一点，正如前面在“目录结构”一节中提到的，您必须在目录数据集中创建一个具有所需人员姓名的目录。然后，编码器应该包含以下代码。在这段代码中，我们递归地获取数据集目录中每个人的所有图像。通过使用人脸识别框架，我们定位人脸并提取每个图像的编码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pn po l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">构建一个pickle文件，其中包含来自数据集的编码。</p></figure><h2 id="89c4" class="nx nb iq bd nc ny nz dn ng oa ob dp nk lf oc od nm lj oe of no ln og oh nq oi bi translated">人脸识别</h2><p id="3755" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">为了识别人脸，将使用以下代码。总结一下代码，它使用来自我们相机设备的图像，检测人脸，为每个人脸提取128维编码，然后将新编码与我们的编码数据集进行比较。为了进行比较，它会检查新编码的要素与我们的编码数据集之间的距离，如果某个要素的距离低于容差参数，则该要素会获得投票。为了找到最佳匹配，我们只需选择票数最高的人。如果简单的解决方案不够，您可以实现一个更强的分类器。</p><p id="d82b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更具体地说，VideoStream为每一帧调用函数<code class="fe ph pi pj pk b">process_image</code>，这个函数完成实现人脸识别的所有必要工作。在第43–45行，您可以调整用于比较的公差参数。公差越低，比较越严格。此外，在第48–51行中，也可以调整<code class="fe ph pi pj pk b">highest_vote</code>来增加或减少严格性。</p><p id="b063" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要获得关于面部识别功能的更多详细信息，请参考<a class="ae kv" href="https://face-recognition.readthedocs.io/en/latest/face_recognition.html" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pn po l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">计算机视觉部分，基于人脸识别框架。</p></figure></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="3160" class="na nb iq bd nc nd ox nf ng nh oy nj nk jw oz jx nm jz pa ka no kc pb kd nq nr bi translated">外壳脚本(警告)</h1><p id="5a33" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">为了使工作更简单，创建一个shell脚本，使用以下参数运行xhost和Docker。对于xhost，启用对每个人的访问，然后在分离Docker容器后禁用它。在这个Docker命令中，我们共享GPU、用于查看GUI的显示器、用于持续开发的卷和网络摄像头设备。</p><p id="131c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">警告:</strong>如果在本地运行，使用xhost和这些Docker参数应该不成问题。但是，如果用于生产，安全性应该得到加强，这是建议<a class="ae kv" href="http://wiki.ros.org/docker/Tutorials/GUI#The_simple_way" rel="noopener ugc nofollow" target="_blank">在这里</a>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pn po l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">自动启用/禁用xhost并运行Docker容器。</p></figure></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="6c39" class="na nb iq bd nc nd ox nf ng nh oy nj nk jw oz jx nm jz pa ka no kc pb kd nq nr bi translated">运行应用程序</h1><ol class=""><li id="d2fc" class="oj ok iq ky b kz ns lc nt lf ol lj om ln on lr oo op oq or bi translated">建立码头工人形象:<code class="fe ph pi pj pk b">docker build -t facerecognition_gui .</code></li><li id="c2fb" class="oj ok iq ky b kz os lc ot lf ou lj ov ln ow lr oo op oq or bi translated">使shell脚本可执行:<code class="fe ph pi pj pk b">chmod +x ./run.sh</code></li><li id="a158" class="oj ok iq ky b kz os lc ot lf ou lj ov ln ow lr oo op oq or bi translated">运行shell脚本:<code class="fe ph pi pj pk b">./run.sh</code></li><li id="9cb1" class="oj ok iq ky b kz os lc ot lf ou lj ov ln ow lr oo op oq or bi translated">在Docker容器中，创建编码数据集(确保您的图像位于数据集目录下的某个目录中):<code class="fe ph pi pj pk b">python3 encoder.py</code></li><li id="2c0e" class="oj ok iq ky b kz os lc ot lf ou lj ov ln ow lr oo op oq or bi translated">运行应用程序:<code class="fe ph pi pj pk b">python3 gui.py</code></li><li id="16da" class="oj ok iq ky b kz os lc ot lf ou lj ov ln ow lr oo op oq or bi translated">您现在可以启用面部识别了。</li></ol><p id="4be3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="pg">注意:</em> </strong> <em class="pg">要分离/退出Docker容器，请按ctrl-D </em></p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="4e01" class="na nb iq bd nc nd ox nf ng nh oy nj nk jw oz jx nm jz pa ka no kc pb kd nq nr bi translated">结论</h1><p id="ad5a" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">在本文中，您已经了解了GUI、摄像设备、GPU如何与Docker一起使用。知道如何将这些结合起来，提供了许多可以用于学术和商业目的的可能性。而且，与etc的策略相同。通过Docker共享设备，您应该能够利用其他库和框架，而不会遇到问题。</p><h2 id="1f30" class="nx nb iq bd nc ny nz dn ng oa ob dp nk lf oc od nm lj oe of no ln og oh nq oi bi translated">感谢阅读</h2><p id="fc47" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">一如既往，我们非常欢迎反馈。我故意排除了类型提示以减少代码。但是，如果你觉得类型提示有用，请告诉我。</p></div></div>    
</body>
</html>