<html>
<head>
<title>Learn to Smell (Molecules) with Graph Convolutional Neural Networks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用图形卷积神经网络学习嗅觉(分子)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/learn-to-smell-molecules-with-graph-convolutional-neural-networks-62fa5a826af5?source=collection_archive---------18-----------------------#2021-08-21">https://towardsdatascience.com/learn-to-smell-molecules-with-graph-convolutional-neural-networks-62fa5a826af5?source=collection_archive---------18-----------------------#2021-08-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2211" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">结合化学和图形深度学习的端到端项目</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b5c47376ec3301d36c66a3268ecda945.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a06CNSDzdpD8fbh2qrWcfQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@les_photos_de_raph?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">拉斐尔·比斯卡尔迪</a>在<a class="ae ky" href="https://unsplash.com/s/photos/molecules?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="5ac1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们要完成以下任务:</p><ol class=""><li id="155f" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">构建一个<strong class="lb iu">定制的</strong>图形数据集，其格式适合在DGL工作(这是本文的主题😎)</li><li id="ef0f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">随机准备训练和测试数据集(了解这一点很好👍)</li><li id="3b0e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">定义Conv网络图(小菜一碟🍰)</li><li id="23d5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">训练和评估准确性(像往常一样🧠)</li></ol><h2 id="5d74" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">1.构建适用于DGL的自定义图表数据集格式</h2><p id="1330" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们要处理的数据集来自于<a class="ae ky" href="https://www.aicrowd.com/challenges/learning-to-smell" rel="noopener ugc nofollow" target="_blank">AIcrowd Learning to smear Challenge</a>，它由一个列和另一个列组成，其中一个列是识别特定分子的微笑字符串，另一个列是这些分子的气味名称。</p><div class="nh ni gp gr nj nk"><a href="https://www.aicrowd.com/challenges/learning-to-smell" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">AIcrowd |学习嗅觉|挑战</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">💡试试这个有趣的新方法📹错过市政厅了吗？观看这里开始与一些惊人的解释…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">www.aicrowd.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny ks nk"/></div></div></a></div><p id="830b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，下表中的第二个分子，碳酸二甲酯-13C3，其微笑是COC(=O)OC，其气味被定义为“清新、飘渺、果味”，这当然与人们对这种物质的了解相对应[1]。对于所有这些4316个分子，有100多种不同的气味形成无序的组合。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="480f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们希望a)将每个分子的微笑转换成DGL图，b)标记它是否有水果味，c)去除任何有问题的分子。以下代码块处理每个请求:</p><p id="b9dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">A)必须为每个分子定义DGL图形对象。我们可以使用RDKit首先从它的微笑中形成一个mol RDKit对象(第2行)来实现这一点。由于我们想识别节点及其连接，我们可以得到邻接矩阵(第3行和第4行)。非零值的索引标识连接的节点(第5行)并给出双向图的源节点和目的节点(第6行和第7行)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="d5b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用来自<em class="of"> ogb </em>库【2】的<code class="fe ob oc od oe b">atom_to_feature_vector</code>来生成原子的特征向量</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="dc61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，当我们对字符串COC(=O)CO应用<code class="fe ob oc od oe b">feat_vec</code> <em class="of"> </em>时，我们得到:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="378c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，每一行对应于一个具有9个特征的原子。这些特征是原子的物理化学性质，例如，原子序数、氢的数目，或者原子是否在环中，等等。</p><p id="c535" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">c)现在我们有了带有特征的图表，是时候定义标签了。正如我们所见，每个分子都与一种以上的气味相关联。这里为了简单起见，问题将是一个<strong class="lb iu">二元分类</strong>来确定分子是否有<strong class="lb iu">水果</strong>气味。下面的代码块执行该任务，如果有水果香味，则分配标签a <strong class="lb iu"> 1 </strong>，如果没有，则分配标签<strong class="lb iu"> 0 </strong>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="8c43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个数据集中，我注意到有一小部分分子没有正确地转换成DGL图，所以我决定去掉它们。我通过简单地忽略如下所示的异常来做到这一点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="24f8" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">2.随机准备训练和测试数据集</h2><p id="0f45" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">完成所有这些步骤后，数据集就准备好了，但我们将进一步将其转换为DGL数据集，以便顺利地进行预处理并形成训练和测试子集。这里我将引用DGL团队的“<a class="ae ky" href="https://docs.dgl.ai/en/0.6.x/new-tutorial/6_load_data.html" rel="noopener ugc nofollow" target="_blank">制作自己的数据集</a>”官方教程中的概述[3]:</p><blockquote class="og oh oi"><p id="c46e" class="kz la of lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi translated">您的自定义图形数据集应该继承<code class="fe ob oc od oe b">dgl.data.DGLDataset</code>类并实现以下方法:</p><p id="5ff8" class="kz la of lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi translated"><code class="fe ob oc od oe b">__getitem__(self, i)</code>:检索数据集的第<code class="fe ob oc od oe b">i</code>个例子。一个例子通常包含一个DGL图，偶尔还包含它的标签。</p><p id="6f20" class="kz la of lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi translated"><code class="fe ob oc od oe b">__len__(self)</code>:数据集中的样本数。</p><p id="8c11" class="kz la of lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi translated"><code class="fe ob oc od oe b">process(self)</code>:从磁盘加载并处理原始数据。</p></blockquote><p id="4664" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">过程方法是我们给图形加标签的地方。从一个文件中得到它是可能的，但是在我们的例子中，只有图表列表和标签列表被转换成torch张量。因此这是一个非常简单的类:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="128d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们继续构建列车并测试随机抽样。这样做的好处是可以设置批量大小。在这里，我们将其设置为每批五个图形:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="7ab7" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated"><strong class="ak"> 3。</strong>定义Conv网络图</h2><p id="5c5a" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们正在定义GCNN的路上。我已经在之前的一篇文章中解释了GCN类是如何构建的。每个节点都有一个输出特征张量，因此为了进行二元分类，我们可以将输出特征的长度设置为类的数量(此处为两个)，然后使用<code class="fe ob oc od oe b">dgl.mean_nodes</code>对所有特征节点进行平均，以获得每个图的平均(二维)张量:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="7ba1" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated"><strong class="ak"> 4。</strong>训练和评估准确性</h2><p id="601f" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">最后，我们建立模型，每个原子接受9个原子特征，并返回一个二维张量，用于定义是否有水果香味。历元在批次上运行，损失用交叉熵计算。最后一部分只是一个循环，对正确的预测进行计数，以评估准确性:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="9ab9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们得到的精度大约是0.78，这已经很不错了。现在，你可以尝试预测其他气味，甚至更好地制作你自己的定制数据集，与分子或任何你想要的DGL一起工作。</p><p id="8d2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想试代码，打开这个<a class="ae ky" href="https://github.com/napoles-uach/DGL_Smell/blob/main/dgl_smell_fruity.ipynb" rel="noopener ugc nofollow" target="_blank"> Colab笔记本</a>。如果你有任何问题，我将非常乐意回答。最后，考虑订阅邮件列表:</p><div class="nh ni gp gr nj nk"><a href="https://jnapoles.medium.com/subscribe" rel="noopener follow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">每当joséMANUEL náPOLES du arte发表文章时都会收到电子邮件。</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">编辑描述</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">jnapoles.medium.com</p></div></div><div class="nt l"><div class="om l nv nw nx nt ny ks nk"/></div></div></a></div><p id="e985" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并查看我以前的帖子:</p><div class="nh ni gp gr nj nk"><a rel="noopener follow" target="_blank" href="/start-with-graph-convolutional-neural-networks-using-dgl-cf9becc570e1"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">从使用DGL的图形卷积神经网络开始</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">轻松的介绍</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">towardsdatascience.com</p></div></div><div class="nt l"><div class="on l nv nw nx nt ny ks nk"/></div></div></a></div><div class="nh ni gp gr nj nk"><a rel="noopener follow" target="_blank" href="/making-network-graphs-interactive-with-python-and-pyvis-b754c22c270"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">用Python和Pyvis制作交互式网络图。</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">制作精美图表的简单方法。</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">towardsdatascience.com</p></div></div><div class="nt l"><div class="oo l nv nw nx nt ny ks nk"/></div></div></a></div><div class="nh ni gp gr nj nk"><a rel="noopener follow" target="_blank" href="/graph-convolutional-nets-for-classifying-covid-19-incidence-on-states-3a8c20ebac2b"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">用于状态新冠肺炎关联分类的图卷积网</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">如何将地图映射到图卷积网络？</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">towardsdatascience.com</p></div></div><div class="nt l"><div class="op l nv nw nx nt ny ks nk"/></div></div></a></div><p id="050a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">参考资料:</p><p id="a5f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi">1)</p><div class="nh ni gp gr nj nk"><a href="https://doi.org/10.1039/C7GC01764B" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">碳酸二甲酯及其衍生物的反应</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">世界范围内对可持续发展和生物相容性化学的强烈要求已经导致工业界和学术界开发…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">doi.org</p></div></div><div class="nt l"><div class="oq l nv nw nx nt ny ks nk"/></div></div></a></div><p id="de3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi">2)</p><div class="nh ni gp gr nj nk"><a href="https://github.com/snap-stanford/ogb" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">GitHub - snap-stanford/ogb:图形机器的基准数据集、数据加载器和评估器…</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">开放图形基准(OGB)是一个图形机器的基准数据集，数据加载器和评估器的集合…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">github.com</p></div></div><div class="nt l"><div class="or l nv nw nx nt ny ks nk"/></div></div></a></div><p id="c288" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi">3)</p><div class="nh ni gp gr nj nk"><a href="https://docs.dgl.ai/en/0.6.x/new-tutorial/6_load_data.html" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">创建自己的数据集- DGL 0.6.1文档</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">编辑描述</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">docs.dgl.ai</p></div></div></div></a></div></div></div>    
</body>
</html>