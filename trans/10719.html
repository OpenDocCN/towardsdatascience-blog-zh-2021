<html>
<head>
<title>Data Splitting for Model Evaluation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于模型评估的数据分割</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-splitting-for-model-evaluation-d9545cd04a99?source=collection_archive---------8-----------------------#2021-10-15">https://towardsdatascience.com/data-splitting-for-model-evaluation-d9545cd04a99?source=collection_archive---------8-----------------------#2021-10-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3c10" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">是时候回归基本面了。数据分割，或训练测试分割，是一个如此基本的概念，以至于我们有时会忘记它的重要性。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/964658628191e1d746f129d169e5a15e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*y4dvFiN2AeAOjBij"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@karsten116?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Karsten Winegeart </a>拍摄</p></figure><p id="47bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据分割，或通常称为训练-测试分割，是将数据划分为子集，分别用于模型训练和评估。</p><p id="d502" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2017年，吴恩达领导的一个斯坦福研究小组发表了一篇关于从胸部x光片中检测肺炎的算法的论文。<a class="ae ky" href="https://arxiv.org/pdf/1711.05225v1.pdf" rel="noopener ugc nofollow" target="_blank">的原始论文</a>称，他们使用了“30，805名不同患者的112，120张正面X射线图像”，“我们将整个数据集随机分为80%的训练和20%的验证”。这促使<a class="ae ky" href="https://twitter.com/nizkroberts/status/931121395748270080" rel="noopener ugc nofollow" target="_blank">一些人质疑</a>在训练、验证和测试集之间是否有患者重叠。在重叠的情况下，这可能会大大高估模型性能。直到后来，研究小组才在他们的论文中澄清没有重叠。但这是一场本可以避免的不必要的争论。</p><p id="38d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Kaggle上，许多人会经常参考流行的笔记本进行学习和参考。不幸的是，有时即使是<a class="ae ky" href="https://www.kaggle.com/c/house-prices-advanced-regression-techniques/discussion/195550" rel="noopener ugc nofollow" target="_blank">经验丰富的Kagglers </a>也可能在训练测试分割之前对整个数据应用特征工程而犯数据分割错误。</p><p id="c3cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇<a class="ae ky" href="https://www.semanticscholar.org/paper/Are-We-Evaluating-Rigorously-Benchmarking-for-and-Sun-Yu/9485054d936cfb51bdcaaf3395d2a2f53b1b212f" rel="noopener ugc nofollow" target="_blank">论文中</a>作者是朱孙等人。艾尔。，发现在顶级会议上发表的85篇抽样推荐论文中，只有12%使用固定时间戳来训练测试拆分数据。<a class="ae ky" href="https://arxiv.org/abs/2010.11060" rel="noopener ugc nofollow" target="_blank">伊通纪等。艾尔。</a>推断忽略全局时间线不适于评估推荐系统，并且可能导致向用户推荐“未来项目”的不合理场景。</p><p id="fe39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">提出上述案例研究的目的不是批评任何人。事实上，我自己也犯过数据分割错误。相关的一点是，数据分割是数据科学中的一个基本概念，我们有时会低估或忘记它的重要性。我们在进行“简单的”训练测试分割时会错过重要的细节，从而导致对模型性能的不准确评估。</p><p id="aff5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，在进行案例研究之前，我们列出了在数据分割过程中需要注意的5个问题。</p><h1 id="fe7a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">不平衡数据集</h1><p id="49d3" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><em class="ms">问题:如果我们随机分割一个数据集，其中99%为负类，1%为正类，会出现什么问题？</em></p><p id="9901" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个潜在的结果是，在我们的训练数据中，正面类甚至更少或者没有。一切听天由命可能不是分割不平衡数据集的理想方式。</p><p id="cb26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更好的方法是在类别标签上分层。我们值得信赖的scikit-learn的train_test_split有一个分层参数，允许我们以分层的方式分割数据。即使我们没有不平衡的数据集，对类别标签和感兴趣的其他重要子类进行分层也是一种很好的做法，以确保我们的测试和训练数据分布彼此相似。</p><h1 id="24d7" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">有限的数据</h1><p id="475e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><em class="ms">问题:在数据有限的实验中，如果我们执行简单的训练测试分割，可能会出现什么样的模型评估问题？</em></p><p id="498f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在数据有限的情况下，确保测试和训练数据分布彼此相似是非常具有挑战性的。如果我们为训练分配了太多的数据，那么我们将会以太少的测试数据来结束良好的代表性，并且模型结果可能不可概括。</p><p id="702b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个潜在的解决方案是k-fold交叉验证，其中数据被分成<em class="ms"> k </em>个子集(或折叠)并执行以下程序。</p><ol class=""><li id="0df7" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">使用k -1折叠的训练模型</li><li id="6c32" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">在未用于培训的剩余折叠上验证模型</li><li id="9552" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">对每个褶皱组合重复上述两个步骤，并计算模型结果的平均值</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/f437b640a65708d9498082823aab6d55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*IwJZ7tK1W7POeti_XliOyQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">五重交叉验证|作者图片</p></figure><p id="5673" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该方法使模型能够在数据集中的各种数据上进行评估，以导出平均模型结果，该平均模型结果将比仅在少量测试数据上进行评估更准确地估计模型性能。</p><h1 id="b14d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">特征工程泄漏</h1><p id="7a62" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><em class="ms">问题:在进行列车测试分割之前，对整个数据进行标准化有什么问题吗？</em></p><p id="ffa6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们在训练测试分割之前对整个数据进行标准化时，我们通过平均值和标准偏差将测试数据分布的信息“泄漏”到模型中。这篇<a class="ae ky" href="https://machinelearningmastery.com/data-preparation-without-data-leakage/" rel="noopener ugc nofollow" target="_blank">文章</a>有一个很好的实验，展示了训练测试分割之前的特征工程如何影响模型评估。</p><p id="024f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">特征工程泄漏的一个更明显的例子是当我们使用整个数据集执行缺失数据的热卡插补时。这可能导致测试数据点被估算为训练数据点，反之亦然。</p><h1 id="fd5e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">群体泄漏</h1><p id="3eee" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><em class="ms">问题:如果在训练、验证和测试集之间有患者重叠，为什么模型性能可能被大大高估？</em></p><p id="1066" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在大多数X射线数据集中，同一个病人会有多张X射线，它们显然是高度相关的。该模型可以简单地结束学习识别人(即，将训练数据标签分配给同一患者的测试数据中的X射线)，而不是检测疾病，从而导致夸大的模型性能。</p><p id="c4ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我曾经有一个项目，目标是使用微波图像识别物体的类型。当我们的模型准确率达到99%时，红旗就升起来了！原来，数据收集器扫描了同一物体的多个图像，尽管与物体的距离和角度不同。我们在做一个普通的火车测试。Facepalm…</p><p id="c400" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，正确的方法是按对象标识符而不是按数据点或图像进行分割。</p><h1 id="5cbf" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">时间泄漏</h1><p id="c5f1" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><em class="ms">问:随机分割时间序列数据有什么问题吗？</em></p><p id="3f9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，当我们的任务是预测未来，而我们的模型在预测之前已经显示了未来的一部分。</p><p id="de44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在最简单的情况下，正确的方法是确保测试数据在时间上晚于训练数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/86f1ac2719e6d07fc291cd464e2802c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*0Fq86Va9e62F8s9dgL72hQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">时间序列训练-测试分割|作者图片</p></figure><p id="76a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一种更复杂的方法是使用一种前推验证。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/19b5ff49dab8d2a52c4d53780f1b7a3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*JXvp_kTQNsZdQqAi6WUULA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">具有3个分割的嵌套式步行验证|按作者排序的图片</p></figure><p id="d77a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但不管怎样，我们总是确保模型看不到它未来的试卷。</p><h1 id="4084" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">案例研究—🏡房价预测</h1><p id="7ce6" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">有时候事情并不那么明显。</p><p id="788f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ms">问:给定一个关于个人房价的数据集和一个预测房价的目标，你会如何分割这些数据？</em></p><p id="b41a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的谷歌搜索结果中的大部分文章都使用了随机训练测试分割法。如此多的人做了随机列车测试分裂，我严重怀疑自己。也许我的担心是多余的，如果是这样的话，我希望看到这篇文章的人能帮我解释一下。但是，我们是否不需要考虑以下两个数据拆分标准？</p><ol class=""><li id="70b5" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated"><strong class="lb iu">房屋出售的日期</strong> —如果我们在明天出售的房屋上训练我们的模型来预测明天出售的房屋的价格，我们不会有时间泄漏吗？</li><li id="2db4" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><strong class="lb iu">房屋单元</strong> —如果我们的数据集包含在短时间内多次出售的同一栋房屋的数据点，我们不会面临群体泄漏的风险吗？</li></ol><p id="536e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上述两个标准中，我认为更大的问题是时间泄漏，因为在短期内多次出售相同房屋的数量应该很少。我们还认识到，许多住房数据集不允许我们识别单个住房单元。</p><p id="44ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以我决定进行实验来验证我的假设，也就是说，如果我们简单地做一个随机的训练测试分割，会有时间泄漏吗？</p><p id="bb36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实验是在两种不同的设置中使用<a class="ae ky" href="https://data.gov.sg/dataset/resale-flat-prices" rel="noopener ugc nofollow" target="_blank">新加坡的转售单位价格</a>来预测房价，并比较模型结果。</p><ol class=""><li id="321d" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">第一次设置—随机训练-测试分割</li><li id="3e7b" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">第二次设置—临时训练测试分割(即，考虑房屋出售日期的数据分割)</li></ol><p id="f913" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这两种设置中，我们尽可能保持相同的东西，包括测试数据的大小和算法。</p><p id="bd53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用新加坡转售单位价格的一个好处是，集团漏损应该是不存在的或微不足道的，因为新加坡有一项法规要求最低占用期为5年。</p><p id="7d5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实施实验的笔记本可以在这里<a class="ae ky" href="https://colab.research.google.com/drive/13fvik17ZRnpAtdsBKFY9MGKF2QkINuzq?usp=sharing" rel="noopener ugc nofollow" target="_blank">访问。下面我们就来分享一下结果。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/e65e6ca378f996cdb4ec93231cf75cf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*EfZhr8_z2--xC0Pl9zHuYg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">随机分割与时间分割的MAPE |图片作者</p></figure><p id="4b1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上图显示了随机分割与时间分割设置的平均绝对百分比误差(MAPE)。测试数据是两种设置中的公共测试数据点。</p><p id="bda3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到，在随机分割设置中训练的模型通常比在时间分割设置中训练的模型具有“更好”的性能。我们也将测试的时间周期改为其他年份，但结果保持不变。</p><p id="8f9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我们的结论是很可能存在时间泄漏。我们的猜测是，在不同的时间段存在影响房价的宏观经济条件，通过执行随机的训练测试分割，我们正在向模型泄露一些我们在训练时无法知道的宏观经济影响。</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="a1ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个“简单”的列车测试分离也许根本就不那么简单。</p><p id="d01b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读，我希望这篇文章对你有用😄如果您有任何问题或建议，也请随时发表评论，尤其是关于房价预测的案例研究。</p><h1 id="26ca" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">参考</h1><ul class=""><li id="fa16" class="mt mu it lb b lc mn lf mo li ns lm nt lq nu lu nv mz na nb bi translated"><a class="ae ky" href="https://aiukraine.com/wp-content/uploads/2018/09/12_00-Yuriy-Guts-Target-Leakage-in-Machine-Learning-.pdf" rel="noopener ugc nofollow" target="_blank">https://ai Ukraine . com/WP-content/uploads/2018/09/12 _ 00-塞维多夫-Guts-Target-Leakage-in-Machine-Learning-。pdf </a></li><li id="1eeb" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu nv mz na nb bi translated"><a class="ae ky" href="https://en.wikipedia.org/wiki/Leakage_(machine_learning)" rel="noopener ugc nofollow" target="_blank">https://en . Wikipedia . org/wiki/Leakage _(machine _ learning)</a></li></ul></div></div>    
</body>
</html>