<html>
<head>
<title>How to Reduce the Size of a Pandas Dataframe in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中减小熊猫数据帧的大小</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-reduce-the-size-of-a-pandas-dataframe-in-python-7ed6e4269f88?source=collection_archive---------9-----------------------#2021-06-10">https://towardsdatascience.com/how-to-reduce-the-size-of-a-pandas-dataframe-in-python-7ed6e4269f88?source=collection_archive---------9-----------------------#2021-06-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a23a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">减小数据的大小有时会很棘手。在这个快速教程中，我们将演示如何通过向下转换将数据帧的大小减少一半，让您事半功倍。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/389122f1c331f43751498cc1129918cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*he1VA679AHFUDriP"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Guillaume de Germain 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="d3d7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">背景</h1><p id="9a9f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">无论您是为业余爱好项目还是为工作目的构建模型，您的第一次尝试都可能包括打开jupyter笔记本并读取一些数据。最终，你的笔记本肯定会遇到内存问题。在开始删除行或尝试复杂的采样技术来减小数据大小之前，应该检查数据的结构。</p><h1 id="a879" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">了解我们数据的规模</h1><p id="59be" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了探索如何减少数据集的大小，我们需要一些样本数据。对于本教程，我使用的是我为Kaggle上的未来销售预测竞赛创建的旧数据集(<a class="ae ky" href="https://nankarstad.medium.com/how-to-use-lightgbm-and-boosted-decision-trees-forecast-sales-cf65ce8ab645" rel="noopener">这里是我关于预处理数据</a>的文章)。完全连接和功能工程化后，数据集有58列和11，128，050条记录。对于一台小型笔记本电脑来说，这是很大的数据量。我们需要一个减少数据量的解决方案。</p><p id="4643" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在我们开始之前，我们应该检查了解更多的数据。熊猫库中的df.info()是一个非常有用的函数。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="8534" class="mx la it mt b gy my mz l na nb">df.info(memory_usage = "deep")</span></pre><p id="1fe5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这段代码snippit返回以下输出:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="d586" class="mx la it mt b gy my mz l na nb">&lt;class 'pandas.core.frame.DataFrame'&gt;<br/>Int64Index: 11128050 entries, 0 to 11128049<br/>Data columns (total 58 columns):<br/> #   Column                                            Dtype         <br/>---  ------                                            -----         <br/> 0   date_block_num                                    int64         <br/> 1   item_id                                           int64         <br/> 2   shop_id                                           int64         <br/> 3   target                                            float64       <br/> 4   item_name                                         object        <br/> 5   item_category_id                                  int64         <br/> 6   Category_type                                     object        <br/> 7   City                                              object        <br/> 8   Month_End_Date                                    datetime64[ns]<br/> 9   Number_of_Mondays                                 int64         <br/> 10  Number_of_Tuesdays                                int64         <br/> 11  Number_of_Wednesdays                              int64         <br/> 12  Number_of_Thursdays                               int64         <br/> 13  Number_of_Fridays                                 int64         <br/> 14  Number_of_Saturdays                               int64         <br/> 15  Number_of_Sundays                                 int64         <br/> 16  Year                                              int64         <br/> 17  Month                                             int64         <br/> 18  Days_in_Month                                     int64         <br/> 19  min_item_sale_date_block_num                      int64         <br/> 20  Months_Since_Item_First_Sold                      int64         <br/> 21  avg_first_months_sales_by_item_category_id        float64       <br/> 22  avg_first_months_sales_by_item_category_and_shop  float64       <br/> 23  target_lag_1                                      float64       <br/> 24  target_lag_2                                      float64       <br/> 25  target_lag_3                                      float64       <br/> 26  target_lag_4                                      float64       <br/> 27  target_lag_5                                      float64       <br/> 28  target_lag_6                                      float64       <br/> 29  target_lag_12                                     float64       <br/> 30  avg_monthly_by_item_lag_1                         float64       <br/> 31  avg_monthly_by_item_lag_2                         float64       <br/> 32  avg_monthly_by_item_lag_3                         float64       <br/> 33  avg_monthly_by_item_lag_6                         float64       <br/> 34  avg_monthly_by_item_lag_12                        float64       <br/> 35  avg_monthly_by_shop_lag_1                         float64       <br/> 36  avg_monthly_by_shop_lag_2                         float64       <br/> 37  avg_monthly_by_shop_lag_3                         float64       <br/> 38  avg_monthly_by_shop_lag_6                         float64       <br/> 39  avg_monthly_by_shop_lag_12                        float64       <br/> 40  avg_monthly_by_category_lag_1                     float64       <br/> 41  avg_monthly_by_category_lag_2                     float64       <br/> 42  avg_monthly_by_category_lag_3                     float64       <br/> 43  avg_monthly_by_category_lag_6                     float64       <br/> 44  avg_monthly_by_category_lag_12                    float64       <br/> 45  avg_monthly_by_city_lag_1                         float64       <br/> 46  avg_monthly_by_city_lag_2                         float64       <br/> 47  avg_monthly_by_city_lag_3                         float64       <br/> 48  avg_monthly_by_city_lag_6                         float64       <br/> 49  avg_monthly_by_city_lag_12                        float64       <br/> 50  item_price_lag_1                                  float64       <br/> 51  item_price_lag_2                                  float64       <br/> 52  item_price_lag_3                                  float64       <br/> 53  item_price_lag_4                                  float64       <br/> 54  item_price_lag_5                                  float64       <br/> 55  item_price_lag_6                                  float64       <br/> 56  target_3_month_avg                                float64       <br/> 57  target_6_month_avg                                float64       <br/>dtypes: datetime64[ns](1), float64(38), int64(16), object(3)<br/>memory usage: 7.6 GB</span></pre><p id="042a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">使用df.info，我们可以获得以下信息:</p><ul class=""><li id="826c" class="nc nd it lt b lu mn lx mo ma ne me nf mi ng mm nh ni nj nk bi translated">行数或条目数</li><li id="5e45" class="nc nd it lt b lu nl lx nm ma nn me no mi np mm nh ni nj nk bi translated">列数</li><li id="e62f" class="nc nd it lt b lu nl lx nm ma nn me no mi np mm nh ni nj nk bi translated">每列的索引和名称</li><li id="d777" class="nc nd it lt b lu nl lx nm ma nn me no mi np mm nh ni nj nk bi translated">每列的数据类型</li><li id="73df" class="nc nd it lt b lu nl lx nm ma nn me no mi np mm nh ni nj nk bi translated">数据帧的总内存使用量</li><li id="ae67" class="nc nd it lt b lu nl lx nm ma nn me no mi np mm nh ni nj nk bi translated">每种数据类型有多少列</li></ul><p id="8fc6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">仔细观察这个表，我们可以看到每个数据类型后面的数字说明了它们使用的位数。</p><p id="7208" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">由于其中许多被列为int64或float64，我们可能会将它们减少到更小的空间数据类型，如int16或float8。向下转换意味着我们将每个特性的数据类型减少到最低可能的类型。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="1659" class="mx la it mt b gy my mz l na nb">## downcasting loop<br/>for column in df:<br/> if df[column].dtype == ‘float64’:<br/> df[column]=pd.to_numeric(df[column], downcast=’float’)<br/> if df[column].dtype == ‘int64’:<br/> df[column]=pd.to_numeric(all_data[column], downcast=’integer’)</span><span id="afb0" class="mx la it mt b gy nq mz l na nb">## dropping an unused column<br/>df = df.drop('item_name',axis =1)</span></pre><p id="74ac" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们可以再次检查数据帧的大小。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="9928" class="mx la it mt b gy my mz l na nb">&lt;class 'pandas.core.frame.DataFrame'&gt;<br/>Int64Index: 11128050 entries, 0 to 11128049<br/>Data columns (total 57 columns):<br/> #   Column                                            Dtype         <br/>---  ------                                            -----         <br/> 0   date_block_num                                    int8          <br/> 1   item_id                                           int16         <br/> 2   shop_id                                           int8          <br/> 3   target                                            float32       <br/> 4   item_category_id                                  int8          <br/> 5   Category_type                                     object        <br/> 6   City                                              object        <br/> 7   Month_End_Date                                    datetime64[ns]<br/> 8   Number_of_Mondays                                 int8          <br/> 9   Number_of_Tuesdays                                int8          <br/> 10  Number_of_Wednesdays                              int8          <br/> 11  Number_of_Thursdays                               int8          <br/> 12  Number_of_Fridays                                 int8          <br/> 13  Number_of_Saturdays                               int8          <br/> 14  Number_of_Sundays                                 int8          <br/> 15  Year                                              int16         <br/> 16  Month                                             int8          <br/> 17  Days_in_Month                                     int8          <br/> 18  min_item_sale_date_block_num                      int8          <br/> 19  Months_Since_Item_First_Sold                      int8          <br/> 20  avg_first_months_sales_by_item_category_id        float32       <br/> 21  avg_first_months_sales_by_item_category_and_shop  float32       <br/> 22  target_lag_1                                      float32       <br/> 23  target_lag_2                                      float32       <br/> 24  target_lag_3                                      float32       <br/> 25  target_lag_4                                      float32       <br/> 26  target_lag_5                                      float32       <br/> 27  target_lag_6                                      float32       <br/> 28  target_lag_12                                     float32       <br/> 29  avg_monthly_by_item_lag_1                         float32       <br/> 30  avg_monthly_by_item_lag_2                         float32       <br/> 31  avg_monthly_by_item_lag_3                         float32       <br/> 32  avg_monthly_by_item_lag_6                         float32       <br/> 33  avg_monthly_by_item_lag_12                        float32       <br/> 34  avg_monthly_by_shop_lag_1                         float32       <br/> 35  avg_monthly_by_shop_lag_2                         float32       <br/> 36  avg_monthly_by_shop_lag_3                         float32       <br/> 37  avg_monthly_by_shop_lag_6                         float32       <br/> 38  avg_monthly_by_shop_lag_12                        float32       <br/> 39  avg_monthly_by_category_lag_1                     float32       <br/> 40  avg_monthly_by_category_lag_2                     float32       <br/> 41  avg_monthly_by_category_lag_3                     float32       <br/> 42  avg_monthly_by_category_lag_6                     float32       <br/> 43  avg_monthly_by_category_lag_12                    float32       <br/> 44  avg_monthly_by_city_lag_1                         float32       <br/> 45  avg_monthly_by_city_lag_2                         float32       <br/> 46  avg_monthly_by_city_lag_3                         float32       <br/> 47  avg_monthly_by_city_lag_6                         float32       <br/> 48  avg_monthly_by_city_lag_12                        float32       <br/> 49  item_price_lag_1                                  float32       <br/> 50  item_price_lag_2                                  float32       <br/> 51  item_price_lag_3                                  float32       <br/> 52  item_price_lag_4                                  float32       <br/> 53  item_price_lag_5                                  float32       <br/> 54  item_price_lag_6                                  float32       <br/> 55  target_3_month_avg                                float32       <br/> 56  target_6_month_avg                                float32       <br/>dtypes: datetime64[ns](1), float32(38), int16(2), int8(14), object(2)<br/>memory usage: 3.2 GB</span></pre><p id="9233" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们看到现在有几个8、16和32位的列，通过简单地更改数据类型，我们已经有效地将数据帧的大小减半。</p><p id="893f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">更有趣的是，dataframe的内存使用量下降到了3.2gb。这大约是我们刚开始时7.6gb的一半。通过这种类型的内存减少，我们可以将更多的数据加载到更小的机器上，最终降低成本。</p><h1 id="16d8" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="9810" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在本教程中，我们将1100万条记录数据集加载到熊猫数据帧中。我们学习了如何通过使用？pandas中的info()函数。这为我们提供了有用的信息，如行数和列数、数据帧的大小和内存使用情况以及每列的数据类型。</p><p id="ec0b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们学习了向下转换，我们用它将数据帧的大小减半，这样我们可以使用更少的内存，对数据做更多的事情。</p></div></div>    
</body>
</html>