<html>
<head>
<title>Explaining Scikit-learn models with SHAP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">è§£é‡Š sci kit-ä¸ SHAP ä¸€èµ·å­¦ä¹ æ¨¡å‹</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://towardsdatascience.com/explaining-scikit-learn-models-with-shap-61daff21b12a?source=collection_archive---------2-----------------------#2021-11-02">https://towardsdatascience.com/explaining-scikit-learn-models-with-shap-61daff21b12a?source=collection_archive---------2-----------------------#2021-11-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/1dde57815ca4574d8dc0ca69ae4ab7e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8bd-BYX528blFhTz"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">ç…§ç‰‡<a class="ae jg" href="https://unsplash.com/@marekpiwnicki?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">ç”± Marek Piwn </a> icki <a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">åœ¨ Unsp </a> lash ä¸Šæ‹æ‘„</p></figure><h2 id="5d00" class="jh ji jj bd b dl jk jl jm jn jo jp dk jq translated" aria-label="kicker paragraph">æ•°æ®ç§‘å­¦åŸºç¡€</h2><div class=""/><div class=""><h2 id="3c2e" class="pw-subtitle-paragraph kp js jj bd b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dk translated">èµ°å‘å¯è§£é‡Šçš„äººå·¥æ™ºèƒ½</h2></div><p id="1bd9" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><em class="md">å¯è§£é‡Šçš„äººå·¥æ™ºèƒ½(XAI) </em>é€šè¿‡ä½¿æœºå™¨å­¦ä¹ æ¨¡å‹æ›´åŠ é€æ˜ï¼Œå¸®åŠ©å»ºç«‹å¯¹å®ƒä»¬çš„ä¿¡ä»»å’Œä¿¡å¿ƒã€‚<a class="ae jg" href="https://cloud.google.com/blog/products/ai-machine-learning/why-you-need-to-explain-machine-learning-models" rel="noopener ugc nofollow" target="_blank"> XAI æ˜¯ä¸€å¥—å·¥å…·å’Œæ¡†æ¶ï¼Œå¯ç”¨äºç†è§£å’Œè§£é‡Šæœºå™¨å­¦ä¹ æ¨¡å‹å¦‚ä½•åšå‡ºå†³ç­–ã€‚ä¸€ä¸ªæœ‰ç”¨çš„ XAI å·¥å…·æ˜¯ Python ä¸­çš„ SHAP åº“ã€‚æ­¤å·¥å…·å…è®¸æˆ‘ä»¬é‡åŒ–ç‰¹å¾å¯¹å•ä¸ªé¢„æµ‹ä»¥åŠæ•´ä½“é¢„æµ‹çš„è´¡çŒ®ã€‚è¯¥åº“è¿˜å¸¦æœ‰ç¾è§‚æ˜“ç”¨çš„å¯è§†åŒ–åŠŸèƒ½ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹  SHAP åº“çš„åŸºç¡€çŸ¥è¯†ï¼Œä»¥ç†è§£æ¥è‡ª<em class="md"> Scikit-learn </em>ä¸­å†…ç½®çš„å›å½’å’Œåˆ†ç±»æ¨¡å‹çš„é¢„æµ‹ã€‚</a></p><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi me"><img src="../Images/e189fa5966c0e8a832302f2e716de6e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7SqYLrV19qcWtBOL"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">ç”±<a class="ae jg" href="https://unsplash.com/@lobostudiohamburg?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">æ±‰å ¡é¾™è™¾å·¥ä½œå®¤</a>åœ¨<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>æ‹æ‘„</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="b99b" class="mq mr jj bd ms mt mu mv mw mx my mz na ky nb kz nc lb nd lc ne le nf lf ng nh bi translated">1.å¤æ™®ä»·å€¼è§‚âœ¨</h1><blockquote class="ni nj nk"><p id="7cee" class="lh li md lj b lk ll kt lm ln lo kw lp nl lr ls lt nm lv lw lx nn lz ma mb mc im bi translated">å½¢çŠ¶å€¼å¸®åŠ©æˆ‘ä»¬é‡åŒ–<em class="jj">ç‰¹å¾å¯¹é¢„æµ‹çš„è´¡çŒ®</em>ã€‚Shap å€¼è¶Šæ¥è¿‘é›¶è¡¨ç¤ºè¯¥è¦ç´ å¯¹é¢„æµ‹çš„è´¡çŒ®è¶Šå°ï¼Œè€Œ shap å€¼è¿œç¦»é›¶è¡¨ç¤ºè¯¥è¦ç´ çš„è´¡çŒ®è¶Šå¤§ã€‚</p></blockquote><p id="a8cd" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">è®©æˆ‘ä»¬æ¥å­¦ä¹ å¦‚ä½•ä¸ºå›å½’é—®é¢˜æå–è¦ç´ çš„ shap å€¼ã€‚æˆ‘ä»¬å°†ä»åŠ è½½åº“å’Œæ ·æœ¬æ•°æ®å¼€å§‹ï¼Œç„¶åæ„å»ºä¸€ä¸ªå¿«é€Ÿæ¨¡å‹æ¥é¢„æµ‹ç³–å°¿ç—…è¿›å±•:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="5917" class="nt mr jj np b gy nu nv l nw nx">import numpy as np<br/>np.set_printoptions(formatter={'float':lambda x:"{:.4f}".format(x)})<br/>import pandas as pd<br/>pd.options.display.float_format = "{:.3f}".format</span><span id="3e20" class="nt mr jj np b gy ny nv l nw nx">import seaborn as sns<br/>import matplotlib.pyplot as plt<br/>sns.set(style='darkgrid', context='talk', palette='rainbow')</span><span id="93fd" class="nt mr jj np b gy ny nv l nw nx">from sklearn.datasets import load_diabetes<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.ensemble import (RandomForestRegressor, <br/>                              RandomForestClassifier)</span><span id="ef53" class="nt mr jj np b gy ny nv l nw nx">import shap # v0.39.0<br/>shap.initjs()</span><span id="d04b" class="nt mr jj np b gy ny nv l nw nx"># Import sample data<br/>diabetes = load_diabetes(as_frame=True)<br/>X = diabetes['data'].iloc[:, :4] # Select first 4 columns<br/>y = diabetes['target']</span><span id="4c6b" class="nt mr jj np b gy ny nv l nw nx"># Partition data<br/>X_train, X_test, y_train, y_test = train_test_split(X, y, <br/>                                                    test_size=0.2, <br/>                                                    random_state=1)<br/>print(f"Training features shape: {X_train.shape}")<br/>print(f"Training target shape: {y_train.shape}\n")<br/>print(f"Test features shape: {X_test.shape}")<br/>print(f"Test target shape: {y_test.shape}")<br/>display(X_train.head())</span><span id="34f1" class="nt mr jj np b gy ny nv l nw nx"># Train a simple model<br/>model = RandomForestRegressor(random_state=42)<br/>model.fit(X_train, y_train)</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/21f02ff5f6215f761a200fcc040601fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*nAybWM4ILCJsxE3ikkf1Kg.png"/></div></figure><p id="7a78" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">è·å– shap å€¼çš„ä¸€ä¸ªå¸¸è§æ–¹æ³•æ˜¯ä½¿ç”¨<a class="ae jg" href="https://shap.readthedocs.io/en/latest/generated/shap.Explainer.html" rel="noopener ugc nofollow" target="_blank">è§£é‡Šå™¨</a>å¯¹è±¡ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code class="fe oa ob oc np b">Explainer</code>å¯¹è±¡ï¼Œå¹¶ä¸ºæµ‹è¯•æ•°æ®æå–<code class="fe oa ob oc np b">shap_test</code>:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="8f5e" class="nt mr jj np b gy nu nv l nw nx">explainer = shap.Explainer(model)<br/>shap_test = explainer(X_test)<br/>print(f"Shap values length: {len(shap_test)}\n")<br/>print(f"Sample shap value:\n{shap_test[0]}")</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi od"><img src="../Images/3122394bafc64af7b7c6e53f2165e2fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*cgh4mDZ_LbvmjNIcOkY6mQ.png"/></div></figure><p id="cdba" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><code class="fe oa ob oc np b">shap_test</code>çš„é•¿åº¦æ˜¯ 89ï¼Œå› ä¸ºå®ƒåŒ…å«äº†æ¯ä¸ªæµ‹è¯•å®ä¾‹çš„è®°å½•ã€‚ä»ç¬¬ä¸€ä¸ªæµ‹è¯•è®°å½•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸‰ä¸ªå±æ€§:<br/> â—¼ <code class="fe oa ob oc np b">shap_test[0].base_values</code>:ç›®æ ‡çš„åŸºå€¼<br/> â—¼ <code class="fe oa ob oc np b">shap_test[0].data</code>:æ¯ä¸ªç‰¹æ€§çš„å€¼<br/> â—¼ <code class="fe oa ob oc np b">shap_test[0].values</code>:æ¯ä¸ªç‰¹æ€§çš„å½¢çŠ¶å€¼</p><p id="2cb8" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">è®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹è¿™äº›å±æ€§ä¸­çš„æ¯ä¸€ä¸ªå‘æˆ‘ä»¬å±•ç¤ºäº†ä»€ä¹ˆã€‚</p><h2 id="81d5" class="nt mr jj bd ms oe of dn mw og oh dp na lq oi oj nc lu ok ol ne ly om on ng jp bi translated">ğŸ“1.1 åŸºç¡€å€¼</h2><p id="accd" class="pw-post-body-paragraph lh li jj lj b lk oo kt lm ln op kw lp lq oq ls lt lu or lw lx ly os ma mb mc im bi translated"><em class="md">åŸºå€¼(</em> <code class="fe oa ob oc np b">shap_test.base_values</code> <em class="md"> ) </em>ï¼Œä¹Ÿç§°ä¸º<em class="md">æœŸæœ›å€¼(</em> <code class="fe oa ob oc np b">explainer.expected_value</code>)ï¼Œæ˜¯è®­ç»ƒæ•°æ®<em class="md">ä¸­çš„<em class="md">å¹³å‡ç›®æ ‡å€¼</em>ã€‚</em>æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ¥æ£€æŸ¥è¿™ä¸€ç‚¹:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="12c7" class="nt mr jj np b gy nu nv l nw nx">print(f"Expected value: {explainer.expected_value[0]:.1f}")<br/>print(f"Average target value (training data): {y_train.mean():.1f}")<br/>print(f"Base value: {np.unique(shap_test.base_values)[0]:.1f}")</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/b7828127dcdeffb3a7e985864e33ccaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*SH7qqV7cswuzzgE7hbdSXw.png"/></div></figure><p id="779e" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">å› æ­¤ï¼Œæˆ‘ä»¬å°†äº’æ¢ä½¿ç”¨è¯è¯­<em class="md">æœŸæœ›å€¼</em>å’Œ<em class="md">åŸºç¡€å€¼</em>ã€‚</p><h2 id="b9b9" class="nt mr jj bd ms oe of dn mw og oh dp na lq oi oj nc lu ok ol ne ly om on ng jp bi translated">ğŸ“¦ 1.2.æ•°æ®</h2><p id="c782" class="pw-post-body-paragraph lh li jj lj b lk oo kt lm ln op kw lp lq oq ls lt lu or lw lx ly os ma mb mc im bi translated">æ¥ä¸‹æ¥ï¼Œ<code class="fe oa ob oc np b">shap_test.data</code>åŒ…å«ä¸<code class="fe oa ob oc np b">X_test</code>ç›¸åŒçš„å€¼:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="14e1" class="nt mr jj np b gy nu nv l nw nx">(shap_test.data == X_test).describe()</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/0ed7940bf84f7704e3f3acd81699875f.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*V-zcxwymOoVhQpKESK-M0g.png"/></div></figure><p id="ba69" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">è®©æˆ‘ä»¬æŠŠå®ƒè½¬æ¢æˆæ•°æ®å¸§æ¥çœ‹çœ‹:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="1713" class="nt mr jj np b gy nu nv l nw nx">pd.DataFrame(shap_test.data, columns=shap_test.feature_names, <br/>             index=X_test.index)</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/920d87c87e544a3898aaa09c28b064a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:550/format:webp/1*BoHeSJut3Z5JUYglhx6iNg.png"/></div></figure><p id="5b4e" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">è¿™åªæ˜¯æˆ‘ä»¬ä¼ é€’ç»™å®ƒçš„æ•°æ®é›†çš„å‰¯æœ¬ã€‚</p><h2 id="7a07" class="nt mr jj bd ms oe of dn mw og oh dp na lq oi oj nc lu ok ol ne ly om on ng jp bi translated">âœ¨ 1.3.ä»·å€¼è§‚å¿µ</h2><p id="fdd8" class="pw-post-body-paragraph lh li jj lj b lk oo kt lm ln op kw lp lq oq ls lt lu or lw lx ly os ma mb mc im bi translated">æ¥è‡ª<code class="fe oa ob oc np b">shap_test</code>çš„æœ€é‡è¦çš„å±æ€§æ˜¯<code class="fe oa ob oc np b">values</code>å±æ€§ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å¯ä»¥ä»ä¸­è®¿é—® shap å€¼ã€‚è®©æˆ‘ä»¬å°† shap å€¼è½¬æ¢æˆæ•°æ®å¸§ï¼Œä»¥ä¾¿äºæ“ä½œ:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="1961" class="nt mr jj np b gy nu nv l nw nx">shap_df = pd.DataFrame(shap_test.values, <br/>                       columns=shap_test.feature_names, <br/>                       index=X_test.index)<br/>shap_df</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/51ed3db46d236db256a8ef2c584707c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:594/format:webp/1*6ndtP0C_rUeeE5TTjeVX5g.png"/></div></figure><p id="34a7" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸ªè®°å½•çš„ shap å€¼ã€‚å¦‚æœæˆ‘ä»¬æŠŠè¿™äº› shap å€¼åŠ åˆ°æœŸæœ›å€¼ä¸Šï¼Œæˆ‘ä»¬å°†å¾—åˆ°é¢„æµ‹:</p><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/4113f6b6c91b6f8a409abccada68057a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*5BxjpcnNIIWkMCjgLzt1pg.png"/></div></figure><p id="7548" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">æˆ‘ä»¬æ¥çœ‹çœ‹æ˜¯ä¸æ˜¯è¿™æ ·:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="ebf8" class="nt mr jj np b gy nu nv l nw nx">np.isclose(model.predict(X_test), <br/>           explainer.expected_value[0] + shap_df.sum(axis=1))</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/2c991e19931e5b3703d64ddb998caf76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*SeCn-51fGRLp3nh5PKDfSA.png"/></div></figure><p id="ae8d" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">å‰å®³ï¼è¿™é‡Œæˆ‘ä»¬ç”¨<code class="fe oa ob oc np b">np.isclose()</code>å¿½ç•¥<a class="ae jg" href="https://stackoverflow.com/questions/2100490/floating-point-inaccuracy-examples" rel="noopener ugc nofollow" target="_blank">æµ®ç‚¹ä¸å‡†ç¡®</a>ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº† shap å€¼ï¼Œæˆ‘ä»¬å¯ä»¥åƒè¿™æ ·è¿›è¡Œè‡ªå®šä¹‰å¯è§†åŒ–ï¼Œä»¥äº†è§£ç‰¹æ€§è´¡çŒ®:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="8393" class="nt mr jj np b gy nu nv l nw nx">columns = shap_df.apply(np.abs).mean()\<br/>                 .sort_values(ascending=False).index</span><span id="eb98" class="nt mr jj np b gy ny nv l nw nx">fig, ax = plt.subplots(1, 2, figsize=(11,4))<br/>sns.barplot(data=shap_df[columns].apply(np.abs), orient='h', <br/>            ax=ax[0])<br/>ax[0].set_title("Mean absolute shap value")<br/>sns.boxplot(data=shap_df[columns], orient='h', ax=ax[1])<br/>ax[1].set_title("Distribution of shap values");</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/6fa209019bbd8e128a98b38ac95823d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*-0pGJ9tdnYQ0pMooXgPZ2w.png"/></div></figure><p id="8fd8" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">å·¦ä¾§å­å›¾æ˜¾ç¤ºäº†æ¯ä¸ªç‰¹å¾çš„å¹³å‡ç»å¯¹å½¢çŠ¶å€¼ï¼Œè€Œå³ä¾§å­å›¾æ˜¾ç¤ºäº†å½¢çŠ¶å€¼æŒ‰ç‰¹å¾çš„åˆ†å¸ƒã€‚ä»è¿™äº›å›¾è¡¨ä¸­å¯ä»¥çœ‹å‡º,<code class="fe oa ob oc np b">bmi</code>åœ¨ä½¿ç”¨çš„ 4 ä¸ªç‰¹æ€§ä¸­è´¡çŒ®æœ€å¤§ã€‚</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="e1d5" class="mq mr jj bd ms mt mu mv mw mx my mz na ky nb kz nc lb nd lc ne le nf lf ng nh bi translated">2.å½¢çŠ¶å†…ç½®å›¾ğŸ“Š</h1><p id="e5b4" class="pw-post-body-paragraph lh li jj lj b lk oo kt lm ln op kw lp lq oq ls lt lu or lw lx ly os ma mb mc im bi translated">è™½ç„¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ shap å€¼æ„å»ºæˆ‘ä»¬è‡ªå·±çš„å¯è§†åŒ–ï¼Œä½†æ˜¯<code class="fe oa ob oc np b">shap </code>åŒ…å¸¦æœ‰å†…ç½®çš„å¥‡ç‰¹çš„å¯è§†åŒ–ã€‚åœ¨è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°†ç†Ÿæ‚‰è¿™äº›è§‚æƒ³ä¸­çš„ä¸€äº›ç²¾é€‰ã€‚æˆ‘ä»¬å°†ä¼šçœ‹åˆ°ä¸¤ç§ä¸»è¦çš„æƒ…èŠ‚ğŸŒ³<strong class="lj jt">å…¨å±€:</strong>æ˜¾ç¤ºç‰¹å¾æ€»ä½“è´¡çŒ®çš„å›¾å½¢ã€‚è¿™ç§å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªç‰¹å¾å¯¹æ•´ä¸ªæ•°æ®çš„æ€»ä½“è´¡çŒ®ã€‚<br/>ğŸ€<strong class="lj jt">å±€éƒ¨:</strong>æ˜¾ç¤ºç‰¹å®šå®ä¾‹ä¸­ç‰¹å¾è´¡çŒ®çš„å›¾ã€‚è¿™æœ‰åŠ©äºæˆ‘ä»¬æ·±å…¥äº†è§£å•ä¸ªé¢„æµ‹ã€‚</p><h2 id="008f" class="nt mr jj bd ms oe of dn mw og oh dp na lq oi oj nc lu ok ol ne ly om on ng jp bi translated">ğŸŒ³ 2.1.å…¨å±€|æ¡å½¢å›¾</h2><p id="13f8" class="pw-post-body-paragraph lh li jj lj b lk oo kt lm ln op kw lp lq oq ls lt lu or lw lx ly os ma mb mc im bi translated">å¯¹äºå‰é¢æ˜¾ç¤ºçš„å·¦ä¾§å­å›¾ï¼Œæœ‰ä¸€ä¸ªç­‰æ•ˆçš„å†…ç½®å‡½æ•°ï¼Œåªéœ€å‡ æ¬¡å‡»é”®:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="1e4d" class="nt mr jj np b gy nu nv l nw nx">shap.plots.bar(shap_test)</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/dd3c87a75de991b3c268c25aecb5467e.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*RycQbrtJA9114qvIQh-9zw.png"/></div></figure><p id="a26f" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">è¿™ä¸ªç®€å•ä½†æœ‰ç”¨çš„å›¾æ˜¾ç¤ºäº†ç‰¹æ€§è´¡çŒ®çš„å¼ºåº¦ã€‚è¯¥å›¾åŸºäºç‰¹å¾çš„å¹³å‡ç»å¯¹å½¢çŠ¶å€¼:<code class="fe oa ob oc np b">shap_df.apply(np.abs).mean()</code>ã€‚è¦ç´ ä»ä¸Šåˆ°ä¸‹æ’åˆ—ï¼Œå…·æœ‰æœ€é«˜å¹³å‡ç»å¯¹å½¢çŠ¶å€¼çš„è¦ç´ æ˜¾ç¤ºåœ¨é¡¶éƒ¨ã€‚</p><h2 id="832b" class="nt mr jj bd ms oe of dn mw og oh dp na lq oi oj nc lu ok ol ne ly om on ng jp bi translated">ğŸŒ³ 2.2.å…¨å±€|æ±‡æ€»å›¾</h2><p id="4859" class="pw-post-body-paragraph lh li jj lj b lk oo kt lm ln op kw lp lq oq ls lt lu or lw lx ly os ma mb mc im bi translated">å¦ä¸€ä¸ªæœ‰ç”¨çš„æƒ…èŠ‚æ˜¯æ‘˜è¦æƒ…èŠ‚:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="e14a" class="nt mr jj np b gy nu nv l nw nx">shap.summary_plot(shap_test)</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/05fac7effd1e15aa7a530c0e94d1d294.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*C6ubQH7ufzP17UdNHZ7qSg.png"/></div></figure><p id="262d" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">è¿™é‡Œæœ‰ä¸€ä¸ªæ›¿ä»£è¯­æ³•:<code class="fe oa ob oc np b">shap.plots.beeswarm(shap_test)</code>ç”¨äºè¿™ä¸ªå…·ä½“çš„æƒ…èŠ‚ã€‚ä¸ä¹‹å‰ä¸€æ ·ï¼Œè¦ç´ æŒ‰å…¶å¹³å‡ç»å¯¹å½¢çŠ¶å€¼æ’åºã€‚ä¸ä¹‹å‰çš„æ¡å½¢å›¾ç›¸æ¯”ï¼Œæ­¤å›¾è¡¨æ›´åŠ å¤æ‚ï¼ŒåŒ…å«æ›´å¤šä¿¡æ¯ã€‚ä¸‹é¢æ˜¯è§£é‡Šè¯¥å›¾çš„æŒ‡å—:<br/> â—¼ï¸ <strong class="lj jt">å›¾çš„æ¨ªè½´</strong>æ˜¾ç¤ºäº†ç‰¹å¾çš„ shap å€¼åˆ†å¸ƒã€‚æ¯ä¸ªç‚¹ä»£è¡¨æ•°æ®é›†ä¸­çš„ä¸€æ¡è®°å½•ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯¹äº<code class="fe oa ob oc np b">bmi</code>ï¼Œç‚¹éå¸¸åˆ†æ•£ï¼Œåœ¨ 0 é™„è¿‘å‡ ä¹æ²¡æœ‰ä»»ä½•ç‚¹ï¼Œè€Œå¯¹äº<code class="fe oa ob oc np b">age</code>ï¼Œç‚¹æ›´é è¿‘ 0 èšé›†ã€‚<br/> â—¼ï¸ <strong class="lj jt">ç‚¹çš„é¢œè‰²</strong>æ˜¾ç¤ºç‰¹å¾å€¼ã€‚è¿™ä¸ªé¢å¤–çš„ç»´åº¦å…è®¸æˆ‘ä»¬çœ‹åˆ° shap å€¼å¦‚ä½•éšç€ç‰¹å¾å€¼çš„æ”¹å˜è€Œæ”¹å˜ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…³ç³»çš„æ–¹å‘ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“<code class="fe oa ob oc np b">bmi</code>ä¸ºé«˜æ—¶ï¼Œshap å€¼å¾€å¾€è¾ƒé«˜(ç”±ç²‰çº¢è‰²åœ†ç‚¹è¡¨ç¤º)ï¼Œå½“<code class="fe oa ob oc np b">bmi</code>ä¸ºä½æ—¶ï¼Œshap å€¼å¾€å¾€è¾ƒä½(ç”±è“è‰²åœ†ç‚¹è¡¨ç¤º)ã€‚è¿˜æœ‰ä¸€äº›ç´«è‰²çš„ç‚¹åˆ†æ•£åœ¨å…‰è°±ä¸­ã€‚</p><p id="f75e" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">å¦‚æœæˆ‘ä»¬å‘ç°é»˜è®¤é¢œè‰²å›¾ä¸ç›´è§‚æˆ–ä¸åˆé€‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ›´æ”¹ä¸ºæˆ‘ä»¬é¦–é€‰çš„<a class="ae jg" href="https://matplotlib.org/stable/tutorials/colors/colormaps.html" rel="noopener ugc nofollow" target="_blank"> matplotlib é¢œè‰²å›¾</a>ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="96ad" class="nt mr jj np b gy nu nv l nw nx">shap.summary_plot(shap_test, cmap=plt.get_cmap("winter_r"))</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/8ec1fbe4158cbaf9c1259065f8008c0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*x9mgwmAYbUkULSKNIY6fnQ.png"/></div></figure><p id="cc22" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ä¸åŒçš„ç»˜å›¾ç±»å‹ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="aeb4" class="nt mr jj np b gy nu nv l nw nx">shap.summary_plot(shap_test, plot_type='violin')</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/263dcdb48d3cc85d4db9a692eedb87e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*sOWvleFfebLoXjqIWe1Y7w.png"/></div></figure><h2 id="f84a" class="nt mr jj bd ms oe of dn mw og oh dp na lq oi oj nc lu ok ol ne ly om on ng jp bi translated">ğŸŒ³ 2.3.å…¨çƒ|çƒ­å›¾</h2><p id="f687" class="pw-post-body-paragraph lh li jj lj b lk oo kt lm ln op kw lp lq oq ls lt lu or lw lx ly os ma mb mc im bi translated">çƒ­å›¾æ˜¯å¯è§†åŒ– shap å€¼çš„å¦ä¸€ç§æ–¹å¼ã€‚æˆ‘ä»¬çœ‹åˆ°çš„æ˜¯å½©è‰²ç¼–ç çš„å•ä¸ªå€¼ï¼Œè€Œä¸æ˜¯å°†å½¢çŠ¶å€¼èšåˆæˆä¸€ä¸ªå¹³å‡å€¼ã€‚ç‰¹å¾æ ‡ç»˜åœ¨ y è½´ä¸Šï¼Œè®°å½•æ ‡ç»˜åœ¨ x è½´ä¸Š:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="2475" class="nt mr jj np b gy nu nv l nw nx">shap.plots.heatmap(shap_test)</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/00f219c6a96b357b0c6e9f9cd7dc2939.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*c_5V2c3qQiG1ccUYVRe7ow.png"/></div></figure><p id="3d48" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">è¯¥çƒ­å›¾ç”±é¡¶éƒ¨æ¯ä¸ªè®°å½•çš„é¢„æµ‹å€¼(å³<code class="fe oa ob oc np b">f(x)</code>)çš„çº¿å›¾è¡¥å……ã€‚</p><p id="8e0c" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code class="fe oa ob oc np b">cmap</code>å‚æ•°å°†é¢œè‰²å›¾æ›´æ”¹ä¸ºæˆ‘ä»¬æƒ³è¦çš„é¢œè‰²å›¾:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="a0a8" class="nt mr jj np b gy nu nv l nw nx">shap.plots.heatmap(shap_test, cmap=plt.get_cmap("winter_r"))</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/e85fc04693a2356e503a65f997cef643.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*pjZXmJvS-xUnTLkBmjWwxA.png"/></div></figure><h2 id="4e60" class="nt mr jj bd ms oe of dn mw og oh dp na lq oi oj nc lu ok ol ne ly om on ng jp bi translated">ğŸŒ³ 2.4.å…¨å±€|åŠ›å›¾</h2><p id="4f02" class="pw-post-body-paragraph lh li jj lj b lk oo kt lm ln op kw lp lq oq ls lt lu or lw lx ly os ma mb mc im bi translated">è¿™ä¸ªäº¤äº’å›¾è®©æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç”±è®°å½•æ„æˆçš„ shap å€¼:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="1585" class="nt mr jj np b gy nu nv l nw nx">shap.force_plot(explainer.expected_value, shap_test.values, <br/>                X_test)</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/2229c2b5792a13712a843880d5546187.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*ciMuXASd89oEYyycT8JdQw.png"/></div></figure><p id="3cd5" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">å°±åƒçƒ­å›¾ä¸€æ ·ï¼Œx è½´æ˜¾ç¤ºæ¯æ¡è®°å½•ã€‚æ­£çš„å½¢çŠ¶å€¼æ˜¾ç¤ºä¸ºçº¢è‰²ï¼Œè´Ÿçš„å½¢çŠ¶å€¼æ˜¾ç¤ºä¸ºè“è‰²ã€‚ä¾‹å¦‚ï¼Œç”±äºç¬¬ä¸€æ¡è®°å½•çš„çº¢è‰²æˆåˆ†æ¯”è“è‰²æˆåˆ†å¤šï¼Œå› æ­¤è¿™æ¡è®°å½•çš„é¢„æµ‹å€¼å°†é«˜äºé¢„æœŸå€¼ã€‚</p><p id="3be6" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">äº¤äº’æ€§å…è®¸æˆ‘ä»¬æ”¹å˜ä¸¤ä¸ªè½´ã€‚ä¾‹å¦‚ï¼Œy è½´æ˜¾ç¤ºé¢„æµ‹ï¼Œ<code class="fe oa ob oc np b">f(x)</code>ï¼Œx è½´æŒ‰ä¸Šé¢å¿«ç…§ä¸­çš„è¾“å‡º(é¢„æµ‹)å€¼æ’åºã€‚</p><h2 id="7e68" class="nt mr jj bd ms oe of dn mw og oh dp na lq oi oj nc lu ok ol ne ly om on ng jp bi translated">ğŸ€ 2.5.å±€éƒ¨|æ¡å½¢å›¾</h2><p id="d4a1" class="pw-post-body-paragraph lh li jj lj b lk oo kt lm ln op kw lp lq oq ls lt lu or lw lx ly os ma mb mc im bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬å°†é€šè¿‡å›¾è¡¨æ¥ç†è§£ä¸ªåˆ«æƒ…å†µä¸‹çš„é¢„æµ‹ã€‚è®©æˆ‘ä»¬ä»æŸ±çŠ¶å›¾å¼€å§‹:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="d9c2" class="nt mr jj np b gy nu nv l nw nx">shap.plots.bar(shap_test[0])</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/6b205e52197edf2b153c89107986557a.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*jLibMUFMj1gcXMV4PK50Gw.png"/></div></figure><p id="5e91" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">è¯­æ³•ä¸<em class="md">ç¬¬ 2.1 èŠ‚ä¸­çš„å®Œå…¨ç›¸åŒã€‚Global | Bar plot' </em>é™¤äº†è¿™æ¬¡æˆ‘ä»¬å¯¹å•ä¸ªè®°å½•çš„æ•°æ®è¿›è¡Œåˆ‡ç‰‡ã€‚</p><h2 id="da29" class="nt mr jj bd ms oe of dn mw og oh dp na lq oi oj nc lu ok ol ne ly om on ng jp bi translated">ğŸ€ 2.6.å±€éƒ¨|ç€‘å¸ƒå›¾</h2><p id="0a77" class="pw-post-body-paragraph lh li jj lj b lk oo kt lm ln op kw lp lq oq ls lt lu or lw lx ly os ma mb mc im bi translated">è¿™æ˜¯æ¡å½¢å›¾çš„å¦ä¸€ç§æ›¿ä»£å½¢å¼:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="4967" class="nt mr jj np b gy nu nv l nw nx">class WaterfallData():<br/>    def __init__ (self, shap_test, index):<br/>        self.values = shap_test[index].values<br/>        self.base_values = shap_test[index].base_values[0]<br/>        self.data = shap_test[index].data<br/>        self.feature_names = shap_test.feature_names</span><span id="c5e8" class="nt mr jj np b gy ny nv l nw nx">shap.plots.waterfall(WaterfallData(shap_test, 0))</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/3113e010fbf06473bad55276f36fdea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*2DaTkx_B4KcXu-97U5Fusw.png"/></div></figure><p id="164e" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">ç€‘å¸ƒå›¾æ˜¯ä¿¡æ¯å¯†é›†çš„ï¼Œæœ‰å››ä½ä¿¡æ¯:<br/> â—¼ï¸åœ¨ y è½´ä¸Šï¼Œæˆ‘ä»¬çœ‹åˆ°è®°å½•çš„å®é™…ç‰¹å¾å€¼ã€‚å¦‚æœæ‚¨ä¸ç¡®å®šæˆ‘çš„æ„æ€ï¼Œè¯·å°†<code class="fe oa ob oc np b">X_test.head(1)</code>ä¸ y è½´ä¸Šçš„å€¼è¿›è¡Œæ¯”è¾ƒã€‚<br/> â—¼ï¸åœ¨å›¾è¡¨çš„å³ä¸‹è§’ï¼Œæˆ‘ä»¬çœ‹åˆ°<code class="fe oa ob oc np b">E[f(X)]</code>ï¼Œé¢„æœŸå€¼ã€‚<br/> â—¼ï¸åœ¨å·¦ä¸Šè§’ï¼Œæˆ‘ä»¬çœ‹åˆ°<code class="fe oa ob oc np b">f(x)</code>ï¼Œé¢„æµ‹å€¼ã€‚<br/> â—¼ï¸ ï¸Just åƒå‰é¢çš„æŸ±çŠ¶å›¾ä¸€æ ·ï¼Œæ¨ªæ¡ä»£è¡¨é¢œè‰²ç¼–ç çš„ç‰¹å¾è´¡çŒ®ã€‚ä»åº•éƒ¨çš„æœŸæœ›å€¼å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸ªè´¡çŒ®æ˜¯å¦‚ä½•ä¸Šä¸‹ç§»åŠ¨é¢„æµ‹å€¼ä»¥æœ€ç»ˆè¾¾åˆ°é¢„æµ‹å€¼çš„ã€‚</p><h2 id="8dc3" class="nt mr jj bd ms oe of dn mw og oh dp na lq oi oj nc lu ok ol ne ly om on ng jp bi translated">ğŸ€ 2.7.å±€éƒ¨|åŠ›å›¾</h2><p id="d8e2" class="pw-post-body-paragraph lh li jj lj b lk oo kt lm ln op kw lp lq oq ls lt lu or lw lx ly os ma mb mc im bi translated">æœ€åä¸€ä¸ªè¦ç†Ÿæ‚‰çš„å›¾æ˜¯å•ä¸ªè®°å½•çš„åŠ›å›¾ã€‚å¦‚æœæˆ‘ä»¬å°†è¯¥å›¾æ—‹è½¬ 90 åº¦å¹¶ç»˜åˆ¶å¤šä¸ªè®°å½•ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å…¨å±€åŠ›å›¾ã€‚</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="8f5b" class="nt mr jj np b gy nu nv l nw nx">shap.plots.force(shap_test[0])</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/4dedbdd1fcbc26d646b3ba892517963f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*uJY7cGMJWzqKaZzq5EdYCA.png"/></div></figure><p id="6af8" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">æˆ‘ä»¬æ—¢å¯ä»¥çœ‹åˆ°åŸºç¡€å€¼:153.4ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°é¢„æµ‹å€¼:103.48ã€‚æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ç‰¹æ€§è´¡çŒ®çš„åˆ†è§£ã€‚</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="e62f" class="mq mr jj bd ms mt mu mv mw mx my mz na ky nb kz nc lb nd lc ne le nf lf ng nh bi translated">3.è°ƒæ•´åˆ†ç±»ğŸŒ“</h1><p id="d2ea" class="pw-post-body-paragraph lh li jj lj b lk oo kt lm ln op kw lp lq oq ls lt lu or lw lx ly os ma mb mc im bi translated">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å…³æ³¨äº†ä¸€ä¸ªå›å½’ç¤ºä¾‹ã€‚åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ ä¸€ç§æ–¹æ³•æ¥è°ƒæ•´æˆ‘ä»¬æ‰€å­¦çš„å†…å®¹ä»¥é€‚åº”äºŒå…ƒåˆ†ç±»ã€‚è®©æˆ‘ä»¬å¯¼å…¥ titanic æ•°æ®çš„å­é›†å¹¶è®­ç»ƒä¸€ä¸ªç®€å•çš„æ¨¡å‹:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="f2f1" class="nt mr jj np b gy nu nv l nw nx"># Import sample data<br/>df =  sns.load_dataset('titanic')<br/>df['is_male'] = df['sex'].map({'male': 1, 'female': 0}) # Encode<br/># Keep numerical complete columns<br/>df = df.select_dtypes('number').dropna() <br/>X = df.drop(columns=['survived'])<br/>y = df['survived']</span><span id="c4cc" class="nt mr jj np b gy ny nv l nw nx"># Partition data<br/>X_train, X_test, y_train, y_test = train_test_split(X, y, <br/>                                                    test_size=0.2, <br/>                                                    random_state=1)</span><span id="ce0f" class="nt mr jj np b gy ny nv l nw nx">print(f"Training features shape: {X_train.shape}")<br/>print(f"Training target shape: {y_train.shape}\n")<br/>print(f"Test features shape: {X_test.shape}")<br/>print(f"Test target shape: {y_test.shape}")<br/>display(X_train.head())</span><span id="86f7" class="nt mr jj np b gy ny nv l nw nx"># Train a simple model<br/>model = RandomForestClassifier(random_state=42)<br/>model.fit(X_train, y_train)</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/bc1a2c94e977a85c1c7d51e91867670c.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*G6dvCcDIScsDhBc-S_vmUQ.png"/></div></figure><h2 id="a611" class="nt mr jj bd ms oe of dn mw og oh dp na lq oi oj nc lu ok ol ne ly om on ng jp bi translated">âœ¨ 3.1.å½¢çŠ¶å€¼</h2><p id="1bca" class="pw-post-body-paragraph lh li jj lj b lk oo kt lm ln op kw lp lq oq ls lt lu or lw lx ly os ma mb mc im bi translated">æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªè§£é‡Šå™¨å¯¹è±¡ï¼Œå¹¶åƒå‰é¢ä¸€æ ·æå– shap å€¼:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="856f" class="nt mr jj np b gy nu nv l nw nx">explainer = shap.Explainer(model)<br/>shap_test = explainer(X_test)<br/>print(f"Length of shap_test: {len(shap_test)}\n")<br/>print(f"Sample shap_test:\n{shap_test[0]}")</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/edfb2dbb734f38fcb0dde4298466c563.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*99YKLa-HVvk2KFQWEO-sgg.png"/></div></figure><p id="4012" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">å°±åƒå›å½’<code class="fe oa ob oc np b">shap_test.data</code>å°†åŒ…å«ä¸<code class="fe oa ob oc np b">X_test</code>ç›¸åŒæ•°é‡çš„è®°å½•ã€‚ä½†æ˜¯ï¼Œä»è¿™ä¸ªç¤ºä¾‹è®°å½•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code class="fe oa ob oc np b">values </code>å’Œ<code class="fe oa ob oc np b">base_values</code>çš„å°ºå¯¸ä¸åŒã€‚</p><p id="52b4" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹åŸºå€¼ã€‚åŸºå€¼ç°åœ¨å‘Šè¯‰æˆ‘ä»¬æ¯ä¸ªç±»çš„æ¦‚ç‡ã€‚æˆ‘ä»¬å°†å…³æ³¨ç§¯æç±»(å³<code class="fe oa ob oc np b">y==1</code>ï¼Œç”Ÿå­˜):</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="af10" class="nt mr jj np b gy nu nv l nw nx">print(f"Expected value: {explainer.expected_value[1]:.2f}")<br/>print(f"Average target value (training data): {y_train.mean():.2f}")<br/>print(f"Base value: {np.unique(shap_test.base_values)[0]:.2f}")</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/8ee01cf1e49988a86a04db2d0dde31a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*ERyP5NaPXn9bqvLQG4XYbA.png"/></div></figure><p id="82f9" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ shap å€¼ã€‚è¿˜ä¸ºè¿™ä¸¤ä¸ªç±»æä¾›äº† Shap å€¼ã€‚ä½ ä¹Ÿä¼šæ³¨æ„åˆ°å®ƒä»¬æ˜¯å½¼æ­¤çš„åé¢ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·æå–æ­£ç±»çš„ shap å€¼:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="dc45" class="nt mr jj np b gy nu nv l nw nx">shap_df = pd.DataFrame(shap_test.values[:,:,1], <br/>                       columns=shap_test.feature_names, <br/>                       index=X_test.index)<br/>shap_df</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pl"><img src="../Images/f42c245a460c769391953a3a566356dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*VQTkkNn0S3zWm5YRgWPwIw.png"/></div></div></figure><p id="6d84" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">è®©æˆ‘ä»¬ä»”ç»†æ£€æŸ¥ä¸€ä¸‹å°† shap å€¼çš„æ€»å’ŒåŠ åˆ°é¢„æœŸæ¦‚ç‡ä¸Šæ˜¯å¦ä¼šå¾—åˆ°é¢„æµ‹æ¦‚ç‡:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="df80" class="nt mr jj np b gy nu nv l nw nx">np.isclose(model.predict_proba(X_test)[:,1], <br/>           explainer.expected_value[1] + shap_df.sum(axis=1))</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/34779d38569374fd21a03bd233173f49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*Fi8FADBzWeKnqwgnD8QC7g.png"/></div></figure><p id="d415" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">å¤ªæ£’äº†ï¼Œç°åœ¨ä½ çŸ¥é“å¦‚ä½•å¾—åˆ°æ¦‚ç‡å•ä½çš„ shap å€¼äº†ã€‚</p><h2 id="c1e0" class="nt mr jj bd ms oe of dn mw og oh dp na lq oi oj nc lu ok ol ne ly om on ng jp bi translated">ğŸ“Š 3.2.å½¢çŠ¶å†…ç½®å›¾</h2><p id="16f7" class="pw-post-body-paragraph lh li jj lj b lk oo kt lm ln op kw lp lq oq ls lt lu or lw lx ly os ma mb mc im bi translated">æ˜¯æ—¶å€™è°ƒæ•´æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„æƒ…èŠ‚äº†ã€‚ä¸ºäº†é¿å…é‡å¤ï¼Œæˆ‘å°†å±•ç¤ºä¸€ä¸ªå…¨å±€å›¾çš„ç¤ºä¾‹å’Œä¸€ä¸ªå±€éƒ¨å›¾çš„ç¤ºä¾‹ï¼Œå› ä¸ºå…¶ä»–å›¾å¯ä»¥ä½¿ç”¨ç›¸åŒçš„é€»è¾‘æ¥å¤åˆ¶ã€‚</p><p id="89ba" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj jt">å…¨å±€|æ¡å½¢å›¾:</strong>è®©æˆ‘ä»¬æ£€æŸ¥ç‰¹å¾å¯¹é¢„æµ‹æ­£ç±»çš„æ€»ä½“è´¡çŒ®:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="baca" class="nt mr jj np b gy nu nv l nw nx">shap.plots.bar(shap_test[:,:,1])</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/bb2fc7119b1bdbe2ccf944da46880e5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*3QC7Vd5tjpNvF4nM8sn0lQ.png"/></div></figure><p id="cf5e" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj jt">å±€éƒ¨|ç€‘å¸ƒå›¾:</strong>æˆ‘ä»¬æ¥çœ‹çœ‹ç¬¬ä¸€ä¸ªæµ‹è¯•è®°å½•çš„ç€‘å¸ƒå›¾:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="04ca" class="nt mr jj np b gy nu nv l nw nx">shap.plots.waterfall(shap_test[:,:,1][0])</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi po"><img src="../Images/b7fc8e1b758a2e5c1cadfbc820f70fbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*Qnesupowgj541YTXrvJmPw.png"/></div></figure><p id="df5f" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">ä»è¿™ä¸ªå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸ªç‰¹å¾æ˜¯å¦‚ä½•å¯¹å±äºæ­£ç±»çš„é¢„æµ‹æ¦‚ç‡åšå‡ºè´¡çŒ®çš„:å¯¹äºè¿™ä¸ªè®°å½•æ˜¯ 0.98ã€‚</p><h2 id="2587" class="nt mr jj bd ms oe of dn mw og oh dp na lq oi oj nc lu ok ol ne ly om on ng jp bi translated">ğŸ“ 3.3.ä½¿ç”¨æ¡ˆä¾‹</h2><p id="8f44" class="pw-post-body-paragraph lh li jj lj b lk oo kt lm ln op kw lp lq oq ls lt lu or lw lx ly os ma mb mc im bi translated">åœ¨æˆ‘ä»¬ç»“æŸä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç¤ºä¾‹ç”¨ä¾‹ã€‚æˆ‘ä»¬å°†ä¸ºå¹¸å­˜è€…æ‰¾åˆ°æœ€ä¸æ­£ç¡®çš„ä¾‹å­ï¼Œå¹¶è¯•å›¾ç†è§£ä¸ºä»€ä¹ˆæ¨¡å‹åšå‡ºä¸æ­£ç¡®çš„é¢„æµ‹:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="1924" class="nt mr jj np b gy nu nv l nw nx">test = pd.concat([X_test, y_test], axis=1)<br/>test['probability'] = model.predict_proba(X_test)[:,1]<br/>test['order'] = np.arange(len(test))<br/>test.query('survived==1').nsmallest(5, 'probability')</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/e2d8370644179dc7cc22fbe27d258afb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*xa7hohitxZ9idHcY60BHkQ.png"/></div></figure><p id="5d51" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">ç¬¬ä¸€æ¬¡è®°å½•çš„å­˜æ´»æ¦‚ç‡æ˜¯ 0.03ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ç‰¹æ€§æ˜¯å¦‚ä½•ä¿ƒæˆè¿™ä¸€é¢„æµ‹çš„:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="387c" class="nt mr jj np b gy nu nv l nw nx">ind1 = test.query('survived==1')\<br/>           .nsmallest(1, 'probability')['order'].values[0]<br/>shap.plots.waterfall(shap_test[:,:,1][ind1])</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/36c8c4b335505eed07eb7100cdc2a36d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*6TNBZ1cbOkK5VskLuioixQ.png"/></div></figure><p id="df43" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">å¹´è½»çš„ä¸‰ç­‰èˆ±ç”·æ€§ä¹˜å®¢â€¦â€¦æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ€§åˆ«ã€ä¹˜å®¢çº§åˆ«å’Œå¹´é¾„å·²ç»å¤§å¤§é™ä½äº†é¢„æµ‹ã€‚è®©æˆ‘ä»¬åœ¨è®­ç»ƒæ•°æ®ä¸­æ‰¾åˆ°ç±»ä¼¼çš„ä¾‹å­:</p><pre class="mf mg mh mi gt no np nq nr aw ns bi"><span id="fe65" class="nt mr jj np b gy nu nv l nw nx">pd.concat([X_train, y_train], <br/>          axis=1)[(X_train['is_male']==1) &amp; <br/>                  (X_train['pclass']==3) &amp; <br/>                  (X_train['age']==22) &amp; <br/>                  (X_train['fare'].between(7,8))]</span></pre><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div class="gh gi pr"><img src="../Images/af92e97bc0dc4a9ff4decac6792b6f33.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*1YGjdOvfy1na2F3DKPLDfw.png"/></div></figure><p id="beea" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">æ‰€æœ‰ç±»ä¼¼çš„è®­ç»ƒä¾‹å­å…¶å®éƒ½æ²¡æœ‰å­˜æ´»ä¸‹æ¥ã€‚è¿™å°±è¯´å¾—é€šäº†ã€‚è¿™æ˜¯ä¸€ä¸ªå°ç”¨ä¾‹ï¼Œè¯´æ˜ shap å¦‚ä½•æœ‰åŠ©äºè§£é‡Šä¸ºä»€ä¹ˆæ¨¡å‹ä¼šå¾—å‡ºä¸æ­£ç¡®çš„é¢„æµ‹ã€‚</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><figure class="mf mg mh mi gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ps"><img src="../Images/c6704224f337036623e2d8d1b66f837e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HsBIRXgcv-lkIBpZ"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://unsplash.com/@albedo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">äº‘</a>åœ¨<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹ç…§</p></figure><p id="bb61" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">å¸Œæœ›æ‚¨å–œæ¬¢å­¦ä¹ å¦‚ä½•ä½¿ç”¨ SHAP åº“æ¥ç†è§£ Scikit-learn ä¸­å†…ç½®çš„å›å½’å’Œåˆ†ç±»æ¨¡å‹ã€‚å› ä¸º SHAP æ˜¯æ¨¡å‹ä¸å¯çŸ¥çš„ï¼Œæ‰€ä»¥ä½ ä¹Ÿå¯ä»¥æŠŠå®ƒç”¨äºå…¶ä»–æ¨¡å‹ã€‚æˆ‘å¸Œæœ›ä½ èƒ½å¾ˆå¿«ä½¿ç”¨è¿™ä¸ªå¯è§£é‡Šçš„äººå·¥æ™ºèƒ½å·¥å…·æ¥ç†è§£ä¸ºä»€ä¹ˆæ¨¡å‹ä¼šåšå‡ºé¢„æµ‹ï¼Œä»¥ä¾¿æ”¹è¿›æ¨¡å‹å¹¶æ›´å¥½åœ°å‘ä»–äººè§£é‡Šå®ƒã€‚</p><p id="0f80" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><em class="md">æ‚¨æƒ³è®¿é—®æ›´å¤šè¿™æ ·çš„å†…å®¹å—ï¼Ÿåª’ä½“ä¼šå‘˜å¯ä»¥æ— é™åˆ¶åœ°è®¿é—®åª’ä½“ä¸Šçš„ä»»ä½•æ–‡ç« ã€‚å¦‚æœä½ ä½¿ç”¨</em> <a class="ae jg" href="https://zluvsand.medium.com/membership" rel="noopener"> <em class="md">æˆ‘çš„æ¨èé“¾æ¥</em> </a>ï¼Œ<em class="md">æˆä¸ºä¼šå‘˜ï¼Œä½ çš„ä¸€éƒ¨åˆ†ä¼šè´¹ä¼šç›´æ¥å»æ”¯æŒæˆ‘ã€‚</em></p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="31aa" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">æ„Ÿè°¢æ‚¨é˜…è¯»è¿™ç¯‡æ–‡ç« ã€‚å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œè¿™é‡Œæœ‰æˆ‘å…¶ä»–ä¸€äº›å¸–å­çš„é“¾æ¥:<br/> â—¼ï¸ï¸ <a class="ae jg" rel="noopener" target="_blank" href="/k-nearest-neighbours-explained-52c910c035c5"> K è¿‘é‚»è§£é‡Š</a> <br/> â—¼ï¸ï¸ <a class="ae jg" rel="noopener" target="_blank" href="/logistic-regression-explained-7695f15d1b8b">é€»è¾‘å›å½’è§£é‡Š</a> <br/> â—¼ï¸ï¸ <a class="ae jg" rel="noopener" target="_blank" href="/comparing-random-forest-and-gradient-boosting-d7236b429c15">æ¯”è¾ƒéšæœºæ£®æ—å’Œæ¢¯åº¦æ¨è¿›</a> <br/> â—¼ï¸ï¸ <a class="ae jg" rel="noopener" target="_blank" href="/how-are-decision-trees-built-a8e5af57ce8?source=your_stories_page-------------------------------------">å†³ç­–æ ‘æ˜¯å¦‚ä½•æ„å»ºçš„ï¼Ÿ</a> <br/> â—¼ï¸ï¸ <a class="ae jg" rel="noopener" target="_blank" href="/pipeline-columntransformer-and-featureunion-explained-f5491f815f?source=your_stories_page-------------------------------------">ç®¡é“ã€ColumnTransformer å’Œ FeatureUnion è¯´æ˜</a> <br/> â—¼ï¸ï¸ <a class="ae jg" rel="noopener" target="_blank" href="/featureunion-columntransformer-pipeline-for-preprocessing-text-data-9dcb233dbcb6"> FeatureUnionã€ColumnTransformer &amp;ç®¡é“ç”¨äºé¢„å¤„ç†æ–‡æœ¬æ•°æ®</a></p><p id="34eb" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">å†è§ğŸƒ ğŸ’¨</p></div></div>    
</body>
</html>