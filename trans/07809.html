<html>
<head>
<title>Python for Excel Users — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向Excel用户的Python第1部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-for-excel-users-part-1-c44bacff4adc?source=collection_archive---------19-----------------------#2021-07-17">https://towardsdatascience.com/python-for-excel-users-part-1-c44bacff4adc?source=collection_archive---------19-----------------------#2021-07-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="814f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">开始使用pandas处理数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0919c02c0d273f2a614d32e4980343fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lCBKfoHyFLLA3SDfqjwNMQ.jpeg"/></div></div></figure><p id="caa8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是一个教程系列的第一部分，面向所有想开始使用python而不是Excel的人，例如，自动化任务或提高速度和可伸缩性。或者只是出于好奇。</p><p id="bb02" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当出现以下情况时，您处于正确的位置:</p><ul class=""><li id="f617" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">您可以使用Excel合并各种工作表或表格(使用诸如Index、Match、VLookup</li><li id="75cb" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">使用简单的数学运算，如求和与平均</li><li id="2bae" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">使用条件聚合函数(例如，每个类别的交易总和)或数据透视表</li></ul><p id="843a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这篇博文不会涵盖您需要了解的关于转储Excel的所有内容，这也不是本系列的目标。第1部分旨在帮助您从Excel转向Python/Pandas。</p><p id="213d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">虽然Excel有它自己的位置，而且非常快速和方便，但我希望这个博客文章系列能够帮助您探索除Excel之外的其他数据处理方式。</p><p id="8cd7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以在Jupyter笔记本上找到这篇博文，以及我们在<a class="ae me" href="https://github.com/HOSD-Mentoring/presentations/tree/main/From%20Excel%20to%20Python%20-%20Part%201" rel="noopener ugc nofollow" target="_blank"> HOSD指导GitHub repo </a>中使用的数据。</p><h2 id="2d85" class="mf mg it bd mh mi mj dn mk ml mm dp mn ld mo mp mq lh mr ms mt ll mu mv mw mx bi translated">本教程的目标</h2><p id="942a" class="pw-post-body-paragraph ku kv it kw b kx my ju kz la mz jx lc ld na lf lg lh nb lj lk ll nc ln lo lp im bi translated">我们将像在Excel中一样探索和组合不同的销售数据表。这些表格是:</p><ul class=""><li id="3648" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">命令</li><li id="1ead" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">订单_行</li><li id="ee36" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">制品</li></ul><p id="f6f9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一会儿会有更多关于数据的细节。</p><h2 id="6e4a" class="mf mg it bd mh mi mj dn mk ml mm dp mn ld mo mp mq lh mr ms mt ll mu mv mw mx bi translated">要求</h2><p id="5c0d" class="pw-post-body-paragraph ku kv it kw b kx my ju kz la mz jx lc ld na lf lg lh nb lj lk ll nc ln lo lp im bi translated">虽然Python的一些基本经验会有所帮助，但你不必成为一名程序员或数据科学家来遵循本教程。理想情况下，你应该听说过熊猫，并亲自花了一些时间与python打交道。只要能让自己感到舒适，不气馁就行了。试着跟上并阅读我们没有涉及的内容。你可以随时回到这里。</p><h1 id="8fd8" class="nd mg it bd mh ne nf ng mk nh ni nj mn jz nk ka mq kc nl kd mt kf nm kg mw nn bi translated">1.形势</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/063f07a7f7f942b5fe3d14dfb7668efc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8llznJI2LG02_TtC4rLdXA.jpeg"/></div></div><p class="np nq gj gh gi nr ns bd b be z dk translated">来源:pix abay<a class="ae me" href="https://pixabay.com/photos/office-startup-business-home-office-594132/" rel="noopener ugc nofollow" target="_blank">https://pix abay . com/photos/office-startup-business-home-office-594132/</a></p></figure><p id="11d4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">想象一下，你刚开始在一家大型巴西在线零售商的销售部门工作。这是你的第一天。你设置好你的电脑，从你公司的咖啡师那里得到一杯很棒的双份浓缩咖啡。休息室里的旧咖啡机，你已经准备好开始了！</p><p id="d12b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不幸的是，现在是夏天，你团队中的每个人都在度假。这让你有很多问题和时间<strong class="kw iu">自己探索公司数据</strong>。太好了！</p><h2 id="562a" class="mf mg it bd mh mi mj dn mk ml mm dp mn ld mo mp mq lh mr ms mt ll mu mv mw mx bi translated">你脑中的一些问题是:</h2><ul class=""><li id="4797" class="lq lr it kw b kx my la mz ld nt lh nu ll nv lp lv lw lx ly bi translated">🏬以交易数量衡量，这家公司实际上有多大？</li><li id="ee88" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">💵按年收入计算的公司规模？</li><li id="a5f3" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">👗每个类别我们提供多少产品？</li><li id="eb94" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">📦我们的交付有多成功？</li></ul><p id="86d4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您知道您可以简单地通过使用标准公式和一个数据透视表来使用和组合Excel中的三个表Orders、Order_lines和Products来回答这些问题。</p><p id="bbfd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是因为没有人在你身边，你开始一份新工作标志着你职业生涯的一个新时代，所以这次你想做得不同。为什么不试试LinkedIn上人人都在谈论的这个叫做python的很酷的东西呢？好啊，我们走吧！</p><h1 id="e758" class="nd mg it bd mh ne nf ng mk nh ni nj mn jz nk ka mq kc nl kd mt kf nm kg mw nn bi translated">2.开始—数据</h1><p id="c835" class="pw-post-body-paragraph ku kv it kw b kx my ju kz la mz jx lc ld na lf lg lh nb lj lk ll nc ln lo lp im bi translated">本教程中使用的数据是Olist 的<a class="ae me" href="https://www.kaggle.com/olistbr/brazilian-ecommerce" rel="noopener ugc nofollow" target="_blank">巴西电子商务公共数据集的改编和简化版本。</a></p><p id="5575" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Excel中，你可以做类似于打开一个新的Excel文档，进入数据&gt;获取数据&gt;从文本，然后搜索。csv文件，并单击文本导入向导(选择分隔符、文件编码、数据格式等。)或者您只需双击。csv文件，希望Excel会自己正确地解决所有问题(哎哟！).</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nw"><img src="../Images/0e61c6dbdc9affeea4138aee2f917c67.png" data-original-src="https://miro.medium.com/v2/format:webp/1*buCnwEsKTI5fv4MfdMmsCQ.png"/></div></figure><p id="8168" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是现在我们在python的土地上，事情有点不同(但是不会更难！).</p><p id="dddb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用。csv文件，我们将使用包<a class="ae me" href="https://pandas.pydata.org/docs/" rel="noopener ugc nofollow" target="_blank">熊猫</a>将其作为dataframe(表格的别称)读取。我们将导入的表保存在具有适当名称的变量中。数据帧名称通常以df结尾。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="79c0" class="mf mg it ny b gy oc od l oe of"># setup notebook and load tables<br/>import pandas as pd<br/><br/>orders_df = pd.read_csv("data/Orders.csv")<br/>order_lines_df = pd.read_csv("data/Order_lines.csv")<br/>products_df = pd.read_csv("data/Products.csv")</span></pre><p id="f4b9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">太好了！我们刚刚将三个表加载到我们的python程序中。</p><p id="9a90" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们有吗？</p><p id="0f8c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">与Excel不同，导入的数据不会立即显示。如果你不明确说出你想看什么，Python是相当沉默的。</p><p id="47c4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在您使用pandas的read_csv()方法导入csv文件并将其保存为something_df之后，我们可以使用<strong class="kw iu"> something_df.head(5) </strong>显示前5行。</p><p id="fa8c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这样，我们可以简单地看到表的样子以及我们正在处理哪些列。让我们为我们的三张桌子做那件事。</p><p id="35b5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">订单</strong>将陈述所有交易、交易发生的时间以及订单是否已成功履行。每个订单都有一个order_id(每个订单唯一)、customer_id(每个客户唯一)、order_status和购买日期。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="2b0a" class="mf mg it ny b gy oc od l oe of"># Preview of the Orders table<br/>orders_df.head(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nw"><img src="../Images/409311cbf3d49cde744a3e73e54d9a75.png" data-original-src="https://miro.medium.com/v2/format:webp/1*tDUo7npUYctbxsNeLQ3LRA.png"/></div></figure><p id="50b1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是，orders_df不包含单个订单的内容。为此，我们需要查看一下<strong class="kw iu"> Order_lines </strong>表，并使用订单id连接这两个表。在order_lines_df中，每一行指一个交易项目，包括数量、价格和运费值。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="4e9e" class="mf mg it ny b gy oc od l oe of"># Preview of Order_lines table<br/>order_lines_df.head(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nw"><img src="../Images/b3776a6c3445da856ea6db384a60d0be.png" data-original-src="https://miro.medium.com/v2/format:webp/1*VVhmZQHTM_treVhWj2uu5A.png"/></div></figure><p id="8fca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">产品类别还不是这个表的一部分，所以我们需要将<strong class="kw iu">产品</strong>表(products_df)与order_lines_df结合起来，以防我们想要分析类别级别的数据。目前，products_df中只有两列，产品id和相关的产品类别。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="978e" class="mf mg it ny b gy oc od l oe of"># Preview of Products table<br/>products_df.head(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nw"><img src="../Images/274c9ff104ad4c157c4dcae586bd3980.png" data-original-src="https://miro.medium.com/v2/format:webp/1*SzBxKTN1Qw39BoUtO-05UA.png"/></div></figure><h1 id="1e84" class="nd mg it bd mh ne nf ng mk nh ni nj mn jz nk ka mq kc nl kd mt kf nm kg mw nn bi translated">3.用数据回答我们的问题</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/b13a3a34d2a98d1c320919fecc0949e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2xufNfHI1mnW-UqwziM9cw.jpeg"/></div></div><p class="np nq gj gh gi nr ns bd b be z dk translated">来源:pix abay<a class="ae me" href="https://pixabay.com/photos/audit-chart-graph-hand-writing-3229739/" rel="noopener ugc nofollow" target="_blank">https://pix abay . com/photos/audit-chart-graph-hand-writing-3229739/</a></p></figure><p id="c1fa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们已经把所有的东西都载入了笔记本，我们可以开始用数据来回答我们的问题了。</p><h2 id="570b" class="mf mg it bd mh mi mj dn mk ml mm dp mn ld mo mp mq lh mr ms mt ll mu mv mw mx bi translated">3.1 🏬以交易数量衡量，这家公司实际上有多大？</h2><p id="7f60" class="pw-post-body-paragraph ku kv it kw b kx my ju kz la mz jx lc ld na lf lg lh nb lj lk ll nc ln lo lp im bi translated">因为我们在销售部门工作，所以当我们在这里谈论公司规模时，我们指的是<strong class="kw iu">交易数量</strong>。为此，我们可以从使用python的len()方法计算order_df中的行数开始。这类似于单击Excel中的列并在屏幕底部读取计数。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="03ae" class="mf mg it ny b gy oc od l oe of">len(orders_df)</span><span id="ae63" class="mf mg it ny b gy og od l oe of">99441</span></pre><p id="cb87" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">或者，我们可以对order_id列使用pandas pd.unique()方法，该方法将返回order_id的唯一值。在这种情况下，应该没有什么不同，因为订单id本质上是唯一的。</p><p id="4391" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是，如果我们对有重复项的列(如customer_id)使用这种方法，那么我们对整个表使用len()的结果将是不正确的。因此，让我们正确地使用pd.unique()来获取唯一的订单id，然后对其使用len()。</p><p id="7fb2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意:可以使用table_df["column_name"]来访问表中的列</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="a2e6" class="mf mg it ny b gy oc od l oe of">len(pd.unique(orders_df["order_id"]))</span><span id="7f22" class="mf mg it ny b gy og od l oe of">99441</span></pre><p id="d779" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">起初，我们对大量的交易感到惊讶，但随后我们注意到两件事:</p><ul class=""><li id="040e" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated"><strong class="kw iu">并非所有订单都已交付</strong>。我们应该只查看使用order_status成功交付的订单。</li><li id="10aa" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">这些交易发生在2016–2018的三个<strong class="kw iu">年。我们应该看看每年的交易数量。</strong></li></ul><p id="e7fb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们先把所有没有发货成功的订单过滤掉。为了找出有多少order_status选项，我们将在Excel中单击该列的过滤器。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nw"><img src="../Images/da91ece489e535f14f160c37c8ac6ee1.png" data-original-src="https://miro.medium.com/v2/format:webp/1*N0C0g5rN_S8_KlyBu0K6xQ.png"/></div></figure><p id="ce4e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Excel只向我们显示唯一的值，这很方便，但是正如我们刚刚了解到的，我们可以通过在order_status列上使用pd.unique()来达到同样的目的。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="5da8" class="mf mg it ny b gy oc od l oe of">pd.unique(orders_df["order_status"])</span><span id="6f61" class="mf mg it ny b gy og od l oe of">array(['delivered', 'invoiced', 'shipped', 'processing', 'unavailable',<br/>       'canceled', 'created', 'approved'], dtype=object)</span></pre><p id="bb61" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Excel中，我们只需取消选择除“已交付”之外的所有选项来过滤我们的表格。Excel将检查每一行，只显示order_status等于“已交付”的行。</p><p id="4fc3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以告诉python也这样做。如果我们的计算机是一个人，我们会告诉她:请以order_df表为例，只显示order_df表中“order_status”列等于“delivered”的行。幸运的是，我们的计算机不是人，需要更少的文本来做同样的事情。</p><p id="fb07" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">翻译成python就是:</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="955f" class="mf mg it ny b gy oc od l oe of">orders_df[orders_df["order_status"]=="delivered"]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nw"><img src="../Images/0ee30994f9e40bf02796f58c4056e19d.png" data-original-src="https://miro.medium.com/v2/format:webp/1*-zQVitCC30TBOgTHk5AjHA.png"/></div></figure><p id="8d03" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们应该将过滤后的结果保存到另一个数据帧中，以便进一步使用该表。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="ec72" class="mf mg it ny b gy oc od l oe of">delivered_orders_df = orders_df[orders_df["order_status"]=="delivered"]</span></pre><p id="e358" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，我们希望对每年的交易进行细分。我们将把order_purchase_timestamp列转换成一个日期时间列。然后我们将<strong class="kw iu">从中提取年份</strong>，并保存到一个名为“year”的<strong class="kw iu">新列中。</strong></p><p id="6a10" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这类似于使用Excel的Year()公式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nw"><img src="../Images/24ddb277b6498effaed4d85541a9295a.png" data-original-src="https://miro.medium.com/v2/format:webp/1*36-WJUDoU7AbM_jUS-MSYg.png"/></div></figure><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="6e88" class="mf mg it ny b gy oc od l oe of"># the data type of this column is not yet datetime<br/>delivered_orders_df["order_purchase_timestamp"].dtypes</span><span id="992e" class="mf mg it ny b gy og od l oe of">dtype('O')</span><span id="a7fc" class="mf mg it ny b gy og od l oe of"># convert to datetime<br/>delivered_orders_df["order_purchase_timestamp"] = pd.to_datetime(delivered_orders_df["order_purchase_timestamp"])<br/>delivered_orders_df["order_purchase_timestamp"].dtypes</span><span id="d797" class="mf mg it ny b gy og od l oe of">dtype('&lt;M8[ns]')</span><span id="1724" class="mf mg it ny b gy og od l oe of"># extract the year from datetime and save to new column<br/>delivered_orders_df["order_year"] = delivered_orders_df["order_purchase_timestamp"].dt.year</span><span id="f33f" class="mf mg it ny b gy og od l oe of"># show the new table<br/>delivered_orders_df.head(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nw"><img src="../Images/8a2057cb2726b3a6aef0bfd7a50c87c6.png" data-original-src="https://miro.medium.com/v2/format:webp/1*9Tka65wkIrzK6PV-jPOpMg.png"/></div></figure><p id="546f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">太好了！现在，我们拥有了统计每年交付订单所需的一切。在Excel中，我们会按年份过滤，对每一行进行计数，并将其写入一个新的汇总表。</p><p id="3987" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">更高级的Excel用户可以跳过这一手动任务，使用以年份为列的数据透视表，并计算order_id的值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nw"><img src="../Images/50f215bbc0d9abd68358edddf57e1a9f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*0tkAjkDH4-HnoQmAl7zwDg.png"/></div></figure><p id="39b6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以通过使用pandas <strong class="kw iu"> groupby </strong>和<strong class="kw iu"> agg </strong>函数来实现同样的功能。对于这样一个简单的任务来说，语法可能看起来令人生畏，但是这个函数是非常通用和强大的，这是Excel的pivot梦寐以求的。</p><p id="6557" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，我们选择要聚合的表(what)，然后定义要聚合的列(where)，接着定义聚合函数(how)。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="66be" class="mf mg it ny b gy oc od l oe of">delivered_orders_df.groupby(by=["order_year"], as_index=False).agg({'order_id':'count'})</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nw"><img src="../Images/832ea7d6c5e678bc4caa135954d18e2f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*kRTNGQ4fuj3JEARaSL83fg.png"/></div></figure><h2 id="7066" class="mf mg it bd mh mi mj dn mk ml mm dp mn ld mo mp mq lh mr ms mt ll mu mv mw mx bi translated">3.2 💵按年收入计算的公司规模？</h2><p id="5092" class="pw-post-body-paragraph ku kv it kw b kx my ju kz la mz jx lc ld na lf lg lh nb lj lk ll nc ln lo lp im bi translated">在交易数量旁边，我们还想找出收入。如上所述，我们需要通过order_id作为键将delivered_order_df与order_lines_df结合起来。此外，我们注意到order_lines表有关于订单商品数量和价格的信息，但还没有收入的信息。</p><p id="1356" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，这是我们需要做的:</p><ul class=""><li id="7395" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">用order_item * price的值在order_lines_df中创建一个列“line_revenue”</li><li id="3d0f" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">创建一个汇总表，将每个订单的line_revenue汇总为order_revenue</li><li id="f8e6" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">将聚合表与delivered_orders_df合并，并合计每年的order_revenue</li></ul><p id="22b0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Excel中，我们会创建一个新列，使用一个数据透视表，使用类似VLOOKUP的东西将数据透视表与其他过滤表合并，在结果表上构建另一个数据透视表…</p><p id="b734" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们不要那样做。这不是一个复杂的任务，但是我们已经明白为什么我们应该切换到Python来完成这样的任务。一旦你习惯了语法和过程，一切都会变得更容易和更容易实现。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="cc37" class="mf mg it ny b gy oc od l oe of">order_lines_df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nw"><img src="../Images/b3776a6c3445da856ea6db384a60d0be.png" data-original-src="https://miro.medium.com/v2/format:webp/1*VVhmZQHTM_treVhWj2uu5A.png"/></div></figure><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="d4f8" class="mf mg it ny b gy oc od l oe of"># create new column and save the result of order_item_id * price<br/>order_lines_df["line_revenue"] = order_lines_df["order_item_id"] * order_lines_df["price"]<br/>order_lines_df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nw"><img src="../Images/3931f6f530720d380291916517e2e140.png" data-original-src="https://miro.medium.com/v2/format:webp/1*-dvinwIXy3I5gvfJJJbGbA.png"/></div></figure><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="b7b6" class="mf mg it ny b gy oc od l oe of"># aggregate table and sum up line_revenue to get the total order value per order id<br/>order_lines_agg_df = order_lines_df.groupby(by=["order_id"], as_index=False).agg({"line_revenue":"sum"})<br/>order_lines_agg_df.head(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nw"><img src="../Images/435b964363f95b73c91b8b4f5bd47efb.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Pp-tEvtmIUL9_gZbYRKScQ.png"/></div></figure><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="8e51" class="mf mg it ny b gy oc od l oe of">delivered_orders_df.head(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nw"><img src="../Images/8a2057cb2726b3a6aef0bfd7a50c87c6.png" data-original-src="https://miro.medium.com/v2/format:webp/1*9Tka65wkIrzK6PV-jPOpMg.png"/></div></figure><p id="6835" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们想合并上面的两个表，order_lines_agg_df和delivered_orders_df。就结果而言，我们所做的类似于Excel的VLOOKUP()公式，但是我们<strong class="kw iu">使用order_id作为键</strong>来合并两个表。python代码非常简单，几乎像散文一样。</p><p id="a9d8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">之后，我们重复上面在计算每年的交易数量时所做的事情，但这次我们对order_revenue求和。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="8e60" class="mf mg it ny b gy oc od l oe of"># merge the two tables to get revenue per order<br/>delivered_orders_merged_df = pd.merge(left=delivered_orders_df, right=order_lines_agg_df, how="left", on="order_id")<br/>delivered_orders_merged_df.head(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/35ff38eeb1c1a3cd00dd8541ae26ad81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GnOvvPLCHjyXy1tR4YY8Bw.png"/></div></div></figure><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="a864" class="mf mg it ny b gy oc od l oe of">revenue_per_year_df = delivered_orders_merged_df.groupby(by=["order_year"], as_index=False).agg({"order_revenue":"sum"})<br/>revenue_per_year_df.columns = ["order_year", "total_revenue"]<br/>revenue_per_year_df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/e8b29d1fe72a35394e9d239d731b58d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PmUgqZOG63xfO-6RABbN2Q.png"/></div></div></figure><p id="f2df" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这看起来不对，对吧？不完全是。这被称为<strong class="kw iu">科学记数法</strong>，其中非常大或非常小的数字显示为计算结果。</p><p id="dd45" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">4.649029e+4表示4.649029 * 10⁴表示4.649029 * 10000表示46490.29。您可以使用以下代码片段更改Jupyter笔记本显示数字的方式。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="7655" class="mf mg it ny b gy oc od l oe of">pd.set_option('display.float_format', lambda x: '%.2f' % x)</span><span id="cce9" class="mf mg it ny b gy og od l oe of"># display float numbers up to second decimal point<br/>revenue_per_year_df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/d4c9a46d1eaa554b7eb8cb90a2ff27d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BK6xW5zL5C5r7WBTBr_GiA.png"/></div></div></figure><p id="f690" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">太好了！看起来我们公司很有活力。使用这种方法，我们可以计算各种各样的东西。比如每年的客户数量和平均订单价值。交易与客户的比率可能也很有意思，因为当一家公司的收入仅基于少数高价值客户时，该公司可能会面临风险。如果他们转向我们的竞争对手呢？</p><p id="a597" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦你完成本教程，这些都是很好的调查问题。但首先让我们回到我们的其他问题。</p><h2 id="d64e" class="mf mg it bd mh mi mj dn mk ml mm dp mn ld mo mp mq lh mr ms mt ll mu mv mw mx bi translated">3.3 👗每个类别我们提供多少产品？</h2><p id="ee40" class="pw-post-body-paragraph ku kv it kw b kx my ju kz la mz jx lc ld na lf lg lh nb lj lk ll nc ln lo lp im bi translated">既然您已经知道了如何计算一个列的唯一值，现在这将变得非常容易。上面，我们计算了orders_df中唯一order _ ids的数量。现在，我们必须计算products_df中的product_id，以大致了解我们的产品范围，即<strong class="kw iu">我们提供多少不同的产品</strong>。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="90dc" class="mf mg it ny b gy oc od l oe of">products_df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nw"><img src="../Images/274c9ff104ad4c157c4dcae586bd3980.png" data-original-src="https://miro.medium.com/v2/format:webp/1*SzBxKTN1Qw39BoUtO-05UA.png"/></div></figure><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="5ce7" class="mf mg it ny b gy oc od l oe of"># count unique products in our database<br/>len(pd.unique(products_df["product_id"]))</span><span id="5411" class="mf mg it ny b gy og od l oe of">32951</span></pre><p id="0fda" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于我们还想知道每个类别的<strong class="kw iu">产品数量，我们复制上面的方法，计算每年的交易数量。我们现在将使用“产品类别名称”而不是“订单年份”,并且使用“产品标识”而不是“订单标识”来计数。</strong></p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="da42" class="mf mg it ny b gy oc od l oe of"># count products per category<br/>products_per_category_df = products_df.groupby(by=["product_category_name"], as_index=False).agg({"product_id":"count"})<br/>products_per_category_df.columns = ["product_category_name", "product_id_count"]<br/>products_per_category_df.head(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nw"><img src="../Images/d6f65967c21976d9d6f61a6793228d87.png" data-original-src="https://miro.medium.com/v2/format:webp/1*I-aKagBWkBB-NvswINt69g.png"/></div></figure><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="e3a4" class="mf mg it ny b gy oc od l oe of"># number of categories<br/>len(products_per_category_df)</span><span id="19ee" class="mf mg it ny b gy og od l oe of">73</span></pre><p id="4587" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">哇，我们提供73个类别的近33，000种产品？就产品数量而言，前5大类别是什么？</p><p id="2aec" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">像在Excel中一样，我们只需按product_id_count对表进行排序。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="aadb" class="mf mg it ny b gy oc od l oe of"># sort by product_id_count descending<br/>products_per_category_df.sort_values(by=["product_id_count"], ascending=False).head(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nw"><img src="../Images/9235658edc7ff00ad80c04f098e7357a.png" data-original-src="https://miro.medium.com/v2/format:webp/1*7bnMt6-ytkLhMfSbEHWW6A.png"/></div></figure><p id="b556" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这可能是你发现在巴西公司工作时懂葡萄牙语很有帮助的地方…</p><h2 id="c9b8" class="mf mg it bd mh mi mj dn mk ml mm dp mn ld mo mp mq lh mr ms mt ll mu mv mw mx bi translated">3.4 📦我们的交付有多成功？</h2><p id="9d0a" class="pw-post-body-paragraph ku kv it kw b kx my ju kz la mz jx lc ld na lf lg lh nb lj lk ll nc ln lo lp im bi translated">在3.1中，我们创建了一个只包含成功交付订单的新表。如果我们计算该表的唯一订单id数，并将该数除以未过滤的orders_df表中的唯一订单id数，那么我们就可以得到成功交付的百分比。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="44e7" class="mf mg it ny b gy oc od l oe of">unique_orderids_total = len(pd.unique(orders_df["order_id"]))<br/>unique_orderids_delivered = len(pd.unique(delivered_orders_df["order_id"]))<br/><br/># calculate ratio and round to second decimal point<br/>round(unique_orderids_delivered/unique_orderids_total,2)</span><span id="03b0" class="mf mg it ny b gy og od l oe of">0.97</span></pre><p id="009e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">97%的交付成功率是我们公司值得骄傲的事情。</p><h1 id="2c7b" class="nd mg it bd mh ne nf ng mk nh ni nj mn jz nk ka mq kc nl kd mt kf nm kg mw nn bi translated">4.摘要</h1><p id="d2aa" class="pw-post-body-paragraph ku kv it kw b kx my ju kz la mz jx lc ld na lf lg lh nb lj lk ll nc ln lo lp im bi translated">现在，由于pandas，我们了解到使用python是Excel的真正替代方法，我们有点忘乎所以，根据来自三个原始表的聚合数据计算了各种KPI。快速看一下手表就能知道我们的胃已经知道了什么:该吃午饭了！</p><p id="3eb0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是在我们去公司之前。文鼎机器，我们想保存我们所做的，并将其发送给我们的同事。我们如何做到这一点？</p><p id="288f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以简单地<strong class="kw iu">将数据帧导出为csv文件</strong>，并将它们发送给那些喜欢使用Excel的人。</p><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="af36" class="mf mg it ny b gy oc od l oe of"># Export dataframe as csv for Excel<br/>products_per_category_df.to_csv("output/products_per_category_df.csv", index=False)</span></pre><p id="fbf9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">今天，我们学习了一些基本但强大的函数，这些函数允许我们用Python代替Excel工作。这里有一个总结。</p><ul class=""><li id="26b5" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated"><em class="ok"> pd.read_csv() </em>可以用来导入。作为数据帧的csv文件</li><li id="6695" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><em class="ok"> table_df.head() </em>向我们展示了该表的预览输出</li><li id="0c84" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">为了访问table_df的一列，我们键入<em class="ok">table _ df[" column _ name "]</em></li><li id="d4c1" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><em class="ok">len(PD . unique(table _ df[" column _ name "])</em>给出该列中唯一值的数量</li><li id="9b49" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">我们可以将两列相乘，并使用<em class="ok">table _ df[" new "]= table _ df[" col 1 "]* table _ df[" col 2 "]</em>将结果保存在新列中</li><li id="8473" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">除了Excel的数据透视表，我们还可以汇总每个类别的值，例如，使用<em class="ok">table _ df . group by(by =[" category "]，as_index=False)计算每年的交易次数或合计每个订单的收入。agg({"col3":"sum"}) </em></li><li id="debc" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">除了在Excel中使用VLOOKUP()，我们还可以使用<em class="ok"> pd.merge(left=table_1_df，right=table_2_df，how="left "，on="key_column") </em></li></ul><p id="4a7b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我建议你继续下去，进一步研究这个数据集或你自己的数据集。每当你不知道如何做某件事时，最好的方法是查看熊猫文档或谷歌你的特定问题(“来自字符串的python日期时间”或“python数据透视表”)，看看其他人是如何做的。只是不要气馁，继续学习！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nw"><img src="../Images/44bc973e1a66a6d3c7268eb11f3c3b13.png" data-original-src="https://miro.medium.com/v2/format:webp/1*8gFFX1iFSwlU5r48HRAXqQ.png"/></div></figure><p id="bfa1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">开始总是艰难的，但坚持下去，你会比任何Excel专业人员更有效、更快。如果你需要一些关于数据分析和数据科学是否可以成为你的职业道路的一般性指导，我们<a class="ae me" href="http://www.hosd-mentoring.com" rel="noopener ugc nofollow" target="_blank"> HOSD辅导公司提供免费的一对一辅导</a>。</p><p id="ef8a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">只需在我们的网站上点击一下，您就可以预约我们的导师。不要害羞:)</p><p id="cb35" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此外，我们想宣布，本教程和许多其他教程将在会议结束时变成一个带有问答环节的在线研讨会。要了解更多关于我们的产品或与我们联系，请务必前往我们的<a class="ae me" href="https://www.linkedin.com/company/hosd-mentoring/" rel="noopener ugc nofollow" target="_blank"> HOSD LinkedIn页面</a>。</p><p id="e341" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">坚持学习！</p><p id="791b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">乔纳斯</p><p id="9873" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">HOSD创始人兼数据分析师导师</p></div></div>    
</body>
</html>