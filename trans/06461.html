<html>
<head>
<title>Building a YOLOv3 pipeline with Valohai and Superb AI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Valohai和Superb AI构建YOLOv3管道</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-yolov3-pipeline-with-valohai-and-superb-ai-45275aa5ebde?source=collection_archive---------44-----------------------#2021-06-09">https://towardsdatascience.com/building-a-yolov3-pipeline-with-valohai-and-superb-ai-45275aa5ebde?source=collection_archive---------44-----------------------#2021-06-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0ac5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">每次训练模型时，建立管道的价值都会增加</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/142ff6837ef343a66d6a58447f97408c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oTdY7VNIiGaE-BSgfN9H4Q.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="5159" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本文展示了一个管道示例，该管道集成了Valohai和Superb AI，使用预训练的权重和转移学习来训练计算机视觉模型。对于该模型，我们使用YOLOv3，它是为实时对象检测而构建的。</p><p id="01ea" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这个例子中，Superb AI用于管理训练数据，并产生可用于训练的标记数据集。另一方面，Valohai接收这些数据，并通过训练步骤和批量推理步骤来运行流水线。我们在这里写了一个关于这些平台如何互补的更全面的分析。</p><ul class=""><li id="e07a" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated"><a class="ae lr" href="https://www.superb-ai.com/" rel="noopener ugc nofollow" target="_blank"> Superb AI </a>是一个ML DataOps平台，帮助计算机视觉团队自动化和管理整个数据管道:从摄取和标记到数据质量评估和交付。</li><li id="614b" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated"><a class="ae lr" href="https://valohai.com/" rel="noopener ugc nofollow" target="_blank"> Valohai </a>是一个MLOps平台，帮助在任何云或本地硬件上构建和运行全自动培训管道。非常适合计算机视觉和深度学习。</li></ul><p id="f032" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">项目详情</strong></p><ul class=""><li id="7b9f" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated"><strong class="kx ir">储存库:</strong><a class="ae lr" href="https://github.com/valohai/yolov3-tf2/" rel="noopener ugc nofollow" target="_blank">https://github.com/valohai/yolov3-tf2</a></li><li id="82fb" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kx ir">型号:</strong> YOLOv3-416 ( <a class="ae lr" href="https://pjreddie.com/media/files/yolov3.weights" rel="noopener ugc nofollow" target="_blank">重量</a>)</li><li id="79ce" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kx ir">框架:</strong> Tensorflow 2.4.0 + OpenCV 4.1</li><li id="9e35" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kx ir">模式:</strong>迁移学习</li><li id="bbc7" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kx ir">数据集:</strong> ~3000张图像(COCO 2017验证集)</li><li id="2f4f" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kx ir">类:</strong>人，车，椅子，书，瓶子</li></ul><p id="7c77" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">注意:管道是通用的，这意味着使用Superb.ai平台上的任何数据集和任何种类的类，使用符合YOLOv3模型的任何权重进行训练都是微不足道的。这里列出的只是我们使用的默认值。</p><h1 id="2912" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">在高超的人工智能中准备数据</h1><p id="2892" class="pw-post-body-paragraph kv kw iq kx b ky my jr la lb mz ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">首先，我们需要在高超的人工智能平台上创建一个新项目。选择任何名称和描述。对于这个例子，数据类型将是图像和注释类型框。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/697c40297c08021afd2e8371c38710b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xabeymOSprDX6UUt.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="f672" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后添加五个类(人，车，椅子，书，瓶子)来匹配我们的COCO数据集，我们会上传到平台。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/0c3ca1ac60810f04bd60f9505c1e8120.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/0*qNxkdM2GIp3K7TAn.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="8289" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">人们也可以利用高超的人工智能的自动标记功能，但在这个例子中，我们将在COCO数据集中已经有了标签。现在我们已经在平台中准备好了项目和数据集模板，是时候使用高超的AI SDK和CLI来转换和上传实际的数据+标签了。遵循这个<a class="ae lr" href="https://github.com/Superb-AI-Suite/spb-example/tree/main/create-coco-project" rel="noopener ugc nofollow" target="_blank">示例存储库</a>中的说明。</p><p id="4bc2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦转换和上传完成，该项目应该包含3000多张图片，随时可供瓦罗海的培训管道使用。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/c76ac533a33a0ebf3a1a4029aac1c834.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vY2cN4Y9gfbYBBfT.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="5645" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">瓦罗海训练管道</h1><p id="b193" class="pw-post-body-paragraph kv kw iq kx b ky my jr la lb mz ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">在瓦罗海，培训渠道是任何成功项目的关键组成部分。我们的示例管道由四个步骤组成。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/c766e4e2cff5e0a46760d1b70fc759c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8EosnQ3j39op9rtR.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="b9ff" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe nh ni nj nk b">convert-superbai</code>步骤从Superb.ai中提取数据，根据Superb.ai标记拆分训练集和验证集，最后将这两个集转换为。模型的tfrecord文件。</p><p id="9cf6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe nh ni nj nk b">weights</code>步骤从Joseph Redmon的网站下载预训练的权重，将它们转换为Tensorflow检查点，最后通过对单幅图像运行推理来验证它们是否正确工作。</p><p id="9529" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe nh ni nj nk b">train</code>步骤基于超参数在GPU环境(其他步骤默认为CPU)中训练模型。</p><p id="60d7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，<code class="fe nh ni nj nk b">detect</code>步骤对作为该步骤输入给出的一组图像的新训练模型进行推理。这一步的输出是图像的新版本，边界框和标签呈现在原始图像之上。</p><p id="7905" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">每个步骤(通常)都是一个Python文件。这里是我们的<code class="fe nh ni nj nk b">weights</code>步骤的<a class="ae lr" href="https://github.com/valohai/yolov3-tf2/blob/master/weights.py" rel="noopener ugc nofollow" target="_blank"> weights.py </a>的源代码。它有一个参数<code class="fe nh ni nj nk b">weights_num_classes</code>(预训练模型使用了多少个类别)和一个输入<code class="fe nh ni nj nk b">weights</code>(实际预训练权重)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="8a96" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">参数和输入被提供给对Valohai SDK的<code class="fe nh ni nj nk b">valohai.prepare()</code>调用。Valohai CLI可以解析这个调用，以自动生成参数化该步骤所需的配置。</p><p id="2d02" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">管道本身在<a class="ae lr" href="https://github.com/valohai/yolov3-tf2/blob/master/pipeline.py" rel="noopener ugc nofollow" target="_blank"> pipeline.py </a>中定义，它也使用新的SDK。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h1 id="4178" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">在瓦罗海建立管道</h1><p id="23ed" class="pw-post-body-paragraph kv kw iq kx b ky my jr la lb mz ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">首先，在Valohai中创建一个新项目，并从项目设置中链接GitHub <a class="ae lr" href="https://github.com/valohai/yolov3-tf2.git" rel="noopener ugc nofollow" target="_blank">示例存储库</a>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/0e318a8f35d90d75f7f42b31d1f61f69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*56MQ3ZgT43mlGXte.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="9bfe" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，您可以从pipelines选项卡创建一个新的管道，并从蓝图下拉列表中选择<code class="fe nh ni nj nk b">train-superbai</code>。</p><h1 id="749c" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">与卓越的人工智能相结合</h1><p id="77b5" class="pw-post-body-paragraph kv kw iq kx b ky my jr la lb mz ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">在运行管道之前，您需要告诉它从哪里获取数据。图像和标签是两个独立的URL，这意味着从Superb.ai到Valohai的两次复制粘贴。</p><p id="bf8f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">图片:</strong>设置&gt;通用(Superb.ai)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/bd1415ff78a3436144c31e1de26dd925.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EK0i_s7-kWlhuWJh.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="31c5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">标签:</strong>导出&gt;导出历史(Superb.ai)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/bf4502d16fd004f09612cd2dba2eb196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*19LHRhx4Tj3tKgLL.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="b1e2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">管道输入(Valohai) </strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/8ad882d80068b5cb14197da37d8b5eda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WifhowRx27KLLpO6.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="1613" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">运行管道</h1><p id="9cd6" class="pw-post-body-paragraph kv kw iq kx b ky my jr la lb mz ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">现在，我们已经在卓越的人工智能平台中集成了我们的数据集，我们的管道已经准备就绪！</p><p id="3df2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Valohai记录了管道每一步的所有输入、参数、日志和指标。这些是输入、参数、Docker图像、环境和执行<code class="fe nh ni nj nk b">train</code>步骤的其余信息:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/41ae1ba968adda5b29f40e6e271769ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Z-D8aB3KJDrfcTFr.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="49d4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是训练代码打印出的所有日志的一部分。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/fa52aa1d044688e2ffe1f8d9ae8e4123.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VDPdvU_Cl0fwD75d.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="586f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这些是由培训代码打印出来的指标。Valohai将所有打印的JSON解析为一个度量(在Valohai中称为元数据)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/96d17c6e4bca622a34029a24ee84391a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yFrlxgc-SfudKZcJ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="2d5d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，在<code class="fe nh ni nj nk b">detect</code>步骤的输出选项卡中，我们可以用一些实际的图像来检查模型的执行情况。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/de28fc2c7151bd88596d03862b767cfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*B3n9YEpHi8z3ajnv.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="a0a2" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">对标签进行迭代</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/ff85d25d9a220e80e7ede62c36af4385.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0QSdooCaHWuKJqBQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="0e1b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦您知道您的模型需要优化的地方，因为它与数据有关，您可以通过他们的SDK将您的模型输出快速发送回Superb AI套件以进行模型辅助标记，从而快速启动您的下一次迭代。</p><h1 id="d7f1" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">为什么为您的YOLOv3模型建立一个端到端的管道是显而易见的</h1><p id="b195" class="pw-post-body-paragraph kv kw iq kx b ky my jr la lb mz ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">在本文中，端到端管道建立在两个专门构建的工具之上:用于数据管理的Superb AI和用于模型生命周期管理的Valohai。这个示例中的整个设置可以在几个小时内完成，但是每次训练模型时，前期工作的价值都会增加。</p><p id="e446" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">训练数据集随着时间的推移而发展，它可以独立于训练管道被重新标记和改变。类似地，训练管道中的代码可以被迭代，同时保持端到端管道的完整性以用于连续操作。此外，随着训练数据集和建模复杂性的增长，Valohai上的训练管道可以轻松扩展到更强大的GPU实例。</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><p id="be6c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="od">最初发表于</em><a class="ae lr" href="https://valohai.com/blog/building-a-yolov3-pipeline/" rel="noopener ugc nofollow" target="_blank"><em class="od">https://valohai.com</em></a><em class="od">。</em></p></div></div>    
</body>
</html>