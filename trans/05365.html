<html>
<head>
<title>4 Must-Know Python Pandas Functions for Time Series Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于时间序列分析的4个必知Python Pandas函数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/4-must-know-python-pandas-functions-for-time-series-analysis-6610dad521e?source=collection_archive---------5-----------------------#2021-05-12">https://towardsdatascience.com/4-must-know-python-pandas-functions-for-time-series-analysis-6610dad521e?source=collection_archive---------5-----------------------#2021-05-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="14d3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">举例说明</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/400bf6882d5a6146059be8375a05d185.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mpyrgqwMjfclV2oN1U2VIA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@lukechesser?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">卢克·切瑟</a>在<a class="ae ky" href="https://unsplash.com/s/photos/financial?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="5277" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">时间序列数据由附加到连续时间戳的数据点组成。日销售额、每小时温度值和化学过程中的秒级测量值都是时间序列数据的一些例子。</p><p id="a07b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">时间序列数据具有不同于普通表格数据的特征。因此，时间序列分析有其自身的动态，可以被认为是一个独立的领域。有超过500页的书深入涵盖时间序列分析的概念和技术。</p><p id="777f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas是由Wes Mckinney创建的，旨在提供一个高效灵活的工具来处理金融数据，这是一种时间序列。在本文中，我们将介绍4个可用于时间序列分析的熊猫函数。</p><p id="06dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要例子的数据。让我们从创建我们自己的时间序列数据开始。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="0464" class="ma mb it lw b gy mc md l me mf">import numpy as np<br/>import pandas as pd</span><span id="3499" class="ma mb it lw b gy mg md l me mf">df = pd.DataFrame({<br/>   "date": pd.date_range(start="2020-05-01", periods=100, freq="D"),<br/>   "temperature": np.random.randint(18, 30, size=100) +  <br/>                  np.random.random(100).round(1)<br/>})</span><span id="d4aa" class="ma mb it lw b gy mg md l me mf">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/9b71cc752f7fa05dd6bc74823259b73f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0DXEWQUj0MohqpkXm-dXcg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="8f86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们创建了一个包含100天内温度测量值的数据框。Pandas的<code class="fe mi mj mk lw b">date_range</code>功能可用于生成自定义频率的日期范围。使用Numpy函数随机生成温度值。</p><p id="6d13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以开始函数了。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="683c" class="ma mb it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">1.变化</h2><p id="c9af" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">对时序数据进行移位是一种常见的操作。我们可能需要对滞后或超前特征进行比较。在我们的数据框中，我们可以创建一个包含前一天温度的新要素。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="488f" class="ma mb it lw b gy mc md l me mf">df["temperature_lag_1"] = df["temperature"].shift(1)</span><span id="3c01" class="ma mb it lw b gy mg md l me mf">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/adce2d6b31903b5063b958dd96532cab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2pGAEjLd3GdpfMLyvUbXqQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="6c9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">传递给shift函数的标量值表示要移动的周期数。新列的第一行用NaN填充，因为第一行没有以前的值。</p><p id="c7f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mi mj mk lw b">fill_value</code>参数可用于用标量填充缺失值。让我们用温度列的平均值代替NaN。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="c535" class="ma mb it lw b gy mc md l me mf">df["temperature_lag_1"] = df["temperature"]\<br/>.shift(1, fill_value = df.temperature.mean())</span><span id="ae6f" class="ma mb it lw b gy mg md l me mf">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/d2d321fd7ce4b0ad1f1a6d8d4df176cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eaAI-AxWPzvxiKj26ePh3A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="062c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您对未来值感兴趣，可以通过向shift函数传递负值来向后移动。例如，“-1”表示第二天的温度。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="61d1" class="ma mb it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">2.重新取样</h2><p id="5b42" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">对时间序列数据执行的另一个常见操作是重采样。它包括改变周期的频率。例如，我们可能对每周的温度数据感兴趣，而不是每天的测量值。</p><p id="4c09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mi mj mk lw b">resample</code>功能创建指定内部的组(或箱)。然后，我们可以对这些组应用聚合函数，根据重新采样的频率来计算值。</p><p id="db42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来计算一下每周的平均气温。第一步是将数据重新采样到周级别。然后，我们将应用均值函数来计算平均值。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="9e09" class="ma mb it lw b gy mc md l me mf">df_weekly = df.resample("W", on="date").mean()</span><span id="3e4c" class="ma mb it lw b gy mg md l me mf">df_weekly.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/5053194f07d31626c850702ee7daf201.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xg0yeT1pCWw893uG8JZsBQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="08d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个参数指定重采样的频率。令人惊讶的是," W "代表星期。如果数据帧没有日期时间索引，则包含日期或时间相关信息的列需要传递给<code class="fe mi mj mk lw b">on</code>参数。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="96a0" class="ma mb it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">3.Asfreq</h2><p id="5cd9" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated"><code class="fe mi mj mk lw b">asfreq</code>函数提供了一种不同的重采样技术。它返回指定间隔结束时的值。例如，<code class="fe mi mj mk lw b">asfreq(“W”)</code> <strong class="lb iu"> </strong>返回每周最后一天的值。</p><p id="1736" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使用<code class="fe mi mj mk lw b">asfreq</code>功能，我们应该将日期列设置为数据框的索引。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="673c" class="ma mb it lw b gy mc md l me mf">df.set_index("date").asfreq("W").head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/02a2d7d1a87be11f45c05d67dbaa50c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c20CYyf8vfc9SZzFZiWFeA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="b611" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们在特定的一天获取一个值，所以没有必要应用聚合函数。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="bd28" class="ma mb it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">4.旋转</h2><p id="38a2" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated"><code class="fe mi mj mk lw b">rolling</code>函数可用于计算移动平均值，这是时间序列数据非常常见的操作。它创建一个特定大小的窗口。然后，我们可以使用此窗口在数据点滚动时进行计算。</p><p id="a542" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图解释了滚动的概念。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/974fd47445df3cea93dd77f7c9ca65af.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/0*YCAm1iFZb6tGdBeu.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="2dbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建一个滚动窗口3，并使用它来计算移动平均。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a4d0" class="ma mb it lw b gy mc md l me mf">df.set_index("date").rolling(3).mean().head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/6e1417560d03d89767688a0728422c29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zsnB3YvO_1zXrB99B-zVYQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="750c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于任何一天，这些值显示当天和前两天的平均值。前3天的值为18.9、23.8和19.9。因此，第三天的移动平均值是这些值的平均值，即20.7。</p><p id="fb25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">前两个值是NaN，因为它们没有前两个值。我们还可以使用这个滚动窗口来覆盖任何给定日期的前一天和后一天。这可以通过将<code class="fe mi mj mk lw b">center</code>参数设置为真来实现。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f749" class="ma mb it lw b gy mc md l me mf">df.set_index("date").rolling(3, center=True).mean().head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/66e3828bde917362929efb317ec15627.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bvo6ANQHFn1lC5ciGPUdBQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="024b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">前3天的值为18.9、23.8和19.9。因此，第二天的移动平均值是这3个值的平均值。在这个设置中，只有第一个值是NaN，因为我们只需要1个先前的值。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="dd31" class="ma mb it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">结论</h2><p id="3c74" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">我们已经介绍了在时间序列分析中常用的4个熊猫函数。预测分析是数据科学的重要组成部分。时间序列分析是预测分析旨在解决的许多问题的核心。因此，如果你打算从事预测分析，你肯定应该学习如何处理时间序列数据。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="69d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后但同样重要的是，如果你还不是<a class="ae ky" href="https://sonery.medium.com/membership" rel="noopener">中级会员</a>并计划成为其中一员，我恳请你使用以下链接。我将从你的会员费中收取一部分，不增加你的额外费用。</p><div class="nv nw gp gr nx ny"><a href="https://sonery.medium.com/membership" rel="noopener follow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">通过我的推荐链接加入Medium-Soner yl DRM</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">sonery.medium.com</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om ks ny"/></div></div></a></div></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="433d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>