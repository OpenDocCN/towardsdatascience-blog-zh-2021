<html>
<head>
<title>Make Python Faster with CFFI Python Bindings</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用CFFI Python绑定提高Python速度</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/make-python-faster-with-cffi-python-bindings-eb5402bc35dd?source=collection_archive---------17-----------------------#2021-09-27">https://towardsdatascience.com/make-python-faster-with-cffi-python-bindings-eb5402bc35dd?source=collection_archive---------17-----------------------#2021-09-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="92e1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从Python中的任何C库中调用函数。准备好起飞了吗？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4438cca64c00b01e6c8d68fccd4ec15a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p6Uqa0t0FAR4Z7cQw_WJzQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=67643" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae ky" href="https://pixabay.com/users/wikiimages-1897/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=67643" rel="noopener ugc nofollow" target="_blank">维基图片</a></p></figure><p id="c91d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python是最用户友好的编程语言之一。它易于学习，免费使用，并且您可以随意扩展它的功能。</p><p id="7585" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，Python可以说是数据科学和机器学习领域最常用的编程语言。优秀的数字库，如NumPy和SciPy，以及卓越的深度学习框架，如PyTorch和TensorFlow，为每个喜欢玩数据和人工神经网络的程序员创建了一个庞大的工具库。</p><p id="92c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，Python是一种解释型语言，它可以设置代码执行速度的上限。在AI和大数据的世界里，这不是一件好事。所以，我们确实有矛盾。Python如何成为该领域使用最多的编程语言？我们能做些什么让它更快？</p><p id="67ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好吧，我们可以用另一种语言(例如，C或C++)编写我们要求高的函数，并利用特定的绑定从Python调用这些函数。这就是这些巨大的数字库或深度学习框架所做的事情。因此，如果你是一名数据科学家或机器学习工程师，想要调用CUDA函数，这个故事适合你。</p><blockquote class="lv lw lx"><p id="11d2" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><a class="ae ky" href="https://www.dimpo.me/newsletter?utm_source=medium&amp;utm_medium=article&amp;utm_campaign=cffi" rel="noopener ugc nofollow" target="_blank">学习率</a>是为那些对AI和MLOps的世界感到好奇的人准备的时事通讯。你会在每周五收到我关于最新人工智能新闻和文章的更新和想法。在这里订阅<a class="ae ky" href="https://www.dimpo.me/newsletter?utm_source=medium&amp;utm_medium=article&amp;utm_campaign=cffi" rel="noopener ugc nofollow" target="_blank"/>！</p></blockquote></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="c4a6" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">CFFI</h1><p id="fb5d" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在上一篇文章中，我们用标准Python库的一部分库<code class="fe ng nh ni nj b">ctypes</code>做了同样的事情。我们看到了什么是编组，以及Python在内存管理方面与C有何不同。最后，我们通过一个简单的例子看到了<code class="fe ng nh ni nj b">ctypes</code>如何帮助我们调用C函数。</p><div class="nk nl gp gr nm nn"><a rel="noopener follow" target="_blank" href="/do-you-hate-how-slow-python-is-this-is-how-you-can-make-it-run-faster-532468fe1583"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd iu gy z fp ns fr fs nt fu fw is bi translated">你讨厌Python有多慢吗？这就是你如何让它跑得更快！</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">将具有挑战性的任务委派给另一名玩家</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">towardsdatascience.com</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob ks nn"/></div></div></a></div><p id="ac0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个故事中，让我们和CFFI一起更上一层楼。</p><h2 id="9476" class="oc mk it bd ml od oe dn mp of og dp mt li oh oi mv lm oj ok mx lq ol om mz on bi translated">CFFI对ctypes</h2><p id="c46d" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated"><code class="fe ng nh ni nj b">ctypes</code>可能是Python标准库的一部分，但是所有这些类型声明都容易出错，并且它不能扩展到大型项目/</p><p id="6250" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，<code class="fe ng nh ni nj b">ctypes</code>允许您将共享库直接加载到Python程序中。另一方面，使用<code class="fe ng nh ni nj b">CFFI</code>，您可以构建一个新的Python模块，并像导入任何其他Python库一样导入它。</p><h2 id="d37b" class="oc mk it bd ml od oe dn mp of og dp mt li oh oi mv lm oj ok mx lq ol om mz on bi translated">装置</h2><p id="2103" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated"><code class="fe ng nh ni nj b">CFFI</code>不是标准库的一部分。因此，要使用它，我们需要先安装它。我们可以使用Python包管理器<code class="fe ng nh ni nj b">pip</code>轻松做到这一点:</p><pre class="kj kk kl km gt oo nj op oq aw or bi"><span id="6f0c" class="oc mk it nj b gy os ot l ou ov">$ python3 -m pip install cffi</span></pre><blockquote class="lv lw lx"><p id="3122" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">请注意，建议使用Python虚拟环境来遵循本教程，以避免全局安装Python包。这可能会破坏系统工具或其他项目。</p></blockquote><h2 id="8de1" class="oc mk it bd ml od oe dn mp of og dp mt li oh oi mv lm oj ok mx lq ol om mz on bi translated">简单的例子</h2><p id="a7e1" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在这个例子中，我们将从的<code class="fe ng nh ni nj b">m</code>库中调用一个函数。我们将使用这个函数来得到一个数的平方根。</p><p id="15f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一步是创建一个python文件，该文件将构建一个具有我们需要的功能的Python模块；提供所有好东西的图书馆。</p><p id="cd73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，复制并粘贴以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="e2cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个例子中，您从的<code class="fe ng nh ni nj b">m</code>库中用<code class="fe ng nh ni nj b">sqrt</code>函数创建了一个绑定。首先，在<code class="fe ng nh ni nj b">set_source</code>方法中，传递想要构建的Python模块的名称(例如<code class="fe ng nh ni nj b">_libmath</code>)。</p><p id="21a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还包括来自的<code class="fe ng nh ni nj b">m</code>库的<code class="fe ng nh ni nj b">math</code>头文件，因为我们使用的是来自<code class="fe ng nh ni nj b">C</code>标准库的库，所以我们不需要在<code class="fe ng nh ni nj b">library_dirs</code>中提供库的位置。</p><p id="d63b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，您可以像运行任何其他Python脚本一样运行该脚本:</p><pre class="kj kk kl km gt oo nj op oq aw or bi"><span id="537c" class="oc mk it nj b gy os ot l ou ov">$ python3 build_cffi.py</span></pre><p id="477d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将产生<code class="fe ng nh ni nj b">.o</code>和一个<code class="fe ng nh ni nj b">.c</code>文件。让我们看看如何使用这个调用的输出。</p><h2 id="ff7c" class="oc mk it bd ml od oe dn mp of og dp mt li oh oi mv lm oj ok mx lq ol om mz on bi translated">从Python调用C</h2><p id="b79b" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">现在您已经准备好从<code class="fe ng nh ni nj b">C</code>调用<code class="fe ng nh ni nj b">sqrt</code>函数。这就像运行下面的代码一样简单:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="2b9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，从您创建的库(即<code class="fe ng nh ni nj b">_libmath</code>)导入lib模块。在内部，您可以找到对<code class="fe ng nh ni nj b">sqrt</code>函数的绑定。最后，您可以用任何浮点数调用这个函数。</p><p id="d6e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以创建到其他函数的绑定。例如，要创建与<code class="fe ng nh ni nj b">m</code>库的<code class="fe ng nh ni nj b">sin</code>或<code class="fe ng nh ni nj b">cos</code>函数的绑定，只需在<code class="fe ng nh ni nj b">cdef</code>中声明它们:</p><pre class="kj kk kl km gt oo nj op oq aw or bi"><span id="9cf0" class="oc mk it nj b gy os ot l ou ov">ffibuilder.cdef("""<br/>    double sqrt(double x);<br/>    double sin(double x);<br/>""")</span></pre><h1 id="6819" class="mj mk it bd ml mm oy mo mp mq oz ms mt jz pa ka mv kc pb kd mx kf pc kg mz na bi translated">结论</h1><p id="847d" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">Python是最用户友好的编程语言之一，也可以说是数据科学和机器学习领域中使用最多的编程语言。</p><p id="f866" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，Python是一种解释型语言，它可以设置代码执行速度的上限。但并不是所有的希望都破灭了；我们可以用另一种语言(例如，C或C++)编写要求苛刻的函数，并利用特定的绑定从Python调用这些函数。</p><p id="8eed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上一篇文章中，我们讨论了<code class="fe ng nh ni nj b">ctypes</code>以及如何使用它从Python中调用<code class="fe ng nh ni nj b">C</code>库。在这篇文章中，我们使用了一种更加自动化的方法，并看到了如何使用<code class="fe ng nh ni nj b">CFFI</code>来实现这一点。</p><p id="17bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来:我们将看到如何利用Cython来加速我们的Python代码！</p><h1 id="f65e" class="mj mk it bd ml mm oy mo mp mq oz ms mt jz pa ka mv kc pb kd mx kf pc kg mz na bi translated">关于作者</h1><p id="5908" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我的名字是<a class="ae ky" href="https://www.dimpo.me/?utm_source=medium&amp;utm_medium=article&amp;utm_campaign=cffi" rel="noopener ugc nofollow" target="_blank">迪米特里斯·波罗普洛斯</a>，我是一名为<a class="ae ky" href="https://www.arrikto.com/" rel="noopener ugc nofollow" target="_blank">阿里克托</a>工作的机器学习工程师。我曾为欧洲委员会、欧盟统计局、国际货币基金组织、欧洲央行、经合组织和宜家等主要客户设计和实施过人工智能和软件解决方案。</p><p id="e840" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有兴趣阅读更多关于机器学习、深度学习、数据科学和数据操作的帖子，请关注我的<a class="ae ky" href="https://towardsdatascience.com/medium.com/@dpoulopoulos/follow" rel="noopener" target="_blank"> Medium </a>、<a class="ae ky" href="https://www.linkedin.com/in/dpoulopoulos/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或Twitter上的<a class="ae ky" href="https://twitter.com/james2pl" rel="noopener ugc nofollow" target="_blank"> @james2pl </a>。</p><p id="936c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所表达的观点仅代表我个人，并不代表我的雇主的观点或意见。</p></div></div>    
</body>
</html>