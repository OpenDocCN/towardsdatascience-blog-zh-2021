<html>
<head>
<title>Anomaly Detection in a Machine Learning Scoring Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">机器学习评分模型中的异常检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/anomaly-detection-in-a-machine-learning-scoring-model-205a942518e3?source=collection_archive---------23-----------------------#2021-11-10">https://towardsdatascience.com/anomaly-detection-in-a-machine-learning-scoring-model-205a942518e3?source=collection_archive---------23-----------------------#2021-11-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8e26" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">时间序列异常检测的统计技术</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/eb29583299b2db347efd4859e5e22de2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DDLyrUYg-UaYkoXH"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">掷骰子将是本文所用方法的一个很好的类比。乔纳森·格林纳韦在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="b036" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我最近的默认评分数据科学项目中，我希望有一个自动工具可以警告我，特别是在开发阶段，当我的模型预测不连贯时，无论是因为数据处理中出现了问题，还是因为模型需要重新训练。</p><p id="b493" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">主要的困难是分数的急剧上升或下降可能是不一致的，也可能是合理的，这意味着分数的变化是观测数据实际和显著变化的结果。</p><p id="d59b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在不知道模型输出分布的情况下，做出这种区分是复杂的，尽管SHAP或LIME等可解释性工具有助于区分，但这意味着要逐一检查每个预测。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/564f7bd07929e5e22b68da2e849736da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jOkLuPi2duDfEM49nv31iA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">一个在XGBoost模型上计算的SHAP值的例子，该模型是根据来自<a class="ae kv" href="https://www.kaggle.com/c/home-credit-default-risk/data" rel="noopener ugc nofollow" target="_blank">“住房信贷违约风险”Kaggle竞赛</a>的数据训练的。图片作者。</p></figure><p id="1a35" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将在这里使用的关键原则是<a class="ae kv" href="https://en.wikipedia.org/wiki/Central_limit_theorem" rel="noopener ugc nofollow" target="_blank">中心极限定理</a>，利用它我们将研究从我们的模型预测中导出的正态或伪正态分布。由于这一点，我们将能够用一种完全自动化的方法来推断一个预测序列是一致的还是异常的。</p><h1 id="5715" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">掷骰子的类比</h1><p id="4d82" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">让我们把我们的模型看作一个骰子滚动。我们不知道骰子是否被装载，这意味着我们不知道它的概率分布。</p><p id="bb43" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，如果我们掷骰子1000次并平均结果，我们将得到一个稳定的值，如果我们重复这个过程，它不会改变太多。<br/>例如，下面是我们通过对空载骰子进行1000次投掷的3000次迭代得到的图表:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/49d8f98bd60c72fe398a1e6876440774.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mzyQkC7rPcnUmrwABJUWNA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。</p></figure><p id="0e62" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，即使我们不知道骰子是空载的，我们也知道掷骰子的平均值具有正态分布，其中68%、95%和99.7%的值位于平均值的一个、两个和三个标准差内。</p><p id="9ad1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果骰子突然变化并被加载，它将立即可见:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/7c025dcb8a1da72507ee0c28929d15cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QI9nVWdr_xfIzQTVvJi5ag.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。</p></figure><p id="b37a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，掷骰子的结果是6:掷出6的概率是30%,其他值是14%。如果骰子没有变，那么出现这种结果的概率极低，因此我们可以有把握地假设骰子被改变了。</p><h1 id="994b" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">回到模型</h1><p id="fcb2" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我对我的模型所做的是一样的。我取了之前每个月预测的平均分数，看看最新的预测是否与它们一致。</p><p id="04b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">即使一些观察值合理地显著增加或减少了它们的分数，所有分数的平均值应该总体上遵循正态分布。这就是我们可以看到的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/1d1b320515303c66bc78cb48d0f6bc57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g6OtytOakj_bhQbLvD3skg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。</p></figure><p id="8342" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果一系列预测的平均值在平均值的两个标准差之外，我们可以将其视为异常并仔细分析。</p><p id="0500" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">该方法也可应用于月度预测的标准差。</strong></p><h1 id="2afc" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">计数异常</h1><p id="18c7" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">如果我们的骰子是3的话会怎么样？它会自然地将1000个滚动系列的平均值移向3，但该值不会离平均值太远而被视为异常:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/8fea1b0068f1d34f2480f9181cbcef66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LQ71wWeMf9ZWYXf8C2wDOg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">骰子的位置有利于3。图片作者。</p></figure><p id="87e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，根据掷骰子的平均值看不出异常，但是如果我们在1000次掷骰子中数出3的次数，就可以看出异常:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/cdb05a21f6781bbe1e95432467732b8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jE3wesGNDNzkA3EEd93e7g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。</p></figure><p id="2051" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样，三的数量遵循正态分布，装载骰子的结果明显异常。</p><p id="6109" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在模型中，我们可以通过计算观察值的数量来应用这一点，这些观察值的得分有显著的增加或减少。<br/>如果一半的观察值增加了0.3，而另一半减少了0.3，那么就预测值的平均值而言，结果是不可见的，但通过这种方法可以看到。</p><p id="e98e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">应用于我的模型，我得到了以下图表:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/ba43f400120c036143d087981fb39d0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EV1xzXPfR_pZ7MwsAklXrA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/3a06c0f3596841803f2b5e97f8ed778d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qJzv8efD6gnuRACsBzBYZQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。</p></figure><p id="6a6f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里，我保留了一份我的模型，几个月来根本没有训练它。我们可以从直方图和折线图中看到，该模型在2021年6月之后出现了退化的迹象。以前的数据分析表明，模型只需每年重新训练一次，但这种异常分析表明，这应该在4个月后发生。</p><h1 id="301f" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">处理异常情况</h1><p id="fe1c" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在多种原因中，异常可能发生，因为:<br/> -数据处理管道<br/>中存在异常-模型不稳定或必须重新训练<br/> -存在外部因素。例如，如果出现经济危机，大多数观察值的默认分数将会急剧上升，因为它们的健康状况已经下降。反常不一定意味着不连贯。</p><p id="e97c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我的情况下，数据处理管道还没有最终确定，即使模型的重新训练频率已经被推断出来，我也想在当前数据上监控它。<br/>因此，基于CLT的异常检测主要针对前两种情况。</p></div></div>    
</body>
</html>