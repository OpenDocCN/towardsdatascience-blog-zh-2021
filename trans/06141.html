<html>
<head>
<title>Essential Bash for Data Science</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据科学的重要盛会</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/essential-bash-for-data-science-609508cc2ced?source=collection_archive---------42-----------------------#2021-06-01">https://towardsdatascience.com/essential-bash-for-data-science-609508cc2ced?source=collection_archive---------42-----------------------#2021-06-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3ecb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过与贝壳相处来提高你的生产力</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/91d50d7daad7f7399365a69247ec4368.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NKej2w68-ajpJwUNTtI9qA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@ngeshlew" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/@ngeshlew</a></p></figure><p id="e64b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为一名数据专业人员，您可能已经了解Python，这是最强大的通用语言之一，它的库几乎可以方便地做任何事情。那么，为什么要学习Bash和Unix shell呢？我在工作中发现的一些用例:</p><ul class=""><li id="dfc9" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">本地/远程使用文件系统</li><li id="f7fc" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">本地/远程监控系统资源</li><li id="f050" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">远程检查数据文件(在本地，我发现用Pandas启动Python控制台更快)</li><li id="84ec" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">自动化任何使用不同命令行工具的作业</li><li id="dae2" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">整合复杂的预处理步骤，包括编译软件或与数据库同步(可能通过Docker)</li><li id="01fa" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">在查询/预处理/训练/部署阶段之间建立粘合剂</li><li id="f2f1" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">将定制的实用程序整合在一起，这些实用程序利用了您无论如何都会从CLI使用的工具(例如Git)</li><li id="4006" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">Makefile经常被用作数据科学的DAG框架，例如在cookiecutter项目中</li></ul><h1 id="9adc" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">设置</h1><p id="c10e" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">注意，在Mac上，默认情况下你会被BSD工具所困，它们没有GNU 那么强大。然而，你可以使用<code class="fe nd ne nf ng b">brew install coreutils</code>，然后加上前缀<code class="fe nd ne nf ng b">g</code>，例如<code class="fe nd ne nf ng b">split</code>变成了<code class="fe nd ne nf ng b">gsplit</code>。</p><p id="dc4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可能还想用<code class="fe nd ne nf ng b">brew install bash</code>更新Mac Bash版本。</p><p id="dac7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果有任何命令不存在，那么在Mac上你通常可以运行<code class="fe nd ne nf ng b">brew install command</code>。</p><p id="d865" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Mac上，你可能想安装<a class="ae kv" href="https://iterm2.com/" rel="noopener ugc nofollow" target="_blank"> iTerm2 </a>而不是默认的终端。</p><h1 id="f9bf" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">基础</h1><p id="ca50" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">用<code class="fe nd ne nf ng b">#!/bin/bash</code>或<code class="fe nd ne nf ng b">#!/usr/bin/env bash</code>启动脚本(在Mac上，您可能有多个Bash - <code class="fe nd ne nf ng b">which -a bash</code>版本)。</p><p id="705c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用双引号将<code class="fe nd ne nf ng b">"$VARIABLE"</code>括起来以保留值。</p><p id="1820" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">set -euox pipefail</code>是一个很好的默认配置(在脚本中)，它提供了:</p><ul class=""><li id="9778" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">在脚本中的任何命令失败时引发错误</li><li id="8cdc" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">运行命令时打印命令</li><li id="932b" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">在未设置变量的情况下引发错误</li></ul><p id="2494" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用终端中的<code class="fe nd ne nf ng b">Ctrl+R</code>搜索命令历史，使用<code class="fe nd ne nf ng b">history</code>查看全部命令历史。</p><p id="9837" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<code class="fe nd ne nf ng b">info command</code>或<code class="fe nd ne nf ng b">man command</code>或<code class="fe nd ne nf ng b">help command</code>或<code class="fe nd ne nf ng b">command --help</code>获得命令帮助。<code class="fe nd ne nf ng b">whatis command</code>还打印来自<code class="fe nd ne nf ng b">man</code>手册的第一行描述。</p><h1 id="79b4" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">别名</h1><p id="4519" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">别名是一种快捷方式，可用于冗长乏味的命令，例如</p><p id="547b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">连接到远程机器:<code class="fe nd ne nf ng b">alias remote="ssh user@bigawesomemachine.cloud</code></p><p id="dc46" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">连接到数据库:<code class="fe nd ne nf ng b">alias db="psql -h database.redshift.amazonaws.com -d live -U database_user -p 5439"</code></p><p id="7b43" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">激活Conda环境:<code class="fe nd ne nf ng b">alias pyenv="source activate py_39_latest</code></p><p id="37f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">甚至只是纯粹的懒惰:<code class="fe nd ne nf ng b">alias jn="jupyter notebook"</code></p><p id="f5b0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">alias repo="cd /Users/john/work/team_repo"alias l="ls -lah"</code></p><p id="65e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">alias l=”ls -lah”</code></p><p id="30bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将这些添加到<code class="fe nd ne nf ng b">~/.bash_profile</code>中，以便它们在shell会话中保持不变。</p><h1 id="d6b0" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">检查文件</h1><p id="41b7" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">使用<code class="fe nd ne nf ng b">tree</code>以树状格式列出目录的内容。</p><p id="d857" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用<code class="fe nd ne nf ng b">head -n 10 file</code>或<code class="fe nd ne nf ng b">tail -n 10 file</code>读取文件的一端</p><p id="23d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">观察动态变化的文件，如日志</p><p id="54b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">tail -f file.log</code></p><p id="eede" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在当前(嵌套)目录中查找文件</p><p id="af08" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">find . -name data.csv</code></p><p id="eb89" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">浏览一个. csv文件，其中“，”是列分隔符</p><p id="6e4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">cat data.csv | column -t -s "," | less -S</code></p><p id="fb0b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从明文配置中获取密钥值，这在Bash中不一定是可理解的<code class="fe nd ne nf ng b">sed -n 's/^MODEL_DATA_PATH = //p' model_conf.py</code></p><p id="4d4e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以使用<code class="fe nd ne nf ng b">cut</code>对. csv列进行Pandas风格的值计数，例如对分号分隔的文件中的第五列进行计数</p><p id="a06b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">cut -d ";" -f 5 data.csv | sort | uniq -c | sort</code></p><p id="a35b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用<code class="fe nd ne nf ng b">diff file1 file2</code>或<code class="fe nd ne nf ng b">cmp file1 file2</code>比较文件，用<code class="fe nd ne nf ng b">diff &lt;(ls directory1) &lt;(ls directory2)</code>比较目录。</p><p id="8063" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<code class="fe nd ne nf ng b">grep</code>在文件中搜索(正则表达式)模式。这个命令有很多有用的选项，所以最好读一下<code class="fe nd ne nf ng b">info grep</code>。grep+cut是一种强大的模式，可以根据模式过滤行并获得您关心的列，例如获得最新的提交散列:</p><p id="86ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">git log -1 | grep '^commit' | cut -d " " -f 2</code></p><p id="ad0a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">sort</code>和<code class="fe nd ne nf ng b">uniq</code>可以一起使用来处理重复，例如计算一个. csv文件中重复的行数</p><p id="2b68" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">sort data.csv | uniq -d | wc -l</code></p><h1 id="6f4a" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">控制结构</h1><p id="7fa6" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">快速if-then-else:</p><p id="e0d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">[[ "$ENV" == prod ]] &amp;&amp; bash run_production_job.sh || bash run_test_job.sh</code></p><p id="0c0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">检查文件是否存在:<code class="fe nd ne nf ng b">[[ -f configuration.file ]] &amp;&amp; bash run_training_job.sh || echo "Configuration missing"</code></p><p id="56bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数字比较:</p><p id="a2f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">[[ "$MODEL_ACCURACY" -ge 0.8 ]] &amp;&amp; bash deploy_model.sh || echo "Insufficient accuracy" | tee error.log</code></p><p id="bb62" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Bash是一种编程语言，所以它支持常规的<code class="fe nd ne nf ng b">for</code> / <code class="fe nd ne nf ng b">while</code> / <code class="fe nd ne nf ng b">break</code> / <code class="fe nd ne nf ng b">continue</code>结构。例如，要创建备份文件:</p><p id="3f9b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">for i in `ls .csv`; do cp "$i" "$i".bak ; done</code></p><p id="115a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Bash中定义函数也很简单，对于更复杂的逻辑来说，它可能是别名的有用替代物</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="bcc3" class="nl mh iq ng b gy nm nn l no np">view_map() {<br/>    open "https://www.google.com/maps/search/$1,$2/"<br/>}</span></pre><p id="726e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，上面用<code class="fe nd ne nf ng b">view_map 59.43 24.74</code>在塔林打开了一个谷歌地图浏览器窗口</p><p id="b1e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<code class="fe nd ne nf ng b">xargs</code>为多个参数执行一个命令:例如删除所有已经合并到master的本地Git分支。</p><p id="8b52" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">git branch --merged master | grep -v "master" | xargs git branch -d</code></p><h1 id="97ff" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">IO基础知识</h1><p id="435f" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">添加到文件中</p><p id="21cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">python server.py &gt;&gt; server.log</code></p><p id="5f94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将stdout和stderr写入文件和控制台</p><p id="4d7f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">python run_something.py 2&gt;&amp;1 | tee something.log</code></p><p id="7ab5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将所有输出写入void(丢弃它)</p><p id="738f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">python run_something.py &gt; /dev/null 2&gt;&amp;1</code></p><h1 id="19bf" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">操纵字符串</h1><p id="e0f9" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">你可以用括号扩展生成一个字符串列表:<code class="fe nd ne nf ng b">mkdir /var/project/{data,models,conf,outputs}</code></p><p id="66b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Bash内置了一些漂亮的字符串操作功能，比如</p><p id="92c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">${string//substring/replacement}</code></p><p id="2555" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于字符串，使用转换将小写替换为大写</p><p id="6984" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">cat lower_case_file | tr 'a-z' 'A-Z'</code>。</p><p id="4026" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，还有更强大的语言，如<code class="fe nd ne nf ng b">awk</code>和<code class="fe nd ne nf ng b">sed</code>内置来处理任何字符串操作。您还可以将Perl或Python与正则表达式一起用于任意复杂性的字符串操作。</p><p id="385e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了开始使用正则表达式，我发现有用的是交互式教程，如<a class="ae kv" href="https://regexone.com/" rel="noopener ugc nofollow" target="_blank"> RegexOne </a>和操场，如<a class="ae kv" href="https://regexr.com/" rel="noopener ugc nofollow" target="_blank"> regexr </a>。</p><h1 id="c64d" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">操作文件</h1><p id="2584" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">确保文件存在:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="ffe1" class="nl mh iq ng b gy nm nn l no np">if [[ ! -f stuff/parent_of_files/files/necessary.file ]]; then<br/>	mkdir -p stuff/parent_of_files/files<br/>	touch files/necessary.file<br/>fi</span></pre><p id="1ff1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">压缩和解压缩目录</p><p id="de90" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">tar -cvzf archive_name.tar.gz content_directory</code></p><p id="d352" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">tar -xvzf archive_name.tar.gz -C target_directory</code></p><p id="6b69" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">合并两个。具有相同索引的csv文件</p><p id="1266" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">join file1.csv file2.csv</code></p><p id="afd8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用单独的头文件合并N .csv文件</p><p id="ba75" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">cat header.csv file1.csv file2.csv ... &gt; target_file.csv</code></p><p id="8c67" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<code class="fe nd ne nf ng b">split</code>将文件分成块，例如. csv文件(保留文件头)</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="5d21" class="nl mh iq ng b gy nm nn l no np">tail -n +2 file.csv | split -l 4 - split_<br/>for file in split_*<br/>do<br/>    head -n 1 file.csv &gt; tmp_file<br/>    cat "$file" &gt;&gt; tmp_file<br/>    mv -f tmp_file "$file"<br/>done</span></pre><p id="d774" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从大样本中随机抽取一个样本。csv文件(这会将它加载到内存中):</p><p id="84dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">shuf -n 10 data.csv</code>如果您需要保留标题，但将子样本写入另一个文件:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="9137" class="nl mh iq ng b gy nm nn l no np">head -n 1 data.csv &gt; data_sample.csv<br/>shuf -n 10000 &lt;(tail -n +2 data.csv) &gt;&gt; data_sample.csv</span></pre><p id="92a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用<code class="fe nd ne nf ng b">sedsed 's/;/,/g' data.csv &gt; data.csv</code>改变文件分隔符</p><p id="ef86" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将文件发送到远程机器</p><p id="c456" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">scp /Users/andrei/local_directory/conf.py user@hostname:/home/andrei/conf.py</code></p><h1 id="e879" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">管理资源和作业</h1><p id="85f0" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">是什么占用了我所有的磁盘空间？<code class="fe nd ne nf ng b">ncdu</code>提供交互式视图。不需要额外安装的替代方案是<code class="fe nd ne nf ng b">du -hs * | sort -h</code></p><p id="7795" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">是什么/谁让整个机器变慢了？<code class="fe nd ne nf ng b">htop</code>为多彩版，<code class="fe nd ne nf ng b">top</code>否则。</p><p id="9125" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">uptime</code> -不言自明。</p><p id="e44c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让一个长时间运行的模型/脚本在服务器的后台执行，并将输出写到<code class="fe nd ne nf ng b">model.log</code> <code class="fe nd ne nf ng b">nohup python long_running_model.py &gt; model.log &amp;</code>这也打印出你可以用来终止进程的PID，如果过了一段时间你可以用<code class="fe nd ne nf ng b">ps -ef | grep long_running_model.py</code>找到PID</p><p id="770d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">向本地Flask服务发送带有(嵌套)有效负载的请求</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="1d5c" class="nl mh iq ng b gy nm nn l no np">curl \<br/>  -H 'Content-Type: application/json' \<br/>  -X POST \<br/>  -d '{"model_type": "neuralnet", "features": {"measurement_1": 50002.3, "measurement_2": -13, "measurement_3": 1.001}}' \<br/>  http://localhost:5000/invoke</span></pre><p id="50c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个进程占用一个端口吗？<code class="fe nd ne nf ng b">lsof -i :port_number</code></p><p id="8fd9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要<a class="ae kv" href="https://tldp.org/LDP/Bash-Beginners-Guide/html/sect_12_01.html#sect_12_01_02" rel="noopener ugc nofollow" target="_blank">干掉</a>岗位，先试<code class="fe nd ne nf ng b">kill PID</code>，最后再用<code class="fe nd ne nf ng b">kill -9 PID</code>。</p><h1 id="947a" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">变量</h1><h1 id="e310" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">基础</h1><p id="c3e2" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">使用<code class="fe nd ne nf ng b">printenv</code>查看您的环境变量。要设置一个永久的环境变量，将其添加到您的<code class="fe nd ne nf ng b">~/.bash_profile</code> : <code class="fe nd ne nf ng b">export MLFLOW_TRACKING_URI=http://mlflow.remoteserver</code>中，现在您可以在Python中访问<code class="fe nd ne nf ng b">os.environ["MLFLOW_TRACKING_URI"]</code>。</p><p id="1d5e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<code class="fe nd ne nf ng b">env</code>在自定义环境中运行命令:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="8a6a" class="nl mh iq ng b gy nm nn l no np">env -i INNER_SHELL=True bash</span></pre><p id="9c06" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<code class="fe nd ne nf ng b">local</code>在函数中声明局部范围变量。</p><h1 id="62f2" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">特殊参数</h1><p id="5028" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">有几个，但是一些有用的</p><p id="8d86" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">$?</code> -最后一条命令的退出状态</p><p id="1bcb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">$#</code> -脚本的位置参数数量</p><p id="7f23" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">$$</code> -过程ID</p><p id="9c17" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">$_</code> -外壳的绝对路径</p><p id="3585" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">$0</code> -脚本的名称</p><p id="621f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nd ne nf ng b">[[ $? == 0 ]] &amp;&amp; echo "Last command succeeded" || echo "Last command failed"</code></p><h1 id="ca36" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">变量操作</h1><p id="cc8a" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">您可以使用变量的一些技巧:</p><p id="5bc5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果未设置参数，则使用默认值:<code class="fe nd ne nf ng b">${MODEL_DIR:-"/Users/jack/work/models"}</code>或将其设置为另一个值:<code class="fe nd ne nf ng b">${MODEL_DIR:=$WORK_DIR}</code>或显示一条错误消息:<code class="fe nd ne nf ng b">${MODEL_DIR:?'No directory exists!'}</code></p><h1 id="fecc" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">命令行参数</h1><p id="31f1" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated"><code class="fe nd ne nf ng b">$#</code> -命令行参数的数量</p><p id="7d22" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您总是可以使用简单的<code class="fe nd ne nf ng b">$1</code>、<code class="fe nd ne nf ng b">$2</code>、<code class="fe nd ne nf ng b">$3</code>来使用与脚本一起传递的位置参数。</p><p id="87b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于简单的单字母命名参数，您可以使用内置的<code class="fe nd ne nf ng b">getopts</code>。</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="0cd5" class="nl mh iq ng b gy nm nn l no np">while getopts ":m:s:e:" opt; do<br/>    case ${opt} in<br/>        m) MODEL_TAG="$OPTARG"<br/>        ;;<br/>        s) DATA_START_DATE="$OPTARG"<br/>        ;;<br/>        e) DATA_END_DATE="$OPTARG"<br/>        ;;<br/>        \?) echo "Incorrect usage!"<br/>        ;;<br/>    esac<br/>done</span></pre><h1 id="17e6" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">巴利安</h1><p id="6765" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">Python代码可以在管道中内联运行——这意味着如果有必要，你可以用它来替换<code class="fe nd ne nf ng b">awk</code> / <code class="fe nd ne nf ng b">sed</code> / <code class="fe nd ne nf ng b">perl</code>:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="55f1" class="nl mh iq ng b gy nm nn l no np">echo "Hello World" | python3 -c "import sys; import re; input = sys.stdin.read(); output = re.sub('Hello World', 'Privet Mir', input); print(output)"</span></pre><p id="590a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">或者做任何事情:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="21f3" class="nl mh iq ng b gy nm nn l no np">model_accuracy=$(python -c 'from sklearn.svm import SVC; from sklearn.multiclass import OneVsRestClassifier; from sklearn.metrics import accuracy_score; from sklearn.preprocessing import LabelBinarizer; X = [[1, 2], [2, 4], [4, 5], [3, 2], [3, 1]]; y = [0, 0, 1, 1, 2]; classif = OneVsRestClassifier(estimator=SVC(random_state=0)); y_preds = classif.fit(X, y).predict(X); print(accuracy_score(y, y_preds))';)</span></pre><p id="58c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">向命令提供多行输入的另一种方法是使用here文档，例如:</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="2695" class="nl mh iq ng b gy nm nn l no np">python &lt;&lt;HEREDOC<br/>import sys<br/>for p in sys.path:<br/>  print(p)<br/>HEREDOC</span></pre><p id="d909" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其中<code class="fe nd ne nf ng b">HEREDOC</code>作为EOF编码，脚本仅在满足EOF后执行。</p><p id="ecc1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<code class="fe nd ne nf ng b">jq</code>命令在命令行上使用JSON。<a class="ae kv" href="https://www.datascienceatthecommandline.com/2e/chapter-5-scrubbing-data.html#working-with-xmlhtml-and-json" rel="noopener ugc nofollow" target="_blank">例题</a>。</p><h1 id="ff3f" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">资源</h1><p id="f2f6" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">初学者Bash指南——介绍脚本的不错资源</p><p id="255c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://www.gnu.org/software/coreutils/manual/coreutils.html" rel="noopener ugc nofollow" target="_blank"> GNU Coreutils手册</a> —了解你可以用默认工具做什么</p><p id="6252" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://www.datascienceatthecommandline.com/" rel="noopener ugc nofollow" target="_blank">命令行的数据科学</a>——如果你非常喜欢shell，想在那里做EDA/建模:)</p><p id="7625" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢马克·考恩的一些提示和技巧，他实际上知道一些Bash:)</p></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><p id="310c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nx">最初发表于2021年6月1日https://mlumiste.com</em><em class="nx">的</em> <a class="ae kv" href="https://mlumiste.com/peripherals/bash-cheat-sheet/" rel="noopener ugc nofollow" target="_blank"> <em class="nx">。</em></a></p></div></div>    
</body>
</html>