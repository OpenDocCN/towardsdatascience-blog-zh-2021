<html>
<head>
<title>Introduction to Time Series Forecasting — Part 2 (ARIMA Models)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列预测导论第二部分(ARIMA模型)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introduction-to-time-series-forecasting-part-2-arima-models-9f47bf0f476b?source=collection_archive---------2-----------------------#2021-07-30">https://towardsdatascience.com/introduction-to-time-series-forecasting-part-2-arima-models-9f47bf0f476b?source=collection_archive---------2-----------------------#2021-07-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b63b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">大多数时间序列预测方法都假设数据是“平稳的”，但实际上它往往需要某些变换才能进一步处理。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/fce5c298c294b46b51605c79a46bf96d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jWyo7dNr0pJd0wWY"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Miguel Luis 在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="d3c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第一篇文章中，我们看了简单的移动平均和指数平滑方法。在这篇文章中，我们将看看更复杂的方法，如ARIMA及其扩展。</p><h1 id="d06b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">方法3:季节性自回归综合移动平均数</h1><p id="bad4" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">季节性ARIMA是ARIMA模型的一个变种。它是支持数据季节性的ARIMA方法的扩展。让我们首先了解ARIMA模式的运作。</p><p id="ab88" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ARIMA是一种用于预测时间序列数据的统计模型。<strong class="ky ir">ARIMA方程是一个回归型方程，其中自变量是因变量的滞后和/或预测误差的滞后。</strong>ARIMA模型的方程式如下:</p><p id="67d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">y '(t)= c+ϕ1* y '(t1)+⋯+ϕp*y′(t−p)+θ1 *ε(t1)+⋯+θq *ε(TQ)+εt</strong></p><p id="59d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">等式中有三项:</p><p id="0556" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> AR:自动回归:</strong>时间序列用其以前的值回归，即y(t-1)，y(t-2)等。滞后的顺序表示为<strong class="ky ir"> p. </strong></p><p id="dcf7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> I:积分:</strong>时间序列使用差分使其平稳。差值的阶数表示为<strong class="ky ir"> d. </strong></p><p id="aa72" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> MA:移动平均:</strong>用过去观测值的残差对时间序列进行回归，即误差<strong class="ky ir"> ε </strong> (t-1)，误差<strong class="ky ir"> ε </strong> (t-2)等。误差滞后的阶数表示为<strong class="ky ir"> q. </strong></p><p id="d8a3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上式中，<strong class="ky ir">y′t</strong>为差分数列，<strong class="ky ir"> ϕ1 </strong>为第一项AR的系数，<strong class="ky ir"> p </strong>为AR项的阶次，<strong class="ky ir"> θ1 </strong>为第一项MA的系数，<strong class="ky ir"> q </strong>为MA项的阶次，<strong class="ky ir"> εt </strong>为误差。</p><p id="cda9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ARIMA不支持季节性数据。对于具有显著季节性模式的时间序列，使用季节性ARIMA模型。</p><p id="1e99" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它和ARIMA有什么不同？<strong class="ky ir">除了ARIMA的三个参数，即P、D、Q，SARIMA还有三个季节参数(P、D、Q)。</strong>额外的三个参数说明了<strong class="ky ir">季节水平的自回归分量(P)、差异分量(D)和移动平均分量(Q)。</strong></p><p id="80ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">可以表示如下:ARIMA (p，D，q) (P，D，Q)m <br/> </strong>这里m是每个季节的观测次数(在我们的例子中，m是12)。模型的季节性成分用大写字母表示，模型的非季节性成分用小写字母表示。</p><p id="41eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们进入萨里玛的细节之前，让我们先了解一下术语<strong class="ky ir">‘自相关’和‘偏自相关’。</strong></p><p id="8910" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">自相关函数(ACF) : </strong>滞后k的自相关是Y(t)和Y(t-k)之间的相关性，在不同的k滞后处测量。对于滞后1，在Y(t)和Y(t-1)之间测量自相关，类似地，对于滞后2，在Y(t)和Y(t-2)值之间测量自相关。不同k值的自相关图被称为<strong class="ky ir">自相关图或相关图。</strong></p><p id="3cb6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">偏自相关(PACF) : </strong>滞后k的偏自相关是在所有其他中间值(Y(t-1)，Y(t-2)，…)的影响下，Y(t)和Y(t-k)之间的相关。Y(t-k+1))同时从Y(t)和Y(t-k)中删除。例如，y(t)和y(t+1)之间的部分自相关与它们的自相关相同，因为它们之间没有中间项。y(t)和y(t+2)之间的部分自相关将从y(t)和y(t+2)中去除y(t+1)的影响。不同k值的部分自相关图称为<strong class="ky ir">部分自相关图。</strong></p><p id="6652" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">在我们使用ARIMA或其任何扩展之前，我们需要确保时间序列是平稳的。</strong></p><p id="7c1c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">时间序列的平稳性是什么意思？</strong></p><p id="28b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果一个时间序列具有以下三个性质，则称它是平稳的:</p><ol class=""><li id="3a0d" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated"><strong class="ky ir">它有一个恒定的平均值</strong>，即平均值随时间保持不变</li><li id="0f7b" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><strong class="ky ir">它有一个恒定的方差</strong>，即方差随时间保持恒定</li><li id="5f97" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><strong class="ky ir">它有一个恒定的协方差。</strong>两个时间段之间的协方差值取决于两个时间段之间的滞后，而不取决于计算协方差的时间。这意味着t=2和t = 4时序列之间的协方差应该与t=7和t=9时序列之间的协方差大致相同。</li></ol><p id="8774" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">平稳时间序列将具有相同的统计特性，即相同的均值、方差和协方差，无论我们在什么点测量它们，因此这些特性是时不变的。从长期来看，这个系列没有可预测的模式。时间图将显示序列大致水平，具有恒定的平均值和方差。</strong></p><p id="fbe6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为什么我们需要平稳的时间序列？因为如果时间序列不是平稳的，我们只能研究它在那个时间段的行为。时间序列的每个周期都有其独特的行为，如果序列不是稳定的，就不可能预测或概括未来的时间周期。</p><p id="1cfa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">一个平稳的时间序列将趋向于返回到它的平均值，围绕这个平均值的波动将具有恒定的幅度。</strong>因此，由于方差有限，平稳时间序列不会偏离均值太多。</p><p id="2fba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">平稳时间序列的一个例子是“白噪声”。</strong>由于其固有的平稳性，它没有可预测的长期模式。因此它是无记忆的。</p><p id="a650" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是白噪声的分布情况:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="00ea" class="ni lt iq ne b gy nj nk l nl nm"><em class="nn"># </em><strong class="ne ir"><em class="nn">Plot for White Noise with Mean 0 and standard deviation as 0.8</em></strong><br/>wnoise= np.random.normal(loc=0, scale=0.8, size=800)<br/>plt.figure(figsize=(15, 4)),<br/>plt.plot(wnoise);<br/>plt.title('Distribution of White Noise');</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/0ad99b84f84214458e0d1be0739a3881.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rsqAOwsBHc1HTQoQqFJR5w.png"/></div></div></figure><p id="2dc0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">从上面的图中可以看出，平均值的分布是恒定的，完全是随机的。很难预测时间序列的下一步动向。</strong>如果我们绘制该序列的自相关图，将会观察到完全的零自相关。这意味着任何时间t的序列与其滞后值之间的相关性为零。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="7aa2" class="ni lt iq ne b gy nj nk l nl nm">acr = plot_acf(wnoise, lags = 50)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/3ef024e5ad7830e21b9524390f9a28eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*owMQkpfV0fMD3j7O6mmZAw.png"/></div></figure><p id="b7ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的ACF(自相关图)中，你可以看到所有的滞后都在蓝色突出显示的区域内。这表明不同滞后的观测值之间几乎没有相关性。如果一个或多个尖峰在这个范围之外，或者超过5%的尖峰在这些范围之外，那么我们可以推断该序列不是“白噪声”。</p><h2 id="7bbb" class="ni lt iq bd lu nq nr dn ly ns nt dp mc lf nu nv me lj nw nx mg ln ny nz mi oa bi translated">我们如何检查平稳性？</h2><p id="5e04" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">用于检查平稳性的两个流行测试是<strong class="ky ir">增强迪基富勒测试(ADF)和科维亚特科夫斯基-菲利普斯-施密特-申测试(KPSS) </strong>。让我们详细看看每个测试。</p><h2 id="5fac" class="ni lt iq bd lu nq nr dn ly ns nt dp mc lf nu nv me lj nw nx mg ln ny nz mi oa bi translated"><strong class="ak"> 1。增强的迪基富勒测验:</strong></h2><p id="b844" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这种统计检验属于称为单位根检验的类别。它检查时间序列是否有单位根，从而是非平稳的。当我们进行这个测试来检查平稳性时，我们检查单位根。</p><p id="4288" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">零假设Ho </strong>:有单位根，即时间序列是非平稳的<br/> <strong class="ky ir">交替假设Ha </strong>:没有单位根，即时间序列是平稳的</p><h2 id="dbf0" class="ni lt iq bd lu nq nr dn ly ns nt dp mc lf nu nv me lj nw nx mg ln ny nz mi oa bi translated"><strong class="ak">单位根是什么意思？</strong></h2><p id="06e5" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">观察到两种非平稳随机时间序列:</p><ol class=""><li id="0aa4" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">无漂移随机行走模型</li><li id="3d19" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">漂移随机游动模型</li></ol><p id="1029" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">无漂移随机游走中，</strong>序列的均值是常数，等于其初始值或起始值，但方差随时间增加。因此，该序列是非平稳的。通常，股票价格被认为是遵循随机游走的。显示随机游走的数据具有长周期的上升或下降趋势，以及方向上的突然和不可预测的变化。<br/>因此，这个模型的预测是最后一次观察，因为未来的运动是不可预测的，同样有可能上升或下降。</p><p id="a99f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">时间序列Y在t时刻的值等于其在t-1时刻的值加上一个随机冲击即<strong class="ky ir"> Y(t) = Y(t-1) +误差u(t) </strong> <br/> <strong class="ky ir">无漂移随机游走的一阶差分是一个平稳的时间序列。</strong>为什么？原因从上式可知，Y(t) — Y(t-1) =误差项u(t)。误差项是具有均值0和恒定方差的白噪声或平稳序列</p><p id="7ea1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">在有漂移的随机游走</strong>中，序列的均值和方差都随时间增加。因此，该序列不是静止的。这里，时间t的时间序列值等于时间(t-1)的值加上漂移参数α加上随机冲击，即Y(t)= Y(t-1)+α+u(t)。漂移参数α是系列从一个周期到下一个周期的平均增量。</p><p id="1b1b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">随机游走模型被称为单位根过程。</strong></p><p id="f9ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">写为:Y(t) = (Delta)* Y(t-1) + u(t) </strong></p><p id="cdbe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">如果delta的值为1(随机游走)或大于1(有漂移的随机游走)，则序列是非平稳的。如果delta的值小于1，我们断定该序列是平稳的。</strong></p><p id="2948" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nn">请注意，非平稳性或单位根也可能是确定性趋势的原因。我在本文中没有涉及这一部分。</em></p><p id="20f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们看看KPSS测试。</p><p id="df71" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 2。科维亚特科夫斯基-菲利普斯-施密特-申(KPSS测试):</strong></p><p id="43f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是另一个不太流行的检验平稳性的测试。这里的零假设和交替假设与ADF检验相反。</p><p id="1b32" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">零假设:</strong>过程是趋势平稳的。</p><p id="8256" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">交替假设:</strong>数列有单位根(数列不是平稳的)。</p><p id="41da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们使用这两种测试来确认平稳性，则可能出现以下四种情况之一:</p><p id="60ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">情景一— </strong>两个测试都得出平稳性结论。因此，数列是平稳的。</p><p id="c8c8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">情景二</strong> —两个测试都得出非平稳性的结论。因此，该序列是非平稳的。</p><p id="7694" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">情景三</strong> — ADF检验得出平稳性结论，但KPSS检验得出非平稳性结论。这表明需要使用差分来使序列平稳。这里，创建了一个新的序列，其中时间t处的观测值由时间t处的实际值和时间t-1处的值之间的差给出。因此，</p><p id="4cb4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">差分序列的值(t)=观测值(t)-观测值(t-1) </strong></p><p id="eb3f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">情景四</strong> — ADF检验得出非平稳性结论，但KPSS检验证实平稳性。这表明需要使用去趋势来使系列静止。常见的去趋势方法包括使用对数变换、原始序列的平方根变换。</p><p id="847e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦数列稳定下来，下一步就是建立ARIMA模型。建立ARIMA模型有两种方法。</p><p id="a0d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">方法1: </strong>通过查看差异数据的ACF和PACF图，手动选择模型阶数，并确定p和q的最佳值。使用不同的p和q值构建多个模型，并选择最终模型，即<strong class="ky ir"> </strong>具有<strong class="ky ir">最低AIC的模型。(AIC或阿凯克的信息准则是一个有用的模型选择工具。给定一组时间序列数据的模型，最佳模型是具有最低AIC的模型。它通过惩罚具有更多参数的模型来平衡拟合优度和过度拟合。)</strong></p><p id="ec3b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">方法2: </strong>使用Auto Arima (auto.arima())寻找给定时间序列的最佳模型。</p><p id="2a90" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">实际上，这两种方法混合使用。使用方法1，确定p和q的范围。在下一步中，Auto Arima函数用于步骤1中确定的范围。</p><p id="8753" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在方法1中提到的ARIMA模型中，有一些用于确定p、d和q的最佳值的指导原则。这些措施如下:</p><h2 id="4479" class="ni lt iq bd lu nq nr dn ly ns nt dp mc lf nu nv me lj nw nx mg ln ny nz mi oa bi translated">准则1:确定ARIMA模型中的差分顺序:</h2><p id="cfd9" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">拟合ARIMA模型的第一步也是最重要的一步是决定差分的阶次，以使序列平稳。正确的方法是从最低差值开始，即d=1。通常这将使系列静止。然而，如果仍然有一个显著的趋势，或者如果滞后≥10的自相关为正显著，那么序列需要二阶差分。阶数大于2的差分从来不是优选的。</p><p id="c004" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果差分序列的滞后1的自相关为零或负值，或者如果自相关都很小且没有模式，则该序列不需要更多的差分。如果滞后-1自相关比-0.5更负，则表明序列可能已被过度差分。</p><h2 id="1fbd" class="ni lt iq bd lu nq nr dn ly ns nt dp mc lf nu nv me lj nw nx mg ln ny nz mi oa bi translated">准则2:识别ARIMA模型中的应收账款或并购术语:</h2><p id="29f2" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">一旦我们有了平稳序列，下一步就是确定ARIMA模型中的AR和MA项。直觉如下:</p><ol class=""><li id="6608" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">如果差分序列的PACF显示出一个锐截止和/或lag1自相关为正(这表明一个“欠差分”序列),而ACF衰减较慢，则考虑在模型中增加一个AR项。AR术语的数量将取决于PACF截止的滞后时间。</li><li id="5ad6" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">如果差分序列的ACF显示出锐截止和/或lag1自相关为负(这表示“过度差分”序列),而PACF衰减较慢，则考虑将MA项添加到模型中。这里，通过添加MA项来解释自相关模式。MA项的数量将取决于ACF截止的滞后。</li><li id="6a51" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">AR项与滞后1处的欠差分或正自相关相关，而MA项与滞后1处的过差分或负自相关相关。</li></ol><h2 id="7709" class="ni lt iq bd lu nq nr dn ly ns nt dp mc lf nu nv me lj nw nx mg ln ny nz mi oa bi translated">准则3:最终确定哪种ARIMA模式？</h2><p id="4590" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">选择与AR或MA项差异水平较低的模型。然而，AR和MA的混合模型有时可能是最佳选择。</p><p id="e707" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">如果AR系数之和等于1或几乎等于1(即存在单位根)，则增加差分阶数并减少AR项数。</strong></p><p id="eae5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">如果MA系数之和等于1或接近1，则降低差分阶数，增加MA项数。</strong></p><p id="92f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">AR系数之和或MA系数之和等于1的模型称为有“单位根”。这种模型没有作为白噪声的残差。</p><p id="a381" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nn">除了ARIMA模型中的P、D、q，像萨里玛这样的季节性模型还有额外的季节性项P、D、q。这些也可以从ACF和PACF图中确定。</em></p><h2 id="0c5d" class="ni lt iq bd lu nq nr dn ly ns nt dp mc lf nu nv me lj nw nx mg ln ny nz mi oa bi translated">季节性ARIMA (SARIMA)指南:</h2><h2 id="63d8" class="ni lt iq bd lu nq nr dn ly ns nt dp mc lf nu nv me lj nw nx mg ln ny nz mi oa bi translated"><strong class="ak">准则4 </strong>:识别季节性和非季节性差异顺序:</h2><p id="2b6e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">SARIMA模型中最重要的一步是决定是否需要季节差异。如果季节性很强，应该使用季节差异的顺序。如果序列在应用季节差异后仍然不是平稳的，我们可以考虑应用非季节差异。H <strong class="ky ir"> <em class="nn">然而，永远不要使用一个以上的季节差异，季节和非季节差异之和不应超过2。</em>T11】</strong></p><p id="b29b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们使用季节性差异和非季节性差异的顺序并不重要，但是，如果我们有高度季节性的数据，最好先执行季节性差异，然后执行非季节性差异。</p><h2 id="5300" class="ni lt iq bd lu nq nr dn ly ns nt dp mc lf nu nv me lj nw nx mg ln ny nz mi oa bi translated">准则5:识别季节性和非季节性AR和MA术语:</h2><p id="9a6a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果季节性滞后k处的自相关为正(在我们的例子中k=12，24，36 ),则向模型添加季节性AR项(P)。如果季节性滞后的自相关为负，则向模型添加季节性MA项(Q)。<strong class="ky ir">应注意不要在同一个模型中同时包含季节性AR和MA术语，并且每个术语的顺序不应超过1。</strong></p><p id="22fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些是杜克大学的罗伯特·瑙提出的指导方针。请参考以下链接，以获得对上述准则的详细理解。https://people.duke.edu/~rnau/411arim.htm<a class="ae kv" href="https://people.duke.edu/~rnau/411arim.htm" rel="noopener ugc nofollow" target="_blank"/></p><p id="3516" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我<strong class="ky ir">总结一下</strong>ARIMA/萨里玛造型的关键步骤:</p><ol class=""><li id="c6f9" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">绘制时间序列数据，观察趋势和季节性</li><li id="1136" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">使用ADF和KPSS等统计测试来检查平稳性</li><li id="4d2c" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">如果序列不稳定，请使用差分或去趋势等变换。对于季节性数据，除了非季节性差异外，可能还需要季节性差异。</li><li id="1ff9" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">一旦确定了差分的阶数，我们就需要决定最佳的AR和MA项。</li><li id="979c" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">使用ACF和PACF图获得参数P，P，Q，Q的范围。使用auto.arima并指定这些参数的范围。</li><li id="9b1b" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">检查回归模型的假设，即误差的正态性和误差之间没有自相关。</li></ol><p id="0493" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们一次一个地完成这些步骤。</p><p id="49aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据的曲线如下:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="880f" class="ni lt iq ne b gy nj nk l nl nm">plt.figure(figsize=(15,5))<br/>plt.ylabel('Energy Production')<br/>plt.title('Trend of Energy Production')<br/>plt.plot(df['Energy_Production'],'b-');</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/1f2c4e9a245932c6f85433fda32fee06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qSOmqL_coRU7bXBYImaVUA.png"/></div></div></figure><p id="c14b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里我们将去掉某一部分数据，即从1940年到1964年的观测数据。原因是非常旧的数据，可能会引起不必要的噪声。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="76d5" class="ni lt iq ne b gy nj nk l nl nm">df1 = df.copy()<br/>df2 = df1['Energy_Production'][312:]<br/>df2 = pd.DataFrame(df2)<br/>df2.head()</span></pre><p id="5007" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">能源_生产日期<br/>1965–01–01 29.4598<br/>1965–02–01 28.7989<br/>1965–03–01 28.8497<br/>1965–04–01 28.1889<br/>1965–05–01 27.7059</p><p id="dca7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在可以继续运行统计测试来检查平稳性。</p><h2 id="b0b1" class="ni lt iq bd lu nq nr dn ly ns nt dp mc lf nu nv me lj nw nx mg ln ny nz mi oa bi translated"><strong class="ak">测试1:增强的Dickey Fuller测试:</strong></h2><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="8a2d" class="ni lt iq ne b gy nj nk l nl nm">X = df2['Energy_Production'].values<br/>result = adfuller(X)<br/>print('ADF Statistic: <strong class="ne ir">%f</strong>' % result[0])<br/>print('p-value: <strong class="ne ir">%f</strong>' % result[1])<br/>print('Critical Values:')<br/><strong class="ne ir">for</strong> key, value <strong class="ne ir">in</strong> result[4].items():<br/>    print('<strong class="ne ir">\t%s</strong>: <strong class="ne ir">%.3f</strong>' % (key, value))</span><span id="84f4" class="ni lt iq ne b gy oc nk l nl nm"><strong class="ne ir">ADF Statistic: -2.231551<br/>p-value: 0.194994<br/>Critical Values:<br/>	1%: -3.440<br/>	5%: -2.866<br/>	10%: -2.569</strong></span></pre><p id="626b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，p值大于0.05，因此我们不能拒绝零假设。因此，级数有单位根，是非平稳的。</p><h2 id="ee1f" class="ni lt iq bd lu nq nr dn ly ns nt dp mc lf nu nv me lj nw nx mg ln ny nz mi oa bi translated">测试2 : KPSS测试</h2><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="da91" class="ni lt iq ne b gy nj nk l nl nm"><strong class="ne ir">from</strong> <strong class="ne ir">statsmodels.tsa.stattools</strong> <strong class="ne ir">import</strong> kpss<br/><br/><strong class="ne ir">def</strong> kpss_test(timeseries):<br/>    print("Results of KPSS Test:")<br/>    kpsstest = kpss(timeseries, regression="c")<br/>    kpss_output = pd.Series(<br/>        kpsstest[0:3], index=["Test Statistic", "p-value", "Lags Used"]<br/>    )<br/>    <strong class="ne ir">for</strong> key, value <strong class="ne ir">in</strong> kpsstest[3].items():<br/>        kpss_output["Critical Value (<strong class="ne ir">%s</strong>)" % key] = value<br/>    print(kpss_output)</span><span id="8add" class="ni lt iq ne b gy oc nk l nl nm">kpss_test(df2['Energy_Production'].values)</span><span id="96e4" class="ni lt iq ne b gy oc nk l nl nm"><strong class="ne ir">Results of KPSS Test:<br/>Test Statistic            3.273962<br/>p-value                   0.010000<br/>Lags Used                20.000000<br/>Critical Value (10%)      0.347000<br/>Critical Value (5%)       0.463000<br/>Critical Value (2.5%)     0.574000<br/>Critical Value (1%)       0.739000<br/>dtype: float64</strong></span></pre><p id="1571" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，p值小于0.05。然而，KPSS检验的零假设与ADF检验相反。因此，在这里，我们将拒绝平稳序列的零假设，并得出结论，该序列是非平稳的。</p><p id="6253" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">这与场景2类似，两个测试都确认给定序列是非平稳的。我们现在将考虑使数列平稳的步骤。</strong></p><p id="754d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">鉴于季节性很强，我们将首先使用季节差异。给定m=12，我们需要将时间t的观测值与其在t-12的滞后值区别开来。如果我们这样做，差分序列的前12个观测值将取NaN值。这里，季节差异D的顺序是1。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="7150" class="ni lt iq ne b gy nj nk l nl nm">df2['Energy_Production_diff'] = df2['Energy_Production'] - df2['Energy_Production'].shift(12)<br/>df2[['Energy_Production','Energy_Production_diff']].head(13)</span></pre><p id="bfe8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">日期能源_生产能源_生产_差异<br/>1965–01–01 29.4598南<br/>1965–02–01 28.7989南<br/>1965–03–01 28.8497南<br/>1965–04–01 28.1889南<br/>1965–05–01 27.7059南<br/>1965–06–08</p><p id="fd84" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将删除NaN观测值，并绘制数据序列，以检查差分是否使序列平稳。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="4796" class="ni lt iq ne b gy nj nk l nl nm">plt.figure(figsize=(18,5));<br/>plt.xlabel('Time');<br/>plt.ylabel('Energy Production');<br/>plt.title('Differenced Time Series of Energy Production');<br/>plt.plot(df2['Energy_Production_diff1']);</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/61b36be310dacbe9871974ec81da9778.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ikBsYz3HCI_Lwsr3eSJDw.png"/></div></div></figure><p id="5a63" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尽管方差不是常数，但该序列看起来几乎是平稳的。我们将再次运行这两个测试来确认稳定性。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="58e9" class="ni lt iq ne b gy nj nk l nl nm"><strong class="ne ir"># ADF Test: </strong><br/>X = df2['Energy_Production_diff1'].dropna().values<br/>result = adfuller(X)<br/>print('ADF Statistic: <strong class="ne ir">%f</strong>' % result[0])<br/>print('p-value: <strong class="ne ir">%f</strong>' % result[1])<br/>print('Critical Values:')<br/><strong class="ne ir">for</strong> key, value <strong class="ne ir">in</strong> result[4].items():<br/>    print('<strong class="ne ir">\t%s</strong>: <strong class="ne ir">%.3f</strong>' % (key, value))</span><span id="c79f" class="ni lt iq ne b gy oc nk l nl nm"><strong class="ne ir">ADF Statistic: -7.448126<br/>p-value: 0.000000<br/>Critical Values:<br/>	1%: -3.440<br/>	5%: -2.866<br/>	10%: -2.569</strong></span></pre><p id="c777" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，p值小于0.05。因此，我们将拒绝零假设，并得出结论，该序列是平稳的。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="2109" class="ni lt iq ne b gy nj nk l nl nm"><strong class="ne ir"># KPSS Test </strong><br/>kpss_test(X)</span><span id="4f3d" class="ni lt iq ne b gy oc nk l nl nm">Results of KPSS Test:<br/><strong class="ne ir">Test Statistic            0.575462<br/>p-value                   0.024867</strong><br/>Lags Used                20.000000<br/>Critical Value (10%)      0.347000<br/>Critical Value (5%)       0.463000<br/>Critical Value (2.5%)     0.574000<br/>Critical Value (1%)       0.739000<br/>dtype: float64</span></pre><p id="dcdd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">KPSS检验的p值小于0.05。因此，我们将拒绝数列是平稳的零假设。KPSS检验的结论是该序列是非平稳的。</p><p id="7a64" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">这个结果类似于本文上面提到的场景3。两种检验都给出了相互矛盾的结果，ADF的结论是序列是平稳的，而KPSS检验的结论则相反。</strong>因此，我们可以得出结论，该序列是非平稳的。如果我们绘制差分序列的ACF和PACF图，我们可以看到初始滞后之间的强正自相关。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="c4e3" class="ni lt iq ne b gy nj nk l nl nm">acf_plot = plot_acf(df2['Energy_Production_diff1'].dropna(), lags= 30)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/1dfddb7a94f908e54d4742db218b8bd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*BviBeSBengpvHNlTtue78A.png"/></div></figure><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="53cb" class="ni lt iq ne b gy nj nk l nl nm">pacf_plot = plot_pacf(df2['Energy_Production_diff1'].dropna(), lags= 30)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/7717694d85c186ec0b3e53521af85cc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*h1d_fggd0wNabzHcMrFanA.png"/></div></figure><p id="e2dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们将继续下去，并再次差分序列，使其静止。这将是1阶的非季节性差异，即d = 1</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="1564" class="ni lt iq ne b gy nj nk l nl nm">df2['Energy_Production_diff121'] = df2['Energy_Production_diff1'] - df2['Energy_Production_diff1'].shift(1)<br/></span></pre><p id="9775" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用两个统计测试来检查和确认平稳性。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="2e6a" class="ni lt iq ne b gy nj nk l nl nm"><strong class="ne ir"># ADF Test </strong><br/>X = df2['Energy_Production_diff121'].dropna().values<br/>result = adfuller(X)<br/>print('ADF Statistic: <strong class="ne ir">%f</strong>' % result[0])<br/>print('p-value: <strong class="ne ir">%f</strong>' % result[1])<br/>print('Critical Values:')<br/><strong class="ne ir">for</strong> key, value <strong class="ne ir">in</strong> result[4].items():<br/>    print('<strong class="ne ir">\t%s</strong>: <strong class="ne ir">%.3f</strong>' % (key, value))</span><span id="4991" class="ni lt iq ne b gy oc nk l nl nm"><strong class="ne ir">ADF Statistic: -8.939993<br/>p-value: 0.000000</strong><br/>Critical Values:<br/>	1%: -3.441<br/>	5%: -2.866<br/>	10%: -2.569</span><span id="cfb0" class="ni lt iq ne b gy oc nk l nl nm"># <strong class="ne ir">KPSS Test:</strong><br/>kpss_test(X)<br/>Results of KPSS Test:<br/><strong class="ne ir">Test Statistic            0.017791<br/>p-value                   0.100000</strong><br/>Lags Used                20.000000<br/>Critical Value (10%)      0.347000<br/>Critical Value (5%)       0.463000<br/>Critical Value (2.5%)     0.574000<br/>Critical Value (1%)       0.739000<br/>dtype: float64</span></pre><p id="5227" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">在这一步，两个测试都确认系列是稳定的。</strong>让我们绘制ACF图和PACF图，以及总体差异系列图。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="cdb1" class="ni lt iq ne b gy nj nk l nl nm">acf_plot = plot_acf(df2['Energy_Production_diff121'].dropna(), lags= 30)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/68fe08a5a87b9852a11460a2046abe49.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*btELzn3Q1yG6VeYvwus-EQ.png"/></div></figure><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="df5b" class="ni lt iq ne b gy nj nk l nl nm">pacf_plot = plot_pacf(df2['Energy_Production_diff121'].dropna(), lags= 30)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/f987eb3a9cb8b10d4841d98333c7877f.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*G-e7HryifL475g-C6xCNOA.png"/></div></figure><p id="90f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这两个图确实有明显的滞后，但我们将继续处理序列平稳，如ADF和KPSS测试所证实的。差分序列的曲线如下:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="3a2b" class="ni lt iq ne b gy nj nk l nl nm">plt.figure(figsize=(18,5));<br/>plt.xlabel('Time');<br/>plt.ylabel('Energy Production');<br/>plt.title('Differenced Time Series of Energy Production');<br/>plt.plot(df2['Energy_Production_diff121']);</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/5c4a0bdd792cd23dce92bd114223ca8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NNnHU6bDAR2chMGbxK1UnQ.png"/></div></div></figure><p id="dc99" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个图看起来很像白噪声的分布。我们可以从上面的图中推断出这个数列是平稳的。</p><p id="6947" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到目前为止，我们已经使用了两次差分，即一次D=1阶的季节性差分和一次d=1阶的非季节性差分。下一步是确定AR和MA参数。在ACF图中，在1、12和24处有显著的负滞后。因此，MA参数应为1，季节性MA参数应为2。<strong class="ky ir">(准则2，5) </strong>。鉴于PACF图在1和12处也有负滞后，根据指南，我们将不包括AR和季节性AR项。</p><p id="e4fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="nn">由此，模型的最终顺序似乎是(0，1，1)(0，1，2)12。</em> </strong></p><p id="ad92" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在遵循ACF和PACF图的方法1时，很难在第一时间提出最佳模型。这是因为要正确解读这些情节是非常困难的。因此，一般的方法是将这两种方法结合起来。使用第一种方法，我们可以确定非季节性参数P、D、q和季节性参数P、D、q的范围。然后，这可以作为auto arima函数的输入。</p><p id="0ad8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看它是如何实现的。</p><p id="bb86" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将首先安装库“pmdarima ”,然后导入它。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="7df4" class="ni lt iq ne b gy nj nk l nl nm"><strong class="ne ir">import</strong> <strong class="ne ir">pmdarima</strong> <strong class="ne ir">as</strong> <strong class="ne ir">pm<br/>from</strong> <strong class="ne ir">pmdarima</strong> <strong class="ne ir">import</strong> auto_arima<br/><em class="nn"># Ignore harmless warnings</em><br/><strong class="ne ir">import</strong> <strong class="ne ir">warnings</strong><br/>warnings.filterwarnings("ignore")</span><span id="68a6" class="ni lt iq ne b gy oc nk l nl nm">df3 = df2['Energy_Production']</span></pre><p id="d10e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将从ACF和PACF图中定义P、Q、P、Q值的范围。这里，我们取了d=D=1。(在这种情况下，ADF和KPSS测试是同步的)。我们将参数P，P，Q，Q初始化为0，最大值为2。正如指南中提到的，我们不应该建立具有更高阶AR、MA、SAR、SMA参数的模型。假设数据是季节性的，这里m是12，search = ' True '。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="cf13" class="ni lt iq ne b gy nj nk l nl nm">model = auto_arima(df3, start_p=0, start_q=0,<br/>                          max_p=2, max_q=2,m=12,start_P=0,start_Q=0, <br/>                          max_P = 2, max_Q = 2,<br/>                          seasonal=<strong class="ne ir">True</strong>,<br/>                          d=1,D=1,trace=<strong class="ne ir">True</strong>,<br/>                          error_action='ignore',   <br/>                          suppress_warnings=<strong class="ne ir">True</strong>,  <br/>                          stepwise=<strong class="ne ir">True</strong>)</span></pre><p id="8838" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码需要一些时间来运行，因为它评估了许多模型的组合。代码的输出是具有最小AIC的模型。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="bda4" class="ni lt iq ne b gy nj nk l nl nm">Performing stepwise search to minimize aic<br/> ARIMA(0,1,0)(0,1,0)[12]             : AIC=3281.487, Time=0.08 sec<br/> ARIMA(1,1,0)(1,1,0)[12]             : AIC=3171.654, Time=0.23 sec<br/> ARIMA(0,1,1)(0,1,1)[12]             : AIC=3018.258, Time=0.58 sec<br/> ARIMA(0,1,1)(0,1,0)[12]             : AIC=3218.537, Time=0.08 sec<br/> ARIMA(0,1,1)(1,1,1)[12]             : AIC=3015.997, Time=0.92 sec<br/> ARIMA(0,1,1)(1,1,0)[12]             : AIC=3141.548, Time=0.28 sec<br/> ARIMA(0,1,1)(2,1,1)[12]             : AIC=2994.828, Time=1.94 sec<br/> ARIMA(0,1,1)(2,1,0)[12]             : AIC=3058.224, Time=0.81 sec<br/> ARIMA(0,1,1)(2,1,2)[12]             : AIC=2977.369, Time=5.76 sec<br/> ARIMA(0,1,1)(1,1,2)[12]             : AIC=3010.587, Time=3.48 sec<br/> ARIMA(0,1,0)(2,1,2)[12]             : AIC=3047.276, Time=4.01 sec<br/> ARIMA(1,1,1)(2,1,2)[12]             : AIC=2912.252, Time=7.25 sec<br/> ARIMA(1,1,1)(1,1,2)[12]             : AIC=2931.644, Time=4.72 sec<br/> ARIMA(1,1,1)(2,1,1)[12]             : AIC=2918.937, Time=3.15 sec<br/> ARIMA(1,1,1)(1,1,1)[12]             : AIC=2937.865, Time=1.59 sec<br/> ARIMA(1,1,0)(2,1,2)[12]             : AIC=3010.240, Time=6.52 sec<br/> ARIMA(2,1,1)(2,1,2)[12]             : AIC=2914.225, Time=9.10 sec<br/> ARIMA(1,1,2)(2,1,2)[12]             : AIC=2914.220, Time=7.80 sec<br/> ARIMA(0,1,2)(2,1,2)[12]             : AIC=2930.445, Time=5.22 sec<br/> ARIMA(2,1,0)(2,1,2)[12]             : AIC=2980.502, Time=6.62 sec<br/> ARIMA(2,1,2)(2,1,2)[12]             : AIC=2916.073, Time=16.42 sec<br/> ARIMA(1,1,1)(2,1,2)[12] intercept   : AIC=2914.035, Time=21.91 sec<br/><br/><strong class="ne ir">Best model:  ARIMA(1,1,1)(2,1,2)[12] </strong>         <br/>Total fit time: 108.511 seconds</span></pre><p id="f8b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看模型的总结。Auto Arima给出(1，1，1)(2，1，2)12作为最佳模型，即具有最小AIC的模型。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="420d" class="ni lt iq ne b gy nj nk l nl nm">print(model.summary())</span><span id="d455" class="ni lt iq ne b gy oc nk l nl nm"><strong class="ne ir">Statespace Model Results        </strong>                         <br/>===================================================================<br/>Dep. Variable:      y                 No. Observations: 677<br/>Model: SARIMAX(1, 1, 1)x(2, 1, 2, 12) Log Likelihood: -1449.126            <br/>Date:  Wed, 28 Jul 2021               AIC: 2912.252                      <br/>Time:  17:14:03                       BIC: 2943.740                      <br/>Sample: 0- 677                        HQIC : 2924.454                                                                                                            Covariance Type: opg                                                                  <br/>====================================================================<br/>                 coef    std err          z      P&gt;|z|      <br/><strong class="ne ir">ar.L1</strong>          0.5133      0.034     15.039      0.000             <br/><strong class="ne ir">ma.L1</strong>         -0.9304      0.018    -52.457      0.000           <br/><strong class="ne ir">ar.S.L12</strong>       0.6594      0.090      7.340      0.000             <br/><strong class="ne ir">ar.S.L24</strong>      -0.3230      0.041     -7.930      0.000           <br/><strong class="ne ir">ma.S.L12 </strong>     -1.3218      0.093    -14.195      0.000           <br/><strong class="ne ir">ma.S.L24</strong>       0.5492      0.075      7.350      0.000            <br/>sigma2         4.5143      0.186     24.224      0.000             <br/>====================================================================<br/>Ljung-Box (Q): 52.32                  Jarque-Bera (JB): 112.23       <br/>Prob(Q): 0.09                         Prob(JB):0.00                         <br/>Heteroskedasticity (H):4.73           Skew: 0.07                            <br/>Prob(H) (two-sided): 0.00             Kurtosis: 5.01<br/>====================================================================<br/><br/>Warnings:<br/>[1] Covariance matrix calculated using the outer product of gradients (complex-step).</span></pre><p id="7d68" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">需要进行某些检查:AR和MA项的系数小于1，两个季节性AR项的系数之和小于1，两个MA项的系数之和也小于1。这些项中的每一项在p值小于0.05时都是显著的。这似乎是一个很好的模式。因此，萨里玛模型(1，1，1) (2，1，2)12是最终选择的模型。 <em class="nn">(这接近我们从图中识别的模型(0，1，1)(0，1，2)12)</em></p><p id="ff13" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在将数据分为训练和测试，并计算测试数据的预测。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="1523" class="ni lt iq ne b gy nj nk l nl nm">train = df3[:612]<br/>test = df3[612:]</span><span id="4d38" class="ni lt iq ne b gy oc nk l nl nm"><strong class="ne ir">from</strong> <strong class="ne ir">statsmodels.tsa.statespace.sarimax</strong> <strong class="ne ir">import</strong> SARIMAX<br/>final_model = SARIMAX(train,order=(1,1,1),seasonal_order=(2,1,2,12))<br/>result = final_model.fit()<br/>print(result.summary())</span></pre><p id="c415" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">摘要如下:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="f7fa" class="ni lt iq ne b gy nj nk l nl nm">Statespace Model Results                                 <br/>====================================================================<br/>Dep. Variable: Energy_Production        No. Observations:612                 <br/>Model: SARIMAX(1, 1, 1)x(2, 1, 2, 12)   Log Likelihood :-1247.862               <br/>Date:  Wed, 28 Jul 2021                 AIC :2509.724                           <br/>Time:  17:14:32                         BIC :2540.491                         <br/>Sample: 01-01-1965- 12-01-2015          HQIC: 2521.702                         <br/>                                                                                                            <br/>====================================================================<br/>                 coef    std err          z      P&gt;|z|     <br/>--------------------------------------------------------------------<br/><strong class="ne ir">ar.L1 </strong>         0.5832      0.038     15.368      0.000       <br/><strong class="ne ir">ma.L1  </strong>       -0.9411      0.017    -55.676      0.000      <br/><strong class="ne ir">ar.S.L12  </strong>     0.6723      0.167      4.020      0.000       <br/><strong class="ne ir">ar.S.L24 </strong>     -0.2318      0.047     -4.908      0.000      <br/><strong class="ne ir">ma.S.L12  </strong>    -1.3065      0.169     -7.738      0.000      <br/><strong class="ne ir">ma.S.L24</strong>       0.5211      0.125      4.175      0.000       <br/><strong class="ne ir">sigma2  </strong>       3.7119      0.161     23.044      0.000      <br/>===================================================================================<br/>Ljung-Box (Q): 61.31                  Jarque-Bera (JB): 109.28              <br/>Prob(Q): 0.02                         Prob(JB): 0.00                        <br/>Heteroskedasticity (H): 4.62          Skew: -0.11<br/>Prob(H) (two-sided): 0.00             Kurtosis: 5.08                         <br/>====================================================================<br/>Warnings:<br/>[1] Covariance matrix calculated using the outer product of gradients (complex-step).</span></pre><p id="02f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还将运行模型诊断来检查误差的正态性假设和残差分布。如果误差是正态分布的，并且彼此不相关，那么我们实际上有一个好的模型。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="c242" class="ni lt iq ne b gy nj nk l nl nm">result.plot_diagnostics(figsize=(15, 12));</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/a535c44c4cd860ffea712927a670bc05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0MGJjLhfLhhML3pFn7vyIg.png"/></div></div></figure><p id="094d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">我们在这里可以看到残差是白噪声，也是正态分布。因此，我们可以继续这一模式。</strong></p><p id="499f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在将预测测试数据，然后检查准确性。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="e789" class="ni lt iq ne b gy nj nk l nl nm"><em class="nn"># Obtain predicted values</em><br/>start=len(train)<br/>end=len(train)+len(test)-1<br/>predictions = result.predict(start=start, end=end, dynamic=<strong class="ne ir">False</strong>, typ='levels').rename('SARIMA(1,1,1)(2,1,2,12) Predictions')</span><span id="9b79" class="ni lt iq ne b gy oc nk l nl nm"><em class="nn"># Plot predictions against known values</em><br/>title = 'Energy Production - Actual vs. Predicted'<br/>ylabel='Production'<br/>xlabel='Date'<br/><br/>ax = test.plot(legend=<strong class="ne ir">True</strong>,figsize=(12,6),title=title)<br/>predictions.plot(legend=<strong class="ne ir">True</strong>)<br/>ax.autoscale(axis='x',tight=<strong class="ne ir">True</strong>)<br/>ax.set(xlabel=xlabel, ylabel=ylabel</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/40f0c8e542e91dca2fd79a441ee4fd61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yKJ7HmQyl_xG1ZKxsNSptg.png"/></div></div></figure><p id="45c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到预测值与实际值非常接近。如果我们计算模型的MAPE和RMSE，我们分别得到3.09和4的值。我们可以将这些值与测试系列的平均值进行比较，以检查误差的大小是否可以接受。在这种情况下，它是。(<em class="nn">我们无法将这些指标与平均和平滑方法进行比较，因为数据维度不同</em>)</p><p id="85d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就把我们带到了时间序列预测的第2部分的结尾。这是一篇相当长的文章，这里有太多的东西需要吸收。时间序列预测是一门科学，这只是冰山一角。这里有更多值得探索的地方。</p><p id="faa0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是这篇文章的要点。</p><ol class=""><li id="0786" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">ARIMA模型基本上是回归模型，其中独立变量是序列的滞后值和/或滞后预测误差。</li><li id="51c0" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">使用ARIMA模型进行预测的必要条件之一是序列应该是平稳的。</li><li id="0d7d" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">平稳序列具有恒定的均值、恒定的方差，并且对于等滞后的观测值，协方差大致相同。</li><li id="422e" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">时间序列的平稳性用扩展的迪基-富勒检验和KPSS检验来检验。如果序列不是稳定的，就使用差分法。可能只有一个差异(即使用D或D)或两者都有。如果我们同时使用季节性差异和非季节性差异，建议在数据系列具有高度季节性的情况下首先使用季节性差异。</li><li id="c644" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">参数AR(p)、MA(q)、s AR(p)、SMA(Q)使用ACF和PACF图来识别。有一些准则可以帮助粗略估计这些参数的顺序。但是，最终的模型是使用auto.arima()函数构建的。</li><li id="5d6d" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">最终模型应该满足某些假设，如误差的正态性和残差之间的零自相关，即残差应该是白噪声。最终模型中所有参数的p值应该是显著的。</li></ol><p id="05f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有许多链接对理解这个主题非常有帮助。下面是其中的几个。</p><ol class=""><li id="dc5a" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">https://otexts.com/fpp2/index.html<a class="ae kv" href="https://otexts.com/fpp2/index.html" rel="noopener ugc nofollow" target="_blank"/>——这是著名的在线书籍《预测——原理与实践》的链接，作者是罗布·J·海曼和乔治·阿萨纳索普洛斯</li><li id="6949" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">https://people.duke.edu/~rnau/411home.htm<a class="ae kv" href="https://people.duke.edu/~rnau/411home.htm" rel="noopener ugc nofollow" target="_blank">——理解预测的另一个非常有用的来源。我多次提到这几页。</a></li><li id="db53" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><a class="ae kv" href="https://online.stat.psu.edu/stat510/lesson/4/4.1" rel="noopener ugc nofollow" target="_blank">https://online.stat.psu.edu/stat510/lesson/4/4.1</a></li></ol><p id="b994" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">希望这篇文章对你有用。一如既往，如果有任何问题或更正或建议，请告诉我。</p></div></div>    
</body>
</html>