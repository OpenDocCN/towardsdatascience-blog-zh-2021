<html>
<head>
<title>Build a Jina neural search with Streamlit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Streamlit构建纪娜神经搜索</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-a-jina-neural-search-with-streamlit-a2b5c323cd45?source=collection_archive---------24-----------------------#2021-04-15">https://towardsdatascience.com/build-a-jina-neural-search-with-streamlit-a2b5c323cd45?source=collection_archive---------24-----------------------#2021-04-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="745b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">借助深度学习的力量，使用纪娜搜索文本或图像</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1bd0844ca9d1e57e5f6f8089cf080c3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WvjM_alXoLuikejb.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">通过<a class="ae kv" href="https://blog.streamlit.io/streamlit-jina-neural-search/" rel="noopener ugc nofollow" target="_blank">流线</a></p></figure><p id="2a58" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你有没有想过，“该死的云。为什么不能有更简单的方法在上面建立一个神经搜索？”</p><p id="8956" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你有，这篇文章是给你的。我将介绍如何使用<a class="ae kv" href="https://github.com/jina-ai/jina/" rel="noopener ugc nofollow" target="_blank">纪娜的</a>新Streamlit组件来搜索文本或图像，以构建一个神经搜索前端。</p><p id="37bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">想直接跳进去吗？查看我们的<a class="ae kv" href="http://examples.jina.ai:8501/" rel="noopener ugc nofollow" target="_blank">文本搜索应用</a>或<a class="ae kv" href="http://examples.jina.ai:8502/" rel="noopener ugc nofollow" target="_blank">图片搜索应用</a>，这里是<a class="ae kv" href="https://github.com/jina-ai/streamlit-jina" rel="noopener ugc nofollow" target="_blank">组件的回购</a>。</p><h1 id="ab34" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">为什么要用纪娜来建立一个神经搜索？</h1><p id="8e5d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">纪娜是一个开源的深度学习搜索框架，用于在云上构建跨/多模态搜索系统(例如，文本、图像、视频、音频)。本质上，它让你用任何类型的数据为任何类型的数据构建一个搜索引擎。</p><p id="5de0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以你可以建立自己的文本到文本的搜索引擎，比如谷歌，文本到图像的搜索引擎，视频到视频的搜索引擎等等。脸书、谷歌和Spotify等公司通过最先进的人工智能模型(如FAISS、DistilBERT和Annoy)来构建这些搜索。</p><h1 id="2f25" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">为什么将Streamlit与纪娜一起使用？</h1><p id="2200" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在我加入纪娜之前，我就已经是Streamlit的忠实粉丝了。我在一个项目中使用它来创建可怕的《星际迷航》脚本，后来变成了《变形金刚文本生成的<a class="ae kv" href="https://github.com/alexcg1/easy_text_generator" rel="noopener ugc nofollow" target="_blank">前端。所以我非常高兴能使用这个很酷的框架为我们的用户构建一些东西。</a></p><p id="d1e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">构建Streamlit组件有助于数据科学家、机器学习爱好者和Streamlit社区中的所有其他开发人员构建由神经搜索驱动的酷东西。它提供了灵活性，并且由于是用Python编写的，数据科学家可以更容易地跟上速度。</p><p id="0405" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开箱即用，streamlit-jina组件有文本到文本和图像到图像的搜索，但纪娜提供了丰富的搜索体验<em class="mp">为</em>任何类型的数据<em class="mp">与</em>任何类型的数据，所以有更多的添加到组件！</p><h1 id="cbc4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">它是如何工作的？</h1><p id="cc69" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">每个纪娜项目包括两个<a class="ae kv" href="https://docs.jina.ai/chapters/101/index.html#flow" rel="noopener ugc nofollow" target="_blank">流程</a>:</p><p id="51f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">索引:</strong>用于使用神经网络模型从数据集中分解和提取丰富的含义</p><p id="ac99" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">查询:</strong>接受用户输入并查找匹配结果</p><p id="4938" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的Streamlit组件是终端用户的前端，所以它不用担心索引部分。</p><ol class=""><li id="bc5e" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">管理员旋转出一个纪娜码头工人的图像:<code class="fe mz na nb nc b">docker run -p 45678:45678 jinahub/app.example.wikipedia-sentences-30k:0.2.9-1.0.1</code></li><li id="27c6" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr mv mw mx my bi translated">用户在Streamlit组件中输入一个查询(当前为文本输入或图片上传)并点击“搜索”</li><li id="10fa" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr mv mw mx my bi translated">输入查询被封装在JSON中，并发送给纪娜的查询API</li><li id="6cd4" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr mv mw mx my bi translated">查询流完成它的工作，并以JSON格式返回结果(以及大量元数据)</li><li id="0f22" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr mv mw mx my bi translated">该组件解析出有用的信息(例如文本或图像匹配)并将它们显示给用户</li></ol><h1 id="113c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">示例代码</h1><p id="1408" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们来看看我们的<a class="ae kv" href="https://github.com/jina-ai/streamlit-jina/blob/main/examples/jina_text.py" rel="noopener ugc nofollow" target="_blank">文本搜索示例</a>，因为这样更容易看到那里发生了什么:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="ec8f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可以看到，上面的代码:</p><ul class=""><li id="b7d8" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr nk mw mx my bi translated">进口<code class="fe mz na nb nc b">streamlit</code>和<code class="fe mz na nb nc b">streamlit_jina</code></li><li id="5957" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nk mw mx my bi translated">设置搜索的REST端点</li><li id="7846" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nk mw mx my bi translated">设置页面标题</li><li id="862d" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nk mw mx my bi translated">显示一些说明性文本</li><li id="b8ef" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nk mw mx my bi translated">显示定义了<code class="fe mz na nb nc b">endpoint</code>的纪娜文本搜索小部件</li></ul><p id="5bbb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于纪娜的Streamlit小部件，你也可以传入<a class="ae kv" href="https://github.com/jina-ai/streamlit-jina#parameters" rel="noopener ugc nofollow" target="_blank">其他参数</a>来定义你想要返回的结果数量或者你是否想要隐藏某些小部件。</p><h1 id="28cb" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">在幕后</h1><p id="d7fd" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们模块的源代码只有一个文件。现在让我们来看看文本搜索示例的高级功能:</p><h2 id="fd5e" class="nl lt iq bd lu nm nn dn ly no np dp mc lf nq nr me lj ns nt mg ln nu nv mi nw bi translated">设置配置变量</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><h2 id="39be" class="nl lt iq bd lu nm nn dn ly no np dp mc lf nq nr me lj ns nt mg ln nu nv mi nw bi translated">渲染组件</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="a70b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">简而言之，<code class="fe mz na nb nc b">jina.text_search()</code>法:</p><ul class=""><li id="0306" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr nk mw mx my bi translated">创建一个Streamlit容器来保存所有内容，如果没有指定，则使用默认设置</li><li id="6d57" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nk mw mx my bi translated">如果小部件没有设置为隐藏，则向用户显示它们</li><li id="969b" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nk mw mx my bi translated">[用户类型查询]</li><li id="14e4" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nk mw mx my bi translated">[用户点击按钮]</li><li id="e980" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nk mw mx my bi translated">向纪娜API发送查询并返回结果</li><li id="9a47" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nk mw mx my bi translated">显示组件中的结果</li></ul><p id="ba8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们方法的参数是:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/997b6db9ab76adf78ece1281aab48428.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ejdU31OYTwh-GX9S.png"/></div></div></figure><p id="382c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mz na nb nc b">jina.text_search()</code>调用其他几种方法，这些方法都可以在<code class="fe mz na nb nc b">__init__.py</code>中找到。对于图像搜索，还有一些附加功能:</p><ul class=""><li id="773c" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr nk mw mx my bi translated">将查询图像编码为base64，并在传递给纪娜API之前将其包装在JSON中</li><li id="7d28" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nk mw mx my bi translated">纪娜的API返回base64格式的匹配。<code class="fe mz na nb nc b">image.render.html()</code>方法将它们包装在<code class="fe mz na nb nc b">&lt;IMG&gt;</code>标签中，这样它们就能很好地显示</li></ul><h1 id="0d4e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">在您的项目中使用它</h1><p id="bdb4" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><strong class="ky ir">在你的终端:</strong></p><p id="49df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建一个包含虚拟环境的新文件夹并激活它。这将防止系统库和单个项目库之间的冲突:</p><pre class="kg kh ki kj gt ny nc nz oa aw ob bi"><span id="fcb9" class="nl lt iq nc b gy oc od l oe of">mkdir my_project<br/>virtualenv env<br/>source env/bin/activate</span></pre><p id="662e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安装<a class="ae kv" href="https://pypi.org/project/streamlit/" rel="noopener ugc nofollow" target="_blank">细流</a>和<a class="ae kv" href="https://pypi.org/project/streamlit-jina/" rel="noopener ugc nofollow" target="_blank">细流-纪娜</a>包:</p><pre class="kg kh ki kj gt ny nc nz oa aw ob bi"><span id="376c" class="nl lt iq nc b gy oc od l oe of">pip install streamlit streamlit-jina</span></pre><p id="3684" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://docs.jina.ai/chapters/my_first_jina_app" rel="noopener ugc nofollow" target="_blank">索引您在纪娜的数据并启动查询流程</a>。或者，使用预先索引的Docker图像:</p><pre class="kg kh ki kj gt ny nc nz oa aw ob bi"><span id="3c93" class="nl lt iq nc b gy oc od l oe of">docker run -p 45678:45678 jinahub/app.example.wikipedia-sentences-30k:0.2.9-1.0.1</span></pre><p id="a5ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建您的<code class="fe mz na nb nc b">app.py</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="79ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行Streamlit:</p><pre class="kg kh ki kj gt ny nc nz oa aw ob bi"><span id="3c9e" class="nl lt iq nc b gy oc od l oe of">streamlit run app.py</span></pre><p id="eb85" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是你自己的文本搜索！</p><p id="7532" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于图像搜索，只需将上面的文本代码替换为我们的<a class="ae kv" href="https://github.com/jina-ai/streamlit-jina/blob/main/examples/jina_image.py" rel="noopener ugc nofollow" target="_blank">图像示例代码</a>，并运行一个纪娜图像(就像我们的<a class="ae kv" href="https://github.com/jina-ai/examples/tree/master/pokedex-with-bit" rel="noopener ugc nofollow" target="_blank">口袋妖怪示例</a>)。</p><h1 id="586d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">下一步做什么</h1><p id="d62e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">感谢您阅读本文，并期待听到您对该组件的看法！如果你想了解更多关于纪娜和Streamlit的信息，这里有一些有用的资源:</p><h2 id="7006" class="nl lt iq bd lu nm nn dn ly no np dp mc lf nq nr me lj ns nt mg ln nu nv mi nw bi translated">纪娜</h2><ul class=""><li id="3838" class="mq mr iq ky b kz mk lc ml lf og lj oh ln oi lr nk mw mx my bi translated"><a class="ae kv" href="https://github.com/jina-ai/streamlit-jina" rel="noopener ugc nofollow" target="_blank">流线型纪娜组件</a></li><li id="fb2b" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nk mw mx my bi translated"><a class="ae kv" href="https://docs.jina.ai/chapters/101/index.html" rel="noopener ugc nofollow" target="_blank">纪娜101 </a>:纪娜的基本部件</li><li id="08ec" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nk mw mx my bi translated">纪娜102 :纪娜组件如何协同工作</li><li id="6c25" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nk mw mx my bi translated">我的第一个纪娜应用程序:为维基百科句子建立一个简单的文本搜索应用程序</li><li id="2ef7" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nk mw mx my bi translated">我们的示例repo:文本、图像、音频、视频和多模态搜索后端的示例，更不用说查询语言、增量索引、QA搜索等等</li></ul><h2 id="db6f" class="nl lt iq bd lu nm nn dn ly no np dp mc lf nq nr me lj ns nt mg ln nu nv mi nw bi translated">细流</h2><ul class=""><li id="23fd" class="mq mr iq ky b kz mk lc ml lf og lj oh ln oi lr nk mw mx my bi translated"><a class="ae kv" href="https://docs.streamlit.io/en/stable/" rel="noopener ugc nofollow" target="_blank">精简文档</a></li><li id="7239" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nk mw mx my bi translated"><a class="ae kv" href="https://streamlit.io/gallery?type=components&amp;category=featured" rel="noopener ugc nofollow" target="_blank">组件图库</a></li><li id="d155" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nk mw mx my bi translated"><a class="ae kv" href="https://streamlit.io/gallery?type=apps&amp;category=featured" rel="noopener ugc nofollow" target="_blank">应用程序库</a></li><li id="e27f" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr nk mw mx my bi translated"><a class="ae kv" href="https://discuss.streamlit.io/" rel="noopener ugc nofollow" target="_blank">社区论坛</a></li></ul><h1 id="7b8b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">非常感谢你！</h1><p id="40cc" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">主要感谢Randy Zwitch，TC Ricks和Amanda Kelly，感谢他们的帮助，让组件上线。感谢我在纪娜的所有同事，是他们构建了后端让这一切成为可能！</p></div><div class="ab cl oj ok hu ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="ij ik il im in"><p id="3903" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mp">原载于2021年4月15日</em><a class="ae kv" href="https://blog.streamlit.io/streamlit-jina-neural-search/" rel="noopener ugc nofollow" target="_blank"><em class="mp">https://blog . streamlit . io</em></a><em class="mp">。</em></p></div></div>    
</body>
</html>