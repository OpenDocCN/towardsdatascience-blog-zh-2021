<html>
<head>
<title>How to Kaggle the Engineer way. Act 2: Google Colab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何走工程师之路？第二幕:谷歌实验室</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-kaggle-the-engineer-way-act-2-google-colab-2afa29ab35b8?source=collection_archive---------23-----------------------#2021-04-16">https://towardsdatascience.com/how-to-kaggle-the-engineer-way-act-2-google-colab-2afa29ab35b8?source=collection_archive---------23-----------------------#2021-04-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="24a7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">或者，如何设计出你的Kaggle开发环境:两幕剧。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/201eb9b33a7d5a48f8d1c0aa919b40b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*b1orx-5n34Vi-YD_"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae kv" href="https://unsplash.com/@krakenimages?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> krakenimages </a>拍摄的照片</p></figure><p id="02b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是该剧的第二幕，你可以在这里阅读第一幕<a class="ae kv" href="https://link.medium.com/kOoq47KYrfb" rel="noopener"/>。</p><p id="38d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我的整个Kaggle工作，包括本文中讨论的内容，都发表在这里<a class="ae kv" href="https://github.com/Witalia008/kaggle-public" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="5971" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">序言/介绍</h2><p id="3431" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在故事的第一部分，我描述了如何为Kaggle设置带有容器的VS代码。对我来说，使用系统的方法是最重要的，不管是工程工作还是数据科学。因为这个信念，我在Kaggle比赛中的提升在很大程度上是为了将来节省时间。</p><p id="3c14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将描述在我参加的第二次比赛中，我是如何改进我最初使用VS代码进行开发的方法的。如题所示，我转到了Google Colab，但尽管如此，我仍然希望有适当的设置。</p><h2 id="d379" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">以前方法的缺点</h2><p id="3e1e" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在第一场比赛中，在用Kaggle容器设置了VS代码之后，我在Kaggle上进行本地开发和培训。我尽最大努力减少在不同环境间切换的重复性工作。然而，还有一些其他问题:</p><ul class=""><li id="254f" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">我仍然不得不在两种环境之间切换。</li><li id="6fd6" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">Kaggle不允许使用数据集的特定版本(例如，当训练5倍时，我必须下载每一个并上传所有数据作为集合的数据集)。</li><li id="5735" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">包含依赖项是一件痛苦的事情——我不得不再次上传它们，作为一个数据集，然后映射它们的位置。</li></ul><p id="f570" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将描述我如何使用Google Colab来克服所有这些麻烦，并获得一些额外的好处，如更好的GPU和更好的运行时。</p><h2 id="e4db" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">第2幕——谷歌与GitHub的Kaggle合作实验室</h2><p id="1abd" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">Google Colab是一个为您的数据科学工作获取免费GPU的好方法。只需支付少量额外费用，你就可以获得配备V100/P100 GPU的Colab pro，这比你在Kaggle上获得的T4 GPU快几倍。它还有其他不错的功能，比如映射Google Drive文件、使用GitHub等等——如下所述。</p><p id="ddba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我选择这将是对Kaggle在训练速度和易用性上的改进，并且我不需要在本地开发。随着更多的研究，看起来我甚至不需要离开Colab环境，在里面做任何事情(有点像不离开我的公寓)。</p><h2 id="2c1d" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">在Google Drive中为Colab设置GitHub</h2><p id="8e29" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我做的第一件事是确保我仍然可以使用Git，并且不必在环境之间切换。</p><p id="4241" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">糟糕的方法:你可以直接从你的私人或公共回购中打开文件，编辑它并提交回来，正如这里的<a class="ae kv" href="https://colab.research.google.com/github/googlecolab/colabtools/blob/master/notebooks/colab-github-demo.ipynb" rel="noopener ugc nofollow" target="_blank"/>所描述的。但是，有几个问题:</p><ul class=""><li id="661f" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">提交仅针对一个笔记本，即Colab仅在一个笔记本的上下文中工作。</li><li id="fc83" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">由于上述原因，您不能拥有依赖关系。</li></ul><p id="8851" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">好消息是，Colab允许你<a class="ae kv" href="https://www.marktechpost.com/2019/06/07/how-to-connect-google-colab-with-google-drive/" rel="noopener ugc nofollow" target="_blank">安装你的Google Drive </a>。一旦它被映射，它就是运行Colab的VM实例上的一个常规文件夹。</p><p id="62e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那么，为什么不克隆你的GitHub repo呢？</p><ul class=""><li id="aeec" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">创建GitHub个人访问令牌来代替您的密码— <a class="ae kv" href="https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token" rel="noopener ugc nofollow" target="_blank"> link </a>。</li><li id="2396" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">准备一些临时的笔记本，姑且称之为<code class="fe ne nf ng nh b">terminal.ipynb</code>，存储在你的Google Drive中，并与你的驱动器进行映射:</li></ul><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="33c8" class="ls lt iq nh b gy nm nn l no np">from google.colab import drive<br/>drive.mount("/content/drive")</span></pre><ul class=""><li id="6098" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">在Colab Pro中，您可以打开一个终端实例— <a class="ae kv" href="https://stackoverflow.com/questions/59318692/how-can-i-run-shell-terminal-in-google-colab" rel="noopener ugc nofollow" target="_blank"> link </a>。</li><li id="8715" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">在任何Colab中，您都可以从笔记本单元格中运行终端命令:</li></ul><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="37ce" class="ls lt iq nh b gy nm nn l no np">%%bash<br/>cd /content/drive/MyDrive/<br/>git clone https://&lt;username&gt;:&lt;PAT&gt;@github.com/&lt;username&gt;/&lt;repo name&gt;.git<br/>cd &lt;repo name&gt;</span></pre><p id="368c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">至此，您已经将所有代码git克隆到您的Google Drive中，并且您可以在其中打开任何笔记本。我还在笔记本<a class="ae kv" href="https://github.com/Witalia008/kaggle-public/blob/master/setup-colab-for-kaggle.ipynb" rel="noopener ugc nofollow" target="_blank">中设置了一些代码来使用Git，但是我最终只使用了终端命令。</a></p><p id="1a60" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">唯一的缺点是，你必须在每个笔记本的开头映射Google Drive，但我认为这相对来说没什么问题。</p><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="25ef" class="ls lt iq nh b gy nm nn l no np">try:<br/>    from google.colab import drive<br/>    drive.mount("/content/drive")<br/>    %cd /content/drive/MyDrive/Colab\ Notebooks/kaggle<br/>except:<br/>    print("Not in Colab")</span></pre><p id="636b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我为自己创建了一个<a class="ae kv" href="https://github.com/Witalia008/kaggle-public/blob/master/template-colab-kaggle-nb.ipynb" rel="noopener ugc nofollow" target="_blank">模板笔记本</a>，我复制它作为任何其他笔记本的基准。</p><p id="335a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:一个额外的很酷的技巧，不需要每次都给你的驱动器Colab授权，你可以像这里描述的<a class="ae kv" href="https://stackoverflow.com/questions/52808143/colab-automatic-authentication-of-connection-to-google-drive-persistent-per-n" rel="noopener ugc nofollow" target="_blank">一样为每个笔记本设置自动挂载。</a></p><h2 id="d747" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">为Kaggle设置</h2><p id="e50e" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">下一步是设置Kaggle ( <code class="fe ne nf ng nh b">/kaggle/input</code>、<code class="fe ne nf ng nh b">/kaggle/working</code>)和Kaggle API secrets等所需的所有目录。这个设置必须在每个笔记本的开头完成，所以它必须作为脚本导入和函数调用。</p><p id="1164" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您不能在Colab中真正编辑Python脚本，但是您可以让您的笔记本写入文件:</p><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="f9d2" class="ls lt iq nh b gy nm nn l no np">%%writefile setup_colab.py<br/>def setup_colab_for_kaggle():<br/>    ...</span></pre><p id="0a86" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在该脚本中，让我们执行必要的设置:</p><ul class=""><li id="e5b8" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">映射和/或创建目录:</li></ul><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="147e" class="ls lt iq nh b gy nm nn l no np">kaggle_dir = Path("/kaggle")<br/>drive_content_dir = Path("/content/drive/MyDrive/kaggle")<br/>(kaggle_dir / "working").mkdir()<br/>target_content_dirs = ["input", "output"] + ([] if local_working else ["working"])<br/>for content_dir in target_content_dirs:<br/>    (kaggle_dir / content_dir).symlink_to(drive_content_dir / content_dir)</span></pre><ul class=""><li id="c0d2" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">设置Kaggle API令牌。将你的<code class="fe ne nf ng nh b">kaggle.json</code>文件上传到你的硬盘上(我把它放在了repo文件夹中，虽然你也这样做，<strong class="ky ir">确保把它添加到</strong> <code class="fe ne nf ng nh b"><strong class="ky ir">.gitignore</strong></code>)。</li></ul><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="766b" class="ls lt iq nh b gy nm nn l no np">drive_sources_dir = Path("/content/drive/MyDrive/Colab Notebooks/kaggle")<br/>kaggle_config = Path.home() / ".kaggle"<br/>(kaggle_config / "kaggle.json").symlink_to(drive_sources_dir / "kaggle.json")</span></pre><ul class=""><li id="4d04" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">您可以使用相同的方法来设置Weights &amp; Biases API键或任何其他键。</li><li id="adbb" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">在该文件中有任何其他设置代码。</li></ul><p id="3f18" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有相当多的附加逻辑，所以完整的代码在<a class="ae kv" href="https://github.com/Witalia008/kaggle-public/blob/master/setup-colab-for-kaggle.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>和<a class="ae kv" href="https://github.com/Witalia008/kaggle-public/blob/master/setup_colab.py" rel="noopener ugc nofollow" target="_blank">输出脚本</a>中。</p><p id="6778" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，每台笔记本只需导入代码并运行设置功能:</p><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="948b" class="ls lt iq nh b gy nm nn l no np">from setup_colab import setup_colab_for_kaggle<br/>setup_colab_for_kaggle(check_env=False, local_working=True)</span></pre><p id="4b95" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用我的脚本，输出将告诉我们最终的设置:</p><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="fe50" class="ls lt iq nh b gy nm nn l no np">Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount("/content/drive", force_remount=True).<br/>/content/drive/MyDrive/Colab Notebooks/kaggle<br/>Content of Drive Kaggle data dir (/content/drive/MyDrive/kaggle): ['/content/drive/MyDrive/kaggle/input', '/content/drive/MyDrive/kaggle/working', '/content/drive/MyDrive/kaggle/output']<br/>Content of Kaggle data dir (/kaggle): ['/kaggle/working', '/kaggle/output', '/kaggle/input']<br/>Content of Kaggle data subdir (/kaggle/input): ['/kaggle/input/vinbigdata']<br/>Content of Kaggle data subdir (/kaggle/output): ['/kaggle/output/vbdyolo-out']<br/>Content of Kaggle data subdir (/kaggle/working): []<br/>Content of Kaggle config dir (/root/.kaggle): ['/root/.kaggle/kaggle.json']<br/>Loaded environment variables from .env file: ['WANDB_API_KEY'].</span></pre><p id="3594" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">酷，在这一点上，所有的设置都是模仿Kaggle内核的设置，以及前一篇文章中描述的本地环境，所以笔记本在两个环境之间切换时不会知道区别(如果你想知道的话)。但是，让我们将它设置得更好，这样我们就根本不用切换了。</p><h2 id="8549" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">从Kaggle获取数据</h2><p id="bd4f" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">首先，我会将数据下载到本地，然后上传到我的驱动器，最后它会被映射到正确的位置，如上所示。然而，这并不太实际，最重要的是——<em class="nq">Colab从Google Drive </em>中访问文件非常慢。事实证明，每次将数据集下载到Colab虚拟机的本地存储中要快得多。在你的笔记本上有:</p><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="a7d6" class="ls lt iq nh b gy nm nn l no np">!kaggle competitions download vinbigdata-chest-xray-abnormalities-detection -f train.csv -p {INPUT_FOLDER_DATA} --unzip<br/>!kaggle datasets download xhlulu/vinbigdata-chest-xray-resized-png-1024x1024 -p {INPUT_FOLDER_PNG} --unzip</span></pre><p id="88eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过Google Drive训练有效网络B3的一个时期需要大约1小时，而下载8GB需要大约8分钟，训练一个时期需要大约15分钟。速度提高了4倍，不错！</p><h2 id="1b27" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">版本化数据集和模型</h2><p id="01ec" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">这一节将阐明为什么我们需要设置Kaggle API令牌。</p><p id="09dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于我对Kaggle竞赛的方法是系统的和有条理的，我开始思考如何组织我使用的数据和产生的模型。有点像模型和数据的Git。事实上，我发现有<a class="ae kv" href="https://dvc.org/" rel="noopener ugc nofollow" target="_blank">数据版本控制</a>和其他一些工具。然而，对于Kaggle比赛，更简单的方法就可以了。一种选择是只存储在文件夹中，但这不是很整洁，数据可能会丢失，而且很难给每个版本附加注释。所以我选择把所有东西都作为Kaggle数据集偷走。</p><p id="7bb7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这可以像在每个笔记本末尾上传文件一样简单:</p><ul class=""><li id="652b" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">将您想要上传的文件放在一个文件夹中(比如说，<code class="fe ne nf ng nh b">yolo_pred/</code>文件夹包含YOLO预测和<code class="fe ne nf ng nh b">yolo.pt</code>文件)。</li><li id="1ebf" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">创建<code class="fe ne nf ng nh b">dataset-metadata.json</code>文件——由Kaggle API解析和理解的东西:</li></ul><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="240b" class="ls lt iq nh b gy nm nn l no np">with open(Path(folder_path) / "dataset-metadata.json", "w") as f:<br/>    json.dump({<br/>        "title": dataset_name,<br/>        "id": f"{user_name}/{dataset_name}",<br/>        "licenses": [{ "name": "CC0-1.0" }]<br/>    }, f, indent=4)</span></pre><ul class=""><li id="723a" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">使用Kaggle API命令在笔记本执行(如模型训练)结束时上传文件:如果是第一次:</li></ul><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="6f25" class="ls lt iq nh b gy nm nn l no np">!kaggle datasets create -p {OUTPUT_FOLDER_CUR} -r zip</span></pre><p id="bbf7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">否则:</p><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="34db" class="ls lt iq nh b gy nm nn l no np">!kaggle datasets version -m "{version_message}" -p {OUTPUT_FOLDER_CUR} -r zip</span></pre><ul class=""><li id="fa76" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">现在，在您的后处理中，您可以下载特定版本(特定的训练模式及其输出)用于提交:</li></ul><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="0f78" class="ls lt iq nh b gy nm nn l no np">!kaggle datasets download "username/dataset-name" -v {yolo_version} -p {version_data["path"]} --unzip --force</span></pre><p id="cebb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">剧透:虽然，这在官方Kaggle API中不起作用——见下一段。</p><h2 id="703d" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">修复Kaggle API以满足我们的需求</h2><p id="08ba" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">作为一个偏离主题的话题，我需要在Kaggle API中添加/修复一些特性。推动这一点是因为在某一点上，我不能重现良好的结果，我获得了一些早期版本。那时，我已经对所有的东西进行了版本控制，并且记录了所有的设置，所以这几乎是不可能的……但是它正在发生。然后我注意到我选择的任何版本都得到了相同的结果。结果是，嗯，Kaggle API默默地忽略了我的版本请求，总是下载最新的版本。</p><p id="35d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，他们的GitHub repo提到他们欢迎改变，因此我决定自己解决问题(我非常需要竞争的功能)。</p><ul class=""><li id="242d" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">首先，我需要确保Kaggle会下载一个特定的版本。我的PR <a class="ae kv" href="https://github.com/Kaggle/kaggle-api/pull/335" rel="noopener ugc nofollow" target="_blank">在这里</a>。</li><li id="a49f" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">第二，我已经准备好了，所以我做了一些修正，使得比赛中的一个文件可以正确下载(整个数据集大约200GB，我只下载了带有火车标签的<code class="fe ne nf ng nh b">.csv</code>文件，并从另一个数据集获得了大约8GB的相同图像)。我的PR <a class="ae kv" href="https://github.com/Kaggle/kaggle-api/pull/336" rel="noopener ugc nofollow" target="_blank">这里</a>。</li></ul><p id="e471" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不过，很明显，将变更加入Kaggle API的过程很慢(他们有一个私有的回购协议，一些开发人员必须去合并变更……)。所以，这两个改动都暂时在我这里的<a class="ae kv" href="https://github.com/Witalia008/kaggle-api/tree/witalia-main" rel="noopener ugc nofollow" target="_blank">分叉</a>。</p><p id="9d61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以从您的Colab笔记本上安装带有我的补丁的Kaggle API，如下所示:</p><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="80cf" class="ls lt iq nh b gy nm nn l no np">!pip install -U git+https://github.com/Witalia008/kaggle-api.git@witalia-main</span></pre><h2 id="f5d1" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">臣服于Kaggle</h2><p id="ab4b" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">对于我参加的特定比赛，提交的只是一个<code class="fe ne nf ng nh b">.csv</code>文件，所以我只需在我的后处理笔记本的末尾运行以下命令:</p><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="792a" class="ls lt iq nh b gy nm nn l no np">!kaggle competitions submit \<br/>    vinbigdata-chest-xray-abnormalities-detection \<br/>    -f {WORK_FOLDER}/submission.csv \<br/>    -m "{submission_message}"</span></pre><p id="26ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后检查提交的结果:</p><pre class="kg kh ki kj gt ni nh nj nk aw nl bi"><span id="d2cc" class="ls lt iq nh b gy nm nn l no np">!kaggle competitions submissions vinbigdata-chest-xray-abnormalities-detection</span></pre><h2 id="542a" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">整个设置</h2><p id="71f6" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">您可以参考具有完整实现的文件:</p><ul class=""><li id="0a70" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated"><a class="ae kv" href="https://github.com/Witalia008/kaggle-public/blob/master/setup-colab-for-kaggle.ipynb" rel="noopener ugc nofollow" target="_blank">setup-colab-for-ka ggle . ipynb</a>—包含使用Git的代码以及setup-colab逻辑的笔记本。</li><li id="8753" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated"><a class="ae kv" href="https://github.com/Witalia008/kaggle-public/blob/master/setup_colab.py" rel="noopener ugc nofollow" target="_blank"> setup_colab.py </a> —设置脚本(由上述笔记本产生)，包含映射目录、配置密钥等功能。</li><li id="30d9" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated"><a class="ae kv" href="https://github.com/Witalia008/kaggle-public/blob/master/template-colab-kaggle-nb.ipynb" rel="noopener ugc nofollow" target="_blank">template-colab-ka ggle-nb . ipynb</a>—需要设置的模板笔记本，我将它用作其他笔记本的基础。</li><li id="a1d7" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated"><a class="ae kv" href="https://github.com/Witalia008/kaggle-public/blob/master/vinbigdata-chest-xray-abnormalities-detection/vbd-yolov5.ipynb" rel="noopener ugc nofollow" target="_blank"> vbd-yolov5.ipynb </a> —下载数据集、训练模型并将输出存储为数据集的示例笔记本。</li><li id="f24c" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated"><a class="ae kv" href="https://github.com/Witalia008/kaggle-public/blob/master/vinbigdata-chest-xray-abnormalities-detection/vbd-postprocess-yolo.ipynb" rel="noopener ugc nofollow" target="_blank">vbd-postprocess-yolo . ipynb</a>—示例笔记本，它下载以前笔记本输出的多个版本作为数据集，集成它们，并提交给Kaggle。</li></ul><h2 id="d7b3" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">进一步的改进</h2><p id="f6f0" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">这种方法的问题实际上是失去了IDE的全部功能(比如，调试，或者处理笔记本之外的其他文件格式)。笔记本电脑中pdb的调试能力有限，人们可以通过终端用Vim或Nano编辑文件，但这不是很好。但我听说有一种方法可以将VS代码连接到Google Colab ( <a class="ae kv" href="https://amitness.com/vscode-on-colab/" rel="noopener ugc nofollow" target="_blank"> link </a>)，所以我一定会尝试一下，也许会有续集。</p><h2 id="0bdc" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">结语/总结</h2><p id="3ef2" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">本文中描述的设置是对Kaggle开发环境的进一步改进，只需几个简单的步骤，就可以下载数据、进行数据科学工作、存储模型/输出并提交给竞赛，而无需离开Colab笔记本。</p><p id="0ce6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这可以通过以下步骤实现:</p><ul class=""><li id="5bdb" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">安装Google Drive并通过终端命令操作。</li><li id="a28d" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">像在本地机器上一样克隆Git repo和跟踪文件。</li><li id="88ac" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">在每个笔记本的开头创建一个脚本来运行设置命令，以模拟Kaggle环境、设置API键等等。</li><li id="fc9c" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">使用Kaggle API将数据集和比赛数据从笔记本下载到Colab VM。</li><li id="35b6" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">使用Kaggle API将模型版本及其输出存储为数据集。</li><li id="b636" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">使用Kaggle API直接从笔记本提交竞赛。</li></ul><p id="f0ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望你会发现这个设置很有用，它可以让你花更少的时间来配置一切，而花更多的时间来解决Kaggle比赛。祝你好运:)</p></div></div>    
</body>
</html>