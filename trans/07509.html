<html>
<head>
<title>Every Pandas Function You Can (Should) Use to Manipulate Time Series</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你可以(应该)使用的每一个熊猫函数来操纵时间序列</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/every-pandas-function-you-can-should-use-to-manipulate-time-series-711cb0c5c749?source=collection_archive---------2-----------------------#2021-07-09">https://towardsdatascience.com/every-pandas-function-you-can-should-use-to-manipulate-time-series-711cb0c5c749?source=collection_archive---------2-----------------------#2021-07-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4600" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从基本的时间序列度量到窗口函数</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d9f9b22ebea84dd903bff575fc9aae6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*goDYbZULUkLiheRkrJpmJQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ky">照片由</strong> <a class="ae kz" href="https://www.pexels.com/@bentonphotocinema?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> <strong class="bd ky">乔丹本顿</strong> </a> <strong class="bd ky">上</strong> <a class="ae kz" href="https://www.pexels.com/photo/shallow-focus-of-clear-hourglass-1095601/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> <strong class="bd ky">像素</strong> </a></p></figure><h1 id="22e1" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">时间序列预测项目简介</h1><p id="e063" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">最近，在Kaggle上发起了Optiver Realized波动率预测竞赛。顾名思义，这是一个时间序列预测的挑战。</p><p id="4f48" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我想参加，但事实证明我在时间序列方面的知识甚至不足以参加如此大规模的比赛。所以，我接受了这一点，认为这是我需要开始认真关注ML这个大领域的‘刺激’。</p><p id="b83d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">作为第一步，我想学习和教授你可以用来操作时间序列数据的每一个熊猫函数。这些函数是处理您在野外遇到的任何时间序列数据的基本要求。</p><p id="8f46" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我已经为这个话题准备了相当酷和有趣的文章，今天，你将会读到即将到来的第一个味道。尽情享受吧！</p><div class="mt mu gp gr mv mw"><a href="https://ibexorigin.medium.com/membership" rel="noopener follow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd iu gy z fp nb fr fs nc fu fw is bi translated">通过我的推荐链接加入Medium-BEXGBoost</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">获得独家访问我的所有⚡premium⚡内容和所有媒体没有限制。支持我的工作，给我买一个…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">ibexorigin.medium.com</p></div></div><div class="nf l"><div class="ng l nh ni nj nf nk ks mw"/></div></div></a></div><p id="4cbb" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">获得由强大的AI-Alpha信号选择和总结的最佳和最新的ML和AI论文:</p><div class="mt mu gp gr mv mw"><a href="https://alphasignal.ai/?referrer=Bex" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd iu gy z fp nb fr fs nc fu fw is bi translated">阿尔法信号|机器学习的极品。艾总结的。</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">留在循环中，不用花无数时间浏览下一个突破；我们的算法识别…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">alphasignal.ai</p></div></div><div class="nf l"><div class="nl l nh ni nj nf nk ks mw"/></div></div></a></div></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="8e11" class="la lb it bd lc ld nt lf lg lh nu lj lk jz nv ka lm kc nw kd lo kf nx kg lq lr bi translated">目录</h1><p id="95e4" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">这篇文章的笔记本可以在Kaggle上这里<a class="ae kz" href="https://www.kaggle.com/bextuychiev/every-pandas-function-to-manipulate-time-series" rel="noopener ugc nofollow" target="_blank">阅读。</a></p><ol class=""><li id="8161" class="ny nz it lu b lv mo ly mp mb oa mf ob mj oc mn od oe of og bi translated">基本数据和时间函数</li><li id="4709" class="ny nz it lu b lv oh ly oi mb oj mf ok mj ol mn od oe of og bi translated">时间序列中缺失数据的插补/插值</li><li id="19db" class="ny nz it lu b lv oh ly oi mb oj mf ok mj ol mn od oe of og bi translated">基本时间序列计算和指标</li><li id="f9ce" class="ny nz it lu b lv oh ly oi mb oj mf ok mj ol mn od oe of og bi translated">重采样—上采样和下采样</li><li id="dabe" class="ny nz it lu b lv oh ly oi mb oj mf ok mj ol mn od oe of og bi translated">比较多个时间序列的增长</li><li id="37ee" class="ny nz it lu b lv oh ly oi mb oj mf ok mj ol mn od oe of og bi translated">窗口功能</li><li id="5c66" class="ny nz it lu b lv oh ly oi mb oj mf ok mj ol mn od oe of og bi translated">摘要</li></ol></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="7233" class="la lb it bd lc ld nt lf lg lh nu lj lk jz nv ka lm kc nw kd lo kf nx kg lq lr bi translated">1.熊猫的基本日期和时间功能</h1><h2 id="6e21" class="om lb it bd lc on oo dn lg op oq dp lk mb or os lm mf ot ou lo mj ov ow lq ox bi translated">1.1导入时间序列数据</h2><p id="c6b2" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">当使用<code class="fe oy oz pa pb b">pd.read_csv</code>函数导入时间序列时，有两个参数你应该一直使用- <code class="fe oy oz pa pb b">parse_dates</code>和<code class="fe oy oz pa pb b">index_col</code>:</p><blockquote class="pc pd pe"><p id="0d51" class="ls lt pf lu b lv mo ju lx ly mp jx ma pg mq md me ph mr mh mi pi ms ml mm mn im bi translated">由于出版政策，数据集已被匿名化。如果你感兴趣，数据集的真实版本保存在<a class="ae kz" href="https://www.kaggle.com/bextuychiev/every-pandas-function-to-manipulate-time-series" rel="noopener ugc nofollow" target="_blank">笔记本</a>中。请注意，这种匿名不会妨碍您的体验。</p></blockquote><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/e96afc0ddc4c57ea23eec18fcdf8976a.png" data-original-src="https://miro.medium.com/v2/format:webp/1*4HV3d0S_O7C9QYRzo0T7vQ.png"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/0b1c14c647d0a7ab6ed538b70b8b2c61.png" data-original-src="https://miro.medium.com/v2/format:webp/1*OuFr0EaP8e05HI2cAtySbg.png"/></div></figure><p id="0870" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated"><code class="fe oy oz pa pb b">parse_dates</code>将类似日期的字符串转换为DateTime对象，<code class="fe oy oz pa pb b">index_col</code>将传递的列设置为索引。该操作是对熊猫进行所有时间序列操作的基础。</p><p id="4087" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">当您在导入时不知道哪一列包含日期时，您可以在之后使用<code class="fe oy oz pa pb b">pd.to_datetime</code>功能进行日期转换:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="83f1" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在，检查日期时间格式字符串:</p><pre class="kj kk kl km gt pm pb pn po aw pp bi"><span id="0287" class="om lb it pb b gy pq pr l ps pt">&gt;&gt;&gt; data2.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/ba59647ad1fcbf26bc7a64e9a3b20fff.png" data-original-src="https://miro.medium.com/v2/format:webp/1*A1Nw3Rpzz1sXxB5JolkK8A.png"/></div></figure><p id="d6a9" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">它的格式是" %Y-%m-%d "(日期时间格式字符串的完整列表可以在<a class="ae kz" href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior" rel="noopener ugc nofollow" target="_blank">这里</a>找到)。把这个传给<code class="fe oy oz pa pb b">pd.to_datetime</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="21eb" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">向<code class="fe oy oz pa pb b">pd.to_datetime</code>传递一个格式字符串可以显著加快大型数据集的转换速度。将<code class="fe oy oz pa pb b">errors</code>设置为“强制”，将无效日期标记为<code class="fe oy oz pa pb b">NaT</code>(不是日期，即-缺失)。</p><p id="38a2" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">转换后，将DateTime列设置为索引(这是最佳时间序列分析的严格要求):</p><pre class="kj kk kl km gt pm pb pn po aw pp bi"><span id="f498" class="om lb it pb b gy pq pr l ps pt">&gt;&gt;&gt; data2.set_index("date", inplace=True)</span></pre></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="e5ee" class="om lb it bd lc on oo dn lg op oq dp lk mb or os lm mf ot ou lo mj ov ow lq ox bi translated">1.2熊猫时间戳</h2><p id="b1a7" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">Pandas中的基本日期数据结构是时间戳:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="8969" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">您可以使用正确的格式制作更精细的时间戳，或者更好的是，使用<code class="fe oy oz pa pb b">datetime</code>模块:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="f0ba" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">完整时间戳具有如下有用的属性:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/eab949611e1edcbe19e081207847fa8a.png" data-original-src="https://miro.medium.com/v2/format:webp/1*BD7vlUoSAiS5hzS_seSDGQ.png"/></div></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="8d47" class="om lb it bd lc on oo dn lg op oq dp lk mb or os lm mf ot ou lo mj ov ow lq ox bi translated">1.3日期序列(时间戳)</h2><p id="584a" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">pandas中的一个<code class="fe oy oz pa pb b">DateTime</code>列/索引被表示为一系列<code class="fe oy oz pa pb b">TimeStamp</code>对象。</p><p id="3ee3" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated"><code class="fe oy oz pa pb b">pd.date_range</code>返回一个特殊的<code class="fe oy oz pa pb b">DateTimeIndex</code>对象，它是<code class="fe oy oz pa pb b">TimeStamps</code>的集合，具有给定范围内的自定义频率:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="7546" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在指定日期范围(从2010年10月10日到2020年的同一天)后，我们告诉熊猫每月生成<code class="fe oy oz pa pb b">TimeStamps</code>和<code class="fe oy oz pa pb b">freq='M'</code>:</p><pre class="kj kk kl km gt pm pb pn po aw pp bi"><span id="52f1" class="om lb it pb b gy pq pr l ps pt">&gt;&gt;&gt; index[0]</span><span id="b17c" class="om lb it pb b gy pu pr l ps pt">Timestamp('2010-10-31 00:00:00', freq='M')</span></pre><p id="6754" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">创建日期范围的另一种方法是传递开始日期，告诉您需要多少个周期，并指定频率:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="f192" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">因为我们将频率设置为年，所以带有5个周期的<code class="fe oy oz pa pb b">date_range</code>返回5年/时间戳对象。可以传递给<code class="fe oy oz pa pb b">freq</code>的<a class="ae kz" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-offset-aliases" rel="noopener ugc nofollow" target="_blank">频率别名</a>列表很大，所以我在这里只提到最重要的几个:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/bd2a67c78e231eb8dfef1715ae8a3bf5.png" data-original-src="https://miro.medium.com/v2/format:webp/1*2P8g5deh995_lAjFTOvUVg.png"/></div></figure><p id="c018" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">也可以通过自定义频率，如“1小时30分”、“5D”、“2W”等。再次，检查<a class="ae kz" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-offset-aliases" rel="noopener ugc nofollow" target="_blank">这个链接</a>的完整信息。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="3920" class="om lb it bd lc on oo dn lg op oq dp lk mb or os lm mf ot ou lo mj ov ow lq ox bi translated">1.4切片</h2><p id="0b6c" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">如果索引是一个<code class="fe oy oz pa pb b">DateTimeIndex</code>，切片时间序列数据会非常直观。你可以使用部分切片:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/d3296377a179f58d16972e37f8d51ede.png" data-original-src="https://miro.medium.com/v2/format:webp/1*IMwV-OBT1jdoxPvqRyH__Q.png"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/1315b997ab8664c90eff53d9df6b19bf.png" data-original-src="https://miro.medium.com/v2/format:webp/1*lN5Hf8yerp4CukmUxDrsQg.png"/></div></figure><p id="5cb0" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">如果日期时间足够精确，甚至可以达到小时、分钟或秒的级别。</p><p id="1a8b" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">请注意，熊猫切片日期在封闭的时间间隔。例如，使用“2010”:“2013”返回所有4年的行—它不像整数切片那样排除期末。</p><p id="b00d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这个日期切片逻辑适用于其他操作，如在切片后选择特定的列:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="1c15" class="la lb it bd lc ld nt lf lg lh nu lj lk jz nv ka lm kc nw kd lo kf nx kg lq lr bi translated">2.缺失数据插补或插值</h1><p id="5758" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">无论数据集的类型如何，缺失数据都是普遍存在的。这一部分是关于在时间序列的背景下对其进行估算。</p><blockquote class="pc pd pe"><p id="45b3" class="ls lt pf lu b lv mo ju lx ly mp jx ma pg mq md me ph mr mh mi pi ms ml mm mn im bi translated">你也可能在时间序列行话中听到它被称为缺失数据的<strong class="lu iu">插值</strong>。</p></blockquote><p id="20ea" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">除了基本的均值、中值和众数插补之外，一些最常用的技术包括:</p><ol class=""><li id="1eba" class="ny nz it lu b lv mo ly mp mb oa mf ob mj oc mn od oe of og bi translated">正向填充</li><li id="0663" class="ny nz it lu b lv oh ly oi mb oj mf ok mj ol mn od oe of og bi translated">反向填充</li><li id="eede" class="ny nz it lu b lv oh ly oi mb oj mf ok mj ol mn od oe of og bi translated">使用<code class="fe oy oz pa pb b">pd.interpolate</code>进行中间插补</li></ol><p id="dfbd" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我们还将讨论基于模型的插补，如KNN插补。此外，我们将探索比较技术效率的可视化方法，并选择最适合底层分布的方法。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="7e7f" class="om lb it bd lc on oo dn lg op oq dp lk mb or os lm mf ot ou lo mj ov ow lq ox bi translated">2.1均值、中值和众数插补</h2><p id="147f" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">让我们从基础开始。我们将在第一个匿名数据集中随机选择数据点，并将其转换为NaN:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="dd35" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我们还将创建一个函数，绘制插补执行前后的原始分布:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="b225" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我们将从Sklearn的<code class="fe oy oz pa pb b">SimpleImputer</code>开始尝试技巧:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="228c" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">让我们针对我们刚刚创建的3个估算特征绘制原始<code class="fe oy oz pa pb b">feature_2</code>分布图:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/3fa691f71169a60b55d186a16d994820.png" data-original-src="https://miro.medium.com/v2/format:webp/1*VBcFm2uj4-PLlK_nRn4esw.png"/></div></figure><p id="52a5" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">很难说哪条线最像黑线，但我会选绿色。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="1b05" class="om lb it bd lc on oo dn lg op oq dp lk mb or os lm mf ot ou lo mj ov ow lq ox bi translated">2.2向前和向后填充</h2><p id="c40a" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">考虑这个小分布:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/27ca48835655a53a2c6d75fbaee6c7aa.png" data-original-src="https://miro.medium.com/v2/format:webp/1*zB4iCShOXvMArJsdybCD1A.png"/></div></figure><p id="d520" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我们将使用向前和向后填充，并将它们作为单独的列分配回数据帧:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/9d838353582781439a8707e52919451c.png" data-original-src="https://miro.medium.com/v2/format:webp/1*5vQaVmnpUnykY-_o6heGUw.png"/></div></figure><p id="75c6" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">一旦检查了上面的输出，这些方法是如何工作的就应该很明显了。</p><p id="c93e" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在，让我们对印度的空气质量数据集执行这些方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/7a917391afb20961714c4a9bb85bbd42.png" data-original-src="https://miro.medium.com/v2/format:webp/1*c5I78oG-lbjVw-ck6rhLpA.png"/></div></figure><p id="c046" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">尽管非常基本，向前和向后填充实际上对气候和股票数据非常有效，因为附近数据点之间的差异很小。</p><h2 id="cf43" class="om lb it bd lc on oo dn lg op oq dp lk mb or os lm mf ot ou lo mj ov ow lq ox bi translated">2.3使用<code class="fe oy oz pa pb b">pd.interpolate</code></h2><p id="6eee" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">Pandas在<code class="fe oy oz pa pb b">pd.interpolate</code>功能中提供了一整套其他统计插补技术。它的<code class="fe oy oz pa pb b">method</code>参数接受技术名称作为字符串。</p><p id="f95d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">最流行的是“线性”和“最近”，但是你可以从函数的文档中看到完整的列表。在这里，我们将只讨论这两个。</p><p id="1d85" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">考虑这个小分布:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/e42452e73264fd85cfed7ea529cadaf3.png" data-original-src="https://miro.medium.com/v2/format:webp/1*i8yfBWrXRe4LCP5loTSo_A.png"/></div></figure><p id="7989" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我们再次应用这些方法，并将它们的结果赋回来:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/ec5b33c875d04a55b06d2da08ca7c5d5.png" data-original-src="https://miro.medium.com/v2/format:webp/1*RQf5YqKgCzNqbO3jEqqzbA.png"/></div></figure><p id="a4ca" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">很整洁，是吧？线性方法将任意两个非缺失点之间的距离视为线性间隔，并找到连接它们的直线(如<code class="fe oy oz pa pb b">np.linspace</code>)。“Nearest”方法应该可以从它的名字和上面的输出中理解。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="d240" class="om lb it bd lc on oo dn lg op oq dp lk mb or os lm mf ot ou lo mj ov ow lq ox bi translated">2.4基于模型的KNN插补</h2><p id="d195" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">我们将看到的最后一种方法是K-最近邻算法。我不会详细说明算法是如何工作的，而只是展示如何在Sklearn中使用它。如果你想知道细节，我有一个单独的文章<a class="ae kz" rel="noopener" target="_blank" href="/going-beyond-the-simpleimputer-for-missing-data-imputation-dd8ba168d505?source=your_stories_page-------------------------------------">在这里</a>。</p><p id="614d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">KNN最重要的参数是<code class="fe oy oz pa pb b">k</code>——邻居的数量。我们将把该技术应用于具有几个值<code class="fe oy oz pa pb b">k</code>的第一个数据集，并像我们在前面章节中所做的那样找到最佳的一个:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/32725bbef48ba9d75a9ca7f5f8a44761.png" data-original-src="https://miro.medium.com/v2/format:webp/1*L4xV0ti5UAM6VjPFHIC6Ug.png"/></div></figure><h1 id="e59e" class="la lb it bd lc ld le lf lg lh li lj lk jz ll ka lm kc ln kd lo kf lp kg lq lr bi translated">3.基本时间序列计算</h1><p id="3ede" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">Pandas提供了计算最常见的时间序列计算的基本函数。这些被称为转移，滞后，以及所谓的百分比变化。</p><h2 id="a8a0" class="om lb it bd lc on oo dn lg op oq dp lk mb or os lm mf ot ou lo mj ov ow lq ox bi translated">3.1换档和滞后</h2><p id="6c4b" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">时间序列中的一个常见操作是将所有数据点向后或向前移动一个或多个周期，以比较过去和未来的值。你可以使用熊猫的<code class="fe oy oz pa pb b">shift</code>功能来完成这些操作。让我们看看如何将数据点1和2移至未来:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/0b1c14c647d0a7ab6ed538b70b8b2c61.png" data-original-src="https://miro.medium.com/v2/format:webp/1*OuFr0EaP8e05HI2cAtySbg.png"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/4fbc4d90d0fe2a31692df04230b9c1fe.png" data-original-src="https://miro.medium.com/v2/format:webp/1*S0PaH4Pl6rDtB_BmxBU4NA.png"/></div></figure><p id="ffc9" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">向前移动使您能够将当前数据点与一个或多个期间之前记录的数据点进行比较。</p><p id="def5" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">你也可以向后移动。这种操作也称为“滞后”:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/5536d8cdd6f425e2ae9dfdf88e698e49.png" data-original-src="https://miro.medium.com/v2/format:webp/1*EPBDtLvi_sSKU83mIFasDA.png"/></div></figure><p id="d927" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">向后移动使我们能够看到当前数据点和一个或多个周期后的数据点之间的差异。</p><p id="6069" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">换档或滞后后的常见操作是找出差异并绘制出来:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/126ed7255f989a46933e6d54fcd07539.png" data-original-src="https://miro.medium.com/v2/format:webp/1*JT2H1vNymZtzjPajt8ZSGg.png"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/f5cdbf1174b4d8030783cda21a23548a.png" data-original-src="https://miro.medium.com/v2/format:webp/1*1CTgMEFSf6KJFeLcW9eBUQ.png"/></div></figure><p id="9b4c" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">由于这种操作非常常见，Pandas提供了<code class="fe oy oz pa pb b">diff</code>函数来计算基于周期的差异:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/63b9d1570d1abaabb18a59bae8d49b8f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*eY-Vu7wkNG33LWCCn-VpsQ.png"/></div></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="40d4" class="om lb it bd lc on oo dn lg op oq dp lk mb or os lm mf ot ou lo mj ov ow lq ox bi translated">3.2百分比变化</h2><p id="3afa" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">可以从时间序列数据中得出的另一个常见指标是每日百分比变化:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/ed9c6c915d2db78dbec93907a7176476.png" data-original-src="https://miro.medium.com/v2/format:webp/1*csGupAR-bTEf3hUevJOOgw.png"/></div></figure><p id="f16f" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">要计算每天的百分比变化，向前移动一个周期，将原始分布除以移动后的分布，然后减去1。结果值以前一天的比例给出。</p><p id="eb29" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">因为这是一个常见的操作，Pandas用<code class="fe oy oz pa pb b">pct_change</code>函数来实现它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/c66234d77b88ead009116fe2ce7d1aab.png" data-original-src="https://miro.medium.com/v2/format:webp/1*RADZpnf6DBAONyxDZeASxw.png"/></div></figure><h2 id="04b3" class="om lb it bd lc on oo dn lg op oq dp lk mb or os lm mf ot ou lo mj ov ow lq ox bi translated">4.重采样</h2><p id="7a19" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">通常，您可能希望增加或减少时间序列的粒度，以生成新的见解。这些操作被称为重采样或改变时间序列的频率，我们将在本节中讨论与它们相关的Pandas函数。</p><h2 id="af2b" class="om lb it bd lc on oo dn lg op oq dp lk mb or os lm mf ot ou lo mj ov ow lq ox bi translated">4.1用<code class="fe oy oz pa pb b">asfreq</code>改变频率</h2><p id="dc5b" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">第二个数据集没有固定的日期频率，即每个日期之间的周期差异不相同:</p><pre class="kj kk kl km gt pm pb pn po aw pp bi"><span id="8b4f" class="om lb it pb b gy pq pr l ps pt">data2.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/0b1c14c647d0a7ab6ed538b70b8b2c61.png" data-original-src="https://miro.medium.com/v2/format:webp/1*OuFr0EaP8e05HI2cAtySbg.png"/></div></figure><p id="2647" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">让我们通过给它一个日历日频率(每日)来解决这个问题:</p><pre class="kj kk kl km gt pm pb pn po aw pp bi"><span id="0231" class="om lb it pb b gy pq pr l ps pt">data2.asfreq("D").head(7)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/e52a56e019df5d84dd7bdc3b2867120a.png" data-original-src="https://miro.medium.com/v2/format:webp/1*pqNgcuo4W-R2IFd4KFqTYQ.png"/></div></figure><p id="96f9" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我们只是把约会的频率变得更细了。结果，添加了新的日期，导致更多的值丢失。现在，您可以使用我们之前讨论过的任何技术对它们进行插值。</p><p id="e0bb" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">你可以在这里看到<a class="ae kz" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases" rel="noopener ugc nofollow" target="_blank">的内置频率别名列表。更有趣的场景是使用自定义频率:</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/8691957f966e23c0f79cd8a1dc16aa38.png" data-original-src="https://miro.medium.com/v2/format:webp/1*7h_2fAWmXgzZGuWsS8MIwQ.png"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/3d77eb93b4881e25579a2ab726807333.png" data-original-src="https://miro.medium.com/v2/format:webp/1*MTcCMxug9iTgccDCwGH58g.png"/></div></figure><pre class="kj kk kl km gt pm pb pn po aw pp bi"><span id="8714" class="om lb it pb b gy pq pr l ps pt"># 10 month frequency<br/>data2.asfreq("10M", method="bfill").head(7)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/f902a77bdfa37d439d43fd8b8a998214.png" data-original-src="https://miro.medium.com/v2/format:webp/1*7N5AcFhSQ4i4lJJWLb4yHQ.png"/></div></figure><p id="f46d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">还有一个<code class="fe oy oz pa pb b">reindex</code>函数，操作类似，支持额外的缺失值填充逻辑。我们不会在这里讨论它，因为我们会考虑更好的选择。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="e5a9" class="om lb it bd lc on oo dn lg op oq dp lk mb or os lm mf ot ou lo mj ov ow lq ox bi translated">4.2使用<code class="fe oy oz pa pb b">resample</code>进行下采样并聚合</h2><p id="3d16" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">在时间序列行话中，降低<code class="fe oy oz pa pb b">DateTime</code>的频率被称为下采样。例如，将频率从每小时更改为每天，从每天更改为每周，等等。</p><p id="08d5" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">我们看到了如何使用<code class="fe oy oz pa pb b">asfreq</code>进行下采样。一个更强大的选择是<code class="fe oy oz pa pb b">resample</code>，它的行为类似于<code class="fe oy oz pa pb b">pd.groupby</code>。就像<code class="fe oy oz pa pb b">groupby</code>根据分类值对数据分组一样，<code class="fe oy oz pa pb b">resample</code>根据日期频率对数据分组。</p><p id="9790" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">让我们按月末频率对第一个数据集进行缩减采样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="acfa" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">与<code class="fe oy oz pa pb b">asfreq</code>不同，使用重采样只返回重采样状态的数据。要查看每个组，我们需要使用某种类型的函数，类似于我们使用<code class="fe oy oz pa pb b">groupby</code>的方式。</p><p id="581c" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">由于下采样减少了数据点的数量，我们需要一个聚合函数，如mean、median或mode:</p><pre class="kj kk kl km gt pm pb pn po aw pp bi"><span id="5621" class="om lb it pb b gy pq pr l ps pt">data1.resample("M").mean().tail()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/ca02ef10bcbc48d6b244b7173f65418f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*g1ocFj0Nw5bhZ5HenVWqpA.png"/></div></figure><p id="8a39" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">还有一些函数返回一个组的第一条或最后一条记录:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/a392a553822d7cb7f06ba2902f77643d.png" data-original-src="https://miro.medium.com/v2/format:webp/1*iLl4n26NDzROF5pl35IKEw.png"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/c3bbb60c5a1937050b4bd560b63d575f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*IAIOcsIUkhRZIdg7RGk60Q.png"/></div></figure><p id="ec00" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">也可以使用<code class="fe oy oz pa pb b">agg</code>使用多个聚合功能:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/dbcfa1b1929e97cfd685959778ca5e78.png" data-original-src="https://miro.medium.com/v2/format:webp/1*z0pJoYheMOJl3aMScubbDQ.png"/></div></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="6630" class="om lb it bd lc on oo dn lg op oq dp lk mb or os lm mf ot ou lo mj ov ow lq ox bi translated">4.3使用<code class="fe oy oz pa pb b">resample</code>进行上采样和插值</h2><p id="d4ce" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">缩减采样的反面是使<code class="fe oy oz pa pb b">DateTime</code>更加精细。这称为上采样，包括将频率从每天一次改为每小时一次、每小时一次改为每秒一次等操作。</p><p id="d44b" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">向上采样时，您会引入新的日期，导致更多的值丢失。这意味着你需要使用某种类型的插补:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/f5ee32410aa9bbe5108f1517dfdeb491.png" data-original-src="https://miro.medium.com/v2/format:webp/1*dktPb8qulMDbjdLNg_6FJA.png"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/eafdbf43041aaabfa610554fd1497cf4.png" data-original-src="https://miro.medium.com/v2/format:webp/1*fL58BHgaIazxIEiJP_b97Q.png"/></div></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="69ac" class="om lb it bd lc on oo dn lg op oq dp lk mb or os lm mf ot ou lo mj ov ow lq ox bi translated">4.4绘制重采样数据</h2><p id="9926" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">如果不绘制结果，重采样不会产生太多效果。</p><p id="fd9e" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">在大多数情况下，进行缩减采样时，您会看到新的趋势和模式。这是因为下采样降低了粒度，从而消除了噪声:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/fcbd19904f00d5120a0d56723756f6ad.png" data-original-src="https://miro.medium.com/v2/format:webp/1*5AvtAQH2BSdSFDWXKB9KLA.png"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/9ffbf3ab71aa42f5e8a20223c6ce4a6f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*rcIwuwAbIiScRkG3a8CGtQ.png"/></div></figure><p id="94b9" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">绘制上采样分布只会引入更多噪声，所以我们在这里不做。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="085a" class="la lb it bd lc ld nt lf lg lh nu lj lk jz nv ka lm kc nw kd lo kf nx kg lq lr bi translated">5.比较多个时间序列的增长</h1><p id="9821" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">比较两个或多个随时间变化的数值是很常见的。例如，我们可能希望看到第一个数据集中要素1和2的增长率。但问题是:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="8e45" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">第二分布具有高得多的值。将它们绘制在一起可能会将feature_1挤压成一条直线。换句话说，这两种分布具有不同的规模。</p><p id="0bfb" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">为了解决这个问题，统计学家使用标准化。最常见的变化是选择第一个记录的值，然后将其余的样本除以该值。这显示了每个记录与第一个记录相比是如何变化的。</p><p id="1d62" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这里有一个例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/3ba634e47875e7707bda777a5e37e468.png" data-original-src="https://miro.medium.com/v2/format:webp/1*00TZBdvcqG1TBlQduVTG9Q.png"/></div></figure><p id="c2ad" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在，上面输出中的每一行都显示了与第一行相比的百分比增长。</p><p id="8104" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在，让我们绘制它们来比较增长率:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/ee043d5e1ab498c8e37bbd223b95c50c.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Ydfmm_yi9Clm3S6zFaBzRw.png"/></div></figure><p id="7a88" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">从2011年到2017年，这两项功能都实现了超过300%的增长。您甚至可以从其他数据集绘制时间序列:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/fc77f510529885ed9dbcef267a5ceb3d.png" data-original-src="https://miro.medium.com/v2/format:webp/1*-eUDxAkWCuzrgBCToYosJQ.png"/></div></figure><p id="97d0" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">如您所见，数据集1中的要素比第二个数据集中的另一个要素具有更高的增长率。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="1c7b" class="la lb it bd lc ld nt lf lg lh nu lj lk jz nv ka lm kc nw kd lo kf nx kg lq lr bi translated">6.窗口功能</h1><p id="d222" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">还有另一种类型的函数可以帮助您以新颖的方式分析时间序列数据。这些被称为窗口函数，它们帮助您聚合自定义数量的行，称为“窗口”</p><p id="e1b0" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">例如，我可以在我的<a class="ae kz" href="https://medium.com/@ibexorigin" rel="noopener">中型订户</a>数据上创建一个30天的窗口，以查看过去30天中任何一天的订户总数。或者，餐馆老板可以创建一个每周窗口来查看上周的平均销售额。例子不胜枚举，因为您可以在数据上创建任意大小的窗口。</p><p id="0799" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">让我们更详细地探讨这些。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="de59" class="om lb it bd lc on oo dn lg op oq dp lk mb or os lm mf ot ou lo mj ov ow lq ox bi translated">6.1滚动窗口功能</h2><p id="33bb" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">滚动窗口功能将具有相同的长度。当它们滑过数据时，它们的覆盖范围(行数不变)。以下是一个包含5个时间段的数据滑动窗口示例:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pv"><img src="../Images/035ea5a86dd5370b458f00f6d17ea5cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PYt9OYUi7tIOiFC2xQK2OA.png"/></div></div></figure><p id="9007" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">下面是我们如何在pandas中创建滚动窗口:</p><pre class="kj kk kl km gt pm pb pn po aw pp bi"><span id="1281" class="om lb it pb b gy pq pr l ps pt">&gt;&gt;&gt; data1.rolling(window=5)</span><span id="c64d" class="om lb it pb b gy pu pr l ps pt">Rolling [window=5,center=False,axis=0]</span></pre><p id="a683" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">就像<code class="fe oy oz pa pb b">resample</code>一样，它处于只读状态——为了使用每个窗口，我们应该链接某种类型的函数。例如，让我们为过去5个周期创建一个累计和:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/6c123cd9b3d6479a3cf469e117037e1a.png" data-original-src="https://miro.medium.com/v2/format:webp/1*C22vyhDNkqHACDDSxntdiQ.png"/></div></figure><p id="2ded" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">显然，前4排是NaNs。任何其他行将包含前4行和当前行的总和。</p><p id="f5e6" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">请注意窗口参数。如果传递一个整数，窗口大小将由该行数决定。如果您传递一个频率别名，如月、年、5小时或7周，则窗口大小将是包含传递频率的单个单位的任意行数。换句话说，5周期窗口可能与5天频率窗口大小不同。</p><p id="5f4b" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">例如，让我们绘制特性2的90和360天移动平均线，并绘制它们:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/8277ad3a5f414a7581670f2864340826.png" data-original-src="https://miro.medium.com/v2/format:webp/1*uNLEVdYyAuD8dOA-k7owiA.png"/></div></figure><p id="c225" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">就像<code class="fe oy oz pa pb b">groupby</code>和<code class="fe oy oz pa pb b">resample</code>一样，您可以使用<code class="fe oy oz pa pb b">agg</code>函数为每个窗口计算多个指标。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="7498" class="om lb it bd lc on oo dn lg op oq dp lk mb or os lm mf ot ou lo mj ov ow lq ox bi translated">6.2扩展窗口功能</h2><p id="d6fd" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">另一种类型的窗口函数处理扩展窗口。每个新窗口将包含截至当前日期的所有记录:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pw"><img src="../Images/78acdd68a2c7e22aa392323f1567546f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*41yjh0h28bXPOLelA36DAQ.png"/></div></div></figure><p id="39ab" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">扩展窗口对于计算“运行”指标非常有用，例如，运行总和、平均值、最小值和最大值、运行回报率等。</p><p id="4e7d" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">下面，您将看到如何计算累积和。累积和实际上是一个窗口大小为1:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/5eddc397f53eb9576d6fe088c5919b08.png" data-original-src="https://miro.medium.com/v2/format:webp/1*4YMsUzzbuy5S_mou4PsGWw.png"/></div></figure><p id="71cc" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated"><code class="fe oy oz pa pb b">expanding</code>函数有一个<code class="fe oy oz pa pb b">min_periods</code>参数，决定初始窗口大小。</p><p id="33ec" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在，让我们看看如何绘制跑步最小值和最大值:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj pk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl pl"><img src="../Images/2245d482606deeb778de29a24e9e6c5e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*2KWKlFK6ebUg0pzSmxl2pg.png"/></div></figure><h2 id="fe97" class="om lb it bd lc on oo dn lg op oq dp lk mb or os lm mf ot ou lo mj ov ow lq ox bi translated">摘要</h2><p id="dc32" class="pw-post-body-paragraph ls lt it lu b lv lw ju lx ly lz jx ma mb mc md me mf mg mh mi mj mk ml mm mn im bi translated">我想祝贺是应该的！</p><p id="3313" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">现在，您知道了可以用来操作时间序列数据的每一个Pandas函数。这是一篇非常长的帖子，但绝对值得，因为现在你可以处理任何扔给你的时间序列数据。</p><p id="83bc" class="pw-post-body-paragraph ls lt it lu b lv mo ju lx ly mp jx ma mb mq md me mf mr mh mi mj ms ml mm mn im bi translated">这篇文章主要关注数据操作。该系列的下一篇文章将是关于更深入的时间序列分析，你可以在时间序列上创建的每个单独的图的类似文章，以及关于预测的专门文章。敬请期待！</p><h2 id="eaaa" class="om lb it bd lc on oo dn lg op oq dp lk mb or os lm mf ot ou lo mj ov ow lq ox bi translated">您可能也会感兴趣…</h2><ul class=""><li id="e856" class="ny nz it lu b lv lw ly lz mb px mf py mj pz mn qa oe of og bi translated"><a class="ae kz" rel="noopener" target="_blank" href="/matplotlib-vs-plotly-lets-decide-once-and-for-all-ad25a5e43322?source=your_stories_page-------------------------------------"> Matplotlib vs. Plotly:一劳永逸吧</a></li><li id="fcd6" class="ny nz it lu b lv oh ly oi mb oj mf ok mj ol mn qa oe of og bi translated"><a class="ae kz" href="https://medium.com/me/stories/public#:~:text=6%20Things%20I%20Do%20to%20Consistently%20Improve%20My%20Machine%20Learning%20Models" rel="noopener">我为持续改进我的机器学习模型而做的6件事</a></li><li id="fbff" class="ny nz it lu b lv oh ly oi mb oj mf ok mj ol mn qa oe of og bi translated"><a class="ae kz" rel="noopener" target="_blank" href="/5-short-but-super-productive-things-to-do-during-model-training-b02e2d7f0d06?source=your_stories_page-------------------------------------">训练机器学习模型时要做的5件超级高效的事情</a></li></ul></div></div>    
</body>
</html>