<html>
<head>
<title>How Grouping Works with Python Pandas vs R Data Table</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python Pandas与R数据表的分组方式</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-grouping-works-with-python-pandas-vs-r-data-table-bc9990bc46e0?source=collection_archive---------25-----------------------#2021-05-06">https://towardsdatascience.com/how-grouping-works-with-python-pandas-vs-r-data-table-bc9990bc46e0?source=collection_archive---------25-----------------------#2021-05-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="37df" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">举例说明</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/65349317c02dc0d14de0e05579beac50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ke6B9s41T85l__Yp__hnTA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com/s/photos/color-groups?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae ky" href="https://unsplash.com/@shyshkina?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">特蒂亚娜·什希金娜</a>的照片</p></figure><p id="e2c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">美国不同城市的平均房价是多少？一家店不同产品组的总销售额是多少？不同公司的平均工资是多少？</p><p id="56d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只要我们有适当的数据，所有这些问题都可以通过分组操作来回答。大多数数据分析库和框架都实现了一个函数来执行这样的操作。</p><p id="ef69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将比较两个最流行的数据分析库在涉及分组的任务方面的差异。第一个是Python熊猫，第二个是R数据表。</p><p id="b8af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用Kaggle上提供的墨尔本房屋<a class="ae ky" href="https://www.kaggle.com/anthonypino/melbourne-housing-market" rel="noopener ugc nofollow" target="_blank">数据集</a>作为示例。我们首先导入库并读取数据集。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="e14a" class="ma mb it lw b gy mc md l me mf"># pandas<br/>import pandas as pd<br/>melb = pd.read_csv("/content/melb_data.csv")</span><span id="02a2" class="ma mb it lw b gy mg md l me mf"># data.table<br/>library(data.table)<br/>melb &lt;- fread("datasets/melb_data.csv")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/bd0c5a91d4a90701c4f24a5c88c00419.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gAAUjukzv2Bm4QNIhPzqcg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">前5行数据(图片由作者提供)</p></figure><p id="c133" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从找到每种房屋类型的平均房间数开始。Pandas提供了<code class="fe mi mj mk lw b">groupby</code>函数，用于对观察值(即行)进行分组。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ccae" class="ma mb it lw b gy mc md l me mf"># pandas<br/>melb[["Type","Rooms"]].groupby("Type").mean()</span><span id="41a9" class="ma mb it lw b gy mg md l me mf">        Rooms<br/>Type<br/>h    3.405189<br/>t    2.944260<br/>u    2.061948</span></pre><p id="7a42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们选择“类型”和“房间”列，并根据“类型”列对房屋(即行)进行分组。因为在type列中有3个不同的值，所以我们最终有3个组。最后，我们对每组应用均值函数，得到房间的平均数。</p><p id="39db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们不选择列并直接应用<code class="fe mi mj mk lw b">groupby</code>函数，Pandas会计算所有数字列的平均值。有一个更实际的方法来解决这个问题，我们将在下面的例子中讨论。</p><p id="ccfc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我们如何对数据表进行同样的操作:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4e8c" class="ma mb it lw b gy mc md l me mf"># data.table<br/>melb[, .(mean(Rooms)), by=Type]</span><span id="b1b0" class="ma mb it lw b gy mg md l me mf">   Type       V1<br/>1:    h 3.405189<br/>2:    t 2.944260<br/>3:    u 2.061948</span></pre><p id="5e62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">直觉是一样的，但语法是不同的。<code class="fe mi mj mk lw b">by</code>参数用于选择用于分组的列。数据表可以用逗号分隔不同类型的操作。例如，如果我们需要传递一个条件来过滤行，我们把它放在方括号内的第一个逗号之前。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="f586" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于第二个示例，我们计算每个地区的平均房价，并为聚合列指定一个名称。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="177c" class="ma mb it lw b gy mc md l me mf"># pandas<br/>melb.groupby("Regionname", as_index=False).agg(<br/>    avg_house_price = ("Price", "mean")<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/bb6f8512af18154b6a5d3cbbbe4b93cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sF0HxH4fFBS-tbAmFzMSWw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="9936" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这次我们使用了命名聚合，因此我们不必选择任何列。聚合的类型和要聚合的列在<code class="fe mi mj mk lw b">agg</code>函数中指定。我们还可以为聚合列指定一个定制的名称。</p><p id="a7b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mi mj mk lw b">as_index</code>参数用于为组创建一个列。否则，它们将被表示为数据帧的索引。</p><p id="db4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是数据表版本:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2b84" class="ma mb it lw b gy mc md l me mf"># data.table<br/>melb[, .(avg_house_price = mean(Price, na.rm = TRUE)), by=Regionname]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/bb86230b248bfc7cc610d9f97761941c.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*M-euhzaDusUP-LQ4dp5FtA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="e8f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据表语法变化不大。我们刚刚添加了<code class="fe mi mj mk lw b">na.rm</code>参数，因为price列中缺少值。我们需要在计算平均值之前去掉它们。否则，所有聚合值都变成NA。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="7f10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两个库都允许嵌套分组，因此我们可以基于多个列对观察结果进行分组。让我们找出每个地区每种类型的平均房价。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ca1c" class="ma mb it lw b gy mc md l me mf"># pandas<br/>melb.groupby(["Regionname", "Type"], as_index=False).agg(<br/>   avg_house_price = ("Price", "mean")<br/>)[:5]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/9e8ab676806ee1c851d39a3de448e415.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MfUtlI10V4TM0iewa0UAmA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="5211" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用一个列表将多个列传递给<code class="fe mi mj mk lw b">groupby</code>函数。代码末尾的5限制了要显示的行数。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="da11" class="ma mb it lw b gy mc md l me mf"># data.table<br/>melb[, .(avg_house_price = mean(Price, na.rm = T)), .(Regionname, Type)][1:5]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/3007ebca45e742e0a91ea87babb5746a.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*UuVqSZF5mH-WXxKBpNM9XQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="a051" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能已经注意到，我们不一定要使用<code class="fe mi mj mk lw b">by</code>关键字。数据表的标准结构语法允许它知道哪些列用于分组。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="49cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就像我们可以按多个列分组一样，我们可以为每个组计算多个聚合。此外，它们不必是相同类型的聚合。</p><p id="efa6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，我们可以计算每种房屋类型的平均房间数量，并计算每组中的房屋数量。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="e6ff" class="ma mb it lw b gy mc md l me mf"># pandas<br/>melb.groupby("Type", as_index=False).agg(<br/>   avg_number_of_rooms = ("Rooms", "mean"),<br/>   number_of_houses = ("Rooms", "count")<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/2b20f564aa071b4f8241eeacb4a232f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*NX1RZ91sLUOX0X5z0oohnA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="e70b" class="ma mb it lw b gy mc md l me mf"># data.table<br/>melb[,<br/>     .(avg_number_of_rooms = mean(Rooms), number_of_houses = .N)<br/>     , Type]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/7564b1fac6619b754eb3e6321df480c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*joEVO9XJ-XPMA1KqcIbCrA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="f8e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们以一个稍微复杂一点的例子来结束。我们首先根据条件过滤观察值(即行),然后应用分组操作。最后，我们基于聚合列对结果进行排序。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a02a" class="ma mb it lw b gy mc md l me mf"># pandas<br/>melb[melb.Price &gt; 1000000].groupby("Type").agg(<br/>   avg_distance = ("Distance", "mean"),<br/>   number_of_houses = ("Distance", "count")<br/>).sort_values(by="avg_distance")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi my"><img src="../Images/d42db224fe6359d4fe7b0a5c85f737a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:880/format:webp/1*jJ4N3HyjxyZfAuUXU2wRcQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d818" class="ma mb it lw b gy mc md l me mf"># data.table<br/>melb[Price &gt; 1000000,<br/>     .(avg_distance = mean(Distance),<br/>       number_of_houses = .N)<br/>     , Type][order(avg_distance)]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/779fd0ca6fe7e6c2db89f5a0216e13a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*i6DryHUfS06y7uHqpNCzrw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="25a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">过滤是预期的第一个操作。<code class="fe mi mj mk lw b">sort_values</code>和<code class="fe mi mj mk lw b">order</code>函数分别对熊猫和数据表进行排序。默认情况下，它们都按升序排序。为了按降序排序，我们可以将熊猫的参数<code class="fe mi mj mk lw b">ascending</code>设置为false。如果我们在列名前添加一个减号，数据表将按降序排序。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="6090" class="ma mb it bd na nb nc dn nd ne nf dp ng li nh ni nj lm nk nl nm lq nn no np nq bi translated">结论</h2><p id="3378" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">根据列中不同的值或类别对观察值进行分组，然后应用一些聚合，这对探索性数据分析至关重要。</p><p id="67ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，数据分析和操作库提供了灵活的功能来处理这些操作。我们已经做了几个例子来演示如何用pandas和数据表库进行分组。</p><p id="2249" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>