<html>
<head>
<title>Regression in Python using Sklearn, XGBoost and PySpark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Sklearn、XGBoost和PySpark在Python中进行回归</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/solution-of-a-regression-problem-with-machine-learning-in-python-using-sklearn-and-xgboost-and-ea19afdfc067?source=collection_archive---------13-----------------------#2021-10-25">https://towardsdatascience.com/solution-of-a-regression-problem-with-machine-learning-in-python-using-sklearn-and-xgboost-and-ea19afdfc067?source=collection_archive---------13-----------------------#2021-10-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="2743" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi ko translated">机器学习通常用于解决回归问题。更具体地说，将回归算法应用于多维数据框架是<strong class="js iu">一种常用于测量一个(或多个)自变量(预测值)和多个因变量(响应值)</strong>线性相关程度的方法。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi kx"><img src="../Images/f38edb1eeefde644cf4faab960b558ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kSw-njRsFwVlqbTElIX8oQ.jpeg"/></div></div><p class="lj lk gj gh gi ll lm bd b be z dk translated">图片来自unsplash.com</p></figure><p id="2526" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你正准备开始建立你的机器学习模型，那么我希望你已经完成了探索性数据分析(EDA ),并且现在你已经熟悉了你的数据集。如果你不知道，我建议你看一下我写的关于EDA的故事，这是为了解决我在这里将要介绍的同样的问题。这个故事将带你回到分析数据，然后跳到机器学习部分，我将在这里介绍。</p><div class="ln lo gp gr lp lq"><a rel="noopener follow" target="_blank" href="/exploratory-data-analysis-eda-in-python-using-sql-and-seaborn-sns-d1f3bfcc78af"><div class="lr ab fo"><div class="ls ab lt cl cj lu"><h2 class="bd iu gy z fp lv fr fs lw fu fw is bi translated">使用SQL和Seaborn (SNS)在Python中进行探索性数据分析(EDA)</h2><div class="lx l"><h3 class="bd b gy z fp lv fr fs lw fu fw dk translated">探索性数据分析(EDA)是一种分析数据集以总结其主要特征的方法，通常…</h3></div><div class="ly l"><p class="bd b dl z fp lv fr fs lw fu fw dk translated">towardsdatascience.com</p></div></div><div class="lz l"><div class="ma l mb mc md lz me lh lq"/></div></div></a></div></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><p id="13b4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上面的故事中，我们使用了一个<a class="ae mm" href="https://github.com/quaesito/ml-fitbit/tree/main/data" rel="noopener ugc nofollow" target="_blank"> Fitbit数据集</a>。</p><p id="7ea6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">基于EDA，发现所采取的步骤和卡路里在某种程度上是线性相关的，并且它们一起可以指示全因死亡率的较低风险。更有趣的是，在我们的数据中，有一个数据集还没有被使用，那就是重量和身体质量指数测井。</p><p id="663d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些数据具有独特的性质，因为它们不一定是机器生成的，此后它们被用作<em class="mn">“标签”</em>。简而言之，用户正在使用他们的Fitbit收集有关他们活动的数据，并且偶尔会记录一些身体信息，如体重、脂肪和身体质量指数。这为监督学习问题创造了一个最佳场景，例如，我们可以使用Fitbit活动数据来预测用户的身体质量指数。然后，这种预测可以用于评估用户的健康状况。此外，访问与上述监督学习问题非常相关的一些其他个人信息，如身高、年龄和性别，会更加有用。</p><p id="c2df" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然而，出于本练习的目的，<em class="mn">weightLogInfo _ merged</em>data frame的数据长度不足以训练一个人工智能模型，并且我们不会处理用户的个人信息。因此，我们将问题简化为卡路里预测，而卡路里被用作评估用户健康状况的主要变量。</p><p id="a732" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将实现三种不同的机器学习算法，即:多元线性回归、随机森林和极端梯度助推器。然后，我们将宣布获胜者，并在PySpark中实现获胜者算法，以适应潜在的“大数据”问题。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="9da7" class="mo mp it bd mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl bi translated">预处理</h1><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi no"><img src="../Images/f8962de6d0eb418e7c9f5b7940e1a20d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q6gUbhaQP_186_Pw40iP9Q.png"/></div></div></figure><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi np"><img src="../Images/a5911b71cd11ba2669efd9846cc87cf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bbdeEypsFxORKjkCbhdjLA.png"/></div></div></figure><p id="5912" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们希望以这样一种方式分割数据，即训练集占总数据集的60%，验证集和测试集各占20%。此后，为了便于学习过程，我们将数据的范围定在0到1之间。</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="5628" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们希望根据每次预测平均值的模型的性能来建立基线分数。基线有助于评估我们要训练的模型是否真正从数据中“学习”了什么。</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/e0e13b1496028c1851cddc24ae5c07a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*Izhr2CdDvv7HI0EySXj6nQ.png"/></div></figure><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi nr"><img src="../Images/cda3d329b764625921874463b8cd3d11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vpK5Cw4yg0_z8wqyuh-PIw.png"/></div></div></figure><p id="b923" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Lasso回归算法表明，通过在模型中包含所有要素，我们可能不会面临任何重大的多重共线性问题。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="f707" class="mo mp it bd mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl bi translated">多元线性回归器</h1><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/e9d85cb7f38a7df2ce952b7f2071fe08.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/format:webp/1*rLwKD90OW9JKRW1hhQz05w.png"/></div></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="769a" class="mo mp it bd mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl bi translated">随机森林回归量</h1><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/55f2a7ef900ae7342307a7c86a6d5b73.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*4TdX_vEBDRECu58zn6qvlA.png"/></div></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="6d72" class="mo mp it bd mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl bi translated">极端梯度助推器</h1><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/18764c12968ebb9b5f78f7d6ab766831.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*wnqvTYNO_TEHW8cGlcNrew.png"/></div></figure><p id="2d54" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们使用了三种不同的模型，它们(幸运地)似乎都优于基线，因此结果是有意义的。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="dacb" class="mo mp it bd mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl bi translated">交叉验证</h1><p id="4b47" class="pw-post-body-paragraph jq jr it js b jt nv jv jw jx nw jz ka kb nx kd ke kf ny kh ki kj nz kl km kn im bi translated">首先，我们将进行交叉验证比较…</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi oa"><img src="../Images/20ca801a8b23952c8a5bb10d6cb936e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oMbt5ahwia2xSTZElCP1OA.png"/></div></div></figure><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi ob"><img src="../Images/957e5bb5124501aec1ca268ccd04d52c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PDXtjXYI34hDHLexMkWW5A.png"/></div></div></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="6105" class="mo mp it bd mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl bi translated">超参数调谐</h1><p id="9276" class="pw-post-body-paragraph jq jr it js b jt nv jv jw jx nw jz ka kb nx kd ke kf ny kh ki kj nz kl km kn im bi translated">为了提高我们的随机森林模型的准确性，我们将使用RandomizedSearchCV调整超参数</p><p id="3f60" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们将设置调整随机森林的范围或可能性…</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/8489e9be375441174682d4043cbb67b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*rR7nB2mRtSdEc565iTP2HQ.png"/></div></figure><p id="0d69" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">…然后我们调整模型</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi od"><img src="../Images/e4926471afa765a05746facede9a4b28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4syzNr736YGDWK0wkKSEig.png"/></div></div></figure><p id="0802" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，我们将对极端梯度助推器重复同样的过程…</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/b15d12394c46df63673c196c837d237c.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/format:webp/1*XKC55X7pWO70HiQJHXVbow.png"/></div></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="f4e9" class="mo mp it bd mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl bi translated">最终模型评估</h1><p id="598e" class="pw-post-body-paragraph jq jr it js b jt nv jv jw jx nw jz ka kb nx kd ke kf ny kh ki kj nz kl km kn im bi translated">现在，是时候评估模型了…</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi oe"><img src="../Images/e648ecd742d279a9b45fe7a0b77f5f9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tXEBnqlLM-qaa4TwwbHzvA.png"/></div></div></figure><blockquote class="of og oh"><p id="6c81" class="jq jr mn js b jt ju jv jw jx jy jz ka oi kc kd ke oj kg kh ki ok kk kl km kn im bi translated"><em class="it">aaaaaa获胜者是… </em> <strong class="js iu"> <em class="it">随机森林</em> </strong></p></blockquote><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi ol"><img src="../Images/0024b083aab08257a6c415d7cb867289.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fP1elv-raL3PZUDbWHmYSQ.jpeg"/></div></div></figure><p id="6f32" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">交叉验证和超参数微调有助于提高准确性。</p><p id="c7d8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过在更大的跨度上选择更小的估计量区间，模型的性能可能会得到改善。总的来说，随机森林似乎给出了最好的结果，准确率为80.5%。</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi om"><img src="../Images/d1483b3a4e9c656b158b9e721952fd3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VlWcviycHKOrqhVy076cgA.png"/></div></div></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="98b8" class="mo mp it bd mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl bi translated">PySpark中的随机森林回归器</h1><p id="8a5e" class="pw-post-body-paragraph jq jr it js b jt nv jv jw jx nw jz ka kb nx kd ke kf ny kh ki kj nz kl km kn im bi translated">为了构建前面的模型，我们使用了Scikit-learn和XGBoost。虽然这些库在相对方便的数据集上工作得很好(比如我们正在处理的数据集)，但它们是处理“大数据”的高效计算选择。</p><p id="49ca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">假设我们的数据集可能被进一步扩展，我们只为性能最好的模型实现了上述原型的一个更加可扩展的应用程序。为了简单起见，我们将直接使用以前在Pandas中创建的数据帧。</p><p id="9058" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">数据框需要一些“按摩”才能适合训练…</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi on"><img src="../Images/eb6ced777ae7f25768efe18e5953cc86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RnlV-UKHYVjGmMWnuX61Pg.png"/></div></div></figure><p id="98af" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">既然PySpark数据框架已经准备好了，我们就可以创建特性了…</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/49a932e2f8bf18ecbb2a4ceff53e855d.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*Jbn16KBN2NDfaxmoL4etlQ.png"/></div></figure><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi op"><img src="../Images/d7b82b76b142ba40ccd5ef48c3584106.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*gVQMv5SzeskXOF2tx6ACqw.png"/></div></figure><p id="88eb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在数据已经准备好进行训练了…</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nm nn l"/></div></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/59bc393d8338d985ce8081a28aab6e50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*1VZum0tyD9ZLeV1QiIAJCQ.png"/></div></figure><p id="9f4b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在Spark环境中获得了(几乎)相同的结果，而在超参数调整之前，先前的随机森林模型的准确度是77.3%，现在获得了77%。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><p id="1d79" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你喜欢我的故事，并想跳到有代码和完整数据集的笔记本，我已经在我个人的<a class="ae mm" href="https://github.com/quaesito" rel="noopener ugc nofollow" target="_blank"> git </a>上的<a class="ae mm" href="https://github.com/quaesito/ml-fitbit" rel="noopener ugc nofollow" target="_blank"> repo </a>中发布了它。</p><p id="d8cd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">给回购打个星:)</p><p id="6308" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你在数据科学和/或人工智能项目上需要任何帮助，请不要犹豫，通过<a class="ae mm" href="https://www.linkedin.com/in/micheledefilippo/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>或<a class="ae mm" href="http://midasanalytics.ai" rel="noopener ugc nofollow" target="_blank"> midasanalytics.ai </a>联系我</p></div></div>    
</body>
</html>