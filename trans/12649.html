<html>
<head>
<title>An Easy Beginners Guide to SQLite in Python and Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 和 Pandas 中 SQLite 的简易初学者指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/an-easy-beginners-guide-to-sqlite-in-python-and-pandas-fbf1f38f6800?source=collection_archive---------5-----------------------#2021-12-29">https://towardsdatascience.com/an-easy-beginners-guide-to-sqlite-in-python-and-pandas-fbf1f38f6800?source=collection_archive---------5-----------------------#2021-12-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="27a1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何在 SQLite 中创建表和查询数据，以及从 Pandas 访问 SQLite</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5a1d2c3e3b9ffa1c7ab800a4f9d33471.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XdSzYz_U58zBCEUT"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@clemhlrdt?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Clément Hélardot </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="b3eb" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">欢迎阅读 SQLite 的简易初学者指南。在本文中，您将了解什么是 SQLite，如何连接到数据库、创建表、插入和查询数据，以及在 Pandas 中访问 SQLite。我假设您对 SQL 有基本的了解，我在本文中的重点将是如何在 Python 中使用 SQLite。</p><h1 id="0c23" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">什么是 SQLite？</h1><p id="7a2f" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">SQLite 是一个软件库，它为我们提供了一个开源的关系数据管理系统，我们可以在其中存储大量的数据。</p><p id="bbe8" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">它易于设置，是独立的(需要最少的支持)，并且不需要服务器。SQLite 数据库实际上只是一个普通文件，这使得它易于访问和移植。鉴于 SQLite 的简单性，它是部署最广泛的数据库引擎。</p><p id="706a" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">SQLite 有很多优点，但是在实践中，如果要处理大量数据，就不应该使用 SQLite。该数据库实际上限为 281。</p><h1 id="9de7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">入门指南</h1><p id="4998" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">如果你愿意跟随，你可以在这里下载我的 Jupyter 笔记本。</p><p id="3866" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们首先在 python 文件中导入 SQLite 库。如果您使用的是 Python 2.5 和更高版本，那么这个库不必下载，因为它应该已经包含在标准库中了。</p><p id="d1c2" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe mz na nb nc b">import sqlite3 as db</code></p><p id="5371" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">接下来，我们可以连接到一个现有的数据库，或者创建一个新的数据库，如果它不存在的话。</p><p id="87b4" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe mz na nb nc b">conn = db.connect('my_database.db')</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/448a9089bdbaea1583c0afe27b1509fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*1uSTtCoLxHNjLp-mSaJGqA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><blockquote class="ne nf ng"><p id="af58" class="lg lh nh li b lj lk ju ll lm ln jx lo ni lq lr ls nj lu lv lw nk ly lz ma mb im bi translated"><em class="it">请注意，SQLite 引擎将数据库维护为扩展名为. db 的文件，因此上面的代码行将连接到一个名为 my_database.db 的文件，如果它存在于文件夹中的话。如果它不存在，将在您的计算机上自动创建一个名为 my_database.db 的文件，如上面的代码片段所示。</em></p></blockquote><p id="4dc4" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">为了与数据库进行交互，我们现在必须创建一个游标。这就是我们将用来发布命令，允许我们查询或修改我们的数据库。</p><p id="11f4" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe mz na nb nc b">c = conn.cursor()</code></p><h1 id="23f5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建和修改表格</h1><p id="45fa" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">既然我们已经创建了数据库连接和游标，现在我们可以开始交互了。让我们在数据库中创建第一个表。</p><h2 id="797b" class="nl md it bd me nm nn dn mi no np dp mm lp nq nr mo lt ns nt mq lx nu nv ms nw bi translated">创建表格</h2><p id="d128" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">我们对之前创建的游标<code class="fe mz na nb nc b">c</code>使用方法<code class="fe mz na nb nc b">execute</code>，并传入我们的 SQL 语句。</p><p id="51b5" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe mz na nb nc b">c.execute("CREATE TABLE employees (empid INTEGER PRIMARY KEY, firstname NVARCHAR(20), lastname NVARCHAR(20))")</code></p><p id="95a2" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">上面的语句将创建一个名为 employees 的表，该表包含三列:empid、firstname 和 lastname。</p><p id="605d" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">您可以使用以下语句检查该表是否已成功创建。</p><pre class="kj kk kl km gt nx nc ny nz aw oa bi"><span id="0741" class="nl md it nc b gy ob oc l od oe">c.execute("SELECT name FROM sqlite_master WHERE type='table';")<br/>print(c.fetchall())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/9f3e9eae22d0079f9c1e54e0aa2bdb2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*vkANBrD68nixyAHnTF6M3g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="fd13" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">上面的选择查询将显示数据库中的所有表。请注意，如果只有第一条语句，则不会输出查询结果。你必须使用<code class="fe mz na nb nc b">c.fetchall()</code>来显示结果。</p><h2 id="be8a" class="nl md it bd me nm nn dn mi no np dp mm lp nq nr mo lt ns nt mq lx nu nv ms nw bi translated">将数据插入表格</h2><p id="ab8e" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">要填充该表，我们有几个选项。如果只插入几行，可以使用下面的 insert 语句向 employee 表中输入两行。</p><pre class="kj kk kl km gt nx nc ny nz aw oa bi"><span id="82a5" class="nl md it nc b gy ob oc l od oe">c.execute("INSERT INTO employees VALUES (12986,'Michael','Scott')")<br/>c.execute("INSERT INTO employees VALUES (12987,'Dwight','Schrute')")</span></pre><p id="22b9" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">如果有许多行要输入到表中，可以考虑制作一个元组列表，并使用<code class="fe mz na nb nc b">executemany()</code>命令。</p><pre class="kj kk kl km gt nx nc ny nz aw oa bi"><span id="b381" class="nl md it nc b gy ob oc l od oe">new_employees = [(12987, 'Jim', 'Halpert'),<br/> (12988, 'Pam', 'Beesly'),<br/> (12989, 'Andy', 'Bernard'),<br/> (12990, 'Kevin', 'Malone'),<br/> (12991, 'Toby', 'Flenderson'),<br/> (12992, 'Angela', 'Martin'),<br/> (12993, 'Stanley', 'Hudson')]</span><span id="bfb1" class="nl md it nc b gy og oc l od oe">c.executemany('INSERT INTO employees VALUES (?, ?, ?)', new_employees)</span></pre><p id="8adc" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">请注意，我们已经用(？, ?, ?).这里的问号代表我们输入到表格中的三个项目的占位符。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/43bd260fa52fc11e28831206e9092e65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3IKg4W6ghu2hZgi5.jpg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">上的</a><a class="ae ky" href="https://unsplash.com/@windows?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">窗口</a>拍照</p></figure><p id="9d1a" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">让我们看看现在我们的表中有什么。我们可以在 execute 命令中使用 select 语句，就像我们以前做的那样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/736a12186d6cf17c1827662d1b90e6e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bEIMyP5tua1MuprtM-ypag.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6c1f" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">从输出中，我们可以看到我们所有的员工都被正确地输入到表中。万岁！</p><h2 id="04e4" class="nl md it bd me nm nn dn mi no np dp mm lp nq nr mo lt ns nt mq lx nu nv ms nw bi translated">提交更改</h2><p id="181b" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">我们已经对我们的数据库做了一些更改，但是它们还没有保存到数据库中！这些只是临时的修改，所以我们必须确保用下面的命令提交这些修改。</p><p id="fc2e" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe mz na nb nc b">conn.commit()</code></p><p id="feaa" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">否则，一旦我们关闭连接，更改将会丢失。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/7ac804fa4b05807bee0d128c5350dcf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s5PrmHPY0NYKukiJ.jpg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@javaistan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Afif Kusuma </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="477c" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">最后，一旦完成，关闭光标和连接总是一个好习惯。我们可以用下面的命令做到这一点。</p><pre class="kj kk kl km gt nx nc ny nz aw oa bi"><span id="60bd" class="nl md it nc b gy ob oc l od oe">c.close()<br/>conn.close()</span></pre><h1 id="55f7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak"> SQLite via Pandas </strong></h1><p id="060b" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">你可以做的一件很酷的事情是同时使用 SQLite 和 Pandas。Pandas 有一个<code class="fe mz na nb nc b">read_sql_query</code>方法，允许你以 Pandas dataframe 的形式返回数据。从那里，您可以更容易地操作 Pandas 中的数据。就我个人而言，我更喜欢把数据放在熊猫体内进行研究。</p><p id="88fb" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们再次必须首先建立到数据库的连接。然后我们可以使用<code class="fe mz na nb nc b">pd.read_sql_query</code>并将输出保存为名为<code class="fe mz na nb nc b">df_employees.</code>的数据帧</p><pre class="kj kk kl km gt nx nc ny nz aw oa bi"><span id="0e36" class="nl md it nc b gy ob oc l od oe">#import library<br/>import pandas as pd</span><span id="3d44" class="nl md it nc b gy og oc l od oe">con = db.connect('my_database.db')<br/>df<!-- -->_employees<!-- --> = pd.read_sql_query('select * from employees', con)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/2363b15a482ed4753ec71fca53557bf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*VBto1qTbjrdDOBJtwFiW0Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者的图片</p></figure><p id="37ee" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在它是一个 pandas 数据框架，您可以使用您常用的 Pandas 函数随意操作数据。</p><p id="180e" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">例如，假设 Stanley <em class="nh">(桌子上的最后一个人)</em>本来就不该被雇佣，所以我们需要把他从桌子上赶走。</p><p id="94b0" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe mz na nb nc b">df_new = df_employees[:-1]</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/19447bfe3f792d68c474b8a255279a44.png" data-original-src="https://miro.medium.com/v2/resize:fit:470/format:webp/1*WfZpFxV6Ql-Dux7KzKkRbg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="8fcb" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们可以将新的 dataframe 写回 SQLite 并替换原始的 employee 表。为了写入 SQLite，我们在新的数据帧上使用方法<code class="fe mz na nb nc b">to_sql()</code>。</p><p id="2b2e" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe mz na nb nc b">df_new.to_sql("employees", con, if_exists="replace")</code></p><p id="aa67" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们在这个方法中提供了三个参数:</p><ol class=""><li id="eb2c" class="on oo it li b lj lk lm ln lp op lt oq lx or mb os ot ou ov bi translated">SQL 表的名称</li><li id="3ff5" class="on oo it li b lj ow lm ox lp oy lt oz lx pa mb os ot ou ov bi translated">与数据库的连接</li><li id="8eba" class="on oo it li b lj ow lm ox lp oy lt oz lx pa mb os ot ou ov bi translated">如果表已经存在，该如何操作。“替换”将删除原始表格。“失败”将在 Python 中引发一个值错误。“追加”会将数据作为新行插入到表中</li></ol><p id="56c1" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">为了检查它是否如我们预期的那样工作，我可以再次查询这个表，看看 Stanley 是否已经被删除。它有！</p><p id="efad" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe mz na nb nc b">pd.read_sql_query ('select * from employees', con)</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/da72564a743a985955591b7e6c7fc819.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*Rqa3Jh-A0zgxx2U-xC4AyQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="165b" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">就像之前一样，一旦我们完成，让我们关闭连接。</p><p id="111d" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe mz na nb nc b">con.close()</code></p><p id="6ee9" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">就是这样！SQLite 使用起来非常简单。如果你正在寻找一个好的数据库来练习 SQL 和/或 SQLite，你可以在这里下载 Chinook 数据库<a class="ae ky" href="https://www.sqlitetutorial.net/wp-content/uploads/2018/03/chinook.zip" rel="noopener ugc nofollow" target="_blank">。关于 Chinook 数据库中数据的更多信息可以在</a><a class="ae ky" href="https://www.sqlitetutorial.net/sqlite-sample-database/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="7003" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">感谢您的阅读！如果你有问题或者想讲一个 SQL 笑话，请在评论中告诉我。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/26db1b0794cfaa95eefbce61779332d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6X_bAI-NZPbFzIXt.jpg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@medienstuermer" rel="noopener ugc nofollow" target="_blank">医学家</a>在 Unsplash 上拍摄的照片</p></figure></div></div>    
</body>
</html>