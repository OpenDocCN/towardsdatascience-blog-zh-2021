<html>
<head>
<title>Database Indexing Anti-Patterns</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据库索引反模式</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/database-indexing-anti-patterns-dccb1b8ecef?source=collection_archive---------11-----------------------#2021-12-18">https://towardsdatascience.com/database-indexing-anti-patterns-dccb1b8ecef?source=collection_archive---------11-----------------------#2021-12-18</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><figure class="it iu gq gs iv iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj is"><img src="../Images/b4f7f5f03ea34c31c8086571316fd59f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sm5RHZoXeXbzYmPPpcW3-w.jpeg"/></div></div><p class="jd je gk gi gj jf jg bd b be z dk translated">由<a class="ae jh" href="https://unsplash.com/@urielsc26?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">乌列尔 SC </a>在<a class="ae jh" href="https://unsplash.com/s/photos/database?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h2 id="2305" class="ji jj jk bd b dl jl jm jn jo jp jq dk jr translated" aria-label="kicker paragraph">数据工程</h2><div class=""/><div class=""><h2 id="c377" class="pw-subtitle-paragraph kq jt jk bd b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dk translated">数据库索引的设计和实现通常会出现什么问题</h2></div><h1 id="906d" class="li lj jk bd lk ll lm ln lo lp lq lr ls kz lt la lu lc lv ld lw lf lx lg ly lz bi translated">介绍</h1><p id="f1fd" class="pw-post-body-paragraph ma mb jk mc b md me ku mf mg mh kx mi mj mk ml mm mn mo mp mq mr ms mt mu mv in bi translated">索引设计是使用数据库时最重要的事情之一。有效的索引设计会对数据库性能产生巨大的影响。设计良好的索引可以让你的数据库超级快速高效。设计糟糕的索引会让你的数据库很糟糕，很慢，会让你付出很大的代价。在本文中，我们将讨论一些新手犯的错误以及一些常见的索引设计反模式。考虑索引的方法是将它们视为指向原始表的表的部分、重新排列的副本。为什么是局部的，为什么是重新排列的？先来回答这两个问题。</p><p id="bc46" class="pw-post-body-paragraph ma mb jk mc b md mw ku mf mg mx kx mi mj my ml mm mn mz mp mq mr na mt mu mv in bi translated">在构建产品时，我们需要确保用户体验是最好的。为了让用户获得最佳体验，软件需要很快。想象一下，如果你的亚马逊或网飞页面每次更换过滤器都要花 5 秒钟。这不会给你作为买家注入太多的信心。</p><p id="8e36" class="pw-post-body-paragraph ma mb jk mc b md mw ku mf mg mx kx mi mj my ml mm mn mz mp mq mr na mt mu mv in bi translated">应用程序不仅仅需要有很大的写吞吐量；他们还需要非常快的读取吞吐量。在一系列数据访问模式中，读取吞吐量应该或多或少是一致的。我们原始表的设计和定义可能不足以处理这种数据访问模式。为了解决这个问题，我们在表中引入了索引、分区或者两者的组合。现在让我们只讨论索引。</p><blockquote class="nb"><p id="30f7" class="nc nd jk bd ne nf ng nh ni nj nk mv dk translated"><em class="nl">在我们将数据存储到数据库中之后，我们还需要对数据进行重新排列，以便能够快速获取数据。</em></p></blockquote><p id="796e" class="pw-post-body-paragraph ma mb jk mc b md nm ku mf mg nn kx mi mj no ml mm mn np mp mq mr nq mt mu mv in bi translated">虽然您知道通过创建索引，您可以迎合不同的数据访问模式来加快应用程序的速度，但是如果您没有充分考虑应该设计索引以获得最佳效果的不同方面，您可能会最终陷入索引地狱。性能增强实际上会成为性能杀手和成本膨胀者。记住这一点，让我们看看在数据库中创建和维护索引时一些常见的反模式。</p><h1 id="77bb" class="li lj jk bd lk ll lm ln lo lp lq lr ls kz lt la lu lc lv ld lw lf lx lg ly lz bi translated">反模式</h1><h2 id="3aa4" class="nr lj jk bd lk ns nt dn lo nu nv dp ls mj nw nx lu mn ny nz lw mr oa ob ly jq bi translated">指数混沌</h2><p id="b371" class="pw-post-body-paragraph ma mb jk mc b md me ku mf mg mh kx mi mj mk ml mm mn mo mp mq mr ms mt mu mv in bi translated">当您创建各种随机索引而没有检查哪些索引已经存在、哪些索引已经被使用等等时，就会发生这种情况。创建和维护索引是一件成本高昂的事情。每个新的索引都会给 SQL 优化器带来额外的负载，占用更多的空间，甚至会降低写入速度，而不一定会提高读取速度。</p><p id="a051" class="pw-post-body-paragraph ma mb jk mc b md mw ku mf mg mx kx mi mj my ml mm mn mz mp mq mr na mt mu mv in bi translated">为了防止自己陷入这种混乱状态，你需要创建索引，记住一个简单的原则。创建尽可能少的索引来覆盖大多数查询。在创建索引之前，看看是否可以重新利用现有的索引来满足额外的查询。</p><p id="c96b" class="pw-post-body-paragraph ma mb jk mc b md mw ku mf mg mx kx mi mj my ml mm mn mz mp mq mr na mt mu mv in bi translated">索引的内部实现因数据库而异。因此，在修改索引之前，总是在 dev 中测试对覆盖索引的更改，以确保任何更改都不会影响该索引所覆盖的现有查询。</p><h2 id="c5c7" class="nr lj jk bd lk ns nt dn lo nu nv dp ls mj nw nx lu mn ny nz lw mr oa ob ly jq bi translated">不可用的索引</h2><p id="480e" class="pw-post-body-paragraph ma mb jk mc b md me ku mf mg mh kx mi mj mk ml mm mn mo mp mq mr ms mt mu mv in bi translated">由于与数据类型、排序规则、字符集等相关的一些特定于数据库的问题，一些数据库索引不可用或保持未使用状态。有时，您可以通过显式地强制优化器使用索引来使索引工作。</p><p id="60d4" class="pw-post-body-paragraph ma mb jk mc b md mw ku mf mg mx kx mi mj my ml mm mn mz mp mq mr na mt mu mv in bi translated">如果你不注意这些问题并解决它们，你的索引将永远不会被使用，即使你的查询被设计来使用它们。所有这些都给优化器和数据库服务器带来了压力，让它们不断更新索引。</p><div class="it iu gq gs iv oc"><a href="https://www.mongodb.com/developer/article/schema-design-anti-pattern-unnecessary-indexes/" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fp"><div class="oe ab of cl cj og"><h2 class="bd ju gz z fq oh fs ft oi fv fx jt bi translated">MongoDB 模式设计反模式:不必要的索引</h2><div class="oj l"><h3 class="bd b gz z fq oh fs ft oi fv fx dk translated">到目前为止，在 MongoDB 模式设计反模式系列中，我们已经讨论了如何避免大规模数组以及大规模…</h3></div><div class="ok l"><p class="bd b dl z fq oh fs ft oi fv fx dk translated">www.mongodb.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq jb oc"/></div></div></a></div><h2 id="9f57" class="nr lj jk bd lk ns nt dn lo nu nv dp ls mj nw nx lu mn ny nz lw mr oa ob ly jq bi translated">陈旧索引</h2><p id="5dce" class="pw-post-body-paragraph ma mb jk mc b md me ku mf mg mh kx mi mj mk ml mm mn mo mp mq mr ms mt mu mv in bi translated">任何一段代码都有保质期。它是不断变化的。查询随着业务需求的变化而变化。当查询发生变化时，一些最初为这些查询设计的索引现在可能完全不相关了。理想情况下，这些索引要么应该重新调整用途以满足不同的查询集，要么应该被删除。</p><p id="d83e" class="pw-post-body-paragraph ma mb jk mc b md mw ku mf mg mx kx mi mj my ml mm mn mz mp mq mr na mt mu mv in bi translated">然而，有时人们会将这些索引留在原处，要么是希望将来会用到它们，要么是忘记删除它们。这就是自动化陈旧索引删除过程非常重要的原因。优化器通过引用数据库服务器维护的统计信息来使用索引。统计数据可以指导我们找出一个索引是否被使用。如果不是，我们可以简单地编写一个存储过程来删除索引。</p><p id="4d00" class="pw-post-body-paragraph ma mb jk mc b md mw ku mf mg mx kx mi mj my ml mm mn mz mp mq mr na mt mu mv in bi translated">如果没有正确测试，从生产中删除索引可能会有问题。因此，消除这些索引的另一种方法是发送一封电子邮件或一个 Slack 通知，让您通过手动触发气流作业或类似的方式删除过时索引列表。</p><h2 id="462e" class="nr lj jk bd lk ns nt dn lo nu nv dp ls mj nw nx lu mn ny nz lw mr oa ob ly jq bi translated">错误的索引类型</h2><p id="7242" class="pw-post-body-paragraph ma mb jk mc b md me ku mf mg mh kx mi mj mk ml mm mn mo mp mq mr ms mt mu mv in bi translated">虽然这不是一个经常出现的问题，但是留心它是有好处的。一些数据库提供了各种类型的索引，您可以根据自己的读取访问模式创建这些索引。大多数关系数据库现在都支持全文索引。</p><p id="28ce" class="pw-post-body-paragraph ma mb jk mc b md mw ku mf mg mx kx mi mj my ml mm mn mz mp mq mr na mt mu mv in bi translated">现在，如果您没有执行全文搜索的用例，并且您的用例只需要正则表达式搜索，那么您最好拥有一个简单的索引。全文索引的开销要大得多，因为它们占用的空间要大得多，更新起来也要花更多的时间。</p><h2 id="75f4" class="nr lj jk bd lk ns nt dn lo nu nv dp ls mj nw nx lu mn ny nz lw mr oa ob ly jq bi translated">庞大的指数</h2><p id="eda4" class="pw-post-body-paragraph ma mb jk mc b md me ku mf mg mh kx mi mj mk ml mm mn mo mp mq mr ms mt mu mv in bi translated">拥有数十亿行和许多列的表上的巨大索引确实很难管理。它们也可能非常慢。这就是您可以使用分区这一美丽概念的地方——本质上是将表分成许多部分，并使用一种称为分区修剪的现象来查询您绝对、最肯定需要的分区。一旦删除了不需要的分区，表中就只剩下小块的索引，即更小的索引、更少的管理开销、更快的索引查找。在我不久前写的这篇文章中可以读到更多的相关内容。</p><div class="it iu gq gs iv oc"><a rel="noopener follow" target="_blank" href="/indexing-very-large-tables-569811421ee0"><div class="od ab fp"><div class="oe ab of cl cj og"><h2 class="bd ju gz z fq oh fs ft oi fv fx jt bi translated">索引非常大的表</h2><div class="oj l"><h3 class="bd b gz z fq oh fs ft oi fv fx dk translated">关于索引大型表的最佳实践以及如何使用分区来减轻负载的简短指南…</h3></div><div class="ok l"><p class="bd b dl z fq oh fs ft oi fv fx dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="or l on oo op ol oq jb oc"/></div></div></a></div><h1 id="9aa5" class="li lj jk bd lk ll lm ln lo lp lq lr ls kz lt la lu lc lv ld lw lf lx lg ly lz bi translated">结论</h1><p id="c608" class="pw-post-body-paragraph ma mb jk mc b md me ku mf mg mh kx mi mj mk ml mm mn mo mp mq mr ms mt mu mv in bi translated">编写软件是一项协作工作，编写数据库模型、查询、管道和支持软件。开发数据库时的协作极其重要。数据库会很快成为瓶颈，即使对于性能最好的软件也是如此。有效地协作，<a class="ae jh" href="https://medium.com/analytics-vidhya/indexing-best-practices-10025d779e0b" rel="noopener">遵循最佳实践</a>，并留意上面列出的一些反模式，你会没事的。</p><p id="842e" class="pw-post-body-paragraph ma mb jk mc b md mw ku mf mg mx kx mi mj my ml mm mn mz mp mq mr na mt mu mv in bi translated">如果你觉得我的文章有用，请订阅并查看我的文章🌲<a class="ae jh" href="https://towardsdatascience.com/linktree.com/kovid" rel="noopener" target="_blank"> <strong class="mc ju"> Linktree </strong> </a>。你也可以考虑用我的推荐链接购买一个中级会员来支持我。干杯！</p><div class="it iu gq gs iv oc"><a href="https://kovidrathee.medium.com/membership" rel="noopener follow" target="_blank"><div class="od ab fp"><div class="oe ab of cl cj og"><h2 class="bd ju gz z fq oh fs ft oi fv fx jt bi translated">通过我的推荐链接加入 Medium-Kovid Rathee</h2><div class="oj l"><h3 class="bd b gz z fq oh fs ft oi fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ok l"><p class="bd b dl z fq oh fs ft oi fv fx dk translated">kovidrathee.medium.com</p></div></div><div class="ol l"><div class="os l on oo op ol oq jb oc"/></div></div></a></div></div></div>    
</body>
</html>