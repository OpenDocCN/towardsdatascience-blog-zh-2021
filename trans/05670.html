<html>
<head>
<title>SQL — update into another table</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL —更新到另一个表中</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/sql-update-into-another-table-bfc3dff79a66?source=collection_archive---------20-----------------------#2021-05-20">https://towardsdatascience.com/sql-update-into-another-table-bfc3dff79a66?source=collection_archive---------20-----------------------#2021-05-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2b90" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在一条语句中更新一个表中的记录，并将更新后的记录插入到另一个表中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b364a209888faba1959238417c3737c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lKjtODfWT2epuIYCC7zzNA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的桌子上有些工作要做(图片由<a class="ae ky" href="https://www.pexels.com/@mabelamber" rel="noopener ugc nofollow" target="_blank">梅布尔·安伯</a>在<a class="ae ky" href="https://www.pexels.com/photo/close-up-photography-of-red-and-white-road-signage-117602/" rel="noopener ugc nofollow" target="_blank">像素</a>上拍摄)</p></figure><p id="7566" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“我为什么需要这样的查询？”将<strong class="lb iu">更新为</strong>语句是有利的，主要有两个原因:</p><ul class=""><li id="daf5" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">语句是<a class="ae ky" href="https://en.wikipedia.org/wiki/Atomicity_(database_systems)" rel="noopener ugc nofollow" target="_blank">原子</a>；要么两者都发生，要么什么都不发生，即如果更新或插入失败，它将回滚更改。</li><li id="3116" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">它更便宜:你的数据库只需要查找一次记录。或者，执行单独的插入和删除需要两次查找</li><li id="10a7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">吹牛的权利:给你的老板和同事留下深刻印象</li></ul><p id="1d91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">深信不疑？“给我看一些代码！”。好的，但是首先我们必须设置一些表来演示查询。让我们编码:</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="11d0" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">设置:创建一些包含数据的表</h1><p id="5d58" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">想象一下，我们有一个有很多文章的新闻网站。如果用户注意到某篇文章中有拼写错误，他/她可以通过网站提交错误。这些错误存储在一个名为SpellingErrors的表中。我们将存储包含错误的文章的Id，以及消息和报告者的电子邮件地址。我们存储了电子邮件地址，以便联系记者提问。</p><p id="6a2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们的作者之一修复拼写错误，我们更新记录设置电子邮件地址为空；我们不再需要它，我们想保证记者的隐私。此外，我们想保留一些关于错误的信息，这样我们就可以可怕地惩罚犯了很多错误的作者。为此，我们将一些数据存储到一个名为SpellingErrorsHistory的表中。让我们首先创建表并插入一些错误。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用一些记录创建我们的表</p></figure><p id="62ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行这些查询。如果您从拼写错误表中选择，您将看到以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/3c0de4754de5e153221c47a3f7313d88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Rxf9mYiwAAI2c7AKF2vzg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的拼写错误表</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="d1e5" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">执行我们的查询</h1><p id="b85f" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">让我们开始创建查询吧！让我们来看看这个查询，然后解释它在做什么。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="a606" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的一个作者已经修复了Id为1的错误。我们将把它存储在一个名为@targetId的变量中。然后，我们更新SpellingErrors表并将ReporterEmail设置为NULL，其中Id等于@targetId (1)。使用输出，我们可以访问已经从SpellingsErrors表中更新的列。我们将一些列以及一个额外的列(SolvedMessage)输出到SpellingErrorsHistory表中。还要注意，我们没有在这个表中保存用户的电子邮件数据。</p><p id="b292" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">恭喜你，你成功了！这是一个简单、安全的查询，允许您同时执行两个查询。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="2c4d" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">结论</h1><p id="103b" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">使用这个查询，我们可以执行原子操作，更新一个表中的记录，同时将这些更新的记录插入到另一个表中。另请查看:</p><ul class=""><li id="d88a" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/sql-delete-into-another-table-b5b946a42299" rel="noopener">删除到另一个表中</a></li><li id="e278" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/sql-rolling-back-statements-with-transactions-81937811e7a7?" rel="noopener">使用交易撤销查询</a></li><li id="c5c4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/sql-insert-delete-and-update-in-one-statement-sync-your-tables-with-merge-14814215d32c" rel="noopener">在一条语句中插入、删除和更新</a></li><li id="353d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/sql-update-select-in-one-query-b067a7e60136" rel="noopener">更新选择一批记录</a></li><li id="6263" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://mikehuls.medium.com/version-control-your-database-part-1-creating-migrations-and-seeding-992d86c90170" rel="noopener">版本控制你的数据库</a></li></ul><p id="dea2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！</p><p id="928e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">—迈克</p><p id="4f96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">页（page的缩写）学生:比如我正在做的事情？<a class="ae ky" href="https://mikehuls.medium.com/" rel="noopener">跟我来</a>！</p></div></div>    
</body>
</html>