<html>
<head>
<title>5 Examples to Explain SQL Versions of Pandas Operations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">5个例子来解释Pandas操作的SQL版本</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/5-examples-to-explain-sql-versions-of-pandas-operations-113f7afde249?source=collection_archive---------35-----------------------#2021-06-06">https://towardsdatascience.com/5-examples-to-explain-sql-versions-of-pandas-operations-113f7afde249?source=collection_archive---------35-----------------------#2021-06-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6f10" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">SQL不仅仅是一种查询语言</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7c0db19c3163d91344605e91b97d1f4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9X5M-_U3JbdF0iuCpJAdpQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/s/photos/similar?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@jannerboy62?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">尼克·费因斯</a>拍摄</p></figure><p id="f899" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL代表结构化查询语言。然而，它提供的不仅仅是从关系数据库中检索数据的查询。我认为SQL是一个完整的数据分析和操作工具。</p><p id="bf31" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据科学生态系统中最受欢迎的数据分析工具之一是Pandas Python库。SQL可以执行几乎任何你可以用Pandas做的操作。</p><p id="61a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将通过5个例子来演示Pandas操作的SQL版本。示例将包括数据操作和分析任务。</p><p id="3610" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将做一些超越非常简单的任务的例子，因为我想强调SQL是如何被用作数据分析工具的。</p><p id="f472" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用Kaggle上的墨尔本房产<a class="ae ky" href="https://www.kaggle.com/anthonypino/melbourne-housing-market" rel="noopener ugc nofollow" target="_blank">数据集</a>。我之前已经下载了数据集，并创建了一个包含其中一些列的SQL表。</p><p id="c6bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们先来看看这张表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/60519ce537d34b0f30224ecf293a38f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8bPJZwwvbYFVLjGyXdrUmw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="2498" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注</strong>:关系数据库管理系统有MySQL、SQL Server、PostgreSQL等几种。尽管它们大多采用相同的SQL语法，但可能会有一些细微的差别。在本文中，我们将使用PostgreSQL。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="49e3" class="md me it bd mf mg mh dn mi mj mk dp ml li mm mn mo lm mp mq mr lq ms mt mu mv bi translated">示例1</h2><p id="e7cf" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">第一个例子是关于日期操作的。在某些情况下，我们需要从某个日期提取特定的信息，比如月份和年份。</p><p id="6c04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Pandas中，可以使用dt访问器下的month方法从日期中提取月份信息。</p><p id="3e03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以对SQL进行同样的操作，如下所示:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="5fb3" class="md me it nc b gy ng nh l ni nj">SELECT date, EXTRACT(month from date) AS month FROM melb LIMIT 5;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/ba1741599f906878423da55e55d06ada.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*se5P5HmNnz8H1YgWRSQGyg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="bda0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用extract函数，该函数可用于从一个日期获取多条信息。例如，可以通过将提取函数中的“月”参数替换为“年”来提取年。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="8036" class="md me it bd mf mg mh dn mi mj mk dp ml li mm mn mo lm mp mq mr lq ms mt mu mv bi translated">示例2</h2><p id="b0af" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">第二个例子是关于字符串操作的。在数据分析中，这是一项非常常见的任务，因为大量数据都是文本形式的。</p><p id="0529" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">典型的操作是拆分字符串。Pandas在str访问器下为这个任务提供了split函数。在PostgreSQL中，split_part函数可以用来拆分字符串。</p><p id="696d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建一个新列，它包含region name列中的第一个单词。它可以用作区域组。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="6930" class="md me it nc b gy ng nh l ni nj">SELECT <br/> regionname, <br/> SPLIT_PART(regionname,' ', 1) AS regiongroup <br/>FROM  melb LIMIT 5;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/df715eaa1f1a015a5e2ba3844cbf93bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TxDnKTGU9mhHjITX7jghZw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="7c0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">limit关键字仅用于限制要显示的行数。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="cc07" class="md me it bd mf mg mh dn mi mj mk dp ml li mm mn mo lm mp mq mr lq ms mt mu mv bi translated">示例3</h2><p id="6c12" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">在这个例子中，我们将复制熊猫的value_counts函数。它用于计算一列中不同值的出现次数。在我们的例子中，我们可以找到每个地区的房屋数量。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="21d7" class="md me it nc b gy ng nh l ni nj">SELECT regionname, count(1) AS house_count<br/>FROM melb<br/>GROUP BY regionname<br/>ORDER BY house_count desc;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/a2cfb21fc4c3b23ae98e4d9217d51a60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3M0FokHZhY5z-XmwoAuvUQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="9ef7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用group by函数根据region name列中的不同值对观察值(即行)进行分组。然后，count函数用于计算每个区域的行数。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="c48b" class="md me it bd mf mg mh dn mi mj mk dp ml li mm mn mo lm mp mq mr lq ms mt mu mv bi translated">实例4</h2><p id="e567" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">在这个例子中，我们将在查询中实现一个if-else语句。假设我们想根据房屋到中心商业区的距离对它们进行分类。我们可以使用case when函数来完成这项任务。</p><p id="b8e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从该表中检索数据时，我们将创建一个名为“距离类型”的新列。它所取的值将基于距离列。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="b7c2" class="md me it nc b gy ng nh l ni nj">SELECT <br/>   distance,                                                                                                                    <br/>   CASE WHEN distance &gt; 20 THEN 'far'                                                                                                             <br/>        WHEN distance &lt;= 20 and distance &gt; 10 THEN 'medium'                                                                                          <br/>        ELSE 'close'                                                                                                                                <br/>        END AS distancetype                                                                                                                         FROM melb                                                                                                                                   LIMIT 5;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/eef2d2343458f280fdf40a047da6abff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iz6Dd1mVnY9WfuWRz3ZtMg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="fe85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">前5行具有相同的距离。为了确认功能按预期工作的情况，我们可以检查每种距离类型的最大距离。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="3550" class="md me it nc b gy ng nh l ni nj">SELECT <br/>   MAX(distance),                                                                                                                    <br/>   CASE WHEN distance &gt; 20 THEN 'far'                                                                                                             <br/>        WHEN distance &lt;= 20 and distance &gt; 10 THEN 'medium'                                                                                          <br/>        ELSE 'close'                                                                                                                                <br/>        END AS distancetype                                                                                                                         FROM melb                                                                                                                                   GROUP BY distancetype;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/21e757de5731db85ecf148297aa169fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NYE72P99L3By-8qiszaWvg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="9653" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用Pandas中的剪切功能来完成这项任务。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="7810" class="md me it bd mf mg mh dn mi mj mk dp ml li mm mn mo lm mp mq mr lq ms mt mu mv bi translated">实例5</h2><p id="b098" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">最后一个例子是关于一个最常用的Pandas函数，groupby。我们使用它来根据不同列中的值比较一列中的不同值或类别。</p><p id="2046" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL为此任务提供了group by语句。就像熊猫一样，我们可以用SQL创建嵌套组。我们只需要传递用于分组的列名。</p><p id="3aa8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦创建了组，我们就可以对感兴趣的列应用聚合函数。</p><p id="a3da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们根据“类型”和“房间”栏中的类别对房屋进行分组。然后，我们可以为每个类别计算以下值:</p><ul class=""><li id="b085" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated">最高价</li><li id="7963" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">平均距离</li><li id="d285" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">该组中的房屋数量</li></ul><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="f3fe" class="md me it nc b gy ng nh l ni nj">SELECT <br/>   type, <br/>   rooms,                                                                                                                 <br/>   max(price/1000000) as max_price,                                                                                                            <br/>   cast(avg(distance) as decimal(5,2)) as avg_distance,                                                                                        <br/>   count(1) as house_count                                                                                                                     FROM melb                                                                                                                                   WHERE rooms &lt;= 4                                                                                                                            GROUP BY type, rooms<br/>ORDER BY type, rooms;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/1b8e6271efcb86cfcaa9acc39d3b1aa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*azKO6o4DrbyY9T-3QgkqaQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="fc02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了简化结果集，我只包含了拥有4个或更少房间的房屋。结果按“类型”和“房间”列排序。</p><p id="632d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行此任务的Pandas代码如下:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="0e8d" class="md me it nc b gy ng nh l ni nj">melb[melb.Rooms &lt;= 4]\<br/>   .groupby(["Type", "Rooms"], as_index=False).agg(<br/>      max_price = ("Price", "max"),<br/>      avg_distance = ("Distance", "mean"),<br/>      house_count = ("Distance", "count")<br/>   ).sort_values(by=["Type","Rooms"])</span></pre></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="d84b" class="md me it bd mf mg mh dn mi mj mk dp ml li mm mn mo lm mp mq mr lq ms mt mu mv bi translated">结论</h2><p id="6de1" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">SQL是数据科学家的必备技能。虽然它被称为查询语言，但它提供的不仅仅是检索数据。使用SQL可以完成几乎所有典型的数据分析和操作任务。</p><p id="d498" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>