<html>
<head>
<title>MLOps: Keep a check on your AI/ML Model Predictions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">保持检查你的人工智能/人工智能模型预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/mlops-model-monitoring-prior-probability-shift-f64abfa03d9a?source=collection_archive---------22-----------------------#2021-04-10">https://towardsdatascience.com/mlops-model-monitoring-prior-probability-shift-f64abfa03d9a?source=collection_archive---------22-----------------------#2021-04-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3597" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">模型监控指标确保生产化的人工智能模型按预期执行。先验概率转移是一种现象，当在模型预测中检测到时，表明模型已经变得陈旧。</h2></div><p id="592d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由<a class="ae lb" href="https://www.linkedin.com/in/pronojitsaha/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir">普罗诺吉</strong> </a> <strong class="kh ir"> </strong>和<strong class="kh ir"> </strong> <a class="ae lb" href="https://www.linkedin.com/in/arnab-bose-phd-6369531/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir">阿纳博士</strong> </a></p><h1 id="919d" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">背景</h1><p id="74b1" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">在我们的<strong class="kh ir"> MLOps模型监控系列</strong> <a class="ae lb" rel="noopener" target="_blank" href="/mlops-model-monitoring-101-46de6a578e03">的第一篇文章中，我们探讨了使用模型监控框架背后的动机。在人工智能系统中，它在完成从模型部署到模型构建的基本反馈循环中起着非常重要的作用。这进一步确保了生产化的模型保持了在模型训练阶段所承诺的性能水平。此外，我们定义了三大类指标(即稳定性指标、性能指标&amp;运营指标),我们可以跟踪这些指标来实现相同的目标。向前发展，稳定性度量可以进一步分为两个主要的子类型，即用于检测先验概率偏移的稳定性度量类别I和用于检测协变量偏移的稳定性度量类别II。在本文中，我们将讨论稳定性度量类别I，并深入探讨它的工作方式。我们将在本系列的后续文章中研究其他指标。</a></p><h1 id="f9d3" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">先验概率转移</h1><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/f73947d611918132b0e9b77c5bcedee2.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*tfngX6JsesH8Z_ce6VQkeA.png"/></div><p class="mh mi gj gh gi mj mk bd b be z dk translated">图1:在人工智能系统监控的三个主要方面中，即数据、模型和预测，稳定性度量类别I监控人工智能系统的预测输出，以检测先验概率变化。(图片来自<a class="ae lb" href="http://aif360.mybluemix.net/" rel="noopener ugc nofollow" target="_blank">aif360.mybluemix.net</a>)</p></figure><p id="5ed5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">先验概率偏移捕捉训练数据和生产数据之间或者生产数据的不同时间范围之间的预测输出<strong class="kh ir"> </strong>的分布偏移(要了解关于这些时间范围的更多信息，请查阅本系列的第一篇文章)。在贝叶斯统计推断[2]中，不确定变量(预测产量)的先验概率分布是在考虑一些证据(新的生产数据)之前表达个人对该变量的信念的概率分布。因此，潜在的假设是，训练时预测输出的分布(即先验概率)不应在生产过程中发生显著变化(即有新的证据)。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/48aca3e3320297ada0f4926dbb85e085.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*M3pv7GpxGNisYd10tZ4w3Q.png"/></div><p class="mh mi gj gh gi mj mk bd b be z dk translated">图2:训练和生产数据之间的先验概率转移。预测输出类别的分布在培训和生产之间有很大的不同。(图片由作者提供)</p></figure><p id="69dc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设在贷款违约数据集中，训练数据具有相等的贷款违约的先验概率(即，贷款违约的概率是0.5)。因此，我们预计50%的训练集包含贷款违约者，50%包含良好贷款。然而，在现实中，只有5%的贷款可能违约，然后贷款违约变量的先验概率发生了变化。数学上，我们可以将其表示为</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/a9df466aba931ee2652ae5738e4a732b.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*ij3_O060Sck4wDC2n7y64Q.png"/></div></figure><h1 id="0b6b" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">稳定性度量标准类型I</h1><p id="8bee" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">稳定性度量标准类型I帮助我们检测先验概率变化。它由两个主要KPI组成，即群体稳定性指数(PSI)和分化指数(DI)。</p><h1 id="e683" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">1.人口稳定指数</h1><p id="44d3" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">群体稳定性指数(PSI)比较两个数据集(训练和生产)的预测概率(分类)或连续预测输出(回归)的分布。因此，它有助于评估先验概率(即训练期间的预测产量分布)是否随着生产期间新数据的流入而发生了显著变化(新证据)。</p><p id="edde" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">计算PSI的步骤如下。这里，为了便于理解，我们考虑了训练数据和生产数据之间的比较(本系列第一篇文章中的场景I<a class="ae lb" rel="noopener" target="_blank" href="/mlops-model-monitoring-101-46de6a578e03">这里</a>)。但是这可以很好地应用于比较不同时间的两个生产数据实例(第一篇文章中的场景II)。</p><ol class=""><li id="617e" class="mn mo iq kh b ki kj kl km ko mp ks mq kw mr la ms mt mu mv bi translated">按降序对训练数据集预测概率进行排序</li><li id="1424" class="mn mo iq kh b ki mw kl mx ko my ks mz kw na la ms mt mu mv bi translated">将预测的概率分成10个桶(十分位数)</li><li id="42a7" class="mn mo iq kh b ki mw kl mx ko my ks mz kw na la ms mt mu mv bi translated">对于步骤(2)中形成的每个桶，找到概率值的最小值和最大值，即训练数据集中每个桶的分界点</li><li id="88b7" class="mn mo iq kh b ki mw kl mx ko my ks mz kw na la ms mt mu mv bi translated">计算落入每个这样的桶中的观察值的百分比(下表I中的预期百分比)</li><li id="da39" class="mn mo iq kh b ki mw kl mx ko my ks mz kw na la ms mt mu mv bi translated">根据生产数据集中10个时段的概率分界点，计算生产数据集中每个时段的观测值百分比(下表I中的实际百分比)</li><li id="c7cc" class="mn mo iq kh b ki mw kl mx ko my ks mz kw na la ms mt mu mv bi translated">最后，根据下面的公式计算PSI。</li></ol><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/4e8d975b30285d76962f869d436a27a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*mjkSbiSIkaHBFiugedN2wg.png"/></div></figure><p id="7b7b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的例子是在分类问题设置中使用预测概率。在回归的情况下，边界值将是输出预测值的连续值桶。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/16c833e388aff382a4d609ce727286dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DXsmSY-rLrqIN5-W0IdIVg.png"/></div></div><p class="mh mi gj gh gi mj mk bd b be z dk translated">表一:人口稳定指数计算</p></figure><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/64edb54c012ebf3d39b7bbf65ae396ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*bOgv0wCpYO8Na92Ao5_YxA.png"/></div><p class="mh mi gj gh gi mj mk bd b be z dk translated">图3:分类问题中的PSI。从训练数据到生产数据的预测输出概率分布变化。我们得到PSI = 0.12，从而在预测输出中捕捉到这一微小的先验概率变化。(图片由作者提供)</p></figure><h2 id="6acd" class="ni ld iq bd le nj nk dn li nl nm dp lm ko nn no lo ks np nq lq kw nr ns ls nt bi translated"><strong class="ak">如何作用于PSI值？</strong></h2><p id="b1f5" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">根据经验，以下是PSI的几个决策值点。</p><ol class=""><li id="db3a" class="mn mo iq kh b ki kj kl km ko mp ks mq kw mr la ms mt mu mv bi translated">如果PSI &lt; 0.1 then there is not much prior probability shift in the predicted output and no change is required in the existing production model.</li><li id="6202" class="mn mo iq kh b ki mw kl mx ko my ks mz kw na la ms mt mu mv bi translated">However, if PSI &gt; =0.1且&lt;0.2 then slight change may be required in the production model and it’s best to review some of the other KPIs as well to make a decision.</li><li id="e2ef" class="mn mo iq kh b ki mw kl mx ko my ks mz kw na la ms mt mu mv bi translated">If PSI&gt; =0.2，则在预测输出中检测到显著的先验概率偏移，应根据最新数据重新训练生产模型。</li></ol><p id="ce72" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于什么是合适的决策点的进一步讨论可以从Bilal Yurdakul的作品中得到[1]</p><h1 id="68e4" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">2.分歧指数</h1><p id="5ed2" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">差异指数(DI)比较两个数据集(训练和生产)之间输出的聚合统计数据。与PSI一样，DI也有助于评估先验概率(即培训期间的输出分布)是否在生产中发生了显著变化。但是DI是在总体水平上这样做的，并且使用实际的输出值(地面实况)而不是预测的输出。因此，DI的一个限制是，由于采集生产数据地面实况可能会延迟或不总是可用，因此可能不总是能够进行计算。计算DI的步骤如下。</p><p id="f734" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于分类问题，我们计算训练数据集和生产数据集上的实际类别分布(对于每个类别)。我们确定预测类变量中唯一级别的数量，然后计算每个级别的交集并除以它们的并集。例如，如果训练数据集中的给定类变量有三个唯一级别，即良好、非常好和优秀，而生产数据集中有五个唯一级别，即差、一般、良好、非常好和优秀，则DI将计算为:</p><ol class=""><li id="f683" class="mn mo iq kh b ki kj kl km ko mp ks mq kw mr la ms mt mu mv bi translated">DI = 1-(培训和生产中的普通级别/培训和生产中的级别的联合)= 1-(3/5) = 0.4</li><li id="0522" class="mn mo iq kh b ki mw kl mx ko my ks mz kw na la ms mt mu mv bi translated">此外，在没有添加新水平的情况下，DI = 0，而对于两个数据集中完全不同的水平，DI = 1。</li></ol><p id="6c1c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于回归问题，我们简单地计算两个数据集之间的连续值输出的平均值的百分比变化。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/6ac2ab7d5c291f0a24cb40a4e31357e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*K1PieB9NMt4Je5A9aStPoQ.png"/></div><p class="mh mi gj gh gi mj mk bd b be z dk translated">图4:分类问题中的DI。生产数据有一个新类(黄色)，该类在培训数据中不存在。因此，DI = 1-(2/3) = 0.33，这捕获了预测输出类别中的先验概率变化。(图片由作者提供)</p></figure><h2 id="d407" class="ni ld iq bd le nj nk dn li nl nm dp lm ko nn no lo ks np nq lq kw nr ns ls nt bi translated"><strong class="ak">如何作用于DI值？</strong></h2><p id="201c" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">前面针对PSI提到的相同的经验法则也可以用于DI，以检测预测输出中的先验概率偏移的存在，并且因此可以采取模型再训练决策。</p><h1 id="be34" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">结论</h1><p id="cd42" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">机器学习模型预测提供洞察力并定义可操作性。监控模型以保持预测的有效性和相关性是至关重要的。第一类稳定性指标，如PSI和DI，通过检测模型预测中的先验概率变化来帮助我们做到这一点。这些指标是人工智能系统中重要的监控工具。</p><h1 id="cd57" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">参考</h1><ol class=""><li id="671c" class="mn mo iq kh b ki lu kl lv ko nv ks nw kw nx la ms mt mu mv bi translated">Bilal Yurdakul，<a class="ae lb" href="https://scholarworks.wmich.edu/cgi/viewcontent.cgi?article=4249&amp;context=dissertations" rel="noopener ugc nofollow" target="_blank">人口稳定指数的统计特性</a> (2018)，WMU的ScholarWorks</li><li id="121f" class="mn mo iq kh b ki mw kl mx ko my ks mz kw na la ms mt mu mv bi translated">约翰·克鲁施克等人，<a class="ae lb" href="https://link.springer.com/article/10.3758/s13423-017-1272-1" rel="noopener ugc nofollow" target="_blank">新人贝叶斯数据分析</a> (2017)，施普林格</li></ol></div></div>    
</body>
</html>