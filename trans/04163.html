<html>
<head>
<title>How I Built a Data Discovery API for AWS Data Lake</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何为AWS数据湖构建数据发现API</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-i-built-a-data-discovery-api-for-aws-data-lake-5d2813f794bf?source=collection_archive---------15-----------------------#2021-04-08">https://towardsdatascience.com/how-i-built-a-data-discovery-api-for-aws-data-lake-5d2813f794bf?source=collection_archive---------15-----------------------#2021-04-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="46b0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这个简单的FastAPI服务将帮助您在数据湖中找到数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e6bf0c447482a0b03b6dbee9c44d0eb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Cfc_ZIOPedz5_n9i"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@enka80?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> nine koepfer </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a> | <a class="ae ky" href="https://www.annageller.com/disclosure" rel="noopener ugc nofollow" target="_blank">品牌内容披露</a>上拍摄</p></figure><p id="046a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated">阿塔湖提供了无数的好处。它们是数据不可知的，不需要你预先定义一个模式。但是，如果没有合适的结构，找到您需要的数据可能会很困难。在本文中，我们将通过创建一个FastAPI抽象来解决这个问题，它允许我们查询AWS Glue元数据目录。</p><p id="5158" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">目录</strong></p><p id="0b9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="#0d4d" rel="noopener ugc nofollow">为什么FastAPI用于数据发现服务？</a> <br/> <a class="ae ky" href="#f107" rel="noopener ugc nofollow">我们如何开始？</a> <br/> <a class="ae ky" href="#1d89" rel="noopener ugc nofollow">怎么才能把这个翻译成Python代码？</a> <br/> <a class="ae ky" href="#aac7" rel="noopener ugc nofollow">实现:FastAPI MVP </a> <br/> <a class="ae ky" href="#a8c9" rel="noopener ugc nofollow">如何规模化服务这个API？</a><br/>∘<a class="ae ky" href="#f991" rel="noopener ugc nofollow">AWS lambda</a><br/>∘<a class="ae ky" href="#0715" rel="noopener ugc nofollow">API网关</a> <br/> ∘ <a class="ae ky" href="#dacf" rel="noopener ugc nofollow">让API安全可追踪</a> <br/> <a class="ae ky" href="#b746" rel="noopener ugc nofollow">我们如何监控我们的数据发现服务？</a><br/>T37】结论</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="0d4d" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">为什么FastAPI用于数据发现服务？</h1><p id="bbb3" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">如果我们将它实现为一个Python包，我们会假设每个人都知道足够多的Python来使用它。但是，您的公司可能有其他开发人员(Java、C#、JavaScript、Go等)需要访问数据湖中的数据。通过为数据发现构建一个REST-ful服务，你为每个人提供了一个<strong class="lb iu">与编程语言无关的</strong>接口。这种<strong class="lb iu"> API优先</strong>的方法还有进一步的<strong class="lb iu">好处</strong>:</p><ul class=""><li id="191d" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">如果您后来决定为业务用户构建一个<strong class="lb iu"> UI </strong>，您的任务将变得容易得多，因为您已经有了一个以JSON形式提供数据的REST API。</li><li id="f2eb" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">您可以在一个<strong class="lb iu">单一服务</strong>中组合用于此目的的所有功能。</li><li id="704d" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">如果您需要添加新的方法或更改现有的方法，您可以通过创建一个<strong class="lb iu">新的API版本</strong>(比如说，<code class="fe nw nx ny nz b">api_url/v3</code>)来更容易地部署<strong class="lb iu">更改</strong>，而不会破坏任何依赖于当前版本的工作负载。</li><li id="bff5" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">您可以<strong class="lb iu">扩展功能</strong>以包括实时数据流、非结构化数据，并允许查询访问日志以确定哪些数据最常被哪些用户使用。</li></ul></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="f107" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">我们如何开始？</h1><p id="55ac" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">我们可以从列出所有可能对数据发现有用的方法开始:</p><ul class=""><li id="91ce" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">列出所有数据库或<strong class="lb iu">模式</strong>，</li><li id="4e0e" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">列出特定模式的所有<strong class="lb iu">表</strong>,</li><li id="e4e5" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">过滤带有特定<strong class="lb iu">前缀</strong>或<strong class="lb iu">后缀</strong>的表名，</li><li id="5108" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">对表名进行<strong class="lb iu">全文搜索</strong>(比如，与<code class="fe nw nx ny nz b">orders</code>或<code class="fe nw nx ny nz b">customers</code>有关的所有表)，</li><li id="8d9d" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">对表注释进行<strong class="lb iu">全文搜索</strong>(例如，如果我们想找到任何与<em class="oa">物流</em>相关的栏目，</li><li id="6cb6" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">显示一个<strong class="lb iu">完整的表定义</strong> ( <em class="oa">所有列、数据类型和列注释</em>)，</li><li id="bf41" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">显示特定表的<strong class="lb iu">分区</strong>，</li><li id="5463" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">在特定分区下显示来自S3的所有文件，</li><li id="0a37" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">显示带有特定<strong class="lb iu">注释</strong>的所有列，</li><li id="2cef" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">显示包含特定<strong class="lb iu">列名</strong>的所有表格，</li><li id="875c" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">最后，数据发现的最佳方式是<strong class="lb iu">查看整个表的前X行</strong>。</li></ul></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="1d89" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">我们如何将这些翻译成Python代码呢？</h1><p id="34c5" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">我们有三个选择:要么使用低级别的AWS SDKs，在Athena的<code class="fe nw nx ny nz b">information_schema</code>上进行查询，要么利用<code class="fe nw nx ny nz b">awswrangler</code>。最后，我们可以将它们结合起来，以满足上一节的要求。</p><p id="1ce5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">#1.要列出所有数据库(<em class="oa">即模式</em>)和表格，我们可以使用<strong class="lb iu"> awswrangler </strong>包，尤其是模块<code class="fe nw nx ny nz b">wr.catalog</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/2dcfac98a45f20d1839b6b37776a3fb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cH9dunGB6Hw_QLsm515sWQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b2a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">#2.要过滤带有特定<strong class="lb iu">前缀</strong>或<strong class="lb iu">后缀</strong>的表名，我们也可以使用<code class="fe nw nx ny nz b">wr.catalog.tables</code>。检索<strong class="lb iu">表定义</strong>并对这些定义进行<strong class="lb iu">全文搜索</strong>也是如此:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/c4cbb09bd948b40d281e170bb48a26ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B8Vx74P53Ya1v32XseuHgg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="e269" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">#3.列出特定表的所有<strong class="lb iu">分区</strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/16e38c59abfd66cf0c8586650f0a47a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XNMLELRQngkMj7-3oMwM-A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="2fb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">#4.显示表格的DDL:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/62faa543897fc4b4256f34e9923426f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OeLOqR2dF-lXx9s69XWZqQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="27f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">#5.<strong class="lb iu">列出S3 </strong>目录<strong class="lb iu">路径</strong>或者根据文件类型显示具体对象(<em class="oa"> ex。拼花文件</em>)和最后修改日期:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/f7ac773f9ae69c8346e4c1bb47f5a11c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VdRsJdSX2dZVP-vsIYswkg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="2335" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">#6.查询<strong class="lb iu">列注释</strong>找到你需要的数据集:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/b1ac0da4552c31f95c2be2d6fc5e0f33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dD_DfXtR7MaavJdJEoNeOg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="ffc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">#7.描述雅典娜<strong class="lb iu">表定义</strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/daf03b85bf2ffa678041ba88a337e4cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HEfnDH9bxyEnCfhDQSXZ0Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a79e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">#8.搜索特定的<strong class="lb iu">列名</strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/03aceaf3f3b1d8aca4c3615b496d4679.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-5cRJnOz4PvJjZvEXcoKvQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="e15d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述方法构成了数据发现服务的基本MVP。它允许查询模式、表、列、列注释(<em class="oa">又名数据字典</em>)，显示数据预览，以及探索底层文件、目录和分区。</p><p id="e144" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过利用AWS X-Ray和Lake Formation等服务，我们可以添加查询使用访问模式的方法，并确定使用最多和最少的数据集。</p><blockquote class="oi oj ok"><p id="a4ef" class="kz la oa lb b lc ld ju le lf lg jx lh ol lj lk ll om ln lo lp on lr ls lt lu im bi translated"><strong class="lb iu">补充说明:</strong>如果您不想在每个API方法中单独附加您的<code class="fe nw nx ny nz b">boto3_session</code>，您可以使用:</p></blockquote><pre class="kj kk kl km gt oo nz op oq aw or bi"><span id="edd5" class="os mm it nz b gy ot ou l ov ow">boto3.setup_default_session(region_name="us-east-1")</span></pre></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="aac7" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">实现:FastAPI MVP</h1><p id="72ec" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">这个MVP的完整代码可以在Github库中找到。我们简单讨论一下其中的一些细节。</p><p id="fbe3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的演示中，我们可以看到Kaggle 的巴西电子商务数据集上应用的所有端点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="b35c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的截屏演示了我们如何使用这个API来发现和查询存储在S3数据湖中的电子商务数据。最终用户可以确定他们需要的表或模式。通过深入底层文件，数据科学家和分析师可以在交互式笔记本或他们选择的其他工具中探索这些数据。使用<code class="fe nw nx ny nz b">awswrangler</code>从S3读取特定的parquet、CSV、Excel或JSON文件非常简单:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/2e3551fb03647eb59ca14cf8222875c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nlcLsWVoiUI0lobiIKK0AQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="a8c9" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">我们如何大规模地提供这个API？</h1><p id="45eb" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">部署REST API有几种选择。如果你已经使用了AWS，你可能会发现利用专门为构建弹性和可伸缩API而构建的无服务器服务很有用:<strong class="lb iu"> AWS Lambda </strong>和<strong class="lb iu"> API Gateway </strong>。</p><p id="399f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用名为<code class="fe nw nx ny nz b">mangum</code>的优秀包，将我们的FastAPI转换为Lambda处理程序就像导入这个包(<em class="oa"> from mangum import Mangum </em>)并添加一行代码:<code class="fe nw nx ny nz b">handler = Mangum(app=app)</code>一样简单。</p><p id="9c49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将API部署到AWS Lambda的docker文件如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/891481f97e4a8c0c7885b50a5a52659e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W-LqiGG_BxrngLAVraxe5g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="d0f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在Python 3.8中使用官方Python Lambda镜像，并且<strong class="lb iu">安装</strong>所有需要的<strong class="lb iu">包</strong>。然后，我们复制剩余的API代码，并指定将用作容器入口点的<strong class="lb iu"> Lambda处理程序</strong>。</p><p id="3a24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们必须将容器推送到ECR — AWS容器注册中心。要复制此演示，请用您的AWS帐户ID替换<code class="fe nw nx ny nz b">123456789</code>，并调整您的AWS地区名称。如果你想知道:<code class="fe nw nx ny nz b">dda</code>是我对<code class="fe nw nx ny nz b">data-discovery-api</code>的缩写。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/73a208a1d92c4e83acb711865760722e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n3rZbHs7CPVBKbWR9VVy7A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="f991" class="os mm it bd mn pb pc dn mr pd pe dp mv li pf pg mx lm ph pi mz lq pj pk nb pl bi translated">自动气象站λ</h2><p id="aa7c" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">容器映像被部署到ECR。现在，我们需要<strong class="lb iu">创建一个λ函数</strong>。我们选择容器图像选项，并选择我们的ECR图像。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pm"><img src="../Images/2523d1a1a10353c5b3b660f1d1d5f5de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vG2s1SFSrnsd4QiKwtOJPg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="acb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于查询一些表可能比Lambda的默认<strong class="lb iu">超时</strong>三秒更长，我们可以将其延长到三分钟。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/5a60bdc6c7641927af91a76a85ac8585.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DVihHmaRecKfNaYY5T_hoQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="eccf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们需要附加IAM策略来授予我们的Lambda函数权限，以便从AWS Glue、Athena和S3中检索数据(<em class="oa">当然，我们应该对生产使用更细粒度的权限</em>)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi po"><img src="../Images/789d2c72d5dccee7546a9b4739b12e13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rLhbe_aChVbg-CiL72yXPg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="0715" class="os mm it bd mn pb pc dn mr pd pe dp mv li pf pg mx lm ph pi mz lq pj pk nb pl bi translated">API网关</h2><p id="6f25" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">在用我们的容器映像配置了Lambda函数之后，我们可以在API网关控制台中创建新的API。我们需要选择REST API并指定一个名称。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/23e9612b26b071577388b1643f477358.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dhgO5kV5FlaHAGJiLRqKQw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7475" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以添加一个方法和资源来配置Lambda代理集成。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pq"><img src="../Images/24a8545fc08e0769f5d8740f8cb66a66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d8X0YmGPezSsgJ0UlskAwA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b235" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦所有这些都设置好了，我们就可以部署API并开始服务它了。</p><p id="4680" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了一步一步地了解它，这里有一个演示API网关配置、部署和测试API的截屏:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pr oy l"/></div></figure><h2 id="dacf" class="os mm it bd mn pb pc dn mr pd pe dp mv li pf pg mx lm ph pi mz lq pj pk nb pl bi translated">确保API的安全性和可追踪性</h2><p id="479b" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">要了解如何额外配置<strong class="lb iu"> API键</strong>来确保API安全，请查看我以前的文章。它还展示了如何使用AWS X-Ray 配置<strong class="lb iu">分布式跟踪，以便更好地控制AWS上的FastAPI服务:</strong></p><div class="ps pt gp gr pu pv"><a rel="noopener follow" target="_blank" href="/fastapi-aws-secure-api-part-2-1123bff28b55"><div class="pw ab fo"><div class="px ab py cl cj pz"><h2 class="bd iu gy z fp qa fr fs qb fu fw is bi translated">FastAPI + AWS =安全API(第2部分)</h2><div class="qc l"><h3 class="bd b gy z fp qa fr fs qb fu fw dk translated">让我们用FastAPI、AWS Lambda、API Gateway、CloudWatch和AWS X-Ray构建一个安全且可观察的Python REST API</h3></div><div class="qd l"><p class="bd b dl z fp qa fr fs qb fu fw dk translated">towardsdatascience.com</p></div></div><div class="qe l"><div class="qf l qg qh qi qe qj ks pv"/></div></div></a></div></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="b746" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">我们如何监控我们的数据发现服务？</h1><p id="6af6" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">想象一下，您在自己的公司部署了一个类似的服务，并且获得了巨大的成功。现在你需要确保它保持<strong class="lb iu">健康</strong>，可以很容易<strong class="lb iu">维护</strong>，并且运行<strong class="lb iu">没有错误</strong>。此时，您可以:</p><ol class=""><li id="c2f9" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu qk no np nq bi translated">手动关注(<em class="oa">不推荐</em>)，</li><li id="f195" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu qk no np nq bi translated">通过使用AWS CloudWatch和相关服务，自己构建一个<strong class="lb iu">可观察性仪表板</strong>，</li><li id="bfba" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu qk no np nq bi translated">使用观察工具，如<a class="ae ky" href="https://dashbird.io/" rel="noopener ugc nofollow" target="_blank"> Dashbird </a>。</li></ol><p id="d0e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">每个选项的含义:</strong></p><ul class=""><li id="fcc8" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">对于选项1，你可能会发疯。</li><li id="c834" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">对于选项#2，您将不得不花费额外的时间来构建CloudWatch仪表板，在几个CloudWatch日志和多个AWS控制台选项卡之间切换，以修复任何潜在的错误。</li><li id="f27a" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">使用选项#3，您只需登录您的<a class="ae ky" href="https://dashbird.io/" rel="noopener ugc nofollow" target="_blank"> Dashbird </a>帐户——它会自动扫描所有无服务器资源，并为您提供跟踪API和微服务健康状况所需的可视化功能。然后可以随意(<em class="oa">强烈推荐！</em>)结合API Gateway和Lambda资源构建<strong class="lb iu">项目仪表盘</strong>，失败<strong class="lb iu">设置预警</strong>。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ql"><img src="../Images/67323d9550247edf1f666d5a4e0db43b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G7Vf1qEhreJk6dPRoawDEA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="811a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上图中，我们可以看到Dashbird是如何指出3秒后超时的任务的(<em class="oa">默认Lambda超时</em>)。它还揭示了<strong class="lb iu"> Lambda </strong>函数何时经历了冷启动，并显示了每个API调用的持续时间。</p><p id="b71b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于<strong class="lb iu"> API网关</strong>，我们可以看到平均延迟、API请求的数量以及我们在API初始测试中遇到的不同类型的错误。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qm"><img src="../Images/580e31d9a7ec2df76939b6795a5da46e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AckqipEx83x5UVAKLoF-Ow.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="931b" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">结论</h1><p id="ffa0" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">在本文中，我们研究了如何为数据发现构建REST-ful服务。通过利用Python库，如FastAPI、awswrangler、boto3和Mangum，我们可以在几个小时而不是几周内构建有用的API。此外，通过将该服务部署到API Gateway和Lambda，我们可以大规模地提供该API，而不会遇到运营难题。最后，通过利用<a class="ae ky" href="https://dashbird.io/" rel="noopener ugc nofollow" target="_blank"> Dashbird </a>，您可以为您的无服务器资源添加可观察性，而无需安装任何CloudWatch代理、提取日志或构建任何仪表板。</p><p id="e1e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">感谢您的阅读！如果这篇文章有用，</strong> <a class="ae ky" href="https://medium.com/@anna.anisienia" rel="noopener"> <strong class="lb iu">关注我</strong> </a> <strong class="lb iu">看我下一篇帖子。还有，看看相关文章:</strong></p><ul class=""><li id="9f58" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/fastapi-aws-robust-api-part-1-f67ae47390f9"> FastAPI + AWS =健壮的API(第一部分)</a></li><li id="c19d" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><a class="ae ky" href="https://levelup.gitconnected.com/deploying-aws-lambda-with-docker-containers-i-gave-it-a-try-and-heres-my-review-147327519ce9" rel="noopener ugc nofollow" target="_blank">用Docker容器部署AWS Lambda:我尝试了一下，这是我的评论</a></li><li id="e6c7" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/7-reasons-why-you-should-consider-a-data-lake-and-event-driven-etl-7616b74fe484">您应该考虑数据湖(和事件驱动的ETL)的7个理由</a></li></ul></div></div>    
</body>
</html>