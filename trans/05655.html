<html>
<head>
<title>Tableau your Time Series Forecast with TabPy!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用TabPy制作你的时间序列预测表！</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tableau-your-time-series-forecast-with-tabpy-5c09c151477f?source=collection_archive---------5-----------------------#2021-05-20">https://towardsdatascience.com/tableau-your-time-series-forecast-with-tabpy-5c09c151477f?source=collection_archive---------5-----------------------#2021-05-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0a87" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用Tableau的速度洞察来补充您的预测！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/861fd249608de8ee06b1d406c86abe1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ph4U8AE3ZtOSsEbW"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Julian Hochgesang 在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="5337" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">欢迎观看一个简短(希望如此)的演示，演示如何使用TabPy将数据科学模型与Tableau集成在一起。在这个故事中，我们将特别关注时间序列预测。</p><blockquote class="ls lt lu"><p id="b7f5" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">我们将使用三个时间序列模型，这些模型是使用superstore数据集(零售业数据)在python中构建的。我们将使用Jupyter notebook构建我们的python代码，然后继续学习Tableau。</p></blockquote><p id="7136" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文旨在展示如何将一个模型与Tableau的分析扩展相集成，并使其无缝用于消费。</p><blockquote class="ls lt lu"><p id="175b" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">为什么是Tableau？好吧，我喜欢它，我不能强调它是多么容易探索你的数据。</p></blockquote><p id="2bc7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们先来看看数据:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mb"><img src="../Images/47b008c0d4a986f2d6de629c006201ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4o_qHmAU1M2eZhOUy4bSuQ.png"/></div></div></figure><p id="a500" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们只保留日期和销售额列，用于构建时间序列对象。以下代码按升序对销售数字进行排序，并按月对数据进行聚合。</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="c4ec" class="mh mi iq md b gy mj mk l ml mm">#fetching required columns<br/>data = superstore[[‘Order Date’,’Sales’]] <br/>data = data.sort_values(by = 'Order Date')</span><span id="f653" class="mh mi iq md b gy mn mk l ml mm">#creating a ts object<br/>data['Order Date'] = pd.to_datetime(data['Order Date'])<br/>data.index = data['Order Date']<br/>data = data.resample('M').sum()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/8f95789a3f1c0b15f2b38107dd1753b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*CfLHHBM3fpMk31DVXJPCYg.png"/></div></figure><p id="0a72" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们准备好可视化时间序列:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="e50d" class="mh mi iq md b gy mj mk l ml mm">import matplotlib.pyplot as plt<br/>import seaborn as sns</span><span id="9dc8" class="mh mi iq md b gy mn mk l ml mm">plt.subplots(figsize = (17,7))<br/>sns.lineplot(x = “Order Date”, y = “Sales”, data = data)<br/>plt.show()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/0189ad75e4fa27bcd8c58f3f3b8b93bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JqMha9QMZG7ONtq6_HK5wQ.png"/></div></div></figure><p id="a7df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以上是我们的时间序列图。时间序列有三个重要组成部分:趋势、季节性和误差。我们可以将该系列视为“加法模型”或“乘法模型”,这取决于该系列的性质和我们假设的假设。我将把模型构建和预测方法放在<a class="ae kv" rel="noopener" target="_blank" href="/a-blueprint-for-time-series-9f865609bfa2">的下一篇文章</a>中，作为这篇文章的延续，在这篇文章中，我们将涵盖不同的技术、分解、平稳性测试、自相关和部分自相关因子以及模型总结。</p><p id="7d3c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，在我切换到Tableau之前，我将分享我为最终确定模型而编写的代码。</p><blockquote class="ls lt lu"><p id="8309" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">正如文章开头提到的，我们将使用三种模型。这些是霍尔特的线性模型，霍尔特-温特的模型和ARIMA。前两种是指数平滑法，ARIMA代表自回归综合移动平均法，这是一种回归方法。</p></blockquote><p id="6f2b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是霍尔特线性方法的python代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="0485" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该模型在42个月内进行训练，最后6个月用于预测。可以调整模型参数以提高精度。该模型将两者相加，并将整个系列返回给我们。</p><h1 id="7cd9" class="mq mi iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">我们怎么把这和画面联系起来？</h1><p id="84f4" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">Tableau具有内置的分析扩展，允许与其他平台集成。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/463b692f32eeea9638368dada36797d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f0tkSoxA6b01PXgAXUmVXQ.png"/></div></div></figure><p id="8fa2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的例子中，我们选择TabPy。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/c8fa3aebb28edf845ce7e7140f5d5316.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*POFkiwpIVjiv7RB-_DyOHw.png"/></div></div></figure><p id="a1a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请确保安装TabPy，并在您的终端中启动，如以下资源所示:</p><div class="no np gp gr nq nr"><a href="https://tableau.github.io/TabPy/docs/server-install.html" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd ir gy z fp nw fr fs nx fu fw ip bi translated">TabPy安装说明</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">动态执行Python代码并在Tableau可视化中显示结果:在GitHub tableau/TabPy上查看项目…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">tableau.github.io</p></div></div></div></a></div><p id="d3f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以在上述弹出窗口的Tableau中测试连接。</p><p id="5351" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还在python环境中导入了TabPyClient来创建一个连接对象。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="604d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用这个连接对象在我们启动的TabPy服务器上部署我们的模型。</p><p id="ed5a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看可以部署在TabPy上的Holt线性方法的修改代码。</p><p id="4441" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="lv">霍尔特线性法</em> </strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="93e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们已经创建了一个返回模型输出的函数。因为我们将从Tableau中读取数据，所以我们使用了接受我们将从Tableau中传递的值的参数。您将会注意到，我们已经使用了connection对象来在TabPy中部署模型。同样，您可以为其他模型创建函数。</p><p id="a3d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="lv">霍尔特-温特的方法</em> </strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="bcec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="lv"> ARIMA </em> </strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="adea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经在TabPy中部署了这些模型，让我们在Tableau中使用它。我们将创建如下所示的计算字段:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/5ff44f5b2918ee7716889c67d67fde4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n5X_g-tlLIYih5c6P5mxcg.png"/></div></div></figure><blockquote class="ls lt lu"><p id="c44f" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">Tableau使用四个函数，即SCRIPT_REAL、SCRIPT_STR、SCRIPT_BOOL和SCRIPT_INT，分别用于返回类型REAL、string、boolean和integer。上面的代码告诉Tableau运行“季节性ARIMA方法”,该方法部署在TabPy上，带有3个参数(日期、销售额和预测月份),并将“响应”返回给Tableau的计算字段。</p></blockquote><p id="38c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样，我们为其他两个模型定义了计算字段。如果我们想在Tableau中一览无余，它看起来会是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/0c296bafc6b4892b2d7ba3bddd51d74e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*g9OQkVt1OXYyRghGwsvvTA.gif"/></div></div></figure><p id="6b55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，您可以根据需要动态更改预测周期并查看预测。您希望选择最精确的模型。您可以选择在Tableau中创建一个参数来在模型之间切换。</p><p id="67b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">需要注意的一个关键点是，我们需要容纳Tableau中的预测周期(在我们的例子中是几个月),以便为TabPy的返回值腾出空间。这是因为当我们从Tableau传递值时，原始数据集没有这些未来日期的空记录。我调整了数据以扩展日期范围，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/78ea1ee00cddfe2f109d23cde7c583a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JZ6t42KrPaXPGuFX2-pibw.png"/></div></div></figure><p id="754e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上述代码在将所需月份添加到forecast中并将其传递给TabPy之后，基本上扩展了日期范围。此外，我们为此计算日期字段选择“显示缺失值”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/6dddee366dc3e0b2c3858925af2bf167.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*k4rqcrU5IaHhov7e_4fFIQ.png"/></div></figure><blockquote class="ls lt lu"><p id="ae9e" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">这里有一个小交易。因为我们扩展了日期范围，所以最后的日期和销售数字被推到新的预测结束日期。然而，我们只对预测感兴趣；我们可以排除这个数据点，或者在过滤框中使用LAST()=FALSE。请随意提出相同的想法。</p></blockquote></div><div class="ab cl oe of hu og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="ij ik il im in"><p id="e232" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="lv">让我们最后把它插入我们的仪表板:</em> </strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/abf200eb7377792afdf7153692737c11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*m9r90knhD1jN4dm9X8H3Yw.gif"/></div></div></figure><p id="262b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就对了。在Tableau的可视化发现中，我们有一个集成良好的预测模型。你绝对可以在Tableau中引入准确度分数和模型参数，让它变得更加活泼！</p><p id="2709" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如前所述，在我的<a class="ae kv" rel="noopener" target="_blank" href="/a-blueprint-for-time-series-9f865609bfa2">下一个故事</a>中会有更多。</p></div></div>    
</body>
</html>