<html>
<head>
<title>Visualizing Graph Embeddings with t-SNE in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python中的t-SNE可视化图形嵌入</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualizing-graph-embeddings-with-t-sne-in-python-10227e7876aa?source=collection_archive---------12-----------------------#2021-06-25">https://towardsdatascience.com/visualizing-graph-embeddings-with-t-sne-in-python-10227e7876aa?source=collection_archive---------12-----------------------#2021-06-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="74d0" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="5ac0" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">如何定性评估Neo4j图嵌入</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/70119eb37d0ac5f910a28583ecd39181.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*DEbxBW9WKTjz-GI7krum-g.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">图片由<a class="ae la" href="https://commons.wikimedia.org/wiki/User:SlvrKy" rel="noopener ugc nofollow" target="_blank"> Martin Grandjean </a>提供，根据<a class="ae la" href="https://en.wikipedia.org/wiki/en:Creative_Commons" rel="noopener ugc nofollow" target="_blank">知识共享</a> <a class="ae la" href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" rel="noopener ugc nofollow" target="_blank">署名-分享相似4.0国际</a>许可授权。未对原始图像进行任何更改。</p></figure><h1 id="c96b" class="lb lc iq bd ld le lf lg lh li lj lk ll kf lm kg ln ki lo kj lp kl lq km lr ls bi translated">介绍</h1><p id="1918" class="pw-post-body-paragraph lt lu iq lv b lw lx ka ly lz ma kd mb mc md me mf mg mh mi mj mk ml mm mn mo ij bi translated">在我的<a class="ae la" href="https://dev.neo4j.com/intro_graph_emb_tds" rel="noopener ugc nofollow" target="_blank">上一篇文章</a>中，我们讨论了图嵌入的目的和本质。主要思想是，为了在图上进行机器学习，我们需要将图转换成一系列向量(嵌入)，然后我们可以使用这些向量来训练我们的机器学习(ML)模型。</p><p id="63be" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">问题是图嵌入可能很难调优。与创建嵌入和它们所用于的模型的其他方法类似，我们需要考虑很多超参数，并且针对特定的应用对它们进行优化需要时间。关于调整嵌入的主题，我将留到以后的文章中讨论。</p><p id="8011" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">这篇文章是关于开发关于嵌入的超参数的直觉。更具体地说，我将向您展示如何在<a class="ae la" href="https://dev.neo4j.com/neo4j" rel="noopener ugc nofollow" target="_blank"> Neo4j </a>中注入由<a class="ae la" href="https://dev.neo4j.com/graph_data_science" rel="noopener ugc nofollow" target="_blank">图形数据科学</a> (GDS)库创建的图形嵌入，然后用<a class="ae la" href="https://streamlit.io" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>仪表板可视化它们。Tomaz Bratanic开发了<a class="ae la" href="https://dev.neo4j.com/nneuler_embeddings" rel="noopener ugc nofollow" target="_blank">功能</a>来可视化NEuler Neo4j工具中的嵌入，但是我将演示如何以一种纯粹的pythonic方式来实现这一点。</p><p id="cccc" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">你可以在GitHub repo 中找到本教程的所有代码。</p><h1 id="d625" class="lb lc iq bd ld le lf lg lh li lj lk ll kf lm kg ln ki lo kj lp kl lq km lr ls bi translated">入门指南</h1><p id="1e21" class="pw-post-body-paragraph lt lu iq lv b lw lx ka ly lz ma kd mb mc md me mf mg mh mi mj mk ml mm mn mo ij bi translated">我们需要做的第一件事是使用免费的Neo4j <a class="ae la" href="https://dev.neo4j.com/sandbox" rel="noopener ugc nofollow" target="_blank">沙箱</a>实例创建一个用于嵌入创建的图。在本次演示中，我们将使用一个预先构建在沙盒中的图表，即《权力的游戏》图表，它是许多图表示例的来源。(这张图贯穿了前5本书，我要警告你，《权力的游戏》剧透就要来了！)</p><div class="mu mv gp gr mw mx"><a href="https://dev.neo4j.com/sandbox" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd ja gy z fp nc fr fs nd fu fw iz bi translated">Neo4j沙盒</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">使用个人的、可通过互联网访问的数据库快速开始学习Neo4j。供大众使用的内置指南和数据集…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">dev.neo4j.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl ku mx"/></div></div></a></div><p id="7675" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">当您到达主沙盒页面时，您将希望选择带有预构建数据的图表数据科学类型，并启动项目:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nm"><img src="../Images/86464b08ca2913a02d2e32e82b447426.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dn9ehX1AQFyHELBHsjaU1Q.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">选择带有预建数据的图形数据科学图像。(图片由作者提供。)</p></figure><p id="0e34" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">您将看到实例被创建。然后，您需要使用右边的下拉菜单获取连接详细信息:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nr"><img src="../Images/7ba8a3b9a67dd7ac22810237c354a4e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*73eWHWAik9pdR34_QxXU_g.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">实例的连接详细信息。(图片由作者提供。)</p></figure><p id="24b4" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">酷毙了。请务必获取Bolt URL和密码，因为这些将用于建立我们的连接。如果您单击Open: Open with Browser，然后单击左上角的数据库图标，您应该会看到一个预先填充的2642个节点的图表，这些节点代表人员、地点等。以及各种类型的16，474个关系。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/edee89e48cbd1be3b5afd4d369ca6a7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*9PA1O_Hl6Mp1YLiF2Tvhag.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">《权力的游戏》图表的节点和关系。(图片由作者提供。)</p></figure><p id="2e71" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">在这一点上，你会想进入回购(你克隆了它，对不对？)并且我们将用这些信息调整Dockerfile文件。我喜欢使用Docker，这样结果是可重复的。因此，根据上面的图像，您将编辑Dockerfile文件的最后一行，以读取</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="f7d7" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">(在本文发布时，这个沙盒实例将被关闭。)</p><p id="0ebc" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">太棒了。现在我们可以构建用于建立连接的Streamlit容器。我非常喜欢Streamlit，因为它允许您以最少的编码开销快速创建非常复杂的仪表板。我们现在将通过命令行使用标准命令来构建容器:</p><pre class="kp kq kr ks gt nv nw nx ny aw nz bi"><span id="0e7c" class="oa lc iq nw b gy ob oc l od oe">docker build -t neo_stream .</span></pre><p id="e0a8" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">然后我们会用</p><pre class="kp kq kr ks gt nv nw nx ny aw nz bi"><span id="9812" class="oa lc iq nw b gy ob oc l od oe">docker run -p 8501:8501 -v $PWD/src:/examples neo_stream</span></pre><p id="5835" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">(请注意，如果您在Windows上，您将需要调整这些命令。)</p><h1 id="1950" class="lb lc iq bd ld le lf lg lh li lj lk ll kf lm kg ln ki lo kj lp kl lq km lr ls bi translated">在仪表板中可视化嵌入</h1><p id="f2e7" class="pw-post-body-paragraph lt lu iq lv b lw lx ka ly lz ma kd mb mc md me mf mg mh mi mj mk ml mm mn mo ij bi translated">现在，我们已经启动并运行了Streamlit容器，并将其连接到Neo4j沙盒实例。现在容器正在运行，它将为您提供您应该使用浏览器导航到的URL。它看起来会像<a class="ae la" href="http://172.17.0.2:8501." rel="noopener ugc nofollow" target="_blank"> http://172.17.0.2:8501。</a>当您这样做时，您应该会看到类似这样的内容:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi of"><img src="../Images/cb197f66ec380b506e1e1d364dce7469.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uC02_Alh8b5zQmrpdmCu-w.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">Streamlit仪表板的屏幕截图。(图片由作者提供。)</p></figure><p id="0387" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">很好。现在让我们看看这里有什么。我们可以做的第一件事是点击“获取图表列表”这将做两件事。首先，如果您得到一些文本，您知道您已经正确地连接到沙箱。其次，如果有任何由GDS创建的内存图形(参见<a class="ae la" href="https://neo4j.com/docs/graph-data-science/current/management-ops/" rel="noopener ugc nofollow" target="_blank"> API文档</a>和<a class="ae la" rel="noopener" target="_blank" href="/how-to-get-started-with-the-new-graph-data-science-library-of-neo4j-3c8fff6107b">本帖</a>了解这些)，那么它们将在此列出。既然我们才刚刚开始，应该不会有。</p><p id="42b7" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">但是我们现在要创建一个，因为他们是整个GDS的支柱。给图形命名并点击“创建内存图形”(没有空格！).这将创建一个单边无向图，查看《权力的游戏》中的哪些人与其他人互动，或<code class="fe og oh oi nw b">(person1:Person)-[:INTERACTS]-(person2:Person)</code>。当我们这样做时，我们将得到一个有2166个节点和7814个关系的图。注意，无向图将使关系的数量加倍，因为它考虑了从人员1到人员2和人员2到人员1的两个方向。剧透:如果你沿着图的自然方向走，你的嵌入看起来会不同:<code class="fe og oh oi nw b">(person1:Person)-[:INTERACTS]-&gt;(person2:Person)</code>。</p><p id="e85c" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">好了，现在是开始工作并创建一些嵌入的时候了。在撰写本文时，我已经实现了GDS内置的两个更简单的嵌入，即<a class="ae la" href="https://neo4j.com/docs/graph-data-science/current/algorithms/fastrp/#algorithms-embeddings-fastrp" rel="noopener ugc nofollow" target="_blank"> FastRP </a>和<a class="ae la" href="https://neo4j.com/docs/graph-data-science/current/algorithms/node2vec/#beta-algorithms-embeddings-node2vec" rel="noopener ugc nofollow" target="_blank"> node2vec </a>。如果你阅读了API文档，你可以并且应该使用很多超参数，因为正如我们所知，缺省值往往不会给出最好的结果。我只包含了每种方法的一个子集，但将来会添加更多。对于FastRP，我有以下内容:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi oj"><img src="../Images/cd8527b51dd2afdba20c4aa26a4a581e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*knlMIhOb6unFVMOmUdkYTw.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">仪表板中包含的FastRP超参数。(图片由作者提供。)</p></figure><p id="a86c" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">您还可以单击node2vec的下拉菜单，查看其中有哪些可调参数。我强烈建议您查阅每种嵌入方法的API文档，以获得更多关于每种方法的含义的信息，因为详细描述每种方法超出了本文的范围(尽管在以后关于嵌入调优的文章中，我们将深入讨论这一点！).</p><p id="d1a2" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">因此您可以创建FastRP和node2vec嵌入。现在我们想把它们形象化。但是为了什么目标呢？我们来看看，在这一点上，我们是否无法预测哪些角色是活着的，哪些是死了的。这是一个非常基本的节点分类问题，也是一个很好的起点，因为这是一个监督学习问题。对于这个数据，我将每个人节点标记为1(如果他们活着), 0(如果他们死了)。</p><p id="a2c4" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">我们将使用<code class="fe og oh oi nw b"><a class="ae la" href="https://scikit-learn.org/stable/modules/generated/sklearn.manifold.TSNE.html" rel="noopener ugc nofollow" target="_blank">scikit-learn</a></code>中可用的<a class="ae la" href="https://en.wikipedia.org/wiki/T-distributed_stochastic_neighbor_embedding" rel="noopener ugc nofollow" target="_blank">t-分布式随机邻居嵌入</a> (t-SNE)来执行维度缩减，以便在2维空间中可视化。(您可以使用任何降维方法，如PCA。我对SNE霸王龙的选择是任意的。)</p><p id="49c1" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">我将选取一些随机值并生成一些node2vec嵌入，如下所示:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi ok"><img src="../Images/ad865870a5d2c94c50b8f473feb48d90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GS6hG-mukTNpCGHGgYGFfA.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">my node2vec嵌入的演示超参数。(图片由作者提供。)</p></figure><p id="0497" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">接下来，我将使用t-SNE选项卡来可视化这些嵌入。当我这么做的时候，我得到了这个:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi ol"><img src="../Images/8dc236194c4e2359d525c28f9b6048bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uo2dCthOueS4FHYOyh91GQ.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">基于以上node2vec嵌入的2D t-SNE向量。(图片由作者提供。)</p></figure><p id="5700" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">哦不！这太可怕了！红色的数据点是死去的人，蓝色的是活着的人。我们希望我们的红色和蓝色点会比这更好地聚集！我把它作为一个练习留给读者，让他们来修补这些值，看看他们是否能做得更好。(相信我，你可以！)</p><h1 id="a43f" class="lb lc iq bd ld le lf lg lh li lj lk ll kf lm kg ln ki lo kj lp kl lq km lr ls bi translated">后续步骤</h1><p id="938d" class="pw-post-body-paragraph lt lu iq lv b lw lx ka ly lz ma kd mb mc md me mf mg mh mi mj mk ml mm mn mo ij bi translated">这里需要考虑一些事情。首先，这是一个非常小的图表。所以真正的优化通常会很难。第二，如果我们真的想优化它们，我们需要做的不仅仅是在2D看一张更高维度的嵌入的漂亮图片。我们可以使用这样的工具来获得对我们的图最重要的超参数的直觉，然后在ML模型中使用这些参数进行网格搜索，以优化我们的相关指标。因此，我鼓励您修改这些超参数，看看会发生什么。</p><p id="61d7" class="pw-post-body-paragraph lt lu iq lv b lw mp ka ly lz mq kd mb mc mr me mf mg ms mi mj mk mt mm mn mo ij bi translated">在未来的帖子中，我计划使用更大的图，我们希望可以得到更好的嵌入结果，并在ML模型中测试它们。</p></div></div>    
</body>
</html>