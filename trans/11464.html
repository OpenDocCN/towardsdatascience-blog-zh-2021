<html>
<head>
<title>Connecting to SQL Databases for Data Scientists, Analysts, and Engineers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为数据科学家、分析师和工程师连接到SQL数据库</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/connecting-to-sql-databases-for-data-scientists-analysts-and-engineers-58dc77a9165e?source=collection_archive---------8-----------------------#2021-11-11">https://towardsdatascience.com/connecting-to-sql-databases-for-data-scientists-analysts-and-engineers-58dc77a9165e?source=collection_archive---------8-----------------------#2021-11-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8071" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何利用企业中最常见的数据存储来源之一。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ce8b638123469a8801b8393f980c4d5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XjQ8PD4MiCvuYOhM"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">本杰明·雷曼在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="da62" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">无论你是在构建分析还是在寻求训练一个机器学习模型，数据工程、分析和科学的基础都是对数据的访问。数据本身可以从许多不同的来源收集:web抓取、API调用、平面文件；但是跨企业的数据存储的最常见来源之一是结构化数据库，它通常被称为SQL数据库。</p><p id="037f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">SQL数据库是一个包罗万象的术语，指的是使用结构化查询语言(SQL查询)进行交互的关系数据库管理系统(RDBMS)。SQL数据库能够快速处理和存储大量数据，使其成为企业中非常常用的数据存储和管理应用程序。</p><p id="17a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然SQL语言能够对数据库执行标准分析(GROUP BY/FILTER/etc……)，但在实践中，许多企业不鼓励直接在数据库本身上大量使用SQL，因为它们要么是热数据库(根据它们所服务的软件应用程序的需要而活动)，要么是报告数据库(从热数据库同步，专门用于数据提取)。此外，由于SQL语言的限制，许多统计和机器学习工具不可用，因此在企业环境中，在处理数据之前摄取数据是常见的做法。</p><p id="6c85" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据接收是从一个存储介质(源)获取数据并将其转储到另一个更适合数据操作的存储介质(接收器)的过程。谈到大数据，企业环境中最常见的大规模数据吸收汇是数据湖(通常通过Hadoop生态系统)。一旦数据进入湖中，就可以由任何Hadoop生态系统工具(Spark、Pig等)自由转换或操纵。)或转换成开发者喜欢的不同形式。为了将数据从SQL数据库接收到您选择的介质中，必须使用连接器作为开发的软件应用程序的一部分。</p><h1 id="793c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">ODBC / JDBC驱动程序</h1><p id="2c9f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">开放式数据库连接(ODBC)是数据库采用的API标准，它允许软件应用程序与数据库管理系统(DBMS)接口。在这方面，ODBC驱动程序或Java数据库连接器(JDBC)驱动程序都是这些标准的实际应用，它们可以被软件应用程序用来连接到如图1所示的数据库。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/5894b5c52041c10277dff14c57e29741.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*UfLTxTcgPTXeoxNAoaQz9g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图1软件应用程序通过ODBC/JDBC驱动程序连接到SQL数据库的描述(图片由作者提供)</p></figure><p id="6b9f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于每个数据库引擎(MySQL、Microsoft SQL、PostGreSQL、Oracle等)的内部操作不同，每个数据库引擎都有自己特定的ODBC/JDBC驱动程序用于交互。然而，这些ODBC/JDBC驱动程序的功能都是相似的，因此许多编程语言都有一种标准的方式来调用用于连接这些数据库的各种ODBC/JDBC驱动程序。一旦软件应用程序加载了ODBC/JDBC驱动程序，该驱动程序就被配置为指向SQL数据库并与之交互，这需要设置:主机/URL、数据库名称以及可以访问数据集的凭证。</p><p id="f50c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了演示从SQL DB获取或加载数据的不同连接方式，本教程将介绍使用Python (pyodbc包)、Spark(Scala Spark和PySpark)和Sqoop(Hadoop生态系统的数据获取工具)获取数据。此外，Docker将用于容器化环境，以更接近地模拟企业环境，并允许读者轻松复制演示。</p><h1 id="f461" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">码头工人</h1><p id="ddaa" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Docker是一个允许您轻松构建和部署轻量级虚拟机(也称为容器)的工具，这些虚拟机可以连接起来形成一个网络。在大多数实际的企业环境中，需要来自SQL服务器的数据的软件应用程序不会在与SQL服务器相同的机器上运行，因此我们可以使用图2所示的Docker体系结构来模拟这样的企业环境。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/8f53763a3b9ed166e7501e3228b3aeaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yhPqXdM_aJdvia_jt1LKxw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图2使用Docker容器和网络的模拟企业环境(图片来自作者)</p></figure><p id="edaf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了便于跟随教程，上面的Docker环境和所有用于连接MySQL数据库的脚本都可以在GitHub [1]上找到。</p><h1 id="8e55" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">使用MySQL设置SQL数据库</h1><p id="de02" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">MySQL是一个用于存储和管理企业架构中常见的结构化数据的通用数据库引擎，它代表了一个用于本地部署的开源(并且容易获得)SQL DB，以构建我们的沙盒企业环境。</p><p id="e56d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">mysql提供了一个基本的Docker映像，mysql/mysql-server [2]，它在一个容器中启动一个预安装的MySQL实例，该实例将在我们的模拟企业环境中充当SQL Server。</p><p id="4dcb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此Docker图像接受。sql脚本作为容器初始化时运行的命令，我们可以使用它(与。下面的sql脚本)来配置数据库，并为我们的连接测试创建假数据。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="604e" class="mw lt iq ms b gy mx my l mz na"><em class="nb">-- Create database</em></span><span id="215e" class="mw lt iq ms b gy nc my l mz na"><em class="nb">CREATE DATABASE test_db;</em></span><span id="cd96" class="mw lt iq ms b gy nc my l mz na"><em class="nb">USE test_db;</em></span><span id="6751" class="mw lt iq ms b gy nc my l mz na"><em class="nb">-- Create table</em></span><span id="aa10" class="mw lt iq ms b gy nc my l mz na"><em class="nb">CREATE TABLE test_table(</em></span><span id="7cac" class="mw lt iq ms b gy nc my l mz na"><em class="nb">row_id INT AUTO_INCREMENT PRIMARY KEY,</em></span><span id="b32c" class="mw lt iq ms b gy nc my l mz na"><em class="nb">test_value VARCHAR(255) NOT NULL</em></span><span id="cea6" class="mw lt iq ms b gy nc my l mz na"><em class="nb">);</em></span><span id="3fed" class="mw lt iq ms b gy nc my l mz na"><em class="nb">-- Fill table with values</em></span><span id="ba30" class="mw lt iq ms b gy nc my l mz na"><em class="nb">INSERT INTO test_table(test_value) VALUES ("A");</em></span><span id="38b0" class="mw lt iq ms b gy nc my l mz na"><em class="nb">INSERT INTO test_table(test_value) VALUES ("b");</em></span><span id="bec8" class="mw lt iq ms b gy nc my l mz na"><em class="nb">INSERT INTO test_table(test_value) VALUES ("C");</em></span><span id="26b2" class="mw lt iq ms b gy nc my l mz na"><em class="nb">INSERT INTO test_table(test_value) VALUES ("4");</em></span><span id="2c0f" class="mw lt iq ms b gy nc my l mz na"><em class="nb">-- Add user with remote access priveleges</em></span><span id="6ee8" class="mw lt iq ms b gy nc my l mz na"><em class="nb">CREATE USER "remote_connect_user"@"%" IDENTIFIED BY "remote_connect_password";</em></span><span id="c10e" class="mw lt iq ms b gy nc my l mz na"><em class="nb">GRANT ALL PRIVILEGES ON * . * TO "remote_connect_user"@"%" WITH GRANT OPTION;</em></span><span id="994f" class="mw lt iq ms b gy nc my l mz na"><em class="nb">FLUSH PRIVILEGES;</em></span></pre><p id="eba1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码执行两个主要功能:</p><ol class=""><li id="2f93" class="nd ne iq ky b kz la lc ld lf nf lj ng ln nh lr ni nj nk nl bi translated">MySQL服务器创建一个数据库(名为test_db ),在数据库中创建一个表(名为test_table ),并用少量记录填充test_table(见下面的表I ),当我们尝试提取数据时，可以在接收端验证这些记录</li><li id="22b7" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">MySQL服务器创建一个用户帐户(名称:remote_connect_user，密码:remote_connect_password ),该帐户具有远程访问数据库的权限</li></ol><p id="58b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">表I: test_db.test_table值</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/56af5bbe713ef061b104abce1c4216dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*NIRp3s1EGfUBPsakCvx4RQ.png"/></div></figure><p id="f8d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">设置好MySQL数据库后，我们可以专注于如何通过各种软件应用程序提取数据，在本教程中从Python(和pyodbc包)开始。</p><h1 id="114c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">使用Python的MySQL数据库连接(通过pyodbc)</h1><p id="e0a2" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">通过使用pip install调用许多可用的ODBC包之一，可以很容易地使用Python连接到SQL DB。在本教程中，我们将重点关注使用pyodbc [3]包使用Python连接到MySQL DB，该包作为Docker映像laudio/pyodbc [4]提供，并包含MySQL ODBC 8.0驱动程序。</p><p id="f661" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了连接到容器以建立python连接，我们可以运行命令:</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="d3ec" class="mw lt iq ms b gy mx my l mz na"><em class="nb">docker exec -it sql-ingestion-tutorial-python-client-1 python</em></span></pre><p id="3edd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它远程连接到容器，并在容器中启动python的交互式会话。</p><p id="027a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">加载python后，我们可以使用下面的代码来加载pyodbc包，配置驱动程序的设置以连接到我们的MySQL实例，并运行测试查询来选择*并在控制台中输出结果。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="8c9d" class="mw lt iq ms b gy mx my l mz na"><em class="nb"># Imports</em></span><span id="7553" class="mw lt iq ms b gy nc my l mz na"><em class="nb">import pyodbc</em></span><span id="f2aa" class="mw lt iq ms b gy nc my l mz na"><em class="nb"># Set configuration for DB</em></span><span id="ae22" class="mw lt iq ms b gy nc my l mz na"><em class="nb">MYSQL_HOST="mysql-server"</em></span><span id="7f5e" class="mw lt iq ms b gy nc my l mz na"><em class="nb">MYSQL_USER="remote_connect_user"</em></span><span id="8b4f" class="mw lt iq ms b gy nc my l mz na"><em class="nb">MYSQL_PASS="remote_connect_password"</em></span><span id="98a8" class="mw lt iq ms b gy nc my l mz na"><em class="nb">MYSQL_DB="test_db"</em></span><span id="26dc" class="mw lt iq ms b gy nc my l mz na"><em class="nb">MYSQL_TABLE="test_table"</em></span><span id="61fd" class="mw lt iq ms b gy nc my l mz na"><em class="nb"># Establish connection to MySQL DB</em></span><span id="f2dc" class="mw lt iq ms b gy nc my l mz na"><em class="nb">cnxn = pyodbc.connect(f"DRIVER={{MySQL ODBC 8.0 Driver}};SERVER={MYSQL_HOST};DATABASE={MYSQL_DB};UID={MYSQL_USER};PWD={MYSQL_PASS}")</em></span><span id="1a31" class="mw lt iq ms b gy nc my l mz na"><em class="nb">cursor = cnxn.cursor()</em></span><span id="86f2" class="mw lt iq ms b gy nc my l mz na"><em class="nb"># Run query to select * and output results</em></span><span id="ba12" class="mw lt iq ms b gy nc my l mz na"><em class="nb">cursor.execute(f"SELECT * FROM {MYSQL_TABLE}")</em></span><span id="f078" class="mw lt iq ms b gy nc my l mz na"><em class="nb">row = cursor.fetchone()</em></span><span id="4365" class="mw lt iq ms b gy nc my l mz na"><em class="nb">while row:</em></span><span id="af3d" class="mw lt iq ms b gy nc my l mz na"><em class="nb">   print (row)</em></span><span id="9acd" class="mw lt iq ms b gy nc my l mz na"><em class="nb">   row = cursor.fetchone()</em></span></pre><p id="207d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这种情况下，pyodbc.connect函数引用MySQL DB的预安装odbc驱动程序，并且该驱动程序被配置为包括服务器URL、数据库名称和运行查询所调用的凭证。然后，test命令通过对DB中的表运行SELECT *语句来引用这个连接，并迭代地打印输出，如下所示。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="a165" class="mw lt iq ms b gy mx my l mz na">(1, 'A')<br/>(2, 'b')<br/>(3, 'C')<br/>(4, '4')</span></pre><h1 id="944e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">使用Apache Sqoop的MySQL数据库连接</h1><p id="e762" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Apache Sqoop [5]是Hadoop生态系统中的一个工具，用于结构化数据库中的数据与Hadoop文件存储之间的批量传输。虽然Apache Sqoop已于2021年6月退役[6]，但该工具通常被企业用来将数据吸收到数据湖中，实际上需要一段时间才能从企业生产系统中完全退役。</p><p id="613a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与其他容器类似，Apache Sqoop可以使用dvoros/sqoop映像[7]立即获得，该映像预装了Apache Sqoop和所有用于支持Sqoop的Hadoop生态系统工具。</p><p id="ea50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Sqoop映像不包含JDBC驱动程序，Sqoop将使用该驱动程序连接到MySQL数据库，因此正在启动的Docker容器包括将JDBC驱动程序装载到容器中，当该容器放置在/usr/local/sqoop/lib文件夹中时，Sqoop将自动识别该容器。考虑到要连接到一个MySQL数据库，我们可以通过下载MySQL网站[8]上提供的连接器的平台无关版本来获得这个连接器。</p><p id="e981" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Sqoop本身有许多参数来帮助实现常见的数据摄取功能[9]，但是出于本教程的目的，演示将是使用下面给出的代码以文本形式从MySQL数据库到HDFS的基本摄取:</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="15fe" class="mw lt iq ms b gy mx my l mz na"><em class="nb"># Create the data ingestion location</em></span><span id="5a56" class="mw lt iq ms b gy nc my l mz na"><em class="nb">hdfs dfs -mkdir /user/sqoop<br/></em></span><span id="4938" class="mw lt iq ms b gy nc my l mz na"><em class="nb"># Sqoop import example</em></span><span id="326d" class="mw lt iq ms b gy nc my l mz na"><em class="nb">MYSQL_HOST=mysql-server</em></span><span id="6bca" class="mw lt iq ms b gy nc my l mz na"><em class="nb">MYSQL_USER=remote_connect_user</em></span><span id="5d28" class="mw lt iq ms b gy nc my l mz na"><em class="nb">MYSQL_PASS=remote_connect_password</em></span><span id="c694" class="mw lt iq ms b gy nc my l mz na"><em class="nb">MYSQL_DB=test_db</em></span><span id="9209" class="mw lt iq ms b gy nc my l mz na"><em class="nb">MYSQL_TABLE=test_table</em></span><span id="64cf" class="mw lt iq ms b gy nc my l mz na"><em class="nb">sqoop import --connect jdbc:mysql://$MYSQL_HOST/$MYSQL_DB --table $MYSQL_TABLE --username $MYSQL_USER --password $MYSQL_PASS --as-textfile --target-dir /user/sqoop/text -m 1</em></span><span id="27cd" class="mw lt iq ms b gy nc my l mz na"><em class="nb"># Test the output</em></span><span id="d037" class="mw lt iq ms b gy nc my l mz na"><em class="nb">hdfs dfs -ls /user/sqoop/text</em></span><span id="5133" class="mw lt iq ms b gy nc my l mz na"><em class="nb"># Inspect the parquet file</em></span><span id="56f1" class="mw lt iq ms b gy nc my l mz na"><em class="nb">hdfs dfs -cat /user/sqoop/text/part-m-00000</em></span></pre><p id="f0f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如代码所示，首先在HDFS创建一个目标文件夹来存储接收到的数据。Sqoop摄取过程直接从命令行执行，与建立连接的其他应用程序类似，MySQL连接器被引用并配置为指向正确的表位置和凭证。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="bcc5" class="mw lt iq ms b gy mx my l mz na">1,A<br/>2,b<br/>3,C<br/>4,4</span></pre><p id="6e28" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">代码的最终结果如上所示，它验证了MySQL数据库的快照已经被HDFS接收。此时，可以通过Spark或其他方式在Hadoop中原生拾取。</p><h1 id="b0c7" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">使用Spark的MySQL数据库连接</h1><p id="dca5" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">与上面的例子类似，我们可以利用Spark自带的Docker容器，在这种情况下，我们将使用jupyter/pyspark-notebook映像[10]。然而，与其他连接不同，当我们提交应用程序时，我们必须将JDBC驱动程序作为一个添加的jar文件包含在Spark中。下面是Scala Spark和PySpark连接MySQL数据库的示例代码。</p><h2 id="9be7" class="mw lt iq bd lu ns nt dn ly nu nv dp mc lf nw nx me lj ny nz mg ln oa ob mi oc bi translated">使用Scala Spark连接MySQL数据库</h2><p id="fee8" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">与之前的容器一样，我们首先运行以下命令来连接Spark容器并调用Scala提示符:</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="b58c" class="mw lt iq ms b gy mx my l mz na"><em class="nb">docker exec -it sql-ingestion-tutorial-pyspark-client-1 spark-shell --jars /jdbc/*</em></span></pre><p id="8cf3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">连接到Scala提示符后，以下命令调用JDBC驱动程序连接到DB并打印结果数据以验证连接成功。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="f4c7" class="mw lt iq ms b gy mx my l mz na"><em class="nb">// Set configuration for DB</em></span><span id="8939" class="mw lt iq ms b gy nc my l mz na"><em class="nb">val MYSQL_HOST="mysql-server";</em></span><span id="3e20" class="mw lt iq ms b gy nc my l mz na"><em class="nb">val MYSQL_USER="remote_connect_user";</em></span><span id="9c3b" class="mw lt iq ms b gy nc my l mz na"><em class="nb">val MYSQL_PASS="remote_connect_password";</em></span><span id="2192" class="mw lt iq ms b gy nc my l mz na"><em class="nb">val MYSQL_DB="test_db";</em></span><span id="602e" class="mw lt iq ms b gy nc my l mz na"><em class="nb">val MYSQL_TABLE="test_table";</em></span><span id="e16c" class="mw lt iq ms b gy nc my l mz na"><em class="nb">// Establish connection for MySQL DB using credentials provided</em></span><span id="b4a4" class="mw lt iq ms b gy nc my l mz na"><em class="nb">val df = (spark.read</em></span><span id="a1c4" class="mw lt iq ms b gy nc my l mz na"><em class="nb">.format("jdbc")</em></span><span id="d483" class="mw lt iq ms b gy nc my l mz na"><em class="nb">.option("url", s"jdbc:mysql://$MYSQL_HOST/$MYSQL_DB")</em></span><span id="23b1" class="mw lt iq ms b gy nc my l mz na"><em class="nb">.option("driver", "com.mysql.cj.jdbc.Driver")</em></span><span id="249b" class="mw lt iq ms b gy nc my l mz na"><em class="nb">.option("dbtable", MYSQL_TABLE)</em></span><span id="6026" class="mw lt iq ms b gy nc my l mz na"><em class="nb">.option("user", MYSQL_USER)</em></span><span id="457c" class="mw lt iq ms b gy nc my l mz na"><em class="nb">.option("password", MYSQL_PASS)</em></span><span id="3808" class="mw lt iq ms b gy nc my l mz na"><em class="nb">.load())</em></span><span id="4e45" class="mw lt iq ms b gy nc my l mz na"><em class="nb">// Display results for validating successful connection</em></span><span id="4ccf" class="mw lt iq ms b gy nc my l mz na"><em class="nb">df.show()</em></span></pre><p id="09c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">成功建立连接后，将生成以下输出。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="ef76" class="mw lt iq ms b gy mx my l mz na">+------+----------+<br/>|row_id|test_value|<br/>|     1|         A|<br/>|     2|         b|<br/>|     3|         C|<br/>|     4|         4|<br/>+------+----------+</span></pre><h2 id="4710" class="mw lt iq bd lu ns nt dn ly nu nv dp mc lf nw nx me lj ny nz mg ln oa ob mi oc bi translated">使用PySpark连接到MySQL数据库</h2><p id="2162" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">为了连接到PySpark提示符，将调用之前使用的同一个容器，但是下面的命令将启动一个PySpark会话来连接到DB。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="efc2" class="mw lt iq ms b gy mx my l mz na"><em class="nb">docker exec -it sql-ingestion-tutorial-pyspark-client-1 pyspark --jars /jdbc/*</em></span></pre><p id="adec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">调用JDBC驱动程序并提取数据的PySpark版本代码如下:</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="4ba9" class="mw lt iq ms b gy mx my l mz na"><em class="nb"># Set configuration for DB</em></span><span id="35ff" class="mw lt iq ms b gy nc my l mz na"><em class="nb">MYSQL_HOST="mysql-server"</em></span><span id="3427" class="mw lt iq ms b gy nc my l mz na"><em class="nb">MYSQL_USER="remote_connect_user"</em></span><span id="e661" class="mw lt iq ms b gy nc my l mz na"><em class="nb">MYSQL_PASS="remote_connect_password"</em></span><span id="983d" class="mw lt iq ms b gy nc my l mz na"><em class="nb">MYSQL_DB="test_db"</em></span><span id="c675" class="mw lt iq ms b gy nc my l mz na"><em class="nb">MYSQL_TABLE="test_table"</em></span><span id="db58" class="mw lt iq ms b gy nc my l mz na"><em class="nb"># Establish connection for MySQL DB using credentials provided</em></span><span id="0940" class="mw lt iq ms b gy nc my l mz na"><em class="nb">df = spark.read.format('jdbc').options(</em></span><span id="3ada" class="mw lt iq ms b gy nc my l mz na"><em class="nb">url = f"jdbc:mysql://{MYSQL_HOST}/{MYSQL_DB}",</em></span><span id="577b" class="mw lt iq ms b gy nc my l mz na"><em class="nb">driver = "com.mysql.cj.jdbc.Driver",</em></span><span id="088b" class="mw lt iq ms b gy nc my l mz na"><em class="nb">dbtable = MYSQL_TABLE,</em></span><span id="56d0" class="mw lt iq ms b gy nc my l mz na"><em class="nb">user = MYSQL_USER,</em></span><span id="d0b8" class="mw lt iq ms b gy nc my l mz na"><em class="nb">password = MYSQL_PASS</em></span><span id="2de4" class="mw lt iq ms b gy nc my l mz na"><em class="nb">).load()</em></span><span id="b8fd" class="mw lt iq ms b gy nc my l mz na"><em class="nb"># Display results for validating successful connection</em></span><span id="5eb6" class="mw lt iq ms b gy nc my l mz na"><em class="nb">df.show()</em></span></pre><p id="e9f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">成功建立连接后，将会看到以下输出。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="616a" class="mw lt iq ms b gy mx my l mz na">+------+----------+<br/>|row_id|test_value|<br/>|     1|         A|<br/>|     2|         b|<br/>|     3|         C|<br/>|     4|         4|<br/>+------+----------+</span></pre><h1 id="80f3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="f895" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">没有数据，分析或数据科学就没有机会让业务受益。大多数企业系统严重依赖SQL数据库来存储大量数据，并不是每个团队都有专门的数据工程师或数据仓库来提供对开发数据的轻松访问。在这种情况下，值得你自己学习这些技能，让你的生活变得更轻松。本文简要介绍了如何使用ODBC和JDBC连接器在软件应用程序中建立与数据库的连接，并使用Python (pyodbc包)、Sqoop和Spark (PySpark和Scala Spark)进行了演示。</p><h1 id="bdd1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">参考</h1><p id="e395" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">[1] SQL摄取教程Github页面，<a class="ae kv" href="https://github.com/mkgray/sql-ingestion-tutorial" rel="noopener ugc nofollow" target="_blank">https://github.com/mkgray/sql-ingestion-tutorial</a></p><p id="30fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[2] MySQL服务器Dockerfile，【https://hub.docker.com/r/mysql/mysql-server/ T2】</p><p id="3ba8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[3] PyODBC包，【https://pypi.org/project/pyodbc/ T4】</p><p id="489f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[4]pyodbc dock file，<a class="ae kv" href="https://hub.docker.com/r/laudio/pyodbc" rel="noopener ugc nofollow" target="_blank">https://hub . docker . com/r/laudo/pyodbc</a></p><p id="b5e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[5] Apache Sqoop，<a class="ae kv" href="https://sqoop.apache.org/" rel="noopener ugc nofollow" target="_blank">https://sqoop . Apache . org/</a></p><p id="196b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[6] Apache Sqoop Attic，<a class="ae kv" href="https://attic.apache.org/projects/sqoop.html" rel="noopener ugc nofollow" target="_blank">https://attic . Apache . org/projects/sqoop . html</a></p><p id="b7b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[7]Apache sqoop docerfile，<a class="ae kv" href="https://hub.docker.com/r/dvoros/sqoop" rel="noopener ugc nofollow" target="_blank">https://hub . docker . com/r/dvosos/sqoop</a></p><p id="bb43" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[8] MySQL JDBC连接器，<a class="ae kv" href="https://dev.mysql.com/downloads/connector/j/" rel="noopener ugc nofollow" target="_blank">https://dev . MySQL . com/downloads/connector/j/</a></p><p id="8c66" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[9] Apache Sqoop User Guide，<a class="ae kv" href="https://sqoop.apache.org/docs/1.4.6/SqoopUserGuide.html" rel="noopener ugc nofollow" target="_blank">https://sqoop . Apache . org/docs/1 . 4 . 6/sqoop user guide . html</a></p><p id="7035" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[10]spark dock file，<a class="ae kv" href="https://hub.docker.com/r/jupyter/pyspark-notebook" rel="noopener ugc nofollow" target="_blank">https://hub . docker . com/r/jupyter/pyspark笔记本电脑</a></p></div></div>    
</body>
</html>