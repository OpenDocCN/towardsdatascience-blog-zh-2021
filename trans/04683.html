<html>
<head>
<title>How to Use SQL RANK and DENSE_RANK Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用SQL RANK和DENSE_RANK函数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-use-sql-rank-and-dense-rank-functions-7c3ebf84b4e8?source=collection_archive---------0-----------------------#2021-04-23">https://towardsdatascience.com/how-to-use-sql-rank-and-dense-rank-functions-7c3ebf84b4e8?source=collection_archive---------0-----------------------#2021-04-23</a></blockquote><div><div class="fc ij ik il im in"/><div class="io ip iq ir is"><div class=""/><div class=""><h2 id="4e73" class="pw-subtitle-paragraph js iu iv bd b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj dk translated">一个关于你为什么想要使用它们以及它们的主要区别的教程</h2></div><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/84736051b62f87e12c1868e57e7563f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c999rZ5HXEHWupDPffCrVg.jpeg"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">由<a class="ae la" href="https://unsplash.com/@joshgmit?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">乔舒亚·戈德</a>在<a class="ae la" href="https://unsplash.com/s/photos/podium?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2bdc" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">如果你一直在虔诚地练习你的SQL，就像我在<a class="ae la" rel="noopener" target="_blank" href="/top-skills-to-ace-every-sql-interview-question-33356b08845a">顶级技巧中建议的那样，去面对每一个SQL面试问题</a>，那么你可能会遇到使用窗口函数的问题。或者你已经在Leetcode上的讨论或解决方案页面中遇到了他们。</p><p id="3acd" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">窗口函数可能很复杂，但它们使许多问题更容易解决。一旦你学会了最常用的窗口函数，你就可以轻而易举地将它们应用到你的解决方案中。</p><p id="f11f" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">今天我要讲两个对任何类型的排名问题都有帮助的函数——RANK和DENSE_RANK。虽然这些功能相似，但它们确实有所不同。在很多情况下，两者都可以解决你的问题。然而，当你确实需要一个特殊的解决方案时，知道其中的区别仍然是很重要的。</p><h1 id="1be4" class="lx ly iv bd lz ma mb mc md me mf mg mh kb mi kc mj ke mk kf ml kh mm ki mn mo bi translated">他们做什么</h1><p id="0c71" class="pw-post-body-paragraph lb lc iv ld b le mp jw lg lh mq jz lj lk mr lm ln lo ms lq lr ls mt lu lv lw io bi translated">RANK和DENSE_RANK用于对值进行排序，并根据它们相对于彼此的位置为它们分配编号。</p><p id="e364" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">例如，假设你有三个学生，他们有三个不同的考试分数——一个学生得了100分，另一个得了85分，最后一个得了72分。这些函数将根据您希望的排名顺序为每个学生分配1、2或3。</p><h1 id="b3b5" class="lx ly iv bd lz ma mb mc md me mf mg mh kb mi kc mj ke mk kf ml kh mm ki mn mo bi translated">如何使用它们</h1><p id="8343" class="pw-post-body-paragraph lb lc iv ld b le mp jw lg lh mq jz lj lk mr lm ln lo ms lq lr ls mt lu lv lw io bi translated">这两个函数都使用OVER()子句以及PARTITION BY和ORDER BY。函数的part BY是可选的，但是ORDER BY总是必需的。</p><p id="0b02" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><code class="fe mu mv mw mx b">SELECT student_name, RANK() OVER(ORDER BY grades DESC) AS grade_ranking</code></p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi my"><img src="../Images/17b9cc33aa0c61481662d00c49d1700c.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/1*JCLYF6Fo6-ACgp7BIVhB7g.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</p></figure><p id="1578" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">在这里，您可以看到最高等级的等级为1，最低等级为5，因为它们是按降序排列的。</p><p id="94d6" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><strong class="ld iw"> ORDER BY </strong>指定要对其值进行排序的列。在前面的示例中，等级是在ORDER BY之后指定的。您可以按降序或升序排列值。</p><p id="8de2" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">在上面的代码片段中，我们从最高等级到最低等级排序(DESC)，下面我们从最低等级到最高等级排序(ASC)。</p><p id="debb" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><code class="fe mu mv mw mx b">SELECT student_name, RANK() OVER(ORDER BY grades ASC) AS grade_ranking</code></p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/b0f92cb47f44c1f307ce37e68077a8ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:574/format:webp/1*I-fpLbIvBx4YIAs6XOgLwA.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</p></figure><p id="9a8d" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">在这里，您可以看到最低等级的等级为1，最高等级的等级为5，因为等级是按升序排列的。</p><p id="cf26" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><strong class="ld iw">分区由</strong>组排名。当此处指定的列的值发生变化时，排名会重新开始。假设我们在学生的考试成绩中增加了科目。如果你把数据按主题分类，它会给你每个分数的排名，按主题分组。</p><p id="670d" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><code class="fe mu mv mw mx b">SELECT student_name, DENSE_RANK() OVER(PARTITION BY subject ORDER BY grades DESC) AS grade_ranking</code></p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi na"><img src="../Images/1b205a1d9afb56a129b857067c4efdbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*B2saV3gTQ9TyXA2lyU3QLw.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</p></figure><p id="e84f" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">正如你所看到的，每门课的最高分被定为1分，其余的分数也根据他们在这门课中的位置进行排名。</p><h1 id="944f" class="lx ly iv bd lz ma mb mc md me mf mg mh kb mi kc mj ke mk kf ml kh mm ki mn mo bi translated">秩和DENSE_RANK的区别</h1><p id="c643" class="pw-post-body-paragraph lb lc iv ld b le mp jw lg lh mq jz lj lk mr lm ln lo ms lq lr ls mt lu lv lw io bi translated">这两个函数的区别在于它们如何处理相同的值。假设我们有两个成绩相同的学生。两人的数学考试都得了90分。</p><p id="bb5f" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">RANK和DENSE_RANK将根据等级与其他值相比的排名情况为等级分配相同的排名。然而，RANK将跳过下一个可用的排名值，而DENSE_RANK将仍然使用下一个按时间顺序排列的排名值。</p><p id="9626" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">因此，对于等级，如果两个90的等级为2，下一个最低值将被分配为4，跳过3。使用DENSE_RANK，下一个最低的值将被分配等级3，而不会跳过任何值。</p><p id="1b96" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">让我们比较一下这两个函数的结果。</p><p id="9f48" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated"><code class="fe mu mv mw mx b">SELECT student_name, RANK() OVER(ORDER BY grades DESC) AS rank_w_rank, DENSE_RANK() OVER(ORDER BY grades DESC) AS rank_w_dense_rank</code></p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/66e31630871e6fa359542bc5cead522a.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*2gBahGBXxBxUJJk2ah044A.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</p></figure><p id="5612" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">同样，您可以看到使用rank的列中没有rank 2，而DENSE_RANK列包含rank 2并以rank 4结尾，尽管表中有5行。</p><p id="761f" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">希望你现在明白如何使用RANK和DENSE_RANK以及何时使用它们。通常，我使用DENSE_RANK作为我在SQL中的默认排名函数。我发现更多的问题希望你按照时间顺序排列，不要跳过一个数字。但是，请确保您仔细阅读了问题，并考虑了您试图实现的输出。</p><p id="c93d" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">如果你正在准备SQL面试，一定要看看我的文章<a class="ae la" rel="noopener" target="_blank" href="/top-skills-to-ace-every-sql-interview-question-33356b08845a">每一个SQL面试问题的顶级技巧</a>。</p><p id="3a38" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">查询愉快！</p><p id="f164" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">通过订阅我的电子邮件列表，了解更多关于SQL和分析工程师使用的其他工具的信息。</p></div></div>    
</body>
</html>