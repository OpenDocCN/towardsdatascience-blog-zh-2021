<html>
<head>
<title>Stop Using CSVs for Storage — This File Format Is 150 Times Faster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">停止使用CSV进行存储—这种文件格式速度快150倍</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/stop-using-csvs-for-storage-this-file-format-is-150-times-faster-158bd322074e?source=collection_archive---------0-----------------------#2021-09-06">https://towardsdatascience.com/stop-using-csvs-for-storage-this-file-format-is-150-times-faster-158bd322074e?source=collection_archive---------0-----------------------#2021-09-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="40cd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">CSV耗费您的时间、磁盘空间和金钱。是时候结束了。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a71b39da957c436e91556dc7f04f4efe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2cMo4bAgsAHZrxR-M7b_WA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">汤姆·斯温宁从派克斯<a class="ae ky" href="https://www.pexels.com/photo/selective-focus-photograph-of-black-crow-946344/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">拍摄的照片</a></p></figure><p id="27e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CSV不是唯一的数据存储格式。事实上，这可能是你应该考虑的最后一个。如果你不打算手动编辑保存的数据，坚持这样做是在浪费时间和金钱。</p><p id="d4d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想象一下，你收集了大量的数据，并将它们存储在云中。您没有对文件格式做太多的研究，所以您选择了CSV。你的费用高得惊人！一个简单的调整可以减少一半，如果不是更多的话。这个调整就是——你已经猜到了——选择不同的文件格式。</p><p id="3f0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天，您将了解羽毛数据格式的来龙去脉，这是一种用于存储数据帧的快速、轻量级二进制格式。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9510" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">羽毛到底是什么？</h1><p id="17c8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">简单来说，就是一种存储数据帧的数据格式(想想熊猫)。它是围绕一个简单的前提设计的—尽可能有效地将数据帧推入和推出内存。它最初是为Python和R之间的快速通信而设计的，但是您并不局限于这个用例。</p><p id="5a97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，不，Feather并不局限于Python和R——你可以使用每一种主流编程语言中的Feather文件。</p><p id="531f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据格式不是为长期存储而设计的。最初的意图是R和Python程序之间的快速交换，以及一般的短期存储。没人能阻止你把羽毛文件转储到磁盘上，然后保存几年，但是有更有效的格式。</p><p id="6de5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Python中，你可以通过Pandas或一个专用库来使用Feather。本文将向您展示如何使用这两者。你需要安装<code class="fe mz na nb nc b">feather-format</code>来跟随。下面是终端命令:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="3615" class="nh md it nc b gy ni nj l nk nl"># Pip<br/>pip install feather-format<br/><br/># Anaconda<br/>conda install -c conda-forge feather-format</span></pre><p id="5998" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是你开始工作所需要的一切。打开JupyterLab或任何其他<a class="ae ky" rel="noopener" target="_blank" href="/top-4-python-and-data-science-ides-for-2021-and-beyond-3bbcb7b9bc44?source=user_profile---------0----------------------------">数据科学IDE </a>，因为下一节将介绍Feather的基础知识。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9130" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如何在Python中使用羽毛？</h1><p id="3d2c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们从导入库和创建一个相对较大的数据集开始。你将需要羽毛，Numpy和熊猫跟随。数据集将有5列和10M行随机数:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="ee5c" class="nh md it nc b gy ni nj l nk nl">import feather<br/>import numpy as np<br/>import pandas as pd<br/><br/>np.random.seed = 42<br/>df_size = 10_000_000<br/><br/>df = pd.DataFrame({<br/>    'a': np.random.rand(df_size),<br/>    'b': np.random.rand(df_size),<br/>    'c': np.random.rand(df_size),<br/>    'd': np.random.rand(df_size),<br/>    'e': np.random.rand(df_size)<br/>})<br/>df.head()</span></pre><p id="ccaa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是数据集的外观:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/8da0a9c4cb0c1c7863247aa9e50d183c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nIqMq-l7thCt1BUZ153oEA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片1-随机虚拟数据集(图片由作者提供)</p></figure><p id="18d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来就本地保存吧。您可以使用以下命令将数据帧保存为带有熊猫的羽化格式:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="18ac" class="nh md it nc b gy ni nj l nk nl">df.to_feather('1M.feather')</span></pre><p id="8250" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是如何用羽毛库做同样的事情:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="47a3" class="nh md it nc b gy ni nj l nk nl">feather.write_dataframe(df, '1M.feather')</span></pre><p id="2f9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没多大区别。这两个文件现在都保存在本地。你可以用熊猫或者专用图书馆来阅读它们。首先是熊猫的语法:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="720e" class="nh md it nc b gy ni nj l nk nl">df = pd.read_feather('1M.feather')</span></pre><p id="e29b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您正在使用羽毛库，请将其更改为以下内容:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="324a" class="nh md it nc b gy ni nj l nk nl">df = feather.read_dataframe('1M.feather')</span></pre><p id="7b4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这涵盖了你应该知道的一切。下一节介绍了与CSV文件格式的比较，包括文件大小、读取和写入时间。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1d89" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">CSV与Feather——您应该使用哪一个？</h1><p id="944d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您不需要即时更改数据，答案很简单—您应该使用Feather over CSV。尽管如此，让我们做一些测试。</p><p id="7e6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图显示了在本地保存上一部分的数据帧所需的时间:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/cc5908a9c669b26cb2543c70bb38bc79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jXNS0D4btA21ftIBBrbf_Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2 — CSV与Feather本地保存时间(秒)(CSV:35.6；羽毛(熊猫):0.289；羽毛:0.235)(图片由作者提供)</p></figure><p id="3393" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个巨大的差异——native Feather比CSV快150倍左右。如果您使用Pandas来处理羽毛文件，这没有太大关系，但是与CSV相比，速度的提高是显著的。</p><p id="c352" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们比较一下读取时间—读取不同格式的相同数据集需要多长时间:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/da67a0faaa30577ffb4e94c6a4c23563.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SOhVXasSG16f3UKyeTtQ3A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3 — CSV与以秒为单位的羽毛读取时间(CSV:3.85；羽毛(熊猫):0.472；羽毛:0.326)(图片由作者提供)</p></figure><p id="0299" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">再一次，显著的差异。CSV的读取速度要慢得多。当然，它们会占用更多的磁盘空间，但是具体会多多少呢？</p><p id="ae11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是下一个可视化的答案:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/6f2bba8df6557e651868584e49eafa26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yE4qPS-QlrQX2EtbCpwZpw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4 — CSV与Feather文件大小(CSV:963.5 MB；羽毛:400.1 MB)(图片由作者提供)</p></figure><p id="d4ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，CSV文件占用的空间是羽化文件的两倍多。</p><p id="d1d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您每天存储千兆字节的数据，选择正确的文件格式至关重要。在这方面，Feather击败了CSV。如果你需要更多的压缩，你应该试试T4拼花地板。我发现这是迄今为止最好的格式。</p><p id="dd77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">综上所述，将<code class="fe mz na nb nc b">to_csv()</code>改为<code class="fe mz na nb nc b">to_feather()</code>，将<code class="fe mz na nb nc b">read_csv()</code>改为<code class="fe mz na nb nc b">read_feather()</code>可以为你节省大量的时间和磁盘空间。在您的下一个大数据项目中考虑这一点。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="f3ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="np">喜欢这篇文章吗？成为</em> <a class="ae ky" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="np">中等会员</em> </a> <em class="np">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="nq nr gp gr ns nt"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd iu gy z fp ny fr fs nz fu fw is bi translated">阅读达里奥·拉德契奇(以及媒体上数以千计的其他作家)的每一个故事</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">medium.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh ks nt"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="81bd" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">保持联系</h1><ul class=""><li id="9d8a" class="oi oj it lb b lc mu lf mv li ok lm ol lq om lu on oo op oq bi translated">在<a class="ae ky" href="https://medium.com/@radecicdario" rel="noopener"> Medium </a>上关注我，了解更多类似的故事</li><li id="541f" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated">注册我的<a class="ae ky" href="https://mailchi.mp/46a3d2989d9b/bdssubscribe" rel="noopener ugc nofollow" target="_blank">简讯</a></li><li id="9ad4" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated">在<a class="ae ky" href="https://www.linkedin.com/in/darioradecic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上连接</li></ul></div></div>    
</body>
</html>