<html>
<head>
<title>Docker based RStudio &amp; PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Docker的RStudio和PostgreSQL</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/docker-based-rstudio-postgresql-fbeefe8285bf?source=collection_archive---------14-----------------------#2021-08-07">https://towardsdatascience.com/docker-based-rstudio-postgresql-fbeefe8285bf?source=collection_archive---------14-----------------------#2021-08-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1200" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><em class="kf">这是与Docker、PostgreSQL数据库和异常数据集相关的两篇文章的第一部分。</em></h2></div><h1 id="8ae9" class="kg kh iq bd ki kj kk kl km kn ko kp kq jw kr jx ks jz kt ka ku kc kv kd kw kx bi translated">背景</h1><p id="0d5a" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">在最近的LinkedIn帖子(<a class="ae lu" href="https://www.linkedin.com/posts/rahulsangole_rstats-datascience-analytics-activity-6824183826877698048-0ImA" rel="noopener ugc nofollow" target="_blank">原创</a>和<a class="ae lu" href="https://github.com/RamiKrispin" rel="noopener ugc nofollow" target="_blank"> Rami </a>的<a class="ae lu" href="https://www.linkedin.com/posts/rami-krispin_anomalydetection-data-timeseries-activity-6825126331672612864-MEks" rel="noopener ugc nofollow" target="_blank">转帖</a>和<a class="ae lu" href="https://twitter.com/rsangole/status/1418418477329620993" rel="noopener ugc nofollow" target="_blank">推文</a>)中，我向互联网询问他们最喜欢的异常检测问题数据集，特别是在时间序列领域。我收到了很多回复，现在有了大量的数据可以处理，谢谢回复的人们。</p><p id="5793" class="pw-post-body-paragraph ky kz iq la b lb lv jr ld le lw ju lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">为了处理这些数据，我需要一个比将数据保存为CSV文件、<code class="fe ma mb mc md b">qs</code>对象或R包更好的解决方案。我想要一个数据库来存储原始输入数据、我处理过的数据和算法结果。虽然我过去以传统方式设置数据库，但这次我希望整个代码库是可移植的&amp;可复制的。</p><p id="ed7a" class="pw-post-body-paragraph ky kz iq la b lb lv jr ld le lw ju lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">结果，我用Docker设置了所有的东西，它工作起来很流畅。如果你想了解如何做到这一点，请关注我的下一篇文章:</p><ul class=""><li id="7a10" class="me mf iq la b lb lv le lw lh mg ll mh lp mi lt mj mk ml mm bi translated">第一部分—(这篇文章)将教你如何为个人PostgreSQL数据库+ RStudio代码开发建立一个简单的可重复的基于Docker的工作流</li><li id="3cd1" class="me mf iq la b lb mn le mo lh mp ll mq lp mr lt mj mk ml mm bi translated">第二部分—(下一篇文章)将是异常数据的ETL管道</li></ul><h1 id="1ce8" class="kg kh iq bd ki kj kk kl km kn ko kp kq jw kr jx ks jz kt ka ku kc kv kd kw kx bi translated">你为什么要读这个？</h1><p id="50f2" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">在本教程结束时，您将能够快速设置一个基于Docker的个人PostgreSQL数据库。您将学习如何使用<code class="fe ma mb mc md b">docker-compose</code>快速部署PostgreSQL &amp; RStudio。您将能够访问R中的数据库，并立即开始开发。最重要的是，整个过程将是完全可复制的，因为您继承了安装脚本和Docker的优点。</p><p id="ba7b" class="pw-post-body-paragraph ky kz iq la b lb lv jr ld le lw ju lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated"><em class="ms">本教程假设您熟悉Docker环境中的Docker和RStudio。如果你不是，我推荐先阅读R </em>  <em class="ms">中的</em> <a class="ae lu" href="https://rsangole.medium.com/reproducible-work-in-r-e7d160d5d198" rel="noopener"> <em class="ms">可复制作品。</em></a></p><h1 id="0144" class="kg kh iq bd ki kj kk kl km kn ko kp kq jw kr jx ks jz kt ka ku kc kv kd kw kx bi translated">概观</h1><p id="e5e4" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">您将启动两个Docker映像:</p><ol class=""><li id="1b8b" class="me mf iq la b lb lv le lw lh mg ll mh lp mi lt mt mk ml mm bi translated">PostgreSQL图像。我选择<code class="fe ma mb mc md b"><a class="ae lu" href="https://hub.docker.com/_/postgres/" rel="noopener ugc nofollow" target="_blank">postgres:13.3</a></code></li><li id="9b44" class="me mf iq la b lb mn le mo lh mp ll mq lp mr lt mt mk ml mm bi translated">RStudio图像。我选择<code class="fe ma mb mc md b"><a class="ae lu" href="https://hub.docker.com/r/hatmatrix/blog/tags?page=1&amp;ordering=last_updated" rel="noopener ugc nofollow" target="_blank">hatmatrix/blog:base</a></code> <em class="ms"> </em></li></ol><p id="5615" class="pw-post-body-paragraph ky kz iq la b lb lv jr ld le lw ju lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">为了在容器寿命结束后永久存储数据，您将装入两个卷，每个容器一个卷。我选择了:</p><ol class=""><li id="21a0" class="me mf iq la b lb lv le lw lh mg ll mh lp mi lt mt mk ml mm bi translated">对于PostgreSQL: <code class="fe ma mb mc md b">$HOME/docker/volumes/postgres</code></li><li id="1a65" class="me mf iq la b lb mn le mo lh mp ll mq lp mr lt mt mk ml mm bi translated">对于R项目:<code class="fe ma mb mc md b">$HOME/github</code></li></ol><figure class="mv mw mx my gt mz gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi mu"><img src="../Images/2bd1df6b5ff89132a3f284964a21d3ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TtTrFUtZy2sT3D_N.png"/></div></div><p class="ng nh gj gh gi ni nj bd b be z dk translated">由作者创建的设置概述。从flaticon.com获得的图标。</p></figure><p id="5be3" class="pw-post-body-paragraph ky kz iq la b lb lv jr ld le lw ju lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">除了容器内PostgreSQL之外，这些路径都不是特殊的；你可以根据自己的喜好定制其他的。默认情况下，<code class="fe ma mb mc md b">postgres:13.3</code>希望数据库位于<code class="fe ma mb mc md b">/var/lib/postgresql/data</code>。如果您选择另一个数据库，请相应地修改它。</p><p id="9f0e" class="pw-post-body-paragraph ky kz iq la b lb lv jr ld le lw ju lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">我使用<code class="fe ma mb mc md b">docker-compose</code>同时启动PostgreSQL和RStudio服务。这很方便，同时也确保了PostgreSQL服务首先运行，然后是RStudio。只需几个命令就可以轻松启动或停止所有服务。</p><h1 id="ee6a" class="kg kh iq bd ki kj kk kl km kn ko kp kq jw kr jx ks jz kt ka ku kc kv kd kw kx bi translated">首次设置</h1><p id="5c16" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">第一次设置PostgreSQL数据库时，需要运行这些步骤。我已经将这些步骤存储在<code class="fe ma mb mc md b"><a class="ae lu" href="https://github.com/rsangole/postgres/blob/master/00-postgres-init.sh" rel="noopener ugc nofollow" target="_blank">00-postgres-init.sh</a></code> <a class="ae lu" href="https://github.com/rsangole/postgres/blob/master/00-postgres-init.sh" rel="noopener ugc nofollow" target="_blank">中。</a></p><h2 id="2beb" class="nk kh iq bd ki nl nm dn km nn no dp kq lh np nq ks ll nr ns ku lp nt nu kw nv bi translated">1-目录设置</h2><p id="434f" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">您需要一个本地目录来存储PostgreSQL数据库。第3-10行为您处理这个问题。</p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="nw nx l"/></div></figure><h2 id="59fc" class="nk kh iq bd ki nl nm dn km nn no dp kq lh np nq ks ll nr ns ku lp nt nu kw nv bi translated">2-PostgreSQL设置</h2><p id="29f0" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">现在是设置数据库的时候了。您至少需要两步才能开始:</p><ol class=""><li id="3f82" class="me mf iq la b lb lv le lw lh mg ll mh lp mi lt mt mk ml mm bi translated">一个新的“角色”(类似于登录)，有权创建新的数据库。</li><li id="fc43" class="me mf iq la b lb mn le mo lh mp ll mq lp mr lt mt mk ml mm bi translated">至少要在一个数据库中工作。在我的脚本中，我做了两个:<code class="fe ma mb mc md b">work</code>和<code class="fe ma mb mc md b">anomaly</code>。</li></ol><p id="c5c7" class="pw-post-body-paragraph ky kz iq la b lb lv jr ld le lw ju lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">要操作数据库，需要运行PostgreSQL服务器来处理<code class="fe ma mb mc md b">psql</code>命令。您将使用<code class="fe ma mb mc md b">docker run</code>启动一个。您需要使用<code class="fe ma mb mc md b">-v</code>安装正确的卷。接下来，我们通过将<code class="fe ma mb mc md b">psql</code>命令传送到<code class="fe ma mb mc md b">docker exec</code>来创建角色和数据库。然后，我们停止集装箱</p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="0dcf" class="pw-post-body-paragraph ky kz iq la b lb lv jr ld le lw ju lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">总之，现在我有了一个PostgresSQL数据库:</p><ul class=""><li id="7e01" class="me mf iq la b lb lv le lw lh mg ll mh lp mi lt mj mk ml mm bi translated">存储在<code class="fe ma mb mc md b">$HOME/docker/volumes/postgres</code></li><li id="97c3" class="me mf iq la b lb mn le mo lh mp ll mq lp mr lt mj mk ml mm bi translated">有了新的角色<code class="fe ma mb mc md b">rahul</code>和密码<code class="fe ma mb mc md b">pass</code></li><li id="e6f3" class="me mf iq la b lb mn le mo lh mp ll mq lp mr lt mj mk ml mm bi translated">有两个数据库:<code class="fe ma mb mc md b">work</code>和<code class="fe ma mb mc md b">anomaly</code></li></ul><h1 id="15d6" class="kg kh iq bd ki kj kk kl km kn ko kp kq jw kr jx ks jz kt ka ku kc kv kd kw kx bi translated">日常工作流程</h1><h2 id="f799" class="nk kh iq bd ki nl nm dn km nn no dp kq lh np nq ks ll nr ns ku lp nt nu kw nv bi translated">tldr:你是如何开始的？</h2><ol class=""><li id="4244" class="me mf iq la b lb lc le lf lh ny ll nz lp oa lt mt mk ml mm bi translated">将<code class="fe ma mb mc md b"><a class="ae lu" href="https://github.com/rsangole/postgres/blob/master/docker-compose.yml" rel="noopener ugc nofollow" target="_blank">docker-compose.yml</a></code>存储在本地目录中</li><li id="e126" class="me mf iq la b lb mn le mo lh mp ll mq lp mr lt mt mk ml mm bi translated">如果您更改了我选择的图像/目录，请对其进行修改</li><li id="352a" class="me mf iq la b lb mn le mo lh mp ll mq lp mr lt mt mk ml mm bi translated">在shell中，运行<code class="fe ma mb mc md b">docker-compose up -d</code></li></ol><p id="d897" class="pw-post-body-paragraph ky kz iq la b lb lv jr ld le lw ju lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated"><em class="ms"> protip </em>:要启动一个浏览器(firefox for me)直接进入RStudio，在你有<code class="fe ma mb mc md b">docker-compose.yml</code>的目录下运行这个命令:</p><pre class="mv mw mx my gt ob md oc od aw oe bi"><span id="b6c9" class="nk kh iq md b gy of og l oh oi">docker-compose up -d; firefox localhost:8787</span></pre><p id="271e" class="pw-post-body-paragraph ky kz iq la b lb lv jr ld le lw ju lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated"><em class="ms"> pro-protip </em>:保存一个别名，通用化命令。<code class="fe ma mb mc md b">-f</code>参数指示<code class="fe ma mb mc md b">docker-compose</code>你想要使用哪个文件。现在可以在系统的任何地方运行。</p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="nw nx l"/></div></figure><h2 id="2898" class="nk kh iq bd ki nl nm dn km nn no dp kq lh np nq ks ll nr ns ku lp nt nu kw nv bi translated">崩溃</h2><p id="14a5" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated"><code class="fe ma mb mc md b"><a class="ae lu" href="https://github.com/rsangole/postgres/blob/master/docker-compose.yml" rel="noopener ugc nofollow" target="_blank">docker-compose.yml</a></code>里有什么？我们正在创建两个服务，一个叫做<code class="fe ma mb mc md b">db</code>，另一个叫做<code class="fe ma mb mc md b">rstudio</code>。⁴</p><p id="6046" class="pw-post-body-paragraph ky kz iq la b lb lv jr ld le lw ju lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">先来看<code class="fe ma mb mc md b">db</code>。如果你熟悉<code class="fe ma mb mc md b">docker run</code> args，大多数参数看起来都很熟悉。这里的新特性是<code class="fe ma mb mc md b">restart: unless-stopped</code> arg，它告诉Docker只在PostgreSQL当前停止时才启动它。</p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="ec5a" class="pw-post-body-paragraph ky kz iq la b lb lv jr ld le lw ju lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">第二个服务是<code class="fe ma mb mc md b">rstudio</code>。除了典型的参数之外，这里有趣的参数是<code class="fe ma mb mc md b">depends_on</code>，它告诉Docker只在数据库启动并运行之后运行这个映像<em class="ms">。太棒了。</em></p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="nw nx l"/></div></figure><h2 id="7609" class="nk kh iq bd ki nl nm dn km nn no dp kq lh np nq ks ll nr ns ku lp nt nu kw nv bi translated">通过R连接</h2><p id="ae70" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">用于测试您的连接。运行你的<code class="fe ma mb mc md b">DBI::</code>命令，除了有一个关键的不同。</p><p id="6a9c" class="pw-post-body-paragraph ky kz iq la b lb lv jr ld le lw ju lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">建立连接时，确保<code class="fe ma mb mc md b">host</code>的名称是您在<code class="fe ma mb mc md b">docker-compose.yml</code>中选择的数据库服务的名称。(在docker之外，您通常会使用<code class="fe ma mb mc md b">localhost</code>来连接本地PostgreSQL服务器)。</p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="27e0" class="pw-post-body-paragraph ky kz iq la b lb lv jr ld le lw ju lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">就是这样！你现在要去比赛了。像平常一样使用数据库</p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="nw nx l"/></div></figure><h2 id="d64e" class="nk kh iq bd ki nl nm dn km nn no dp kq lh np nq ks ll nr ns ku lp nt nu kw nv bi translated">停止服务</h2><p id="b173" class="pw-post-body-paragraph ky kz iq la b lb lc jr ld le lf ju lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">您有两种选择:</p><ol class=""><li id="f6ba" class="me mf iq la b lb lv le lw lh mg ll mh lp mi lt mt mk ml mm bi translated"><code class="fe ma mb mc md b">docker-compose stop</code>将停止服务，您可以使用<code class="fe ma mb mc md b">docker-compose start</code>重新启动服务。</li><li id="c531" class="me mf iq la b lb mn le mo lh mp ll mq lp mr lt mt mk ml mm bi translated"><code class="fe ma mb mc md b">docker-compose down</code>将容器也取出。再次运行<code class="fe ma mb mc md b">docker-compose up</code>开始运行。</li></ol></div><div class="ab cl oj ok hu ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="ij ik il im in"><p id="ac66" class="pw-post-body-paragraph ky kz iq la b lb lv jr ld le lw ju lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated"><em class="ms">8月8日编辑:</em>我刚刚得知，我的<a class="ae lu" href="https://rsangole.netlify.app/post/2021/08/07/docker-based-rstudio-postgres/" rel="noopener ugc nofollow" target="_blank">原始博客</a>的脚注没有转到媒体上。他们在这里:</p><ol class=""><li id="a391" class="me mf iq la b lb lv le lw lh mg ll mh lp mi lt mt mk ml mm bi translated">我喋喋不休地谈论“个人”，因为我没有在工作环境中设置适当的角色、授权等。但是，它对我个人使用来说足够好了。</li><li id="fedf" class="me mf iq la b lb mn le mo lh mp ll mq lp mr lt mt mk ml mm bi translated">这是我自己根据<code class="fe ma mb mc md b"><a class="ae lu" href="https://hub.docker.com/r/rocker/rstudio" rel="noopener ugc nofollow" target="_blank">rocker/rstudio</a></code>拍摄的照片</li><li id="f516" class="me mf iq la b lb mn le mo lh mp ll mq lp mr lt mt mk ml mm bi translated"><em class="ms">属性:<br/> </em> DB图标由<a class="ae lu" href="https://www.flaticon.com/authors/pixel-perfect" rel="noopener ugc nofollow" target="_blank">像素完善</a> <br/>文件夹图标由<a class="ae lu" href="https://www.flaticon.com/authors/icongeek26" rel="noopener ugc nofollow" target="_blank">图标极客26 </a> <br/> RAM图标由<a class="ae lu" href="https://www.freepik.com/" rel="noopener ugc nofollow" target="_blank"> Freepik </a> <br/>存储图标由<a class="ae lu" href="https://smashicons.com/" rel="noopener ugc nofollow" target="_blank"> Smashicons </a></li><li id="2127" class="me mf iq la b lb mn le mo lh mp ll mq lp mr lt mt mk ml mm bi translated">这些只是标签，你可以随便叫它们</li></ol></div><div class="ab cl oj ok hu ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="ij ik il im in"><p id="e252" class="pw-post-body-paragraph ky kz iq la b lb lv jr ld le lw ju lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated"><em class="ms">原载于</em><a class="ae lu" href="https://rsangole.netlify.app/post/2021/08/07/docker-based-rstudio-postgres/" rel="noopener ugc nofollow" target="_blank"><em class="ms">https://rsangole . netlify . app</em></a><em class="ms">。</em></p></div></div>    
</body>
</html>