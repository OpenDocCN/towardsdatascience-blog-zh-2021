<html>
<head>
<title>Marimekko Charts with Python’s Matplotlib</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python的Matplotlib制作Marimekko图表</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/marimekko-charts-with-pythons-matplotlib-6b9784ae73a1?source=collection_archive---------12-----------------------#2021-04-10">https://towardsdatascience.com/marimekko-charts-with-pythons-matplotlib-6b9784ae73a1?source=collection_archive---------12-----------------------#2021-04-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2388" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">可视化分组和分段比例的好方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6bd6c2cdd955cf687c54e5a1bc55cb70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gqMEq26elQzcWJZDWGCjkQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Marimekko图表—图片由作者提供</p></figure><p id="f790" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通常被称为马赛克图，脊柱图，或只是Mekko。在其他应用程序中，该图表通常用作市场地图，以可视化按客户类型、地区和许多其他变量划分的行业。</p><p id="06c1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本质上，它们只是一个堆叠的条形图，其中的条形宽度用于显示另一个变量，通常是整个组占总数的比例。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lu"><img src="../Images/5d8c1ae50c8e0651ef41ff2526f70ee1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sX5Y6AIeIAi-2e10GJq5yg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Marimekko图表—图片由作者提供</p></figure><p id="6a4e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">比例对于发现模式和比较不同规模的群体非常有用。本文将探讨如何用Matplotlib中的Marimekko图表来改进我们可视化它们的方式。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="15b5" class="mc md it bd me mf mg dn mh mi mj dp mk lh ml mm mn ll mo mp mq lp mr ms mt mu bi translated">为什么要使用Marimekko图表</h2><p id="1131" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">我们将通过一个Marimekko图表的快速示例来说明它们的可用性，最后，我们将看到如何更系统地绘制它们。</p><p id="6879" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我们将导入我们将使用的库。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="3068" class="mc md it nb b gy nf ng l nh ni">import pandas as pd<br/>import matplotlib.pyplot as plt<br/>import numpy as np</span></pre><p id="9f2d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我们公司，部门<strong class="la iu"> A </strong>的30人和部门<strong class="la iu"> B </strong>的20人希望继续远程工作。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="584b" class="mc md it nb b gy nf ng l nh ni">y = np.array([.3, .4, .7, .8]) * np.array([100., 50., 100., 300.])<br/>x_label = ['a','b','c', 'd']<br/>plt.bar(x_label, y)<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/3725ef70b9aa22701d0cb4fed24e512a.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*FMe9uScw06YPNQ6__BPmZg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">条形图—作者提供的图片</p></figure><p id="f178" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">光是这些信息是没有帮助的，而且可能会产生误导，因为我们不知道每个部门有多少人在工作。分析比例会更有见地。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="a34c" class="mc md it nb b gy nf ng l nh ni">y = [.3, .4, .7, .8]<br/>x_label = ['a','b','c', 'd']</span><span id="970a" class="mc md it nb b gy nk ng l nh ni">plt.bar(x_label, y) # bottom bar<br/>plt.bar(x_label, np.ones(len(y))-y, bottom=y) # top bar</span><span id="b197" class="mc md it nb b gy nk ng l nh ni">plt.ylim(0,1)<br/>plt.yticks([0, 0.25, 0.5, 0.75, 1], ['0%', '25%', '50%', '75%', '100%'])</span><span id="1b9f" class="mc md it nb b gy nk ng l nh ni">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/09c1021cf7e06ab24fcd464d379f2708.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*wAOb_IOyh7u6Gw8l6jmSFQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">百分比堆积条形图—图片由作者提供</p></figure><p id="3c65" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是，假设我们也想把所有部门想象成一个整体。上面的图表可能也会误导我们。我们可以说这是一个整体“分裂”的意见；一半部门在50%以上，另一半在50%以下，这是不对的。</p><p id="dc24" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了从整体上了解各个部门，我们需要多种可视化或不同的方法，如树状图和<strong class="la iu"> Marimekko图表</strong>。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="2563" class="mc md it nb b gy nf ng l nh ni">fig, ax = plt.subplots(1)<br/>y = [.3, .4, .7, .8]<br/>x = [100, 50, 100, 300]<br/>x_label = ['a','b','c', 'd']<br/>width = [i/sum(x) for i in x]</span><span id="6b29" class="mc md it nb b gy nk ng l nh ni"># calculate x coordinates based on the width of the previous bars<br/># same as: [0, width[0], width[0] + width[1], width[0] + width[1] + width[2]]<br/>adjusted_x, temp = [0], 0<br/>for i in width[:-1]:<br/>    temp += i<br/>    adjusted_x.append(temp)</span><span id="5375" class="mc md it nb b gy nk ng l nh ni"># Marimekko chart<br/>plt.bar(adjusted_x, y, width=width, align='edge', edgecolor='black')<br/>plt.bar(adjusted_x, np.ones(len(y))-y, bottom=y, width=width, align='edge', edgecolor='black')</span><span id="42b1" class="mc md it nb b gy nk ng l nh ni"># x and y ticks (%)<br/>ax.set_yticks([0, 0.25, 0.5, 0.75, 1])<br/>ax.set_yticklabels(['0%', '25%', '50%', '75%', '100%'])<br/>ax.set_xticks([0, 0.25, 0.5, 0.75, 1])<br/>ax.set_xticklabels(['0%', '25%', '50%', '75%', '100%'])</span><span id="8338" class="mc md it nb b gy nk ng l nh ni">plt.ylim(0,1)<br/>plt.xlim(0,1)</span><span id="9edd" class="mc md it nb b gy nk ng l nh ni"># twin y-axis to draw x-ticks at the top<br/>axy = ax.twiny()<br/>axy.set_xticks([(width[i]/2)+ v for i, v in enumerate(adjusted_x)])<br/>axy.set_xticklabels(x_label, fontsize=14)</span><span id="11d5" class="mc md it nb b gy nk ng l nh ni">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/f188c56db093b2ac2afcc3262592abab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*8Mmwmoywv94XK4-p65Owkw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Mekko图表—图片由作者提供</p></figure><p id="e9dd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这种可视化帮助我们毫不费力地将部门内的比例以及每个部门占总数的比例可视化。</p><p id="54e3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以清楚地看到，我们公司的绝大多数人都希望继续远程工作，但我们仍然注意到，较小的部门似乎不太热衷于这一想法。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="0fba" class="mc md it bd me mf mg dn mh mi mj dp mk lh ml mm mn ll mo mp mq lp mr ms mt mu bi translated">数据集</h2><p id="9967" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">现在，为了更系统地使用Marimekko图表，让我们尝试使用Pandas数据框。这样，我们可以更容易地在列、行和数据集之间切换。</p><p id="2509" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我将使用的数据集来自<a class="ae nn" href="https://data.worldbank.org/" rel="noopener ugc nofollow" target="_blank">世界银行公开数据</a>。我想将一些指标的比例形象化，如<a class="ae nn" href="https://data.worldbank.org/indicator/SP.RUR.TOTL.ZS" rel="noopener ugc nofollow" target="_blank">农村人口</a>、<a class="ae nn" href="https://data.worldbank.org/indicator/EG.ELC.ACCS.ZS" rel="noopener ugc nofollow" target="_blank">用电</a>和<a class="ae nn" href="https://data.worldbank.org/indicator/SE.ADT.LITR.ZS" rel="noopener ugc nofollow" target="_blank">识字率</a>。但我也想说明这些国家占总人口的比例。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/f2741001cb2b6c049e0f62bec9f0a155.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dOsi3IGPHWJc59zdlQbudA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">人口数据框-图片由作者提供</p></figure><p id="3959" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">世界银行数据集可能包含一些区域、次区域、社会经济群体等行，但我们希望将国家与其他国家进行比较。我们需要一些国家的列表来清理我们的数据框架，例如<em class="np">所有国家</em>、<em class="np">拉丁美洲&amp;加勒比海</em>、<em class="np">欧盟</em>等等。</p><p id="fd4f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们还需要考虑，我们不会给每个国家贴标签；那就太杂乱了，所以我们还需要选择一些国家来突出显示。</p><p id="dfb8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于这些内容广泛，我将在这里 留下这部分代码<a class="ae nn" href="https://gist.github.com/Thiagobc23/40054ae4a6e6b98a3abb982cfa645651" rel="noopener ugc nofollow" target="_blank"> <strong class="la iu">的链接。</strong></a></p><p id="bb9e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，让我们创建一些字典，以便更容易地与所有这些列表和值进行交互。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="b4c8" class="mc md it nb b gy nf ng l nh ni">var_dict = {'Rural Population':<br/>             {'file':'API_SP.RUR.TOTL.ZS_DS2_en_csv_v2_2166125.csv',<br/>              'label':'Rural Pop. (%)',<br/>              'legend':['Rural Population', 'Urban Population'],<br/>              'min_year':1960,<br/>              'max_year':2019}, <br/>            <br/>            'Access to Electricity':<br/>             {'file':'API_EG.ELC.ACCS.ZS_DS2_en_csv_v2_2164123.csv',<br/>              'label':'Access to Electricity (%)',<br/>              'legend':['Access to Electricity', <br/>                        'No Access to Electricity'],<br/>              'min_year':1990,<br/>              'max_year':2018},<br/>            <br/>            'Literacy':<br/>             {'file':'API_SE.ADT.LITR.ZS_DS2_en_csv_v2_2163525.csv',<br/>              'label':'Literacy Rate (age +15)',<br/>              'legend':['Literate Pop.', 'Illiterate Pop.'],<br/>              'min_year':1970,<br/>              'max_year':2018},<br/>            <br/>            'Unemployment':<br/>             {'file':'API_SL.UEM.TOTL.ZS_DS2_en_csv_v2_2163385.csv',<br/>              'label':'Unemployment (ILO Estimate)',<br/>              'legend':['Unemployed', 'Employed'],<br/>              'min_year':1991,<br/>              'max_year':2019}}</span><span id="63af" class="mc md it nb b gy nk ng l nh ni">countries_dict = {"All":all_countries,<br/>                  "European Union": eu, <br/>                  "Latin America &amp; Caribbean": la_c,<br/>                  "East Asia and Pacific": eap,<br/>                  "Europe and Central Asia": eca,<br/>                  "Middle East and North Africa": mena,<br/>                  "North America": na,<br/>                  "South Asia" : sa,<br/>                  "Sub-Saharan Africa": ssa,<br/>                  "Custom":False}</span><span id="7ae8" class="mc md it nb b gy nk ng l nh ni">highlights_dict = {"All":highlight_all,<br/>                  "European Union": highlight_eu, <br/>                  "Latin America &amp; Caribbean": highlight_la_c,<br/>                  "East Asia and Pacific": [],<br/>                  "Europe and Central Asia":[],<br/>                  "Middle East and North Africa":[],<br/>                  "North America":[],<br/>                  "South Asia" : [],<br/>                  "Sub-Saharan Africa":[],<br/>                  "Custom":[]}</span></pre><p id="badb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们已经做好了一切准备，可以更有效地与数据集进行交互。现在让我们设置变量并开始清理。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="ec9f" class="mc md it nb b gy nf ng l nh ni">year = 2018<br/>countries_select = "All"<br/>indicator = 'Rural Population'<br/>countries = countries_dict[countries_select]<br/>highlight = highlights_dict[countries_select]</span></pre><p id="9fe3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">无论我们绘制什么指标，人口数据框架都是一样的。尽管如此，指标数据框架将取决于我们从以前的代码中选择，在这种情况下，农村人口。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="61e5" class="mc md it nb b gy nf ng l nh ni">pop_file = 'API_SP.POP.TOTL_DS2_en_csv_v2_2163507.csv'</span><span id="7dc6" class="mc md it nb b gy nk ng l nh ni">df = pd.read_csv('../data/'+pop_file)<br/>var_df = pd.read_csv('../data/'+var_dict[indicator]['file'])</span><span id="aeb7" class="mc md it nb b gy nk ng l nh ni">df = df.merge(var_df, <br/>              left_on='Country Name', <br/>              right_on='Country Name', <br/>              suffixes=['_pop', '_var_df'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/1d4c0c0c1698cb7aa946d2eefa9fd141.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7n7Rfw-7r2NDKu90YBgwPQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">合并的数据框-作者提供的图片</p></figure><p id="4d06" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">合并后的数据框将为人口和变量指标的每一年提供一列。</p><h2 id="0cfe" class="mc md it bd me mf mg dn mh mi mj dp mk lh ml mm mn ll mo mp mq lp mr ms mt mu bi translated">清洁</h2><p id="8e18" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">我们将删除不在列表中的国家，删除没有值的行，并按指标值对行进行排序。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="39c4" class="mc md it nb b gy nf ng l nh ni"># remove non-countries<br/>df = df[df['Country Name'].isin(countries)]</span><span id="7791" class="mc md it nb b gy nk ng l nh ni"># remove rows with empty values for the indicator or population<br/>df = df[(df['{}_var_df'.format(year)].notna() &amp; df['{}_pop'.format(year)].notna())]</span><span id="fe9f" class="mc md it nb b gy nk ng l nh ni"># sort rows by the indicator values <br/>df.sort_values('{}_var_df'.format(year), inplace=True)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/3bd4c6c4178740887d5c92e0d54f2b9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*m9ZhvyfE-9nbLszU1Tcr8A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">经过清理和排序的数据框-图片由作者提供</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="e373" class="mc md it bd me mf mg dn mh mi mj dp mk lh ml mm mn ll mo mp mq lp mr ms mt mu bi translated">准备数据</h2><p id="93b5" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">接下来，我们需要定义Y，这是每个国家的指标值。</p><p id="34cd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">条形的宽度就是人口数量。X是宽度的累积和。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="d634" class="mc md it nb b gy nf ng l nh ni"># get y<br/>y = df['{}_var_df'.format(year)]/100</span><span id="0394" class="mc md it nb b gy nk ng l nh ni"># get the width of the bars (population / 1mi)<br/>width = df['{}_pop'.format(year)].values / 1000000</span><span id="3f59" class="mc md it nb b gy nk ng l nh ni"># calculate the x position of each country<br/># x is the cummulative sum of all previous widths<br/>x = [0]<br/>temp = 0<br/>for i in width[:-1]:<br/>    temp += i<br/>    x.append(temp)</span></pre><p id="479b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将定义的最后一个变量与x记号和国家标签相关。我们将使用高亮列表来绘制记号，获取国家的X和一半宽度来定位标签。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="221c" class="mc md it nb b gy nf ng l nh ni"># create lists with the x ticks positions and labels<br/># based on a list of countries we want to highlight<br/>xticks_pos = []<br/>xticks_labels = [] <br/>for i, v in enumerate(df['Country Name']):<br/>    if v in highlight:<br/>        xticks_pos.append(width[i]/2 + x[i])<br/>        xticks_labels.append(v)</span></pre><p id="a17c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">厉害了，我们有<strong class="la iu"> X </strong>、<strong class="la iu"> Y </strong>、<strong class="la iu">宽度</strong>、<strong class="la iu"> x刻度位置</strong>和<strong class="la iu">标签</strong>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="e1c9" class="mc md it bd me mf mg dn mh mi mj dp mk lh ml mm mn ll mo mp mq lp mr ms mt mu bi translated">绘制Marimekko图表</h2><p id="7de3" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">我们完成了函数的第一部分。现在我们可以开始绘制条形图，并使用变量来绘制Marimekko图。</p><p id="d000" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">默认情况下，Matplotlib在x位置的中心对齐条形，我们需要它们在边缘。我们还需要给每个条形添加一个轮廓，这样我们就可以区分它们。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="02aa" class="mc md it nb b gy nf ng l nh ni">fig, ax = plt.subplots(1, figsize=(24,12))</span><span id="7987" class="mc md it nb b gy nk ng l nh ni"># plot proportions<br/>plt.bar(x, y, <br/>        width=width, <br/>        align='edge', <br/>        edgecolor='w', <br/>        linewidth=0.5, <br/>        color='#559A65')</span><span id="179c" class="mc md it nb b gy nk ng l nh ni"># plot ones - proportions at the top<br/>plt.bar(x, np.ones(len(y))-y, bottom=y, <br/>        width=width, <br/>        align='edge', <br/>        edgecolor='w', <br/>        linewidth = 0.5, <br/>        color='#477C91')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/00cd63538ddad4f7ca376d730c7709ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6uPdzkZpIpkbeWcXV_d0PQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Marimekko图表—图片由作者提供</p></figure><p id="7e76" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们需要修改x和y的限制来删除空白，并用一些适当的值替换x和y记号。</p><p id="e3a2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要在x轴上绘制百分比和标签，我们需要写第一个，设置一个双y轴，然后写另一个。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="566b" class="mc md it nb b gy nf ng l nh ni">fig, ax = plt.subplots(1, figsize=(24,12))</span><span id="26c8" class="mc md it nb b gy nk ng l nh ni">plt.bar(x, y, <br/>        width=width, <br/>        align='edge', <br/>        edgecolor='w', <br/>        linewidth=0.5, <br/>        color='#559A65')</span><span id="f91f" class="mc md it nb b gy nk ng l nh ni">plt.bar(x, np.ones(len(y))-y, bottom=y, <br/>        width=width, <br/>        align='edge', <br/>        edgecolor='w', <br/>        linewidth = 0.5, <br/>        color='#477C91')</span><span id="e882" class="mc md it nb b gy nk ng l nh ni"># xy limits<br/>plt.xlim(0, x[-1]+width[-1])<br/>plt.ylim(0,1)</span><span id="9033" class="mc md it nb b gy nk ng l nh ni"># xy ticks<br/>plt.xticks(xticks_pos, xticks_labels, fontsize=14)<br/>plt.yticks(np.arange(0,1.1,0.25), <br/>          ['{:.0f}%'.format(i*100) for i in np.arange(0,1.1,0.25)],<br/>          fontsize=14)</span><span id="0aad" class="mc md it nb b gy nk ng l nh ni"># twin y-axis to draw x-ticks at the top<br/>axy = ax.twiny()</span><span id="e70e" class="mc md it nb b gy nk ng l nh ni"># max value on the x axis<br/>max_x = (x[-1] + width[-1])</span><span id="033f" class="mc md it nb b gy nk ng l nh ni"># get the values for 0%, 25%, 50%, 75%, and 100%<br/>x_ticks_percent = np.arange(0, max_x+1, max_x/4)</span><span id="d2d9" class="mc md it nb b gy nk ng l nh ni"># set ticks and labels<br/>axy.set_xticks(x_ticks_percent)<br/>axy.set_xticklabels(['{:.0f}%'.format(i*100) for i in x_ticks_percent/max_x],fontsize=14)</span><span id="64b7" class="mc md it nb b gy nk ng l nh ni">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/226e47b56e3cee85672419b3cdfddc84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hvCCpe8U0JO1jRBnQA_Oww.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Marimekko图表—图片由作者提供</p></figure><p id="8d58" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就是这样。我们需要添加一个图例，标题，一些注释，并在一个函数中获得所有这些代码，以方便地切换指标和国家。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="39f0" class="mc md it nb b gy nf ng l nh ni">def marimekko(countries_select, indicator, <br/>              year, countries, highlight):</span><span id="76af" class="mc md it nb b gy nk ng l nh ni">    ##################<br/>    ###### DATA ######<br/>    ##################<br/>    pop_file = 'API_SP.POP.TOTL_DS2_en_csv_v2_2163507.csv'<br/>    df = pd.read_csv('../data/'+pop_file)<br/>    var_df = pd.read_csv('../data/'+var_dict[indicator]['file'])<br/>    df = df.merge(var_df, <br/>                  left_on='Country Name', <br/>                  right_on='Country Name', <br/>                  suffixes=['_pop', '_var_df'])<br/>    <br/>    # remove non-countries<br/>    df = df[df['Country Name'].isin(countries)]</span><span id="c128" class="mc md it nb b gy nk ng l nh ni">    # remove rows with empty values for the indicator or population<br/>    df = df[(df['{}_var_df'.format(year)].notna() &amp; df['{}_pop'.format(year)].notna())]</span><span id="5965" class="mc md it nb b gy nk ng l nh ni">    # sort rows by the indicator values <br/>    df.sort_values('{}_var_df'.format(year), inplace=True)</span><span id="0a8c" class="mc md it nb b gy nk ng l nh ni">    # get y<br/>    y = df['{}_var_df'.format(year)]/100</span><span id="23c4" class="mc md it nb b gy nk ng l nh ni">    # get the width of the bars (population / 1mi)<br/>    width = df['{}_pop'.format(year)].values / 1000000</span><span id="0351" class="mc md it nb b gy nk ng l nh ni">    # calculate the x position of each country<br/>    # x is the cummulative sum of all previous widths<br/>    x = [0]<br/>    temp = 0<br/>    for i in width[:-1]:<br/>        temp += i<br/>        x.append(temp)</span><span id="3d57" class="mc md it nb b gy nk ng l nh ni">    # create lists with the x ticks positions and labels<br/>    # based on a list of countries we want to highlight<br/>    xticks_pos = []<br/>    xticks_labels = [] <br/>    for i, v in enumerate(df['Country Name']):<br/>        if v in highlight:<br/>            xticks_pos.append(width[i]/2 + x[i])<br/>            xticks_labels.append(v)<br/>            <br/>    ##########################<br/>    ########## PLOT ##########<br/>    ##########################<br/>    # define figure and axis<br/>    fig, ax = plt.subplots(1, figsize=(24,12))</span><span id="1813" class="mc md it nb b gy nk ng l nh ni">    # bars<br/>    plt.bar(x, y, align='edge', <br/>            width=width, edgecolor='w', <br/>            linewidth = 0.5, color='#559A65')<br/>    plt.bar(x, np.ones(len(y))-y, bottom=y, <br/>            align='edge', width=width, edgecolor='w', <br/>            linewidth = 0.5, color='#477C91')<br/>    <br/>    # Add notes (Total population and Year)<br/>    total_pop = df['{}_pop'.format(year)].sum()<br/>    if total_pop &gt; 1000000000:<br/>        total_pop = '{:.2f} bi'.format(total_pop/1000000000)<br/>    elif total_pop &gt; 1000000:<br/>        total_pop = '{:.2f} mi'.format(total_pop/1000000)<br/>    else:<br/>        total_pop = '{:.2f}'.format(total_pop)</span><span id="23fb" class="mc md it nb b gy nk ng l nh ni">    notes = 'Total population: {} | Year: {}'.format(total_pop,<br/>                                                     year)<br/>    plt.text(x[-1], 1.07, notes, ha='right', fontsize=20)</span><span id="a004" class="mc md it nb b gy nk ng l nh ni">    # title and legend<br/>    plt.legend(var_dict[indicator]['legend'], <br/>               ncol=2, loc='upper left', fontsize=20,<br/>               frameon=False, bbox_to_anchor=(0,1.11))<br/>    plt.title('{} by Country\n\n'.format(var_dict[indicator]['label']), <br/>              loc='left', fontsize=24)<br/>    <br/>    # xy limits<br/>    plt.xlim(0, x[-1]+width[-1])<br/>    plt.ylim(0,1)</span><span id="f283" class="mc md it nb b gy nk ng l nh ni">    # xy ticks<br/>    plt.xticks(xticks_pos, xticks_labels, fontsize=14)<br/>    plt.yticks(np.arange(0,1.1,0.25), <br/>              ['{:.0f}%'.format(i*100) for i in np.arange(0,1.1,0.25)],<br/>              fontsize=14)<br/>    # twin y-axis to draw x-ticks at the top<br/>    axy = ax.twiny()<br/>    # max value on the x axis<br/>    max_x = (x[-1] + width[-1])<br/>    # get the values for 0%, 25%, 50%, 75%, and 100%<br/>    x_ticks_percent = np.arange(0, max_x+1, max_x/4)<br/>    # set ticks and labels<br/>    axy.set_xticks(x_ticks_percent)<br/>    axy.set_xticklabels(['{:.0f}%'.format(i*100) for i in x_ticks_percent/max_x], <br/>                        fontsize=14)</span><span id="3f22" class="mc md it nb b gy nk ng l nh ni">    plt.savefig('chart.png')</span></pre><p id="6edd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">太棒了，让我们试试我们的新功能。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="e680" class="mc md it nb b gy nf ng l nh ni">year = 2018<br/>countries_select = "All"<br/>indicator = 'Rural Population'<br/>countries = countries_dict[countries_select]<br/>highlight = highlights_dict[countries_select]</span><span id="88b5" class="mc md it nb b gy nk ng l nh ni">marimekko(countries_select, indicator, year, countries, highlight)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/fc37a7fe237abcef8b0f64358d1504f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rVolSss70OtNtT-cZjJfug.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Marimekko图表—图片由作者提供</p></figure><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="22af" class="mc md it nb b gy nf ng l nh ni">year = 2000<br/>countries_select = "European Union"<br/>indicator = 'Unemployment'<br/>countries = countries_dict[countries_select]<br/>highlight = ['Belgium', 'Czech Republic', 'France', 'Germany', <br/>             'Italy', 'Poland', 'Portugal', 'Spain', 'Sweden']</span><span id="13ed" class="mc md it nb b gy nk ng l nh ni">marimekko(countries_select, indicator, year, countries, highlight)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/4af00ada89a1fe8b13638ab116a96798.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tft6jCL8R9c6wU9CVR8JTA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Marimekko图表—图片由作者提供</p></figure><p id="8a18" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">太好了！我们有一个很好的可视化工具，可以让我们检查国家的比例和整体的比例。所有这些都在一个函数中，因此我们可以轻松地在不同的指标和国家组之间切换。</p><p id="1edb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在就看你的了。您可以改进设计，增加交互性，或者在笔记本或脚本中使用它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b27d1f2db4d3162a2f4b0ba901207cca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oBuapb52yDXctxR6CNiSyA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用Python生成并用<a class="ae nn" href="http://pixlr.com" rel="noopener ugc nofollow" target="_blank"> Pixlr </a>编辑的元素—图片由作者提供</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/882cdfaef336a5d3ab8be95e57936a71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*D9EN6-fFLV4RNAJXQCYOdg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用<a class="ae nn" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>打造的数据探索app图片由作者提供</p></figure><p id="46a0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上述例子的代码可以在<a class="ae nn" href="https://github.com/Thiagobc23/Marimekko-charts" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="7754" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae nn" href="https://linktr.ee/admin/settings#Settings--SocialLinks" rel="noopener ugc nofollow" target="_blank">更多Python DataViz教程</a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="cdf8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读我的文章。希望对你有帮助！</p></div></div>    
</body>
</html>