<html>
<head>
<title>The importance of layered thinking in data engineering</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">分层思维在数据工程中的重要性</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-importance-of-layered-thinking-in-data-engineering-a09f685edc71?source=collection_archive---------8-----------------------#2021-07-08">https://towardsdatascience.com/the-importance-of-layered-thinking-in-data-engineering-a09f685edc71?source=collection_archive---------8-----------------------#2021-07-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="93dd" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/notes-from-industry" rel="noopener" target="_blank">行业笔记</a></h2><div class=""/><div class=""><h2 id="0785" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">如何在机器学习(ML)用例中使用真实世界的数据<em class="ko"/></h2></div><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/66d796a2973427069d6e58734acc4f4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CAlA66MruFZHHEQOvBBqUg.jpeg"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">看起来有点像数据湖，对吗？(<a class="ae lf" href="https://flic.kr/p/o29b6m" rel="noopener ugc nofollow" target="_blank">Flickr上科利·多克托罗的《纠结的电线》</a> (CC BY-SA 2.0))</p></figure><h2 id="2e06" class="lg lh iq bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma iw bi translated">这是给谁的？</h2><p id="a665" class="pw-post-body-paragraph mb mc iq md b me mf ka mg mh mi kd mj lp mk ml mm lt mn mo mp lx mq mr ms mt ij bi translated">你是数据科学家还是数据工程师，热衷于构建可持续和健壮的数据管道？那这篇文章就送给你了！我们将通过一个真实世界的例子，到本文结束时，您将理解为什么您需要一个分层的数据工程约定来避免我们过去所犯的错误🙈。我们是<a class="ae lf" href="https://quantumblack.com/" rel="noopener ugc nofollow" target="_blank"> QuantumBlack </a>我们将讨论我们的开源Python框架:<a class="ae lf" href="https://kedro.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> Kedro </a>。</p><h2 id="65fa" class="lg lh iq bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma iw bi translated"><strong class="ak">为什么我们需要一个约定？记住—数据通常是偶然存在的</strong></h2><p id="7f84" class="pw-post-body-paragraph mb mc iq md b me mf ka mg mh mi kd mj lp mk ml mm lt mn mo mp lx mq mr ms mt ij bi translated">经验丰富的数据科学家、分析师和工程师非常清楚，并非所有数据都是为分析而设计的。通常它是“偶然”存在的，是一些其他业务流程的随机副产品。</p><p id="0634" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">当这种情况发生时，数据质量差和基础设施不可靠是很常见的。</p><p id="d1da" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">以下是一些在企业组织中常见的情况，它们说明了一个人是如何不可避免地陷入这种境地的:</p><ul class=""><li id="8a21" class="mz na iq md b me mu mh mv lp nb lt nc lx nd mt ne nf ng nh bi translated">生产线的值班经理仍然在Excel中维护时间表，而不是使用他们现有的花哨的企业软件，因为这是一个有效的系统，可以通过电子邮件发送，并且迁移会中断业务关键时间表。</li><li id="1759" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">一家跨国制药公司的库存系统实际上仍然是20世纪80年代的大型计算机(嘿，它可以工作！).它有一些基本的报告和预测功能，但它是专门为管理股票而设计的，而不是用于分析。</li></ul><p id="95a5" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">许多组织，尤其是大型组织，并不是“互联网原住民”，现在正在将机器学习追溯到他们的运营中。在这种情况下，我们必须采取灵活的迭代方法来构建ML用例。</p><p id="95a9" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">人们不能指望数据结构整齐，随时可用。例如，你会看到像<a class="ae lf" href="https://monzo.com/" rel="noopener ugc nofollow" target="_blank"> Monzo </a>这样的数字银行非常仔细地思考他们如何从源头将<a class="ae lf" href="https://en.wikipedia.org/wiki/Personal_data" rel="noopener ugc nofollow" target="_blank"> PII </a>的数据从分析中分离出来。这是更传统的机构在尝试进行同类分析时，必须在不同的系统之间进行分解的事情。</p><blockquote class="nn"><p id="107c" class="no np iq bd nq nr ns nt nu nv nw mt dk translated">在现实世界中，将为某个目的设计的数据逆向工程成对分析有用的东西是构建ML管道的一个重要部分。</p></blockquote><p id="4362" class="pw-post-body-paragraph mb mc iq md b me nx ka mg mh ny kd mj lp nz ml mm lt oa mo mp lx ob mr ms mt ij bi translated">承认这种情况并使用标准化的项目模板是简化代码库和工作心理模型的有效机制。</p><p id="a65d" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">在这个问题上，一组固执己见的最佳实践可以求助于Cookiecutter数据科学。他们的任务是促进数据科学的正确性和可再现性，而且，碰巧的是，他们也采用了数据工程的分层方法…</p><h2 id="fdeb" class="lg lh iq bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma iw bi translated"><strong class="ak">我们❤️库克数据科学</strong></h2><p id="42a3" class="pw-post-body-paragraph mb mc iq md b me mf ka mg mh mi kd mj lp mk ml mm lt mn mo mp lx mq mr ms mt ij bi translated"><a class="ae lf" href="https://github.com/cookiecutter/cookiecutter" rel="noopener ugc nofollow" target="_blank"> <em class="oc"> Cookiecutter </em> </a> <em class="oc">及关联的</em> <a class="ae lf" href="https://drivendata.github.io/cookiecutter-data-science/" rel="noopener ugc nofollow" target="_blank"> <em class="oc"> Cookiecutter数据科学</em> </a> <em class="oc">项目都是该领域的领导者，有着坚如磐石的见解。</em>如果你还没有机会详细阅读他们的方法，<a class="ae lf" href="https://drivendata.github.io/cookiecutter-data-science/#opinions" rel="noopener ugc nofollow" target="_blank">看看他们的</a>。我们等着，没事的😀 ⏳。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi od"><img src="../Images/ddce7f16208468276c6eccddd9d40a70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IbERzfd-6amJD0VY.jpg"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">嗯……(<a class="ae lf" href="https://www.flickr.com/photos/52473526@N00" rel="noopener ugc nofollow" target="_blank">hlkljkgk</a>的<a class="ae lf" href="https://www.flickr.com/photos/52473526@N00/3343913005" rel="noopener ugc nofollow" target="_blank"/>健康巧克力曲奇获得<a class="ae lf" href="https://creativecommons.org/licenses/by-sa/2.0/?ref=ccsearch&amp;atype=rich" rel="noopener ugc nofollow" target="_blank"> CC BY-SA 2.0 </a>授权)</p></figure><p id="b3d7" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">总之，他们的想法是基于以下6条规则:</p><blockquote class="oe of og"><p id="7a2a" class="mb mc oc md b me mu ka mg mh mv kd mj oh mw ml mm oi mx mo mp oj my mr ms mt ij bi translated">1.数据是不可变的<br/> 2。笔记本是用来探索和交流的<br/> 3。分析是一个<a class="ae lf" href="https://en.wikipedia.org/wiki/Directed_acyclic_graph" rel="noopener ugc nofollow" target="_blank">DAG</a>T28】4。从环境中建立起来。将秘密和配置置于版本控制之外<br/> 6。在更改默认文件夹结构时要谨慎</p></blockquote><p id="1ae5" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">您可以从标准的Cookiecutter <a class="ae lf" href="https://drivendata.github.io/cookiecutter-data-science/#directory-structure" rel="noopener ugc nofollow" target="_blank">目录结构</a>中看到，一种清晰简洁的数据工程约定形式得到了实施:</p><pre class="kq kr ks kt gt ok ol om on aw oo bi"><span id="af39" class="lg lh iq ol b gy op oq l or os">...<br/>├── data<br/>│   ├── external       &lt;- Data from third party sources.<br/>│   ├── interim        &lt;- Transformed intermediate data.<br/>│   ├── processed      &lt;- The final data sets for modeling.<br/>│   └── raw            &lt;- The original, immutable data dump.<br/>│<br/>...</span></pre><p id="bd97" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">虽然这是一个很好的工作框架，但随着我们项目的规模和复杂性的增长，我们觉得我们的方法需要更多的细微差别。</p><h1 id="ce95" class="ot lh iq bd li ou ov ow ll ox oy oz lo kf pa kg ls ki pb kj lw kl pc km ma pd bi translated">凯卓:它是什么，它有什么帮助</h1><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi pe"><img src="../Images/4353658e5456bda6484330b0d7a1c281.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n7qp7XvAR_VKMOyTJ0Bewg.png"/></div></div></figure><p id="8130" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">曾几何时，QuantumBlack 交付的每个项目看起来都不一样。人们每次都是从零开始，独立地经历相同的陷阱，再现性是耗时的，并且只有最初项目团队的成员真正理解每个代码库。</p><p id="2b75" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">进入<a class="ae lf" href="https://kedro.readthedocs.io/en/stable/01_introduction/01_introduction.html" rel="noopener ugc nofollow" target="_blank"> Kedro </a>，这是一个开源的Python框架，用于创建可复制、可维护和模块化的数据科学代码。如果你以前从未听说过Kedro框架，你可以在这里了解更多<a class="ae lf" href="https://kedro.readthedocs.io/en/stable/01_introduction/01_introduction.html" rel="noopener ugc nofollow" target="_blank">。</a></p><blockquote class="nn"><p id="b8ca" class="no np iq bd nq nr ns nt nu nv nw mt dk translated">我们用疤痕组织建造了凯卓。</p></blockquote><p id="f87e" class="pw-post-body-paragraph mb mc iq md b me nx ka mg mh ny kd mj lp nz ml mm lt oa mo mp lx ob mr ms mt ij bi translated">我们需要在我们自己的工作中实施一致性和软件工程最佳实践。Kedro给了我们将人们从一个项目转移到另一个项目的超能力，这改变了游戏规则。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi pf"><img src="../Images/42e47b001c9d73b493b8ba24efa3cfdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yWmK0BKE4rEtqRsB.jpg"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated"><em class="ko">工程师中途加入长期运行的Kedro项目的现场镜头(</em><a class="ae lf" href="https://www.flickr.com/photos/36614130@N06/41073591781" rel="noopener ugc nofollow" target="_blank">【180327-N-VN 584–3279】</a>由美国第七舰队<a class="ae lf" href="https://www.flickr.com/photos/36614130@N06" rel="noopener ugc nofollow" target="_blank">指挥官</a>根据<a class="ae lf" href="https://creativecommons.org/licenses/by-sa/2.0/?ref=ccsearch&amp;atype=rich" rel="noopener ugc nofollow" target="_blank"> CC BY-SA 2.0 </a>授权)</p></figure><p id="519f" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">在与Kedro合作一次后，你可以进入另一个项目，知道代码库是如何构建的，所有东西都在哪里，最重要的是你可以如何提供帮助。</p><p id="4fc3" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">Kedro是一个专注于ML产品开发的开发和实验阶段的框架。它不是以执行“成品”为中心——那被称为“编排”，是我们视为已部署的Kedro项目的下游的东西。如果您对如何使用orchestrators感兴趣，请<a class="ae lf" href="https://kedro.readthedocs.io/en/stable/10_deployment/01_deployment_guide.html" rel="noopener ugc nofollow" target="_blank">阅读我们的部署指南</a>。</p><p id="dd90" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">Cookiecutter项目的核心观点对我们有巨大的影响，也是我们试图在Kedro中体现的东西。Kedro项目结构的初始前提是扩展<a class="ae lf" href="https://drivendata.github.io/cookiecutter-data-science/#directory-structure" rel="noopener ugc nofollow" target="_blank"> Cookiecutter目录结构</a>。此外，它还为今天的<code class="fe pg ph pi ol b">kedro new</code>命令和<a class="ae lf" href="https://kedro.readthedocs.io/en/stable/07_extend_kedro/05_create_kedro_starters.html" rel="noopener ugc nofollow" target="_blank"> Kedro启动器</a>功能提供动力。</p><p id="d625" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">如前所述，我们发现我们的开发过程需要一组稍微微妙一些的“层”:</p><pre class="kq kr ks kt gt ok ol om on aw oo bi"><span id="2fec" class="lg lh iq ol b gy op oq l or os">...<br/>├── data<br/>│   ├── 01_raw            &lt;-- Raw immutable data<br/>│   ├── 02_intermediate   &lt;-- Typed data<br/>│   ├── 03_primary        &lt;-- Domain model data<br/>│   ├── 04_feature        &lt;-- Model features<br/>│   ├── 05_model_input    &lt;-- Often called 'master tables'<br/>│   ├── 06_models         &lt;-- Serialised models<br/>│   ├── 07_model_output   &lt;-- Data generated by model runs<br/>│   ├── 08_reporting      &lt;-- Ad hoc descriptive cuts<br/>...</span></pre><h1 id="a42e" class="ot lh iq bd li ou ov ow ll ox oy oz lo kf pa kg ls ki pb kj lw kl pc km ma pd bi translated">Kedro数据层</h1><p id="a1c0" class="pw-post-body-paragraph mb mc iq md b me mf ka mg mh mi kd mj lp mk ml mm lt mn mo mp lx mq mr ms mt ij bi translated">下面复杂的图表代表了在Kedro出现之前这种思维的样子。在我们有标准化的工具来构建我们的管道之前，它是(现在仍然是)处理数据的剧本。</p><p id="bd8a" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">有一套定义良好的规则来确保清楚地了解每一层需要执行哪些任务。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi pj"><img src="../Images/7acfbfdfb10a994edc842236004f285e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hCJiBTYmshBw-HIAJz0nHQ.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">并非所有这些都与今天的Kedro相关，但展示了我们更广泛的思维</p></figure><p id="800b" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">今天，这已经被简化并转化为Kedro的工作模式。下面有一个表格描述了这些是如何工作的，但是我们很快也会带您看一个端到端的例子。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="5792" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">在Kedro项目模板中，我们生成了一个实现该约定的文件结构。这在很大程度上是为了引导用户采用这种思维方式——然而，在实践中，我们希望用户将他们的数据存储在云中或数据湖/仓库中。如果你正在寻找一个例子，<a class="ae lf" href="https://kedro.readthedocs.io/en/stable/05_data/01_data_catalog.html" rel="noopener ugc nofollow" target="_blank">这是一个开始</a>的好地方！</p><p id="b01b" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">使用这种方法的另一个主要好处是能够可视化kedro-viz中的层，我们关于这个<a class="ae lf" href="https://kedro.readthedocs.io/en/0.17.4/03_tutorial/06_visualise_pipeline.html" rel="noopener ugc nofollow" target="_blank">的文档可以在这里</a>找到。</p><pre class="kq kr ks kt gt ok ol om on aw oo bi"><span id="a350" class="lg lh iq ol b gy op oq l or os"><strong class="ol ja">shuttles</strong>:<br/>  <strong class="ol ja">type</strong>: pandas.ExcelDataSet<br/>  <strong class="ol ja">filepath</strong>: data/01_raw/shuttles.xlsx<br/>  <strong class="ol ja">layer</strong>: raw</span></pre><p id="a44e" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated"><code class="fe pg ph pi ol b"><strong class="md ja">layer</strong></code>键可应用于任何<a class="ae lf" href="https://kedro.readthedocs.io/en/stable/05_data/01_data_catalog.html" rel="noopener ugc nofollow" target="_blank">目录</a>条目的第一级，并反映数据集将如何在<a class="ae lf" href="https://github.com/quantumblacklabs/kedro-viz" rel="noopener ugc nofollow" target="_blank"> kedro-viz </a>中可视化。</p><h1 id="c0b5" class="ot lh iq bd li ou ov ow ll ox oy oz lo kf pa kg ls ki pb kj lw kl pc km ma pd bi translated"><strong class="ak">关键概念——源与领域数据模型</strong></h1><blockquote class="oe of og"><p id="8c90" class="mb mc oc md b me mu ka mg mh mv kd mj oh mw ml mm oi mx mo mp oj my mr ms mt ij bi translated">在Kedro世界中，我们称域级数据为<code class="fe pg ph pi ol b">primary</code>层……但稍后会详细介绍。</p></blockquote><p id="5c4a" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">让我们以下面的示例问题为例，讨论源数据模型和域数据模型之间的区别。</p><blockquote class="nn"><p id="57cc" class="no np iq bd nq nr ns nt nu nv nw mt dk translated">工厂里的哪台机器下一步会出故障？</p></blockquote><p id="44da" class="pw-post-body-paragraph mb mc iq md b me nx ka mg mh ny kd mj lp nz ml mm lt oa mo mp lx ob mr ms mt ij bi translated">我们从两个<code class="fe pg ph pi ol b">raw</code>数据来源开始:</p><ul class=""><li id="7a3c" class="mz na iq md b me mu mh mv lp nb lt nc lx nd mt ne nf ng nh bi translated"><code class="fe pg ph pi ol b">Inventory</code> -跟踪可用的设备</li><li id="3bf2" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated"><code class="fe pg ph pi ol b">Maintenance schedule</code> -哪个机械师工作哪个班次</li></ul><p id="d151" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">这些数据源不是为分析而设计的，但是两个系统之间的一条线允许我们创建一个与手头问题相关的数据集。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="pk pl l"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">这是使用<a class="ae lf" href="https://github.com/quantumblacklabs/kedro-viz" rel="noopener ugc nofollow" target="_blank"> kedro-viz </a>建造的，它可以显示任何kedro管道</p></figure><p id="2d15" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">尽管两个原始数据集是以它们最初设计的任何形状接收的，但是<code class="fe pg ph pi ol b"><strong class="md ja">Machine shutdowns</strong></code>反映了问题正在被解决。有了这个导出的数据集，我们可以开始评估我们关于停机原因的假设。</p><h1 id="297d" class="ot lh iq bd li ou ov ow ll ox oy oz lo kf pa kg ls ki pb kj lw kl pc km ma pd bi translated">将Kedro层与Cookiecutter数据科学进行比较</h1><p id="4906" class="pw-post-body-paragraph mb mc iq md b me mf ka mg mh mi kd mj lp mk ml mm lt mn mo mp lx mq mr ms mt ij bi translated">最重要的区别是我们如何将“临时”部分分成具有明确职责的不同子部分。作为参考，这里是完整的<a class="ae lf" href="https://drivendata.github.io/cookiecutter-data-science/#directory-structure" rel="noopener ugc nofollow" target="_blank"> Cookiecutter目录结构</a>。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="pk pl l"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">*在Kedro中，内部和外部数据之间没有区别</p></figure></div><div class="ab cl pm pn hu po" role="separator"><span class="pp bw bk pq pr ps"/><span class="pp bw bk pq pr ps"/><span class="pp bw bk pq pr"/></div><div class="ij ik il im in"><h1 id="7012" class="ot lh iq bd li ou pt ow ll ox pu oz lo kf pv kg ls ki pw kj lw kl px km ma pd bi translated">将Kedro数据工程惯例应用到一个实际的例子中</h1><p id="b897" class="pw-post-body-paragraph mb mc iq md b me mf ka mg mh mi kd mj lp mk ml mm lt mn mo mp lx mq mr ms mt ij bi translated">在这一节中，我们将把它们都集中在一起。让我们以上述<em class="oc">(在概念上，数据是不同的)</em>中的预测性维护示例为例，并将其置于机器学习用例的现实版本中。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi py"><img src="../Images/93c5336d069b376e6fd695667b8ca061.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gM_Qth1GdU7kSeb35AV68A.jpeg"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">实践中的分层思考(<a class="ae lf" href="https://www.flickr.com/photos/52440453@N05/8455976261" rel="noopener ugc nofollow" target="_blank">《TACC大脑》</a>作者<a class="ae lf" href="https://www.flickr.com/photos/52440453@N05" rel="noopener ugc nofollow" target="_blank">约安尼斯·n·阿塔纳西亚迪斯</a>授权于<a class="ae lf" href="https://creativecommons.org/licenses/by/2.0/?ref=ccsearch&amp;atype=rich" rel="noopener ugc nofollow" target="_blank"> CC BY 2.0 </a>)</p></figure><blockquote class="oe of og"><p id="b4d8" class="mb mc oc md b me mu ka mg mh mv kd mj oh mw ml mm oi mx mo mp oj my mr ms mt ij bi translated"><strong class="md ja">在我们开始之前，需要提到两个关键点:</strong></p><p id="c2b7" class="mb mc oc md b me mu ka mg mh mv kd mj oh mw ml mm oi mx mo mp oj my mr ms mt ij bi translated">🧢:这是带着数据工程的帽子写的，因此数据科学的工作流程有些简化。所采用的建模方法也是指示性的，而不是一项强有力的工作。<br/>🤷‍♀️:归根结底，这些都是建议，而不是规则——这篇文章旨在将我们的基本原理放在上下文中，但最终你应该自由地遵循这种思维方式，提出你自己的层次，或者完全无视它。</p></blockquote><p id="cfaa" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">构建管道和整体ML用例所必需的数据目前分布在多个系统和业务部门，它们之间很少相互交流。</p><p id="ebd2" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">如果我们能够控制这些数据是如何到达的，它们将被很好地记录、打印和访问。实际上，很典型的情况是，到达的东西不是理想的格式💩。</p><h2 id="ffd5" class="lg lh iq bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma iw bi translated">🔒 01.原始层</h2><blockquote class="nn"><p id="4ab0" class="no np iq bd nq nr ns nt nu nv nw mt dk translated">️We从不在这里修改数据，只在副本上工作</p></blockquote><p id="edab" class="pw-post-body-paragraph mb mc iq md b me nx ka mg mh ny kd mj lp nz ml mm lt oa mo mp lx ob mr ms mt ij bi translated">在本例中，<code class="fe pg ph pi ol b">raw</code>层填充了来自大型分布式组织的数据。存在以下数据源:</p><ol class=""><li id="386a" class="mz na iq md b me mu mh mv lp nb lt nc lx nd mt pz nf ng nh bi translated">一份基于Excel的<strong class="md ja">维护日志</strong>，详细记录了机器的维修时间等。</li><li id="f212" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt pz nf ng nh bi translated">来自<a class="ae lf" href="https://en.wikipedia.org/wiki/Enterprise_resource_planning" rel="noopener ugc nofollow" target="_blank"> ERP </a>系统如<a class="ae lf" href="https://en.wikipedia.org/wiki/SAP_ERP" rel="noopener ugc nofollow" target="_blank"> SAP </a>的<strong class="md ja">机器操作员</strong>列表，描述了哪些操作员在不同时间使用不同的机器。</li><li id="2fdc" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt pz nf ng nh bi translated">来自未知的<strong class="md ja">设备清单</strong> SQL数据库的静态剪切，提供关于范围内各种机器的其他元数据。该导出以多个部分的形式提供。</li></ol><blockquote class="oe of og"><p id="6e11" class="mb mc oc md b me mu ka mg mh mv kd mj oh mw ml mm oi mx mo mp oj my mr ms mt ij bi translated">现在我们已经设置好了场景—在我们介绍数据如何在各层之间流动之前，请熟悉下面的管道。</p></blockquote><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="pk pl l"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">使用左侧边栏滑出底部的<strong class="ak">标签</strong>来关注特定层。</p></figure><h2 id="c556" class="lg lh iq bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma iw bi translated">🆕 02.中间层</h2><blockquote class="nn"><p id="14b9" class="no np iq bd nq nr ns nt nu nv nw mt dk translated">实际上，<code class="fe pg ph pi ol b">intermediate</code>层只需要是仍在“源”数据模型中的<code class="fe pg ph pi ol b">raw</code>层的<strong class="ak">类型镜像</strong></p></blockquote><ul class=""><li id="2990" class="mz na iq md b me nx mh ny lp qa lt qb lx qc mt ne nf ng nh bi translated">一旦<code class="fe pg ph pi ol b">intermediate</code>层存在，你永远不必接触<code class="fe pg ph pi ol b">raw</code>层，我们消除了与改变原始数据相关的风险。</li><li id="e02a" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">我们允许对数据进行较小的转换，在本例中，我们将多部分设备摘录合并到一个数据集中，但没有改变数据的结构。</li><li id="2887" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">清理列名、解析日期和完全删除<code class="fe pg ph pi ol b">null</code>列是这个阶段通常执行的其他“转换”。</li><li id="59c9" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">我们使用现代的类型化数据格式，比如Apache <a class="ae lf" href="https://kedro.readthedocs.io/en/stable/kedro.extras.datasets.pandas.ParquetDataSet.html" rel="noopener ugc nofollow" target="_blank"> Parquet </a>。</li><li id="b4d3" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">如果您的数据已经被类型化和结构化<strong class="md ja">，那么从这一点开始</strong>是可以的——但是要把它当作不可变的。</li><li id="f7ce" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">从这里而不是从<code class="fe pg ph pi ol b">raw</code>层运行管道通常会有性能提升。就计算而言，键入和解析大型CSV或<a class="ae lf" href="https://www.bbc.co.uk/news/technology-54423988" rel="noopener ugc nofollow" target="_blank"> Excel </a>文件可能是非常重要的活动。</li><li id="65c7" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">此时应执行概要分析、EDA和任何数据质量评估。</li></ul><h2 id="05e8" class="lg lh iq bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma iw bi translated">⚙ 03.初级层</h2><blockquote class="nn"><p id="7b3b" class="no np iq bd nq nr ns nt nu nv nw mt dk translated"><code class="fe pg ph pi ol b">primary</code>层包含针对正在解决的问题而构建的数据集。</p></blockquote><ul class=""><li id="fd9a" class="mz na iq md b me nx mh ny lp qa lt qb lx qc mt ne nf ng nh bi translated">从<code class="fe pg ph pi ol b">intermediate</code>层构建了两个领域级数据集，描述了<strong class="md ja">设备关闭</strong>和<strong class="md ja">操作员操作</strong>。</li><li id="cb83" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">这两个<code class="fe pg ph pi ol b">primary</code>数据集都是以这样一种方式构建的，即每行描述一个固定时间点的动作/事件，允许我们以直观的方式提出数据问题。</li><li id="96fc" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">从<strong class="md ja">源</strong>迁移到您的<strong class="md ja">域</strong>模型的概念在这里非常关键。这是将数据设计成适合分析目的的结构的地方。</li><li id="46ec" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">此外，当我们在各层之间流动时，冗余的源级数据点将被丢弃，从而简化我们的<strong class="md ja">工作心理模型</strong>。</li><li id="14db" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">由此我们有了一个<strong class="md ja">平台</strong>，我们可以用它来构建我们的<code class="fe pg ph pi ol b">feature</code>层。</li></ul><h2 id="556e" class="lg lh iq bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma iw bi translated">🧩 <strong class="ak"> 04。特征层</strong></h2><blockquote class="nn"><p id="1f72" class="no np iq bd nq nr ns nt nu nv nw mt dk translated">要素层由位于<code class="fe pg ph pi ol b">primary</code>层的输入构建而成。</p></blockquote><ul class=""><li id="1ff2" class="mz na iq md b me nx mh ny lp qa lt qb lx qc mt ne nf ng nh bi translated">从前面的<code class="fe pg ph pi ol b">primary</code>层专门构建<code class="fe pg ph pi ol b">feature</code>表(而不是从<code class="fe pg ph pi ol b">intermediate</code>层跳转)被认为是一个好的实践。然而，与Kedro中的所有东西一样，这是一个建议，而不是硬性规定。</li><li id="9454" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">在成熟的情况下，这些将保存在<a class="ae lf" href="https://eugeneyan.com/writing/feature-stores/" rel="noopener ugc nofollow" target="_blank">功能存储</a>中，为用户提供一个版本化的集中位置，为低延迟服务做好准备。</li><li id="0c95" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">特性通常在一致的聚合级别上进行设计(通常称为分析的'<a class="ae lf" href="https://en.wikipedia.org/wiki/Unit_of_analysis" rel="noopener ugc nofollow" target="_blank">单元</a>或表'<a class="ae lf" href="https://stackoverflow.com/questions/39181036/whats-the-grain-in-the-context-of-dw" rel="noopener ugc nofollow" target="_blank">粒度</a>')。在本例中，我们可以转换数据，使每一行都对应于一个独特的设备。</li><li id="7b00" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">T <a class="ae lf" href="https://en.wikipedia.org/wiki/Dependent_and_independent_variables" rel="noopener ugc nofollow" target="_blank">目标变量</a>位于该层内，被视为通用特征。</li><li id="34f8" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">在本例中，创建的3个特征代表了一些变量，这些变量可能是设备停机的预测因素或信号:</li></ul><blockquote class="oe of og"><p id="e536" class="mb mc oc md b me mu ka mg mh mv kd mj oh mw ml mm oi mx mo mp oj my mr ms mt ij bi translated">a)上次关机和上次维护之间的天数<br/> b)过去6个月的维护小时数<br/> c)上次关机后的天数</p></blockquote><h2 id="08fa" class="lg lh iq bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma iw bi translated">⚡️ 05.模型输入层</h2><blockquote class="nn"><p id="dc27" class="no np iq bd nq nr ns nt nu nv nw mt dk translated">我们觉得“主表”这个术语不够精确，所以选择使用这个术语</p></blockquote><ul class=""><li id="d036" class="mz na iq md b me nx mh ny lp qa lt qb lx qc mt ne nf ng nh bi translated">在这里，我们将所有的特性结合在一起，为我们的模型创建输入</li><li id="e3a1" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">在实践中，通常要试验多个模型，因此需要多个“模型输入”表。</li><li id="d360" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">这里的第一个例子是基于<strong class="md ja">时间序列的</strong>表，而另一个表是以<strong class="md ja">设备为中心的</strong>表，没有时间元素。</li><li id="d3d0" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">在这个例子中，我们使用一个简单的“脊柱”<strong class="md ja"> </strong>连接表，以便将每个输入表锚定到正确的“<a class="ae lf" href="https://stackoverflow.com/questions/39181036/whats-the-grain-in-the-context-of-dw" rel="noopener ugc nofollow" target="_blank">颗粒</a>”/“<a class="ae lf" href="https://en.wikipedia.org/wiki/Unit_of_analysis" rel="noopener ugc nofollow" target="_blank">分析单位</a>”。</li></ul><h2 id="a8e4" class="lg lh iq bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma iw bi translated">🧠 06.模型层</h2><blockquote class="nn"><p id="bb99" class="no np iq bd nq nr ns nt nu nv nw mt dk translated">这是训练好的模型被序列化的地方</p></blockquote><ul class=""><li id="da50" class="mz na iq md b me nx mh ny lp qa lt qb lx qc mt ne nf ng nh bi translated">在本例中，我们有两个模型，为了安全起见，我们将其保存为<a class="ae lf" href="https://kedro.readthedocs.io/en/latest/kedro.extras.datasets.pickle.PickleDataSet.html" rel="noopener ugc nofollow" target="_blank"> pickles </a>。</li><li id="3cc4" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">与其他层一样,“模型”层是一个概念性的盒子，有助于在构建管道时组织您团队(或您自己)的思维。</li><li id="d91b" class="mz na iq md b me ni mh nj lp nk lt nl lx nm mt ne nf ng nh bi translated">在现代生产环境中，经常可以看到<a class="ae lf" href="https://ml-ops.org/content/mlops-principles" rel="noopener ugc nofollow" target="_blank">模型注册表</a>在流程的这一点上使用。</li></ul><h2 id="bf19" class="lg lh iq bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma iw bi translated">🎁 07.模型输出层</h2><blockquote class="nn"><p id="7584" class="no np iq bd nq nr ns nt nu nv nw mt dk translated">各种模型运行的结果在这里直播</p></blockquote><ul class=""><li id="2ffd" class="mz na iq md b me nx mh ny lp qa lt qb lx qc mt ne nf ng nh bi translated">在这个例子中，两种不同的建模方法以不同的格式输出推荐和评分结果，这些结果在下游被消费。</li></ul><h2 id="668e" class="lg lh iq bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma iw bi translated">📣 08.报告层</h2><p id="de69" class="pw-post-body-paragraph mb mc iq md b me mf ka mg mh mi kd mj lp mk ml mm lt mn mo mp lx mq mr ms mt ij bi translated">在本例中，所执行的特征工程工作也使得向企业提供以前无法获得的维护活动的描述性直升机视图成为可能。</p><blockquote class="oe of og"><p id="b73f" class="mb mc oc md b me mu ka mg mh mv kd mj oh mw ml mm oi mx mo mp oj my mr ms mt ij bi translated">额外加分—在本例中，我们使用了一种高级的<a class="ae lf" href="https://kedro.readthedocs.io/en/stable/06_nodes_and_pipelines/03_modular_pipelines.html" rel="noopener ugc nofollow" target="_blank">模块化管道</a>模式，以便在两种模型中重用相同的数据科学管道(因此采用了镜像结构)。通过这样做，我们可以通过简单地覆盖每个管道的相关输入和输出来重用相同的代码。</p></blockquote><h1 id="041d" class="ot lh iq bd li ou ov ow ll ox oy oz lo kf pa kg ls ki pb kj lw kl pc km ma pd bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="95a2" class="pw-post-body-paragraph mb mc iq md b me mf ka mg mh mi kd mj lp mk ml mm lt mn mo mp lx mq mr ms mt ij bi translated">在现实世界中，数据的设计往往没有考虑到分析。它有助于建立一个框架，将您的数据转换成适合分析的格式，而且，碰巧的是，我们开发了一个框架，帮助我们理解复杂性并避免常见错误。</p><p id="2693" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">本文给出了我们如何发展我们的思维的想法，并提供了一个关于Kedro的数据约定是如何制定的工作示例。</p><p id="d1a5" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">作为读者，你用什么来指导你的数据工程呢？请在评论中告诉我们！</p><p id="5eed" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">📦<a class="ae lf" href="https://github.com/quantumblacklabs/kedro" rel="noopener ugc nofollow" target="_blank"> GitHub </a> <br/>💬<a class="ae lf" href="https://discord.com/invite/akJDeVaxnB" rel="noopener ugc nofollow" target="_blank">不和</a>不和<br/>🐍<a class="ae lf" href="https://pypi.org/project/kedro/" rel="noopener ugc nofollow" target="_blank">PyPi</a>T8】🤓<a class="ae lf" href="https://kedro.readthedocs.io/" rel="noopener ugc nofollow" target="_blank">阅读文档</a></p><p id="b01a" class="pw-post-body-paragraph mb mc iq md b me mu ka mg mh mv kd mj lp mw ml mm lt mx mo mp lx my mr ms mt ij bi translated">你是软件工程师、产品经理、数据科学家还是设计师？你想成为创新产品和技术的多学科团队的一员吗？然后查看我们的<a class="ae lf" href="https://www.quantumblack.com/labs/" rel="noopener ugc nofollow" target="_blank"> QuantumBlack Labs </a>页面了解更多信息。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi qd"><img src="../Images/21284adbf9c87fc73ccb5093d96ae632.png" data-original-src="https://miro.medium.com/v2/resize:fit:528/format:webp/1*Xuvf0fj0pSARNnAXFsfuqA.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">加入<a class="ae lf" href="https://discord.com/invite/akJDeVaxnB" rel="noopener ugc nofollow" target="_blank"> Kedro社区</a>，成为一名Kedroid</p></figure></div></div>    
</body>
</html>