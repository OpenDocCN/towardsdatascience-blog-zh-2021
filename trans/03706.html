<html>
<head>
<title>iPad Pro + Raspberry Pi for Data Science Part 4: Installing Kubernetes for Learning Purposes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于数据科学的iPad Pro + Raspberry Pi第4部分:为学习目的安装Kubernetes</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/ipad-pro-raspberry-pi-for-data-science-part-4-installing-kubernetes-for-learning-eb7f8ac31198?source=collection_archive---------17-----------------------#2021-03-26">https://towardsdatascience.com/ipad-pro-raspberry-pi-for-data-science-part-4-installing-kubernetes-for-learning-eb7f8ac31198?source=collection_archive---------17-----------------------#2021-03-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/bf2500bffd89ca5b77300246e6764e69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MByzqIexp6hb_VNR57du6w.jpeg"/></div></div></figure><h2 id="ba56" class="jc jd je bd b dl jf jg jh ji jj jk dk jl translated" aria-label="kicker paragraph">树莓派+ iPad Pro</h2><div class=""/><div class=""><h2 id="f51f" class="pw-subtitle-paragraph kk jn je bd b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dk translated">教你如何在你的树莓派上安装Kubernetes来展示新的学习理念</h2></div><p id="d9c2" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">你好，朋友们！我们再次回到我们系列的第四部分，让树莓派直接与iPad Pro配合使用。如果你一直在关注，你会记得我不确定我会写第四篇文章。我已经花了几个星期的时间在这个特定的帖子上，因为，老实说，让它工作起来是一场斗争。在我们开始讨论为什么我要写第四篇文章之前，我想鼓励新读者看看之前的三篇文章:</p><ul class=""><li id="19ea" class="ly lz je le b lf lg li lj ll ma lp mb lt mc lx md me mf mg bi translated">第1部分:首次操作系统初始化！</li><li id="42dc" class="ly lz je le b lf mi li mj ll mk lp ml lt mm lx md me mf mg bi translated"><a class="ae mh" rel="noopener" target="_blank" href="/ipad-pro-raspberry-pi-for-data-science-part-2-setting-up-the-hardline-connection-555f939c29c2">第2部分:建立硬线连接！</a></li><li id="dc98" class="ly lz je le b lf mi li mj ll mk lp ml lt mm lx md me mf mg bi translated"><a class="ae mh" rel="noopener" target="_blank" href="/ipad-pro-raspberry-pi-for-data-science-part-3-installing-our-data-science-tools-77d020e485f2">第3部分:安装我们的数据科学工具！</a></li></ul><p id="4b5d" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">作为一名机器学习工程师，我日常工作的主要职责是与我们的数据科学家合作，生产他们构建的机器学习解决方案，以便与我们的其他企业级系统进行适当的交互。当然，执行这项工作的部署环境不止一个，但是最近出现的最流行的一个是Kubernetes。当谈到我的日常工作时，我要么在内部Kubernetes集群上工作，要么使用像SageMaker这样的AWS服务。</p><p id="ee73" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">也就是说，我喜欢在沙盒空间中测试我的新实验，以免影响生产中运行的任何东西。说到我的个人设置，我一直在一个名为Minikube的工具的帮助下，在我的个人MacBook Pro上运行单节点Kubernetes集群。Minikube已经很棒了，但不幸的是它不能与树莓Pi一起工作。这是因为Raspberry Pi使用基于ARM的CPU架构，不幸的是，目前还没有一款Minikube支持这种架构。</p><p id="4c22" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">但是不用担心！我发现了一个不同的解决方案，叫做K3s，我们将在这篇文章中启用它。如果你不知道，Kubernetes经常被缩写为“k8s”，这是因为在Kubernetes的“k”和“s”之间有8个字符。我不能肯定地说这一点，但我不得不猜测K3s的命名方式，因为它是一个更轻量级版本的Kubernetes。我不知道我是否会将它推荐给一个完整的企业级生产系统，但作为一个测试新想法的沙盒空间——就像在我们的Raspberry Pi上——K3s肯定能完成任务。</p><p id="4116" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">在开始安装K3s之前，我应该注意到这篇文章不会涉及任何关于使用Kubernetes的“操作方法”。即使你从未使用过Kubernetes，你也一定可以继续关注这篇文章，但是我们不会在这篇文章中讨论任何类型的机器学习部署模式。但请继续关注，因为我还有一些其他的帖子将在Kubernetes上演示，我个人将使用我的iPad/Raspberry Pi组合来执行这项工作。</p><p id="c6fd" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">好了，让我们开始安装吧！</p><h1 id="2e52" class="mn mo je bd mp mq mr ms mt mu mv mw mx kt my ku mz kw na kx nb kz nc la nd ne bi translated">K3s初始安装</h1><p id="a414" class="pw-post-body-paragraph lc ld je le b lf nf ko lh li ng kr lk ll nh ln lo lp ni lr ls lt nj lv lw lx im bi translated">好的，在我们进入实际安装之前，我们需要做一件简单的事情。您需要在<code class="fe nk nl nm nn b">/boot/cmdline.txt</code>文件中添加一些东西。将这些项目添加到该文件的末尾，与其他项目位于同一行:</p><pre class="no np nq nr gt ns nn nt nu aw nv bi"><span id="d112" class="nw mo je nn b gy nx ny l nz oa">cgroup_enable=cpuset cgroup_memory=1 cgroup_enable=memory</span></pre><p id="8604" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">重启你的Pi，现在我们可以继续了！</p><p id="36b2" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">K3s在你的Raspberry Pi上的实际安装非常简单，尽管在我最终弄清楚我需要做什么之后才变得简单。您只需运行以下命令:</p><pre class="no np nq nr gt ns nn nt nu aw nv bi"><span id="4b7d" class="nw mo je nn b gy nx ny l nz oa">curl -sfL <a class="ae mh" href="https://get.k3s.io" rel="noopener ugc nofollow" target="_blank">https://get.k3s.io</a> | sh -s - --write-kubeconfig-mode 644</span></pre><p id="6cfc" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">这个命令做了几件事。正如你可能从这里的<code class="fe nk nl nm nn b">curl</code>命令中知道的，我们首先从K3s网站下载适当的文件，然后用从下载中得到的shell脚本安装组件。我第一次做的时候没有注意到的是<code class="fe nk nl nm nn b">--write-kubeconfig-mode</code>命令。这个Kubernetes部署的独特之处在于，K3s使用一个特定的<code class="fe nk nl nm nn b">k3s.yaml</code>文件进行配置设置。如果你不运行带有<code class="fe nk nl nm nn b">644</code>值的标志，K3s将不能识别那个文件，你基本上不能使用Kubernetes。</p><p id="36ef" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">完成安装需要一点时间，但是一旦完成，您应该能够运行下面的命令并看到某种成功消息:<code class="fe nk nl nm nn b">sudo systemctl status k3s</code>。除了启动Kubernetes集群本身，K3s安装脚本还会做一些其他的事情。首先，它将创建一个额外的shell脚本来轻松卸载K3s。如果您遇到任何问题，并且需要从头开始，运行以下命令将完全清除您的Pi中的K3s:</p><pre class="no np nq nr gt ns nn nt nu aw nv bi"><span id="6113" class="nw mo je nn b gy nx ny l nz oa">bash /usr/local/bin/k3s-uninstall.sh</span></pre><p id="697a" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">K3s安装做的第二件事是它会为你安装<code class="fe nk nl nm nn b">kubectl</code>命令行工具，这非常方便。如果你不熟悉那是什么，<code class="fe nk nl nm nn b">kubectl</code>是我们用来与Kubernetes环境交互的主要工具。当在Kubernetes集群中安装东西、检查东西的状态等等时，您将使用<code class="fe nk nl nm nn b">kubectl</code>来执行所有这些命令。</p><p id="858b" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">好了，尽管我们已经启动并运行了基线Kubernetes集群，但是还需要做一些事情来设置我们的理想配置。让我们继续设置一种方法，将本地存储用于持久性卷。</p><h1 id="fcf9" class="mn mo je bd mp mq mr ms mt mu mv mw mx kt my ku mz kw na kx nb kz nc la nd ne bi translated">为永久卷设置本地存储</h1><p id="1eb9" class="pw-post-body-paragraph lc ld je le b lf nf ko lh li ng kr lk ll nh ln lo lp ni lr ls lt nj lv lw lx im bi translated">如果您以前没有使用过Kubernetes，您将会了解到，Kubernetes计算资源(例如pods)默认使用临时存储。Kubernetes的伟大之处在于，如果某个资源由于某种原因而死亡(比如从集群断开电源)，它会在可能的时候重建该资源。坏消息是，由于pod存储的短暂性，您将丢失存储后创建的任何新数据。</p><p id="6ff2" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">当然，Kubernetes有一个机制来保护我们。Kubernetes允许我们在被称为“持久卷”或简称为PV的存储设备中使用广泛的存储设备。有了实例化的PV，Kubernetes部署就可以以持久卷声明(简称PVC)的形式使用PV的一小部分。</p><p id="c234" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">对于我们的实验目的，我们可以通过我们的Raspberry Pi利用我们的microSD卡上的存储，只需进行一点额外的配置。当然，这取决于你的microSD卡的大小。我个人使用的是200GB的microSD卡，所以我有足够的空间来使用这种模式。如果您使用的是容量较小的卡，您可能不想为您的PV启用本地存储。</p><p id="1964" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">注意到这一点，K3s的制造商——Rancher——创建了一个小脚本，使您能够非常容易地使用您的本地存储。您只需运行以下命令:</p><pre class="no np nq nr gt ns nn nt nu aw nv bi"><span id="0111" class="nw mo je nn b gy nx ny l nz oa">kubectl apply -f https://raw.githubusercontent.com/rancher/local-path-provisioner/master/deploy/local-path-storage.yaml</span></pre><p id="7925" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">就是这样！现在，您可以通过K3s使用您的本地存储。如果你想进一步测试，Rancher在他们的GitHub页面上提供了一些很棒的说明和演示材料。你可以在这个链接找到那个<a class="ae mh" href="https://github.com/rancher/local-path-provisioner/blob/master/README.md#usage" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="4e19" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">至此，在结束这篇文章之前，我们还有最后一部分要讲，这肯定是你会感兴趣的一部分。让K3s列车继续前行吧！</p><h1 id="765c" class="mn mo je bd mp mq mr ms mt mu mv mw mx kt my ku mz kw na kx nb kz nc la nd ne bi translated">利用自定义Docker图像</h1><p id="377c" class="pw-post-body-paragraph lc ld je le b lf nf ko lh li ng kr lk ll nh ln lo lp ni lr ls lt nj lv lw lx im bi translated">所以我真的不知道这是为什么，但默认情况下，K3s不能使用自定义的Docker图像。如果您找到一个发布到Docker Hub的，您就可以使用这些现成的，但是如果您使用自己的本地映像进行本地测试，这确实需要一点额外的步骤。(说实话，我觉得可能有更好的方法来做这件事，但我还没有想出来。如果有，我会回来更新这篇文章。)</p><p id="c3b5" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">为了使用你自己的自定义镜像，你必须压缩你的Docker版本并使用K3s命令行，以便在你的K3s部署中使用它们。以下是实现这一点的步骤:</p><ul class=""><li id="e517" class="ly lz je le b lf lg li lj ll ma lp mb lt mc lx md me mf mg bi translated">使用标准的<code class="fe nk nl nm nn b">docker build</code>命令构建您的容器。</li><li id="6058" class="ly lz je le b lf mi li mj ll mk lp ml lt mm lx md me mf mg bi translated">将构建的Docker图像保存为TAR文件。Docker天生就有这种能力，您可以通过运行这个命令来启动它:<code class="fe nk nl nm nn b">docker save --output YOUR_IMAGE.tar NAME_OF_YOUR_DOCKER_IMAGE:latest</code>。(如果您使用不同的标签，请将其替换为最新的。)</li><li id="31b5" class="ly lz je le b lf mi li mj ll mk lp ml lt mm lx md me mf mg bi translated">使用K3s CLI将目标映像复制到K3s。这里有一个如何做到这一点的例子:<code class="fe nk nl nm nn b">sudo k3s ctr images import YOUR_IMAGE.tar</code>。</li></ul><p id="c518" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">坦率地说，每次更新图像时，这都是一件令人头疼的事情，所以我建议您构建一个小的shell脚本来实现自动化。<a class="ae mh" href="https://github.com/dkhundley/celery-flask-redis/blob/main/build_images.sh" rel="noopener ugc nofollow" target="_blank">这里有一个例子</a>，我是如何在我的另一个个人项目中做到这一点的。</p><p id="6c46" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">朋友们，这就是我们这篇文章的结尾！如果我找到更好的方法来做上面的任何事情，我一定会用更好的内容更新这篇文章。否则，你应该很乐意在你的树莓派上搭配K3s！正如我的Pi上的其他数据科学工具一样，我发现启用这种模式有很多价值。事实上，整篇文章，从标题图片到正文内容再到代码片段，都是在我的iPad上写的。所以你知道，当我说这种模式有效并且很棒的时候，我是认真的。😃</p></div></div>    
</body>
</html>