<html>
<head>
<title>Continuous Testing for Machine Learning Systems</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">机器学习系统的连续测试</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/continuous-testing-for-machine-learning-systems-a8519eede545?source=collection_archive---------21-----------------------#2021-07-25">https://towardsdatascience.com/continuous-testing-for-machine-learning-systems-a8519eede545?source=collection_archive---------21-----------------------#2021-07-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="600a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过ML产品生命周期验证机器学习系统的正确性和性能。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f5102eba1f1c9a3713068d72a1e56139.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*p11QAbAJkHqrxrSF"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">托尔加·乌尔坎在<a class="ae kv" href="https://unsplash.com/photos/9k36QqhA0cU" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="4c68" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">目录</h1><ul class=""><li id="f7af" class="lo lp iq lq b lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><a class="ae kv" href="#f86f" rel="noopener ugc nofollow">机器学习系统中的测试</a></li><li id="1b75" class="lo lp iq lq b lr mg lt mh lv mi lx mj lz mk mb mc md me mf bi translated"><a class="ae kv" href="#de0d" rel="noopener ugc nofollow">ML测试的范围</a></li><li id="9158" class="lo lp iq lq b lr mg lt mh lv mi lx mj lz mk mb mc md me mf bi translated"><a class="ae kv" href="#3421" rel="noopener ugc nofollow">我们什么时候进行不同类型的测试？</a></li><li id="a29b" class="lo lp iq lq b lr mg lt mh lv mi lx mj lz mk mb mc md me mf bi translated"><a class="ae kv" href="#b342" rel="noopener ugc nofollow">结论</a></li></ul><h1 id="f86f" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">机器学习系统中的测试</h1><p id="e48a" class="pw-post-body-paragraph ml mm iq lq b lr ls jr mn lt lu ju mo lv mp mq mr lx ms mt mu lz mv mw mx mb ij bi translated">软件行业中的测试是一个经过充分研究的成熟领域。从不计其数的失败项目中吸取的好的实践帮助我们频繁地发布，并且有更少的机会看到产品中的缺陷。像CI、测试覆盖和TDD这样的行业惯例被很好地采用，并为每个项目量身定制。</p><p id="b00d" class="pw-post-body-paragraph ml mm iq lq b lr my jr mn lt mz ju mo lv na mq mr lx nb mt mu lz nc mw mx mb ij bi translated">然而，当我们试图将SWE测试哲学借用到机器学习领域时，我们必须解决一些独特的问题。在这篇文章中，我们将讨论ML模型(系统)测试中的一些常见问题，并讨论潜在的解决方案。</p><p id="618e" class="pw-post-body-paragraph ml mm iq lq b lr my jr mn lt mz ju mo lv na mq mr lx nb mt mu lz nc mw mx mb ij bi translated">ML系统在这里代表一个生成可供用户使用的预测(洞察)的系统(管道)。它可能包括一些机器学习模型。例如，OCR模型(系统)可以包括一个用于检测文本区域的ML模型、一个用于判断当前文本区域类别的ML模型(汽车牌照与路标)以及一个用于从图片中识别文本的模型。</p><h1 id="de0d" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">ML测试的范围</h1><p id="3bc5" class="pw-post-body-paragraph ml mm iq lq b lr ls jr mn lt lu ju mo lv mp mq mr lx ms mt mu lz mv mw mx mb ij bi translated">模型由代码(算法、预处理、后处理等)、数据和促进运行时的基础设施组成。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/627bf4b702dc4108f8366c2187033bf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*SVqEVsV_MigmBDQYIzVz3g.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">ML系统测试的范围，图片由作者提供</p></figure><p id="3c72" class="pw-post-body-paragraph ml mm iq lq b lr my jr mn lt mz ju mo lv na mq mr lx nb mt mu lz nc mw mx mb ij bi translated">不同类型的测试涵盖了系统不同组件的质量保证。</p><p id="c432" class="pw-post-body-paragraph ml mm iq lq b lr my jr mn lt mz ju mo lv na mq mr lx nb mt mu lz nc mw mx mb ij bi translated"><strong class="lq ir">数据测试</strong>:确保新数据满足你的假设。在我们训练模型和进行预测之前，需要进行这种测试。在训练模型之前，X和y(标签)</p><p id="2daa" class="pw-post-body-paragraph ml mm iq lq b lr my jr mn lt mz ju mo lv na mq mr lx nb mt mu lz nc mw mx mb ij bi translated"><strong class="lq ir">管道测试</strong>:确保你的管道设置正确。这就像SWE中的集成测试。对于ML系统，它也可以测量一致性(再现性)。</p><p id="df38" class="pw-post-body-paragraph ml mm iq lq b lr my jr mn lt mz ju mo lv na mq mr lx nb mt mu lz nc mw mx mb ij bi translated"><strong class="lq ir">模型评估</strong>:评估你的ML管道有多好。取决于您使用的指标和数据集，它可能指不同的东西。</p><ul class=""><li id="3cbf" class="lo lp iq lq b lr my lt mz lv ne lx nf lz ng mb mc md me mf bi translated">对维持/交叉验证数据集的评估。</li><li id="1b47" class="lo lp iq lq b lr mg lt mh lv mi lx mj lz mk mb mc md me mf bi translated">部署管线和地面实况的评估(<a class="ae kv" href="https://cloud.google.com/ai-platform/prediction/docs/continuous-evaluation" rel="noopener ugc nofollow" target="_blank">连续评估</a>)。</li><li id="3bb0" class="lo lp iq lq b lr mg lt mh lv mi lx mj lz mk mb mc md me mf bi translated">基于系统用户反馈的评估(与业务相关的指标，而不是可测量的ML代理)</li></ul><p id="e7e4" class="pw-post-body-paragraph ml mm iq lq b lr my jr mn lt mz ju mo lv na mq mr lx nb mt mu lz nc mw mx mb ij bi translated">有许多技术可以应用于该过程，如基于切片的评估、MVP(数据的关键子集)组/样本分析、消融研究、基于用户分组的实验(如Beta测试和A/B测试)。</p><p id="8153" class="pw-post-body-paragraph ml mm iq lq b lr my jr mn lt mz ju mo lv na mq mr lx nb mt mu lz nc mw mx mb ij bi translated"><strong class="lq ir">模型测试</strong>:包括对我们期望模型遵循的行为的明确检查。这种类型的测试不是为了告诉我们与准确性相关的指标，而是为了防止我们在生产中出现不良行为。常见的测试类型包括但不限于:</p><ul class=""><li id="db8e" class="lo lp iq lq b lr my lt mz lv ne lx nf lz ng mb mc md me mf bi translated">不变性(扰动)测试:输入<em class="nh">的扰动不影响模型的输出</em>。</li><li id="da8c" class="lo lp iq lq b lr mg lt mh lv mi lx mj lz mk mb mc md me mf bi translated">方向性期望测试:为了实现我们的<em class="nh">应该</em>对模型输出有一个<em class="nh">可预测的</em>效果。例如，如果手术中失血量增加，输血量也应该增加。</li><li id="f61a" class="lo lp iq lq b lr mg lt mh lv mi lx mj lz mk mb mc md me mf bi translated">基准回归:使用预定义的样本和精度门来确保模型版本不会引入疯狂的问题。</li><li id="66c9" class="lo lp iq lq b lr mg lt mh lv mi lx mj lz mk mb mc md me mf bi translated">过度拟合(记忆)测试:尝试用整个数据集的一小部分来过度拟合模型，并确认模型是否能够记忆数据。</li></ul><h1 id="3421" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">我们什么时候进行不同类型的测试？</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/46f240c510ef6e5ff0eb4e69209f299d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DWYrF78fAwxkdj3mtfDniw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们什么时候进行测试？作者图片</p></figure><p id="cbf0" class="pw-post-body-paragraph ml mm iq lq b lr my jr mn lt mz ju mo lv na mq mr lx nb mt mu lz nc mw mx mb ij bi translated">有些人可能会问，为什么我们需要使用维持评估和持续评估来衡量CI和服务时间方面几乎相同的指标。</p><p id="5b19" class="pw-post-body-paragraph ml mm iq lq b lr my jr mn lt mz ju mo lv na mq mr lx nb mt mu lz nc mw mx mb ij bi translated">一个原因是，我们无法通过查看预定义维持数据集的指标来全面评估模型性能，因为数据泄漏有时比看起来更难检测。例如，一些预期在服务时间内存在的特征被证明具有获取的高延迟，因此我们的训练模型不能习惯于看到该特征总是为空。</p><p id="ca30" class="pw-post-body-paragraph ml mm iq lq b lr my jr mn lt mz ju mo lv na mq mr lx nb mt mu lz nc mw mx mb ij bi translated">有时模型评估可能非常昂贵，因此将全周期维持评估集成到CI中是不可行的。在这种情况下，我们可以在CI中定义一个子集回归评估，并且只在重要的里程碑之前进行完整的评估。</p><p id="b6ed" class="pw-post-body-paragraph ml mm iq lq b lr my jr mn lt mz ju mo lv na mq mr lx nb mt mu lz nc mw mx mb ij bi translated">模型测试不是一次性的步骤，相反，它应该是一个与自动化设置持续集成的过程。一些测试用例可以在CI过程中执行，所以每次代码提交都会触发它们，我们可以保证repo的主要分支中的代码/模型质量。其他的可以在服务环境中进行，所以我们不会对系统的性能视而不见，当我们有问题时，我们可以有相对充足的时间来解决问题。有时，服务环境中正在进行的测试可以被视为监控组件的一部分，我们可以与警报工具集成以结束循环。</p><h1 id="b342" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">结论</h1><p id="2d70" class="pw-post-body-paragraph ml mm iq lq b lr ls jr mn lt lu ju mo lv mp mq mr lx ms mt mu lz mv mw mx mb ij bi translated">机器学习系统不容易测试，不仅因为它包括更多要验证的组件(代码+数据)，而且它具有动态性。虽然我们没有改变任何东西，但我们的模型可能会因为数据变化(数据漂移)或事物的本质随着时间的推移而变化(概念漂移)而变得陈旧。</p><p id="1a00" class="pw-post-body-paragraph ml mm iq lq b lr my jr mn lt mz ju mo lv na mq mr lx nb mt mu lz nc mw mx mb ij bi translated">自动化测试是CI / CD中的一个重要组成部分，用于以较小的占用空间验证管道的正确性。虽然在我们说一个新的ML流水线已经可以生产之前，手工测试和人在回路中的验证仍然是至关重要的步骤。管道投产后，持续的监控和评估可以确保我们不会盲目行动。最后，基于客户反馈的测试(即A/B测试)能够告诉我们，我们试图解决的问题是否真的有所改善。</p><p id="bfc4" class="pw-post-body-paragraph ml mm iq lq b lr my jr mn lt mz ju mo lv na mq mr lx nb mt mu lz nc mw mx mb ij bi translated">在ML系统测试中没有银弹，持续地尝试覆盖边缘情况将帮助我们减少犯错误的机会。希望有一天我们能找出一个简单的度量标准，比如代码覆盖率，来判断我们的系统是否足够好。</p><h1 id="d4b1" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak">参考</strong>:</h1><ul class=""><li id="d07b" class="lo lp iq lq b lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><a class="ae kv" href="https://www.jeremyjordan.me/testing-ml/" rel="noopener ugc nofollow" target="_blank">机器学习系统的有效测试。</a></li><li id="ebdf" class="lo lp iq lq b lr mg lt mh lv mi lx mj lz mk mb mc md me mf bi translated"><a class="ae kv" href="https://arxiv.org/abs/2107.00079" rel="noopener ugc nofollow" target="_blank">使用反模式避免MLOps错误</a></li><li id="9dc2" class="lo lp iq lq b lr mg lt mh lv mi lx mj lz mk mb mc md me mf bi translated">CS 329S:机器学习系统设计</li></ul></div></div>    
</body>
</html>