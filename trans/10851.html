<html>
<head>
<title>How To Create a New Column Based on Values From Other Columns in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何基于Pandas中其他列的值创建新列</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/create-new-column-based-on-other-columns-pandas-5586d87de73d?source=collection_archive---------0-----------------------#2021-10-21">https://towardsdatascience.com/create-new-column-based-on-other-columns-pandas-5586d87de73d?source=collection_archive---------0-----------------------#2021-10-21</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="8ed5" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">讨论如何从pandas数据框架中的现有列创建新列</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/90539da560d853d315f193edbd28a3db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S8_H436aj8zpVBzkf8qI-g.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@drscythe?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">张秀坤镰刀</a>在<a class="ae kz" href="https://unsplash.com/s/photos/new?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><h2 id="05ec" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">介绍</h2><p id="72b7" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">作为数据处理或特征工程的一部分，我们通常需要在现有列的基础上创建额外的列。在今天的简短指南中，我们将探索如何在熊猫身上进行这样的操作。</p><p id="1ca7" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">具体来说，我们将探索如何以几种不同的方式实现这一点，使用</p><ul class=""><li id="ea1b" class="mu mv iu ly b lz mp mc mq lj mw ln mx lr my mo mz na nb nc bi translated"><code class="fe nd ne nf ng b">apply()</code>方法</li><li id="60fd" class="mu mv iu ly b lz nh mc ni lj nj ln nk lr nl mo mz na nb nc bi translated"><code class="fe nd ne nf ng b">numpy.select()</code>方法(对于矢量化方法)</li><li id="4ff6" class="mu mv iu ly b lz nh mc ni lj nj ln nk lr nl mo mz na nb nc bi translated"><code class="fe nd ne nf ng b">loc</code>地产</li></ul></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><p id="b971" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">首先，让我们创建一个示例DataFrame，我们将在整篇文章中引用它来演示一些概念，并展示如何基于现有列的值创建新列。</p><pre class="kk kl km kn gu nt ng nu bn nv nw bi"><span id="6307" class="nx lb iu ng b be ny nz l oa ob">import pandas as pd<br/><br/>df = pd.DataFrame(<br/>    [<br/>        (1, 'Hello', 158, True, 12.8),<br/>        (2, 'Hey', 567, False, 74.2),<br/>        (3, 'Hi', 123, False, 1.1),<br/>        (4, 'Howdy', 578, True, 45.8),<br/>        (5, 'Hello', 418, True, 21.1),<br/>        (6, 'Hi', 98, False, 98.1),<br/>    ],<br/>    columns=['colA', 'colB', 'colC', 'colD', 'colE']<br/>)<br/>print(df)<br/>   colA   colB  colC   colD  colE<br/>0     1  Hello   158   True  12.8<br/>1     2    Hey   567  False  74.2<br/>2     3     Hi   123  False   1.1<br/>3     4  Howdy   578   True  45.8<br/>4     5  Hello   418   True  21.1<br/>5     6     Hi    98  False  98.1</span></pre></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><h2 id="cd78" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用apply()方法</h2><p id="eaa6" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">如果您需要在现有列上应用一个方法，以便计算一些最终将作为新列添加到现有数据框架中的值，那么<code class="fe nd ne nf ng b"><a class="ae kz" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.apply.html" rel="noopener ugc nofollow" target="_blank">pandas.DataFrame.apply()</a></code>方法应该可以做到。</p><p id="45d8" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">例如，您可以定义自己的方法，然后将其传递给<code class="fe nd ne nf ng b">apply()</code>方法。假设我们想要创建一个名为<code class="fe nd ne nf ng b">colF</code>的新列，它将基于列<code class="fe nd ne nf ng b">colC</code>的值使用下面定义的<code class="fe nd ne nf ng b">categorise()</code>方法创建:</p><pre class="kk kl km kn gu nt ng nu bn nv nw bi"><span id="cd1e" class="nx lb iu ng b be ny nz l oa ob">def categorise(row):  <br/>    if row['colC'] &gt; 0 and row['colC'] &lt;= 99:<br/>        return 'A'<br/>    elif row['colC'] &gt; 100 and row['colC'] &lt;= 199:<br/>        return 'B'<br/>    elif row['colC'] &gt; 200  and row['colC'] &lt;= 299:<br/>        return 'C'<br/>    return 'D'</span></pre><p id="4b7d" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">你需要做的就是将上述方法作为lambda表达式传递给<code class="fe nd ne nf ng b">apply()</code>:</p><pre class="kk kl km kn gu nt ng nu bn nv nw bi"><span id="570b" class="nx lb iu ng b be ny nz l oa ob">df['colF'] = df.apply(lambda row: categorise(row), axis=1)<br/><br/>print(df)<br/>   colA   colB  colC   colD  colE colF<br/>0     1  Hello   158   True  12.8    B<br/>1     2    Hey   567  False  74.2    D<br/>2     3     Hi   123  False   1.1    B<br/>3     4  Howdy   578   True  45.8    D<br/>4     5  Hello   418   True  21.1    D<br/>5     6     Hi    98  False  98.1    A</span></pre><p id="3023" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">对于更简单的操作，您可以将lambda表达式直接指定给<code class="fe nd ne nf ng b">apply()</code>方法。例如，假设我们想要创建另一个名为<code class="fe nd ne nf ng b">colG</code>的列，它将把列<code class="fe nd ne nf ng b">colC</code>和<code class="fe nd ne nf ng b">colE</code>的值加在一起。以下内容应该可以解决问题:</p><pre class="kk kl km kn gu nt ng nu bn nv nw bi"><span id="5882" class="nx lb iu ng b be ny nz l oa ob">df['colG'] = df.apply(lambda row: row.colC + row.colE, axis=1)<br/><br/>print(df)<br/>   colA   colB  colC   colD  colE colF   colG<br/>0     1  Hello   158   True  12.8    B  170.8<br/>1     2    Hey   567  False  74.2    D  641.2<br/>2     3     Hi   123  False   1.1    B  124.1<br/>3     4  Howdy   578   True  45.8    D  623.8<br/>4     5  Hello   418   True  21.1    D  439.1<br/>5     6     Hi    98  False  98.1    A  196.1</span></pre></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><h2 id="75ec" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用NumPy的select()方法</h2><p id="3d2f" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">现在，一种更矢量化的方法(在性能方面可能更好)是使用NumPy的<code class="fe nd ne nf ng b">select()</code>方法，如下所述。</p><p id="4602" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">同样，假设我们想要创建一个名为<code class="fe nd ne nf ng b">colF</code>的新列，它将基于列<code class="fe nd ne nf ng b">colC</code>的值来创建。这一次，我们将创建一个包含所需条件的列表，而不是定义一个函数。</p><pre class="kk kl km kn gu nt ng nu bn nv nw bi"><span id="4b1e" class="nx lb iu ng b be ny nz l oa ob">import numpy as np<br/>conditions = [<br/>  np.logical_and(df['colC'].gt(0), np.less_equal(df['colC'], 99)),<br/>  np.logical_and(df['colC'].gt(100), np.less_equal(df['colC'],199)),<br/>  np.logical_and(df['colC'].gt(200), np.less_equal(df['colC'],299)),<br/>]</span></pre><p id="9b12" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">然后，我们定义一个额外的列表，其中包含新列将包含的相应值。注意，在下面的列表中，我们不包括默认值<code class="fe nd ne nf ng b">D</code>。</p><pre class="kk kl km kn gu nt ng nu bn nv nw bi"><span id="5a98" class="nx lb iu ng b be ny nz l oa ob">outputs = ['A', 'B', 'C']</span></pre><p id="07f6" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated">最后，我们使用<code class="fe nd ne nf ng b">select()</code>方法来应用条件，并指定当指定的条件都不满足时将使用的默认值。</p><pre class="kk kl km kn gu nt ng nu bn nv nw bi"><span id="bfa0" class="nx lb iu ng b be ny nz l oa ob">df['colF'] = pd.Series(np.select(conditions, outputs, 'D'))<br/><br/>print(df)<br/>    colA   colB  colC   colD  colE colF<br/>0     1  Hello   158   True  12.8    B<br/>1     2    Hey   567  False  74.2    D<br/>2     3     Hi   123  False   1.1    B<br/>3     4  Howdy   578   True  45.8    D<br/>4     5  Hello   418   True  21.1    D<br/>5     6     Hi    98  False  98.1    A</span></pre></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><h2 id="3785" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用loc属性</h2><p id="7c34" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">最后，另一个选择是<code class="fe nd ne nf ng b">loc</code>属性，在某些情况下，它可能比<code class="fe nd ne nf ng b">apply()</code>方法更有效。请注意，与我们之前讨论过的解决方案相比，这种方法可能会更加冗长。</p><pre class="kk kl km kn gu nt ng nu bn nv nw bi"><span id="fdac" class="nx lb iu ng b be ny nz l oa ob">df.loc[<br/>  np.logical_and(df['colC'].gt(0), np.less_equal(df['colC'], 99)), <br/>  'colF'<br/>] = 'A'<br/>df.loc[<br/>  np.logical_and(df['colC'].gt(100), np.less_equal(df['colC'], 199)),'colF'<br/>] = 'B'<br/>df.loc[<br/>  np.logical_and(df['colC'].gt(200), np.less_equal(df['colC'], 299)),'colF'<br/>] = 'C'<br/>df['colF'].fillna('D', inplace=True)<br/><br/>print(df)<br/>   colA   colB  colC   colD  colE colF<br/>0     1  Hello   158   True  12.8    B<br/>1     2    Hey   567  False  74.2    D<br/>2     3     Hi   123  False   1.1    B<br/>3     4  Howdy   578   True  45.8    D<br/>4     5  Hello   418   True  21.1    D<br/>5     6     Hi    98  False  98.1    A</span></pre></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><h2 id="78f3" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">最后的想法</h2><p id="f311" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">在今天的简短指南中，我们讨论了根据现有列的值在pandas数据框架中添加新列。具体来说，我们展示了如何在pandas中使用<code class="fe nd ne nf ng b">apply()</code>方法和<code class="fe nd ne nf ng b">loc[]</code>属性来实现这一点，如果您对更加矢量化的方法感兴趣，还可以使用NumPy的<code class="fe nd ne nf ng b">select()</code>方法。</p></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><p id="1b77" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated"><a class="ae kz" href="https://gmyrianthous.medium.com/membership" rel="noopener"> <strong class="ly iv">成为会员</strong> </a> <strong class="ly iv">阅读介质上的每一个故事。你的会员费直接支持我和你看的其他作家。你也可以在媒体上看到所有的故事。</strong></p></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><p id="676e" class="pw-post-body-paragraph lw lx iu ly b lz mp jv mb mc mq jy me lj mr mg mh ln ms mj mk lr mt mm mn mo in bi translated"><strong class="ly iv">你可能也会喜欢</strong></p><div class="oc od gq gs oe of"><a rel="noopener follow" target="_blank" href="/sparksession-vs-sparkcontext-vs-sqlcontext-vs-hivecontext-741d50c9486a"><div class="og ab fp"><div class="oh ab oi cl cj oj"><h2 class="bd iv gz z fq ok fs ft ol fv fx it bi translated">spark session vs spark context vs SQLContext vs hive context</h2><div class="om l"><h3 class="bd b gz z fq ok fs ft ol fv fx dk translated">SparkSession、SparkContext HiveContext和SQLContext有什么区别？</h3></div><div class="on l"><p class="bd b dl z fq ok fs ft ol fv fx dk translated">towardsdatascience.com</p></div></div><div class="oo l"><div class="op l oq or os oo ot kt of"/></div></div></a></div></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu of"><a rel="noopener follow" target="_blank" href="/how-to-efficiently-convert-a-pyspark-dataframe-to-pandas-8bda2c3875c3"><div class="og ab fp"><div class="oh ab oi cl cj oj"><h2 class="bd iv gz z fq ok fs ft ol fv fx it bi translated">加快PySpark和Pandas数据帧之间的转换</h2><div class="om l"><h3 class="bd b gz z fq ok fs ft ol fv fx dk translated">将大型Spark数据帧转换为熊猫时节省时间</h3></div><div class="on l"><p class="bd b dl z fq ok fs ft ol fv fx dk translated">towardsdatascience.com</p></div></div><div class="oo l"><div class="ou l oq or os oo ot kt of"/></div></div></a></div></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu of"><a href="https://medium.com/geekculture/how-to-refine-your-google-search-and-get-better-results-c774cde9901c" rel="noopener follow" target="_blank"><div class="og ab fp"><div class="oh ab oi cl cj oj"><h2 class="bd iv gz z fq ok fs ft ol fv fx it bi translated">如何优化你的谷歌搜索并获得更好的结果</h2><div class="om l"><h3 class="bd b gz z fq ok fs ft ol fv fx dk translated">更智能的谷歌搜索的12个技巧</h3></div><div class="on l"><p class="bd b dl z fq ok fs ft ol fv fx dk translated">medium.com</p></div></div><div class="oo l"><div class="ov l oq or os oo ot kt of"/></div></div></a></div></div></div>    
</body>
</html>