<html>
<head>
<title>Rendering Responsive Text on Video using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python渲染视频上的响应文本</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/rendering-responsive-text-on-video-using-python-a3863c7bbb2e?source=collection_archive---------39-----------------------#2021-04-07">https://towardsdatascience.com/rendering-responsive-text-on-video-using-python-a3863c7bbb2e?source=collection_archive---------39-----------------------#2021-04-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9aa9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用OpenCV进行计算机视觉项目实践</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d7d145ac10fe809531ac4a95a1b04cd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VRiirJEkZApOqlb7laA1Og.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">BBC创意在<a class="ae ky" href="https://unsplash.com/s/photos/video-editing?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="da6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我将向你展示如何使用Python渲染视频中的响应文本。我们将在整个项目中使用OpenCV python包。这可能听起来有点难以做到，只是OpenCV，这是一个计算机视觉包，但在这个项目中，你会看到它在视频编辑方面也很好。我做了一个和这个类似的项目，可以在这里找到<a class="ae ky" rel="noopener" target="_blank" href="/rendering-text-on-video-using-python-1c006519c0aa">。在那篇文章中，我展示了如何在视频上添加静态文本。但是这一次，我决定通过添加一个可更新的响应文本来增加一些趣味，而不是使用像MoviePy这样的视频编辑库。</a></p><p id="cc85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你会喜欢这个项目。我们开始吧！</p><h2 id="b6a8" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">目录</h2><ul class=""><li id="a482" class="mo mp it lb b lc mq lf mr li ms lm mt lq mu lu mv mw mx my bi translated"><em class="mz">简介</em></li><li id="2696" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu mv mw mx my bi translated"><em class="mz">步骤1 —导入视频</em></li><li id="52fd" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu mv mw mx my bi translated"><em class="mz">步骤2 —阅读文本文档</em></li><li id="57eb" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu mv mw mx my bi translated"><em class="mz">步骤3 —响应文本功能</em></li><li id="2df8" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu mv mw mx my bi translated"><em class="mz">最后一步——渲染视频</em></li></ul></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="0ed3" class="nm lw it bd lx nn no np ma nq nr ns md jz nt ka mg kc nu kd mj kf nv kg mm nw bi translated">介绍</h1><p id="45b8" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">正如我前面提到的，我们将在这个项目中只使用OpenCV包。而且是超级酷的计算机视觉库。当处理像这样的机器学习或计算机视觉项目时，我们需要首先安装软件包。这样，我们就有权力使用它。我先分享一点OpenCV的定义，然后我们安装。</p><blockquote class="oa ob oc"><p id="d38c" class="kz la mz lb b lc ld ju le lf lg jx lh od lj lk ll oe ln lo lp of lr ls lt lu im bi translated"><strong class="lb iu"> OpenCV </strong>(开源计算机视觉库)是一个开源的计算机视觉和机器学习软件库。OpenCV旨在为计算机视觉应用提供一个公共基础设施，并加速机器感知在商业产品中的应用。作为一个BSD许可的产品，OpenCV使得企业利用和修改代码变得很容易。</p><p id="1243" class="kz la mz lb b lc ld ju le lf lg jx lh od lj lk ll oe ln lo lp of lr ls lt lu im bi translated">来源:<a class="ae ky" href="https://opencv.org/" rel="noopener ugc nofollow" target="_blank">https://opencv.org</a></p></blockquote><p id="4639" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们使用PIP安装它。如果你想知道更多关于安装的信息，请随意搜索“如何将OpenCV安装到Windows或macOS”。顺便说一下，在您的终端中运行这一行之前，请确保已经安装了Python。</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="69fa" class="lv lw it oh b gy ol om l on oo">pip install opencv-python</span></pre><p id="8ebb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装完成后，我们可以进入文本编辑器并开始编程。这个项目我不推荐用Jupyter笔记本；由于我们将创建一个在新窗口上运行的视频播放器，这样更容易打开和关闭窗口。否则，程序可能会冻结并且没有响应。</p><p id="0a84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我在文本编辑器中的第一行。我正在使用<em class="mz"> import </em>方法导入我们刚刚安装到程序中的OpenCV包。</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="fd2e" class="lv lw it oh b gy ol om l on oo">import cv2</span></pre><p id="7e87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完美！现在我们可以进入下一步，我们将选择一个视频并将其导入到程序中。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="0daa" class="nm lw it bd lx nn no np ma nq nr ns md jz nt ka mg kc nu kd mj kf nv kg mm nw bi translated">步骤1 —导入视频</h1><p id="4840" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">这将是一个简单的步骤。我们将做两件事:导入一个视频，并找到视频的帧速率。我们将使用帧速率来计算视频中的秒数，以便我们可以计算不同文本的渲染持续时间。</p><p id="42bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们使用<em class="mz">视频捕获</em>方法导入视频。如果你想了解更多关于<em class="mz">视频捕捉</em>的信息，这里是<a class="ae ky" href="https://docs.opencv.org/3.4/d8/dfe/classcv_1_1VideoCapture.html" rel="noopener ugc nofollow" target="_blank">官方参考</a>页面。</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="10dc" class="lv lw it oh b gy ol om l on oo">tree_video = cv2.VideoCapture('tree.mov')</span></pre><p id="b412" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们来计算导入视频的帧速率。</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="99d1" class="lv lw it oh b gy ol om l on oo">fps = tree_video.get(cv2.CAP_PROP_FPS)<br/>print(fps)</span><span id="9bd4" class="lv lw it oh b gy op om l on oo">#result<br/>23.97</span></pre><p id="2daa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我运行这条线时，终端上显示出23.97。这意味着视频基本上是每秒24帧。所以24次的捕捉循环相当于1秒钟的视频。我将分享更多关于我如何在<em class="mz">响应文本函数</em>步骤中进行计算的信息。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="3073" class="nm lw it bd lx nn no np ma nq nr ns md jz nt ka mg kc nu kd mj kf nv kg mm nw bi translated">步骤2 —阅读文本文档</h1><p id="af83" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">在这一步中，我们将从文本文档中读取文本。我们将使用<em class="mz"> open </em>函数，这是Python自带的内置函数。这是我将要导入的文本文档的截图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/c71b0b84209bcb54da869d3f1cc065b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u9BM6nUM2NyAhLmyJx-9kQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="abe9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这几行是我写的一首诗，叫做《大树下的<a class="ae ky" href="https://sonsuzdesign.blog/2019/12/14/under-the-giant-tree/" rel="noopener ugc nofollow" target="_blank"><em class="mz"/></a>》。</p><p id="a95d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保每个句子都在新的一行。在阅读文本文档时，我们会将每一行转换成一个列表项。</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="e2ac" class="lv lw it oh b gy ol om l on oo">poem = open('under_the_giant_tree.txt')<br/>poem_lines = list(poem)</span><span id="1dd4" class="lv lw it oh b gy op om l on oo">print(poem_lines)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/4d77ab5523ffa95d75fcd4b208f58840.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-clU_WIkKu5mhqplIbAtTw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="2d4a" class="nm lw it bd lx nn no np ma nq nr ns md jz nt ka mg kc nu kd mj kf nv kg mm nw bi translated">步骤3 —响应文本功能</h1><p id="d823" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">在这一步，我们将编写一个函数来更新文本。我决定根据不同的时间戳更新文本，但可以随意将其更改为不同的大小写。</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="a7b2" class="lv lw it oh b gy ol om l on oo">frame_ = 0</span><span id="b3c6" class="lv lw it oh b gy op om l on oo">def text_update(frame_):<br/> if frames_ &lt; (5*fps):<br/>  text = str(poem_lines[2])<br/> elif frames_ &lt; (10*fps):<br/>  text = str(poem_lines[4])<br/> elif frames_ &lt; (15*fps):<br/>  text = str(poem_lines[6])<br/> elif frames_ &lt; (20*fps):<br/>  text = str(poem_lines[8])<br/> else:<br/>  text = "no text found"<br/> return text</span></pre><p id="c564" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我正在使用if-else来了解正在播放的视频的时间戳。开关盒也可以做到这一点。请随意摆弄代码。</p><p id="2d5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经定义了一个名为"<em class="mz"> frame_" </em>的新变量来传入视频帧。这样，我可以用秒来计算持续时间。我们已经知道了第一步中的每秒帧数，即24 fps。在此功能中，文本将每五秒更新一次。我将这首诗的诗句赋给文本变量。</p><p id="c093" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们进入最后一步。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="3996" class="nm lw it bd lx nn no np ma nq nr ns md jz nt ka mg kc nu kd mj kf nv kg mm nw bi translated">最后一步——渲染视频</h1><p id="d135" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">太好了！我们差不多完成了。在这最后一步，我们将结合我们迄今为止所做的一切。我们将使用while循环来触发程序。我们可以使用“escape”或“q”键结束循环。</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="3639" class="lv lw it oh b gy ol om l on oo">while(True):</span><span id="73cf" class="lv lw it oh b gy op om l on oo">ret, frame = tree_video.read()</span><span id="d03d" class="lv lw it oh b gy op om l on oo">font = cv2.FONT_HERSHEY_SIMPLEX</span><span id="d769" class="lv lw it oh b gy op om l on oo">on_video_text = text_update(frame_)<br/>   <br/>  cv2.putText(frame, on_video_text, (50, 50), font, 1, (0, 255, 255),<br/>    2, cv2.LINE_4)</span><span id="d288" class="lv lw it oh b gy op om l on oo">frame_ = frame_ + 1</span><span id="5690" class="lv lw it oh b gy op om l on oo">cv2.imshow('poem on video', frame)</span><span id="464e" class="lv lw it oh b gy op om l on oo">if cv2.waitKey(1) &amp; 0xFF == ord('q'):<br/>    break</span><span id="e99d" class="lv lw it oh b gy op om l on oo">tree_video.release()</span><span id="4113" class="lv lw it oh b gy op om l on oo">cv2.destroyAllWindows()</span></pre><p id="577f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么上面的代码中发生了什么呢:</p><ul class=""><li id="b17c" class="mo mp it lb b lc ld lf lg li os lm ot lq ou lu mv mw mx my bi translated">我们从读取导入的视频记录开始。</li><li id="bee7" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu mv mw mx my bi translated">然后，我们定义想要用于文本的字体。</li><li id="6c08" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu mv mw mx my bi translated">然后，我们调用<em class="mz"> text_update </em>函数来更新文本。</li><li id="4ea9" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu mv mw mx my bi translated">我们使用<em class="mz"> putText </em>方法在视频上添加我们的响应文本。<a class="ae ky" href="https://docs.opencv.org/master/d6/d6e/group__imgproc__draw.html" rel="noopener ugc nofollow" target="_blank">这里的</a>是官方参考链接，在这里你可以了解更多关于<em class="mz"> putText的信息。</em></li><li id="b361" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu mv mw mx my bi translated">之后，我们正在更新frame变量，以便将正确的帧传递给我们的<em class="mz"> text_update </em>函数。</li><li id="e604" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu mv mw mx my bi translated">为了在新窗口上显示视频，我们使用了<em class="mz"> imshow </em>方法。</li><li id="861e" class="mo mp it lb b lc na lf nb li nc lm nd lq ne lu mv mw mx my bi translated">最后，用if语句结束while循环。当按下“escape”或“q”键时，程序将停止运行。如果没有按任何键，视频结束时窗口将关闭。</li></ul><p id="7667" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我运行程序后播放的视频截图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/785cb424e18bb447dac33a29057d3ac2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kmevQTN6xJBxCqAu81PhIA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b158" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">恭喜你。！我们已经学习了如何使用Python在视频上呈现可更新的响应文本。我希望你喜欢这个动手的计算机视觉项目。从事动手编程项目是提高编码技能的最佳方式。如果你今天学到了新东西，我会很骄傲。</p><p id="d535" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您在执行代码时有任何问题，请随时<a class="ae ky" href="https://sonsuzdesign.blog/" rel="noopener ugc nofollow" target="_blank">联系我</a>。我尽力在两周内回来。</p><blockquote class="oa ob oc"><p id="69be" class="kz la mz lb b lc ld ju le lf lg jx lh od lj lk ll oe ln lo lp of lr ls lt lu im bi translated">我们来连线。查看我的<a class="ae ky" href="https://medium.com/@lifexplorer" rel="noopener">博客</a>和<a class="ae ky" href="https://www.youtube.com/behicguven" rel="noopener ugc nofollow" target="_blank"> youtube </a>以获得灵感。谢谢你，</p></blockquote></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h2 id="00de" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">更多计算机视觉和机器学习相关的项目</h2><div class="ow ox gp gr oy oz"><a rel="noopener follow" target="_blank" href="/building-a-face-recognizer-in-python-7fd6630c6340"><div class="pa ab fo"><div class="pb ab pc cl cj pd"><h2 class="bd iu gy z fp pe fr fs pf fu fw is bi translated">用Python构建人脸识别器</h2><div class="pg l"><h3 class="bd b gy z fp pe fr fs pf fu fw dk translated">使用OpenCv库进行实时人脸识别的分步指南</h3></div><div class="ph l"><p class="bd b dl z fp pe fr fs pf fu fw dk translated">towardsdatascience.com</p></div></div><div class="pi l"><div class="pj l pk pl pm pi pn ks oz"/></div></div></a></div><div class="ow ox gp gr oy oz"><a rel="noopener follow" target="_blank" href="/extracting-speech-from-video-using-python-f0ec7e312d38"><div class="pa ab fo"><div class="pb ab pc cl cj pd"><h2 class="bd iu gy z fp pe fr fs pf fu fw is bi translated">使用Python从视频中提取语音</h2><div class="pg l"><h3 class="bd b gy z fp pe fr fs pf fu fw dk translated">使用Google语音识别API的简单实用项目</h3></div><div class="ph l"><p class="bd b dl z fp pe fr fs pf fu fw dk translated">towardsdatascience.com</p></div></div><div class="pi l"><div class="po l pk pl pm pi pn ks oz"/></div></div></a></div></div></div>    
</body>
</html>