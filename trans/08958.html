<html>
<head>
<title>QuestDB vs. TimescaleDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">QuestDB与时标b</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/questdb-vs-timescaledb-38160a361c0e?source=collection_archive---------21-----------------------#2021-08-18">https://towardsdatascience.com/questdb-vs-timescaledb-38160a361c0e?source=collection_archive---------21-----------------------#2021-08-18</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><figure class="it iu gq gs iv iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj is"><img src="../Images/3221c93a90128408a4f693276d168bb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gXv2N7Pa79WA_NOJB4u-3g.jpeg"/></div></div><p class="jd je gk gi gj jf jg bd b be z dk translated">照片由<a class="ae jh" href="https://unsplash.com/@i_am_g?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Guillaume Jaillet </a>在<a class="ae jh" href="https://unsplash.com/s/photos/fast?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><h2 id="7837" class="ji jj jk bd b dl jl jm jn jo jp jq dk jr translated" aria-label="kicker paragraph">数据工程，时间序列</h2><div class=""/><div class=""><h2 id="15d9" class="pw-subtitle-paragraph kq jt jk bd b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dk translated">如何使用时序基准测试套件比较QuestDB和TimescaleDB的数据库读写性能</h2></div><h1 id="7312" class="li lj jk bd lk ll lm ln lo lp lq lr ls kz lt la lu lc lv ld lw lf lx lg ly lz bi translated">介绍</h1><p id="aa8b" class="pw-post-body-paragraph ma mb jk mc b md me ku mf mg mh kx mi mj mk ml mm mn mo mp mq mr ms mt mu mv in bi translated">在这个联系空前紧密的世界里，数十亿用户正在产生比以往更多的数据。从人类通信到我们创造的数字足迹，物联网传感器已经无处不在，金融交易也实现了数字化。我们有大量以时间为中心的数据，我们正在努力跟上这一切。时间系列数据库正在崛起。OSS项目，如QuestDB、InfluxDB、TimescaleDB，以及基于云的解决方案，如Amazon Timestream等。的需求量比以往任何时候都大。时间系列数据库已经正式成熟。</p><p id="bca1" class="pw-post-body-paragraph ma mb jk mc b md mw ku mf mg mx kx mi mj my ml mm mn mz mp mq mr na mt mu mv in bi translated">所有这些产品都在争夺时间序列领域的更大空间，在这样做的过程中，它们互相做得更好。本文将考察两个主要的时间序列数据库，并使用一个名为TSBS的开源基准测试工具——时间序列基准测试套件对它们进行比较。这个基准测试套件基于最初在InfluxDB开发的测试脚本，后来被其他主要的timeseries数据库增强，目前由TimescaleDB维护。</p><h1 id="b5ea" class="li lj jk bd lk ll lm ln lo lp lq lr ls kz lt la lu lc lv ld lw lf lx lg ly lz bi translated">什么是时间序列基准测试套件(TSBS)？</h1><p id="21c4" class="pw-post-body-paragraph ma mb jk mc b md me ku mf mg mh kx mi mj mk ml mm mn mo mp mq mr ms mt mu mv in bi translated">对于MySQL和PostgreSQL等传统数据库，许多流行的选项如<a class="ae jh" href="https://hammerdb.com/" rel="noopener ugc nofollow" target="_blank"> HammerDB </a>和<a class="ae jh" href="https://github.com/akopytov/sysbench" rel="noopener ugc nofollow" target="_blank"> sysbench </a>都是衡量数据库读写性能的标准工具。不同类型的数据库都有类似的工具。当基准测试工具通过创建真实的突发和读取流来模拟真实场景时，性能测试是有意义的。时间序列数据库的访问模式与传统数据库非常不同——这就是为什么我们需要像TSBS这样的工具。</p><p id="b95d" class="pw-post-body-paragraph ma mb jk mc b md mw ku mf mg mx kx mi mj my ml mm mn mz mp mq mr na mt mu mv in bi translated">TSBS目前支持两种负载:</p><ul class=""><li id="9447" class="nb nc jk mc b md mw mg mx mj nd mn ne mr nf mv ng nh ni nj bi translated"><strong class="mc ju">物联网</strong> —模拟卡车运输公司的传感器生成的物联网数据。想象一下，使用车队中每辆卡车的实时诊断数据来跟踪一个货运车队。</li><li id="a7ae" class="nb nc jk mc b md nk mg nl mj nm mn nn mr no mv ng nh ni nj bi translated"><strong class="mc ju"> DevOps </strong> —模拟服务器生成的数据使用情况，跟踪内存使用情况、CPU使用情况、磁盘使用情况等。想象一下，查看Grafana仪表板上的这些指标，并获得违规警报。</li></ul><h1 id="eba0" class="li lj jk bd lk ll lm ln lo lp lq lr ls kz lt la lu lc lv ld lw lf lx lg ly lz bi translated">先决条件</h1><p id="ae02" class="pw-post-body-paragraph ma mb jk mc b md me ku mf mg mh kx mi mj mk ml mm mn mo mp mq mr ms mt mu mv in bi translated">对于本教程，我们将使用DevOps选项。首先，您需要遵循以下步骤:</p><ul class=""><li id="6ff1" class="nb nc jk mc b md mw mg mx mj nd mn ne mr nf mv ng nh ni nj bi translated"><strong class="mc ju">在您的机器上安装Docker </strong>，以便您可以从Docker Hub安装并运行<a class="ae jh" href="https://questdb.io/docs/get-started/docker/" rel="noopener ugc nofollow" target="_blank"> QuestDB </a>和<a class="ae jh" href="https://hub.docker.com/r/timescale/timescaledb/" rel="noopener ugc nofollow" target="_blank"> TimescaleDB </a>。</li><li id="63a1" class="nb nc jk mc b md nk mg nl mj nm mn nn mr no mv ng nh ni nj bi translated"><strong class="mc ju">克隆TSBS存储库</strong> —一旦三个都启动并运行，<a class="ae jh" href="https://github.com/questdb/tsbs" rel="noopener ugc nofollow" target="_blank">在您的机器上克隆TSBS存储库</a>。</li></ul><figure class="np nq nr ns gu iw"><div class="bz fq l di"><div class="nt nu l"/></div></figure><blockquote class="nv nw nx"><p id="af34" class="ma mb ny mc b md mw ku mf mg mx kx mi nz my ml mm oa mz mp mq ob na mt mu mv in bi translated"><strong class="mc ju"> <em class="jk">注:</em> </strong> <em class="jk">该基准测试是在AWS EC2上的16核英特尔至强白金8175M CPU @ 2.50GHz和128 GB RAM上完成的。</em></p></blockquote><h1 id="f079" class="li lj jk bd lk ll lm ln lo lp lq lr ls kz lt la lu lc lv ld lw lf lx lg ly lz bi translated">使用TSBS测试时序数据库性能</h1><p id="a0ec" class="pw-post-body-paragraph ma mb jk mc b md me ku mf mg mh kx mi mj mk ml mm mn mo mp mq mr ms mt mu mv in bi translated">我们将分四个阶段测试这两个数据库的性能:</p><ul class=""><li id="62ed" class="nb nc jk mc b md mw mg mx mj nd mn ne mr nf mv ng nh ni nj bi translated"><strong class="mc ju">生成一天的</strong> <strong class="mc ju"> DevOps数据</strong>，其中每10秒收集200个设备的9个不同指标。将根据QuestDB和TimescaleDB各自的格式分别为它们生成数据。为此使用<code class="fe oc od oe of b"><strong class="mc ju">tsbs_generate_data</strong></code>实用程序。</li><li id="932f" class="nb nc jk mc b md nk mg nl mj nm mn nn mr no mv ng nh ni nj bi translated"><strong class="mc ju">加载</strong>生成的数据。使用<code class="fe oc od oe of b"><strong class="mc ju">tsbs_load_questdb</strong></code>和<code class="fe oc od oe of b"><strong class="mc ju">tsbs_load</strong></code> <strong class="mc ju"> </strong>实用程序分别将数据加载到QuestDB和TimescaleDB中。这使我们能够测试每个系统的接收和写入速度。</li><li id="f681" class="nb nc jk mc b md nk mg nl mj nm mn nn mr no mv ng nh ni nj bi translated"><strong class="mc ju">生成</strong>查询，在QuestDB和TimescaleDB的加载数据上运行。为此，请使用<code class="fe oc od oe of b"><strong class="mc ju">tsbs_generate_queries</strong></code> <strong class="mc ju"> </strong>实用程序。</li><li id="5d67" class="nb nc jk mc b md nk mg nl mj nm mn nn mr no mv ng nh ni nj bi translated"><strong class="mc ju">分别使用<code class="fe oc od oe of b"><strong class="mc ju">tsbs_run_queries_questdb</strong></code>和<code class="fe oc od oe of b"><strong class="mc ju">tsbs_run_queries_timescaledb</strong></code>在QuestDB和TimescaleDB上执行</strong>生成的查询。</li></ul><p id="f3bc" class="pw-post-body-paragraph ma mb jk mc b md mw ku mf mg mx kx mi mj my ml mm mn mz mp mq mr na mt mu mv in bi translated">让我们一个接一个地检查每个步骤的脚本。</p><h1 id="ede6" class="li lj jk bd lk ll lm ln lo lp lq lr ls kz lt la lu lc lv ld lw lf lx lg ly lz bi translated">生成测试数据</h1><p id="98d2" class="pw-post-body-paragraph ma mb jk mc b md me ku mf mg mh kx mi mj mk ml mm mn mo mp mq mr ms mt mu mv in bi translated">在本教程中，我们将基准测试的<code class="fe oc od oe of b"><strong class="mc ju">scale</strong></code>限制在200台设备。如上所述，数据将在一天内生成，每10秒钟跟踪一百个设备中每一个设备的九个指标。使用<code class="fe oc od oe of b"><strong class="mc ju">tsbs_generate_data</strong></code>命令，您可以为任何支持的数据库和用例生成测试数据。</p><blockquote class="nv nw nx"><p id="de2f" class="ma mb ny mc b md mw ku mf mg mx kx mi nz my ml mm oa mz mp mq ob na mt mu mv in bi translated"><strong class="mc ju"> <em class="jk">注意:</em> </strong> <em class="jk">生成的数据会占用很多空间。您可以根据基准测试要求和磁盘空间的可用性来扩大或缩小规模。</em></p></blockquote><figure class="np nq nr ns gu iw"><div class="bz fq l di"><div class="nt nu l"/></div></figure><blockquote class="nv nw nx"><p id="6b7d" class="ma mb ny mc b md mw ku mf mg mx kx mi nz my ml mm oa mz mp mq ob na mt mu mv in bi translated"><strong class="mc ju"> <em class="jk">注意:</em> </strong> <em class="jk">由于TimescaleDB和QuestDB使用的格式不同，为数据生成的文件大小也会不同。QuestDB使用的流入线协议格式比其他任何格式都要简单得多。</em></p></blockquote><h1 id="fe1c" class="li lj jk bd lk ll lm ln lo lp lq lr ls kz lt la lu lc lv ld lw lf lx lg ly lz bi translated">加载数据</h1><p id="7db6" class="pw-post-body-paragraph ma mb jk mc b md me ku mf mg mh kx mi mj mk ml mm mn mo mp mq mr ms mt mu mv in bi translated">加载数据甚至比生成数据更简单。对于TimescaleDB，您可以使用通用实用程序<code class="fe oc od oe of b"><strong class="mc ju">tsbs_load</strong></code>。对于QuestDB，您可以使用<code class="fe oc od oe of b"><strong class="mc ju">tsbs_load_questdb</strong></code>实用程序，因为它支持一些特定于QuestDB的标志，比如用于流入线路协议绑定端口的<code class="fe oc od oe of b">--<strong class="mc ju">ilp-bind-to</strong></code>和表示QuestDB的REST端点的<code class="fe oc od oe of b"><strong class="mc ju">--url</strong></code>。您可以使用以下命令将数据分别加载到TimescaleDB和QuestDB中:</p><blockquote class="nv nw nx"><p id="ddc0" class="ma mb ny mc b md mw ku mf mg mx kx mi nz my ml mm oa mz mp mq ob na mt mu mv in bi translated"><strong class="mc ju"> <em class="jk">注意:</em> </strong> <em class="jk">请按照TimescaleDB的config.yaml文件的说明操作。</em></p></blockquote><figure class="np nq nr ns gu iw"><div class="bz fq l di"><div class="nt nu l"/></div></figure><p id="1126" class="pw-post-body-paragraph ma mb jk mc b md mw ku mf mg mx kx mi mj my ml mm mn mz mp mq mr na mt mu mv in bi translated">为了更好地了解负载性能，您可以尝试更改<code class="fe oc od oe of b"><strong class="mc ju">--workers</strong></code> <strong class="mc ju"> </strong>参数。请确保两个数据库的基准参数和条件是相同的，这样您就可以得到公平的比较。</p><h2 id="2d6c" class="og lj jk bd lk oh oi dn lo oj ok dp ls mj ol om lu mn on oo lw mr op oq ly jq bi translated">时标DB加载/写入性能</h2><pre class="np nq nr ns gu or of os ot aw ou bi"><span id="7286" class="og lj jk of b gz ov ow l ox oy">./tsbs_load load timescaledb --config=./config.yaml<br/>...<br/>Summary:<br/>loaded 174528000 metrics in 59.376sec with 8 workers (mean rate 2939386.10 metrics/sec)<br/>loaded <strong class="of ju">15552000</strong> rows in <strong class="of ju">59.376sec</strong> with <strong class="of ju">8 workers</strong> (mean rate 261925.49 rows/sec)</span></pre><h2 id="9131" class="og lj jk bd lk oh oi dn lo oj ok dp ls mj ol om lu mn on oo lw mr op oq ly jq bi translated">QuestDB加载/写入性能</h2><pre class="np nq nr ns gu or of os ot aw ou bi"><span id="c987" class="og lj jk of b gz ov ow l ox oy">./tsbs_load_questdb --file /tmp/questdb-data --workers 8<br/>...<br/>Summary:<br/>loaded 174528000 metrics in 18.223sec with 8 workers (mean rate 9577373.06 metrics/sec)<br/>loaded <strong class="of ju">15552000</strong> rows in <strong class="of ju">18.223sec</strong> with <strong class="of ju">8 workers</strong> (mean rate 853429.28 rows/sec)</span></pre><p id="f6e8" class="pw-post-body-paragraph ma mb jk mc b md mw ku mf mg mx kx mi mj my ml mm mn mz mp mq mr na mt mu mv in bi translated">在这种情况下，有八个工作线程的QuestDB的写性能比TimescaleDB快<strong class="mc ju"> ~3.2x </strong> <strong class="mc ju">。关于这次基准测试的完整输出，请<a class="ae jh" href="https://github.com/kovid-r/tsbs-questdb-timescaledb#readme" rel="noopener ugc nofollow" target="_blank">访问这个GitHub库</a>。</strong></p><h1 id="144e" class="li lj jk bd lk ll lm ln lo lp lq lr ls kz lt la lu lc lv ld lw lf lx lg ly lz bi translated">生成查询</h1><p id="e8ec" class="pw-post-body-paragraph ma mb jk mc b md me ku mf mg mh kx mi mj mk ml mm mn mo mp mq mr ms mt mu mv in bi translated">TSBS为QuestDB和TimescaleDB生成的数据集包含200台主机的指标。为了查询所有主机中某个指标高于阈值的所有读数，我们将使用查询类型<code class="fe oc od oe of b"><strong class="mc ju">high-cpu-all</strong></code>。要在一天内生成1000个不同时间范围的查询，您需要运行以下命令:</p><figure class="np nq nr ns gu iw"><div class="bz fq l di"><div class="nt nu l"/></div></figure><p id="2a40" class="pw-post-body-paragraph ma mb jk mc b md mw ku mf mg mx kx mi mj my ml mm mn mz mp mq mr na mt mu mv in bi translated">在本教程中，我们只运行一种类型的读取查询。您可以从<a class="ae jh" href="https://github.com/questdb/tsbs#appendix-i-query-types-" rel="noopener ugc nofollow" target="_blank">中选择不同类型的查询</a>来测试读取性能。</p><figure class="np nq nr ns gu iw"><div class="bz fq l di"><div class="nt nu l"/></div></figure><h1 id="25d3" class="li lj jk bd lk ll lm ln lo lp lq lr ls kz lt la lu lc lv ld lw lf lx lg ly lz bi translated">执行查询</h1><p id="ee2a" class="pw-post-body-paragraph ma mb jk mc b md me ku mf mg mh kx mi mj mk ml mm mn mo mp mq mr ms mt mu mv in bi translated">现在我们已经生成了数据，并将其加载到QuestDB和TimescaleDB中，还生成了我们想要运行的基准测试查询，我们最终可以使用以下命令执行读取性能基准测试:</p><blockquote class="nv nw nx"><p id="c977" class="ma mb ny mc b md mw ku mf mg mx kx mi nz my ml mm oa mz mp mq ob na mt mu mv in bi translated"><strong class="mc ju"> <em class="jk">注意:</em> </strong> <em class="jk">确保在运行命令之前已经正确生成了查询。为此，您可以运行</em> <code class="fe oc od oe of b"><strong class="mc ju"><em class="jk">less /tmp/timescaledb-queries-high-cpu-all</em></strong></code> <strong class="mc ju"> <em class="jk"> </em> </strong> <em class="jk">或</em> <code class="fe oc od oe of b"><strong class="mc ju"><em class="jk">less /tmp/queries_questdb-high-cpu-all</em></strong></code> <em class="jk">。</em></p></blockquote><figure class="np nq nr ns gu iw"><div class="bz fq l di"><div class="nt nu l"/></div></figure><h2 id="be2e" class="og lj jk bd lk oh oi dn lo oj ok dp ls mj ol om lu mn on oo lw mr op oq ly jq bi translated">时标DB读取性能</h2><pre class="np nq nr ns gu or of os ot aw ou bi"><span id="a2e5" class="og lj jk of b gz ov ow l ox oy">Run complete after <strong class="of ju">1000 queries</strong> with <strong class="of ju">8 workers</strong> (Overall query rate <strong class="of ju">25.78 queries/sec</strong>):<br/>TimescaleDB CPU over threshold, all hosts:<br/>min: 222.49ms, med: 274.94ms, mean: 308.60ms, max: 580.13ms, stddev: 73.70ms, sum: 308.6sec, count: 1000<br/>all queries :<br/>min: 222.49ms, med: 274.94ms, mean: 308.60ms, max: 580.13ms, stddev: 73.70ms, sum: 308.6sec, count: 1000<br/>wall clock time: <strong class="of ju">38.827242sec</strong></span></pre><h2 id="17c8" class="og lj jk bd lk oh oi dn lo oj ok dp ls mj ol om lu mn on oo lw mr op oq ly jq bi translated">QuestDB读取性能</h2><pre class="np nq nr ns gu or of os ot aw ou bi"><span id="5249" class="og lj jk of b gz ov ow l ox oy">Run complete after <strong class="of ju">1000 queries</strong> with <strong class="of ju">8 workers</strong> (Overall query rate <strong class="of ju">70.18 queries/sec</strong>):<br/>QuestDB CPU over threshold, all hosts:<br/>min: 92.71ms, med: 109.10ms, mean: 113.32ms, max: 382.57ms, stddev: 19.34ms, sum: 113.3sec, count: 1000<br/>all queries :<br/>min: 92.71ms, med: 109.10ms, mean: 113.32ms, max: 382.57ms, stddev: 19.34ms, sum: 113.3sec, count: 1000<br/>wall clock time: <strong class="of ju">14.275811sec</strong></span></pre><p id="9d61" class="pw-post-body-paragraph ma mb jk mc b md mw ku mf mg mx kx mi mj my ml mm mn mz mp mq mr na mt mu mv in bi translated">QuestDB执行查询的速度比TimescaleDB快2.7倍。</p><h1 id="241b" class="li lj jk bd lk ll lm ln lo lp lq lr ls kz lt la lu lc lv ld lw lf lx lg ly lz bi translated">QuestDB与时标b</h1><p id="e063" class="pw-post-body-paragraph ma mb jk mc b md me ku mf mg mh kx mi mj mk ml mm mn mo mp mq mr ms mt mu mv in bi translated">总结一下读写基准测试的结果，我们可以说QuestDB的写速度明显快于TimescaleDB，读速度也快得多。当我们谈论读取性能时，只使用一种类型的查询可能是不公平的，这就是为什么您可以尝试自己运行TSBS套件来处理这两个数据库的不同类型的查询。总结如下:</p><blockquote class="oz"><p id="23b9" class="pa pb jk bd pc pd pe pf pg ph pi mv dk translated"><em class="pj"> QuestDB执行~ </em> <strong class="ak"> <em class="pj">对于写入/加载工作负载，比TimescaleDB快320%</em></strong><em class="pj">。</em></p><p id="c363" class="pa pb jk bd pc pd pe pf pg ph pi mv dk translated">对于读取/分析工作负载，QuestDB的执行速度比TimescaleDB快270 %。</p></blockquote><h1 id="7b2e" class="li lj jk bd lk ll lm ln lo lp lq lr ls kz pk la lu lc pl ld lw lf pm lg ly lz bi translated">结论</h1><p id="10dd" class="pw-post-body-paragraph ma mb jk mc b md me ku mf mg mh kx mi mj mk ml mm mn mo mp mq mr ms mt mu mv in bi translated">TSBS是时间序列数据库基准测试的事实标准。在本教程中，您学习了如何使用TSBS通过轻松生成测试数据和模拟实际的读写负载来比较两个timeseries数据库。如前所述，TSBS目前支持DevOps和IoT(车辆诊断)的测试数据生成。您可以创建您的测试数据生成脚本来创建更多的用例，例如，实时天气跟踪、交通信号、金融市场等等。</p></div></div>    
</body>
</html>