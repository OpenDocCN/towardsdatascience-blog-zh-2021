<html>
<head>
<title>SQL Views With PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PostgreSQL的SQL视图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/sql-views-with-postgresql-493ba7aa0934?source=collection_archive---------14-----------------------#2021-08-29">https://towardsdatascience.com/sql-views-with-postgresql-493ba7aa0934?source=collection_archive---------14-----------------------#2021-08-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f02a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">简化任务的聪明方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/033fd36aa447f6b5950ff174c44dfad0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hhdcEg-AFHDDrv4WWh5Eyg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com/s/photos/save?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@perfectshot4u?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Arvind meena mina </a>拍摄的照片</p></figure><p id="c6eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL是数据科学家的必备技能。由于许多公司将数据存储在关系数据库中，我们需要使用SQL来访问、查询和分析这些数据。</p><p id="ff9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL能够执行比基本查询更高级的任务。它提供了几个使SQL成为高效数据分析工具的函数。</p><p id="03aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面可能是最简单的SQL查询。它选择表格中的所有行和列。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2f42" class="ma mb it lw b gy mc md l me mf">SELECT * FROM table_name;</span></pre><p id="a7fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着任务复杂性的增加，查询的语法也变得更加复杂。此外，您可能需要查询多个表来获得所需的数据。因此，您的查询可能有几行代码。</p><p id="1912" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您肯定不希望一遍又一遍地输入如此复杂的查询。一种选择是保存它并从那里复制。然而，SQL提供了一种更好的方法，即SQL视图。</p><p id="1af0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">视图是数据库中存储的查询。我们可以像查询表一样查询视图。但是，除了PostgreSQL中的物化视图之外，视图不存储数据。</p><p id="e0f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">类比将帮助我们更好地理解视图的概念。假设您编写了一个Python脚本，该脚本读取一个csv文件，计算一些统计数据，然后返回结果。你需要不时地执行这项任务。如果您将脚本保存在您的工作环境中，您可以在需要执行任务时执行它。您不必每次都编写相同的脚本。</p><p id="9d99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们做一些例子来演示如何使用视图。我用模拟数据创建了两个名为“订单”和“产品”的表。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="673e" class="ma mb it lw b gy mc md l me mf">select * from orders;</span><span id="f295" class="ma mb it lw b gy mg md l me mf"> order_id | product_id | order_qty |    date<br/>----------+------------+-----------+------------<br/>      101 |       1001 |         2 | 2021-01-04<br/>      102 |       1423 |         1 | 2021-01-04<br/>      103 |       1260 |         5 | 2021-01-13<br/>      104 |       1590 |         5 | 2021-05-13<br/>      105 |       1002 |         3 | 2021-01-13<br/>      106 |       1600 |         2 | 2021-05-13</span><span id="cd52" class="ma mb it lw b gy mg md l me mf"><br/>select * from product;</span><span id="7209" class="ma mb it lw b gy mg md l me mf"> product_id | price | description<br/>------------+-------+-------------<br/>       1001 |  2.50 | bread<br/>       1002 |  1.90 | water<br/>       1423 | 10.90 | icecream<br/>       1260 |  5.90 | tomato<br/>       1590 |  4.90 | egg<br/>       1600 |  2.90 | milk</span></pre><p id="d0ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">订单表包含产品id、订单数量和日期信息。产品表包含产品的价格和描述。</p><p id="f5f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下查询计算每份订单的总金额。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="b9ae" class="ma mb it lw b gy mc md l me mf">SELECT <br/>   O.order_id, <br/>   (O.order_qty * P.price) AS order_amount                         FROM orders O <br/>LEFT JOIN product P on O.product_id = P.product_id <br/>ORDER BY order_amount desc;</span><span id="5bee" class="ma mb it lw b gy mg md l me mf"> order_id | order_amount<br/>----------+--------------<br/>      103 |        29.50<br/>      104 |        24.50<br/>      102 |        10.90<br/>      106 |         5.80<br/>      105 |         5.70<br/>      101 |         5.00</span></pre><p id="e7ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于产品价格和订单数量在不同的表中，我们需要在这个查询中使用一个连接。</p><p id="c0cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设这是一个“高度复杂”的查询，我们不想每次都键入它。我们的解决方案是将其存储在视图中。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8199" class="ma mb it lw b gy mc md l me mf">CREATE VIEW order_amounts AS<br/>SELECT <br/>   O.order_id, <br/>   (O.order_qty * P.price) AS order_amount                         FROM orders O <br/>LEFT JOIN product P on O.product_id = P.product_id <br/>ORDER BY order_amount desc;</span></pre><p id="1191" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用create view语句和查询创建视图。我们还需要为视图指定一个名称。</p><p id="a615" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建视图不会返回任何内容。我们可以像查询表一样查询这个视图。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="0d29" class="ma mb it lw b gy mc md l me mf">SELECT * FROM order_amounts;</span><span id="02ad" class="ma mb it lw b gy mg md l me mf"> order_id | order_amount<br/>----------+--------------<br/>      103 |        29.50<br/>      104 |        24.50<br/>      102 |        10.90<br/>      106 |         5.80<br/>      105 |         5.70<br/>      101 |         5.00</span></pre><p id="4f7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们接受金额高于20英镑的订单吧。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6a7e" class="ma mb it lw b gy mc md l me mf">SELECT * FROM order_amounts<br/>WHERE order_amount &gt; 20;</span><span id="4ed9" class="ma mb it lw b gy mg md l me mf"> order_id | order_amount<br/>----------+--------------<br/>      103 |        29.50<br/>      104 |        24.50</span></pre></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><p id="7543" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">视图对于简化任务非常有用。我们用作示例的查询并不复杂。当我们执行涉及多重过滤、聚合和嵌套select语句的高度复杂的任务时，这些视图就派上了用场。</p><p id="5c32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用视图的另一个优点是可以更灵活地控制数据库访问。例如，表中的某些列可能包含只有特定员工才能访问的敏感信息。</p><p id="7e23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们查询视图时，我们只能检索视图中存在的列，而不是视图中使用的表中的每一列。因此，视图允许我们授予对表的部分访问权。</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><p id="c717" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用alter view语句来更改视图的各种辅助属性。例如，列的名称可以更改如下:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f39c" class="ma mb it lw b gy mc md l me mf">ALTER VIEW order_amounts RENAME order_amount TO total_amount;</span><span id="9d12" class="ma mb it lw b gy mg md l me mf">SELECT * FROM order_amounts;</span><span id="0626" class="ma mb it lw b gy mg md l me mf"> order_id | total_amount<br/>----------+--------------<br/>      103 |        29.50<br/>      104 |        24.50<br/>      102 |        10.90<br/>      106 |         5.80<br/>      105 |         5.70<br/>      101 |         5.00</span></pre><p id="e1bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了删除视图，使用了drop view语句。它类似于用于删除表的drop table语句。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="02d9" class="ma mb it lw b gy mc md l me mf">DROP VIEW order_amounts;</span><span id="b061" class="ma mb it lw b gy mg md l me mf">SELECT * FROM order_amounts;<br/>ERROR:  relation "order_amounts" does not exist</span></pre></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h2 id="8752" class="ma mb it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">结论</h2><p id="ddbd" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">SQL视图是存储查询。它们允许我们通过保存复杂的查询以备后用来简化某些任务。这些查询可以看作是一个表，所以我们可以像查询表一样查询它们。</p><p id="6b82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>