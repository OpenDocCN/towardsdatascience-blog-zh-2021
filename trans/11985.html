<html>
<head>
<title>Spurned in a Survival Forest: Customer Churn Prediction in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在生存森林中被抛弃:Python 中的客户流失预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/spurned-in-a-survival-forest-customer-churn-prediction-in-python-2083551f3cc5?source=collection_archive---------6-----------------------#2021-12-02">https://towardsdatascience.com/spurned-in-a-survival-forest-customer-churn-prediction-in-python-2083551f3cc5?source=collection_archive---------6-----------------------#2021-12-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6cfa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">具有 PySurvival 的条件生存森林模型</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/30b8bb1b50f1455a6d6d29b6ca80a4bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PMQ8KUEFcHV2yr7kq20JqA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.istockphoto.com/photo/young-love-spurned-gm166679449-22094493" rel="noopener ugc nofollow" target="_blank">年轻的爱被拒绝的股票照片——由伊斯托克/范德韦尔登(istockphoto.com)</a>在标准许可下拍摄</p></figure><p id="205e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一家公司的<strong class="lb iu">客户流失率</strong> <strong class="lb iu">比率</strong>是在给定的时间段内停止与该公司做生意的客户的百分比。他们中的大多数人肯定已经开始喜欢竞争对手的产品了。留住客户的努力旨在最大限度地降低流失率。</p><p id="c947" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一般来说，试图吸引新客户——通过把他们从竞争对手那里引走——比留住现有客户的成本更高。贝恩公司(Bain &amp; Company)的一篇论文曾指出，在金融服务行业，客户保持率每增加 5%，利润就会增加 25%以上<a class="ae ky" href="https://media.bain.com/Images/BB_Prescription_cutting_costs.pdf" rel="noopener ugc nofollow" target="_blank">(bain.com)</a>。</p><p id="ecbf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的目标是构建一个预测每个客户流失风险的模型。为了向销售和营销团队提供早期预警信号，该模型应识别那些与客户可能很快会拒绝我们的业务的风险增加相关的客户资料。</p><h1 id="d385" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">1.属国</h1><p id="53a8" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">除了我们的核心包如 pandas 和 numpy，我们将安装并导入<strong class="lb iu"> PySurvival </strong>库。</p><p id="ff14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和往常一样，在安装一个复杂的包之前，您应该创建一个新的虚拟环境，尤其是具有非 Python 依赖性的包。PySurvival 需要 C++可再发行版本。</p><p id="0c07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要在<strong class="lb iu"> MacOS 或 Linux 上 pip-install PySurvival，</strong>您应该检查 gcc 是否已经安装在您的机器上:</p><ul class=""><li id="25cf" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated"><a class="ae ky" href="https://square.github.io/pysurvival/installation.html" rel="noopener ugc nofollow" target="_blank">安装—py survival(square . github . io)</a></li></ul><p id="70c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<strong class="lb iu"> Windows </strong>机器上，安装需要一些额外的步骤。PySurvival 开发人员似乎忘记了一个事实，即 Python 用户社区存在于操作系统划分的 Windows 端；或者他们只是没那么喜欢 Windows 用户。但是我们可以在 Windows 机器上运行 PySurvival，即使 pip 安装无法运行。请遵循以下步骤:</p><ul class=""><li id="5f0c" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">使用不高于 3.8 的 Python 版本创建新的虚拟环境。例如在 conda 中:$ conda create-n your chosen name python = 3.8。原因是当前的 PySurvival 版本使用了一种 3.8 以后已经不推荐使用的方法 tp_print。</li><li id="5cf6" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">你将需要微软的 C++编译器。如果您的计算机上还没有安装它，那么一种方法是从以下网址下载免费的 Visual Studio 构建工具:<a class="ae ky" href="https://visualstudio.microsoft.com/downloads/?q=build+tools" rel="noopener ugc nofollow" target="_blank">下载 Visual Studio 工具—免费安装 Windows、Mac、Linux(microsoft.com)</a>。在构建工具选择窗口的左上角，选择“用 C++进行桌面开发”选项。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/e9f8b8d0458079360e19d8c35944e7c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9R6rx_CvYIkvK1aiVwtj_w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">截图:作者</p></figure><ul class=""><li id="275a" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">从这个 GitHub 资源库下载分叉的 PySurvival 包，在 Windows 下工作:【github.com】bacalfa/py Survival:生存分析建模开源包【对其创建者 B. A. Calfa 的赞赏】。将下载的软件包保存在要用作其安装目录的文件夹中。</li><li id="0d6d" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">激活您的新虚拟环境，例如:$ conda activate yourchosenname</li><li id="1fe5" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">在命令提示符下，导航到保存并解压缩 PySurvival 包的目录。</li><li id="f93d" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">在命令提示符下，首先重新打包下载的文件，然后安装软件包:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/e2c3a427300115f532b28bd430ebdc0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:966/format:webp/1*360cSoG9YiRu1z89lSCXDw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/8073b86f44687621a4f0dad51952d563.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*42Kl88ZPDaD4WVTQ027bTQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h1 id="3ab5" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">2.数据争论</h1><p id="fe53" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">PySurvival 附带了一个内置的数据集来分析客户流失。我们从<em class="lv">数据集</em>模块加载它。</p><p id="9e22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">原始数据代表 SaaS 提供商(软件即服务)的客户数据库，该提供商为中小型企业提供一系列服务:数据存储、工资和费用核算、在线营销和客户响应跟踪。它的商业模式是基于每月订阅。</p><p id="1ee3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这家 SaaS 公司要求我们实施一个预测客户流失风险的模型，以便销售和营销团队能够采取行动，增加留住这些高风险客户的机会。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/6f15b60f4c3ea65d07df01d285d17145.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hzpj4AlKRajvcrLUzZv_QA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="e94d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">源数据由 13 列组成，其中 5 列是分类变量。Pandas 的 info()函数显示 dataframe 不包含空值。</p><p id="73de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们试图确定流失风险背后的模式时，有两列将作为我们的目标变量:</p><ul class=""><li id="4051" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">“搅动的”，标识过去没有续订的客户</li><li id="e4d8" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">“months_active”，它添加了一个时间维度，我们希望沿着这个维度来跟踪客户流失风险</li></ul><p id="5904" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其他列表示影响客户流失风险的特征。我们想确定哪种特征值组合——哪种客户特征——将流失概率提高了多少。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/7473ce8d20d10ef6500f9b43d7dfdbd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4QzZThileQxImxMjSMcwzA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/052713084d0e0603e429eb1e26f543ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DexXet2Pd9C6rsaDNqBhaw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="9c6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们查看分类变量时，我们看到每一列中唯一值的数量很少。它们的低计数将使它们更容易转换成数值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/d596211f73f121b5beca2a2a7c57f9bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ga6xz_ZCq3EfgDZVcs9EHg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="1ef9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了评估分类值对流失风险的影响，我们需要导出数值。</p><p id="5c6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的列表<em class="lv"> catcols </em>标识分类列的索引。然后，<em class="lv"> ne-hot 编码，</em>通过使用熊猫的<em class="lv"> get_dummies() </em>函数，为每个唯一分类值创建一个新列，并用二进制值 1 和 0 填充它:值 1 出现在找到匹配分类值的行中。</p><p id="f1be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">info()函数确认没有留下分类列。它还显示 dataframe 现在包含 26 列，而原来只有 13 列。例如，前一列“公司规模”中的四个唯一值被拆分为四列。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/48db0eec4656e7e7dec7d0f9691538f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vi59VovW4JhRn8tmTi41fQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/1116af56d48eb39b770cfd0d2af661c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vbiCHSsmOvx1JqcJHRKWgQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="99a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个扩展的数据框架将使我们能够运行数据科学模型，量化特征变量对流失风险的影响。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/b840b31741ff8d2787f83c24e5a8a5cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YrDdbjdTe2QPufkE1W29CA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="abaa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们通过分离目标变量来完成我们的数据争论工作:</p><ul class=""><li id="7114" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">“事件”——在我们的例子中是“搅动”= 1 或 0</li><li id="b7ea" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">时间维度:“months_active”</li></ul><p id="eb16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，第 6 行中的 numpy 函数<em class="lv"> setdiff1d() </em>从所有列名的列表中删除“churned”和“months_active ”,留下一个特性列的列表。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/3ea2fe2b5411c0c0541d4a7ddecaf725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vDqDN50sfmzLaJFh4pwGcA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="2086" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">3.识别流失风险</h1><h2 id="19ed" class="nu lx it bd ly nv nw dn mc nx ny dp mg li nz oa mi lm ob oc mk lq od oe mm of bi translated">3.1 特征的相关性</h2><p id="ad74" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在 PySurvival 的效用函数中，我们找到了<em class="lv">相关矩阵。</em>它显示了<em class="lv"> </em>特征对齐的紧密程度。如果任何一对显示出惊人的高相关性，接近 1.0，我们应该删除其中一个来处理它们的多重共线性。</p><p id="26c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的例子中，大中型客户公司之间的最高相关性不超过 0.52。这不是一个令人担忧的水平，所以我们继续我们的分析。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/9aeb0c9698a9e17ffd04d5b79246cf41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Efagef7Fw08-1GffKSoYrA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="09a9" class="nu lx it bd ly nv nw dn mc nx ny dp mg li nz oa mi lm ob oc mk lq od oe mm of bi translated">3.2 训练与测试数据集</h2><p id="da17" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在第 3 行，Scikit 的<em class="lv"> train_test_split </em>方法保留了 35%的数据集用于测试。</p><p id="209f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第 9 行到第 11 行对特性列 X、事件列 E ("churned ")和时间列 T ("months_active ")应用相同的分割。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="c5f9" class="nu lx it bd ly nv nw dn mc nx ny dp mg li nz oa mi lm ob oc mk lq od oe mm of bi translated">3.3 条件生存森林模型—概念</h2><p id="f900" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们从生存分析之外的分类问题中知道决策树和随机森林。你可以在 Carolina Bento 的文章中找到关于决策树的优秀初级读本:<a class="ae ky" rel="noopener" target="_blank" href="/decision-tree-classifier-explained-in-real-life-picking-a-vacation-destination-6226b2b60575">现实生活中解释的决策树分类器:挑选度假目的地| Carolina Bento |迈向数据科学</a>；在饶彤彤关于随机森林的文章中:<a class="ae ky" rel="noopener" target="_blank" href="/understanding-random-forest-58381e0602d2">了解随机森林。算法如何工作|饶彤彤|走向数据科学</a></p><p id="2ba5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">生存问题增加了一个困难:模型必须处理<em class="lv">被审查的</em>数据。当数据集达到观察期的末尾时，许多(希望是大多数)客户将不会有动摇。他们的流失事件仍未被观察到，并将在未知的未来日期发生。因此，数据集是右删截的。</p><p id="074b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了处理审查问题，生存模型使用一个修改的配置:</p><ul class=""><li id="1a7f" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">传统的回归模型对两个数据组 X 和 y 进行操作:回归变量 X 和目标向量 y。</li><li id="9f7d" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">而生存模型对 X、E 和 T 这三个变量起作用:</li><li id="29d3" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">—特征数组 X(由代表客户属性或概况的列组成)</li><li id="a6fb" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">—二进制事件指示符(1 或 0)的向量 E，其表示是否已经为客户记录了流失事件；</li><li id="3fe3" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">—时间向量 T = min(t，c)，其中 T 表示事件时间，c 表示审查时间</li></ul><p id="3389" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">生存模型预测感兴趣的事件在时间 t 发生的概率。</p><p id="2e66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将实现由赖特/丹科夫斯基/齐格勒在 2017 年(【arxiv.org】)设计的<strong class="lb iu">条件生存森林</strong>模型。CSF 改进了旧的随机生存森林方法使用的训练算法。</p><h2 id="5ff8" class="nu lx it bd ly nv nw dn mc nx ny dp mg li nz oa mi lm ob oc mk lq od oe mm of bi translated">3.4 拟合模型</h2><p id="370d" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">PySurvival 的 CSF 模型采用以下参数:</p><ul class=""><li id="0b2e" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">每次分割的最大要素数</li><li id="8a81" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">— int =绝对数字</li><li id="6468" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">—浮点=分数</li><li id="f05c" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">—“sqrt”=特征数量的平方根</li><li id="46d9" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">—“log2”=特征数量的二进制对数</li><li id="845b" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">—“全部”</li><li id="b17f" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">最小节点大小=每个节点的最小样本数，默认为 10</li><li id="46b3" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">alpha =允许拆分的显著性水平，默认为 0.05</li><li id="56fd" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">样本大小百分比= %每个树构建中使用的原始样本，默认值为 0.63</li><li id="5b34" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">num_threads =并行线程中可用内核的数量</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="64ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">拟合生存森林后，我们检查它的准确性。</p><h2 id="eb01" class="nu lx it bd ly nv nw dn mc nx ny dp mg li nz oa mi lm ob oc mk lq od oe mm of bi translated">3.5 准确性指标</h2><p id="3a6e" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated"><strong class="lb iu">一致性指数</strong>衡量模型的辨别能力。如果有四个客户在 2 年、3 年、4 年和 5 年后流失，而模型准确预测他们将按此顺序流失，则和谐指数达到其最佳值 1.0。如果模型预测了不同的等级顺序，则指数将低于 1。该指数并不评估预测的存活时间，而是评估<em class="lv">排名顺序</em>。如果模型为四个客户分配了 3、4、6 和 7 的流失周期，则指数仍将等于 1.0，因为它报告了客户的正确排序顺序(<a class="ae ky" href="https://square.github.io/pysurvival/metrics/c_index.html" rel="noopener ugc nofollow" target="_blank"> C-index) </a>。虽然这看起来像是一个弱点，但与 MAE 等其他准确性指标相比，我们需要一个像 concordance index 这样的指标来处理<em class="lv">右删截</em>数据:在观察数据集的结束日期，所有客户的流失事件将只记录一小部分。</p><p id="9448" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就我们的目的而言，我们认为 0.87 的一致性指数是令人满意的。</p><p id="59b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> Brier 评分</strong>衡量实际流失状态和估计概率之间的平均差异:观察到的生存状态(0 或 1)和给定时间 t 的生存概率之间的平均平方距离。它可以采用 0 到 1 之间的值，0 是最佳值:生存函数将完美地预测生存状态(<a class="ae ky" href="https://square.github.io/pysurvival/metrics/brier_score.html" rel="noopener ugc nofollow" target="_blank"> Brier 评分)</a>。通常，最大值 0.25 被视为接受阈值。</p><p id="244e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的例子中，Bier 分数不超过 0.14:低到可以接受。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/1851c664d987ab3a41b71dd631110ebb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y-3qO3exv4abja_N7PYf_w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="c2be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">PySurvival 的<strong class="lb iu">compare _ to _ actual</strong><em class="lv"/>方法沿时间轴绘制了预测的和实际的风险客户数量。它还计算三个精度指标，RMSE、平均误差和中位数绝对误差。在内部，它计算 Kaplan-Meier 估计量，以确定源数据的实际生存函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/ac56dcd9e9dea5d99dab2615b3462638.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x7aQauvUxYLtshLmHIxxtw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="cf48" class="nu lx it bd ly nv nw dn mc nx ny dp mg li nz oa mi lm ob oc mk lq od oe mm of bi translated">3.6 模型结果:特征重要性</h2><p id="2465" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">拟合模型报告了数据帧中每个特征的重要性。<strong class="lb iu">重要性</strong>衡量特性对流失风险的影响。积极的重要性分数会增加风险，消极的分数会减轻风险。</p><p id="e500" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">列“pct_importance”在从 0 到 1 的范围内校准相对重要性。相对重要性合计为 1.0。</p><ul class=""><li id="5de3" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">不出所料,“csat _ score”——通过市场调查衡量的客户满意度得分——与客户流失风险密切相关。</li><li id="4140" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">没有<em class="lv">预订工资单或产品会计服务的客户更容易拒绝。要么其他顾客已经学会欣赏整个产品系列；或者，将这些更复杂的任务转移给竞争对手会花费他们更多的精力，因此，只要竞争对手不能展示出明显更好的竞争优势，他们就会继续留在 SaaS 公司。</em></li><li id="e27b" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">“minutes_customer_support”将那些在取消订阅之前经常向支持热线投诉的客户视为高流失风险。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/504ce4bb46f8812400960df3fb909081.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*N486l1pZrdqIrVIYGdjChQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="c4f1" class="nu lx it bd ly nv nw dn mc nx ny dp mg li nz oa mi lm ob oc mk lq od oe mm of bi translated">3.7 流失预测</h2><p id="9f9a" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">让我们从源数据中随机抽取一个客户:index 1989。</p><p id="a4d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请记住，我们创建了 dataframe X 来包含所有的特性列(不包括目标变量<em class="lv"> churned </em>和<em class="lv">months _ active】</em>)。我们将随机选择的索引行 1989 的特征输入三个函数:生存、危害和风险评分函数。</p><p id="8274" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们将时间变量 t 设置为 None，那么 PySurvival 将计算数据帧中所有时间段的函数值，并显示它们的趋势——在我们的示例中是 12 个月。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/8220e25a06f9615867aa6c786e4c7806.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*bHp0k9bmlq-LA-BBSrfjdQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0399" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">生存函数</strong>是累积分布函数的补码:</p><ul class=""><li id="12fb" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">svf(t &gt; T) = 1 — cdf(t ≤ T)</li></ul><p id="7368" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">变量 T 表示直到感兴趣的事件发生的时间。</p><p id="4f0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">累积分布函数沿着时间轴追踪事件的增长概率。流失风险会随着时间的推移而增加。最终，许多客户将会破产或尝试竞争对手的产品。</p><p id="3a11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相反，生存函数 svf(t)报告事件在时间 t 之前没有发生的概率。</p><p id="17dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">危险函数</strong> hf(t)代表时间 t 的瞬时故障率:事件在下一个时刻 t*内发生的概率，假设事件在时间 t 之前没有发生。通常，危险函数不能单独解释。</p><p id="cd8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">风险分值</strong>汇总了一段时间内的累积危险值。PySurvival 将其报告为我们选择的整个时间范围的标量。</p><p id="524d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的笔记本单元格计算每个客户在四个时间点的风险分数和生存概率:订阅期的 1、3、6 和 12 个月。它将生存概率作为四个新列插入数据帧:svf1、svf3、svf6 和 svf12。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/f5daf80e5bcad2feab72662d7eed83b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LQy6Xo3XUXZ_8Xn88qy8yA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a5d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">PySurvival 的方法<em class="lv"> create_risk_groups </em>绘制了数据集中客户的得分。这有助于想象，例如，客户数量是否在接近标尺的高端时开始上升。</p><p id="728f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该方法采用可选数量的分组标准。在第 2 行到第 5 行，我选择用四分位数来划分风险分值。然后，图表通过许多不同的颜色代码来区分四个风险分值组。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/17baa93e13611a5c5a877613ae86c204.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ns--5wJ8_jC0nQD06snL9A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="12b0" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">结论</h1><p id="7602" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们将生存分析技术——条件生存森林——应用于我们的客户数据库。</p><p id="5ef7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该模型确定了客户档案中的哪些特征决定了流失风险:每个特征的重要性权重。然后我们将生存概率输入客户数据库。这些指标将为营销团队提供他们所寻求的预先信号:什么时候接触客户是明智的？</p><p id="3e5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Jupyter 笔记本可在 GitHub 下载:<a class="ae ky" href="https://github.com/h3ik0th/pysurvival_csf" rel="noopener ugc nofollow" target="_blank">h3ik0th/py survival _ CSF:py survival 的有条件生存森林(github.com)的客户流失</a></p></div></div>    
</body>
</html>