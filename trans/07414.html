<html>
<head>
<title>Detecting fiducial markers from a PCB with pattern matching</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用图案匹配从PCB检测基准标记</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/detecting-fiducial-markers-from-a-pcb-with-pattern-matching-4ed7f3bfb644?source=collection_archive---------15-----------------------#2021-07-06">https://towardsdatascience.com/detecting-fiducial-markers-from-a-pcb-with-pattern-matching-4ed7f3bfb644?source=collection_archive---------15-----------------------#2021-07-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b990" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">位置，位置，位置。</h2></div><p id="b185" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这可能很容易忘记，但无论我们的电子设备内部发生了什么，都不是魔法。想到有些产品如此复杂，以至于没有一个人能够理解每个部分是如何精确地相互作用的，我感到很惊讶，然而制造过程是存在的，从工厂运出的东西就是这样工作的。任何涉及集成电路的东西都属于这一类。</p><p id="70f0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你仔细观察印刷电路板(PCB)，你可能会注意到没有与任何其他结构电连接的金色小圆盘。这些是基准标记(或<em class="lb">基准</em>):它们的目的是让视觉系统尽可能容易地找到它们，在图像中定位PCB。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/0a0305348557dca8525e92a470d9e84e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qyNoagh7RAXF8l1jz2YK0w.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">PCB的基准标记。图片由作者提供。</p></figure><p id="3f4c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将通过OpenCV的<a class="ae ls" href="https://docs.opencv.org/2.4/modules/imgproc/doc/object_detection.html?highlight=matchtemplate#cv2.matchTemplate" rel="noopener ugc nofollow" target="_blank"><em class="lb">match template()</em></a><em class="lb"/>函数来完成定位基准标记的步骤。<a class="ae ls" href="https://github.com/sebastiengilbert73/pattern_matching_tutorial" rel="noopener ugc nofollow" target="_blank">你可以在这个库</a>里找到代码和图片。</p><blockquote class="lt lu lv"><p id="9a1b" class="kf kg lb kh b ki kj jr kk kl km ju kn lw kp kq kr lx kt ku kv ly kx ky kz la ij bi translated">为什么多氯联苯需要基准标记？</p></blockquote><p id="db0a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在PCB组装过程中，<a class="ae ls" href="https://en.wikipedia.org/wiki/Pick-and-place_machine" rel="noopener ugc nofollow" target="_blank">自动化系统会将分立元件</a>(芯片、电容器、连接器等)放置在PCB上各自的位置，然后焊接到焊盘上。基准标记的检测允许在PCB上精确放置组件。放置后，自动检测系统将检查所有物品是否都在应该在的位置，并且放置在公差范围内。同样，基准标记将提供将PCB图中的物理点(以毫米为单位)转换为图像点(以像素为单位)所需的参考点。</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><h1 id="aa50" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">预处理</h1><p id="2264" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">我们从将图像转换为灰度开始，因为我们依赖于基准标记的独特形状，而不是它们的特定颜色。这是用OpenCV的<a class="ae ls" href="https://docs.opencv.org/2.4/modules/imgproc/doc/miscellaneous_transformations.html?highlight=cvtcolor#cv2.cvtColor" rel="noopener ugc nofollow" target="_blank"> <em class="lb"> cvtColor() </em> </a>函数完成的。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nd"><img src="../Images/64df12a9f1557c908d6f7fd1715e49dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*shGNyU29nYcsJRjofMyQXg.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">图像已转换为灰度。图片由作者提供。</p></figure><p id="ca68" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该PCB上的基准标记由两个直径分别为26和68像素的同心圆盘组成。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/12dc68cad09e6af301dda547ae15eca4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*cuDlL-AO3nhiPR4H3tBM1w.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">手动测量内盘直径。图片由作者提供。</p></figure><p id="d00e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">OpenCV的<em class="lb"> matchTemplate() </em>函数需要目标对象的模板图像。在这种情况下，它将是一个基准标记的图像。我们可以在我们的图像中裁剪三个基准标记中的一个，并将其用作我们的模板，但是这种方法容易遗漏与任意选择的模板图像具有微小外观差异的真正的基准标记。相反，我们将创建一个理想基准标记的合成图像:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nf ng l"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">创建合成基准标记图像。作者代码。</p></figure><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/d4fa8f01af933c6c5a3a03e20b7716a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:138/format:webp/1*1NOLc1SqGG7W2nPTcxLFQw.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">合成基准标记。图片由作者提供。</p></figure><p id="b1fd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">基准标记图像被标准化为零均值和单位标准偏差，因为我们希望<em class="lb"> matchTemplate() </em>的结果在搜索图像的均匀值区域中接近零，并且阳性匹配的强度值接近1。</p><h1 id="8304" class="mg mh iq bd mi mj ni ml mm mn nj mp mq jw nk jx ms jz nl ka mu kc nm kd mw mx bi translated">模式匹配</h1><p id="bddb" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">我们现在拥有了调用<em class="lb"> matchTemplate() </em>所需的所有要素:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nf ng l"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">模式匹配。作者代码。</p></figure><p id="6485" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">值得注意的是，我们用零填充得到的匹配图像，以使图像具有与原始图像相同的尺寸。这是必要的，因为，<em class="lb"> matchTemplate() </em>基于卷积，输出图像具有维度(Wₒᵣᵢ-Wₚₐₜₜₑᵣₙ+1，Hₒᵣᵢ-Hₚₐₜₜₑᵣₙ+1).在我们的例子中，具有维度(69，69)的模式图像，<em class="lb"> matchTemplate() </em>的输出具有比原始图像窄68像素和短68像素的维度。为了补偿这种影响，我们在图像外围零填充了34个像素。我们还重新调整了匹配图像的灰度等级，从[-1，1]到[0，255]以便于可视化。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nd"><img src="../Images/8ee6418a95d17408a31f9d106ec144e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xuR0DiQ672Taxh8pr7Rb0A.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">零填充和重缩放的匹配图像。图片由作者提供。</p></figure><p id="139b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们感兴趣的是匹配图像强度的峰值，由上面图像中的亮点表示。决定哪些亮点是我们正在寻找的基准标记是一个设置正确阈值的问题。</p><p id="e016" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们不是手动设置阈值，而是利用这样一个事实，即我们知道在这个匹配图像中应该有三个基准标记，因此应用正确的阈值应该会产生正好有三个斑点的二值图像。为了做到这一点，我们将逐渐降低阈值，从255开始，并在结果阈值图像中计数斑点。当我们到达三个点时，我们停下来。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nf ng l"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">通过降低阈值来寻找最佳阈值，直到找到预期数量的对象。作者代码。</p></figure><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/1224bee8a538e45bd58a766e5a28d7a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:406/format:webp/1*kxDxTe1Fff5aTS2i3-zzKA.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">找到的三个基准标记之一的位置。图片由作者提供。</p></figure><h1 id="fb81" class="mg mh iq bd mi mj ni ml mm mn nj mp mq jw nk jx ms jz nl ka mu kc nm kd mw mx bi translated">变换矩阵的计算</h1><p id="6ecf" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">PCB平面上的参考点(以毫米为单位)与其在图像中的相应位置(以像素为单位)之间的三个对应关系是计算单应性所需的最少<a class="ae ls" rel="noopener" target="_blank" href="/coordinates-of-a-flat-scene-b37487df63ca">，即允许我们将毫米坐标转换为像素坐标的变换矩阵。利用这个变换矩阵，我们可以用PCB边缘来标注图像。</a></p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nd"><img src="../Images/1c1f4ad4464b47dbdb02b1144da87237.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kZXW5IMPyyxrfUt5c8LSNA.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">图像注释，显示三个找到的基准标记和PCB边缘。图片由作者提供。</p></figure><p id="ef17" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面带注释的图像证实了三个基准标记被正确找到，并且计算出的变换矩阵是准确的。假设我们在PCB上有给定元件的物理坐标，现在可以裁剪图像中需要检测的任何区域。</p><p id="43f0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在制造环境中，待检查的物体在传送带上移动是很常见的。我们不能假设被检查的物体将总是精确地位于相对于摄像机的相同位置。即使从一个对象到下一个对象存在平移和旋转，根据基准标记的检测计算的变换矩阵也允许我们检索PCB上感兴趣的给定区域。</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><p id="0e20" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们刚刚做的是自动化检查流程的第一部分。这可能不是最困难的部分，但肯定是最关键的部分:如果对象定位失败，其他任何事情都没有意义。</p><p id="c9ad" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下次你看PCB时——提醒自己这不是一个神奇的人工制品，而是一个工程奇迹——试着找出便于组装和自动检测的基准标记。</p><p id="edb7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你有一个应用程序需要基准标记的位置，让我知道。我很高兴听到这件事。</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><p id="4713" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">[1]在计算机视觉中，斑点是一组相连的像素。</p></div></div>    
</body>
</html>