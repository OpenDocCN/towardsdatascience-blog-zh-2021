<html>
<head>
<title>A Simple Guide to Automate Your Excel Reporting with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python自动生成Excel报表的简单指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-simple-guide-to-automate-your-excel-reporting-with-python-9d35f143ef7?source=collection_archive---------0-----------------------#2021-05-05">https://towardsdatascience.com/a-simple-guide-to-automate-your-excel-reporting-with-python-9d35f143ef7?source=collection_archive---------0-----------------------#2021-05-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0de7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用openpyxl通过Python自动生成Excel报表</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/414d296ffca90e2a6e71c1b69680b2f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zUFNwX6y2RVOjT1jIMwf2Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://pixabay.com/users/stocksnap-894430/" rel="noopener ugc nofollow" target="_blank"> StockSnap </a>在<a class="ae ky" href="https://pixabay.com/photos/business-working-laptop-macbook-925900/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上拍摄</p></figure><p id="7fc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们面对它；无论我们的工作是什么，迟早，我们将不得不处理重复的任务，如在Excel中更新每日报告。如果你在一家不使用Python的公司工作，事情可能会变得更糟，因为你不能只使用Python来解决这个问题。</p><p id="91b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是不要担心，您仍然可以使用您的Python技能来自动化您的excel报告，而不必说服您的老板迁移到Python！你只需要用Python模块<code class="fe lv lw lx ly b">openpyxl</code>告诉Excel你想通过Python做什么。与我之前写的鼓励您从Excel迁移到Python的文章不同，使用openpyxl，您可以在使用Python创建报表时坚持使用Excel。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="a9dd" class="md me it ly b gy mf mg l mh mi"><strong class="ly iu">Table of Contents<br/></strong>1. <a class="ae ky" href="#3bf7" rel="noopener ugc nofollow">The Dataset</a><br/>2. <a class="ae ky" href="#e24a" rel="noopener ugc nofollow">Make a Pivot Table with Pandas</a><br/> - <a class="ae ky" href="#2541" rel="noopener ugc nofollow">Importing libraries</a><br/> - <a class="ae ky" href="#fdc1" rel="noopener ugc nofollow">Reading the Excel file</a><br/> - <a class="ae ky" href="#b16b" rel="noopener ugc nofollow">Making a pivot table</a><br/> - <a class="ae ky" href="#cd3a" rel="noopener ugc nofollow">Exporting pivot table to Excel file</a><br/>3. <a class="ae ky" href="#4913" rel="noopener ugc nofollow">Make The Report with Openpyxl</a><br/> - <a class="ae ky" href="#67f0" rel="noopener ugc nofollow">Creating row and column reference</a><br/> - <a class="ae ky" href="#8c6c" rel="noopener ugc nofollow">Adding Excel charts through Python</a><br/> - <a class="ae ky" href="#e347" rel="noopener ugc nofollow">Applying Excel formulas through Python</a><br/> - <a class="ae ky" href="#1600" rel="noopener ugc nofollow">Formatting the report sheet</a><br/>4. <a class="ae ky" href="#5cd7" rel="noopener ugc nofollow">Automating the Report with a Python Function (Full code)</a><br/> - <a class="ae ky" href="#30c9" rel="noopener ugc nofollow">Applying the function to a single Excel file</a><br/> - <a class="ae ky" href="#77dc" rel="noopener ugc nofollow">Applying the function to multiple Excel files</a><br/>5. <a class="ae ky" href="#e271" rel="noopener ugc nofollow">Schedule the Python Script to Run Monthly, Weekly, or Daily</a></span></pre><h1 id="3bf7" class="mj me it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">数据集</h1><p id="7265" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">在本指南中，我们将使用一个包含销售数据的Excel文件，该文件类似于您用来制作工作报告的输入文件。你可以在<a class="ae ky" href="https://www.kaggle.com/aungpyaeap/supermarket-sales" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上下载这个文件；不过它有一个. csv格式，所以你应该把扩展名改成<code class="fe lv lw lx ly b">.xlsx</code>或者直接从这个<a class="ae ky" href="https://drive.google.com/file/d/1zWTJ4MPnMO8ez0_Ik87WB423uEF-xDWa/view?usp=sharing" rel="noopener ugc nofollow" target="_blank"> Google Drive链接</a>下载(我还把文件名改成了supermarket_sales.xlsx)</p><p id="d983" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在写任何代码之前，先看看Google Drive上的文件，熟悉一下。该文件将成为通过Python创建以下报告的输入。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/3fe6070155ed11b5d732526f4f1aa69b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zxosZ9nYHYFz22lKIoOC1Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0f2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们制作报告，并用Python自动完成！</p><h1 id="e24a" class="mj me it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">用熊猫做一张枢轴表</h1><h2 id="2541" class="md me it bd mk ng nh dn mo ni nj dp ms li nk nl mu lm nm nn mw lq no np my nq bi translated">导入库</h2><p id="ae83" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">现在您已经下载了Excel文件，让我们导入我们将在本指南中使用的库。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="a1d8" class="md me it ly b gy mf mg l mh mi">import pandas as pd<br/>import openpyxl<br/>from openpyxl import load_workbook<br/>from openpyxl.styles import Font<br/>from openpyxl.chart import BarChart, Reference<br/>import string</span></pre><p id="b1d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用Pandas来读取Excel文件，创建一个数据透视表，并将其导出到Excel。然后我们将使用Openpyxl库编写Excel公式，制作图表，并通过Python格式化电子表格。最后，我们将创建一个Python函数来自动化这个过程。</p><p id="89e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nr">注意:如果你没有在Python中安装那些库，你可以通过在你的终端或命令提示符上写</em> <code class="fe lv lw lx ly b">pip install pandas</code>和<code class="fe lv lw lx ly b">pip install openpyxl</code> <em class="nr">来轻松安装。</em></p><h2 id="fdc1" class="md me it bd mk ng nh dn mo ni nj dp ms li nk nl mu lm nm nn mw lq no np my nq bi translated">读取Excel文件</h2><p id="9d1d" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">在我们读取Excel文件之前，请确保该文件与您的Python脚本位于同一位置。然后，像下面的代码一样读取带有<code class="fe lv lw lx ly b">pd.read_excel()</code>的Excel文件。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="4302" class="md me it ly b gy mf mg l mh mi">excel_file = pd.read_excel('supermarket_sales.xlsx')<br/>excel_file[['Gender', 'Product line', 'Total']]</span></pre><p id="2d67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该文件有许多列，但我们将只使用性别、产品线和总计列来创建报告。为了向您展示它们的样子，我使用了双括号来选择它们。如果我们把它打印在Jupyter笔记本上，你会看到下面这个看起来像Excel电子表格的数据框。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/5fd838a59f69203c237af6f1cd6bab66.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*ZisA9o5eZvg14sy_AHskog.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="b16b" class="md me it bd mk ng nh dn mo ni nj dp ms li nk nl mu lm nm nn mw lq no np my nq bi translated">制作数据透视表</h2><p id="5284" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">我们可以很容易地从先前创建的<code class="fe lv lw lx ly b">excel_file </code>数据框架中创建一个数据透视表。我们只需要使用<code class="fe lv lw lx ly b">.pivot_table() </code>方法。假设我们想要创建一个数据透视表，显示男性和女性在不同产品线上的总花费。为此，我们编写以下代码。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="e998" class="md me it ly b gy mf mg l mh mi">report_table = excel_file.pivot_table(index='Gender',<br/>                                      columns='Product line',<br/>                                      values='Total',<br/>                                      aggfunc='sum').round(0)</span></pre><p id="7ef6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">report_table </code>应该是这样的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/afb336dfd7608d7e63adbe4d4ae2806c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*etiHc60q0QqqjOF5vD5Dtw.png"/></div></figure><h2 id="cd3a" class="md me it bd mk ng nh dn mo ni nj dp ms li nk nl mu lm nm nn mw lq no np my nq bi translated">将数据透视表导出到Excel文件</h2><p id="5b6f" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">为了导出之前创建的数据透视表，我们使用了<code class="fe lv lw lx ly b">.to_excel()</code>方法。在括号内，我们必须写出输出Excel文件的名称。在这种情况下，我将这个文件命名为<code class="fe lv lw lx ly b">report_2021.xlsx</code></p><p id="b684" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以指定要创建的工作表的名称以及数据透视表应该位于哪个单元格中。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="f6a3" class="md me it ly b gy mf mg l mh mi">report_table.to_excel('report_2021.xlsx',<br/>                      sheet_name='Report',<br/>                      startrow=4)</span></pre><p id="964c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，Excel文件被导出到Python脚本所在的文件夹中。</p><h1 id="4913" class="mj me it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">用Openpyxl制作报表</h1><p id="7e91" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">每次我们想要访问一个工作簿时，我们将使用从<code class="fe lv lw lx ly b">openpyxl </code>导入的<code class="fe lv lw lx ly b">load_workbook</code>，然后用<code class="fe lv lw lx ly b">.save() </code>方法保存它。在下面的部分中，我将在每次修改工作簿时加载并保存工作簿；但是，您只需要这样做一次(就像本指南末尾显示的完整代码一样)</p><h2 id="67f0" class="md me it bd mk ng nh dn mo ni nj dp ms li nk nl mu lm nm nn mw lq no np my nq bi translated">创建行和列引用</h2><p id="ab86" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">为了使报告自动化，我们需要获取最小和最大的活动列/行，这样即使我们添加了更多的数据，我们将要编写的代码也会继续工作。</p><p id="a411" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了获得工作簿中的引用，我们首先用<code class="fe lv lw lx ly b">load_workbook()</code>加载工作簿，并使用<code class="fe lv lw lx ly b">wb[‘name_of_sheet’]</code>定位我们想要使用的工作表。然后我们用<code class="fe lv lw lx ly b">.active</code>访问活动单元格</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="76ff" class="md me it ly b gy mf mg l mh mi">wb = load_workbook('report_2021.xlsx')<br/>sheet = wb['Report']</span><span id="3d11" class="md me it ly b gy nu mg l mh mi"># cell references (original spreadsheet) <br/>min_column = wb.active.min_column<br/>max_column = wb.active.max_column<br/>min_row = wb.active.min_row<br/>max_row = wb.active.max_row</span></pre><p id="2323" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以打印所创建的变量，以了解它们的含义。对于这个例子，我们获得这些数字。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="5903" class="md me it ly b gy mf mg l mh mi">Min Columns: 1<br/>Max Columns: 7<br/>Min Rows: 5<br/>Max Rows: 7</span></pre><p id="dbd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开我们之前导出的<code class="fe lv lw lx ly b">report_2021.xlsx</code>来验证这一点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/bbf1b3ff456b01259c039694f3865a37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_6v90ZgoO8uOq-GzwW49kA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4e10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上图所示，最小行数为5，最大行数为7。同样，最小行是A (1)，最大行是G (7)。这些参考资料对后面的章节非常有用。</p><h2 id="8c6c" class="md me it bd mk ng nh dn mo ni nj dp ms li nk nl mu lm nm nn mw lq no np my nq bi translated">通过Python添加Excel图表</h2><p id="4f21" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">为了从我们创建的数据透视表创建一个Excel图表，我们需要使用我们之前导入的<code class="fe lv lw lx ly b">Barchart</code>模块。为了识别数据和类别值的位置，我们使用来自<code class="fe lv lw lx ly b">openpyxl </code>的<code class="fe lv lw lx ly b">Reference</code>模块(我们在本文开始时导入了<code class="fe lv lw lx ly b">Reference</code>)</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="7191" class="md me it ly b gy mf mg l mh mi">wb = load_workbook('report_2021.xlsx')<br/>sheet = wb['Report']</span><span id="d820" class="md me it ly b gy nu mg l mh mi"># barchart<br/>barchart = BarChart()</span><span id="e707" class="md me it ly b gy nu mg l mh mi">#locate data and categories<br/>data = Reference(sheet,<br/>                 min_col=min_column+1,<br/>                 max_col=max_column,<br/>                 min_row=min_row,<br/>                 max_row=max_row) #including headers<br/>categories = Reference(sheet,<br/>                       min_col=min_column,<br/>                       max_col=min_column,<br/>                       min_row=min_row+1,<br/>                       max_row=max_row) #not including headers</span><span id="0d48" class="md me it ly b gy nu mg l mh mi"># adding data and categories<br/>barchart.add_data(data, titles_from_data=True)<br/>barchart.set_categories(categories)</span><span id="1f40" class="md me it ly b gy nu mg l mh mi">#location chart<br/>sheet.add_chart(barchart, "B12")</span><span id="c9dc" class="md me it ly b gy nu mg l mh mi">barchart.title = 'Sales by Product line'<br/>barchart.style = 5 #choose the chart style</span><span id="ecca" class="md me it ly b gy nu mg l mh mi">wb.save('report_2021.xlsx')</span></pre><p id="fd31" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">写完这段代码后，<code class="fe lv lw lx ly b">report_2021.xlsx</code>文件应该是这样的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/7d230513ab4d56dfda4fe93942baf45d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IiPYHp3-6VVIU2reS1GPBA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="ca0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分解代码:</p><ul class=""><li id="9161" class="nx ny it lb b lc ld lf lg li nz lm oa lq ob lu oc od oe of bi translated"><code class="fe lv lw lx ly b">barchart = BarChart() </code>从<code class="fe lv lw lx ly b">Barchart </code>类初始化一个<code class="fe lv lw lx ly b">barchart</code>变量</li><li id="483e" class="nx ny it lb b lc og lf oh li oi lm oj lq ok lu oc od oe of bi translated"><code class="fe lv lw lx ly b">data</code>和<code class="fe lv lw lx ly b">categories </code>是代表信息所在位置的变量。我们使用上面定义的列和行引用来实现自动化。另外，请记住，我在<code class="fe lv lw lx ly b">data </code>中包括了标题，但在<code class="fe lv lw lx ly b"> categories</code>中没有</li><li id="41a5" class="nx ny it lb b lc og lf oh li oi lm oj lq ok lu oc od oe of bi translated">我们使用<code class="fe lv lw lx ly b">add_data</code>和<code class="fe lv lw lx ly b">set_categories</code>将必要的数据添加到<code class="fe lv lw lx ly b">barchart</code>中。在<code class="fe lv lw lx ly b">add_data </code>内部，我添加了<code class="fe lv lw lx ly b">titles_from_data=True </code>，因为我包含了<code class="fe lv lw lx ly b">data</code>的标题</li><li id="2b78" class="nx ny it lb b lc og lf oh li oi lm oj lq ok lu oc od oe of bi translated">我们使用<code class="fe lv lw lx ly b">sheet.add_chart </code>来指定我们想要添加到“报告”表中的内容，以及我们想要添加到哪个单元格中</li><li id="ed4b" class="nx ny it lb b lc og lf oh li oi lm oj lq ok lu oc od oe of bi translated">我们可以使用<code class="fe lv lw lx ly b">barchart.title</code>和<code class="fe lv lw lx ly b">barchart.style</code>修改默认标题和图表样式</li><li id="3e60" class="nx ny it lb b lc og lf oh li oi lm oj lq ok lu oc od oe of bi translated">我们用<code class="fe lv lw lx ly b">wb.save()</code>保存所有的修改</li></ul><h2 id="e347" class="md me it bd mk ng nh dn mo ni nj dp ms li nk nl mu lm nm nn mw lq no np my nq bi translated">通过Python应用Excel公式</h2><p id="a264" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">您可以通过Python编写Excel公式，就像在Excel表格中编写公式一样。例如，假设我们希望对单元格B5和B6中的数据求和，并在单元格B7中以货币样式显示。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="beab" class="md me it ly b gy mf mg l mh mi">sheet['B7'] = '=SUM(B5:B6)'<br/>sheet['B7'].style = 'Currency'</span></pre><p id="b1ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这很简单，对吧？我们可以从B列到G列重复这个过程，或者使用for循环来自动执行。但是首先，我们需要让字母表作为Excel中列名的引用(A，B，C，…),为此，我们使用<code class="fe lv lw lx ly b">string</code>库并编写以下代码。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="8f89" class="md me it ly b gy mf mg l mh mi">import string<br/>alphabet = list(string.ascii_uppercase)<br/>excel_alphabet = alphabet[0:max_column] <br/>print(excel_alphabet)</span></pre><p id="79d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们打印这个，我们将得到一个从A到g的列表。</p><p id="2732" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">发生这种情况是因为首先，我们创建了一个从A到Z的<code class="fe lv lw lx ly b">alphabet</code>列表，但是然后我们取了一个切片<code class="fe lv lw lx ly b">[0:max_column]</code>来匹配这个列表的长度(7)和字母表的前7个字母(A-G)。</p><p id="4b64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nr">注意:Python列表从0开始，所以A=0，B=1，C=2，依此类推。此外，[a:b]切片符号采用b-a元素(以“a”开始，以“b-1”结束)</em></p><p id="a590" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这之后，我们可以通过列进行循环，并应用求和公式，但是现在使用列引用，所以不用写这个，</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="4bb9" class="md me it ly b gy mf mg l mh mi">sheet['B7'] = '=SUM(B5:B6)'<br/>sheet['B7'].style = 'Currency'</span></pre><p id="f572" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们包括引用，并把它放在for循环中。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="96c0" class="md me it ly b gy mf mg l mh mi">wb = load_workbook('report_2021.xlsx')<br/>sheet = wb['Report']</span><span id="3283" class="md me it ly b gy nu mg l mh mi"># sum in columns B-G<br/>for i in excel_alphabet:<br/>    if i!='A':<br/>        sheet[f'{i}{max_row+1}'] = f'=SUM({i}{min_row+1}:{i}{max_row})'<br/>        sheet[f'{i}{max_row+1}'].style = 'Currency'</span><span id="93bc" class="md me it ly b gy nu mg l mh mi"># adding total label<br/>sheet[f'{excel_alphabet[0]}{max_row+1}'] = 'Total'</span><span id="657a" class="md me it ly b gy nu mg l mh mi">wb.save('report_2021.xlsx')</span></pre><p id="907b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行代码后，我们在B到g之间的列的“总计”行中得到=SUM公式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/94a705e23ea4a549529c3059ab289346.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*GI2ZpoOZjQZPqVMM0gZBoQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="c71a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分解代码:</p><ul class=""><li id="049a" class="nx ny it lb b lc ld lf lg li nz lm oa lq ob lu oc od oe of bi translated"><code class="fe lv lw lx ly b">for i in excel_alphabet </code>遍历所有活动列，但是我们用<code class="fe lv lw lx ly b">if i!='A' </code>排除了A列，因为A列不包含数字数据</li><li id="3790" class="nx ny it lb b lc og lf oh li oi lm oj lq ok lu oc od oe of bi translated"><code class="fe lv lw lx ly b">sheet[f'{i}{max_row+1}'] = f'=SUM({i}{min_row+1}:{i}{max_row}' </code>与编写<code class="fe lv lw lx ly b">sheet['B7'] = '=SUM(B5:B6)' </code>是一样的，但是现在我们对列A到G也这么做</li><li id="41e8" class="nx ny it lb b lc og lf oh li oi lm oj lq ok lu oc od oe of bi translated"><code class="fe lv lw lx ly b">sheet[f'{i}{max_row+1}'].style = 'Currency' </code>为最大行以下的单元格赋予货币样式。</li><li id="0d1d" class="nx ny it lb b lc og lf oh li oi lm oj lq ok lu oc od oe of bi translated">我们用<code class="fe lv lw lx ly b">sheet[f'{excel_alphabet[0]}{max_row+1}'] = 'Total'</code>将“总计”标签添加到最大行下方的A列</li></ul><h2 id="1600" class="md me it bd mk ng nh dn mo ni nj dp ms li nk nl mu lm nm nn mw lq no np my nq bi translated">格式化报告表</h2><p id="f9b3" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">为了完成报告，我们可以添加一个标题，副标题，还可以自定义他们的字体。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="a0aa" class="md me it ly b gy mf mg l mh mi">wb = load_workbook('report_2021.xlsx')<br/>sheet = wb['Report']</span><span id="95fd" class="md me it ly b gy nu mg l mh mi">sheet['A1'] = 'Sales Report'<br/>sheet['A2'] = '2021'<br/>sheet['A1'].font = Font('Arial', bold=True, size=20)<br/>sheet['A2'].font = Font('Arial', bold=True, size=10)</span><span id="ebe0" class="md me it ly b gy nu mg l mh mi">wb.save('report_2021.xlsx')</span></pre><p id="eb7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以在<code class="fe lv lw lx ly b">Font()</code>里面添加其他参数。在这个<a class="ae ky" href="https://openpyxl.readthedocs.io/en/stable/api/openpyxl.styles.fonts.html" rel="noopener ugc nofollow" target="_blank">网站</a>上，你可以找到可供选择的款式列表。</p><p id="f1af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终的报告应该如下图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/3fe6070155ed11b5d732526f4f1aa69b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zxosZ9nYHYFz22lKIoOC1Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="5cd7" class="mj me it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">使用Python函数自动生成报告</h1><p id="db1d" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">现在报告已经准备好了，我们可以将目前为止编写的所有代码放入一个自动生成报告的函数中，所以下次我们想要生成这个报告时，我们只需引入文件名并运行它。</p><p id="f6f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nr">注意:为了使这个函数工作，文件名应该具有“sales_month.xlsx”的结构。另外，我添加了几行代码，使用销售文件的月份/年份作为变量，这样我们就可以在输出文件和报告的副标题中重用它。</em></p><p id="e730" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码可能看起来很吓人，但这只是我们目前为止所写的加上新的变量<code class="fe lv lw lx ly b">file_name, month_name, </code>和<code class="fe lv lw lx ly b"> month_and_extension</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="30c9" class="md me it bd mk ng nh dn mo ni nj dp ms li nk nl mu lm nm nn mw lq no np my nq bi translated">将函数应用于单个Excel文件</h2><p id="d941" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">假设我们下载的原始文件的名称是“sales_2021.xlsx ”,而不是“supermarket_sales.xlsx ”,我们可以通过编写以下内容将公式应用于报表</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="defc" class="md me it ly b gy mf mg l mh mi">automate_excel('sales_2021.xlsx')</span></pre><p id="b372" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行此代码后，您将在Python脚本所在的文件夹中看到一个名为“report_2021.xlsx”的Excel文件。</p><h2 id="77dc" class="md me it bd mk ng nh dn mo ni nj dp ms li nk nl mu lm nm nn mw lq no np my nq bi translated">将函数应用于多个Excel文件</h2><p id="1cb2" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">假设现在我们只有每月的Excel文件“sales _ January . xlsx”“sales _ January . xlsx”和“sales_march.xlsx”(你可以在我的<a class="ae ky" href="https://github.com/ifrankandrade/automation.git" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到这些文件来测试它们)</p><p id="a383" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以一个接一个地应用公式来获得3个报告</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="a24c" class="md me it ly b gy mf mg l mh mi">automate_excel('sales_january.xlsx')<br/>automate_excel('sales_february.xlsx')<br/>automate_excel('sales_march.xlsx')</span></pre><p id="78c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者您可以先使用<code class="fe lv lw lx ly b">pd.concat()</code>将它们连接起来，然后只应用一次函数。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="68a4" class="md me it ly b gy mf mg l mh mi"># read excel files<br/>excel_file_1 = pd.read_excel('sales_january.xlsx')<br/>excel_file_2 = pd.read_excel('sales_february.xlsx')<br/>excel_file_3 = pd.read_excel('sales_march.xlsx')</span><span id="b2d4" class="md me it ly b gy nu mg l mh mi"># concatenate files<br/>new_file = pd.concat([excel_file_1,<br/>                      excel_file_2,<br/>                      excel_file_3], ignore_index=True)</span><span id="b7b8" class="md me it ly b gy nu mg l mh mi"># export file<br/>new_file.to_excel('sales_2021.xlsx')</span><span id="d39c" class="md me it ly b gy nu mg l mh mi"># apply function<br/>automate_excel('sales_2021.xlsx')</span></pre><h1 id="e271" class="mj me it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">安排Python脚本每月、每周或每天运行</h1><p id="7d56" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">您可以安排我们在本指南中编写的Python脚本在您的计算机上随时运行。你只需要分别在Windows和Mac上使用任务调度器或者crontab就可以了。</p><p id="7794" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您不知道如何安排工作，请点击下面的指南了解如何安排。</p><div class="oo op gp gr oq or"><a rel="noopener follow" target="_blank" href="/how-to-easily-automate-your-python-scripts-on-mac-and-windows-459388c9cc94"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd iu gy z fp ow fr fs ox fu fw is bi translated">如何在Mac和Windows上轻松自动化您的Python脚本</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">使用crontab和任务调度器来自动化您的脚本并节省时间</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">towardsdatascience.com</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf ks or"/></div></div></a></div></div><div class="ab cl pg ph hx pi" role="separator"><span class="pj bw bk pk pl pm"/><span class="pj bw bk pk pl pm"/><span class="pj bw bk pk pl"/></div><div class="im in io ip iq"><p id="71bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nr">就是这样！在本文中，您了解了如何自动化一个基本的Excel报表；然而，一旦你掌握了熊猫图书馆，你可以自己做更多的事情。在下面的链接中，你可以找到我专门为Excel用户写的熊猫的完整指南。</em></p><div class="oo op gp gr oq or"><a rel="noopener follow" target="_blank" href="/a-complete-yet-simple-guide-to-move-from-excel-to-python-d664e5683039"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd iu gy z fp ow fr fs ox fu fw is bi translated">从Excel迁移到Python的完整而简单的指南</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">用熊猫和Numpy永远抛弃Excel。</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">towardsdatascience.com</p></div></div><div class="pa l"><div class="pn l pc pd pe pa pf ks or"/></div></div></a></div><p id="a80b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nr">我还做了一个指南，帮助你用Python建立你的第一个机器学习模型。</em></p><div class="oo op gp gr oq or"><a rel="noopener follow" target="_blank" href="/a-beginners-guide-to-text-classification-with-scikit-learn-632357e16f3a"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd iu gy z fp ow fr fs ox fu fw is bi translated">Scikit-Learn简单指南—用Python构建机器学习模型</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">Python中的第一个ML模型。</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">towardsdatascience.com</p></div></div><div class="pa l"><div class="po l pc pd pe pa pf ks or"/></div></div></a></div><p id="04c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在我的<a class="ae ky" href="https://github.com/ifrankandrade/automation.git" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到这个分析背后的代码。</p><p id="6a42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://frankandrade.ck.page/bd063ff2d3" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">与3k以上的人一起加入我的电子邮件列表，获取我在所有教程中使用的Python for Data Science备忘单(免费PDF) </strong> </a></p></div></div>    
</body>
</html>