<html>
<head>
<title>Speeding Up Data Analysis with PostgreSQL and TimescaleDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PostgreSQL和TimescaleDB加速数据分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/speeding-up-data-analysis-with-timescaledb-and-postgresql-e3bdfee41108?source=collection_archive---------38-----------------------#2021-07-27">https://towardsdatascience.com/speeding-up-data-analysis-with-timescaledb-and-postgresql-e3bdfee41108?source=collection_archive---------38-----------------------#2021-07-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="adb1" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/making-sense-of-big-data" rel="noopener" target="_blank">理解大数据</a></h2><div class=""/><div class=""><h2 id="8947" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">评估、清理和转换数据时的常见问题PostgreSQL和TimescaleDB如何帮助我解决这些问题。</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/91171933cf6757c251164574239257aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6tJuZAc6-GN8drWS.jpeg"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">由<a class="ae le" href="https://unsplash.com/@markuswinkler" rel="noopener ugc nofollow" target="_blank">马库斯·温克勒</a>通过<a class="ae le" href="https://unsplash.com/photos/afW1hht0NSs" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>创作</p></figure><ol class=""><li id="597d" class="lf lg iq lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">常用数据分析工具和“问题”</li><li id="1aa9" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls lt lu lv lw bi translated">数据分析问题#1:存储和访问数据</li><li id="1d28" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls lt lu lv lw bi translated">数据分析问题#2:最大化分析速度和计算效率(数据集越大，问题越大)</li><li id="8212" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls lt lu lv lw bi translated">数据分析问题#3:存储和维护数据分析脚本</li><li id="eca7" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls lt lu lv lw bi translated">数据分析问题#4:轻松利用新技术或附加技术</li><li id="eb6f" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls lt lu lv lw bi translated">包扎</li></ol><p id="73f6" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated"><a class="ae le" href="https://blog.timescale.com/blog/what-the-heck-is-time-series-data-and-why-do-i-need-a-time-series-database-dcf3b1b18563/?utm_source=tds&amp;utm_medium=blog&amp;utm_id=tsdb-for-data-analysis&amp;utm_content=time-series-blog-post" rel="noopener ugc nofollow" target="_blank">时序</a>数据无处不在，它驱动着每个行业的决策。时间序列数据共同代表了一个系统、过程或行为如何随时间变化。了解这些变化有助于我们解决众多行业的复杂问题，包括<a class="ae le" href="https://blog.timescale.com/blog/simplified-prometheus-monitoring-for-your-entire-organization-with-promscale/?utm_source=tds&amp;utm_medium=blog&amp;utm_id=tsdb-for-data-analysis&amp;utm_content=promscale-blog-post" rel="noopener ugc nofollow" target="_blank">可观察性</a>、<a class="ae le" href="https://blog.timescale.com/blog/how-messari-uses-data-to-open-the-cryptoeconomy-to-everyone/?utm_source=tds&amp;utm_medium=blog&amp;utm_id=tsdb-for-data-analysis&amp;utm_content=messari-blog-post" rel="noopener ugc nofollow" target="_blank">金融服务</a>、<a class="ae le" href="https://blog.timescale.com/blog/how-meter-group-brings-a-data-driven-approach-to-the-cannabis-production-industry/?utm_source=tds&amp;utm_medium=blog&amp;utm_id=tsdb-for-data-analysis&amp;utm_content=meter-groups-cannabis-blog-post" rel="noopener ugc nofollow" target="_blank">物联网</a>，甚至<a class="ae le" href="https://blog.timescale.com/blog/hacking-nfl-data-with-postgresql-timescaledb-and-sql/?utm_source=tds&amp;utm_medium=blog&amp;utm_id=tsdb-for-data-analysis&amp;utm_content=nfl-blog-post" rel="noopener ugc nofollow" target="_blank">职业足球</a>。</p><p id="e37a" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">根据他们构建的应用程序的类型，开发人员最终会收集数百万行时间序列数据(有时每天甚至每小时会收集数百万行数据！).理解这种高容量、高保真度的数据需要一组特殊的数据分析技能，而这些技能在传统的开发人员技能中并不常见。为了执行超越基本问题的时间序列分析，开发人员和数据分析师需要专门的工具，随着<a class="ae le" href="https://db-engines.com/en/ranking_categories" rel="noopener ugc nofollow" target="_blank">时间序列数据日益突出</a>，这些工具的<strong class="lh ja">效率</strong>变得更加重要。</p><p id="622f" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">通常，数据分析师的工作可以归结为<strong class="lh ja">评估</strong>、<strong class="lh ja">清理</strong>、<strong class="lh ja">转换</strong>，以及<strong class="lh ja">建模</strong>数据。根据我的经验，我发现这些行动对我从数据中获得理解是必要的，我将在这篇文章中称之为“数据分析生命周期”。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mp"><img src="../Images/ee66a398bb700b71aa717b0124b474a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3tpEZFXx9vcxiPFBxZq3XQ.jpeg"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">数据分析生命周期。图片作者。</p></figure><p id="aa9f" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">Excel、R和Python可以说是一些最常用的数据分析工具，虽然它们都是很棒的工具，但它们可能并不适合每项工作。从经验上讲，这些工具在生命周期的早期阶段对于“数据管理”尤其低效；具体来说，预建模工作中涉及的<strong class="lh ja">评估数据</strong>、<strong class="lh ja">清理数据</strong>、<strong class="lh ja">转换数据</strong>步骤。</p><p id="fbef" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">随着我处理更大和更复杂的数据集，我开始相信为特定类型的数据(如时间序列数据)构建的数据库对于数据分析更有效。</p><p id="8ac5" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">在这个博客系列中，我将深入讨论分析生命周期中的三个数据管理步骤，并演示如何使用TimescaleDB和PostgreSQL作为强大的数据分析工具。</p><p id="90b8" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">在这篇介绍性的文章中，我将探讨一些我在使用流行的数据分析工具时遇到的常见挫折，并从这里开始，深入探讨我是如何使用TimescaleDB和PostgreSQL来帮助缓解这些棘手问题的。</p><p id="2995" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">在以后的帖子中，我们将关注:</p><ul class=""><li id="98ee" class="lf lg iq lh b li lj lk ll lm ln lo lp lq lr ls mq lu lv lw bi translated">TimescaleDB和PostgreSQL数据分析功能如何取代通常在Python和pandas中执行的数据管理工作</li><li id="bf08" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls mq lu lv lw bi translated">TimescaleDB和PostgreSQL与Python和pandas在数据管理任务中的比较(标准数据分析工作流的基准测试)</li><li id="f489" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls mq lu lv lw bi translated">如何使用TimescaleDB、PostgreSQL和Python进行端到端的深度数据分析，使用来自<a class="ae le" href="https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page" rel="noopener ugc nofollow" target="_blank">纽约市出租车和豪华轿车委员会</a> (NYC TLC)的真实黄色出租车数据。</li></ul><h1 id="fa59" class="mr ms iq bd mt mu mv mw mx my mz na nb kf nc kg nd ki ne kj nf kl ng km nh ni bi translated">常用数据分析工具和“问题”</h1><p id="47e4" class="pw-post-body-paragraph mc md iq lh b li nj ka me lk nk kd mf lm nl mh mi lo nm mk ml lq nn mn mo ls ij bi translated">正如我们已经讨论过的，用于数据分析的三个最流行的工具是Excel、R和Python。虽然它们本身是很好的工具，但它们并没有优化到能有效地执行分析过程中的每一步。</p><p id="1161" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">尤其是大部分数据科学家(包括我自己！)随着数据量的增长，或者需要月复一月地重复相同的分析，为类似的问题而苦恼。</p><p id="8258" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">这些困难包括:</p><ul class=""><li id="12dd" class="lf lg iq lh b li lj lk ll lm ln lo lp lq lr ls mq lu lv lw bi translated">数据存储和访问:存储和维护用于分析的数据的最佳位置是哪里？</li><li id="52f6" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls mq lu lv lw bi translated">数据大小及其对分析的影响:如何提高数据管理任务的效率，尤其是在数据扩展时？</li><li id="dae5" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls mq lu lv lw bi translated">脚本存储和可访问性:我能做些什么来改进数据管理脚本存储和维护？</li><li id="1a0b" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls mq lu lv lw bi translated">轻松利用新技术:我如何设置我的数据分析工具链，以便轻松过渡到新技术？</li></ul><p id="3d2c" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">所以系好安全带，让你的胳膊和腿一直呆在车里，让我们开始研究这些问题吧！</p><h1 id="a4f0" class="mr ms iq bd mt mu mv mw mx my mz na nb kf nc kg nd ki ne kj nf kl ng km nh ni bi translated">数据分析问题#1:存储和访问数据</h1><p id="7858" class="pw-post-body-paragraph mc md iq lh b li nj ka me lk nk kd mf lm nl mh mi lo nm mk ml lq nn mn mo ls ij bi translated">为了进行数据分析，你需要访问…数据。</p><p id="c16a" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">管理数据的存储位置，以及访问数据的难易程度是分析过程中的第一步(通常也是最重要的一步)。每当我开始一个新的数据分析项目时，这通常是我第一次陷入困境的地方。不管原始数据源是什么，我总是问“当我开始处理数据管理过程时，存储和维护数据的最佳位置在哪里？”</p><p id="3ac7" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">尽管数据分析师使用数据库存储和查询数据变得越来越普遍，但它仍然不是普遍存在的。很多时候，原始数据是在生成JSON的CSV文件或API流中提供的。虽然这对于较小的项目来说可能是可管理的，但是它可能很快变得难以维护，并且难以在项目之间进行管理。</p><p id="80ef" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">例如，让我们考虑如何使用Python作为我们选择的数据分析工具。</p><p id="04e6" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">在使用Python进行数据分析时，我可以选择通过文件/API或数据库连接来获取数据。</p><p id="3b72" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">如果我在分析过程中使用文件或API来查询数据，我经常会遇到这样的问题:</p><ul class=""><li id="88cc" class="lf lg iq lh b li lj lk ll lm ln lo lp lq lr ls mq lu lv lw bi translated">文件在哪里？如果某个API的URL或参数发生变化，会发生什么情况？</li><li id="7bca" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls mq lu lv lw bi translated">如果制作了重复的文件会怎么样？如果只更新了一个文件，而没有更新另一个文件呢？</li><li id="0eff" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls mq lu lv lw bi translated">我如何最好地与同事共享这些文件？</li><li id="ea6d" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls mq lu lv lw bi translated">如果多个文件相互依赖，会发生什么？</li><li id="68ba" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls mq lu lv lw bi translated">如何防止不正确的数据被添加到CSV的错误列中？(即。字符串应该在的地方是十进制数)</li><li id="9bb0" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls mq lu lv lw bi translated">非常大的文件怎么办？10MB、100MB、1GB、1TB大小的文件的接收率是多少？</li></ul><p id="f2ad" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">在经历了一个又一个项目的初始问题后，我知道一定会有更好的解决方案。我知道我的数据需要一个真实的来源——很明显，一个专门的SQL数据库可能就是我的答案！</p><p id="e74a" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">现在，让我们考虑一下，如果我连接到TimescaleDB。</p><p id="5442" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">通过将我的时间序列数据导入TimescaleDB，我可以为我的所有数据创建一个真实的来源。因此，与他人协作变得像共享数据库访问权限一样简单。对数据库中数据管理过程的任何修改都意味着所有用户可以同时访问相同的更改，而不是通过解析CSV文件来验证我的版本是否正确。</p><p id="eade" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">此外，数据库通常可以处理比用Python或r编写的脚本大得多的数据负载。TimescaleDB旨在高效、经济地容纳、维护和查询数TB的数据(从计算角度和您的钱包角度而言)。有了像<a class="ae le" href="https://docs.timescale.com/timescaledb/latest/how-to-guides/continuous-aggregates/?utm_source=tds&amp;utm_medium=blog&amp;utm_id=tsdb-for-data-analysis&amp;utm_content=caggs-docs" rel="noopener ugc nofollow" target="_blank">连续聚合</a>和本机<a class="ae le" href="https://docs.timescale.com/timescaledb/latest/how-to-guides/compression/?utm_source=tds&amp;utm_medium=blog&amp;utm_id=tsdb-for-data-analysis&amp;utm_content=compression-docs" rel="noopener ugc nofollow" target="_blank">列压缩</a>这样的功能，存储和分析多年的时间序列数据变得高效，同时仍然易于访问。</p><p id="6168" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">简而言之，随着时间的推移管理数据，尤其是当数据来自不同来源时，高效地维护和访问数据可能是一场噩梦。但是，不一定要这样。</p><h1 id="377b" class="mr ms iq bd mt mu mv mw mx my mz na nb kf nc kg nd ki ne kj nf kl ng km nh ni bi translated">数据分析问题#2:最大化分析速度和计算效率(数据集越大，问题越大)</h1><p id="1e0a" class="pw-post-body-paragraph mc md iq lh b li nj ka me lk nk kd mf lm nl mh mi lo nm mk ml lq nn mn mo ls ij bi translated">Excel、R和Python都能够执行数据分析“生命周期”的前三个步骤:评估、清理和转换数据。然而，这些技术在处理过程中通常没有针对速度或计算效率进行优化。</p><p id="6bc2" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">在过去几年的许多项目中，我发现随着数据集大小的增加，导入、清理和转换数据集的过程变得更加困难、耗时，在某些情况下甚至是不可能的。对于Python和R来说，解析大量数据似乎要花很长时间，而Excel一旦遇到数百万行就会崩溃。</p><p id="92a7" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">当我需要为聚合或数据转换之类的事情创建额外的表时，事情变得<em class="no">尤其</em>困难:根据数据的大小、我使用的计算机或分析的复杂性，一些代码行可能需要几秒钟，或者在极端情况下，几分钟才能运行。</p><p id="7e81" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">虽然几秒钟或几分钟可能看起来不算多，但当你在执行一个月需要运行数百或数千次的分析时，它们累积起来会导致数小时或数天的生产力损失！</p><p id="686d" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">为了说明这一点，我们再来看一个Python例子。</p><p id="afb1" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">假设我正在处理来自Kaggle 的<a class="ae le" href="https://www.kaggle.com/srinuti/residential-power-usage-3years-data-timeseries" rel="noopener ugc nofollow" target="_blank">物联网数据集。该套件包含两个表格，一个指定德克萨斯州休斯顿一个家庭的能源消耗，另一个记录天气情况。</a></p><p id="64ac" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">要使用Python进行分析，我的分析的第一步是获取数据并观察它。</p><p id="48ff" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">当使用Python来做这件事时，我会像这样运行代码👇</p><pre class="kp kq kr ks gt np nq nr ns aw nt bi"><span id="542a" class="nu ms iq nq b gy nv nw l nx ny">import psycopg2</span><span id="64ad" class="nu ms iq nq b gy nz nw l nx ny">import pandas as pd</span><span id="55f7" class="nu ms iq nq b gy nz nw l nx ny">import configparser</span><span id="c86f" class="nu ms iq nq b gy nz nw l nx ny">## use config file for database connection information</span><span id="7dcd" class="nu ms iq nq b gy nz nw l nx ny">config = configparser.ConfigParser()</span><span id="f4bf" class="nu ms iq nq b gy nz nw l nx ny">config.read('env.ini')</span><span id="f801" class="nu ms iq nq b gy nz nw l nx ny">## establish connection</span><span id="d54a" class="nu ms iq nq b gy nz nw l nx ny">conn = psycopg2.connect(database=config.get('USERINFO', 'DB_NAME'),</span><span id="538e" class="nu ms iq nq b gy nz nw l nx ny">host=config.get('USERINFO', 'HOST'),</span><span id="e86b" class="nu ms iq nq b gy nz nw l nx ny">user=config.get('USERINFO', 'USER'),</span><span id="bcb9" class="nu ms iq nq b gy nz nw l nx ny">password=config.get('USERINFO', 'PASS'),</span><span id="b428" class="nu ms iq nq b gy nz nw l nx ny">port=config.get('USERINFO', 'PORT'))</span><span id="cbbe" class="nu ms iq nq b gy nz nw l nx ny">## define the queries for selecting data out of our database</span><span id="07b2" class="nu ms iq nq b gy nz nw l nx ny">query_weather = 'select * from weather'</span><span id="e792" class="nu ms iq nq b gy nz nw l nx ny">query_power = 'select * from power_usage'</span><span id="180a" class="nu ms iq nq b gy nz nw l nx ny">## create cursor to extract data and place it into a DataFrame</span><span id="1cf1" class="nu ms iq nq b gy nz nw l nx ny">cursor = conn.cursor()</span><span id="96e9" class="nu ms iq nq b gy nz nw l nx ny">cursor.execute(query_weather)</span><span id="062b" class="nu ms iq nq b gy nz nw l nx ny">weather_data = cursor.fetchall()</span><span id="e3bf" class="nu ms iq nq b gy nz nw l nx ny">cursor.execute(query_power)</span><span id="eda4" class="nu ms iq nq b gy nz nw l nx ny">power_data = cursor.fetchall()</span><span id="6f2d" class="nu ms iq nq b gy nz nw l nx ny">## you will have to manually set the column names for the data frame</span><span id="24f7" class="nu ms iq nq b gy nz nw l nx ny">weather_df = pd.DataFrame(weather_data, columns=['date','day','temp_max','temp_avg','temp_min','dew_max','dew_avg','dew_min','hum_max','hum_avg','hum_min','wind_max','wind_avg','wind_min','press_max','press_avg','press_min','precipit','day_of_week'])</span><span id="7303" class="nu ms iq nq b gy nz nw l nx ny">power_df = pd.DataFrame(power_data, columns=['startdate', 'value_kwh', 'day_of_week', 'notes'])</span><span id="cd38" class="nu ms iq nq b gy nz nw l nx ny">cursor.close()</span><span id="ec72" class="nu ms iq nq b gy nz nw l nx ny">print(weather_df.head(20))</span><span id="ce62" class="nu ms iq nq b gy nz nw l nx ny">print(power_df.head(20))</span></pre><p id="8572" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">总之，使用我的<a class="ae le" href="https://www.apple.com/shop/buy-mac/macbook-pro/16-inch-space-gray-2.3ghz-8-core-processor-1tb" rel="noopener ugc nofollow" target="_blank"> 2019款32GB内存的MacBook Pro笔记本电脑</a>，这段代码运行了2.718秒。</p><p id="a2f0" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">但是，如果我用数据库中的SQL运行这个等价的脚本呢？</p><pre class="kp kq kr ks gt np nq nr ns aw nt bi"><span id="fb11" class="nu ms iq nq b gy nv nw l nx ny">select * from weather</span><span id="e305" class="nu ms iq nq b gy nz nw l nx ny">select * from power_usage</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oa"><img src="../Images/dcee743df0cb08740ea86ddb628b422b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oCiu0XRQfnH31Q2aCyHySg.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><p id="b874" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">这个查询只花了0.342秒，比Python脚本快了近8倍。</p><p id="f351" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">当我们考虑到Python必须连接到数据库，然后运行SQL查询，然后解析检索到的数据，然后将其导入到DataFrame中时，这种时间差是很有意义的。虽然几乎三秒钟的时间很快，但是随着脚本变得更加复杂以及更多数据管理任务的增加，额外的处理时间也会增加。</p><p id="7863" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">拉进数据观察只是我分析的开始！当我需要执行转换任务时，比如聚合数据，会发生什么情况？</p><p id="8474" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">对于这个数据集，当我们查看<code class="fe ob oc od nq b">power_usage</code>表时——如上所示——每小时记录千瓦时读数。如果我想进行每日分析，我必须将每小时的数据汇总到“天时段”中。</p><p id="4bdf" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">如果我使用Python进行这种聚合，我可以使用类似👇</p><pre class="kp kq kr ks gt np nq nr ns aw nt bi"><span id="29c2" class="nu ms iq nq b gy nv nw l nx ny"># sum power usage by day, bucket by day</span><span id="3cc5" class="nu ms iq nq b gy nz nw l nx ny">## create column for the day</span><span id="51bd" class="nu ms iq nq b gy nz nw l nx ny">day_col = pd.to_datetime(power_df['startdate']).dt.strftime('%Y-%m-%d')</span><span id="ac4f" class="nu ms iq nq b gy nz nw l nx ny">power_df.insert(0, 'date_day', day_col)</span><span id="7ac9" class="nu ms iq nq b gy nz nw l nx ny">agg_power = power_df.groupby('date_day').agg({'value_kwh' : 'sum', 'day_of_week' : 'unique', 'notes' : 'unique' })</span><span id="4d8d" class="nu ms iq nq b gy nz nw l nx ny">print(agg_power)</span></pre><p id="587c" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">…运行时间为0.49秒(这不包括导入数据的时间)。</p><p id="1cb4" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">或者，使用TimescaleDB <code class="fe ob oc od nq b"><a class="ae le" href="https://docs.timescale.com/api/latest/hyperfunctions/time_bucket/?utm_source=tds&amp;utm_medium=blog&amp;utm_id=tsdb-for-data-analysis&amp;utm_content=time-bucket-docs" rel="noopener ugc nofollow" target="_blank">time_bucket()</a></code>函数，我可以使用下面的查询直接在数据库中进行聚合👇</p><pre class="kp kq kr ks gt np nq nr ns aw nt bi"><span id="98e4" class="nu ms iq nq b gy nv nw l nx ny">select</span><span id="7965" class="nu ms iq nq b gy nz nw l nx ny">time_bucket(interval '1 day', startdate ) as day,</span><span id="89b6" class="nu ms iq nq b gy nz nw l nx ny">sum(value_kwh),</span><span id="e9f2" class="nu ms iq nq b gy nz nw l nx ny">day_of_week,</span><span id="c459" class="nu ms iq nq b gy nz nw l nx ny">notes</span><span id="84f0" class="nu ms iq nq b gy nz nw l nx ny">from power_usage pu</span><span id="d390" class="nu ms iq nq b gy nz nw l nx ny">group by day, day_of_week, notes</span><span id="b30c" class="nu ms iq nq b gy nz nw l nx ny">order by day</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oe"><img src="../Images/2eb217a0b6ee9111a79bb659a3cd84a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OuGR2AHrJPUpI9tni7OHNQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</p></figure><p id="bda4" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">…这只需要0.087秒，比Python脚本快5倍以上。</p><p id="6066" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">你可以在这里看到一个模式。</p><p id="8038" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">创建TimescaleDB是为了高效地查询和存储时间序列数据。但是简单地查询数据只是触及了TimescaleDB和PostgreSQL功能所提供的可能性的表面。</p><p id="0236" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">TimescaleDB和PostgreSQL提供了广泛的工具和功能，可以取代使用其他工具来评估、清理和转换数据的需求。一些TimescaleDB功能包括连续聚合、压缩和<a class="ae le" href="https://docs.timescale.com/api/latest/hyperfunctions/?utm_source=tds&amp;utm_medium=blog&amp;utm_id=tsdb-for-data-analysis&amp;utm_content=hyperfunctions-doc" rel="noopener ugc nofollow" target="_blank">超功能</a>；所有这些都允许您直接在数据库中完成几乎所有的数据管理任务。</p><p id="795c" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">当我直接在TimescaleDB中执行分析的评估、清理和转换步骤时，我不再需要使用额外的工具(如Excel、R或Python)来执行数据管理任务。然后，我可以将经过清理和转换的数据直接导入Excel、R或Python，为建模做好准备。</p><h1 id="d161" class="mr ms iq bd mt mu mv mw mx my mz na nb kf nc kg nd ki ne kj nf kl ng km nh ni bi translated">数据分析问题#3:存储和维护数据分析脚本</h1><p id="bb65" class="pw-post-body-paragraph mc md iq lh b li nj ka me lk nk kd mf lm nl mh mi lo nm mk ml lq nn mn mo ls ij bi translated">将Excel、R或Python专门用于整个数据分析工作流的另一个潜在缺点是，分析数据的所有逻辑都包含在一个脚本文件中。与拥有许多不同数据源的问题类似，维护脚本文件可能会很不方便和混乱。</p><p id="aeb1" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">我和许多数据分析师遇到的一些常见问题包括:</p><ul class=""><li id="eae1" class="lf lg iq lh b li lj lk ll lm ln lo lp lq lr ls mq lu lv lw bi translated">丢失文件</li><li id="3388" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls mq lu lv lw bi translated">无意中创建重复文件</li><li id="e7ee" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls mq lu lv lw bi translated">更改或更新一些文件，但不更改或更新其他文件</li><li id="2ecd" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls mq lu lv lw bi translated">需要编写和运行脚本来访问转换后的数据(参见下面的示例)</li><li id="e0de" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls mq lu lv lw bi translated">每当添加新的原始数据时，花费时间重新运行脚本(参见下面的示例)</li></ul><p id="c91e" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">虽然您可以使用代码库来克服其中的一些问题，但它不能解决最后两个问题。</p><p id="19ca" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">让我们再次考虑我们的Python场景。</p><p id="4b8a" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">假设我使用了一个专门用于我所有数据分析任务的Python脚本。如果我需要导出转换后的数据以用于德克萨斯州的能源消耗报告，会发生什么情况？</p><p id="55c0" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">很可能，我必须在脚本中添加一些代码来导出数据，然后再次运行脚本来实际导出数据。根据脚本的内容和转换数据所需的时间，这可能会非常不方便和低效。</p><p id="9dbb" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">如果我也得到一堆新能源使用和天气数据呢？为了将新的原始数据合并到现有的可视化或报告中，我需要再次运行脚本，并确保我的所有数据管理任务都按预期运行。</p><p id="cd9e" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">数据库函数，如连续聚合和物化视图，可以创建转换后的数据，这些数据可以直接从数据库中存储和查询，而无需运行脚本。此外，我可以为连续聚合创建策略，以便在任何时候修改原始数据时，定期更新转换后的数据。由于这些策略，我不必担心运行脚本来重新转换数据以供使用，从而高效地访问更新的数据。</p><h1 id="f281" class="mr ms iq bd mt mu mv mw mx my mz na nb kf nc kg nd ki ne kj nf kl ng km nh ni bi translated">数据分析问题#4:轻松利用新技术或附加技术</h1><p id="816a" class="pw-post-body-paragraph mc md iq lh b li nj ka me lk nk kd mf lm nl mh mi lo nm mk ml lq nn mn mo ls ij bi translated">最后，数据分析生命周期的最后一步:建模。如果我想使用新的工具或技术来创建可视化，很难轻松地将转换后的数据用于其他地方的建模或可视化。</p><p id="7435" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">Python、R和Excel的可视化和建模能力都非常棒。然而，当你的公司或团队想要采用一种新工具时会发生什么呢？</p><p id="96e1" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">根据我的经验，这通常意味着要么在分析过程中增加另一个步骤，要么重新发现如何在新技术中执行评估、清理和转换步骤。</p><p id="42ff" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">例如，在我以前的一份工作中，我被要求将我的一部分分析转换成Power BI，用于业务分析。我的利益相关者想要的一些可视化要求我从Python脚本中访问转换后的数据。当时，我可以选择从Python脚本中导出数据，或者想出如何在Power BI中直接转换数据。这两种选择都不理想，而且肯定要花费额外的时间。</p><p id="3976" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">当谈到采用新的可视化或建模工具时，使用数据库来评估、清理和转换数据可以再次对您有利。大多数可视化工具——如<a class="ae le" href="https://grafana.com/" rel="noopener ugc nofollow" target="_blank"> Grafana </a>、<a class="ae le" href="https://www.metabase.com/" rel="noopener ugc nofollow" target="_blank"> Metabase </a>或<a class="ae le" href="https://powerbi.microsoft.com/" rel="noopener ugc nofollow" target="_blank">Power BI</a>——允许用户直接从数据库导入数据。</p><p id="1d09" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">由于我可以在TimescaleDB中完成大部分数据管理任务，因此添加或切换工具——比如使用Power BI实现仪表板功能——变得非常简单，只需连接到我的数据库，提取管理的数据，并使用新工具进行可视化和建模。</p><h1 id="e339" class="mr ms iq bd mt mu mv mw mx my mz na nb kf nc kg nd ki ne kj nf kl ng km nh ni bi translated">包扎</h1><p id="4f99" class="pw-post-body-paragraph mc md iq lh b li nj ka me lk nk kd mf lm nl mh mi lo nm mk ml lq nn mn mo ls ij bi translated">总之，Excel、R和Python都是很好的分析工具，但可能不是每项工作的最佳工具。例证:我在时间序列数据分析上的挣扎，尤其是在大数据集上。</p><p id="4b23" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">借助TimescaleDB和PostgreSQL功能，您可以直接在数据库中存放数据并执行数据分析的评估、清理和转换，并在此过程中解决许多常见的数据分析难题(我希望如此！—在本文中演示)</p><p id="f829" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">在接下来的博客文章中，我将探索TimescaleDB和PostgreSQL功能与Python的比较，比较TimescaleDB和PostgreSQL性能与Python和pandas的数据管理任务，并深入研究TimescaleDB(用于数据管理)和Python(用于建模和可视化)的数据分析。</p><p id="5b87" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">如果你对TimescaleDB、时间序列数据或上述任何功能有疑问，欢迎<a class="ae le" href="https://slack.timescale.com/?utm_source=dev-to&amp;utm_medium=blog&amp;utm_id=tsdb-for-data-analysis&amp;utm_content=slack" rel="noopener ugc nofollow" target="_blank">加入Timescale的<strong class="lh ja">社区Slack </strong> </a>，在那里你会发现一个由时间序列爱好者和各种Timescale团队成员(包括我！).</p><p id="2b2c" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">如果你对使用TimescaleDB和PostgreSQL感兴趣，你可以注册<a class="ae le" href="https://www.timescale.com/timescale-signup/?utm_source=tds&amp;utm_medium=blog&amp;utm_id=tsdb-for-data-analysis&amp;utm_content=timescale-signup" rel="noopener ugc nofollow" target="_blank">30天免费试用</a>或<a class="ae le" href="https://docs.timescale.com/timescaledb/latest/how-to-guides/install-timescaledb/self-hosted/?utm_source=tds&amp;utm_medium=blog&amp;utm_id=tsdb-for-data-analysis&amp;utm_content=timescale-self-hosted-guide" rel="noopener ugc nofollow" target="_blank">安装TimescaleDB </a>并在你当前的PostgreSQL实例上管理它。我们还有一堆很棒的<a class="ae le" href="https://docs.timescale.com/timescaledb/latest/tutorials/?utm_source=tds&amp;utm_medium=blog&amp;utm_id=tsdb-for-data-analysis&amp;utm_content=timescale-tutorials" rel="noopener ugc nofollow" target="_blank">教程</a>来帮助你入门。</p><p id="4877" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated">下次见！</p></div><div class="ab cl of og hu oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="ij ik il im in"><p id="321c" class="pw-post-body-paragraph mc md iq lh b li lj ka me lk ll kd mf lm mg mh mi lo mj mk ml lq mm mn mo ls ij bi translated"><em class="no">本帖由米兰达·奥尔原创，发表于2021年9月9日</em><a class="ae le" href="https://blog.timescale.com/blog/speeding-up-data-analysis/?utm_source=dev-to&amp;utm_medium=blog&amp;utm_id=tsdb-for-data-analysis&amp;utm_content=original-blog-post" rel="noopener ugc nofollow" target="_blank"><em class="no">https://blog.timescale.com</em></a><em class="no">上</em></p></div></div>    
</body>
</html>