<html>
<head>
<title>Dockerizing and Deploying a Shiny Dashboard on Google Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在谷歌云上对接和部署闪亮的仪表板</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/dockerizing-and-deploying-a-shiny-dashboard-on-google-cloud-a990ceb3c33a?source=collection_archive---------5-----------------------#2021-04-15">https://towardsdatascience.com/dockerizing-and-deploying-a-shiny-dashboard-on-google-cloud-a990ceb3c33a?source=collection_archive---------5-----------------------#2021-04-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/cfda78200ae664928b72eba4a21ab0ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NuNjhsdt7cZiIL2fZrLhkA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">作者图片</p></figure><div class=""/><div class=""><h2 id="e4cd" class="pw-subtitle-paragraph kc je jf bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">将Shiny引入云计算的分步指南</h2></div><p id="44d7" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">闪亮的应用程序和仪表板是高度通用的工具，允许最终用户以各种方式与数据进行交互，而应用程序功能由后台运行的R代码支持。然而，为了让其他人访问您的工作并从中受益，您需要考虑将您的应用程序部署到哪里。在某些情况下，无论是免费还是付费计划，直接从RStudio内部在shinyapps.io上部署您的工作可能会很方便。然而，这种选择有一些限制。例如，一些应用程序可能需要shinyapps.io不支持的各种系统依赖关系。在这种情况下，您需要使用Docker将您的应用程序容器化，并在其他地方寻找主机。</p><p id="8727" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">Docker是一个功能强大且广泛使用的工具，它允许开发人员将代码、设置和依赖项捆绑和隔离在一起，以便应用程序能够在任何计算环境中以相同的方式运行。在本指南中，我们将在Google Cloud Run上整理和部署一个闪亮的仪表板。为了遵循本教程中的步骤，<em class="lq">你需要在你的机器上安装R，RStudio和Docker以及一个谷歌账户。</em></p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="d409" class="ly lz jf bd ma mb mc md me mf mg mh mi kl mj km mk ko ml kp mm kr mn ks mo mp bi translated">第1部分:如何将闪亮的应用程序或仪表板分类</h1><p id="87b6" class="pw-post-body-paragraph ku kv jf kw b kx mq kg kz la mr kj lc ld ms lf lg lh mt lj lk ll mu ln lo lp ij bi translated">因为我们将重点关注dockerization和deployment，所以我们将简单地构建一个空白的闪亮仪表板作为临时仪表板。按照这种方法，我们将需要以下文件和文件夹结构。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="1116" class="ne lz jf na b gy nf ng l nh ni">/myshinydashboardfolder<br/> ├── Dockerfile<br/> ├── app<br/> │   └── app.R<br/> ├── shiny-server.conf<br/> ├── shiny-server.sh</span></pre><h2 id="a351" class="ne lz jf bd ma nj nk dn me nl nm dp mi ld nn no mk lh np nq mm ll nr ns mo nt bi translated">app。稀有</h2><p id="3bd5" class="pw-post-body-paragraph ku kv jf kw b kx mq kg kz la mr kj lc ld ms lf lg lh mt lj lk ll mu ln lo lp ij bi translated">我们可以使用下面几行R代码创建一个无内容的应用程序。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="d9a2" class="ne lz jf na b gy nf ng l nh ni">library(shinydashboard)</span><span id="677e" class="ne lz jf na b gy nu ng l nh ni">ui &lt;- dashboardPage(<br/> dashboardHeader(title=”Hello world”),<br/> dashboardSidebar(),<br/> dashboardBody()<br/>)</span><span id="03c5" class="ne lz jf na b gy nu ng l nh ni">server &lt;- function(input, output) { }</span><span id="0db7" class="ne lz jf na b gy nu ng l nh ni">shinyApp(ui, server)</span></pre><p id="8b19" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">如果您运行该应用程序，它应该看起来像下图。</p><figure class="mv mw mx my gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nv"><img src="../Images/ee516e6f35b43525103163d9e9755b2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vWd9P3lstCBszZ18HVgS4A.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">作者图片</p></figure><h2 id="7051" class="ne lz jf bd ma nj nk dn me nl nm dp mi ld nn no mk lh np nq mm ll nr ns mo nt bi translated">Dockerfile文件</h2><p id="9f5a" class="pw-post-body-paragraph ku kv jf kw b kx mq kg kz la mr kj lc ld ms lf lg lh mt lj lk ll mu ln lo lp ij bi translated">Dockerfile指定在构建Docker映像时要安装哪些依赖项和R包。在这种情况下，我们将使用摇滚/闪亮的基础形象。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="5f35" class="ne lz jf na b gy nf ng l nh ni"># get shiny server plus tidyverse packages image<br/>FROM rocker/shiny-verse:latest</span><span id="2a32" class="ne lz jf na b gy nu ng l nh ni"># system libraries of general use<br/>RUN apt-get update &amp;&amp; apt-get install -y \<br/>    sudo \<br/>    pandoc \<br/>    pandoc-citeproc \<br/>    libcurl4-gnutls-dev \<br/>    libcairo2-dev \<br/>    libxt-dev \<br/>    libssl-dev \<br/>    libssh2-1-dev</span><span id="1531" class="ne lz jf na b gy nu ng l nh ni"># install R packages required <br/># (change it depending on the packages you need)<br/>RUN R -e "install.packages('shinydashboard', repos='<a class="ae nw" href="http://cran.rstudio.com/'" rel="noopener ugc nofollow" target="_blank">http://cran.rstudio.com/'</a>)"</span><span id="3fec" class="ne lz jf na b gy nu ng l nh ni"># Copy configuration files into the Docker image<br/>COPY shiny-server.conf  /etc/shiny-server/shiny-server.conf<br/>COPY /app /srv/shiny-server/<br/>RUN rm /srv/shiny-server/index.html</span><span id="fa01" class="ne lz jf na b gy nu ng l nh ni"># Make the ShinyApp available at port 80<br/>EXPOSE 80</span><span id="88cb" class="ne lz jf na b gy nu ng l nh ni"># Copy further configuration files into the Docker image<br/>COPY shiny-server.sh /usr/bin/shiny-server.sh</span><span id="7486" class="ne lz jf na b gy nu ng l nh ni">RUN ["chmod", "+x", "/usr/bin/shiny-server.sh"]</span><span id="e1a2" class="ne lz jf na b gy nu ng l nh ni">CMD ["/usr/bin/shiny-server.sh"]</span></pre><p id="092d" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">与docker文件不同，我不需要对shiny-server.conf和shiny-server.sh文件进行任何修改。</p><h2 id="139b" class="ne lz jf bd ma nj nk dn me nl nm dp mi ld nn no mk lh np nq mm ll nr ns mo nt bi translated">闪亮服务器. conf</h2><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="1fc7" class="ne lz jf na b gy nf ng l nh ni"># Define the user we should use when spawning R Shiny processes<br/>run_as shiny;</span><span id="03dd" class="ne lz jf na b gy nu ng l nh ni"># Define a top-level server which will listen on a port<br/>server {<br/>  # Instruct this server to listen on port 80.<br/>  listen 80;</span><span id="97d7" class="ne lz jf na b gy nu ng l nh ni"># Define the location available at the base URL<br/>  location / {</span><span id="9ad2" class="ne lz jf na b gy nu ng l nh ni"># Run this location in 'site_dir' mode, which hosts the entire directory<br/>    # tree at '/srv/shiny-server'<br/>    site_dir /srv/shiny-server;<br/>    <br/>    # Define where we should put the log files for this location<br/>    log_dir /var/log/shiny-server;<br/>    <br/>    # Should we list the contents of a (non-Shiny-App) directory when the user <br/>    # visits the corresponding URL?<br/>    directory_index on;<br/>  }<br/>}</span></pre><h2 id="30f0" class="ne lz jf bd ma nj nk dn me nl nm dp mi ld nn no mk lh np nq mm ll nr ns mo nt bi translated">闪亮服务器. sh</h2><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="49bb" class="ne lz jf na b gy nf ng l nh ni">#!/bin/sh</span><span id="84bd" class="ne lz jf na b gy nu ng l nh ni"># Make sure the directory for individual app logs exists<br/>mkdir -p /var/log/shiny-server<br/>chown shiny.shiny /var/log/shiny-server</span><span id="f029" class="ne lz jf na b gy nu ng l nh ni">exec shiny-server &gt;&gt; /var/log/shiny-server.log 2&gt;&amp;1</span></pre><p id="72ff" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">现在我们已经把文件整理好了，是时候构建Docker映像了！步骤如下:</p><ol class=""><li id="8697" class="nx ny jf kw b kx ky la lb ld nz lh oa ll ob lp oc od oe of bi translated">在RStudio中打开一个shell。这将自动从项目文件夹(“myshinydashboardfolder”)开始。</li><li id="4c4a" class="nx ny jf kw b kx og la oh ld oi lh oj ll ok lp oc od oe of bi translated">键入以下命令来构建映像。请注意，<code class="fe ol om on na b">mydashboard</code>将是使用<code class="fe ol om on na b">-t</code>选项标记图像的应用程序的名称。</li></ol><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="728f" class="ne lz jf na b gy nf ng l nh ni">docker build -t mydashboard .</span></pre><p id="bc96" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">3.使用以下命令，在分离模式下使用端口80，验证应用程序是否正常运行，或者什么也不做。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="c5bb" class="ne lz jf na b gy nf ng l nh ni">docker run -d -p 80:80 mydashboard</span></pre></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="7fac" class="ly lz jf bd ma mb mc md me mf mg mh mi kl mj km mk ko ml kp mm kr mn ks mo mp bi translated">第2部分:如何在Google Cloud上设置项目和容器注册中心</h1><p id="12c9" class="pw-post-body-paragraph ku kv jf kw b kx mq kg kz la mr kj lc ld ms lf lg lh mt lj lk ll mu ln lo lp ij bi translated">假设我们已经设置了一个帐户，我们现在需要完成以下步骤来创建应用服务:</p><ol class=""><li id="b656" class="nx ny jf kw b kx ky la lb ld nz lh oa ll ob lp oc od oe of bi translated">在谷歌云平台上创建一个新项目，并选择一个合适的名称，例如“shinyapps”。记下项目ID。</li><li id="c5d8" class="nx ny jf kw b kx og la oh ld oi lh oj ll ok lp oc od oe of bi translated">确保您位于项目目录中，打开云shell并通过输入以下命令启用容器注册表。</li></ol><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="1240" class="ne lz jf na b gy nf ng l nh ni">gcloud services enable containerregistry.googleapis.com</span></pre><p id="5099" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">然后会要求您授权此步骤。瞧啊！现在，您可以从Docker Hub中提取图像，并将图像推送到您的容器注册表中。在我们的例子中，我们将使用gcloud CLI工具，直接从本地机器推送映像。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="1580" class="ly lz jf bd ma mb mc md me mf mg mh mi kl mj km mk ko ml kp mm kr mn ks mo mp bi translated">第3部分:如何将Docker映像推送到容器注册中心</h1><p id="5af9" class="pw-post-body-paragraph ku kv jf kw b kx mq kg kz la mr kj lc ld ms lf lg lh mt lj lk ll mu ln lo lp ij bi translated">正如Google Cloud文档中所解释的，将Docker映像放入容器注册表有不同的方法。按照建议的方法，我们需要执行以下操作:</p><ol class=""><li id="927e" class="nx ny jf kw b kx ky la lb ld nz lh oa ll ob lp oc od oe of bi translated">在您的本地机器上安装<a class="ae nw" href="https://cloud.google.com/sdk/docs/install" rel="noopener ugc nofollow" target="_blank">云SDK </a>，并按照说明进行操作。</li><li id="510d" class="nx ny jf kw b kx og la oh ld oi lh oj ll ok lp oc od oe of bi translated">首先运行命令，使用您的用户凭据登录，然后按照步骤操作。</li></ol><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="f1c6" class="ne lz jf na b gy nf ng l nh ni">gcloud auth login<!-- --> </span></pre><p id="736a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">3.通过运行以下命令，将Docker配置为使用gcloud CLI进行身份验证。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="6838" class="ne lz jf na b gy nf ng l nh ni">gcloud auth configure-docker</span></pre><p id="93a6" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">4.用注册表名称标记您的图像。这里的<code class="fe ol om on na b">gcr.io</code>是主机名称，您可能希望在名称前加上您的首选位置，例如<code class="fe ol om on na b">eu.gcr.io</code>将在欧盟托管映像。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="a2fc" class="ne lz jf na b gy nf ng l nh ni">docker tag <!-- -->mydashboard<!-- --> gcr.io/YOUR-PROJECT-ID/<!-- -->mydashboard</span></pre><p id="caf6" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">5.现在，您可以使用以下命令最终推送映像:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="ff06" class="ne lz jf na b gy nf ng l nh ni">docker push gcr.io/YOUR-PROJECT-ID/<!-- -->mydashboard</span></pre><p id="8f8f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">之后，您应该能够在容器注册表中检查您的映像。您甚至可以从这里直接启动部署。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="84e9" class="ly lz jf bd ma mb mc md me mf mg mh mi kl mj km mk ko ml kp mm kr mn ks mo mp bi translated">第4部分:如何使用Google Cloud Run部署您的dockerized应用程序</h1><p id="b00a" class="pw-post-body-paragraph ku kv jf kw b kx mq kg kz la mr kj lc ld ms lf lg lh mt lj lk ll mu ln lo lp ij bi translated">快到了。现在，我们只需要导航到Google Cloud Run，创建一个名为“myfirstdashboard”的新服务，并指定一个所需的区域。</p><figure class="mv mw mx my gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oo"><img src="../Images/6133d891697d1718f8d217c554da6581.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zuuoSvc2yXJc8TCo4mhrCg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">作者图片</p></figure><p id="f5f3" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在下一页，我们只需单击“选择”来选择我们之前已推送到容器注册表中的图像。</p><figure class="mv mw mx my gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi op"><img src="../Images/793b3992f72e7371ee9c5c6cdebf48bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z9p2nV4GqlLS_kPWkLJPWA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">作者图片</p></figure><p id="1877" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">打开高级设置并选择容器端口80很重要，这是我们在docker文件中指定的。</p><figure class="mv mw mx my gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oo"><img src="../Images/e460c703d1e51ec4cd27aed874e59d05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1MieC0RP3LZUdGyeLcl2cw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">作者图片</p></figure><p id="1a3f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在最后一步，我们做出以下选择:</p><figure class="mv mw mx my gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oq"><img src="../Images/5dd6cf458f33ccbdf0ee22c799a7ae17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6gdLNt-U9OY79BER3vkwhA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">作者图片</p></figure><p id="45c5" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">过一会儿，你应该可以看到我们闪亮的新仪表板部署！该链接将显示在我们新创建的服务的仪表板中。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="36c8" class="ly lz jf bd ma mb mc md me mf mg mh mi kl mj km mk ko ml kp mm kr mn ks mo mp bi translated">后续步骤</h1><p id="3294" class="pw-post-body-paragraph ku kv jf kw b kx mq kg kz la mr kj lc ld ms lf lg lh mt lj lk ll mu ln lo lp ij bi translated">我们的应用程序显然是非常无用的，但我希望这个指南将帮助你根据你的使用情况来整理和部署更高级的闪亮应用程序和仪表板。尽管我们在这里没有涉及到这一点，但是您可能也希望为自动化构建和持续部署建立管道。</p><p id="4500" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">感谢Ivana Hybenová帮助我开始使用Dockering闪亮的应用程序。</p></div></div>    
</body>
</html>