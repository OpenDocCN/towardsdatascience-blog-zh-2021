<html>
<head>
<title>Anonymise Sensitive Data in a Pandas DataFrame Column with hashlib</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用hashlib匿名化Pandas DataFrame列中的敏感数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/anonymise-sensitive-data-in-a-pandas-dataframe-column-with-hashlib-8e7ef397d91f?source=collection_archive---------6-----------------------#2021-09-01">https://towardsdatascience.com/anonymise-sensitive-data-in-a-pandas-dataframe-column-with-hashlib-8e7ef397d91f?source=collection_archive---------6-----------------------#2021-09-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7ee6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">停止在您的数据框架中共享个人身份信息</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/bc5bdc735a9420010a3024be3e5e8f89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*d44HOeIsnQCrj39q"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">马库斯·斯皮斯克在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="9727" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据科学家遇到的一个常见情况是与其他人共享数据。但是，如果这些数据包含电子邮件地址、客户id或电话号码等个人身份信息(PII ),您该怎么办呢？</p><p id="1398" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个简单的解决方案是在共享数据之前删除这些字段。然而，你的分析可能依赖于PII的数据。例如，电子商务交易数据集中的客户id是了解哪个客户购买了哪个产品所必需的。</p><p id="39eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">相反，你可以使用<strong class="ky ir">散列法</strong>来匿名化数据中的PII字段。</p><h1 id="3904" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">哈希是什么？</h1><p id="02c3" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">哈希是将明文字符串转换为固定长度的唯一字符串的单向过程。哈希过程有两个重要特征:</p><ol class=""><li id="63f4" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">将散列字符串转换成其原始形式是非常困难的</li><li id="b310" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">相同的明文字符串将产生相同的哈希输出</li></ol><p id="35a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">出于这些原因，开发人员会将您的散列密码存储在网站的数据库中。</p><h1 id="cde1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">一个使用hashlib的简单例子</h1><p id="3fa3" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><a class="ae kv" href="https://docs.python.org/3/library/hashlib.html" rel="noopener ugc nofollow" target="_blank"> haslib </a>是Python中的内置模块，包含了很多流行的哈希算法。在我们的教程中，我们将使用SHA-256，它是SHA-2算法家族的一部分。</p><p id="2dfb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在将我们的字符串(在本例中为电子邮件地址)转换为哈希值之前，我们必须首先使用UTF-8编码将其转换为字节:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="de20" class="ni lt iq ne b gy nj nk l nl nm">import hashlib</span><span id="628a" class="ni lt iq ne b gy nn nk l nl nm"># Encode our string using UTF-8 default <br/>stringToHash = 'example@email.com'.encode()</span></pre><p id="5c46" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在可以使用SHA-256散列它:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="9164" class="ni lt iq ne b gy nj nk l nl nm"># Hash using SHA-256 and print<br/>print('Email (SHA-256): ', hashlib.sha256(stringToHash).hexdigest())</span></pre><p id="0a51" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">输出:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="357f" class="ni lt iq ne b gy nj nk l nl nm">Email (SHA-256): 36e96648c5410d00a7da7206c01237139f950bed21d8c729aae019dbe07964e7</span></pre><p id="18a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样！我们的假电子邮件地址已被成功散列。</p><h1 id="0289" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">使用pandas和hashlib的完整示例</h1><p id="796e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">既然我们可以将hashlib应用于单个字符串，那么将这个例子扩展到pandas数据帧就相当简单了。我们将使用信用卡客户数据，这些数据可以在<a class="ae kv" href="https://www.kaggle.com/sakshigoyal7/credit-card-customers" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上获得，最初是由<a class="ae kv" href="https://leaps.analyttica.com/" rel="noopener ugc nofollow" target="_blank">Analyttica treasury hunt LEAPS</a>提供的。</p><p id="79c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">场景:</strong>你需要共享一个信用卡客户列表。您希望保留字段“CLIENTNUM ”,因为一个客户可以拥有多张信用卡，并且您希望能够唯一地标识它们。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="57c4" class="ni lt iq ne b gy nj nk l nl nm">import pandas as pd</span><span id="addf" class="ni lt iq ne b gy nn nk l nl nm"># Read only select columns using pandas<br/>df = pd.read_csv('data/BankChurners.csv', usecols=['CLIENTNUM', 'Customer_Age', 'Gender', 'Attrition_Flag', 'Total_Trans_Amt'])</span><span id="bcee" class="ni lt iq ne b gy nn nk l nl nm">df.head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/1d5a7ff9bbd33987219528782e491325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sHHLQOXmoqGfF3es2jc91A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="eb0a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在将我们的“CLIENTNUM”列转换为string数据类型之后，我们可以使用pandas <code class="fe np nq nr ne b">.apply()</code>散列该列中的所有字符串:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="97d9" class="ni lt iq ne b gy nj nk l nl nm"># Convert column to string<br/>df['CLIENTNUM'] = df['CLIENTNUM'].astype(str)</span><span id="66ae" class="ni lt iq ne b gy nn nk l nl nm"># Apply hashing function to the column<br/>df['CLIENTNUM_HASH'] = df['CLIENTNUM'].apply(<br/>    lambda x: <br/>        hashlib.sha256(x.encode()).hexdigest()<br/>)</span></pre><p id="a7df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">祝你在尝试破解我们新创建的专栏时好运。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/232291ffebdaced52c32ee2ccaa38a94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2u_qNZeiY2KGJPQpCiqkBw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="00f4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="326a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">完成本教程后，你应该对哈希算法有一个基本的了解。我们看到了如何使用<strong class="ky ir"> hashlib </strong>散列一个字符串，以及如何将它应用于pandas DataFrame列来匿名敏感信息。</p><p id="0bce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你有什么问题吗？<a class="ae kv" href="https://twitter.com/rtkilian" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">推我</strong> </a>或者在<a class="ae kv" href="https://www.linkedin.com/in/rtkilian/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> LinkedIn </strong> </a>上加我。</p><p id="ca43" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在<a class="ae kv" href="https://github.com/rtkilian/data-science-blogging/blob/main/hashlib_pandas.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> GitHub </strong> </a>上找到这篇文章中用到的所有代码。</p></div></div>    
</body>
</html>