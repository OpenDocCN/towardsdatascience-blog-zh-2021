<html>
<head>
<title>10 tricks for converting Data to a Numeric Type in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Pandas中将数据转换为数字类型的10个技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/converting-data-to-a-numeric-type-in-pandas-db9415caab0b?source=collection_archive---------2-----------------------#2021-04-14">https://towardsdatascience.com/converting-data-to-a-numeric-type-in-pandas-db9415caab0b?source=collection_archive---------2-----------------------#2021-04-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5d20" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">熊猫帮助你开始数据分析的提示和技巧</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5347d13cc0e65dec59e723c98a574f40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mrymy_h_8NdLvSx2rzxN7A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@rossf?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">罗斯·芬登</a>在<a class="ae ky" href="https://unsplash.com/s/photos/change?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="272f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在进行数据分析时，确保正确的数据类型非常重要。否则，您可能会得到意外的结果或错误。在熊猫的例子中，它将在许多情况下正确地推断数据类型，并且您可以继续您的分析，而无需对该主题进行任何进一步的思考。</p><p id="6737" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管pandas工作得很好，但在数据分析过程中的某个时候，您可能需要显式地将数据从一种类型转换为另一种类型。本文将讨论如何将数据转换为数值类型。更具体地说，您将学习如何使用Pandas内置方法<code class="fe lv lw lx ly b">astype()</code>和<code class="fe lv lw lx ly b">to_numeric()</code>来处理以下常见问题:</p><ol class=""><li id="b921" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu me mf mg mh bi translated">将string/int转换为int/float</li><li id="51bc" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">将float转换为int</li><li id="388e" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">转换混合数据类型的列</li><li id="7587" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">处理缺失值</li><li id="dc83" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">将货币列转换为浮动</li><li id="9edb" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">将布尔值转换为0/1</li><li id="c075" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">一次转换多个数据列</li><li id="9943" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">读取CSV文件时定义数据类型</li><li id="c46c" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">创建自定义函数来转换数据类型</li><li id="cf96" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated"><code class="fe lv lw lx ly b">astype()</code>对<code class="fe lv lw lx ly b">to_numeric()</code></li></ol><p id="4b4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了进行演示，我们创建了一个数据集，并用一个函数加载它:</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="e719" class="mr ms it ly b gy mt mu l mv mw">import pandas as pd<br/>import numpy as np</span><span id="1b6e" class="mr ms it ly b gy mx mu l mv mw">def load_df(): <br/>  return pd.DataFrame({<br/>    'string_col': ['1','2','3','4'],<br/>    'int_col': [1,2,3,4],<br/>    'float_col': [1.1,1.2,1.3,4.7],<br/>    'mix_col': ['a', 2, 3, 4],<br/>    'missing_col': [1.0, 2, 3, np.nan],<br/>    'money_col': ['£1,000.00','£2,400.00','£2,400.00','£2,400.00'],<br/>    'boolean_col': [True, False, True, True],<br/>    'custom': ['Y', 'Y', 'N', 'N']<br/>  })</span><span id="5df2" class="mr ms it ly b gy mx mu l mv mw">df = load_df()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/c1f5b6d9abb2ba804e7fd8c6d8626c28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3vUX-pDewteoJn2pOPnvTw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="ff79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请查看<a class="ae ky" href="https://github.com/BindiChen/machine-learning/blob/master/data-analysis/036-pandas-change-data-to-numeric-type/change-data-to-a-numeric-type.ipynb" rel="noopener ugc nofollow" target="_blank"> Github repo </a>获取源代码。</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="4f56" class="ng ms it bd nh ni nj nk nl nm nn no np jz nq ka nr kc ns kd nt kf nu kg nv nw bi translated">检查数据类型</h1><p id="8d5e" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">在我们深入研究更改数据类型之前，让我们快速了解一下如何检查数据类型。如果我们想在一个数据帧中看到所有的数据类型，我们可以使用<code class="fe lv lw lx ly b">dtypes</code>属性:</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="64e7" class="mr ms it ly b gy mt mu l mv mw">&gt;&gt;&gt; <strong class="ly iu">df.dtypes</strong></span><span id="85b7" class="mr ms it ly b gy mx mu l mv mw">string_col      object<br/>int_col          int64<br/>float_col      float64<br/>mix_col         object<br/>missing_col    float64<br/>money_col       object<br/>boolean_col       bool<br/>custom          object<br/>dtype: object</span></pre><p id="5c48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个属性在Series中也是可用的，我们可以用它来检查特定列上的数据类型。例如，检查<strong class="lb iu"> int_col </strong>的数据类型:</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="8561" class="mr ms it ly b gy mt mu l mv mw">&gt;&gt;&gt; df.<strong class="ly iu">int_col.dtypes</strong></span><span id="1aa6" class="mr ms it ly b gy mx mu l mv mw">dtype('int64')</span></pre><p id="04bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们想研究数据，那么<code class="fe lv lw lx ly b">info()</code>方法可能更有用，因为它提供了RangeIndex、总列数、非空计数、dtypes和内存使用情况。这是大量有价值的信息，可以帮助我们更全面地了解数据。</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="820e" class="mr ms it ly b gy mt mu l mv mw">&gt;&gt;&gt; <strong class="ly iu">df.info()</strong></span><span id="0e6f" class="mr ms it ly b gy mx mu l mv mw">RangeIndex: 4 entries, 0 to 3<br/>Data columns (total 8 columns):<br/> #   Column       Non-Null Count  Dtype  <br/>---  ------       --------------  -----  <br/> 0   string_col   4 non-null      object <br/> 1   int_col      4 non-null      int64  <br/> 2   float_col    4 non-null      float64<br/> 3   mix_col      4 non-null      object <br/> 4   missing_col  3 non-null      float64<br/> 5   money_col    4 non-null      object <br/> 6   boolean_col  4 non-null      bool   <br/> 7   custom       4 non-null      object <br/>dtypes: bool(1), float64(2), int64(1), object(4)<br/>memory usage: 356.0+ bytes</span></pre><h1 id="f076" class="ng ms it bd nh ni oc nk nl nm od no np jz oe ka nr kc of kd nt kf og kg nv nw bi translated">1.将字符串转换为整型/浮点型</h1><p id="30eb" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">将Pandas列转换为不同类型的最简单方法是使用Series的方法<code class="fe lv lw lx ly b">astype()</code>。例如，要将字符串转换成整数，我们可以这样调用它:</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="bda6" class="mr ms it ly b gy mt mu l mv mw"># string to int<br/>&gt;&gt;&gt; df['string_col'] = df['string_col']<strong class="ly iu">.astype('int')</strong><br/>&gt;&gt;&gt; df.dtypes</span><span id="94e8" class="mr ms it ly b gy mx mu l mv mw"><strong class="ly iu">string_col       int64</strong><br/>int_col        float64<br/>float_col      float64<br/>mix_col         object<br/>missing_col    float64<br/>money_col       object<br/>boolean_col       bool<br/>custom          object<br/>dtype: object</span></pre><p id="7e6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到它默认使用的是<strong class="lb iu"> 64位整数</strong>。在某些情况下，当处理大型数据集时，使用较短的整数会更节省内存。为此，你可以简单地调用<code class="fe lv lw lx ly b">astype('int8')</code>、<code class="fe lv lw lx ly b">astype('int16')</code>或<code class="fe lv lw lx ly b">astype('int32')</code></p><p id="cd0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，如果我们想将数据类型转换为float，我们可以调用<code class="fe lv lw lx ly b">astype('float')</code>。默认情况下，它使用的是<strong class="lb iu"> 64位浮点数</strong>。我们可以使用<code class="fe lv lw lx ly b">'float128'</code>来获得更高的精度，或者使用<code class="fe lv lw lx ly b">'float16'</code>来获得更高的内存效率。</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="a6b2" class="mr ms it ly b gy mt mu l mv mw"># string to float<br/>&gt;&gt;&gt; df['string_col'] = df['string_col']<strong class="ly iu">.astype('float')</strong><br/>&gt;&gt;&gt; df.dtypes</span><span id="713c" class="mr ms it ly b gy mx mu l mv mw"><strong class="ly iu">string_col     float64</strong><br/>int_col          int64<br/>float_col      float64<br/>mix_col         object<br/>missing_col    float64<br/>money_col       object<br/>boolean_col       bool<br/>custom          object<br/>dtype: object</span><span id="2825" class="mr ms it ly b gy mx mu l mv mw"># For more precision<br/>&gt;&gt;&gt; df['string_col'] = df['string_col']<strong class="ly iu">.astype('float128')</strong></span><span id="51b9" class="mr ms it ly b gy mx mu l mv mw"># For more memory efficiency<br/>&gt;&gt;&gt; df['string_col'] = df['string_col']<strong class="ly iu">.astype('float16')<br/></strong>&gt;&gt;&gt; df['string_col'] = df['string_col']<strong class="ly iu">.astype('float32')</strong></span></pre><h1 id="f276" class="ng ms it bd nh ni oc nk nl nm od no np jz oe ka nr kc of kd nt kf og kg nv nw bi translated">2.将float转换为int</h1><p id="e5a3" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">如果我们想将一个浮点列转换成整数，我们可以尝试使用上面使用的<code class="fe lv lw lx ly b">astype()</code>。</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="8308" class="mr ms it ly b gy mt mu l mv mw">df['float_col'] = df['float_col']<strong class="ly iu">.astype('int')</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/1c58e1bf619e7be3de8aacbb8b851e3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tkY80j2vxRw6TFJ-lhhc9Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="1cc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，有一个小问题。通过显示DataFrame，我们可以看到该列被转换为整数，但所有值都被向下舍入。这可能没问题，但在大多数情况下，我会认为这是不对的。如果我们想转换成整数，并按照我们期望的方式四舍五入，我们可以先做<code class="fe lv lw lx ly b">round()</code>。</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="4baf" class="mr ms it ly b gy mt mu l mv mw">df['float_col'] = df['float_col']<strong class="ly iu">.round(0)</strong>.astype('int')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/a7f3f5bbdfbf90c54b70c2323315637e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*noGGzZe7dDlv9ISsWatkWg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0264" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，数字<code class="fe lv lw lx ly b">4.7</code>被四舍五入为<code class="fe lv lw lx ly b">5</code>。</p><h1 id="52c5" class="ng ms it bd nh ni oc nk nl nm od no np jz oe ka nr kc of kd nt kf og kg nv nw bi translated">3.转换混合类型的列</h1><p id="331d" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">让我们继续看一列混合的字符串和数字。当运行<code class="fe lv lw lx ly b">astype('int')</code>时，我们得到一个<strong class="lb iu">值错误</strong>。</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="38e9" class="mr ms it ly b gy mt mu l mv mw"># Getting ValueError<br/>df['mix_col'] = df['mix_col'].astype('int')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/2ee36677dcb0de0ee0308c5f71654961.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bWLkYb_Zojr-wAcsmO5g2w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7ece" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该错误表明值<code class="fe lv lw lx ly b">'a'</code>有问题，因为它不能转换为整数。为了解决这个问题，我们可以使用带参数<code class="fe lv lw lx ly b">errors='coerce'</code>的Pandas <code class="fe lv lw lx ly b">to_numeric()</code>函数。</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="621c" class="mr ms it ly b gy mt mu l mv mw">df['mix_col'] = pd.<strong class="ly iu">to_numeric</strong>(df['mix_col'], <strong class="ly iu">errors='coerce'</strong>)</span></pre><p id="9fcb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是当检查<code class="fe lv lw lx ly b">dtypes</code>时，你会发现它被转换为<code class="fe lv lw lx ly b">float64</code>。</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="61e3" class="mr ms it ly b gy mt mu l mv mw">&gt;&gt;&gt; df['mix_col'].dtypes</span><span id="483b" class="mr ms it ly b gy mx mu l mv mw">dtype('<strong class="ly iu">float64</strong>')</span></pre><p id="e305" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在某些情况下，你不希望输出浮点值，你希望它是整数，例如转换一个ID列。我们可以叫<code class="fe lv lw lx ly b">astype('Int64')</code>。注意它有一个大写字母<code class="fe lv lw lx ly b">I</code>并且不同于Numpy <code class="fe lv lw lx ly b">'int64'</code>。这样做的目的是将Numpy的<code class="fe lv lw lx ly b">NaN</code>改为Pandas的<code class="fe lv lw lx ly b">NA</code>，这样它就可以是一个整数。</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="3873" class="mr ms it ly b gy mt mu l mv mw">&gt;&gt;&gt; df['mix_col'] = <br/>       pd.to_numeric(df['mix_col'], errors='coerce').<strong class="ly iu">astype('Int64')</strong></span><span id="3b37" class="mr ms it ly b gy mx mu l mv mw">&gt;&gt;&gt; df['mix_col'].dtypes</span><span id="bedf" class="mr ms it ly b gy mx mu l mv mw">Int64Dtype()</span></pre><p id="2da7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，我们可以用另一个值替换Numpy <code class="fe lv lw lx ly b">nan</code>(例如用<code class="fe lv lw lx ly b">0</code>替换<code class="fe lv lw lx ly b">NaN</code>)并调用<code class="fe lv lw lx ly b">astype('int')</code></p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="7d03" class="mr ms it ly b gy mt mu l mv mw">df['mix_col'] = pd.to_numeric(<br/>    df['mix_col'], <br/>    errors='coerce'<br/>).<strong class="ly iu">fillna(0)</strong>.<strong class="ly iu">astype('int')</strong></span></pre><h1 id="487b" class="ng ms it bd nh ni oc nk nl nm od no np jz oe ka nr kc of kd nt kf og kg nv nw bi translated">4.处理缺失值</h1><p id="be6b" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">现在，我们应该完全具备处理缺失值的能力。在Pandas中，缺失值被赋予值<code class="fe lv lw lx ly b">NaN</code>，这是“不是一个数字”的缩写。由于技术原因，这些<code class="fe lv lw lx ly b">NaN</code>值总是属于<code class="fe lv lw lx ly b">float64</code>。</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="542e" class="mr ms it ly b gy mt mu l mv mw">df.<strong class="ly iu">missing_col.dtypes</strong></span><span id="72df" class="mr ms it ly b gy mx mu l mv mw">dtype('<strong class="ly iu">float64</strong>')</span></pre><p id="4f5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当将带有缺失值的列转换为整数时，我们还会得到一个<strong class="lb iu"> ValueError </strong>，因为<code class="fe lv lw lx ly b">NaN</code>不能转换为整数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/d7b5ae78414ef589027057bf6317662c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ULlQHYM4Eo2LQnD2nLlBXw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="ea3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了避免这个错误，我们可以像上面那样调用<code class="fe lv lw lx ly b">astype('Int64')</code>(注意它是大写的<code class="fe lv lw lx ly b">I</code>，和上一节提到的一样)。这样做的是将Numpy的<code class="fe lv lw lx ly b">NaN</code>改为Pandas的<code class="fe lv lw lx ly b">NA</code>，这允许它是一个整数。</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="7fa9" class="mr ms it ly b gy mt mu l mv mw">df['missing_col'] = df['missing_col'].<strong class="ly iu">astype('Int64')</strong></span></pre><p id="d7f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，我们可以用另一个值替换Numpy <code class="fe lv lw lx ly b">NaN</code>(例如用<code class="fe lv lw lx ly b">0</code>替换<code class="fe lv lw lx ly b">NaN</code>)并调用<code class="fe lv lw lx ly b">astype('int')</code></p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="8a7a" class="mr ms it ly b gy mt mu l mv mw">df['mix_col'] = df['missing_col'].<strong class="ly iu">fillna(0)</strong>.<strong class="ly iu">astype('int')</strong></span></pre><p id="b1ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想了解有关处理缺失值的更多信息，可以查看:</p><div class="ol om gp gr on oo"><a rel="noopener follow" target="_blank" href="/working-with-missing-values-in-pandas-5da45d16e74"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd iu gy z fp ot fr fs ou fu fw is bi translated">处理熊猫中缺失的值</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">关于Pandas中缺失值以及如何使用内置方法处理它们的教程</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">towardsdatascience.com</p></div></div><div class="ox l"><div class="oy l oz pa pb ox pc ks oo"/></div></div></a></div><h1 id="3db2" class="ng ms it bd nh ni oc nk nl nm od no np jz oe ka nr kc of kd nt kf og kg nv nw bi translated">5.将货币列转换为数字</h1><p id="f6ae" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">让我们转到钱这一栏。问题是，如果我们使用上面的方法，我们将得到所有的<code class="fe lv lw lx ly b">NaN</code>或<code class="fe lv lw lx ly b">NA</code>值，因为它们都是带有符号<code class="fe lv lw lx ly b">£</code>和<code class="fe lv lw lx ly b">,</code>的字符串，并且它们不能转换成数字。所以我们要做的第一件事就是删除所有无效的符号。</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="49fc" class="mr ms it ly b gy mt mu l mv mw">&gt;&gt;&gt; df['money_replace'] = <br/>       df['money_col']<strong class="ly iu">.str.replace('£', '').str.replace(',','')</strong><br/>&gt;&gt;&gt; df['money_replace'] = pd.to_numeric(df['money_replace'])<br/>&gt;&gt;&gt; df['money_replace']</span><span id="0db9" class="mr ms it ly b gy mx mu l mv mw">0    1000.0<br/>1    2400.0<br/>2    2400.0<br/>3    2400.0<br/>Name: money_replace, dtype: <strong class="ly iu">float64</strong></span></pre><p id="3ef6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们链接2个<code class="fe lv lw lx ly b">replace()</code>调用，一个用于<code class="fe lv lw lx ly b">£</code>，另一个用于<code class="fe lv lw lx ly b">,</code>，用空字符串替换它们。</p><p id="df96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你熟悉正则表达式，我们也可以用正则表达式替换那些符号。</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="b227" class="mr ms it ly b gy mt mu l mv mw">&gt;&gt;&gt; df['money_regex'] = <br/>       df['money_col'].str.replace(<strong class="ly iu">'[\£\,]', '', regex=True</strong>)<br/>&gt;&gt;&gt; df['money_regex'] = pd.to_numeric(df['money_replace'])<br/>&gt;&gt;&gt; df['money_regex']</span></pre><p id="b77c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">replace('[\£\,]', '', regex=True)</code>表示我们想用一个空字符串替换<code class="fe lv lw lx ly b">£</code>和<code class="fe lv lw lx ly b">,</code>。参数<code class="fe lv lw lx ly b">regex=True</code>假设传入的模式是一个正则表达式(注意它默认为<code class="fe lv lw lx ly b">True</code>)。</p><h1 id="edf5" class="ng ms it bd nh ni oc nk nl nm od no np jz oe ka nr kc of kd nt kf og kg nv nw bi translated">6.将布尔值转换为0/1</h1><p id="bdb7" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">我们有<code class="fe lv lw lx ly b">True</code> / <code class="fe lv lw lx ly b">False</code>，但是您可以想象一种情况，我们需要这些作为<code class="fe lv lw lx ly b">0</code>和<code class="fe lv lw lx ly b">1</code>，例如，如果您正在构建一个机器学习模型，这是您的输入特征之一，您需要它是数字，您将使用<code class="fe lv lw lx ly b">0</code>和<code class="fe lv lw lx ly b">1</code>来表示<code class="fe lv lw lx ly b">False</code>和<code class="fe lv lw lx ly b">True</code>。这个其实很简单，你可以直接叫<code class="fe lv lw lx ly b">astype('int')</code>:</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="05a5" class="mr ms it ly b gy mt mu l mv mw">df['boolean_col'] = df['boolean_col']<strong class="ly iu">.astype('int')</strong></span></pre><h1 id="9af3" class="ng ms it bd nh ni oc nk nl nm od no np jz oe ka nr kc of kd nt kf og kg nv nw bi translated">7.一次转换多个列数据类型</h1><p id="418f" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">到目前为止，我们一直在一次转换一列的数据类型。例如</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="03d7" class="mr ms it ly b gy mt mu l mv mw"># Converting column string_col and int_col one at a time<br/>df['string_col'] = df['string_col'].astype('float16')<br/>df['int_col'] = df['int_col'].astype('float16')</span></pre><p id="f595" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有一个DataFrame方法，也称为<code class="fe lv lw lx ly b">astype()</code>，允许我们同时转换多个列数据类型。当您有一堆要更改的列时，这很节省时间。</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="2885" class="mr ms it ly b gy mt mu l mv mw">df = df.astype({<br/>    <strong class="ly iu">'string_col': 'float16',<br/>    'int_col': 'float16'</strong><br/>})</span></pre><h1 id="9b18" class="ng ms it bd nh ni oc nk nl nm od no np jz oe ka nr kc of kd nt kf og kg nv nw bi translated">8.定义读取CSV文件时每列的数据类型</h1><p id="7f2a" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">如果您想在读取CSV文件时为每一列设置数据类型，可以在加载数据时使用参数<code class="fe lv lw lx ly b">dtype</code><code class="fe lv lw lx ly b">read_csv()</code>:</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="d600" class="mr ms it ly b gy mt mu l mv mw">df = pd.read_csv(<br/>    'dataset.csv', <br/>    <strong class="ly iu">dtype={<br/>        'string_col': 'float16',<br/>        'int_col': 'float16'<br/>    }</strong><br/>)</span></pre><p id="063a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">dtype</code>参数取一个字典，键代表列，值代表数据类型。此方法与上述方法的区别在于，此方法在读取过程中进行转换，可以节省时间并提高内存效率。</p><h1 id="9724" class="ng ms it bd nh ni oc nk nl nm od no np jz oe ka nr kc of kd nt kf og kg nv nw bi translated">9.创建自定义函数将数据转换为数字</h1><p id="bf9c" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">当数据转换有点复杂时，我们可以创建一个自定义函数，并将其应用于每个值，以转换为适当的数据类型。</p><p id="d3e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，在<strong class="lb iu"> money_col </strong>列中，有一个我们可以使用的简单函数:</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="a972" class="mr ms it ly b gy mt mu l mv mw">&gt;&gt;&gt; <strong class="ly iu">def convert_money(value):<br/>       value = value.replace('£','').replace(',', '')<br/>       return float(value)</strong></span><span id="33de" class="mr ms it ly b gy mx mu l mv mw">&gt;&gt;&gt; df['money_col']<strong class="ly iu">.apply(convert_money)</strong></span><span id="b118" class="mr ms it ly b gy mx mu l mv mw">0    1000.0<br/>1    2400.0<br/>2    2400.0<br/>3    2400.0<br/>Name: money_col, dtype: <strong class="ly iu">float64</strong></span></pre><p id="5bc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以使用λ函数:</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="49ce" class="mr ms it ly b gy mt mu l mv mw">df['money_col']<br/>    .apply(<strong class="ly iu">lambda v: v.replace('£','').replace(',','')</strong>)<br/>    .astype('float')</span></pre><h1 id="0753" class="ng ms it bd nh ni oc nk nl nm od no np jz oe ka nr kc of kd nt kf og kg nv nw bi translated">10.<code class="fe lv lw lx ly b">astype()</code>与<code class="fe lv lw lx ly b">to_numeric()</code>的区别</h1><p id="1aee" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">将数据类型从一种转换到另一种最简单的方法是使用<code class="fe lv lw lx ly b">astype()</code>方法。熊猫数据框架和系列都支持这种方法。如果您已经有了数字数据类型(<code class="fe lv lw lx ly b">int8</code>、<code class="fe lv lw lx ly b">int16</code>、<code class="fe lv lw lx ly b">int32</code>、<code class="fe lv lw lx ly b">int64</code>、<code class="fe lv lw lx ly b">float16</code>、<code class="fe lv lw lx ly b">float32</code>、<code class="fe lv lw lx ly b">float64</code>、<code class="fe lv lw lx ly b">float128</code>和<code class="fe lv lw lx ly b">boolean</code>)，您也可以使用<code class="fe lv lw lx ly b">astype()</code>进行以下操作:</p><ul class=""><li id="482b" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu pd mf mg mh bi translated">将其转换为另一种数字数据类型(int到float，float到int，等等。)</li><li id="9df3" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pd mf mg mh bi translated">使用它向下转换到较小的字节大小，或者向上转换到较大的字节大小</li></ul><p id="15c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，<code class="fe lv lw lx ly b">astype()</code>对混合类型的列不起作用。例如，<strong class="lb iu">混合列</strong>有<code class="fe lv lw lx ly b">a</code>，而<strong class="lb iu">缺失列</strong>有<code class="fe lv lw lx ly b">NaN</code>。如果我们尝试使用<code class="fe lv lw lx ly b">astype()</code>，我们将得到一个<strong class="lb iu">值错误</strong>。从熊猫0.20.0开始，这个错误可以通过设置参数<code class="fe lv lw lx ly b">errors='ignore',</code>来抑制，但是你的原始数据将原封不动地返回。</p><p id="53df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas <code class="fe lv lw lx ly b">to_numeric()</code>函数可以更优雅地处理这些值。与其失败，我们可以设置参数<code class="fe lv lw lx ly b">errors='coerce'</code>将无效值强制为<code class="fe lv lw lx ly b">NaN</code>:</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="5a3e" class="mr ms it ly b gy mt mu l mv mw">pd.to_numeric(df['mixed_col'], <strong class="ly iu">errors='coerce'</strong>)</span></pre><h1 id="af4f" class="ng ms it bd nh ni oc nk nl nm od no np jz oe ka nr kc of kd nt kf og kg nv nw bi translated">结论</h1><p id="5025" class="pw-post-body-paragraph kz la it lb b lc nx ju le lf ny jx lh li nz lk ll lm oa lo lp lq ob ls lt lu im bi translated">我们已经看到了如何使用<code class="fe lv lw lx ly b">astype()</code>和<code class="fe lv lw lx ly b">to_numeric()</code>将Pandas数据列转换为数字类型。<code class="fe lv lw lx ly b">astype()</code>是最简单的方法，在转换方式上提供了更多的可能性，而<code class="fe lv lw lx ly b">to_numeric()</code>具有更强大的错误处理功能。</p><p id="0f5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇文章能帮助你节省学习熊猫的时间。我建议您查看一下<code class="fe lv lw lx ly b">astypes()</code>和<code class="fe lv lw lx ly b">to_numeric()</code> API的文档，并了解您可以做的其他事情。</p><p id="867e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。请查看<a class="ae ky" href="https://github.com/BindiChen/machine-learning/blob/master/data-analysis/036-pandas-change-data-to-numeric-type/change-data-to-a-numeric-type.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>获取源代码，如果你对机器学习的实用方面感兴趣，请继续关注。</p><h2 id="d896" class="mr ms it bd nh pe pf dn nl pg ph dp np li pi pj nr lm pk pl nt lq pm pn nv po bi translated">你可能会对我的其他一些熊猫文章感兴趣:</h2><ul class=""><li id="acad" class="lz ma it lb b lc nx lf ny li pp lm pq lq pr lu pd mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/all-pandas-json-normalize-you-should-know-for-flattening-json-13eae1dfb7dd">熊猫json_normalize()你应该知道的扁平化JSON </a></li><li id="53b8" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pd mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/all-pandas-cut-you-should-know-for-transforming-numerical-data-into-categorical-data-1370cf7f4c4f">所有熊猫切()你应该知道把数值数据转换成分类数据</a></li><li id="40b1" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pd mf mg mh bi translated"><a class="ae ky" href="https://medium.com/@bindiatwork/using-pandas-method-chaining-to-improve-code-readability-d8517c5626ac" rel="noopener">使用熊猫方法链接提高代码可读性</a></li><li id="d2d9" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pd mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/how-to-do-a-custom-sort-on-pandas-dataframe-ac18e7ea5320">如何对熊猫数据帧进行自定义排序</a></li><li id="8b6f" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pd mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/all-the-pandas-shift-you-should-know-for-data-analysis-791c1692b5e">为了数据分析你应该知道的所有熊猫移位()</a></li><li id="5074" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pd mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/when-to-use-pandas-transform-function-df8861aa0dcf">何时使用Pandas transform()函数</a></li><li id="9580" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pd mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/pandas-concat-tricks-you-should-know-to-speed-up-your-data-analysis-cd3d4fdfe6dd">你应该知道的熊猫串联()招数</a></li><li id="382b" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pd mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/all-the-pandas-merge-you-should-know-for-combining-datasets-526b9ecaf184">所有熊猫合并()你应该知道</a></li><li id="6121" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pd mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/working-with-datetime-in-pandas-dataframe-663f7af6c587">在Pandas数据帧中处理日期时间</a></li><li id="43fc" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pd mf mg mh bi translated"><a class="ae ky" href="https://medium.com/@bindiatwork/all-the-pandas-read-csv-you-should-know-to-speed-up-your-data-analysis-1e16fe1039f3" rel="noopener">熊猫阅读_csv()你应该知道的招数</a></li><li id="b0ef" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu pd mf mg mh bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/4-tricks-you-should-know-to-parse-date-columns-with-pandas-read-csv-27355bb2ad0e">用Pandas read_csv()解析日期列应该知道的4个技巧</a></li></ul><p id="aab4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更多教程可以在我的<a class="ae ky" href="https://github.com/BindiChen/machine-learning" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到</p></div></div>    
</body>
</html>