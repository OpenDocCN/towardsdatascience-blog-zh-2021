<html>
<head>
<title>Panel Forecasting For eCommerce Demand</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">电子商务需求的面板预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/panel-forecasting-for-ecommerce-demand-3cb4d7c6f351?source=collection_archive---------8-----------------------#2021-12-15">https://towardsdatascience.com/panel-forecasting-for-ecommerce-demand-3cb4d7c6f351?source=collection_archive---------8-----------------------#2021-12-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="05db" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/notes-from-industry" rel="noopener" target="_blank">行业笔记</a></h2><div class=""/><div class=""><h2 id="8fa0" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">使用机器学习来更好地预测和理解数字市场</h2></div><p id="a087" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><em class="lk">本文是哈佛大学2021年秋季</em>  <em class="lk">课程</em> <a class="ae ll" href="https://www.capstone.iacs.seas.harvard.edu/" rel="noopener ugc nofollow" target="_blank"> <em class="lk"> AC297R期末项目的一部分。</em></a></p><p id="0318" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="kq ja"> <em class="lk">团队成员</em></strong><em class="lk">:siva Nanda Raja Nanda、Ryan Liu、David Assaraf、Junkai Ong </em></p><p id="8611" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="kq ja"> <em class="lk">模式伙伴</em> </strong> <em class="lk">:雅各布·米勒、汉密尔顿·诺尔</em></p><p id="11ae" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="kq ja"> <em class="lk">助教</em> </strong> <em class="lk">:佐纳·科斯蒂克</em></p><p id="9c47" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="kq ja"> <em class="lk">导师</em> </strong> <em class="lk">:克里斯·坦纳</em></p><h1 id="1413" class="lm ln iq bd lo lp lq lr ls lt lu lv lw kf lx kg ly ki lz kj ma kl mb km mc md bi translated">问题描述</h1><p id="8375" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">电子商务正在全球零售市场中占据主导地位。预测消费者行为的趋势非常重要，因为它们有助于为库存规划等关键业务提供信息。库存过多会导致不必要的财务支出和存储成本增加，而库存不足会导致潜在收入损失和消费者需求得不到满足。因此，准确预测需求以优化库存计划至关重要。</p><p id="401f" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们与电子商务加速器Pattern合作，创建了一个预测未来8周需求的面板预测模型。我们的模型的性能将与28天移动平均线模型进行比较，该模型用作基线模型。</p><h1 id="35ae" class="lm ln iq bd lo lp lq lr ls lt lu lv lw kf lx kg ly ki lz kj ma kl mb km mc md bi translated">数据</h1><p id="ce67" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">提供了从2018年1月到2021年11月每日产品销售业绩的数据集。该数据集包含大约1150万行，与Amazon.com的销售有关。数据集的字段包括假名供应商(品牌)代码、产品代码、地区、日期、单位销售、库存和购买量百分比。库存和购买箱百分比信息是内部跟踪的指标，有时可能会丢失。在亚马逊上有多个卖家出售同一产品的情况下，当买家购买产品时，购买框决定哪个卖家获得销售。购买箱百分比是根据模式每天估计的一个指标，该功能为需求预测增加了另一层复杂性，因为特定卖方的销售增长可能归因于该卖方更高的产品需求和/或更高的购买箱百分比。此外，库存信息可能对我们的预测有用，因为用完库存(缺货)会影响观察到的销售。</p><p id="efba" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们选择专注于美国地区的销售，因为大部分销售都在美国。</p><h1 id="644f" class="lm ln iq bd lo lp lq lr ls lt lu lv lw kf lx kg ly ki lz kj ma kl mb km mc md bi translated">探索性数据分析</h1><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mj"><img src="../Images/89c8cee2663528d2f7e42b3c7d79462a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*U2hG6FcwBGbYFvV2"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图1:按日期排列的总单位数(</em>图片由作者提供)</p></figure><p id="b270" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">图1显示了整个数据范围内的每日单位总数。该图还显示，在每年的黄金日、黑色星期五和圣诞节前后，与大型销售活动相对应，销售量会出现峰值。因此，我们为某些假日创建了指示变量(参见后面的“特征工程”部分)，以在我们的建模中考虑这些事件。在Covid疫情期间，我们看到了更多的销售波动。特别是，在Covid开始时有一个峰值(可能是由于对某些维生素和医疗保健产品的需求增加)，在2020年下半年急剧下降并迅速恢复，在2021年期间销售相对稳定。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi na"><img src="../Images/2bdf21b8b70cd97d9b5ee060f910773e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GDmH_2UDLiI8ktA7"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图2:按日期排列的未购买框百分比(</em>按作者排列的图片)</p></figure><p id="6fa2" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">由于购买箱百分比信息可能对需求预测很重要，我们在图2中按日期显示了缺少购买箱百分比信息的观察的百分比。我们观察到，从2018年下半年开始，购买箱百分比指标变得更加一致。此外，似乎有几个日期的购买框从几乎所有的观察中消失了。</p><h1 id="6dd6" class="lm ln iq bd lo lp lq lr ls lt lu lv lw kf lx kg ly ki lz kj ma kl mb km mc md bi translated">方法——概述</h1><p id="6004" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">如下图所示，我们采用了三步法进行面板预测。对于数据清理，我们过滤掉非美国数据，并将其汇总到每周级别(以减轻每日波动的影响)。对于特征工程，我们创建了新的特征来捕捉潜在的信息。在建模中，我们探索了基线模型(即28天移动平均线)、XGBoost、不同的LSTM模型，并最终通过集合模型将它们全部结合起来。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi nb"><img src="../Images/826724a4451c1b8774d35615814adb81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eqPs_sGxDgBbAkvb"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图3:面板预测的三步法(</em>图片由作者提供)</p></figure><h1 id="6310" class="lm ln iq bd lo lp lq lr ls lt lu lv lw kf lx kg ly ki lz kj ma kl mb km mc md bi translated">方法——培训和评估方法</h1><p id="181e" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">我们的评估标准是平均绝对误差(MAE ),它是针对每个预测周独立测量的。在评估过程中，我们还删除了基准(28天移动平均线)为0的观察值，因为使用基准作为未来需求估计的人如果知道产品可能会有一些销售，可能不会预测0销售。</p><p id="6569" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">为了训练和评估模型，我们按日期分割训练、验证和测试数据:</p><ul class=""><li id="f284" class="nc nd iq kq b kr ks ku kv kx ne lb nf lf ng lj nh ni nj nk bi translated">训练数据集:截至2021年2月28日</li><li id="75f2" class="nc nd iq kq b kr nl ku nm kx nn lb no lf np lj nh ni nj nk bi translated">验证数据集:2021年3月1日至2021年4月30日</li><li id="f9ed" class="nc nd iq kq b kr nl ku nm kx nn lb no lf np lj nh ni nj nk bi translated">测试数据集:2021年5月1日起</li></ul><p id="e6ff" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们利用验证数据集来调整每个模型的超参数。一旦超参数被调优，我们就在组合的训练集和验证集上进行训练，然后在测试集上评估性能。</p><p id="4348" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们有两种训练方法:</p><ol class=""><li id="dc75" class="nc nd iq kq b kr ks ku kv kx ne lb nf lf ng lj nq ni nj nk bi translated">非在线培训。在非在线训练中，我们在测试数据集上计算模型预测的MAE。</li><li id="5cf9" class="nc nd iq kq b kr nl ku nm kx nn lb no lf np lj nq ni nj nk bi translated">在线培训。在在线培训中，我们用测试集中每个新周的数据迭代更新我们的模型，以便预测下一组周的需求。这种方法(如图4所示)模拟了真实世界的环境，因为模型可以在生产中每周更新一次。</li></ol><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi nb"><img src="../Images/bf44c6e47e6367c8444591439bb1922c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mElDvZngdlOGSQDB"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图4:在线培训流程图(</em>图片由作者提供)</p></figure><h1 id="520b" class="lm ln iq bd lo lp lq lr ls lt lu lv lw kf lx kg ly ki lz kj ma kl mb km mc md bi translated">数据处理、特征工程</h1><p id="cde4" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">我们设计了各种附加功能来补充原始数据集中提供的功能。针对之前1、2、3、4、12、26、52周的时间框架，计算销售单位的滚动汇总统计数据(即平均值、标准偏差、最小值、最大值、第25百分位、第50百分位和第75百分位指标)，并将其添加到数据集中。因此，每一行不仅包含该周的销售数据，还包含前4周的信息。我们还计算了12周、26周和52周时间范围内购买箱百分比的汇总统计数据。这些额外的信息将允许模型捕捉短期趋势，并检测本周数据中可能的异常。</p><p id="dc28" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">基于时间的要素也被创建并添加到数据集中。对一周的开始日期进行简单的解析和操作，以设计诸如一月中的某一天、一年中的某一天、一月中的某一周、一年中的某一周、月和年等特征。为了提取品牌和产品的更多信息，我们还计算了自品牌首次出现在市场上以来的日志天数和自产品首次出现在市场上以来的日志天数。我们使用了对数变换，使特征的数据分布更接近高斯分布。这导致更紧凑的特征范围，从而实现更有效的神经网络训练。</p><p id="b2cc" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">自从产品最后一次销售以来的周数和最后一次销售的数量也被添加为特性。我们还添加了截至该日期每种产品的总销售量，作为长期历史销售业绩的指标。由于产品可能会遵循季节性周期，我们设计了一个包括上一年2周平均销售额(即本周之前52–53周的平均销售额)的功能。</p><p id="5e05" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">由于从每日级别到每周级别的数据聚合，我们丢失了一些关于缺失值的信息。因此，该特定周的购买框和库存列中缺失值的数量也被添加到数据集中(这对于模型能够考虑缺货非常重要)。原始数据集中缺少的行(由于缺少销售额)也被计算并添加到数据集中。此外，由于假日和销售额的大幅增长之间存在明显的相关性，我们还设计了一个“假日指标”功能，该功能可以指示假日的购物期是否在我们希望预测的一周内。</p><p id="5102" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">为了利用具有相似销售趋势的产品的统计优势，我们基于训练数据中最近52周的单位销售执行了时间序列聚类。我们使用3种不同的聚类算法将产品分为6类:(1)欧几里德k均值聚类，(2)动态时间弯曲(DTW)，以及(3) DTW重心平均(DBA)。</p><h1 id="eb45" class="lm ln iq bd lo lp lq lr ls lt lu lv lw kf lx kg ly ki lz kj ma kl mb km mc md bi translated"><strong class="ak">建模</strong></h1><p id="c4ed" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">在基线模型(28天移动平均线)之上，我们选择与不同的模型(即XGBoost、LSTM、CNN-LSTM和自回归LSTM)合作，以利用它们的不同优势。众所周知，XGBoost在某些预测任务上具有一流的性能，训练速度相对较快，并且可伸缩性非常好。LSTM模型是为序列和时间序列数据制作的，因为它们能够处理不同长度的时间戳。然后，我们在最后将这些模型与一个集合模型(以随机森林回归的形式)相结合，以获得有利的结果。</p><p id="5abb" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们从使用更小的数据子集开始，随着我们构建数据管道、训练我们的模型和调整我们的模型超参数，迭代地增加产品的数量。我们在下面更详细地描述了我们的模型和建模结果。</p><h1 id="369f" class="lm ln iq bd lo lp lq lr ls lt lu lv lw kf lx kg ly ki lz kj ma kl mb km mc md bi translated">基线模型(28天移动平均线)</h1><p id="e56f" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">基线模型是一个简单的28天移动平均线。这意味着，对于每种产品，提前1-8周的任意一周的预测需求是前28天售出数量的简单平均值。</p><p id="5ac7" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">为了直观显示基线模型在较高或较低流动性产品上表现更好，我们绘制了基线模型的相对绝对误差(|y_pred — y_true | / y_true)与产品流动性的关系图。图5显示，数据量和28天基线模型的性能之间似乎没有相关性。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi nr"><img src="../Images/f42fcf87e63ca678103aca3ac949314d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iuvsqiepyynQVak-"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图5:28天基线相对于产品流动性的表现(</em>图片由作者提供)</p></figure><p id="274f" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">下面是单个产品的基准模型预测的直观表示，比较了预测1周和未来8周的基准性能。在每个预测日期，28天移动平均线用于预测接下来8周的销售额。我们观察到，这一基线在提前1周预测需求方面相当不错，但在前几周之后表现不佳，除非销售相当稳定。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi nb"><img src="../Images/0ccf795af7e07e29b51e957baf493d2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VKrshHkLxeLC9Frv"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图6:单一产品的28天平均基线(</em>图片由作者提供)</p></figure><h1 id="ea60" class="lm ln iq bd lo lp lq lr ls lt lu lv lw kf lx kg ly ki lz kj ma kl mb km mc md bi translated">XGBoost</h1><p id="6a34" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">我们选择训练一个单独的模型来预测未来每周的需求。这种方法在计算上更容易，并允许我们更快地迭代，因为预测未来任何一周的全局模型都需要在内存中保存更大的数据集，并且训练起来更慢。此外，在预测未来特定时间范围的更窄任务上训练模型可能会导致更好的性能，因为该模型针对该任务进行了优化，而不是平衡跨时间段的性能。</p><p id="734d" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">使用默认超参数在我们的工程特性上训练的XGBoost模型能够击败基于前3000个产品的测试集的MAE的基准测试，参见下面的图7。</p><h2 id="5060" class="ns ln iq bd lo nt nu dn ls nv nw dp lw kx nx ny ly lb nz oa ma lf ob oc mc iw bi translated">XGBoost:超参数(HP)调整</h2><p id="22b3" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">我们对训练数据执行了网格搜索的多次迭代和交叉验证，以找到该预测任务的最佳超参数。对于每次迭代，搜索空间被缩小以精确定位要使用的最佳超参数。最终，通过搜索选择的超参数对前3000种产品的未调优XGBoost模型产生了更大的改进。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi od"><img src="../Images/6ef1564b943b3d37d4f3d36461110afa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/0*WskZ-kvTBPRS8Wmf"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图7:超参数调优的XGBoost性能(前3000种产品)(</em>图片由作者提供)</p></figure><h2 id="0702" class="ns ln iq bd lo nt nu dn ls nv nw dp lw kx nx ny ly lb nz oa ma lf ob oc mc iw bi translated">XGBoost:在线培训</h2><p id="c55d" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">随后，我们进行了在线训练，并评估了我们的模型。在测试集中的每个星期之后，该模型在直到该星期的数据期间被重新训练。通过这种方式，模型将使用生产环境中可用的新信息进行更新，并且在预测日期不会使用未来的信息来训练模型。此外，这种方法更好地解释了数据的分布变化。如果测试数据与训练数据的分布不同(在这种情况下是正确的，因为销售通常在增加)，那么更新模型将是必要的，以防止它在未来的进一步预测中变得过时。下图比较了有和没有在线培训的XGBoost模型的结果MAEs。我们观察到，在线培训极大地提高了模型性能，尤其是在未来几周。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/243758a31495953729905da2ca784390.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/0*3LopF8LSXjqPEIvB"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图8:在线培训的XGBoost性能(前3000名产品)(</em>图片由作者提供)</p></figure><h2 id="bb4b" class="ns ln iq bd lo nt nu dn ls nv nw dp lw kx nx ny ly lb nz oa ma lf ob oc mc iw bi translated">XGBoost:用于在线培训的不同时间长度</h2><p id="512d" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">在线训练的一个相关超参数是在每个预测周期后使用多少数据来重新训练模型。换句话说，我们想要调查我们需要给模型多少周的过去数据来学习数据中的模式，所以我们设计了一个实验，在再训练期间用给模型的不同周的数据来执行在线训练。下面我们展示这个实验的结果。有趣的是，我们看到，虽然在更长的一段时间内重新训练模型提高了对近期预测的性能，但它往往会导致对未来更远时间的更差预测。对此的一个潜在解释可能是，越旧的数据变得越不相关，您需要预测的越远，因此将训练数据限制到更近的观测值可能有利于预测未来更远的时间。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi of"><img src="../Images/1ef949bf32b5b763e90ce14cb96f8a5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/0*BGiEy_2VPo9SGDnQ"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图9: XGBoost在线培训绩效，按用于再培训的周数排列(</em>图片由作者提供)</p></figure><h2 id="820d" class="ns ln iq bd lo nt nu dn ls nv nw dp lw kx nx ny ly lb nz oa ma lf ob oc mc iw bi translated">XGBoost:前100名产品</h2><p id="040f" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">接下来，我们评估了我们的模型在前100种产品上进行训练时的性能。如下图所示，在对排名前100的产品进行评估时，我们的模型相对于基准测试的改进更加适度。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi of"><img src="../Images/59ca39f1581506c0808ed51ef79b2211.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/0*ip-8Ewbz-xxYQvQf"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图10:在线培训的XGBoost性能(前100名产品)(</em>图片由作者提供)</p></figure><h2 id="570b" class="ns ln iq bd lo nt nu dn ls nv nw dp lw kx nx ny ly lb nz oa ma lf ob oc mc iw bi translated">XGBoost:预测9到16周</h2><p id="59d0" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">预测未来超过8周的需求可以帮助品牌了解生产量。因此，当提前16周预测时，我们评估我们的模型与基准相比的性能。我们观察到，通过在线培训，我们的模型相对于基准的改进随着提前周数的增加而增加。虽然基准和模型MAE都在增长，但模型MAE的增长速度比基准慢，因为它在预测中考虑了其他特征。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/5fe7fade8d8996b2f2295f9aa162b599.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/0*x01NDUMi4NJD71Q7"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图11:在线培训的XGBoost性能(</em>图片由作者提供)</p></figure><h1 id="5a97" class="lm ln iq bd lo lp lq lr ls lt lu lv lw kf lx kg ly ki lz kj ma kl mb km mc md bi translated">LSTM</h1><p id="0979" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">我们探索了LSTM的3个关键设计，即:</p><ol class=""><li id="8315" class="nc nd iq kq b kr ks ku kv kx ne lb nf lf ng lj nq ni nj nk bi translated"><strong class="kq ja">普通LSTM </strong>。我们探索了常规LSTM的使用，它适用于基于时间序列的数据和应用，如面板需求预测。</li><li id="5919" class="nc nd iq kq b kr nl ku nm kx nn lb no lf np lj nq ni nj nk bi translated">美国有线电视新闻网-LSTM。在LSTM进行序列预测之前，CNN-LSTM将利用CNN层来改进特征提取。</li><li id="2da3" class="nc nd iq kq b kr nl ku nm kx nn lb no lf np lj nq ni nj nk bi translated"><strong class="kq ja">自回归LSTM </strong>。自回归LSTM将允许我们利用历史时间序列数据的自回归。</li></ol><h1 id="2825" class="lm ln iq bd lo lp lq lr ls lt lu lv lw kf lx kg ly ki lz kj ma kl mb km mc md bi translated">普通LSTM和CNN LSTM频道</h1><p id="389c" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">为了了解以下因素对性能的影响，我们在常规LSTM和CNN LSTM频道上进行了以下实验。</p><h2 id="befb" class="ns ln iq bd lo nt nu dn ls nv nw dp lw kx nx ny ly lb nz oa ma lf ob oc mc iw bi translated"><strong class="ak">常规LSTM &amp; CNN LSTM: 1全球模特vs每周模特</strong></h2><p id="6d65" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">我们探讨了LSTM的以下主要方法，即:</p><ol class=""><li id="409e" class="nc nd iq kq b kr ks ku kv kx ne lb nf lf ng lj nq ni nj nk bi translated">跨所有周和所有产品的1个LSTM模型(全球模型)</li><li id="ff39" class="nc nd iq kq b kr nl ku nm kx nn lb no lf np lj nq ni nj nk bi translated">所有产品每周1个LSTM模型(每周模型)</li></ol><p id="46d7" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">下图总结了实验结果。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi og"><img src="../Images/a4443b176fba50f1b6d9337c27e028b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/0*19Qx-y72XClEfsiE"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图12:全球模型与每周模型的比较(</em>图片由作者提供)</p></figure><p id="3fe5" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">从上图可以看出，从第1周到第7周，周模型的性能优于全局模型。这可能是因为每周建模的LSTM允许它学习预测未来特定时间范围的更窄任务，这可能会导致更好的性能，因为该模型针对该任务进行了优化，而不是平衡各时间段的性能。</p><h2 id="3f49" class="ns ln iq bd lo nt nu dn ls nv nw dp lw kx nx ny ly lb nz oa ma lf ob oc mc iw bi translated">常规LSTM和CNN LSTM:不同的LSTM输入序列长度</h2><p id="2d33" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">我们研究了在LSTM模型中改变输入序列长度对性能的影响。出于我们项目的目的，我们选择探索2、6、10、14、18的长度。结果如下图所示。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi og"><img src="../Images/77f0753eae5104a2747dd7d4ae16a9f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/0*379IB9FB5uHSLMEa"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图13:不同序列长度的常规LSTM的比较(</em>图片由作者提供)</p></figure><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi og"><img src="../Images/ce7ae58d740a962264f6d857b3a9fac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/0*uFRoFRtG56xBJcS1"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图14:不同序列长度的CNN LSTM对比(</em>图片由作者提供)</p></figure><p id="b8d8" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">如上图所示，通常随着输入序列长度从2增加到14，LSTM的性能(就MAE而言)会提高。然而，当序列长度变为18时，我们注意到性能变得更差。这可能是因为虽然较长的输入序列长度允许LSTM更好地了解历史趋势，但当输入序列长度变得过长时，模型的训练会变得过于复杂，并且模型无法很好地拟合预测数据。</p><h2 id="140d" class="ns ln iq bd lo nt nu dn ls nv nw dp lw kx nx ny ly lb nz oa ma lf ob oc mc iw bi translated">常规LSTM和CNN LSTM:100大产品</h2><p id="414d" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">我们探究了常规的LSTM和CNN LSTM在100大产品上的表现。结果如下图所示。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi og"><img src="../Images/5ec63e2729b31871a8f8bcd3fc3fe536.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/0*3LNPSIJc5uIqUqIb"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图15:常规LSTM百强产品的结果(</em>图片由作者提供)</p></figure><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi og"><img src="../Images/803c7463a007b67d12ca277b5040dc5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/0*WV29yKUOThNPQkxH"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图16:CNN-LSTM 100强产品结果(</em>图片由作者提供)</p></figure><p id="fd9e" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">如上图所示，在预测前100种产品的需求时，常规的LSTM和CNN-LSTM都比没有在线培训的基准(28天移动平均线)差得多。然而，常规的LSTM和CNN-LSTM都能够在在线培训后实现接近基准(28天移动平均线)的MAE表现。这可能是因为在线训练允许用新数据更新先前训练的模型，从而提高其性能。</p><h2 id="b180" class="ns ln iq bd lo nt nu dn ls nv nw dp lw kx nx ny ly lb nz oa ma lf ob oc mc iw bi translated">常规LSTM和CNN LSTM:前3000名产品</h2><p id="6f92" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">我们探讨了常规LSTM和CNN LSTM对前3000名产品的表现。结果如下图所示。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/5b5f66975cd42c1b5875c01357528ceb.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/0*TXWPy3BPcPYIEYyG"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图17:常规LSTM 3000强产品的结果(</em>图片由作者提供)</p></figure><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/62e0f9e61f35ed3ed2ba4b83ed803787.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/0*pih-WLs-PKGyr9vs"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图18:CNN LSTM 3000强产品结果(</em>图片由作者提供)</p></figure><p id="cb79" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">如上图所示，在预测前3000种产品的需求时，与前100种产品的需求相似，常规的LSTM和CNN-LSTM都比没有在线培训的基准(28天移动平均线)差得多。</p><p id="0947" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">然而，在线培训后，常规的LSTM和CNN-LSTM都能够在1-2周内实现优于基准(28天移动平均线)的MAE表现，而在2周后实现差于基准的MAE表现。这可能是因为在线训练允许用新数据更新先前训练的模型，从而提高其性能。</p><h1 id="2491" class="lm ln iq bd lo lp lq lr ls lt lu lv lw kf lx kg ly ki lz kj ma kl mb km mc md bi translated">自回归LSTM</h1><p id="0bd5" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">我们选择实施自回归LSTM (AR-LSTM)，因为这可能是一个优雅的问题解决方案。AR-LSTM为一种产品获取10个时间步长(即10周)的数据，然后预测第11周的销售量。由于许多特性取决于售出的单位，因此第11周的预测用于生成特性，作为第12周预测的输入。这种特性工程是在训练和测试期间动态进行的。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi oi"><img src="../Images/a49dbbcfb7ffd23ac615bf1c7741e891.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BZOWYc7OABkJo9Q7"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated">图19:显示自回归LSTM过程的图表。(图片由作者提供)</p></figure><p id="6fcd" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">由于LSTM无法处理NaN值，我们向前填充每个产品的值，然后用零填充剩余的NaN(即在产品生命周期开始时没有先前数据的NaN)。在评估期间，我们删除了这些填充的值，以确保模型不会根据填充的值进行评估。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/f40dc441551314b0ec6cf69e6073a21f.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/0*tTZnPdxF4Rl7vPQp"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图20:前100名产品的结果(</em>图片由作者提供)</p></figure><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/06b737ec1479b141f09ac84f8c7b50c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/0*lFAds5ZWkR3orCMq"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图21:3000强产品的结果(</em>图片由作者提供)</p></figure><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/a18b79f7ffa22af04011a1f723e2a03b.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/0*nF12wCCjFtuEDfGn"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图22:所有产品的结果(</em>图片由作者提供)</p></figure><p id="905f" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们在下面看到，AR-LSTM的结果随着产品数量的增加而改善。人们可能会凭直觉认为，用更多产品训练的模型表现更好，因为它在大多数时候预测的值要低得多。但是，预测值和真实值的直方图显示，预测值的分布通常相互匹配。相反，它还表明该模型没有尽可能多地预测接近于零的值。这可能是由于损失函数是均方误差，并且较低的损失不会像较高的损失那样受到惩罚。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi ok"><img src="../Images/5cfb7b830c24145020053431db19b19c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0yCF9TwIqRZfKEvT"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图23:所有产品的预测直方图和预测标签(</em>作者图片)</p></figure><h1 id="7e71" class="lm ln iq bd lo lp lq lr ls lt lu lv lw kf lx kg ly ki lz kj ma kl mb km mc md bi translated">单个模型的结果汇总</h1><p id="5ff0" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">下表总结了各个模型在预测前100名产品和前3000名产品方面的性能。</p><p id="95c6" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">一般来说，与前3000个产品相比，我们的模型对前100个产品的改进更为适度。一种解释可能是，模型有更多的数据和产品可供训练，因此产品之间和品牌内部有更好的迁移学习。此外，另一个起作用的因素可能是，前100名中的这些高销量产品比低销量产品具有更稳定的销售，因此28天移动平均线是对这些产品未来需求的相当好的预测，因此基准预测更难改进。事实上，前100名产品基准的MAEs远低于前3000名产品的MAEs，这意味着该基准是前100名产品与前3000名产品的更好预测器。</p><p id="0131" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">请注意，下表中以浅绿色突出显示的单元格代表特定一周的最低(即最佳)MAE。单个模型的预测将在下一步被输入到集合模型中，以结合我们不同模型的优势。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi ol"><img src="../Images/73daf578ef85a7027c821d96c891754f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*klqQESK8aIEzYti3xv_30A.png"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">表1:前100名产品的结果(</em>图片由作者提供)</p></figure><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi ol"><img src="../Images/c7e2ac4e1612f344250716b613a565e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GBDe_TIEQzQFm-JXs4o9Ww.png"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">表2:3000种顶级产品的结果(</em>图片由作者提供)</p></figure><h1 id="425c" class="lm ln iq bd lo lp lq lr ls lt lu lv lw kf lx kg ly ki lz kj ma kl mb km mc md bi translated">集合模型</h1><p id="3fde" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">我们方法的最后一步是结合不同模型的优势。在这个时间点，我们有4个不同的模型在每个时间步产生4个不同的预测，我们希望有一个统一的方法来组合各种预测。拥有一个集成学习方法将允许我们拥有一个集中的预处理、训练和微调API。此外，由于一些模型在时间序列之间的迁移学习方面比其他模型更强——我们可以在跨模型比较前100名产品和前3000名产品的性能时看到这一点——组合不同的模型将是有帮助的。</p><p id="bbd7" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们希望集合模型能够缩小某个模型优于另一个模型的情况。因此，我们希望不同模型的“权重”是动态的。</p><p id="229d" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">从非动态聚合模型切换到动态聚合模型:</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi om"><img src="../Images/bd477f8470eb042f8529992fce84a5e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k7H0E0RBi4xzGATYghEa2w.png"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz"> ( </em>图片作者)</p></figure><p id="e4fe" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">因此，第一步将是在0级模型(即下面描述的“聚集模型”)的不同预测上训练元模型，并添加一些元特征以给出关于我们正在预测的当前点的一些元信息(关于该方法的详细描述，请参考<em class="lk">特征加权线性叠加，Sill等人</em>)。</p><p id="992f" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">第二步是选择我们想要使用的实际元模型。通常的方法是利用线性模型的可解释性。然而，线性模型的基本假设是不同的预测因子是相互独立的。因此，分配给不同的0级模型的权重不能依赖于当前时间。因此，我们决定使用随机森林模型。最后，我们也将使用黑盒解释方法来推断集合模型是如何做出预测的。</p><p id="99fc" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="kq ja">元特性</strong>:我们使用的元特性被称为‘元’,因为我们不希望它们包含任何定量信息，例如它们只包含当前季节、年份、产品和供应商的信息。使用这些元特征，我们期望随机森林(RF)分类器能够拾取不同的模型。</p><p id="3402" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="kq ja">聚合模型</strong>:我们利用来自以下模型的预测:Tuned XGBoost、AR-LSTM、LSTM、CNN LSTM和Benchmark。</p><p id="f6c3" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="kq ja">培训程序</strong>:对于这一步，我们设计了2021年3月1日的培训-验证拆分和2021年5月1日的验证-测试拆分。我们设计了两种不同的培训程序，一种用于非在线培训(nOT ),一种用于在线培训(OT)。</p><ul class=""><li id="ac20" class="nc nd iq kq b kr ks ku kv kx ne lb nf lf ng lj nh ni nj nk bi translated"><strong class="kq ja"> <em class="lk">非在线训练</em></strong>:0级模型首先在训练集上进行训练，然后在验证集上进行预测。然后，我们在训练+验证上重新训练，并在测试集上预测。然后，元模型在验证集上被训练，并在测试集上被测试。</li><li id="22f6" class="nc nd iq kq b kr nl ku nm kx nn lb no lf np lj nh ni nj nk bi translated"><strong class="kq ja"> <em class="lk">在线训练</em> </strong>:首先在训练集上对0级模型进行训练，然后在验证集上进行预测。然后，我们再培训那些培训+验证。元模型已经在验证集上进行了训练。然后，0级模型都在测试集上进行在线训练，元模型在不同的0级模型之上进行在线训练。</li></ul><p id="3b6b" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="kq ja">调谐程序</strong>:</p><ul class=""><li id="c63e" class="nc nd iq kq b kr ks ku kv kx ne lb nf lf ng lj nh ni nj nk bi translated"><strong class="kq ja"> <em class="lk">消融研究</em> </strong>:为了仅在“强”模型上训练元模型，我们执行消融研究，以便在对整个测试集进行1周到8周的预测时，仅从模型中选择对降低整体MAE有显著贡献的预测。这个过程是在验证集上运行的，我们将验证集分成两部分(并用来自训练集的数据填充训练部分)。</li><li id="449b" class="nc nd iq kq b kr nl ku nm kx nn lb no lf np lj nh ni nj nk bi translated"><strong class="kq ja"> <em class="lk">嵌入式超参数(HP)调整</em> </strong> <em class="lk"> : </em>随机森林分类器模型的每一次训练都利用了对4个关键超参数的超参数调整:树的数量、生长的树的最大深度、分裂节点的最小点数和叶子中的最小点数。超参数调整过程利用贝叶斯优化(BO)来加速该过程并更有效地搜索参数空间。</li></ul><h2 id="9b6a" class="ns ln iq bd lo nt nu dn ls nv nw dp lw kx nx ny ly lb nz oa ma lf ob oc mc iw bi translated">集合模型:前100名产品</h2><ul class=""><li id="50a3" class="nc nd iq kq b kr me ku mf kx on lb oo lf op lj nh ni nj nk bi translated"><em class="lk">消融研究</em>:在160，000种组合中，我们可以尝试约40，000种组合，并选择预测因子的最佳子集。所选择的特征是prediction_XGBoost、prediction_CNNLSTM、vendor_name_encoded、自品牌发布以来的时间、基准和一些其他时间特征。这一步骤有助于显著降低MAE。</li><li id="7b51" class="nc nd iq kq b kr nl ku nm kx nn lb no lf np lj nh ni nj nk bi translated"><em class="lk">嵌入式超参数调整</em>:贝叶斯优化算法探索了插入的max_depth和min_sample_split范围的下端。树的数量是我们指定的一组离散值。</li></ul><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi nb"><img src="../Images/d22ecff10a0a4c9e212be792d4ad1d85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*meMGNth7rD-S6viB"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图24:惠普调优仪表板的可视化(</em>图片由作者提供)</p></figure><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi oq"><img src="../Images/7db8cef1383c5ad30f07facb593dfca8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KsbQpEKdrDNnbAnfL270SQ.png"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">表3:消融研究和嵌入式惠普调整后前100名产品的整体模型结果(</em>图片由作者提供)</p></figure><p id="9ebb" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">如上面的表3所示，集合模型在所有预测周内都明显优于所有其他模型<em class="lk"/>。这证实了我们的直觉，即集合模型能够获得不同产品和供应商的不同模型的不同优势。具有在线培训、消融研究和HP调整的集合模型是产生最佳结果的模型。</p><h2 id="a9f9" class="ns ln iq bd lo nt nu dn ls nv nw dp lw kx nx ny ly lb nz oa ma lf ob oc mc iw bi translated">集合模型:前3000名产品</h2><p id="e127" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">使用前3000种产品运行管道的计算成本更高，因此无法进行全面的消融研究或惠普调整程序。这里，结果使用所有20个特征和随机森林分类器的默认超参数。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi oq"><img src="../Images/a02ade520aa97ceacad7c50c7b73fc5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L3rHMl_GlcSVhgjkkIGiDA.png"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">表4:前3000种产品的整体模型结果，无消融研究，无嵌入式惠普调整(</em>图片由作者提供)</p></figure><p id="2411" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这里要观察的一点是，前3000个产品上的默认集合模型(非在线训练)优于前100个产品上的优化模型(非在线训练)。对于前100名产品的模型，采用嵌入式HP调整的消融研究显著提高了分类器的性能。因此，我们相信，在排名前3000的产品上以正确的方式调整集合模型将会产生更好的结果。</p><p id="6f4e" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="kq ja">集合模型解释</strong> : <em class="lk"> </em>如前所述，我们故意使用不可解释的模型，以便预测依赖于所有特征的值。然而，随机森林模型并不受益于可解释的机制。因此，我们使用了SHAP模型，<em class="lk">一个统一的方法来解释模型预测，伦德伯格等人。艾尔。</em>，以便了解执行预测时使用了哪些特征。在这里，我们将SHAP模型用于前100名产品的集合模型、消融后研究和超参数调整后。</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi or"><img src="../Images/d1c51c2a83dcacd9ef7c3d70ba51bdea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/0*TKwF6j5rLGbOtvyS"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz">图25:100强模型的全球SHAP值结果(</em>图片由作者提供)</p></figure><p id="6011" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">SHAP值背后的直觉是，给定要预测的实例x，我们训练局部线性模型来近似我们的(黑盒，这里是随机森林)模型的输出:</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi os"><img src="../Images/8222d9dc4eba95477d928f45f9bfe7de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ivTVpVOhw5HS12lLnLkpKA.png"/></div></div><p class="mv mw gj gh gi mx my bd b be z dk translated"><em class="mz"> ( </em>图片作者)</p></figure><p id="8e02" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">图25中的图是整个训练集的所有SHAP值的集合，其中不同的特征按照特征重要性排序(参见<em class="lk"> Lundberg等人。艾尔。</em>对特征重要性的定义)。我们可以从这个数字中得出一些结论:</p><ol class=""><li id="2502" class="nc nd iq kq b kr ks ku kv kx ne lb nf lf ng lj nq ni nj nk bi translated">随机森林最重要的特征是基准。这抓住了我们的直觉:即使我们构建了不同的模型来预测未来的价值，基准模型将始终“产生”非常接近实际价值的结果。</li><li id="cd3c" class="nc nd iq kq b kr nl ku nm kx nn lb no lf np lj nq ni nj nk bi translated">CNN-LSTM的预测比XGboost的预测用得多。这表明，在这种情况下，CNN-LSTM能够更有效地获取前100名产品的需求。</li><li id="c08a" class="nc nd iq kq b kr nl ku nm kx nn lb no lf np lj nq ni nj nk bi translated">编码的供应商名称具有很高的特性重要性，这意味着当删除时，性能会显著下降。这证实了我们最初的观点，即随机森林模型比不同的模型具有更强的性能，因为它了解模型对于不同产品和品牌的优势。</li><li id="9ca3" class="nc nd iq kq b kr nl ku nm kx nn lb no lf np lj nq ni nj nk bi translated">实施的不同模型以正确的方式捕捉了趋势:当它们的值低时，它们的Shapley值是负的。这意味着当模型的输出与其平均值相比较低时，其预测对缺口y(x，t)- y的影响是负的；这将降低输出的价值。</li></ol><h1 id="e8bc" class="lm ln iq bd lo lp lq lr ls lt lu lv lw kf lx kg ly ki lz kj ma kl mb km mc md bi translated">未来的工作</h1><p id="0292" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">在我们的项目结束后，我们项目的下一步包括以下内容。</p><p id="5b56" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在这个项目中，我们实现了前3000种产品的面板预测模型。对于项目的下一个开发阶段，我们可以将其扩展到包括整个产品集的预测，以使模型更加全面。</p><p id="ca02" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">此外，针对整体模型，我们对前100种产品进行了全面的消融研究和超参数调整。在项目的下一阶段，我们可以将其扩展到前3000个产品，并随后扩展到整个产品集。这将有可能让我们在更全面的产品组合中实现出色的表现。</p><h1 id="267b" class="lm ln iq bd lo lp lq lr ls lt lu lv lw kf lx kg ly ki lz kj ma kl mb km mc md bi translated"><strong class="ak">参考文献</strong></h1><p id="afe5" class="pw-post-body-paragraph ko kp iq kq b kr me ka kt ku mf kd kw kx mg kz la lb mh ld le lf mi lh li lj ij bi translated">南任、崔天凯、刘，“基于面板数据的粒子滤波模型在服装销售预测中的应用”，载于《IEEE系统、人与控制论汇刊:系统》，第45卷，第3期，第411-421页，2015年3月，doi:10.1109/台积电，2014年12月。40316.63636363616</p><p id="ea0e" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">R.Ghanbari和K. Borna，“使用LSTM神经网络的多变量时间序列预测”，2021年第26届国际计算机会议，伊朗计算机学会(CSICC)，2021，第1–5页，doi:10.1109/csicc 52101 . 53686766676</p><p id="865f" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">Y.王，郭，“基于和XGBoost混合模型的股市波动时间序列预测方法”，载《中国交通》，第17卷第3期，第205-221页，2020年3月，doi: 10.23919/JCC.2020.03.017</p><p id="0e5f" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">J.Sill，G. Takacs，L. Mackey和D. Lin，“特征加权线性叠加”，arXiv.org，2019年11月，arXiv: 0911.0460</p><p id="434e" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">南Lundberg，S. Lee，“解释模型预测的统一方法”，arXiv.org，2017年11月，arXiv: 1705.07874</p></div></div>    
</body>
</html>