# 让我们通过大量的例子来学习列表理解:高效的 Python 编程

> 原文：[https://towardsdatascience.com/lets-learn-list-comprehension-with-a-lots-of-examples-efficient-python-programming-98fb41813d7?source=collection_archive---------28-----------------------#2021-10-26](https://towardsdatascience.com/lets-learn-list-comprehension-with-a-lots-of-examples-efficient-python-programming-98fb41813d7?source=collection_archive---------28-----------------------#2021-10-26)

![](../Images/00097b66f0318f44eb3c648c5cfd9480.png)

托尔比约恩·赫尔格森在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

## 让您的 Python 代码更紧凑、更快速

列表理解是一种在列表或字符串上编写 for 循环的简洁方法。使用列表理解来执行列表或字符串的每个元素的动作并生成新列表是非常容易、简短和紧凑的。通常我们用 for 循环来实现。做列表理解是写“for 循环”的一种相对更快更短的方式。我假设你已经了解初级 python 编程。

在这篇文章中，我将用大量的例子来解释列表理解，从最简单的例子开始，一直到更复杂的问题。

让我们首先创建一个简单的数字列表:

```
digits = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
```

让我们制作一个新的列表，包括数字列表中每个元素的平方。我将首先使用一个常规的 for 循环，然后使用一个 list comprehension。

下面是常规的 for 循环:

> 示例 1:

```
numbers = []for i in digits:
    numbers.append(i**2)

print(numbers)
```

输出:

```
[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]
```

现在用一个列表理解同样的事情:

```
[i**2 for i in digits]
```

输出:

```
[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]
```

如你所见，我只写了一行简单的代码，而不是 4 行代码。

> 示例 2:

我会把上面‘数字’列表的所有偶数都分出来，做一个新的列表。

```
numbers = []for i in digits:
    if i%2 ==0:
        numbers.append(i/2)

print(numbers)
```

输出:

```
[0.0, 1.0, 2.0, 3.0, 4.0]
```

这里，我们必须使用额外的“if 语句”来检查数字是否是偶数。下面是如何在列表理解中做同样的事情:

```
[i/2 for i in digits if i%2 ==0]
```

输出:

```
[0.0, 1.0, 2.0, 3.0, 4.0]
```

> 示例 3:

在这个例子中，我将把“digits”列表的偶数元素乘以 3，将奇数元素乘以 3，然后加 1，使其成为偶数。代码如下:

```
numbers = []
for i in digits:
    if i%2 ==0:
        numbers.append(3*i)
    else:
        numbers.append(3*i + 1)
print(numbers)
```

输出:

```
[0, 4, 6, 10, 12, 16, 18, 22, 24, 28]
```

在这个例子中，我们有一个 for 循环和一个 if-else 语句。具有列表理解的相同代码的实现:

```
[3*i if i%2 ==0 else 3*i + 1 for i in digits]
```

输出:

```
[0, 4, 6, 10, 12, 16, 18, 22, 24, 28]
```

> 示例 4:

我们可以在列表理解中使用内置函数。我将导入数学库，并在“数字”列表的所有元素中使用平方根函数:

```
import math
[math.sqrt(i) for i in digits]
```

输出:

```
[0.0,
 1.0,
 1.4142135623730951,
 1.7320508075688772,
 2.0,
 2.23606797749979,
 2.449489742783178,
 2.6457513110645907,
 2.8284271247461903,
 3.0]
```

> 示例 5:

这个例子将向你展示如何使用一个自定义函数，在列表的每个元素中使用它。首先，让我们定义一个函数，然后在“数字”列表中使用它:

```
def form(n):
    return 2**n - n**2[form(i) for i in digits]
```

输出:

```
[1, 1, 0, -1, 0, 7, 28, 79, 192, 431]
```

看，函数中的公式是如何变换每个数字的。我发现把数字本身和转换后的数字放在一起很有帮助。我们可以使用列表理解来生成元组，其中每个元组将包括数字本身和转换:

```
[(i, form(i)) for i in digits]
```

输出:

```
[(0, 1),
 (1, 1),
 (2, 0),
 (3, -1),
 (4, 0),
 (5, 7),
 (6, 28),
 (7, 79),
 (8, 192),
 (9, 431)]
```

除了元组，我们还可以使用集合:

```
[{i, form(i)} for i in digits]
```

输出:

```
[{0, 1},
 {1},
 {0, 2},
 {-1, 3},
 {0, 4},
 {5, 7},
 {6, 28},
 {7, 79},
 {8, 192},
 {9, 431}]
```

> 示例 6:

这个例子将处理一个嵌套的 for 循环。让我们写一个简单的嵌套 for 循环，然后我们将看到如何使用列表理解来完成它。

```
com = []for i in [3, 1, 4]:
    for j in [9, 0, 2]:
        com.append((i, j))
print(com)
```

输出:

```
[(3, 9), (3, 0), (3, 2), (1, 9), (1, 0), (1, 2), (4, 9), (4, 0), (4, 2)]
```

下面是使用嵌套 for 循环的列表理解的一行实现:

```
[(i, j) for i in [3, 1, 4] for j in [9, 0, 2]]
```

输出:

```
[(3, 9), (3, 0), (3, 2), (1, 9), (1, 0), (1, 2), (4, 9), (4, 0), (4, 2)]
```

> 示例 7:

我还想展示嵌套 for 循环的 if-else 语句的实现。这次我将检查例 6 的第一个列表是否是奇数。如果是奇数，我们将加 1，否则它将保持原样。

```
com = []for i in [3, 1, 4]:
    for j in [9, 0, 2]:
        if i%2 != 0:
            com.append((i+1, j))
        else:
            com.append((i, j))

print(com)
```

输出:

```
[(4, 9), (4, 0), (4, 2), (2, 9), (2, 0), (2, 2), (4, 9), (4, 0), (4, 2)]
```

下面是上面代码块的列表理解实现:

```
[(i+1, j) if i%2 !=0 else (i, j) for i in [3, 1, 4] for j in [9, 0, 2]]
```

输出:

```
[(4, 9), (4, 0), (4, 2), (2, 9), (2, 0), (2, 2), (4, 9), (4, 0), (4, 2)]
```

> 实施例 8:

在这个例子中，我将使用一个二维列表，并使用列表理解方法将其展平。

```
v = [[1, 3, 4], [2, 5, 6], [7, 5, 4]][i for elements in v for i in elements]
```

输出:

```
[1, 3, 4, 2, 5, 6, 7, 5, 4]
```

> 示例 9:

对于这个例子，我们也将采用一个二维列表，并将其旋转 90 度。这个例子在编码面试中非常流行。让我们先用常规的 for 循环来实现它，因为对于新程序员来说，它可能有点复杂:

```
td = [[1, 3, 4], 
      [2, 5, 6], 
      [7, 5, 4]]res = []for i in range(len(td)):
    el = []
    for j in td:
        el.append(j[i])
    res.append(el)

print(res)
```

输出:

```
[[1, 2, 7], [3, 5, 5], [4, 6, 4]]
```

下面是如何使用列表理解来做到这一点:

```
[[j[i] for j in td] for i in range(len(td))]
```

输出:

```
[[1, 2, 7], [3, 5, 5], [4, 6, 4]]
```

## 结论

希望这些例子对你学好列表理解有帮助。在编写大型应用程序时，找到改进代码的方法是很重要的。列表理解可以是压缩代码并使它们更快的方法之一。但是对于太复杂的代码来说，列表理解可能不是一个好主意。

欢迎在推特上关注我，喜欢我的 T2 脸书页面。

以下是本主题的视频版本，解释了相同的代码: