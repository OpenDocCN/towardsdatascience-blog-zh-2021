<html>
<head>
<title>Interactive Visualization with Plotly and Datapane</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Plotly和Datapane的交互式可视化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/interactive-visualization-with-plotly-and-datapane-97472017cb54?source=collection_archive---------15-----------------------#2021-09-24">https://towardsdatascience.com/interactive-visualization-with-plotly-and-datapane-97472017cb54?source=collection_archive---------15-----------------------#2021-09-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2a0f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Plotly和Datapane从您的可视化中获得更多</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/639b753b1b6819e162d403b11fec8a22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p23fG6RZV55_3x3ehGNeuw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Plotly中的交互式烛台图(图片由作者提供)</p></figure><p id="94d0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi lu translated">可视化是任何分析的一个重要方面。但是静态图限制了我们理解数据的能力。Plotly和Datapane解决了这个问题。</p><p id="85e6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本文将展示如何创建交互式烛台时序图来可视化比特币的价格。但是，所提供的代码很容易修改以支持其他时间序列数据。</p><p id="9a3b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这篇文章分成几个部分:</p><ol class=""><li id="d9c4" class="md me it la b lb lc le lf lh mf ll mg lp mh lt mi mj mk ml bi translated">用Alpha Vantage提取数据</li><li id="e7a8" class="md me it la b lb mm le mn lh mo ll mp lp mq lt mi mj mk ml bi translated">Matplotlib中静态图的比较</li><li id="48e9" class="md me it la b lb mm le mn lh mo ll mp lp mq lt mi mj mk ml bi translated">用Plotly和Datapane嵌入图</li><li id="0651" class="md me it la b lb mm le mn lh mo ll mp lp mq lt mi mj mk ml bi translated">具有高级功能的Plotly中的交互式绘图</li></ol><h1 id="7828" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">阿尔法优势</h1><p id="04d6" class="pw-post-body-paragraph ky kz it la b lb nj ju ld le nk jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">Alpha vantage是一个金融服务API，支持多种编程语言，包括Python、NodeJS、PDP、C#/。Net和许多其他语言。一个强大的开源社区已经为Alpha Vantage开发了超过600个跨越这些编程语言的库。</p><p id="3ed7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Alpha Vantage使程序员能够提取各种股票和加密货币的当天定价。该API易于使用，并允许很大的灵活性。因此，对于那些想要对大量数据进行回溯测试机器学习算法、创建可视化和执行财务分析的人来说，它是理想的选择。</p><p id="e1df" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你对在金融领域使用数据科学感兴趣，Alpha Vantage是一个完美的工具。</p><h2 id="87f1" class="no ms it bd mt np nq dn mx nr ns dp nb lh nt nu nd ll nv nw nf lp nx ny nh nz bi translated">要求</h2><p id="a6df" class="pw-post-body-paragraph ky kz it la b lb nj ju ld le nk jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">该工具需要一个个性化的API密钥来提取数据。注册一个免费帐户后就可以使用这个密钥，但是由于明显的原因，免费层中的呼叫次数是有限的。</p><p id="3ccf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">您收到的API密匙允许每分钟最多5个请求，每天最多500个请求</strong> —对于大量金融数据的实验来说绰绰有余。</p><p id="8ef1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是，如果您确实需要更多财务数据，请考虑高级选项。该选项还允许附加历史数据。对于希望用更多数据对模型进行回溯测试的用户来说，这个选项可能更好。</p><h2 id="98ea" class="no ms it bd mt np nq dn mx nr ns dp nb lh nt nu nd ll nv nw nf lp nx ny nh nz bi translated">提取数据</h2><p id="025e" class="pw-post-body-paragraph ky kz it la b lb nj ju ld le nk jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">对于本文，我将使用Python中的API。您将使用的主要功能可能是股票或加密的当天功能。</p><p id="a125" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，您可以使用相关的货币代码指定您选择的货币的价格。然后，使用interval命令设置数据间隔，其中选项为每分钟、5分钟、15分钟、30分钟或60分钟。</p><p id="7f76" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，输出大小决定了您想要接收多少数据。在这里，我使用完整的输出大小来获取尽可能多的信息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将比特币数据加载到DataFrame中(由作者编写代码)</p></figure><p id="4615" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">确保用API键替换API_KEY变量。</p><p id="d543" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">API返回元信息和价格信息。价格信息包括开盘价、收盘价、最高价和最低价。</p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h1 id="da4b" class="mr ms it bd mt mu oj mw mx my ok na nb jz ol ka nd kc om kd nf kf on kg nh ni bi translated">使用Matplotlib的静态图</h1><p id="28e4" class="pw-post-body-paragraph ky kz it la b lb nj ju ld le nk jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">python中最常见的绘图库可能是Matplotlib。它是许多python教程的主要内容，并被集成到许多包中。然而，它有一些明显的缺点。首先，您必须指定轴的范围。虽然这最初看起来不像是Matplotlib的一个突出的贬损者，但当更多的不稳定数据出现时，它就成了一个问题。</p><p id="7a89" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当时间序列发生变化时，您只能选择一个较短的时间段进行详细观察，或者查看一个更重要的时间段并查看整体趋势。</p><h2 id="4d98" class="no ms it bd mt np nq dn mx nr ns dp nb lh nt nu nd ll nv nw nf lp nx ny nh nz bi translated">mplfinance</h2><p id="4533" class="pw-post-body-paragraph ky kz it la b lb nj ju ld le nk jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">我已经通过使用“mplfinance”包展示了这一点。这个包是建立在Matplotlib之上的，可以很容易地创建蜡烛图。虽然易于设置和使用，但轴范围被设置为传递给函数的数据帧的总范围。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Matplotlib中的蜡烛图(作者代码)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/39492514a0017b6f6cf0718c1e0e4621.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CuEfMifVHG4FIWhMHqbo3Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基于Matplotlib的静态绘图(图由作者提供)</p></figure><p id="5306" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了正确地研究不同时期的数据，你必须重建整个图。虽然金融数据的焦点通常是最近的数据，但深入历史数据对于回溯测试算法至关重要。只有通过密切观察数据，你才能看到你的算法崩溃的场景。</p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h1 id="1e50" class="mr ms it bd mt mu oj mw mx my ok na nb jz ol ka nd kc om kd nf kf on kg nh ni bi translated">用数据面板嵌入图</h1><p id="6d84" class="pw-post-body-paragraph ky kz it la b lb nj ju ld le nk jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">Plotly是一个漂亮的库，默认情况下提供交互式绘图。然而，简单地将这些情节插入到文章中并不会自动允许交互性。</p><p id="1659" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">相反，可以使用Datapane来管理这些图。</p><p id="da9e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Datapane是一个开源的Python库，允许用户快速构建交互式绘图。此外，Datapane提供Datapane Studio，这是免费的，将使您能够上传公共和私人报告。</p><p id="083e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用Datapane的免费层，您可以使用电子邮件共享、无限公共报告托管和社交嵌入API创建五个私人报告。</p><p id="c5a0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本文使用社交嵌入API来展示Plotly图表。</p><p id="d33d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">注意:</strong> Plotly确实允许写入html，这样剧情的交互功能就可以持续。当您想保持交互方面的完整性时，将图发送给其他人时，此选项非常有用。</p><h2 id="4866" class="no ms it bd mt np nq dn mx nr ns dp nb lh nt nu nd ll nv nw nf lp nx ny nh nz bi translated">嵌入图</h2><p id="21ee" class="pw-post-body-paragraph ky kz it la b lb nj ju ld le nk jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">在数据面板上显示图表。首先安装Datapane。接下来，使用注册时收到的令牌登录Datapane。大概是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">初始化数据面板(由作者编写代码)</p></figure><p id="e0d6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">简单地创建一个Plotly图表，并用Datapane报告功能将报告上传到Datapane。这里，日期滑块被自动添加到绘图中，因为索引是日期时间类型。如果沿x轴看到日期时间值，则类型为字符串，并且无法生成日期滑块。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上传嵌入图表(作者代码)</p></figure><p id="ab5e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要确保报告正确集成到介质中，您必须设置一个集成令牌。然后将这个令牌保存到您的Datapane帐户。这里有一个简单的演练:</p><div class="op oq gp gr or os"><a href="https://docs.datapane.com/reports/publishing-and-sharing/export-to-medium" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">导出到介质</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">在介质上写很多？Datapane允许您将现有的Datapane报告转换为中等故事草稿，保留…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">docs.datapane.com</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg ks os"/></div></div></a></div></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h1 id="e409" class="mr ms it bd mt mu oj mw mx my ok na nb jz ol ka nd kc om kd nf kf on kg nh ni bi translated">与Plotly的互动情节</h1><p id="4011" class="pw-post-body-paragraph ky kz it la b lb nj ju ld le nk jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">默认情况下，Plotly允许用户动态调整绘图的轴范围。此外，默认图允许缩放、保存图、添加或删除迹线、双击重置图以及尖峰线切换。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基本绘图图(作者代码)</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ph ob l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基本Plotly时间序列(作者提供的图表)</p></figure><p id="1612" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然上面的图表无疑是一个进步，但还是有一些局限性。</p><p id="69e0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，虽然您可以放大多个周期，但y轴保持不变。不幸的是，默认图表的这个属性使得烛台图表变得毫无意义，因为蜡烛变平了。</p><p id="c821" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">经过深入研究，我发现可以在更新时动态更新y轴。这次更新需要对以前的情节做一些改动。</p><p id="2e34" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先是将图形对象导入从<strong class="la iu"><em class="pi">plotly . graph _ objects</em></strong>改为<strong class="la iu"> <em class="pi"> plotly_graph_obs </em> </strong>。接下来是将你的人物对象初始化为一个<strong class="la iu"> <em class="pi">人物小部件</em> </strong>而不仅仅是一个人物。该导入要求安装<strong class="la iu"> <em class="pi"> ipywidgets </em> </strong>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用活动Python内核动态调整Y轴(代码由作者编写)</p></figure><p id="f025" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第二个变化是取消了日期间隔。虽然比特币不需要这样做，但其他金融股票在时间序列上也有缺口。这种模式是由于市场关闭，可以掩盖情节。</p><p id="b2cd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了避免这个问题，不存在值的日期将被删除。首先，为整个范围生成一个日期列表以防止此问题。则不存在值的日期将被删除。然后轴被更新以反映该变化。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">删除日期差距代码(作者代码)</p></figure><p id="e271" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我做了最后的修改来改善烛台图:着色(使用seaborn主题)、格式改变和日期滑块按钮。这些更多的是生活质量的提高。由于日期滑块可能相当麻烦，日期按钮简化了日期范围的选择。</p><p id="abc5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">按钮遵循标准格式。“步骤”被指定为日期时间频率，如分钟、小时、天、月或年。那么“计数”被设置为指示范围的大小。这些按钮可以从日期时间图的起点或终点选择数据，支持自定义标签和自定义日期范围。</p><blockquote class="pj"><p id="e9de" class="pk pl it bd pm pn po pp pq pr ps lt dk translated">注意Datapane不支持上传FigureWidgets，chart-studio(来自Plotly的chart hosting)不提供内核来更新日期选择的y轴值。但是，在Jupyter笔记本中运行图表时，您可以看到动态的y轴变化。</p></blockquote><figure class="pt pu pv pw px kn"><div class="bz fp l di"><div class="oa ob l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">详细Plotly时间序列图的代码(作者代码)</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ph ob l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">改进了Plotly中的蜡烛图(图由作者提供)</p></figure></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h1 id="cbd9" class="mr ms it bd mt mu oj mw mx my ok na nb jz ol ka nd kc om kd nf kf on kg nh ni bi translated">最后的想法</h1><p id="10b9" class="pw-post-body-paragraph ky kz it la b lb nj ju ld le nk jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">当利益相关者需要从分析或初始数据调查中获得一些有形的输出时，在整个数据科学项目中使用可视化。</p><p id="25aa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，如果可视化工具过于死板，您可能会错过一些对数据的关键见解。交互式图表确保您的数据中令人兴奋的方面易于观察。</p><p id="1c3e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这篇文章中，使用了比特币数据。但应该清楚的是，交互式绘图的好处适用于数据科学的许多不同领域。</p><p id="57a5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些图有助于传达故事、传递信息，并帮助我们调查数据。</p><p id="b63d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Plotly提供了一个开箱即用的解决方案来实现绘图交互性。与Datapane结合，您可以将完全交互式的图发送给相关的利益相关者，并揭示数据的复杂性。</p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><p id="680f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你有兴趣阅读关于新颖的数据科学工具和理解机器学习算法的文章，可以考虑在Medium上关注我。</p><p id="831a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="pi">如果你对我的写作感兴趣，想直接支持我，请通过以下链接订阅。这个链接确保我会收到你的会员费的一部分。</em></p><div class="op oq gp gr or os"><a href="https://zjwarnes.medium.com/membership" rel="noopener follow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">通过我的推荐链接加入Medium-Zachary Warnes</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">阅读扎卡里·沃恩斯(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">zjwarnes.medium.com</p></div></div><div class="pb l"><div class="py l pd pe pf pb pg ks os"/></div></div></a></div></div></div>    
</body>
</html>