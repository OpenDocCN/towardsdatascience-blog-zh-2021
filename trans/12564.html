<html>
<head>
<title>In modelling, the first steps are the hardest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在建模中，第一步是最难的</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/in-modelling-the-first-steps-are-the-hardest-a4250b80a0f2?source=collection_archive---------14-----------------------#2021-12-24">https://towardsdatascience.com/in-modelling-the-first-steps-are-the-hardest-a4250b80a0f2?source=collection_archive---------14-----------------------#2021-12-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6717" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">以及为什么它们会影响你的其他工作</h2></div><p id="b1f3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi lb translated">我已经在之前的博客中展示过<a class="ae lk" href="https://www.linkedin.com/posts/dr-marc-jacobs-885b1430_waarom-we-nog-niet-kunnen-zeggen-dat-de-activity-6879787496541077504-jm6F" rel="noopener ugc nofollow" target="_blank">模特天生缺乏安全感</a>，培养这种不安全感很重要。我也已经提到过<a class="ae lk" href="https://medium.com/@marc.jacobs012/why-science-is-beautifully-human-and-very-frail-4f6225d32bb0" rel="noopener">科学是流动的</a>，机遇是有条件的。总之，这意味着事实核查是无用的，因为“事实”从属于当前的知识和依赖于其他机会的机会。因此，只有在您非常清楚这些组是谁的情况下，才可能按组对策略进行分类。因此，基于单一变量的指数化是极不可能的，当然也是极不可取的。</p><p id="4e32" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">今天我想说的是，对于建模来说，最后一段并不是最难的。不，这只是第一步。当你开始做一个模型的时候，很重要的一点就是要快速明确你要建模什么，为什么要建模。想要“快”有时会妨碍过程，因为你一直在做假设。重要的是你让它们有多重要，尤其是在数据很少的情况下。此外，重要的不是数据量，而是数据是如何创建的。</p><p id="ced4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们中的许多人都是从数据集开始的，当我们谈论第一步时，我们谈论的是基于数据集创建第一个模型。对于新冠肺炎病毒，情况略有不同。数据每天都有，而正是你的模型在初始阶段的目标决定了行动。矛盾的是，甚至可能是这样的情况，开始时的不确定性决定了未来的进程，因为对病毒的反应也会影响病毒。例如，很有可能在一个模型中使用不同的初始假设会导致不同的政策，从而导致不同的过程。</p><p id="2ac5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所有这些现在都是桥下溢出的水，但重要的是要认识到每个模型都是脆弱的，尤其是在开始的时候。</p><p id="2bbb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">看看下面的指数曲线就知道了:</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ll"><img src="../Images/496b90cf369fc5d3b9b7beedbd074b2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dZvxkA5-mlkj5VwntFI9lQ.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">图片作者。</p></figure><p id="bbb7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这种图表的危险之处在于，这里的数据已经相当先进了。先进到足以发布指数曲线(y ~ b1*(1+b2)^x).即使你不确定公式的系数，数据也足以找到系数并画出曲线。换句话说，当你在这个阶段收集数据时，你很清楚你在看什么。</p><pre class="lm ln lo lp gt mb mc md me aw mf bi"><span id="3735" class="mg mh iq mc b gy mi mj l mk ml">library(brms)<br/>library(tidyverse)<br/>library(cmdstanr)<br/>library(kinfitr)<br/>library(nls.multstart)<br/>library(nlme)<br/>library(hrbrthemes)<br/>library(broom)<br/>library(viridis)<br/>library(epifitter)<br/>library(nls2)<br/>library(nlstools)<br/>library(lattice)<br/>library(bayesrules)<br/>library(tidyverse)<br/>library(janitor)<br/>library(rstanarm)<br/>library(bayesplot)<br/>library(tidybayes)<br/>library(broom.mixed)<br/>library(modelr)<br/>library(e1071)<br/>library(forcats)<br/>library(grid)<br/>library(gridExtra)<br/>library(fitdistrplus)<br/>library(ggpubr)</span><span id="29b8" class="mg mh iq mc b gy mm mj l mk ml">set.seed(1123)<br/>b &lt;- c(10, 3<br/>x &lt;- rnorm(200)<br/>y &lt;- rnorm(200, mean = b[1]*(1+(b[2])^x), sd=15)<br/>dat1 &lt;- data.frame(x, y)<br/>plot(dat1$x,dat1$y)<br/><br/>prior1 &lt;- prior(normal(10,30), nlpar = "b1") +<br/>  prior(normal(4, 16), nlpar = "b2")<br/>fit1 &lt;- brm(bf(y ~ b1*(1+b2)^x, b1 + b2 ~ 1, nl = TRUE),<br/>            data ​= dat1, <br/>            prior = prior1,<br/>            sample_prior = T,<br/>            chains=4,<br/>            cores = getOption("mc.cores", 8),<br/>            threads =16, <br/>            backend="cmdstanr")<br/>summary(fit1)<br/>plot(fit1)<br/>plot(conditional_effects(fit1), <br/>     points = TRUE,<br/>     rug=TRUE,<br/>     theme=theme_bw()))<br/><br/>dat1 %&gt;<br/>  add_fitted_draws(fit1, n = 150) %&gt;%<br/>  ggplot(aes(x = x, y = y)) +<br/>  geom_line(aes(y = .value, group = .draw), alpha = 0.05) + <br/>  geom_point(data = dat1, size = 0.05)+theme_bw()<br/><br/>dat1 %&gt;%<br/>  add_predicted_draws(fit1, ndraws = 4) %&gt;%<br/>  ggplot(aes(x = x, y = y)) +<br/>  geom_point(color="black", alpha=0.2)+<br/>  geom_point(aes(x = x, <br/>                 y = .prediction, <br/>                 group = .draw, colour=((y-.prediction)))) +<br/>  facet_wrap(~ .draw) + theme_bw()</span></pre><div class="lm ln lo lp gt ab cb"><figure class="mn lq mo mp mq mr ms paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><img src="../Images/d6be58b87420f704621f824a4da8a1af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*eWFGzAT64wJxJzCeKTpuDQ.png"/></div></figure><figure class="mn lq mo mp mq mr ms paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><img src="../Images/0009fd4f29b60a015daa0063e89ec05d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*CZ5VRJkpH6UWK9iKDehQyQ.png"/></div><p class="lx ly gj gh gi lz ma bd b be z dk mt di mu mv translated">图片作者。</p></figure></div><p id="2a0a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，如果您的数据没有超出最开始的范围呢？如果我只是删除一些数据，然后重新参数化模型呢？不难看出，在这个阶段我知道的很少，当我试图推断我的模型时，我会到处去。因为我做的模型是贝叶斯模型，先验现在占了大部分权重，曲线看起来是指数型的。，但这一切都是基于假设。</p><div class="lm ln lo lp gt ab cb"><figure class="mn lq mw mp mq mr ms paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><img src="../Images/ec87ecdb3c510dbec4c87a42c4a29427.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*iwpJ75o9ysEnvLvZyZbfQQ.png"/></div></figure><figure class="mn lq mx mp mq mr ms paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><img src="../Images/2caa8889ff8adc328005a455d124b290.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*6gMjyrU3wNNOO4zh0zp9LQ.png"/></div></figure><figure class="mn lq mx mp mq mr ms paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><img src="../Images/9045f3c2f047f3e11eab76ee3432961e.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*iO-h_P_FFcrFRBJShVDSKQ.png"/></div><p class="lx ly gj gh gi lz ma bd b be z dk my di mz mv translated">图片作者。</p></figure></div><p id="3ef8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上图显示了基于不完整数据以及整个数据集的假设轨迹。两种情况都有可能。甚至有一个超出想象的预测，这是先验与可能性无关的明显标志。</p><p id="91dc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi lb translated">我想展示的另一个例子是基于 Gompertz 曲线。Gompertz 公式如下所示，用于许多过程。例如，在 Gompertz 中可以捕捉到一个人的成长，也可以捕捉到一头猪的成长。它还有助于监测病毒感染，因此在下文中，它已被用于捕捉对“英国变种”增长的估计。我关心的是模型估计，它远远超出了萌芽监测的观察结果。用贝叶斯术语来说——先验 far 否决了可能性。这不是一个问题，因为当我们说话的时候数据正在进来，但是它确实保证持续更新。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi na"><img src="../Images/7d410605a02894d2233f442438a8140c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UHa3DK7mC68J6dQQBjGCIQ.jpeg"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">图片来源:<br/>国家公共卫生与环境研究所；<em class="nb">厚生劳动省。</em></p></figure><p id="904c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从建模的角度来看，上图实际上是不可能的，因为数据甚至没有越过拐点。拐点是递增增长和递减增长的分界线。现在的情况是，图表非常清楚地表明红色曲线来自一个模型，但它没有说明该模型是基于哪个数据产生的。我们不知道先前的假设。</p><p id="aa2f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我模拟数据来说明我的意思。</p><pre class="lm ln lo lp gt mb mc md me aw mf bi"><span id="9421" class="mg mh iq mc b gy mi mj l mk ml">dat&lt;-sim_gompertz(N  = 10<br/>                  dt = 0.5, <br/>                  y0 = 0.01, <br/>                  r  = 0.07, <br/>                  K  = 1, <br/>                  n  = 20,  <br/>                  alpha = 1)<br/>dat&lt;-as.data.frame(dat)<br/>plot(dat$time, dat$random_y)<br/><br/>g1&lt;-ggplot(dat, aes(x=time))+<br/>  geom_line(aes(y=y)) +<br/>  geom_point(aes(y=random_y), color="grey", alpha=0.2)+<br/>  labs(title="Gompertz Curve", <br/>       x="Total time course of the epidemic", <br/>       y="Disease Intensity")+theme_bw()<br/><br/>g2&lt;-ggplot(dat, aes(x=time))+<br/>  geom_boxplot(aes(y=random_y, group=time), color="grey", alpha=0.2)+<br/>  geom_line(aes(y=y)) +<br/>  labs(title="Gompertz Curve", <br/>       x="Total time course of the epidemic", <br/>       y="Disease Intensity")+theme_bw()<br/><br/>g3&lt;-ggplot(dat, aes(x=time, y=random_y))+<br/>  stat_summary(fun.data = "mean_cl_boot", colour = "black", size = 0.2)+<br/>  geom_smooth(color="red", alpha=0.5)+<br/>  labs(title="GAM model", <br/>       x="Total time course of the epidemic", <br/>       y="Disease Intensity")+theme_bw()<br/><br/>g4&lt;-ggplot(dat, aes(x=time, y=random_y))+<br/>  geom_point(color="black", alpha=0.2)+<br/>  geom_smooth(aes(color=as.factor(replicates),<br/>              fill=as.factor(replicates)), alpha=0.2)+<br/>  facet_wrap(~replicates)+<br/>  labs(title="LOESS model", <br/>       x="Total time course of the epidemic", <br/>       y="Disease Intensity")+<br/>  theme_bw()+theme(legend.position = "none")<br/>ggarrange(g1,g2,g3,g4)</span></pre><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi nc"><img src="../Images/0421ccfda0f16edc525cd08fe1a95677.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sU0ZHNXkQk7-_HCz1pwusw.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">图片作者。</p></figure><p id="6759" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">左下方的图表可能最能说明我所说的模型和少量数据的含义。这个模型不是在 Gompertz 的基础上获得的，而是在 GAM 模型的基础上获得的，GAM 模型是一种观察数据的统计模型。如果我砍掉数据，直到左边只剩下很小一部分，GAM 就不会显示同样的曲线。基于 Gompertz 函数的非线性模型仍然可以做到这一点，但该模型必须基于许多假设。把它比作在一个黑暗的房间里预测一天的天气，只有微弱的光线指引你。</p><pre class="lm ln lo lp gt mb mc md me aw mf bi"><span id="6461" class="mg mh iq mc b gy mi mj l mk ml">dat&lt;-sim_gompertz(N  = 10<br/>                  dt = 0.5, <br/>                  y0 = 0.01, <br/>                  r  = 0.07, <br/>                  K  = 1, <br/>                  n  = 20,  <br/>                  alpha = 1)<br/>dat&lt;-as.data.frame(dat);dat$x&lt;-dat$tim<br/>fitgomp&lt;-fit_nlin2(time = dat$time,<br/>          y =  dat$y,<br/>          starting_par = list(y0 = 0.01, r = 0.07, K = 1),<br/>          maxiter = 1024)<br/>fitgomp<br/>g1&lt;-function(x,a,b,c){<br/>  a*exp(-b*exp(-c*x))<br/>}<br/>g2 &lt;- function(x, y0, ymax, k, lag){<br/>  y0+(ymax-y0)*exp(-exp(k*(lag-x)/(ymax-y0)+1))<br/>}<br/>g3&lt;-function(x,n0,nI,b){<br/>  n0*exp(log(nI/n0)*(1-exp(-b*x)))<br/>}<br/>plot(dat$x, dat$random_y)<br/>curve(g1(x, a=1, b=4.5, c=0.07), add=T, col="red", lwd=2) <br/>curve(g2(x, y0=0.01, ymax=1, k=0.07, lag=8), add=T, col="blue", lwd=2) <br/>curve(g3(x, n0=0.01,nI=1,b=0.07), add=T, col="orange", lwd=2)</span></pre><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi nd"><img src="../Images/999ac87eb3a6faa43b93869b0ecfab1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6IxjwcpOH8Zom-0G2Yl8ZQ.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">图片作者。</p></figure><p id="3b17" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">幸运的是，一旦模型收集了相当多的数据，它们就可以很好地处理不确定性。这里我将使用一个特定的非线性模型，它能够包含不确定性的来源。假设我们收集了前 20 个城市的数据。</p><pre class="lm ln lo lp gt mb mc md me aw mf bi"><span id="fc06" class="mg mh iq mc b gy mi mj l mk ml">dat_new&lt;-groupedData(random_y~time|replicates,<br/>                       data=dat,<br/>                       FUN=mean,<br/>                       labels=list(x="Time", y="Disease Intensity")) <br/>fit&lt;-nlme(random_y~n0*exp(log(nI/n0)*(1-exp(-r*time)))<br/>          data​=dat_new, <br/>          fixed=n0+nI+r~1, <br/>          random=r~1, <br/>          start=c(0.01,1,0.07),<br/>          method="ML", <br/>          control=nlmeControl(maxIter=100000, msMaxIter = 100))<br/>plot(augPred(fit, level=0:1))<br/>fitpreds &lt;- dat_new %&gt;% mutate(.fitted=predict(fit, newdata=dat_new))<br/>ggplot(dat_new, aes(x=time, y=random_y)) <br/>  geom_point() +<br/>  geom_line(data=fitpreds, aes(y=.fitted, <br/>                               group=replicates, <br/>                               colour=replicates),size=1) +theme_bw()+labs(title="NLS model",<br/>                                                  x="Total time course of the epidemic",<br/>                                                  y="Disease Intensity")</span></pre><div class="lm ln lo lp gt ab cb"><figure class="mn lq mo mp mq mr ms paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><img src="../Images/dedddb58a66952f6b1868703ea12f310.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*HGjNtjaHM-O57OLQ1vc0HA.png"/></div></figure><figure class="mn lq mo mp mq mr ms paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><img src="../Images/8e2de511779f2f62c0d33e67a3bfec2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*pOnRXBKBPHy_j9rsqZb5Ww.png"/></div><p class="lx ly gj gh gi lz ma bd b be z dk mt di mu mv translated">图片作者。</p></figure></div><p id="be94" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了更好地了解我们建模的不确定性，即使我们已经有了大量数据，我也会对相同的数据应用贝叶斯模型。</p><pre class="lm ln lo lp gt mb mc md me aw mf bi"><span id="f536" class="mg mh iq mc b gy mi mj l mk ml">gompprior &lt;- c<br/>  set_prior("beta(1, 20)",       nlpar = "n0", lb=0, ub=1),<br/>  set_prior("gamma(1, 1)",       nlpar = "nI", lb=0, ub=1),<br/>  set_prior("normal(0, 1)",      nlpar = "r",  lb=0), <br/>  set_prior("normal(0.05, 0.2)", class="sigma"))</span><span id="5302" class="mg mh iq mc b gy mm mj l mk ml">gomp_bayes &lt;- bf(random_y ~ n0*exp(log(nI/n0)*(1-exp(-r*time))),<br/>                             n0 + nI + r ~ 1,<br/>                             nl = TRUE)</span><span id="70d7" class="mg mh iq mc b gy mm mj l mk ml">options(mc.cores=parallel::detectCores())<br/>gomp_bayes_fit &lt;- brm(<br/>  gomp_bayes,<br/>  family=gaussian(), <br/>  data ​= dat_new,<br/>  prior = gompprior )<br/><br/>plot(gomp_bayes_fit)<br/>pairs(gomp_bayes_fit)<br/><br/><br/>predtimes &lt;- unique(dat_new$time)<br/>gomp_bayes_fitted &lt;- fitted(gomp_bayes_fit, <br/>                            newdata=list(time = predtimes))%&gt;%as_tibble()<br/>gomp_bayes_pred &lt;- predict(gomp_bayes_fit,<br/>                           newdata=list(time = predtimes))%&gt;%as_tibble()<br/>gomp_bayes_ribbons &lt;- tibble(<br/>  time = predtimes,<br/>  random_y=gomp_bayes_fitted$Estimate,<br/>  Estimate = gomp_bayes_fitted$Estimate,<br/>  pred_lower = gomp_bayes_pred$Q2.5,<br/>  pred_upper = gomp_bayes_pred$Q97.5,<br/>  fitted_lower = gomp_bayes_fitted$Q2.5,<br/>  fitted_upper = gomp_bayes_fitted$Q97.5)<br/>ggplot(dat_new, aes(x=time, y=random_y)) +<br/>  geom_point(size=2, alpha=0.2) +<br/>  geom_ribbon(data=gomp_bayes_ribbons, aes(ymin=pred_lower, ymax=pred_upper), <br/>              alpha=0.2, fill=colourcodes[3]) +<br/>  geom_ribbon(data=gomp_bayes_ribbons, aes(ymin=fitted_lower, ymax=fitted_upper), <br/>              alpha=0.5, fill=colourcodes[3]) +<br/>  geom_line(data=gomp_bayes_ribbons, aes(y=Estimate), colour=colourcodes[3], <br/>            size=1) + labs(title="Bayesian model", <br/>                           x="Total time course of the epidemic", <br/>                           y="Disease Intensity")+<br/>  theme_bw()+theme(legend.position = "none")</span></pre><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ll"><img src="../Images/20d458c51841ce1df60aac51485665b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*49G9f8XlKr-qWdhiF1qExQ.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">图片作者。</p></figure><p id="9fb0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从上图中可以看出，蓝色的模型线包含了相当多的不确定性。这也反映在下面各个参数的估计值中，以及参数之间的相关性中。重要的是要记住，模型预测强烈依赖于模型系数，而这些系数又依赖于数据和相互关系。假设驱动一个只有少量数据的模型。再一次，在贝叶斯分析中，我们接受这样的情况。</p><div class="lm ln lo lp gt ab cb"><figure class="mn lq ne mp mq mr ms paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><img src="../Images/8469ceca9d2477c457a0d1c3a732827f.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*RWiHRCrCEKNjqy9JXNrTdw.png"/></div></figure><figure class="mn lq nf mp mq mr ms paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><img src="../Images/23a979bfbe37d2c8115f85449dc0c791.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*W-OC6unSreAbM3EOV-bjsg.png"/></div><p class="lx ly gj gh gi lz ma bd b be z dk ng di nh mv translated">图片作者。</p></figure></div><p id="86d6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们像以前一样删除一些数据，会发生什么？那它看起来像什么？下面我要求的是严格限制天数，并用这些数据显示 Gompertz 曲线。我已经知道了那条曲线的参数，所以我对下限和上限的变化以及繁殖率感兴趣。</p><pre class="lm ln lo lp gt mb mc md me aw mf bi"><span id="8eab" class="mg mh iq mc b gy mi mj l mk ml">set.seed(1123<br/>dat&lt;-sim_gompertz(N  = 100,<br/>                  dt = 0.5, <br/>                  y0 = 0.01, <br/>                  r  = 0.07, <br/>                  K  = 1, <br/>                  n  = 20,  <br/>                  alpha = 1)<br/>dat&lt;-as.data.frame(dat);dat$x&lt;-dat$time<br/>dat_new&lt;-groupedData(random_y~time|replicates, <br/>                     data=dat,<br/>                     FUN=mean,<br/>                     labels=list(x="Time", y="Disease Intensity"))<br/>dat_new_1&lt;-dat_new%&gt;%filter(x&lt;10)%&gt;%mutate(random_y=replace(random_y,0,0.001))<br/>plot(dat_new_1$x,dat_new_1$random_y)<br/>fit&lt;-nlme(random_y~n0*exp(log(nI/n0)*(1-exp(-r*time))),<br/>          data​=dat_new_1, <br/>          fixed=n0+nI+r~1, <br/>          start=c(0.01,1,0.07),<br/>          method="ML", <br/>          control=nlmeControl(maxIter=100000, msMaxIter = 100)))</span></pre><p id="16f6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个模型不会运行，我也不能在数据上绘制一个假设的 Gompertz 曲线。</p><pre class="lm ln lo lp gt mb mc md me aw mf bi"><span id="7e7d" class="mg mh iq mc b gy mi mj l mk ml">ggplot(dat_new_1, aes(x=time, y=random_y)<br/>  geom_point(color="grey", alpha=0.2)+<br/>  stat_summary(fun.data = "mean_cl_boot", colour = "black", size = 0.2)+<br/>  stat_smooth(method = 'nls', formula = 'y ~ n0*exp(log(nI/n0)*(1-exp(-r*x)))',<br/>              method.args = list(start=c(n0=0.01,nI=1,r=0.07)), se=TRUE)+<br/>  geom_smooth(color="red",fill="red", alpha=0.2)+<br/>  labs(title="GAM model", <br/>       x="Total time course of the epidemic", <br/>       y="Disease Intensity")+<br/>  theme_bw())</span></pre><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ni"><img src="../Images/f5cd06930807cbacabab1fa9d28d7414.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8tIRpzc4FAHvzBuHpmQVQg.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">图片作者。</p></figure><p id="e96e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在让我们看看，当我试图从现在的模型中推断未来时，会发生什么。毫无疑问，上面的红线是一个模型，它被训练成尽可能整齐地放置在数据之上。非线性函数通常不是这样的。它们的功能是从生物学和逻辑学的角度将起点和终点联系起来。然而，他们需要足够的数据来找到合适的系数。这就是我现在想做的，求系数。</p><pre class="lm ln lo lp gt mb mc md me aw mf bi"><span id="bcf3" class="mg mh iq mc b gy mi mj l mk ml">set_prior("beta(1, 20)",       nlpar = "n0", lb=0, ub=1),<br/>  set_prior("gamma(1, 1)",       nlpar = "nI", lb=0, ub=1),<br/>  set_prior("normal(0, 1)",      nlpar = "r",  lb=0), <br/>  set_prior("normal(0.05, 0.2)", class="sigma"))<br/><br/>gomp_bayes &lt;- bf(random_y ~ n0*exp(log(nI/n0)*(1-exp(-r*time))),<br/>                 n0 + nI + r ~ 1,<br/>                 nl = TRUE)<br/>options(mc.cores=parallel::detectCores())<br/><br/>gomp_bayes_fit &lt;- brm(<br/>  gomp_bayes,<br/>  family=gaussian(), <br/>  data ​= dat_new_1,<br/>  prior = gompprior )<br/>summary(gomp_bayes_fit)<br/>plot(gomp_bayes_fit)<br/>plot(conditional_effects(gomp_bayes_fit), <br/>     points = TRUE,<br/>     rug=TRUE,<br/>     theme=theme_bw()) <br/><br/>dat_new_1 %&gt;%<br/>  add_fitted_draws(gomp_bayes_fit, n = 150) %&gt;%<br/>  ggplot(aes(x = x, y = y)) +<br/>  geom_line(aes(y = .value, group = .draw), alpha = 0.05) + <br/>  geom_point(data = dat_new_1, size = 0.05)+theme_bw()+<br/>  labs(title="Bayesian Model overlayed on trained data",<br/>       x="Total time course of the epidemic",<br/>       y="Disease Intensity")<br/><br/>dat_new %&gt;%<br/>  add_fitted_draws(gomp_bayes_fit, n = 150) %&gt;%<br/>  ggplot(aes(x = x, y = y)) +<br/>  geom_vline(xintercept = 10, color="red", linetype=2)+<br/>  geom_line(aes(y = .value, group = .draw), alpha = 0.1) + <br/>  geom_point(data = dat_new, size = 0.05)+theme_bw()+<br/>  labs(title="Bayesian Model overlayed on all data",<br/>       x="Total time course of the epidemic",<br/>       y="Disease Intensity")</span></pre><p id="7e81" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">显而易见的是，结果提供了不同的参数。再现值从 0.07 到 0.09，估计线顶是 0.58 而不是 1。</p><pre class="lm ln lo lp gt mb mc md me aw mf bi"><span id="622b" class="mg mh iq mc b gy mi mj l mk ml">Family: gaussian<br/>  Links: mu = identity; sigma = identity <br/>Formula: random_y ~ n0 * exp(log(nI/n0) * (1 - exp(-r * time))) <br/>         n0 ~ 1<br/>         nI ~ 1<br/>         r ~ 1<br/>   Data: dat_new_1 (Number of observations: 400) <br/>  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;<br/>         total post-warmup draws = 4000<br/><br/><br/>Population-Level Effects: <br/>             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS<br/>n0_Intercept     0.01      0.00     0.01     0.02 1.01      833      662<br/>nI_Intercept     0.58      0.23     0.21     0.98 1.01      527      190<br/>r_Intercept      0.09      0.02     0.06     0.15 1.01      496      162<br/><br/><br/>Family Specific Parameters: <br/>      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS<br/>sigma     0.04      0.00     0.04     0.04 1.00     2006     1936<br/><br/><br/>Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS and Tail_ESS are effective sample size measures, and Rhat is the potential scale reduction factor on split chains (at convergence, Rhat = 1).</span></pre><p id="9f2f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">表格实际显示的内容可以通过三个视觉效果得到最好的解释。第一，基于数据的条件模型。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ni"><img src="../Images/fe9937590ec87bbf00253f6ae6273af5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bNfMXOA-uMdwrkGeRQjBYg.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">图片作者。</p></figure><p id="39be" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二，基于数据的可能性范围。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ni"><img src="../Images/98b8866ef7c50fc0ce4c72ac8fe9f52e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xaSUflF9QxvNR5xraH9CvA.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">图片作者。</p></figure><p id="d341" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第三，模型的外推覆盖了全部数据，但基于不完整的数据。红线显示模型成为外推的地方。它显示了基于起始点来拟合一条曲线是多么困难。这只有在你对疾病强度的过程非常确定的情况下才有可能。这是相当多的假设。为了比较，荷兰国家公共健康和环境研究所的数据再次被加入。看出区别。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ni"><img src="../Images/715ddf31e693cf87f52f38661530df70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aE-9dMhjunVmoqfGptTzSA.png"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">图片作者。</p></figure><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi na"><img src="../Images/7d410605a02894d2233f442438a8140c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UHa3DK7mC68J6dQQBjGCIQ.jpeg"/></div></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">国家公共卫生和环境研究所；<em class="nb">卫生、福利和体育部/ </em></p></figure><p id="92ad" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">欢迎评论(反馈)和指出错误。讨论当然也是！</p></div></div>    
</body>
</html>