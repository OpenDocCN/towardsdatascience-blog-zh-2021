<html>
<head>
<title>Machine Learning with Google’s BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用谷歌的BigQuery进行机器学习</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/machine-learning-with-googles-bigquery-6602e734bf74?source=collection_archive---------26-----------------------#2021-06-23">https://towardsdatascience.com/machine-learning-with-googles-bigquery-6602e734bf74?source=collection_archive---------26-----------------------#2021-06-23</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="23e8" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">如何使用SQL轻松创建和部署ML模型</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/cb296053b374692fb228f7aa8a1e2f1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8z2Bt-FeBda9xocbrHhvSQ.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">彼得·奥勒克萨在<a class="ae kz" href="https://unsplash.com/s/photos/utah?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="5f87" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">从数据仓库或数据湖中提取数据的传统方法——然后用它清理、转换和建立模型——正在慢慢被一种叫做<strong class="lc iv"> <em class="lw">的新方法所取代。这种新方法将计算引入数据，或将机器学习/算法引入数据</em></strong>【1】<strong class="lc iv"><em class="lw">。</em>在像Google的BigQuery这样的服务中，传统的数据库系统甚至用ML工具进行了内部扩展[2]。</strong></p><h1 id="a296" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">新范式的优势</h1><p id="34fe" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">新方法的优势包括简化的基础架构。如果我们看一下下面的简化架构，就可以清楚地看到，如果服务已经可以在云环境中相互通信，或者集成在一个服务中，那么就不需要第三方系统的进一步接口。<strong class="lc iv">这大大缩短了这些环境的设置和维护时间。</strong></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj mu"><img src="../Images/ab3d32500ee751536506304207efccd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iV9yaI4k8FYsNnPW.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">经典分析过程架构—作者图片</p></figure><p id="1b44" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">另一个重要因素是<strong class="lc iv">数据科学流程可以显著简化</strong>。每个数据科学家和工程师都知道这一过程有多耗时，因此将您需要的一切都放在云环境甚至服务中的方法大大简化了这一过程。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj mv"><img src="../Images/7743ac265dd45c104f55d6d605af48bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PXsEIb1ipA-_QDU6.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">集成的数据湖和分析平台—作者图片</p></figure><p id="e607" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">第三点是<strong class="lc iv">可编程性的简化</strong>——比如分析师只用SQL就能轻松完成机器学习任务。下面，我想用BigQuery中的一个简单例子来说明这一点。如果您想更深入地了解数据平台现代化这一主题，您可能会对这篇文章感兴趣。</p><h1 id="4d41" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">BigQuery ML示例</h1><p id="3b00" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">为了展示解决方案如何简化数据分析过程，我将使用BigQuery及其ML功能。这里，我使用了公共数据集，其中包含了爱荷华州所有批发购买的酒。</p><p id="efcb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这个例子中，我只是想做一些聚类。这个例子非常简单，但是很好地展示了可能性和您必须采取的步骤。</p><p id="81e7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">第一步:创建模型</strong></p><pre class="kk kl km kn gu mw mx my mz aw na bi"><span id="a29a" class="nb ly iu mx b gz nc nd l ne nf">CREATE OR REPLACE MODEL DATA.iowa_bottle_clusters OPTIONS (model_type=’kmeans’, num_clusters=3, distance_type = ‘euclidean’) ASSELECT item_description, AVG(state_bottle_cost) AS state_bottle_cost,FROM `bigquery-public-data.iowa_liquor_sales.sales`WHERE EXTRACT(YEAR FROM date) = 2018GROUP BY item_description;</span></pre><p id="d7b9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">上面，您可以看到我使用了k-Means算法，并将聚类数的参数设置为3。对于这个高度简化的例子，我的想法是使用变量<em class="lw">state _ bottle _ payed</em>(酒精饮料部门为订购的每瓶酒支付的金额)将其分为三个价格类别。</p><p id="062c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">第二步:评估模型</strong></p><p id="d904" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">创建模型后，BigQuery会自动为您提供一些指标。这些允许对聚类算法进行评估。对于<em class="lw">戴维斯-波尔丁指数</em>，目标将是最低的可能值【3】。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj ng"><img src="../Images/5fd01d76f83309c245bb1986f57ae934.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/0*JYI-t8tDu2gqSP5P.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">指标—按作者分类的图像</p></figure><p id="ffb3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">另一个很棒的特性是我们得到的损失图表。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj mu"><img src="../Images/4cc7442fad771d18144f1b16c7194a3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XXIQsi0UqK8xAxiT.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">损失-作者提供的图像</p></figure><p id="325a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">随着</p><pre class="kk kl km kn gu mw mx my mz aw na bi"><span id="6ed7" class="nb ly iu mx b gz nc nd l ne nf">SELECT * FROM ML.TRAINING_INFO(MODEL Data.iowa_bottle_clusters);</span></pre><p id="311a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">和</p><pre class="kk kl km kn gu mw mx my mz aw na bi"><span id="938a" class="nb ly iu mx b gz nc nd l ne nf">SELECT davies_bouldin_index FROM ML.EVALUATE(MODEL Data.iowa_bottle_clusters);</span></pre><p id="c169" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果需要，您可以稍后查询结果。</p><p id="2e9b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">第三步:预测</strong></p><p id="7201" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">经由<em class="lw">毫升。预测</em>我们将看到特定品牌属于哪个集群。</p><pre class="kk kl km kn gu mw mx my mz aw na bi"><span id="4b12" class="nb ly iu mx b gz nc nd l ne nf">SELECT<br/> centroid_id,<br/> item_description,<br/> state_bottle_cost<br/>FROM<br/> ML.PREDICT(MODEL Data.iowa_bottle_clusters,(SELECT<br/>  item_description,<br/>  AVG(state_bottle_cost) AS state_bottle_cost<br/> FROM<br/>  bigquery-public-data.iowa_liquor_sales.sales<br/> WHERE<br/>  date &lt;= '2018-02-02'<br/>  AND date &gt;='2018-01-01'<br/> GROUP BY<br/>  item_description) )<br/> ORDER BY<br/>  centroid_id;</span></pre><p id="5736" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">第四步:检查结果</strong></p><p id="4faa" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在让我们检查结果是否有意义。以下是三个集群的示例:</p><p id="9ddd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">第一组中只有一个项目，似乎是高级产品:</p><p id="ae6f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="lw"> 1 —雷米·马丁路易十三干邑— 1599.19 </em></p><p id="4f4d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在第二组中，我们有更多的瓶子，似乎被认为是中产阶级，例如:</p><p id="1d8b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="lw"> 2 —达尔莫尔雪茄麦芽苏格兰威士忌— 93.33 </em></p><p id="c7ce" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="lw"> 2 —卡瓦兰雪利酒橡木单一麦芽— 73.33 </em></p><p id="3fa8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="lw"> 2 —吉姆梁酒厂的杰作— 104.91 </em></p><p id="1e12" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">还有一组产品，你可能会将它们与可乐或其他软饮料混合在一起:</p><p id="5cc3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="lw"> 3 —斯米尔诺夫葡萄— 8.25 </em></p><p id="2f97" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="lw"> 3 —斯米尔诺夫酸青苹果— 8.25 </em></p><p id="b56f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="lw"> 3 —伯内特水果潘趣酒— 4.48 </em></p><p id="5269" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">所以最终的结果并没有那么糟糕——但当然可以优化。这里您需要的只是BigQuery和一些基本的SQL。</p><h2 id="a647" class="nb ly iu bd lz nh ni dn md nj nk dp mh lj nl nm mj ln nn no ml lr np nq mn nr bi translated">结论</h2><p id="688b" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">在这篇短文中，我想提供一些关于将机器学习或算法转移到数据的范式<strong class="lc iv">的理论基础知识</strong>。此外，相对于传统方法的优势是显而易见的。尤其是在设置和维护方面，以及在节省时间方面的实际数据分析过程。BigQuery ML使机器学习的使用民主化。数据科学家和分析师可以使用BigQuery ML来构建和运行模型，而不必访问新的商业智能工具和表。预测分析有助于商业决策。最后，我展示了现在只使用SQL和Google的BigQuery开发一个机器学习模型是多么容易。有关更多信息，请单击下面的链接。</p><h2 id="e75a" class="nb ly iu bd lz nh ni dn md nj nk dp mh lj nl nm mj ln nn no ml lr np nq mn nr bi translated">资料来源和进一步阅读</h2><p id="a526" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">[1]唐斯，B. N .，奥菲姆，D. M .，黑尔，w .，Xi，l .，多纳霍，L. A .，&amp;卡拉，D. (2014)。将计算引入数据的实际例子。生物分子技术杂志:JBT ，<em class="lw"> 25 </em>(增刊)，S5。</p><p id="9986" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">[2] Google，<a class="ae kz" href="https://cloud.google.com/bigquery-ml/docs/introduction?hl=en" rel="noopener ugc nofollow" target="_blank">什么是BigQuery ML？</a> (2020年)</p><p id="87b9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">[3]戴维斯博士，波尔丁博士(1979年)。“一个集群分离措施”。IEEE模式分析与机器智能汇刊。PAMI-1 (2)，第224至227节。</p></div></div>    
</body>
</html>