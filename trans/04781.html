<html>
<head>
<title>Build with PyCaret, Deploy with FastAPI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用PyCaret构建，用FastAPI部署</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-with-pycaret-deploy-with-fastapi-333c710dc786?source=collection_archive---------6-----------------------#2021-04-26">https://towardsdatascience.com/build-with-pycaret-deploy-with-fastapi-333c710dc786?source=collection_archive---------6-----------------------#2021-04-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="cea8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">这是一个循序渐进、初学者友好的教程，介绍如何使用PyCaret构建端到端的机器学习管道，并将其作为API进行部署。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a4e4a7468bfabd294f7baac55222cd77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X-TkH_enuSrM71f1zrbHSg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">py caret——Python中的开源、低代码机器学习库</p></figure><h1 id="2914" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">👉介绍</h1><p id="87f8" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这是一个循序渐进、初学者友好的教程，介绍如何使用<a class="ae mj" href="https://www.pycaret.org" rel="noopener ugc nofollow" target="_blank"> PyCaret </a>构建端到端的机器学习管道，并使用<a class="ae mj" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank"> FastAPI </a>将其作为web API部署到生产中。</p><h2 id="1b01" class="mk kw iq bd kx ml mm dn lb mn mo dp lf lw mp mq lh ma mr ms lj me mt mu ll mv bi translated">本教程的学习目标</h2><ul class=""><li id="8cdf" class="mw mx iq lp b lq lr lt lu lw my ma mz me na mi nb nc nd ne bi translated">使用PyCaret构建端到端的机器学习管道</li><li id="f93f" class="mw mx iq lp b lq nf lt ng lw nh ma ni me nj mi nb nc nd ne bi translated">什么是部署？我们为什么要部署机器学习模型</li><li id="1707" class="mw mx iq lp b lq nf lt ng lw nh ma ni me nj mi nb nc nd ne bi translated">使用FastAPI开发一个API来生成对未知数据的预测</li><li id="4626" class="mw mx iq lp b lq nf lt ng lw nh ma ni me nj mi nb nc nd ne bi translated">使用Python向API发送以编程方式生成预测的请求。</li></ul><p id="f032" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">本教程将在较高层次上涵盖整个机器学习生命周期，分为以下几个部分:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/5104566c15027e483c034377ee8a134e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m_dqCv42rZmxqyFzQ7rpUQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">PyCaret —机器学习高级工作流</p></figure><h1 id="3a68" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">💻在本教程中，我们将使用哪些工具？</h1><h2 id="56e0" class="mk kw iq bd kx ml mm dn lb mn mo dp lf lw mp mq lh ma mr ms lj me mt mu ll mv bi translated">👉PyCaret</h2><p id="0801" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">PyCaret是一个开源的低代码机器学习库和端到端的模型管理工具，内置于Python中，用于自动化机器学习工作流。它因其易用性、简单性以及快速有效地构建和部署端到端ML原型的能力而广受欢迎。</p><p id="b79c" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">PyCaret是一个替代的低代码库，可以用几行代码代替数百行代码。这使得实验周期成倍地快速和有效。</p><p id="36ed" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">py caret<strong class="lp ir">简单</strong> <strong class="lp ir">好用</strong>。PyCaret中执行的所有操作都顺序存储在一个<strong class="lp ir">管道</strong>中，该管道对于<strong class="lp ir">部署是完全自动化的。</strong>无论是输入缺失值、一键编码、转换分类数据、特征工程，甚至是超参数调整，PyCaret都能实现自动化。</p><p id="3fb3" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">要了解更多关于PyCaret的信息，请查看他们的GitHub。</p><h2 id="b88b" class="mk kw iq bd kx ml mm dn lb mn mo dp lf lw mp mq lh ma mr ms lj me mt mu ll mv bi translated">👉FastAPI</h2><p id="b004" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">FastAPI是一个现代、快速(高性能)的web框架，用于基于标准Python类型提示用Python 3.6+构建API。主要特点是:</p><ul class=""><li id="c1f1" class="mw mx iq lp b lq nk lt nl lw nq ma nr me ns mi nb nc nd ne bi translated"><strong class="lp ir">快</strong>:非常高的性能，与<strong class="lp ir"> NodeJS </strong>和<strong class="lp ir"> Go </strong>不相上下(感谢Starlette和Pydantic)。<a class="ae mj" href="https://fastapi.tiangolo.com/#performance" rel="noopener ugc nofollow" target="_blank">最快的Python框架之一</a>。</li><li id="fbd0" class="mw mx iq lp b lq nf lt ng lw nh ma ni me nj mi nb nc nd ne bi translated"><strong class="lp ir">快速编码</strong>:将开发特性的速度提高200%到300%左右。</li><li id="ce29" class="mw mx iq lp b lq nf lt ng lw nh ma ni me nj mi nb nc nd ne bi translated"><strong class="lp ir">易</strong>:设计为易于使用和学习。减少阅读文件的时间。</li></ul><p id="51e6" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">要了解FastAPI的更多信息，请查看他们的<a class="ae mj" href="https://github.com/tiangolo/fastapi" rel="noopener ugc nofollow" target="_blank"> GitHub </a>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/301eee71b2ff10b7c506b1bf943f451f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cTds_qxWkAmBCovv0bmnIg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">PyCaret和FastAPI的工作流</p></figure><h2 id="03b6" class="mk kw iq bd kx ml mm dn lb mn mo dp lf lw mp mq lh ma mr ms lj me mt mu ll mv bi translated">👉正在安装PyCaret</h2><p id="e32d" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">安装PyCaret非常容易，只需要几分钟。我们强烈建议使用虚拟环境来避免与其他库的潜在冲突。</p><p id="6cbb" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">PyCaret的默认安装是pycaret的精简版本，只安装这里列出的硬依赖项<a class="ae mj" href="https://github.com/pycaret/pycaret/blob/master/requirements.txt" rel="noopener ugc nofollow" target="_blank"/>。</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="b035" class="mk kw iq nv b gy nz oa l ob oc"><strong class="nv ir"># install slim version (default)<br/></strong>pip install pycaret</span><span id="a5f8" class="mk kw iq nv b gy od oa l ob oc"><strong class="nv ir"># install the full version</strong><br/>pip install pycaret[full]</span></pre><p id="51a2" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">当您安装pycaret的完整版本时，这里列出的所有可选依赖项<a class="ae mj" href="https://github.com/pycaret/pycaret/blob/master/requirements-optional.txt" rel="noopener ugc nofollow" target="_blank">也会被安装。</a></p><h2 id="3ded" class="mk kw iq bd kx ml mm dn lb mn mo dp lf lw mp mq lh ma mr ms lj me mt mu ll mv bi translated">👉安装FastAPI</h2><p id="95c0" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">您可以从pip安装FastAPI。</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="8a42" class="mk kw iq nv b gy nz oa l ob oc">pip install fastapi</span></pre><h1 id="cf15" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">👉商业问题</h1><p id="b761" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">对于本教程，我将使用一个非常受欢迎的案例研究，由达顿商学院发表在<a class="ae mj" href="https://hbsp.harvard.edu/product/UV0869-PDF-ENG" rel="noopener ugc nofollow" target="_blank">哈佛商学院</a>。这个案子是关于两个未来将要结婚的人的故事。名叫<em class="oe">格雷格</em>的家伙想买一枚戒指向一个名叫<em class="oe">莎拉</em>的女孩求婚。问题是找到莎拉会喜欢的戒指，但在他的密友建议后，格雷格决定买一颗钻石，这样莎拉就可以决定她的选择。然后，格雷格收集了6000颗钻石的价格和切割、颜色、形状等属性数据。</p><h1 id="3526" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">👉数据</h1><p id="fbaa" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在本教程中，我将使用一个数据集，该数据集来自达顿商学院的一个非常受欢迎的案例研究，发表在<a class="ae mj" href="https://hbsp.harvard.edu/product/UV0869-PDF-ENG" rel="noopener ugc nofollow" target="_blank">哈佛商业</a>上。本教程的目标是根据钻石的重量、切割、颜色等属性来预测钻石的价格。您可以从<a class="ae mj" href="https://github.com/pycaret/pycaret/tree/master/datasets" rel="noopener ugc nofollow" target="_blank"> PyCaret的存储库</a>下载数据集。</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="0819" class="mk kw iq nv b gy nz oa l ob oc"><strong class="nv ir"># load the dataset from pycaret<br/></strong>from pycaret.datasets import get_data<br/>data = get_data('diamond')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi of"><img src="../Images/59224af5669b8aa635d96027ef45a0b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1094/format:webp/1*e-rJPY4j9GYciT-L-lZnWw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数据中的样本行</p></figure><h1 id="14fc" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">👉探索性数据分析</h1><p id="54bf" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">让我们做一些快速可视化来评估独立特征(重量、切割、颜色、净度等)之间的关系。)与目标变量即<code class="fe og oh oi nv b">Price</code></p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="a279" class="mk kw iq nv b gy nz oa l ob oc"><strong class="nv ir"># plot scatter carat_weight and Price</strong><br/>import plotly.express as px<br/>fig = px.scatter(x=data['Carat Weight'], y=data['Price'], <br/>                 facet_col = data['Cut'], opacity = 0.25, template = 'plotly_dark', trendline='ols',<br/>                 trendline_color_override = 'red', title = 'SARAH GETS A DIAMOND - A CASE STUDY')<br/>fig.show()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/ed9f1000130827f13bb6dc9fdcfb5198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8aLmTOhOB68KYLO05I6A3A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">莎拉得到了一份钻石案例研究</p></figure><p id="2ebd" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">让我们检查目标变量的分布。</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="0c41" class="mk kw iq nv b gy nz oa l ob oc"><strong class="nv ir"># plot histogram</strong><br/>fig = px.histogram(data, x=["Price"], template = 'plotly_dark', title = 'Histogram of Price')<br/>fig.show()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/e535e3df0a0e2e62d37a9d328753ae2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wp_UPlON60zl43zZ7MwqPg.png"/></div></div></figure><p id="5078" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">请注意，<code class="fe og oh oi nv b">Price</code>的分布是右偏的，我们可以快速查看对数变换是否可以使<code class="fe og oh oi nv b">Price</code>接近正态，从而给假设正态的算法一个机会。</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="7a5d" class="mk kw iq nv b gy nz oa l ob oc">import numpy as np</span><span id="d3c6" class="mk kw iq nv b gy od oa l ob oc"><strong class="nv ir"># create a copy of data</strong><br/>data_copy = data.copy()</span><span id="1035" class="mk kw iq nv b gy od oa l ob oc"><strong class="nv ir"># create a new feature Log_Price</strong><br/>data_copy['Log_Price'] = np.log(data['Price'])</span><span id="a474" class="mk kw iq nv b gy od oa l ob oc"><strong class="nv ir"># plot histogram</strong><br/>fig = px.histogram(data_copy, x=["Log_Price"], title = 'Histgram of Log Price', template = 'plotly_dark')<br/>fig.show()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/bef0fa3285c94c3fae33cd149c3450e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O6pYtQoZ7Pf07Xw-og0vFA.png"/></div></div></figure><p id="edef" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">这证实了我们的假设。这种转换将帮助我们摆脱偏态，使目标变量接近正态。基于此，我们将在训练我们的模型之前转换<code class="fe og oh oi nv b">Price</code>变量。</p><h1 id="069d" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">👉数据准备</h1><p id="6c0c" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">对于PyCaret中的所有模块来说，<code class="fe og oh oi nv b">setup</code>是在PyCaret中执行的任何机器学习实验中的第一个也是唯一一个强制步骤。该功能负责训练模型之前所需的所有数据准备。除了执行一些基本的默认处理任务，PyCaret还提供了一系列预处理功能。要了解PyCaret中所有预处理功能的更多信息，您可以查看这个<a class="ae mj" href="https://pycaret.org/preprocessing/" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="26bd" class="mk kw iq nv b gy nz oa l ob oc"><strong class="nv ir"># init setup</strong><br/>from pycaret.regression import *<br/>s = setup(data, target = 'Price', transform_target = True)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/f1245b82abf22574b1a4886c7578fbc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jw47qMeoH7ixupKG6xDNHA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">pycaret.regression模块中的设置函数</p></figure><p id="af6c" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">每当在PyCaret中初始化<code class="fe og oh oi nv b">setup</code>函数时，它都会分析数据集并推断所有输入要素的数据类型。在这种情况下，你可以看到除了<code class="fe og oh oi nv b">Carat Weight</code>所有其他特征都被推断为分类，这是正确的。您可以按enter键继续。</p><p id="c8a4" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">注意，我在<code class="fe og oh oi nv b">setup</code>中使用了<code class="fe og oh oi nv b">transform_target = True</code>。PyCaret将使用box-cox变换在后台转换<code class="fe og oh oi nv b">Price</code>变量。它以类似于日志转换<em class="oe">(技术上不同)</em>的方式影响数据的分布。如果你想了解更多关于box-cox变换的知识，你可以参考这个<a class="ae mj" href="https://onlinestatbook.com/2/transformations/box-cox.html" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi on"><img src="../Images/cc53cd3dcd933f321031a4b014d5707d.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*Xm7xnZr1UjSTM_dTFwbv6g.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">设置的输出—为显示而截断</p></figure><h1 id="f045" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">👉模型训练和选择</h1><p id="ca29" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">现在数据准备工作已经完成，让我们使用<code class="fe og oh oi nv b">compare_models</code>功能开始训练过程。此函数训练模型库中可用的所有算法，并使用交叉验证评估多个性能指标。</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="7aff" class="mk kw iq nv b gy nz oa l ob oc"><strong class="nv ir"># compare all models</strong><br/>best = compare_models()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/84d5f17dbac103a24c3699521e3e0de1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*poaUGuUkOX-2kO3b5-Z_4g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">compare_models的输出</p></figure><p id="d386" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">基于<em class="oe">平均绝对误差</em>的最佳模型是<code class="fe og oh oi nv b">CatBoost Regressor</code>。使用10倍交叉验证的MAE为543美元，而钻石的平均价值为11，600美元。这还不到5%。对于我们到目前为止所付出的努力来说还不错。</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="7fc4" class="mk kw iq nv b gy nz oa l ob oc"><strong class="nv ir"># check the residuals of trained model</strong><br/>plot_model(best, plot = 'residuals_interactive')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/1e28b0917f49b9e33d315e6b69dad88c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9XL2AJvT7ZoejJNgxmlU-g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">最佳模型的残差和QQ图</p></figure><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="79a0" class="mk kw iq nv b gy nz oa l ob oc"><strong class="nv ir"># check feature importance</strong><br/>plot_model(best, plot = 'feature')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/9741cdeefb633345b19166ca726e7999.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*azpWQD8M5dPycAzWBGtNaQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">最佳模型的特征重要性</p></figure><h1 id="a3db" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">完成并保存管道</h1><p id="62a4" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">现在让我们最终确定最佳模型，即在包括测试集在内的整个数据集上训练最佳模型，然后将管道保存为pickle文件。</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="611e" class="mk kw iq nv b gy nz oa l ob oc"><strong class="nv ir"># finalize the model</strong><br/>final_best = finalize_model(best)</span><span id="a931" class="mk kw iq nv b gy od oa l ob oc"><strong class="nv ir"># save model to disk<br/></strong>save_model(final_best, 'diamond-pipeline')</span></pre><h1 id="d1c0" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">👉部署</h1><blockquote class="or os ot"><p id="dc0d" class="ln lo oe lp b lq nk jr ls lt nl ju lv ou nm ly lz ov nn mc md ow no mg mh mi ij bi translated"><strong class="lp ir"> <em class="iq">首先，我们来了解一下为什么要部署机器学习模型？</em> </strong></p></blockquote><p id="5a73" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated"><em class="oe">机器学习模型的部署是使模型在生产中可用的过程，其中web应用程序、企业软件和API可以通过提供新的数据点和生成预测来使用经过训练的模型。通常建立机器学习模型，以便它们可以用于预测结果(二进制值，即用于分类的1或0，用于回归的连续值，用于聚类的标签等)。生成预测有两种主要方式(I)批量预测；以及(ii)实时预测。本教程将展示如何将您的机器学习模型部署为API以进行实时预测。</em></p><p id="c88b" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">既然我们已经理解了为什么部署是必要的，并且我们已经具备了创建API所需的一切，即<em class="oe">作为pickle文件</em>的训练模型管道。使用FastAPI创建API非常简单。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae mj" href="https://gist.github.com/moezali1/4bd5312d27884d7b07f66befcdc28ccf" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/moe zali 1/4bd 5312d 27884d 7 b 07 f 66 bef CDC 28 CCF</a></p></figure><p id="9dc6" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">代码的前几行是简单的导入。第8行正在通过调用<code class="fe og oh oi nv b">FastAPI()</code>初始化一个app。第11行从您的磁盘加载训练好的模型<code class="fe og oh oi nv b">diamond-pipeline</code>(您的脚本必须与文件在同一个文件夹中)。第15–20行定义了一个名为<code class="fe og oh oi nv b">predict</code>的函数，它接受输入，并在内部使用PyCaret的<code class="fe og oh oi nv b">predict_model</code>函数来生成预测，并将值作为字典返回(第20行)。</p><p id="f262" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">然后，您可以通过在命令提示符下运行以下命令来运行该脚本。在执行此命令之前，您必须与python脚本和模型pickle文件位于同一目录下。</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="fd62" class="mk kw iq nv b gy nz oa l ob oc">uvicorn main:app --reload</span></pre><p id="6fab" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">这将在本地主机上初始化一个API服务。在您的浏览器上键入<a class="ae mj" href="http://localhost:8000/docs" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/docs</a>，它应该显示如下内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/ed9068582f64441134bc16f4e955a90a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RWJbHRXV3YrMI5I4NdMBtA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">http://本地主机:8000/docs</p></figure><p id="9b7f" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">点击绿色的<code class="fe og oh oi nv b"><strong class="lp ir">POST</strong></code> <strong class="lp ir"> </strong>按钮，会打开一个这样的表单:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/7fd7b94676310f23883a10576c7b0b16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NZlbBe8gAkq1CmqC_4_hDg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae mj" href="http://localhost:8000/docs" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/docs</a></p></figure><p id="ad50" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">点击右上角的<strong class="lp ir">“试用”</strong>，在表格中填写一些值，然后点击“执行”。如果您做了所有正确的事情，您将看到以下响应:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pb"><img src="../Images/31331be5bfc6aaba88849ded97cb6255.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1j3Pfu3G-63ic09mIkrwvA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来自FastAPI的响应</p></figure><p id="9b75" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">请注意，在响应主体下，我们有一个预测值5396(这是基于我在表单中输入的值)。这意味着，考虑到您输入的所有属性，这颗钻石的预测价格为5396美元。</p><p id="5c10" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">这太好了，这表明我们的API正在工作。现在我们可以使用Python或任何其他语言中的<code class="fe og oh oi nv b">requests</code>库来连接API并生成预测。我为此创建了如下所示的脚本:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae mj" href="https://gist.github.com/moezali1/545be5743b61aa5477228b8727e40b59" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/moe zali 1/545 be 5743 b 61 aa 5477228 b 8727 e 40 b 59</a></p></figure><p id="8861" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">让我们来看看这个函数的运行情况:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pc"><img src="../Images/a42897886ae995e4647f0186e6781996.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G83rpAEKbTeOEYXtl6_7qQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">为进行API调用而创建的get_prediction函数</p></figure><p id="dd5a" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">请注意，预测值是5396，这是因为我在这里使用了与上表中相同的值。(1.1，“理想”，“H”，“SII”，“VG”，“EX”，“GIA”)</p><p id="66ae" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">我希望你会喜欢PyCaret和FastAPI的易用性和简单性。在不到25行代码和几分钟的实验中，我使用PyCaret训练和评估了多个模型，并使用API部署了ML管道。</p><h1 id="8911" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">即将推出！</h1><p id="e836" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">下周我将写一篇教程来推进部署到下一个级别，我将在下一篇教程中介绍像容器化和码头工人这样的概念。请关注我的<a class="ae mj" href="https://medium.com/@moez-62905" rel="noopener">媒体</a>、<a class="ae mj" href="https://www.linkedin.com/in/profile-moez/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>、<a class="ae mj" href="https://twitter.com/moezpycaretorg1" rel="noopener ugc nofollow" target="_blank"> Twitter </a>获取更多更新。</p></div><div class="ab cl pd pe hu pf" role="separator"><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi"/></div><div class="ij ik il im in"><p id="ec3e" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">使用Python中的这个轻量级工作流自动化库，您可以实现的目标是无限的。如果你觉得这很有用，请不要忘记给我们GitHub库上的⭐️。</p><p id="1ca6" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">要了解更多关于PyCaret的信息，请关注我们的LinkedIn和Youtube。</p><p id="34a1" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated">加入我们的休闲频道。此处邀请链接<a class="ae mj" href="https://join.slack.com/t/pycaret/shared_invite/zt-p7aaexnl-EqdTfZ9U~mF0CwNcltffHg" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="475d" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">您可能还对以下内容感兴趣:</h1><p id="8b7a" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated"><a class="ae mj" rel="noopener" target="_blank" href="/build-your-own-automl-in-power-bi-using-pycaret-8291b64181d">使用PyCaret 2.0 </a> <br/> <a class="ae mj" rel="noopener" target="_blank" href="/deploy-machine-learning-pipeline-on-cloud-using-docker-container-bec64458dc01">在Power BI中构建您自己的AutoML使用Docker </a> <br/> <a class="ae mj" rel="noopener" target="_blank" href="/deploy-machine-learning-model-on-google-kubernetes-engine-94daac85108b">在Azure上部署机器学习管道在Google Kubernetes引擎上部署机器学习管道</a> <br/> <a class="ae mj" rel="noopener" target="_blank" href="/deploy-machine-learning-pipeline-on-aws-fargate-eb6e1c50507">在AWS Fargate上部署机器学习管道</a> <br/> <a class="ae mj" rel="noopener" target="_blank" href="/build-and-deploy-your-first-machine-learning-web-app-e020db344a99">构建和部署您的第一个机器学习web应用</a> <br/> <a class="ae mj" rel="noopener" target="_blank" href="/deploy-pycaret-and-streamlit-app-using-aws-fargate-serverless-infrastructure-8b7d7c0584c2">使用AWS Fargate无服务器</a> <br/> <a class="ae mj" rel="noopener" target="_blank" href="/build-and-deploy-machine-learning-web-app-using-pycaret-and-streamlit-28883a569104">构建和部署机器</a></p><h1 id="199b" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">重要链接</h1><p id="b071" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated"><a class="ae mj" href="https://pycaret.readthedocs.io/en/latest/installation.html" rel="noopener ugc nofollow" target="_blank">文档</a> <br/> <a class="ae mj" href="https://medium.com/@moez_62905" rel="noopener">博客</a><br/><a class="ae mj" href="http://www.github.com/pycaret/pycaret" rel="noopener ugc nofollow" target="_blank">GitHub</a><br/><a class="ae mj" href="https://stackoverflow.com/questions/tagged/pycaret" rel="noopener ugc nofollow" target="_blank">stack overflow</a><br/><a class="ae mj" href="https://pycaret.readthedocs.io/en/latest/installation.html" rel="noopener ugc nofollow" target="_blank">安装PyCaret <br/> </a> <a class="ae mj" href="https://pycaret.readthedocs.io/en/latest/tutorials.html" rel="noopener ugc nofollow" target="_blank">笔记本教程<br/> </a> <a class="ae mj" href="https://pycaret.readthedocs.io/en/latest/contribute.html" rel="noopener ugc nofollow" target="_blank">投稿于PyCaret </a></p><h1 id="c0e4" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">想了解某个特定模块？</h1><p id="1b27" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">单击下面的链接查看文档和工作示例。</p><p id="f800" class="pw-post-body-paragraph ln lo iq lp b lq nk jr ls lt nl ju lv lw nm ly lz ma nn mc md me no mg mh mi ij bi translated"><a class="ae mj" href="https://pycaret.readthedocs.io/en/latest/api/classification.html" rel="noopener ugc nofollow" target="_blank">分类<br/></a>T3】回归T5】T6】聚类 <br/> <a class="ae mj" href="https://pycaret.readthedocs.io/en/latest/api/anomaly.html" rel="noopener ugc nofollow" target="_blank">异常检测</a> <br/> <a class="ae mj" href="https://pycaret.readthedocs.io/en/latest/api/nlp.html" rel="noopener ugc nofollow" target="_blank">自然语言处理<br/> </a> <a class="ae mj" href="https://pycaret.readthedocs.io/en/latest/api/arules.html" rel="noopener ugc nofollow" target="_blank">关联规则挖掘</a></p></div></div>    
</body>
</html>