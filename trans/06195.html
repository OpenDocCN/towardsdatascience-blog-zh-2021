<html>
<head>
<title>Using Prophet after COVID? Read this first.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在COVID之后使用Prophet？先看这个。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-prophet-after-covid-read-this-first-fc27cd77f3d7?source=collection_archive---------9-----------------------#2021-06-03">https://towardsdatascience.com/using-prophet-after-covid-read-this-first-fc27cd77f3d7?source=collection_archive---------9-----------------------#2021-06-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8142" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何处理<strong class="ak"> COVID对时间序列数据的影响</strong>？<strong class="ak">加法vs乘法</strong>，选哪个？如何处理<strong class="ak">非日常数据</strong>？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6fa4c621c0dc51e922a811f030063a44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ih1lBRGg4HOUt8i3"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">弗里达·布莱德森在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><blockquote class="ld le lf"><p id="3f1a" class="lg lh li lj b lk ll jr lm ln lo ju lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">Prophet是基于<strong class="lj ir">加法模型</strong>预测<strong class="lj ir">时间序列数据</strong>的程序，其中非线性趋势与<strong class="lj ir">年、周、日季节性</strong>、<strong class="lj ir">加上假日效应</strong>相符合。它最适用于具有强烈季节效应的时间序列和几个季节的历史数据。Prophet对缺失数据和趋势变化具有很强的鲁棒性，通常情况下,<strong class="lj ir">能很好地处理异常值,</strong>。</p></blockquote><p id="5c11" class="pw-post-body-paragraph lg lh iq lj b lk ll jr lm ln lo ju lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">通过使用可分解的时间序列模型，Prophet模型有三个主要组件:</p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="cd2a" class="ml mm iq mh b gy mn mo l mp mq"><strong class="mh ir">y(t) = g(t) + s(t) + h(t) + e(t)</strong></span><span id="0510" class="ml mm iq mh b gy mr mo l mp mq">g(t): <strong class="mh ir">trend</strong> functions that models <em class="li">non-periodic</em> changes; <br/>s(t): <strong class="mh ir">seasonality</strong> functions that models <em class="li">periodic</em> changes; i.e. weekly, monthly, yearly seasonality;<br/>h(t): <strong class="mh ir">holdiay</strong> function that represents the effects of potentially irregular scheduled holidays;<br/>e(t): <strong class="mh ir">error </strong>terms that represents changes that are not captured by the model;</span></pre><p id="e48c" class="pw-post-body-paragraph lg lh iq lj b lk ll jr lm ln lo ju lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">如果你是Prophet新手，想了解更多的细节，请查看这些令人敬畏的媒体文章(<a class="ae kv" href="https://medium.com/future-vision/intro-to-prophet-9d5b1cbd674e" rel="noopener">一篇</a>、<a class="ae kv" href="https://medium.com/swlh/facebook-prophet-426421f7e331" rel="noopener">两篇</a>、<a class="ae kv" href="https://medium.com/future-vision/the-math-of-prophet-46864fa9c55a" rel="noopener">三篇</a>)以及<a class="ae kv" href="https://doi.org/10.7287/peerj.preprints.3190v2" rel="noopener ugc nofollow" target="_blank">原始出版物</a>，它们可以让你快速而深入地开始。假设您已经使用过Prophet模型有一段时间了，并且理解了基本原理，那么本文涵盖了在新冠肺炎之后使用Prophet建模时间序列时迟早会遇到的3个重要的高级主题。</p><ul class=""><li id="9111" class="ms mt iq lj b lk ll ln lo md mu me mv mf mw mc mx my mz na bi translated"><em class="li">如何应对COVID的冲击？</em></li><li id="3ebe" class="ms mt iq lj b lk nb ln nc md nd me ne mf nf mc mx my mz na bi translated"><em class="li">加法vs乘法模型？选哪个？</em></li><li id="58eb" class="ms mt iq lj b lk nb ln nc md nd me ne mf nf mc mx my mz na bi translated"><em class="li">如何处理非日常数据？</em></li></ul><h1 id="b2d8" class="ng mm iq bd nh ni nj nk nl nm nn no np jw nq jx nr jz ns ka nt kc nu kd nv nw bi translated"><strong class="ak"> 1。如何应对COVID的冲击？</strong></h1><p id="1de9" class="pw-post-body-paragraph lg lh iq lj b lk nx jr lm ln ny ju lp md nz ls lt me oa lw lx mf ob ma mb mc ij bi translated">COVID的影响已经渗透到方方面面。如果你正在处理时间序列数据，你可能已经注意到2020年后一些奇怪的模型表现。这就像是由COVID对时间序列数据的趋势和季节性的影响所驱动的。有几种方法可以处理这个问题。</p><h2 id="5de4" class="ml mm iq bd nh oc od dn nl oe of dp np md og oh nr me oi oj nt mf ok ol nv om bi translated">方法1:将COIVD视为“假日”事件</h2><p id="717e" class="pw-post-body-paragraph lg lh iq lj b lk nx jr lm ln ny ju lp md nz ls lt me oa lw lx mf ob ma mb mc ij bi translated">模特没有情感。我们可以做一个简单的“把戏”，让模型将COVID视为一个事件或“假日”。这个概念很简单。就像在假日购物季期间，我们预计购物中心的客流量会增加一样，该模型会将COVID视为一个特殊的“假日”，估计购物中心的客流量会减少。下面的代码将完成这项工作。</p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="d5fd" class="ml mm iq mh b gy mn mo l mp mq">COVID_lockdown = pd.DataFrame({<br/>        'holiday': 'covid',<br/>        'ds':  pd.date_range(start='2020-03-15', <br/>                             end='2020-05-01',<br/>                             freq='D'),<br/>        'lower_window': 0,<br/>        'upper_window': 0,<br/>        'prior_scale': 1 <br/>        })</span></pre><p id="4f69" class="pw-post-body-paragraph lg lh iq lj b lk ll jr lm ln lo ju lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">然而，这种方法很棘手，因为有太多的外部因素(州政策变化)使得COVID“假日”效应在不同时间和不同场景下不一致。</p><h2 id="b814" class="ml mm iq bd nh oc od dn nl oe of dp np md og oh nr me oi oj nt mf ok ol nv om bi translated">方法2:简单地丢弃或替换2020 COVID数据(有风险)</h2><p id="3cd6" class="pw-post-body-paragraph lg lh iq lj b lk nx jr lm ln ny ju lp md nz ls lt me oa lw lx mf ob ma mb mc ij bi translated">这是最简单的方法。只需丢弃2020年的数据或在2019年数据的基础上插入2020年的数据。然而，正如你可以想象的，这种方法是非常不可靠的，尤其是当你有短的历史数据。我们仍然希望包括2020年的真实数据，以帮助模型了解季节性。然而，如果您的时间序列数据总体上逐年稳定，并且您认为COVID在您的数据中不再起作用，则该方法值得测试。</p><h2 id="a9ee" class="ml mm iq bd nh oc od dn nl oe of dp np md og oh nr me oi oj nt mf ok ol nv om bi translated">方法3:指定“pre_covid”和“post_covid”季节性</h2><p id="af65" class="pw-post-body-paragraph lg lh iq lj b lk nx jr lm ln ny ju lp md nz ls lt me oa lw lx mf ob ma mb mc ij bi translated">COVID可能会创建一个周季节性模式，该模式在疫情/锁定期间与疫情之后不同。此方法将允许您训练两个独立的季节性模式，这可能对某些时间序列数据有所帮助。然而，在实验过程中，我发现这种方法产生的模型性能最差。因此，请再次考虑使用两种不同的季节来模拟您的数据是否有意义。</p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="31ef" class="ml mm iq mh b gy mn mo l mp mq">#define pre and post covid period<br/>def is_postcovid_seasonality(ds):<br/>            date = pd.to_datetime(ds)<br/>            return date.date() &gt;= pd.to_datetime('2021-03-15').date()<br/>dfprophet['pre_covid_seasonality']=~dfprophet['ds'].apply(is_postcovid_seasonality)<br/>dfprophet['post_covid_seasonality'] = dfprophet['ds'].apply(is_postcovid_seasonality)</span><span id="4ddb" class="ml mm iq mh b gy mr mo l mp mq">#add pre-covid and post-covid seasonality to the model <br/>base_model.add_seasonality(name='pre_covid_seasonality', period=7, fourier_order=3, condition_name='pre_covid_seasonality')<br/>base_model.add_seasonality(name='post_covid_seasonality', period=7, fourier_order=3, condition_name='post_covid_seasonality')</span></pre><h2 id="97e1" class="ml mm iq bd nh oc od dn nl oe of dp np md og oh nr me oi oj nt mf ok ol nv om bi translated">方法4:添加与COVID相关的回归变量，例如google mobility</h2><p id="bda7" class="pw-post-body-paragraph lg lh iq lj b lk nx jr lm ln ny ju lp md nz ls lt me oa lw lx mf ob ma mb mc ij bi translated">在许多业务场景中，这可能是处理COVID影响的最佳方法。我们将在此添加流动性数据等外部回归变量，以帮助模型获得COVID的影响。由于那些外部回归变量将极大地吸收COVID的影响，这将使COVID对季节性的影响最小化。以下是一些你可以使用的公开可用指标。<a class="ae kv" href="https://data.oecd.org/leadind/consumer-confidence-index-cci.htm#indicator-chart" rel="noopener ugc nofollow" target="_blank">消费者信心指数(CCI) </a>，<a class="ae kv" href="https://www.google.com/covid19/mobility/" rel="noopener ugc nofollow" target="_blank">谷歌流动性</a>，<a class="ae kv" href="https://covid19.healthdata.org/united-states-of-america?view=infections-testing&amp;tab=trend&amp;test=infections" rel="noopener ugc nofollow" target="_blank"> COVID案例预测</a></p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="b65a" class="ml mm iq mh b gy mn mo l mp mq">#add a list of external regressors<br/>regressors = ['CCI','google mobility','covid cases']<br/>for regressor in regressors:<br/>            base_model = base_model.add_regressor(regressor,<br/>                                                  prior_scale=1,  <br/>                                                 standardize='auto',   mode='multiplicative')</span></pre><p id="02f9" class="pw-post-body-paragraph lg lh iq lj b lk ll jr lm ln lo ju lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">需要注意的一点是，其中一些指标可能只是暂时可用的，如谷歌移动数据，它也不提供预测数据。为了利用它，我们可能需要对这些外部变量做自己的预测。尽管如此，包括这些指标将大大提高模型性能。当COVID影响消退，我们有了更稳定的时间序列数据时，我们可能只需要重新访问模型。</p><h1 id="e071" class="ng mm iq bd nh ni nj nk nl nm nn no np jw nq jx nr jz ns ka nt kc nu kd nv nw bi translated"><em class="on"> 2。加法vs乘法模型？选哪个？</em></h1><p id="726f" class="pw-post-body-paragraph lg lh iq lj b lk nx jr lm ln ny ju lp md nz ls lt me oa lw lx mf ob ma mb mc ij bi translated">第二个话题也有很多问题和讨论。你可能知道Prophet对于<strong class="lj ir">季节性和回归量</strong>有两种模式，一种是加法模式(默认)，另一种是乘法模式。<br/>加性模式下，季节性/回归量逐年不变；而在乘法模式下，季节性/回归量的大小随着趋势而变化(见下图)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/8b87daf5b2dcc7833c8edeae54a6c1b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*zVK_Zh7GDb702cx4n7hoAw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">尼古拉·考伦茨的加法与乘法季节性</p></figure><p id="c627" class="pw-post-body-paragraph lg lh iq lj b lk ll jr lm ln lo ju lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">先知的公式可以写成:</p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="ba82" class="ml mm iq mh b gy mn mo l mp mq">df['yhat'] = df['trend'] * (1 + df['multiplicative_terms']) + df['additive_terms']</span></pre><p id="3a52" class="pw-post-body-paragraph lg lh iq lj b lk ll jr lm ln lo ju lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">由于季节性和回归量都有两种模式，因此有四种组合:</p><h2 id="1988" class="ml mm iq bd nh oc od dn nl oe of dp np md og oh nr me oi oj nt mf ok ol nv om bi translated">案例1:附加季节性，附加回归量</h2><p id="0077" class="pw-post-body-paragraph lg lh iq lj b lk nx jr lm ln ny ju lp md nz ls lt me oa lw lx mf ob ma mb mc ij bi translated"><strong class="lj ir"><em class="li">【yhat(t)=趋势(t) +季节性(t)+β*回归量(t) </em> </strong> <br/>意思是回归量增加一个单位会产生yhat的β增加。</p><h2 id="ec81" class="ml mm iq bd nh oc od dn nl oe of dp np md og oh nr me oi oj nt mf ok ol nv om bi translated">案例2:倍增季节性，倍增回归量</h2><p id="4b11" class="pw-post-body-paragraph lg lh iq lj b lk nx jr lm ln ny ju lp md nz ls lt me oa lw lx mf ob ma mb mc ij bi translated"><strong class="lj ir"> <em class="li"> yhat(t) = trend(t) * (1 +季节性(t) + beta *回归量(t)) </em> </strong> <br/>意思是回归量增加一个单位会产生yhat的beta *趋势增加。</p><h2 id="9b11" class="ml mm iq bd nh oc od dn nl oe of dp np md og oh nr me oi oj nt mf ok ol nv om bi translated">案例3:加性季节性，乘性回归</h2><p id="367d" class="pw-post-body-paragraph lg lh iq lj b lk nx jr lm ln ny ju lp md nz ls lt me oa lw lx mf ob ma mb mc ij bi translated"><strong class="lj ir"><em class="li">【yhat(t)= trend(t)*(1+beta *回归量)+季节性(t) </em> </strong> <br/>意为回归量增加一个单位将产生yhat的beta *趋势增加。</p><h2 id="882d" class="ml mm iq bd nh oc od dn nl oe of dp np md og oh nr me oi oj nt mf ok ol nv om bi translated">案例4:乘法季节性，加法回归</h2><p id="ed9e" class="pw-post-body-paragraph lg lh iq lj b lk nx jr lm ln ny ju lp md nz ls lt me oa lw lx mf ob ma mb mc ij bi translated"><strong class="lj ir"><em class="li">yhat(t)= trend(t)*(1+beta *季节性(t)) +回归量(t) </em> </strong> <br/>意思是回归量增加一个单位会产生yhat增加一个单位。</p><h2 id="28fb" class="ml mm iq bd nh oc od dn nl oe of dp np md og oh nr me oi oj nt mf ok ol nv om bi translated"><strong class="ak">一般规则:</strong></h2><p id="7c6e" class="pw-post-body-paragraph lg lh iq lj b lk nx jr lm ln ny ju lp md nz ls lt me oa lw lx mf ob ma mb mc ij bi translated">因此，在选择加法或乘法模式之前，要问一个问题——回归变量中的一个单位变化是否总是有恒定的影响？或者它将取决于趋势的基础。通常，使用乘法模式更有意义，因为我们可以想象季节性的大小与趋势的大小是一致的。更多信息见<a class="ae kv" href="https://facebook.github.io/prophet/docs/multiplicative_seasonality.html" rel="noopener ugc nofollow" target="_blank">本</a>。</p><p id="953a" class="pw-post-body-paragraph lg lh iq lj b lk ll jr lm ln lo ju lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">例如，夏季气温升高一度，必然会比冬季气温升高一度引发更多的冰淇淋销售。所以在这种情况下，乘法模型更有意义。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/5a60620a45115d1cf58a0bec5e18054b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WGncbjpbqUu3nCMr"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@tsuneya?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Jared </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="543f" class="pw-post-body-paragraph lg lh iq lj b lk ll jr lm ln lo ju lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated"><strong class="lj ir">然而，由于COVID… </strong>，规则略有不同</p><p id="e053" class="pw-post-body-paragraph lg lh iq lj b lk ll jr lm ln lo ju lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">由于COVID的影响，2020年的数字可能非常低，因此如果我们使用乘法季节性，模型将被低基线误导，认为从2019年到2020年季节性的幅度有很大下降，然后预测2021年的季节性幅度甚至小于2020年。使用乘法可能会严重低估模型预测。</p><p id="0868" class="pw-post-body-paragraph lg lh iq lj b lk ll jr lm ln lo ju lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">综上所述，<strong class="lj ir"> <em class="li">在疫情期间使用加性季节性更有意义，这样就不会因2020年的异常基线而产生偏差，尤其是当COVID对你的时间序列数据产生很大影响的时候。</em> </strong>当我们走出疫情的时候，我们可能需要重温一下模型的超参数。</p><h1 id="e029" class="ng mm iq bd nh ni nj nk nl nm nn no np jw nq jx nr jz ns ka nt kc nu kd nv nw bi translated"><em class="on"> 3。如何处理非日常数据？</em></h1><p id="a32f" class="pw-post-body-paragraph lg lh iq lj b lk nx jr lm ln ny ju lp md nz ls lt me oa lw lx mf ob ma mb mc ij bi translated">现在，您可能希望每周或每月汇总一次数据，以抵消COVID带来的波动。在Prophet中处理非日常数据时有许多注意事项。下面我列出了两个基本的:</p><h2 id="dab2" class="ml mm iq bd nh oc od dn nl oe of dp np md og oh nr me oi oj nt mf ok ol nv om bi translated"><em class="on">警告1:确保“假期”是在代表周或月的日期。</em></h2><p id="a4de" class="pw-post-body-paragraph lg lh iq lj b lk nx jr lm ln ny ju lp md nz ls lt me oa lw lx mf ob ma mb mc ij bi translated">尽管您有每月或每周的汇总数据，但Prophet模型并不知道这一点，它仍然在拟合一个连续的模型，并将每周或每月的数据点视为仅在这些特定日期的单个数据点。因此，那些不属于数据中使用的特定日期的假期将被忽略！！！</p><p id="f80c" class="pw-post-body-paragraph lg lh iq lj b lk ll jr lm ln lo ju lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">例如，如果您有每月数据，并且每个月由该月的第一天表示(01/01/2021、02/01/2021、03/01/2021)，那么如果您想要将圣诞节作为假日事件，则需要将圣诞节设置为2021年12月1日，而不是2021年12月25日。为了处理这个潜在的问题，我们只需要将假日移到代表周或月的日期(见下面的代码)。</p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="5eee" class="ml mm iq mh b gy mn mo l mp mq">#Convert date to first day of month<br/>df['First_day_of_the_month'] =<br/>df['date'].to_numpy().astype('datetime64[M]')</span><span id="ddc8" class="ml mm iq mh b gy mr mo l mp mq">#Convert date to first day of week (sunday)<br/>df["First_day_of_the_week"] = df['Date'].apply(lambda x: (x - timedelta(days=x.dayofweek + 1)), axis = 1)</span></pre><h2 id="4b94" class="ml mm iq bd nh oc od dn nl oe of dp np md og oh nr me oi oj nt mf ok ol nv om bi translated"><em class="on">警告2:并非所有的前科都是平等的。</em></h2><p id="dc6c" class="pw-post-body-paragraph lg lh iq lj b lk nx jr lm ln ny ju lp md nz ls lt me oa lw lx mf ob ma mb mc ij bi translated">在Prophet中，您可以为<strong class="lj ir">趋势</strong>、<strong class="lj ir">季节性、节假日和额外回归变量</strong>设置先验。然而，选择正确的先验范围并不是一件容易的事情。</p><p id="3eed" class="pw-post-body-paragraph lg lh iq lj b lk ll jr lm ln lo ju lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">例如，如果数据的变化已经被额外的回归因素捕捉到，那么假日效应可能就是错误的，例如，如果我们使用营销支出作为额外的回归因素来预测需求，我们可能会意外地看到黑色星期五对需求产生负面影响。这是因为营销支出已经解释了需求的大多数变化，这导致了假日的不正确(反直觉)效应。</p><p id="8574" class="pw-post-body-paragraph lg lh iq lj b lk ll jr lm ln lo ju lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">另一个例子是，如果您增加之前的假期并减少之前的季节性，那么模型会更倾向于使用假期而不是季节性来解释数据的变化。如果您确实想使用季节性，您可以将节假日设置在一个非常小的数字(如0.00001)之前，将季节性设置在一个非常大的数字(如0.5)之前。</p><p id="ad41" class="pw-post-body-paragraph lg lh iq lj b lk ll jr lm ln lo ju lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">当然，如果您的目标是短期的准确性，您可以使用网格搜索方法(参见下面的代码块)来优化超参数。但是如果你也关心可解释性，你需要考虑哪一个对特定的变化或改变、季节性、假日或额外的回归变量更有影响，并且相对地增加那个部分的先验。</p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="85e0" class="ml mm iq mh b gy mn mo l mp mq"># Python<br/>import itertools<br/>param_grid = {  <br/>    'changepoint_prior_scale': [0.001, 0.01, 0.1, 0.5],<br/>    'seasonality_prior_scale': [0.01, 0.1, 1.0, 10.0],}</span><span id="5e7b" class="ml mm iq mh b gy mr mo l mp mq"># Generate all combinations of parameters<br/>all_params = [dict(zip(param_grid.keys(), v)) for v in itertools.product(*param_grid.values())]<br/>rmses = []  # Store the RMSEs for each params here</span><span id="541f" class="ml mm iq mh b gy mr mo l mp mq"># Use cross validation to evaluate all parameters<br/>for params in all_params:<br/>    m = Prophet(**params).fit(df)  # Fit model with given params<br/>    df_cv = cross_validation(m, cutoffs=cutoffs, horizon='30 days', parallel="processes")<br/>    df_p = performance_metrics(df_cv, rolling_window=1)<br/>    rmses.append(df_p['rmse'].values[0])</span><span id="f7e3" class="ml mm iq mh b gy mr mo l mp mq"># Find the best parameters<br/>tuning_results = pd.DataFrame(all_params)<br/>tuning_results['rmse'] = rmses<br/>print(tuning_results)</span></pre></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="73e6" class="ng mm iq bd nh ni oq nk nl nm or no np jw os jx nr jz ot ka nt kc ou kd nv nw bi translated">最后的</h1><p id="8cb0" class="pw-post-body-paragraph lg lh iq lj b lk nx jr lm ln ny ju lp md nz ls lt me oa lw lx mf ob ma mb mc ij bi translated">我希望这篇文章可以帮助您了解如何处理COVID影响，如何选择加法和乘法模式，以及如何处理非日常数据。这三个主题变得特别重要，甚至是在新冠肺炎之后使用先知时必须知道的。</p><p id="971e" class="pw-post-body-paragraph lg lh iq lj b lk ll jr lm ln lo ju lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">我对你如何看待COVID在你的模型中的影响也很感兴趣，欢迎在下面发表评论。</p><p id="b841" class="pw-post-body-paragraph lg lh iq lj b lk ll jr lm ln lo ju lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">保持积极，感谢阅读！</p><h1 id="b567" class="ng mm iq bd nh ni nj nk nl nm nn no np jw nq jx nr jz ns ka nt kc nu kd nv nw bi translated">参考</h1><ol class=""><li id="e685" class="ms mt iq lj b lk nx ln ny md ov me ow mf ox mc oy my mz na bi translated">泰勒SJ，勒撒姆B. 2017。大规模预测。PeerJ预印本5:e 3190v 2<a class="ae kv" href="https://doi.org/10.7287/peerj.preprints.3190v2" rel="noopener ugc nofollow" target="_blank">https://doi.org/10.7287/peerj.preprints.3190v2</a></li></ol></div></div>    
</body>
</html>