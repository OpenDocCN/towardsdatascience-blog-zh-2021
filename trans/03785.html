<html>
<head>
<title>3 lesser-known pipe operators in Tidyverse</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Tidyverse三家不太知名的管道运营商</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-lesser-known-pipe-operators-in-tidyverse-111d3411803a?source=collection_archive---------18-----------------------#2021-03-29">https://towardsdatascience.com/3-lesser-known-pipe-operators-in-tidyverse-111d3411803a?source=collection_archive---------18-----------------------#2021-03-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9a4f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用于干净代码编写的三通、展示和赋值管道操作符</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d53b6627ce2c765bdaba669073df12d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ePPv3TRmQFi2mBQO"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@martinadams?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马丁·亚当斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="d190" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了托管Tidyverse社区使用的主要管道操作符%&gt;%之外，Tidyverse中的magrittr包还托管了其他一些管道操作符。%&gt;%管道广泛用于数据操作，并由Tidyverse自动加载。</p><p id="f127" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">管道运算符用于执行多个操作，这些操作需要前一个操作的输出作为输入参数。因此，执行从左边开始，将数据作为第一个参数传递给右边的函数，依此类推。这样，一系列数据操作可以在一个步骤中完成。</p><p id="24a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，这里我们将讨论magrittr包中的其他三个管道操作符。讨论主管操作员失败的领域以及这些功能如何补充它。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="83f0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">三通管</h1><p id="97b5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">三通管操作符<code class="fe mz na nb nc b">%T&gt;%</code>的工作方式几乎和<code class="fe mz na nb nc b">%&gt;%</code>操作符一样，除了一系列操作中有一个操作没有返回值的情况。当我们在一系列操作中使用print()或plot()函数时，t形管道操作符是很有用的，这些操作不一定在序列的末尾。由于print()和plot()函数不返回任何值，在这种情况下，我们可以使用<code class="fe mz na nb nc b">%T&gt;%</code>操作符，在print()/plot()操作之后使用最后一个要分配给该操作的参数值。让我们看一个例子，在这个例子中，我们使用主管操作符<code class="fe mz na nb nc b">%&gt;%</code>编写了一系列操作。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="c41e" class="nh md it nc b gy ni nj l nk nl"># sequence of operations using main pipe operator<br/>rnorm(100) %&gt;% <br/>  matrix(ncol=2) %&gt;% <br/>  sin() %&gt;% <br/>  plot() %&gt;% <br/>  colSums()</span><span id="6fce" class="nh md it nc b gy nm nj l nk nl"># output<br/>Error in colSums(.) : 'x' must be an array of at least two dimensions</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/aa279a92410b6e242bb4918a717791e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*Qas340qum16HQt0xgnmjYQ.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="f7e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以在上面的操作中，我们看到在执行colSums()函数时出现了一个错误。这是因为plot()函数不返回值。为了解决这个问题，我们将在plot()函数之前使用tee pipe运算符。这样做的目的是将sin()函数的值作为参数传递给plot()和colSums()函数，从而保持信息流。</p><p id="670a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用三通管道操作符重做上面的例子。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="e4d5" class="nh md it nc b gy ni nj l nk nl"># using tee pipe operator<br/>rnorm(100) %&gt;% <br/>  matrix(ncol=2) %&gt;% <br/>  sin() %T&gt;% <br/>  plot() %&gt;% <br/>  colSums()</span><span id="177d" class="nh md it nc b gy nm nj l nk nl"># output<br/>[1]  2.372528 -4.902566</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/621c774ad93d93cd1ca47fc199e25173.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*dzb5s3ZWQI3Mj-Ix4qvTCw.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="489e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从上面的例子中我们可以看到，使用tee pipe操作符可以执行完整的操作序列。</p><h1 id="d25f" class="mc md it bd me mf no mh mi mj np ml mm jz nq ka mo kc nr kd mq kf ns kg ms mt bi translated">暴露管道</h1><p id="c719" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Exposition pipe操作符<code class="fe mz na nb nc b">%$%</code>将左边数据框的变量名公开为右边函数中的匹配参数名。在base R中的一些函数中，没有<code class="fe mz na nb nc b">data =…</code>参数。所以要从数据框中引用一个变量，我们必须使用$操作符作为<code class="fe mz na nb nc b">dataframe$variable1</code>等等。因此，在这些情况下，我们要处理多个变量，然后我们必须重复使用$符号的过程，同时重复数据框名称。为了避免这种情况，我们可以使用exposition管道。让我们使用cor()和lm()函数来理解exposition pipe的用法。我们将使用来自base R的mtcars数据集。</p><p id="ad63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">例1使用lm()函数</strong></p><p id="233c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用%&gt;%运算符</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="2662" class="nh md it nc b gy ni nj l nk nl">mtcars %&gt;% lm(formula = disp~mpg)</span><span id="7c04" class="nh md it nc b gy nm nj l nk nl"># output<br/>Call:<br/>lm(formula = disp ~ mpg, data = .)<br/><br/>Coefficients:<br/>(Intercept)          mpg  <br/>     580.88       -17.43</span></pre><p id="1624" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用%$%运算符</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="66ee" class="nh md it nc b gy ni nj l nk nl">mtcars %$% lm(formula = disp~mpg)</span><span id="ea29" class="nh md it nc b gy nm nj l nk nl"># output<br/>Call:<br/>lm(formula = disp ~ mpg, data = .)<br/><br/>Coefficients:<br/>(Intercept)          mpg  <br/>     580.88       -17.43</span></pre><p id="504c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">例2使用cor()函数</strong></p><p id="26b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用%&gt;%运算符(案例1)</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="06cd" class="nh md it nc b gy ni nj l nk nl">mtcars %&gt;% cor(disp,mpg)</span><span id="cd42" class="nh md it nc b gy nm nj l nk nl"># output<br/>Error in cor(., disp, mpg) : invalid 'use' argument<br/>In addition: Warning message:<br/>In if (is.na(na.method)) stop("invalid 'use' argument") :<br/>  the condition has length &gt; 1 and only the first element will be used</span></pre><p id="1b9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用%&gt;%运算符(案例2)</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="5951" class="nh md it nc b gy ni nj l nk nl">cor(mtcars$disp,mtcars$mpg)</span><span id="087d" class="nh md it nc b gy nm nj l nk nl"># output<br/>[1] -0.8475514</span></pre><p id="01f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用%$%运算符</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="65aa" class="nh md it nc b gy ni nj l nk nl">mtcars %$% cor(disp, mpg)</span><span id="90b6" class="nh md it nc b gy nm nj l nk nl"># output<br/>[1] -0.8475514</span></pre><p id="6f43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在示例1中，我们看到，无论使用哪种类型的管道操作符，使用两个不同管道的两个操作都工作得非常好。但是在示例2中，%&gt;%操作符和%$%操作符的情况2是有效的。<strong class="lb iu"> <em class="nt">这里的关键区别在于lm()和cor()函数的参数类型。</em></strong>lm()函数有数据作为参数之一，但cor()函数没有。因此，% &gt; %和%$%管道操作符可以很好地使用lm()函数。对于cor()函数的情况，因为参数不是x就是y(查看文档)。因此，我们必须通过将x和y参数定义为mtcars$disp和mtcars$mpg来明确告诉x和y值来自mtcars数据帧。因此，为了避免mtcars数据帧的重复，我们可以直接使用%$%管道操作符。</p><h1 id="1821" class="mc md it bd me mf no mh mi mj np ml mm jz nq ka mo kc nr kd mq kf ns kg ms mt bi translated">分配管道</h1><p id="8876" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">最后一个鲜为人知的管道是赋值管道<code class="fe mz na nb nc b">%&lt;&gt;%</code>。当变量在经过某些操作后被赋值给自身时，使用管道。让我们看一个例子</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="c590" class="nh md it nc b gy ni nj l nk nl">a &lt;- a %&gt;% cos() %&gt;% sin()</span><span id="6da4" class="nh md it nc b gy nm nj l nk nl"># using assignment operator<br/>a %&lt;&gt;% cos() %&gt;% sin()</span></pre><p id="69f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，通过使用赋值管道操作符，我们可以删除赋值操作符<code class="fe mz na nb nc b">&lt;-</code>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d9a6" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="faa9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们探索了三个不太知名的管道操作符:tee、exposition和assignment管道，来自Tidyverse的magrittr package。此外，我们在不同的设置中实现了这些管道操作符，以了解它们如何补充主要管道操作符%&gt;%的功能。</p><p id="21d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当一系列操作具有不返回值的函数时，三通管道%T&gt;%非常有用。在exposition pipe % $ %的情况下，它们对于没有数据作为参数的base R函数来说非常方便。而赋值管道% &lt;&gt; %，在一系列操作后将变量赋值给自身时，避免了重复。</p><p id="1444" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。我希望你喜欢管道的功能。如果您有任何反馈，请告诉我。</p><h2 id="ac1e" class="nh md it bd me nu nv dn mi nw nx dp mm li ny nz mo lm oa ob mq lq oc od ms oe bi translated">参考资料:</h2><ol class=""><li id="28a9" class="of og it lb b lc mu lf mv li oh lm oi lq oj lu ok ol om on bi translated"><a class="ae ky" href="https://magrittr.tidyverse.org/articles/magrittr.html" rel="noopener ugc nofollow" target="_blank">https://magrittr.tidyverse.org/articles/magrittr.html</a></li><li id="ad0d" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated">https://r4ds.had.co.nz/pipes.html<a class="ae ky" href="https://r4ds.had.co.nz/pipes.html" rel="noopener ugc nofollow" target="_blank"/></li><li id="583f" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated">【https://magrittr.tidyverse.org/reference/exposition.html T4】</li></ol><p id="a24c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在<a class="ae ky" href="https://www.linkedin.com/in/abhinav-malasi/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae ky" href="https://twitter.com/malasi_abhinav" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上与我联系，跟随我的数据科学和数据可视化之旅。</p></div></div>    
</body>
</html>