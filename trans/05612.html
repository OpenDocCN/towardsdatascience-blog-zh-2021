<html>
<head>
<title>Take your SQL from Good to Great: Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让您的SQL从优秀走向卓越:第2部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/take-your-sql-from-good-to-great-part-2-cb03b1b7981b?source=collection_archive---------4-----------------------#2021-05-19">https://towardsdatascience.com/take-your-sql-from-good-to-great-part-2-cb03b1b7981b?source=collection_archive---------4-----------------------#2021-05-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c609" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当你打电话时，并不总是在那里，但总是准时。</p><p id="502d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是关于我最看重的SQL“技巧”的4部分系列的第2部分。查看该系列中的其他内容:</p><p id="fea7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一部分:<a class="ae km" rel="noopener" target="_blank" href="/take-your-sql-from-good-to-great-part-1-3ae61539e92a">常见的餐桌用语</a></p><p id="a249" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第2部分:所有关于这些日期的内容</p><p id="237e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第三部分:<a class="ae km" rel="noopener" target="_blank" href="/take-your-sql-from-good-to-great-part-3-687d797d1ede">其他加入</a></p><p id="f80d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第四部分:<a class="ae km" rel="noopener" target="_blank" href="/take-your-sql-from-good-to-great-part-4-99a55fd0e7ff">窗口功能</a></p><p id="c5f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">您对一个被低估的SQL技巧有什么建议吗？</em> <a class="ae km" href="mailto:hello@count.co" rel="noopener ugc nofollow" target="_blank"> <em class="kl">让我知道</em> </a> <em class="kl">！</em></p><p id="9b87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，现在我们来看主要事件:</p><h1 id="9ac6" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">SQL中的日期和时间⏰</h1><p id="54d0" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">无论您编写SQL有多长时间，处理日期和时间从来都不是一项受欢迎的任务。它们非常棘手，会在你最意想不到的时候耽误你几个小时。</p><p id="596d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，在这一期的系列文章中，我将介绍一些有用的日期/时间“技巧”,新手和专家都可以从中受益。</p><h1 id="2448" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">行动卡🎮</h1><p id="b665" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">在深入研究代码之前，评估一下我们可以使用的高级工具是很重要的。这就像玩棋盘游戏<a class="ae km" href="https://en.wikipedia.org/wiki/Pandemic_(board_game)" rel="noopener ugc nofollow" target="_blank">疫情</a>(太快了？)，并且让你的角色的动作牌总是可见，这样你就能在每一回合都被提醒该做什么动作。</p><p id="569d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是我们的SQL日期/时间操作卡，包括我们可以在日期/时间执行的操作。在每个is动作中有一系列单独的函数和语法，但是在这个高层次上计划我们的分析是有帮助的。</p><p id="1ba5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，如果您有一些带有字符串日期列的销售数据，而您的老板想要查看季度合计，您将需要:</p><ol class=""><li id="c393" class="lq lr iq jp b jq jr ju jv jy ls kc lt kg lu kk lv lw lx ly bi translated"><strong class="jp ir">将字符串解析成日期(“2020 01 10”➡️2020–01–10)</strong></li><li id="10f2" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">将日期截短为每个季度的开始日期(2020年1月10日➡️ 2020年1月1日)</li><li id="e38d" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">将这些日期以图表或表格的形式显示出来(2020年1月1日➡️“2020年第一季度”)</li></ol><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi me"><img src="../Images/fcba45a56d7e474c8daa1966d66b17fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-GC2kX_SlL_GMakSjeKkEg.png"/></div></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">SQL日期/时间动作卡。图片作者。</p></figure><p id="9879" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">SQL的每一种方言都有自己的函数来执行这些操作，可悲的是，还有自己的语法。因此，我不会煞费苦心地详细介绍每一个动作，而是将您引向以下指南:</p><ul class=""><li id="fb0c" class="lq lr iq jp b jq jr ju jv jy ls kc lt kg lu kk mu lw lx ly bi translated"><a class="ae km" href="https://count.co/sql-resources/bigquery-standard-sql/dates-and-times" rel="noopener ugc nofollow" target="_blank">big query中的日期和时间</a></li><li id="cf83" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk mu lw lx ly bi translated"><a class="ae km" href="https://count.co/n/Vo8Sn9DLQ8C?vm=e" rel="noopener ugc nofollow" target="_blank">雪花中的日期和时间</a></li></ul><h1 id="aad6" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">我的MVHs(最有价值的黑客)🏆</h1><p id="63ea" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">好了，现在有趣的部分——什么是实际的、有用的技巧。以下是我最喜欢的日期/时间“黑客”列表:</p><h2 id="7c5f" class="mv ko iq bd kp mw mx dn kt my mz dp kx jy na nb lb kc nc nd lf kg ne nf lj ng bi translated">1.隐式铸造</h2><p id="e1db" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">大多数数据库都有一种“隐式转换”的感觉，这意味着在某些情况下，你可以键入一个日期字符串(“2020–01–01”)，数据库会自动计算出你想要使用的日期是2020年1月1日。</p><p id="785f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这对于日期列的过滤特别有用。</p><p id="49a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">例如:</strong>下面的查询将获取2017年伦敦的所有天气数据。</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi nh"><img src="../Images/e4fd16ca8bd11ea023674696b87d183a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rMb9FWkq0j7GeNXDRgleTQ.png"/></div></div></figure><p id="f9a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">为什么我喜欢它:</strong> <em class="kl"> </em>如果我们没有这个，我就必须总是将我的字符串转换/解析为日期，或者在过滤时使用提取函数来获得我想要的日期部分。但是对于像这样简单的日期范围，使用字符串格式“YYYY-MM-DD”作为过滤器是我永远不会停止的事情。</p><p id="d836" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ℹ️ <strong class="jp ir">警告:</strong>与我的下一个观点直接冲突的是，大多数数据库都要求这些日期采用标准的ISO格式:“YYYY-MM-DD”，但有些数据库允许你自定义这种格式。</p><h2 id="6e4d" class="mv ko iq bd kp mw mx dn kt my mz dp kx jy na nb lb kc nc nd lf kg ne nf lj ng bi translated">2.放眼全球</h2><p id="17eb" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">作为一个生活在欧洲的美国人，每当我看到2020/10/06这样的日期，我都会有一瞬间的恐慌，我不确定我们是在谈论10月6日还是6月10日。</p><p id="9ee2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">而且，当我看到2020/10/06上午10:00的时候，我更迷茫了。是当地时间上午10点吗？<a class="ae km" href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time" rel="noopener ugc nofollow" target="_blank"> UTC </a>？夏令时？</p><p id="8c82" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">即使您的数据和团队都位于同一时区，考虑如何存储和显示日期和时间也是至关重要的。</p><p id="0be2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了解决这个问题，我喜欢:</p><ol class=""><li id="7d67" class="lq lr iq jp b jq jr ju jv jy ls kc lt kg lu kk lv lw lx ly bi translated">始终使用UTC时间戳，如果需要，为时区调整的日期和时间创建新列</li><li id="caa5" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk lv lw lx ly bi translated">当显示日期时，我总是在最后一步将日期重新格式化为:年月日(2020年10月6日)。(但我知道，世界上大多数国家可能会有不同的做法😂)</li></ol><p id="affc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">示例</strong>:在对我的<a class="ae km" href="https://count.co/n/wgTgjkXGhAK" rel="noopener ugc nofollow" target="_blank">网飞数据</a>的分析中，每个程序的开始时间都以UTC时间戳的形式给出。但是为了计算出一天中我看电视最多的时间，我需要将它转换成当地时间。</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi ni"><img src="../Images/a4087830ed398f19b1e8de2d11da3ebf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ObEzFmX6CFQBSrM2HGhkFw.png"/></div></div><p class="mq mr gj gh gi ms mt bd b be z dk translated">标准化我的全局时间戳的格式。</p></figure><p id="c685" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">我喜欢它的原因:</strong> <em class="kl"> </em>让我安心地看到用UTC、<strong class="jp ir">和</strong>当地时间表示的日期和时间，这样我就可以选择如何处理每个问题。</p><p id="0884" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ℹ️ <strong class="jp ir">警告:</strong>每个工具都有不同的默认日期显示方式。例如，在许多BI工具中，时间戳会自动调整为本地时间，因此您定制的转换可能是多余的。如果有疑问，请更改您的计算机时区，看看查询输出是否会改变！</p><h2 id="25d5" class="mv ko iq bd kp mw mx dn kt my mz dp kx jy na nb lb kc nc nd lf kg ne nf lj ng bi translated">3.生成日期</h2><p id="ec1a" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">如果我想知道事情什么时候没有发生，而不是在我们的数据集中找出事情发生的时间，会怎么样？那个用户<em class="kl">不是</em>什么时候用过我们的app？</p><p id="ddc3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种工作需要一组完全不来自我们数据的统一日期。</p><p id="37d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">这在做队列分析时特别有用。</strong></p><p id="e56a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">例子</strong>:假设我想知道在给定的时间段内(包括我不看任何网飞的时候)，我每天看了多少小时的电视。我需要生成我想看到的日期，然后将其加入我的网飞数据。当我那天没有看任何电视时，该日期应该会出现一个空值:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi nj"><img src="../Images/8fc227ebe27efae21030445309b860e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E2ovrjBX1bb0UkVmOHAB_Q.png"/></div></div></figure><p id="93dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我喜欢它的原因:发现某件事情<em class="kl">没有</em>发生的频率有时就好像并不比它发生的时候更重要。</p><p id="d571" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ℹ️ <strong class="jp ir">警告:</strong>令人烦恼的是，每种SQL语法都有<em class="kl">非常</em>不同的实现方式。</p><p id="1c23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">我错过了一些日期/时间SQL技巧吗？请在评论中告诉我</em>👇</p><h1 id="1f8c" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">进一步阅读</h1><ul class=""><li id="c0a3" class="lq lr iq jp b jq ll ju lm jy nk kc nl kg nm kk mu lw lx ly bi translated"><a class="ae km" href="https://www.postgresql.org/docs/9.1/datatype-datetime.html" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>、<a class="ae km" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/date_functions" rel="noopener ugc nofollow" target="_blank"> BigQuery </a>、<a class="ae km" href="https://docs.snowflake.com/en/sql-reference/functions-date-time.html" rel="noopener ugc nofollow" target="_blank">雪花</a>、<a class="ae km" href="https://docs.aws.amazon.com/redshift/latest/dg/Date_functions_header.html" rel="noopener ugc nofollow" target="_blank">红移</a>、<a class="ae km" href="https://dev.mysql.com/doc/refman/8.0/en/datetime.html" rel="noopener ugc nofollow" target="_blank"> MySQL </a>的日期/时间文档</li><li id="612f" class="lq lr iq jp b jq lz ju ma jy mb kc mc kg md kk mu lw lx ly bi translated">如果字幕看起来很熟悉，在这里欣赏一些90年代的节拍<a class="ae km" href="https://open.spotify.com/track/5nRdApWHvONcw938MWgc2s?si=f9330cbb8747479e" rel="noopener ugc nofollow" target="_blank"/>。</li></ul></div></div>    
</body>
</html>