<html>
<head>
<title>Build a Player Recommendation System For Cricket Using K-Nearest Neighbor Algorithm</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用K-最近邻算法构建板球运动员推荐系统</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-a-player-recommendation-system-for-cricket-using-k-nearest-neighbor-algorithm-3742d2bfc657?source=collection_archive---------13-----------------------#2021-07-24">https://towardsdatascience.com/build-a-player-recommendation-system-for-cricket-using-k-nearest-neighbor-algorithm-3742d2bfc657?source=collection_archive---------13-----------------------#2021-07-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5b85" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用k-最近邻算法构建简单推荐系统的初学者指南。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cdc41ed9f044edadacae9324e62ef956.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hEqqeteRsDOmPIPd"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@bushmush?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">迈克尔·韦尔</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="e973" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将构建一个简单的板球运动员推荐系统，该系统将根据过去为该队打球的运动员的统计数据，为该队推荐击球手名单。</p><blockquote class="ls lt lu"><p id="9a18" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">我们将只为击球手构建推荐系统，通过计算他们各自的指标，该系统可以扩展到投球手和其他类型的球员。</p></blockquote><h1 id="5257" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">k近邻概述</h1><p id="b665" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">简而言之，k-nearest neighbors (kNN)算法根据任何距离度量找出距离数据点最近的k个邻居。在计算数据点相似性的方式上，它与k-means非常相似。我们将使用kNN算法来推荐最接近当前团队成员的玩家。</p><h1 id="d1b5" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated"><strong class="ak">数据采集</strong></h1><p id="a852" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">用于该系统的数据集是从Kaggle上的<a class="ae kv" href="https://www.kaggle.com/harsha547/indian-premier-league-csv-dataset" rel="noopener ugc nofollow" target="_blank">印度超级联赛CSV数据集</a>下载的。它由6个CSV文件组成，总结了截至IPL第9赛季的577场IPL比赛的逐球信息。</p><h2 id="28db" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">理解数据</h2><p id="c6b7" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我们将使用Pandas来读取以下CSV文件。</p><ol class=""><li id="155a" class="ni nj iq ky b kz la lc ld lf nk lj nl ln nm lr nn no np nq bi translated"><strong class="ky ir"> Ball_by_Ball.csv — </strong>这个文件有比赛中每一个球的数据。我们可以提取前锋和非前锋球员的身份，得分等等。我们将使用这个文件来计算推荐系统的击球手统计数据。</li><li id="9ffc" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated"><strong class="ky ir"> Match.csv — </strong>该文件存储关于比赛的信息，如场地、球队、结果、裁判的详细信息等。我们将需要这个文件来提取一个<code class="fe nw nx ny nz b">Match_Id</code>和<code class="fe nw nx ny nz b">Season_Id</code>之间的关联。</li><li id="7aed" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated"><strong class="ky ir"> Player.csv — </strong>该文件包含所有球员的数据，即他们的姓名、国家、出生日期等。这些字段将用于使用k-最近邻算法构建我们的推荐系统。</li><li id="0c03" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated"><strong class="ky ir"> Player_Match.csv — </strong>该文件将<code class="fe nw nx ny nz b">Player_Id</code>与他们参加过的比赛相关联。我们会用这个文件来了解当前队伍中球员的特点。</li></ol><h1 id="d4a3" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">数据清理</h1><p id="dc01" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我们将创建另一个名为<code class="fe nw nx ny nz b">player_data</code>的数据帧来存储击球手统计数据和来自现有<code class="fe nw nx ny nz b">player</code>数据帧的其他相关特征。由于<code class="fe nw nx ny nz b">player</code>数据帧有两列<code class="fe nw nx ny nz b">Is_Umpire</code>和<code class="fe nw nx ny nz b">unnamed:7</code>，这对我们的用例来说无关紧要，我们将删除它们并将其他列复制到<code class="fe nw nx ny nz b">player_data</code>。</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="360a" class="mw ma iq nz b gy oe of l og oh">player_data = player.drop(["Is_Umpire", "Unnamed: 7"], axis = 1)</span></pre><h1 id="1032" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">特征抽出</h1><h2 id="9310" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">从Match_Id导出赛季</h2><p id="7ca5" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我们将得出每个赛季球员的表现统计。<code class="fe nw nx ny nz b">match</code>数据帧具有字段<code class="fe nw nx ny nz b">Match_Id</code>和<code class="fe nw nx ny nz b">Season_Id</code>，可用于从<code class="fe nw nx ny nz b">Match_Id</code>中导出季节编号。</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="20a1" class="mw ma iq nz b gy oe of l og oh">NUMBER_OF_SEASONS = 9<br/>season_info = pd.DataFrame(columns = ['Season', 'Match_Id_start', 'Match_Id_end'])</span><span id="128a" class="mw ma iq nz b gy oi of l og oh">for season in range(1, NUMBER_OF_SEASONS + 1):<br/>    match_info = match.loc[match['Season_Id'] == season]['Match_Id']<br/>    season_info = season_info.append({<br/>        'Season' : season,<br/>        'Match_Id_start' : match_info.min(), <br/>        'Match_Id_end' : match_info.max()<br/>    }, ignore_index=True)</span></pre><p id="05b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码片段会找到每个季节的<code class="fe nw nx ny nz b">Match_Id</code>的范围。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/874678e9f985a589d529dcbda1434f65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*Bv7RmqtpPN0PQr9c7DjMPw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">每个赛季的Match_Id范围</p></figure><p id="8bf0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基于以上结果，我们将创建一个函数，该函数将基于比赛的id返回正确的赛季号。</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="9329" class="mw ma iq nz b gy oe of l og oh">def get_season_from_match_id(match_id):<br/>    season = season_info.loc[<br/>        (season_info['Match_Id_start'] &lt;= match_id) &amp; <br/>        (season_info['Match_Id_end'] &gt;= match_id)] ['Season']<br/>    # Return the integer value of the season else return -1 if<br/>      season is not found   <br/>    return season.item() if not season.empty else -1</span></pre><h2 id="bbed" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">每个赛季击球成绩的计算</h2><p id="5334" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">根据<code class="fe nw nx ny nz b">ball_by_ball</code>数据，我们将计算每个赛季所有球员的以下特征:</p><ol class=""><li id="c2d0" class="ni nj iq ky b kz la lc ld lf nk lj nl ln nm lr nn no np nq bi translated">得分得分</li><li id="a319" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">玩的局数</li><li id="0b49" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">玩家没有出局的局数</li><li id="c777" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">面对球</li><li id="1f8d" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">四的数量</li><li id="73e0" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">六的数量</li></ol><p id="c675" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">计算得分、面对的球数、4分和6分的数量非常简单。在<code class="fe nw nx ny nz b">ball_by_ball</code>数据框中，我们可以简单地检查<code class="fe nw nx ny nz b">Striker_Id</code>和<code class="fe nw nx ny nz b">Batsman_Scored</code>列中的值，并相应地增加这些特征。</p><p id="b71a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">难点在于计算每个赛季打的局数和球员没有出局的局数。为此，我们不仅需要查看数据帧中的当前行，还需要查看前一行。在下列情况下，玩家的局数应该增加:</p><ol class=""><li id="b2de" class="ni nj iq ky b kz la lc ld lf nk lj nl ln nm lr nn no np nq bi translated"><code class="fe nw nx ny nz b">Match_Id</code>前一个球与当前球不同。这意味着当前行属于新的比赛，因此新的一局将开始。我们将增加射手和非射手的局数。</li><li id="59c3" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated"><code class="fe nw nx ny nz b">Match_Id</code>与前一个和当前焊球相同，但<code class="fe nw nx ny nz b">Innings_Id</code>发生变化。这意味着这是同一场比赛的第二局。我们将增加射手和非射手的局数。</li><li id="198b" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">前一个球和当前球中的<code class="fe nw nx ny nz b">Match_Id</code>和<code class="fe nw nx ny nz b">Innings_Id</code>相同，但当前的<code class="fe nw nx ny nz b">Striker_Id</code>不等于前一个<code class="fe nw nx ny nz b">Striker_Id</code>或<code class="fe nw nx ny nz b">Non_Striker_Id</code>。这意味着有新的玩家来击球了，所以我们将只为id等于<code class="fe nw nx ny nz b">Striker_Id</code>的玩家增加局数。类似的逻辑也适用于电流<code class="fe nw nx ny nz b">Non_Striker_Id.</code></li></ol><p id="cf75" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还将跟踪<code class="fe nw nx ny nz b">Player_dismissed</code>列，找出玩家是否在特定的一局中没有出局。</p><h2 id="cfd3" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">击球统计的计算</h2><p id="2f55" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">最后一步是计算击球统计数据，如<strong class="ky ir">击球命中率(BSR) </strong>、<strong class="ky ir">击球率(BA) </strong>和<strong class="ky ir">每局边界得分(BRPI) </strong>。首先每个赛季计算BSR、BA和BRPI，然后根据球员参加的赛季数计算这些值的平均值。在计算平均指标时，只考虑击球手实际打过的那些赛季。这消除了对过去所有赛季都参加过比赛的球员的偏见。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/11a8ae0e75569bbb2a7a38a1ba9a9def.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*x9qvHrDwISNV47cZYUuM2Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">每个赛季平均击球率的计算</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/6b60ed84a4e6138961edff2c1ab1fbde.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/1*wOCFixITTdyAbkFwY2Kljg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">每季击球命中率的计算</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi om"><img src="../Images/7628ffb9f78090355ce9677e9679adcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*TMrBbDPhAYzHqi1nYWKujA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">每个赛季每局边界得分的计算</p></figure><p id="36d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦我们计算了这些统计数据，我们还可以得出球员的年龄，以及他们是国内还是国际球员。这些属性很重要，因为假设目前超过40岁的球员不会参加下个赛季的比赛。此外，由于在IPL球队中选择国际球员的限制，国内球员的属性将很重要。</p><h1 id="3f90" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">K-最近邻的实现</h1><p id="b683" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">对于k-最近邻的实现，我们将使用scikit learn并构建一个numpy数组，其中只有那些特征有助于团队选择，即BA、BSR、BRPI、年龄和国籍。</p><p id="078a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">x是代表这些特征的numpy数组。</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="1411" class="mw ma iq nz b gy oe of l og oh">from sklearn.neighbors import NearestNeighbors</span><span id="52c0" class="mw ma iq nz b gy oi of l og oh">nbrs = NearestNeighbors(n_neighbors=3, algorithm='ball_tree').fit(X)<br/>distances, indices = nbrs.kneighbors(X)</span></pre><p id="ffb5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nw nx ny nz b">indices</code>将给出x中每一行的最近邻的索引</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi on"><img src="../Images/f26399fcbb1f51e72db646a7d2f67f74.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*NrJuZWmUBbW_wt_3f29VNw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">前几个玩家和他们最近的邻居的可视化。节点号是玩家的id</p></figure><p id="6f1c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于在当前赛季中在特定球队中比赛的所有球员，kNN将返回与现有球员相似的3个最近邻居。</p><blockquote class="ls lt lu"><p id="17b2" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">在建议的3个玩家中，第一个玩家将与现有玩家相同，因为玩家与自己的距离为0。</p></blockquote><p id="22d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所有推荐的玩家都被添加到有序集合中，并按照最高BSR到最低排序。我们可以编程返回前<em class="lv"> n </em>个击球手，其中<em class="lv"> n </em>可以根据需要更改。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/3e214e888486e19eab3c61e9992597ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HPZ-uTY8jfQRwWTl-75H1A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">最终输出推荐15名球员按击球命中率排序。</p></figure><p id="a0aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是击球手推荐系统的一个非常简单的实现。你可以在这里查看代码<a class="ae kv" href="https://github.com/shivaneej/Batsmen-Recommendation-System" rel="noopener ugc nofollow" target="_blank">的GitHub库。感谢您的阅读！:)</a></p></div></div>    
</body>
</html>