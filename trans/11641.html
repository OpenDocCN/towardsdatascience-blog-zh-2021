<html>
<head>
<title>Adding Metadata to PyTorch Lite Models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向 PyTorch Lite 模型添加元数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/adding-metadata-to-pytorch-lite-models-4d6fa45a6354?source=collection_archive---------26-----------------------#2021-11-17">https://towardsdatascience.com/adding-metadata-to-pytorch-lite-models-4d6fa45a6354?source=collection_archive---------26-----------------------#2021-11-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="db0c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">PyTorch 允许您将附加元数据与 lite 解释器模型文件相关联。本文探讨了如何使用 Python 和 C++ API 添加/检索模型元数据。</h2></div><h2 id="1e62" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">PyTorch (Lite)模型的结构</h2><p id="4b72" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">PyTorch Lite 模型基本上是包含大部分未压缩文件的 ZIP 存档。另外，PyTorch Lite 模型也是普通的<a class="ae lu" href="https://pytorch.org/docs/stable/jit.html" rel="noopener ugc nofollow" target="_blank"> TorchScript </a>序列化模型。也就是说，用户可以使用<a class="ae lu" href="https://pytorch.org/docs/stable/generated/torch.jit.load.html" rel="noopener ugc nofollow" target="_blank"> torch.jit.load </a>加载 PyTorch Lite 模式作为普通 TorchScript 模式。</p><p id="2736" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">下图显示了 PyTorch Lite 模型文件的外观，以及它存储了哪些高级组件。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ma"><img src="../Images/b62f1d0b6402bf164eeaada33c6297d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G_qSn_Eo_m1JXEa6KyGNVw.png"/></div></div><p class="mm mn gj gh gi mo mp bd b be z dk translated">PyTorch Lite 模型的格式(ZIP 文件)</p></figure><p id="01a5" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">以下是每个组件的含义:</p><ol class=""><li id="5506" class="mq mr iq ld b le lv lh lw ko ms ks mt kw mu lt mv mw mx my bi translated">常数:对应 TorchScript 模型的序列化张量。其中一些与 Lite 模型零件共享。</li><li id="468f" class="mq mr iq ld b le mz lh na ko nb ks nc kw nd lt mv mw mx my bi translated">代码:火炬文字代码。</li><li id="d043" class="mq mr iq ld b le mz lh na ko nb ks nc kw nd lt mv mw mx my bi translated"><strong class="ld ir"> extra </strong>:与模型关联的 extra(附加)元数据文件。</li><li id="b42f" class="mq mr iq ld b le mz lh na ko nb ks nc kw nd lt mv mw mx my bi translated">字节码:只对应于 lite 模型的序列化张量+为移动 Lite 解释器序列化字节码。</li></ol><h2 id="77d4" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">在模型生成过程中向 Lite 模型添加元数据</h2><p id="d64a" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">一旦你有了 PyTorch 模型(Python 类)，你可以把它保存为<a class="ae lu" rel="noopener" target="_blank" href="/deep-learning-on-your-phone-pytorch-lite-interpreter-for-mobile-platforms-ae73d0b17eaa"> PyTorch Lite 格式</a>。PyTorch Lite 格式的模型可以加载到移动设备上进行推理。</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="02d6" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">因为 PyTorch Lite 模型基本上是一个 zip 文件，所以可以使用<a class="ae lu" href="https://docs.python.org/3/library/zipfile.html" rel="noopener ugc nofollow" target="_blank"> <em class="ng"> zipfile </em> </a> Python 模块来检查序列化模型文件的内容。</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h2 id="d4a0" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">查看与 Lite 模型相关联的元数据</h2><p id="e51a" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">还可以使用<a class="ae lu" href="https://docs.python.org/3/library/zipfile.html#zipfile.ZipFile.read" rel="noopener ugc nofollow" target="_blank"><em class="ng">zipfile . read()</em></a>方法查看 PyTorch Lite 模块中某个文件的内容。</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h2 id="293a" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">在模型生成后向模型添加额外的元数据</h2><p id="a7e9" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">因为 PyTorch Lite 模型基本上是一个 zip 文件，所以在保存模型之后，很容易向模型添加额外的元数据文件。您所需要做的就是知道顶层文件夹的名称，然后使用 Python 的<em class="ng"> zipfile </em>模块将文件添加到 zip 存档中。</p><p id="abe3" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">获取档案名称。</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="71f0" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">将新文件添加到 zip 存档中。</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="da1b" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">列出模型的内容，并打印新添加文件的内容。</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h2 id="d59c" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">使用 C++ API 从 Lite 模型中获取元数据</h2><p id="3175" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">PyTorch C++ API 还提供了一种获取与模型一起保存的定制元数据的方法。</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="c2d1" class="pw-post-body-paragraph lb lc iq ld b le lv jr lg lh lw ju lj ko lx ll lm ks ly lo lp kw lz lr ls lt ij bi translated">关于如何在移动平台上使用 PyTorch C++ API 的更详细的帖子，请参见<a class="ae lu" href="https://www.kdnuggets.com/2021/11/deep-learning-mobile-phone-pytorch-c-api.html" rel="noopener ugc nofollow" target="_blank">这篇帖子</a>。</p><h2 id="9819" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结论</h2><p id="49c8" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">我们看到了如何用 Python 和 C++从 PyTorch Lite 模型中添加/获取元数据。同样的策略也适用于 PyTorch TorchScript 模型。其他 AI 框架如<a class="ae lu" href="https://www.tensorflow.org/lite/convert/metadata" rel="noopener ugc nofollow" target="_blank"> TFLite 也支持模型元数据</a>。</p></div></div>    
</body>
</html>