<html>
<head>
<title>How To Parse Data Using Ruby and Selenium</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Ruby和Selenium解析数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-parse-data-using-ruby-and-selenium-5cf11605340c?source=collection_archive---------19-----------------------#2021-08-25">https://towardsdatascience.com/how-to-parse-data-using-ruby-and-selenium-5cf11605340c?source=collection_archive---------19-----------------------#2021-08-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4525" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解硒的基础知识</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cedca91afe9dae3ea9bacfdde8af18b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FwrpjsZ_eT5HvaVq"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@nci?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">国立癌症研究所</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="70b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated">人工测试可能效率低下且容易出错。但是，它可以通过自动化消除。Selenium是一个自动化测试的开源自动化工具。例如，我们可以用它来测试web应用程序。</p><p id="a03c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将使用Selenium ( <a class="ae ky" href="https://rubygems.org/gems/selenium-webdriver" rel="noopener ugc nofollow" target="_blank"> Ruby </a>和<a class="ae ky" href="https://chromedriver.chromium.org/" rel="noopener ugc nofollow" target="_blank"> Chrome </a>来解析数据。我们将使用一个名为<code class="fe me mf mg mh b">selenium-webdriver</code>的ruby gem，它为Selenium和ChromeDriver提供ruby绑定来使用Chrome web浏览器。Selenium拥有对C#、Python、JavaScript和Java的支持。而且支持的平台有Firefox，Internet Explorer，Safari，Opera，Chrome，Edge。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="634e" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">设置</h1><p id="6b45" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">首先，我们需要安装一个ruby gem和ChromeDriver。对于这个设置，我使用的是macOS。如果你的机器上没有安装Ruby，那么从<a class="ae ky" href="https://www.ruby-lang.org/en/downloads/" rel="noopener ugc nofollow" target="_blank">这里</a>获取。</p><p id="2d36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您的终端中运行以下命令。</p><pre class="kj kk kl km gt nm mh nn bn no np bi"><span id="bd3d" class="nq mq it mh b be nr ns l nt nu">gem install selenium-webdriver</span></pre><p id="9a13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，在您的终端中运行以下命令来安装ChromeDriver。在这里，我使用<a class="ae ky" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">自制软件</a>来安装驱动程序。</p><pre class="kj kk kl km gt nm mh nn bn no np bi"><span id="82da" class="nq mq it mh b be nr ns l nt nu">brew install chromedriver</span></pre><p id="8a2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你在初始设置时遇到任何问题，看看我的<a class="ae ky" href="https://github.com/lifeparticle/Ruby-Cheatsheet/tree/master/Scripts/web_scraper" rel="noopener ugc nofollow" target="_blank"> GitHub </a>或者使用错误信息来解决问题。好了，我们可以走了。你可以从<a class="ae ky" href="https://raw.githubusercontent.com/lifeparticle/Ruby-Cheatsheet/master/Scripts/web_scraper/web_scraper.rb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>下载以下代码。让我们来分解一下<code class="fe me mf mg mh b">web_scraper.rb</code>文件的各个成分。在这篇文章中，我们将从名为<a class="ae ky" href="https://toscrape.com/" rel="noopener ugc nofollow" target="_blank"> toscrape </a>的网站收集数据。这是一个网页抓取沙盒。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="516a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们用一个无头的chrome浏览器初始化我们的selenium WebDriver。</p><pre class="kj kk kl km gt nm mh nn bn no np bi"><span id="ab7e" class="nq mq it mh b be nr ns l nt nu">def init_selenium_webdriver<br/> options = Selenium::WebDriver::Chrome::Options.new<br/> options.add_argument('--headless')<br/> return Selenium::WebDriver.for :chrome, options: options<br/>end</span></pre><p id="9092" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们有了将用来解析数据的URL。这里，我们从第一页开始。在循环内部，我们使用驱动程序、URL和页码来导航网页。</p><pre class="kj kk kl km gt nm mh nn bn no np bi"><span id="6f7b" class="nq mq it mh b be nr ns l nt nu">def main<br/> driver = init_selenium_webdriver<br/> url = "http://quotes.toscrape.com/page/"<br/> page_no = 1<br/> loop do<br/>  navigate(driver, url, page_no)<br/>  data = get_data(driver, {class_name: 'quote'})<br/>  parse_data(data, {text: {class_name: 'text'}, author: {class_name: 'author'}})<br/>  page_no += 1<br/>  break unless has_data?(data)<br/> end<br/> driver.quit<br/>end</span></pre><p id="efc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe me mf mg mh b">navigate</code>方法中，我们使用基本URL和页码构建最终的URL。</p><pre class="kj kk kl km gt nm mh nn bn no np bi"><span id="872a" class="nq mq it mh b be nr ns l nt nu">def navigate(driver, url, page_no)<br/> driver.navigate.to URI.join(url, page_no.to_s)<br/>end</span></pre><p id="6c2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用<code class="fe me mf mg mh b">get_data</code>方法从<code class="fe me mf mg mh b">navigate</code>方法返回的数据中提取报价。<code class="fe me mf mg mh b">find_elements</code>方法将返回所有匹配给定参数的元素。</p><pre class="kj kk kl km gt nm mh nn bn no np bi"><span id="1130" class="nq mq it mh b be nr ns l nt nu">def get_data(driver, pattern)<br/> return driver.find_elements(pattern)<br/>end</span></pre><p id="d08b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，我们遍历所有报价，使用<code class="fe me mf mg mh b">parse_data</code>方法在控制台中打印单个报价信息。<code class="fe me mf mg mh b">find_element</code>方法将返回匹配给定参数的第一个元素。你可以在这里阅读更多相关信息<a class="ae ky" href="https://www.selenium.dev/selenium/docs/api/rb/Selenium/WebDriver/SearchContext.html#find_element-instance_method" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="kj kk kl km gt nm mh nn bn no np bi"><span id="38ca" class="nq mq it mh b be nr ns l nt nu">def parse_data(data, pattern)<br/> data.each do |quote|<br/>  text = quote.find_element(pattern[:text]).text<br/>  author = quote.find_element(pattern[:author]).text<br/>  puts "#{text} -- #{author}"<br/> end<br/>end</span></pre><p id="c06b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成此步骤后，我们将页码增加1，并对页码2重复此过程。最后，我们将增加页码，直到没有需要解析的引号。</p><pre class="kj kk kl km gt nm mh nn bn no np bi"><span id="3b95" class="nq mq it mh b be nr ns l nt nu">def has_data?(data)<br/> return data.size() &gt; 0<br/>end</span></pre></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="1bb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太棒了，现在您知道如何使用Selenium解析数据了。继续尝试使用不同的导航技术解析数据，比如<a class="ae ky" href="https://quotes.toscrape.com/scroll" rel="noopener ugc nofollow" target="_blank">滚动</a>。我希望你从这篇文章中学到了一些新的东西。如果你有兴趣了解Ruby，那么可以在GitHub 上查看我的Ruby Cheatsheet。编码快乐！</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="c349" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">看看我关于Ruby的其他帖子</h1><div class="nx ny gp gr nz oa"><a rel="noopener follow" target="_blank" href="/useful-ruby-array-methods-to-manage-your-data-4d2813c63ccf"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">管理数据的有用的Ruby数组方法</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">节省宝贵的时间，高效管理您的数据</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">towardsdatascience.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo ks oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a rel="noopener follow" target="_blank" href="/17-useful-ruby-string-methods-to-clean-and-format-your-data-9c9147ff87b9"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">清理和格式化数据的17个有用的Ruby字符串方法</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">你不写的每一行代码都是你不需要维护的一行代码</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">towardsdatascience.com</p></div></div><div class="oj l"><div class="op l ol om on oj oo ks oa"/></div></div></a></div></div></div>    
</body>
</html>