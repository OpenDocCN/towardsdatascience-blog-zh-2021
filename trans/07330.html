<html>
<head>
<title>30 times Faster Python Function Execution in a Few Lines of Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用几行代码将Python函数的执行速度提高了30倍</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/25x-times-faster-python-function-execution-in-a-few-lines-of-code-4c82bdd0f64c?source=collection_archive---------5-----------------------#2021-07-04">https://towardsdatascience.com/25x-times-faster-python-function-execution-in-a-few-lines-of-code-4c82bdd0f64c?source=collection_archive---------5-----------------------#2021-07-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2296" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Python中多重处理的基本指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2d8ccade314cf13a7ee249ab6725d36f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rfWcN0koMjOWIFS1kTnOTg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="1fbf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Python是一种流行的编程语言，也是数据科学社区中最受欢迎的语言。与其他流行的编程语言相比，Python速度慢主要是因为它的动态特性和多功能性。Python代码在运行时被解释，而不是在编译时被编译成本机代码。</p><p id="b74b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">C语言的执行时间比Python代码快10到100倍。但是，如果比较开发时间，Python比C语言要快。对于数据科学案例研究，开发时间比运行时性能更重要。Python更受数据科学家和数据分析师的青睐，因为它提供了大量的API、框架和包，但是在优化执行方面，它却失败得很惨。</p><p id="dcc2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我们将讨论如何使用多处理模块并行执行自定义Python函数，并进一步比较运行时时间数。</p><h1 id="55f9" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">入门—多重处理:</h1><p id="8e46" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">考虑具有单个处理器的CPU，如果它同时被分配多个任务，它必须连续地中断每个任务并切换到单个任务以保持所有进程继续。对于多核处理器来说，CPU可以在不同的CPU内核中同时执行多个任务，这个概念被称为并行处理。</p><h2 id="abcb" class="mr lv it bd lw ms mt dn ma mu mv dp me lh mw mx mg ll my mz mi lp na nb mk nc bi translated">为什么重要？</h2><p id="baac" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">数据争论、特征工程和数据探索是数据科学模型开发流程中的重要元素。在输入机器学习模型之前，需要对原始数据进行设计和处理。对于小规模数据集，执行在几秒钟内完成，但对于大规模数据集，这将成为一项繁琐的任务。</p><p id="f653" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">并行处理是提高Python程序性能的有效方法。Python有一个多处理模块，让我们能够在CPU的不同内核上并行执行程序。</p><h1 id="8605" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">实施:</h1><p id="d70e" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我们将使用来自<strong class="la iu">多重处理</strong>模块的<code class="fe nd ne nf ng b"><strong class="la iu">Pool</strong></code>类，帮助并行执行针对多个输入值的函数。这个概念被称为数据并行，这是<code class="fe nd ne nf ng b"><strong class="la iu">Pool</strong></code>类的主要目标。</p><blockquote class="nh ni nj"><p id="2e5a" class="ky kz nk la b lb lc ju ld le lf jx lg nl li lj lk nm lm ln lo nn lq lr ls lt im bi translated">我将使用从<a class="ae no" href="https://www.kaggle.com/" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>下载的<a class="ae no" href="https://www.kaggle.com/c/quora-question-pairs" rel="noopener ugc nofollow" target="_blank"> Quora问题对相似性数据集</a>来进一步演示该模块。</p></blockquote><p id="1e58" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上述数据集包含在Quora平台上提问的文本问题。我将在一个Python函数上执行多处理模块，该函数通过删除停用词、删除HTML标签、删除标点符号、词干等来处理文本数据。</p><p id="e6c5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nd ne nf ng b"><strong class="la iu">preprocess()</strong></code>是执行上述文本处理步骤的函数。</p><blockquote class="nh ni nj"><p id="f93e" class="ky kz nk la b lb lc ju ld le lf jx lg nl li lj lk nm lm ln lo nn lq lr ls lt im bi translated">找到托管在我的GitHub上的函数<strong class="la iu">预处理()</strong> 的<a class="ae no" href="https://gist.github.com/satkr7/7d66e00bc2db9742a6c77cbf206af3f9" rel="noopener ugc nofollow" target="_blank">代码片段。</a></p></blockquote><p id="4da2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，让我们使用来自<code class="fe nd ne nf ng b"><strong class="la iu">multiprocessing</strong></code>模块的<code class="fe nd ne nf ng b"><strong class="la iu">Pool</strong></code>类为数据集的不同块并行执行函数。数据集的每个块都将被并行处理。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="b265" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">数据集有537，361条记录或文本问题需要处理。对于大小为50，000的存储桶，数据集被分成11个较小的数据块，这些数据块可以并行处理，以加快程序的执行时间。</p><h1 id="66a2" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">基准测试:</h1><p id="7615" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">经常会出现这样的问题，使用多处理模块后执行速度有多快。我比较了实现数据并行性和一次对整个数据集执行<code class="fe nd ne nf ng b"><strong class="la iu">preprocess()</strong></code>函数后的基准执行时间。</p><blockquote class="nh ni nj"><p id="e5c2" class="ky kz nk la b lb lc ju ld le lf jx lg nl li lj lk nm lm ln lo nn lq lr ls lt im bi translated">性能记录在一个系统上，该系统配有<strong class="la iu"> RAM: 64GB </strong>和<strong class="la iu"> 10个CPU内核</strong>。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4a90b60a5af13d351ba9b100bd1a4fdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oVohEdG41oZ1fPPvarLotg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)，多处理和单处理的执行时间基准测试</p></figure><p id="c784" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从上面的图中，我们可以观察到Python函数的并行处理将执行速度提高了近<strong class="la iu"> 30x </strong>倍。</p><blockquote class="nh ni nj"><p id="a74f" class="ky kz nk la b lb lc ju ld le lf jx lg nl li lj lk nm lm ln lo nn lq lr ls lt im bi translated">你可以在我的<a class="ae no" href="https://gist.github.com/satkr7/1087afdd4291638122186f5741564dd9" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中找到用来记录基准数的<a class="ae no" href="https://gist.github.com/satkr7/1087afdd4291638122186f5741564dd9" rel="noopener ugc nofollow" target="_blank"> Python文件</a>。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/7acfee407456acd1193bebb3d2fd9378.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/1*EhoMr6w24-IRDN11J7eTtQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(GIF by Author)，执行Python文件计算基准数</p></figure><h1 id="21bd" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">结论:</h1><p id="7a4a" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在本文中，我们讨论了Python中多重处理模块的实现，它可以用来加速Python函数的执行。通过添加几行多处理代码，对于具有537k个实例的数据集，执行时间几乎快了30倍。</p><p id="e642" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于处理大型数据集，建议使用并行处理，因为它可以节省大量时间并加快工作流程。</p><p id="bfb7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">参考我关于加速Python工作流的其他文章:</p><ul class=""><li id="1d9e" class="ns nt it la b lb lc le lf lh nu ll nv lp nw lt nx ny nz oa bi translated"><a class="ae no" rel="noopener" target="_blank" href="/4-libraries-that-can-parallelize-the-existing-pandas-ecosystem-f46e5a257809"> 4个可以并行处理现有熊猫生态系统的库</a></li><li id="e5db" class="ns nt it la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated"><a class="ae no" rel="noopener" target="_blank" href="/400x-time-faster-pandas-data-frame-iteration-16fb47871a0a">熊猫数据帧迭代速度快400倍</a></li><li id="1768" class="ns nt it la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated"><a class="ae no" rel="noopener" target="_blank" href="/optimize-pandas-memory-usage-while-reading-large-datasets-1b047c762c9b">为大型数据集优化熊猫的内存使用</a></li><li id="0a4d" class="ns nt it la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated">带PyPolars的熊猫速度快3倍</li></ul><h1 id="571c" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">参考资料:</h1><p id="df44" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">[1]多处理文档:<a class="ae no" href="https://docs.python.org/3/library/multiprocessing.html" rel="noopener ugc nofollow" target="_blank">https://docs.python.org/3/library/multiprocessing.html</a></p></div><div class="ab cl og oh hx oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="im in io ip iq"><p id="26a9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="nk">喜欢这篇文章吗？成为</em> <a class="ae no" href="https://satyam-kumar.medium.com/membership" rel="noopener"> <em class="nk">中等会员</em> </a> <em class="nk">继续无限制学习。如果你使用下面的链接，我会收到你的一小部分会员费，不需要你额外付费。</em></p><div class="on oo gp gr op oq"><a href="https://satyam-kumar.medium.com/membership" rel="noopener follow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd iu gy z fp ov fr fs ow fu fw is bi translated">加入我的推荐链接-萨蒂扬库马尔媒体</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">satyam-kumar.medium.com</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe ks oq"/></div></div></a></div><blockquote class="pf"><p id="a074" class="pg ph it bd pi pj pk pl pm pn po lt dk translated">感谢您的阅读</p></blockquote></div></div>    
</body>
</html>