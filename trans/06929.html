<html>
<head>
<title>Chemical Predictions with 3 lines of code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">三行代码的化学预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/chemical-predictions-with-3-lines-of-code-c4c6a4ce7378?source=collection_archive---------17-----------------------#2021-06-23">https://towardsdatascience.com/chemical-predictions-with-3-lines-of-code-c4c6a4ce7378?source=collection_archive---------17-----------------------#2021-06-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0c12" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Chemprop &amp; graph神经网络的最新结果</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a415db2d74aea7564adc0b67f0726282.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e41iaJ644p2BgIuz22KN4g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由宏向量设计—<a class="ae ky" href="http://www.freepik.com" rel="noopener ugc nofollow" target="_blank">www.freepik.com</a></p></figure><p id="57a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们使用机器学习/人工智能来预测小分子的属性(这项任务被称为<em class="lv"> QSAR </em>)。这是通过使用来自开源库<a class="ae ky" href="https://github.com/chemprop/chemprop" rel="noopener ugc nofollow" target="_blank"> Chemprop </a>的最先进的图形神经网络来完成的。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="e71f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">典型的药物以小分子的形式出现，可以调节我们体内的一些生物过程。不幸的是，在这个过程中可能会出现难以想象的问题；这些化合物可能是有毒的，从我们体内清除非常缓慢，与非预期的其他分子相互作用，等等。因此，我们希望在这些小分子被注射到人体之前，非常仔细地对它们进行检测。</p><p id="b084" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在药物发现的早期阶段，通常在实验室规模的实验中测试小分子的许多不同变体的各种性质，例如溶解度、不同形式的毒性、结合亲和力等。这个过程可能非常费力，所以使用ML来根据已经完成的实验预测这些特性不是很好吗？这项任务在化学信息学中是众所周知的，近年来由于深度学习的进步而受到越来越多的关注。</p><p id="d0f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有大量的库可以进行这种分析。在本文中，我们将使用名为<a class="ae ky" href="https://github.com/chemprop/chemprop" rel="noopener ugc nofollow" target="_blank"> ChemProp </a>的开源库，该库由麻省理工学院的一个研究小组不断更新，它在广泛的基准数据集上取得了出色的结果，同时使用起来极其简单。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="2536" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">输入数据是什么？</h1><p id="3fb0" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">预测化学性质传统上被称为定量结构-活性关系(QSAR)模型。这些模型的输入是分子的字符串表示，也称为“微笑”字符串。例如，这可能看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/19b127ab4a06b5a00b5b67f367fd3687.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*ZZBuBYLqBmxUyMxSab7ZQg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">不同的微笑字符串可以代表同一个分子，但是每个微笑字符串只对应一个分子。作者图片</p></figure><p id="9e95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从本质上讲，我们的数据集由用微笑字符串表示的分子和我们想要预测的每个分子的一组属性组成。这可以看起来如下:属性是一个分子是否被FDA批准和是否通过毒性测试的二元变量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/4a8941e72b2cca1017a460920a3a7410.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*oP0kBO_JR7XJZoFcg1xe3A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">每个样本都是一个分子，由它的微笑字符串和一个或多个属性表示——图片由作者提供。</p></figure><h1 id="265a" class="md me it bd mf mg nc mi mj mk nd mm mn jz ne ka mp kc nf kd mr kf ng kg mt mu bi translated">这个Chemprop模型是什么？</h1><p id="b39c" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">Chemprop模型于2019年在[1]发表，但此后一直在不断更新，并在一系列后来的出版物中显示出其价值，最引人注目的是在[2]中，他们用它来发现新的潜在抗生素化合物。</p><p id="d785" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">底层的Chemprop是在Pytorch中实现的消息传递神经网络，这意味着模型的输入是分子的图形表示。然而，除了直接在图表上工作之外，Chemprop还自动使用更经典的衍生化学特征，这意味着它通常在小型和大型数据集上都表现良好(与其他模型相比)。要了解更多信息，我推荐阅读论文[1]。</p><p id="c38c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Chemprop可以从PyPI: <code class="fe nh ni nj nk b">pip install chemprop.</code>安装</p><h1 id="f1be" class="md me it bd mf mg nc mi mj mk nd mm mn jz ne ka mp kc nf kd mr kf ng kg mt mu bi translated">让我们开始吧:3行代码</h1><p id="c53c" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">假设我们有一个如上所示的数据集，带有一些微笑字符串和两个我们希望预测的属性；FDA是否批准了该化合物，以及它是否通过了临床试验期间的毒理学测试。</p><p id="b13b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大量类似的数据集可以在网上找到，例如，查看<a class="ae ky" href="https://github.com/chemprop/chemprop/blob/master/data.tar.gz" rel="noopener ugc nofollow" target="_blank">这些基准</a>。在Chemprop的典型使用中，我们将经历以下步骤:1)优化模型的超参数，2)训练模型，以及3)对一组新的分子进行预测。</p><h2 id="bce1" class="nl me it bd mf nm nn dn mj no np dp mn li nq nr mp lm ns nt mr lq nu nv mt nw bi translated">步骤1:调整超参数。</h2><p id="30fb" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">Chemprop有一些可调的超参数，可以调整这些参数以在给定数据集上获得最佳结果。安装chemprop后，我们可以运行50次<a class="ae ky" href="https://papers.nips.cc/paper/2011/file/86e8f7ab32cfd12577bc2619bc635690-Paper.pdf" rel="noopener ugc nofollow" target="_blank"> TPE超参数调整</a>迭代:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><h2 id="d9d9" class="nl me it bd mf nm nn dn mj no np dp mn li nq nr mp lm ns nt mr lq nu nv mt nw bi translated">第二步:训练模型</h2><p id="8b97" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">有了在<code class="fe nh ni nj nk b">data/config.json</code>中识别和保存的理想超参数，我们就可以用这些参数训练模型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="366a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有几个值得注意的有趣参数:</p><ul class=""><li id="1f82" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated"><code class="fe nh ni nj nk b">num_folds</code>:我们创建5个折叠(不同的训练/测试)分割，并在每个折叠上训练/评估模型。</li><li id="351c" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><code class="fe nh ni nj nk b">ensemble_size</code>:我们用不同的初始化创建了一个3个模型的集合，这将提高平均性能。请注意，这3个模型每个都有5个折叠，所以我们总共训练了15次模型！</li><li id="8953" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><code class="fe nh ni nj nk b">split_type</code>在创建我们的内部训练/测试分裂时，我们确保将相似的分子放入相同的折叠中，以获得更真实的泛化度量。</li></ul><p id="3367" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我的训练运行中，我收到了下面的输出:<code class="fe nh ni nj nk b">Overall test AUC: 0.871 +/- 0.036</code>——即来自训练交叉验证的非常有希望的结果。</p><h2 id="001b" class="nl me it bd mf nm nn dn mj no np dp mn li nq nr mp lm ns nt mr lq nu nv mt nw bi translated">步骤3:根据新数据评估模型。</h2><p id="4050" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">既然我们已经训练了模型，下一步就是在测试数据集上评估它的性能。从交叉验证中我们已经知道，性能应该是大约0.84的AUC，但是让我们看看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="3aef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将生成一个文件<code class="fe nh ni nj nk b">predictions.csv</code>，其中包含我们测试数据集中化合物的预测。请注意，这些预测是上一步中训练的总共15个模型的平均值。将此与真实值进行对比，我们得到以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/d6b46f17cac7f8461e958577a69c1bdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E5_qM-oCcFpivL3s6W2I3w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在测试数据集上评估已训练的chemprop模型。由作者策划。</p></figure><p id="1b1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">非常适合最小的努力！👏</p><h1 id="3f41" class="md me it bd mf mg nc mi mj mk nd mm mn jz ne ka mp kc nf kd mr kf ng kg mt mu bi translated">更进一步:解释</h1><p id="10ab" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">有时仅仅得到点预测是不够的；我们可能想知道<em class="lv">为什么</em>模型返回一个给定的预测。例如，如果预测该分子是有毒的，那么知道该分子的哪一部分引起所述毒性将是有价值的。通过从<a class="ae ky" href="https://github.com/chemprop/chemprop" rel="noopener ugc nofollow" target="_blank">这里</a>获取我的Chemprop分支，我们可以使用<a class="ae ky" href="https://arxiv.org/pdf/1807.01985.pdf" rel="noopener ugc nofollow" target="_blank"> BayesGrad </a>方法的变体创建这样的解释:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="f20d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于由<code class="fe nh ni nj nk b">interpret_local.py</code>脚本评估的每种化合物，算法将返回一个解释图，例如，在上面训练的溶解度模型的情况下，它将显示亲水原子(氧)如何增加分子的溶解度:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/601e24ce8f16be1fbd3059a0c98d2164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*brWbC0MFerrpg5D4E5A1ew.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">解释溶解度预测的热图。图片由作者提供。</p></figure><p id="ea78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简而言之，这里分子中给定原子或键的“重要性分数”被计算为预测目标相对于来自该原子或键的特征的梯度；即，归因于给定键/原子的梯度的绝对和越大，假定该键/原子对预测越重要。众所周知，以这种方式直接生成的灵敏度图噪声很大。因此，BayesGrad建议使用dropout对网络参数<em class="lv"> W </em>的后验分布<em class="lv"> p(W|D) </em>进行采样，允许我们计算所有这些采样网络的梯度平均值，从而平滑结果。我们没有依赖Chemprop中包含的dropout，而是通过简单地使用交叉验证折叠和集合模型中的权重<em class="lv"> W </em>对<em class="lv"> p(W|D) </em>进行采样，即，对于一组20个模型，我们计算每个原子和键的梯度的平均和。</p><h1 id="e32a" class="md me it bd mf mg nc mi mj mk nd mm mn jz ne ka mp kc nf kd mr kf ng kg mt mu bi translated">结束语</h1><p id="1438" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">能够预测化学性质是极其强大的；想象你有一组100个潜在的分子候选者。合成它们中的每一个都是一项艰巨的任务。如果我们可以根据它们满足各种特性的可能性来对它们进行排序，我们就可以首先综合出最有希望的候选者。此外，通过解释模型预测，我们可以了解更多关于分子工作或不工作的原因，因此甚至可以根据这些信息开发出更有前途的候选分子。</p><p id="c39b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用3个命令来训练和预测这些模型可能会给人一种这是一个已解决问题的印象。事实并非如此。我推荐阅读Andreas Bender的<a class="ae ky" href="http://www.drugdiscovery.net/2020/10/13/how-to-lie-with-computational-predictive-models-in-drug-discovery/" rel="noopener ugc nofollow" target="_blank">这篇文章</a>，思考从这些模型中得出结论是多么的危险和困难。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="002e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[1] Kevin Yang <em class="lv">等</em>，<em class="lv"> J. Chem .Inf。模型。</em> 2019，59，8，3370–3388</p><p id="2eaf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[2]乔纳森·m·斯托克斯<em class="lv">等</em>，抗生素发现的深度学习方法(2020)，<em class="lv">细胞，180，4，P688–702。E13 </em></p></div></div>    
</body>
</html>