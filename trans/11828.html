<html>
<head>
<title>4 Tricky Data Manipulation Operations With Python Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python Pandas的4个棘手的数据操作</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/4-tricky-data-manipulation-operations-with-python-pandas-7fd5e8bba624?source=collection_archive---------13-----------------------#2021-11-25">https://towardsdatascience.com/4-tricky-data-manipulation-operations-with-python-pandas-7fd5e8bba624?source=collection_archive---------13-----------------------#2021-11-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0ba8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">挑战极限</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/209e94dc291b69802db445cc94c57759.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*198KxF4REakkK-Ifyert7g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Joppe Spaa 在<a class="ae ky" href="https://unsplash.com/s/photos/trick?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="ef58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas是数据科学生态系统中最受欢迎的数据分析和操作库之一。这有几个原因。</p><p id="9888" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">原因之一是熊猫让复杂的操作变得简单直观。在一行熊猫代码中，你可以实现比你预期的更多的东西。</p><p id="fb1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将讨论4个数据操作，这些操作初看起来有点复杂。当我们完成后，你会惊奇地发现用熊猫来完成它们是多么简单。</p><p id="ef62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于现实生活中的数据集可能相当混乱，数据操作或清理是数据科学工作流程的主要部分。</p><p id="003c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我准备了一个样本数据集，展示了我们在现实生活中可能会遇到的一些问题。</p><blockquote class="lv lw lx"><p id="c744" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">注:这个故事最初发表在datasciencehowto.com的<a class="ae ky" href="https://datasciencehowto.com/2022/10/29/4-tricky-data-manipulation-operations-with-python-pandas/" rel="noopener ugc nofollow" target="_blank">上。</a></p></blockquote><p id="f0a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还将分享创建数据框的代码，以防您想自己练习。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="dc99" class="mh mi it md b gy mj mk l ml mm">df = pd.DataFrame({</span><span id="4009" class="mh mi it md b gy mn mk l ml mm">    "last_date": ["2021-03-14", "2021-01-13", <br/>                  "2021-09-15", "2021-01-01", <br/>                  "2020-12-10","2021-04-02"],</span><span id="ca67" class="mh mi it md b gy mn mk l ml mm">    "price": ["$950.0", "$450.5", "$1,100.5", <br/>              "$360.0", "$850.0", "$440.5"],</span><span id="26df" class="mh mi it md b gy mn mk l ml mm">    "duration": ["2 days", "1 week", "5 days", <br/>                 "1 month", "10 days", "2 weeks"],</span><span id="b752" class="mh mi it md b gy mn mk l ml mm">    "amenities": ["tv, dishwasher", "TV, washer", <br/>                  "dishwasher, washer", "washer", <br/>                  "tv", "dishwasher"]<br/>})</span><span id="839f" class="mh mi it md b gy mn mk l ml mm">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/518dc659da04db17072043f89ff4bf20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*smKzlwT3pa0UdisF9h9Tqw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure><p id="7306" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些值有不同的类型，如日期、数字、文本和列表。但是，它们与对象数据类型一起存储。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="411c" class="mh mi it md b gy mj mk l ml mm">df.dtypes</span><span id="eae3" class="mh mi it md b gy mn mk l ml mm">last_date    object<br/>price        object<br/>duration     object<br/>amenities    object<br/>dtype: object</span></pre><p id="7419" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们应该总是用正确的数据类型存储数据。否则，我们将无法使用一些特定于数据类型的操作。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="d5d5" class="mw mi it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">招数1:让价格合适</h1><p id="b9ff" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">价格栏对我们来说似乎是，但对软件来说不是。“$360.0”是一个字符序列，并不意味着数量或数值。</p><p id="6800" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们把它更新成一种计算机实际上能理解的格式它是360。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="f5c3" class="mh mi it md b gy mj mk l ml mm">df["price_cleaned"] = df["price"].str[1:].str.replace(",","").astype("float")</span></pre><p id="ce33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一步是从第二个字符开始取值，因为第一个字符是“$”。</p><p id="4869" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们通过使用str访问器下的replace函数来删除用作千位分隔符的逗号。</p><p id="7fe4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一步是将数据类型改为float。</p><p id="349f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是更新后的数据框:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/91606b8bc17980ec49d725e0668f4ba2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kiups8AtsZy6kQiH4uJfEA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="7e91" class="mw mi it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">招数二:有电视？</h1><p id="6f04" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">便利设施列在便利设施栏中。假设我对电视特别感兴趣，想要创建一个列来指示是否有电视。</p><p id="a111" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行这项任务有多种方式。一种有效的方法是使用列表理解，尤其是在处理大型数据框时。</p><p id="242a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要考虑到“电视”和“电视”是一样的。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="93e9" class="mh mi it md b gy mj mk l ml mm">df["has_tv"] = pd.Series(['tv' in row.lower() for row in df.amenities]).replace({False:0, True:1})</span></pre><p id="7a5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们先来阐述一下列表理解:</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="3cda" class="mh mi it md b gy mj mk l ml mm">['tv' in row.lower() for row in df.amenities]</span></pre><ul class=""><li id="9d5b" class="nt nu it lb b lc ld lf lg li nv lm nw lq nx lu ny nz oa ob bi translated">它占用了便利设施列中的所有行。</li><li id="ebba" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated">将其转换为小写，这样我们就可以同时捕捉到“tv”和“TV”。</li><li id="6f39" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated">检查行中是否存在“tv”。</li></ul><p id="beef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个列表理解返回真或假，但是我想把它们分别转换成1或0。</p><p id="34c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas的替换功能可以很容易地完成这项任务，所以我将列表转换为Pandas系列，然后应用替换功能。</p><p id="6448" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据框现在看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/2ceb05d81cd280719a908fdcadc640b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xPzLS40FjyH1J1TYgFI0jA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="ce64" class="mw mi it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">招数三:词条多大？</h1><p id="6e93" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">数据框中有一个名为“最后日期”的列。我更感兴趣的是这个条目或广告有多老。因此，我需要计算从今天到最后一天的天数。</p><p id="1641" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码创建了一个名为“自上次日期”的列，其中包含我需要的信息。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="c747" class="mh mi it md b gy mj mk l ml mm">df["since_last_date"] = (pd.to_datetime("2021-11-25") - df["last_date"].astype("datetime64")).dt.days</span></pre><p id="1cac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只要数据类型正确，我们就可以计算出两个日期之间的差异。因此，我使用“astype”函数更新最后一个日期列的数据类型。</p><p id="8801" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“to_datetime”函数获取一个字符串并将其转换为日期。</p><p id="5c9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该减法运算的输出如下:</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="6df5" class="mh mi it md b gy mj mk l ml mm">0   256 days<br/>1   316 days<br/>2    71 days<br/>3   328 days<br/>4   350 days<br/>5   237 days<br/>Name: last_date, dtype: timedelta64[ns]</span></pre><p id="4c21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用“dt”访问器下的“days”方法从该输出中提取数量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/92f24cc75cc23ff20c96e509aae0565b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xOZGNb7xDgobl9tzYCN2Lw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="3c6b" class="mw mi it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">招数四:标准时长？</h1><p id="1c5a" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">持续时间列表示时间长度，但单位不同。我想你会同意，这种格式不是很有用。</p><p id="2a41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建一个新的duration列，它将持续时间显示为天数。</p><p id="754c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要做的是:</p><ul class=""><li id="b322" class="nt nu it lb b lc ld lf lg li nv lm nw lq nx lu ny nz oa ob bi translated">取第二个字，换算成天数。</li><li id="f716" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated">将该值乘以第一个单词中显示的数量。</li></ul><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="a182" class="mh mi it md b gy mj mk l ml mm">df["duration_days"] = df["duration"].str.split(" ", expand=True)[1].replace(<br/>    {"week": 7, "weeks": 7, "days": 1, "day": 1, "month": 30}<br/>).astype("int") * df["duration"].str.split(" ", expand=True)[0].astype("int")</span></pre><p id="c8d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码看起来很复杂，但是当我们一步一步看的时候就变得很清楚了。</p><p id="f648" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下部分采用持续时间列中的第二个单词(例如，周、周、月)</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="ad79" class="mh mi it md b gy mj mk l ml mm">df["duration"].str.split(" ", expand=True)[1]</span></pre><p id="631e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">replace函数用适当的天数替换单词。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="73dd" class="mh mi it md b gy mj mk l ml mm">replace(<br/>    {"week": 7, "weeks": 7, "days": 1, "day": 1, "month": 30}<br/>)</span></pre><p id="b92a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后“astype”函数将数据类型转换为整数。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><p id="050f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">乘法的第二部分采用duration列中的第一个字，并将数据类型转换为integer。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="7857" class="mh mi it md b gy mj mk l ml mm">df["duration"].str.split(" ", expand=True)[0].astype("int")</span></pre><p id="ec3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将这两个值相乘得到一个标准的持续时间，即天数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/cfc847ce045f8daa69f6b15b027aebfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sdo3Jp9-vaJxggFD9rlsCQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure><p id="0a5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您不必一次完成所有这些操作。另一种选择是创建一个具有月、周、日等单位的列。然后，您可以相应地更新该值。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><p id="2a8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas提供了许多功能和方法来简化和加快数据分析和处理过程。</p><p id="c4f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑到清理原始数据所花费的时间，Pandas对于数据科学家和数据分析师来说都是一个非常重要的工具。</p><p id="4928" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以成为<a class="ae ky" href="https://sonery.medium.com/membership" rel="noopener">媒介会员</a>来解锁我的作品的全部访问权限，以及媒介的其余部分。如果您使用以下链接，我将收取您的一部分会员费，无需您支付额外费用。</p><div class="ok ol gp gr om on"><a href="https://sonery.medium.com/membership" rel="noopener follow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd iu gy z fp os fr fs ot fu fw is bi translated">通过我的推荐链接加入Medium-Soner yl DRM</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">sonery.medium.com</p></div></div><div class="ow l"><div class="ox l oy oz pa ow pb ks on"/></div></div></a></div></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><p id="533e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>