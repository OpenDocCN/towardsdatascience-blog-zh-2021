<html>
<head>
<title>Improve Your Hyperparameter Tuning Experience With The Random Search</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用随机搜索改善您的超参数调谐体验</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/improve-your-hyperparameter-tuning-experience-with-the-random-search-2c05d789175f?source=collection_archive---------23-----------------------#2021-10-25">https://towardsdatascience.com/improve-your-hyperparameter-tuning-experience-with-the-random-search-2c05d789175f?source=collection_archive---------23-----------------------#2021-10-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f481" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">学习通常比常规网格搜索更实用的超参数优化方法的内部工作原理</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cce3c2a9342285d3faf0059f05376ec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VS6wgQtgnzI7CTpYkf39Ew.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://www.pexels.com/photo/person-holding-volume-knob-1345630/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae kv" href="https://www.pexels.com/@githirinick?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Nicholas Githiri </a>拍摄</p></figure><p id="e60b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当开发一个机器学习分类器时，不存在哪个超参数将为您提供最佳性能模型的经验法则。出于这个原因，获得最佳超参数的一种非常常见的方法是尝试超参数的每种组合。</p><p id="5df6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种类型的超参数调整被称为<strong class="ky ir">网格搜索</strong>，它需要测试超参数的每一个组合，以找到为相关数据提供最佳模型的组合。</p><p id="6f1e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">网格搜索是最广为人知的超参数优化形式，原因显而易见。</p><p id="3cac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">网格搜索不仅易于直观理解，而且保证为您的分类器获得理想的超参数。</p><p id="4ae9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也就是说，还有一种超参数优化技术没有得到足够的重视:随机搜索。</p><h1 id="5a31" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">随机搜索</h1><p id="257d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">随机搜索与网格搜索非常相似。</p><p id="fc0a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，随机搜索只测试随机选择的一定数量的组合，而不是测试超参数的每个组合。</p><p id="cb38" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">乍一看，随机搜索似乎没有吸引力。毕竟，如果你不能测试每一个超参数组合，你不太可能找到最好的一个。</p><p id="5fa4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，这种方法确实有一些好处。</p><p id="4428" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，由于随机搜索测试更少的模型架构，所以它需要更少的时间和更少的计算来获得结果。</p><p id="90be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尽管随机搜索不一定能找到最佳的超参数集，但它可以提供在性能方面接近理想模型的模型。</p><h1 id="7046" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">随机搜索与网格搜索</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/40744f9a3cc1f4f9db412d92e562c06a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BzSPi-MDRjbx6vMZLWYyEQ.jpeg"/></div></div></figure><p id="efd2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您是数据科学项目的新手，您可能会坚持使用网格搜索。毕竟，多花一点时间有什么问题，如果这意味着你可以获得最好的模型？</p><p id="9884" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在处理简单数据集时，这可能是一个合理的论点。然而，当您开始处理包含数百万条记录的数据时，测试每一个模型架构所需的时间和计算将是巨大的。</p><p id="fee8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，如果您正在为客户构建一个模型，您将无法证明仅仅为了模型性能的轻微提高而分配这么多资源是合理的。</p><p id="fb0f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不幸的是，网格搜索很浪费；它不会从以前的模型中“学习”。</p><p id="7bf0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，如果您要通过从1000个不同的超参数组合中进行选择来构建一个分类器，那么您只对产生最佳性能指标的单个组合感兴趣。测试其他999种组合不会带来额外的好处。</p><p id="9a8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随机搜索通过限制被测试的超参数组合的数量来解决这个问题。尽管这意味着该模型的性能指标可能没有理想模型的高，但这种差异可以忽略不计。</p><p id="7d3e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随机搜索可能不像纸上的网格搜索那样吸引人，但是在实践中，它们是获得期望的模型体系结构的更具成本效益的方式。</p><h1 id="227a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">个案研究</h1><p id="a4bc" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们通过建立一个预测泰坦尼克号生存能力的模型来探索随机搜索方法(数据集可访问<a class="ae kv" href="https://www.kaggle.com/sureshbhusare/titanic-dataset-from-kaggle" rel="noopener ugc nofollow" target="_blank">此处</a>)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">资料组</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/a73a5cd9dde9c5f0b8060c508e91833c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*7t2bzpNHitw45pXOUb3ppw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="49ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在任何数据建模之前，需要为机器学习算法准备数据集。</p><p id="2d42" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据预处理包括:</p><ul class=""><li id="b4d0" class="mt mu iq ky b kz la lc ld lf mv lj mw ln mx lr my mz na nb bi translated">移除不需要的功能</li><li id="02a7" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">删除缺少值的记录</li><li id="871a" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">编码分类特征</li><li id="ee3e" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">将数据分成训练集和测试集</li><li id="d805" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">归一化整数特征</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数据预处理</p></figure><p id="2d06" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在使用随机搜索之前，我们将使用网格搜索作为一种参考形式来进行超参数调整。</p><p id="f7c8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">sklearn模块中的<a class="ae kv" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV.html" rel="noopener ugc nofollow" target="_blank"> GridSearchCV </a>对象允许我们使用每个期望的超参数组合对分类器执行网格搜索。</p><p id="89b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于本案例研究，我们将重点关注使用最佳超参数构建随机森林分类器。将使用f-1评分标准对模型进行评估(即最佳模型的f-1评分最高)。</p><p id="95a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里是将要测试的所有超参数，以及存储在字典中的分配给每个超参数的值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">超参数</p></figure><p id="3dd1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你使用网格搜索方法，你将不得不用<strong class="ky ir"> 5832 </strong>不同的超参数组合来构建随机森林分类器。</p><p id="aef5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的代码显示了适合每个可能的模型架构的数据。每个模型都被赋予训练集的f-1分数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">GridSearchCV</p></figure><p id="6648" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">GridSearchCV提供了一些属性，有助于获得关于最佳性能模型的更多信息。这些属性包括:</p><ul class=""><li id="687c" class="mt mu iq ky b kz la lc ld lf mv lj mw ln mx lr my mz na nb bi translated">best_estimator_:返回得分最高的估计值</li><li id="77d6" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">best_params_:返回理想模型中的超参数值</li><li id="29f0" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">best_score_:返回最佳模型的平均交叉验证分数</li></ul><p id="3f05" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用实现最高性能模型的最佳参数属性。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用最佳参数</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/e2392b4c8295e7909003eb927e422504.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*WowJphgsZr_GmOHevzDmdA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="15a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用best_score_找出最佳模型的平均f1分数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用最佳分数</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/86ca1cb3b36488aba2af63f0327cf22c.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*4KJ1ixsqRZ6KMWrhhi3xAg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="fc0b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">理想模型的f-1分数为0.831。</p><p id="1bd6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经用网格搜索建立了一个模型，让我们用随机搜索做同样的事情，并比较一下它的效果。</p><p id="d23f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">sklearn模块中的<a class="ae kv" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.RandomizedSearchCV.html" rel="noopener ugc nofollow" target="_blank"> RandomizedSearchCV </a>对象允许我们使用随机选取的一定数量的超参数组合对分类器进行随机搜索。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">随机搜索</p></figure><p id="5233" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随机搜索的实现与常规网格搜索非常相似。但是，在分配的参数方面有一些关键的区别。</p><p id="dbce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于随机搜索并不测试每一个可用的组合，您可以通过为“n_iter”参数赋值来选择构建和评估的模型数量。这里，我们将值500分配给参数(即测试500个超参数组合)。</p><p id="b0e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:该函数还允许您选择一个随机状态。这不是强制性的，但仍然鼓励这样做，以便您的结果是可重复的。</p><p id="2a5c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看随机搜索产生的最佳模型是什么样的。sklearn模块为RandomizedSearchCV提供了与GridSearchCV相同的属性。</p><p id="9054" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里是用随机搜索建立的最佳模型的超参数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用最佳参数</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/c1a19524736deab0303587304d2b05d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*lrI27Ss1nSFT0flc35QE0Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="0f6f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们来看看使用这组超参数得到了什么样的f-1分数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用最佳分数</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/ed1b3796f67c1f407df6c1ce3333b82a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*Z6UDCUUj-0IIJaUe6MS17w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="f6f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可以看出，随机搜索选择的超参数与网格搜索选择的超参数非常不同。因此，它登记的分数也较低。</p><p id="f146" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是f-1成绩的差距只有0.013。此外，该结果是通过测试少于十分之一<em class="nl"/><strong class="ky ir"/>的用网格搜索测试的超参数组合获得的。</p><p id="3480" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在使用RandomizedSearchCV找到最佳模型架构之后，您可以使用best_estimator_ attribute来使用测试集创建预测。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">生成预测</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/9432953a0682ac059ec953575ed622a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:966/format:webp/1*tCuie1eUU0CxX_Q0l-AxAQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="1022" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">总而言之，网格搜索比随机搜索稍微好一点。但是，为了这样一点点的性能提升，测试10倍以上的模型架构是合理的吗？</p><p id="d538" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果一个项目优先考虑限制成本和时间，那么随机搜索无疑是更好的选择。</p><h1 id="7ac1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/9734dc2f9d54769b12cc8f8ea4312845.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E_QypCwB4FD3i_S_"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae kv" href="https://unsplash.com/@prateekkatyal?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Prateek Katyal </a>拍摄</p></figure><p id="8b20" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">总而言之，您对超参数调优技术的选择应该取决于您在模型成本和性能之间权衡的优先级。</p><p id="164e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">网格搜索可以获得理想的模型体系结构，但是考虑到它所引起的成本，它不一定适用于许多现实生活场景。</p><p id="c4b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一方面，随机搜索提供了一种获得可靠模型(尽管不是最好的)的方法，同时节省了金钱和时间。</p><p id="a542" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我祝你在机器学习的努力中好运！</p></div></div>    
</body>
</html>