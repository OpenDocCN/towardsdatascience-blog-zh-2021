<html>
<head>
<title>Building NLP Web Apps With Gradio And Hugging Face Transformers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Gradio和拥抱面部变形金刚构建NLP Web应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-nlp-web-apps-with-gradio-and-hugging-face-transformers-59ce8ab4a319?source=collection_archive---------17-----------------------#2021-08-11">https://towardsdatascience.com/building-nlp-web-apps-with-gradio-and-hugging-face-transformers-59ce8ab4a319?source=collection_archive---------17-----------------------#2021-08-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="398a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">向同事和客户展示你的NLP/ML解决方案时，web应用是必不可少的。但是构建和部署一个有时会是一场噩梦。输入Gradio。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e1abd0db06b80a71700fdf673a4db17b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*DHsXieocan8E6ntk-8O8WQ.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">蔡钦汉的情绪分析网络应用的Gif。</p></figure><p id="7406" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Web应用程序设计和部署可以说是数据科学家和分析师最容易忽视的技能之一。然而，如果你需要向同事或客户展示你的NLP或机器学习解决方案，这些技能是必不可少的。</p><p id="2d08" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">虽然一个好的演示会有很长的路要走，但没有什么比拥有一个原型更好的了，在这个原型中，非技术用户可以自己测试提议的解决方案。如果你最近几年尝试过部署一个ML web应用，你就会知道大多数托管服务对于那些前端开发经验有限的人来说并不容易。</p><p id="75e2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">相比之下，Gradio是一个相对较新的库，它使ML和NLP web应用程序的创建和共享变得轻而易举。只需几行代码，您就可以将您的模型放在许多标准模板中，这样就不必创建单独的HTML模板，也不必考虑UI、按钮的颜色和大小等问题。</p><p id="b0d7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">可以肯定的是，Gradio模板非常简约。但是坦率地说，在测试和开发的早期阶段，这就是你所需要的全部，那时的目标仅仅是快速测试和快速迭代。Gradio的<a class="ae ls" href="https://gradio.app/blog/using-huggingface-models" rel="noopener ugc nofollow" target="_blank">与抱抱脸的</a> <em class="lr">变形金刚</em>库和模型中枢的紧密集成使其成为一个更加强大的工具。</p><p id="dfbe" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当然，Gradio不是唯一可以用来快速开发web应用程序的库。<a class="ae ls" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>和<a class="ae ls" href="https://plotly.com/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>是这一领域的另外两个著名名字，各有所长。但是我要说Gradio是迄今为止最用户友好的，并且是早期NLP/ML解决方案开发的游戏改变者。</p><p id="7a15" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通过几个Jupyter笔记本，我将分享我如何使用Gradio构建独立的和“链式链接”的NLP应用程序的例子，这些应用程序结合了不同的功能和transformer模型。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="8a22" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">回购、文件和项目范围</h1><p id="f570" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">我为这个项目准备的<a class="ae ls" href="https://github.com/chuachinhon/gradio_nlp" rel="noopener ugc nofollow" target="_blank"> repo包含了运行本文中的例子所需的所有文件:</a><a class="ae ls" href="https://github.com/chuachinhon/gradio_nlp/tree/main/notebooks" rel="noopener ugc nofollow" target="_blank"> 5个Jupyter笔记本</a>、<a class="ae ls" href="https://github.com/chuachinhon/gradio_nlp/tree/main/data" rel="noopener ugc nofollow" target="_blank"> 2个音频文件</a>和一个腌制的<a class="ae ls" href="https://github.com/chuachinhon/gradio_nlp/tree/main/models" rel="noopener ugc nofollow" target="_blank">逻辑回归模型</a>(演示Gradio在transformer模型之外的用法)。</p><p id="9bc9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这里的演示更适合新手，以及那些处于NLP/ML项目早期探索阶段的人。Gradio提供了托管和私有部署的选项，但是这已经超出了本文的范围。</p><p id="a7c6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">除了定义NLP/ML模型的输入和输出之外，只需几行代码就可以启动并运行Gradio应用程序。如果你使用拥抱脸的公共<a class="ae ls" href="https://huggingface.co/inference-api" rel="noopener ugc nofollow" target="_blank">推理API </a>，这个过程就更简单了。但我不会在我的例子中采用这种方法，因为我发现Hugging Face的公共/免费推理API相对较慢，如果你试图一次加载太多transformer模型，你的应用程序可能会崩溃。</p><p id="ffe3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，我编写了在本地机器上运行的演示程序。要公开分享app，只需要在Gradio界面更改一个参数即可。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="7fa8" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">1.独立的情绪分析应用</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e1abd0db06b80a71700fdf673a4db17b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*DHsXieocan8E6ntk-8O8WQ.gif"/></div></div></figure><p id="a8ca" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们从一个最简单的例子开始——使用Hugging Face的<a class="ae ls" href="https://huggingface.co/transformers/main_classes/pipelines.html" rel="noopener ugc nofollow" target="_blank">管道API </a>构建一个用于情感分析的<a class="ae ls" href="https://github.com/chuachinhon/gradio_nlp/blob/main/notebooks/1.0_gradio_sentiment.ipynb" rel="noopener ugc nofollow" target="_blank"> web应用。情感分析管道中的默认蒸馏模型返回两个值—一个标签(正或负)和一个分数(浮点)。</a></p><p id="813c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Gradio消除了从零开始设计web应用程序的痛苦，并解决了如何正确标记两个输出的问题。下面的屏幕截图展示了如何通过在Gradio中更改一些参数来轻松调整应用程序的外观:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/49f471a06a715c252bd58bf33a320eda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u1-hrd9fHkIOuDVS2eb8hQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">屏幕截图:蔡振汉</p></figure><p id="0df0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">由于Gradio和<em class="lr"> transformers </em>库之间的紧密集成，只需几分钟就可以调整<a class="ae ls" href="https://github.com/chuachinhon/gradio_nlp/blob/main/notebooks/1.0_gradio_sentiment.ipynb" rel="noopener ugc nofollow" target="_blank"> notebook1.0 </a>中的代码，将情感分析web应用程序转变为一个用于翻译、摘要或零镜头分类的应用程序。</p><h1 id="b05a" class="ma mb iq bd mc md my mf mg mh mz mj mk jw na jx mm jz nb ka mo kc nc kd mq mr bi translated">2.独立的TROLL TWEET探测器应用程序</h1><p id="4571" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">通过Scikit-learn等标准机器学习库，Gradio可以很好地处理酸洗模型。在<a class="ae ls" href="https://github.com/chuachinhon/gradio_nlp/blob/main/notebooks/1.1_gradio_logreg.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本1中。</a> 1，我加载了我在<a class="ae ls" href="https://github.com/chuachinhon/transformers_state_trolls_cch/blob/master/notebooks/3.0_compare_logreg_cch.ipynb" rel="noopener ugc nofollow" target="_blank">之前的项目</a>中为巨魔推文构建的逻辑回归分类器，Gradio应用程序很快就启动并运行了:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/c7e41b1bf8308abcd43f2aef1fd94757.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7nPox8VyxnmcBNTRG3Pcvg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">屏幕截图:蔡振汉</p></figure><p id="39a6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Gradio模板是准系统，毫无疑问。但这就是我在早期阶段所需要的，以查看模型是否如预期的那样工作，以及解决方案是否对非技术观众来说是清楚的。</p><h1 id="f31a" class="ma mb iq bd mc md my mf mg mh mz mj mk jw na jx mm jz nb ka mo kc nc kd mq mr bi translated">3.“平行”中的梯度—比较两种汇总模型</h1><p id="09fa" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">最近，几乎不可能跟上各种NLP任务可用的新transformer模型的数量。例如，如果你正在做一个文本摘要项目，你如何展示拥抱脸的模型中枢上可用的<a class="ae ls" href="https://huggingface.co/models?pipeline_tag=summarization" rel="noopener ugc nofollow" target="_blank"> 248个模型中哪一个更适合你的用例？或者，您如何证明您自己的微调模型比其他模型表现得更好？</a></p><p id="ea49" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Gradio提供了一个简洁的解决方案，允许在同一个应用程序中“并行”加载transformer模型。这样，您可以直接比较一个输入的不同结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/1de0ab95478f8f310e4b0ca30c994bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YUBqz6xteSNKzS4UNMQglQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">屏幕截图:蔡振汉</p></figure><p id="5cc7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<a class="ae ls" href="https://github.com/chuachinhon/gradio_nlp/blob/main/notebooks/2.0_gradio_parallel_summaries.ipynb" rel="noopener ugc nofollow" target="_blank"> notebook2.0 </a>中，我开发了一个快速网络应用程序来比较两种不同模型的摘要能力:FB的Bart和Google的Pegasus。这是一个直接比较多个模型的结果的好方法，而不必复制不同应用程序的结果，或者在两个模型之间来回切换屏幕。</p><p id="f502" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这也是比较文本生成或翻译模型性能的一个很好的方法，在这种情况下，不同模型的结果会有很大的不同。Gradio没有说明一次可以并行加载的模型的最大数量，所以根据需要应用一些常识性的限制。</p><h1 id="39f1" class="ma mb iq bd mc md my mf mg mh mz mj mk jw na jx mm jz nb ka mo kc nc kd mq mr bi translated">4.“系列”中的GRADIO结合两种变压器模型进行翻译和总结</h1><p id="3315" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">另一种利用大量变形金刚模型的方法是将它们“串联”起来，即在一个Gradio应用程序下连接不同功能的模型。</p><p id="0471" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae ls" href="https://github.com/chuachinhon/gradio_nlp/blob/main/notebooks/3.0_gradio_series.ipynb" rel="noopener ugc nofollow" target="_blank"> Notebook3.0 </a>演示了如何构建一个翻译摘要器，它接收中文文本并生成英文翻译摘要:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/49e1be2c72125b9351d9763b228a4ba9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yw8KlonkN9GlwLwWSh0TgA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">屏幕截图:蔡振汉</p></figure><p id="22ef" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">正如上面的截屏图所示，最终结果并不令人印象深刻。这很好地提醒了约束在这些NLP/ML项目中的重要性——仅仅因为一些东西在技术上可行并不意味着结果会有任何好处。</p><p id="9224" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">虽然链接不同功能的多个transformer模型的能力是一个非常受欢迎的能力，但要找到一个有效的组合并交付良好的结果还需要付出相当多的努力。</p><h1 id="c982" class="ma mb iq bd mc md my mf mg mh mz mj mk jw na jx mm jz nb ka mo kc nc kd mq mr bi translated">5.具有音频输入和文本输出的语音到文本“混合媒体”应用程序</h1><p id="6784" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">我的最后一个例子，在<a class="ae ls" href="https://github.com/chuachinhon/gradio_nlp/blob/main/notebooks/4.0_gradio_audio_text.ipynb" rel="noopener ugc nofollow" target="_blank"> notebook4.0 </a>中，演示了一种使用<a class="ae ls" href="https://huggingface.co/models?search=wav2vec2" rel="noopener ugc nofollow" target="_blank">humping Face对脸书的Wav2Vec2模型</a>的实现来构建简单的语音到文本网络应用的快速方法。</p><p id="b3e8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用最新版本的Gradio，您可以轻松配置混合媒体应用程序，这些应用程序采用一种特定的输入格式，例如音频或视频，并以另一种格式输出，例如文本或数字。为了简化演示，我选择了一款语音转文本应用，它可以接收音频剪辑并返回文本文本:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/22be7af626dfd8d1c91020a5ea7cd821.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8e6d27yEOvKZxRb_ECbtBA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">屏幕截图:蔡振汉</p></figure><p id="a700" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一个新人使用Flask和HTML模板创建一个类似的语音到文本的应用程序可能需要几个小时，如果不是几天的话，更不用说在正确部署到托管提供商的过程中还要经历额外的考验。</p><p id="7844" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于Gradio，这个特殊示例的挑战主要在于定义一个函数来处理较长的音频文件，而不会出现会导致本地计算机崩溃的内存不足问题:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/1caf37baaf9754e013d529c1662225bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UnBVaVCNDM3YoGOrInyhig.png"/></div></div></figure><p id="04f9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">创建应用程序界面实际上只需要一行代码:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/5d7179334f95c9d5dae194032e80f07f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fyxiG3iRWRk0247z1TNy8Q.png"/></div></div></figure><p id="1047" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我已经在repo 中包含了两个音频文件，你可以尝试一下语音转文本应用程序——美国总统约翰·肯尼迪在1961年的著名就职演说，以及青年诗人阿曼达·戈尔曼在2021年美国总统乔·拜登就职典礼上的诗。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="2c90" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">结束注释</h1><p id="5a6b" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">坦率地说，数据专业人员高效工作所需的技能越来越多，这是非常荒谬的。很少有人(如果有的话)会有时间学习与数据相关的编码和分析技能，以及前端开发。</p><p id="3865" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">像Gradio这样的库有助于将所需技能“压缩”成更易于管理的东西，让数据科学家和分析师不必为了一个简单的演示而花费数小时摆弄Flask和HTML。</p><p id="4a66" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从长远来看，我认为这有助于促进机器学习的更大透明度和问责制，因为数据专业人员不再有任何借口说他们不能快速构建应用程序来让其他人尝试提议的解决方案。</p><p id="5c59" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">随着越来越多的人开始在早期阶段测试此类应用，希望深埋在特定解决方案的训练数据和设计中的偏见和道德问题将更容易被发现。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="35c6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">和往常一样，如果你在这篇文章或我之前的文章中发现了错误，请联系我:</p><ul class=""><li id="4782" class="nj nk iq kx b ky kz lb lc le nl li nm lm nn lq no np nq nr bi translated">推特:<a class="ae ls" href="https://medium.com/u/b3d8090c0aee?source=post_page-----aad7f2e1d0a0----------------------" rel="noopener">蔡锦鸿</a></li><li id="dd7f" class="nj nk iq kx b ky ns lb nt le nu li nv lm nw lq no np nq nr bi translated">领英:【www.linkedin.com/in/chuachinhon T2】</li></ul></div></div>    
</body>
</html>