<html>
<head>
<title>An Unconventional Yet Convenient Matplotlib Broken_Barh Function And When It Is Particularly Helpful</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个非常规但方便的Matplotlib Broken_Barh函数，当它特别有用时</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/an-unconventional-yet-convenient-matplotlib-broken-barh-function-and-when-it-is-particularly-88887b76c127?source=collection_archive---------26-----------------------#2021-08-01">https://towardsdatascience.com/an-unconventional-yet-convenient-matplotlib-broken-barh-function-and-when-it-is-particularly-88887b76c127?source=collection_archive---------26-----------------------#2021-08-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8038" class="pw-subtitle-paragraph ju is it bd b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dk translated">它是什么，如何使用和定制，何时使用</h2></div><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/0cd0e8b812894f2eb0963399f04f8dfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zkl9I6s8ESf71tPnArNu4g.jpeg"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">作者图片</p></figure><p id="bd72" class="pw-post-body-paragraph lc ld it le b lf lg jy lh li lj kb lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">尽管对于Python中的某些数据可视化情况非常方便，但<code class="fe jq jr js jt b"><a class="ae ly" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.broken_barh.html" rel="noopener ugc nofollow" target="_blank">broken_barh</a></code>是matplotlib中不太为人所知和被低估的方法之一。它用于绘制不同x范围的水平矩形序列，并且位于y范围定义的相同垂直位置。换句话说，它产生了一个“断开的”水平条形图，即一个有间隙的图。</p><p id="ff4a" class="pw-post-body-paragraph lc ld it le b lf lg jy lh li lj kb lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">语法非常简单:该函数主要接受两个参数，<code class="fe jq jr js jt b">xranges</code>和<code class="fe jq jr js jt b">yrange</code>。<code class="fe jq jr js jt b">xranges</code>参数表示2项元组的列表或元组，其中每个元组的第一项<code class="fe jq jr js jt b">xmin</code>是相应矩形的最左侧x位置，第二项<code class="fe jq jr js jt b">xwidth</code>是该矩形的宽度。<code class="fe jq jr js jt b">yrange</code>参数是一个元组，表示所有矩形的y位置和高度。</p><p id="74a5" class="pw-post-body-paragraph lc ld it le b lf lg jy lh li lj kb lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">一个基本的情节是这样的:</p><pre class="kn ko kp kq gt lz jt ma mb aw mc bi"><span id="363e" class="md me it jt b gy mf mg l mh mi">import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>plt.figure(figsize=(8,2))<br/>plt.broken_barh(xranges=[(1, 1), (3, 2)], yrange=(1, 1))<br/>sns.despine()<br/>plt.show()</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/b377dae9b05bdd792e4dfe417e6332e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*D3ZJj2_B9ZzC2xMhGSoaTA.png"/></div><p class="ky kz gj gh gi la lb bd b be z dk translated">作者图片</p></figure><p id="94d9" class="pw-post-body-paragraph lc ld it le b lf lg jy lh li lj kb lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">一些额外的不言自明的参数可以用来定制结果矩形的外观:<code class="fe jq jr js jt b">color</code>、<code class="fe jq jr js jt b">alpha</code>、<code class="fe jq jr js jt b">edgecolor</code>、<code class="fe jq jr js jt b">linewidth</code>、<code class="fe jq jr js jt b">linestyle</code>(可以是<code class="fe jq jr js jt b">'solid'</code>、<code class="fe jq jr js jt b">'dashed'</code>、<code class="fe jq jr js jt b">'dashdot'</code>或<code class="fe jq jr js jt b">'dotted'</code>)。<code class="fe jq jr js jt b">hatch</code>参数用于用图案填充矩形，可以取下列值之一或其组合作为字符串:<code class="fe jq jr js jt b">/</code>、<code class="fe jq jr js jt b">\\</code>、<code class="fe jq jr js jt b">|</code>、<code class="fe jq jr js jt b">-</code>、<code class="fe jq jr js jt b">+</code>、<code class="fe jq jr js jt b">x</code>、<code class="fe jq jr js jt b">o</code>、<code class="fe jq jr js jt b">O</code>、<code class="fe jq jr js jt b">.</code>、<code class="fe jq jr js jt b">*</code>。<code class="fe jq jr js jt b">label</code>参数设置将在图例中显示的标签。</p><p id="4cf0" class="pw-post-body-paragraph lc ld it le b lf lg jy lh li lj kb lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">这些参数中的每一个都可以是应用于所有矩形的单个自变量(浮点或字符串)(例如<code class="fe jq jr js jt b">color='red'</code>)或自变量的列表/元组(例如<code class="fe jq jr js jt b">color=('red','blue')</code>)，在该列表/元组上迭代以创建矩形的间歇序列:</p><pre class="kn ko kp kq gt lz jt ma mb aw mc bi"><span id="e7a2" class="md me it jt b gy mf mg l mh mi">plt.figure(figsize=(15,2))<br/>x1 = (1, 1), (2.1, 2), (5, 2), (7.2, 1)<br/>y1 = (1, 1)<br/>plt.broken_barh(x1, y1, <br/>                color=['slateblue', 'orange'], alpha=0.7, <br/>                linewidth=4, <br/>                edgecolor=['black', 'brown', 'green', 'blue'], <br/>                linestyle='dashed', hatch='/')<br/>sns.despine()<br/>plt.show()</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mk"><img src="../Images/04b6b51f3225514ba193da03fef5bb68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LfE1_N36__uZy9zRznUiKQ.png"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">作者图片</p></figure><p id="cda5" class="pw-post-body-paragraph lc ld it le b lf lg jy lh li lj kb lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我知道，上面的情节看起来有点让人不知所措🙂然而，它清楚地显示了附加参数是如何工作的。</p><p id="7e80" class="pw-post-body-paragraph lc ld it le b lf lg jy lh li lj kb lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><code class="fe jq jr js jt b">broken_barh</code>函数什么时候能在现实世界中派上用场？</p><h1 id="a321" class="ml me it bd mm mn mo mp mq mr ms mt mu kd mv ke mw kg mx kh my kj mz kk na nb bi translated">1.要显示范围</h1><p id="4229" class="pw-post-body-paragraph lc ld it le b lf nc jy lh li nd kb lk ll ne ln lo lp nf lr ls lt ng lv lw lx im bi translated">使用这种方法，我们可以在同一个图上显示不同类别的范围，例如:</p><ul class=""><li id="2436" class="nh ni it le b lf lg li lj ll nj lp nk lt nl lx nm nn no np bi translated">不同种类动物的边界条件(比如温度),</li><li id="f488" class="nh ni it le b lf nq li nr ll ns lp nt lt nu lx nm nn no np bi translated">不同地理位置在一段时间内的降雨量，</li><li id="42f6" class="nh ni it le b lf nq li nr ll ns lp nt lt nu lx nm nn no np bi translated">各种工作的工资范围。</li></ul><p id="9eb7" class="pw-post-body-paragraph lc ld it le b lf lg jy lh li lj kb lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">让我们用虚拟数据来看看最后一种情况:</p><pre class="kn ko kp kq gt lz jt ma mb aw mc bi"><span id="abe1" class="md me it jt b gy mf mg l mh mi">x_ranges = [[(3800, 600)], [(2000, 1000)], [(2700, 800)]]<br/>y_start = 1<br/>colors = ['deepskyblue', 'limegreen', 'magenta']<br/>for i in range(len(x_ranges)):<br/>    plt.broken_barh(x_ranges[i], (y_start+i, 0.5), color=colors[i])    <br/>plt.title('Salary ranges by job ($)', fontsize=25)<br/>plt.xticks(fontsize=14)<br/>plt.yticks(ticks=[1.25, 2.25, 3.25], <br/>           labels=['Job1', 'Job2', 'Job3'], fontsize=16)<br/>plt.tick_params(left=False)<br/>sns.despine()<br/>plt.show()</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/8dd5ced6aec8bae72d6f244c37b67d4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*lG6lxH8U6-LveJn-TW19zQ.png"/></div><p class="ky kz gj gh gi la lb bd b be z dk translated">作者图片</p></figure><p id="b94d" class="pw-post-body-paragraph lc ld it le b lf lg jy lh li lj kb lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">在这种情况下，<code class="fe jq jr js jt b">broken_barh</code>方法实际上为每个类别绘制了一个矩形。</p><p id="77e9" class="pw-post-body-paragraph lc ld it le b lf lg jy lh li lj kb lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le iu">注意:</strong>当我们必须为一个类别只绘制一个矩形时，我们必须将相应的2项元组放在<em class="nw">列表</em>中，而不是放在<em class="nw">元组</em>中。</p><h1 id="6f1d" class="ml me it bd mm mn mo mp mq mr ms mt mu kd mv ke mw kg mx kh my kj mz kk na nb bi translated">2.强调另一个图形上的某些音程</h1><p id="192e" class="pw-post-body-paragraph lc ld it le b lf nc jy lh li nd kb lk ll ne ln lo lp nf lr ls lt ng lv lw lx im bi translated">在强调其他图表上的某些特定区间时，<code class="fe jq jr js jt b">broken_barh</code>方法是一个不错的选择。例如:</p><ul class=""><li id="5f09" class="nh ni it le b lf lg li lj ll nj lp nk lt nl lx nm nn no np bi translated">我们有一个地理区域在一段时间内温度波动的线图，我们希望显示温度高于某个值的时间间隔，</li><li id="68a1" class="nh ni it le b lf nq li nr ll ns lp nt lt nu lx nm nn no np bi translated">货币汇率随着利息的变化而变化，</li><li id="1019" class="nh ni it le b lf nq li nr ll ns lp nt lt nu lx nm nn no np bi translated">当交通比平均水平更拥挤时，交通流量波动</li></ul><p id="dc26" class="pw-post-body-paragraph lc ld it le b lf lg jy lh li lj kb lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">下图准确地代表了最后一种情况:工作日从06:00到19:00，<a class="ae ly" href="https://en.wikipedia.org/wiki/Interstate_94" rel="noopener ugc nofollow" target="_blank"> I-94州际公路</a>上每小时的交通量波动(数据取自<a class="ae ly" href="https://archive.ics.uci.edu/ml/datasets/Metro+Interstate+Traffic+Volume" rel="noopener ugc nofollow" target="_blank"> this repository </a>，经过修改和略微修改)。我们应用了<code class="fe jq jr js jt b">broken_barh</code>方法来强调流量高于平均水平的时间范围:</p><pre class="kn ko kp kq gt lz jt ma mb aw mc bi"><span id="31e7" class="md me it jt b gy mf mg l mh mi">import pandas as pd<br/>cars_per_hr = pd.Series([4141, 4740, 4587, 4485, 4185, 4466, 4718, 4801, 4932, 5241, 5664, 5310, 4264, 3276])</span><span id="0837" class="md me it jt b gy nx mg l mh mi"># Create a line plot<br/>plt.figure(figsize=(10,5))<br/>plt.plot(cars_per_hr, color="grey")</span><span id="8787" class="md me it jt b gy nx mg l mh mi"># Create a broken horizontal bar plot<br/>x = [(0.8, 0.95), (5.65, 6)]<br/>y = (cars_per_hr.mean()-50, 100)<br/>plt.broken_barh(x, y, color ='red')</span><span id="ba5a" class="md me it jt b gy nx mg l mh mi">plt.title('Traffic volume from 06.00 till 19.00 on weekdays', <br/>          fontsize=25)<br/>plt.xlabel('Time', fontsize=20)<br/>plt.ylabel('Traffic volume, cars/hr', fontsize=20)<br/>plt.xticks(ticks=list(range(14)), <br/>           labels=list(range(6,20)), fontsize=13)<br/>plt.yticks(fontsize=13)<br/>plt.xlim(0,13)<br/>sns.despine()  <br/>plt.show()</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/8b739c322d735a21a65e443473304229.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*of0AgKkWe7JVcj9NiOxwQw.png"/></div><p class="ky kz gj gh gi la lb bd b be z dk translated">作者图片</p></figure><p id="328f" class="pw-post-body-paragraph lc ld it le b lf lg jy lh li lj kb lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们看到有两个时间段的交通比平均水平更拥挤:大约从6.45到7.40，以及从11.40到17.40。</p><h1 id="4fde" class="ml me it bd mm mn mo mp mq mr ms mt mu kd mv ke mw kg mx kh my kj mz kk na nb bi translated">3.要创建甘特图</h1><p id="0f15" class="pw-post-body-paragraph lc ld it le b lf nc jy lh li nd kb lk ll ne ln lo lp nf lr ls lt ng lv lw lx im bi translated">或许，<code class="fe jq jr js jt b">broken_barh</code>方法的最佳应用是创建简化的<a class="ae ly" href="https://en.wikipedia.org/wiki/Gantt_chart" rel="noopener ugc nofollow" target="_blank">甘特图</a>。甘特图是一种特殊类型的条形图，通常用于显示不同活动之间随时间变化的关系。这些活动可以包括:</p><ul class=""><li id="0410" class="nh ni it le b lf lg li lj ll nj lp nk lt nl lx nm nn no np bi translated">项目管理进度及其当前状态，</li><li id="767f" class="nh ni it le b lf nq li nr ll ns lp nt lt nu lx nm nn no np bi translated">要完成的任务及其截止日期，</li><li id="f03f" class="nh ni it le b lf nq li nr ll ns lp nt lt nu lx nm nn no np bi translated">正在进行的事件，</li><li id="3e16" class="nh ni it le b lf nq li nr ll ns lp nt lt nu lx nm nn no np bi translated">假期。</li></ul><p id="8163" class="pw-post-body-paragraph lc ld it le b lf lg jy lh li lj kb lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">在Python中还有其他更复杂的创建甘特图的方法，比如使用<a class="ae ly" href="https://plotly.com/python/gantt/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>或<a class="ae ly" href="https://pypi.org/project/python-gantt/" rel="noopener ugc nofollow" target="_blank"> python-gantt </a>库。然而，<code class="fe jq jr js jt b">broken_barh</code> matplotlib函数也足以创建一个基本但信息丰富的图形。此外，它只需要几行代码就可以完成。</p><p id="14e9" class="pw-post-body-paragraph lc ld it le b lf lg jy lh li lj kb lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">让我们以今年夏天的假期计划为例来说明这种方法是如何工作的。我们将为一个5人的部门使用虚拟数据:</p><pre class="kn ko kp kq gt lz jt ma mb aw mc bi"><span id="cad4" class="md me it jt b gy mf mg l mh mi">plt.figure(figsize=(20,7))</span><span id="18b3" class="md me it jt b gy nx mg l mh mi"># Create broken horizontal bar plots for vacation ranges <br/>x_ranges = [[(0,3), (36,3), (69,12)], [(13,19), (55,5)], [(48,5), (76,12)], [(27,19)], [(0,4), (62,12), (86,2)]]<br/>y_start = 0.75<br/>colors = ['deepskyblue', 'indianred', 'limegreen', 'gold', 'violet']<br/>for i in range(len(x_ranges)):<br/>    plt.broken_barh(x_ranges[i], (y_start+i, 0.5), color=colors[i])</span><span id="399b" class="md me it jt b gy nx mg l mh mi"># Create broken horizontal bar plots for weekends <br/>x_weekend = [(4,2), (11,2), (18,2), (25,2), (32,2), (39,2), (46,2), (53,2), (60,2), (67,2), (74,2), (81,2), (88,2)]<br/>y_weekend = (0, 5.5)<br/>plt.broken_barh(x_weekend, y_weekend, color='tomato', alpha=0.1)</span><span id="bf08" class="md me it jt b gy nx mg l mh mi">plt.title('Vacation schedule for June-August 2021', fontsize=35)<br/>plt.xticks(ticks= [0, 4, 9, 14, 19, 24, 30, 34, 39, 44, 49, 54, 61, 65, 70, 75, 80, 85, 90],<br/>           labels=['June', 5, 10, 15, 20, 25, 'July', 5, 10, 15, 20, 25, 'August', 5, 10, 15, 20, 25, 30], fontsize=20)<br/>plt.yticks(ticks= [1, 2, 3, 4, 5], <br/>           labels=['Vladimir', 'Natalia', 'Michael', 'Peter', 'Elena'], fontsize=20)<br/>plt.xlim(0, 92)<br/>plt.ylim(0, 5.5)<br/>plt.axvline(30, color='black')<br/>plt.axvline(61, color='black')<br/>plt.grid(axis='x')<br/>plt.tick_params(left=False, bottom=False)<br/>plt.show()</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nz"><img src="../Images/241958b7f8265d12981aafb26de4ee76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6AaqvpStBLvs5G8SAcaa5w.png"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">作者图片</p></figure><p id="7844" class="pw-post-body-paragraph lc ld it le b lf lg jy lh li lj kb lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">即使不使用任何专门的库，上面的图看起来也很清楚:我们看到了雇员的姓名、每个雇员的假期数和假期范围、主要的时间标志(开始、5日、10日等等。每个月、所有的周末)、重叠假期的时段或者没有人休假的时段。</p><h1 id="c22a" class="ml me it bd mm mn mo mp mq mr ms mt mu kd mv ke mw kg mx kh my kj mz kk na nb bi translated">结论</h1><p id="9dd7" class="pw-post-body-paragraph lc ld it le b lf nc jy lh li nd kb lk ll ne ln lo lp nf lr ls lt ng lv lw lx im bi translated">在本文中，我们探索了一个很少使用但很方便的<code class="fe jq jr js jt b">broken_barh</code> matplotlib方法的语法，定制结果图的方法，特别是该方法有特殊用途的情况，即在同一图上显示不同类别的范围(边界条件、工资范围)，在另一个图上强调一些区间(汇率变化、交通量波动)，以及创建甘特图(可视化计划，如项目步骤、任务或假期)。</p><p id="8963" class="pw-post-body-paragraph lc ld it le b lf lg jy lh li lj kb lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">感谢阅读！</p></div><div class="ab cl oa ob hx oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="im in io ip iq"><p id="338d" class="pw-post-body-paragraph lc ld it le b lf lg jy lh li lj kb lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le iu">相关主题:</strong></p><div class="oh oi gp gr oj ok"><a rel="noopener follow" target="_blank" href="/how-to-fill-plots-with-patterns-in-matplotlib-58ad41ea8cf8"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">如何在Matplotlib中用模式填充绘图</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">向条形图、直方图、箱线图和饼图添加图案的方法</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">towardsdatascience.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy kw ok"/></div></div></a></div><div class="oh oi gp gr oj ok"><a rel="noopener follow" target="_blank" href="/bar-plots-alternatives-specific-types-9d10ef250e5"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">条形图:备选方案和特定类型</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">何时以及是否使用它们</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">towardsdatascience.com</p></div></div><div class="ot l"><div class="oz l ov ow ox ot oy kw ok"/></div></div></a></div><div class="oh oi gp gr oj ok"><a href="https://medium.com/geekculture/creating-toyplots-in-python-49de0bb27ec1" rel="noopener follow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">在Python 🧸中创建玩具图</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">高质量的极简交互式可视化，非常适合电子出版</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">medium.com</p></div></div><div class="ot l"><div class="pa l ov ow ox ot oy kw ok"/></div></div></a></div></div></div>    
</body>
</html>