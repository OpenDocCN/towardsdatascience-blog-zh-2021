<html>
<head>
<title>How To Fix pandas.parser.CParserError: Error tokenizing data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何修复pandas.parser.CParserError:标记数据时出错</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/fix-pandas-parser-error-tokenizing-data-889167292d38?source=collection_archive---------0-----------------------#2021-12-01">https://towardsdatascience.com/fix-pandas-parser-error-tokenizing-data-889167292d38?source=collection_archive---------0-----------------------#2021-12-01</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="7780" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">了解在pandas中读取CSV文件时出现错误的原因以及如何处理该错误</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/89dfc44c7d48830a77d886fba38a8ce8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dGxL8kAMIJBEaLEsPsHfzQ.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">由<a class="ae kz" href="https://unsplash.com/@markusspiske?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">马库斯·斯皮斯克</a>在<a class="ae kz" href="https://unsplash.com/s/photos/token?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h2 id="4233" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">介绍</h2><p id="26a7" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">从csv文件导入数据可能是实例化pandas数据帧最常用的方式。然而，很多时候这可能有点棘手，尤其是当文件中包含的数据不是预期的形式时。在这些情况下，pandas parser可能会引发类似下面报告的错误:</p><pre class="kk kl km kn gu mp mq mr ms aw mt bi"><span id="d816" class="la lb iu mq b gz mu mv l mw mx">pandas.errors.ParserError: Error tokenizing data. C error: Expected 5 fields in line 2, saw 6</span></pre><p id="383a" class="pw-post-body-paragraph lw lx iu ly b lz my jv mb mc mz jy me lj na mg mh ln nb mj mk lr nc mm mn mo in bi translated">在今天的简短指南中，我们将首先讨论为什么会出现这个错误，此外，我们还将讨论一些最终可以帮助您处理它的方法。</p></div><div class="ab cl nd ne hy nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="in io ip iq ir"><h2 id="68e4" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">重现错误</h2><p id="0bdc" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">首先，让我们使用我在本教程中准备的一个小数据集来重现这个错误。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nk nl l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">包含不一致格式数据的示例文件— <a class="ae kz" href="https://gmyrianthous.medium.com/" rel="noopener">来源:作者</a></p></figure><p id="ca94" class="pw-post-body-paragraph lw lx iu ly b lz my jv mb mc mz jy me lj na mg mh ln nb mj mk lr nc mm mn mo in bi translated">现在，如果我们尝试使用<code class="fe nm nn no mq b">read_csv</code>读取文件:</p><pre class="kk kl km kn gu mp mq mr ms aw mt bi"><span id="c531" class="la lb iu mq b gz mu mv l mw mx">import pandas as pd</span><span id="7d2b" class="la lb iu mq b gz np mv l mw mx">df = pd.read_csv('test.txt')</span></pre><p id="12bb" class="pw-post-body-paragraph lw lx iu ly b lz my jv mb mc mz jy me lj na mg mh ln nb mj mk lr nc mm mn mo in bi translated">我们将得到下面的错误</p><pre class="kk kl km kn gu mp mq mr ms aw mt bi"><span id="edbe" class="la lb iu mq b gz mu mv l mw mx">pandas.errors.ParserError: Error tokenizing data. C error: Expected 4 fields in line 4, saw 6</span></pre><p id="74dc" class="pw-post-body-paragraph lw lx iu ly b lz my jv mb mc mz jy me lj na mg mh ln nb mj mk lr nc mm mn mo in bi translated">这个错误非常明显，因为它表明在第4行而不是4行，观察到了6个字段(顺便说一下，同样的问题也出现在最后一行)。</p><p id="8733" class="pw-post-body-paragraph lw lx iu ly b lz my jv mb mc mz jy me lj na mg mh ln nb mj mk lr nc mm mn mo in bi translated">默认情况下，<code class="fe nm nn no mq b">read_csv</code>使用逗号(<code class="fe nm nn no mq b">,</code>)作为分隔符，但是很明显，文件中两行的分隔符比预期的多。在这种情况下，预期的数字实际上是4，因为我们的头(即文件的第一行)包含4个用逗号分隔的字段。</p></div><div class="ab cl nd ne hy nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="in io ip iq ir"><h2 id="f038" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">手动修复文件</h2><p id="c659" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">这个问题最明显的解决方案，是通过删除行中给我们带来麻烦的额外分隔符来手动修复数据文件。这实际上是最佳解决方案(假设您已经指定了正确的分隔符、标题等)。调用<code class="fe nm nn no mq b">read_csv</code>函数时)。然而，当您需要处理包含数千行的大文件时，这可能是相当棘手和痛苦的。</p></div><div class="ab cl nd ne hy nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="in io ip iq ir"><h2 id="ac41" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">指定行结束符</h2><p id="2301" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">此错误的另一个原因可能与数据中的某些回车符(即<code class="fe nm nn no mq b">'\r’</code>)有关。在某些场合这实际上是通过<code class="fe nm nn no mq b">pandas.to_csv()</code>方法引入的。将pandas数据帧写入CSV文件时，会在列名中添加一个回车，然后该方法会将后续的列名写入pandas数据帧的第一列。因此我们将在第一行中得到不同数量的列。</p><p id="7720" class="pw-post-body-paragraph lw lx iu ly b lz my jv mb mc mz jy me lj na mg mh ln nb mj mk lr nc mm mn mo in bi translated">如果是这种情况，那么您可以在调用<code class="fe nm nn no mq b">read_csv()</code>时使用相应的参数显式地指定<code class="fe nm nn no mq b">'\n' </code>的行结束符:</p><pre class="kk kl km kn gu mp mq mr ms aw mt bi"><span id="f628" class="la lb iu mq b gz mu mv l mw mx">import pandas as pd </span><span id="3473" class="la lb iu mq b gz np mv l mw mx">df = pd.read_csv('test.csv', <strong class="mq iv">lineterminator='\n'</strong>)</span></pre></div><div class="ab cl nd ne hy nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="in io ip iq ir"><h2 id="6488" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">指定正确的分隔符和标题</h2><p id="2441" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">该错误也可能与调用<code class="fe nm nn no mq b">read_csv</code>时指定的分隔符和/或头(非)有关。确保传递正确的分隔符和标题。</p><p id="ea57" class="pw-post-body-paragraph lw lx iu ly b lz my jv mb mc mz jy me lj na mg mh ln nb mj mk lr nc mm mn mo in bi translated">例如，下面的参数指定<code class="fe nm nn no mq b">;</code>是用于分隔列的分隔符(默认情况下逗号用作分隔符),并且文件不包含任何标题。</p><pre class="kk kl km kn gu mp mq mr ms aw mt bi"><span id="75ee" class="la lb iu mq b gz mu mv l mw mx">import pandas as pd</span><span id="82e2" class="la lb iu mq b gz np mv l mw mx">df = pd.read_csv('test.csv', sep=';', header=None)</span></pre></div><div class="ab cl nd ne hy nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="in io ip iq ir"><h2 id="2b7d" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">跳过行</h2><p id="e47c" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">跳过导致错误的行应该是您最后的手段，我个人不鼓励您这样做，但是我想在某些用例中这是可以接受的。</p><p id="96b1" class="pw-post-body-paragraph lw lx iu ly b lz my jv mb mc mz jy me lj na mg mh ln nb mj mk lr nc mm mn mo in bi translated">如果是这种情况，那么在调用<code class="fe nm nn no mq b">read_csv</code>函数时，可以通过将<code class="fe nm nn no mq b">error_bad_lines</code>设置为<code class="fe nm nn no mq b">False</code>来实现:</p><pre class="kk kl km kn gu mp mq mr ms aw mt bi"><span id="3985" class="la lb iu mq b gz mu mv l mw mx">import pandas as pd </span><span id="1644" class="la lb iu mq b gz np mv l mw mx">df = pd.read_csv('test.txt', <strong class="mq iv">error_bad_lines=False</strong>)</span><span id="dc45" class="la lb iu mq b gz np mv l mw mx">print(df)<br/><em class="nq">   colA colB  colC  colD<br/>0     1    A   100   1.0<br/>1     2    B   121   2.1<br/>2     4    D   164   3.1<br/>3     5    E    55   4.5</em></span></pre><p id="c122" class="pw-post-body-paragraph lw lx iu ly b lz my jv mb mc mz jy me lj na mg mh ln nb mj mk lr nc mm mn mo in bi translated">正如您从上面的输出中看到的，导致错误的行实际上被跳过了，现在我们可以继续处理我们的pandas数据帧了。</p></div><div class="ab cl nd ne hy nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="in io ip iq ir"><h2 id="78f3" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">最后的想法</h2><p id="f311" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">在今天的简短指南中，我们讨论了在将csv文件读入pandas数据帧时，pandas解析器引发<code class="fe nm nn no mq b">pandas.errors.ParserError: Error tokenizing data</code>的几种情况。</p><p id="acb1" class="pw-post-body-paragraph lw lx iu ly b lz my jv mb mc mz jy me lj na mg mh ln nb mj mk lr nc mm mn mo in bi translated">此外，我们展示了如何通过修复数据文件本身的错误或打字错误，或者通过指定适当的行结束符来处理错误。最后，我们还讨论了如何跳过导致错误的行，但是请记住，在大多数情况下，这是应该避免的。</p></div><div class="ab cl nd ne hy nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="in io ip iq ir"><p id="1b77" class="pw-post-body-paragraph lw lx iu ly b lz my jv mb mc mz jy me lj na mg mh ln nb mj mk lr nc mm mn mo in bi translated"><a class="ae kz" href="https://gmyrianthous.medium.com/membership" rel="noopener"> <strong class="ly iv">成为会员</strong> </a> <strong class="ly iv">阅读介质上的每一个故事。你的会员费直接支持我和你看的其他作家。你也可以在媒体上看到所有的故事。</strong></p><div class="nr ns gq gs nt nu"><a href="https://gmyrianthous.medium.com/membership" rel="noopener follow" target="_blank"><div class="nv ab fp"><div class="nw ab nx cl cj ny"><h2 class="bd iv gz z fq nz fs ft oa fv fx it bi translated">通过我的推荐链接加入Medium-Giorgos Myrianthous</h2><div class="ob l"><h3 class="bd b gz z fq nz fs ft oa fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oc l"><p class="bd b dl z fq nz fs ft oa fv fx dk translated">gmyrianthous.medium.com</p></div></div><div class="od l"><div class="oe l of og oh od oi kt nu"/></div></div></a></div></div><div class="ab cl nd ne hy nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="in io ip iq ir"><p id="676e" class="pw-post-body-paragraph lw lx iu ly b lz my jv mb mc mz jy me lj na mg mh ln nb mj mk lr nc mm mn mo in bi translated"><strong class="ly iv">你可能也会喜欢</strong></p><div class="nr ns gq gs nt nu"><a rel="noopener follow" target="_blank" href="/dynamic-typing-in-python-307f7c22b24e"><div class="nv ab fp"><div class="nw ab nx cl cj ny"><h2 class="bd iv gz z fq nz fs ft oa fv fx it bi translated">Python中的动态类型</h2><div class="ob l"><h3 class="bd b gz z fq nz fs ft oa fv fx dk translated">探索Python中对象引用的工作方式</h3></div><div class="oc l"><p class="bd b dl z fq nz fs ft oa fv fx dk translated">towardsdatascience.com</p></div></div><div class="od l"><div class="oj l of og oh od oi kt nu"/></div></div></a></div></div><div class="ab cl nd ne hy nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu nu"><a rel="noopener follow" target="_blank" href="/mastering-indexing-and-slicing-in-python-443e23457125"><div class="nv ab fp"><div class="nw ab nx cl cj ny"><h2 class="bd iv gz z fq nz fs ft oa fv fx it bi translated">掌握Python中的索引和切片</h2><div class="ob l"><h3 class="bd b gz z fq nz fs ft oa fv fx dk translated">深入研究有序集合的索引和切片</h3></div><div class="oc l"><p class="bd b dl z fq nz fs ft oa fv fx dk translated">towardsdatascience.com</p></div></div><div class="od l"><div class="ok l of og oh od oi kt nu"/></div></div></a></div></div></div>    
</body>
</html>