<html>
<head>
<title>Install Airflow 2 on a Raspberry Pi (using Python 3.x)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Raspberry Pi上安装Airflow 2(使用Python 3.x)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/install-airflow-2-on-a-raspberry-pi-using-python-3-x-a137117ba4c7?source=collection_archive---------24-----------------------#2021-07-21">https://towardsdatascience.com/install-airflow-2-on-a-raspberry-pi-using-python-3-x-a137117ba4c7?source=collection_archive---------24-----------------------#2021-07-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="dee7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">构建数据工程管道(使用Raspberry Pi)——第一部分</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4d9e6744d4860640391b9ae4df2e42c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LQB5K6YVag0_iSnUxOj4Mw.png"/></div></div></figure><p id="cc86" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">气流是数据工程常用的工具。编排工作流很棒。Airflow版只支持Python 3+版本，所以我们需要确保使用Python 3来安装。我们也可以将它安装在另一个Linux发行版上。</p><p id="386d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是系列文章的第一篇，在这里我们将构建一个<strong class="kt ir">完整的数据工程管道</strong>(使用Raspberry Pi的)。要关注这个系列，只需<strong class="kt ir">订阅</strong> <a class="ae ln" href="https://pedromadruga.com/newsletter" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">简讯</strong> </a>。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="8356" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">安装依赖项</h1><p id="7f2f" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">让我们确保我们的操作系统是最新的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="0dbe" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，我们将在树莓Pi上安装Python 3.x和Pip。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="7588" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">气流依赖<strong class="kt ir"> numpy </strong>，numpy有自己的依赖关系。我们将通过安装必要的依赖项来解决这个问题:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="1b3f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们还需要确保使用Python3和Pip3安装Airflow，因此我们将为两者设置一个别名。为此，通过添加以下内容来编辑<code class="fe mu mv mw mx b">~/.bashrc</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="1be7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">或者，您可以直接使用<code class="fe mu mv mw mx b">pip3</code>进行安装。对于本教程，我们将假设别名正在使用中。</p><h1 id="b159" class="lv lw iq bd lx ly my ma mb mc mz me mf jw na jx mh jz nb ka mj kc nc kd ml mm bi translated">安装气流</h1><h2 id="ae41" class="nd lw iq bd lx ne nf dn mb ng nh dp mf la ni nj mh le nk nl mj li nm nn ml no bi translated">创建文件夹</h2><p id="b6ad" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">我们需要一个占位符来安装气流。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><h2 id="3b3e" class="nd lw iq bd lx ne nf dn mb ng nh dp mf la ni nj mh le nk nl mj li nm nn ml no bi translated">安装气流组件</h2><p id="58ae" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">最后，我们可以安全地安装气流。我们从定义airflow和python版本开始，以获得正确的约束URL。约束URL确保我们为正确的python版本安装正确的airflow版本。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><h2 id="b564" class="nd lw iq bd lx ne nf dn mb ng nh dp mf la ni nj mh le nk nl mj li nm nn ml no bi translated">初始化数据库</h2><p id="25a9" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">在运行Airflow之前，我们需要初始化数据库。这个设置有几个选项:1)对一个单独的数据库运行Airflow，2)运行一个简单的SQLite数据库。本教程中使用了SQLite数据库，所以除了初始化数据库之外，没有什么要做的。</p><p id="26eb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以让我们初始化它:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><h1 id="2b31" class="lv lw iq bd lx ly my ma mb mc mz me mf jw na jx mh jz nb ka mj kc nc kd ml mm bi translated">运行气流</h1><p id="850d" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">现在可以同时运行服务器和调度程序:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="71c3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在在浏览器上打开<strong class="kt ir"> http://localhost:8080 </strong>。如果您需要登录，您需要创建一个新用户。这里有一个例子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="a001" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦通过验证，现在可以看到主屏幕:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/036b7702ea701e2de04cb3e66e72abd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gt-sXzcedHsPwev20yyesg.png"/></div></div></figure><p id="48a4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">就这样——您现在已经安装了气流系统！可选地，您可以采取额外的步骤。</strong></p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="5775" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">可选择的</h1><h2 id="9f59" class="nd lw iq bd lx ne nf dn mb ng nh dp mf la ni nj mh le nk nl mj li nm nn ml no bi translated">自动启动气流</h2><p id="ce72" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">为了在系统启动时自动启动web服务器和调度程序，我们需要三个文件:<code class="fe mu mv mw mx b">airflow-webserver.service</code>、<code class="fe mu mv mw mx b">airflow-scheduler.service</code>和一个<code class="fe mu mv mw mx b">environment</code>文件。让我们把它分成几个部分:</p><ol class=""><li id="3b67" class="np nq iq kt b ku kv kx ky la nr le ns li nt lm nu nv nw nx bi translated">到<a class="ae ln" href="https://github.com/apache/airflow/tree/master/scripts/systemd" rel="noopener ugc nofollow" target="_blank"> Airflow的GitHub repo </a>下载<code class="fe mu mv mw mx b">airflow-webserver.service</code>和<code class="fe mu mv mw mx b">airflow-scheduler.service</code></li><li id="2b6f" class="np nq iq kt b ku ny kx nz la oa le ob li oc lm nu nv nw nx bi translated">将它们粘贴到<code class="fe mu mv mw mx b">/etc/systemd/system</code>文件夹中。</li><li id="a1bc" class="np nq iq kt b ku ny kx nz la oa le ob li oc lm nu nv nw nx bi translated">编辑这两个文件。首先，<code class="fe mu mv mw mx b">airflow-webserver.service</code>应该是这样的:</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="79a7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在继续编辑<code class="fe mu mv mw mx b">airflow-scheduler.service</code>文件，看起来应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="8e33" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意<code class="fe mu mv mw mx b">user</code>和<code class="fe mu mv mw mx b">Group</code>已经改变，还有<code class="fe mu mv mw mx b">ExecStart</code>。您还会注意到还有一个尚未创建的<code class="fe mu mv mw mx b">EnvironmentFile</code>。这就是我们接下来要做的。</p><p id="6824" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">4.创建环境文件。你可以叫它任何名字。我选择将其命名为<code class="fe mu mv mw mx b">env </code>，并将其放在<code class="fe mu mv mw mx b">/home/pi/airflow</code>文件夹中。换句话说:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="9e0a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们编辑<code class="fe mu mv mw mx b">env</code>文件并放置内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="2298" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">5.最后，让我们重新加载系统守护进程:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><h1 id="127f" class="lv lw iq bd lx ly my ma mb mc mz me mf jw na jx mh jz nb ka mj kc nc kd ml mm bi translated">就是这样！下一步是什么？</h1><p id="dea3" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">在这个数据工程系列的下一篇博文中，我们将使用Airflow创建我们的第一个有向无环图(DAG)。订阅<a class="ae ln" href="https://pedromadruga.com" rel="noopener ugc nofollow" target="_blank">简讯</a>，不要错过！</p><h1 id="7fc0" class="lv lw iq bd lx ly my ma mb mc mz me mf jw na jx mh jz nb ka mj kc nc kd ml mm bi translated">来源</h1><ol class=""><li id="4e3a" class="np nq iq kt b ku mn kx mo la od le oe li of lm nu nv nw nx bi translated"><a class="ae ln" href="https://airflow.apache.org/docs/apache-airflow/stable/installation.html" rel="noopener ugc nofollow" target="_blank">https://air flow . Apache . org/docs/Apache-air flow/stable/installation . html</a></li><li id="6534" class="np nq iq kt b ku ny kx nz la oa le ob li oc lm nu nv nw nx bi translated"><a class="ae ln" href="https://medium.com/the-kickstarter/apache-airflow-running-on-a-raspberry-pi-2e061f6c3655" rel="noopener">https://medium . com/the-kickstarter/Apache-air flow-running-on-a-raspberry-pi-2e 061 F6 c 3655</a></li><li id="fb48" class="np nq iq kt b ku ny kx nz la oa le ob li oc lm nu nv nw nx bi translated"><a class="ae ln" href="http://www.thecrustyengineer.com/home/post/setting_up_airflow_on_a_raspberry_pi_4_part_1" rel="noopener ugc nofollow" target="_blank">http://www . the crusty engineer . com/home/post/setting _ up _ air flow _ on _ a _ raspberry _ pi _ 4 _ part _ 1</a></li></ol></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><p id="c873" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="og">原载于</em><a class="ae ln" href="https://pedromadruga.com/posts/airflow-install/" rel="noopener ugc nofollow" target="_blank"><em class="og">pedromadruga.com</em></a><em class="og">。</em></p></div></div>    
</body>
</html>