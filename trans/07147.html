<html>
<head>
<title>From raw data to web app deployment with ATOM and Streamlit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">借助ATOM和Streamlit从原始数据到web应用部署</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/from-raw-data-to-web-app-deployment-with-atom-and-streamlit-d8df381aa19f?source=collection_archive---------39-----------------------#2021-06-28">https://towardsdatascience.com/from-raw-data-to-web-app-deployment-with-atom-and-streamlit-d8df381aa19f?source=collection_archive---------39-----------------------#2021-06-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c064c0e7c0f36ee8dedadca163087cdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XHOz5pbLS_2Wo99A"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">由<a class="ae kc" href="https://unsplash.com/@kmuza?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卡洛斯·穆扎</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="ce13" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">介绍</h1><p id="c03d" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在本文中，我们将向您展示如何创建一个简单的web应用程序，该应用程序能够帮助数据科学家在提供的数据集上快速执行预测模型性能的基本分析。用户将能够上传自己的数据集(作为. csv文件)，并以两种方式调整机器学习管道:选择对原始数据集应用哪些数据清理步骤，以及选择要训练和评估的模型。我们将用50行代码完成所有这些工作！怎么会？使用正确的库。</p><ul class=""><li id="537b" class="lz ma iq ld b le mb li mc lm md lq me lu mf ly mg mh mi mj bi translated">我们将使用<a class="ae kc" href="https://tvdboom.github.io/ATOM/" rel="noopener ugc nofollow" target="_blank"> ATOM </a>进行数据处理和模型训练。ATOM是一个为快速探索机器学习管道而设计的库。如果你想对这个包有一个温和的介绍，请阅读这个故事。</li><li id="8465" class="lz ma iq ld b le mk li ml lm mm lq mn lu mo ly mg mh mi mj bi translated">我们将使用<a class="ae kc" href="https://www.google.com/search?q=streamlit&amp;rlz=1C5CHFA_enUS930NL930&amp;oq=streamlit&amp;aqs=chrome.0.0j69i59l2j0l4j69i61.1980j0j7&amp;sourceid=chrome&amp;ie=UTF-8" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>来创建web应用程序。Streamlit是一个流行的库，可以在几分钟内制作出漂亮的数据应用程序。</li></ul></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="3d4a" class="kd ke iq bd kf kg mw ki kj kk mx km kn ko my kq kr ks mz ku kv kw na ky kz la bi translated">构建web应用程序</h1><h2 id="d150" class="nb ke iq bd kf nc nd dn kj ne nf dp kn lm ng nh kr lq ni nj kv lu nk nl kz nm bi translated">建立</h2><p id="09a4" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">开始进行必要的导入并设置streamlit的配置。我们选择一个宽布局，以便有空间显示两个相邻的地块。</p><pre class="nn no np nq gt nr ns nt nu aw nv bi"><span id="4e34" class="nb ke iq ns b gy nw nx l ny nz">import pandas as pd<br/>import streamlit as st<br/>from atom import ATOMClassifier</span><span id="a780" class="nb ke iq ns b gy oa nx l ny nz"># Expand the web app across the whole screen<br/>st.set_page_config(layout="wide")</span></pre><h2 id="6fdb" class="nb ke iq bd kf nc nd dn kj ne nf dp kn lm ng nh kr lq ni nj kv lu nk nl kz nm bi translated">管道菜单</h2><p id="2434" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">这个想法是能够从位于侧边栏的菜单中修改机器学习管道。该菜单将由复选框组成，这些复选框将决定将哪些元素(数据清理步骤或模型)添加到管道中，就像一个菜谱，您可以在其中选择自己的配料。</p><p id="2492" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm ob lo lp lq oc ls lt lu od lw lx ly ij bi translated">使用<code class="fe oe of og ns b">st.sidebar</code>可以将对象添加到streamlit的侧边栏中。我们将要实施的数据清理步骤是:特征缩放、分类特征编码和缺失值插补。</p><pre class="nn no np nq gt nr ns nt nu aw nv bi"><span id="c378" class="nb ke iq ns b gy nw nx l ny nz">st.sidebar.title("Pipeline")<br/><br/># Data cleaning options<br/>st.sidebar.subheader("Data cleaning")<br/>scale = st.sidebar.checkbox("Scale", False, "scale")<br/>encode = st.sidebar.checkbox("Encode", False, "encode")<br/>impute = st.sidebar.checkbox("Impute", False, "impute")</span></pre><p id="2746" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm ob lo lp lq oc ls lt lu od lw lx ly ij bi translated">之后，我们添加可用于拟合数据的模型。这一次，我们将复选框包装在一个字典中，以便以后能够对它们进行循环(注意，我们使用ATOM的模型缩写作为键)。</p><pre class="nn no np nq gt nr ns nt nu aw nv bi"><span id="14eb" class="nb ke iq ns b gy nw nx l ny nz"># Model options<br/>st.sidebar.subheader("Models")<br/>models = {<br/>    "gnb": st.sidebar.checkbox("Gaussian Naive Bayes", True, "gnb"),<br/>    "rf": st.sidebar.checkbox("Random Forest", True, "rf"),<br/>    "et": st.sidebar.checkbox("Extra-Trees", False, "et"),<br/>    "xgb": st.sidebar.checkbox("XGBoost", False, "xgb"),<br/>    "lgb": st.sidebar.checkbox("LightGBM", False, "lgb"),<br/>}</span></pre><p id="c0d0" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm ob lo lp lq oc ls lt lu od lw lx ly ij bi translated"><strong class="ld ir">注意:</strong>确保安装了<a class="ae kc" href="https://pypi.org/project/xgboost/" rel="noopener ugc nofollow" target="_blank"> XGBoost </a>和<a class="ae kc" href="https://pypi.org/project/lightgbm/" rel="noopener ugc nofollow" target="_blank"> LightGBM </a>软件包，以便能够使用这些型号。</p><h2 id="b5cc" class="nb ke iq bd kf nc nd dn kj ne nf dp kn lm ng nh kr lq ni nj kv lu nk nl kz nm bi translated">数据摄取</h2><p id="b358" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">侧边栏菜单已经完成，是时候制作应用程序的主体了。第一部分是数据摄取，我们可以上传想要使用的数据集。为此使用streamlit的<a class="ae kc" href="https://docs.streamlit.io/en/stable/api.html#streamlit.file_uploader" rel="noopener ugc nofollow" target="_blank"> file_uploader </a>函数。</p><pre class="nn no np nq gt nr ns nt nu aw nv bi"><span id="c346" class="nb ke iq ns b gy nw nx l ny nz">st.header("Data")<br/>data = st.file_uploader("Upload data:", type="csv")</span><span id="568e" class="nb ke iq ns b gy oa nx l ny nz"># If a dataset is uploaded, show a preview<br/>if data is not None:<br/>    data = pd.read_csv(data)<br/>    st.text("Data preview:")<br/>    st.dataframe(data.head())</span></pre><h2 id="9a2f" class="nb ke iq bd kf nc nd dn kj ne nf dp kn lm ng nh kr lq ni nj kv lu nk nl kz nm bi translated">模型训练和评估</h2><p id="bfd7" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">最后，编写将处理数据、训练模型和评估结果的实际管道。注意，这个例子只适用于二进制分类任务。</p><pre class="nn no np nq gt nr ns nt nu aw nv bi"><span id="4fb4" class="nb ke iq ns b gy nw nx l ny nz">st.header("Results")<br/><br/>if st.sidebar.button("Run"):<br/>    placeholder = st.empty()  # Empty to overwrite write statements<br/>    placeholder.write("Initializing atom...")<br/><br/>    # Initialize atom<br/>    atom = ATOMClassifier(data, verbose=2, random_state=1)<br/><br/>    if scale:<br/>        placeholder.write("Scaling the data...")<br/>        atom.scale()<br/>    if encode:<br/>        placeholder.write("Encoding the categorical features...")<br/>        atom.encode(strategy="LeaveOneOut", max_onehot=10)<br/>    if impute:<br/>        placeholder.write("Imputing the missing values...")<br/>        atom.impute(strat_num="median", strat_cat="most_frequent")<br/>    <br/>    placeholder.write("Fitting the models...")<br/>    to_run = [key for key, value in models.items() if value]<br/>    atom.run(models=to_run, metric="f1")<br/>    <br/>    # Display metric results<br/>    placeholder.write(atom.evaluate())<br/><br/>    # Draw plots<br/>    col1, col2 = st.beta_columns(2)<br/>    col1.write(atom.plot_roc(title="ROC curve", display=None))<br/>    col2.write(atom.plot_prc(title="PR curve", display=None))<br/><br/>else:<br/>    st.write("No results yet. Click the run button!")</span></pre><p id="1fb0" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm ob lo lp lq oc ls lt lu od lw lx ly ij bi translated">这是相当大的一段代码，所以让我解释一下这里发生了什么。开始的<em class="oh"> if语句</em>在侧边栏中创建了一个按钮，如果点击它，就会执行<em class="oh"> if语句</em>中的代码块。只要没有单击该按钮，管道就不会运行。这确保了管道不会在每次单击菜单中的一个复选框后开始运行。<em class="oh"> if语句</em>内的代码块执行以下操作:</p><ul class=""><li id="5c66" class="lz ma iq ld b le mb li mc lm md lq me lu mf ly mg mh mi mj bi translated">创建一个占位符文本块，以便在管道运行时写入一些进度信息。</li><li id="b5a5" class="lz ma iq ld b le mk li ml lm mm lq mn lu mo ly mg mh mi mj bi translated">初始化一个将处理管道的<a class="ae kc" href="https://tvdboom.github.io/ATOM/API/ATOM/atomclassifier/" rel="noopener ugc nofollow" target="_blank"> ATOMClassifier </a>实例。使用此命令，数据会自动拆分为80%-20%比率的训练集和测试集。</li><li id="f78d" class="lz ma iq ld b le mk li ml lm mm lq mn lu mo ly mg mh mi mj bi translated">运行侧栏中每个选中复选框对应的数据清理步骤。</li><li id="ebca" class="lz ma iq ld b le mk li ml lm mm lq mn lu mo ly mg mh mi mj bi translated">使用atom的<a class="ae kc" href="https://tvdboom.github.io/ATOM/API/ATOM/atomclassifier/#run" rel="noopener ugc nofollow" target="_blank"> run </a>方法在训练集上训练所有选择的模型。</li><li id="43dc" class="lz ma iq ld b le mk li ml lm mm lq mn lu mo ly mg mh mi mj bi translated">使用<a class="ae kc" href="https://tvdboom.github.io/ATOM/API/ATOM/atomclassifier/#scoring" rel="noopener ugc nofollow" target="_blank">评分</a>方法输出模型在测试集上的表现。</li><li id="1297" class="lz ma iq ld b le mk li ml lm mm lq mn lu mo ly mg mh mi mj bi translated">显示所有训练模型的<a class="ae kc" href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic" rel="noopener ugc nofollow" target="_blank">接收机工作特性曲线</a>和<a class="ae kc" href="https://en.wikipedia.org/wiki/Precision_and_recall" rel="noopener ugc nofollow" target="_blank">精度-召回曲线</a>。display=None参数对于返回创建的matplotlib图形是必需的。</li></ul><h2 id="0675" class="nb ke iq bd kf nc nd dn kj ne nf dp kn lm ng nh kr lq ni nj kv lu nk nl kz nm bi translated">尝试一下</h2><p id="0ec2" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">就这样，web应用程序完成了！让我们试一试。要运行该应用程序，请打开终端并转到文件所在的目录。运行命令<code class="fe oe of og ns b">streamlit run &lt;name_web_app&gt;.py</code>。web应用程序将自动在您的默认浏览器中打开。按照此处<a class="ae kc" href="https://docs.streamlit.io/en/stable/deploy_streamlit_app.html" rel="noopener ugc nofollow" target="_blank">描述的步骤</a>进行部署。</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oi"><img src="../Images/ef2720e6efcd0bc552ff26451776680d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*37CkqBYVc2whUca2QQBqxA.gif"/></div></div></figure><p id="c6ce" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm ob lo lp lq oc ls lt lu od lw lx ly ij bi translated">所示示例中使用的数据是来自Kaggle的<a class="ae kc" href="https://www.kaggle.com/jsphyg/weather-dataset-rattle-package" rel="noopener ugc nofollow" target="_blank">澳大利亚天气数据集</a>的变体。可以从<a class="ae kc" href="https://github.com/tvdboom/ATOM/blob/master/examples/datasets/weatherAUS.csv" rel="noopener ugc nofollow" target="_blank">这里</a>下载。这个数据集的目标是预测明天是否会下雨，在目标列<code class="fe oe of og ns b">RainTomorrow</code>上训练一个二元分类器。这个例子的完整代码可以在<a class="ae kc" href="https://github.com/tvdboom/ATOM/blob/master/examples/webapp/webapp.py" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="0718" class="kd ke iq bd kf kg mw ki kj kk mx km kn ko my kq kr ks mz ku kv kw na ky kz la bi translated">结论</h1><p id="1e31" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">我们已经看到了如何使用ATOM和Streamlit快速创建一个能够探索基本机器学习管道的web应用程序。由于这两个库的灵活性和易用性，添加新模型、允许回归管道、显示一些额外的图表或增加管道的复杂性，都不会花费太多精力来改进web应用程序。</p><p id="9957" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm ob lo lp lq oc ls lt lu od lw lx ly ij bi translated">相关故事:</p><ul class=""><li id="75ca" class="lz ma iq ld b le mb li mc lm md lq me lu mf ly mg mh mi mj bi translated"><a class="ae kc" rel="noopener" target="_blank" href="/atom-a-python-package-for-fast-exploration-of-machine-learning-pipelines-653956a16e7b">https://towards data science . com/atom-a-python-package-for-fast-exploration-of-machine-learning-pipelines-653956 a16 e7b</a></li><li id="318f" class="lz ma iq ld b le mk li ml lm mm lq mn lu mo ly mg mh mi mj bi translated"><a class="ae kc" rel="noopener" target="_blank" href="/how-to-test-multiple-machine-learning-pipelines-with-just-a-few-lines-of-python-1a16cb4686d">https://towards data science . com/how-to-test-multiple-machine-learning-pipelines-with-just-the-less-lines-of-python-1 a16 CB 4686d</a></li></ul><p id="3127" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm ob lo lp lq oc ls lt lu od lw lx ly ij bi translated">有关ATOM的更多信息，请查看该项目的<a class="ae kc" href="https://github.com/tvdboom/ATOM" rel="noopener ugc nofollow" target="_blank"> GitHub </a>或<a class="ae kc" href="https://tvdboom.github.io/ATOM/" rel="noopener ugc nofollow" target="_blank">文档</a>页面。对于bug或特性请求，请不要犹豫，在GitHub上打开问题或给我发电子邮件。</p></div></div>    
</body>
</html>