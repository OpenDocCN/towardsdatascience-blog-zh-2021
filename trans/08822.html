<html>
<head>
<title>When a uniform threshold is not enough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当统一的阈值不够时</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/when-a-uniform-threshold-is-not-enough-b16da0fbb4e1?source=collection_archive---------19-----------------------#2021-08-14">https://towardsdatascience.com/when-a-uniform-threshold-is-not-enough-b16da0fbb4e1?source=collection_archive---------19-----------------------#2021-08-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9e0e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">适应可以走很长的路。</h2></div><p id="ee28" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你儿子是阅兵式上唯一一个步调一致的士兵？</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/3c52be907f843114af77f2e766cafaea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ipqsQiohugULMQ0oTa0fxQ.jpeg"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图一。由<a class="ae lr" href="https://unsplash.com/@mrmarkdejong" rel="noopener ugc nofollow" target="_blank">马克·德容</a>在<a class="ae lr" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="f73f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你立刻就注意到了。不是因为这是你的儿子，而是因为你善于发现规律中的偏差。</p><p id="5635" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你的工作是在显微镜下检查平板显示器，以检测异常像素，这种超能力可能会被证明是有用的——只要你能连续几个小时这样做而不会无聊死。</p><p id="0bf8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检查常规模式很容易——对任何人来说都是如此——但是非常乏味。这是一项应该用计算机视觉自动完成的任务。</p><h2 id="6dc9" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">织物中的缺陷</h2><p id="5503" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">织物是具有规则图案的制成品的一个例子，任何偏差都被认为是缺陷。</p><blockquote class="mq"><p id="bd79" class="mr ms iq bd mt mu mv mw mx my mz la dk translated">让我们站在一位计算机视觉工程师的立场上，他负责设计一个自动系统，用于检测从织机上输出的布条的图像。</p></blockquote><figure class="nb nc nd ne nf lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi na"><img src="../Images/80ef3d4511bc20adc6a5878092d6dbda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WivLB5swnrSWNDnjreTKpw.jpeg"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图二。漂亮的布料图案。在<a class="ae lr" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae lr" href="https://unsplash.com/@anigmb" rel="noopener ugc nofollow" target="_blank">安娜露莎·甘博亚</a>的照片。</p></figure><p id="b2a6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将使用<a class="ae lr" href="https://www.aitex.es/afid/" rel="noopener ugc nofollow" target="_blank"> AITEX织物图像数据库</a>【1】。它由有缺陷和无缺陷的织物条的灰度图像组成。该数据库还包括指示缺陷位置的掩模。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ng"><img src="../Images/a4970a87887990f6df8b55058580318b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PSLZkVl0zYCcvPLNWHS48w.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图3。织物带(上图)及其相应缺陷遮罩(下图)的图像。缺陷显示为黑色。来自<a class="ae lr" href="https://www.aitex.es/afid/" rel="noopener ugc nofollow" target="_blank"> AITEX织物图像数据库</a>的图像。</p></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ng"><img src="../Images/c838526e0acb9d59b942dd658a1e0d14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9-ju5a1ueQzDcSdr8PN9tg.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图4。织物带(上图)及其相应缺陷遮罩(下图)的图像。缺陷看起来很亮。来自<a class="ae lr" href="https://www.aitex.es/afid/" rel="noopener ugc nofollow" target="_blank"> AITEX织物图像数据库</a>的图像。</p></figure><blockquote class="nh ni nj"><p id="3460" class="kf kg nk kh b ki kj jr kk kl km ju kn nl kp kq kr nm kt ku kv nn kx ky kz la ij bi translated">我们将重点关注那些以像素斑点形式出现的缺陷，这些像素的灰度明显高于或低于其周围环境。我们将不描述织物的质地。</p></blockquote><p id="9256" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以在这里找到本文<a class="ae lr" href="https://github.com/sebastiengilbert73/tutorial_adaptiveThreshold" rel="noopener ugc nofollow" target="_blank">中使用的代码。</a></p><p id="d82a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一种合理的方法是应用阈值操作来突出亮像素，并应用反阈值操作来突出暗像素。阈值(对于两种操作)将必须单独计算，因为整体灰度级从一幅图像到下一幅图像变化很大。</p><h2 id="2a78" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">均匀阈值</h2><p id="a8b4" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">一个好的起点是评估图像的中间灰度级，因为中间灰度级不会受到图像左侧的太大影响，在图像左侧，成像系统可能在织物带到达照相机的成像线之前扫描列。然后可以通过将灰度级中值加上(对于标准阈值)或减去(对于逆阈值)一个固定量来设置阈值。这些增量值的大小将决定阈值操作对于亮像素和暗像素的敏感度。</p><p id="8875" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将这种方法称为<a class="ae lr" href="https://github.com/sebastiengilbert73/tutorial_adaptiveThreshold/blob/main/uniform_thresholding.py" rel="noopener ugc nofollow" target="_blank"> <em class="nk">统一阈值</em> </a>，因为单个阈值和逆阈值将统一应用于图像。</p><p id="a2e4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们首先模糊图像以衰减其高频成分，假设缺陷将大于几个相连的像素。OpenCV函数<a class="ae lr" href="https://docs.opencv.org/2.4/modules/imgproc/doc/filtering.html?highlight=blur#cv2.blur" rel="noopener ugc nofollow" target="_blank"> cv2.blur() </a>对中心像素附近的灰度级进行均匀平均。我们选择一个足够大的邻域大小，以使不需要的图案消失，但是足够小，例如足够大的缺陷仍然从背景中清晰地突出。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi no"><img src="../Images/840186079b37a19b60e60c60991d6cd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*5LnBpgXctzvl4y8IiQKLpQ.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图5。使用11x11的邻域大小进行均匀平均的模糊效果。图片由作者提供。</p></figure><p id="6780" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了计算中位数，我们调用NumPy的函数<a class="ae lr" href="https://numpy.org/doc/stable/reference/generated/numpy.median.html" rel="noopener ugc nofollow" target="_blank"> np.median() </a>。</p><p id="3024" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">标准阈值和反阈值操作都由OpenCV函数<a class="ae lr" href="https://docs.opencv.org/2.4/modules/imgproc/doc/miscellaneous_transformations.html?highlight=threshold#cv2.threshold" rel="noopener ugc nofollow" target="_blank"> cv2.threshold() </a>实现。函数参数中的“类型”标志指定了所需的操作类型。我们通过偏移刚刚计算的中值灰度级来获得两种操作的阈值。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="np nq l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">标准和逆阈值。作者代码。</p></figure><p id="196d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在将暗像素的掩模与亮像素的掩模合并之后，我们得到异常掩模，突出灰度级足够暗或足够亮的像素。如果我们忽略图像的左侧，在某些情况下我们会得到好的结果。看起来我们只差一点点了！</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ng"><img src="../Images/95323aa0037ed2a16fb2aee1a452a263.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W_PFOlvWNKp7fnIpNCYzPA.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图6。统一阈值成功识别异常的三个例子(红色=明亮；蓝色=深色)。图片由作者提供。</p></figure><p id="44e8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但这并不是故事的结尾！</p><p id="4a7a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">随着我们测试更多的图像，我们发现织物带的大部分区域被检测为亮或暗，而我们的判断告诉我们这些区域不应被视为异常。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ng"><img src="../Images/a97308ac288182aa46eb8d2e3f512227.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zbXxSPdVlZy8hKPtalphTw.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图6。三个示例中，统一阈值突出显示了没有异常的区域。图片由作者提供。</p></figure><p id="f83f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们达到了统一阈值方法的极限。经过一些研究，我们观察到，在某些情况下，当我们从左向右扫描图像时，平均灰度级缓慢变化。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nr"><img src="../Images/79311356ffa4dea655be0234a23971c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NN9JAwMQ1b9d3W36ukPJ_w.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图8。每列的平均灰度级示例。变化是显著的。图片由作者提供。</p></figure><p id="2e27" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">原因可能与成像系统有关。也许图像是用线扫描相机拍摄的，并且光照强度或积分时间不是恒定的。这也可能与产品本身有关:织物的颜色可能会随着条纹的变化而变化。我们不知道为什么，但我们必须处理这个问题。</p><blockquote class="mq"><p id="aad1" class="mr ms iq bd mt mu mv mw mx my mz la dk translated">统一的门槛是不够的。</p></blockquote><h2 id="8ba4" class="ls lt iq bd lu lv ns dn lx ly nt dp ma ko nu mc md ks nv mf mg kw nw mi mj mk bi translated">自适应阈值</h2><p id="38ff" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">自适应阈值正是为这种情况而发明的。不是对整个图像使用单个阈值，<strong class="kh ir">每个像素都计算其阈值</strong>，因此有了限定词<em class="nk">自适应</em>。</p><p id="5568" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于给定的中心像素，评估邻域中像素的灰度加权平均值。阈值是平均灰度级，偏移某个常数以提供所需的灵敏度级别。在输出遮罩中，将中心像素灰度级与其自己的个性化阈值进行比较。</p><p id="72cc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">自适应阈值处理允许高亮显示与它们的邻域有足够差异<em class="nk">的像素，而不是简单地高于或低于统一阈值。</em></p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nx"><img src="../Images/6c7f9653d8ea015e3824bcd3a5115f73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uVMOvmTJZEVEn2aFEDH9RQ.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图9。左图:棋盘的原始图像。中心:<a class="ae lr" href="https://github.com/sebastiengilbert73/tutorial_adaptiveThreshold/blob/main/threshold_checkerboard.py" rel="noopener ugc nofollow" target="_blank">均匀阈值</a>由于光照不均匀，无法同时分割黑色和白色方块。右图:自适应阈值处理可以同时分割黑色和白色方块。图片由作者提供。</p></figure><p id="5786" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">回到均匀阈值处理没有产生良好结果的织物图像情况，我们可以找到一组工作得更好的参数，使用<a class="ae lr" href="https://github.com/sebastiengilbert73/tutorial_adaptiveThreshold/blob/main/adaptive_thresholding.py" rel="noopener ugc nofollow" target="_blank">自适应阈值处理</a>(由OpenCV函数<a class="ae lr" href="https://docs.opencv.org/2.4/modules/imgproc/doc/miscellaneous_transformations.html?highlight=adaptivethreshold#cv2.adaptiveThreshold" rel="noopener ugc nofollow" target="_blank">cv2 . adaptive threshold()</a>实现)。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="np nq l"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">标准和反向自适应阈值处理。作者代码。</p></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ng"><img src="../Images/a72a997a803772f0ed35fec9e9070a9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*okN_woyKQJnC0o3eDyF3PA.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">图10。当平均灰度级沿x轴缓慢变化时，自适应阈值产生更好的结果。图片由作者提供。</p></figure><p id="84ba" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从这一点来看，下一步将是基于维度标准和与其他斑点的接近度(或者机器学习，如果我们有足够的例子)来过滤异常掩模斑点。这将是一个巨大的挑战，但至少，通过这个简单的技术，我们摆脱了与织物缺陷无关的伪像。</p><h2 id="925f" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">结论</h2><p id="1f1c" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">在自动化系统检测零件的制造环境中，经常会遇到类似于我们刚刚观察到的图像不一致的情况。照明条件可能不同，被检测的零件可能有不同的颜色或反射率，多个摄像头可能有不同的灵敏度，等等。</p><p id="6dc1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">设计对这些变化具有鲁棒性的计算机视觉系统是至关重要的，因为它们不是制造工程师和操作员所关心的:找到缺陷而不被大量的错误警报所超载。有时，像使用自适应阈值这样简单的事情会有很大帮助。</p></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><p id="1b64" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">[1] AFID:用于缺陷检测的公共织物图像数据库。Javier Silvestre-Blanes，Teresa Albero-Albero，Ignacio Miralles，Rubén Pérez-Llorens，Jorge Moreno，AUTEX研究杂志，2019年第4期</p></div></div>    
</body>
</html>