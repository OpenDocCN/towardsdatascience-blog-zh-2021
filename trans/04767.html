<html>
<head>
<title>Transfer learning applied on the Unsplash data using the Alexnet pre-trained network from MATLAB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用来自MATLAB的Alexnet预训练网络对Unsplash数据应用迁移学习</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/transfer-learning-applied-on-the-unsplash-data-using-alexnet-pretrained-network-2fc6aa70d43a?source=collection_archive---------35-----------------------#2021-04-25">https://towardsdatascience.com/transfer-learning-applied-on-the-unsplash-data-using-alexnet-pretrained-network-2fc6aa70d43a?source=collection_archive---------35-----------------------#2021-04-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fc5b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><strong class="ak">使用MATLAB预先训练的深度学习网络进行迁移学习可以很容易地实现，以获得快速和令人印象深刻的结果</strong></h2></div><p id="7c57" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我从Unsplash获得了图像数据。我下载了42幅猫的图像、46幅狗的图像和35幅马的图像，输入到MATLAB中预先训练好的Alexnet模型中。有关MATLAB中Alexnet网络的详细信息，请参见其<a class="ae lb" href="https://www.mathworks.com/help/deeplearning/ref/alexnet.html" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/9f3ccc4c35c84ef7fa6457080db2a600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5di5WrBjFRClfF_2"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">照片由<a class="ae lb" href="https://unsplash.com/@jjying?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> JJ英</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="39f6" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">Alexnet</h1><p id="d057" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">AlexNet是一个8层深度的卷积神经网络。MATLAB有一个预先训练好的网络版本，对来自<a class="ae lb" href="https://www.mathworks.com/help/deeplearning/ref/alexnet.html#bvk8vk9_sep_mw_6dc28e13-2f10-44a4-9632-9b8d43b376fe" rel="noopener ugc nofollow" target="_blank"> ImageNet数据库</a>的100多万张图像进行训练。预训练的网络可以将图像分类为1000个预定义的对象类别。</p><p id="f68c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">针对一百万幅图像上的1000个对象类别的训练使得该网络学习了广泛图像的丰富特征表示。</p><div class="mp mq gp gr mr ms"><a href="https://www.earthinversion.com/machinelearning/transfer-learning-applied-on-unsplash-data-using-alexnet/" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">基于alexnet预训练网络的迁移学习在Unsplash数据上的应用</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">我从Unsplash获得了图像数据。我下载了42张猫的图片，46张狗的图片，35张马的图片…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">www.earthinversion.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng lm ms"/></div></div></a></div><h1 id="027d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">装置</h1><p id="bb47" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">您可以通过键入以下命令来检查alexnet的安装</p><pre class="ld le lf lg gt nh ni nj nk aw nl bi"><span id="b5aa" class="nm lt iq ni b gy nn no l np nq">alexnet</span></pre><p id="e914" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在命令行中。如果没有安装，它会在附加资源管理器中提示指向所需支持包的链接。简单来说，跟着链接走。</p><h1 id="bddc" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">为什么要转学？</h1><p id="3ffe" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">迁移学习因其速度快、易于实现而成为深度学习应用中的热门。人们可以使用预先训练好的网络，并将其作为学习新任务的起点。这使用较少数量的训练图像将学习的特征快速转移到新的任务。</p><h1 id="ee6e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">数据</h1><p id="8f5e" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">我从Unsplash网站上获得了这三类图片。Unsplash提供了数百万张高质量的免费图片。我获得了猫、狗和马的图像。使用这些类别没有特定的原因，但使用猫和狗已经成为测试任何模型的标准，因为它提供了足够的鲁棒性。</p><p id="6da2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我将数据保存到三个子文件夹中，分别标有<code class="fe nr ns nt ni b">cats</code>、<code class="fe nr ns nt ni b">dogs</code>和<code class="fe nr ns nt ni b">horses</code>，在文件夹<code class="fe nr ns nt ni b">unsplashData</code>下。我将压缩数据保存在包含脚本的文件夹中。</p><h1 id="da7f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">准备数据</h1><p id="a81f" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">我们做的第一件事是使用<code class="fe nr ns nt ni b">unzip</code>命令解压数据。然后，我们根据文件夹名称自动标记图像，并将数据存储为一个<code class="fe nr ns nt ni b">ImageDatastore</code>对象。</p><pre class="ld le lf lg gt nh ni nj nk aw nl bi"><span id="5b1c" class="nm lt iq ni b gy nn no l np nq">clear; close; clc;<br/><br/>%% Unzip and load the new images as an image datastore<br/>filename = 'unsplashData';<br/>unzip(strcat(filename,'.zip'));<br/><br/>% imageDatastore automatically labels the images based on folder names and stores the data as an ImageDatastore object<br/>imds = imageDatastore(filename, ...<br/>    'IncludeSubfolders',true, ...<br/>    'LabelSource','foldernames');</span></pre><h1 id="e761" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">将数据分为训练数据集和验证数据集</h1><p id="1eb4" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">我们使用随机选择的图像的70%用于训练，30%用于验证。</p><pre class="ld le lf lg gt nh ni nj nk aw nl bi"><span id="0c9f" class="nm lt iq ni b gy nn no l np nq">[imdsTrain,imdsValidation] = splitEachLabel(imds,0.7,'randomized');</span></pre><h1 id="b8b3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">可视化加载的图像</h1><p id="c948" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">我们绘制了16个随机选择的数据。</p><pre class="ld le lf lg gt nh ni nj nk aw nl bi"><span id="6487" class="nm lt iq ni b gy nn no l np nq">visualize = 1;<br/>if visualize==1<br/>    numTrainImages = numel(imdsTrain.Labels);<br/>    idx = randperm(numTrainImages,16);<br/>    fig1 = figure;<br/>    for i = 1:16<br/>        subplot(4,4,i)<br/>        I = readimage(imdsTrain,idx(i));<br/>        imshow(I)<br/>    end<br/>    print(fig1,strcat(filename,'input-data-selected'),'-djpeg')<br/>end</span></pre><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nu"><img src="../Images/bd11f2aabef00e3b6fb4586344d6840b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mY1LW_KjQs69iNAB.jpg"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">作者图片</p></figure><h1 id="3271" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">负载预训练网络</h1><pre class="ld le lf lg gt nh ni nj nk aw nl bi"><span id="5c84" class="nm lt iq ni b gy nn no l np nq">net = alexnet;<br/>inputSize = net.Layers(1).InputSize</span></pre><p id="29d6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">来分析alexnet网络的层次。</p><pre class="ld le lf lg gt nh ni nj nk aw nl bi"><span id="485c" class="nm lt iq ni b gy nn no l np nq">inspect_network=0;<br/>if inspect_network==1<br/>    analyzeNetwork(net)<br/>end</span></pre><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nv"><img src="../Images/132061b8989240a5e004c446e1525d42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gj8vevaYPTsoK0UB.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">作者图片</p></figure><h1 id="7fb2" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">替换最后三层</h1><p id="38f9" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">我们从预训练的网络中提取所有层，除了最后三层。可以增加完全连接层的WeightLearnRateFactor和BiasLearnRateFactor值，以便在新层中比在转移层中学习得更快</p><pre class="ld le lf lg gt nh ni nj nk aw nl bi"><span id="8ec2" class="nm lt iq ni b gy nn no l np nq">layersTransfer = net.Layers(1:end-3); <br/><br/>numClasses = numel(categories(imdsTrain.Labels)) %the number of classes in the new data<br/><br/>layers = [<br/>    layersTransfer<br/>    fullyConnectedLayer(numClasses,'WeightLearnRateFactor',20,'BiasLearnRateFactor',20)<br/>    softmaxLayer<br/>    classificationLayer];</span></pre><h1 id="ebfd" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">使用增强的图像数据库来自动调整训练图像的大小</h1><p id="fc11" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">alexnet网络设计用于处理固定尺寸(227 x 227 x 3)的图像。我们遵循标准操作来扩充训练图像——沿着垂直轴随机翻转训练图像，将它们随机水平和垂直平移30个像素。数据扩充对于防止网络过度拟合和记忆训练图像的精确细节是必要的。</p><pre class="ld le lf lg gt nh ni nj nk aw nl bi"><span id="d68d" class="nm lt iq ni b gy nn no l np nq">pixelRange = [-30 30];<br/>imageAugmenter = imageDataAugmenter( ...<br/>    'RandXReflection',true, ... %randomly flip the training images along the vertical axis<br/>    'RandXTranslation',pixelRange, ... %randomly translate them up to 30 pixels horizontally and vertically<br/>    'RandYTranslation',pixelRange);<br/><br/><br/>augimdsTrain = augmentedImageDatastore(inputSize(1:2),imdsTrain, ...<br/>    'DataAugmentation',imageAugmenter); <br/><br/>% automatically resize the validation images without performing further data augmentation<br/>augimdsValidation = augmentedImageDatastore(inputSize(1:2),imdsValidation);</span></pre><h1 id="c536" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">微调培训选项</h1><p id="f52b" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">应用迁移学习的目标是保持预训练网络早期层的特征(迁移的层权重)。</p><pre class="ld le lf lg gt nh ni nj nk aw nl bi"><span id="6c92" class="nm lt iq ni b gy nn no l np nq">options = trainingOptions('sgdm', ...<br/>    'MiniBatchSize',10, ... %when performing transfer learning, you do not need to train for as many epochs<br/>    'MaxEpochs',6, ...<br/>    'InitialLearnRate',1e-4, ... %slow down learning in the transferred layers ( fast learning only in the new layers and slower learning in the other layers)<br/>    'Shuffle','every-epoch', ...<br/>    'ValidationData',augimdsValidation, ...<br/>    'ValidationFrequency',3, ...<br/>    'Verbose',false, ...<br/>    'Plots','training-progress', ...<br/>    'ExecutionEnvironment','auto'); %Hardware resource for training network - auto, cpu, gpu, multi-gpu, parallel</span></pre><h1 id="a330" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">训练网络</h1><p id="9b0c" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">我们训练由转移层和新层组成的网络。</p><pre class="ld le lf lg gt nh ni nj nk aw nl bi"><span id="c005" class="nm lt iq ni b gy nn no l np nq">netTransfer = trainNetwork(augimdsTrain,layers,options); %By default, trainNetwork uses a GPU if one is available</span></pre><h1 id="1ae1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">分类验证图像</h1><pre class="ld le lf lg gt nh ni nj nk aw nl bi"><span id="d931" class="nm lt iq ni b gy nn no l np nq">[YPred,scores] = classify(netTransfer,augimdsValidation); %classify using the fine-tuned network</span></pre><p id="0878" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们显示了四个样本验证图像及其预测标签。</p><pre class="ld le lf lg gt nh ni nj nk aw nl bi"><span id="d7ae" class="nm lt iq ni b gy nn no l np nq">classify_visualize = 1;<br/>if classify_visualize==1<br/>    idx = randperm(numel(imdsValidation.Files),4);<br/>    fig = figure;<br/>    for i = 1:4<br/>        subplot(2,2,i)<br/>        I = readimage(imdsValidation,idx(i));<br/>        imshow(I)<br/>        label = YPred(idx(i));<br/>        title(string(label));<br/>    end<br/>    print(fig,strcat(filename,'classification-result'),'-djpeg')<br/>end</span></pre><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nu"><img src="../Images/7668f4dcea532ff2f2642f57ceebd113.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yQG0yCx9eXfh1LA9.jpg"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">作者图片</p></figure><h1 id="9246" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">分类准确度</h1><p id="56e5" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">分类准确度给出了网络正确预测的标签的比例。</p><pre class="ld le lf lg gt nh ni nj nk aw nl bi"><span id="3511" class="nm lt iq ni b gy nn no l np nq">YValidation = imdsValidation.Labels;<br/>accuracy = mean(YPred == YValidation)</span><span id="ae1f" class="nm lt iq ni b gy nw no l np nq">% accuracy = 0.9189</span></pre><h1 id="c9dc" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="a39a" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">我使用MATLAB中预先训练的Alexnet网络，用Unsplash数据对其进行微调。但是，它有可能导致图像数据的任何分类问题。我们还应该探索MATLAB提供的其他几个预训练网络，如squeezenet、resnet18、googlenet等，以实现更好的准确性。准确性在很大程度上取决于数据数量、质量和模型参数，如层数。</p></div><div class="ab cl nx ny hu nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="ij ik il im in"><p id="8f45" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="oe">原载于2021年4月25日</em><a class="ae lb" href="https://www.earthinversion.com/machinelearning/transfer-learning-applied-on-unsplash-data-using-alexnet/" rel="noopener ugc nofollow" target="_blank"><em class="oe">【https://www.earthinversion.com】</em></a><em class="oe">。</em></p></div></div>    
</body>
</html>