<html>
<head>
<title>ARIMA Model In Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的ARIMA模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/arima-model-in-python-7bfc7fb792f9?source=collection_archive---------6-----------------------#2021-04-28">https://towardsdatascience.com/arima-model-in-python-7bfc7fb792f9?source=collection_archive---------6-----------------------#2021-04-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a1f8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">时间序列预测完全指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d3fb65752262d76aef93d0adba0b69e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MIR6fYvGtJEc9naf8mzYVA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@akuan5?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> K许</a>在<a class="ae ky" href="https://unsplash.com/s/photos/airport?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="b05b" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">ARIMA是最流行的统计模型之一。它代表自回归综合移动平均，适合时间序列数据，用于预测或更好地理解数据。我们不会涵盖ARIMA模型背后的整个理论，但我们会告诉你正确应用它需要遵循的步骤。</p><p id="49ae" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><a class="ae ky" href="https://en.wikipedia.org/wiki/Autoregressive_integrated_moving_average" rel="noopener ugc nofollow" target="_blank"> ARIMA </a>车型的主要特点如下:</p><ul class=""><li id="316a" class="mc md it li b lj lk lm ln lp me lt mf lx mg mb mh mi mj mk bi translated">AR:自回归。这表明时间序列根据其自身的滞后值<a class="ae ky" href="https://en.wikipedia.org/wiki/Linear_regression" rel="noopener ugc nofollow" target="_blank">回归</a>。</li><li id="3ee8" class="mc md it li b lj ml lm mm lp mn lt mo lx mp mb mh mi mj mk bi translated"><strong class="li iu"> I:综合。</strong>这表示数据值已被替换为其值与先前值之间的差值，以便将序列转换为平稳序列。</li><li id="40c2" class="mc md it li b lj ml lm mm lp mn lt mo lx mp mb mh mi mj mk bi translated"><strong class="li iu"> MA:移动平均线。</strong>这表明<a class="ae ky" href="https://en.wikipedia.org/wiki/Errors_and_residuals_in_statistics" rel="noopener ugc nofollow" target="_blank">回归误差</a>实际上是误差项的<a class="ae ky" href="https://en.wikipedia.org/wiki/Linear_combination" rel="noopener ugc nofollow" target="_blank">线性组合</a>，其值在过去的不同时间同时出现。</li></ul><p id="2cd0" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">当我们有季节性或非季节性数据时，可以应用ARIMA模型。不同之处在于，当我们有季节性数据时，我们需要向模型中添加更多的参数。</p><p id="0d65" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">对于非季节性数据，参数为:</p><ul class=""><li id="9045" class="mc md it li b lj lk lm ln lp me lt mf lx mg mb mh mi mj mk bi translated"><strong class="li iu"> p </strong>:模型将使用的滞后观测的数量</li><li id="5dc4" class="mc md it li b lj ml lm mm lp mn lt mo lx mp mb mh mi mj mk bi translated"><strong class="li iu"> d </strong>:原始观测值被差分直到平稳的次数。</li><li id="f990" class="mc md it li b lj ml lm mm lp mn lt mo lx mp mb mh mi mj mk bi translated"><strong class="li iu"> q </strong>:移动平均线窗口的大小。</li></ul><p id="65b6" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">对于季节性数据，我们还需要添加以下内容:</p><ul class=""><li id="dae5" class="mc md it li b lj lk lm ln lp me lt mf lx mg mb mh mi mj mk bi translated">P:模型将使用的季节性滞后观测的数量</li><li id="087a" class="mc md it li b lj ml lm mm lp mn lt mo lx mp mb mh mi mj mk bi translated"><strong class="li iu"> D </strong>:季节观测值差分到平稳的次数。</li><li id="9af0" class="mc md it li b lj ml lm mm lp mn lt mo lx mp mb mh mi mj mk bi translated"><strong class="li iu"> Q </strong>:季节移动平均线窗口的大小。</li><li id="aeda" class="mc md it li b lj ml lm mm lp mn lt mo lx mp mb mh mi mj mk bi translated"><strong class="li iu">m</strong>:1个季节的观测次数</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/89925dd6e47ff18459f57466e371cfe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*n4jk1_EOwwJ2qEQ0.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="cd29" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">季节性或非季节性数据</h1><p id="2a48" class="pw-post-body-paragraph lg lh it li b lj nj ju ll lm nk jx lo lp nl lr ls lt nm lv lw lx nn lz ma mb im bi translated">这个很好理解。季节性数据是指有时间间隔的数据，如每周、每月或每季度。例如，在本教程中，我们将使用按月聚集的数据，我们的“季节”是一年。因此，我们有季节性数据，对于ARIMA模型中的<strong class="li iu"> m参数</strong>，我们将使用<strong class="li iu"> 12 </strong>，即每年的月数。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="3a68" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">平稳性</h1><p id="cd3d" class="pw-post-body-paragraph lg lh it li b lj nj ju ll lm nk jx lo lp nl lr ls lt nm lv lw lx nn lz ma mb im bi translated">ARIMA模型只能应用于平稳数据。这意味着我们不想有一个时间趋势。如果时间序列有趋势，那么它是非平稳的，我们需要应用差分将其转换为平稳的。下面是一个平稳和非平稳序列的例子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/19e316ee857d52289f13e6765e2ed53b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xMFrCyXuDwpGisXv.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="acf9" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们还可以使用<strong class="li iu">扩展的Dickey-Fuller </strong>测试来帮助我们判断序列是否平稳。检验的零假设是有一个单位根，或者没有单位根。换句话说，如果p值低于0.05(或您将使用的任何临界尺寸)，我们的系列是<strong class="li iu">固定的</strong>。</p><p id="aaae" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">开始编码吧。</p><p id="023b" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">对于本教程，我们将使用来自Kaggle 的<a class="ae ky" href="https://www.kaggle.com/rakannimer/air-passengers" rel="noopener ugc nofollow" target="_blank">航空乘客数据。</a></p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="6f33" class="nt ms it np b gy nu nv l nw nx">import pandas as pd<br/>import numpy as np<br/>from statsmodels.tsa.seasonal import seasonal_decompose<br/> <br/>#<a class="ae ky" href="https://www.kaggle.com/rakannimer/air-passengers" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/rakannimer/air-passengers</a><br/>df=pd.read_csv(‘AirPassengers.csv’)<br/> <br/>#We need to set the Month column as index and convert it into datetime<br/>df.set_index(‘Month’,inplace=True)<br/>df.index=pd.to_datetime(df.index)</span><span id="d618" class="nt ms it np b gy ny nv l nw nx">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/8652ad75742e08ea240fc20eff811afe.png" data-original-src="https://miro.medium.com/v2/resize:fit:378/format:webp/0*NAvS-jidU1vbo5Ht.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="d0bc" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">首先，让我们绘制数据。</p><p id="bef5" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe oa ob oc np b">df.plot()</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/89c9f68dcea8dd2c1fc9654b5962092b.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/0*t_GG-5-JdKwl-bq_.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="25cb" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">正如你可以清楚地看到，有一个时间趋势，这表明数据不是静止的。然而，只是为了确保我们将使用一个扩大的迪基-富勒测试。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="51b9" class="nt ms it np b gy nu nv l nw nx">from statsmodels.tsa.stattools import adfuller</span><span id="ad1f" class="nt ms it np b gy ny nv l nw nx">result=adfuller(df['#Passengers'])</span><span id="77ea" class="nt ms it np b gy ny nv l nw nx">#to help you, we added the names of every value<br/>dict(zip(['adf', 'pvalue', 'usedlag', 'nobs', 'critical' 'values', 'icbest'],result))</span><span id="9b95" class="nt ms it np b gy ny nv l nw nx">{'adf': 0.8153688792060468,<br/> 'pvalue': 0.991880243437641,<br/> 'usedlag': 13,<br/> 'nobs': 130,<br/> 'criticalvalues': {'1%': -3.4816817173418295,<br/>  '5%': -2.8840418343195267,<br/>  '10%': -2.578770059171598},<br/> 'icbest': 996.692930839019}</span></pre><p id="e5dc" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">正如所料，我们未能拒绝零假设，该系列有一个单位根，因此不是平稳的。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="82ea" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">使用差分将非平稳转换为平稳(D和D参数)</h1><p id="3c13" class="pw-post-body-paragraph lg lh it li b lj nj ju ll lm nk jx lo lp nl lr ls lt nm lv lw lx nn lz ma mb im bi translated">下一步是将我们的数据转换为静态数据，这样我们就可以估计出将在模型中使用的D和D参数。这可以通过使用<strong class="li iu">差分</strong>来完成，并通过从当前观察值中减去先前观察值来完成。</p><blockquote class="oe of og"><p id="f13c" class="lg lh oh li b lj lk ju ll lm ln jx lo oi lq lr ls oj lu lv lw ok ly lz ma mb im bi translated">差异(T) =观察值(T) —观察值(T-1)</p></blockquote><p id="e755" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">然后，我们将使用扩展的Dickey-Fuller测试再次测试它的平稳性，如果它是平稳的，我们将进行下一步。如果没有，我们将再次应用差分，直到我们有一个平稳的序列。使用<strong class="li iu">移位</strong>功能，熊猫可以很容易地进行区分。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="3b0e" class="nt ms it np b gy nu nv l nw nx">df['1difference']<strong class="np iu">=</strong>df['#Passengers']<strong class="np iu">-</strong>df['#Passengers'].shift(1)</span><span id="0583" class="nt ms it np b gy ny nv l nw nx">df['1difference'].plot()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/5f1e1eb2f80afddc1c1f1c09424a07c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/0*ogYcRxeJ25HBykZa.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="fa35" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">似乎我们去除了趋势，序列是平稳的。然而，我们将使用扩展的Dickey-Fuller测试来证明这一点。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="cdcb" class="nt ms it np b gy nu nv l nw nx">#note we are dropping na values because the first value of the first difference is NA</span><span id="c4b2" class="nt ms it np b gy ny nv l nw nx">result=adfuller(df['1difference'].dropna())<br/>dict(zip(['adf', 'pvalue', 'usedlag', 'nobs', 'critical' 'values', 'icbest'],result))<br/></span><span id="6a01" class="nt ms it np b gy ny nv l nw nx">{'adf': -2.8292668241699857,<br/> 'pvalue': 0.05421329028382734,<br/> 'usedlag': 12,<br/> 'nobs': 130,<br/> 'criticalvalues': {'1%': -3.4816817173418295,<br/>  '5%': -2.8840418343195267,<br/>  '10%': -2.578770059171598},<br/> 'icbest': 988.5069317854084}</span></pre><p id="3cf1" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">如你所见，我们没有拒绝零假设，因为我们的p值大于0.05。这表明序列不是稳定的，我们需要再次使用差分法，取第二个差。第二个差可以作为第一个差来计算，但是这次我们将使用第一个差，而不是使用观察值。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="3ed3" class="nt ms it np b gy nu nv l nw nx">df['2difference']<strong class="np iu">=</strong>df['1difference']<strong class="np iu">-</strong>df['1difference'].shift(1)</span><span id="c93e" class="nt ms it np b gy ny nv l nw nx">df['2difference'].plot()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/566c07cc4e8d51d6f3c5f97adb3ac391.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/0*Szjrec2vVDayTr-C.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="dfee" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">让我们从第二个差异的扩展Dickey-Fuller测试中得到结果。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="888e" class="nt ms it np b gy nu nv l nw nx">result<strong class="np iu">=</strong>adfuller((df['2difference']).dropna())</span><span id="0b01" class="nt ms it np b gy ny nv l nw nx">dict(zip(['adf', 'pvalue', 'usedlag', 'nobs', 'critical'<!-- --> <!-- -->'values', 'icbest'],result))</span><span id="3e6b" class="nt ms it np b gy ny nv l nw nx">{'adf': -16.384231542468452,<br/> 'pvalue': 2.732891850014516e-29,<br/> 'usedlag': 11,<br/> 'nobs': 130,<br/> 'criticalvalues': {'1%': -3.4816817173418295,<br/>  '5%': -2.8840418343195267,<br/>  '10%': -2.578770059171598},<br/> 'icbest': 988.602041727561}</span></pre><p id="ef86" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">p值小于0.05，因此我们可以拒绝零假设。这意味着第二个差异是固定的，这表明对值d的一个好的估计是2 。</p><p id="950c" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们的数据是季节性的，所以我们还需要估计<strong class="li iu"> D值</strong>，它与D值相同，但存在季节性差异。季节性差异可以通过将数据移动每季的行数(在我们的示例中是每年12个月)并从上一季中减去它们来计算。这是<strong class="li iu">而不是</strong>第一个季节差异。如果我们得到季节差异是稳定的，那么D值将为0。如果不是，那么我们将计算<strong class="li iu">季节第一差异</strong>。</p><blockquote class="oe of og"><p id="cd8d" class="lg lh oh li b lj lk ju ll lm ln jx lo oi lq lr ls oj lu lv lw ok ly lz ma mb im bi translated">季节差异(T) =观测值(T) —观测值(T-12)</p><p id="985f" class="lg lh oh li b lj lk ju ll lm ln jx lo oi lq lr ls oj lu lv lw ok ly lz ma mb im bi translated">季节首差(T) =季节差(T) —季节差(T-1)</p></blockquote><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="9558" class="nt ms it np b gy nu nv l nw nx">df['Seasonal_Difference']<strong class="np iu">=</strong>df['#Passengers']<strong class="np iu">-</strong>df['#Passengers'].shift(12)</span><span id="8308" class="nt ms it np b gy ny nv l nw nx">ax<strong class="np iu">=</strong>df['Seasonal_Difference'].plot()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/eeb39075b1856b140846ce9d7fcbae90.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/0*El4MZMVXCIBJJ06o.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="0009" class="nt ms it np b gy nu nv l nw nx">result<strong class="np iu">=</strong>adfuller((df['Seasonal_Difference']).dropna())</span><span id="3ecd" class="nt ms it np b gy ny nv l nw nx">dict(zip(['adf', 'pvalue', 'usedlag', 'nobs', 'critical'<!-- --> <!-- -->'values', 'icbest'],result))</span><span id="91a7" class="nt ms it np b gy ny nv l nw nx">{'adf': -3.383020726492481,<br/> 'pvalue': 0.011551493085514952,<br/> 'usedlag': 1,<br/> 'nobs': 130,<br/> 'criticalvalues': {'1%': -3.4816817173418295,<br/>  '5%': -2.8840418343195267,<br/>  '10%': -2.578770059171598},<br/> 'icbest': 919.527129208137}</span></pre><p id="6857" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li iu"> p值小于0.05 </strong>，因此它是固定的，我们不必使用差分。这表明使用<strong class="li iu"> 0作为</strong>和<strong class="li iu">的D值</strong>。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="f1aa" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">自相关和偏自相关图(P，Q和P，Q参数)</h1><p id="c4c3" class="pw-post-body-paragraph lg lh it li b lj nj ju ll lm nk jx lo lp nl lr ls lt nm lv lw lx nn lz ma mb im bi translated">ARIMA模型之前的最后一步是创建自相关和偏自相关图，以帮助我们估计P、Q、P和Q参数。</p><p id="5dae" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">ARIMA 和<a class="ae ky" href="https://people.duke.edu/~rnau/seasarim.htm" rel="noopener ugc nofollow" target="_blank">季节性ARIMA </a>模型有一些非常有用的<a class="ae ky" href="https://people.duke.edu/~rnau/arimrule.htm" rel="noopener ugc nofollow" target="_blank">规则，我们通过查看自相关和偏自相关图来帮助我们估计参数。我们将为我们的时间序列的<strong class="li iu">秒差</strong>和<strong class="li iu">季节差</strong>创建图表，因为这些是我们最终在ARIMA使用的平稳序列(d=2，D=0)。</a></p><p id="a1ee" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">首先，让我们画出ACF和PACF的第二个区别。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="5f54" class="nt ms it np b gy nu nv l nw nx"><strong class="np iu">from</strong> <!-- -->statsmodels.graphics.tsaplots <strong class="np iu">import</strong> <!-- -->plot_acf, plot_pacf</span><span id="1f5c" class="nt ms it np b gy ny nv l nw nx">fig1<strong class="np iu">=</strong>plot_acf(df['2difference'].dropna())</span><span id="ac60" class="nt ms it np b gy ny nv l nw nx">fig2<strong class="np iu">=</strong>plot_pacf(df['2difference'].dropna())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/880ad3e6451f899a5e6dad39c2ffaf93.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/0*gWm53eEUC26qV2fo.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/557c3ec7a50919bbc53cd54d96c35b26.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/0*2nRZqH0jiReXLz3t.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="82de" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们可以看到，在我们的两个图中，滞后-1处都有一个明显的截止点。根据我们上面提到的规则，这建议使用AR和MA术语。换句话说，p=1，q=1。</p><p id="1265" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在，我们需要同样的季节差异图。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="2956" class="nt ms it np b gy nu nv l nw nx">fig1=plot_acf(df['2difference'].dropna())</span><span id="1d57" class="nt ms it np b gy ny nv l nw nx">fig2=plot_pacf(df['2difference'].dropna())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/1eead70bc47c493a030789dcb9cb24e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/0*YvVE8VowLVD9xyQF.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/f6db8e9ff9d06fe7b2826c26206dfbad.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/0*q4hOZDVlwxKEWNxJ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6fba" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们在自相关图中有一个逐渐减小的曲线，在部分自相关图中有一个急剧的截止。这表明对于ARIMA的季节部分，使用AR并且不超过值1。</p><p id="8a1f" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们选择的值可能不是最佳的。您可以使用这些参数来微调模型，以上面提到的规则作为指导。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="d522" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">ARIMA模式</h1><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="def6" class="nt ms it np b gy nu nv l nw nx"><strong class="np iu">from</strong> <!-- -->statsmodels.tsa.statespace.sarimax <strong class="np iu">import</strong> <!-- -->SARIMAX</span><span id="24fd" class="nt ms it np b gy ny nv l nw nx">model<strong class="np iu">=</strong>SARIMAX(df['#Passengers'],order<strong class="np iu">=</strong>(1,2,1),seasonal_order<strong class="np iu">=</strong>(1, 0, 0, 12))</span><span id="ec15" class="nt ms it np b gy ny nv l nw nx">result<strong class="np iu">=</strong>model.fit()</span></pre><p id="0368" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们可以画出模型的残差，从而了解模型的拟合程度。基本上，残差是原始值和模型预测值之间的差值。</p><p id="97d4" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe oa ob oc np b">result.resid.plot(kind='kde')</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/9b607c6d08c5e582d1542146432b8d7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/0*rejoSJTTe5oWNdOu.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6fec" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">是时候做个预测了。我们将创建一些未来的日期添加到我们的数据中，这样我们就可以预测未来的值。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="f063" class="nt ms it np b gy nu nv l nw nx"><strong class="np iu">from</strong> <!-- -->pandas.tseries.offsets <strong class="np iu">import</strong> <!-- -->DateOffset</span><span id="9e12" class="nt ms it np b gy ny nv l nw nx">new_dates<strong class="np iu">=</strong>[df.index[<strong class="np iu">-</strong>1]<strong class="np iu">+</strong>DateOffset(months<strong class="np iu">=</strong>x) <strong class="np iu">for</strong> <!-- -->x <strong class="np iu">in</strong> <!-- -->range(1,48)]</span><span id="ce2a" class="nt ms it np b gy ny nv l nw nx">df_pred<strong class="np iu">=</strong>pd.DataFrame(index<strong class="np iu">=</strong>new_dates,columns <strong class="np iu">=</strong>df.columns)</span><span id="aaad" class="nt ms it np b gy ny nv l nw nx">df_pred.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/decf2ee34ab2665cac8816d026ba82ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/0*fL8ZoKdx5gGTLm-V.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="42c9" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">ARIMA模型预测将枚举索引的开始和结束作为参数，而不是日期范围。<br/>我们创建了一个包含未来日期索引的空数据框，并将它们连接到原始数据中。我们的数据有144行，我们添加的新数据有48行。因此，为了只获得对未来数据的预测，我们将从第143行预测到第191行。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="4d41" class="nt ms it np b gy nu nv l nw nx">df2<strong class="np iu">=</strong>pd.concat([df,df_pred])</span><span id="3011" class="nt ms it np b gy ny nv l nw nx">df2['predictions']<strong class="np iu">=</strong>result.predict(start<strong class="np iu">=</strong>143,end<strong class="np iu">=</strong>191)</span><span id="4cbf" class="nt ms it np b gy ny nv l nw nx">df2[['#Passengers','predictions']].plot()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/49bb9fc9d70947da866ba0129d2fdc59.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/0*F4MtlJ1SY60kgm12.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="8f7d" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">总结一下</h1><p id="da0b" class="pw-post-body-paragraph lg lh it li b lj nj ju ll lm nk jx lo lp nl lr ls lt nm lv lw lx nn lz ma mb im bi translated">Arima是一个很好的预测模型，可用于季节性和非季节性时间序列数据。<br/>对于非季节性ARIMA，你必须估计P、D、Q参数，而对于季节性ARIMA，它有3个以上适用于P、D、Q参数的季节性差异。</p><p id="8491" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们用来运行ARIMA模型的管道如下:</p><ul class=""><li id="f8e3" class="mc md it li b lj lk lm ln lp me lt mf lx mg mb mh mi mj mk bi translated">看看你的时间序列，了解它们是季节性的还是非季节性的。</li><li id="a646" class="mc md it li b lj ml lm mm lp mn lt mo lx mp mb mh mi mj mk bi translated">如果需要达到平稳性，将差分应用于时间序列和季节差异，以获得D和D值的估计值。</li><li id="7944" class="mc md it li b lj ml lm mm lp mn lt mo lx mp mb mh mi mj mk bi translated">绘制自相关和偏自相关图有助于估计P、P和Q、Q值。</li><li id="efdc" class="mc md it li b lj ml lm mm lp mn lt mo lx mp mb mh mi mj mk bi translated">微调模型，如果需要改变参数根据ARIMA的一般规则</li></ul><p id="a364" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">有用链接:<br/><a class="ae ky" href="https://people.duke.edu/~rnau/arimrule.htm" rel="noopener ugc nofollow" target="_blank">ARIMA规则</a><br/><a class="ae ky" href="https://predictivehacks.com/arima-r/" rel="noopener ugc nofollow" target="_blank">R中的Arima</a><br/><a class="ae ky" href="https://predictivehacks.com/how-to-backtest-your-crypto-trading-strategies-in-r/" rel="noopener ugc nofollow" target="_blank">如何回测你在R中的加密交易策略</a> <br/> <a class="ae ky" href="https://en.wikipedia.org/wiki/Autoregressive_integrated_moving_average" rel="noopener ugc nofollow" target="_blank">维基百科中的ARIMA</a></p><p id="b580" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><em class="oh">最初发表于</em><a class="ae ky" href="https://predictivehacks.com/arima-model-in-python/" rel="noopener ugc nofollow" target="_blank"><em class="oh">https://predictivehacks.com。</em> </a></p></div></div>    
</body>
</html>