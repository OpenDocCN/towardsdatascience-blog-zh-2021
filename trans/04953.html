<html>
<head>
<title>6 Must-Know Column Operations with PySpark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PySpark的6个必备色谱柱操作</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/6-must-know-column-operations-with-pyspark-d64f5315873e?source=collection_archive---------14-----------------------#2021-04-30">https://towardsdatascience.com/6-must-know-column-operations-with-pyspark-d64f5315873e?source=collection_archive---------14-----------------------#2021-04-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7f77" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">简单如Python，强大如Spark</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a9a080fabdd715466d299e7c7d4626c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*onYKgNkbxS-LOrBj.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Marc-Olivier Jodoin 在<a class="ae ky" href="https://unsplash.com/s/photos/fast?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="42b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Spark是一个用于大规模数据处理的分析引擎。它让您可以将数据和计算分散到集群上，从而实现显著的性能提升。</p><p id="b9e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">PySpark是Spark的Python库。它结合了Python的简单性和Spark的高效性，这种合作得到了数据科学家和工程师的高度赞赏。</p><p id="546e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将介绍6种不同的列操作，它们是数据分析和操作中经常用到的。我们将使用PySpark的SQL模块，它提供了几个处理结构化数据的函数。</p><p id="fd45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从导入库开始。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="0e35" class="ma mb it lw b gy mc md l me mf">from pyspark.sql import SparkSession<br/>from pyspark.sql import functions as F</span></pre><p id="2f31" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要创建一个SparkSession作为Spark SQL的入口点。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="853d" class="ma mb it lw b gy mc md l me mf">spark = SparkSession.builder.getOrCreate()</span></pre><p id="81a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在整篇文章中使用这个spark会话。下一步是创建一个样本数据框来进行示例。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="bf24" class="ma mb it lw b gy mc md l me mf">data = [<br/>    ("John", "Biology", 3.45, "Junior"),<br/>    ("Jane", "Chemistry", 3.60, "Sophomore"),<br/>    ("Ashley", "Biology", 3.25, "Sophomore"),<br/>    ("Max", "Physics", 2.95, "Senior"),<br/>    ("Emily", "Biology", 3.30, "Junior")<br/>]</span><span id="b472" class="ma mb it lw b gy mg md l me mf">columns = ["Name", "Major", "GPA", "Class"]</span><span id="8c69" class="ma mb it lw b gy mg md l me mf">df = spark.createDataFrame(data = data, schema = columns)</span><span id="164d" class="ma mb it lw b gy mg md l me mf">df.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/e6f6a8d7bd9aab5efcbaae72ef67a264.png" data-original-src="https://miro.medium.com/v2/resize:fit:474/format:webp/1*toxKWb2VD7cYySH-o-MPYw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="11c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们根据一个模式编写样本数据。然后数据和模式都被传递给<code class="fe mi mj mk lw b">createDataFrame</code>函数。</p><p id="6ca9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以开始列操作了。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="2d61" class="ma mb it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">1.创建新列</h2><p id="cd93" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated"><code class="fe mi mj mk lw b">withColumn</code>函数用于创建一个新列。我们传递新列的名称以及填充它的数据。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="0ba6" class="ma mb it lw b gy mc md l me mf">df = df.withColumn("School", F.lit("A"))</span><span id="fd09" class="ma mb it lw b gy mg md l me mf">df.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/8f0c0b0bf7579d5e1e5b248e16590a1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:562/format:webp/1*oKWxTZxpi6b61LbQ0JoKEQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="ddf7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mi mj mk lw b">lit</code>函数允许用常量值填充一列。不像熊猫，我们不能只写“A”。</p><p id="011b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要注意的是<code class="fe mi mj mk lw b">withColumn</code>功能不能正常工作。因此，我们需要将更新后的数据框赋给一个新变量(自身或任何其他变量)来保存更改。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="0b5f" class="ma mb it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">2.更新列</h2><p id="9499" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated"><code class="fe mi mj mk lw b">withColumn</code>函数也可以用来更新或修改一列中的值。例如，我们可以将GPA值转换为100分制。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="da92" class="ma mb it lw b gy mc md l me mf">df.withColumn("GPA", F.col("GPA") * 100 / 4).show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/8b32493220921302d803ba83bde13851.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/1*9R2t-w7xc0saTxF4T6i0Sw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="a57c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请记住，我们需要使用<code class="fe mi mj mk lw b">col</code>函数来应用列操作。如果我们只把列名写成字符串，我们会得到一个错误。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="02ea" class="ma mb it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">3.重命名列</h2><p id="cdf8" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated"><code class="fe mi mj mk lw b">withColumnRenamed</code>函数改变列的名称。我们将当前名称和新名称作为参数传递给这个函数。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2742" class="ma mb it lw b gy mc md l me mf">df = df.withColumnRenamed("School", "University")</span><span id="b644" class="ma mb it lw b gy mg md l me mf">df.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/1351a3b0680aaa058ca2298f9a0c5f3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/1*_rxePKJdjQZhfS5baKwzHA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="965a" class="ma mb it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">4.选择一列或多列</h2><p id="13a0" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">在某些情况下，我们可能只需要从数据框中获取特定的一列或几列。select函数允许我们通过传递所需列的名称来完成这项任务。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a483" class="ma mb it lw b gy mc md l me mf">df.select("Name", "Major").show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/6b9da27c34660e6033b980e462ed6de3.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*HLBMu9_nz07PXAvx3tJWww.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="4ed7" class="ma mb it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">5.列中的唯一值</h2><p id="6440" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">如果我们想检查一列中不同值的数量，可以使用<code class="fe mi mj mk lw b">countDistinct</code>函数。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8eb0" class="ma mb it lw b gy mc md l me mf">df.select(F.countDistinct("Major").alias("Unique_count")).show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/6ffc516a3e1fbff4db0986660c4c0782.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*4AHYF8Qhol8zg3nW7oV9kw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="0271" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它非常类似于SQL语法。选择列时应用该函数。我们还可以在一列中显示唯一的值。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="56a5" class="ma mb it lw b gy mc md l me mf">df.select("Major").distinct().show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/2d637becb4ee9e3eea2f3263505fa521.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/format:webp/1*k0peevnJzWUvGA37OI9cYw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="baea" class="ma mb it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">6.删除一列</h2><p id="8fca" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">删除列的语法非常直观。正如您可能猜到的，使用了<code class="fe mi mj mk lw b">drop</code>函数。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="eb89" class="ma mb it lw b gy mc md l me mf">df = df.drop("University")</span><span id="564e" class="ma mb it lw b gy mg md l me mf">df.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/9c7c9e15701526e4645de5266cacd5aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:466/format:webp/1*4N-2yEOyL-fgT_1wW3aqew.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="28c8" class="ma mb it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">结论</h2><p id="1c26" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">我们已经用PySpark介绍了6种常用的列操作。PySpark的SQL模块提供了更多的函数和方法来执行高效的数据分析。</p><p id="7889" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要注意的是，Spark针对大规模数据进行了优化。因此，在处理小规模数据时，您可能看不到任何性能提升。事实上，在处理小数据集时，Pandas可能会比PySpark表现得更好。</p><p id="9704" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>