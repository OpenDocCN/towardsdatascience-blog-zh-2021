<html>
<head>
<title>Transform Invoices Into Tabular Data Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python将发票转换成表格数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/transform-invoices-into-tabular-data-using-python-cd30b31d1a8f?source=collection_archive---------8-----------------------#2021-06-30">https://towardsdatascience.com/transform-invoices-into-tabular-data-using-python-cd30b31d1a8f?source=collection_archive---------8-----------------------#2021-06-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="379b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">PDF水管工和正则表达式使它更容易</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b79f0791a68aee4a4c84b36f2a347cf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DsMMVSAYxpMOFj7uRsq-iQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片(Canva上制作)</p></figure><p id="867e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">99%的文本数据以非结构化形式存在。当我们谈到难以解释和管理的非结构化数据时，发票是非结构化数据的一个例子。</p><p id="3a29" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当我们在分析和数据科学领域工作时，我们通常需要表格形式的数据来分析它们。我的意思是，通过分析，我们可以绘制洞察图、监控、预测未来的洞察、管理未来的需求，等等。</p><p id="8043" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">根据<a class="ae lu" href="https://www.quora.com/How-many-invoices-do-SMEs-generate-per-month-on-average" rel="noopener ugc nofollow" target="_blank"> quora </a>上的信息，一家大型企业一个月可以产生33000张发票，根据<a class="ae lu" href="https://www.bizjournals.com/bizjournals/on-numbers/scott-thomas/2012/07/16055-companies-fit-the-definition-of.html" rel="noopener ugc nofollow" target="_blank">商业杂志</a>的一份报告，有16000多家大公司，这意味着一天内会产生数百万张发票，这是非结构化数据要多得多。</p><p id="910e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">发票的好处是——大多数都遵循相同的模式。也就是说，如果我们能够匹配单一发票的模式，我们就可以处理任何行业的所有发票。</p><p id="532f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">时至今日，一些行业已经采用了自动化发票处理方法，其中大多数仍在手动处理，少数仍在进行相同的自动化流程，以节省时间和资金。</p><p id="0209" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们看看如何使用python编程来自动化这个过程。我们的最终产品将是一个功能，将采取pdf文件的列表作为输入，并生成一个excel表，其中一行将表示一个结构化的发票文件。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ebe1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">必需的库</h1><p id="296b" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">我们将需要一些库来读取pdf文件，并对我们的文本数据应用正则表达式。</p><ul class=""><li id="3119" class="mz na it la b lb lc le lf lh nb ll nc lp nd lt ne nf ng nh bi translated">pdf lumber—读取pdf文件</li><li id="d194" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">re-应用正则表达式</li><li id="af21" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">熊猫——来创建和操作我们的数据集</li></ul><h2 id="b908" class="nn md it bd me no np dn mi nq nr dp mm lh ns nt mo ll nu nv mq lp nw nx ms ny bi translated">导入所需的库</h2><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="711e" class="nn md it oa b gy oe of l og oh">import pdfplumber<br/>import re<br/>import itertools<br/>import pandas as pd</span></pre><h1 id="f985" class="mc md it bd me mf oi mh mi mj oj ml mm jz ok ka mo kc ol kd mq kf om kg ms mt bi translated">示范发票</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/e8e8ca2dfeb765800af8c59e1dada1f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eD6W4oS8EKbCqjD8bTX5tg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">演示发票截图</p></figure><p id="a652" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里，我们有三个部分。最上面的第一部分给出了日期和时间、用户名、程序名和菜单代码的详细信息。<br/> <br/>第二个中间部分告诉我们该发票可用的菜单选项。最后，倒数第三个部分告诉我们每个菜单选项下的授权码。</p><h1 id="ce9b" class="mc md it bd me mf oi mh mi mj oj ml mm jz ok ka mo kc ol kd mq kf om kg ms mt bi translated">方法</h1><p id="094a" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">我们的第一个目标是制作一个能够区分每个部分的python脚本。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="7945" class="nn md it oa b gy oe of l og oh">with <strong class="oa iu">pdfplumber.open("Menu_Authorizations.pdf") as pdf</strong>:<br/>    next_page_continue=False<br/>    for pcount in range(len(pdf.pages)):<br/>        page=pdf.pages[pcount]<br/>        text=page.extract_text()</span></pre><p id="1e68" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面的代码帮助我们打开pdf文件。这里，我们只有一个包含300个菜单的pdf文件。有些菜单需要两页纸，因为它们有更多的菜单选项。我们需要根据正则表达式的结果来处理这种情况。</p><p id="01c7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以使用extract_text()函数从pdf中提取数据。因为我们使用了一个循环，所以一次只能接受一张发票。</p><p id="2e8a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当我们迭代提取的文本时，我们的循环逐行迭代文本。这意味着——我们必须根据循环正在执行的行来定义正则表达式。</p><p id="2f56" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们首先定义每个条件的正则表达式。</p><h2 id="54df" class="nn md it bd me no np dn mi nq nr dp mm lh ns nt mo ll nu nv mq lp nw nx ms ny bi translated">抓取菜单代码</h2><p id="5478" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">菜单编号出现在以“Menu”开头的行中。这里，我们需要一个正则表达式来检测时间。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="124c" class="nn md it oa b gy oe of l og oh">menu_re= re.compile(r'^MENU:')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/0693f9adf13431d733e3f3635b92fd0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W9WoQpBGhLDtyNdSOo0XwQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><p id="fb54" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这一行python代码可以为我们完成这项任务。</p><h2 id="fd2f" class="nn md it bd me no np dn mi nq nr dp mm lh ns nt mo ll nu nv mq lp nw nx ms ny bi translated">抓取所有菜单选项</h2><p id="d270" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">根据菜单格式——就在菜单代码下面，我们可以找到菜单选项列表。这里，我们需要确保我们的行对于菜单选项表有各自的标题。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="1848" class="nn md it oa b gy oe of l og oh">menu_func_re=re.compile(r'^\s*\d+\s{2}[A-Za-z\s\d\W]+$')</span></pre><p id="6dc0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们的行以空格、数字开头，后面跟两个空格，上面的正则表达式可以帮助我们。这样，我们就可以检测到这条线。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/fcbf6fe32cf93956069bd39cbd6b00ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hp9h6xbS9e_VyAJxm3_hAA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><h2 id="c303" class="nn md it bd me no np dn mi nq nr dp mm lh ns nt mo ll nu nv mq lp nw nx ms ny bi translated">抓取每个菜单的授权码</h2><p id="ad74" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">这是我们需要提取的最后一部分。我们需要检查该行是否以数字开头，后跟代码“APM”。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="6ce9" class="nn md it oa b gy oe of l og oh">APM_re=re.compile(r'\s*\d+\s+APM')<br/>APM_re_internal=re.compile(r"^AUTHORIZED:")</span></pre><p id="7947" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以上两行可以为我们完成任务。</p><h1 id="764e" class="mc md it bd me mf oi mh mi mj oj ml mm jz ok ka mo kc ol kd mq kf om kg ms mt bi translated">将这些点连接起来</h1><p id="ff53" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">一旦正则表达式部分完成，我们就可以用必要的条件连接所有的代码部分。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><h1 id="b18b" class="mc md it bd me mf oi mh mi mj oj ml mm jz ok ka mo kc ol kd mq kf om kg ms mt bi translated">最终输出</h1><p id="0406" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">通过运行代码，我们可以获得表示文档及其相关信息的列表列表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/b9cfaf6fe4eb923b9a9fe98459965b92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fgQp5rns6IGItHhVpp-HzA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">最终结果—导出前</p></figure><p id="1cda" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，我们可以使用pandas将列表转换为数据框，然后将该数据框导出到excel表中。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="326d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="9c83" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">这篇内容丰富的文章就到这里。我们已经介绍了将PDF发票转换成excel表格的一步一步的方法。这一次，我们还讨论了这个用例的重要性。</p><p id="194e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望你喜欢这篇文章。敬请关注即将到来的文章。</p><p id="1f23" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">谢谢你的阅读！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="8166" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是我的一些最佳选择:</p><div class="ot ou gp gr ov ow"><a rel="noopener follow" target="_blank" href="/step-by-step-yolo-model-deployment-in-localhost-using-python-8537e93a1784"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd iu gy z fp pb fr fs pc fu fw is bi translated">逐步使用Flask &amp; Python部署自定义对象检测</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">自定义对象检测本地主机部署| YOLO</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">towardsdatascience.com</p></div></div><div class="pf l"><div class="pg l ph pi pj pf pk ks ow"/></div></div></a></div><div class="ot ou gp gr ov ow"><a rel="noopener follow" target="_blank" href="/7-amazing-python-one-liners-you-must-know-413ae021470f"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd iu gy z fp pb fr fs pc fu fw is bi translated">你必须知道的7个惊人的Python一行程序</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">加速熊猫，快速数据剖析，数据抓取，等等</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">towardsdatascience.com</p></div></div><div class="pf l"><div class="pl l ph pi pj pf pk ks ow"/></div></div></a></div><div class="ot ou gp gr ov ow"><a href="https://betterprogramming.pub/10-python-tricks-that-will-wow-you-de450921d96a" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd iu gy z fp pb fr fs pc fu fw is bi translated">让你惊叹的10个Python技巧</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">提高Python编程技能的便利特性</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">better编程. pub</p></div></div><div class="pf l"><div class="pm l ph pi pj pf pk ks ow"/></div></div></a></div><div class="ot ou gp gr ov ow"><a rel="noopener follow" target="_blank" href="/5-data-science-projects-that-you-can-complete-over-the-weekend-34445b14707d"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd iu gy z fp pb fr fs pc fu fw is bi translated">你可以在周末完成的5个数据科学项目</h2><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">towardsdatascience.com</p></div></div><div class="pf l"><div class="pn l ph pi pj pf pk ks ow"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><blockquote class="po pp pq"><p id="4480" class="ky kz pr la b lb lc ju ld le lf jx lg ps li lj lk pt lm ln lo pu lq lr ls lt im bi translated"><em class="it">在你走之前……</em></p></blockquote><p id="8394" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你喜欢这篇文章，并希望<strong class="la iu">继续关注</strong>更多关于<strong class="la iu"> Python &amp;数据科学</strong>的<strong class="la iu">精彩文章</strong>——请点击这里<a class="ae lu" href="https://pranjalai.medium.com/membership" rel="noopener">https://pranjalai.medium.com/membership</a>考虑成为一名中级会员。</p><p id="3d59" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请考虑使用<a class="ae lu" href="https://pranjalai.medium.com/membership" rel="noopener">我的推荐链接</a>注册。通过这种方式，会员费的一部分归我，这激励我写更多关于Python和数据科学的令人兴奋的东西。</p><p id="8061" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">还有，可以随时订阅我的免费简讯:<a class="ae lu" href="https://pranjalai.medium.com/subscribe" rel="noopener"> <strong class="la iu"> Pranjal的简讯</strong> </a>。</p></div></div>    
</body>
</html>