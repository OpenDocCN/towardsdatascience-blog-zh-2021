<html>
<head>
<title>PyTorch TabNet: integration with MLflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PyTorch TabNet:与MLflow集成</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pytorch-tabnet-integration-with-mlflow-cb14f3920cb0?source=collection_archive---------21-----------------------#2021-04-16">https://towardsdatascience.com/pytorch-tabnet-integration-with-mlflow-cb14f3920cb0?source=collection_archive---------21-----------------------#2021-04-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b600" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> TabNet </strong>是一个用于表格数据的现代神经网络架构。在本文中，我想让大家关注一个很好的开源实现，它基于PyTorch，以及我如何将它与<strong class="jp ir"> MLflow </strong>集成在一起。</p><h1 id="6de3" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">深度学习和表格数据。</h1><p id="0e74" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated"><strong class="jp ir"> TabNet </strong>是一种神经网络架构，专门设计用于充分管理我们以<strong class="jp ir">表格</strong>格式处理数据的所有情况。</p><p id="75e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">想想看，对于许多公司(如银行和政府机构)来说，绝大多数数据都属于这一类。当然，所有由事务性应用程序“生产”并浓缩到“数据仓库”中的数据都是这种类型的。</p><p id="6251" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在最近十年中，深度学习在非结构化数据上显示出了非凡的结果，例如在图像识别和对象检测(图像)领域，在自然语言处理(文本)领域，在“语音到文本”领域，经常被证明能够达到并克服“人类级别的性能”。</p><p id="9024" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但到目前为止，普遍的想法是，对于表格数据，使用不基于神经网络的算法，如<strong class="jp ir">梯度推进</strong>算法，通常更容易、更快地获得结果。事实上，在Kaggle上分析这些类型的数据就足够了:使用实现可以获得最好的结果，这些实现也可以在GPU上快速运行，如XGBoost，LightGBM，CatBoost。</p><p id="8ead" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">TabNet是一种专用于表格形式的结构化数据的神经网络架构。它于2020年底推出，其最佳描述可以在常见的<strong class="jp ir">ArXiv</strong>:<a class="ae lo" href="https://arxiv.org/pdf/1908.07442.pdf" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/pdf/1908.07442.pdf</a>上的文章中找到</p><h1 id="d619" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">TabNet上的一些信息。</h1><p id="a949" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">介绍用Python开发神经网络的书籍中充满了处理表格数据的例子。原因是样本数据集通常很小，最大为几百MB，因此网络训练不需要很大的计算能力。当您继续处理图像时，维度会变成(甚至数百)GB的量级，很快就解释了使用GPU的必要性。</p><p id="e83b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面提到的那种例子中，网络架构几乎总是一个<strong class="jp ir">全连接</strong>网络。每一层由一定数量的神经元组成，与前一层的所有神经元相连。</p><p id="a5d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为这样的网络编写代码很容易，但是这些网络不能很好地处理结构化(表格)数据有几个原因。</p><p id="8e7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个例子:通常这种类型的数据包含相关的特征，特别是当我们有很多的时候。网络总是可以将一些权重置零，但是这个问题会导致过度拟合的问题。</p><p id="2a96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">描述TabNet的内部结构并不容易，那些想了解其内部结构的人最好读一下我链接的文章。</p><p id="0e9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最有趣的设计元素之一是TabNet(具有编码器-解码器架构)提供了一系列模块(在编码器部分)，数量与超参数N_STEP相等，每个模块都有一个<strong class="jp ir">顺序注意机制</strong>，用于选择(或至少尝试)哪些功能最重要。</p><p id="8475" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">与注意力机制直接相关的另一个因素是，TabNet一旦被训练，就可以很容易地为“<strong class="jp ir">可解释性</strong>”提供有用的信息。特别是，获得相对的特性重要性或多或少需要一行代码。在下图中，我展示了一个结果的例子。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/880033435bc744468d16bde1d12c37d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GFojKbGjQ2mhnK38vwW9gQ.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">相对特征重要性(图片由作者提供)。</p></figure><p id="78bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，TabNet管理并使用<strong class="jp ir">嵌入</strong>来处理高维分类特征。并且既可以用于<strong class="jp ir">分类问题</strong>也可以用于<strong class="jp ir">回归</strong>问题。</p><p id="6693" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对这种架构的关注与日俱增。一个迹象是Kaggle上越来越多的人开始尝试使用TabNet。</p><h1 id="31cb" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">如何使用TabNet？</h1><p id="c062" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">与关于ArXiv的文章一起提供的代码实际上并不能用于具体的应用程序。</p><p id="8a79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是一家名为<a class="ae lo" href="https://www.dreamquark.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> DreamQuark </strong> </a>的公司的一个团队已经开发出了一个开源实现，这个实现叫做<a class="ae lo" href="https://github.com/dreamquark-ai/tabnet" rel="noopener ugc nofollow" target="_blank"> pythorch-tabnet </a></p><p id="d295" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个实现也可以从通常的pypi (pip install pytorch-tabnet)上下载，从pypi的统计数据中可以看出，它非常有趣(每月有9500次下载)。</p><p id="9429" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个疑问可能会出现(它出现在我面前，因为我更喜欢使用TensorFlow，很少使用PyTorch):但是要使用它，我必须使用并了解PyTorch吗？</p><p id="5ded" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不。PyTorch TabNet的开发者已经提供了一个兼容的scikit-learn接口。只需实例化<strong class="jp ir"> TabNetClassifier </strong>类或<strong class="jp ir"> TabNetRegressor </strong>类，传递正确的参数，并在无需远程了解PyTorch的情况下使用。</p><p id="b120" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">非常详细的例子包含在GitHub库中。最好从这些开始。</p><p id="4ed2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">PyTorch-TabNet在幕后悄悄地使用GPU 。在我的Oracle云环境中，我所要做的就是启动笔记本电脑。从日志中可以看出他在用CUDA，显然训练速度更快。</p><p id="e707" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，在本文中，我想关注另一个方面:我想说明我已经实现的将TabNet与我最喜欢的工具<strong class="jp ir"> MFlow </strong>集成的解决方案。</p><h1 id="0628" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">MLflow集成。</h1><p id="8fd6" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated"><strong class="jp ir"> MLflow </strong>是Databricks开展的一个开源工具和项目。</p><p id="c8ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">GitHub库位于URL:<a class="ae lo" href="https://github.com/mlflow/mlflow" rel="noopener ugc nofollow" target="_blank">https://github.com/mlflow/mlflow</a></p><p id="9af2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">设计师给的定义是:“一个管理机器学习模型生命周期的平台”。它可以做很多事情，甚至可以在你的MacBook上使用。</p><p id="58bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的例子中，我用它来跟踪和<strong class="jp ir">追踪</strong>在<strong class="jp ir">超参数优化阶段</strong>完成的所有“实验”的进度，通常与<strong class="jp ir"> Optuna </strong>结合使用。</p><p id="1a74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">特别是如果您有大量数据，超参数的优化阶段可能需要大量测试和时间，并且以有组织和结构化的方式跟踪所有结果<strong class="jp ir">是很重要的，以便能够重建哪些变化有效，哪些变化无效。</strong></p><p id="2d5f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">MLflow可以很容易地安装在Ubuntu VM上(需要半个小时),并在REST端点上公开一个跟踪API。</p><p id="8dfe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我所做的是:</p><p id="a13d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Ubuntu虚拟机上安装跟踪服务器，使用一个漂亮的MySQL数据库作为存储库</p><p id="0b6b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的笔记本上使用<strong class="jp ir"> MLflow Python API </strong></p><p id="2bd2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">特别是当培训持续很长时间(几个小时)时，在MLflow提供的指标图上实时跟踪进度会更加舒适和有趣。</p><p id="59cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是让我们来看看与TabNet的集成。</p><p id="ff95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">TabNet允许您在TabNetClassifier和TabNetRegressor类的参数中指定在训练周期中“插入”的<strong class="jp ir">回调</strong>。</p><p id="086d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于了解TensorFlow的人来说，这些回调遵循相同的模式:它们必须是定义方法的类:</p><p id="b225" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> on_train_begin </strong></p><p id="1a6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> on_train_end </strong></p><p id="4ec9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> on_epoch_end </strong></p><p id="a631" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，它们扩展了<strong class="jp ir">py torch _ tabnet . callbacks . callback</strong>类。</p><p id="7e53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">总的来说，我的解决方案</strong>使用了MLFlow跟踪API和:</p><p id="6997" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以<strong class="jp ir"> on_train_begin </strong>方法开始实验和运行</p><p id="6628" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在相同的方法中，它将包含我正在试验的参数的字典发送到MLFlow，以跟踪它们并将所使用的值与获得的性能相关联</p><p id="87e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<strong class="jp ir"> on_epoch_end </strong>中的MLFlow API更新指标(例如:准确度、AUC)</p><p id="cf14" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir"> on_train_end方法</strong>中标记运行的结束</p><p id="bb95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是回调的完整代码:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="2114" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用PyTorch TabNet的完整代码是:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="6234" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了满足你合理的好奇心，这是我在一个<strong class="jp ir">信用评分</strong>模型上运行的图表:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mh"><img src="../Images/b536734d03f53c6c3dfef16825516c59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MPMMgk5giF_VSNN9YmP4Yg.png"/></div></div><p class="mb mc gj gh gi md me bd b be z dk translated">MLflow，训练的进度(图片由作者提供)。</p></figure><h1 id="1a7f" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">一些安全措施。</h1><p id="6e3e" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">对于那些真正希望在自己的云环境中实施这种类型的解决方案的人来说，有一个重要的细节。</p><p id="f340" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您在Linux机器上安装MLflow，您将暴露一个端点，而没有任何形式的安全性。因此，建议使用代理，如NGINX，在代理上实现安全性，并公开NGINX端点，而不是直接公开MLflow。</p><p id="d05c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但我同意，这不太像是数据科学家的工作。您可以从在Web应用程序和安全性方面更有经验的同事那里获得帮助。</p><p id="9063" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的示例代码中，我没有展示如何传递凭证，但它是有文档记录的。</p><h1 id="3591" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">总之…</h1><p id="d588" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我真的认为，我们将看到越来越多有趣的新想法的一个领域是神经网络在表格数据中的应用。</p><p id="131c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">TabNet是一个有趣的解决方案，有一个很好的开源实现，基于PyTorch。</p><p id="0e16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">(好的)开源的好处是很容易找到文档并将其集成到整个管道中。</p><p id="e8cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我试图展示与MLflow集成是多么容易。希望你会感兴趣。</p></div></div>    
</body>
</html>