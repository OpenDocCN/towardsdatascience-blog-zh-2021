<html>
<head>
<title>Data Engineering: Create your own Dataset</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据工程:创建自己的数据集</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-engineering-create-your-own-dataset-9c4d267eb838?source=collection_archive---------10-----------------------#2021-11-10">https://towardsdatascience.com/data-engineering-create-your-own-dataset-9c4d267eb838?source=collection_archive---------10-----------------------#2021-11-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c83c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用 Python 和提取转换加载管道创建自己的数据集</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/666e4b3ac48a87e68176f2feaad33d94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JiNYMRCn1_8nJpc9"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">伊恩·巴塔格利亚在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="4251" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="6940" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">你是一名机器学习工程师还是一名数据科学家，你想在数据集上应用机器学习(ML)，而数据集目前并不存在？或者你是一名数据工程师，你的工作是创建一个数据集，以便机器学习工程师和数据科学家可以将这个数据集转化为你公司的商业价值？在这两种情况下，您应该熟悉提取-转换-加载(ETL)管道。</p><p id="1eb7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">ETL 是一个允许您从各种来源提取数据，根据您的要求转换数据，并最终将其加载到您选择的数据库或数据格式中的过程。</p><p id="d81a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在本文中，我将向您展示一个 ETL 管道的例子。我想创建一个小型数据集，其中包含所有国家的幸福数据、关于人口数量和国内生产总值的数据，以及每个国家的平均年龄。</p><p id="9848" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">作为编程语言，我使用 Python。我从维基百科搜集幸福值，从 Rapid API 搜集每个国家的人口数据，从另一个网站搜集平均年龄。然后，我将这些数据集组合在一起，并对数据集中存储的数据类型和数值应用一些转换。最后，我将数据集加载到一个 CSV 文件中，这样它就可以被机器学习工程师加载。</p><p id="53e1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">你可以在我的 Github 库<a class="ae ky" href="https://github.com/patrickbrus/Medium_Notebooks/tree/master/Build_ETL_Pipeline" rel="noopener ugc nofollow" target="_blank">这里</a>找到完整的 Jupyter 笔记本。我使用 Python 中的 BeautifulSoup 包和 request 包从不同的网站和 API 中抓取数据。</p><h1 id="a9e7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">提取</h1><p id="aec7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在让我们从管道的第一部分开始，从不同的来源提取数据。作为第一步，我从维基百科收集快乐数据。代码 1 显示了从 Wikipedia 链接中提取完整的 html 数据，然后使用 BeautifulSoup 从提取的 html 数据中获取幸福表的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码 1: Python 代码，用于从维基百科抓取快乐数据，并将其存储在熊猫数据框中。</p></figure><p id="7cbe" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在第 8 行，请求包用于从提供的 Wikipedia 链接中获取 html 数据。在第 14 行，创建了 BeautifulSoup 对象，并将原始 html 数据作为输入传递。在第 17 行中,“find_all”函数用于获取所有带有 html 类“wikitable”的表。Gif 1 展示了如何检查一个网站的元素，以获得您感兴趣的表的类别。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/68f116e2e0d988eadb8f93b9f18beefa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*D4OsDYqYH_V6mzJzT0im1g.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Gif 1:这个例子展示了如何检查一个 html 对象来获取 html 类。可以通过右键单击对象，然后选择“检查元素”选项来检查 Html 对象。</p></figure><p id="ead1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Code1 的剩余部分将 html 表转换成 Pandas 数据框。</p><p id="7ea8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">图 1 显示了这个数据框的头部，它包含了 153 个国家的幸福数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/999ac9ff31aa8bf2dbfeea2f5f790ae7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h8cEEf8nYTfwv0Szi-ThCA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 1:世界幸福数据框头部。</p></figure><p id="4002" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下一步，使用 Rapid API 中的<a class="ae ky" href="https://rapidapi.com/aldair.sr99/api/world-population/" rel="noopener ugc nofollow" target="_blank"> this </a> API 获取每个国家的人口数据。Rapid API 还提供了一些关于如何从该 API 获取数据的示例 Python 代码。代码 2 显示了从这个 API 获取数据并将其附加到幸福数据帧的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码 2:通过从 Rapid API 提取数据来获取幸福数据集中每个国家的人口数据的代码。tqdm 包用于在执行 for 循环时获取进度条。</p></figure><p id="77bb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">不幸的是，五个国家的人口数字不见了。这些现在可以从互联网上的其他来源加载，但这不是在这个小项目的上下文中完成的。</p><p id="6a50" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下一步，通过抓取世界数据网站来加载每个国家的平均年龄，可以在这里找到<a class="ae ky" href="https://www.worlddata.info/average-age.php" rel="noopener ugc nofollow" target="_blank"/>。再次检查感兴趣的表，以便获得正确的 html 类。代码 3 显示了获取数据并将其存储在数据帧中的完整代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码 3:用于从 worlddata 网站提取每个国家的平均年龄数据并将其存储在 Pandas 数据框中的代码。</p></figure><p id="2095" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这个数据集只包含 116 个不同国家的数据，而幸福数据集包含 153 个国家的数据。同样，人们也可以从不同的来源提取缺失国家的数据，但在这个小项目中没有这样做。</p><p id="7050" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，作为提取过程的最后一步，幸福数据框和包含每个国家平均年龄的数据框被合并成一个大数据框(代码 4，图 2)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码 4:连接数据框以创建一个大的数据框。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/d11875d43bbf019f2402f5c04bbfe699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OH8ML6bjlpu5WhdglAguqg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 2:提取管道步骤结束时的数据帧头。</p></figure><h1 id="ba20" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">改变</h1><p id="8eee" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在让我们从 ETL 管道的第二部分开始，转换步骤。在转换步骤中，您通常会调整数据格式以满足您的需求，或者将列组合到新功能中。数据集准备得越好，机器学习工程师之后要做的工作就越少。在这个项目中，我决定添加一个包含每个国家 GDP 的列。这可以通过将“人均国内生产总值”和“人口”两栏相乘来计算。作为第二个转换步骤，我通过删除百分号并将字符串转换为浮点数，将列“20 岁以下人口”转换为浮点数。代码 5 显示了这些转换的代码，而图 3 显示了最终转换后的数据帧的头部。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码 5:转换管道步骤的代码。计算 GDP 并将其添加到数据框中，20 岁以下人口列被转换为 float 类型。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mx"><img src="../Images/62ab2e2c17ca4a91c0c6a03aeeee76c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tMiqJU0KtjicfhZVjyrE2w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 3:应用转换后数据帧的最终状态。</p></figure><h1 id="f32d" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">负荷</h1><p id="4e30" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">加载步骤是 ETL 管道的最后一步。在加载步骤中，最终数据集被加载为预期的存储格式。这可以是数据库、CSV 文件或许多其他存储类型之一。我决定将这个数据集存储在一个 CSV 文件中。这可以很容易地加载到机器学习中。代码 6 显示了最后一个管道步骤的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码 6:将最终数据集加载到 CSV 文件中。</p></figure><h1 id="b9a3" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="4288" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在本文中，我通过使用几个不同的数据源创建了一个小型数据集，并将数据组合成一个数据集。我演示了 ETL 管道的样子，并为每个管道步骤添加了代码。数据集现在可用于进一步分析。</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><p id="c0e5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">谢谢你把我的文章看完！我希望你喜欢这篇文章和我参与的项目。如果你想在未来阅读更多类似的文章，请关注我，保持更新。</p></div></div>    
</body>
</html>