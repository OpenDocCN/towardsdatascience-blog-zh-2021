<html>
<head>
<title>Discover Urban viewer: an interactive web map to visualize population of Urban Areas Worldwide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Discover Urban viewer:一个交互式web地图，用于可视化全球城市地区的人口</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/discover-urban-viewer-an-interactive-web-map-to-visualize-population-of-urban-areas-worldwide-f36df1fe420d?source=collection_archive---------26-----------------------#2021-07-22">https://towardsdatascience.com/discover-urban-viewer-an-interactive-web-map-to-visualize-population-of-urban-areas-worldwide-f36df1fe420d?source=collection_archive---------26-----------------------#2021-07-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c948" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在传单中创建包含全球城市群的网络地图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4d8e6787baa70c82bc046f420c5de568.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Iy73HsIahyeLsJFmc42loQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。城市浏览器:包含全球城市群的交互式网络地图</p></figure><p id="794b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">世界正在城市化。2018年，全球城市住区容纳了约55.3%的世界人口。联合国的预测估计，到2030年，60%的世界人口将居住在城市聚集区。城市化的主要趋势揭示了政府对使人类住区具有包容性、安全性、弹性和可持续性的关注[1]。由于城市新陈代谢(废物)，自然正在产生毁灭性的影响，当局主要关注的是通过创建有效的减少废物的过程来减少这种影响，例如回收利用、替代能源或化石燃料的转换，等等。</p><blockquote class="lv"><p id="14b3" class="lw lx it bd ly lz ma mb mc md me lt dk translated">都市观众<a class="ae mf" href="https://bryanvallejo16.github.io/urban-viewer-worldwide/" rel="noopener ugc nofollow" target="_blank">这里！</a> <br/>储存库<a class="ae mf" href="https://github.com/bryanvallejo16/urban-viewer-worldwide" rel="noopener ugc nofollow" target="_blank">这里！</a></p></blockquote><p id="d194" class="pw-post-body-paragraph ky kz it la b lb mg ju ld le mh jx lg lh mi lj lk ll mj ln lo lp mk lr ls lt im bi translated">联合国做了一个引人入胜的人口修订，名为:<a class="ae mf" href="https://www.un.org/en/events/citiesday/assets/pdf/the_worlds_cities_in_2018_data_booklet.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="la iu"> <em class="lu">世界城市化前景:2018年修订的</em></strong></a><strong class="la iu"><em class="lu"/></strong>显示了全球<strong class="la iu">城市群</strong>的人口预测。因此，我们将正确理解<em class="lu">城市群</em>的概念，这是我们在此实践中使用的划界，并将其与另外两个城市概念区分开来:<em class="lu">市区和都市圈</em>。</p><p id="efbd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">市区</strong>代表市区的行政核心。它保持了一个中心界限。下一个概念是<strong class="la iu">城市群</strong>，它指的是划定城市边界的毗连城区或建成区的范围。最后，<strong class="la iu">大都市区域</strong>代表了经济和社会相互联系的边界，通过商业或通勤模式相互联系。这些概念可以在提到的2018年修订版中进行审查。</p><blockquote class="lv"><p id="73b5" class="lw lx it bd ly lz ma mb mc md me lt dk translated">“本练习的目的是创建一个交互式网络地图，以活页形式显示2020年全球城市群的估计人口”</p></blockquote><blockquote class="ml mm mn"><p id="525e" class="ky kz lu la b lb mg ju ld le mh jx lg mo mi lj lk mp mj ln lo mq mk lr ls lt im bi translated"><strong class="la iu">数据</strong></p></blockquote><p id="5a4b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们在这个地图可视化实践中使用的数据集来自联合国经济和社会事务部人口动态部。具体来说，我们使用的是<em class="lu">文件12 </em>，其中包含了1950-2035年按国家划分的2018年拥有30万或以上居民的城市群的人口(千人)[2]该数据集在3.0版的知识共享协议下获得许可。</p><p id="66e9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">《2018年人口修订版》发布了包含大量城市预测信息的出版物，可在<a class="ae mf" href="https://population.un.org/wup/Publications/" rel="noopener ugc nofollow" target="_blank"> <em class="lu">出版物部分</em> </a>找到。</p><blockquote class="ml mm mn"><p id="5120" class="ky kz lu la b lb lc ju ld le lf jx lg mo li lj lk mp lm ln lo mq lq lr ls lt im bi translated"><strong class="la iu">练习</strong></p></blockquote><p id="0fa9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">该练习分为两个部分:1)数据格式，以及2)城市查看器web地图创建。</p><p id="235c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> <em class="lu"> 1)数据格式</em> </strong></p><p id="85a0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从<a class="ae mf" href="https://population.un.org/wup/Download/" rel="noopener ugc nofollow" target="_blank">下载页面</a>下载数据集<code class="fe mr ms mt mu b"><a class="ae mf" href="https://population.un.org/wup/Download/Files/WUP2018-F12-Cities_Over_300K.xls" rel="noopener ugc nofollow" target="_blank">WUP2018-F12-Cities_Over_300K.xls</a></code>后。您可能会注意到，这是一个excel文件，其结构不适合使用，尤其是在传单地图中。此外，您必须正确构建数据集，例如:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/38ef0b76dc2c2fd1020f9c7e45278ded.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3ZZvXIv2FjlvY15v.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。表格的正确结构示例。</p></figure><p id="dc5a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以直接在excel中完成，您可能需要保留列:<code class="fe mr ms mt mu b">Urban Agglomeration</code>、<code class="fe mr ms mt mu b">Latitude</code>、<code class="fe mr ms mt mu b">Longitude</code>和<code class="fe mr ms mt mu b">2020</code>。然后，您必须以这种方式更改列名:<code class="fe mr ms mt mu b">Urban Agglomeration</code>到<code class="fe mr ms mt mu b">City_name</code>和<code class="fe mr ms mt mu b">2020</code>到<code class="fe mr ms mt mu b">a2020</code>，以便它匹配城市查看器的代码。</p><p id="e1cf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当你有了合适的结构后，将它保存为<code class="fe mr ms mt mu b">.csv</code>，然后在<em class="lu"> geopandas </em>中打开它，并将几何列(经度，纬度)作为一个几何对象包含进来。您可以在文章<a class="ae mf" rel="noopener" target="_blank" href="/visualization-of-bike-sharing-system-movements-in-helsinki-with-an-interactive-flow-map-451d897104fe"><strong class="la iu"><em class="lu">赫尔辛基的自行车共享系统运动:用交互式流程图进行聚合和可视化</em> </strong> </a> <strong class="la iu"> <em class="lu">的<strong class="la iu"> <em class="lu">数据生成</em></strong>部分回顾这个过程。</em> </strong>最后保存为GeoJSON，名称<code class="fe mr ms mt mu b">pop_cities.geojson</code>。您会发现数据集已经在<a class="ae mf" href="https://github.com/bryanvallejo16/urban-viewer-worldwide" rel="noopener ugc nofollow" target="_blank">存储库</a>中。</p><p id="2d36" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为小叶映射手动完成的最后一步是在数据集中添加变量的名称。<a class="ae mf" href="https://leafletjs.com/examples/geojson/" rel="noopener ugc nofollow" target="_blank">小叶网有个例子</a>。因此，我们要使用的最终数据集应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/db2093804fa12df1ce5ca84fdaafcbe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gKLXgsSKnSxT7Srb4hKC0A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。数据集可在城市查看器中使用</p></figure><p id="7d1e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您想要自动创建更多不同年份的数据集，或者在创建GeoJSON时需要帮助，请随时寻求支持。您可以在<a class="ae mf" href="https://www.linkedin.com/in/bryanrvallejo/" rel="noopener ugc nofollow" target="_blank"><strong class="la iu"><em class="lu">LinkedIn</em></strong></a>上的我的个人资料中联系我，或者干脆在本文中留言。</p><p id="92c7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> <em class="lu"> 2)城市观者创作</em> </strong></p><p id="4ef1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，我们必须创建一个包含必要文件的存储库，以使Urban Viewer正常工作。我们添加了一个名为<code class="fe mr ms mt mu b">css </code>的文件夹和另一个名为<code class="fe mr ms mt mu b">js.</code>的文件夹，我们还添加了一个名为<code class="fe mr ms mt mu b">index.html</code>的HTML文件，你可以通过在本地磁盘上克隆这个库来获得这些文件。因此，您的本地文件夹可能如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/b2ad6fda67557f76a26ba839053f2664.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*Vo2j1aB-0CAcXBf9jQpaBA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。知识库结构。</p></figure><p id="54d4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意在<em class="lu">数据文件夹</em>中已经有一个<code class="fe mr ms mt mu b">pop_cities.geojson</code>文件，它是步骤1)的结果。要使用文件进行web映射，我推荐使用<a class="ae mf" href="https://atom.io/" rel="noopener ugc nofollow" target="_blank"><strong class="la iu">Atom</strong></a><strong class="la iu"/>或者简单地使用<a class="ae mf" href="https://notepad-plus-plus.org/downloads/" rel="noopener ugc nofollow" target="_blank"><strong class="la iu">notepad++</strong></a><strong class="la iu">。</strong></p><p id="2b16" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我们将下载并复制<a class="ae mf" href="https://leafletjs.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="la iu">传单API </strong> </a>用于文件夹<code class="fe mr ms mt mu b">js.</code>中的web制图。此外，我们添加一个空的JS文件，在本例中命名为<code class="fe mr ms mt mu b">main.js</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi my"><img src="../Images/852b0b8d7b3ba7f407b87ff96c10779a.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*D2O2RDbGHZBMtCTkqtGrMA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。js文件夹的结构</p></figure><p id="1019" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，在文件夹<code class="fe mr ms mt mu b">css </code>中，我们添加来自传单的CSS文件和一个空文件，我们在本例中称之为<code class="fe mr ms mt mu b">style.css</code> CSS文件夹，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/77cca914e0fa20a57019e6c8ee60f0a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*EZF-aMypBipq2ETLr2QL1w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。CSS文件夹的结构</p></figure><p id="f0c2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="lu"> 2.1)将文件加载到index.html</em></p><p id="c325" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将使用Atom或Notepad++打开<em class="lu">index.html</em>文件，并开始加载文件。它将包含一个<strong class="la iu">头部</strong>和一个<strong class="la iu">主体</strong>。在主体部分，我们包含了运行地图动画的主要文件，还有传单文件和数据文件。它包括来自ESRI的基本地图。</p><pre class="kj kk kl km gt na mu nb nc aw nd bi"><span id="b66c" class="ne nf it mu b gy ng nh l ni nj">&lt;!DOCTYPE HTML&gt;<br/>&lt;html&gt;<br/> &lt;head&gt;<br/>  &lt;meta charset="utf-8"&gt;<br/>  &lt;title&gt;Urban Viewer Demo&lt;/title&gt;</span><span id="8ae3" class="ne nf it mu b gy nk nh l ni nj">  &lt;!--link to stylesheet--&gt;<br/>  &lt;link rel="stylesheet" href="css/style.css"&gt;</span><span id="d184" class="ne nf it mu b gy nk nh l ni nj">&lt;!-- link to leaflet stylesheet--&gt;<br/>  &lt;link rel="stylesheet" href="css/leaflet.css"&gt;</span><span id="2bb1" class="ne nf it mu b gy nk nh l ni nj">&lt;/head&gt;</span><span id="74e6" class="ne nf it mu b gy nk nh l ni nj">&lt;body&gt;<br/>  &lt;!-- title of your map--&gt;<br/>  &lt;h1&gt; 🌎Urban viewer - Urban agglomerations worldwide  &lt;/h1&gt;</span><span id="ada5" class="ne nf it mu b gy nk nh l ni nj">&lt;!-- division div for the map --&gt;<br/>  &lt;div id="map"&gt;&lt;/div&gt;</span><span id="4d40" class="ne nf it mu b gy nk nh l ni nj">&lt;!-- link to leaflet javascript library--&gt;<br/>  &lt;script src="js/leaflet-src.js"&gt;&lt;/script&gt;</span><span id="f062" class="ne nf it mu b gy nk nh l ni nj">&lt;!-- load Esri Leaflet because we want to use an Esri basemap --&gt;<br/>  &lt;script src="<a class="ae mf" href="https://unpkg.com/esri-leaflet@2.3/dist/esri-leaflet.js" rel="noopener ugc nofollow" target="_blank">https://unpkg.com/esri-leaflet@2.3/dist/esri-leaflet.js</a>"&gt;&lt;/script&gt;</span><span id="ce7c" class="ne nf it mu b gy nk nh l ni nj">&lt;!--link to the files that contains geoJson data--&gt;<br/>  &lt;script src="data/pop_cities.geojson" type="text/javascript"&gt; &lt;/script&gt;</span><span id="fa50" class="ne nf it mu b gy nk nh l ni nj">&lt;!-- link to main javascript file --&gt;<br/>  &lt;script src="js/main.js"&gt;&lt;/script&gt;</span><span id="4b93" class="ne nf it mu b gy nk nh l ni nj">&lt;/body&gt;<br/>&lt;html&gt;</span></pre><p id="c11a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="lu">2.2)map-style . CSS中的参数</em></p><p id="0780" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们必须设计HTML对象的样式，我们在。css文件中的对象:<em class="lu">标题、正文、图例和地图</em>。打开<code class="fe mr ms mt mu b">style.css</code>，包含下一段代码:</p><pre class="kj kk kl km gt na mu nb nc aw nd bi"><span id="1e46" class="ne nf it mu b gy ng nh l ni nj">h1{<br/> position: fixed;<br/> font-family: "Times New Roman", Times, serif;<br/> font-size: 24px;<br/>  box-shadow: 2px 2px 3px 3px black;<br/> background: lightgray;<br/>    color: black;<br/>    margin-left:5%;<br/>    margin-top: 0.6%;<br/>    z-index: 2;<br/>}</span><span id="0f3f" class="ne nf it mu b gy nk nh l ni nj">body{<br/> width: 100%;<br/> height: 100%;<br/> margin: 0px;<br/> font-family: "Helvetica Neue", Arial, Helveticam sans-serif;<br/>}</span><span id="fafb" class="ne nf it mu b gy nk nh l ni nj">.info {<br/>    padding: 6px 8px;<br/>    font-family: "Times New Roman", Times, sans-serif;<br/>    font-size: 20px;<br/>    background: white;<br/>    background: rgba(255,255,255,0.8);<br/>    box-shadow: 0 0 15px rgba(0,0,0,0.2);<br/>    border-radius: 5px;<br/>}<br/>.info h3 {<br/>  font-size: 24px;<br/>  font-family:  "Times New Roman", Times, serif;</span><span id="153b" class="ne nf it mu b gy nk nh l ni nj">text-shadow: 2px 2px 5px gray;<br/>    margin: 0 0 5px;<br/>    color: #282825   ;<br/>}</span><span id="3170" class="ne nf it mu b gy nk nh l ni nj">.legendcolor {<br/>    line-height: 18px;<br/>    color: #555;<br/>}<br/>.legend i {<br/>    width: 18px;<br/>    height: 18px;<br/>    float: left;<br/>    margin-right: 8px;<br/>    opacity: 1;<br/>}</span><span id="e456" class="ne nf it mu b gy nk nh l ni nj">.legend .circle {<br/>  border-radius: 50%;<br/>  width: 15px;<br/>  height: 15px;<br/>  margin-top: 8px;<br/>}</span><span id="36fd" class="ne nf it mu b gy nk nh l ni nj">#map {<br/> height:100%;<br/> width:100%;<br/> left:0%;<br/> overflow:hidden;<br/> position:fixed;<br/> border:1px #444 solid;<br/>}</span></pre><p id="8ae0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可能会注意到它包含可视化参数，如字体、位置或地图大小。如果你想重新设计你自己的城市观察器，你可以改变它们。</p><p id="9e9e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">添加CSS代码后，如果您在浏览器中打开index.html，您可能会看到如下所示的空白画布:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/9815d2d5a7abf017ba5e7a9d13b26bd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mSk6oFGa4I330aFg1UwucA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。空画布</p></figure><p id="187c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="lu"> 2.3)创建城市浏览器</em></p><p id="3677" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这里，我们将开始用传单创建地图。是时候打开并开始编辑<code class="fe mr ms mt mu b">main.js</code>文件了。我们一步一步来。你可以看一下<a class="ae mf" href="https://leafletjs.com/examples/choropleth/" rel="noopener ugc nofollow" target="_blank"> <strong class="la iu"> <em class="lu">传单互动Choropleth Map </em> </strong> </a>的例子，我在建立Map变量和定义图例颜色时得到了一些帮助。</p><p id="e60d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我们为地图添加一个变量，定义缩放级别和中心。然后，我们添加OSM (OpenStreetMap)和ESRI作为底图。您可以在此处更改属性，例如您的姓名或机构名称，以便在最终的web地图中显示。</p><pre class="kj kk kl km gt na mu nb nc aw nd bi"><span id="1bdb" class="ne nf it mu b gy ng nh l ni nj">// ADDING BASE MAPS, MAP AND SCALE BAR<br/>var map = L.map('map').setView([25, 12], 3);</span><span id="bc37" class="ne nf it mu b gy nk nh l ni nj">var osm = <br/>L.tileLayer('<a class="ae mf" href="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'Open" rel="noopener ugc nofollow" target="_blank">https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'Open</a> Street Maps | Bryan R. Vallejo'});</span><span id="eb69" class="ne nf it mu b gy nk nh l ni nj">var esri = <br/>L.tileLayer('<a class="ae mf" href="https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'" rel="noopener ugc nofollow" target="_blank">https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'</a>, {attribution: 'Tiles &amp;copy; Esri &amp;mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community | Bryan R. Vallejo',maxZoom: 18});</span><span id="beba" class="ne nf it mu b gy nk nh l ni nj">var esridark = <br/>L.esri.basemapLayer('DarkGray',{attribution: 'Bryan R. Vallejo'});</span><span id="5388" class="ne nf it mu b gy nk nh l ni nj">var esrigray = <br/>L.esri.basemapLayer('Gray',{attribution: 'Bryan R. Vallejo'});</span><span id="7c13" class="ne nf it mu b gy nk nh l ni nj">esridark.addTo(map)</span><span id="89a2" class="ne nf it mu b gy nk nh l ni nj">var basemaps={<br/>  'DarkGray': esridark,<br/>  'Satellite': esri,<br/> 'OSM': osm<br/>}</span><span id="4f93" class="ne nf it mu b gy nk nh l ni nj">L.control.scale({imperial:false, position:'bottomleft'}).addTo(map);</span></pre><p id="2674" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果在浏览器中刷新index.html文件，它应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/9a25bf833a026327ec3e4cab46bb321d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8nuQuWAkdzYhdR7LqyoEZA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。从带有ESRI底图的传单添加地图对象</p></figure><p id="cc70" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，我们将添加数据集，并在<em class="lu">信息框</em>中包含检索人口信息的函数。如有必要，务必检查<a class="ae mf" href="https://leafletjs.com/examples/choropleth/" rel="noopener ugc nofollow" target="_blank">活页示例</a>。</p><pre class="kj kk kl km gt na mu nb nc aw nd bi"><span id="da86" class="ne nf it mu b gy ng nh l ni nj">//FUNCTIONS</span><span id="da79" class="ne nf it mu b gy nk nh l ni nj">/Function to highlight Features</span><span id="3b40" class="ne nf it mu b gy nk nh l ni nj">function highlightFeature(e) {<br/>  var activefeature = e.target;<br/>  activefeature.setStyle({<br/>    weight: 5,<br/>    color: '#F0F92B',<br/>    dashArray: '',<br/>    fillOpacity: 0.3<br/>  });<br/>  if (!L.Browser.ie &amp;&amp; !L.Browser.opera) {<br/>    activefeature.bringToFront();<br/>  } info.update(activefeature.feature.properties);<br/>}</span><span id="6328" class="ne nf it mu b gy nk nh l ni nj">//function for resetting the highlight<br/>function resetHighlight(e) {<br/>  cities.resetStyle(e.target);<br/>  info.update();<br/>}</span><span id="ea56" class="ne nf it mu b gy nk nh l ni nj">function zoomToFeature(e) {<br/>  map.flyTo(e.target.getLatLng(),6);<br/>}</span><span id="c155" class="ne nf it mu b gy nk nh l ni nj">//to call these methods we need to add listeners to our features<br/>//the word ON is a short version of addEventListener</span><span id="bfa2" class="ne nf it mu b gy nk nh l ni nj">function interactiveFunction(feature, layer) {<br/>  layer.on({<br/>    mouseover: highlightFeature,<br/>    mouseout: resetHighlight,<br/>    click: zoomToFeature,<br/>  } );<br/>}</span></pre><p id="bb9d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，我们将继续添加功能。第一个是根据人口数量定义圆的<strong class="la iu"> <em class="lu">半径大小</em> </strong>。第二个，圆圈 的<strong class="la iu"> <em class="lu">颜色。第三个，根据点的大小(人口)和颜色定义点的<strong class="la iu"> <em class="lu">样式</em> </strong>。</em></strong></p><pre class="kj kk kl km gt na mu nb nc aw nd bi"><span id="62d5" class="ne nf it mu b gy ng nh l ni nj">// calculate the circles' radius given the cities' population</span><span id="c766" class="ne nf it mu b gy nk nh l ni nj">function getRadius(pop) {<br/>var maxSymbolsize = 20; // maximum symbol size<br/>var maxValue = 37393129; // highest population value in the dataset<br/>r = maxSymbolsize * Math.sqrt(pop/maxValue); // proportional by area<br/>return r;<br/>}</span><span id="b5ba" class="ne nf it mu b gy nk nh l ni nj">// create the circles' style</span><span id="459f" class="ne nf it mu b gy nk nh l ni nj">function getColor(d) {<br/>return d &gt; 10000000  ? '#d7301f' :<br/>        d &gt; 5000000  ? '#fc8d59' :<br/>        d &gt; 1000000   ? '#fdcc8a' :<br/>        '#fef0d9' ;<br/>      }</span><span id="9741" class="ne nf it mu b gy nk nh l ni nj">// radius calculated with function above and population property form GeoJSON as input</span><span id="b979" class="ne nf it mu b gy nk nh l ni nj">function style(feature) {<br/>  return {<br/>    radius: getRadius(feature.properties.a2020), <br/>    fillColor:getColor(feature.properties.a2020),<br/>    color: "#000",<br/>    weight: 1,<br/>    opacity: 0,<br/>    fillOpacity: 0.9<br/>  };<br/>}</span></pre><p id="befa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">目前，我们已经定义了创建web地图交互的功能，以及城市群的风格(大小和颜色)。</p><p id="512d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下一步，添加城市层。</p><pre class="kj kk kl km gt na mu nb nc aw nd bi"><span id="dc49" class="ne nf it mu b gy ng nh l ni nj">// Add circles, popups and tooltips to the map</span><span id="84e3" class="ne nf it mu b gy nk nh l ni nj">var cities=L.geoJson(pop_cities, {<br/>  pointToLayer: function (feature, latlng) {<br/>    return L.circleMarker(latlng, style(feature));<br/>  },<br/>  onEachFeature: interactiveFunction<br/>}).addTo(map)</span></pre><p id="490f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您在浏览器中刷新<code class="fe mr ms mt mu b">index.html</code>,它可能看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/dec15f80aa42664288b21a94aca3b191.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HGP1Mn1YkVvuJdSP80joAA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。《城市观察》中的城市群初窥</p></figure><p id="5603" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下一步是在infobox中检索每个城市的居民数量。为此，我们可以包含一个infobox对象和使它具有交互性的功能。</p><pre class="kj kk kl km gt na mu nb nc aw nd bi"><span id="c08e" class="ne nf it mu b gy ng nh l ni nj">//ADDING A INFO CONTROL BOX<br/>var info = L.control();</span><span id="7daa" class="ne nf it mu b gy nk nh l ni nj">info.onAdd = function (map) {<br/>  this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"<br/>  this.update();<br/>  return this._div;<br/>};</span><span id="acc1" class="ne nf it mu b gy nk nh l ni nj">// method that we will use to update the control based on feature properties passed<br/>info.update = function (props) {<br/>  this._div.innerHTML = '&lt;h3&gt; Cities and population &lt;/h3&gt;' +  (props ?<br/>    '&lt;b&gt;'+props.City_name +'&lt;/b&gt;'+ ' 🌆' +'&lt;br/&gt;' + props.a2020 + ' Inhabitants in 2020':<br/>    'Hover the mouse over the map to see data.'+'&lt;br/&gt;'+'¡Try clicking over the cities!' );<br/>  };</span><span id="98d7" class="ne nf it mu b gy nk nh l ni nj">info.addTo(map);</span></pre><p id="0db3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果刷新index.html文件，信息框可能如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/83f8ce3af384754192f00031050ba304.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ghoL1Coo_Gn8kek3YgwJZA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。添加到城市查看器的信息框</p></figure><p id="df56" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，我们通过一个循环添加定义类颜色的图例。</p><pre class="kj kk kl km gt na mu nb nc aw nd bi"><span id="90f9" class="ne nf it mu b gy ng nh l ni nj">//ADDING A LEGEND WITH COLORS</span><span id="d3f6" class="ne nf it mu b gy nk nh l ni nj">var legendcolor = L.control({position: 'bottomleft'});<br/>legendcolor.onAdd = function (map) {<br/>  var div = L.DomUtil.create('div', 'info legend'),<br/>  grades = [300000, 1000000, 5000000, 10000000],<br/>  labels = [];<br/>  <br/>// loop through our density intervals and generate a label with a colored square for each interval</span><span id="17b3" class="ne nf it mu b gy nk nh l ni nj">for (var i = 0; i &lt; grades.length; i++) {<br/>  div.innerHTML +=<br/>  '&lt;i class ="circle" style="background:' + getColor(grades[i] + 1) + '"&gt;&lt;/i&gt; ' +<br/>  grades[i] + (grades[i + 1] ? '&amp;ndash;' + grades[i + 1] + '&lt;br&gt;' : '+');<br/>}<br/>return div;<br/>};</span><span id="10c2" class="ne nf it mu b gy nk nh l ni nj">legendcolor.addTo(map);</span></pre><p id="6c35" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您在浏览器中刷新<code class="fe mr ms mt mu b">index.html</code>文件。您会注意到，当您将鼠标悬停在城市上方时，infobox会检索信息。此外，还会添加带有适当颜色的图例。看起来是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/8a3e29ce22197b9c66c8f516478d0d3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZfUAKUL-bA_7A4SHNQ59Wg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。添加了图例的城市查看器。</p></figure><p id="77a4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后一步是添加一个图层控制器，如果需要，可以打开底图和城市。</p><pre class="kj kk kl km gt na mu nb nc aw nd bi"><span id="98b5" class="ne nf it mu b gy ng nh l ni nj">//ADDING A LAYER CONTROL<br/>var features={<br/>  'Cities': cities<br/>}</span><span id="f884" class="ne nf it mu b gy nk nh l ni nj">var legend = L.control.layers(basemaps, features, {position: 'bottomleft', collapsed:true}).addTo(map);</span></pre><p id="6749" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，如果需要，你可以改变基本地图并关闭城市。最后，使用OSM底图，城市查看器看起来是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/54170690ac7a77afc37ee89781124913.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PbF4sl_EaGPYBlgrKXAv0w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。带有OSM底图的城市查看器。</p></figure><blockquote class="ml mm mn"><p id="db3e" class="ky kz lu la b lb lc ju ld le lf jx lg mo li lj lk mp lm ln lo mq lq lr ls lt im bi translated"><strong class="la iu"> <em class="it">推荐</em> </strong></p></blockquote><p id="d43b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你在JavaScript方面经验丰富，你可以继续给<strong class="la iu">城市浏览器</strong>添加功能。例如，你可以添加<em class="lu">搜索框</em>，这样你就可以输入城市。这取决于你想赋予它的效用。本练习中解释的主要用于可视化和信息。用户可以快速查看全球<em class="lu">城市群的人口</em>。</p><blockquote class="lv"><p id="fb70" class="lw lx it bd ly lz ma mb mc md me lt dk translated">如果您对创建<strong class="ak">城市查看器</strong>感兴趣，并且需要支持来创建您自己的基于web地图的项目。在我的个人资料上Ping我<a class="ae mf" href="https://www.linkedin.com/in/bryanrvallejo/" rel="noopener ugc nofollow" target="_blank"><strong class="ak">LinkedIn</strong></a><strong class="ak">。</strong></p></blockquote><blockquote class="ml mm mn"><p id="d0b6" class="ky kz lu la b lb mg ju ld le mh jx lg mo mi lj lk mp mj ln lo mq mk lr ls lt im bi translated"><strong class="la iu">参考文献</strong></p></blockquote><p id="90d4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">[1]联合国经济和社会事务部人口司(2018年)。<strong class="la iu"><em class="lu">2018年世界城市—数据手册(ST/ESA/ SER。</em>一/417)</strong>。</p><p id="e874" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">[2]联合国经济和社会事务部人口司(2018年)。<strong class="la iu"> <em class="lu">《世界城市化前景:2018年修订本</em> </strong>，网络版。</p></div></div>    
</body>
</html>