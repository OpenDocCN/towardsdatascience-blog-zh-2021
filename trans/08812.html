<html>
<head>
<title>Deploying a Web App Using Heroku, Google Cloud &amp; GitHub</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Heroku、Google Cloud和GitHub部署Web应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploying-a-web-app-using-heroku-google-cloud-github-1661379fb1b5?source=collection_archive---------9-----------------------#2021-08-14">https://towardsdatascience.com/deploying-a-web-app-using-heroku-google-cloud-github-1661379fb1b5?source=collection_archive---------9-----------------------#2021-08-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6a0b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">允许用户从Google Cloud交互式查询数据，而不暴露您的凭据。</h2></div><p id="1c0e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我最近玩了一下应用程序部署，做了一个关于芝加哥地区犯罪的应用程序。点击这里查看！</p><p id="b0b6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">顾名思义，我希望将源代码保留在GitHub上，使用Heroku进行部署，因为它是免费的，并允许用户从芝加哥警察局实时查询数据，以减少存储成本和维护。安全地做到这一点比我预期的要复杂得多，所以我认为这篇文章可能对其他人有所帮助。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/e0fad7955c73646e23fab0dd7055695d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*esub-Gum7hX-Uw3w"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">由<a class="ae le" href="https://unsplash.com/@flowforfrank?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">费伦茨·阿尔马西</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3fe7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么是这些工具？</h1><p id="fb32" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">GitHub :我想把我的代码都放在GitHub上。出于几个原因，我不想在多个位置存储不同的项目。第一，很乱。我不想为了维护我的项目而在平台之间切换。第二，我记性很差。如果我没有东西放在一个地方，很可能我会忘记一些曾经存在过的东西。</p><p id="8b4d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> Google Cloud: </strong>那是我获得<a class="ae le" href="https://cloud.google.com/bigquery/public-data" rel="noopener ugc nofollow" target="_blank">数据</a>的地方。要构建一个几乎不需要维护并保持最新的应用程序，我知道我需要一些东西，允许我在需要时从那里查询数据。还有，数据是海量的！光是加载就够给熊猫添麻烦了，所以把数据存储在GitHub上不太实际。</p><p id="c642" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Heroku:我想我本可以继续使用谷歌云，使用他们的应用引擎。也许吧。我还没有深入调查过，所以不能确定。它要求我放下一张信用卡，所以我停下来。我还没有富到让公司拿我的信用卡做人质的地步。此外，我有使用GitHub &amp; Heroku部署应用程序的经验。老实说，对我来说，Heroku的界面比谷歌云服务更友好。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="dc6b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">那么挑战是什么？</h1><p id="6a0f" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated"><strong class="kk iu">安全问题:</strong>要使用BigQuery(数据在Google Cloud上)，我必须在每次想要查询数据时向应用程序提供我的凭证。有一个简单明了的计划，就是把所有东西都发布到GitHub上，然后让Heroku接手。</p><p id="9d21" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">试验1: </strong>上传凭证到GitHub上的私有库，在主项目的库中创建子模块，引用私有库。听起来可行，对吧？<a class="ae le" href="https://devcenter.heroku.com/articles/github-integration" rel="noopener ugc nofollow" target="_blank">没有</a>！Heroku不加载GitHub的子模块。我希望我在尝试之前能看到这个…</p><p id="4cc5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">试炼2 </strong> : <a class="ae le" href="https://docs.github.com/en/actions/reference/encrypted-secrets" rel="noopener ugc nofollow" target="_blank"> GitHub秘笈</a>！我认为将我的凭证复制粘贴为存储库秘密是可行的。然后，当Heroku从GitHub部署时，我可以使用<a class="ae le" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> GitHub Actions </a>将秘密作为一个变量进行广播，我可以使用<code class="fe mz na nb nc b">os</code>从Python脚本中获得这个变量。老实说，我仍然不知道这是否可行。我写了一个‘动作’剧本(你是这么说的吗？)似乎通过了GitHub的sniff测试。但是在我的Python脚本中，我根本无法访问这个变量。如果你知道，请告诉我。</p><p id="9743" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">试验三:</strong>然后我想到也许我可以在Heroku这边做一些类似的事情？也许我可以直接告诉Heroku我的资历。而我<a class="ae le" href="https://devdojo.com/bryanborge/adding-google-cloud-credentials-to-heroku" rel="noopener ugc nofollow" target="_blank">找到了</a>我的解决方案！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ab02" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">第三次是一种魅力</h1><p id="95cb" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">因此，步骤是这样的(我不会经历完全复制我的项目的所有步骤，只是那些我认为对于实现使用来自Google Cloud的数据从GitHub部署Heroku应用程序的类似目标是必要的):</p><ol class=""><li id="f397" class="nd ne it kk b kl km ko kp kr nf kv ng kz nh ld ni nj nk nl bi translated">创建一个Heroku帐户，然后在您的控制面板中，单击“新建”创建一个新应用程序。我选择了Python。</li><li id="551e" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld ni nj nk nl bi translated">按照这些<a class="ae le" href="https://devcenter.heroku.com/articles/github-integration" rel="noopener ugc nofollow" target="_blank">步骤</a>来集成GitHub和Heroku。我不建议允许自动部署，除非你确定一切正常。当Heroku给你的收件箱发邮件说‘这没用!’时，你会感到焦虑。！!'当它每5分钟尝试部署你的应用时。</li><li id="a5ee" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld ni nj nk nl bi translated">在GitHub repo中创建一个Procfile、setup.sh(由GitHub<a class="ae le" href="https://github.com/vo-h/Chicago-Crime" rel="noopener ugc nofollow" target="_blank">复制并粘贴)和requirements.txt(包含一个python包的列表以使您的应用程序工作)文件。</a></li><li id="c651" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld ni nj nk nl bi translated">按照这些<a class="ae le" href="https://cloud.google.com/bigquery/docs/quickstarts/quickstart-client-libraries" rel="noopener ugc nofollow" target="_blank">步骤</a>为Google BigQuery设置一个Python客户端。不过，你不需要使用虚拟环境。我用康达。我认为google-cloud-bigquery确实与一些python包冲突，所以我必须为这个项目创建一个新的conda环境。最后，您应该得到一个包含您的凭证的. json文件。还有，第一个1TB是每月免费的，所以我没有设置计费账户。</li><li id="ce59" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld ni nj nk nl bi translated">按照这些<a class="ae le" href="https://devdojo.com/bryanborge/adding-google-cloud-credentials-to-heroku" rel="noopener ugc nofollow" target="_blank">步骤</a>让Heroku知道你的证书。</li></ol></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7f79" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">streamlit——网络的上帝——开发无能</h1><p id="c5b3" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">我唯一真正懂的语言是Python。过去，我曾尝试过MATLAB、Java和R，主要是为了协作项目或课程。当然，如果情况需要，我可以学习新的语言。但如果是为了个人项目，我会尽量把自己对Python的理解推得更远。我只是在走阻力最小的路。</p><p id="d8ca" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">想象一下，当我发现我不必学习Javascript或CSS之类的东西时，我有多轻松。按照以下步骤安装<a class="ae le" href="https://docs.streamlit.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> streamlit </a>。我会用<code class="fe mz na nb nc b">conda install -c conda-forge streamlit</code>来代替。点击此<a class="ae le" href="https://docs.streamlit.io/en/stable/api.html" rel="noopener ugc nofollow" target="_blank">链接</a>查看他们的小工具选项。我没有足够的经验来判断这些选项是否足以满足你的所有需求，但它们肯定足以满足我的需求。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="df5a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">我如何构建应用程序的精简演练</h1><p id="55c6" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">首先，我给这个应用起了一个时髦的名字，吸引眼球，比如</p><pre class="lg lh li lj gt nr nc ns nt aw nu bi"><span id="17c0" class="nv md it nc b gy nw nx l ny nz">import streamlit as st<br/>st.title("Chicago Crime")</span></pre><p id="80e8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那里！然后，我将所有东西包装在一个<code class="fe mz na nb nc b">if</code>语句中，以确保代码只在我拥有Google Cloud凭证的情况下运行。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="eb24" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我想要一个侧边栏，让用户指定他们的偏好。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="d53c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当你打开我的网络应用程序时，我想这些功能显而易见。然后，根据<code class="fe mz na nb nc b">question</code>变量返回的内容，执行一条<code class="fe mz na nb nc b">if</code>语句。</p><p id="365b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我认为streamlit的可爱之处在于，我不必担心将所有东西都包装在一个不断获取用户输入的循环中。例如，如果用户首先选择“普遍犯罪”，则相应的if语句被激活。一个普通的Python程序会在一次输入后结束。但是有了streamlit，用户可以随心所欲地多次输入他们的选项，脚本就可以“重新运行”,而无需我为这个过程显式编码。</p><p id="c2e7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了可视化数据，我使用了plotly。这个过程就像一个人通常会做的那样，但是为了形象化，像这样传递它来简化它</p><pre class="lg lh li lj gt nr nc ns nt aw nu bi"><span id="0c5a" class="nv md it nc b gy nw nx l ny nz">st.plotly_chart(fig1)</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5dee" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">总结</h1><p id="76d5" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">本文讨论了构建一个从Google Cloud查询数据的web应用程序并使用Heroku &amp; GitHub部署它的必要步骤。在Heroku上部署应用程序肯定有更快更简单的方法。事实上，我想要GitHub上的所有东西，这让整个过程变得复杂。</p><p id="1a87" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由此产生的应用程序也存在延迟问题，因为它是从大型数据集实时查询的。我还注意到应用程序启动需要一点时间，这让我想知道是否有比Heroku更好的平台。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9d42" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">保持联系</h1><p id="2429" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">我喜欢写关于数据科学和科学的文章。如果你喜欢这篇文章，请在<a class="ae le" href="https://medium.com/@h-vo" rel="noopener"> Medium </a>上关注我，加入我的<a class="ae le" href="https://medium.com/subscribe/@h-vo" rel="noopener">电子邮件列表</a>，或者<a class="ae le" href="https://medium.com/@h-vo/membership" rel="noopener">成为Medium会员</a>(如果你使用这个链接，我将收取你大约50%的会员费)，如果你还没有的话。下一篇帖子再见！😄</p></div></div>    
</body>
</html>