<html>
<head>
<title>Introduction to Kafka Stream Processing in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中Kafka流处理简介</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introduction-to-kafka-stream-processing-in-python-e30d34bf3a12?source=collection_archive---------2-----------------------#2021-11-08">https://towardsdatascience.com/introduction-to-kafka-stream-processing-in-python-e30d34bf3a12?source=collection_archive---------2-----------------------#2021-11-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="07e9" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">卡夫卡|流媒体| PYTHON</h2><div class=""/><div class=""><h2 id="51cd" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用Faust在Python中轻松处理Kafka流的分步指南</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/6afacec8bcaa6bc063f36fdfd6e54768.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZXyuV4wEyB_WPx9W"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">亨特·哈里特在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="6de2" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">在我们开始之前，卡夫卡是什么？</h1><p id="5fc8" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">让我们首先为那些不了解Apache Kafka技术的人提供一个快速的介绍。</p><p id="92d0" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">Kafka简单来说就是Apache的开源分布式事件流平台。Kafka允许我们建立和管理实时数据流管道。</p><p id="83f1" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">为了这篇文章，你需要了解卡夫卡的四个主要概念。</p><ol class=""><li id="cac5" class="nb nc it mc b md mw mg mx mj nd mn ne mr nf mv ng nh ni nj bi translated"><strong class="mc jd">话题</strong> : <em class="nk">卡夫卡所有的信息都是通过话题传递的。主题只是我们组织和分组信息集合的一种方式。我们可以有多个主题，每个主题都有一个唯一的名称。</em></li><li id="7b44" class="nb nc it mc b md nl mg nm mj nn mn no mr np mv ng nh ni nj bi translated"><strong class="mc jd">消费者:</strong> <em class="nk">消费者是Kafka内部的一个实体(通常称为订阅者)，负责连接(或订阅)某个特定主题以阅读其消息。</em></li><li id="0d9d" class="nb nc it mc b md nl mg nm mj nn mn no mr np mv ng nh ni nj bi translated"><strong class="mc jd">制作者:</strong> <em class="nk">制作者是Kafka内部的一个实体(俗称出版者)，负责撰写(或发布)某个特定主题的消息。</em></li><li id="f486" class="nb nc it mc b md nl mg nm mj nn mn no mr np mv ng nh ni nj bi translated"><strong class="mc jd">消费群体:</strong>在卡夫卡中，我们可以有多个主题，有多个消费者订阅。我们也可以有多个服务(即外部应用程序)订阅相同的主题。为了防止重叠和数据问题，每个服务都可以有自己的使用者组来跟踪哪些消息已经被处理(通常称为偏移量)。</li></ol><h2 id="e139" class="nq lj it bd lk nr ns dn lo nt nu dp ls mj nv nw lu mn nx ny lw mr nz oa ly iz bi translated">TL；速度三角形定位法(dead reckoning)</h2><p id="b9c4" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">阿帕奇卡夫卡是一个信息传递系统。</p><p id="66b9" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">消息按主题组织。</p><p id="f43a" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">生产者向主题发送数据。</p><p id="cd05" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">消费者从主题中读取数据。</p><p id="3510" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">消费者团体管理一组消费者。</p></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><h1 id="5cda" class="li lj it bd lk ll oi ln lo lp oj lr ls ki ok kj lu kl ol km lw ko om kp ly lz bi translated">设置本地Kafka实例</h1><p id="f2de" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">wurstmeister为在docker 容器中运行Kafka提供了一个非常好的仓库。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="c56e" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">如果我们希望我们的Kafka集群可以从外部访问(即从您的终端或服务)，我们需要更新<strong class="mc jd"> docker-compose.yml </strong>文件。</p><p id="0322" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated"><strong class="mc jd"> vim docker-compose.yml </strong>并用以下内容更新它:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="86b7" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">然后在终端中<strong class="mc jd"> docker-compose up -d </strong>。</p><p id="080d" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">以上将打开<strong class="mc jd"> <em class="nk"> localhost:9092上的卡夫卡监听器。</em> </strong></p><p id="8cb4" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">一旦构建了docker映像，我们应该会看到Kafka实例正在运行。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi op"><img src="../Images/47a034bdfa273f81f114ddf07f8a429a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vhrv7RaDgSsl_nqhYkQklw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">运行中的卡夫卡实例</p></figure><p id="813c" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">要进入Kafka bash shell，我们可以使用:</p><pre class="ks kt ku kv gt oq or os ot aw ou bi"><span id="7320" class="nq lj it or b gy ov ow l ox oy">kafka-docker % docker exec -i -t -u root $(docker ps | grep docker_kafka | cut -d' ' -f1) /bin/bash</span></pre><p id="f892" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">现在是我们创建第一个主题的时候了。我们可以通过以下方式做到这一点:</p><pre class="ks kt ku kv gt oq or os ot aw ou bi"><span id="3cd9" class="nq lj it or b gy ov ow l ox oy">$KAFKA_HOME/bin/kafka-topics.sh --create --partitions 4 --bootstrap-server kafka:9092 --topic test</span></pre><p id="0db0" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">要列出Kafka实例中所有可用的主题，我们可以使用:</p><pre class="ks kt ku kv gt oq or os ot aw ou bi"><span id="4d6e" class="nq lj it or b gy ov ow l ox oy">$KAFKA_HOME/bin/kafka-topics.sh --bootstrap-server kafka:9092 --list</span></pre><p id="afa0" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">为了测试是否一切正常，让我们发送一些消息。</p><p id="490b" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">在主题测试中启动一个生成器:</p><pre class="ks kt ku kv gt oq or os ot aw ou bi"><span id="082c" class="nq lj it or b gy ov ow l ox oy">$KAFKA_HOME/bin/kafka-console-producer.sh --broker-list kafka:9092 --topic=test</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oz"><img src="../Images/4f722a5653aa231f80820450a6a86cbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6vgF9hKgWWfDI_6MYCC_Gg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">测试制作人</p></figure><p id="e5b1" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">启动主题测试的消费者:</p><pre class="ks kt ku kv gt oq or os ot aw ou bi"><span id="6a0d" class="nq lj it or b gy ov ow l ox oy">$KAFKA_HOME/bin/kafka-console-consumer.sh --from-beginning --bootstrap-server kafka:9092 --topic=test</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pa"><img src="../Images/d8a182f3ac4a057a5c646d89fb017b97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iZOo8m7AAhSMPQe_Ptsueg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">测试消费者</p></figure><p id="f73d" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们可以确认消费者阅读了生产者发布的所有消息。</p></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><h1 id="f349" class="li lj it bd lk ll oi ln lo lp oj lr ls ki ok kj lu kl ol km lw ko om kp ly lz bi translated">介绍浮士德</h1><p id="7483" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated"><a class="ae lh" href="https://github.com/robinhood/faust" rel="noopener ugc nofollow" target="_blank"> Faust </a>是Robinhood开发的流和事件处理框架。Python社区最终分叉了知识库，并诞生了<a class="ae lh" href="https://github.com/faust-streaming/faust" rel="noopener ugc nofollow" target="_blank">浮士德流</a>。在这篇文章的整个过程中，我们将使用浮士德流。</p><p id="caf7" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">《浮士德》背后的概念相对简单，并且很大程度上基于《T4》和《卡夫卡》背后的思想。Faust使用异步编程，然后要求Python版本≥ 3.6.0(由于async/await关键字)。</p></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><p id="b834" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">快速提示:对于异步和并发编程的技能复习者，请随意查看这些文章。</p><div class="pb pc gp gr pd pe"><a rel="noopener follow" target="_blank" href="/introduction-to-asynchronous-programming-in-python-3cd190748cd5"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd jd gy z fp pj fr fs pk fu fw jc bi translated">Python异步编程简介</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">编写更具响应性和性能的程序指南</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">towardsdatascience.com</p></div></div><div class="pn l"><div class="po l pp pq pr pn ps lb pe"/></div></div></a></div><div class="pb pc gp gr pd pe"><a rel="noopener follow" target="_blank" href="/introduction-to-concurrency-in-python-a3ad6aa8b2d1"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd jd gy z fp pj fr fs pk fu fw jc bi translated">Python中的并发性介绍</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">加速Python代码的指南</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">towardsdatascience.com</p></div></div><div class="pn l"><div class="pt l pp pq pr pn ps lb pe"/></div></div></a></div></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><p id="7419" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">浮士德背后的主要概念是:</p><ol class=""><li id="7b46" class="nb nc it mc b md mw mg mx mj nd mn ne mr nf mv ng nh ni nj bi translated">浮士德应用程序——实例化浮士德并连接到我们的卡夫卡经纪人。</li><li id="272e" class="nb nc it mc b md nl mg nm mj nn mn no mr np mv ng nh ni nj bi translated">代理—创建流处理器。代理是一个<strong class="mc jd">异步定义</strong>函数。我们使用<strong class="mc jd"> @app.agent </strong>装饰器来定义代理。</li></ol><p id="25be" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们可以使用以下命令通过pip安装Faust:</p><pre class="ks kt ku kv gt oq or os ot aw ou bi"><span id="ca8a" class="nq lj it or b gy ov ow l ox oy">pip install faust-streaming</span></pre><h1 id="39a2" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">构建我们的第一个浮士德应用程序</h1><p id="093e" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">运行浮士德应用程序非常简单。让我们在<strong class="mc jd"> myapp.py </strong>中构建我们的第一个应用。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="df22" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们可以使用以下工具运行我们的应用程序:</p><pre class="ks kt ku kv gt oq or os ot aw ou bi"><span id="bba7" class="nq lj it or b gy ov ow l ox oy">faust -A myapp worker -l info</span></pre><p id="cef4" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">这将启动myapp的Worker实例(由Faust处理)。日志<strong class="mc jd"> <em class="nk"> Worker ready </em> </strong>表示Worker已经成功启动并准备开始处理流。</p><p id="16ab" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">这个应用程序将每5秒钟向我们的测试Kafka主题发送一条消息，并让代理实时消耗它，并为我们打印出来。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pu"><img src="../Images/910e24765dd18e7ae437a6518e1aab4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YlE6M2LTwZTHk0jHOf2Oyg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">运行我们的第一个Faust应用程序的示例输出</p></figure><p id="c15a" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">让我们开始一点一点地剖析代码。</p><h2 id="45a1" class="nq lj it bd lk nr ns dn lo nt nu dp ls mj nv nw lu mn nx ny lw mr nz oa ly iz bi translated">浮士德应用程序</h2><pre class="ks kt ku kv gt oq or os ot aw ou bi"><span id="9df6" class="nq lj it or b gy ov ow l ox oy">app = faust.App<em class="nk">(</em>'myapp', broker='kafka://localhost:9092'<em class="nk">)</em></span></pre><p id="58b7" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">在这里，我们为我们的应用程序命名(这也将用于创建Kafka消费群),并指定我们的Kafka经纪人的位置。假设您和我一起遵循本指南，您不需要更改代理设置。当然，如果您有不同的代理URL，请指定它们！</p><p id="4f5f" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">这些是《浮士德》入门所需的最低参数。app参数的完整列表可以在<a class="ae lh" href="https://faust.readthedocs.io/en/latest/userguide/application.html#application-parameters" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="ecfa" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们还使用<strong class="mc jd"> app.topic() </strong>函数指定我们想要使用的主题。我们传入参数<strong class="mc jd"> value_type </strong>来强制消息结构。该参数主要用于向Kafka主题发送消息。如果我们不需要强制任何消息类型，我们可以将<strong class="mc jd"> value_type </strong>设置为使用<em class="nk">字节</em>(<strong class="mc jd">value _ type = bytes</strong>)。</p><p id="387d" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">可以通过创建一个Python类来实现消息类型，该类扩展了类<strong class="mc jd"> faust。记录</strong>。</p><h2 id="12ea" class="nq lj it bd lk nr ns dn lo nt nu dp ls mj nv nw lu mn nx ny lw mr nz oa ly iz bi translated">代理人</h2><p id="363a" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">我们通过使用<strong class="mc jd">@ app . agent<em class="nk">()</em></strong><em class="nk"/>装饰器<em class="nk">来表示一个函数是浮士德代理。</em>我们传递希望代理订阅的主题，作为装饰器的一部分。</p><p id="13be" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">代理应该总是协程。因此，我们应该使用<strong class="mc jd"> async def </strong>关键字来定义代理函数。</p><p id="f112" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">因为我们的代理订阅了一个主题，所以我们需要一个异步循环来检查流中的消息。我们通过对关键字使用<strong class="mc jd">异步来做到这一点。</strong></p><p id="19ee" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">在这个for循环中，我们现在可以访问代理使用的每一条消息。在这里，我们可以开始实现我们的流处理逻辑。</p><p id="1517" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">除了为代理订阅Kafka主题之外，我们还可以让代理发布一些Kafka主题的消息。代理装饰器接受一个参数——<strong class="mc jd">sink</strong>——它定义了用于发布消息的Kafka主题。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="2deb" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">在上面的例子中，我们将目标主题作为接收器传递给代理(在本例中，是我们用于源的相同测试主题)。在消费第一条消息(如上所示，我们可以通过生产者发送)时，代理将开始执行异步循环中的逻辑。</p><p id="db4c" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们正在向接收器/目的地主题发出另一条消息。在我们的例子中，目的主题与源主题相同，模拟了我们的Kafka主题中不断接收消息的行为。</p><h2 id="479c" class="nq lj it bd lk nr ns dn lo nt nu dp ls mj nv nw lu mn nx ny lw mr nz oa ly iz bi translated">成批处理</h2><p id="d8ed" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">代理还为我们提供了批量处理任何Kafka流的能力。我们可以通过<strong class="mc jd"> stream.take() </strong>函数实现这种行为。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="7441" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated"><strong class="mc jd"> take() </strong>函数接受两个参数:</p><ul class=""><li id="dbe1" class="nb nc it mc b md mw mg mx mj nd mn ne mr nf mv pv nh ni nj bi translated"><em class="nk">最大_ — </em>批量消息的最大数量</li><li id="2605" class="nb nc it mc b md nl mg nm mj nn mn no mr np mv pv nh ni nj bi translated">在-等待接收max_ messages的超时时间</li></ul></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><p id="e6f7" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们在例子中还使用了另一个应用装饰器— <strong class="mc jd"> @app.timer <em class="nk"> ( </em>间隔=5.0 <em class="nk"> ) </em> </strong>。这是一个与代理类似的协程，但是它没有订阅任何Kafka流或主题。取而代之的是，这个协程将在每个间隔被触发(在我们的例子中，我们将间隔设置为5秒)。</p><p id="d209" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">这些装饰器被称为动作。你可以在这里找到已接受行动的完整列表<a class="ae lh" href="https://faust.readthedocs.io/en/latest/userguide/application.html#id3" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="eab3" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们可以在应用程序中定义多个动作(就像我们的例子中所做的那样)。</p></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><h1 id="235f" class="li lj it bd lk ll oi ln lo lp oj lr ls ki ok kj lu kl ol km lw ko om kp ly lz bi translated">项目结构</h1><p id="5e58" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">在我们的例子中，我们用一个python脚本编写了整个Faust应用程序。对于生产代码或更复杂的应用程序，最好将我们的项目结构组织成适当的层次结构。</p><p id="fcff" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">浮士德建议大型项目采用以下项目结构:</p><pre class="ks kt ku kv gt oq or os ot aw ou bi"><span id="4ef0" class="nq lj it or b gy ov ow l ox oy">+ proj/<br/>    - setup.py<br/>    - MANIFEST.in<br/>    - README.rst<br/>    - setup.cfg</span><span id="f6d3" class="nq lj it or b gy pw ow l ox oy">    + proj/<br/>        - __init__.py<br/>        - __main__.py<br/>        - app.py       # APP initialisation and app settings<br/><br/>        + &lt;APP_NAME&gt;/<br/>        -   __init__.py<br/>        -   agents.py  # all agents and actions<br/>        -   models.py  # message structures as python classes<br/>        -   views.py   # all web views</span></pre><p id="72f4" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">注意:使用这种结构，我们将在不同的模块中有几个代理和其他动作装饰器。要告诉浮士德搜索这些装修工，我们可以将<strong class="mc jd"><em class="nk">auto discover = True</em></strong>选项传递给<strong class="mc jd"> <em class="nk"> app.py </em> </strong>中的浮士德App。</p></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><h1 id="440e" class="li lj it bd lk ll oi ln lo lp oj lr ls ki ok kj lu kl ol km lw ko om kp ly lz bi translated">结论</h1><p id="ed70" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">在本文中，我们讨论了如何在Docker中生成Kafka集群，以及如何使用Faust健壮地处理来自Python的事件流。我们讨论了如何启动一个最小的浮士德应用程序来订阅Kafka流并处理其事件。</p><p id="517c" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">就这些吗？肯定不是。浮士德是一个不断发展的巨大图书馆，还有许多其他惊人的功能。但是现在，我们已经有了开始构建高性能分布式系统的基础。</p><p id="321f" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我强烈建议你阅读一下<a class="ae lh" href="https://faust.readthedocs.io/en/latest/userguide/index.html" rel="noopener ugc nofollow" target="_blank"> Faust文档</a>并继续尝试本库提供的不同功能！</p></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><p id="0ef0" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">你喜欢这篇文章吗？如果是的话，也许你可以考虑成为会员来支持我和你其他喜欢的作家。</p><div class="pb pc gp gr pd pe"><a href="https://david-farrugia.medium.com/membership" rel="noopener follow" target="_blank"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd jd gy z fp pj fr fs pk fu fw jc bi translated">加入我的介绍链接媒体-大卫法鲁吉亚</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">david-farrugia.medium.com</p></div></div><div class="pn l"><div class="px l pp pq pr pn ps lb pe"/></div></div></a></div></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><p id="40c8" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">想给我买杯咖啡吗？</p><div class="pb pc gp gr pd pe"><a href="https://paypal.me/itsdavidfarrugia?country.x=MT&amp;locale.x=en_US" rel="noopener  ugc nofollow" target="_blank"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd jd gy z fp pj fr fs pk fu fw jc bi translated">使用贝宝支付大卫法鲁吉亚。我</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">如果您接受cookies，我们将使用它们来改善和定制您的体验，并使我们的合作伙伴能够向您展示…</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">paypal.me</p></div></div><div class="pn l"><div class="py l pp pq pr pn ps lb pe"/></div></div></a></div></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><h1 id="4949" class="li lj it bd lk ll oi ln lo lp oj lr ls ki ok kj lu kl ol km lw ko om kp ly lz bi translated">想联系吗？</h1><p id="8ee2" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">我很想听听你对这个话题的想法，或者任何关于Python和AI的想法。如果你想联系我，请发邮件到davidfarrugia53@gmail.com给我。</p><p id="f0b0" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated"><a class="ae lh" href="https://www.linkedin.com/in/david-farrugia/" rel="noopener ugc nofollow" target="_blank">Linkedin</a>——<a class="ae lh" href="https://twitter.com/davidfarrugia53" rel="noopener ugc nofollow" target="_blank">Twitter</a></p></div></div>    
</body>
</html>