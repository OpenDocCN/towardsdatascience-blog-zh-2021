<html>
<head>
<title>How to Create a Web App in Minutes that Makes Predictions and Explains them</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在几分钟内创建一个Web应用程序，进行预测并解释它们</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-a-web-app-in-minutes-that-makes-predictions-and-explains-them-31b7d1a54b3a?source=collection_archive---------23-----------------------#2021-03-18">https://towardsdatascience.com/how-to-create-a-web-app-in-minutes-that-makes-predictions-and-explains-them-31b7d1a54b3a?source=collection_archive---------23-----------------------#2021-03-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/e0678c06ee9ebd5343ee934e4988bb32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W_XYtEVVJSN4IKIowsfIOA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图片作者。</p></figure><div class=""/><div class=""><h2 id="a627" class="pw-subtitle-paragraph kc je jf bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">数据科学家简明指南。</h2></div><p id="c843" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">本指南向你展示如何快速开发网络应用。这很容易，你很快就能准备好！额外收获是:你学会了如何用简单的英语解释你的预测。因此，即使是朋友和家人也能理解导致这一预测的因素。享受创建自己的网络应用程序！</p><h1 id="4945" class="lq lr jf bd ls lt lu lv lw lx ly lz ma kl mb km mc ko md kp me kr mf ks mg mh bi translated">创建Web应用程序的4个步骤</h1><ol class=""><li id="2b17" class="mi mj jf kw b kx mk la ml ld mm lh mn ll mo lp mp mq mr ms bi translated">数据预处理和模型创建</li><li id="dab1" class="mi mj jf kw b kx mt la mu ld mv lh mw ll mx lp mp mq mr ms bi translated">安装Streamlit并开发web应用程序</li><li id="7cbe" class="mi mj jf kw b kx mt la mu ld mv lh mw ll mx lp mp mq mr ms bi translated">运行web应用程序</li><li id="99c1" class="mi mj jf kw b kx mt la mu ld mv lh mw ll mx lp mp mq mr ms bi translated">部署web应用程序</li></ol><p id="c224" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我将在下面讨论这些步骤。作为奖励，你可以阅读如何向任何人解释这些预测。该代码可在<a class="ae my" href="https://github.com/henniedeharder/mushroom_webapp" rel="noopener ugc nofollow" target="_blank">我的GitHub </a>上获得。你可以<a class="ae my" href="https://share.streamlit.io/henniedeharder/mushroom_webapp" rel="noopener ugc nofollow" target="_blank">查看和测试蘑菇网络应用</a>，我将用它作为例子。</p><h2 id="835b" class="mz lr jf bd ls na nb dn lw nc nd dp ma ld ne nf mc lh ng nh me ll ni nj mg nk bi translated">步骤1:数据预处理和模型创建</h2><p id="6cfd" class="pw-post-body-paragraph ku kv jf kw b kx mk kg kz la ml kj lc ld nl lf lg lh nm lj lk ll nn ln lo lp ij bi translated">一如既往，新的数据科学项目从处理、分析和建模数据开始。这个网络应用程序将根据蘑菇的六个特征来决定蘑菇是否可以食用。数据集包含蘑菇的22个特征。</p><p id="dc05" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在原始数据集中，数据集值是字母。例如，对于气味一栏，“p”表示刺鼻，“a”表示茴香，“n”表示没有，以此类推。不熟悉数据集的人无法理解这些字母。通过使用字典并映射这些值，很容易解决这个问题。通过这样做，字母被它们的含义所取代。我们需要这一步用于web应用程序侧边栏和解释预测。现在，我们可以对列进行标签编码并构建一个模型。</p><p id="5adc" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">通过训练和评估不同的模型和预处理数据集，确定最重要的特征。这些特征是孢子印的颜色、气味、鳃的大小、栖息地、种群、茎根和瘀伤。使用标签编码的数据集很容易创建一个完美的预测模型，web应用程序中使用的模型达到了1的精度，即使它只使用了6个特征。</p><p id="4291" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我希望作为数据科学家的你熟悉这个步骤，你可以在这里找到代码<a class="ae my" href="https://github.com/henniedeharder/mushroom_webapp/blob/master/train.py" rel="noopener ugc nofollow" target="_blank"/>。我用pickle保存了模型，所以我们可以在下一步中使用它。</p><h2 id="dd0e" class="mz lr jf bd ls na nb dn lw nc nd dp ma ld ne nf mc lh ng nh me ll ni nj mg nk bi translated">步骤2:安装Streamlit并开发web应用程序</h2><p id="ade5" class="pw-post-body-paragraph ku kv jf kw b kx mk kg kz la ml kj lc ld nl lf lg lh nm lj lk ll nn ln lo lp ij bi translated">Streamlit 是一个很棒的开源库，它可以在几分钟内构建一个web应用程序！安装通过<code class="fe no np nq nr b">pip install streamlit</code>进行，如果你想看演示，你可以运行<code class="fe no np nq nr b">streamlit hello</code>。将会打开一个浏览器，您可以选择一个演示并检查源代码。</p><p id="5ea3" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们继续蘑菇app。我们要做的第一件事是编写标题、副标题、边栏和按钮:</p><figure class="nt nu nv nw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ns"><img src="../Images/82316568787253a13fa2d2934993331e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JJqK3B1b1ZMwnhPR2qkQXQ.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">打开浏览器后的开始屏幕:标题，带有选项和三个按钮的侧边栏。图片作者。</p></figure><p id="cd96" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">您可以在侧边栏中指定蘑菇，当您按下Send时，预测和解释会弹出。“信息”按钮提供了关于应用程序的更多信息,“可视化”按钮显示了降维后的数据集图。开始了。</p><p id="15d5" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们首先创建一个新的py文件。首先，让我们导入必要的库来开始。对于网络应用来说，最重要的是<code class="fe no np nq nr b">import streamlit as st</code>。我们还将使用在第一步中创建的脚本中的函数。这是预处理数据集所必需的。</p><p id="a41d" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们使用在步骤1中创建的脚本中的函数<code class="fe no np nq nr b">load_and_transform_mushroom_data()</code>加载和转换数据。该函数返回翻译后的数据帧<code class="fe no np nq nr b">df</code>、我们需要进行预测的列列表<code class="fe no np nq nr b">used_cols</code>和标签编码器<code class="fe no np nq nr b">encoder</code>。</p><p id="ded8" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">现在我们可以开始使用Streamlit构建web应用程序了！用Streamlit编码真的很简单。</p><pre class="nt nu nv nw gt nx nr ny nz aw oa bi"><span id="68f1" class="mz lr jf nr b gy ob oc l od oe">st.write("""## **MUSHROOM EDIBILITY METER** """)<br/>st.write("""Is your mushroom edible? Let's find out! Specify the mushroom on the left and press Send.""")</span></pre><p id="0a92" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这些行显示屏幕上的文本:</p><figure class="nt nu nv nw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi of"><img src="../Images/dfb27ea9ea1740fecb4624e605cebde3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WofHTXgUGXwhVv1m8JJK6g.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">标题和副标题。图片作者。</p></figure><p id="8dd4" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在那里！app的开头！很简单，对吧？</p><p id="444d" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">让我们继续边栏选项。我们需要具有唯一值的六列，以使模型能够计算预测。通过下面的代码，我们可以做到这一点。</p><pre class="nt nu nv nw gt nx nr ny nz aw oa bi"><span id="dab5" class="mz lr jf nr b gy ob oc l od oe"># create sidebar<br/>opts = []</span><span id="d4db" class="mz lr jf nr b gy og oc l od oe">for col in used_cols:<br/>    option = st.sidebar.selectbox(f'{col}', df[col].unique())<br/>    opts.append(option)</span></pre><p id="ab77" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">通过这样做，我们得到了一个列表<code class="fe no np nq nr b">opts</code>，它存储了从那时起所有被选中的选项。仅此而已！当我们用Streamlit再次运行脚本时，侧栏是可见的:</p><figure class="nt nu nv nw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oh"><img src="../Images/bebd9464410fd0cedd633cb9f5c8bd1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UuFpzCqXIK38c07TEG32Tg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">侧边栏，检查！图片作者。</p></figure><p id="8277" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">按钮有点难，因为我们希望它们彼此相邻。Streamlit允许使用<code class="fe no np nq nr b">beta_columns</code>创建列。在代码中:</p><pre class="nt nu nv nw gt nx nr ny nz aw oa bi"><span id="c390" class="mz lr jf nr b gy ob oc l od oe">col1, col2, col3 = st.beta_columns([0.1,0.09, 1])</span><span id="7395" class="mz lr jf nr b gy og oc l od oe">with col1:<br/>    send = st.button('Send')</span><span id="8836" class="mz lr jf nr b gy og oc l od oe">with col2:<br/>    info = st.button('Info')</span><span id="c9f8" class="mz lr jf nr b gy og oc l od oe">with col3:<br/>    visual = st.button('Visualization')</span></pre><figure class="nt nu nv nw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ns"><img src="../Images/82316568787253a13fa2d2934993331e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JJqK3B1b1ZMwnhPR2qkQXQ.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图片作者。</p></figure><p id="75d2" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">如果一个人点击按钮，变量<code class="fe no np nq nr b">send</code>、<code class="fe no np nq nr b">info</code>和<code class="fe no np nq nr b">visual</code>等于<code class="fe no np nq nr b">True</code>。我们希望当有人点击发送时显示预测和解释，当有人点击信息时显示关于应用程序的一些信息。可视化按钮显示用原始数据集的<a class="ae my" href="https://umap-learn.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> UMAP </a>和<a class="ae my" href="https://plotly.com/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>制作的降维图。</p><p id="6674" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">让我们从预测和解释开始。我们使用存储侧边栏当前值的<code class="fe no np nq nr b">opts</code>列表，并用一行和这些值创建一个dataframe。然后我们加载模型，得到预测。下面几行解释了这个预测(稍后会有更多的信息)并创建了一个matplotlib图，这个图将用<code class="fe no np nq nr b">st.pyplot(fig)</code>来绘制。</p><p id="ed07" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">点击“发送”后，会检查可食用性得分是否高于0.5。如果是这种情况，蘑菇将得到标签可食用(否则有毒)，这将被打印到屏幕上。</p><pre class="nt nu nv nw gt nx nr ny nz aw oa bi"><span id="6bd3" class="mz lr jf nr b gy ob oc l od oe"># create dataframe with selected values<br/>new_mush = pd.DataFrame([opts], columns=used_cols)</span><span id="d06e" class="mz lr jf nr b gy og oc l od oe"># get prediction<br/>model = load_model(model_filename='mushroom.h5')<br/>pred = predict(model, new_mush, encoder)</span><span id="b164" class="mz lr jf nr b gy og oc l od oe"># get explanation<br/>new = encoder.transform(new_mush)<br/>shap_df = get_explanations(new, model)<br/>interpretation = create_interpret_df(shap_df, new, new_mush)<br/>fig, ax = plot_interpretation(interpretation)</span><span id="1d91" class="mz lr jf nr b gy og oc l od oe"># clicking the send button<br/>if send:<br/>    if pred.loc['edible','score'] &gt; 0.5:<br/>        result = 'edible'<br/>    else:<br/>        result = 'poisonous'<br/>    prob = round(pred.loc['edible','score']*100)<br/>    st.write(f"""This mushroom is **{result}**!  \nEdibility score: **{str(prob)}**""")<br/>    st.pyplot(fig)</span></pre><p id="78f9" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">按发送时的结果:</p><figure class="nt nu nv nw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oi"><img src="../Images/39259af611a4005f07a38ae9cd0777f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZMkJGLAynozWbAWLeXu7Jw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图片作者。</p></figure><p id="c6de" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">信息按钮将显示一些关于应用程序的信息。我们将显示一个图像并键入一些文本。</p><pre class="nt nu nv nw gt nx nr ny nz aw oa bi"><span id="a235" class="mz lr jf nr b gy ob oc l od oe"># clicking the info button<br/>if info:<br/>    size = 128, 128<br/>    mush = Image.open('img/mush.jpg')<br/>    mush.thumbnail(size, Image.ANTIALIAS)<br/>    st.image(mush)<br/>    st.write('With this app you can test whether a mushroom is poisonous or edible.  \n You can specify the mushroom in the sidebar and press send.  \n The six characteristics are identified as most important in predicting the edibility of mushrooms.  \nThe model is validated and was 100 percent accurate.')<br/>    st.write('The explanations are from shap. Green specs contribute in a positive way to edibility, while red ones make the mushroom less edible.')<br/>    st.write('*Use at your own risk!*')    <br/>    st.write('&amp;#169 Hennie de Harder, 2021')</span></pre><p id="e861" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">按下Info时，您会看到:</p><figure class="nt nu nv nw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oj"><img src="../Images/bb40ae73a94e39af3cabe4ab8d91c468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wSc36LjY4U_G2HDqaSBtgA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图片作者。</p></figure><p id="310e" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">最后但同样重要的是，可视化按钮。这里我们想要一个交互式图表，显示可食用的(绿点)和有毒的(红点)蘑菇。你可以看到许多小集群。所有的簇只包含绿色或红色的点。不错！这表明，该模型确实很容易将蘑菇归入有毒或可食用组，并解释了为什么该模型具有完美的准确性。如果你熟悉UMAP和普罗特利，你会发现创造这个情节很容易。</p><p id="6be5" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">首先，你需要使用UMAP包进行嵌入。这给了你两个维度。然后，您为绘图和<code class="fe no np nq nr b">hover_data</code>的颜色添加目标标签和原始特征。</p><p id="1e5c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">用Plotly绘图:</p><pre class="nt nu nv nw gt nx nr ny nz aw oa bi"><span id="df9f" class="mz lr jf nr b gy ob oc l od oe"># use embedding and <br/>fig = px.scatter(df_emb, x='0', y='1', hover_data=[col for col in df_emb.columns if col not in ['0', '1', 'poisonous']], color='poisonous', color_continuous_scale=[(0.00, "green"),(0.5, "green"),(0.5, "red"),  (1.00, "red")])</span><span id="4a24" class="mz lr jf nr b gy og oc l od oe"># change layout<br/>fig.update_layout(coloraxis_showscale=False)<br/>fig.update_xaxes(ticklabelposition="inside", title_text="Dimension 0")<br/>fig.update_yaxes(ticklabelposition="inside", title_text="Dimension 1")</span></pre><figure class="nt nu nv nw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ok"><img src="../Images/e1937e411e8b6641f336bfe7684de9e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*alah5FsUHQBLR30vdrkaVA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图片作者。</p></figure><p id="7403" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">看起来没问题，让我们继续下面的步骤！</p><h2 id="4089" class="mz lr jf bd ls na nb dn lw nc nd dp ma ld ne nf mc lh ng nh me ll ni nj mg nk bi translated">步骤3:运行web应用程序</h2><p id="5e4b" class="pw-post-body-paragraph ku kv jf kw b kx mk kg kz la ml kj lc ld nl lf lg lh nm lj lk ll nn ln lo lp ij bi translated">使用pip安装Streamlit(步骤2)后，您可以通过键入<code class="fe no np nq nr b">streamlit run streamlit_app.py</code>运行您的web应用程序。</p><p id="cdb8" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">浏览器会自动打开，您的应用程序会变得可见。测试新代码真的很容易，当你做了一些改变，你可以保存你的文件并按下任何按钮。该应用程序将使用新的代码(每次有变化时都会重新运行文件)。</p><h2 id="f8c3" class="mz lr jf bd ls na nb dn lw nc nd dp ma ld ne nf mc lh ng nh me ll ni nj mg nk bi translated">步骤4:部署web应用程序</h2><p id="2ca5" class="pw-post-body-paragraph ku kv jf kw b kx mk kg kz la ml kj lc ld nl lf lg lh nm lj lk ll nn ln lo lp ij bi translated">Streamlit使部署变得非常简单。如果你去他们的网站，你可以在streamlit.io/sharing T2申请邀请。收到邀请后，就可以部署web应用程序了。将您的Streamlit应用程序放在GitHub上，并创建一个requirements.txt文件。登录<a class="ae my" href="http://share.streamlit.io" rel="noopener ugc nofollow" target="_blank"> share.streamlit.io </a>，用GitHub登录。</p><p id="f07a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">您可以开始部署了！按下新建应用程序，指定repo、分支和文件路径，然后单击部署。</p><p id="4072" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">如果您的分支是master，并且您的应用程序的文件名为streamlit_app.py，您可以在以下位置找到您的应用程序</p><p id="9dd0" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><code class="fe no np nq nr b">https://share.streamlit.io/[user name]/[repo name]</code></p><p id="94b7" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">否则，链接会更长，并添加分支和文件名。</p><p id="4645" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><a class="ae my" href="https://share.streamlit.io/henniedeharder/mushroom_webapp" rel="noopener ugc nofollow" target="_blank">蘑菇app </a>已部署，您可以亲自试用！</p></div><div class="ab cl ol om hu on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="ij ik il im in"><h2 id="39d9" class="mz lr jf bd ls na nb dn lw nc nd dp ma ld ne nf mc lh ng nh me ll ni nj mg nk bi translated">额外收获:如何创建可理解的解释？</h2><p id="dd1f" class="pw-post-body-paragraph ku kv jf kw b kx mk kg kz la ml kj lc ld nl lf lg lh nm lj lk ll nn ln lo lp ij bi translated">怎么才能得到花里胡哨的解说栏剧情？这个模型有六个特征，气味、鳃大小、瘀伤、种群、栖息地和孢子印颜色。所有特征及其特征值都易于理解，并以其自己的方式对预测做出贡献。</p><figure class="nt nu nv nw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi os"><img src="../Images/a4e338a155d41a2d1bb769c10d90982c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z202kIIuuf6P53dl5NSMTA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">条形图:解释预测。红色条对可食用性有负面影响，而绿色条对可食用性有正面影响。在这种情况下，只有“孢子印颜色是黑色的”对这种蘑菇的可食用性有积极的贡献。其他特征增加了蘑菇有毒的可能性。图片作者。</p></figure><p id="be80" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">shap库是一个解释机器学习模型的好工具。它使用博弈论和局部解释来决定特征值对最终预测的贡献。有更多的可解释性技术可用，但shap有一些很大的优势，例如，它是模型不可知的，你可以局部和全局地解释模型。</p><p id="2809" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">蘑菇模型的整体解释:</p><figure class="nt nu nv nw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ot"><img src="../Images/e49e602f6c912b07fa6d74b665d19ed2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X2QEiGlpPCkR11hEAoTA9g.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">蘑菇模型的Shap总结。高特征值为红色，低特征值为蓝色。如果SHAP值为正，将增加预测得分，否则将减少预测得分。该模型被训练来预测蘑菇是否有毒，因此y轴右侧的点将导致蘑菇有毒！图片作者。</p></figure><p id="d041" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">局部解释稍微复杂一点，但是我们可以使用shap值来创建易于理解的条形图(带有绿色和红色条)。</p><p id="b7d4" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">从获取形状值数据帧开始。我们需要蘑菇的模型和数据来获得shap值。</p><pre class="nt nu nv nw gt nx nr ny nz aw oa bi"><span id="0629" class="mz lr jf nr b gy ob oc l od oe">explainer = shap.TreeExplainer(model)<br/>shap_values = explainer.shap_values(new)<br/>shap_df = pd.DataFrame(shap_values, columns=new.columns)</span></pre><p id="5521" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">下一步是创建一个包含解释的数据框架。</p><figure class="nt nu nv nw gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ou"><img src="../Images/22e9a2a97830e412c4d7c5958ad3d47f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*wqBzhmqckFJidc-p9r_Hpg.png"/></div></div></figure><p id="0f1a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">您可以看到形状值、特征名称、特征值、这两者的组合以及颜色。数据帧按shap值降序排序。这就是我们创建条形图所需的全部内容！</p><p id="b4d3" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在代码中:</p><pre class="nt nu nv nw gt nx nr ny nz aw oa bi"><span id="897b" class="mz lr jf nr b gy ob oc l od oe"># creating the interpretation DataFrame<br/># only using top 3 features with highest and lowest shap value<br/>name = []<br/>shap_values = []<br/>feature_names = []</span><span id="2c53" class="mz lr jf nr b gy og oc l od oe">for i in range(len(shap_df)):<br/>    name += [new.index[i]] * 6<br/>    shap_values += sorted(list(np.array(shap_df.iloc[i])), reverse=True)[:3] + sorted(list(np.array(shap_df.iloc[i])))[:3][::-1]<br/>    feature_names += list(shap_df.columns[np.array(shap_df.iloc[i]).argsort()[::-1][:3]]) + list(shap_df.columns[np.array(shap_df.iloc[i]).argsort()[::][:3][::-1]])<br/>    <br/>interpret = pd.DataFrame({'idx':name, 'shap_value':shap_values, 'feature':feature_names})</span><span id="4bfc" class="mz lr jf nr b gy og oc l od oe">interpret['shap_value'] = interpret['shap_value'] * -1<br/>interpret = interpret.sort_values(by='shap_value', ascending=False)</span><span id="301a" class="mz lr jf nr b gy og oc l od oe">def get_value(row):<br/>    return new_mush[new_mush.index == row.idx] [row['feature']].values[0]</span><span id="2162" class="mz lr jf nr b gy og oc l od oe">interpret['feature_value'] = interpret.apply(get_value, axis=1)</span><span id="e485" class="mz lr jf nr b gy og oc l od oe">interpret['feature&amp;value'] = interpret.apply(lambda row: row.feature + ' is ' + str(row.feature_value), axis=1)<br/>    <br/>interpret['color'] = np.where(interpret['shap_value'] &gt; 0, 'green', 'red')</span></pre><p id="bded" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这个例子很简单，因为数据很容易解释。如果您有更复杂的特性和特性值，您可以通过使用特性和特性值列将它们的含义转换为更容易理解的含义。您可以对要素及其值应用函数来解释它们。</p><p id="99c3" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">最难的部分已经完成，有了<code class="fe no np nq nr b">interpret</code>数据框，就可以用matplotlib创建柱状图:</p><pre class="nt nu nv nw gt nx nr ny nz aw oa bi"><span id="eb0f" class="mz lr jf nr b gy ob oc l od oe"># create matplotlib figure<br/>y_pos = np.arange(len(interpret.index))<br/>fig, ax = plt.subplots(figsize=(8,3))</span><span id="7734" class="mz lr jf nr b gy og oc l od oe"># create horizontal bar plot<br/>ax.barh(y_pos, interpret.shap_value.values, align='center', color=interpret.color.values)</span><span id="a06e" class="mz lr jf nr b gy og oc l od oe"># change x and y axis<br/>ax.set_yticks(y_pos)<br/>ax.set_yticklabels(interpret['feature&amp;value'].values)<br/>ax.invert_yaxis()<br/>ax.set_title('Contribution to edibility')<br/>plt.tick_params(axis='x', which='both', bottom=False, top=False,           labelbottom=False)</span><span id="ae01" class="mz lr jf nr b gy og oc l od oe"># add legend<br/>green = mpatches.Patch(color='green', label='Positive contribution')<br/>red = mpatches.Patch(color='red', label='Negative contribution')<br/>plt.legend(handles=[green, red])</span></pre><p id="bc8a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">可以走了！应用程序已创建！</p></div><div class="ab cl ol om hu on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="ij ik il im in"><h1 id="3496" class="lq lr jf bd ls lt ov lv lw lx ow lz ma kl ox km mc ko oy kp me kr oz ks mg mh bi translated">结论</h1><p id="f459" class="pw-post-body-paragraph ku kv jf kw b kx mk kg kz la ml kj lc ld nl lf lg lh nm lj lk ll nn ln lo lp ij bi translated">在这个时代，开发自己的web应用程序真的很容易！你所需要的只是一台电脑，一个IDE，Python，一个互联网连接和数据！这篇文章只是一个例子，我希望你的想象力能带你走得更远，让你开发更酷的应用程序！</p></div><div class="ab cl ol om hu on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="ij ik il im in"><p id="45a6" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><em class="pa">别忘了</em> <a class="ae my" href="https://hennie-de-harder.medium.com/subscribe" rel="noopener"> <em class="pa">订阅</em> </a> <em class="pa">如果你想在我发表新文章时收到电子邮件。</em> ❤</p></div></div>    
</body>
</html>