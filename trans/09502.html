<html>
<head>
<title>Generating Synthetic Multivariate Data with Copulas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Copulas生成综合多元数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/generating-synthetic-multivariate-data-with-copulas-edd1c4afa1bb?source=collection_archive---------17-----------------------#2021-09-03">https://towardsdatascience.com/generating-synthetic-multivariate-data-with-copulas-edd1c4afa1bb?source=collection_archive---------17-----------------------#2021-09-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a182" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建更多与您的数据具有相同要素依赖关系的数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0bf98eba02fe27034c810a2901b20cf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pcmWs94-whI-qtop"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">五月在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的<a class="ae ky" href="https://unsplash.com/@may_paulin09?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"/></p></figure><p id="82fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di"> A </span> Copula是多元累积分布函数，其中每个变量的边际概率分布在区间[0，1]上是均匀的。</p><blockquote class="me"><p id="e677" class="mf mg it bd mh mi mj mk ml mm mn lu dk translated">但是这到底是什么意思呢？</p></blockquote><p id="1548" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">当您需要对多元分布的依赖结构进行建模时，可以使用Copulas。例如，<strong class="lb iu">在金融中经常使用</strong>来捕捉多个时间序列之间的依赖结构。然而，copulas在非平稳数据上不是很好定义的。</p><p id="9abf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Copulas用于模拟随机变量之间的相关性。Copulas的基础是围绕Sklar定理展开的。</p><h2 id="5dc4" class="mt mu it bd mv mw mx dn my mz na dp nb li nc nd ne lm nf ng nh lq ni nj nk nl bi translated"><strong class="ak">斯克拉尔定理:</strong></h2><p id="c9f4" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">任何多元联合分布都可以用一元边际分布函数和描述变量相关结构的copula来表示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/2b7f22c30bdad7b17420157f8f1fe290.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JqgkZzh3uNiOcKvmGemJ2A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Sklar定理(作者供图)</p></figure><p id="2937" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是什么意思？这意味着数据的多元联合分布可以使用边际和Copula进行建模。</p><p id="db33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好吧，当然，但我为什么要知道这个？为什么理解多元联合分布有帮助？</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="f8fe" class="nz mu it bd mv oa ob oc my od oe of nb jz og ka ne kc oh kd nh kf oi kg nk oj bi translated">生成多元数据</h1><p id="046a" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">在python中为单个变量创建概率密度函数非常容易。例如，Scipy的函数“rv_histogram”生成一个概率分布，您可以根据一些数据从中进行采样。</p><p id="f851" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面我有一个这样做的例子。首先，我使用虹膜数据集中带有“萼片长度”的NumPy直方图生成一个直方图。接下来，使用‘RV _ histogram’函数，我从直方图中创建一个概率分布。最后，利用这种分布，对100个值进行采样，并与原始数据集进行比较。</p><pre class="kj kk kl km gt ok ol om on aw oo bi"><span id="02bc" class="mt mu it ol b gy op oq l or os">import scipy.stats<br/>import numpy as np<br/>import matplotlib.pyplot as plt</span><span id="8d5f" class="mt mu it ol b gy ot oq l or os">bins= 40<br/>hist = np.histogram(df[cols[0]], bins=bins)<br/>hist_dist = scipy.stats.rv_histogram(hist)<br/>synthetic_data = hist_dist.rvs(size=100)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/d76104d35481a90d73efb9b233a5cf42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*G7wyZlmYIyYqfl6CH9cZnA.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建萼片长度的概率分布(作者照片)</p></figure><p id="33f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是当你想生成多元数据的时候呢？</p><p id="3bb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望很明显，为每个特征创建数据并将其组合是非常有缺陷的。这里我们可以使用'<strong class="lb iu"> Copulas </strong>'，专门研究Copulas的python库。这个库提供了相关的函数来为你所拥有的数据创建一个copula。<strong class="lb iu">copula表示每个特征之间的依赖关系。</strong></p><p id="9124" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用分类任务，可以在类级别上生成数据。在下面的代码块中，根据每个类的分布开发了不同的多元数据分布。最后，使用这些分布创建新的合成数据。</p><pre class="kj kk kl km gt ok ol om on aw oo bi"><span id="5dc0" class="mt mu it ol b gy op oq l or os">def generate_multivariate_data(df, dist, samples=50):<br/>    df_sample = pd.DataFrame({})<br/>    for t in df['target'].unique():<br/>        dist.fit(df[df['target']==t].drop(['target'],axis=1))<br/>        sampled = dist.sample(samples)<br/>        sampled['target'] = t<br/>        df_sample = df_sample.append(sampled)<br/>    return df_sample</span></pre><p id="7a00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">copula软件包提供了一些有用的可视化工具来比较实际数据和生成的数据。但是，它不支持给每个类添加颜色。</p><p id="1258" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经调整了GitHub的功能，为每个职业保留了一个彩色地图。以下两个函数为实际数据和合成数据创建了两个3D散点图。</p><pre class="kj kk kl km gt ok ol om on aw oo bi"><span id="be6b" class="mt mu it ol b gy op oq l or os">from copulas.multivariate import GaussianMultivariate</span><span id="9e30" class="mt mu it ol b gy ot oq l or os">def scatter_3d_color(data, columns=None, fig=None, title=None, position=None):<br/>    """Plot 3 dimensional data in a scatter plot."""<br/>    fig = fig or plt.figure()<br/>    position = position or 111<br/>    ax = fig.add_subplot(position, projection='3d')<br/>    ax.scatter(*(<br/>        data[column] for column in columns or data.columns<br/>    ), c=color_indices, cmap=colormap)<br/>    if title:<br/>        ax.set_title(title)<br/>        ax.title.set_position([.5, 1.05])<br/>    return ax</span><span id="4e54" class="mt mu it ol b gy ot oq l or os">def compare_3d_color(real, synth, columns=None, figsize=(10, 4)):<br/>    columns = columns or real.columns<br/>    fig = plt.figure(figsize=figsize)<br/>    scatter_3d_color(<br/>        real[columns], fig=fig, <br/>        title='Real Data', position=121<br/>    )<br/>    scatter_3d_color(<br/>        synth[columns], fig=fig, <br/>        title='Synthetic Data', position=122<br/>    )<br/>    plt.tight_layout()</span><span id="053d" class="mt mu it ol b gy ot oq l or os">colors = ["blue", "green", "purple"]<br/>color_indices = [0]*50 + [1]*50 + [2]*50<br/>colormap = matplotlib.colors.ListedColormap(colors)</span><span id="84c6" class="mt mu it ol b gy ot oq l or os"><br/>dist=GaussianMultivariate()<br/>df_s = generate_multivariate_data(df, dist)<br/>compare_3d_color(df[cols[0:3]], df_s[cols[0:3]])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/eebd12829580dcb47db49bcf53f5cece.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IAVegh1WorwtiPg861ze_A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">高斯多元Copula(作者供图)</p></figure><p id="cb13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果每个特征的单变量分布是已知的，则这些分布被传递到Copula中。随后的数据样本用单变量高斯分布估计分布。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/101940045c9c0704dacba13df27ef0fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ye-dHFkpE-sODwdafvQmRg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">高斯单变量Copula(作者供图)</p></figure><p id="6e2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，准确地确定数据的分布是相当具有挑战性的。</p><p id="2023" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，Copulas库还为一类分布中的单变量分布估计提供了实用工具。例如，最终图使用参数单变量来生成合成数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/152a2bd1de11aab47c58744da9daa285.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k-_Tb9jDQMhbulu87oY_vQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">参数单变量Copula(作者图片)</p></figure></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="5e67" class="nz mu it bd mv oa ob oc my od oe of nb jz og ka ne kc oh kd nh kf oi kg nk oj bi translated">数据有多好？</h1><p id="67ac" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">为了比较真实数据和合成数据，我使用剪影分数。轮廓分数是对每个聚类被定义得有多好的度量。当真实标签未知时，该分数用于聚类任务。虽然在这种情况下，标签是已知的，但不执行任何预测。因此，我展示了原始数据的侧影得分与合成数据的得分。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/3b3feca8eb25980eb7f58de2f20c7553.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LV2BuPH_bXG13Q5FujIyVQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">剪影评分S(作者照片)</p></figure><p id="cede" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据底层数据的分布，有几种不同的方法来模拟合成数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/0aba0cb840028b256730731c2c23f2ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*awaivDepF_3wd1Zh5o956g.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">剪影评分比较(作者照片)</p></figure><p id="b420" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当剪影得分为1时，聚类的定义最为清晰。然而，即使对于实际数据来说，情况也并非如此。高斯单变量和参数单变量方法得分较高。尽管如此，这里的数据可能不太能代表实际数据。</p><p id="ad5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该过程旨在生成与原始数据集相似的数据。虽然这两种方法表现更好，但多元高斯方法是理想的，因为分数更接近实际数据。目的是模拟实际数据，即使原始数据不是那么可分的。</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="8efe" class="nz mu it bd mv oa ob oc my od oe of nb jz og ka ne kc oh kd nh kf oi kg nk oj bi translated">结论</h1><p id="62dd" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">连接函数是一个迷人的统计函数。对变量之间的依赖结构进行建模的能力对于理解和处理数据是一个有价值的属性。</p><p id="3afa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些函数还能够生成有效模拟预先存在的多元数据的合成数据。当您想要对多元数据建模或创建一些自定义合成数据时，请考虑使用copulas。</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><p id="1a7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有兴趣阅读关于新颖的数据科学工具和理解机器学习算法的文章，可以考虑在Medium上关注我。</p><p id="4f22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="pa">如果你对我的写作感兴趣，想直接支持我，请通过以下链接订阅。这个链接确保我会收到你的会员费的一部分。</em></p><div class="pb pc gp gr pd pe"><a href="https://zjwarnes.medium.com/membership" rel="noopener follow" target="_blank"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd iu gy z fp pj fr fs pk fu fw is bi translated">通过我的推荐链接加入Medium-Zachary Warnes</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">阅读扎卡里·沃恩斯(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">zjwarnes.medium.com</p></div></div><div class="pn l"><div class="po l pp pq pr pn ps ks pe"/></div></div></a></div></div></div>    
</body>
</html>