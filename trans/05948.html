<html>
<head>
<title>MLflow and DVC for open-source reproducible Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向开源可复制机器学习的MLflow和DVC</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/use-mlflow-and-dvc-for-open-source-reproducible-machine-learning-2ab8c0678a94?source=collection_archive---------4-----------------------#2021-05-28">https://towardsdatascience.com/use-mlflow-and-dvc-for-open-source-reproducible-machine-learning-2ab8c0678a94?source=collection_archive---------4-----------------------#2021-05-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8ee2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://dvc.org" rel="noopener ugc nofollow" target="_blank"> DVC </a>和<a class="ae kl" href="https://mlflow.org" rel="noopener ugc nofollow" target="_blank"> MLflow </a>是两个被广泛采用的开源项目，各有所长。DVC擅长数据版本控制，MLflow是多种工具的结合体，但主要用于实验跟踪和工件记录功能。这两个工具都是开源的，但这并不意味着您可以轻松地拥有一个使用它们的开源项目。您无法将使用DVC版本化的数据与开放世界共享，也无法将为您生成的实验页面MLflow显示给所有人-这种情况已不复存在。</p><p id="8c13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://dagshub.com" rel="noopener ugc nofollow" target="_blank"> DAGsHub </a>已经与DVC整合，你可以在<a class="ae kl" href="https://dagshub.com/blog/datasets-should-behave-like-git-repositories/" rel="noopener ugc nofollow" target="_blank">我之前讨论DVC和DAGsHub的文章</a>中了解更多。它现在也与MLflow集成在一起。这意味着MLflow用户现在可以在一致的环境中管理MLflow实验及其代码和数据集。</p><p id="86d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您只对集成细节感兴趣，您可以滚动到下面关于MLflow with DAGsHub的部分。否则，请继续阅读，以获得MLflow的概述、MLflow的一些优势和差距，以及关于DAGsHub和MLflow集成的详细信息</p><h1 id="b2be" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">什么是MLflow</h1><blockquote class="lk ll lm"><p id="c450" class="jn jo ln jp b jq jr js jt ju jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj kk ij bi translated">MLflow是一个管理ML生命周期的开源平台，包括实验、再现性、部署和中央模型注册</p></blockquote><p id="cb81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">GitHub上每天约有60，000次下载，8，000次下载——ml flow是一款开源工具，最初由Databricks推出，自2018年推出以来广受欢迎。它帮助数据科学家管理机器学习生命周期的多个阶段。其中一个阶段是“实验跟踪”——这是一个公认的术语，用来记录模型每次运行时得到的结果的变化。MLflow提供的收集这些实验的解决方案被称为“MLflow Tracking”。其他工具也提供了很好的功能，我推荐阅读这个<a class="ae kl" href="https://dagshub.com/blog/how-to-compare-ml-experiment-tracking-tools-to-fit-your-data-science-workflow/" rel="noopener ugc nofollow" target="_blank">实验跟踪工具对比</a>来更深入地了解它们之间的区别。</p><h1 id="9665" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">MLflow有什么用途，为什么它是实验跟踪的首选解决方案</h1><h1 id="40bc" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">它有最大的社区</h1><p id="2a89" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">一个大型的机器学习从业者和公司社区已经采用MLflow作为解决方案。这通常是一个强有力的指标，表明某个工具正在做正确的事情。一个大的社区意味着更多的教程，更多的在线问答，或者针对用户遇到的常见问题在GitHub上的公开问题。MLflow已经有290个贡献者，据报道有200多家公司在他们的工作流程中使用它，这对这类项目来说意义重大。这提供了一种安全感，MLflow将在未来许多年继续开发和使用</p><h1 id="f2d8" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">简单且开源</h1><p id="d00b" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">开源工具是个人、研究人员和非营利组织的必需品。这为他们提供了免费的解决方案、社区支持和最大的灵活性。MLflow无疑是当前实现这一承诺的先锋之一。跟踪API是精心设计的，具有全面而简单的客户端库，提供简单的手动日志记录功能，如:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="0a37" class="mf kn iq mb b gy mg mh l mi mj"># Start a run<br/>mlflow.start_run()</span><span id="35bb" class="mf kn iq mb b gy mk mh l mi mj"># Log an hyper-param<br/>mlflow.log_param()</span><span id="e244" class="mf kn iq mb b gy mk mh l mi mj"># Log a metric<br/>mlflow.log_metric()</span></pre><p id="379b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它还为大多数常见的高级机器学习框架提供自动日志记录功能，包括Scikit-learn、Tensorflow、Keras、XGBoost、FastAI、PyTorch等。<br/>以Scikit-learn为例:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="80f8" class="mf kn iq mb b gy mg mh l mi mj"># Automatic logging with mlflow<br/>mlflow.sklearn.autolog()</span></pre><p id="2bda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">设置起来相对容易——开始跟踪实验所需要的只是安装一个客户端库(即python库)并在代码中使用日志API调用。</p><p id="353a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要预览实验或比较结果，您需要通过在命令提示符下运行以下命令来启动一个基于web的本地用户界面:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="eeec" class="mf kn iq mb b gy mg mh l mi mj"># Start the mlflow web ui<br/>mlflow ui</span></pre><p id="a5f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在<code class="fe ml mm mn mb b"><a class="ae kl" href="http://localhost:5000." rel="noopener ugc nofollow" target="_blank">http://localhost:5000</a></code> <a class="ae kl" href="http://localhost:5000." rel="noopener ugc nofollow" target="_blank">的浏览器中找到它。</a></p><h1 id="cda6" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">实时跟踪</h1><p id="b4ef" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">“实时”意味着您可以在代码运行时跟踪性能——或任何指标，这在您想要观察损失时特别有用，例如，如果没有收敛，就在中间停止训练。实时日志记录是一把双刃剑，因为它不能保证再现性。这将实验跟踪工具的领域一分为二。有些人——比如ml flow——将跑步训练的开始视为基线。其他人——像<a class="ae kl" href="https://dagshub.com/blog/data-version-control-tools/" rel="noopener ugc nofollow" target="_blank">DVC</a>——在培训结束时将存储库的状态视为需要签入和访问的时间点。</p><h1 id="8a80" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">MLflow缺少什么使其成为显而易见的选择</h1><h1 id="2f39" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">设置远程服务器很难</h1><p id="d753" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">为一个小团队或开源项目设置一个持久的远程服务器在技术上是复杂的，并且可能是昂贵的。</p><p id="5333" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，你需要建立一个在线机器，可以被外界访问，最好有一个可读的、持久的URL。</p><p id="93e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其次，由于您不希望任何人能够查看或记录您的服务器上的实验，您需要管理访问控制。您可以通过支持身份验证的中间服务器来运行您的调用，然后将通信传递给服务器本身。如果您希望能够添加用户、删除用户并提供对项目的公共访问，您需要围绕它构建一个完整的系统。不幸的是，对许多人来说，这些复杂性将是交易的破坏者。如果你最终设法解决了这些问题，你仍然需要向云提供商支付运行机器的费用，你可能不会为你正在写的论文或你的开源人脸检测项目这样做。这就是为什么MLflow实验可能永远不会走出您的本地机器或内部网络。</p><h1 id="0b3d" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">用户界面缺乏灵活性</h1><p id="5cb9" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">Mlflow的用户界面有一个主菜单，您可以在其中选择和切换不同的实验。“实验”是一组“运行”,用户可以将其定义为一个层次结构。您可以决定是为每个项目创建一个实验，还是为同一个项目创建多个实验。您可以选择多个运行并在它们之间进行比较，但不能在不同实验的运行之间进行比较。</p><p id="c244" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于每次运行，您可以选择您记录的图形，并在单独的页面中显示它们，但是您不能在单个摘要页面中一次性预览它们。</p><h1 id="1613" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">缺乏背景和连通性</h1><p id="89d9" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">假设您已经安装了MLflow服务器，并使用它为多个项目记录实验。现在，您想与同事共享项目的状态。您需要给她发送一个指向存储库的链接，一个指向MLflow服务器的链接，并指定这个特定项目的实验内容。另一种常见的情况是，当您想要将您的研究结果发布到工作场所之外的社区时。您需要找到一种方法来应用如前所述的凭证管理，以便只有他们可以查看项目。此外，您的MLflow UI作为整个项目的一部分是不可发现的。您可以在存储库<code class="fe ml mm mn mb b">Readme.md</code>文件中放置一个链接，但是前面提到的访问问题仍然适用。</p><h1 id="8aa7" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">带DAGsHub的MLflow</h1><figure class="lw lx ly lz gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><h1 id="6dc5" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">连接到项目的其余部分</h1><p id="52a5" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">随着MLflow tracking now <a class="ae kl" href="https://dagshub.com/" rel="noopener ugc nofollow" target="_blank">与DAGsHub </a>的集成，您最终可以以一种有意义的方式管理MLflow实验。项目的所有组件现在都已连接。换句话说，您的存储库主页现在将显示您的代码、您的数据管道和您的所有MLflow实验。</p><figure class="lw lx ly lz gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/ea4d0ce8974828e62c4b91005018e021.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bUNSIXu4uuI67Av6"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">按作者</p></figure><p id="5b52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以比较实验，看到一个有趣的实验，并轻松地一键查看生成实验的代码和数据集。正如在谈论MLflow的用户界面时提到的，比较不同实验的运行需要打开两个不同的窗口。现在情况不再是这样了。现在可以比较不同实验的运行，当然，可以在一个地方看到所有的度量图。</p><figure class="lw lx ly lz gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi nc"><img src="../Images/4efd4c60f0c34bfd9f0be2843036fb3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*V7Y5cWZr0A8S1qaZ"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">按作者</p></figure><h1 id="866f" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">最小设置</h1><p id="280e" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">首先，你需要在<a class="ae kl" href="https://dagshub.com/user/sign_up" rel="noopener ugc nofollow" target="_blank">注册</a>，创建一个存储库，并向其中推送代码。然后，在您的存储库主页上，您将获得MLflow的跟踪URI。</p><figure class="lw lx ly lz gt mo gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/839a5f1670c677b900be52793cdc98f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*BMQdhaU260MwwIB3"/></div><p class="my mz gj gh gi na nb bd b be z dk translated">按作者</p></figure><p id="8960" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设您已经熟悉如何使用MLflow 的<a class="ae kl" href="https://www.mlflow.org/docs/latest/quickstart.html" rel="noopener ugc nofollow" target="_blank">，那么您现在要做的就是将这个URI设置为您的跟踪URI，或者使用环境变量<code class="fe ml mm mn mb b">MLFLOW_TRACKING_URI</code>或者在您的代码中添加以下代码行:</a></p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="7818" class="mf kn iq mb b gy mg mh l mi mj"># Set an mlflow remote server programatically <br/>mlflow.set_tracking_uri("https://dagshub.com/&lt;DAGsHub-user-name&gt;/&lt;repository-name&gt;.mlflow")</span></pre><p id="1a30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想要记录参数和指标，您需要拥有对存储库的写权限——也就是成为贡献者。MLflow客户端支持基本认证，为了指定您的凭证，您需要使用环境变量<code class="fe ml mm mn mb b">MLFLOW_TRACKING_USERNAME</code>和<code class="fe ml mm mn mb b">MLFLOW_TRACKING_PASSWORD</code>。</p><p id="ef2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样，你可以记录你的实验，并像这个例子项目一样与公众分享。如果你的知识库是私有的，那么实验当然也是私有的。</p><h1 id="fec2" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">分发您的项目并与任何人共同创作</h1><p id="509b" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">我们在DAGsHub的任务之一是降低开源机器学习生命周期工具的准入门槛。我们在DVC做到了这一点，现在我们正在与MLflow合作。我们让用户决定如何利用他们喜欢的每个方面。我认为，为社区提供一个专业管理工作的解决方案，而不需要DevOps知识，将使开源、可复制的数据科学不仅仅是一个幻想。</p><h1 id="a9ba" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">摘要</h1><p id="ca1c" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">我们已经看到MLflow被广泛采用，它是开源的，并且简单明了，但是如果没有任何DevOps知识，免费使用它会有一些困难。现在，通过使用专用的MLflow远程服务器将MLflow连接到任何存储库，您可以从DAGsHub的实时日志记录中受益。这里有一个关于如何使用MLflow和DAGsHub 的视频链接。如果您有任何问题，或者您希望我们支持更多MLflow功能，请随时通过我们的<a class="ae kl" href="https://discord.com/invite/9gU36Y6" rel="noopener ugc nofollow" target="_blank">社区聊天</a>联系我们。</p></div></div>    
</body>
</html>