<html>
<head>
<title>Making better cheese with IoT and ML</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用IoT和ML制作更好的奶酪</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/making-better-cheese-with-iot-and-ml-5e9cccc63c3f?source=collection_archive---------19-----------------------#2021-09-15">https://towardsdatascience.com/making-better-cheese-with-iot-and-ml-5e9cccc63c3f?source=collection_archive---------19-----------------------#2021-09-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="15b0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><em class="kf">利用低成本物联网和机器学习解决方案优化奶酪制作流程。</em></h2></div><p id="8bd8" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">一家小型奶酪厂希望改进其生产流程，专注于产品质量。关键的焦点是改善冷藏室的温度监控，以保持产品新鲜并延长保质期。</p><p id="a71d" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">以前的质量控制系统需要一个人每四个小时去一次冷藏室，手动从数字显示器上读取温度。这对于正常工作时间的监控很有效，但是对于晚上和周末就不行了。当然，假设四小时内没有任何差错。由于工厂位于农村地区，电力中断经常发生，因此安装了备用发电机。然而，发生了发电机无法启动的情况，这导致了周末的一些产品损失。</p><p id="b622" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">第一阶段侧重于改进监控，这将简要讨论，第二阶段侧重于实现机器学习，这将在本文中详细讨论。</p><h1 id="dfdd" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">阶段1:改进监测</h1><p id="b8d4" class="pw-post-body-paragraph kg kh iq ki b kj lu jr kl km lv ju ko kp lw kr ks kt lx kv kw kx ly kz la lb ij bi translated">该项目的第一步是实施物联网(IoT)解决方案，以提供对冷藏室制冷系统的实时监控。虽然有一些商业物联网解决方案可用，但考虑到传感器、基础设施和云托管费用，成本往往会迅速增加，尤其是对小型工厂而言。</p><blockquote class="lz ma mb"><p id="f4d8" class="kg kh mc ki b kj kk jr kl km kn ju ko md kq kr ks me ku kv kw mf ky kz la lb ij bi translated">更具成本效益的解决方案是定制的物联网设备，利用ESP32微控制器和一些现成的传感器。一个简单的基于web的应用程序被创建并托管在本地PC上。</p></blockquote><p id="7dcd" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">该系统测量冷藏室内部的温度、制冷机组的功耗和外部环境温度。现在，实时温度每30到60秒自动捕获一次，而不是手动进行现场测量，这提供了更一致的监控和对系统运行的更多洞察。</p><p id="534c" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">如果温度超过上限或下限达30分钟，就会发出警报，但是，似乎每隔几个小时就会发出警报，无需人工干预即可恢复正常。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/1dd097948e5d9eb6f95229c1d2b95cab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hs7UQVUxerQqmtImMuUFtg.png"/></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">正常高低限物联网监控系统趋势。<em class="kf">作者图片。</em></p></figure><h1 id="8e8c" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">阶段2:使用数据获得更好的洞察力</h1><p id="df0c" class="pw-post-body-paragraph kg kh iq ki b kj lu jr kl km lv ju ko kp lw kr ks kt lx kv kw kx ly kz la lb ij bi translated">物联网解决方案的实施提供了改进的监控和大量的实时数据，这是以前所没有的。该项目的下一阶段是实施更高级的分析，即使用生成的数据，以更好地了解过程和系统操作。</p><h2 id="acfc" class="ms ld iq bd le mt mu dn li mv mw dp lm kp mx my lo kt mz na lq kx nb nc ls nd bi translated">三个关键业务需求</h2><p id="c73d" class="pw-post-body-paragraph kg kh iq ki b kj lu jr kl km lv ju ko kp lw kr ks kt lx kv kw kx ly kz la lb ij bi translated">1.怎样才能更好的实现制冷温度监控？我们需要了解常规的有害警报以及在控制范围内会发生什么。</p><p id="6b76" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">2.制冷系统目前的能源性能如何？首先，我们能否利用现有数据建立一个良好的能源模型，我们能否确定潜在的能源节约？</p><p id="83ab" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">3.需要做些什么来实施已确定的变更，这样做是否具有成本效益？</p><h2 id="a74f" class="ms ld iq bd le mt mu dn li mv mw dp lm kp mx my lo kt mz na lq kx nb nc ls nd bi translated">计划评估方法</h2><ul class=""><li id="7645" class="ne nf iq ki b kj lu km lv kp ng kt nh kx ni lb nj nk nl nm bi translated"><strong class="ki ir">数据准备</strong>:建立数据摄取管道，包括数据质量处理。这也将允许在未来添加额外的数据。</li><li id="45f8" class="ne nf iq ki b kj nn km no kp np kt nq kx nr lb nj nk nl nm bi translated"><strong class="ki ir">探索性数据分析(EDA) </strong>:探索<em class="mc">新</em>数据，识别特征，识别潜在的新特性。</li><li id="cfe2" class="ne nf iq ki b kj nn km no kp np kt nq kx nr lb nj nk nl nm bi translated"><strong class="ki ir">开发和测试ML模型:</strong>根据业务需求，开发合适的模型并测试性能。</li><li id="52fd" class="ne nf iq ki b kj nn km no kp np kt nq kx nr lb nj nk nl nm bi translated"><strong class="ki ir">总结成果:</strong>讨论项目这一部分的发现和后续步骤。</li></ul><blockquote class="lz ma mb"><p id="9920" class="kg kh mc ki b kj kk jr kl km kn ju ko md kq kr ks me ku kv kw mf ky kz la lb ij bi translated">数据和python笔记本可以在<a class="ae ns" href="https://github.com/cnrd-dev/cheese-factory" rel="noopener ugc nofollow" target="_blank"> GitHub </a> :-)上获得</p></blockquote><h1 id="71d1" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">数据准备</h1><h2 id="b288" class="ms ld iq bd le mt mu dn li mv mw dp lm kp mx my lo kt mz na lq kx nb nc ls nd bi translated">传感器描述和数据</h2><p id="bd18" class="pw-post-body-paragraph kg kh iq ki b kj lu jr kl km lv ju ko kp lw kr ks kt lx kv kw kx ly kz la lb ij bi translated">各种传感器的描述位于<strong class="ki ir"><em class="mc">sensors _ sensor _ 202107282041 . CSV</em></strong>中。它包括:</p><ul class=""><li id="ee5f" class="ne nf iq ki b kj kk km kn kp nt kt nu kx nv lb nj nk nl nm bi translated"><strong class="ki ir"> <em class="mc"> sensor_id </em> </strong>与日常数据文件相匹配；</li><li id="daed" class="ne nf iq ki b kj nn km no kp np kt nq kx nr lb nj nk nl nm bi translated"><strong class="ki ir"><em class="mc">sensor _ type</em></strong><strong class="ki ir"><em class="mc">sensor _ uom</em></strong>(计量单位)；</li><li id="dccf" class="ne nf iq ki b kj nn km no kp np kt nq kx nr lb nj nk nl nm bi translated"><strong class="ki ir"> <em class="mc"> sensor_ucl </em> </strong>和<strong class="ki ir"> <em class="mc"> sensor_lcl </em> </strong>是用于报警的控制上限和下限；和</li><li id="6c27" class="ne nf iq ki b kj nn km no kp np kt nq kx nr lb nj nk nl nm bi translated"><strong class="ki ir"> <em class="mc"> sensor_uucl </em> </strong>和<strong class="ki ir"> <em class="mc"> sensor_llcl </em> </strong>是用于报警的控制上限和下限。</li></ul><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi nw"><img src="../Images/9a72ce4e54e46ccfd089fa2904ac6d14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UMzCI08ZjQx-782sebrJWg.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">添加了<strong class="bd ob"> sensor_short_name </strong>的数据框细节，便于参考。<em class="kf">图片作者。</em></p></figure><p id="3ee9" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">感兴趣的传感器是冷藏室温度、冷藏室功耗和外部环境温度。有两个冷藏室:一个用于在制品(WIP ),一个用于配送(DP)。</p><p id="63c7" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">物联网系统在2021年3月底实施，提供了大约五个月的高频数据。每日数据文件以压缩的CSV文件形式接收，由系统创建用于备份目的。该文件包含三列:</p><ul class=""><li id="e6b9" class="ne nf iq ki b kj kk km kn kp nt kt nu kx nv lb nj nk nl nm bi translated"><strong class="ki ir"> <em class="mc">时间戳</em> </strong>:获取传感器读数的日期和时间</li><li id="3de7" class="ne nf iq ki b kj nn km no kp np kt nq kx nr lb nj nk nl nm bi translated"><strong class="ki ir"> <em class="mc">值</em> </strong>:传感器描述文件中的原始传感器读数，单位为测量单位；和</li><li id="298d" class="ne nf iq ki b kj nn km no kp np kt nq kx nr lb nj nk nl nm bi translated"><strong class="ki ir"> <em class="mc"> sensor_id_id </em> </strong>:与传感器描述文件匹配的传感器的整数id。</li></ul><p id="7d5e" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">查看原始数据的统计数据，我们可以看到当前读数(32和36)有大约5000个额外的数据点，这表明一些数据点缺失。还可以看出，温度读数(29、30和31)的最小值为-127，这是可疑的，并且还会影响平均值和标准偏差，这取决于该值有多少数据点。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi gj"><img src="../Images/41447e5b8d5422a1d1732ed36def534b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zwXOATuKrqb9plsnAKYzlA.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">原始数据的基本统计(第一遍)。<em class="kf">作者图片。</em></p></figure><h2 id="0734" class="ms ld iq bd le mt mu dn li mv mw dp lm kp mx my lo kt mz na lq kx nb nc ls nd bi translated">数据处理</h2><p id="32e6" class="pw-post-body-paragraph kg kh iq ki b kj lu jr kl km lv ju ko kp lw kr ks kt lx kv kw kx ly kz la lb ij bi translated">开发了一个数据管道来读取单个压缩的CSV数据文件，将其合并到一个数据帧中，并执行一些清理。根据实时监控系统，以下标准用于过滤质量差的数据:</p><ul class=""><li id="25e5" class="ne nf iq ki b kj kk km kn kp nt kt nu kx nv lb nj nk nl nm bi translated">值-99被分配给任何质量差或不可用的传感器值；</li><li id="b599" class="ne nf iq ki b kj nn km no kp np kt nq kx nr lb nj nk nl nm bi translated">值-127表示一些温度传感器的数据质量差；和</li><li id="85e7" class="ne nf iq ki b kj nn km no kp np kt nq kx nr lb nj nk nl nm bi translated">值-327和327表示质量差的数据处于设备范围的极限。</li></ul><p id="63ce" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在此应用中，温度通常略高于零摄氏度，因此-99或-127的值不在正常范围内。没有等于-99的数据点，也没有处于极限的数据点，但是有155个数据点等于-127。移除这些之后，统计数据看起来更符合流程。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi oc"><img src="../Images/2e0ecffc8d47d02b9cea98978f583122.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Orv6iXuhmwYT-hTTn2RPlQ.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">在移除质量差的数据之后，温度标准偏差和最小外观的统计数据与过程一致。<em class="kf">作者图片。</em></p></figure><p id="2b59" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">温度数据在五分钟的时间段内被平均，以减少来自原始测量的噪声，因为系统是缓慢动作的，至少对于温度是如此。正常开关周期数据的变化略有减少，但除霜尖峰仍然突出。</p><p id="c150" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">对于能量分析，电流测量值(功率测量值)被转换为能量测量值，因为电流变化很快，可以在噪声电流趋势中观察到。我们还对能耗感兴趣，而不是瞬时值。在三相系统中，现场电压为400伏。假设平均功率因数为0.85。该分析的温度数据是一个小时内的平均值。</p><p id="1f6b" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这些步骤在<a class="ae ns" href="https://github.com/cnrd-dev/cheese-factory/blob/main/notebooks/data-etl.ipynb" rel="noopener ugc nofollow" target="_blank"><strong class="ki ir"><em class="mc">data-ETL . ipynb</em></strong></a>中有所概述。</p><h1 id="01cd" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">探索性数据分析</h1><p id="3a7f" class="pw-post-body-paragraph kg kh iq ki b kj lu jr kl km lv ju ko kp lw kr ks kt lx kv kw kx ly kz la lb ij bi translated">外部温度呈正态分布，有道理。WIP温度看起来像预期的那样具有特定的设定点，然而，DP温度似乎具有两个不同的设定点。在能量上，我们可以看到设备关闭的时间段(峰值在第一个框中)。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi od"><img src="../Images/4c7b13e03a7384e30a131db5a9e173f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TSYhCNlTbM1w8O69LMU5rQ.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">每个传感器的数据分布。<em class="kf">图片作者。</em></p></figure><p id="cafc" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在分析时间序列趋势(温度和能量)时，似乎有一些能量峰值与工作日的每日温度相匹配，但在周末没有太大变化。包含星期几可能是一个很好的特性。周六和周日的能源消耗不同于一周中的其他日子，因为周末的工作最少。在这一周中，不断有人进出冷藏室，并添加新产品。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi oe"><img src="../Images/5e8d82ba5b3ab0d5feff9ab66c726603.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oRRIyIuiwb97fCT-j2PLRg.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">WIP冷藏室每周一天的能耗与外部温度。周末观察到的明显差异。<em class="kf">作者图片。</em></p></figure><p id="f328" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">观察调度冷藏室的设定点差异，我们可以将冷藏室温度分为3.5°C，以比较高设定点(4°C)和低设定点(2°C)的能耗差异。平均差额为3 538千瓦时/年，约为18%。这意味着如果它在较高的设定点运行，可能会节省18%,假设它不会影响产品质量。然而，随着时间的推移，我们需要考虑可能产生重大影响的相关变量。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi of"><img src="../Images/17d0911f7320243b0dc7aed9739e3956.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*syH4LU5H4hupzVJm9QTSug.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">比较低(2°C)和高(4°C)设定点之间能耗分布的箱线图。<em class="kf">作者图片。</em></p></figure><p id="a457" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这些步骤在<a class="ae ns" href="https://github.com/cnrd-dev/cheese-factory/blob/main/notebooks/eda.ipynb" rel="noopener ugc nofollow" target="_blank"><strong class="ki ir"><em class="mc">EDA . ipynb</em></strong></a>中有所概述。</p><h1 id="7760" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">使用异常检测进行冷房温度监控</h1><p id="4d1e" class="pw-post-body-paragraph kg kh iq ki b kj lu jr kl km lv ju ko kp lw kr ks kt lx kv kw kx ly kz la lb ij bi translated">更一致的监控中的一个见解是每6小时发生的显著的自动除霜循环。这是大多数有害警报的原因。这不是常识，也很少引起对之前人工读数的关注，除非读数是在这段时间内获得的。实时监控使这一点变得可见，但有害警报无助于新系统的采用。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi og"><img src="../Images/788930fd419694b7fb803ee5177d81ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BqaDAOicnD7vvslXf6Js9g.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">六小时制冷循环，显示了一个清晰的模式和除霜循环接近尾声。<em class="kf">图片作者。</em></p></figure><p id="d1ec" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">解决恼人警报的一个解决方案是使用<a class="ae ns" href="https://www.tensorflow.org/tutorials/generative/autoencoder" rel="noopener ugc nofollow" target="_blank">自动编码器、卷积神经网络</a>。有一个使用Keras库进行<a class="ae ns" href="https://keras.io/examples/timeseries/timeseries_anomaly_detection/" rel="noopener ugc nofollow" target="_blank">时间序列异常检测的很好的例子，它使用了来自<a class="ae ns" href="https://github.com/pavithrasv" rel="noopener ugc nofollow" target="_blank"> pavithrasv </a>的自动编码器</a>，该编码器被用于本分析。它基本上接受输入数据并对其进行编码(压缩)，减少特征，然后开始解码特征以重建原始数据，同时将误差降至最低。因此，确保输入数据的高质量和<em class="mc">正常</em>对于手头的流程非常重要。</p><p id="b8d1" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我们有六小时一个周期的温度趋势，在正常情况下是可以预测的。在检查了时间序列趋势后，确定了一个好的时间段作为自动编码器的训练数据(在2021–05–07 16:30和2021–05–11 4:20之间)。这种方法的困难在于处理未标记的数据和直观地找到好的周期。研究了一个典型的循环，以确定创建训练序列所需的时间步长。典型的时间步长约为74，即6小时15分钟。</p><p id="3944" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">指标</strong></p><p id="282a" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在定义Keras模型时，选择均方误差(MSE)作为损失函数，以<a class="ae ns" href="https://medium.com/analytics-vidhya/mae-mse-rmse-coefficient-of-determination-adjusted-r-squared-which-metric-is-better-cd0326a5697e" rel="noopener">惩罚较大误差的益处</a>，这对于该应用至关重要。对于其他参数，使用默认值。</p><p id="d7f9" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">模型评估和选择</strong></p><p id="8463" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">经过训练后，我们看到该模型与训练和验证数据集都非常吻合。通过绘制MSE，在训练损失最大值为0.13时计算重建阈值。当参数调整过多时会遇到一些困难，导致模型中的大量损失。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi oh"><img src="../Images/025a4814bfa01f01d98af979ab277368.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tFD79-l2hpiIJkImVBD02A.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">派遣冷房温度的培训与验证损失。<em class="kf">图片作者。</em></p></figure><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi of"><img src="../Images/3f54612379efea36ded47e1475c98987.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zxfZJzJwtR7IzNfuiAn8Hg.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">确定重建误差阈值的训练损失函数的分布。<em class="kf">图片作者。</em></p></figure><p id="e7ac" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">从模型中检查和重建单个序列，并计算误差以验证模型的拟合。使用训练序列之一，我们观察到良好的拟合和最小的误差。使用一些检测到的异常序列，可以清楚地看到大误差区域。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi oi"><img src="../Images/74b1ce1acc58fa40d272a9abc0b536e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ODLe-xeg07FAyeAcnVX20A.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">无异常的重建趋势示例(测试数据)。<em class="kf">图片作者。</em></p></figure><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi oj"><img src="../Images/04129405dbb45dd36d2883bc0faf0ca0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I3KmzdGc4aHX1FRF_5AV-g.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">带有异常的重构趋势示例。<em class="kf">图片作者。</em></p></figure><p id="0026" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">结果</strong></p><p id="1378" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">将此应用于所有可用的数据，有一些我们期望捕捉的明显异常，但也有一些其他可能或可能不重要的异常。重要的是，一些设定值的变化也被确定为异常，这可能意味着过程没有正常运行。使用提供的示例，这是一个很好的第一步。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi ok"><img src="../Images/47bfc5084edc2cb61e1b1ffccf1e6705.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mGC-GcP2GlXN0rRejcVkrA.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">突出异常的长期趋势。有些异常是意料之中的，比如更高的峰值，而有些则在正常的控制范围内，但可能会有影响产品质量或设备寿命的重大变化。<em class="kf">作者图片。</em></p></figure><p id="729e" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">调整损失函数阈值会影响模型检测异常的灵敏度。如果阈值太高，我们可能会错过设定点温度偏移两度的时间段，这可能意味着使用额外的能量或减少产品的保质期。</p><blockquote class="lz ma mb"><p id="bee3" class="kg kh mc ki b kj kk jr kl km kn ju ko md kq kr ks me ku kv kw mf ky kz la lb ij bi translated">这是一个复杂的方法，用一些基础知识和世界类库就可以实现。它可以减少我们的应用程序的有害警报，并且应该与其他方法结合使用，以实现更健壮的实现。</p></blockquote><p id="4c5d" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这些步骤在<a class="ae ns" href="https://github.com/cnrd-dev/cheese-factory/blob/main/notebooks/anomaly-detection-dp.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="ki ir"> <em class="mc">异常-检测-dp.ipynb </em> </strong> </a> <strong class="ki ir"> <em class="mc">中有所概述。</em> </strong> <em class="mc"> </em>对WIP冷室做了类似的分析(<a class="ae ns" href="https://github.com/cnrd-dev/cheese-factory/blob/main/notebooks/anomaly-detection-wip.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="ki ir"> <em class="mc">异常-检测-wip.ipynb </em> </strong> </a>)。</p><h1 id="99fb" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">估计制冷系统的能量性能</h1><p id="ef7f" class="pw-post-body-paragraph kg kh iq ki b kj lu jr kl km lv ju ko kp lw kr ks kt lx kv kw kx ly kz la lb ij bi translated">到目前为止，人们关注的焦点一直是冷藏室的温度监测。为了建立一个衡量能源绩效的模型，需要衡量相关的变量。物联网系统测量外部环境温度以及制冷设备消耗的电流。从能源的角度来看，冷室温是一个设定点，而不是一个相关变量。然而，这将影响能耗，因为在不同时期，调度冷室似乎有两个不同的设定点。</p><p id="2c1e" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">从质量的角度来看，要求将房间保持在4℃左右，因此任何更冷的温度都意味着在这种特定的气候下需要更多的能量来降温。因此，我们的能量模型可以估计两个设定点之间的能量差，并估计潜在的能量节省。</p><p id="84cc" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">定义模型</strong></p><p id="7a58" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">使用将能耗与环境温度和设定点温度相关联的回归分析，开发了一个简单的能量模型。使用每日数据是因为数据在较小的时间间隔内可能会有噪声，尤其是具有有限特征的数据。与EDA阶段相同的温度分割用于数据集，即3.5°C。对于该模型，使用每日数据，将4°C设定点用作基线，将2°C设定点用作我们的报告期。基准期和报告期的可用数据点分别为53个和61个，因此非常平衡。</p><p id="9235" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">EDA还显示了能量消耗和外部温度之间的相关性。我们用基线期的散点图证实了这一点，并且在右上角观察到四个明显的异常值，以及与lowess线的轻微非线性。异常值已从分析中剔除。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/9ed8b2e0687587f1e3e09862463e632d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*fGIazs2nw-6qmN83EBdpJQ.png"/></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">调度冷藏室能耗与外部温度的关系，添加等高线图，并用红色表示一条lowess线。<em class="kf">作者图片。</em></p></figure><p id="b17d" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">指标</strong></p><p id="c314" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">均方根误差(RMSE)优于平均绝对误差(MAE ),因为它对大误差不利。与预测能量的小偏差并不重要，但一个大值会影响累积能量性能。另一个指标是调整后的R平方，因为我们有一个以上的功能，它提供了一个比R平方更鲁棒的指标，R平方通过添加功能来提高。该指标的实际应用是解释能耗的可变性，并在我们可能遗漏某些功能时给出提示。</p><p id="82e5" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">模型评估和选择</strong></p><p id="ae4f" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">特征(外部温度和设定点温度)已标准化，25%的数据集用于测试。作为基本参考，拟合了OLS回归模型，剔除了异常值，只有轻微的非线性。该模型在测试集上产生了3.83 的<strong class="ki ir"> RMSE和0.5356 </strong>的<strong class="ki ir">调整R平方，这解释了约53%的可变性。这可能表明一些缺失的相关变量或过程控制问题。</strong></p><p id="81bc" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">为了看看是否可以用更健壮的算法来改进模型，我选择使用增强回归树，即XGBoost，因为它对特征的非正态性不敏感，更容易解释和准确。我包括3个交叉验证，因为它是一个小数据集，使用每日数据和网格搜索进行超参数调整。为了找到最佳参数，选择了相当宽的范围，但在选择时要小心，以确保模型不复杂且可能过度拟合，例如<em class="mc"> max_depth </em>不应太深。为了减少过度拟合的可能性，我还指定了<em class="mc"> colsample_bytree </em>和<em class="mc">子采样</em>参数，以便它在每一步使用稍微不同的数据。</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="2ea4" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">该模型得出的<strong class="ki ir"> RMSE为3.49 </strong>和<strong class="ki ir">调整后的R平方为0.6147 </strong>，比OLS回归模型高出约8%。最佳参数是在<em class="mc">最大深度</em>为5，采样参数都为0.3，这意味着没有过度拟合的可接受模型。看看测试数据的回归图，残差看起来是随机分布的，只有一个点在Q-Q图中突出。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi oo"><img src="../Images/830e739592ff90aca6cc2dfc8af4bf46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PP91OsWVEZGEIJceVnaDgw.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">使用XGBoost模型的测试数据的回归图。<a class="ae ns" href="https://emredjan.xyz/blog/2017/07/11/emulating-r-plots-in-python/" rel="noopener ugc nofollow" target="_blank">用Python模拟R图——数据之旅&amp;音乐(emredjan.xyz) </a>。<em class="kf">图片作者。</em></p></figure><p id="703c" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">结果</strong></p><p id="023b" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">现在，我们可以在报告期数据上使用优化的XGBoost模型来预测在较高设定值下消耗的能源。预测能量消耗和实际能量消耗之差的累积和将给出在此期间消耗的额外能量。在此期间，额外的能源消耗为419千瓦时，对其进行调整以代表年度数字，预计额外的能源消耗为2 507千瓦时/年，即高出约11%。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi mg"><img src="../Images/713fb0a8b51f07be18e3b0a09fa6ea33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ibsrG7Hx894-5l4n7UaGg.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">显示使用2°C设定点的额外能耗的累积能源性能。平线期是使用基线数据最多的时期，即设定点为4℃。<em class="kf">作者提供的图像。</em></p></figure><blockquote class="lz ma mb"><p id="a3f9" class="kg kh mc ki b kj kk jr kl km kn ju ko md kq kr ks me ku kv kw mf ky kz la lb ij bi translated">因此，基于更保守的能源模型，该工厂可能在一年内节省2 507千瓦时(约11%)。这大约是在EDA阶段完成的平均盒图分析的70%。这是一个很好的节约，特别是在电力中断时使用柴油发电机，这会增加企业成本和碳排放。</p></blockquote><p id="34f7" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">需要注意的几个关键问题是，有些数据是不可用的，如关于生产量的数据，以及门打开和关闭的次数(潜在的附加功能)。另一个原因是能源消耗受环境温度的影响，我们只查看了几个月的数据，因此不能代表所有季节。</p><p id="4e34" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这些步骤在<a class="ae ns" href="https://github.com/cnrd-dev/cheese-factory/blob/main/notebooks/energy-model.ipynb" rel="noopener ugc nofollow" target="_blank"><strong class="ki ir"><em class="mc">energy-model . ipynb</em></strong></a><strong class="ki ir"><em class="mc">中有所概述。</em> </strong></p><h1 id="c840" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">业务成果和考虑因素</h1><p id="23e9" class="pw-post-body-paragraph kg kh iq ki b kj lu jr kl km lv ju ko kp lw kr ks kt lx kv kw kx ly kz la lb ij bi translated">一个关键的发现是突出的自动除霜循环。了解了这一点后，维护经理想知道为什么另一家工厂的一个拥有相同系统的冷藏室没有任何除霜循环。事实证明，这个系统没有正常运行，这也解释了为什么它需要更频繁的维护和消耗更多的能源。这种情况已经得到纠正，降低了他们组织中另一家工厂的成本。</p><p id="adf1" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">根据能源分析，我们确定2°C和4°C的设定点之间存在能耗差异。降低约11%的能耗可以在更大范围内产生巨大影响，尤其是考虑到更多自持能源系统，如太阳能和电池。它可能对这种系统的资本成本以及电池容量有影响。</p><p id="bf78" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">相比之下，冷藏室的工作温度较低可能会有好处。可能会消耗稍微多一点的能量，但这可能会延长产品的保质期。考虑到产品中的固有能量，这可能意味着减少食物浪费和节约能源。</p><h1 id="a17a" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">结论</h1><p id="cfae" class="pw-post-body-paragraph kg kh iq ki b kj lu jr kl km lv ju ko kp lw kr ks kt lx kv kw kx ly kz la lb ij bi translated">该项目专注于利用新的实时数据从低成本、定制的物联网解决方案中提取价值。使用简单的机器学习技术进行异常检测，可以让人员专注于实际的警报，并避免讨厌的警报。通过持续测量能源性能，可以实现能源和成本节约。</p><p id="13e2" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">简单机器学习模型的应用意味着，可以开发一种低成本、非计算密集型的分析解决方案，该解决方案易于理解、实施和维护，同时提供80%的商业价值。</p><h1 id="567f" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">改进的机会</h1><blockquote class="lz ma mb"><p id="69a5" class="kg kh mc ki b kj kk jr kl km kn ju ko md kq kr ks me ku kv kw mf ky kz la lb ij bi translated">项目这一阶段的下一步是构建机器学习管道并将其集成到主要的物联网解决方案中，并提供一个接口来重新训练和部署测试模型。</p></blockquote><p id="336e" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">后者不仅对模型维护很重要，而且因为可用数据有限，使用更大、更有代表性的数据集会有好处。</p><p id="2312" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">对于异常检测，自动编码器应与控制限值以及统计过程控制原则相结合，以提供更强大的报警功能。</p><p id="9f81" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">对于能源模型，还应该收集额外的数据，以添加更多的功能和增加每日数据点。这种分析的困难在于我们可用的每日数据点有限，这可能意味着该模型在操作中不能很好地概括。</p><p id="fe56" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><em class="mc">笔记本和资料可在</em><a class="ae ns" href="https://github.com/cnrd-dev/cheese-factory" rel="noopener ugc nofollow" target="_blank"><em class="mc">GitHub</em></a><em class="mc">:-)</em>上获得</p><h2 id="9f3c" class="ms ld iq bd le mt mu dn li mv mw dp lm kp mx my lo kt mz na lq kx nb nc ls nd bi translated">参考</h2><ul class=""><li id="d88c" class="ne nf iq ki b kj lu km lv kp ng kt nh kx ni lb nj nk nl nm bi translated"><a class="ae ns" href="https://keras.io/examples/timeseries/timeseries_anomaly_detection/" rel="noopener ugc nofollow" target="_blank"> <em class="mc">使用自动编码器的时间序列异常检测</em> </a></li><li id="362b" class="ne nf iq ki b kj nn km no kp np kt nq kx nr lb nj nk nl nm bi translated"><a class="ae ns" href="https://blog.keras.io/building-autoencoders-in-keras.html" rel="noopener ugc nofollow" target="_blank"> <em class="mc">在Keras中构建自动编码器</em> </a></li><li id="76df" class="ne nf iq ki b kj nn km no kp np kt nq kx nr lb nj nk nl nm bi translated">MAE、MSE、RMSE、决定系数、调整后的R平方——哪个指标更好？T11】</li><li id="aa6f" class="ne nf iq ki b kj nn km no kp np kt nq kx nr lb nj nk nl nm bi translated"><a class="ae ns" href="https://blog.cambridgespark.com/hyperparameter-tuning-in-xgboost-4ff9100a3b2f" rel="noopener ugc nofollow" target="_blank"><em class="mc">XGBoost</em></a>中超参数调谐</li><li id="d5e7" class="ne nf iq ki b kj nn km no kp np kt nq kx nr lb nj nk nl nm bi translated"><a class="ae ns" href="https://emredjan.xyz/blog/2017/07/11/emulating-r-plots-in-python/" rel="noopener ugc nofollow" target="_blank"> <em class="mc">在Python中模拟R图</em> </a></li></ul></div></div>    
</body>
</html>