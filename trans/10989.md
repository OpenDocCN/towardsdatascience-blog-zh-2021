# 模型漂移的内容、原因和方式

> 原文：[https://towardsdatascience.com/the-what-why-and-how-of-model-drift-38c2af0e97ee?source=collection_archive---------21-----------------------#2021-10-26](https://towardsdatascience.com/the-what-why-and-how-of-model-drift-38c2af0e97ee?source=collection_archive---------21-----------------------#2021-10-26)

## [行业笔记](https://towardsdatascience.com/tagged/notes-from-industry)，MLOps

## 识别模型漂移的类型、检测技术、预防措施和补救措施

![](../Images/2f23bc02fb3fd1e293ff962417ced242.png)

来源:undraw.co

# 介绍

我们的世界千变万化，不断变化。随着时间的推移，正如热力学第二定律所描述的那样，事物趋向于无序。现实的这一基本性质在其范围内包含了机器学习模型的预测能力。换句话说，就像其他任何事情一样，机器学习模型会随着时间的推移而恶化。

在预测建模的上下文中，模型根据历史数据进行训练，并用于根据看不见的数据进行预测。这个过程产生一个模型，该模型映射输入特征和目标变量之间的关系。但是，在动态环境中，从长远来看，培训数据和生产数据之间的分布变化是不可避免的。随着时间的推移，这导致我们部署的模型的预测变得不太可靠，这种现象通常称为模型漂移。

> "变化是生活中唯一不变的东西。"赫拉克利特

如果不能及时发现并充分解决这个问题，可能会在这些模型运行的环境中产生严重的后果。在本文中，我们将深入研究文献中分类的常见漂移类型，确定漂移的一些原因、检测技术，以及最重要的补救措施。

# 模型漂移的类型

本文将涵盖两种主要类型的模型漂移，即数据漂移和概念漂移。值得一提的是，存在第三种类型的移动，**先验概率移动，**，这是由于目标变量分布的移动而发生的。但是，我们不会讨论这种类型的转换。

## 数据漂移

当我们的输入特征的统计属性发生变化时，数据漂移，也称为*协变量移位*，由分布 *P(X* 的变化表示。

> 这种现象意味着训练数据的输入特征分布与输入的实时生产数据之间存在差异。

发生数据漂移的一个常见原因是由于**采样选择偏差**。举例来说，许多学习场景中的默认假设是训练和部署数据是独立且同分布的(即，i.d ),即，它们来自相同的分布。样本选择偏差违反了这一假设，导致模型无法在部署时做出准确的预测。

例如，考虑一个在 2010 年观看的电影数据集上训练的电影推荐系统。如果我们在 2021 年部署这种模型，很可能该模型的性能将是次优的。在我们的例子中，这归因于在此期间电影偏好趋势的变化。最终，由于训练集和制作集的输入特征分布之间的差异，在其他条件相同的情况下，如果用于预测 2021 年的电影偏好，我们的模型可能会失败。该示例捕捉了由于消费者偏好随时间变化以及违反 i.i.d .假设而导致的数据漂移。

虽然在前面的示例中，训练数据和服务数据之间的输入要素的分布发生了变化，但输入和目标之间的关系假设不变。接下来，我们将阐明随着时间的推移，这种关系的变化意味着什么。

## 概念漂移

数据漂移表示服务数据和训练数据之间的输入变量的统计特性的差异，而概念漂移表示服务数据和训练数据的模型输入和目标变量之间的关系的差异，即分布 *P(Y|X)* 的变化。简而言之，投入和目标之间的关系随着时间的推移已经发生了变化。

> 结果，由机器学习模型学习的映射不再捕捉服务数据的输入和目标之间的关系。

例如，考虑一个天气预测模型，该模型被训练为使用一组不同的输入特征来预测温度和湿度。随着时间的推移，输入要素和目标变量之间的关系可能会由于各种因素而发生变化，例如，其中一个因素可能是气候变化，这是一个很难捕捉到一个变量中的因素，但仍然会影响输入要素和目标变量之间的关系。由于这个原因，我们最终会在模型学习到的关系和模型要预测的传入数据流中的实际关系之间产生差异。这种变化归功于**的动态环境**。最终，这导致了一个对温度和湿度预测能力低的无能模型。

# 如果模型恶化，这种情况会多快发生？

既然我们已经讨论了不同类型的漂移，现在让我们来看看漂移随时间出现的不同速率。

![](../Images/0d81db6e65efc180fad310cfd72206cc.png)

来源:[undraw.co](https://undraw.co/)

*   **突发**:漂移可能由于不可预见的情况而突然发生，通常由外部事件触发。新冠肺炎病毒的爆发导致了电子商务消费者行为的突然改变，这可以被看作是突然漂移的一个例子。
*   **渐进性:**这种类型的漂移需要更长的时间才能发生，而且通常是很自然的事情。季节性可能是逐渐漂移的一个例子。尽管复杂的时间序列模型确实考虑了季节性对模型性能的影响。如果不予考虑，受季节性影响的模型的预测能力会随着时间的推移而下降。
*   **循环:**循环漂移周期性地发生，通常发生在一年中的特定时间。例如，在黑色星期五或圣诞节前后，消费者行为可能会有所不同，表现为对消费品需求的增加。由于这些事件的重复发生，可以训练某些模型来迎合这些时期周围增加的需求。

# 检测模型漂移

考虑到不同类型的模型漂移以及它们发生的不同速率，如何检测模型质量的恶化？

这可以通过监控生产中模型的性能指标来实现。很明显，对吧？通常，模型的性能是使用部署前的测试集来评估的。到目前为止，我们所发现的模型漂移突出了在生产过程中持续监控模型对输入数据流的性能的重要性。

在二进制分类环境中，随时间监控的相关指标是 **F 值**。如果分数随着时间的推移而下降，那么这可能是漂移的明显信号。在无法获得基本事实的情况下，我们无法在预测值和实际值之间进行比较，因此我们需要依赖不同的测量方法。

由于漂移问题的性质，**统计距离测量**可用于量化分布之间的变化。一种常用的测试是 **Kolmogorov-Smirnov (K-S)测试。**该测试基于参考分布的累积分布和最近分布(在我们的例子中是训练和部署分布)之间的最大差异。该测试的零假设表明两个分布之间没有差异，并且零假设的拒绝可以被推断为模型漂移的指标。

此外，另一种用于识别漂移的流行距离测量是**群体稳定性指数(PSI)。**用于衡量变量分布随时间的变化。这一指标非常适合于监控人口特征的变化。

存在各种不同的方法、度量和测试来检测漂移，例如 **Z 分数**、**基于模型的方法、**和**自适应窗口**。如果你想深入了解，我会在下面提到进一步阅读和研究的资料来源。

话虽如此，但需要强调的是，监控漂移不是一次性任务，而是一个迭代过程。它需要定期发生，因为服务数据通常是不断传入的数据流。因此，这是一个可以大大受益于自动化的过程，从而提高效率和快速检测漂移。

# 模型漂移补救措施

既然我们已经走了这么远。是时候解决一个至关重要的问题了，即纠正模型漂移的问题。可以采取两套方法，一套是预防措施，确保问题不会在一开始就发生；另一套是临时补救措施，在理想情况下，在问题失控之前解决问题。

预防模型漂移的方法需要使用**在线学习。**在线学习是一种模型训练方法，通过实时数据流不断更新模型。这种方法对于防止模型漂移非常有效。然而，实现实时学习是一项复杂的任务，需要专业知识。

在现有的一系列补救措施中，最直接的方法是**在其性能下降到预先确定的阈值以下时，定期重新训练**模型。当观察到漂移时，应该用最近的数据重新训练模型。另一种方法是**定期更新**一个模型。这是一种更有效的方法，其中不是完全丢弃不合适的模型并重新训练新的模型，而是将现有状态用作拟合过程的起点，该拟合过程使用最新数据的样本来更新模型拟合。然而，这种方法并不适用于所有的机器学习算法，因为它最适合于依赖权重或系数进行预测的算法，如回归算法和神经网络。

另一种方法利用**集成学习**技术，其中多个模型的集成用于进行组合预测。这种组合预测通常使用每个模型的单独预测的加权平均值来计算。这里的权重反映了每个模型在最近数据上的表现。

总之，其他方法如**实例选择**和**特征删除**也可用于解决模型漂移。我会在下面链接更多的资源给你。

# 结论

总之，我们已经绘制出了存在的两种主要漂移类型，并揭示了漂移可能发生的速率。我们还提到了不同的监控技术、预防措施和补救措施。您还可以在下一节找到更多资源。

我们在这篇文章的开头指出，我们的世界是不断变化的，这也将是我们的结束语。由于模型漂移问题本身是动态的和不断变化的，用于识别和补救漂移的工具和技术也随着时间的推移而变化，并且很可能演变。出于这个原因，有越来越多的研究旨在完善我们对不同环境下模型漂移和补救措施的理解。

## **延伸阅读**

*   [使用 Jensen-Shannon 和 Kullback Leibler 测量两个样本之间的统计相似性](https://medium.com/datalab-log/measuring-the-statistical-similarity-between-two-samples-using-jensen-shannon-and-kullback-leibler-8d05af514b15)
*   [瓦瑟斯坦公制](https://en.wikipedia.org/wiki/Wasserstein_metric)

[](https://www.arangodb.com/2020/11/arangoml-part-4-detecting-covariate-shift-in-datasets/) [## ArangoML 第 4 部分:检测数据集中的协变量变化

### 本文是介绍 ArangoML 并展示其对机器学习的好处的系列文章中的第四篇…

www.arangodb.com](https://www.arangodb.com/2020/11/arangoml-part-4-detecting-covariate-shift-in-datasets/) 

*   [概念漂移下的学习:概述](https://arxiv.org/abs/1010.4784)
*   [理解概念漂移](https://arxiv.org/abs/1704.00362)
*   [通过模型重用处理概念漂移](https://link.springer.com/article/10.1007/s10994-019-05835-w)

## 参考

[1]阿克曼，s .，法奇，e .，拉兹，o .，扎尔马诺维奇，m .，&杜贝，P. (2020)。检测随时间影响机器学习模型性能的数据漂移和异常值。

[2]黄，j .，格雷特顿，a .，博格瓦尔特，k .，舍尔科夫，b .，&斯莫拉，A. (2006 年)。用未标记数据校正样本选择偏差。

[3] [利用火花上的 Kolmogorov Smirnov 统计量进行模型漂移检测](https://pkghosh.wordpress.com/2020/02/24/model-drift-detection-with-kolmogorov-smirnov-statistic-on-spark/)。

[4]阿列克谢·齐巴尔。(2004).概念漂移的问题:定义和相关工作。