<html>
<head>
<title>3 Cool Features of Python Altair</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python Altair的3个很酷的特性</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-cool-features-of-python-altair-deb3f432cc11?source=collection_archive---------15-----------------------#2021-09-29">https://towardsdatascience.com/3-cool-features-of-python-altair-deb3f432cc11?source=collection_archive---------15-----------------------#2021-09-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4aea" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">它不仅仅是一个数据可视化库</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/eb6339383028b4f2e8815f020986a137.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5ipY1hFf1aPrBK2f06V9Sw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@srosinger3997?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">萨曼塔·加德斯</a>在<a class="ae ky" href="https://unsplash.com/s/photos/simple?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="bf91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据可视化是数据科学不可或缺的一部分。它加速了许多任务，例如探索数据、交付结果、讲故事等等。幸运的是，Python有很好的数据可视化库。</p><p id="5af8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Altair是一个用于Python的声明式统计可视化库。它提供了几个功能来执行数据分析，同时创建惊人的可视化。</p><p id="2a5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将介绍Altair的3个特性，它们有可能提高您的效率。</p><p id="f7a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和其他软件工具和软件包一样，最好的学习方法是通过实践。因此，我将尝试用例子来解释这些特性。我们将在知识共享许可下使用Kaggle上的客户流失数据集。请随意下载并跟随。</p><p id="f14e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Altair可以通过pip轻松安装，如下所示:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="71fd" class="ma mb it lw b gy mc md l me mf">pip install altair</span><span id="6611" class="ma mb it lw b gy mg md l me mf">#if you are using jupyter notebook<br/>!pip install altair</span></pre><p id="9d9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们导入库并将数据集读入Pandas数据框。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d068" class="ma mb it lw b gy mc md l me mf">import pandas as pd<br/>import altair as alt</span><span id="7655" class="ma mb it lw b gy mg md l me mf">churn = pd.read_csv("Data\\BankChurners.csv")</span></pre><p id="1263" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将只使用原始数据集中的一些列。我们还需要最多5000个观察值(即行)才能使用Altair。下面的代码片段执行必要的过滤操作。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8506" class="ma mb it lw b gy mc md l me mf">features = [<br/>    "Attrition_Flag",<br/>    "Customer_Age",<br/>    "Gender",<br/>    "Marital_Status",<br/>    "Income_Category",<br/>    "Total_Trans_Amt",<br/>    "Credit_Limit",<br/>    "Months_Inactive_12_mon"<br/>]</span><span id="2730" class="ma mb it lw b gy mg md l me mf">churn = churn[features].sample(n=5000, ignore_index=True)</span><span id="b4db" class="ma mb it lw b gy mg md l me mf">churn.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/dc08fdcb39aa2f9daf2668c582520ea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qKdd-SiN4F74GhNw3jGqig.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="875c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以开始探索Altair的酷功能了。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="e0f9" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">1.数据聚合</h2><p id="df5b" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">Altair允许在创建可视化时聚合数据。它为我们节省了一些通常由数据分析和操作库(如Pandas)完成的操作。</p><p id="268e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，我们可以创建一个柱状图，展示每个收入类别的平均信用限额。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1edd" class="ma mb it lw b gy mc md l me mf">(alt.<br/>  Chart(churn).<br/>  mark_bar().<br/>  encode(x='Income_Category', y='mean(Credit_Limit):Q').<br/>  properties(height=300, width=400))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/b61e0c55fdc285f3648fc10c034d466f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*Gzp2ujRlQtIFa8EDVosjMw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="3377" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在encode函数中传递给y参数的内容执行与Pandas的<code class="fe nm nn no lw b">groupby</code>函数相同的操作。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8cb8" class="ma mb it lw b gy mc md l me mf">churn.groupby(["Income_Category"]).agg(<br/>   Mean_Credit_Limit = ("Credit_Limit","mean")<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/64405639f069cc5fb1014a520ea2b4fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:614/format:webp/1*Gb-AMh8sAC_bo2HzG6uMhA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="4af1" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">2.过滤</h2><p id="a2cf" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">Altair还提供了过滤数据的功能，以便我们可以创建更集中或更具体的图。有几个谓词被传递给了<code class="fe nm nn no lw b">transform_filter</code>函数。每个谓词应用不同的过滤方法。</p><p id="fc91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，其中一个谓词允许基于值列表过滤行。下面的代码创建一个条形图，显示由<code class="fe nm nn no lw b">oneOf</code>参数指定的列表中给出的每种婚姻状况的平均信用额度。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d925" class="ma mb it lw b gy mc md l me mf">(alt.<br/>  Chart(churn).<br/>  mark_bar(width=50).<br/>  encode(x='Marital_Status', y='mean(Credit_Limit):Q').<br/>  transform_filter(<br/>      alt.FieldOneOfPredicate(<br/>          field="Marital_Status",<br/>          oneOf=["Single","Married","Divorced"])).<br/>  properties(height=300, width=500))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/9b88dd228c8f2abe2ce1301f27ce857f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*xJ6ZyL24q5KuSTF-KgMo3Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="760b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能已经注意到，第二个图中的条形比第一个图中的条形窄。可以使用<code class="fe nm nn no lw b">mark_bar</code>功能的宽度参数调整条的宽度。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="453c" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">3.动态过滤</h2><p id="de7d" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我们也可以用Altair实现动态过滤。它允许使用共享过滤器将多个图绑定在一起。</p><p id="8d59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先创建一个捕捉用户交互的选择对象。顾名思义，它用于选择可视化上的值。选择对象可以连接到图例或另一个图。</p><p id="014d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">换句话说，我们使用选择对象在一个绘图或图例上指定一个条件。然后，基于此选择过滤值。</p><p id="bdee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">举个例子会更清楚。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="532e" class="ma mb it lw b gy mc md l me mf">selection = alt.selection_multi(<br/>   fields=['Attrition_Flag'], bind='legend'<br/>)</span><span id="d6db" class="ma mb it lw b gy mg md l me mf">alt.Chart(churn).mark_circle(size=50).encode(<br/>   x='Credit_Limit',<br/>   y='Total_Trans_Amt',<br/>   color="Attrition_Flag",<br/>   opacity=alt.condition(selection, alt.value(1), alt.value(0.1))<br/>).properties(<br/>   height=350, width=500<br/>).add_selection(<br/>   selection<br/>)</span></pre><p id="53da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码片段的作用如下:</p><ul class=""><li id="1546" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated">它使用损耗标志列创建一个选择对象。它必然与传说有关。</li><li id="58c3" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">然后，它创建一个信用限额和总交易金额列的散点图。这些点根据损耗标志列进行着色。</li><li id="d4f0" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">“不透明度”参数用于根据选择调整点的不透明度。</li><li id="2be3" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">属性功能修改绘图的大小。</li><li id="ab9b" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">最后一步是将选择对象绑定到这个可视化对象。</li></ul><p id="f6c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/178530b12422b55ceb9cf0e80c076c96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*JQh7R53DMegv3-4P_wrwwA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(作者GIF)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="9cfc" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">结论</h2><p id="39e0" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">在数据转换和过滤方面，Altair是一个强大的数据可视化库。它简化了许多典型的数据操作任务。在本文中，我们介绍了3个很酷的特性，它们让我们能够在可视化中集成数据操作。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="996d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后但同样重要的是，如果你还不是<a class="ae ky" href="https://sonery.medium.com/membership" rel="noopener">中级会员</a>并打算成为其中一员，我恳请你使用以下链接。我将从你的会员费中收取一部分，不增加你的额外费用。</p><div class="of og gp gr oh oi"><a href="https://sonery.medium.com/membership" rel="noopener follow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd iu gy z fp on fr fs oo fu fw is bi translated">通过我的推荐链接加入Medium—Soner yld RM</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">sonery.medium.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow ks oi"/></div></div></a></div></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="a95f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>