<html>
<head>
<title>Plotly for Hierarchical Data Visualization: Treemaps and More</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">分层数据可视化的 Plotly:树形图和更多</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/plotly-for-hierarchical-data-visualization-treemaps-and-more-47b36c5db3eb?source=collection_archive---------15-----------------------#2021-12-27">https://towardsdatascience.com/plotly-for-hierarchical-data-visualization-treemaps-and-more-47b36c5db3eb?source=collection_archive---------15-----------------------#2021-12-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="69dc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一步一步的教程，使用 Plotly 和 Treemaps 可视化美国大辞职</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cf82cdff43945095ca17dabf89bfffb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*izQaWxyK5FDABFsBTR3e4A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:<a class="ae ky" href="https://pixabay.com/photos/isolated-tree-green-tree-isolated-3544689/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure><h1 id="f4e2" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="3950" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">2021 年 12 月 8 日，美国劳工统计局发布了其最新的劳动力流动<a class="ae ky" href="https://www.bls.gov/news.release/jolts.t04.htm" rel="noopener ugc nofollow" target="_blank">数据</a>。从 6 月到 10 月，超过 2000 万美国人辞去了工作。10 月份的初步数据显示，当月有超过 400 万美国人辞职，比去年同期高出近 25%。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/575b1d3395c8d21f777c18fa79d0ebf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uTDEyv01lxz0g1PvTl1uhA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">劳动统计局:<a class="ae ky" href="https://www.bls.gov/news.release/jolts.t04.htm" rel="noopener ugc nofollow" target="_blank">经济新闻发布</a></p></figure><p id="82af" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">劳动力流动数据还可以细分到不同的行业，在更精细的层次上提供丰富而深刻的信息。但是，请注意，这些数据是以表格格式呈现的，具有按行业划分的层次结构。这使得发现模式和快速识别需要注意的类别或子类别变得非常困难。</p><p id="a677" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">这是数据可视化发挥作用的典型场景！我们如何可视化这种类型的分层数据，以便它以易读的方式提供见解，同时有效地利用空间？</p><p id="ffe7" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">在本教程中，我们将使用 Plotly 创建一个树形图来可视化不同行业 10 月份的辞职率。树形图使用嵌套矩形显示分层数据，并使用每个矩形的大小和颜色来表示我们想要显示的不同指标。它是分层数据可视化的完美候选。</p><p id="ced5" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">作为奖励，在教程的最后，我们还将构建一个 sunburst 图表和 icicle 图表，它们与 treemaps 非常相似，并且共享相同的输入数据格式。我们将要创建的树形图如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/d46f3bf8dfdfd04ef98d4e35e2b99db2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l7S_Zqbro2oXevpAReTG3g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="fa93" class="kz la it bd lb lc nb le lf lg nc li lj jz nd ka ll kc ne kd ln kf nf kg lp lq bi translated">Plotly Express vs. Plotly Go</h1><p id="c715" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Plotly Python 库是一个交互式的开源图形库，涵盖了广泛的图表类型和数据可视化用例。它有一个名为 Plotly Express 的包装器，是 Plotly 的高级接口。</p><p id="179a" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">Plotly Express 可以轻松快捷地使用简单的语法创建最常见的图表，但在涉及更高级的图表类型或自定义时，它缺乏功能和灵活性。</p><p id="45d5" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">与 Plotly Express 相反，Plotly Go(图形对象)是一个较低级别的图形包，通常需要更多的编码，但更具可定制性和灵活性。在本教程中，我们将使用 Plotly Go 创建如上所示的树形图。您还可以将代码保存为模板，以便在其他用例中创建类似的图表。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="61a6" class="kz la it bd lb lc nb le lf lg nc li lj jz nd ka ll kc ne kd ln kf nf kg lp lq bi translated">下载并准备数据</h1><p id="527d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">你可以从劳动统计局<a class="ae ky" href="https://www.bls.gov/news.release/jolts.t04.htm" rel="noopener ugc nofollow" target="_blank">经济新闻发布页面</a>获得本教程的数据。该数据显示了 2021 年 6 月至 10 月经季节性调整的各行业的对等水平(数字以千计)和比率。我将数据保存在一个 Excel 文件中，工作表名为“By_Industry ”,并直接在 Excel 中重命名列名，使它们更直观。</p><p id="d1ba" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">我们先把数据读入 python。由于我们只对 10 月份的辞职率感兴趣，我们将只在数据框中保留“行业”、“2021 年 10 月辞职”和“2021 年 10 月辞职率”列。请注意，数据框中的“行业”列没有反映出原始表中显示的等级结构-我们需要稍后将这一缺失的信息添加到数据框中，以便绘制树形图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/6e0a6498c9e53119e887be5962487e6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zp_-7qyYZCeyy0wnu0YALQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="855d" class="kz la it bd lb lc nb le lf lg nc li lj jz nd ka ll kc ne kd ln kf nf kg lp lq bi translated">用 go 创建一个树形图。树形图</h1><p id="225c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要使用 Plotly Graph_Objects 制作树形图，我们至少需要“告诉”Plotly 以下内容:</p><ol class=""><li id="9aa7" class="nj nk it lt b lu mo lx mp ma nl me nm mi nn mm no np nq nr bi translated">每个矩形的标签</li><li id="102d" class="nj nk it lt b lu ns lx nt ma nu me nv mi nw mm no np nq nr bi translated">嵌套矩形的层次结构</li><li id="3d20" class="nj nk it lt b lu ns lx nt ma nu me nv mi nw mm no np nq nr bi translated">每个矩形的大小和颜色</li></ol><p id="b4d7" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">在我们的数据框中，“行业”列显示了每个矩形的标签。“Oct_2021_Quits”列可用于表示每个矩形的大小，显示每个行业部门的辞职总数。“Oct_2021_Quit_Rates”列可用于表示每个矩形的颜色，颜色越深，该部门的周转率越高。</p><p id="f277" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">数据框中唯一缺少的信息是标签/矩形的等级。我们需要创建一个新列(我们可以将其命名为“parent”)来明确定义标签的层次结构。这是通过以下代码实现的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/621e776394e2bf01a5cdea682ca92213.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s6NJSkyls0BDKhmjQVu_zQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7ae9" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">现在我们准备绘制树状图了！在下面的代码中，我们将首先创建一个 graph_objects 图形，然后使用<em class="ny"> go 向它添加 treemap 跟踪。图(去。Treemap())。</em>围棋之内。Treemap()，我们通过<code class="fe nz oa ob oc b">values</code>和<code class="fe nz oa ob oc b">parents</code>属性来定义层次结构。每个矩形的大小/面积由<code class="fe nz oa ob oc b">values</code>属性定义，颜色由<code class="fe nz oa ob oc b">marker</code>属性定义。我们也可以通过用 HTML 代码编辑<code class="fe nz oa ob oc b">hovertemplate</code>属性来自定义工具提示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/90fc52a37eda4fbb9e2006327797adb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jMbX2ayWZeYGxQLrRHCUkw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="1f9c" class="kz la it bd lb lc nb le lf lg nc li lj jz nd ka ll kc ne kd ln kf nf kg lp lq bi translated">微调树形图</h1><p id="122a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们刚刚创建的树形图看起来不错！使用 Plotly 创建一个只有几行代码的树形图似乎非常简单方便！请注意，在上面的树形图中，一些行业被压缩成非常小的矩形，由于矩形的大小，标签难以辨认。让我们微调树形图来解决这些问题。</p><p id="2ffe" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">在我们的可视化中，由于我们主要对不同行业的辞职率感兴趣，而不是辞职的数量，我们可以从前面的代码中删除<code class="fe nz oa ob oc b">value</code>属性。由于没有给<code class="fe nz oa ob oc b">value</code>属性分配一个指标，一个类别的面积现在被平均分配给其父类别中的其他子类别。</p><p id="0b15" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">我们也可以通过使用<code class="fe nz oa ob oc b">uniformtext</code>布局参数来强制所有的文本标签具有相同的字体大小。<code class="fe nz oa ob oc b">minsize</code>属性设置所需的字体大小。<code class="fe nz oa ob oc b">mode</code>属性决定了不适合所需字体大小的标签会发生什么。你可以选择<code class="fe nz oa ob oc b">hide</code>或者<code class="fe nz oa ob oc b">show</code>溢出。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/93201e8dc1881ba4f15d569b4832223b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O8W-E5gnbsV5RmrzQ2jd3A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7f9e" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">现在标签看起来更清楚了，尽管标签溢出了矩形的边界还有一个小问题。不幸的是，Plotly 不能自动换行，所以我们需要手动修复它。</p><p id="5c01" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">在下面的代码中，我们使用 HTML 代码通过<br/>元素将长格式文本分成多行。HTML 元素<br/>在文本中产生一个换行符，并且<br/>之后的文本从文本块的下一行开始重新开始。我们可以将这个换行的文本列命名为“id2”。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="969d" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">现在让我们通过将‘id2’赋给<code class="fe nz oa ob oc b">labels</code>属性来完成我们的绘图。我们还将添加一个图表标题，指定标题的字体大小，并将其放在树形图上方的中心位置。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/3fcd641bcce108da18aa27068e675f8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UDVw-BlluuglD0MQR3p6rQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">树形图(图片由作者提供)</p></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="5f14" class="kz la it bd lb lc nb le lf lg nc li lj jz nd ka ll kc ne kd ln kf nf kg lp lq bi translated">奖励:旭日图和冰柱图</h1><p id="aaf1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在可视化分层数据时，还有一些其他图表类型与 treemaps 非常相似，比如 sunburst 图表和 icicle 图表。这两种图表类型的输入数据格式与树形图相同:层次结构由<code class="fe nz oa ob oc b">labels</code>和<code class="fe nz oa ob oc b">parents</code>属性定义。</p><p id="989f" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">要绘制旭日图和冰柱图，代码中唯一需要修改的就是替换<em class="ny"> go。带<em class="ny"> go 的树形图</em>。旭日()</em>或<em class="ny"> go。冰柱()。</em>下面的代码用于创建旭日图。旭日图直观地显示了从根到叶径向向外延伸的分层数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/636d729fdb000b51f1a8fa9d78bcf743.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*YOpXT0epYNFbw4evYNDS-A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">旭日图(图片由作者提供)</p></figure><p id="2097" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">冰柱图使用矩形扇区从根到叶沿四个方向之一显示分层数据:上、下、左或右。冰柱图有一个带有两个参数<code class="fe nz oa ob oc b">orientation</code>和<code class="fe nz oa ob oc b">flip</code>的<code class="fe nz oa ob oc b">tiling</code>属性。您可以结合使用这两个参数来创建四个方向中的每一个:水平、垂直、向左或向右。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/ea872dedac37a83eeec1c35ec0f0fbb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e8lh9vLt_wrtGRDOgR4Dlg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">冰柱图(图片由作者提供)</p></figure><p id="13ef" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">与条形图、折线图或饼图等其他图表类型相比，树状图、旭日图和冰柱图是不太常见的可视化形式。然而，当涉及到可视化分层数据时，它们绝对是完成工作的完美选择，既漂亮又高效！感谢您的阅读，我希望您发现这篇文章有助于提高您的绘图和数据可视化技能！</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><p id="4cab" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">参考和数据来源:</p><ol class=""><li id="cd50" class="nj nk it lt b lu mo lx mp ma nl me nm mi nn mm no np nq nr bi translated">Plotly 官方文档页面:<a class="ae ky" href="https://plotly.com/python/treemaps/" rel="noopener ugc nofollow" target="_blank">https://plotly.com/python/treemaps/</a></li><li id="0296" class="nj nk it lt b lu ns lx nt ma nu me nv mi nw mm no np nq nr bi translated">数据来源:劳动统计局发布的经济新闻(<a class="ae ky" href="https://www.bls.gov/news.release/jolts.t04.htm" rel="noopener ugc nofollow" target="_blank">https://www.bls.gov/news.release/jolts.t04.htm</a>)。这是一个没有许可的开放数据集。</li></ol></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><p id="8598" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">你可以通过这个<a class="ae ky" href="https://medium.com/@insightsbees/membership" rel="noopener">推荐链接</a>注册 Medium 会员(每月 5 美元)来获得我的作品和 Medium 的其他内容。通过这个链接注册，我将收到你的一部分会员费，不需要你额外付费。谢谢大家！</p></div></div>    
</body>
</html>