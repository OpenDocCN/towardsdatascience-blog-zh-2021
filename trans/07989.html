<html>
<head>
<title>The Difference Between Surrogate and Primary Keys</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">代理键和主键的区别</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-difference-between-surrogate-and-primary-keys-222cf31ddb57?source=collection_archive---------12-----------------------#2021-07-22">https://towardsdatascience.com/the-difference-between-surrogate-and-primary-keys-222cf31ddb57?source=collection_archive---------12-----------------------#2021-07-22</a></blockquote><div><div class="fc ij ik il im in"/><div class="io ip iq ir is"><div class=""/><div class=""><h2 id="0ffc" class="pw-subtitle-paragraph js iu iv bd b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj dk translated">什么时候用各种流行来源的例子</h2></div><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/16cbe216aeb2bfb39208e57acd6019c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rwe3OONnTmqJCvrm-qkBww.jpeg"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">弗洛里安·伯杰在<a class="ae la" href="https://unsplash.com/s/photos/keys?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="fcf5" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">最近，我一直致力于重建整个数据堆栈，并找出用dbt编写模型的最佳方式。我最近<a class="ae la" href="https://docs.getdbt.com/docs/building-a-dbt-project/building-models/configuring-incremental-models" rel="noopener ugc nofollow" target="_blank">学习了</a>关于增量模型以及如何实现它们。这对我来说是一件全新的事情，我期待着在进一步探索后与大家分享。</p><p id="3aee" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">在阅读关于增量模型的文档时，我了解到我需要在每个表中拥有一个惟一的键。这对于更新和删除数据仓库中的记录至关重要。在安慰了dbt Slack通道之后，有人建议我使用<code class="fe lx ly lz ma b">dbt_utils.surrogate_key</code>函数为我的表生成一个惟一的键。</p><p id="2903" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">这就是导致我产生这个问题的原因…代理键和主键之间有什么区别？我非常熟悉主键和外键，以及它们如何与关系数据库一起工作。以至于我写了一篇关于他们的文章！然而，直到现在我才听说过代理键。</p><p id="a269" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">事实证明，代理键与主键非常相似，因为它是表中对象的惟一值。但是，它不是从表中的实际数据派生出来的，而是由对象本身生成的字段。它不像主键那样具有商业价值，而是仅用于数据分析目的。如果你想到代理的这个<a class="ae la" href="https://en-academic.com/dic.nsf/enwiki/263746" rel="noopener ugc nofollow" target="_blank">定义</a>“外部世界中的一个<em class="mb">实体</em>”——那么这种差异是有意义的。</p><p id="ce97" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">代理键通常是数据库中的序列号，如PostgreSQL <code class="fe lx ly lz ma b">serial</code>列、Oracle <code class="fe lx ly lz ma b">sequence</code>列或MySQL <code class="fe lx ly lz ma b">auto_increment</code>列。作为Fivetran和雪花的用户，我认为<code class="fe lx ly lz ma b">_file</code>和<code class="fe lx ly lz ma b">_line</code>列的组合是一个代理键。</p><p id="1c1d" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">您可以使用表中已经存在的不同列来生成代理键，而不是作为一个字段。如果您将Fivetran与雪花一起使用，您可以使用<code class="fe lx ly lz ma b">_file</code>和<code class="fe lx ly lz ma b">_line</code>为您的表创建一个代理键，以便惟一地标识每一行。正如开始提到的，我使用<code class="fe lx ly lz ma b">dbt_utils.surrogate_key</code>来做这件事。</p><p id="c7e0" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">下面是一个使用部门id和员工id生成代理键的例子。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi mc"><img src="../Images/995fa653850f58a467f975794b8eaba4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*upKcdpMyn4wxcKk8wuHj4A.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</p></figure><p id="b327" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">它们通常是使用跨两个不同表的字段生成的，正如dbt的代理键函数的<a class="ae la" href="https://github.com/dbt-labs/dbt-utils#surrogate_key-source" rel="noopener ugc nofollow" target="_blank">定义</a>中提到的。</p><p id="0905" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">当您的表中没有主键，但需要唯一的标识符时，代理键是理想的解决方案。它们对于性能和检测历史记录中的变化非常有用。我目前正在我的表中实现它们，以确保尽可能平稳地运行增量模型。它们将在插入、更新和删除记录时帮助雪花的合并语句。</p><p id="5d68" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">希望这能消除您对代理键和主键之间的区别的任何困惑。现在，您可以在您的数据库中成功地实现它们，对两者之间的差异及其用例充满信心。查询愉快！</p></div></div>    
</body>
</html>