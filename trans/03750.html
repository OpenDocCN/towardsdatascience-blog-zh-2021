<html>
<head>
<title>Deploying Python GitHub Actions to Marketplace</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Python GitHub操作部署到市场</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploying-python-github-actions-to-marketplace-d07790e9817d?source=collection_archive---------11-----------------------#2021-03-28">https://towardsdatascience.com/deploying-python-github-actions-to-marketplace-d07790e9817d?source=collection_archive---------11-----------------------#2021-03-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="58bf" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">将Python脚本作为没有Dockers的操作运行</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b2c399a76f07007e925b5223a37ea83b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IYjqk2YH3XfHntUX"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">杰佛森·桑多斯在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><blockquote class="kw kx ky"><p id="b531" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">查看此处开发的动作:</p></blockquote><div class="lw lx gp gr ly lz"><a href="https://github.com/kaustubhgupta/readme-projects-display" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">kaustubhgupta/readme-项目-显示</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">GitHub的个人资料自述文件是向潜在的招聘人员/开发人员展示您的技能和项目的一个很好的工具。这个…</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">github.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn kp lz"/></div></div></a></div><h1 id="6880" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">为什么是Python？</h1><p id="94a2" class="pw-post-body-paragraph kz la iq lc b ld ng jr lf lg nh ju li ni nj ll lm nk nl lp lq nm nn lt lu lv ij bi translated">我使用GitHub actions已经有一段时间了，我相信它比目前的用法有更大的潜力。我见过很多GitHub动作自动化任务的用例，但是一个值得注意的事情是，这些动作主要是使用Javascript和Dockers完成的。如果你在GitHub中搜索“<a class="ae kv" href="https://github.com/search?o=desc&amp;q=github+actions&amp;s=stars&amp;type=Repositories" rel="noopener ugc nofollow" target="_blank"> GitHub Action </a>”这个词，你会看到一长串使用或者做出这个动作的库。根据所选的编程语言，结果如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/2a2691adb24c023e76738de1101ecf2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/1*dMYovC2HZ1OFC1owKizubA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来自GitHub <a class="ae kv" href="https://github.com/search?o=desc&amp;q=github+actions&amp;s=stars&amp;type=Repositories" rel="noopener ugc nofollow" target="_blank">搜索结果</a>的截图(数字在28/03/21)</p></figure><p id="1e08" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li ni lk ll lm nk lo lp lq nm ls lt lu lv ij bi translated">这些数字清楚地表明，使用Python的存储库非常少。主要原因是GitHub在为市场构建动作的同时正式支持Docker和Javascript。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/5ecb6447a4abbff7e51875603ac98305.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ah3vEyxXN1OC-GLVMlxEOw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来自<a class="ae kv" href="https://docs.github.com/en/actions/creating-actions/about-actions#types-of-actions" rel="noopener ugc nofollow" target="_blank">行动文件</a>的截图</p></figure><p id="60e3" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li ni lk ll lm nk lo lp lq nm ls lt lu lv ij bi translated">这并不意味着不支持其他语言，但是它们的解决方法很复杂。需要对Dockers有很好的理解，如果动作使用当前repo中的文件，那么如何管理动作的路径。</p><p id="95d4" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li ni lk ll lm nk lo lp lq nm ls lt lu lv ij bi translated">在本文中，我将向您展示在没有Dockers的情况下发布基于Python的GitHub操作的最佳方式！</p><h1 id="8434" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">形势</h1><p id="162c" class="pw-post-body-paragraph kz la iq lc b ld ng jr lf lg nh ju li ni nj ll lm nk nl lp lq nm nn lt lu lv ij bi translated">我在本文中构建的GitHub动作是为了用用户在其GitHub帐户上托管/推送的项目信息更新GitHub概要自述文件。这个特殊的自述文件显示在公开的个人资料上，这已经成为一种趋势，每个人都试图让它尽可能吸引人。GitHub统计数据、最新的博客帖子显示或提交活动是用户已经集成到他们的个人资料中的一些著名的工作流类型。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/f3cf92d01c76c7062c3458a1b982900d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*reTvik2dqFz1fF9tzl-XJw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">统计数据示例(作者图片)</p></figure><p id="9ab6" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li ni lk ll lm nk lo lp lq nm ls lt lu lv ij bi translated">我想创建一个类似的动作，更新用户的项目信息，如星星，描述中的任何变化，或任何其他新的项目添加。让我们看看我是如何制作基本工作流程的。</p><h1 id="8f5e" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">编码时间！</h1><p id="13c9" class="pw-post-body-paragraph kz la iq lc b ld ng jr lf lg nh ju li ni nj ll lm nk nl lp lq nm nn lt lu lv ij bi translated">逻辑非常简单。由于人们不能从100个储存库中确定以下哪些储存库有资格显示在简档部分上，因此这项工作必须由用户手动完成。我们的工作是将“项目”主题添加到每个存放项目文件的存储库中。这个标签将帮助我筛选出将包含在项目部分中的存储库。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/31895282df02f427e2d9b24f5fe125da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m7yDruFN3s3jIZJ1hV-kLg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">标记为项目的我的存储库示例</p></figure><p id="a12e" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li ni lk ll lm nk lo lp lq nm ls lt lu lv ij bi translated">接下来，我需要提出这样的逻辑，即每次触发动作时，只修改自述文件的特定部分，而不是整个文件。为此，我参考了<a class="ae kv" href="https://github.com/eugeneyan/eugeneyan" rel="noopener ugc nofollow" target="_blank">的自述工作流程。</a>我修改了一般用法的逻辑。另外，在我之前的项目中，还有一点被忽略了，那就是只有当内容发生变化时，才应该提交。这部分采取了一系列的点击和试验，想出了一个解决方案。整个脚本并没有花太多时间来编码，下面是代码的样子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="9ded" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li ni lk ll lm nk lo lp lq nm ls lt lu lv ij bi translated">我从用户那里获得4个输入:GitHub访问令牌、readme文件的名称、检出存储库的路径(我将在下面详细讨论)以及存储库描述的最大字符数。所有这些输入都来自命令行。下一步也是最后一步是将脚本作为工作流中的操作运行。</p><h1 id="24a2" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">操作、工作流和发布</h1><p id="d940" class="pw-post-body-paragraph kz la iq lc b ld ng jr lf lg nh ju li ni nj ll lm nk nl lp lq nm nn lt lu lv ij bi translated">我在以前的一篇文章中描述了动作和工作流之间的区别，所以我在这里简单介绍一下。动作是任务，可以是称为工作流的任何更大任务的一部分。实际上，配置文件自述文件可以有一个工作流，其中包含多个更新不同部分的操作。我上面展示的脚本实际上是一个动作，在它公开后可以成为任何工作流的一部分。</p><p id="aed6" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li ni lk ll lm nk lo lp lq nm ls lt lu lv ij bi translated">GitHub制作了一个流程，用于制作一个动作供其他用户使用。必须在动作存储库的根目录下创建一个名为action.yml的文件，该文件包含动作的所有输入输出。此外，它还定义了操作运行的环境。这就是Python脚本需要额外步骤的地方。</p><p id="234a" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li ni lk ll lm nk lo lp lq nm ls lt lu lv ij bi translated">在<strong class="lc ir">运行参数</strong>中，我们需要使用<strong class="lc ir">组合。</strong>composite采用强制步骤参数，steps参数采用两个强制参数:run和shell。YAML文件最好的部分是它们本质上是分层的，缩进定义了参数的级别。下面是我如何定义我的action.yml runs参数:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><blockquote class="kw kx ky"><p id="f684" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir">重要的事情:</strong>无论你什么时候公开动作，文件的路径都不会一样。要在操作运行时获取文件的确切路径，可以使用github.action_path变量。这些变量被称为上下文信息，GitHub提供了大量的上下文变量，可以在运行操作时使用。查看这个<a class="ae kv" href="https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context" rel="noopener ugc nofollow" target="_blank">文档</a>获取完整列表。</p><p id="e79e" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我使用了action_path和workspace路径，因为这两个路径服务于不同的目的。动作路径是存储动作文件的位置。它们存储在:</p><p id="fe0d" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">/home/runner/work/_ actions/{ git _ username }/{ action _ repo }/master/</p><p id="5f9e" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">工作区路径是当前存储库被检出的地方，在那里触发了这个动作(称之为克隆的)。</p><p id="a861" class="kz la lb lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">/home/runner/work/{检查的回购名称}/{检查的回购名称}/</p></blockquote><h1 id="3fef" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">来试试动作吧！</h1><p id="66c3" class="pw-post-body-paragraph kz la iq lc b ld ng jr lf lg nh ju li ni nj ll lm nk nl lp lq nm nn lt lu lv ij bi translated">既然动作是公开的，我们可以在任何配置文件中使用它。此操作要求您在自述文件中添加特殊注释:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="bcd1" class="nz mp iq nv b gy oa ob l oc od">&lt;!-- PROJECTS START --&gt;<br/>&lt;!-- PROJECTS END --&gt;</span></pre><p id="9c25" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li ni lk ll lm nk lo lp lq nm ls lt lu lv ij bi translated">接下来，创建一个目录:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="5516" class="nz mp iq nv b gy oa ob l oc od">.github/workflows/&lt;any_name&gt;.yml</span></pre><p id="dcd8" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li ni lk ll lm nk lo lp lq nm ls lt lu lv ij bi translated">并粘贴以下起始代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="c4a5" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li ni lk ll lm nk lo lp lq nm ls lt lu lv ij bi translated">现在，该特定部分将使用您的项目信息进行更新！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/c02fefcc2c0f817f28e1823aaa3e5e59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vzIbtO9lTaWecKakss_UTQ.png"/></div></div></figure><h1 id="7d3e" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">结论</h1><p id="1007" class="pw-post-body-paragraph kz la iq lc b ld ng jr lf lg nh ju li ni nj ll lm nk nl lp lq nm nn lt lu lv ij bi translated">使用Github动作、上下文变量和触发器可以实现很多事情。这个特别的动作是受<a class="ae kv" href="https://github.com/marketplace/actions/blog-post-workflow" rel="noopener ugc nofollow" target="_blank">博客-文章-工作流程</a>的启发。</p><p id="22f5" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li ni lk ll lm nk lo lp lq nm ls lt lu lv ij bi translated">你可以在<a class="ae kv" href="https://www.linkedin.com/in/kaustubh-gupta/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>和<a class="ae kv" href="https://github.com/kaustubhgupta" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上和我联系。</p><p id="474a" class="pw-post-body-paragraph kz la iq lc b ld le jr lf lg lh ju li ni lk ll lm nk lo lp lq nm ls lt lu lv ij bi translated">查看我的其他以Python为中心的文章:</p><div class="lw lx gp gr ly lz"><a rel="noopener follow" target="_blank" href="/rebuilding-my-7-python-projects-8c629079c8e6"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">重建我的7个Python项目</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">这就是我如何重建我的Python项目:数据科学、Web开发和Android应用程序</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="of l mk ml mm mi mn kp lz"/></div></div></a></div><div class="lw lx gp gr ly lz"><a rel="noopener follow" target="_blank" href="/3-ways-to-convert-python-app-into-apk-77f4c9cd55af"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">将Python应用程序转换为APK的3种方法</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">结束构建Python系列的Android应用程序！</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="og l mk ml mm mi mn kp lz"/></div></div></a></div><div class="lw lx gp gr ly lz"><a rel="noopener follow" target="_blank" href="/run-python-code-on-websites-exploring-brython-83c43fb7ac5f"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">在网站上运行Python代码:探索Brython</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">Python中的JavaScript等效脚本</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="oh l mk ml mm mi mn kp lz"/></div></div></a></div><div class="lw lx gp gr ly lz"><a rel="noopener follow" target="_blank" href="/building-android-apps-with-python-part-1-603820bebde8"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">用Python构建Android应用程序:第1部分</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">使用Python构建Android应用程序的分步指南</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">towardsdatascience.com</p></div></div><div class="mi l"><div class="oi l mk ml mm mi mn kp lz"/></div></div></a></div></div></div>    
</body>
</html>