<html>
<head>
<title>Packing circles</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">包装圈</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/packing-circles-a9d1f775353b?source=collection_archive---------28-----------------------#2021-07-15">https://towardsdatascience.com/packing-circles-a9d1f775353b?source=collection_archive---------28-----------------------#2021-07-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="20a3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">交互式层次图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/835af8bf46814afeda36541c34d09e87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MtvZCDV7-ijeWzG2xBnP3g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">美国所有县的Circlepacker可视化(按人口)-图片按作者</p></figure><p id="4990" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你是否曾经处理过层次数据，并努力使其可视化？那这篇文章就送给你了！我最近偶然发现了<strong class="la iu"> R </strong>中的便捷的<a class="ae lu" href="http://jeromefroe.github.io/circlepackeR/" rel="noopener ugc nofollow" target="_blank"><strong class="la iu">circle packer</strong></a><strong class="la iu"/>包，它使您能够创建交互式图表，便于分层数据的可视化，我想与您分享我的经验。</p><h1 id="03a0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">先决条件</h1><p id="021f" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">为了创建如上所述的类似可视化，您首先需要安装以下软件包:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="af4a" class="mx lw it mt b gy my mz l na nb">devtools::install_github("jeromefroe/circlepackeR")<br/>install.packages("data.tree")<br/>install.packages("htmlwidgets")</span><span id="3682" class="mx lw it mt b gy nc mz l na nb">library(circlepackeR)<br/>library(data.tree)<br/>library(htmlwidgets)</span></pre><h1 id="50fe" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">数据</h1><p id="4e74" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">在这个简短的示例中，我将使用包含州名、县名及其人口的美国县数据:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="e5a7" class="mx lw it mt b gy my mz l na nb">head(counties)</span><span id="c2de" class="mx lw it mt b gy nc mz l na nb"># A tibble: 3,093 x 5<br/>   country       state   county   population                       <br/>   &lt;chr&gt;         &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt;                             United States Alabama Autauga       55380 <br/>United States Alabama Baldwin      212830 <br/>United States Alabama Barbour       25361 <br/>United States Alabama Bibb          22493 <br/>United States Alabama Blount        57681 <br/>United States Alabama Bullock       10248 <br/> </span></pre><h1 id="2e9c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">预处理</h1><p id="3b2b" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">为了准备好数据，我们需要应用两个预处理步骤:</p><h2 id="b52d" class="mx lw it bd lx nd ne dn mb nf ng dp mf lh nh ni mh ll nj nk mj lp nl nm ml nn bi translated">1.添加路径字符串列</h2><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="f4a6" class="mx lw it mt b gy my mz l na nb">counties$pathString &lt;- paste(“world”, counties$country, counties$state, counties$county, sep = “/”)</span></pre><p id="3577" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">新列应该被称为“pathString ”,并将您想要显示的所有层次级别连接成一个长字符串，该字符串以单词“world”开头，并使用“/”作为分隔符。在这一步之后，带有新添加的列的数据帧看起来是这样的:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="d83a" class="mx lw it mt b gy my mz l na nb">country       state   county   population pathString                          <br/>   &lt;chr&gt;         &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;                               <br/>United States Alabama Autauga       55380 world/United States/Alabama/Autauga <br/>United States Alabama Baldwin      212830 world/United States/Alabama/Baldwin <br/>United States Alabama Barbour       25361 world/United States/Alabama/Barbour <br/>United States Alabama Bibb          22493 world/United States/Alabama/Bibb    <br/>United States Alabama Blount        57681 world/United States/Alabama/Blount  <br/>United States Alabama Bullock       10248 world/United States/Alabama/Bullock</span></pre><h2 id="6e4b" class="mx lw it bd lx nd ne dn mb nf ng dp mf lh nh ni mh ll nj nk mj lp nl nm ml nn bi translated">2.将数据帧转换成一个<code class="fe no np nq mt b">data.tree</code>数据结构</h2><p id="f8c3" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">第二个预处理步骤包括将数据帧转换成data.tree数据结构。这听起来很复杂，但可以通过下面的函数轻松完成:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="1165" class="mx lw it mt b gy my mz l na nb">nodes &lt;- as.Node(counties)</span></pre><p id="3780" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是新创建的结构的样子:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="7822" class="mx lw it mt b gy my mz l na nb">levelName<br/>world <br/>° — United States <br/>¦ — Alabama <br/>¦ ¦ — Autauga <br/>¦ ¦ — Baldwin <br/>¦ ¦ — Barbour<br/>¦ ¦ — Blount<br/>¦ ¦ — Bullock<br/>..</span></pre><p id="8f3b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们准备好创造我们的观想了！</p><h1 id="22a2" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建圆形包装图</h1><p id="82d9" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">创建circlepackeR图再简单不过了。只需运行以下代码:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="04f4" class="mx lw it mt b gy my mz l na nb">#create circlepacker graph<br/>p &lt;- circlepackeR(nodes, <br/>                  size="population", <br/>                  color_min=rgb(255/255,0/255,0/255), <br/>                  color_max=rgb(0/255,0/255,0/255), <br/>                  width=1200, <br/>                  height=1200)<br/></span><span id="4e1c" class="mx lw it mt b gy nc mz l na nb">#save the circle graph<br/>saveWidget(p, file="circles.html")</span></pre><p id="c15f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">注意上面的论点:</strong></p><ul class=""><li id="127f" class="nr ns it la b lb lc le lf lh nt ll nu lp nv lt nw nx ny nz bi translated"><strong class="la iu"> size </strong>:应该作为每个圆大小的列名。</li><li id="b7d0" class="nr ns it la b lb oa le ob lh oc ll od lp oe lt nw nx ny nz bi translated"><strong class="la iu">颜色最小值:</strong>圆圈颜色范围的最小值。可以是十六进制、RGB或HSL颜色。</li><li id="d4ad" class="nr ns it la b lb oa le ob lh oc ll od lp oe lt nw nx ny nz bi translated"><strong class="la iu"> color_max: </strong>圆圈颜色范围的最大值。可以是十六进制、RGB或HSL颜色。</li><li id="3771" class="nr ns it la b lb oa le ob lh oc ll od lp oe lt nw nx ny nz bi translated"><strong class="la iu"> width: </strong>创建的圆形图形的宽度<strong class="la iu"> </strong>(像素)(如果图形很大，尤其有用)</li><li id="b57a" class="nr ns it la b lb oa le ob lh oc ll od lp oe lt nw nx ny nz bi translated"><strong class="la iu">高度:</strong>高度<strong class="la iu"> </strong>(像素)所创建的圆形图形(如果你的图形很大的话特别有用)</li></ul><p id="9317" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">保存图表后，您将在指定的目录中看到一个HTML文件，该文件可以通过电子邮件或嵌入在网页中与其他人共享。此外，您可以使用<a class="ae lu" href="http://www.codepen.io" rel="noopener ugc nofollow" target="_blank"> codepen.io </a>将它嵌入到一篇中型文章中(复制HTML源代码并根据它创建一个codepen，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div></figure><h1 id="e87e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">调整图表</h1><p id="0975" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">该图通常显示得很好，但有时导出图的字体大小有点太小。不幸的是，字体大小和任何其他样式选项都不能在图形创建过程中设置，但是您可以做一些事情！</p><p id="da48" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于导出的文件是一个HTML文件，您可以简单地在任何编辑器中打开它并搜索CSS声明:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="0522" class="mx lw it mt b gy my mz l na nb">&lt;style type=”text/css”&gt;.circlepackeR .node {</span><span id="7bd7" class="mx lw it mt b gy nc mz l na nb">cursor: pointer;</span><span id="fc67" class="mx lw it mt b gy nc mz l na nb">}</span><span id="53e9" class="mx lw it mt b gy nc mz l na nb">.circlepackeR .node:hover {<br/>stroke: #000;<br/>stroke-width: 1.5px;<br/>}</span><span id="3068" class="mx lw it mt b gy nc mz l na nb">.circlepackeR .node — leaf {<br/>fill: white;<br/>}</span><span id="588a" class="mx lw it mt b gy nc mz l na nb">.circlepackeR .label {<br/>font: 11px “Helvetica Neue”, Helvetica, Arial, sans-serif;<br/>text-anchor: middle;<br/>text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff, 0 -1px 0 #fff;<br/>}</span><span id="c253" class="mx lw it mt b gy nc mz l na nb">.circlepackeR .label,<br/>.circlepackeR .node — root,<br/>.circlepackeR .node — leaf {<br/>pointer-events: none;<br/>}</span><span id="6e7c" class="mx lw it mt b gy nc mz l na nb">&lt;/style&gt;</span></pre><p id="f9b5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你有一些CSS知识，你会发现修改图形的布局很容易。如果以前从未使用过CSS，这里是你如何改变字体大小和改变圆形轮廓的颜色:</p><h2 id="f2dc" class="mx lw it bd lx nd ne dn mb nf ng dp mf lh nh ni mh ll nj nk mj lp nl nm ml nn bi translated">更改字体样式</h2><p id="8bb7" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">只需通过指定像素数(如15px)来更改字体大小。此外，您可以将字体名称从“Helvetica新”更改为任何想要的字体:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="47d7" class="mx lw it mt b gy my mz l na nb">.circlepackeR .label {<br/>font: 15px “Helvetica Neue”, Helvetica, Arial, sans-serif;<br/>text-anchor: middle;<br/>text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff, 0 -1px 0 #fff;<br/>}</span></pre><h2 id="43bd" class="mx lw it bd lx nd ne dn mb nf ng dp mf lh nh ni mh ll nj nk mj lp nl nm ml nn bi translated">更改圆形轮廓颜色</h2><p id="8c55" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">如果你想改变圆轮廓(笔画)的颜色，你可以简单地在这里指定所需的十六进制代码(例如#FF0000):</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="5a94" class="mx lw it mt b gy my mz l na nb">.circlepackeR .node:hover {<br/>stroke: #FF0000;<br/>stroke-width: 1.5px;<br/>}</span></pre><p id="8433" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望这对你们中的一些人有用！</p><h1 id="98cc" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">进一步阅读</h1><p id="4ded" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated"><strong class="la iu">【1】</strong>jeromefroe—D3可缩放圆形装箱可视化(教程):【http://jeromefroe.github.io/circlepackeR/】T2</p><p id="3ab0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">【2】</strong>circle packer Github库:<a class="ae lu" href="https://github.com/jeromefroe/circlepackeR" rel="noopener ugc nofollow" target="_blank">https://github.com/jeromefroe/circlepackeR</a></p></div></div>    
</body>
</html>