<html>
<head>
<title>Data Visualisation Principles Part 1 — A Practical Example in Altair</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据可视化原理第1部分Altair中的一个实际例子</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-visualisation-principles-part-1-a-practical-example-in-altair-b6e16f665fc6?source=collection_archive---------34-----------------------#2021-06-18">https://towardsdatascience.com/data-visualisation-principles-part-1-a-practical-example-in-altair-b6e16f665fc6?source=collection_archive---------34-----------------------#2021-06-18</a></blockquote><div><div class="fc ik il im in io"/><div class="ip iq ir is it"><h2 id="1271" class="iu iv iw bd b dl ix iy iz ja jb jc dk jd translated" aria-label="kicker paragraph">数据可视化</h2><div class=""/><div class=""><h2 id="5517" class="pw-subtitle-paragraph kc jf iw bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">关于如何在Python Altair中构建、定制和添加注释到简单条形图的实用教程</h2></div><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj ku"><img src="../Images/3ac533cef7ccfd3c5cfe416159532943.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ewu_Fy20ggMuePi0uxMYw.jpeg"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">图片来自<a class="ae lk" href="https://pixabay.com/users/leni_und_tom-4330980/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4996834" rel="noopener ugc nofollow" target="_blank"> Leni_und_Tom </a>来自<a class="ae lk" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4996834" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure><p id="d5b8" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated"><strong class="ln jg">数据可视化</strong>，这是数据科学项目的最后一步，非常重要，因为它<strong class="ln jg">传达分析或探索的结果</strong>。因此，一个优秀的数据科学家至少应该知道数据可视化的基本原理。</p><p id="ced6" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">在我之前的文章中，我讨论了数据可视化的基本原则，包括空白、字体、文本和颜色。</p><p id="635d" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">在本教程中，我<strong class="ln jg">实现了一个如何应用已经分析过的基本原则</strong>的基本示例。详细地说，我描述了如何使用<a class="ae lk" href="https://altair-viz.github.io/#" rel="noopener ugc nofollow" target="_blank"> Altair </a> Python库构建和定制一个简单的条形图。本教程分为四个步骤:</p><ul class=""><li id="ed13" class="mh mi iw ln b lo lp lr ls lu mj ly mk mc ml mg mm mn mo mp bi translated">构建基本图表</li><li id="ad89" class="mh mi iw ln b lo mq lr mr lu ms ly mt mc mu mg mm mn mo mp bi translated">字体</li><li id="5248" class="mh mi iw ln b lo mq lr mr lu ms ly mt mc mu mg mm mn mo mp bi translated">颜色</li><li id="dc8d" class="mh mi iw ln b lo mq lr mr lu ms ly mt mc mu mg mm mn mo mp bi translated">文本</li></ul><p id="f72b" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">作为示例图，我加载了2018年至2020年意大利的混合动力汽车注册量，手动构建。</p><p id="47cf" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">所有代码都可以作为Jupyter笔记本从我的Github库下载。</p><h1 id="bf18" class="mv mw iw bd mx my mz na nb nc nd ne nf kl ng km nh ko ni kp nj kr nk ks nl nm bi translated">加载数据</h1><p id="8ecc" class="pw-post-body-paragraph ll lm iw ln b lo nn kg lq lr no kj lt lu np lw lx ly nq ma mb mc nr me mf mg ip bi translated">首先，我导入将在教程中使用的库:<code class="fe ns nt nu nv b">altair</code>和<code class="fe ns nt nu nv b">pandas</code>。</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="a394" class="oa mw iw nv b gz ob oc l od oe">import altair as alt<br/>import pandas as pd</span></pre><p id="4409" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">现在，我将数据集构建为一个字典列表，包含成对的字典(Year，Value)。然后我从这个基本列表中构建一个数据框架。</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="7387" class="oa mw iw nv b gz ob oc l od oe">data = [ { 'Year' : 2018, 'Value' : 4800},<br/>         { 'Year' : 2019, 'Value' : 12400},<br/>         { 'Year' : 2020, 'Value' : 32000}]</span><span id="a47c" class="oa mw iw nv b gz of oc l od oe">df = pd.DataFrame(data)<br/>df.head()</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj og"><img src="../Images/0466a115cb36aa1e40db1221677ce6de.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*Rriwa5NaZ3pdhZwBJjXFsw.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><h1 id="c9ca" class="mv mw iw bd mx my mz na nb nc nd ne nf kl ng km nh ko ni kp nj kr nk ks nl nm bi translated">构建基本图表</h1><p id="6fa7" class="pw-post-body-paragraph ll lm iw ln b lo nn kg lq lr no kj lt lu np lw lx ly nq ma mb mc nr me mf mg ip bi translated">在构建条形图之前，我将一些基本参数定义为变量:</p><ul class=""><li id="09f6" class="mh mi iw ln b lo lp lr ls lu mj ly mk mc ml mg mm mn mo mp bi translated"><code class="fe ns nt nu nv b">width</code>:图表的宽度，以像素为单位</li><li id="1c1a" class="mh mi iw ln b lo mq lr mr lu ms ly mt mc mu mg mm mn mo mp bi translated"><code class="fe ns nt nu nv b">height</code>:图表的高度，单位为像素。</li></ul><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="05b6" class="oa mw iw nv b gz ob oc l od oe">width = 300<br/>height = 300</span></pre><p id="05ec" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">现在我可以通过调用<code class="fe ns nt nu nv b">Chart()</code>类的<code class="fe ns nt nu nv b">mark_bar()</code>函数来构建基本的条形图。<code class="fe ns nt nu nv b">Chart()</code>类接收要显示的数据帧<code class="fe ns nt nu nv b">df</code>作为输入。为了指定数据和图形视觉方面之间的映射，<code class="fe ns nt nu nv b">altair</code>库提供了<code class="fe ns nt nu nv b">encode()</code>函数。通过这个函数，我指定了轴和数据之间的映射。我还指定哪些信息必须显示在工具提示中。</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="5b65" class="oa mw iw nv b gz ob oc l od oe">bar = alt.Chart(df).mark_bar().encode(<br/>    alt.Y('Value'),<br/>    alt.X('Year:N', title='Anno'),<br/>    tooltip=[alt.Tooltip('Year:N', title='Anno'), alt.Tooltip('Value', format=',', title='Immatricolazioni')]     <br/>)<br/>bar</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj oh"><img src="../Images/3634d4d60d88eb6f44ab9c1ad5642dbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J4IPwPhll46-x1s23puQ3g.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><h1 id="c017" class="mv mw iw bd mx my mz na nb nc nd ne nf kl ng km nh ko ni kp nj kr nk ks nl nm bi translated">字体</h1><p id="8ed0" class="pw-post-body-paragraph ll lm iw ln b lo nn kg lq lr no kj lt lu np lw lx ly nq ma mb mc nr me mf mg ip bi translated">基本图形可以定制，以便立即向读者传达某种信息。例如，我可以让读者注意到这样一个事实，即从2018年到2020年，混合动力汽车的注册量有了令人难以置信的提高。</p><p id="22ac" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我可以通过以下参数自定义轴和图形标题:</p><ul class=""><li id="9c44" class="mh mi iw ln b lo lp lr ls lu mj ly mk mc ml mg mm mn mo mp bi translated"><code class="fe ns nt nu nv b">font</code>:要使用的字体系列。</li><li id="52e9" class="mh mi iw ln b lo mq lr mr lu ms ly mt mc mu mg mm mn mo mp bi translated"><code class="fe ns nt nu nv b">axis_config</code>:关于两个轴的一些<code class="fe ns nt nu nv b">altair</code>属性，包括字体系列、字体大小和标签旋转。关于轴，<code class="fe ns nt nu nv b">altair</code>库提供了两种类型的文本:<strong class="ln jg">标签</strong>和<strong class="ln jg">标题</strong>。标签是指与数据相关联的每一个标签，例如国家的名称。标题是指轴的标题，比如国家。对于每种类型的文本，<code class="fe ns nt nu nv b">altair</code>库允许配置许多属性，比如字体大小和字体系列。</li><li id="dc55" class="mh mi iw ln b lo mq lr mr lu ms ly mt mc mu mg mm mn mo mp bi translated"><code class="fe ns nt nu nv b">scale</code>:关于要使用的y轴刻度的一些<code class="fe ns nt nu nv b">altair</code>属性。我将最大域值设置为40，000，即大于最大数据值的值。</li><li id="11cd" class="mh mi iw ln b lo mq lr mr lu ms ly mt mc mu mg mm mn mo mp bi translated"><code class="fe ns nt nu nv b">title</code>:条形图的标题。</li></ul><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="02eb" class="oa mw iw nv b gz ob oc l od oe">font = 'utopia-std, serif'<br/>axis_config = alt.Axis(labelAngle=0,labelFont=font,titleFont=font, labelFontSize=16, titleFontSize=18)<br/>scale_config=alt.Scale(domain=[0, 40000])<br/>title='Immatricolazioni Auto Ibride'</span></pre><h1 id="17c8" class="mv mw iw bd mx my mz na nb nc nd ne nf kl ng km nh ko ni kp nj kr nk ks nl nm bi translated">颜色</h1><p id="6ed9" class="pw-post-body-paragraph ll lm iw ln b lo nn kg lq lr no kj lt lu np lw lx ly nq ma mb mc nr me mf mg ip bi translated">然后，我可以将读者的注意力集中到最后一年(2020年)，用比其他条形更强烈的颜色突出显示相应的条形。作为颜色，我可以用一种绿色，来标志生态汽车正在增加的事实。我通过一个<code class="fe ns nt nu nv b">condition()</code>设置了<code class="fe ns nt nu nv b">color</code>属性。</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="e549" class="oa mw iw nv b gz ob oc l od oe">bar = alt.Chart(df).mark_bar(tooltip=True).encode(<br/>    alt.Y('Value', axis=axis_config,title=title,scale=scale_config),<br/>    alt.X('Year:N', axis=axis_config, title='Anno'),<br/>    color=alt.condition(<br/>        alt.datum.Year == 2020,  # If the Year is 2020,<br/>        alt.value('#154734'),     # highlight a bar with green.<br/>        alt.value('lightgrey')   # And grey for the rest of the bars<br/>     ),<br/>    tooltip=[alt.Tooltip('Year:N', title='Anno'), alt.Tooltip('Value', format=',', title='Immatricolazioni')]     <br/>)<br/>bar</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj oi"><img src="../Images/749f52f6d5bc8bf381437bd207104b3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ibOwL1v3eOy87rrskt8VA.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><h1 id="3be7" class="mv mw iw bd mx my mz na nb nc nd ne nf kl ng km nh ko ni kp nj kr nk ks nl nm bi translated">文本</h1><p id="4fc5" class="pw-post-body-paragraph ll lm iw ln b lo nn kg lq lr no kj lt lu np lw lx ly nq ma mb mc nr me mf mg ip bi translated">现在，我可以通过计算百分比增长并将其作为注释添加到图表中，明确显示从2018年到2020年的改善情况。</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="da39" class="oa mw iw nv b gz ob oc l od oe">df['Value'][2]/(df['Value'][2] - df['Value'][0])*100</span></pre><p id="8973" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">它给出了以下输出:</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="8448" class="oa mw iw nv b gz ob oc l od oe">117.64705882352942</span></pre><p id="493a" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">百分比增长约为117%，因此我可以在图表中添加一个包含此信息的文本。我利用了<code class="fe ns nt nu nv b">Chart()</code>类的<code class="fe ns nt nu nv b">mark_text()</code>函数。我还指定了字体和其他样式参数。</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="0509" class="oa mw iw nv b gz ob oc l od oe">text = alt.Chart(df<br/>).mark_text(x=width/2, y=20, dx=-5,fontSize=30, color='green',text='+117% nel 2020',font=font<br/>).encode()</span><span id="5d3f" class="oa mw iw nv b gz of oc l od oe">text</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj oj"><img src="../Images/f03b9715c0479a653e89360a9d44c11b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*zPSCbgIMbXRUShw0e7BBRA.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="5a30" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">现在我建立了一条连接2018年和2020年的虚线。我构建了一个数据框架，其中包含四条线的点。</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="89ad" class="oa mw iw nv b gz ob oc l od oe">df_line = pd.DataFrame([<br/>    {'Year': 2018, 'Value' : df['Value'].min()}, <br/>    {'Year': 2018, 'Value' : 35000},<br/>    {'Year': 2020, 'Value' : 35000},<br/>    {'Year': 2020, 'Value' : df['Value'].max()}<br/>])<br/>df_line.head()</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj ok"><img src="../Images/6ab7391697a461737caf03a1ec3ab2ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:496/format:webp/1*VtyiMflSSXGH_Uqn3hDwRQ.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者形象</p></figure><p id="86e3" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">然后，我通过<code class="fe ns nt nu nv b">Chart()</code>类的<code class="fe ns nt nu nv b">mark_line()</code>函数构建线。注意，在这种情况下，<code class="fe ns nt nu nv b">Chart()</code>类接收<code class="fe ns nt nu nv b">df_line</code>数据帧作为输入。</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="b444" class="oa mw iw nv b gz ob oc l od oe">line = alt.Chart(df_line).mark_line(color='#154734').encode(<br/>    alt.Y('Value', axis=axis_config,title=title,scale=scale_config),<br/>    alt.X('Year:N',axis=axis_config, title='Anno', ),<br/>)<br/>line</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj ol"><img src="../Images/55165f24e65e22a864a78dea054823ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6TeU710Ii_xTZOB8iF8ytQ.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者形象</p></figure><p id="9b08" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">最后，我可以简单地通过对它们求和来组合前面的三个图形。我还可以指定最终图表的一些属性，如标题、宽度和高度。</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="3bb5" class="oa mw iw nv b gz ob oc l od oe">final_chart = bar + line + text<br/>final_chart = final_chart.configure_title(<br/>    fontSize=25,<br/>    dy = -15,<br/>    font=font,<br/>).properties(title=title,width=width,height=height)</span><span id="f8d2" class="oa mw iw nv b gz of oc l od oe">final_chart</span></pre><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj om"><img src="../Images/8b14a90ce4caea068d2e4c19ed13c7d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u4qBi8Fm2hff6apEoM-H4g.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者形象</p></figure><p id="b4ef" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">最后，我将图形保存为一个HTML页面，它可以包含在网站的任何地方。</p><pre class="kv kw kx ky gu nw nv nx ny aw nz bi"><span id="86ee" class="oa mw iw nv b gz ob oc l od oe">final_chart.save('html/auto_ibride.html', embed_options={'actions': False})</span></pre><h1 id="e2f5" class="mv mw iw bd mx my mz na nb nc nd ne nf kl ng km nh ko ni kp nj kr nk ks nl nm bi translated">摘要</h1><p id="b033" class="pw-post-body-paragraph ll lm iw ln b lo nn kg lq lr no kj lt lu np lw lx ly nq ma mb mc nr me mf mg ip bi translated">在本教程中，我举例说明了如何在Python <code class="fe ns nt nu nv b">altair</code>中实现的简单条形图中设置颜色、字体和文本。</p><p id="3f62" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">如果你想了解我的研究和其他活动的最新情况，你可以在<a class="ae lk" href="https://twitter.com/alod83" rel="noopener ugc nofollow" target="_blank">推特</a>、<a class="ae lk" href="https://www.youtube.com/channel/UC4O8-FtQqGIsgDW_ytXIWOg?view_as=subscriber" rel="noopener ugc nofollow" target="_blank"> Youtube </a>和<a class="ae lk" href="https://github.com/alod83" rel="noopener ugc nofollow" target="_blank"> Github </a>上关注我。</p><h1 id="3fe7" class="mv mw iw bd mx my mz na nb nc nd ne nf kl ng km nh ko ni kp nj kr nk ks nl nm bi translated">相关文章</h1><div class="on oo gq gs op oq"><a rel="noopener follow" target="_blank" href="/data-visualisation-principles-part-1-white-space-text-and-colour-13f520f90ce9"><div class="or ab fp"><div class="os ab ot cl cj ou"><h2 class="bd jg gz z fq ov fs ft ow fv fx jf bi translated">数据可视化原则第1部分:空白、文本和颜色</h2><div class="ox l"><h3 class="bd b gz z fq ov fs ft ow fv fx dk translated">从基本的平面设计原则开始。</h3></div><div class="oy l"><p class="bd b dl z fq ov fs ft ow fv fx dk translated">towardsdatascience.com</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe le oq"/></div></div></a></div><div class="on oo gq gs op oq"><a rel="noopener follow" target="_blank" href="/how-to-improve-d3-js-graphs-with-annotations-252fbb9c5bb5"><div class="or ab fp"><div class="os ab ot cl cj ou"><h2 class="bd jg gz z fq ov fs ft ow fv fx jf bi translated">如何改进带有注释的D3.js图</h2><div class="oy l"><p class="bd b dl z fq ov fs ft ow fv fx dk translated">towardsdatascience.com</p></div></div><div class="oz l"><div class="pf l pb pc pd oz pe le oq"/></div></div></a></div><div class="on oo gq gs op oq"><a rel="noopener follow" target="_blank" href="/plotly-vs-matplotlib-what-is-the-best-library-for-data-visualization-in-python-89a8b64a9471"><div class="or ab fp"><div class="os ab ot cl cj ou"><h2 class="bd jg gz z fq ov fs ft ow fv fx jf bi translated">plotly VS matplotlib:Python中数据可视化的最佳库是什么？</h2><div class="ox l"><h3 class="bd b gz z fq ov fs ft ow fv fx dk translated">在这个简短的教程中，我将向您展示如何使用plotly和matplotlib库快速构建一个基本的折线图…</h3></div><div class="oy l"><p class="bd b dl z fq ov fs ft ow fv fx dk translated">towardsdatascience.com</p></div></div><div class="oz l"><div class="pg l pb pc pd oz pe le oq"/></div></div></a></div></div></div>    
</body>
</html>