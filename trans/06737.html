<html>
<head>
<title>Complete guide to animating bar charts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">条形图动画制作完全指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/hands-on-tutorial-f2ee5dc4d0a8?source=collection_archive---------25-----------------------#2021-06-17">https://towardsdatascience.com/hands-on-tutorial-f2ee5dc4d0a8?source=collection_archive---------25-----------------------#2021-06-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="02ed" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">制作两种不同风格的条形图动画的分步指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ccf17543d2b13a352750472244ca3142.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*8WeLSczN7MYhxldqj_PGDQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="e6b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi lu translated">图和信息图形式的数据可视化是传达故事的方式。如果这些故事有实质内容并且不言自明，那么它们对大众是有吸引力的。信息图或演示之所以比单纯的情节更受欢迎，是因为它们传达了一个故事，并且是自给自足的。情节只讲述了故事的一部分。为了使情节更有意义，人们可以将一系列的情节堆叠在一起，或者堆叠一系列的情节来创建动画。一个很好的例子是由<a class="ae md" href="https://www.youtube.com/watch?v=jbkSRLYSojo" rel="noopener ugc nofollow" target="_blank">汉斯·罗斯林</a>创作的动画，其中他比较了预期寿命和收入。</p><p id="a24b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这里，我将使用1960年至2019年间10个最大国家的GDP支出数据创建一个条形图竞赛。本教程的重点是:</p><ol class=""><li id="5672" class="me mf it la b lb lc le lf lh mg ll mh lp mi lt mj mk ml mm bi translated">使用GDP支出数据创建从1960年到2019年每个财年前10个国家GDP的动画。</li><li id="c1ab" class="me mf it la b lb mn le mo lh mp ll mq lp mr lt mj mk ml mm bi translated">清楚地展示如何提高默认<code class="fe ms mt mu mv b">ggplot</code>图的质量。</li><li id="4334" class="me mf it la b lb mn le mo lh mp ll mq lp mr lt mj mk ml mm bi translated">提供创建两种不同风格的竞赛条形图的步骤。</li></ol><p id="8d6a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将创建两种不同风格的条形图比赛，一个具有固定轴，另一个具有动态轴。完整的代码可以在我的<a class="ae md" href="https://github.com/amalasi2418/Blog-post/tree/master/Blog%2014-animate" rel="noopener ugc nofollow" target="_blank"> Github库</a>中找到。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><p id="4cd7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">创建条形图比赛动画的灵感来自约翰·伯恩-默多克的推特帖子，他在那里制作了世界上人口最多的10个城市的动画。在本教程中，条形图比赛动画是使用世界银行的世界GDP数据重新创建的。</p><h1 id="ece9" class="nd ne it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">数据准备</h1><p id="bcbc" class="pw-post-body-paragraph ky kz it la b lb nv ju ld le nw jx lg lh nx lj lk ll ny ln lo lp nz lr ls lt im bi translated">如果您打开数据文件，您会注意到相关的列从第5行开始。所以你需要去掉前四行。要么我们可以手动删除它们，要么我们可以在读取CSV文件时编写一个参数，让计算机为您删除它们。让我们走后一条路。要读取CSV文件，加载<code class="fe ms mt mu mv b">readr</code>包，并使用函数<code class="fe ms mt mu mv b">read.csv()</code>。<code class="fe ms mt mu mv b">skip = 4</code>参数跳过文件的前四行。数据由国家名称、国家代码和GDP值组成。为了确保国家名称和国家代码列属于string类，我们将参数设置为<code class="fe ms mt mu mv b">stringsAsFactors = False</code>。</p><pre class="kj kk kl km gt oa mv ob oc aw od bi"><span id="d202" class="oe ne it mv b gy of og l oh oi">gdp &lt;- read.csv("C:/Users/amalasi/Documents/R/Blog post/Blog 14-animate/GDP/GDP.csv", <br/>                skip = 4,stringsAsFactors = F)</span></pre><p id="896e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在预览<code class="fe ms mt mu mv b">gdp</code>变量时，我们注意到一些列是多余的，可以删除。因为我们对使用时间索引创建动画感兴趣，所以我们需要将当前数据表从宽到长重新排列，以增加包含年份和GDP值的列。使用<code class="fe ms mt mu mv b">tidyr</code>包中的<code class="fe ms mt mu mv b">gather()</code>函数，一个新变量<code class="fe ms mt mu mv b">gdp_long</code>被定义为两个名为<em class="oj"> Year </em>和<em class="oj"> GDP_dollar </em>的新列(GDP值以美元为单位)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/8dc1a0053d86f05116f3f83c9a87ab98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L7JvBUKfGvviweQNa_pbGg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><pre class="kj kk kl km gt oa mv ob oc aw od bi"><span id="c4bd" class="oe ne it mv b gy of og l oh oi"># removing reduncdant columns<br/>gdp %&lt;&gt;% select(-c(2:4,65,66))</span><span id="66af" class="oe ne it mv b gy ol og l oh oi"># converting the wide table to long<br/>gdp_long &lt;- gdp %&gt;% gather(Year,GDP_dollar,c(2:61))</span></pre><p id="30af" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将数据转换为长格式后，<em class="oj">年</em>列值显示年值前的<strong class="la iu"> <em class="oj"> X </em> </strong>。为了去掉<strong class="la iu"> <em class="oj"> X </em> </strong>，我们将使用<code class="fe ms mt mu mv b">gsub()</code>函数。我们调用<code class="fe ms mt mu mv b">gsub()</code>函数，第一个参数是我们想要替换的字符串，第二个参数是我们想要替换的字符串，第三个参数是动作发生的数据。我们使用<code class="fe ms mt mu mv b">as.integer()</code>函数将<em class="oj">年</em>列转换为整数。这种到整数变量的转换将在以后制作动画时派上用场。</p><pre class="kj kk kl km gt oa mv ob oc aw od bi"><span id="cc32" class="oe ne it mv b gy of og l oh oi">gdp_long$Year &lt;- as.integer(gsub("X","",gdp_long$Year))</span></pre><p id="8e7e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后一个清理步骤是从<em class="oj">国家中删除几个特定值。名称</em>列。<em class="oj">国家有几个值。Name </em>代表一组国家或地区的列，如阿拉伯世界、加勒比海小国、中欧和波罗的海、海峡群岛等。最好的方法是使用国家的标准ISO代码来删除不需要的数据。由于所有的国家都被分配了一个ISO代码，我们可以利用它。为此，我们将使用<code class="fe ms mt mu mv b">countrycode</code>包中的<code class="fe ms mt mu mv b">countrycode()</code>函数。使用<code class="fe ms mt mu mv b">mutate()</code>函数定义了一个名为Code的新变量。要将国家名称转换成ISO代码，第一个参数是我们想要处理的数据。对于当前情况，发送的数据是国家名称，因此<code class="fe ms mt mu mv b">countrycode()</code>的第二个参数将被设置为<code class="fe ms mt mu mv b">country.name</code>，第三个参数将被设置为<code class="fe ms mt mu mv b">iso3c</code>。这样做的目的是将国家名称转换成3个字母的国家代码。</p><pre class="kj kk kl km gt oa mv ob oc aw od bi"><span id="3b55" class="oe ne it mv b gy of og l oh oi">gdp_long %&gt;% mutate(Code = countrycode(gdp_long$Country.Name,<br/>                                            "country.name","iso3c"))</span></pre><p id="3802" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所有不必要的地区或国家集群没有ISO代码，将被赋予<code class="fe ms mt mu mv b">NA</code>值。我们现在可以过滤数据，删除不必要的数据。</p><pre class="kj kk kl km gt oa mv ob oc aw od bi"><span id="58fa" class="oe ne it mv b gy of og l oh oi">gdp_long %&gt;% mutate(Code = countrycode(gdp_long$Country.Name,<br/>                                            "country.name","iso3c")) %&gt;% <br/>  filter(!is.na(Code))</span></pre><p id="77ac" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于动画来说，我们需要以某种方式排列数据。我们首先将数据按年份分组，并按GDP支出的降序排列。<code class="fe ms mt mu mv b">rank()</code>函数中的负号按降序排列<em class="oj"> GDP_dollar </em>值。我们定义了一个新的变量，通过将GDP值除以10⁹，将GDP值转换为十亿美元。最后一步是过滤数据，提取GDP支出最高的前10个国家，并取消数据分组。</p><pre class="kj kk kl km gt oa mv ob oc aw od bi"><span id="7e01" class="oe ne it mv b gy of og l oh oi">c &lt;- gdp_long %&gt;% mutate(Code = countrycode(gdp_long$Country.Name,<br/>                                            "country.name","iso3c")) %&gt;% <br/>  filter(!is.na(Code)) %&gt;%<br/>  group_by(Year) %&gt;% <br/>  mutate(top_10 = rank(-GDP_dollar), GDP_bil_dol = GDP_dollar/1e9) %&gt;% <br/>  group_by(Country.Name) %&gt;% <br/>  filter(top_10 &lt;= 10) %&gt;% <br/>  ungroup()</span></pre><h1 id="2914" class="nd ne it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">静态条形图</h1><p id="f831" class="pw-post-body-paragraph ky kz it la b lb nv ju ld le nw jx lg lh nx lj lk ll ny ln lo lp nz lr ls lt im bi translated">在数据准备之后，让我们创建一个静态图，以确保我们的图中有我们想要的一切。要创建动画帧，请将数据过滤到年份= 1960，以绘制GDP支出排名前10位的国家。</p><pre class="kj kk kl km gt oa mv ob oc aw od bi"><span id="baf2" class="oe ne it mv b gy of og l oh oi">c %&gt;% filter(Year==1960) %&gt;% <br/>  ggplot(aes(desc(top_10),GDP_bil_dol, fill = Country.Name)) +<br/>  geom_bar(stat = "identity", alpha = 0.3) +<br/>  coord_flip()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/4ee97cca1664326e448f60b1af7f4491.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vI2j4FMejJ6QqWO-6xfMGw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="2eb9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以，我们有一个需要润色的柱状图。我们能做的改善情节外观的几件事是去除灰色背景和图例。添加描述性文本，使其不言自明，并增加字体大小。</p><p id="044b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以做的第一件事是使用<code class="fe ms mt mu mv b">theme_set()</code>函数改变<code class="fe ms mt mu mv b">ggplot</code>的主题。如果有兴趣了解更多关于R中的theme()函数的信息，请查看这篇文章。</p><div class="on oo gp gr op oq"><a rel="noopener follow" target="_blank" href="/master-data-visualization-with-ggplot2-theme-customization-8421695d24e2"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd iu gy z fp ov fr fs ow fu fw is bi translated">使用ggplot2: theme()定制的主数据可视化</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">自定义ggplot2主题，为高效工作流程创建您的个性化主题模板。</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">towardsdatascience.com</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe ks oq"/></div></div></a></div><pre class="kj kk kl km gt oa mv ob oc aw od bi"><span id="f1b0" class="oe ne it mv b gy of og l oh oi">geom_text(aes(y=ifelse(GDP_bil_dol&lt;1000, 500,GDP_bil_dol/2),<br/>                label = paste0(Country.Name,": ",round(GDP_bil_dol,1)," bn USD"), <br/>                hjust = 0),color = "gray30") +<br/>  theme(panel.grid = element_blank(),<br/>        legend.position = "none",<br/>        axis.title = element_text(size = 12),<br/>        axis.title.x = element_text(vjust = -1.5),<br/>        axis.text.y = element_blank(),<br/>        axis.ticks.y = element_blank(),<br/>        axis.text.x = element_text(family = "Roboto", size = 12),<br/>        plot.subtitle = element_text(size = 12),<br/>        plot.caption = element_text(size = 10, face = "italic")<br/>        ) + <br/>  labs(x="", y="GDP, bn USD", caption = " Data: World Bank") +<br/>  ggtitle("Global GDP Ranking", subtitle = "Top 10 ranked countries for year: {frame_time}") </span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/1cfc11cc46d7d97e2c47c6ed192d2eb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E1_Sl5vWoRIqmXyiKQKM0w.jpeg"/></div></div></figure><p id="ab99" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们所做的是过滤数据并绘制出1960年前10个GDP值。这里是添加到<code class="fe ms mt mu mv b">ggplot</code>的图层列表以及使用它们背后的想法。</p><p id="968c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">在绘图面板中添加文本时，geom_text() </strong>很有用。为了在条形旁边显示GDP值，使用<code class="fe ms mt mu mv b"> ifelse</code>语句定义y坐标，因为文本的长度可以变化。我想确保文本保持在大GDP值的绘图边界内。为此，我将GDP的临界值定义为1000。对于低于1000的GDP值，从500值开始打印文本，否则从当前GDP值的中点开始打印。然后使用<code class="fe ms mt mu mv b">paste0()</code>函数定义<em class="oj">标签</em>，因为我想将运行变量与预定义文本合并。接下来，我使用<code class="fe ms mt mu mv b">hjust = 0</code>来确保文本不会从绘图的左边界超出绘图区域。最后，选择<code class="fe ms mt mu mv b">color = "gray30"</code>来匹配轴刻度的颜色。</p><p id="d038" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> theme() </strong>:使用theme函数，我们负责字体大小、字体类型、颜色，如果我们想要网格线、主要和次要刻度、图例、调整文本等。</p><p id="83b2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> labs() </strong>:所有的轴标题和标题都是用这个函数定义的。</p><p id="29af" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">ggtitle() :我用这个函数定义了剧情的标题和副标题。<em class="oj"> {frame_time} </em>来自<code class="fe ms mt mu mv b">gganimate</code>包，将显示运行时间指数。</p><p id="5607" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在最终确定了情节的美感之后，我们将完整的情节表达分配给一个对象<code class="fe ms mt mu mv b">xx</code>。一旦这一步完成，我们就可以制作情节动画了。</p><pre class="kj kk kl km gt oa mv ob oc aw od bi"><span id="7a99" class="oe ne it mv b gy of og l oh oi">xx &lt;- c %&gt;% group_by(Year) %&gt;% <br/>  ggplot(aes(y = desc(top_10),x = GDP_bil_dol)) +<br/>  geom_barh(stat = "identity", aes(fill = Country.Name),alpha = 0.3) +<br/>  geom_text(aes(x=GDP_bil_dol/2,label = paste0(Country.Name,": ",round(GDP_bil_dol,1)," bn USD"), <br/>                hjust=0), color = "gray30") +<br/>  theme(panel.grid = element_blank(),<br/>        legend.position = "none",<br/>        axis.title = element_text(size = 12),<br/>        axis.title.x = element_text(vjust=-1.5),<br/>        axis.text.y = element_blank(),<br/>        axis.ticks.y = element_blank(),<br/>        axis.text.x = element_text(family = "Roboto", size = 12),<br/>        plot.subtitle = element_text(size = 12),<br/>        plot.caption = element_text(size = 10, face = "italic")<br/>  ) + <br/>  labs(y="", x="GDP, bn USD") +<br/>  ggtitle("Global GDP Ranking", subtitle = "Top 10 ranked countries for year: {frame_time}") + labs(caption = " Data: World Bank")</span></pre><h1 id="cbf7" class="nd ne it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">制作条形图动画</h1><p id="0197" class="pw-post-body-paragraph ky kz it la b lb nv ju ld le nw jx lg lh nx lj lk ll ny ln lo lp nz lr ls lt im bi translated">我们有两种可能来激活条形图。在第一种情况下，我们保持轴不变，让棒线随着时间增长。为此，我们需要加载<code class="fe ms mt mu mv b">gganimate</code>包，并开始向ggplot函数添加层。通过添加<code class="fe ms mt mu mv b">transition_time()</code>层，ggplot函数知道哪个变量是运行指数。<code class="fe ms mt mu mv b">transition_time()</code>的参数是定义时间索引的变量，在我们的例子中，它是<em class="oj">年</em>列。我们定义了一个新的对象<code class="fe ms mt mu mv b">p2</code>，并为它分配了更新后的动画参数。</p><pre class="kj kk kl km gt oa mv ob oc aw od bi"><span id="6c4f" class="oe ne it mv b gy of og l oh oi">p2 &lt;- xx + transition_time(Year)</span></pre><p id="4bbb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦定义了过渡时间，我们可以使用<code class="fe ms mt mu mv b">animate()</code>函数创建一个gif动画。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/cd86ed3acebf3102a078ff093ba40a90.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*dFCHKlELnehwAUg58SwNBQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带固定轴的动画(图片由作者提供)</p></figure><p id="b7a6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第二种情况是，具有GDP值的轴随着时间的推移自动调整。我们为第一种情况添加了另一层代码，使用固定的轴。该层由来自<code class="fe ms mt mu mv b">gganimate</code>包的<code class="fe ms mt mu mv b">view_follow()</code>函数组成。<code class="fe ms mt mu mv b">view_follow()</code>功能让您定义哪个轴需要是动态的。默认值设置为两个轴都是动态的。要仅设置一个轴动态，我们可以将参数设置为<code class="fe ms mt mu mv b">fixed_x = TRUE</code>。这样<code class="fe ms mt mu mv b">view_follow()</code>功能知道x轴是固定的。同样，我们可以通过设置参数<code class="fe ms mt mu mv b">fixed_y = TRUE</code>来设置y轴。我们可以使用参数<code class="fe ms mt mu mv b">fixed_x = c(0, NA)</code>设置动态轴的起始范围(类似于y轴)。取决于数据，向量中的第一个值可以是任何起始值，但最终值必须是<code class="fe ms mt mu mv b">NA</code>。用户也可以使用<code class="fe ms mt mu mv b">ease_aes()</code>功能来定义运行动画时数值如何变化。</p><pre class="kj kk kl km gt oa mv ob oc aw od bi"><span id="47ad" class="oe ne it mv b gy of og l oh oi">p2 &lt;- xx + transition_time(Year) + <br/>  # ease_aes('linear', interval = 0.1) +<br/>  view_follow(fixed_x = c(0,NA), fixed_y = TRUE)</span></pre><p id="42c5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在创建gif时，我们可以在<code class="fe ms mt mu mv b">animate()</code>函数中提供参数来定义<code class="fe ms mt mu mv b">nframes</code>或<code class="fe ms mt mu mv b">fps</code>。<code class="fe ms mt mu mv b">nframes</code>为帧数(默认为100)，而<code class="fe ms mt mu mv b">fps</code>为每秒显示帧数的帧率(默认为10 fps)。</p><pre class="kj kk kl km gt oa mv ob oc aw od bi"><span id="0d7e" class="oe ne it mv b gy of og l oh oi"># if using magick for saving gif files<br/>anim &lt;- animate(p2, nframes = 240, fps = 10)</span><span id="1e01" class="oe ne it mv b gy ol og l oh oi"># using gganimate for saving gif files<br/>animate(p2, nframes = 240, fps = 10)</span></pre><p id="3fa1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在使用view_follow()运行修改后的代码时，我们看到轴刻度上的数据在闪烁，轴标题正在交换位置，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/404731338ffebf757b4a9e0fee6671fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*GgS5N3U727Cw5VxQyCfpZQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><blockquote class="ph pi pj"><p id="91ef" class="ky kz oj la b lb lc ju ld le lf jx lg pk li lj lk pl lm ln lo pm lq lr ls lt im bi translated">由于<code class="fe ms mt mu mv b">view_follow()</code>功能与<code class="fe ms mt mu mv b">coord_flip()</code>不兼容，所以出现了问题。此的<a class="ae md" href="https://github.com/thomasp85/gganimate/issues/336" rel="noopener ugc nofollow" target="_blank">修正是不使用<code class="fe ms mt mu mv b">coord_flip()</code>并手动切换ggplot美学中的x轴和y轴或使用<code class="fe ms mt mu mv b">ggstance()</code>包中的<code class="fe ms mt mu mv b">geom_barh()</code>。</a></p></blockquote><p id="3923" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">修复这个问题后，动画gif应该是这样的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/2e9fc435de774c3f0254b542be00f5d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*bMNtq4ewqXeLPTnp5756kQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">动态x轴(图片由作者提供)</p></figure><h1 id="5873" class="nd ne it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">保存动画</h1><p id="65dd" class="pw-post-body-paragraph ky kz it la b lb nv ju ld le nw jx lg lh nx lj lk ll ny ln lo lp nz lr ls lt im bi translated">生成的gif文件可以使用<code class="fe ms mt mu mv b">magick</code>包或<code class="fe ms mt mu mv b">gganimate</code>包保存。</p><pre class="kj kk kl km gt oa mv ob oc aw od bi"><span id="7e45" class="oe ne it mv b gy of og l oh oi"># using magick packagemagick::image_write(anim, path="myanimation.gif")</span><span id="57d5" class="oe ne it mv b gy ol og l oh oi"># using gganimate package<br/>anim_save("myanimation.gif")</span></pre><p id="3c16" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是创建这两个动画gif的完整代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pn po l"/></div></figure><h1 id="0c24" class="nd ne it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">结论</h1><p id="de83" class="pw-post-body-paragraph ky kz it la b lb nv ju ld le nw jx lg lh nx lj lk ll ny ln lo lp nz lr ls lt im bi translated">在上面的教程中，我们实现了:</p><ol class=""><li id="e77c" class="me mf it la b lb lc le lf lh mg ll mh lp mi lt mj mk ml mm bi translated">从GDP数据创建gif文件。</li><li id="f6fb" class="me mf it la b lb mn le mo lh mp ll mq lp mr lt mj mk ml mm bi translated">改进了默认的绘图质量。</li><li id="d760" class="me mf it la b lb mn le mo lh mp ll mq lp mr lt mj mk ml mm bi translated">展示了为相同数据创建gif文件的两种不同方法。</li><li id="04c2" class="me mf it la b lb mn le mo lh mp ll mq lp mr lt mj mk ml mm bi translated">找到了一个解决同时使用<code class="fe ms mt mu mv b">view_follow()</code>和<code class="fe ms mt mu mv b">coord_flip()</code>的限制的方法。</li></ol><p id="f11d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望你喜欢这个关于创建动画条形图的简短教程。最好的方法是探索gganimate来测试可以使用r创建的动画的极限。</p><p id="8e49" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对使用ggplot创建地块感兴趣，请查看以下帖子:</p><div class="on oo gp gr op oq"><a rel="noopener follow" target="_blank" href="/data-visualization-using-ggplot2-5-features-worth-knowing-c0447a760335"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd iu gy z fp ov fr fs ow fu fw is bi translated">使用ggplot2的数据可视化:值得了解的5个特性</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">使用ggplot2包提高dataviz效率的技巧</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">towardsdatascience.com</p></div></div><div class="oz l"><div class="pp l pb pc pd oz pe ks oq"/></div></div></a></div><div class="on oo gp gr op oq"><a rel="noopener follow" target="_blank" href="/master-data-visualization-with-ggplot2-scatter-and-box-plots-2f0c14cf2b26"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd iu gy z fp ov fr fs ow fu fw is bi translated">使用ggplot2的主数据可视化:散点图和箱线图</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">使用散点图和箱线图的数据可视化指南</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">towardsdatascience.com</p></div></div><div class="oz l"><div class="pq l pb pc pd oz pe ks oq"/></div></div></a></div><div class="on oo gp gr op oq"><a rel="noopener follow" target="_blank" href="/master-data-visualization-with-ggplot2-histograms-bar-and-density-plots-86c8290c9adc"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd iu gy z fp ov fr fs ow fu fw is bi translated">使用ggplot2实现主数据可视化:直方图、条形图和密度图</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">关于何时以及如何在R中使用直方图、条形图和密度图的指南</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">towardsdatascience.com</p></div></div><div class="oz l"><div class="pr l pb pc pd oz pe ks oq"/></div></div></a></div><div class="on oo gp gr op oq"><a rel="noopener follow" target="_blank" href="/master-data-visualization-with-ggplot2-pie-charts-spider-plots-and-bar-plots-899a07a15827"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd iu gy z fp ov fr fs ow fu fw is bi translated">使用ggplot2实现主数据可视化:饼图、蜘蛛图和条形图</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">关于在r中创建饼图、蜘蛛图和圆形条形图的指南。</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">towardsdatascience.com</p></div></div><div class="oz l"><div class="ps l pb pc pd oz pe ks oq"/></div></div></a></div><div class="on oo gp gr op oq"><a rel="noopener follow" target="_blank" href="/master-data-visualization-with-ggplot2-theme-customization-8421695d24e2"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd iu gy z fp ov fr fs ow fu fw is bi translated">使用ggplot2: theme()定制的主数据可视化</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">自定义ggplot2主题，为高效工作流程创建您的个性化主题模板。</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">towardsdatascience.com</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe ks oq"/></div></div></a></div><p id="fea7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">链接到<a class="ae md" href="https://github.com/amalasi2418/Blog-post/tree/master/Blog%2014-animate" rel="noopener ugc nofollow" target="_blank"> Github库</a>。</p><p id="6194" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="oj">你可以在</em><a class="ae md" href="https://www.linkedin.com/in/abhinav-malasi/" rel="noopener ugc nofollow" target="_blank"><em class="oj">LinkedIn</em></a><em class="oj">和</em><a class="ae md" href="https://twitter.com/malasi_abhinav" rel="noopener ugc nofollow" target="_blank"><em class="oj">Twitter</em></a><em class="oj">上与我连线，跟随我的数据科学和数据可视化之旅。</em></p></div></div>    
</body>
</html>