<html>
<head>
<title>How many samples do you need?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你需要多少样品？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-many-samples-do-you-need-simulation-in-r-a60891a6e549?source=collection_archive---------23-----------------------#2021-09-30">https://towardsdatascience.com/how-many-samples-do-you-need-simulation-in-r-a60891a6e549?source=collection_archive---------23-----------------------#2021-09-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="66e0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">R中的模拟</h2></div><p id="b57a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在水产养殖中，实验是在装有鱼的水槽中进行的。这些鱼是单独测量的，这是一项乏味而又紧张的工作。我被要求<em class="lb">计算一个人需要采集多少鱼的样本才能维持相当于一个完整样本实验的能量</em>。</p><p id="f948" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了检测整体效果，我使用了来自<strong class="kh ir"> ANOVA </strong>的<strong class="kh ir"> F值</strong>。从这种模型中获得的任何p值表明，在包含多个处理的实验中，任何处理之间是否存在任何'<strong class="kh ir">显著性</strong>'差异。“显著性”的极限通常设置为0.05，这意味着我们接受每20次重复试验中1次的5%<strong class="kh ir">1型错误</strong>或<strong class="kh ir">假阳性率</strong>(这里不深入探讨Frequentist理论)。</p><p id="3b1b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了尝试回答最初的问题，我收到了一个数据集，其中包含了对各种处理的每缸鱼的观察结果。根据频率理论，我们知道获得显著p值的能力——如果真的存在的话——取决于均值、标准差和样本大小。平均值和标准差用于计算处理内的变异系数，以及处理间的效应大小。在这个例子中，效果大小是处理之间的差异，通过标准偏差进行校正。</p><p id="2313" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于这个练习，我使用了<strong class="kh ir"> R </strong>编程语言，但它可以很容易地在<strong class="kh ir"> SAS </strong>、<strong class="kh ir"> Python </strong>或任何其他选择的编程语言中复制。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="lo lp l"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">让我们加载我认为我会需要的库。</p></figure><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="lo lp l"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">然后，让我们导入数据并查看一下。</p></figure><div class="lj lk ll lm gt ab cb"><figure class="lu ln lv lw lx ly lz paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><img src="../Images/95664c0d5d6b3cc8790e0884426dcacd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*NQcCkkbR44EkBoq83jex1A.png"/></div></figure><figure class="lu ln lv lw lx ly lz paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><img src="../Images/b55758f8125d2bffbdf795fbb9df7cee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*wpkuRgoN_9pFSA7lbmS8aQ.png"/></div><p class="lq lr gj gh gi ls lt bd b be z dk mg di mh mi translated">在这里，您可以看到按治疗和按坦克划分的数据分布。下面的代码显示每个容器包含35个观察值。</p></figure></div><pre class="lj lk ll lm gt mj mk ml mm aw mn bi"><span id="d132" class="mo mp iq mk b gy mq mr l ms mt"># A tibble: 12 x 2<br/>   Tank  no_rows<br/>   &lt;fct&gt;   &lt;int&gt;<br/> 1 120        35<br/> 2 121        35<br/> 3 122        35<br/> 4 123        35<br/> 5 125        35<br/> 6 126        35<br/> 7 127        35<br/> 8 128        35<br/> 9 129        35<br/>10 132        35<br/>11 133        35<br/>12 137        35</span></pre><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="lo lp l"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">用于测试当前功率(事后)的模型和度量分别是ANOVA和f检验。f检验寻找所有处理之间的差异，以说明在给定假阳性率的情况下，它们是处理之间的差异。</p></figure><p id="bb1b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结果、显著性和F值显示在下面的代码中。</p><pre class="lj lk ll lm gt mj mk ml mm aw mn bi"><span id="0d8e" class="mo mp iq mk b gy mq mr l ms mt">Call:<br/>lm(formula = gain ~ Diet, data = ARCdata)</span><span id="1b12" class="mo mp iq mk b gy mu mr l ms mt">Residuals:<br/>     Min       1Q   Median       3Q <br/>-204.067  -48.865   -4.894   45.291 <br/>     Max <br/> 213.933</span><span id="836a" class="mo mp iq mk b gy mu mr l ms mt">Coefficients:<br/>            Estimate Std. Error<br/>(Intercept) 290.7048     6.9934<br/>DietB       -12.6381     9.8901<br/>DietC       -15.9836     9.9139<br/>DietD         0.2087     9.9139<br/>            t value Pr(&gt;|t|)    <br/>(Intercept)  41.569   &lt;2e-16 ***<br/>DietB        -1.278    0.202    <br/>DietC        -1.612    0.108    <br/>DietD         0.021    0.983    <br/>---<br/>Signif. codes:  <br/>  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05<br/>  ‘.’ 0.1 ‘ ’ 1</span><span id="8202" class="mo mp iq mk b gy mu mr l ms mt">Residual standard error: 71.66 on 414 degrees of freedom<br/>  (2 observations deleted due to missingness)<br/>Multiple R-squared:  0.01037, Adjusted R-squared:  0.003198 <br/>F-statistic: 1.446 on 3 and 414 DF,  p-value: 0.2289</span><span id="30e8" class="mo mp iq mk b gy mu mr l ms mt">[1] 0.2288678<br/>[1] 1.445967</span></pre><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="lo lp l"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">为了获得<strong class="ak">事后功耗分析</strong>，我需要查看获得有效p值的概率(p &lt; =0.05)。我应用了bootstrapping(替换重采样)来估计总体均值和标准差(sd)。一旦我有了总体均值和标准差，我就可以模拟1000次试验，并观察总体中达到的“功效”。</p></figure><p id="db0e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在下面的代码中，您可以看到<strong class="kh ir">总体均值</strong>和<strong class="kh ir">标准差</strong>与样本均值和标准差之间的差异结果。这通常被称为“<strong class="kh ir">偏差</strong>”，给出了样本数据对模拟有用程度的一个很好的近似值。</p><pre class="lj lk ll lm gt mj mk ml mm aw mn bi"><span id="d7f2" class="mo mp iq mk b gy mq mr l ms mt">         120          121          122          123          125 <br/> 0.020574286 -0.086813862  0.085062857 -0.243245714  0.185080000 <br/>         126          127          128          129          132 <br/>-0.052434286  0.195677143 -0.005534286 -0.153240000  0.114102857 <br/>         133          137 <br/> 0.044703253  0.031260000<br/></span><span id="5ba2" class="mo mp iq mk b gy mu mr l ms mt">      120       121       122       123       125       126       127 <br/>-1.318715 -1.472052 -1.720122 -1.763247 -1.601380 -1.356375 -1.600663 <br/>      128       129       132       133       137 <br/>-1.624573 -1.583112 -1.250887 -1.307703 -1.889067</span></pre><p id="02a4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我开始模拟10k新试验，使用总体均值和标准差，寻找每罐使用35个样本时的功效。</p><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="lo lp l"/></div></figure><pre class="lj lk ll lm gt mj mk ml mm aw mn bi"><span id="dd2f" class="mo mp iq mk b gy mq mr l ms mt">apply(x, 2, FUN = power)<br/>V1                39.21</span></pre><p id="411d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如你所看到的，结果并不是很好，根据人口值显示了39%的事后权力。这意味着，在当前实验中发现的效应大小不允许每个鱼缸取样少于35条鱼。不会，除非我们能增加差异的影响大小。</p><p id="f43d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了模拟这种情况，我们需要使用总体平均值、标准偏差、变异系数，并通过增加单次治疗的平均值来扩大效应大小。在这里，我选择了治疗D(及其坦克121，126，129)。</p><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="lo lp l"/></div></figure><pre class="lj lk ll lm gt mj mk ml mm aw mn bi"><span id="40da" class="mo mp iq mk b gy mq mr l ms mt">print(popcv&lt;-(popsd/popmean))<br/>      120       121       122       123       125 <br/>0.2036404 0.2273521 0.2912939 0.2887722 0.2576816 <br/>      126       127       128       129       132 <br/>0.2100662 0.2421316 0.2734029 0.2557708 0.2290366 <br/>      133       137 <br/>0.2546334 0.2381327</span></pre><p id="fbcb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的代码很难理解，但是我主要做的是让R创建一个数组，在这个数组中，当改变一个效果大小和每个鱼缸中鱼的数量的矩阵时，F值和p值被存储。</p><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="1277" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面是一些数据争论，以产生我想要的图表，使用变量'权力'，' N '，和' es '。下面是生成图表的代码，如果您看到图表，它应该是不言自明的。</p><figure class="lj lk ll lm gt ln"><div class="bz fp l di"><div class="lo lp l"/></div></figure><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mv"><img src="../Images/d8b18299574fd93976b1471b1e0c68f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nyKVAGef35gOFJA-TtrKdQ.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">显示模拟结果的图表。变化的变量是影响大小和鱼的数量。曲线并不平滑，因为仅使用了1000个样本，这在i7上花费了大约60分钟。</p></figure><p id="16cd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上图清楚地显示了功效是效果大小和鱼样本数量的函数。为了达到80%的力量，你需要有一个特定的效果大小，没有多少鱼可以抵消这一点。因此，当设计一个实验时，你需要尽你所能创造必要的效果来从噪音中检测信号。</p></div></div>    
</body>
</html>