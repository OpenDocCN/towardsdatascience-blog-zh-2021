<html>
<head>
<title>Turn Your Python Script into a Web App Using Streamlit and Altair</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Streamlit和Altair将您的Python脚本转换为Web应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/turn-your-python-script-into-a-web-app-using-streamlit-and-altair-627c70c56f4?source=collection_archive---------26-----------------------#2021-08-31">https://towardsdatascience.com/turn-your-python-script-into-a-web-app-using-streamlit-and-altair-627c70c56f4?source=collection_archive---------26-----------------------#2021-08-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6b76" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">2020年东京奥运会奖牌表现分析</h2></div><p id="7753" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">在本文中，我将给出一个快速教程，介绍如何使用</em><a class="ae lf" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank"><em class="le">Streamlit</em></a><em class="le">和</em><a class="ae lf" href="https://altair-viz.github.io/" rel="noopener ugc nofollow" target="_blank"><em class="le">Altair</em></a><em class="le">——这两个库提供了一个快速简单的框架来创建交互式仪表盘和数据发现工具。</em></p><p id="de46" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">我们将使用2020年东京奥运会</em><a class="ae lf" href="https://olympics.com/tokyo-2020/olympic-games/en/results/all-sports/medal-standings.htm" rel="noopener ugc nofollow" target="_blank"><em class="le"/></a><em class="le">的数据来计算哪些国家获得了最多的奖牌，并比较男女运动员如何为他们的团队取得成功做出贡献。我在教程中使用的数据集可以在</em><a class="ae lf" href="https://www.kaggle.com/jamieeeee/tokyo-2020-olympics-medal-count" rel="noopener ugc nofollow" target="_blank"><em class="le">ka ggle</em></a><em class="le">上找到。</em></p><p id="80d3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是在我们开始之前，先介绍一下这两个库:</p><p id="9718" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae lf" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank"> 1。<strong class="kk iu"><em class="le">Streamlit</em></strong></a>是一个开源库，可以帮助你将Python代码转化为定制的web应用。易于使用和共享，它可以与大多数流行的数据科学和机器学习包一起工作。</p><p id="e3af" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">细流变成了简单的。将脚本复制到现成的web应用程序中，您可以在本地使用，也可以部署到服务器上与其他人共享。Streamlit甚至提供免费的网络应用托管服务(<a class="ae lf" href="https://streamlit.io/sharing" rel="noopener ugc nofollow" target="_blank">点击这里</a>)。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/8a6ec826033263f5bf3fc28a90eaead6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AdCIyXD5RXLMdHkV6_owrw.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">来自<a class="ae lf" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank">https://streamlit.io/</a>的Streamlit应用示例</p></figure><p id="3a5a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2.<a class="ae lf" href="https://altair-viz.github.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu"> <em class="le">牛郎星</em> </strong> </a>是Python的可视化库，基于<a class="ae lf" href="http://vega.github.io/vega" rel="noopener ugc nofollow" target="_blank"> Vega </a>和<a class="ae lf" href="http://vega.github.io/vega-lite" rel="noopener ugc nofollow" target="_blank"> Vega-Lite </a>。它将简单和用户友好的图形语法与强大的功能相结合，可以创建几乎任何类型的复杂交互式图形。</p><p id="163c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从我个人的经验来看，与pyplot相比，这个库提供了更清晰的语法，并且更容易直接处理数据库中的数据，不需要额外的转换。这就是为什么我们将在本教程中使用它。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lw"><img src="../Images/793e11e5ae3fa66ccc56d6257612d6f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5SzMaO24_DyV5Pe9gbaWhA.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">来自https://altair-viz.github.io/<a class="ae lf" href="https://altair-viz.github.io/" rel="noopener ugc nofollow" target="_blank">的Alltair可视化示例</a></p></figure><h1 id="70b3" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">第一步。研究数据和画草图</h1><p id="e29b" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">我在Kaggle上找到的数据有两种类型的数据集。第一个数据集包含按类型(金牌、银牌和铜牌)划分的每个国家队的奖牌总数，第二个数据集或多或少是相同的数据，但增加了一个维度——运动员的性别(这排除了一些无法提供此信息的学科，因此第二类数据集中的奖牌总数较低)。在<a class="ae lf" href="https://www.kaggle.com/jamieeeee/tokyo-2020-olympics-medal-count" rel="noopener ugc nofollow" target="_blank">原始源代码</a>中，男女运动员被列在两个单独的文件中，但是对于我们的用例，我将两个合并成一个文件，该文件可用于<a class="ae lf" href="https://github.com/mariapaskevich/Tokyo2020" rel="noopener ugc nofollow" target="_blank"> Github </a>上的所有其他代码。</p><p id="69d0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们有了数据，现在我们需要考虑仪表板看起来会是什么样子！这是我们开始释放内心艺术家、视觉设计师、UI或UX专家，或者隐藏在这个坚韧的数据科学家表面下的任何人的部分。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi mu"><img src="../Images/a6f675007227434868a904ce8e5c5baf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mrTLlc27MNB-OAAjOMMtAQ.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">正在绘制草图。作者图片</p></figure><p id="f069" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有两种不同类型的信息，所以最好为每一种信息分别绘制图表。拥有按国家分类的数据几乎迫切需要使用地图作为可视化形式，而按性别分类的数据是为用户创建探索性图表的好机会。</p><p id="9f03" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">经过一些草图，这是我想看到的最终结果:</p><ul class=""><li id="5cd2" class="mv mw it kk b kl km ko kp kr mx kv my kz mz ld na nb nc nd bi translated">一个按国家显示奖牌总数的交互式地图，带有奖牌类型过滤器(金、银、铜)。我想根据每个国家的奖牌数量对地图进行颜色编码，并且有一个工具提示，提供鼠标悬停时的附加信息</li><li id="638b" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">一个散点图，以男女运动员获得的奖牌数为轴，每种奖牌类型使用不同的颜色。此外，让用户能够在图表上添加(或删除)更多的国家将会很有趣</li></ul><p id="25bb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看看如何使用Altair创建这些图表。</p><h1 id="9f37" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">第二步。使用Altair创建可视化</h1><p id="0e52" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">为了使事情变得简单，我们将从按性别统计开始，而把地图留到以后。在这里，我们将以男女运动员获得的奖牌数为轴，用不同的颜色表示每种奖牌类型。</p><p id="e423" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们先阅读文件<em class="le">medal _ count _ by _ gender . CSV</em>并查看数据集:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nj"><img src="../Images/8aba00abb063b81bc9101e2a42a18003.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IX9MfcuZlxlsaiScnZveZQ.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">作者图片</p></figure><p id="a280" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每个国家队都有一栏，列有奖牌类型、国名以及获得奖牌的男女运动员人数。</p><p id="111b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在图表上尽可能多地保留这些信息是非常好的。因此，我们将创建一个散点图，X轴和Y轴代表男女运动员。这个图上的颜色将代表不同类型的奖牌，我们将添加工具提示，以便用户可以看到这是哪个国家，以及其他有用的信息。</p><p id="877e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我们先画一个散点图，以count_male为X轴，count_female为Y轴。功能<a class="ae lf" href="https://altair-viz.github.io/user_guide/generated/toplevel/altair.Chart.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu"> alt。Chart() </strong> </a>以数据集为自变量，创建一个基本的牛郎星图。您可以根据想要显示的图形类型选择不同的方法:mark_line()、mark_bar()等等。对于散点图，我们使用<strong class="kk iu">指定图表的类型。mark_circle() </strong>。</p><p id="ff1c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">方法<strong class="kk iu">。encode() </strong>负责绘图看起来到底是什么样的:什么样的数据进入轴和颜色，如果你想将图形分割成单独的行或列也是如此。现在我们只使用<strong class="kk iu"> alt来指定X和Y。X() </strong>和<strong class="kk iu"> alt。Y() </strong>以列名作为参数(数据集中的列名需要是字符串):</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="6859" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的代码生成了这个图形:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nm"><img src="../Images/faf64d95269972782499a4fa8eb4b162.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UhUW7iub8njeJ8UQKOK0ow.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">作者图片</p></figure><p id="bc46" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数据集中的每个国家有3行(每种奖牌类型一行)，现在不可能看到每个点代表的类型，所以让我们用颜色编码。为了用不同的颜色标记不同的奖牌，我们需要给<strong class="kk iu">添加参数“颜色”。encode() </strong>指定显示什么颜色。该参数由<strong class="kk iu"> alt定义。Color() </strong>从数据集中提取一个列名(在本例中为“奖牌类型”)，并相应地在图表上指定颜色。</p><p id="1a81" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果图表使用直观上与奖牌相关的颜色，就会更容易阅读:橙色代表金色，灰色代表银色，棕色代表青铜色。为此，我们需要再添加一个参数<strong class="kk iu"> scale=alt。Scale() </strong>具有指定的域(彩色元素及其顺序的可能选项)和范围(域中每个对应元素的颜色):</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nk nl l"/></div></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nn"><img src="../Images/18b8e87f1bf9eb3a62f58acab3a1eab5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1QjSwHL04WfMdNI69RXsFA.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">作者图片</p></figure><p id="bb78" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在好多了！唯一缺少的是:我们不知道每个位置上是哪个国家，所以让我们使用<strong class="kk iu"> tooltip </strong>参数将它添加为用户的交互式工具提示:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nk nl l"/></div></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi no"><img src="../Images/59b6a12cfe24644b43ffbcf8c057a4d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AwD876AGMl_D-QgBv-Uaug.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">作者图片</p></figure><p id="8dec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这看起来像一个很好的图表，但仍然缺少一件事:我希望有一条对角线将图表分为两部分(更多的男性和更多的女性奖牌)。为此，我们需要在代码中再添加一个Altair对象，并为这两个对象命名:散点图和新对象。新对象将是一条线，因此我们使用<strong class="kk iu"> mark_line() </strong>方法进行显示，并在方法中指定颜色、样式(在本例中为虚线)和不透明度:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nk nl l"/></div></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nn"><img src="../Images/d84f0179824341492cc4fc9a65fddc46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xn3Gzot0fosNXWTZdKnKtQ.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">作者图片</p></figure><p id="fbf4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这或多或少是最终的代码，唯一剩下的是添加过滤国家的能力，以显示和包装成一个函数的一切，所以我们可以很容易地调用它，当需要为某些国家绘制图表。让我们把所有东西放在函数<strong class="kk iu">的奖牌_性别()中。</strong>该函数只有一个参数——国家——用于过滤<em class="le"> medal_count_by_gender </em>数据帧。loc[]。此外，由于我们在图上有更少的点，我将使用<em class="le">将它们的大小从60增加到300。mark_circle(size=300) </em>，这样看起来更好看:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="7e1d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">举例来说，这就是美国队的结果。我们看到，在所有三种类型的奖牌中，女运动员都领先于男运动员:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nk nl l"/></div></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi np"><img src="../Images/30e068411b696d43052320c4e11595c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2VgEa_j-LL-jJBX2RXls5Q.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">作者图片</p></figure><p id="d7ce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以将更多的国家添加到函数输入中，以获得多个国家队的结果。例如，我们可以如下添加中国和日本:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nk nl l"/></div></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nq"><img src="../Images/cc364b1bf075f021f756d1824895fb3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G-ehFf0N75LKs4uYZCxWtQ.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">作者图片</p></figure><p id="52c0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，当散点图可以使用时，让我们开始绘制地图吧！我们有一个名为<em class="le"> olympic_medal_count.csv，</em>的数据集，其中包含列表中每个国家的代码。但是为了在牛郎星地图上使用它，我们还需要为每个国家准备一个<a class="ae lf" href="https://en.wikipedia.org/wiki/ISO_3166-1_numeric" rel="noopener ugc nofollow" target="_blank">ISO 3166-1数字代码</a>。我们在另一个文件(<em class="le"> country_codes.csv </em>)中有这个数据，所以第一步是合并两个数据集:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="51e4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">结果看起来如下:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nr"><img src="../Images/a3778c8d411d6c478d6db3a0756b5426.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UHyybLUCyHClRsxSmLlvyA.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">作者图片</p></figure><p id="020e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从这里，我们可以继续使用Altair创建地图。和以前一样，我们使用<strong class="kk iu"> alt。Chart() </strong>来创建图形，但现在用<strong class="kk iu">。mark_geoshape() </strong>方法和使用Altair的方法<strong class="kk iu">alt . topo _ feature(data . world _ 110m . URL<em class="le">、【国家】</em>)从Vega _ datasets<em class="le">data . world _ 110m . URL</em>创建的新数据源。通过这样做，我们添加了一个带有国家的地图，但是它还没有附加任何值。</strong></p><p id="da02" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<strong class="kk iu"> alt之后。图表()</strong>有一个<strong class="kk iu">。编码()</strong>方法<strong class="kk iu"> </strong>带有颜色和工具提示的参数。颜色和工具提示都使用来自<em class="le"> olympic_medal_map </em>数据集的数据，我们仍然需要加入这些数据。为了做到这一点，在。encode()还有一个方法——<strong class="kk iu">。transform_lookup() — </strong>在<em class="le"> olympic_medal_map </em>中搜索正确的国家id，并将“Team/NOC”和“Total”列中的值添加到地图背景中。</p><p id="ccd2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">之后，我们可以添加更多的方法来控制图形的外观:<strong class="kk iu">。configure_view() </strong>为图形框架(我们将其设置为零)<strong class="kk iu">，。图片尺寸的属性()</strong>和<strong class="kk iu">。project() </strong>定义地图应该是什么样子。</p><p id="3072" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是它在脚本中的样子:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="3c47" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的代码将生成这张漂亮的图片，当鼠标悬停在一个国家上方时会出现工具提示:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ns"><img src="../Images/814d8a4ea587874064cfc72b4c250bde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wUGn8LOARjgC2buGLBojtg.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">作者图片</p></figure><p id="aa8d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作为一个额外的功能，我希望地图根据奖牌类型(金牌、银牌或铜牌)而改变，所以我们创建了一个名为<em class="le"> draw_map() </em>的函数，将奖牌类型作为参数。该参数将定义应该显示的列以及颜色主题，因此对于金牌，地图将具有橙色等级，而对于银牌，地图将具有蓝色等级。</p><p id="9d4d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是它在函数中的样子:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="ef74" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在两个图表都准备好了，是时候把东西包装成一个漂亮的Streamlit应用程序了。</p><h1 id="8b7a" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">第三步。使用Streamlit将Altair graphs转化为web应用程序</h1><p id="cb8c" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">我们已经有了在Altair中显示所有图表的代码，现在只需要将所有内容打包到streamlit命令中，以便将其转换为web应用程序！</p><p id="cb9c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们想在我们的streamlit应用程序中添加两个视图:按国家分类的奖牌总数(地图)和按性别分类的统计数据(散点图)。</p><p id="e88b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为此，我们需要创建一个Python脚本。py，并添加函数<strong class="kk iu"> draw_map() </strong>和<strong class="kk iu"> medals_by_gender() </strong>以及读取数据集的代码。完成后，我们可以使用<strong class="kk iu"> st.write() </strong>方法添加几行代码，在Streamlit应用程序页面上显示Alrair图形:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="a638" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们将脚本保存在名为olympic_medal_tokyo2020.py的文件中，并在终端中运行以下命令:</p><blockquote class="nt nu nv"><p id="a000" class="ki kj le kk b kl km ju kn ko kp jx kq nw ks kt ku nx kw kx ky ny la lb lc ld im bi translated">streamlit run Olympic _ medal _ Tokyo 2020 . py</p></blockquote><p id="b5bb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Streamlit负责一切，我们在localhost上获得了这个交互式仪表板:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nz"><img src="../Images/42da4db1debc8a89aa9e3e6017a34960.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QLU5MgRgBxLmJHgPu-DPpQ.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">作者图片</p></figure><p id="3744" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这已经是一个仪表板，但它不允许我们选择国家或挑选不同类型的奖牌。为此，我们需要添加交互式小部件。</p><p id="2939" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">函数<strong class="kk iu"> draw_map() </strong>将奖牌类型作为参数，一次只能使用一个，因此使用st.selectbox()从四个不同类型(总、金、银或铜)中进行选择是有意义的:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="fc47" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，用户将能够从选项中进行选择，显示的地图将根据选择而变化:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi oa"><img src="../Images/6a9e55aa7fad55761f345459f0c1d893.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_-gnB1rr7EQn6VPUGApefw.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">作者图片</p></figure><p id="52ff" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于性别统计，我们希望允许用户选择显示哪些国家队。这是一个多项选择，所以我们可以使用<strong class="kk iu"> st.multiselect() </strong>。我们还可以为选择器设置一个默认值，这样默认情况下将显示三个国家:日本，因为它是奥运会的主办国，ROC(又名俄罗斯)，因为它是我可爱的祖国，还有瑞典，因为我正舒舒服服地坐在斯德哥尔摩的公寓里写这段代码。:)</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nk nl l"/></div></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ob"><img src="../Images/51f104af4093558f79e873d2eb9419a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fFk-N5iwITD-JgD6j1FXfQ.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">作者图片</p></figure><p id="8066" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们在同一个屏幕上显示了所有的东西，但是给用户一个选择地图或者散点图的选项会更好。因此，让我们使用<strong class="kk iu"> st.sidebar.radio() </strong>在侧边菜单中添加一个开关，并根据选择显示一个或另一个图形。此外，我们将在每个带有<strong class="kk iu"> st.table(): </strong>的图表下以数据表的形式显示所有国家的值</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="ba60" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">结果，我们将得到一个漂亮的图表，左侧边栏中有一个选择，主页上有过滤器:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi oc"><img src="../Images/e1b736803a0639213894d527e8f75969.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ymX69WnkQjTST5CKSYFBqg.png"/></div></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">作者图片</p></figure><p id="e569" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">快好了！</p><p id="3fb0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后一件事是使用奥运标志的<strong class="kk iu"> st.write()、st.title() </strong>和<strong class="kk iu"> st.image() </strong>在页面上添加一些测试说明:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="ae3f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是最终结果的样子:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="od nl l"/></div><p class="ls lt gj gh gi lu lv bd b be z dk translated">作者图片</p></figure><p id="1c19" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是完整的代码:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h1 id="eac4" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">第四步。共享简化仪表板</h1><p id="f394" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">现在，一旦你有了自己的应用程序，你可能想让其他人也能使用它，也就是把它部署在某个地方。有几个我知道的选项(但是如果你知道其他的，请留下评论:):</p><ul class=""><li id="5906" class="mv mw it kk b kl km ko kp kr mx kv my kz mz ld na nb nc nd bi translated"><a class="ae lf" href="https://share.streamlit.io/" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>允许用户在Streamlit平台上托管他们的应用，就像添加你的github库URL一样简单。例如，这里的<a class="ae lf" href="https://share.streamlit.io/mariapaskevich/tokyo2020/main/olympic_medal_tokyo2020.py" rel="noopener ugc nofollow" target="_blank">是我们在本文中创建的仪表板的链接</a></li><li id="3eb3" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">RStudio Connect还为用户提供了上传和分享代码的机会，即使代码是用Python编写的</li><li id="bd7d" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">当然，你可以使用你自己的服务器！</li></ul><h1 id="a3cc" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">有用的链接</h1><ol class=""><li id="cbf3" class="mv mw it kk b kl mp ko mq kr oe kv of kz og ld oh nb nc nd bi translated"><a class="ae lf" href="https://altair-viz.github.io/index.html" rel="noopener ugc nofollow" target="_blank">牛郎星文档</a></li><li id="50b0" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld oh nb nc nd bi translated"><a class="ae lf" href="https://docs.streamlit.io/en/stable/" rel="noopener ugc nofollow" target="_blank">简化</a>文档和<a class="ae lf" href="https://discuss.streamlit.io/t/streamlit-cheat-sheet/4912" rel="noopener ugc nofollow" target="_blank">备忘单</a></li><li id="3d74" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld oh nb nc nd bi translated">Tokyo2020仪表板代码的<a class="ae lf" href="https://github.com/mariapaskevich/Tokyo2020" rel="noopener ugc nofollow" target="_blank"> Github repo </a></li><li id="84af" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld oh nb nc nd bi translated"><a class="ae lf" href="https://share.streamlit.io/mariapaskevich/tokyo2020/main/olympic_medal_tokyo2020.py" rel="noopener ugc nofollow" target="_blank"> Tokyo2020 dahboard </a></li></ol><p id="523d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数据发现快乐！</p></div></div>    
</body>
</html>