<html>
<head>
<title>Develop an Interactive UI for a Microservice using Streamlit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Streamlit为微服务开发交互式UI</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/develop-an-interactive-ui-for-a-microservice-using-streamlit-5f8ef59edadd?source=collection_archive---------19-----------------------#2021-07-24">https://towardsdatascience.com/develop-an-interactive-ui-for-a-microservice-using-streamlit-5f8ef59edadd?source=collection_archive---------19-----------------------#2021-07-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8bb2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将您的python微服务立即转变为交互式仪表盘</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4bd67cc37d37fd6ce39080f328445b86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dmpDlIjbjXDuhOGlrWzysA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@sigmund" rel="noopener ugc nofollow" target="_blank">西格蒙德</a>拍摄自<a class="ae ky" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><h2 id="e86f" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">总结精简</strong></h2><p id="8215" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">Streamlit是一个开源应用程序框架，是数据科学家中一个受欢迎的工具，因为它可以帮助他们快速将开发部署到交互式GUI /仪表板中。此外，如果您了解python，实现Streamlit并不复杂，只需要投入少量时间来拿起这个工具并开始使用它。</p><h2 id="1ba7" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">概述</strong></h2><p id="a70d" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">在本文中，我们将在Google Cloud Run上部署一个微服务，它将拥有一个使用python和Streamlit创建的交互式仪表盘。如果你想看原始脚本，可以在<a class="ae ky" href="https://github.com/iamsuelynn/Microservice-using-Streamlit-1" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。</p><p id="13b6" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><strong class="lx iu"> (1)让我们从准备Streamlit应用程序代码开始— <em class="mt"> (app.py) </em> </strong></p><p id="c4c0" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们需要导入我们的应用程序将要使用的python包。为了让streamlit工作，我们需要添加“导入Streamlit”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/c5647fc824552301c6c87ec6fc20d1ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1054/format:webp/1*8yio20o6PViE-WDmBnuKlA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">需要导入模块</p></figure><p id="a3be" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">接下来，我们将准备应用程序的主体，它由python函数和Streamlit代码组成，这些代码决定了界面上将显示什么。让我们从添加标题、副标题和表情符号开始。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/0f95075f88182d0f844e1a8b808b2de1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yT0mIY7sXqBH5wexZHNjOQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Streamlit:标题、副标题、表情符号</p></figure><ul class=""><li id="8bba" class="mw mx it lx b ly mo mb mp li my lm mz lq na mn nb nc nd ne bi translated"><strong class="lx iu">主标题</strong>:适用于定义申请的主标题。</li><li id="b581" class="mw mx it lx b ly nf mb ng li nh lm ni lq nj mn nb nc nd ne bi translated"><strong class="lx iu"> st.subheader </strong>:可以使用的合适标题级别(另一个标题级别将是<strong class="lx iu"> st.header </strong>)。</li><li id="644d" class="mw mx it lx b ly nf mb ng li nh lm ni lq nj mn nb nc nd ne bi translated">这种方法可以用来给Interface⭐️.添加表情符号</li></ul><p id="23d5" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">现在我们已经定义了标题和副标题，让我们在界面的左侧添加一个下拉菜单，这样用户就可以选择了。在本例中，我们将提供2个选项供用户选择。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/419d96db0617da87710654ea1704058d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X-Rj5iz-mSLm2d3kddnTwg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Streamlit:侧栏</p></figure><ul class=""><li id="b2f2" class="mw mx it lx b ly mo mb mp li my lm mz lq na mn nb nc nd ne bi translated"><strong class="lx iu"> st.sidebar </strong>:将我们的小部件钉在左边。</li><li id="b23f" class="mw mx it lx b ly nf mb ng li nh lm ni lq nj mn nb nc nd ne bi translated"><strong class="lx iu"> st.sidebar.selectbox </strong>:侧边栏上的下拉菜单，供用户选择选项。</li></ul><p id="b58a" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">随着选择选项的实施，我们将需要包括导航逻辑，如果用户选择选项<strong class="lx iu">“查看所有书籍”</strong>，将打印所有书籍的表格，如果用户选择选项<strong class="lx iu">“按评级搜索书籍”</strong>，将显示一个交互式滚动条，用户可以按评级查看书籍。这里我们将使用if…elif条件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/c9cede9b49a97e32df656c4458c6a7ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pkeck46PalXRo1T-uI_Qkw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Streamlit:打印表格</p></figure><ul class=""><li id="ae2a" class="mw mx it lx b ly mo mb mp li my lm mz lq na mn nb nc nd ne bi translated"><strong class="lx iu"> st.write </strong>:可用作瑞士军刀打印文本/变量。</li><li id="1cc5" class="mw mx it lx b ly nf mb ng li nh lm ni lq nj mn nb nc nd ne bi translated"><strong class="lx iu"> st.table </strong>:打印一个静态表格，整个表格将被打印到屏幕上。打印数据框架表的另一种方法是使用<strong class="lx iu"> st.dataframe </strong>。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/19de51033709474e46af6a2ec9ee6ce9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AOkQt9EZuE5tcVhcidjfFg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">流线:滑块</p></figure><ul class=""><li id="5acd" class="mw mx it lx b ly mo mb mp li my lm mz lq na mn nb nc nd ne bi translated"><strong class="lx iu"> st.slider </strong>:允许通过使用滑块传递2个元素来选择数值范围。</li></ul><p id="ee18" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们就快成功了，主应用程序脚本已经完成，现在我们可以将微服务部署到Google Cloud Run上了。</p><p id="b683" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><strong class="lx iu"> (2)准备所需的库—<em class="mt">(requirements . txt)</em></strong></p><ul class=""><li id="da25" class="mw mx it lx b ly mo mb mp li my lm mz lq na mn nb nc nd ne bi translated">在requirements.txt文件中添加“streamlit”</li></ul><p id="45eb" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们需要在requirements.txt文件中添加Streamlit库，Docker容器用它来安装这里列出的包。</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="fa5c" class="kz la it no b gy ns nt l nu nv"># File: requirements.txt </span><span id="e08b" class="kz la it no b gy nw nt l nu nv">google-api-core<br/>google-cloud-bigquery<br/>pandas<br/>pandas-gbq<br/>gcsfs<br/><strong class="no iu">streamlit</strong></span></pre><p id="787e" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><strong class="lx iu"> (3)在Dockerfile中添加运行我们的Streamlit应用程序的命令— <em class="mt"> (Dockerfile) </em> </strong></p><p id="ce0b" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">当我们在Google Cloud Run上部署微服务时，我们需要使用docker将应用程序容器化。为了运行应用程序，需要在<strong class="lx iu"><em class="mt">docker文件</em> </strong>中添加命令“streamlit run”。如果你想了解更多关于Docker，<a class="ae ky" href="https://docker-curriculum.com/" rel="noopener ugc nofollow" target="_blank">你可以参考他们的文档</a>。</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="469c" class="kz la it no b gy ns nt l nu nv">CMD streamlit run --server.port 8080 --server.enableCORS false app.py</span></pre><p id="f135" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><em class="mt">你也可以参考Github上完整的</em><a class="ae ky" href="https://github.com/iamsuelynn/Microservice-using-Streamlit-1/blob/main/Dockerfile" rel="noopener ugc nofollow" target="_blank"><em class="mt">docker file</em></a><em class="mt">。</em></p><p id="d897" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><strong class="lx iu"> (4)部署应用&amp;看看我们最后的结果！</strong></p><p id="8b09" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们将在Google Cloud Run上部署我们的应用程序，这是一个无服务器环境平台。为了成功地将我们的应用程序部署到Google Cloud Run，我们需要构建docker映像并将该映像推入Google Cloud Registry。构建完成后，我们可以在Cloud Run上部署新构建的映像。在构建docker映像之前，请确保您拥有部署应用程序所需的文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/38f3731193c144ad0d71d1d039f37fdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*kqpMZwgxIMMcfmvXKVIxOA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">构建Docker映像所需的文件</p></figure><p id="a750" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">下面是在Google Cloud Run <em class="mt">上部署我们的应用程序的命令(您可以在Cloud Shell上运行脚本)</em>:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="ceab" class="kz la it no b gy ns nt l nu nv"># Set the Region <br/>gcloud config set run/region asia-southeast1</span><span id="3a40" class="kz la it no b gy nw nt l nu nv">#Build a new Docker Image<br/>gcloud builds submit --tag gcr.io/sue-gcp-learning-env/books_ui</span><span id="d3e5" class="kz la it no b gy nw nt l nu nv">#Deploy the Image<br/>gcloud run deploy --image gcr.io/sue-gcp-learning-env/books_ui --platform managed</span></pre><p id="d208" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">成功部署后，您可以通过提供的URL地址访问应用程序<em class="mt">(您也可以从您的云运行实例中检索链接)</em>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/b04ea5a206f3e8c2133194c5236ef990.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c3TmGo1nhinfycETPSYVuQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">完成部署后的应用程序URL</p></figure><p id="6abd" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">以下是我们部署的采用Streamlit接口的微服务的外观:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">简化界面</p></figure><p id="d6e5" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><strong class="lx iu">结论:</strong></p><p id="8aab" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">在本文中，我们将学习如何使用Streamlit创建交互式微服务。一个具有<em class="mt">选择选项</em>、<em class="mt">在表格中打印结果、添加表情符号和使用滑块过滤值</em>功能的界面。还有更多的你可以用Streamlit实现的，本文没有涉及到，比如<a class="ae ky" href="https://docs.streamlit.io/en/stable/getting_started.html#show-progress" rel="noopener ugc nofollow" target="_blank">进度条</a>、<a class="ae ky" href="https://docs.streamlit.io/en/stable/getting_started.html#plot-a-map" rel="noopener ugc nofollow" target="_blank">地图绘制</a>、<a class="ae ky" href="https://docs.streamlit.io/en/stable/getting_started.html#draw-charts-and-maps" rel="noopener ugc nofollow" target="_blank">绘制图表</a>等。我建议你花点时间玩玩Streamlit，因为我玩得很开心！查看您开发的产品并与之互动是一件有趣的事情。我也希望这篇教程对学习使用Streamlit的人有用。如果你有任何问题或者你可能感兴趣的教程，请在评论中告诉我！</p><p id="bb6b" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><strong class="lx iu">参考和链接:</strong></p><p id="c3c8" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">[1]<a class="ae ky" href="https://www.analyticsvidhya.com/blog/2020/10/create-interactive-dashboards-with-streamlit-and-python/" rel="noopener ugc nofollow" target="_blank">https://www . analyticsvidhya . com/blog/2020/10/create-interactive-dashboards-with-streamlit-and-python/</a></p><p id="0134" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">[2]<a class="ae ky" href="https://raw.githubusercontent.com/omnidan/node-emoji/master/lib/emoji.json" rel="noopener ugc nofollow" target="_blank">https://raw . githubusercontent . com/omnidan/node-e moji/master/lib/e moji . JSON</a></p><p id="91cd" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">[3]<a class="ae ky" href="https://docs.streamlit.io/en/stable/" rel="noopener ugc nofollow" target="_blank">https://docs.streamlit.io/en/stable/</a></p><p id="de47" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><a class="ae ky" href="https://docs.streamlit.io/en/stable/api.html#display-text" rel="noopener ugc nofollow" target="_blank">https://docs.streamlit.io/en/stable/api.html#display-text</a></p><p id="0c18" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><a class="ae ky" href="https://docs.docker.com/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/</a></p></div></div>    
</body>
</html>