<html>
<head>
<title>Send CSV payload to API with Data Factory</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用数据工厂将CSV有效负载发送到API</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/send-csv-payload-to-api-with-data-factory-ff0cdddd6563?source=collection_archive---------23-----------------------#2021-07-27">https://towardsdatascience.com/send-csv-payload-to-api-with-data-factory-ff0cdddd6563?source=collection_archive---------23-----------------------#2021-07-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e80c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我将向您展示如何使用Azure数据工厂和函数应用程序将CSV有效负载发送到API</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b3c473d39a9a006ade3692e78e8bd04e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EIDm-tf1K1OQhDuThFxH8Q.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">皮奥特·穆西奥在<a class="ae kv" href="https://unsplash.com/s/photos/kitten-box?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="d18e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有人可能会认为，有一种直接的方法可以使用数据工厂从SQL table/CSV Blob中读取数据，并将其发送给需要CSV格式文本正文的API。据我所知，没有，我们需要创建一个功能应用程序来实现这一点。</p><p id="77b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我遇到的这个问题的一个用例是在将数据上传到<a class="ae kv" href="https://developer.salesforce.com/docs/atlas.en-us.api_asynch.meta/api_asynch/asynch_api_intro.htm" rel="noopener ugc nofollow" target="_blank"> Salesforce Bulk API 2.0 </a>时。</p><h2 id="6f41" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">概观</h2><p id="4984" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在本文中，我将向您展示一个解决方案，其中</p><ol class=""><li id="a0ea" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">我从SQL数据库中读取数据，并将其作为CSV文件写入Blob存储中，</li><li id="9f8c" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">我用Azure Function应用程序以字节形式获取Blob内容</li><li id="7c45" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">我将函数响应发送给我创建的示例API。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/305e31fa1eec22d3601ffe2599dbdd4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DSrIZ24Zov-NxX1GhSd1uw.png"/></div></div></figure><h2 id="3766" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">1.从源到斑点</h2><p id="e7b5" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">如果您想保留发送文件的历史，我建议将Blob名称设置为管道变量。如果没有必要保留历史记录，可以使用硬编码的Blob名称。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/ce849e8e17fa79dffcfd3b4911115cee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EzUADveMqdWfrwj3TVGiCQ.png"/></div></div></figure><p id="9a8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我的Blob名称包括当前时间戳和文件名:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="569e" class="ls lt iq nh b gy nl nm l nn no"><a class="ae kv" href="http://twitter.com/concat" rel="noopener ugc nofollow" target="_blank">@concat</a>(substring(utcnow(), 0, 19), 'canada_climate_data.csv')</span></pre><p id="dc59" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用数据工厂复制活动来创建我们的Blob。在这个例子中，我的源是我的SQL DB中的一个表。源数据集和汇数据集都被创建为通用数据集。参见我的文章<a class="ae kv" rel="noopener" target="_blank" href="/data-factory-generic-datasets-a998b832f060">用通用数据集保持你的数据工厂整洁</a>获得解释。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/9d2e578c9220f8300e94c10449f3db07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r6gZfKJ8gfDiT37SegQXRA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/dbd08c17289d79a561f172288a718c95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a1KjAa4llEJnrI-sEW8f8g.png"/></div></div></figure><h2 id="c8b4" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">2.用函数将Blob转换为字节</h2><p id="9881" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">为了创建我的Python函数应用程序，我遵循了微软的这些指令。我的__init__。py文件如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/24d83faca5dad282f6e9e8a2dfa4920a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X4nw7fjm09z6xFxfKTkRtg.png"/></div></div></figure><p id="fa76" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">JSON主体的动态内容如下(用您的存储帐户名和正确的容器名替换“您的存储”和“容器”):</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="f658" class="ls lt iq nh b gy nl nm l nn no"><a class="ae kv" href="http://twitter.com/concat" rel="noopener ugc nofollow" target="_blank">@concat</a>('{"blob_location":"<a class="ae kv" href="https://miiastorage.blob.core.windows.net/container/',variables('blob_name'),'" rel="noopener ugc nofollow" target="_blank">https://yourstorage.blob.core.windows.net/container/',variables('blob_name'),'</a>"}')</span></pre><h2 id="c864" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">3.向API发送字节</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/6c7eaf64cdccbcece31e24ac7df66e48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M_4N9DiHB52Emn3GWRa0xQ.png"/></div></div></figure><p id="2b42" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">body的动态内容是我的函数的响应:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="74bb" class="ls lt iq nh b gy nl nm l nn no"><a class="ae kv" href="http://twitter.com/activity" rel="noopener ugc nofollow" target="_blank">@activity</a>('Blob to bytes').output.Response</span></pre><p id="710f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样！</p></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><p id="de9d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的阅读！如果你学到了新的东西或者喜欢这篇文章，请在Medium 上关注我。我发表关于数据工程和数据科学的文章。你可以从be <a class="ae kv" href="http://miiaramo.github.io/" rel="noopener ugc nofollow" target="_blank">网页</a>了解更多关于我的信息。</p><p id="8266" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你有没有找到更好的方法来实现这一点，或者有什么不清楚的地方？请在评论中告诉我😊</p></div></div>    
</body>
</html>