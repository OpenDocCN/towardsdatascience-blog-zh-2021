<html>
<head>
<title>MLflow: A Primer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MLflow:初级读本</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/mlflow-a-primer-6dfe6be48353?source=collection_archive---------22-----------------------#2021-12-21">https://towardsdatascience.com/mlflow-a-primer-6dfe6be48353?source=collection_archive---------22-----------------------#2021-12-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="736d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">为什么/如何将内部 ML 框架转变为统一的框架</h2></div><h1 id="947d" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">一行摘要:</h1><p id="742e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">通过遵循这篇博文中的具体步骤，您将能够简单地将您的内部 ML 项目纳入 MLflow 框架。</p><h1 id="3879" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">1.MLflow 有什么用？</h1><ul class=""><li id="874d" class="lu lv iq kz b la lb ld le lg lw lk lx lo ly ls lz ma mb mc bi translated">促进 ML 模型版本化，以简化生产中 ML 模型的性能调整和再培训工作。</li><li id="a533" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls lz ma mb mc bi translated">显著增强数据科学/ML 团队跟踪所有 ML 模型库的能力。</li><li id="c513" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls lz ma mb mc bi translated">将整个数据清理、处理、培训和注册生命周期统一到一个统一的框架中。</li></ul><h1 id="24db" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">2.介绍</h1><p id="3882" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果你曾经参与过生产级的基于人工智能的项目，你可能在处理 ML 模型和将更新的模型集成回 ML 管道的过程中经历过一定程度的脱节。为所有 ML 模型的不同版本建立一个统一的存储库，并跟踪模型度量的发展，这将是非常好的。此外，如果需要更新模型，只需点击一次即可在存储库中记录和注册新模型，随时可用。</p><p id="c2e2" class="pw-post-body-paragraph kx ky iq kz b la mi jr lc ld mj ju lf lg mk li lj lk ml lm ln lo mm lq lr ls ij bi translated">我观察到，第一手的情况是，诸如 GitHub 之类的代码版本控制工具的出现如何在团队成员之间的代码开发过程中革新了协作的质量。MLflow 通过在一个地方维护 ML 模型的版本以及分数和调整参数，对机器学习模型做同样的事情。</p><p id="77b7" class="pw-post-body-paragraph kx ky iq kz b la mi jr lc ld mj ju lf lg mk li lj lk ml lm ln lo mm lq lr ls ij bi translated">在这篇博文中，我将展示如何将任何 ML 代码基础转换成 MLflow 框架的步骤。图 1 显示了这个案例研究的 MLflow UI。从图 1 中可以看出，这里显示了模型的版本以及调优参数和模型度量。因此，每当团队成员更新模型时，都会添加一个新行，并与指标一起显示。现在，说了这么多，让我们更深入地了解达到这一水平所需的步骤。</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mn"><img src="../Images/5fe2cdb2ae4871b116d1327b130d2100.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-BX3BpJxSZroJkSiwNRfGg.png"/></div></div><p class="mz na gj gh gi nb nc bd b be z dk translated">图一。ML 模型不同版本的 MLflow UI 视图。在每次再训练中，模型都要经历整个 ML 循环。这个用例将在下一节解释(图片由作者提供)。</p></figure><h1 id="ed7c" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">3.一个测试用例项目的逐步配方</h1><p id="5a29" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">构建 MLflow 框架的一般路线图如下所示:</p><ul class=""><li id="3e61" class="lu lv iq kz b la mi ld mj lg nd lk ne lo nf ls lz ma mb mc bi translated">安装 MLflow 软件包。</li><li id="7e94" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls lz ma mb mc bi translated">重构 ML 代码库。</li><li id="b5f9" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls lz ma mb mc bi translated">ML 再培训。</li><li id="a123" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls lz ma mb mc bi translated">通过 MLflow UI 跟踪 ML 版本。</li></ul><p id="96b8" class="pw-post-body-paragraph kx ky iq kz b la mi jr lc ld mj ju lf lg mk li lj lk ml lm ln lo mm lq lr ls ij bi translated">下面，我详细解释每一个步骤。另外，在这里可以看到完整的代码库:<a class="ae ng" href="https://github.com/saiedmighani/mlflow_primer" rel="noopener ugc nofollow" target="_blank"> GitHub </a></p><h2 id="83e0" class="nh kg iq bd kh ni nj dn kl nk nl dp kp lg nm nn kr lk no np kt lo nq nr kv ns bi translated"><strong class="ak"> 3.a 安装 MLflow 包</strong></h2><p id="999e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">MLflow 是一个独立的包，受到许多云平台的支持，包括 Spark、GCP、Azure 等。它也可以在内部安装和使用。要安装该软件包，只需在您的终端(以及您的活动虚拟环境，如果您正在使用的话)中运行以下命令:</p><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h2 id="4314" class="nh kg iq bd kh ni nj dn kl nk nl dp kp lg nm nn kr lk no np kt lo nq nr kv ns bi translated"><strong class="ak"> 3.b 重构 ML 代码库</strong></h2><p id="ad8d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了这篇博文的目的，我选择了我之前的一个分类器模型，它已经在另一篇博文(<a class="ae ng" rel="noopener" target="_blank" href="/global-warming-and-the-narrative-around-it-lessons-learned-from-nlp-exploration-of-reddit-posts-fb2918d500e9">链接</a>)中描述过了。总之，该模型使用自然语言处理(NLP)将 subreddit 帖子分类为二进制主题类。要深入阅读，我建议你参考上面的博文。</p><p id="d6be" class="pw-post-body-paragraph kx ky iq kz b la mi jr lc ld mj ju lf lg mk li lj lk ml lm ln lo mm lq lr ls ij bi translated">这个模型的一个特别有趣的方面是数据集(即 reddit 帖子)是实时更新的。这意味着随着数据集的发展，由于数据漂移等原因，模型可能需要更新。许多生产 ML 模型苦于从过时的数据集进行推断，因此往往表现不佳。</p><p id="f6ba" class="pw-post-body-paragraph kx ky iq kz b la mi jr lc ld mj ju lf lg mk li lj lk ml lm ln lo mm lq lr ls ij bi translated">要使用 MLflow，最关键的一步是重构你的 ML 代码库。我准备了一个通用 ML 代码库的模板，以及如何将它包装成一个单独的模块，如下图和代码片段 1 所示:</p><ol class=""><li id="7e45" class="lu lv iq kz b la mi ld mj lg nd lk ne lo nf ls nv ma mb mc bi translated">导入数据。</li><li id="8dca" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls nv ma mb mc bi translated">清理数据集。</li><li id="b310" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls nv ma mb mc bi translated">转换特征。</li><li id="6b28" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls nv ma mb mc bi translated">ML 构建和评分。</li><li id="8c66" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls nv ma mb mc bi translated">在 MLflow 上注册模型、参数和指标。</li></ol><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="nt nu l"/></div><p class="mz na gj gh gi nb nc bd b be z dk translated">代码片段 1。使用 MLflow 的通用代码结构。</p></figure><p id="642d" class="pw-post-body-paragraph kx ky iq kz b la mi jr lc ld mj ju lf lg mk li lj lk ml lm ln lo mm lq lr ls ij bi translated">在每一次再训练运行期间，都会为 ML 模型的新版本生成一个路径，其中包含了您的模型的度量、参数和 pickled 版本(当然这是一个简化的版本，您可以参考 MLflow 文档来了解更多的复杂情况)。</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nw"><img src="../Images/78dfb103655b293a6620914afee88e69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8rZIN6zZMQxUa9AVIKLpiQ.png"/></div></div><p class="mz na gj gh gi nb nc bd b be z dk translated">图二。在每次 MLflow 运行期间重新训练的模型的生成特征。这些特性在 MLflow UI 上的可视化过程中使用(见图 1)。</p></figure><h2 id="f727" class="nh kg iq bd kh ni nj dn kl nk nl dp kp lg nm nn kr lk no np kt lo nq nr kv ns bi translated"><strong class="ak"> 3.c ML 再培训</strong></h2><p id="aa8d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了重新训练和注册您的模型，如果您已经适当地重构了您的 ML 生命周期(参见上面的代码片段 1)，所需要做的只是简单地重新运行最终的函数。在每次重新训练运行期间，都会创建一个新文件夹，其结构如图 2 所示。</p><h2 id="4889" class="nh kg iq bd kh ni nj dn kl nk nl dp kp lg nm nn kr lk no np kt lo nq nr kv ns bi translated"><strong class="ak">3d 通过 MLflow UI 跟踪 ML 版本</strong></h2><p id="218a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">要激活 mlflow ui，请在当前文件夹中的“终端”中运行以下命令(或者您可以在笔记本中将其作为神奇命令运行):</p><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="3842" class="pw-post-body-paragraph kx ky iq kz b la mi jr lc ld mj ju lf lg mk li lj lk ml lm ln lo mm lq lr ls ij bi translated">并通过以下路径访问浏览器中的用户界面(或根据您的端口号而有所不同):</p><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="4081" class="pw-post-body-paragraph kx ky iq kz b la mi jr lc ld mj ju lf lg mk li lj lk ml lm ln lo mm lq lr ls ij bi translated">您将在类似于图 1 的 UI 中看到所有的 ML 版本。好了，你的模型已经在 MLflow 上注册了！</p><h1 id="3905" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">4.建议</h1><ul class=""><li id="cf14" class="lu lv iq kz b la lb ld le lg lw lk lx lo ly ls lz ma mb mc bi translated">如果你已经非常熟悉 ML 模型训练的步骤，MLflow 有一个非常浅的学习曲线(对于轻量级的使用)。</li><li id="cb2a" class="lu lv iq kz b la md ld me lg mf lk mg lo mh ls lz ma mb mc bi translated">MLFlow 目前集成并兼容多个云平台，包括 Spark、GCP、Azure 等。因此，这将是一个很好的候选杠杆 ML 项目在生产，在规模。</li></ul><p id="a8c8" class="pw-post-body-paragraph kx ky iq kz b la mi jr lc ld mj ju lf lg mk li lj lk ml lm ln lo mm lq lr ls ij bi translated">快乐学习！</p></div><div class="ab cl nx ny hu nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="ij ik il im in"><p id="aedf" class="pw-post-body-paragraph kx ky iq kz b la mi jr lc ld mj ju lf lg mk li lj lk ml lm ln lo mm lq lr ls ij bi translated">感谢你阅读我的博文。对更多阅读感兴趣？请查看我的<a class="ae ng" href="https://www.linkedin.com/in/saiedmighani/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae ng" href="https://github.com/saiedmighani" rel="noopener ugc nofollow" target="_blank"> GitHub </a>简介。</p></div></div>    
</body>
</html>