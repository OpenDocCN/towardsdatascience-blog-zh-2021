<html>
<head>
<title>A Better Way for Data Preprocessing: Pandas Pipe</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一种更好的数据预处理方式:熊猫管道</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-better-way-for-data-preprocessing-pandas-pipe-a08336a012bc?source=collection_archive---------3-----------------------#2021-07-31">https://towardsdatascience.com/a-better-way-for-data-preprocessing-pandas-pipe-a08336a012bc?source=collection_archive---------3-----------------------#2021-07-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dc02" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">高效、有条理、优雅。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d5d05f6a7b53d027eca40c8c0fe0b6b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aUmjaErpNi_qJxuF3ZtMWQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@sigmund?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">西格蒙德</a>在<a class="ae ky" href="https://unsplash.com/s/photos/pipe?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="4540" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现实生活中的数据通常是混乱的。它需要大量的预处理才能使用。Pandas是使用最广泛的数据分析和操作库之一，它提供了几个函数来预处理原始数据。</p><p id="4e6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将关注一个特殊的函数，它将多个预处理操作组织成一个单独的操作:管道函数。</p><p id="0669" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当谈到软件工具和软件包时，我通过例子学习得最好。我在创作内容时会牢记这一点。在这篇文章中，我也将这样做。</p><p id="9208" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从用模拟数据创建一个数据框架开始。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f882" class="ma mb it lw b gy mc md l me mf">import numpy as np<br/>import pandas as pd</span><span id="3557" class="ma mb it lw b gy mg md l me mf">df = pd.DataFrame({<br/>   "id": [100, 100, 101, 102, 103, 104, 105, 106],<br/>   "A": [1, 2, 3, 4, 5, 2, np.nan, 5],<br/>   "B": [45, 56, 48, 47, 62, 112, 54, 49],<br/>   "C": [1.2, 1.4, 1.1, 1.8, np.nan, 1.4, 1.6, 1.5]<br/>})</span><span id="9543" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/201b2fc115b6dca470d7b329478a01d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:394/format:webp/1*pSrMazmTaxM4j7VuD573zQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="7812" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的数据框包含一些由标准缺失值表示法(即NaN)表示的缺失值。id列包含重复值。最后但同样重要的是，B列中的112似乎是一个异常值。</p><p id="ec86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些是现实生活数据中的一些典型问题。我们将创建一个管道来处理我们刚刚描述的问题。</p><p id="5098" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于每个任务，我们都需要一个函数。因此，第一步是创建将放置在管道中的函数。</p><p id="d1d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要注意的是，管道中使用的函数需要将数据帧作为参数并返回数据帧。</p><p id="b136" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个函数处理丢失的值。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6e1e" class="ma mb it lw b gy mc md l me mf">def fill_missing_values(df):<br/>   for col in df.select_dtypes(include= ["int","float"]).columns:<br/>      val = df[col].mean()<br/>      df[col].fillna(val, inplace=True)<br/>   return df</span></pre><p id="11ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我更喜欢用列的平均值替换数字列中缺失的值。可以随意定制这个功能。只要它以一个数据帧作为参数并返回一个数据帧，它就会在管道中工作。</p><p id="f3d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二个函数将帮助我们删除重复的值。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f607" class="ma mb it lw b gy mc md l me mf">def drop_duplicates(df, column_name):<br/>   df = df.drop_duplicates(subset=column_name)<br/>   return df</span></pre><p id="c274" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我从熊猫内置的drop duplicates功能中得到了一些帮助。它消除给定的一列或多列中的重复值。除了数据框之外，该函数还将列名作为参数。我们也可以将额外的参数传递给管道。</p><p id="ffa5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">管道中的最后一个函数将用于消除异常值。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6c25" class="ma mb it lw b gy mc md l me mf">def remove_outliers(df, column_list):<br/>   for col in column_list:<br/>      avg = df[col].mean()<br/>      std = df[col].std()<br/>      low = avg - 2 * std<br/>      high = avg + 2 * std<br/>      df = df[df[col].between(low, high, inclusive=True)]<br/>   return df</span></pre><p id="035c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该函数的作用如下:</p><ol class=""><li id="3048" class="mi mj it lb b lc ld lf lg li mk lm ml lq mm lu mn mo mp mq bi translated">它需要一个数据框和一列列表</li><li id="31f4" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated">对于列表中的每一列，它计算平均值和标准偏差</li><li id="f5fb" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated">它使用平均值和标准偏差计算下限和上限</li><li id="0482" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated">它删除由下限和上限定义的范围之外的值</li></ol><p id="452a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就像前面的函数一样，您可以选择自己的方式来检测异常值。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><p id="a1b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在有3个函数来处理数据预处理任务。下一步是用这些函数创建一个管道。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f17b" class="ma mb it lw b gy mc md l me mf">df_processed = (df.<br/>                pipe(fill_missing_values).<br/>                pipe(drop_duplicates, "id").<br/>                pipe(remove_outliers, ["A","B"]))</span></pre><p id="e5cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个管道按照给定的顺序执行函数。我们可以将参数和函数名一起传递给管道。</p><p id="f5a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里要提到一点，管道中的一些函数修改了原始数据帧。因此，如上所述使用管道也将更新df。</p><p id="902b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">克服这个问题的一个选择是在管道中使用原始数据帧的副本。如果您不关心保持原始数据框不变，您可以在管道中使用它。</p><p id="e7f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将更新管道如下:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="aaba" class="ma mb it lw b gy mc md l me mf">my_df = df.copy()</span><span id="f512" class="ma mb it lw b gy mg md l me mf">df_processed = (my_df.<br/>                pipe(fill_missing_values).<br/>                pipe(drop_duplicates, "id").<br/>                pipe(remove_outliers, ["A","B"]))</span></pre><p id="d125" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看原始数据帧和经过处理的数据帧:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/5ad2c363dfd11a5204c6d190a161c24c.png" data-original-src="https://miro.medium.com/v2/resize:fit:406/format:webp/1*0mBDI7mPVwSiLJwpf-LxAQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/93a5ff48771fe7430da7b7279cf5acde.png" data-original-src="https://miro.medium.com/v2/resize:fit:526/format:webp/1*xCzesdiYt9CRgl7MUTXTTQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df_processed(图片由作者提供)</p></figure></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h2 id="6a04" class="ma mb it bd nf ng nh dn ni nj nk dp nl li nm nn no lm np nq nr lq ns nt nu nv bi translated">结论</h2><p id="cd52" class="pw-post-body-paragraph kz la it lb b lc nw ju le lf nx jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">当然，您可以通过分别应用这些函数来完成相同的任务。但是，管道功能提供了一种结构化和有组织的方式，可以将多个功能合并到一个操作中。</p><p id="1354" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据原始数据和任务，预处理可能包括更多步骤。您可以根据需要在管道函数中添加任意数量的步骤。随着步骤数量的增加，与单独执行函数相比，管道函数的语法变得更加清晰。</p><p id="516b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>