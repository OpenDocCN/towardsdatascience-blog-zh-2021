<html>
<head>
<title>Aggregating Pairwise Comparison (Inspired by a Demo at ICML 2021)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">汇总两两比较(受ICML 2021展示的启发)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/aggregating-pairwise-comparison-inspired-by-a-demo-at-icml-2021-c6fdc05680e2?source=collection_archive---------33-----------------------#2021-08-13">https://towardsdatascience.com/aggregating-pairwise-comparison-inspired-by-a-demo-at-icml-2021-c6fdc05680e2?source=collection_archive---------33-----------------------#2021-08-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="df1c" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/thoughts-and-theory" rel="noopener" target="_blank">思想和理论</a></h2><div class=""/><div class=""><h2 id="c8e5" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated"><em class="ko">今天我将向你展示如何在众包中执行答案聚合。当多个执行者执行一项人工智能任务时，请求者需要选择正确的响应，也称为聚合结果。</em></h2></div><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/d313372a43488dfb52d75bc5527b6f28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pzwq8lhpu_pwsM73"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">照片由<a class="ae lf" href="https://unsplash.com/@glenncarstenspeters?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">格伦·卡斯滕斯-彼得斯</a>在<a class="ae lf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="16e1" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">许多众包任务被设计为只有一个正确答案，因此注释被简化为经过充分研究的分类任务。在分类任务中，我们使用基于潜在标签假设的算法:只有一个正确的响应，算法需要恢复正确的响应。有了spark-crowd、CEKA或Truth Inference等流行的答案聚合库，就可以用相应的编程语言快速做到这一点。</p><p id="89ff" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">分类并不是一个放之四海而皆准的方法——毕竟，它假设反应是客观的。但是，如果我们想要评估搜索或推荐质量、个人偏好或其他固有的主观任务呢？可能没有客观的答案，我们不能使用潜在标签假设。我们能做的就是从众学习。此类任务通常被设计为并排任务，也称为成对比较。群体表演者需要从两个选项中选择更吸引人的选项，而不是选择正确的答案。尽管这种方法很简单，但它可以用来处理高度复杂的任务——那些可能需要深入指导和大量设计工作的任务。</p><p id="8f4d" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">幸运的是，有一类特殊的成对聚合模型。其中最著名的被称为布拉德利-特里模型，它在1952年发表的一篇文章中首次被提及。从那时起，不同的研究人员和工程师对这个模型做出了贡献。</p><p id="1786" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">在本例中，我们将向您展示如何使用Bradley-Terry模型及其在<a class="ae lf" href="https://github.com/Toloka/crowd-kit" rel="noopener ugc nofollow" target="_blank"> Crowd-Kit </a>中的变体来聚合成对比较。Crowd-Kit是一个开源的计算质量控制库，可用于实现各种质量控制方法，如聚合、不确定性、协议等。</p><p id="cfb8" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们将演示如何在由陈等人于2013年<a class="ae lf" href="https://doi.org/10.1145/2433396.2433420" rel="noopener ugc nofollow" target="_blank"/>发表的<a class="ae lf" href="http://www-personal.umich.edu/~kevynct/datasets/wsdm_rankagg_2013_readability_crowdflower_data.csv" rel="noopener ugc nofollow" target="_blank">著名数据集</a>上聚合成对比较以进行可读性评估。他们比较了成对的段落，问观众哪一段更难读。每篇文章都附加了一个12级可读性等级的基本事实标签。年级越低，课文越简单。这是一个很好的例子，因为我们有原始的众包数据和地面真相标签来评估结果。</p><p id="bd1f" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们在演示中使用了Google Colab，但是任何其他Python编程环境都可以很好地工作。安装了Crowd-Kit并下载了带注释的数据后，我们就可以开始了。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mc"><img src="../Images/527c065473a1738e95d5fdf224a1a820.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*La-mcFdtt298CXjJaXQ7ow.png"/></div></div></figure><p id="0b15" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们来看看数据。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi md"><img src="../Images/61a37b9d332bab81b977c80ad28f9c95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NryKg-jvYrkxufFTWpYVBQ.png"/></div></div></figure><p id="4d52" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们有一对专栏——a篇和b篇——有两个比较的段落。基础事实标签分别是label_level_a和label_level_b。</p><p id="e79f" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们还有一个列please _ decision _ which _ Passage _ is _ more _ different，它包含以下三个值之一:“A段更难。”，“B段比较难。”，或者“我不知道或者不能决定。”，由群众演员提交。</p><p id="95fd" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们需要对数据集进行轻微的重新排列。首先，我们需要为每个回答分配与所选值相匹配的标签(即两个段落中的一个)。其次，我们需要重命名列:_worker_id变成performer，passage_a变成left，passage_b变成right。我们将省略不明确的比较，只保留带有非空标签的行。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi me"><img src="../Images/9bbcbd3f9bdc259d1699ccc3a705e93b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dn0EsNUI6X_QQvBGP8pZew.png"/></div></div></figure><p id="f4e0" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">现在，让我们仔细看看我们的数据。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mf"><img src="../Images/14b33931f065df4b20c83f89c5ed1297.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aQbIyqmUfNi9fc0mry0AZw.png"/></div></div></figure><p id="f8a5" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们有一个成对的比较数据集；每个项目是由表演者提交的具有给定标识符的一对段落。我们想按可读性降序排列这些段落。这就是我们使用Crowd-Kit执行聚合的原因。</p><p id="fdf7" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们从Crowd-Kit导入Bradley-Terry和noise Bradley-Terry类，通过设置迭代次数直接实例化它们，并调用它们的fit_predict方法。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mg"><img src="../Images/3eedcafbdb67d822c38ac4d5b1235612.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_VWPsoDwg4Qgmm8nKIBTLQ.png"/></div></div></figure><p id="bffe" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们的Bradley-Terry实现使用了边缘化最大化方法。噪声类迭代运行L-BFGS-B优化方法来估计参数。这些参数是项目权重以及执行者的偏见和技能。</p><p id="2982" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">让我们看看我们得到了什么。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mh"><img src="../Images/0c90535d4346669e6b1f741957ee8348.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sNQ_SZEWUKSXYT1IuizCVg.png"/></div></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mi"><img src="../Images/eb0135edadbca69087230f8d9d215fa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vHzc1QN0Ab4iy05dQUnysA.png"/></div></div></figure><p id="06ee" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们对段落对的比较就变成了模型提供的一系列对应权重的段落。根据大众的智慧，权重越高，阅读文章就越困难。</p><p id="cdb2" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">现在，让我们来评估模型预测的质量，并构建一个类似的系列文章，但使用地面真实等级。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mj"><img src="../Images/775ab734fb089184636af6f5665311cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bZzhmgjh4MJtSi6KvzVOzQ.png"/></div></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mk"><img src="../Images/65be86fad2dd53964d19509f2133c28f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wOovP0f3KIxMfeHPMS_rLw.png"/></div></div></figure><p id="ff7c" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们将使用<a class="ae lf" href="https://en.wikipedia.org/wiki/Discounted_cumulative_gain" rel="noopener ugc nofollow" target="_blank"> NDCG@k </a>来评估我们的预测，这是一个分级的相关性分数。通过从两个预测序列和一个基础事实序列构建Pandas数据框架，我们只需要两个缺失的元素:从我们的权重推断的实际等级和随机排序基线。前者可以使用Pandas rank方法轻松获得，而后者可以使用NumPy随机数生成器更轻松地生成。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ml"><img src="../Images/407c112e000e14a771cced455b38d4a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pIXJ22ldGoeEzc0r9MXeyQ.png"/></div></div></figure><p id="a6f6" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">我们现在都准备好了。让我们从scikit-learn导入NDCG计算函数，并使用它来计算NDCG@10值。请记住，当k趋于无穷大时，倾向于收敛到1(【王】等，2013 )，并且由于我们的数据集只有490个元素，我们需要坚持使用k=10的相对较小的值。请随意尝试。</p><p id="c6b2" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">在计算了我们的三个模型(基线、布拉德利-特里和嘈杂的布拉德利-特里)的NDCG@10值后，我们发现随机基线预期显示了最差的性能。相比之下，布拉德利-特里模型显示了更高和相似的分数。然而，在这个数据集上，更简单的模型表现优于更复杂的模型。这意味着您甚至可以使用众包数据来执行模型选择。</p><p id="f83b" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">作为质量的最后一个指标，让我们看看预测之间的等级相关性，而不局限于前k项。我们看到布拉德利-特里模型适度地相互关联，并与地面真相标签相关，即使等级的粒度不同。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mm"><img src="../Images/820ec0e225c3834b661f443d6a3a169e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2zYfRqYUZyi8nBadZSCnGA.png"/></div></div></figure><p id="dfc3" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">假设我们想要导出聚合数据，并在下游应用程序中使用它。我们将汇总结果放入数据框，并保存到TSV文件中。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mn"><img src="../Images/aa4e8648afc2b2f0fa6c6c501d0624d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qNDQoTd0YCpd-RVPG9L-ew.png"/></div></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mo"><img src="../Images/191633fb718e906bac0d58a7defc9ede.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MO7-UfmTD3a7ROP2brStLw.png"/></div></div></figure><p id="089a" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">该文件应该出现在“文件”窗格中。如果你打开它，你会看到数据就在那里，还有权重和排名。</p><p id="6443" class="pw-post-body-paragraph lg lh iq li b lj lk ka ll lm ln kd lo lp lq lr ls lt lu lv lw lx ly lz ma mb ij bi translated">现在你已经知道了:我们用几行代码获得了聚合的成对比较，并使用<a class="ae lf" href="https://github.com/Toloka/crowd-kit" rel="noopener ugc nofollow" target="_blank"> Crowd-Kit </a>和常用的Python数据科学库进行了模型选择。</p></div></div>    
</body>
</html>