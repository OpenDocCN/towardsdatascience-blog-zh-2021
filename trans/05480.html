<html>
<head>
<title>An Interactive Web Dashboard with Plotly and Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Plotly和Flask的交互式Web仪表板</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/an-interactive-web-dashboard-with-plotly-and-flask-c365cdec5e3f?source=collection_archive---------2-----------------------#2021-05-15">https://towardsdatascience.com/an-interactive-web-dashboard-with-plotly-and-flask-c365cdec5e3f?source=collection_archive---------2-----------------------#2021-05-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="a119" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">数据可视化</h2><div class=""/><div class=""><h2 id="53ce" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">要用Dash创建一个真正交互式的应用程序，你需要使用回调。你可以用Plotly和Flask达到同样的效果。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/a4959b1bb4a77db01c90b2abc75f816e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lrkc5plidfgwhZlAeQ3dmw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">应用程序和代码—由autho提供的图像</p></figure><p id="1d16" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">看起来好像我对Dash有意见。老实说，我没有；这是一个很好的产品，得到了Plotly的大力支持，做了它想做的事情。</p><p id="b2b3" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">但是，正如我在<a class="ae md" rel="noopener" target="_blank" href="/web-visualization-with-plotly-and-flask-3660abf9c946">上一篇文章</a>中试图演示的那样，当您可以用HTML编写HTML时，就没有必要用Python编写HTML(因为Dash要求您这样做)!我现在要补充的是，Flask应用程序中不需要额外的复杂层——从根本上说，Dash是一个Flask应用程序——只要一点Javascript和HTML就可以完成同样的工作。</p><p id="041a" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在我的上一篇文章中，我展示了你可以创建一个简单的web应用程序，不需要破折号就可以合并Plotly图表。相反，你可以结合使用Flask和网页模板。这也给了你创建多页面应用的优势。</p><div class="me mf gp gr mg mh"><a rel="noopener follow" target="_blank" href="/web-visualization-with-plotly-and-flask-3660abf9c946"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd jd gy z fp mm fr fs mn fu fw jc bi translated">用Plotly和Flask实现Web可视化。</h2><div class="mo l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">towardsdatascience.com</p></div></div><div class="mp l"><div class="mq l mr ms mt mp mu lb mh"/></div></div></a></div><p id="ed20" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">但是Dash也允许你通过使用回调函数将新数据加载到图表中来创建交互式应用。所以问题是，我们能用Plotly plus Flask模型轻松做到这一点吗？当然，答案是肯定的。你可以用Dash做的任何事情也可以用它的底层技术来做:Python、Flask、HTML和Javascript。</p><p id="8e63" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">但是，这真的更容易吗？</p><p id="081d" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这要由你来判断，但从我(可能有偏见)的角度来看是这样的。如果你需要学习一点你以前从未接触过的HTML或Javascript，那么很好，你可能会在未来找到它的用处。</p><p id="def4" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">为了演示这一点，我们将快速运行一个显示一系列国家人均GDP的基本web应用程序。交互性体现在您可以键入一个新的国家名称，图表会通过回调服务器并使用新数据重新加载图表来自动更新。</p><p id="3ec2" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">该应用程序如下所示:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/8e620f66b08f6484fc2425370d504fbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/0*i5j0v6POjacFcEHK"/></div></figure><p id="34c1" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">它基于来自<a class="ae md" href="https://www.gapminder.org/" rel="noopener ugc nofollow" target="_blank"> Gapminder基金会</a>的数据，这些数据包含在Plotly库中，并在他们的一些示例程序中使用。</p><p id="3995" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这个应用程序非常小，非常简单，但是演示了可以用来创建令人印象深刻的交互式仪表板应用程序的技术(并提供了可以重用的代码)。你将需要使用一点HTML，一点Javascript，并知道如何创建和运行Flask应用程序的基本知识(见这里的简单介绍:<a class="ae md" href="https://jones-alan.medium.com/how-to-create-and-run-a-flask-app-533b7b101c86" rel="noopener">如何创建和运行Flask应用程序</a>)。</p><p id="f9fb" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">您可以在本文末尾找到代码的链接——以zip文件的形式下载它，或者从我的Github存储库中访问它。</p><h1 id="1155" class="mw mx it bd my mz na nb nc nd ne nf ng ki nh kj ni kl nj km nk ko nl kp nm nn bi translated">烧瓶应用程序</h1><p id="b51f" class="pw-post-body-paragraph lh li it lj b lk no kd lm ln np kg lp lq nq ls lt lu nr lw lx ly ns ma mb mc im bi translated">您可以在下面的代码中看到定义了两条路由:第13行的根、<em class="nt"> /、</em>和第9行的<em class="nt">回调</em>。他们都使用来自函数<em class="nt"> gm </em>(完成大部分工作)的数据，但是方式不同。根路径使用模板<em class="nt">chartsajax.html</em>(我们将在下面看到)并将数据传递给它，而<em class="nt">回调</em>只是返回数据本身。你大概可以看到这是怎么回事。</p><p id="ea1f" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这个应用程序是一个由根路径和<em class="nt">chartsajax.html</em>渲染的页面。这将绘制一个初始图，但也允许用户输入一个新的国家名称。当输入该名称时，一个请求被发送到<em class="nt">回调</em>路径，从该路径返回的数据被用于更新绘图。结果是一个令人满意的图表更新，但没有您在重新加载整个页面时会遇到的空白屏幕。</p><p id="051f" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">第17行的函数<em class="nt"> gm </em>实际上创建了情节。它需要一个参数，我们要绘制的国家的名称。该参数缺省值为‘英国’,以满足从没有传递参数的根路径进行调用的需要。然后在第18行从Gapminder数据集创建一个Pandas数据帧。由此我们创建了这个国家的图表。</p><p id="3674" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">第22行使用Plotly自带的编码器将图表编码为JSON，这是在HTML页面中呈现图表所必需的，然后将它返回给调用者。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/237a59e4274f86f608960857ace4651e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/0*87A-KxMiPaldZs1B"/></div></figure><h1 id="bd49" class="mw mx it bd my mz na nb nc nd ne nf ng ki nh kj ni kl nj km nk ko nl kp nm nn bi translated">HTML页面</h1><p id="3829" class="pw-post-body-paragraph lh li it lj b lk no kd lm ln np kg lp lq nq ls lt lu nr lw lx ly ns ma mb mc im bi translated">HTML定义了一个简单的布局，如下面第17到23行所示。几个标题后面是一个单独的段落，一个文本输入框，然后是这个节目的明星，图表。Plotly需要一个HTML中的<em class="nt"> &lt; div &gt; </em>标签来构建一个图表，并在第22行显示。</p><p id="16ae" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这是最简单的部分——并不是说其余的部分很复杂。</p><p id="6fb5" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">当页面加载Plotly和JQuery的库时——我们需要Plotly来呈现图形，当然，我们将使用JQuery函数来实现对服务器的回调。接下来，Javascript函数<em class="nt"> cb </em>被定义——稍后会详细介绍。</p><p id="d785" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">然后加载页面主体，第25行到第28行的Javascript第一次也是唯一一次被执行。我们可以在这段代码中看到，变量<em class="nt"> d </em>被设置为模板变量<em class="nt"> graphJSON </em>的值——这是我们在Flask应用程序中传递给模板的值。然后使用Plotly Javascript库中的<em class="nt"> newPlot </em>函数绘制Plotly图形。这给了我们默认的情节。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nv"><img src="../Images/7712e28da547a37ae11f04cc1f625ca9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*r0_RFKJTd3-_Oqj6"/></div></div></figure><p id="db24" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">现在，如果我们想改变图表以显示不同国家的数据，我们只需输入国家的名称，然后按回车键。图表会自动更新。(注意，如果你输入一个无效的国家，你只会得到一个空白的图表。)</p><p id="b4fd" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这通过使用第21行输入字段中的<em class="nt"> onchange </em>属性来实现。<em class="nt"> onchange </em>做的正是你所期望的:当输入字段的值改变时，函数<em class="nt"> cb </em>用字段的值调用。</p><h1 id="cc95" class="mw mx it bd my mz na nb nc nd ne nf ng ki nh kj ni kl nj km nk ko nl kp nm nn bi translated">回电</h1><p id="540c" class="pw-post-body-paragraph lh li it lj b lk no kd lm ln np kg lp lq nq ls lt lu nr lw lx ly ns ma mb mc im bi translated">那个函数<em class="nt"> cb </em>，就是回调函数。它获取输入字段的值，并通过JQuery函数<em class="nt"> getJSON </em>将其发送给回调路由。<em class="nt"> getJSON </em>是一个AJAX调用，它对指定的URL执行异步HTTP请求，向其传递数据，接收响应(它将其解释为JSON编码的)，并定义当接收到成功结果时要调用的函数。</p><p id="a963" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">success函数获取返回值——这是JSON编码的图表——并调用Plotly <em class="nt"> newPlot </em>函数来更新图表。</p><p id="eac9" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">(顺便说一下，AJAX代表异步Javascript和XML——换句话说，使用Javascript的异步HTTP请求使用XML作为数据传输的格式，只是目前JSON是更常见的数据传输格式，而不是XML。)</p><p id="aee9" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我不会深入介绍JQuery函数如何工作的细节，您可以将它作为可以重用的样板代码，或者在这里了解更多关于JQuery的内容。然而，<strong class="lj jd">了解</strong>有用的是数据参数。这看起来像这样</p><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="d0ed" class="ob mx it nx b gy oc od l oe of">data: { ‘data’: selection } </span></pre><p id="3c07" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">并且它是将被发送到Flask应用中的回调函数的数据。<em class="nt">数据</em>是正在发送的参数的名称，而<em class="nt">选择</em>是它的值(从文本输入字段传递过来)。</p><h1 id="83e3" class="mw mx it bd my mz na nb nc nd ne nf ng ki nh kj ni kl nj km nk ko nl kp nm nn bi translated">下一步怎么样</h1><p id="9d6c" class="pw-post-body-paragraph lh li it lj b lk no kd lm ln np kg lp lq nq ls lt lu nr lw lx ly ns ma mb mc im bi translated">正如所承诺的，这是一个使用Flask、Plotly和AJAX的简单交互式web应用程序的快速设计。我希望，随着“<a class="ae md" rel="noopener" target="_blank" href="/web-visualization-with-plotly-and-flask-3660abf9c946">Web Visualization with Plotly and Flask</a>”的发布，您可以使用Dash的底层技术轻松地构建交互式仪表盘，而且这并不是一项令人畏惧的任务。</p><p id="c741" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">Dash教程还演示了其他一些更复杂的行为，当然，这些也可以使用与我演示的技术类似的技术来实现。但那是以后的事了。</p></div><div class="ab cl og oh hx oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="im in io ip iq"><p id="4c01" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">一如既往，感谢阅读。如果你想知道我什么时候发表新文章，请考虑在这里注册一个电子邮件提醒。</p><p id="9e59" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果你不是一个媒体订阅者，那就注册吧，这样你就可以每月花5美元阅读尽可能多的文章。在这里注册，我会赚一点佣金。</p></div><div class="ab cl og oh hx oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="im in io ip iq"><p id="60cd" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><em class="nt">更新:在你可以在下面下载的代码中，我包含了一个新版本，它只使用Ajax来加载图表，也就是说，它不使用传递给模板的参数来加载初始图表。它还在图表上标注了它所代表的国家，我认为这是一个小小的改进——详情请参见自述文件。</em></p><h1 id="d9ea" class="mw mx it bd my mz na nb nc nd ne nf ng ki nh kj ni kl nj km nk ko nl kp nm nn bi translated">获取代码</h1><p id="86f3" class="pw-post-body-paragraph lh li it lj b lk no kd lm ln np kg lp lq nq ls lt lu nr lw lx ly ns ma mb mc im bi translated">请在我的代码库中查看代码，或者在这里的<a class="ae md" href="https://alanjones2.github.io/Flask-Plotly/" rel="noopener ugc nofollow" target="_blank"> Github页面上下载这篇文章和上一篇文章的zip文件。</a></p></div></div>    
</body>
</html>