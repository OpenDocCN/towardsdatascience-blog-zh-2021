<html>
<head>
<title>Can LSTM be used to Forecast the Number of Sunspots?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">LSTM可以用来预测太阳黑子的数量吗？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/modelling-the-number-of-sunspots-with-time-series-analysis-39ce7d88cff3?source=collection_archive---------19-----------------------#2021-09-09">https://towardsdatascience.com/modelling-the-number-of-sunspots-with-time-series-analysis-39ce7d88cff3?source=collection_archive---------19-----------------------#2021-09-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ad65" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我将使用时间序列分析来预测每月太阳黑子的数量。将深入探讨的模型是ARMA和LSTM模型。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b7c8d1267b107683aba04ad3ed02d7a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ed_P3s6Y5sk7cGum"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">美国宇航局在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><h1 id="5815" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="0013" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">首先:什么是太阳黑子？太阳黑子是太阳光球层上的一种暂时现象，看起来比周围的区域更暗。我选择太阳黑子数据集进行时间序列分析的原因是，太阳黑子以11年的太阳周期出现，这意味着我们应该看到数据的季节性成分。我将使用两种不同的方法来模拟季节性趋势，ARMA模型和LSTM模型。</p><blockquote class="mn mo mp"><p id="c9ef" class="lr ls mq lt b lu mr ju lw lx ms jx lz mt mu mc md mv mw mg mh mx my mk ml mm im bi translated">太阳黑子的出现和消失周期为11年</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/13e3122f567511e3b1c48dec8e9ecfb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*o2WBtBRQy7ZYPvA3ED6_Og.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自[ <a class="ae ky" href="https://en.wikipedia.org/wiki/Sunspot" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></figure><p id="7b09" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">将使用的数据是从1749年到2013年，是每个月的月平均值。用于分析的数据可从<a class="ae ky" href="https://www.kaggle.com/robervalt/sunspots" rel="noopener ugc nofollow" target="_blank"> kaggle </a>中找到。下面我有一小段数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/40c366c32aeb4aeaebb97365b0dc78bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:338/format:webp/1*rUWd64aLr4EQuBXfYcZXFw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由[ <a class="ae ky" href="https://ethanskinner94.medium.com" rel="noopener">作者</a> ]提供</p></figure><p id="7061" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">时间序列分析的第一步是绘制数据和自动校正图。我们这样做是为了了解任何潜在的趋势或季节性，通过识别任何趋势，可以使用适当的数学模型。</p><h1 id="9fa4" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">太阳黑子图</h1><p id="5035" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我首先简单地从太阳黑子数据中画出一个600个数据点的区块。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/a055ad20bf4dd82520f62ffc9e8ef2fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*n2VPe5KZDIlySqUbDoX44Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由[ <a class="ae ky" href="https://ethanskinner94.medium.com" rel="noopener">作者</a> ]提供</p></figure><p id="b82e" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">从图中可以看出强烈的季节性成分。然而，每个波峰和波谷的大小不同，这将限制可以使用的数学模型。例如，使用正弦模型可能不会产生最佳结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/4b1ac246b254aa42e92ee1c6ab58c372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*RWlbIvXiA7JNwjzrQcawug.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由[ <a class="ae ky" href="https://en.m.wikipedia.org/wiki/File:Sine_wave_amplitude.svg" rel="noopener ugc nofollow" target="_blank">维基百科</a> ]提供</p></figure><blockquote class="mn mo mp"><p id="2e86" class="lr ls mq lt b lu mr ju lw lx ms jx lz mt mu mc md mv mw mg mh mx my mk ml mm im bi translated">移动平均或数据科学方法将产生最佳的建模结果</p></blockquote><h1 id="a104" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">自相关</h1><p id="d5c5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我开始对时间序列建模之前，我首先制作自相关图，以了解数据中是否存在任何潜在的模式。对于时间序列建模，我希望看到一个没有模式的平稳时间序列。</p><blockquote class="mn mo mp"><p id="7b78" class="lr ls mq lt b lu mr ju lw lx ms jx lz mt mu mc md mv mw mg mh mx my mk ml mm im bi translated">请注意，自动校正是数据点与其自身滞后版本的相关性。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/d37a352baeb74972380b71d9c9d8054b.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*7j2zoYKKqOgv5Z7w4-FcWA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由[ <a class="ae ky" href="https://ethanskinner94.medium.com" rel="noopener">作者</a> ]提供</p></figure><p id="1b9b" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">从自动校正图来看，存在很强的季节性成分。我们需要细分/分解季节性因素。</p><h1 id="03b7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">时间序列分解</h1><p id="6707" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">对于任何给定的时间序列，可以分为三层。将任何时间序列[Xt]视为三个组成部分可能会有所帮助。下面我展示了一个加法模型的数学公式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/9ec589523c115f0394d39330fe178f11.png" data-original-src="https://miro.medium.com/v2/resize:fit:376/format:webp/1*gZaWNZIxfinIhRnuCzLwIg.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/2a7afb58fb0d238887c1c73f15c3ff80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*Zf1YVz86wjbgtyoeXnVntg.png"/></div></figure><p id="b198" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">在我们的例子中，只有季节性因素。考虑到这一点，我们可以应用差分法。如果一个11年的太阳周期有季节性成分，那么我们可以通过减去11年前的值来消除它。</p><p id="3ab4" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">下面是减去季节性趋势的python代码。</p><pre class="kj kk kl km gt ng nh ni bn nj nk bi"><span id="070b" class="nl la it nh b be nm nn l no np">from matplotlib import pyplot<br/>X = df.values<br/>diff = list()<br/>cycle = 132<br/>for i in range(cycle, len(X)):<br/> value = X[i] - X[i - cycle]<br/> diff.append(value)<br/>pyplot.plot(diff)<br/>pyplot.title('Sunspots Dataset Differenced')<br/>pyplot.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/87e28ae1918ada668a419a06eb65a59a.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*JdGIjTRHJmrQueTBawnKLA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由[ <a class="ae ky" href="https://ethanskinner94.medium.com" rel="noopener">作者</a></p></figure><p id="bf6d" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">从差分图上可以看出，时间序列中仍然存在一定的季节性。接下来，我试图用一个11年循环的多项式来模拟季节性。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/a6ab236834f85fe15fd01fbe95a7d497.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*d9n_JyF01S9l5MagWQfepg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由[ <a class="ae ky" href="https://ethanskinner94.medium.com" rel="noopener">作者</a>提供</p></figure><p id="545c" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">二阶多项式在模拟太阳黑子时间序列方面表现不佳。</p><p id="5c96" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">我们需要解决时间序列的一些关键问题:</p><ul class=""><li id="a0fe" class="nr ns it lt b lu mr lx ms ma nt me nu mi nv mm nw nx ny nz bi translated">每个11年周期的震级不同</li><li id="37d2" class="nr ns it lt b lu oa lx ob ma oc me od mi oe mm nw nx ny nz bi translated">这些周期平均相隔11年，但并不准确。</li></ul><p id="42dd" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">自回归移动平均线将很好地解决这些问题。一个不利因素是，未来的预测在展望未来的日子里会受到限制。本文将深入探讨的另一种方法是LSTM。</p><blockquote class="mn mo mp"><p id="9812" class="lr ls mq lt b lu mr ju lw lx ms jx lz mt mu mc md mv mw mg mh mx my mk ml mm im bi translated">LSTM在正向预测中表现良好，并解决了ARMA模型的衰落问题。</p></blockquote><h1 id="089b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">自回归移动平均模型</h1><p id="10d3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">ARMA模型是时间序列建模的有力工具。ARMA(p，q)定义如下:其中<strong class="lt iu"> p </strong>是自回归多项式的阶，而<strong class="lt iu"> q </strong>是移动平均多项式的阶。</p><p id="e375" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">自回归移动平均(ARMA)模型如下所示</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/4c0c057792d292ef0e4b3bd811e4cdc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Y7XpByjPaFnXmp-x.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ARMA模型</p></figure><p id="aa35" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">在python中，我们能够使用ARIMA函数来拟合参数(<strong class="lt iu"> p，q </strong>)。</p><p id="d01f" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">函数<code class="fe og oh oi nh b">ARIMA()</code>接受两个主要参数</p><ul class=""><li id="a740" class="nr ns it lt b lu mr lx ms ma nt me nu mi nv mm nw nx ny nz bi translated"><code class="fe og oh oi nh b">x</code>:单变量时间序列</li><li id="efd8" class="nr ns it lt b lu oa lx ob ma oc me od mi oe mm nw nx ny nz bi translated"><code class="fe og oh oi nh b">order</code>:长度为3的向量，指定ARIMA(p，d，q)模型的阶数</li></ul><p id="f182" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">这里，<strong class="lt iu"> d </strong>表示时间序列的顺序。例如，如果存在底层线性趋势，则<strong class="lt iu"> d </strong>将等于1。</p><blockquote class="mn mo mp"><p id="1520" class="lr ls mq lt b lu mr ju lw lx ms jx lz mt mu mc md mv mw mg mh mx my mk ml mm im bi translated">当拟合ARMA模型时，我们设置<strong class="lt iu"> d </strong>等于0。</p></blockquote><pre class="kj kk kl km gt ng nh ni bn nj nk bi"><span id="8856" class="nl la it nh b be nm nn l no np">from statsmodels.tsa.arima_model import ARIMA<br/>y = np.array(RNN_data.value)<br/>model = ARIMA(y, order=(1,0,1)) #ARMA(1,1) model<br/>model_fit = model.fit(disp = 0)<br/>print(model_fit.summary())<br/># Plot residual errors<br/>residuals = pd.DataFrame(model_fit.resid)<br/>fig, ax = plt.subplots(1,2)<br/>residuals.plot(title="Residuals", ax=ax[0])<br/>residuals.plot(kind='kde', title='Density', ax=ax[1])<br/>plt.show()<br/># Actual vs Fitted<br/>cut_t = 30<br/>predictions = model_fit.predict()<br/>plot = pd.DataFrame({'Date':date,'Actual':abs(y[cut_t:]),"Predicted": predictions[cut_t:]})<br/>plot.plot(x='Date',y=['Actual','Predicted'],title = 'ARMA(1,1) Sunspots Prediction',legend = True)<br/>RMSE = np.sqrt(np.mean(residuals**2))</span></pre><p id="6174" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">ARMA(1，1)模型产生单日预测。换句话说，我们提前一天预测。</p><blockquote class="mn mo mp"><p id="9ce1" class="lr ls mq lt b lu mr ju lw lx ms jx lz mt mu mc md mv mw mg mh mx my mk ml mm im bi translated">ARMA模型的一个缺点是向前预测的天数。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/70ade4625b4036bcbf4b5627d7e18d62.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*vqfuaOFu-SYCy_4NngNdGg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由[ <a class="ae ky" href="https://ethanskinner94.medium.com" rel="noopener">作者</a> ]提供</p></figure><h1 id="bf8a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">LSTM模型</h1><p id="5fa1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">LSTM是RNN家族中的典范。它可以被认为是一个时间序列数据的神经网络。</p><blockquote class="mn mo mp"><p id="f7bc" class="lr ls mq lt b lu mr ju lw lx ms jx lz mt mu mc md mv mw mg mh mx my mk ml mm im bi translated">LSTM与神经网络的不同之处如下:LSTM不是单次输入到神经网络中，而是用前x天进行输入。</p></blockquote><p id="dc3f" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">你可能会开始理解为什么这对太阳黑子数据集有用。通过使用以前的数据作为输入，该模型将试图捕捉11年周期的季节性信息。</p><p id="3d8b" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">LSTM背后的主要思想是遗忘之门，信息可以通过它传递给下一个神经网络。</p><p id="1b3f" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">这里的绿色块代表回望日，例如，如果我们的LSTM模型使用3天的回望期，下图将代表我们模型中的一天。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/e17292e8ee88776bb9389669a8a6b75b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ErUAtPkk7y-4azjVtZdb2g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自[ <a class="ae ky" href="https://en.m.wikipedia.org/wiki/Long_short-term_memory" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></figure><blockquote class="mn mo mp"><p id="5b59" class="lr ls mq lt b lu mr ju lw lx ms jx lz mt mu mc md mv mw mg mh mx my mk ml mm im bi translated">对于LSTM模型，模型结构由输入数据的结构和预测特征决定</p></blockquote><p id="6b43" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">用于回顾的前几个月的数量和输入特征的数量将决定需要权重和偏差的神经元的数量。</p><h1 id="bbd4" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">Python中的LSTM建模</h1><p id="886b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我将使用Keras库和包来创建LSTM模型。</p><blockquote class="mn mo mp"><p id="8f62" class="lr ls mq lt b lu mr ju lw lx ms jx lz mt mu mc md mv mw mg mh mx my mk ml mm im bi translated">创建输入数据结构是Python中LSTM建模的最重要步骤</p></blockquote><p id="bfcd" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">第一步是简单地将我们的数据分成训练和测试数据集。</p><pre class="kj kk kl km gt ng nh ni bn nj nk bi"><span id="be50" class="nl la it nh b be nm nn l no np">split = 0.7<br/>#Split into test and training set (70/20 split)<br/>length = len(dataset)<br/>train_length = round(length*split)<br/>test_length = len(dataset) - train_length<br/>train = dataset[0:train_length,:]<br/>test = dataset[train_length:length,:]</span></pre><p id="e93f" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">让我们介绍一下单日LSTM预报的预处理功能。</p><pre class="kj kk kl km gt ng nh ni bn nj nk bi"><span id="79bd" class="nl la it nh b be nm nn l no np">def preprocessing(training_set_scaled,n,train_length,days):<br/>    y_train = []<br/>    for i in range(days, train_length -1 ):<br/>        y_train.append(training_set_scaled[i, 0]) # note that our predictor variable is in the first column of our array <br/>    y_train = np.array(y_train)<br/>    <br/>    X = np.zeros(shape=[train_length - (days+1),days,n],dtype=float)<br/>    for j in range(n):<br/>        for i in range(days, train_length-1):<br/>            X[i-days,:,j] = training_set_scaled[i-days:i, j]<br/>    return X, y_train</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/a085b07179c36cab96d8ae6a06f25adb.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*poVvZ0Jjtli409scqGtCPw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由[ <a class="ae ky" href="https://ethanskinner94.medium.com" rel="noopener">作者</a></p></figure><p id="ea5a" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">这里我们的numpy数组的形状如下</p><ul class=""><li id="8630" class="nr ns it lt b lu mr lx ms ma nt me nu mi nv mm nw nx ny nz bi translated">我们训练数据中的天数</li><li id="4455" class="nr ns it lt b lu oa lx ob ma oc me od mi oe mm nw nx ny nz bi translated"><strong class="lt iu"> 3: </strong>我们回顾预测的天数</li><li id="55cb" class="nr ns it lt b lu oa lx ob ma oc me od mi oe mm nw nx ny nz bi translated"><strong class="lt iu"> 1: </strong>用于预测的特征数量</li></ul><h2 id="a385" class="ol la it bd lb om on dn lf oo op dp lj ma oq or ll me os ot ln mi ou ov lp ow bi translated">接下来我介绍LSTM模型的结构</h2><pre class="kj kk kl km gt ng nh ni bn nj nk bi"><span id="52ce" class="nl la it nh b be nm nn l no np"># Initialising the RNN<br/>regressor = Sequential()<br/># Adding the first LSTM layer and some Dropout regularisation<br/>regressor.add(LSTM(units = nodes, return_sequences = True, input_shape = (new.shape[1], new.shape[2])))<br/>regressor.add(Dropout(0.2))<br/># Adding a second LSTM layer and some Dropout regularisation<br/>regressor.add(LSTM(units = nodes, return_sequences = True))<br/>regressor.add(Dropout(0.2))<br/># Adding a third LSTM layer and some Dropout regularisation<br/>regressor.add(LSTM(units = nodes, return_sequences = True))<br/>regressor.add(Dropout(0.2))<br/>regressor.add(LSTM(units = nodes))<br/>regressor.add(Dropout(0.2))<br/># Adding the output layer<br/>regressor.add(Dense(units = t)) # this is the output layer so this repersetns a single node with our output value<br/># Compiling the RNN<br/>regressor.compile(optimizer = 'adam', loss = 'mean_squared_error')<br/># Fitting the RNN to the Training set<br/>model = regressor.fit(new, y_train, epochs = 50, batch_size = 22)</span></pre><h2 id="8b99" class="ol la it bd lb om on dn lf oo op dp lj ma oq or ll me os ot ln mi ou ov lp ow bi translated">LSTM单日远期预测</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/9b2a0de75527683e7e0f1940c4e1d9d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*Didcj4PVH8jACp5hbe-aYw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由[ <a class="ae ky" href="https://ethanskinner94.medium.com" rel="noopener">作者</a> ]提供</p></figure><p id="aeb8" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">LSTM模型预测得相当好，然而，这部分只是因为我们一次预测未来的一天。接下来，我们来看看多日远期预测。</p><h1 id="6e66" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">Python中的多日LSTM建模</h1><p id="d43e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们介绍一下多日LSTM预报的预处理功能。</p><ul class=""><li id="d853" class="nr ns it lt b lu mr lx ms ma nt me nu mi nv mm nw nx ny nz bi translated">回顾是3天</li><li id="d265" class="nr ns it lt b lu oa lx ob ma oc me od mi oe mm nw nx ny nz bi translated">远期预测是5天</li></ul><blockquote class="mn mo mp"><p id="79a1" class="lr ls mq lt b lu mr ju lw lx ms jx lz mt mu mc md mv mw mg mh mx my mk ml mm im bi translated">我用之前的3天来预测未来5天的时间。</p></blockquote><pre class="kj kk kl km gt ng nh ni bn nj nk bi"><span id="61ba" class="nl la it nh b be nm nn l no np">def preprocessing_muli(training_set_scaled,n,t,train_length,days):<br/>    days_length = train_length - t<br/>    y_train = np.zeros(shape=[days_length-t,t],dtype=float)<br/>    #y_train[:,0] = training_set_scaled[t:days,0]<br/>    #y_train = np.zeros(shape=[days_length - t,days],dtype=float)<br/>    for i in range(t):<br/>        y_train[:,i] = training_set_scaled[i+t:days_length+i,0] # Here each column repersents a time step.<br/>    <br/>    X = np.zeros(shape=[days_length-t,days,n],dtype=float)<br/>    for j in range(n):<br/>        for i in range(days):<br/>            X[:,i,j] = training_set_scaled[i:days_length-t+i, j] <br/>    return X, y_train</span></pre><h1 id="b6a0" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">损失函数</h1><p id="3894" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我探索了拟合LSTM模型时的损失函数，以了解模型是否收敛以及收敛速度有多快。损失函数是我们的预测与响应变量之间距离的度量。下面是一个使用MSE拟合线性回归模型的例子。理解从每个蓝点到线的距离是测量的，然后平方，最后除以数据点的总数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/3c4a1dc6daa82deb322112839236eb38.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*BDIA6zfqhqd5iaM4i6RxdA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由[ <a class="ae ky" href="https://commons.wikimedia.org/wiki/File:Linear_regression.svg#mw-jump-to-license" rel="noopener ugc nofollow" target="_blank">维基百科</a> ]提供</p></figure><p id="e9bd" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">为了简单起见，我将使用均方差作为损失函数。均方误差(MSE)的计算公式如下</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/a44e90ea4b4ad90bbab82332c3c0de93.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/0*3Qrnd4epaDdsjoeJ.png"/></div></figure><p id="855a" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">根据<strong class="lt iu"> MSE </strong>公式，hat代表变量y的预测值或估计值。在数学中，变量上方的hat代表给定随机变量的估计值。<strong class="lt iu"> n </strong>代表我们估计的总数据点的数量。上图显示了如何计算二维简单线性回归模型的MSE。</p><p id="6f4a" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">多日LSTM模型的MSE损失函数的结果如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/93a3d188b44f6c36d3cefb34b0c5da20.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*ywiL1GDwVlfFn9POmVRvCw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由[ <a class="ae ky" href="https://ethanskinner94.medium.com" rel="noopener">作者</a></p></figure><h2 id="efdc" class="ol la it bd lb om on dn lf oo op dp lj ma oq or ll me os ot ln mi ou ov lp ow bi translated">3天回顾和5天预测的结果。</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/d3c041b18a4ae1b57b8a5b19c1779bcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*KMZePW1-wtRArr6TKze3TQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由[ <a class="ae ky" href="https://ethanskinner94.medium.com" rel="noopener">作者</a>提供</p></figure><h1 id="8a41" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">Python中的LSTM -太阳黑子11年周期预测</h1><p id="dbc1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">接下来，我研究LSTM模型能否预测未来一个完整的周期。对于我们的数据集，每个数据点代表一个月，我们知道我们应该预期每11年一个太阳黑子周期，所以我们将向前预测未来的132个数据点。然而，为了捕捉下一个周期的一部分，我将使用160天进行预测。</p><ul class=""><li id="65a5" class="nr ns it lt b lu mr lx ms ma nt me nu mi nv mm nw nx ny nz bi translated">回望是200天</li><li id="23cb" class="nr ns it lt b lu oa lx ob ma oc me od mi oe mm nw nx ny nz bi translated">远期预测是160天</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/cbf46ba534d730ed555a66390e774355.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*MhBsFjA9a55wLhiuyu__Hw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由[ <a class="ae ky" href="https://ethanskinner94.medium.com" rel="noopener">作者</a> ]提供</p></figure><p id="37d1" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">LSTM确实很好地捕捉了时间序列的季节性或周期性成分，但是它会偏移，并且波峰和波谷不对齐。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/819a87aa370ba5ebf66d533796324b38.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*iSGtvWycG3n3oQgmzdU5Yw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由[ <a class="ae ky" href="https://ethanskinner94.medium.com" rel="noopener">作者</a> ]提供</p></figure><p id="720b" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">试图预测未来整个11年的周期并没有产生最好的结果，所以接下来我试图预测未来半个周期或大约60天。</p><h1 id="4bd8" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">Python中的LSTM太阳黑子半周预测</h1><p id="05d6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">最后，我研究了LSTM模型是否可以预测提前半个周期。对于我们的数据集，每个数据点代表一个月，我们知道我们应该预期每11年一个太阳黑子周期，所以我们将向前预测未来约60个数据点。</p><ul class=""><li id="f9b4" class="nr ns it lt b lu mr lx ms ma nt me nu mi nv mm nw nx ny nz bi translated">回望是120天</li><li id="bf72" class="nr ns it lt b lu oa lx ob ma oc me od mi oe mm nw nx ny nz bi translated">远期预测是60天</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/bf1d4673b89b7887ee2085d5e5de56a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*OWdRVifCxgn8W0RzwskNcg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自[ <a class="ae ky" href="https://ethanskinner94.medium.com" rel="noopener">作者</a></p></figure><p id="0840" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">在这里，我创建了四个块，每个60天，用于预测测试数据集。</p><h2 id="8712" class="ol la it bd lb om on dn lf oo op dp lj ma oq or ll me os ot ln mi ou ov lp ow bi translated">接下来我计划未来60天。</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/a1a87676151913f8c18e1de787f620d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*A9R3UNCHUnLUZJsWQO5N9w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由[ <a class="ae ky" href="https://ethanskinner94.medium.com" rel="noopener">作者</a> ]提供</p></figure><h1 id="fedb" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="e2ad" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">本文中展示的一切都是使用真实数据来预测太阳黑子数据集的。ARMA和LSTM都得到了深入的评估。在多日远期预测方面，LSTM远远优于ARMA模型，ARMA模型可以捕捉季节性成分，而LSTM不能正确识别新周期的开始和结束。在预测太阳黑子数量时，给LSTM模型增加额外的特征可能会产生更好的结果。</p><blockquote class="mn mo mp"><p id="75eb" class="lr ls mq lt b lu mr ju lw lx ms jx lz mt mu mc md mv mw mg mh mx my mk ml mm im bi translated">我建议使用LSTM模型来模拟太阳黑子数据集。</p></blockquote></div><div class="ab cl pd pe hx pf" role="separator"><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi"/></div><div class="im in io ip iq"><h1 id="84f3" class="kz la it bd lb lc pk le lf lg pl li lj jz pm ka ll kc pn kd ln kf po kg lp lq bi translated">关于我自己的一点点</h1><p id="de16" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我最近在加拿大多伦多的瑞尔森大学获得了应用数学硕士学位。我是金融数学组的一员，专业是统计学。我深入研究了波动建模和算法交易。</p><p id="85c1" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">我之前在庞巴迪宇航公司担任工程专业人员，负责与飞机维护相关的生命周期成本建模。</p><p id="145b" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">本人积极训练铁人三项，热爱健身。</p><p id="c8dd" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">如果您对以下主题有任何建议，请告诉我</p><ul class=""><li id="eb80" class="nr ns it lt b lu mr lx ms ma nt me nu mi nv mm nw nx ny nz bi translated">数据科学</li><li id="0fdc" class="nr ns it lt b lu oa lx ob ma oc me od mi oe mm nw nx ny nz bi translated">机器学习</li><li id="d24e" class="nr ns it lt b lu oa lx ob ma oc me od mi oe mm nw nx ny nz bi translated">数学</li><li id="2c74" class="nr ns it lt b lu oa lx ob ma oc me od mi oe mm nw nx ny nz bi translated">统计建模</li></ul><p id="3ac2" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">领英:<a class="ae ky" href="https://www.linkedin.com/in/ethanjohnsonskinner/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/ethanjohnsonskinner/</a></p><p id="1b80" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated">推特:@Ethan_JS94</p><p id="ad87" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mu mc md me mw mg mh mi my mk ml mm im bi translated"><a class="ae ky" href="https://ethanskinner94.medium.com/membership" rel="noopener">通过我的推荐链接加入灵媒——伊森·约翰逊·斯金纳，理学硕士</a></p></div></div>    
</body>
</html>