<html>
<head>
<title>As a Novice: I Learned That Using Configuration Files in Python Makes Development More Efficient</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">作为新手:我了解到在Python中使用配置文件可以使开发更高效</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/as-a-novice-i-learned-that-using-configuration-files-in-python-makes-development-more-efficient-29c75b4eabd5?source=collection_archive---------10-----------------------#2021-08-14">https://towardsdatascience.com/as-a-novice-i-learned-that-using-configuration-files-in-python-makes-development-more-efficient-29c75b4eabd5?source=collection_archive---------10-----------------------#2021-08-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1f12" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">查看使用配置文件时的区别</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bc6b6077cb4db028f5a5c0013c52485c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IAT1dBRrE4wYUCKnRyeIkQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">费伦茨·阿尔马西拍摄于<a class="ae ky" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><h2 id="97d2" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">介绍</h2><p id="8152" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">在理解配置文件之前，我的脚本通常非常<em class="mo">长，重复，低效</em>。此外，每次变量发生变化时，我都会花大部分时间在脚本的不同部分进行更改，这非常耗时。然后我注意到其他人正在使用配置文件作为他们开发的一部分，我也开始探索和实现它们，我意识到当使用配置文件时，事情变得更加<strong class="lx iu">高效、灵活和有组织</strong>。</p><h2 id="1dbe" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">那么什么是配置文件呢？</h2><ul class=""><li id="2526" class="mp mq it lx b ly lz mb mc li mr lm ms lq mt mn mu mv mw mx bi translated">配置文件允许我们配置参数和初始设置。</li><li id="c8a3" class="mp mq it lx b ly my mb mz li na lm nb lq nc mn mu mv mw mx bi translated">配置文件的格式可以是— yaml <em class="mo">，ini，json，xml </em></li></ul><p id="ecfe" class="pw-post-body-paragraph lv lw it lx b ly nd ju ma mb ne jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">配置文件通常用于存储敏感信息，如数据库凭证、密码、服务器主机名、管理参数等。</p><p id="34dd" class="pw-post-body-paragraph lv lw it lx b ly nd ju ma mb ne jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">在本文中，我将分享在机器学习项目中使用<strong class="lx iu">配置文件与不使用配置文件</strong>的区别。我们将使用的配置文件格式是YAML格式。代表另一种标记语言的YAML被选中，因为它没有诸如大括号和方括号之类的格式，这使得它因可读性和易写性而受欢迎。</p><p id="92d0" class="pw-post-body-paragraph lv lw it lx b ly nd ju ma mb ne jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">这个用例中的场景是基于不同的预建模型执行评分(预测)。每个模型需要不同的数据集来执行预测，但源表是相同的。下图说明了构建所需的过程:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/c6b854549b1611503f096305ea7bb0d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*57pPwWpvgEW1dUMRbhXC4g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用例场景说明</p></figure><p id="a2e0" class="pw-post-body-paragraph lv lw it lx b ly nd ju ma mb ne jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">评分流程概述:</p><ul class=""><li id="6e5a" class="mp mq it lx b ly nd mb ne li nj lm nk lq nl mn mu mv mw mx bi translated">有两个模型:Model_A和Model_B，它们已经基于不同的数据集预先构建，但是是从相同的features表中检索的。</li><li id="51de" class="mp mq it lx b ly my mb mz li na lm nb lq nc mn mu mv mw mx bi translated">为模型A准备评分脚本，根据数据集A进行预测，并将预测结果推送到数据库中。</li><li id="6a4b" class="mp mq it lx b ly my mb mz li na lm nb lq nc mn mu mv mw mx bi translated">为模型B准备评分脚本，根据数据集B进行预测，并将预测结果推送到数据库中。</li></ul><p id="a0d6" class="pw-post-body-paragraph lv lw it lx b ly nd ju ma mb ne jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated"><em class="mo">(在这个用例中，开发的模型基于从</em> <a class="ae ky" href="https://www.kaggle.com/rohitsahoo/sales-forecasting" rel="noopener ugc nofollow" target="_blank"> <em class="mo"> Kaggle:超市销售数据集</em></a><em class="mo">)T21】</em></p><p id="0767" class="pw-post-body-paragraph lv lw it lx b ly nd ju ma mb ne jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">现在，让我们来看看如何实现配置文件，以及不使用配置文件时的比较。</p><h2 id="ac46" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">带有配置文件的评分脚本:</h2><p id="2042" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">首先，让我们看看YAML的配置文件是什么样子的。下面是一个配置文件<strong class="lx iu"> (model_A.yml) </strong>的示例，它指定了模型A执行模型预测所需的段、模型文件名和列。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="b6c3" class="pw-post-body-paragraph lv lw it lx b ly nd ju ma mb ne jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">然后，我们将加载并读取YAML文件，作为评分脚本的一部分。下面是一个使用python加载YAML文件并读取配置文件中的值的示例。注意，配置文件名是用变量<strong class="lx iu"><em class="mo">“+模型+”指定的。yml </em>而不是<em class="mo">" model_A.yml "</em></strong><em class="mo"/>因为我们有多个YAML文件要加载到脚本中(model _ a . yml，model_B.yml)。用这种方法指定允许我们为不同的模型重用相同的脚本。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="497e" class="kz la it np b gy nt nu l nv nw">config_file = ""+model+".yml"</span><span id="8c72" class="kz la it np b gy nx nu l nv nw">with open(config_file, "rb") as file:<br/>        config = yaml.load(file)</span><span id="50b3" class="kz la it np b gy nx nu l nv nw">segment = config['segment']<br/>model_file_name = config['model_file_name']<br/>columns = config['columns']</span></pre><p id="8933" class="pw-post-body-paragraph lv lw it lx b ly nd ju ma mb ne jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">在我们的评分脚本中，配置变量在两个不同的区域被调用:</p><p id="bc6b" class="pw-post-body-paragraph lv lw it lx b ly nd ju ma mb ne jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">(1) <strong class="lx iu">配置变量[' segment ']&amp;[' columns ']</strong>用于从Google Big Query中检索模型A所需的数据集</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="a233" class="kz la it np b gy nt nu l nv nw">client = bigquery.Client()<br/>table_id = 'sales_data.superstore_sales_data_processed'<br/>sql = "SELECT <strong class="np iu">{columns}</strong> FROM `sue-gcp-learning-env.sales_data.superstore_sales_data_processed` where segment = ? and year_week = ?;".format(<strong class="np iu">columns</strong>=",".join(<strong class="np iu">columns</strong>))</span><span id="fc27" class="kz la it np b gy nx nu l nv nw">job_config = bigquery.QueryJobConfig(<br/>        query_parameters = [<br/>            bigquery.ScalarQueryParameter(None, "STRING" , <strong class="np iu">segment</strong>),<br/>            bigquery.ScalarQueryParameter(None, "INTEGER" , int(year_week))<br/>        ]<br/>    )</span></pre><p id="d02f" class="pw-post-body-paragraph lv lw it lx b ly nd ju ma mb ne jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">(2) <strong class="lx iu">配置变量['模型文件名称'] </strong>用于调用加载模型的pickle文件</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="0cdb" class="kz la it np b gy nt nu l nv nw">pickle_file_name = <strong class="np iu">model_file_name</strong><br/>with open(pickle_file_name,'rb') as pickle_model:<br/>     model = pickle.load(pickle_model)</span></pre><p id="a23f" class="pw-post-body-paragraph lv lw it lx b ly nd ju ma mb ne jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">现在让我们看看我们最终的评分脚本是什么样子的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="5036" class="pw-post-body-paragraph lv lw it lx b ly nd ju ma mb ne jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">要为模型A或模型B运行我们的评分脚本，我们可以调用带有指定参数的函数。(型号_A /型号_B)。例如，在下图中，通过传递与YAML文件(model_A.yml，model_B.yml)同名的参数，可以使用相同的评分脚本为模型A和模型B运行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/778624ad6ead6f5cf7b9eb48c01a1980.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*TYxpOKkrYrHl2m_VdbUD_w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">调用评分脚本函数</p></figure><h2 id="d658" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">没有配置文件的评分脚本:</h2><p id="2867" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">现在让我们看看不使用配置文件时的区别。在下面的脚本中，请注意变量是基于模型A所需的细分值硬编码的— <strong class="lx iu">细分=‘消费者’</strong>。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="a94d" class="kz la it np b gy nt nu l nv nw">client = bigquery.Client()<br/>    table_id = 'sales_data.superstore_sales_data_processed'<br/>    sql = "SELECT * EXCEPT(total_sales) FROM `sue-gcp-learning-env.sales_data.superstore_sales_data_processed`  where <strong class="np iu">segment = 'Consumer'</strong> and year_week =?"</span><span id="5caf" class="kz la it np b gy nx nu l nv nw">job_config = bigquery.QueryJobConfig(<br/>        query_parameters = [<br/>            bigquery.ScalarQueryParameter(None, "INTEGER" , int(year_week))<br/>        ]<br/>    )</span></pre><p id="d6f3" class="pw-post-body-paragraph lv lw it lx b ly nd ju ma mb ne jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">此外，模型A的模型文件名也是硬编码的</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="77d9" class="kz la it np b gy nt nu l nv nw">pickle_file_name = <strong class="np iu">'model_A_consumer.pkl'</strong><br/>with open(pickle_file_name,'rb') as pickle_model:<br/>    model = pickle.load(pickle_model)</span></pre><p id="30e8" class="pw-post-body-paragraph lv lw it lx b ly nd ju ma mb ne jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">下面是没有配置文件的最终脚本。现在，该脚本只显示了一个模型，如果我们将这种方法用于模型B，它将是模型B变量被硬编码的脚本的副本。随着我们有越来越多的模型，脚本将继续复制。<strong class="lx iu">例如，如果我们有10个模型要执行评分，并且没有引入配置文件，那么我们的脚本将是下面脚本长度的10倍。</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="b1c3" class="pw-post-body-paragraph lv lw it lx b ly nd ju ma mb ne jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">如果您想查看包括型号B的配置文件在内的完整代码，可在<a class="ae ky" href="https://github.com/iamsuelynn/Config_Comparison" rel="noopener ugc nofollow" target="_blank"> <strong class="lx iu"> Github </strong> </a>上找到。</p><h2 id="b991" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论:</h2><p id="4c1f" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">将配置文件作为软件开发的一部分来添加，使事情更易于管理，并且无疑使我的生活更加轻松。在我目前的项目中，我们有数百个模型要开发和评分。如果我对所有东西都进行硬编码，将会花费大量的时间，并且可能会达到无法控制的程度。我很高兴我意识到了使用配置文件的重要性，并希望这篇文章可以帮助任何人在他们的下一个项目中开始使用配置文件。</p><h2 id="2cab" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">引用&amp;链接</strong></h2><p id="3b5c" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">[1]<a class="ae ky" href="https://www.analyticsvidhya.com/blog/2021/05/reproducible-ml-reports-using-yaml-configs-with-codes/" rel="noopener ugc nofollow" target="_blank">https://www . analyticsvidhya . com/blog/2021/05/reproducible-ml-reports-using-YAML-configs-with-codes/</a></p><p id="6f8f" class="pw-post-body-paragraph lv lw it lx b ly nd ju ma mb ne jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">[2]<a class="ae ky" href="https://medium.com/analytics-vidhya/how-to-write-configuration-files-in-your-machine-learning-project-47bc840acc19" rel="noopener">https://medium . com/analytics-vid hya/how-to-write-configuration-files-in-your-machine-learning-project-47bc 840 ACC 19</a></p><p id="8c2b" class="pw-post-body-paragraph lv lw it lx b ly nd ju ma mb ne jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">[3]<a class="ae ky" href="https://www.kaggle.com/rohitsahoo/sales-forecasting" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/rohitsahoo/sales-forecasting</a></p><p id="4c8c" class="pw-post-body-paragraph lv lw it lx b ly nd ju ma mb ne jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated"><a class="ae ky" href="https://www.tutorialspoint.com/yaml/index.htm" rel="noopener ugc nofollow" target="_blank">https://www.tutorialspoint.com/yaml/index.htm</a></p></div></div>    
</body>
</html>