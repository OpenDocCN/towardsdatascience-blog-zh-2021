<html>
<head>
<title>Integrating Snowflake with Glue</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用胶水粘合雪花</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/integrating-snowflake-with-glue-c00a1e25335c?source=collection_archive---------12-----------------------#2021-04-08">https://towardsdatascience.com/integrating-snowflake-with-glue-c00a1e25335c?source=collection_archive---------12-----------------------#2021-04-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9039" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将两个系统结合在一起可能很棘手，但是您获得的数据洞察力是值得的。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/da84c6df8786065493a65c38261db2c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BF641wtdQcNqcfQX6Xno2w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">米凯拉·帕兰特在<a class="ae ky" href="https://unsplash.com/s/photos/fencing?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="c70b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">雪花是一个优秀的现代数据库，它将传统SQL的强大功能与现代数据湖架构相结合。AWS Glue是内置于AWS无服务器生态系统中的本地ETL环境。它们共同构成了构建现代数据湖的强大组合。</p><p id="023a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文将详细介绍如何创建一个胶合工作来将<a class="ae ky" href="https://www.kaggle.com/heesoo37/120-years-of-olympic-history-athletes-and-results" rel="noopener ugc nofollow" target="_blank"> 120年的奥运奖牌数据</a>加载到雪花数据库中，以确定哪个国家拥有最好的击剑手。</p><h1 id="b6f4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">将您的雪花凭据集成到Secrets Manager中</h1><p id="2511" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">AWS提供了一个名为Secrets Manager的实用程序来存储密码，它有几个特性，包括自动密码轮换，这使它非常适合安全存储。</p><p id="06ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">利用Secrets Manager的最佳方式是使用多因素身份验证来存储您的雪花凭据。</p><p id="68fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开<a class="ae ky" href="https://console.aws.amazon.com/secretsmanager" rel="noopener ugc nofollow" target="_blank">秘密管理器</a>，添加你的雪花用户证书。填写管理器中的所有必填字段，并存储密码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/ca888b552cd3a9db5234f2c4ed36a797.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KQ312R4v7_q7Mmw_tlob2Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">雪花连接参数(按作者)</p></figure><p id="a443" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">填写雪花连接信息</p><p id="2e0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记录秘密ID，并将其添加到云形成文件中的<a class="ae ky" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-role.html" rel="noopener ugc nofollow" target="_blank"> AWS::IAM::Role </a>规范中。使用环境变量来存储机密名称。不用担心；我们将使用AWS角色来明确限制对粘合作业的秘密访问。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="8b66" class="my lw it mu b gy mz na l nb nc">- PolicyName: "AllowSecretsManager"<br/>  PolicyDocument:<br/>    Version: "2012-10-17"<br/>    Statement:<br/>      - Effect: "Allow"<br/>        Action: [<br/>            "secretsmanager:GetSecretValue",<br/>            "secretsmanager:DescribeSecret"<br/>        ]<br/>        Resource: [<br/>            !Sub "arn:aws:secretsmanager:${AWS::Region}:${AWS::AccountId}:secret:${SecretName}*"</span></pre><p id="47b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该策略将允许您的胶合作业连接到雪花以执行操作。</p><h1 id="ae09" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创造一个舞台</h1><p id="cc08" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">复制需要连接到AWS中S3存储桶的阶段。按照雪花法创建一个阶段。最佳实践是为您的S3存储区创建一个<a class="ae ky" href="https://docs.snowflake.com/en/sql-reference/sql/create-storage-integration.html" rel="noopener ugc nofollow" target="_blank">存储集成</a>，然后为应用程序或客户创建多个存储集成阶段。你可以使用<a class="ae ky" href="https://docs.snowflake.com/en/user-guide/snowsql.html" rel="noopener ugc nofollow" target="_blank"> SNOWSQL </a>和变量替换来实现自动化。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="5dd1" class="my lw it mu b gy mz na l nb nc">!set variable_substitution=true;<br/>create or replace stage &amp;{database}.stage.OLYMPICS<br/>storage_integration = &amp;{storage_integration}<br/>url = '&amp;{S3DataHome}/stage/olympics/';</span></pre><h1 id="1932" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">在雪花中创建一个表来包含数据</h1><p id="95e9" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们将创建一个表来包含公共数据集，该数据集包含按运动员、运动和他们所代表的国家分类的运动员成绩。下表列出了每个数据仓库表应该包含的数据集列和标准列(以粗体突出显示)。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="f0db" class="my lw it mu b gy mz na l nb nc">CREATE OR REPLACE TABLE STAGE.OLYMPICS_ATHELETE_EVENT<br/>(<br/><strong class="mu iu">    FILE_LOAD_ID     INTEGER identity (1,1),<br/>    FILE_NAME         VARCHAR,<br/>    FILE_ROW_NUMBER         INTEGER,</strong><br/>    ID             VARCHAR(100) NOT NULL,<br/>    NAME           VARCHAR(100) NOT NULL,<br/>    SEX            VARCHAR(100) NOT NULL,<br/>    AGE            VARCHAR(100) NOT NULL,<br/>    HEIGHT         VARCHAR(100) NOT NULL,<br/>    WEIGHT         VARCHAR(100) NOT NULL,<br/>    TEAM           VARCHAR(100) NOT NULL,<br/>    NOC            VARCHAR(100) NOT NULL,<br/>    GAMES          VARCHAR(100) NOT NULL,<br/>    YEAR           VARCHAR(100) NOT NULL,<br/>    SEASON         VARCHAR(100) NOT NULL,<br/>    CITY           VARCHAR(100) NOT NULL,<br/>    SPORT          VARCHAR(100) NOT NULL,<br/>    EVENT          VARCHAR(100) NOT NULL,<br/>    MEDAL          VARCHAR(100) NOT NULL,<br/><strong class="mu iu">    DW_CREATE_DATE TIMESTAMPTZ           DEFAULT CURRENT_TIMESTAMP(),<br/>    DW_CREATE_USER VARCHAR      NOT NULL DEFAULT CURRENT_USER(),<br/>    DW_UPDATE_DATE TIMESTAMPTZ           DEFAULT CURRENT_TIMESTAMP(),<br/>    DW_UPDATE_USER VARCHAR      NOT NULL DEFAULT CURRENT_USER()</strong><br/>);</span></pre><h1 id="dc82" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建一个COPY语句来从S3加载数据</h1><p id="3204" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Snowflake中的COPY语句是从数据仓库导入和导出数据的强大方法。它将加载任何新的数据文件，并忽略以前加载的文件。利用拷贝是管理仓库的一种简单而有效的方法。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="f2d7" class="my lw it mu b gy mz na l nb nc">copy into STAGE.OLYMPICS_ATHELETE_EVENT (FILE_NAME,<br/>                                         FILE_ROW_NUMBER,<br/>                                         ID,<br/>                                         NAME,<br/>                                         SEX,<br/>                                         AGE,<br/>                                         HEIGHT,<br/>                                         WEIGHT,<br/>                                         TEAM,<br/>                                         NOC,<br/>                                         GAMES,<br/>                                         YEAR,<br/>                                         SEASON,<br/>                                         CITY,<br/>                                         SPORT,<br/>                                         EVENT,<br/>                                         MEDAL)<br/>    from (<br/>        select METADATA$FILENAME        file_name,<br/>               METADATA$FILE_ROW_NUMBER row_number,<br/>               t.$1,<br/>               t.$2,<br/>               t.$3,<br/>               t.$4,<br/>               t.$5,<br/>               t.$6,<br/>               t.$7,<br/>               t.$8,<br/>               t.$9,<br/>               t.$10,<br/>               t.$11,<br/>               t.$12,<br/>               t.$13,<br/>               t.$14,<br/>               t.$15<br/>        from @stage.OLYMPICS t<br/>    )<br/>    pattern = '.*athlete_events.csv.gz'<br/>    on_error = CONTINUE<br/>    force = false<br/>    file_format = (field_optionally_enclosed_by = '"'<br/>        type = 'csv'<br/>        compression = GZIP<br/>        field_delimiter = ','<br/>        skip_header = 1);</span></pre><h1 id="4c20" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">云的形成脚本</h1><p id="6ae0" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">自动气象站的基础是云的形成。基本云形成文件包含参数部分、角色部分和组件部分。上面的组件部分包含了本文前面的Secrets Manager片段。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="275b" class="my lw it mu b gy mz na l nb nc">AWSTemplateFormatVersion: "2010-09-09"<br/>Description: &gt;<br/>  This Template Configures a Job to Load Event Data into a Snowflake Table using Glue</span><span id="ea8d" class="my lw it mu b gy nd na l nb nc">Parameters:<br/>  JobName:<br/>    Type: String<br/>    Description: "The Glue Job name used for the Stack and tags in the Snowflake query"</span><span id="2f9a" class="my lw it mu b gy nd na l nb nc">  JobSql:<br/>    Type: String<br/>    Description: "A SQL COPY function to load the data into Snowflake."</span><span id="b534" class="my lw it mu b gy nd na l nb nc">  S3DataHome:<br/>    Type: String<br/>    MinLength: "1"<br/>    Description: "The S3 Bucket Containing the Data Lake Data"</span><span id="0eb2" class="my lw it mu b gy nd na l nb nc">  SecretName:<br/>    Type: String<br/>    Description: "The secret containing the Snowflake login information"</span><span id="5290" class="my lw it mu b gy nd na l nb nc">Resources:<br/>  SnowflakeGlueJobRole:<br/>    Type: "AWS::IAM::Role"<br/>    Properties:<br/>      AssumeRolePolicyDocument:<br/>        Version: '2012-10-17'<br/>        Statement:<br/>          - Effect: Allow<br/>            Principal:<br/>              Service:<br/>                - glue.amazonaws.com<br/>            Action:<br/>              - sts:AssumeRole<br/>      Policies:<br/>        - PolicyName: root<br/>          PolicyDocument:<br/>            Version: 2012-10-17<br/>            Statement:<br/>              - Effect: Allow<br/>                Action:<br/>                  - "s3:GetObject"<br/>                  - "s3:PutObject"<br/>                  - "s3:ListBucket"<br/>                  - "s3:DeleteObject"<br/>                Resource:<br/>                  - !Sub "arn:aws:s3:::${S3DataHome}"<br/>                  - !Sub "arn:aws:s3:::${S3DataHome}/*"</span><span id="2ee7" class="my lw it mu b gy nd na l nb nc">        - PolicyName: "AllowSecretsManager"<br/>          PolicyDocument:<br/>            Version: "2012-10-17"<br/>            Statement:<br/>              - Effect: "Allow"<br/>                Action: [<br/>                    "secretsmanager:GetSecretValue",<br/>                    "secretsmanager:DescribeSecret"<br/>                ]<br/>                Resource: [<br/>                    !Sub "arn:aws:secretsmanager:${AWS::Region}:${AWS::AccountId}:secret:${SecretName}*"<br/>                ]</span><span id="a8c6" class="my lw it mu b gy nd na l nb nc">      ManagedPolicyArns:<br/>        - arn:aws:iam::aws:policy/service-role/AWSGlueServiceRole<br/>      Path: "/"</span><span id="f984" class="my lw it mu b gy nd na l nb nc">  LoadOlympicData:<br/>    Type: AWS::Glue::Job<br/>    Properties:<br/>      Command:<br/>        Name: pythonshell<br/>        PythonVersion: 3<br/>        ScriptLocation: !Sub "s3://${S3DataHome}/src/etl-scripts/copy_to_snowflake.py"<br/>      GlueVersion: 1.0<br/>      DefaultArguments:<br/>        "--job-bookmark-option": "job-bookmark-enable"<br/>        "--job-language": "python"<br/>        "--extra-py-files": !Sub "s3://${S3DataHome}/lib/snowflake_connector_python-2.4.2-cp37-cp37m-manylinux2014_x86_64.whl"<br/>        "--RegionName": !Sub "${AWS::Region}"<br/>        "--SecretName": !Ref SecretName<br/>        "--JobName": !Ref JobName<br/>        "--JobBucket": !Ref S3DataHome<br/>        "--JobSql": !Ref JobSql<br/>      ExecutionProperty:<br/>        MaxConcurrentRuns: 2<br/>      MaxRetries: 0<br/>      Name: snowflake-load-olympic-data<br/>      Role: !Ref SnowflakeGlueJobRole</span></pre><h1 id="3f43" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">在Docker中创建雪花Python轮</h1><p id="1f6a" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">仔细记下带有雪花连接器库的行。由于雪花不是AWS的原生产品，您需要提供一个带有雪花Python库编译的二进制文件的Wheel文件。使用docker或带有AWS AMI的EC2实例来创建wheel文件。</p><p id="3cca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是docker文件。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="01ab" class="my lw it mu b gy mz na l nb nc">python3.7 -m venv wheel-env<br/>source wheel-env/bin/activate<br/>pip install --upgrade pip<br/>cat "snowflake-connector-python" &gt; requirements.txt<br/>for f in $(cat ../requirements.txt); do pip wheel $f -w ../wheelhouse; done<br/>cd wheelhouse/<br/>INDEXFILE="&lt;html&gt;&lt;head&gt;&lt;title&gt;Links&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Links&lt;/h1&gt;"<br/>for f in *.whl; do INDEXFILE+="&lt;a href='$f'&gt;$f&lt;/a&gt;&lt;br&gt;"; done<br/>INDEXFILE+="&lt;/body&gt;&lt;/html&gt;"<br/>echo "$INDEXFILE" &gt; index.html<br/>cd ..<br/>deactivate<br/>rm -rf cache wheel-env<br/>aws s3 sync wheelhouse s3://${S3DataHome}/lib/</span></pre><h1 id="654d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建Python脚本</h1><p id="0847" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">粘合作业需要一个Python脚本。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="fb09" class="my lw it mu b gy mz na l nb nc">ScriptLocation: !Sub "s3://${S3DataHome}/src/etl-scripts/copy_to_snowflake.py"</span></pre><p id="9ce5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该脚本相当通用，并且需要一个SQL文件来执行，以便于重用。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="ae70" class="my lw it mu b gy mz na l nb nc">import sys</span><span id="4079" class="my lw it mu b gy nd na l nb nc">import boto3<br/>import json</span><span id="49ae" class="my lw it mu b gy nd na l nb nc">from botocore.exceptions import ClientError<br/>from awsglue.utils import getResolvedOptions</span><span id="ffb4" class="my lw it mu b gy nd na l nb nc">import snowflake.connector<br/></span><span id="6ee2" class="my lw it mu b gy nd na l nb nc">def get_secret_json(session, secret_name, region_name):</span><span id="2887" class="my lw it mu b gy nd na l nb nc">    client = session.client(<br/>        service_name='secretsmanager',<br/>        region_name=region_name<br/>    )</span><span id="72dd" class="my lw it mu b gy nd na l nb nc">    secret = None<br/>    get_secret_value_response = None</span><span id="e235" class="my lw it mu b gy nd na l nb nc">    try:<br/>        get_secret_value_response = client.get_secret_value(<br/>            SecretId=secret_name<br/>        )<br/>    except ClientError as e:<br/>            raise e<br/>    else:<br/>        if 'SecretString' in get_secret_value_response:<br/>            secret = get_secret_value_response['SecretString']</span><span id="f26a" class="my lw it mu b gy nd na l nb nc">    return json.loads(secret)<br/></span><span id="ddba" class="my lw it mu b gy nd na l nb nc">def connect(user, password, account, database, warehouse, session_parameters=None):<br/>    <em class="ne">"""</em><br/><em class="ne">    Connect to Snowflake</em><br/><em class="ne">    """</em><br/><em class="ne">    </em>return snowflake.connector.connect(<br/>        user=user,<br/>        password=password,<br/>        account=account,<br/>        database=database,<br/>        warehouse=warehouse,<br/>        session_parameters=session_parameters<br/>    )<br/></span><span id="12d8" class="my lw it mu b gy nd na l nb nc">def read_sql(session, bucket, filename):<br/>    s3_client = session.client("s3")<br/>    s3_object = s3_client.get_object(Bucket=bucket, Key=filename)<br/>    return s3_object['Body'].read().decode("utf-8")<br/></span><span id="deec" class="my lw it mu b gy nd na l nb nc">def main():<br/>    # Create a Secrets Manager client<br/>    session = boto3.session.Session()</span><span id="77b0" class="my lw it mu b gy nd na l nb nc">    args = getResolvedOptions(sys.argv, ['JobName', 'RegionName', 'SecretName', 'JobBucket', 'JobSql'])</span><span id="f89c" class="my lw it mu b gy nd na l nb nc">    json_secret = get_secret_json(session, args["SecretName"], args["RegionName"])</span><span id="b5c0" class="my lw it mu b gy nd na l nb nc">    sql = read_sql(session=session, bucket=args["JobBucket"], filename=args["JobSql"])</span><span id="7187" class="my lw it mu b gy nd na l nb nc">    with connect(<br/>            user=json_secret['USERNAME'],<br/>            password=json_secret['PASSWORD'],<br/>            account=json_secret['ACCOUNT'],<br/>            database=json_secret['DB'],<br/>            warehouse=json_secret['WAREHOUSE'],<br/>            session_parameters={<br/>                'QUERY_TAG': args["JobName"]<br/>            }) as con:<br/>        cs = con.cursor()</span><span id="6f59" class="my lw it mu b gy nd na l nb nc">        result_cs = cs.execute(sql)</span><span id="4968" class="my lw it mu b gy nd na l nb nc">        result_row = result_cs.fetchone()</span><span id="b155" class="my lw it mu b gy nd na l nb nc">        print(result_row)<br/></span><span id="4f33" class="my lw it mu b gy nd na l nb nc">if __name__ == "__main__":<br/>    main()</span></pre><h1 id="5426" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用云形成脚本创建粘合作业</h1><p id="81bb" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">下面是Makefile表单，用于执行云形成脚本来创建粘合作业。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="46d3" class="my lw it mu b gy mz na l nb nc">package-job:<br/>   aws cloudformation package \<br/>      --template-file resources/glue/snowflake-glue-load-history.yaml \<br/>             --s3-bucket ${S3_DEPLOYMENT_BUCKET} \<br/>       --output-template-file build/snowflake-glue-load-history.yaml</span><span id="61fb" class="my lw it mu b gy nd na l nb nc">deploy-job: package-job<br/>   aws cloudformation deploy \<br/>      --template-file build/snowflake-glue-load-history.yaml \<br/>      --parameter-overrides S3DataHome=${S3_DATA_BUCKET} \<br/>         SecretName="${SECRET_NAME}" JobName=${LOAD_OLYMPICS_DATA_JOB} \<br/>         JobSql=${SQL_COPY_OLYMPIC_DATA} \<br/>       --stack-name ${LOAD_OLYMPICS_DATA_JOB} \<br/>       --capabilities CAPABILITY_IAM</span></pre><h1 id="08f4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">执行粘合作业(或对其进行调度)</h1><p id="44b7" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">您可以在AWS控制台中运行和执行Glue作业。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/6e8520808a3105a8874a38334b21e825.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZSA-ZWmQsNAIo4T1-czJsA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">胶水控制台(作者)</p></figure><p id="806b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">胶合过程的成本是每DPU小时0.44美元，每秒计费，最少1分钟，因此它在价格上非常有竞争力，即使是运行在EC2实例上的免费ETL工具。</p><h1 id="ad74" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">检查结果</h1><p id="b180" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">现在有趣的部分—运行查询来检查您的数据。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="d3fb" class="my lw it mu b gy mz na l nb nc">select TEAM,<br/>       sum(case when MEDAL='Gold' then 1 else 0 end) GOLD_MEDALS,<br/>sum(case when MEDAL='Silver' then 1 else 0 end) SILVER_MEDALS,<br/>sum(case when MEDAL='Bronze' then 1 else 0 end) BRONZE_MEDALS<br/>from stage.OLYMPICS_ATHELETE_EVENT<br/>where medal in ('Gold', 'Silver', 'Bronze')<br/> and sport = 'Fencing'<br/>    group by team<br/>order by sum(case when MEDAL='Gold' then 1 else 0 end) desc,<br/>         sum(case when MEDAL='Silver' then 1 else 0 end) desc,<br/>         sum(case when MEDAL='Bronze' then 1 else 0 end) desc;</span></pre><p id="9974" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么谁的剑术最好呢？当然是意大利。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/1bd883247905ddfbb0ae4d160d03f130.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WqaWKyPOOpEyeVwg80D5qA.png"/></div></div></figure><h1 id="934a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="269a" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">加载数据是一项棘手的技术工作，尤其是在桥接两个系统时，比如AWS和雪花。然而，结果——从数据中获得的洞察力将使它变得值得。从这篇文章中吸取这些教训:</p><ol class=""><li id="9eff" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated">将您的凭证保护到您的雪花数据库</li><li id="8257" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">借力<a class="ae ky" href="https://docs.snowflake.com/en/sql-reference/sql/create-stage.html" rel="noopener ugc nofollow" target="_blank">雪花舞台</a>与<a class="ae ky" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/Welcome.html" rel="noopener ugc nofollow" target="_blank"> AWS S3 </a>整合</li><li id="4842" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">使用<a class="ae ky" href="https://aws.amazon.com/blogs/aws/cloudformation-create-your-aws-stack-from-a-recipe/" rel="noopener ugc nofollow" target="_blank">云形成</a>来集成AWS服务</li><li id="86e8" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">扩展Glue Python作业以自动加载雪花中的数据</li><li id="c4a9" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">通过使用SQL查询提出有趣的问题，让数据自己说话</li></ol><p id="9147" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">快乐数据分析！</p></div></div>    
</body>
</html>