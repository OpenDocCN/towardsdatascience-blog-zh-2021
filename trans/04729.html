<html>
<head>
<title>Hands-on PostgreSQL: Basic Queries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">动手操作PostgreSQL:基本查询</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/hands-on-postgresql-basic-queries-a5f1249bba78?source=collection_archive---------17-----------------------#2021-04-24">https://towardsdatascience.com/hands-on-postgresql-basic-queries-a5f1249bba78?source=collection_archive---------17-----------------------#2021-04-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="84cb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">世界上最先进的开源关系数据库</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e506abc179a376aeac0463cc397178f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s5TvqTvlesWPq2Alt3Twaw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@bepnamanh?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">南安</a>在<a class="ae ky" href="https://unsplash.com/s/photos/elephant?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="5018" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL提供了许多函数和方法来管理以表格形式存储的数据。关系数据库管理系统(RDBMS)是一个使用SQL来管理存储在关系数据库中的数据的程序。</p><p id="9a63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关系数据库包含许多通过共享列相互关联的表。有许多不同的RDBMSs，如MySQL、PostgreSQL、SQL Server等等。</p><p id="0058" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我之前写了一篇<a class="ae ky" rel="noopener" target="_blank" href="/practical-introduction-to-postgresql-5f73d3d394e">文章</a>作为对<a class="ae ky" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>的介绍，解释了如何设置PostgreSQL数据库和创建表。在本文中，我们将讨论几个演示如何查询关系数据库的例子。</p><p id="f1a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一步是创建一个我们可以查询的表。一种选择是创建表，并使用insert语句手动填充它。更实用的方法是从csv文件中复制数据。</p><p id="da90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我有一个csv文件，其中包含了Kaggle上提供的墨尔本住房<a class="ae ky" href="https://www.kaggle.com/anthonypino/melbourne-housing-market" rel="noopener ugc nofollow" target="_blank">数据集</a>的一些列。我们需要在从文件上传数据之前创建表。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="b0eb" class="ma mb it lw b gy mc md l me mf">CREATE TABLE houses (                                                                      HouseId SERIAL,                                                                                     Type VARCHAR(20),                                                                                   Date date,                                                                                          Rooms INT,                                                                                          Distance real,                                                                                      Landsize real,                                                                                      Price real,                                                                                         PRIMARY KEY (HouseId)                                                                               );</span></pre><p id="a2af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">表格中的列必须与csv文件中的列兼容。第一个字表示列名，第二个字表示数据类型。</p><p id="6305" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以将csv文件中的数据复制到houses表中。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="cc6b" class="ma mb it lw b gy mc md l me mf">\COPY houses(HouseId, Type, Date, Rooms, Distance, Landsize, Price)                        FROM '/Users/sonery/Downloads/melb_sql/houses.csv'                                                  DELIMITER ','                                                                                       CSV HEADER;</span></pre><p id="6e59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一行包括表名和列名。然后，我们写入将用于复制数据的文件的路径。最后两行是关于csv文件的特征。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><p id="80fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以开始查询houses表。让我们首先检查表中有多少观察值(即行)。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="01c7" class="ma mb it lw b gy mc md l me mf">SELECT COUNT(1) FROM houses;</span><span id="be0f" class="ma mb it lw b gy mn md l me mf">count<br/>-------<br/>13580</span><span id="991e" class="ma mb it lw b gy mn md l me mf">(1 row)</span></pre><p id="4d9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用count函数来计算行数。因为每一列都包含相同数量的行，所以我们可以将任何一列传递给count函数。</p><p id="0511" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过显示前5行来看看这个表。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1ac0" class="ma mb it lw b gy mc md l me mf">SELECT * FROM houses LIMIT 5;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/a23f5817dd2477939f2e616198988330.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T3vB-yF8ucm4llthNtZvhg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="3f89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL也可以被认为是一种数据分析工具。它提供了多种过滤、分析和转换数据的功能和方法。</p><p id="e621" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，我们可以查看价格超过100万英镑的房屋数量。我们只需要使用where语句添加一个条件。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="300d" class="ma mb it lw b gy mc md l me mf">SELECT COUNT(1) FROM houses<br/>WHERE price &gt; 1000000;</span><span id="f61b" class="ma mb it lw b gy mn md l me mf">count<br/>-------<br/>5743</span><span id="095a" class="ma mb it lw b gy mn md l me mf">(1 row)</span></pre><p id="b28d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">where语句接受多个条件。我们来求h型，距离大于2的房子的最高价。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="3bdd" class="ma mb it lw b gy mc md l me mf">SELECT MAX(price) FROM houses                                                              WHERE distance &gt; 2 AND type = 'h';</span><span id="4e16" class="ma mb it lw b gy mn md l me mf">max<br/>-------<br/>9000000</span><span id="0cd7" class="ma mb it lw b gy mn md l me mf">(1 row)</span></pre><p id="c133" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在价格列上使用max函数。过滤条件与“and”关键字相结合。</p><p id="dd32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL函数提供了极大的灵活性和多功能性。考虑前面的例子。结果集中的聚合列显示了函数名，但实际上并没有告诉我们它代表什么。</p><p id="be82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“as”关键字可用于为聚合列分配别名。我们也可以用1000000除以百万来表示价格。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="9610" class="ma mb it lw b gy mc md l me mf">SELECT MAX(price / 1000000) AS price_million FROM houses                                   WHERE distance &gt; 2 AND type = 'h';</span><span id="21e0" class="ma mb it lw b gy mn md l me mf">price_million<br/>---------------<br/>9</span><span id="fe3e" class="ma mb it lw b gy mn md l me mf">(1 row)</span></pre><p id="8d31" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据分析中常用的函数是group by。它根据列中的不同值对行进行分组，然后允许对数值执行聚合。</p><p id="680e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，我们可以计算每种房屋类型的平均价格。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ca0a" class="ma mb it lw b gy mc md l me mf">SELECT type, AVG(price) AS avg_price FROM houses                                           GROUP BY type;</span><span id="901f" class="ma mb it lw b gy mn md l me mf">type |     avg_price<br/>-----+-------------------<br/>t    | 933735.0538599641<br/>h    | 1242664.761138745<br/>u    | 605127.4845873384</span><span id="5e77" class="ma mb it lw b gy mn md l me mf">(3 rows)</span></pre><p id="3851" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该查询的作用是选择type和price列，然后根据type列中的类别对行进行分组。avg函数计算每个类别的平均房价。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><p id="5b3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以使用order by语句对结果集中的值进行排序。我们来看看最近公布的5栋房子的身份证号码。为了使情况稍微复杂一点，我们还将在距离列上添加一个条件进行过滤。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="7fa2" class="ma mb it lw b gy mc md l me mf">SELECT houseid, date FROM houses<br/>WHERE distance BETWEEN 2 AND 3<br/>ORDER BY date desc<br/>LIMIT 5;</span><span id="3005" class="ma mb it lw b gy mn md l me mf">houseid |    date<br/>--------+------------<br/>  10879 | 2017-12-08<br/>  10880 | 2017-12-08<br/>  10877 | 2017-12-08<br/>  10878 | 2017-12-08<br/>  10973 | 2017-12-08</span><span id="600c" class="ma mb it lw b gy mn md l me mf">(5 rows)</span></pre><p id="6229" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先实现过滤条件，然后对结果进行排序。默认情况下，order by语句按升序对结果进行排序。我们可以用desc关键字改变它的行为。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h2 id="684d" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">结论</h2><p id="7ab3" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我们已经做了几个例子来演示如何编写基本查询来从表中检索数据。全面理解基本SQL语句至关重要。高级查询是在基本查询的基础上创建的。</p><p id="99ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我计划通过逐渐增加复杂性来写更多关于PostgreSQL的文章。敬请关注更多内容！</p><p id="a761" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>