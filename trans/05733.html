<html>
<head>
<title>The Matplotlib Line Plot that Crushes the Box Plot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">粉碎盒状图的Matplotlib线图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-matplotlib-line-plot-that-crushes-the-box-plot-912f8d2acd49?source=collection_archive---------15-----------------------#2021-05-22">https://towardsdatascience.com/the-matplotlib-line-plot-that-crushes-the-box-plot-912f8d2acd49?source=collection_archive---------15-----------------------#2021-05-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="22af" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">直观地显示统计数据、误差线或自定义函数</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6e841a0d4fe0f37975188b1985343bc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V_jIfYhfiW7AcPjx7ozOBQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="4902" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi lr translated"><span class="l ls lt lu bm lv lw lx ly lz di"> T </span>盒状图是一种快速便捷的方式来感受你的数据集——它可以给你一个范围、平均值、四分位数和异常值的快照。当然，它不像直方图或kde那样具有描述性，但是它对于观察我们的分布如何随着我们的变量而变化是很棒的。</p><p id="8c4a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">虽然数据科学家和大多数技术人员对盒状图很熟悉，但对于非工程或统计领域的人来说，它们可能很陌生。这就是问题所在:<strong class="kx ir"> <em class="ma">你需要一种方法来显示你的数据趋势及其分布是如何以一种任何人都能理解的格式变化的。</em>T9】</strong></p><p id="5c36" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我将一步一步地向您展示如何制作一个折线图，以传达您想要分享的来自箱线图的尽可能多或尽可能少的信息——均值、中位数、范围、四分位数、标准差误差线或任何自定义值。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h2 id="dcf3" class="mi mj iq bd mk ml mm dn mn mo mp dp mq le mr ms mt li mu mv mw lm mx my mz na bi translated">数据导入</h2><p id="d4b8" class="pw-post-body-paragraph kv kw iq kx b ky nb jr la lb nc ju ld le nd lg lh li ne lk ll lm nf lo lp lq ij bi translated">我们将从导入函数和从Kaggle获取印度房价数据集开始，ka ggle探索待售房屋的信息。我们将使用内置的熊猫功能<code class="fe nh ni nj nk b">read_csv()</code>加载它，或者从本地保存的副本，或者为了方便起见，从我的github ( <code class="fe nh ni nj nk b">'https://tinyurl.com/4yx6p8hs'</code>)的网络链接。</p><pre class="kg kh ki kj gt nl nk nm nn aw no bi"><span id="93d8" class="mi mj iq nk b gy np nq l nr ns">import numpy as np<br/>import pandas as pd<br/>import matplotlib.pyplot as plt<br/>from functools import reduce<br/>import matplotlib as mpl</span><span id="00fa" class="mi mj iq nk b gy nt nq l nr ns">### LOAD DATA ####<br/>df = pd.read_csv('data/Bangalore.csv')<br/>df.rename(columns={"No. of Bedrooms": "Rooms"}, inplace=True)<br/>df.head()</span></pre><p id="6ed8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">快速浏览一下数据(<code class="fe nh ni nj nk b">df.head()</code>)就能发现大量可供我们摆弄的变量。对于这个例子，我们只是要调查房价的分布与一个家庭的房间数量的关系。为了使我们的数据帧尽可能小(有助于计算速度和总体组织)，我们将首先创建一个仅包含这两列的子集数据帧:</p><pre class="kg kh ki kj gt nl nk nm nn aw no bi"><span id="2010" class="mi mj iq nk b gy np nq l nr ns">dfsub = df[['Rooms', 'Price']]</span></pre><h2 id="dfdd" class="mi mj iq bd mk ml mm dn mn mo mp dp mq le mr ms mt li mu mv mw lm mx my mz na bi translated">方框图</h2><p id="502d" class="pw-post-body-paragraph kv kw iq kx b ky nb jr la lb nc ju ld le nd lg lh li ne lk ll lm nf lo lp lq ij bi translated">首先，免责声明—如果您使用pandas box plot函数(而不是matplotlib函数)，非常非常容易做出box plot来评估房价与房间数量的关系。这里的区别是pandas版本提供了一个非常方便的<code class="fe nh ni nj nk b">by</code>参数来定义我们如何在x轴上分割数据。在matplotlib中，我们必须拆分和合并数据，创建一个新的数据框架，每个房间的数量都是数据框架中不同的列。以下是我们在熊猫身上的做法:</p><pre class="kg kh ki kj gt nl nk nm nn aw no bi"><span id="2d57" class="mi mj iq nk b gy np nq l nr ns">df.boxplot(column=['Price'], by=['Rooms'])<br/>plt.title("")<br/>plt.xlabel("Rooms")<br/>plt.ylabel("Price")<br/>plt.yscale("log")<br/>plt.show()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/cc035aecc2eb52ae6842f161f53f4def.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*LROlZSng8Jn0RgLQ2ofpgw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">一个标准的熊猫方块图</p></figure><p id="01af" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">同样，作为一名数据科学家，它是说明性的，并告诉我们许多关于我们的数据分布的信息——均值、四分位数、范围和异常值。这需要做一些工作，但我们需要以一种任何人都能理解的方式传达这一信息。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h2 id="8e95" class="mi mj iq bd mk ml mm dn mn mo mp dp mq le mr ms mt li mu mv mw lm mx my mz na bi translated">带分布的线形图</h2><p id="8425" class="pw-post-body-paragraph kv kw iq kx b ky nb jr la lb nc ju ld le nd lg lh li ne lk ll lm nf lo lp lq ij bi translated">这里的主要目标是将各种级别(均值、范围等)作为线条叠加在一个图上。我们将从提取每个“房间”值的这些值开始。这正是熊猫的拿手好戏。现在，我们将执行一次<code class="fe nh ni nj nk b">groupby()</code>，然后从那里调用这些方法，而不是多次调用这个<code class="fe nh ni nj nk b">groupby()</code>并使用像<code class="fe nh ni nj nk b">.mean() </code>或<code class="fe nh ni nj nk b">.quantile()</code>这样的内置方法询问不同的参数值——节省了一些繁重的计算，并节省了我们大约25%的计算时间。</p><p id="de41" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">另一个技巧是，当我们用任何方法调用<code class="fe nh ni nj nk b">groupby()</code>时，默认输出将是一个以‘Rooms’为索引的dataframe和一个名为‘Price’的列。您可以开始明白为什么这可能是一个问题——我们用<code class="fe nh ni nj nk b">.mean()</code>、<code class="fe nh ni nj nk b">.quantile()</code>或任何其他参数创建的每个新列都将被命名为‘Price’。呀！现在让我们用<code class="fe nh ni nj nk b">.rename()</code>函数来解决这个问题。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/96b44c434c723c60908f85bb6121de75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*WDk3pEObwmP1Yxyv4-WvIQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用Groupby()设置我们的指标</p></figure><p id="50db" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">很明显，我们可以继续下去，追求我们感兴趣的任何其他指标——标准差、四分位数范围、中位数，甚至是<a class="ae ng" href="https://sean-turner.medium.com/applying-custom-functions-to-groupby-objects-in-pandas-61af58955569" rel="noopener">自定义函数</a>。这就是这种方法的主要好处之一— <strong class="kx ir"> <em class="ma">可调性！</em>T15】</strong></p><p id="7d6d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们需要将这些新的微型数据框架合并在一起，这样我们就可以将所有数据保存在一起。这并不是100%必要的，但是强烈建议在数据组织中使用，以防我们以后需要使用这些数据。首先，我们将列出数据帧，然后用<code class="fe nh ni nj nk b">concat()</code>将它们连接起来。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/7d1b3cf9c1af31cd3732b943406b5526.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PM4ZAwktmR72IVtPiwWC1Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">合并微型数据框架</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/6eede771f40a61d993f32f4368440527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BjZzLBujcSyBJf_g922BKA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们的合并数据框架</p></figure><p id="508c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">太好了！“房间”是我们的索引，我们的每个数学函数为“房间”的每个值提供了一个值。这正是线图喜欢使用的数据类型。</p><h2 id="7252" class="mi mj iq bd mk ml mm dn mn mo mp dp mq le mr ms mt li mu mv mw lm mx my mz na bi translated">测绘</h2><p id="8203" class="pw-post-body-paragraph kv kw iq kx b ky nb jr la lb nc ju ld le nd lg lh li ne lk ll lm nf lo lp lq ij bi translated">这里的一般概念是将单个的数学值作为线相加，然后在上下界之间填充。对于此图，我将仅使用平均值、第25个百分点、第75个百分点、第5个百分点和第95个百分点，但是，我鼓励您尝试使用此方法，并使用最大值/最小值或您想要创建的任何其他指标自定义您的图。</p><p id="e2c9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">同样值得注意的是，为了代码和我们的绘图的可读性，我将为“x”和“y”变量赋值，并除以1，000，000以使我们的y轴可读性更好。</p><p id="e2a0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在制作图表时，我们首先为我们想要添加的每一行调用<code class="fe nh ni nj nk b">ax.plot()</code>。我在这里保持简单，只是自定义颜色和线条样式，但还有许多其他方式来自定义这些。另外，增加了一个<code class="fe nh ni nj nk b">label=</code>，它将直接馈入我们的<code class="fe nh ni nj nk b">legend()</code>。这是matplotlib胜过R的plot() 的一个地方——图例几乎是自动生成的。</p><p id="c7ae" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们使用<code class="fe nh ni nj nk b">ax.fill_between()</code>填充线组之间，以帮助眼睛看到定义范围的每组线。接下来，我们添加一个带有<code class="fe nh ni nj nk b">ax.grid()</code>的背景网格，alpha设置透明度，<code class="fe nh ni nj nk b">which='both'</code>给长轴和短轴都添加线条。我们还会给x轴和y轴起一个描述性的名字。</p><p id="f699" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，由于房屋价值的绝对范围，该图在对数标度中使用y轴时可读性更好，否则较小的值会因为标度太大而看不到。不幸的是，matplotlib默认将y轴值放在对数轴的科学符号中，这通常很难快速阅读(特别是对于我们的非技术读者)。为了克服这个问题，我们格式化数字并使用<code class="fe nh ni nj nk b">set_major_formatter()</code>方法，这样我们的y轴将显示为简单的数字。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/95f051a5725de473c7ed02a91e5f1470.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*cEwLYC6QEt0j7Bgfw0aZ_A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">构建我们的线图</p></figure><p id="aa1a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于那些还不熟悉面向对象版本的matplotlib的人来说，基于状态的绘图代码(使用<code class="fe nh ni nj nk b">plt.plot()</code>)在我的github <a class="ae ng" href="https://github.com/bamattis/Blog/tree/main/Matplotlib/Line%20plots%20as%20box%20plots" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/869248c6a8de6525ca0c46229ea3acc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*7cW3jox5amvQ03SSyzGtzA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">啊，好多了！</p></figure><p id="27c4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">其结果是一个更具视觉吸引力和普遍理解的基本箱线图。更好的是，它是完全可定制的——它可以显示我们想要的任何线条或范围，这允许我们调整它的使用来衡量我们的观众熟悉的指标。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h2 id="023b" class="mi mj iq bd mk ml mm dn mn mo mp dp mq le mr ms mt li mu mv mw lm mx my mz na bi translated">额外学分</h2><p id="ad19" class="pw-post-body-paragraph kv kw iq kx b ky nb jr la lb nc ju ld le nd lg lh li ne lk ll lm nf lo lp lq ij bi translated">知道四分位数和平均值是一回事，但知道这些值是否有分量总是很重要的——我们通常想知道这些计算中有多少数据点。显然，如果只有少数房屋售出，噪音可能会使我们的图表变得不那么有用。</p><p id="1946" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">看看我们的图，有点意外的是，一旦我们在一个房子里有6个房间，价格就开始下降……我们应该检查一下，以确保我们有足够的数据来知道这个趋势是否真实。之前我们用<code class="fe nh ni nj nk b">.count()</code>生成了一个<code class="fe nh ni nj nk b">groupby()</code>就是为了这种情况。虽然我们可以在数据框架上查看各自的列，但是直观地传递这些数据会有用得多。</p><p id="533f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了实现这一点，我们可以创建一个带有条形图的子图，显示每个“房间”计数的数据点数量，镜像与之前相同的x轴，以帮助眼睛进行关联。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/16161753a134818037c0f75c4c959da3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*a-A1pBVf4RI9PBh07d1ueA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建支线剧情</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/cf187085824319a6d4eeb6f1a60b1405.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/format:webp/1*7HWiOunmQuvAjYBnbTMAdg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们的箱线图带有数量细目表</p></figure><p id="2ac8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我在这里绘制了一个对数标度，以帮助我们了解“房间”=6和7组中只有两个住宅。与此同时，我们了解到，对于4个房间或更少的房子，我们受到100多个房屋列表的驱动，所以这些趋势和范围可能是可信的。</p><h2 id="4080" class="mi mj iq bd mk ml mm dn mn mo mp dp mq le mr ms mt li mu mv mw lm mx my mz na bi translated">结论</h2><p id="d9e3" class="pw-post-body-paragraph kv kw iq kx b ky nb jr la lb nc ju ld le nd lg lh li ne lk ll lm nf lo lp lq ij bi translated">你有它——心爱的箱线图可以被击败！我们使其更易于可视化，并且可以自定义数据。这里我们复制了通常在箱线图中看到的四分位数，但是我们也可以使用这种方法来绘制自定义函数的误差线或值。这需要更多的工作，但是最终的结果以一种非技术人员可以容易理解的方式传达了我们的结果。我已经把我所有的代码<a class="ae ng" href="https://github.com/bamattis/Blog/tree/main/Matplotlib/Line%20plots%20as%20box%20plots" rel="noopener ugc nofollow" target="_blank">贴在这里</a>，这样你就可以玩并定制你自己的方块剧情杀手。编码快乐！</p></div></div>    
</body>
</html>