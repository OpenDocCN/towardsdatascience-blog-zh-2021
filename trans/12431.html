<html>
<head>
<title>Unleash the Power of Scikit-learn’s Pipelines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">释放 Scikit-learn 管道的力量</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/unleash-the-power-of-scikit-learns-pipelines-b5f03f9196de?source=collection_archive---------7-----------------------#2021-12-19">https://towardsdatascience.com/unleash-the-power-of-scikit-learns-pipelines-b5f03f9196de?source=collection_archive---------7-----------------------#2021-12-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="352a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">scikit-learn 管道中级指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8b90c4bff358528ba913bb4bdb5a6eaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2x7jlYLcPJAEaE2g"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">克里斯托夫·迪翁在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="c089" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我的上一篇文章中，我写了一篇介绍 scikit-learn 管道的文章。如果您尚未阅读，可以通过下面的链接访问:</p><div class="ls lt gp gr lu lv"><a rel="noopener follow" target="_blank" href="/introduction-to-scikit-learns-pipelines-565cc549754a"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">Scikit-learn 管道介绍</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">使用 scikit-learn 构建端到端的机器学习管道</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">towardsdatascience.com</p></div></div><div class="me l"><div class="mf l mg mh mi me mj kp lv"/></div></div></a></div><p id="1725" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我想扩展以前的帖子，展示一些很酷的功能，以创建更强大的管道，在帖子的最后，我将向您展示如何微调这些管道，以提高准确性。</p><p id="1c3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们在上一篇文章中看到的，管道可能非常有用，但是我们在介绍中仅仅抓住了表面。</p><p id="032e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们想做一些考虑到特征类型的特征转换呢？</p><p id="7e08" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设我们有一个包含数字和分类特征的熊猫数据帧，我们希望以不同的方式处理这两种类型的特征。在这种情况下，我们可以使用 scikit-learn pipeline 中的 ColumnTransformer 组件。我们开始吧！</p><p id="80c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">出于教育目的，我们将使用 Kaggle 的成人人口普查收入数据集:</p><div class="ls lt gp gr lu lv"><a href="https://www.kaggle.com/uciml/adult-census-income" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">成人人口普查收入</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">根据人口普查数据预测收入是否超过 5 万美元/年</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">www.kaggle.com</p></div></div><div class="me l"><div class="mk l mg mh mi me mj kp lv"/></div></div></a></div><p id="3ede" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该数据集包含 6 个数字特征和 9 个分类特征，因此它似乎适合我们想要构建的管道。jupyter 笔记本将在我的 github 中提供，您可以通过以下链接下载:</p><div class="ls lt gp gr lu lv"><a href="https://github.com/unaiLopez/towards-data-science-posts-notebooks/blob/master/pipelines/Unleash%20the%20Power%20of%20Scikit-learn%27s%20Pipelines.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">走向-数据-科学-帖子-笔记本/释放 Scikit 的力量-学习的管道。ipynb at master…</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">通过在 GitHub 上创建一个帐户，为 unaiLopez/forward-data-science-posts-notebooks 的开发做出贡献。</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">github.com</p></div></div><div class="me l"><div class="ml l mg mh mi me mj kp lv"/></div></div></a></div><p id="91f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在实现管道之前，我们必须对数据集做一点转换，因为所有未知的值都保存为“？”而不是 NaN，收入(目标列)是一个字符串，我们想把它编码成实数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="a0d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦我们完成了这些转换，我们就可以开始实现我们的管道了。为此，我们将使用 scikit-learn 的 ColumnTransformer 组件，并以不同的方式选择和处理分类和数字特征:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="1039" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Make_column_selector 将帮助我们按类型选择列。在我们的例子中，这些类型对于数字特性是 int 和 float，对于分类特性是 object。如果我们仔细观察，ColumnTransformer 组件也使用了两个变量，称为 numerical _ pipe 和 categorical _ pipe。这些管道的定义如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="85e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦我们定义了 ColumnTransformer 的组件及其所有元素，我们将使用该组件来创建我们的主管道:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="a96e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样！我们的管道完工了！让我们用它来训练，并测量它的准确性:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="9007" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们使用 33%的数据作为测试集的准确率是 83.2%。那一点也不差！</p><p id="69e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如何才能提高这条流水线的精度？</p><p id="83c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了改善这个管道的结果，我们可以对每个组件执行微调技术。Scikit-learn 使使用 GridSearchCV 进行微调变得容易。该组件将进行广泛的微调，在我们定义的范围内尝试所有可能的超参数组合。这里我们必须小心，因为如果我们尝试太多的组合，与此过程相关的计算复杂性可能会呈指数级增长:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="e02e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们仔细观察代码，我们已经为管道定义了一些超参数，然后在定义了我们想要优化的指标之后，我们已经开始了拟合所有可能组合的过程。经过这一过程，我们将准确度提高了 0.9%，总准确度达到 84.1%。这听起来不多，但这是一个非常简单的优化，它可以进一步改善定义一个更大的超参数空间，尝试更强大的模型，进行一些贝叶斯或遗传优化，而不是网格搜索优化，等等。</p><h2 id="dd2b" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">结论</h2><p id="ece7" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">当我们一起使用管道和超参数微调时，它们工作得非常好。这篇文章展示了管道不可思议的潜力，以及它们如何在数据科学家的日常工作中非常有用。虽然这个管道比我第一篇文章中的管道更复杂，但是这些管道可以更复杂。例如，我们可以创建自定义转换，并在管道中使用它们。然而，这超出了这篇文章的范围，但是如果你想要一篇关于定制变形金刚的文章，请告诉我。</p><h2 id="db96" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">参考</h2><div class="ls lt gp gr lu lv"><a href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV.html" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">sklearn.model_selection。GridSearchCV</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">对估计量的特定参数值的穷举搜索。重要成员是适合的，预测。GridSearchCV…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">scikit-learn.org</p></div></div><div class="me l"><div class="nm l mg mh mi me mj kp lv"/></div></div></a></div><div class="ls lt gp gr lu lv"><a href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.make_scorer.html" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">sklearn.metrics.make_scorer</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">根据绩效指标或损失函数进行评分。这个工厂函数包装了评分函数，用于和…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">scikit-learn.org</p></div></div><div class="me l"><div class="nn l mg mh mi me mj kp lv"/></div></div></a></div><div class="ls lt gp gr lu lv"><a href="https://scikit-learn.org/stable/modules/generated/sklearn.compose.ColumnTransformer.html" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">sk learn . compose . column transformer</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">将转换器应用于数组或 pandas 数据框架的列。该估计器允许不同的列或列…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">scikit-learn.org</p></div></div><div class="me l"><div class="no l mg mh mi me mj kp lv"/></div></div></a></div><div class="ls lt gp gr lu lv"><a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">sklearn.pipeline.Pipeline</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">使用 sklearn.pipeline.Pipeline 的示例:特征聚集与单变量选择特征聚集与…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">scikit-learn.org</p></div></div><div class="me l"><div class="np l mg mh mi me mj kp lv"/></div></div></a></div></div></div>    
</body>
</html>