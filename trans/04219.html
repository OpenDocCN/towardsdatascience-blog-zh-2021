<html>
<head>
<title>SAP KPI: Scrap Costs (Quality)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SAP KPI:废料成本(质量管理系统)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/sap-kpi-scrap-costs-quality-7562b9ceea75?source=collection_archive---------32-----------------------#2021-04-09">https://towardsdatascience.com/sap-kpi-scrap-costs-quality-7562b9ceea75?source=collection_archive---------32-----------------------#2021-04-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c7e5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">连接哪些SAP表来分析报废成本</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/d80a616b07b38a1e011ec853caf632de.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/1*immZgz2CMZkURdDK4bJIMw.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">人无完人(Fondor，经马蒂亚斯·伯乐许可)</p></figure><p id="7778" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">动机:</strong></p><p id="684d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">即使是最好的制造工艺也会产生废料，至少时不时会有一点。使用将ERP中的数据存储在数据仓库中来分析这些报废成本，这难道不有趣吗？下面的SQL从SAP BI的角度向您展示了如何实现这一目标。请注意，由于所有SAP ERP都是公司独有的，因此对于此请求没有100%正确和完整的解决方案。但它肯定会指引你正确的方向。</p><p id="b998" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">解决方案:</strong></p><p id="fa34" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果您正在寻找废料成本，QMFE是感兴趣的中央SAP表。QMEL保存总体质量通知，而QMFE存储每个项目的误差。制裁可在QMSM中找到，根本原因可在QMUR中找到，活动可在QMMA中找到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lr"><img src="../Images/ec88713322d3649779eff81160f257dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YR3TmHFYCc_AoPQyziuN7A.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">质量相关交易为QM10、13和15(图片由作者提供)</p></figure><p id="71ed" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">首先，我们将加载表QMFE:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="dff0" class="mb mc it lx b gy md me l mf mg">select * into [etl].[qmfe] from [qmfe]</span></pre><p id="3635" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们将只考虑QMSM中那些没有被取消的数据行(kzloesc &lt;&gt; x)。使用窗口函数row_number和partition by，我们只将每个qmnm和fenum的第一个数据行选择到新表qmsm_decision中:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="8561" class="mb mc it lx b gy md me l mf mg">drop table [etl].[qmsm_decision] <br/>select * into [etl].[qmsm_decision] <br/>from<br/>(select a.*, <br/>Row_number() over (partition by qmnum, fenum order by manum desc) rn<br/>from [qmsm] as a<br/>Where mngrp =’WhatEverYourCompany' and kzloesc &lt;&gt;’X’<br/> )src<br/>Where rn =’1'<br/>Order by qmnum;</span></pre><p id="3cef" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们想为代码组任务(mngrp)和任务代码(mncod)丰富我们的etl.qmfe，这是我们从表QMSM中收到的:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="5102" class="mb mc it lx b gy md me l mf mg">Update [etl].[qmfe]<br/> set QmsmMngrp= qmsm.mngrp, QmsmMncod=qmsm.mncod<br/> FROM [etl].[qmfe] as qmfe<br/> left outer join [etl].[qmsm_decision] as qmsm<br/> on qmfe.QMNUM=qmsm.QMNUM and qmfe.FENUM=qmsm.FENUM</span></pre><p id="35db" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在有趣的部分来了:我们将更具体地更新那些QmsmMngrp当前为null并且QMSM中的fenum为零的数据行:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="f22e" class="mb mc it lx b gy md me l mf mg">Update [etl].[qmfe]<br/> set QmsmMngrp= qmsm.mngrp, QmsmMncod=qmsm.mncod<br/> FROM [etl].[qmfe] as qmfe<br/> left outer join [etl].[qmsm_decision] as qmsm<br/> on qmfe.QMNUM=qmsm.QMNUM <br/>where QmsmMngrp is null and qmsm.FENUM=0</span></pre><p id="fad1" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们从表QMEL中获得项目编号:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="0bf3" class="mb mc it lx b gy md me l mf mg">Update [etl].[qmfe]<br/>Set qmelMatnr=qmel.matnr<br/>From [etl].[qmfe] as qmfe<br/>inner join [QMEL] as qmel<br/>On qmfe.qmnum=qmel.qmnum</span></pre><p id="f2ae" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这也是我们从以下地址获取消息类型(qmart)和<br/>工作中心工厂(arbplwe)、简短文本(qmtxt)和通知完成日期(qmdab)的地方:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="28e8" class="mb mc it lx b gy md me l mf mg">Update [etl].[qmfe]<br/>Set QmelQmart =qmel.qmart, QmelQmtext= qmel.qmtxt, qmelqmdab=qmel.qmdab , qmelWerk=qmel.ARBPLWE<br/>From [etl].[qmfe] as qmfe<br/>inner join [QMEL] as qmel<br/>On qmfe.qmnum=qmel.qmnum</span></pre><p id="5bc9" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们进入狮穴，最终开始计算废料成本:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="3479" class="mb mc it lx b gy md me l mf mg">Update [etl].[qmfe]<br/>Set scrap=qmsm.mngrp<br/>From [etl].[qmfe] as qmfe<br/>inner join [QMSM] as qmsm<br/>On qmfe.qmnum=qmsm.qmnum<br/>Where qmsm.mngrp=’WhatEverYourCompany' and qmsm.mncod=’WhatEverYourCompany' and qmsm.kzloesc &lt;&gt;’x’</span></pre><p id="5114" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们来谈谈过度消费:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="9dec" class="mb mc it lx b gy md me l mf mg">Update [etl].[qmfe]<br/>Set OverConsumption=qmsm.mngrp<br/>From [etl].[qmfe] as qmfe<br/>inner join [QMSM] as qmsm<br/>On qmfe.qmnum=qmsm.qmnum <br/>Where qmsm.mngrp=’WhatEverYourCompany' and qmsm.mncod=’WhatEverYourCompany' and qmsm.kzloesc &lt;&gt;’x’</span></pre><p id="f191" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">不要再拐弯抹角了:我们因废品损失了多少？标准价格(stprs)来自MBEW表(材料估价)。乘以物料的缺陷数量，包括外部(fmgfrd)和内部(fmgeig ),并考虑价格单位(peinh ),得出报废成本:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="090b" class="mb mc it lx b gy md me l mf mg">Update [etl].[qmfe]<br/>Set ScrapCosts=(FMGFRD+FMGEIG)*(STPRS/nullif(Peinh,0))<br/>From [etl].[qmfe] as qmfe</span></pre><p id="619f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">真的有那么糟糕吗？像往常一样，这要看情况。您可能需要详细考虑特殊情况:例如，仅将特定的qmtext、mngrp和mncod组合视为真正的废料。但这确实取决于你的ERP设置。</p><p id="e668" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果只有一些状态与您废料分析相关:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="94f0" class="mb mc it lx b gy md me l mf mg">update [etl].[qmfe]<br/>set JestStatus = c.stat<br/>from [etl].[qmfe] a<br/>inner join [JEST] c<br/>on (‘WhateverYourCompany’+ a.QMNUM ) = c.objnr<br/>where c.inact &lt;&gt;’X’</span></pre><p id="4881" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">通常，需求会随着时间而变化。因此，将来您可能需要从您的分析中移除一些特定的植物、OTRGRP和OTEIL:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="b2be" class="mb mc it lx b gy md me l mf mg">delete from<br/>[etl].[qmfe]<br/>where qmelwerk=’WhatEverYourCompany' and otgrp= ‘WhatEverYourCompany’ and oteil=’WhatEverYourCompany' and jeststatus =’WhatEverYourCompany'</span></pre><p id="daaa" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">QPCT(代码文本)是另一个关于废料成本的有趣表格。例如，我们可以通过加入codegruppe和code来提取部门详细信息:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="6530" class="mb mc it lx b gy md me l mf mg">update [etl].[qmfe]<br/>set Department= [Kurztext]<br/>from [bi].[F_ScrapCosts]<br/>left outer join [qpct] <br/>on OTGRP=Codegruppe and OTEIL=Code<br/>where [catalog]=’WhatEverYourCompany’</span></pre><p id="db9d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">恭喜:</strong></p><p id="32b7" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们刚刚从ERP系统SAP中计算了废料成本。非常感谢阅读，希望这是支持！有任何问题，请告诉我。你可以通过<a class="ae ku" href="https://de.linkedin.com/in/jesko-rehberg-40653883" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或<a class="ae ku" href="https://twitter.com/DAR_Analytics" rel="noopener ugc nofollow" target="_blank"> Twitter </a>与我联系。</p><p id="f6c2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">最初发表在我的网站<a class="ae ku" href="http://dar-analytics.com/" rel="noopener ugc nofollow" target="_blank"> DAR-Analytics </a>。</p></div></div>    
</body>
</html>