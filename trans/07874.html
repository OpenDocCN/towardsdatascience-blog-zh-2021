<html>
<head>
<title>Demystifying boto3: How to Use Any AWS Service with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">揭开boto3的神秘面纱:如何在Python中使用任何AWS服务</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/demystifying-boto3-how-to-use-any-aws-service-with-python-b5c69593bcfa?source=collection_archive---------19-----------------------#2021-07-19">https://towardsdatascience.com/demystifying-boto3-how-to-use-any-aws-service-with-python-b5c69593bcfa?source=collection_archive---------19-----------------------#2021-07-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9576" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">深入探究boto3以及AWS如何构建它</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/117c7e8fa9d97d6c2f9edcff6e069e35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RuVImfDF2raMoTuau2aI6g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://www.pexels.com/photo/desk-industry-technology-computer-8566472/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae ky" href="https://www.pexels.com/@kindelmedia?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">金德媒体</a>的照片</p></figure><p id="be29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">AWS将boto3定义为一个Python软件开发工具包，用于创建、配置和管理AWS服务。在本文中，我们将了解boto3如何工作，以及它如何帮助我们与各种AWS服务进行交互。</p><p id="25a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">目录:</strong></p><p id="eea5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="#b00f" rel="noopener ugc nofollow"> 1。Boto3引擎盖下</a> <br/> <a class="ae ky" href="#f609" rel="noopener ugc nofollow"> 2。客户端与资源</a> <br/> ∘ <a class="ae ky" href="#7374" rel="noopener ugc nofollow">为什么资源通常比客户端容易使用</a> <br/> ∘ <a class="ae ky" href="#b2f3" rel="noopener ugc nofollow">为什么你仍然会在大部分工作中使用客户端</a> <br/> <a class="ae ky" href="#a7e6" rel="noopener ugc nofollow"> 3 .等待者</a> <br/> ∘ <a class="ae ky" href="#a7ba" rel="noopener ugc nofollow">等到特定的S3对象到达S3 </a> <br/> <a class="ae ky" href="#1448" rel="noopener ugc nofollow"> 4。收藏</a> <br/> <a class="ae ky" href="#4272" rel="noopener ugc nofollow"> 5。会话:如何将IAM凭证传递给你的boto3代码？</a> <br/> ∘ <a class="ae ky" href="#190b" rel="noopener ugc nofollow">如何更改默认的boto3会话？</a><br/>T33】结论</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b00f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">1.引擎盖下的Boto3</h1><p id="dfe4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><a class="ae ky" href="https://github.com/aws/aws-cli" rel="noopener ugc nofollow" target="_blank"> AWS CLI </a>和<a class="ae ky" href="https://github.com/boto/boto3" rel="noopener ugc nofollow" target="_blank"> boto3 </a>都建立在<a class="ae ky" href="https://github.com/boto/botocore" rel="noopener ugc nofollow" target="_blank"> botocore </a>之上——一个低级Python库，负责向AWS发送API请求和接收响应所需的一切。<strong class="lb iu">肉毒杆菌:</strong></p><ul class=""><li id="d580" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">处理<strong class="lb iu">会话</strong>，凭证和配置，</li><li id="df8c" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">为所有操作提供细粒度的<strong class="lb iu">访问</strong>。ListObjects，DeleteObject )在特定服务(<em class="nn"> ex)内。S3 </em>)，</li><li id="0ba4" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">负责<strong class="lb iu">将</strong>输入参数、<strong class="lb iu">签名请求</strong>，以及<strong class="lb iu">将</strong>响应数据反序列化到Python字典中，</li><li id="6cba" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">提供低级<strong class="lb iu">客户端</strong>和高级<strong class="lb iu">资源</strong>抽象，以与Python中的AWS服务进行交互。</li></ul><p id="b7fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以把botocore看作是一个包，它允许我们忘记底层的JSON规范，在与AWS APIs交互时使用Python (boto3)。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f609" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">2.客户端与资源</h1><p id="bbaa" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在大多数情况下，我们应该使用boto3而不是botocore。使用boto3，我们可以选择与较低级的<strong class="lb iu">客户端</strong>或者较高级的面向对象的<strong class="lb iu">资源</strong>抽象交互。下图显示了这些抽象之间的关系。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/384cf6f156109aac9c90b26b84310e83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ItsL7ZglQiAy_Xt-MSqVA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">boto3、aws-cli和botocore中的抽象级别，以S3为例—图片由作者提供</p></figure><p id="e866" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了理解这些组件之间的区别，让我们看一个简单的例子，它将展示S3 <strong class="lb iu">客户端</strong>和S3 <strong class="lb iu">资源</strong>之间的区别。我们想要列出来自<code class="fe np nq nr ns b">images</code>目录的所有对象，即所有带有前缀<code class="fe np nq nr ns b">images/</code>的对象。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/af2a9c30650b8e21d89d694cc6d086e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3_TEHdZD_EJ7UsJq6Q3DDg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Boto3:客户端vs资源——作者图片</p></figure><p id="5522" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过这个简单的例子，您可能已经发现了不同之处:</p><ul class=""><li id="7f48" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">使用<strong class="lb iu">客户端</strong>，您可以从反序列化的API响应中直接与<strong class="lb iu">响应字典</strong>进行交互，</li><li id="a663" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">相比之下，使用<strong class="lb iu">资源</strong>，你可以与标准的<strong class="lb iu"> Python类</strong>和对象交互，而不是原始的响应字典。</li></ul><p id="9ec3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用<code class="fe np nq nr ns b">help()</code>和<code class="fe np nq nr ns b">dir()</code>来调查<strong class="lb iu">资源</strong>对象的功能:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/e33dbf4e1cfd1d7926277da6579bc8d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9-cNJBiM9847ZVvhRQHKFQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Boto3:探索资源对象—作者图片</p></figure><p id="be6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总的来说，<strong class="lb iu">资源</strong>抽象产生了可读性更好的代码(<em class="nn">与Python对象交互，而不是解析响应字典</em>)。它还处理许多底层细节，如分页。资源方法通常会返回一个生成器，这样你就可以轻松地遍历大量返回的对象，而不用担心分页或者内存不足。</p><blockquote class="nv nw nx"><p id="19a9" class="kz la nn lb b lc ld ju le lf lg jx lh ny lj lk ll nz ln lo lp oa lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">有趣的花絮:</em> </strong> <em class="it">无论是客户端还是资源代码，都是基于描述各种AWS APIs的JSON模型动态生成的。对于客户端，AWS使用</em> <strong class="lb iu"> <em class="it"> JSON服务描述</em> </strong> <em class="it">，对于资源a </em> <strong class="lb iu"> <em class="it">资源描述</em> </strong> <em class="it">，</em> <strong class="lb iu"> <em class="it"> </em> </strong> <em class="it">作为自动生成代码的基础。这有助于更快的更新，并为您与AWS交互的所有方式提供一致的界面(</em> CLI、boto3、管理控制台<em class="it">)。JSON服务描述和最终的boto3代码之间唯一真正的区别是，</em> <code class="fe np nq nr ns b"><em class="it">PascalCase</em></code> <em class="it">操作被转换为更Pythonic化的</em> <code class="fe np nq nr ns b"><em class="it">snake_case</em></code> <em class="it">符号。</em></p></blockquote></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="7374" class="ob md it bd me oc od dn mi oe of dp mm li og oh mo lm oi oj mq lq ok ol ms om bi translated">为什么资源通常比客户端更容易使用</h2><p id="1a1d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">假设您需要列出S3存储桶中的数千个对象。我们可以尝试在初始代码示例中使用的相同方法。唯一的问题是<code class="fe np nq nr ns b">s3_client.list_objects_v2()</code>方法只允许我们列出一个<a class="ae ky" href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/s3.html?highlight=list_objects_v2#S3.Client.list_objects_v2" rel="noopener ugc nofollow" target="_blank">最多一千个对象</a>。为了解决这个问题，我们可以利用<strong class="lb iu">分页</strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/d28a87c236c3722b52e7417310981eb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ctZMkruSgjGTqECBwMOtIg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">boto 3:S3客户端分页——图片由作者提供</p></figure><p id="d9b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然分页器代码非常简单，但是<strong class="lb iu">资源</strong>抽象只用两行代码就完成了工作:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/2a028fe8a2121894ce1e68f8916419a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pqoD_vpoYlyXIK-wVRF8HQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Boto3: S3资源—作者图片</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="b2f3" class="ob md it bd me oc od dn mi oe of dp mm li og oh mo lm oi oj mq lq ok ol ms om bi translated">为什么您仍然会在大部分工作中使用客户端</h2><p id="4842" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">尽管有资源抽象的好处，<strong class="lb iu">客户机</strong>提供了更多的功能，因为它们与AWS服务API几乎是1:1的映射。因此，根据特定的用例，您很可能最终会同时使用<strong class="lb iu">客户端</strong>和<strong class="lb iu">资源</strong>。</p><p id="71e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了功能上的不同，<strong class="lb iu">资源</strong>不是<strong class="lb iu">线程安全的</strong>，所以如果你计划使用多线程或多重处理来加速AWS操作，比如文件上传，你应该使用客户端而不是资源。更多关于那个<a class="ae ky" href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/resources.html#multithreading-or-multiprocessing-with-resources" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><blockquote class="nv nw nx"><p id="826e" class="kz la nn lb b lc ld ju le lf lg jx lh ny lj lk ll nz ln lo lp oa lr ls lt lu im bi translated"><strong class="lb iu">注意:</strong>有一种方法可以直接从资源对象访问客户端方法:<code class="fe np nq nr ns b">s3_resource.meta.client.some_client_method()</code>。</p></blockquote></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a7e6" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">3.服务员</h1><p id="c7c4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">等待者正在轮询特定资源的状态，直到它达到您感兴趣的状态。例如，当您使用boto3创建EC2实例时，您可能希望等到它达到“运行”状态，直到您可以对这个EC2实例做一些事情。以下是展示这个特定示例的示例代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/353a9fc09dfe7b6d88d9567c32762870.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B8Z0jjV0h3XM3axZAhonDQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Boto3:使用waiter轮询新EC2实例的运行状态——图片由作者提供</p></figure><p id="e13c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，上例中的<code class="fe np nq nr ns b">ImageId</code>对于每个AWS区域是不同的。您可以按照AWS控制台中的“启动实例”向导找到AMI的ID:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/9a1c1423231233b82e468f295d6ea807.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4rBTdlg6i_DvLSrfEbIV7A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">寻找阿美族——作者图片</p></figure><h2 id="a7ba" class="ob md it bd me oc od dn mi oe of dp mm li og oh mo lm oi oj mq lq ok ol ms om bi translated">等到一个特定的S3对象到达S3</h2><p id="49d6" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">实话实说吧。您多长时间发布一次新实例？可能不经常。所以让我们建立一个更真实的服务员例子。</p><p id="5f4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您的ETL过程一直在等待，直到一个特定的文件到达S3桶。在下面的例子中，我们一直等到市场部的人上传一个包含当前活动成本的文件。虽然您可以使用带有S3事件触发器的AWS Lambda实现相同的功能，但是下面的逻辑并不依赖于Lambda，可以在任何地方运行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/3f46da0b55f9e68a827c7e174c0e323c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jTDZxwW0DPnG0qkiE4IPog.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用S3资源中的服务员—图片由作者提供</p></figure><p id="94ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者同样使用更可配置的<strong class="lb iu">客户端</strong>方法:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/a0ca2c9ac0a95898f22a07fb49ca55f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dkeBmz3ADRepc-GX2zDKoQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在S3客户端使用服务员—作者图片</p></figure><p id="c8b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从上面的代码片段可以看出，使用客户端的服务员抽象，我们可以指定:</p><ul class=""><li id="ae56" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated"><strong class="lb iu"> MaxAttempts </strong>:我们应该检查多少次特定对象是否到达——这将防止僵尸进程，如果对象在预期时间内没有到达，将会失败，</li><li id="786c" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><strong class="lb iu">延迟</strong>:每次尝试之间等待的秒数。</li></ul><p id="9eae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">文件一到达S3，进程就停止等待，这允许您对新到达的数据做一些事情。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1448" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">4.收集</h1><p id="8280" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">集合表示一组资源，如桶中的一组S3对象或一组SQS队列。它们允许我们在单个API调用中对一组AWS资源执行各种操作。<strong class="lb iu">收藏可用于:</strong></p><ul class=""><li id="3647" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">获取带有特定对象前缀的<strong class="lb iu">所有S3 </strong> <strong class="lb iu">对象</strong>:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/a2087aaa2b7e5b5ab4ad6cdacb3bd830.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tLmB3qTwS5tTyVRPJoATJg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Boto3系列—作者图片</p></figure><ul class=""><li id="0070" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">获取具有特定内容类型的所有S3对象，例如，<strong class="lb iu">查找所有CSV文件</strong>:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/471308fa771e80420d058c582c6f6013.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*veTcplZTQdQrkZXLHwlyVQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Boto3系列—作者图片</p></figure><ul class=""><li id="7a9d" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">获取所有S3 <strong class="lb iu">对象版本</strong>:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/3ca6dd700c6e8a45fdd5af1262cb5362.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1iZjFOrhA1PaiL1ZEGaInw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Boto3系列—作者图片</p></figure><ul class=""><li id="12f5" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">指定要迭代的对象的<strong class="lb iu">块大小</strong>，例如，当1000个对象的默认页面大小对于您的应用程序来说太大时:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/c1b3ad3189488c22a992e35245f0fa34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8aSPBk1CXLnL8gcX_QvGeQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Boto3系列—作者图片</p></figure><ul class=""><li id="d505" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">在一个API调用中删除所有对象(<em class="nn">小心点！):</em></li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/357bd0bcc7c1b1d006dee1dc217b1523.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kyH_YvBwDK8t2GeuRjC1ZQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Boto3集合:删除所有对象—作者图片</p></figure><p id="a134" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更常见的操作是删除带有特定前缀的所有对象:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/1fd02da36387345ee8e760178d3157f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B6w9Lw59Q6hfIw1iXUVVWw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Boto3集合:删除带有特定前缀的所有对象—图片由作者提供</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4272" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">5.会话:如何将IAM凭证传递给你的boto3代码？</h1><p id="3310" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在与boto3交互时，有许多方法可以传递访问键。以下是boto3尝试查找凭据的位置顺序:</p><p id="90a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">#1显式传递给<code class="fe np nq nr ns b">boto3.client()</code>、<code class="fe np nq nr ns b">boto3.resource()</code>或<code class="fe np nq nr ns b">boto3.Session()</code>:</p><div class="kj kk kl km gt ab cb"><figure class="oz kn pa pb pc pd pe paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/afd2d1f5a08d000c9b7ead28b46d7684.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*CXxe9W2FMNxO9LSc8nCWKQ.png"/></div></figure><figure class="oz kn pf pb pc pd pe paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/a81d6941db3f7adfa68c2ccdf63a4841.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*2bAy-doZMt3mGJ7kocWaSg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk pg di ph pi translated">Boto3:访问键—作者图片</p></figure></div><p id="cf15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">#2设置为环境变量:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/4f5afd0a983d485eff2ac3627ae232a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3oI3DUoSrIWcMweZLcmeGA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将访问键作为环境变量—图片由作者提供</p></figure><p id="e0d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">#3在<code class="fe np nq nr ns b">~/.aws/credentials</code>文件中设置为凭证(<em class="nn">该文件由AWS CLI </em>中的 <code class="fe np nq nr ns b"><em class="nn">aws configure</em></code> <em class="nn">自动生成):</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/3024a19649a9d747ed5968261d119121.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8F3ue7ZXWBSsAGvBGvS0wA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">AWS凭据—图片由作者提供</p></figure><p id="079b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">#4如果您将具有适当权限的<strong class="lb iu"> IAM角色</strong>附加到您的AWS资源，您根本不需要传递凭证，而是分配一个具有所需权限范围的策略。这是它在AWS Lambda中的样子:</p><div class="kj kk kl km gt ab cb"><figure class="oz kn pk pb pc pd pe paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/57fef5e690883c3b66805368485a06e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*HkNj6c1strPIxDV98sCfmg.png"/></div></figure><figure class="oz kn pl pb pc pd pe paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/8bbc02de94fffe57ff0a340997716923.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*qU_Pt2oqwrUjvB-ilNH7ww.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk pm di pn pi translated">我在AWS Lambda中的角色—图片由作者提供</p></figure></div><p id="807c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着通过将<strong class="lb iu"> IAM roles </strong>附加到Lambda函数等资源上，您不需要手动传递或配置任何长期访问键。相反，IAM角色动态地生成临时访问密钥<strong class="lb iu"/>，使得这个过程更加安全。</p><p id="189f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想利用<strong class="lb iu"> AWS Lambda </strong>与<strong class="lb iu"> Python </strong>和<strong class="lb iu"> boto3 </strong>的特定用例，请看下面的链接:</p><ul class=""><li id="ce7e" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">如何构建<a class="ae ky" rel="noopener" target="_blank" href="/7-reasons-why-you-should-consider-a-data-lake-and-event-driven-etl-7616b74fe484">事件驱动的ETL </a>和<a class="ae ky" href="https://betterprogramming.pub/put-a-stop-to-data-swamps-with-event-driven-data-testing-203d9c1be073" rel="noopener ugc nofollow" target="_blank">事件驱动的数据测试</a>，</li><li id="54b4" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">如何使用Amazon Rekognition 从图像中提取文本，</li><li id="55e9" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">如何<a class="ae ky" href="https://betterprogramming.pub/aws-kinesis-vs-sns-vs-sqs-a-comparison-with-python-examples-6fc688bfd244" rel="noopener ugc nofollow" target="_blank">使用社交网络、SQS和Kinesis </a>构建解耦服务，</li><li id="9aa2" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">如何<a class="ae ky" href="https://levelup.gitconnected.com/are-nosql-databases-relevant-for-data-engineering-e631abe473f5" rel="noopener ugc nofollow" target="_blank">使用NoSQL DynamoDB读写数据</a>，</li><li id="5105" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">如何使用机密管理器管理凭证<a class="ae ky" rel="noopener" target="_blank" href="/how-i-manage-credentials-in-python-using-aws-secrets-manager-1bd1bf5da598">，</a></li><li id="bd8f" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">如何<a class="ae ky" rel="noopener" target="_blank" href="/how-i-improved-performance-retrieving-big-data-with-s3-select-2bd2850bc428">使用S3选择来提高从S3检索数据的性能</a>。</li></ul><p id="a54c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">AWS Lambda的一个有用特性是boto3已经预装在所有Python运行时环境中。这样，您可以直接在Lambda函数中运行本文中的任何示例。只需确保添加与您想要在Lambda的IAM角色中使用的服务相对应的适当策略(例如，<em class="nn">，S3只读策略</em>):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi po"><img src="../Images/618fb614d02f612e967d69d5ccda7c47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zM9-5HSD38jfNA0tZpoEGg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在AWS Lambda中创建函数-作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/0b795d91e611173b3f5abfb6f7397d7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HQX0mcj0JhHLFE5ZPIhcxA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">测试来自AWS Lambda的boto3图片由作者提供</p></figure><p id="94c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你计划在生产中运行一些Lambda函数，你可以探索一下<a class="ae ky" href="https://dashbird.io/" rel="noopener ugc nofollow" target="_blank">dash bird</a>——一个可观察性平台，它将帮助你<a class="ae ky" href="https://dashbird.io/serverless-observability/" rel="noopener ugc nofollow" target="_blank">监控和调试你的无服务器工作负载</a>。它对于构建<a class="ae ky" href="https://dashbird.io/failure-detection/" rel="noopener ugc nofollow" target="_blank">故障自动警报</a>、<a class="ae ky" href="https://dashbird.io/blog/group-aws-lambda-functions-dashbird-project/" rel="noopener ugc nofollow" target="_blank">基于项目或域对相关资源</a>进行分组、提供所有无服务器资源的概览、交互式浏览日志以及可视化操作瓶颈尤其有价值。多亏了CloudFormation模板，整个设置只需要2分钟。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pq"><img src="../Images/dc472246e115c03f652b6f1c621ca270.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0_uROQ2_Ip_QEC5g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Dashbird提供的所有无服务器资源概述—图片由<a class="ae ky" href="https://dashbird.io/" rel="noopener ugc nofollow" target="_blank"> Dashbird.io </a>提供</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="190b" class="ob md it bd me oc od dn mi oe of dp mm li og oh mo lm oi oj mq lq ok ol ms om bi translated">如何更改默认的boto3会话？</h2><p id="a4b3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Boto3使更改默认会话变得很容易。例如，如果您有几个概要文件(<em class="nn">，比如一个用于</em> <code class="fe np nq nr ns b"><em class="nn">dev</em></code> <em class="nn">，一个用于</em> <code class="fe np nq nr ns b"><em class="nn">prod</em></code> <em class="nn"> AWS环境</em>，您可以使用一行代码在它们之间切换:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pr"><img src="../Images/46ef4520cf860e63f9a95daad3e20a93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xXhzvl7zvAVkF0Yt5B2Dtw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Boto3: session —作者图片</p></figure><p id="2f7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，您可以将凭据直接附加到默认会话，这样您就不必为每个新客户端或资源单独定义凭据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ps"><img src="../Images/b4ece5292e155e60c9207a941e2291ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6wWls7v0LkcnFKZvFaXVQQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Boto3: session —作者图片</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e06d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="d1a4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在本文中，我们研究了如何使用boto3以及它是如何在内部构建的。我们研究了<strong class="lb iu">客户端</strong>和<strong class="lb iu">资源</strong>之间的差异，并调查了它们各自如何处理<strong class="lb iu">分页</strong>。我们探索了<strong class="lb iu">等待者</strong>如何在继续我们代码的其他部分之前帮助我们轮询AWS资源的特定状态。我们还研究了<strong class="lb iu">集合</strong>如何允许我们在多个AWS对象上执行操作。最后，我们探索了向boto3提供凭证的不同方法，以及如何使用IAM角色和IAM用户访问键来处理这些凭证。</p><p id="dfa6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">感谢您的阅读！</strong></p><p id="e287" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">参考文献:</strong></p><p id="60d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[1]<a class="ae ky" href="https://www.youtube.com/watch?v=Cb2czfCV4Dg" rel="noopener ugc nofollow" target="_blank">AWS re:Invent 2014 |(dev 307)针对Python (Boto)的AWS SDK第3版简介</a></p><p id="7c40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[2] <a class="ae ky" href="https://boto3.amazonaws.com/v1/documentation/api/latest/index.html" rel="noopener ugc nofollow" target="_blank"> Boto3文档</a></p></div></div>    
</body>
</html>