<html>
<head>
<title>Predicting matches for the UEFA Euro 2020 Championship</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测2020年欧锦赛的比赛</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-matches-for-the-uefa-euro-2020-championship-7dcfa449c8ee?source=collection_archive---------17-----------------------#2021-06-22">https://towardsdatascience.com/predicting-matches-for-the-uefa-euro-2020-championship-7dcfa449c8ee?source=collection_archive---------17-----------------------#2021-06-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6867" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">预测足球比赛结果的简单泊松回归方法，准确率为70%。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6bd25ea6d20a3eba61054822cc926120.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*o7gMm2lEQKp7huY8"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">威利安·贾斯登·德·瓦斯康塞洛斯在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="c0f6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">期待什么？</h1><ul class=""><li id="7c18" class="lr ls it lt b lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">在本文中，我将带您了解如何使用两个泊松回归来预测足球比赛的比分，只有一个预测变量，准确率超过70%。如果我们记住我们使用的是一个非常简单的模型，并且只有<strong class="lt iu">一个</strong>预测变量(国际足联球队排名)，这是相当令人印象深刻的。</li><li id="7444" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">泊松回归将以基本线性回归和随机森林回归为基准。</li><li id="2fec" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">您将了解为什么泊松回归是完成这项任务的好工具。</li><li id="e65e" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">我们将研究如何通过专门的后处理步骤来提高预测结果的准确性/ f1分数。</li></ul><h1 id="78d9" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">数据</h1><p id="915b" class="pw-post-body-paragraph mo mp it lt b lu lv ju mq lw lx jx mr ly ms mt mu ma mv mw mx mc my mz na me im bi translated">该方法使用两个数据集，这两个数据集都可以在Kaggle上找到:</p><ul class=""><li id="ffe7" class="lr ls it lt b lu nb lw nc ly nd ma ne mc nf me mf mg mh mi bi translated">【2020年欧锦赛参赛球队的历史比赛:<a class="ae ky" href="https://www.kaggle.com/martj42/international-football-results-from-1872-to-2017" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/martj 42/international-football-results-from-1872-to-2017</a></li><li id="6076" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><strong class="lt iu">国际足联排名各队得分:<em class="ng">“</em></strong><em class="ng">足球的世界管理机构国际足联的男子成员国球队根据他们的比赛成绩进行排名，最成功的球队排名最高。”</em>(维基百科)<strong class="lt iu"/><a class="ae ky" href="https://www.kaggle.com/cashncarry/fifaworldranking?select=fifa_ranking-2021-05-27.csv" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/cashncarry/fifaworldranking?select = FIFA _ ranking-2021-05-27 . CSV</a></li></ul><h2 id="f1a5" class="nh la it bd lb ni nj dn lf nk nl dp lj ly nm nn ll ma no np ln mc nq nr lp ns bi translated"><strong class="ak">训练测试数据分割和特征工程</strong></h2><p id="4568" class="pw-post-body-paragraph mo mp it lt b lu lv ju mq lw lx jx mr ly ms mt mu ma mv mw mx mc my mz na me im bi translated">为了创建我们的<strong class="lt iu">训练数据</strong>，我只考虑了2019年之后的比赛(因为旧的比赛可能不再代表当前球队的表现)，并随后将比赛结果与每个球队的国际足联排名结合起来。</p><p id="f592" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">最后但并非最不重要的是，我创建了一个新变量<strong class="lt iu">“ranking _ diff”</strong>，这是主客场球队之间的FIFA排名<strong class="lt iu">的差异</strong>。这个变量将是我们以后模型的唯一预测变量。</p><p id="9805" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">我的<strong class="lt iu">测试数据</strong>包括到目前为止2020年欧锦赛小组赛的所有比赛。</p><blockquote class="nw nx ny"><p id="0f71" class="mo mp ng lt b lu nb ju mq lw nc jx mr nz nt mt mu oa nu mw mx ob nv mz na me im bi translated">请注意:为了让这篇文章更具可读性，我跳过了大部分代码。但是，如果你对端到端的管道感兴趣，请访问我的<a class="ae ky" href="https://github.com/sikli/simple_poissoin_soccer" rel="noopener ugc nofollow" target="_blank"> GitHub </a>。</p></blockquote><p id="931c" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">这是经过短暂预处理后的训练数据的样子(注意加入的FIFA得分排名列和新创建的ranking_diff列):</p><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="ffbd" class="nh la it od b gy oh oi l oj ok">date home_team away_team home_score away_score tournament home_team_ranking away_team_ranking ranking_diff<br/><br/>2019–01–08 Finland Sweden 1 0 Friendly 1410 1569 -159<br/>2019–01–11 Estonia Finland 2 1 Friendly 1161 1410 -249<br/>2019–01–11 Iceland Sweden 2 2 Friendly 1415 1569 -154<br/>2019–03–20 Germany Serbia 1 1 Friendly 1609 1512 97<br/>2019–03–20 Wales Trinidad and Tobago 1 0 Friendly 1570 1201 369<br/>2019–03–21 Kosovo Denmark 2 2 Friendly 1151 1631 -480<br/>...</span></pre><h1 id="84f7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">探索性数据分析</h1><p id="70d0" class="pw-post-body-paragraph mo mp it lt b lu lv ju mq lw lx jx mr ly ms mt mu ma mv mw mx mc my mz na me im bi translated">让我们研究一下Kaggle的数据，看看进球的情况:</p><div class="kj kk kl km gt ab cb"><figure class="ol kn om on oo op oq paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/7c00cb295cdecb4f594745bab3f6fced.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*ku0zhhaVrVj0tmXutZthdw.png"/></div></figure><figure class="ol kn om on oo op oq paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/a2a9927aa93b57b3eb6fb43caecc512d.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*SWO55m6ggxz7t8Gs_ueXDw.png"/></div></figure><figure class="ol kn om on oo op oq paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/a7b953bd8000debe9376946ff403ceb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*bHnowAkivApFm_whG-XfGg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk or di os ot translated"><strong class="bd ou">图1: </strong>主客场球队进球(左)和(中)的探索性数据分析，以及参赛球队FIFA排名差异与主队进球(右)的关系。—作者图片</p></figure></div><p id="a3cc" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">上面图1中的图表提供了一些对数据的洞察:</p><ul class=""><li id="2eab" class="lr ls it lt b lu nb lw nc ly nd ma ne mc nf me mf mg mh mi bi translated">在左边，我们可以看到一个图表，显示了一个主队每场比赛的进球数。每场比赛的平均值是<strong class="lt iu"> 1.8个进球</strong>(红线)，主队进球最多的是9个！</li><li id="aad3" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">在中间，我们可以看到同样的客队形象化。我们可以看到客场球队的平均进球数更低，每场比赛只有<strong class="lt iu"> 1.2球</strong>。每场比赛的最大进球数是7个(与主队的9个进球相比，这一数字再次下降)。<strong class="lt iu">因此，我们可以清楚地看到，一支球队是在主场还是在客场比赛，进球数量会有相当大的差异。</strong></li><li id="2198" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">在右侧，我们可以看到主队进球(y轴)与竞争球队在国际足联排名中的差异(x轴)之间的关系。在图的左下方，我们可以看到，如果国际足联排名差异非常大(主队的国际足联排名比客队低得多)，主队的进球数非常低(0-1球)。如果一支球队是一个真正的局外人(以国际足联的得分来衡量)，它很少会进超过2个球！另一方面，如果两支球队的国际足联排名差异具有高正值(主队的国际足联排名比客队高得多)，则平均进球数非常高。强大得多的主队实际上从未少于2个进球，并且可能得分超过7+(例如西班牙对圣马力诺)。</li></ul><h1 id="a0e6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">方法</strong></h1><p id="283e" class="pw-post-body-paragraph mo mp it lt b lu lv ju mq lw lx jx mr ly ms mt mu ma mv mw mx mc my mz na me im bi translated">从上面图1的图表中，我们可以从数据中获得两个重要信息:</p><ol class=""><li id="2813" class="lr ls it lt b lu nb lw nc ly nd ma ne mc nf me ov mg mh mi bi translated">两支参赛球队在国际足联排名上的差距和进球数有实质性的关系！</li><li id="bc88" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me ov mg mh mi bi translated">事实上，球队是在主场还是客场比赛对进球数量有很大的影响。主队平均进1.8球，客场平均只进1.2球。</li></ol><p id="1163" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">为此，我训练了两个独立的回归模型:一个预测<strong class="lt iu">主队</strong>的<strong class="lt iu">分数</strong>，另一个预测<strong class="lt iu">客场队</strong>的分数。(请注意，您也可以简单地训练一个组合模型，并将球队是主场还是客场的信息作为附加因素变量包含在内)。我想让我的模型在最初的尝试中尽可能简单，并且(为了可视化的目的)选择用一个预测变量(FIFA排名差异)训练单独的模型。</p><h1 id="9456" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">什么时候用泊松？</h1><p id="e1b3" class="pw-post-body-paragraph mo mp it lt b lu lv ju mq lw lx jx mr ly ms mt mu ma mv mw mx mc my mz na me im bi translated">文献表明，为此目的使用泊松回归是最好的方法。但是，究竟什么是泊松回归，为什么不简单地使用线性回归或其他方法，如随机森林回归方法？</p><ul class=""><li id="29ce" class="lr ls it lt b lu nb lw nc ly nd ma ne mc nf me mf mg mh mi bi translated">嗯，一般来说，当我们预测每单位时间或空间的<strong class="lt iu">计数</strong>时，会用到泊松回归。比如每场比赛的进球数！由于计数不能为负，泊松模型的最小值是<strong class="lt iu">零</strong>(不可能得分低于零！)，理论上最大值是<strong class="lt iu">无界</strong>——虽然一个球队进球超过5个的情况很少发生:)</li><li id="12f8" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">让我们再看一下图1(左)。像许多泊松分布一样，这个分布是右偏的。很明显，这并不意味着每场比赛的进球数是正态分布的。然而，正态分布假设是线性回归的关键假设！</li></ul><h2 id="669f" class="nh la it bd lb ni nj dn lf nk nl dp lj ly nm nn ll ma no np ln mc nq nr lp ns bi translated"><strong class="ak">线性回归的问题</strong></h2><ul class=""><li id="5391" class="lr ls it lt b lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">一个简单的线性回归模型用一条直线来表示，对于某些变量组合(如负目标数)，这肯定会产生负值。例如，在我们的使用案例中，当我们有一支非常弱的球队(国际足联排名低)与一支非常强的球队(国际足联排名高)比赛时，可能会发生线性回归模型预测较弱球队得分为负数的情况(例如-2.4球)。这绝对是我们想要避免的。</li><li id="783d" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">此外，我们的数据违反了线性回归的等方差假设(正态分布)!你可以在上面的右图中看到，当国际足联排名差异获得更高的正值时，进球的方差也增加了！随后的图像再次以图形方式总结了这一点:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/d11ea56acf39406835a31e59d3e683a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T_D1eaTpALfOHwLMFRDhJA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ou">图2: </strong>回归模型:线性回归(左)和泊松回归(右)。—图片来自<em class="ox"> Paul Roback和Julie Legler，来自</em> <a class="ae ky" href="https://bookdown.org/roback/bookdown-BeyondMLR/" rel="noopener ugc nofollow" target="_blank"> <em class="ox">超越多元线性回归</em> </a></p></figure><blockquote class="nw nx ny"><p id="fbab" class="mo mp ng lt b lu nb ju mq lw nc jx mr nz nt mt mu oa nu mw mx ob nv mz na me im bi translated">1.图2中显示线性模型的图形显示在左侧。它表明，对于X的每个值，响应y近似正态分布。右图显示了泊松模型的样子。对于X的每个值，响应y遵循泊松分布:对于泊松回归，X的小值与一个分布相关联，该分布与许多小值和仅仅几个较大值显著偏斜。随着X的增加，响应的分布开始越来越像正态分布。</p><p id="f4d9" class="mo mp ng lt b lu nb ju mq lw nc jx mr nz nt mt mu oa nu mw mx ob nv mz na me im bi translated">2.在线性模型(左)中，每个X值处Y的变化是相同的。对于泊松回归，随着均值的增加，X的每个水平上的响应变得更加多变。</p><p id="f8e3" class="mo mp ng lt b lu nb ju mq lw nc jx mr nz nt mt mu oa nu mw mx ob nv mz na me im bi translated">3.在线性回归的情况下，每个X值的平均响应落在一条线上。在泊松回归的情况下，每个X值处Y的平均值落在曲线上，而不是直线上。</p></blockquote><p id="5e0f" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated"><em class="ng">改编自保罗·罗巴克和朱莉·勒格勒</em>的《 <a class="ae ky" href="https://bookdown.org/roback/bookdown-BeyondMLR/" rel="noopener ugc nofollow" target="_blank"> <em class="ng">超越多元线性回归</em> </a> <em class="ng"/></p></div><div class="ab cl oy oz hx pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="im in io ip iq"><h1 id="0c93" class="kz la it bd lb lc pf le lf lg pg li lj jz ph ka ll kc pi kd ln kf pj kg lp lq bi translated">比较模型</h1><p id="ae96" class="pw-post-body-paragraph mo mp it lt b lu lv ju mq lw lx jx mr ly ms mt mu ma mv mw mx mc my mz na me im bi translated">在本节中，我们将更深入地了解预测的建模部分，并将泊松模型与线性模型和更强大的随机森林回归进行比较。</p><h2 id="b342" class="nh la it bd lb ni nj dn lf nk nl dp lj ly nm nn ll ma no np ln mc nq nr lp ns bi translated">设置模型</h2><p id="da61" class="pw-post-body-paragraph mo mp it lt b lu lv ju mq lw lx jx mr ly ms mt mu ma mv mw mx mc my mz na me im bi translated">现在我们已经准备好设置模型了。在本练习中，我使用了新的<strong class="lt iu"> tidymodels </strong>包，并使用30折交叉验证进行比较:</p><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="72f9" class="nh la it od b gy oh oi l oj ok">library(tidymodels)<br/>library(parsnip)<br/>library(poissonreg)</span><span id="e1bb" class="nh la it od b gy pk oi l oj ok">pois_mod &lt;-  poisson_reg() %&gt;%  set_engine("glm")<br/>lin_mod  &lt;-  linear_reg() %&gt;% set_engine("lm")<br/>rf_mod   &lt;-  rand_forest(trees=100) %&gt;% <br/>             set_engine("randomForest") %&gt;% <br/>             set_mode("regression")</span><span id="5070" class="nh la it od b gy pk oi l oj ok">folds &lt;- vfold_cv(data, v = 30)</span></pre><p id="ca86" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">如上所述，我们将训练两个模型，每个模型有一个预测变量(参赛球队的FIFA排名差异)。一个模型被训练用于预测主队的得分，一个被训练用于预测客场队的得分:</p><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="5725" class="nh la it od b gy oh oi l oj ok">home_score_formula &lt;- formula(“home_score ~ ranking_diff”)<br/>away_score_formula &lt;- formula(“away_score ~ ranking_diff”)</span></pre><p id="8124" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">以下是泊松回归的示例代码:</p><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="6f94" class="nh la it od b gy oh oi l oj ok">#poisson model workflow set up for predicting home scores<br/>pois_mod_hs_wf &lt;- <br/>  workflow() %&gt;%<br/>  add_model(pois_mod) %&gt;%<br/>  add_formula(home_score_formula)</span><span id="2104" class="nh la it od b gy pk oi l oj ok">#perform cross validation<br/>pois_mod_hs_rs &lt;- <br/>  pois_mod_hs_wf %&gt;% <br/>  fit_resamples(folds)<br/>...</span><span id="9909" class="nh la it od b gy pk oi l oj ok">#collect cv scores<br/>collect_metrics(pois_mod_hs_rs)<br/>collect_metrics(lin_mod_hs_rs)<br/>collect_metrics(rf_mod_hs_rs)</span></pre><h2 id="98ae" class="nh la it bd lb ni nj dn lf nk nl dp lj ly nm nn ll ma no np ln mc nq nr lp ns bi translated">交叉验证结果</h2><p id="23db" class="pw-post-body-paragraph mo mp it lt b lu lv ju mq lw lx jx mr ly ms mt mu ma mv mw mx mc my mz na me im bi translated">交叉验证的结果很有趣，并且表明(通过比较均方根误差(RMSE))随机森林回归优于线性回归和所讨论的泊松回归！！</p><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="283d" class="nh la it od b gy oh oi l oj ok">CV-RMSE Poisson Regression 1.30<br/>CV-RMSE Linear Regression 1.34<br/>CV-RMSE Random Forest Regression 1.17</span></pre><h2 id="1cfe" class="nh la it bd lb ni nj dn lf nk nl dp lj ly nm nn ll ma no np ln mc nq nr lp ns bi translated">视觉比较模型</h2><p id="1dae" class="pw-post-body-paragraph mo mp it lt b lu lv ju mq lw lx jx mr ly ms mt mu ma mv mw mx mc my mz na me im bi translated">但是，等等，RMSE真的是比较这些模型的最佳标准吗？在<a class="ae ky" href="https://stats.stackexchange.com/questions/71720/error-metrics-for-cross-validating-poisson-models" rel="noopener ugc nofollow" target="_blank">这个</a>交叉验证的线程中，有一个关于如何为泊松回归选择<strong class="lt iu">性能指标的很好很长的答案，它将更详细地阐述这个主题。由于这有点过于详细，我决定在散点图中目测模型，并检查模型的所谓“外观和感觉”:</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/87353c7ce97c028c8555d2e0835cd71e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ApinmMOO3kxrtW0HMG5Ww.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ou">图3: </strong>模型对比:线性回归(绿色)、泊松回归(红色)、随机森林回归(蓝色)——图片作者</p></figure><p id="f8e1" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">从视觉上观察模型时，我们可以看到线性模型(绿色)明显不符合数据，根本无法捕捉曲率。然而，随机森林模型(蓝色)显示了一条忙乱的之字形线，它过度拟合了我们的数据，可能不会对新数据进行很好的概括。最后，泊松模型(红色)似乎以非常令人满意的方式捕捉到了数据的趋势和曲率！因此,“外观和感觉”清楚地表明:“使用泊松模型！”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pm"><img src="../Images/c178e89d970b44f41fbfe07a96b4dfb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bO50HOwxGi9nIpUk"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae ky" href="https://unsplash.com/@chaossoccergear?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">混沌足球齿轮</a>拍摄</p></figure><h1 id="d2d4" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">从估计目标到预测结果(赢、输、平)</h1><p id="21ad" class="pw-post-body-paragraph mo mp it lt b lu lv ju mq lw lx jx mr ly ms mt mu ma mv mw mx mc my mz na me im bi translated">让我们回顾一下我们所拥有的:两个预测主客场球队目标的回归模型。</p><p id="5a45" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">但是我们实际上如何“预测”哪一队赢得了决斗呢？</p><p id="6d03" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">我们不能简单地比较主客场球队的进球，把胜者定为数字较高的球队。为什么？因为由于我们的预测是浮点数，我们基本上不会以预测平局结束:想象一下，A队的目标预测是1.1，B队的目标预测是1.09。用上面描述的这个简单方法，我们将把A队指定为获胜者，即使两个队有非常相似的预测！</p><h2 id="dcb7" class="nh la it bd lb ni nj dn lf nk nl dp lj ly nm nn ll ma no np ln mc nq nr lp ns bi translated">1.最简单的方法——比较每场比赛的预测目标</h2><p id="e6a2" class="pw-post-body-paragraph mo mp it lt b lu lv ju mq lw lx jx mr ly ms mt mu ma mv mw mx mc my mz na me im bi translated">最简单的方法是简单地将分数四舍五入到最接近的整数值，然后比较这些整数。在R中，这可以如下进行:</p><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="7626" class="nh la it od b gy oh oi l oj ok">pred_result &lt;- rep(0, length(nrow(data)))</span><span id="2438" class="nh la it od b gy pk oi l oj ok">#home_score_pred contains the poisson home goal predictions for each match<br/>#away_score_pred contains the poisson away goal predictions for each match</span><span id="25b4" class="nh la it od b gy pk oi l oj ok">#assign home team win 0<br/>pred_result[round(home_score_pred) &gt; round(away_score_pred)]  &lt;- 0 </span><span id="b594" class="nh la it od b gy pk oi l oj ok">#assign away team win 1 <br/>pred_result[round(home_score_pred) &lt; round(away_score_pred)]  &lt;- 1</span><span id="e616" class="nh la it od b gy pk oi l oj ok">#assign draw 2<br/>pred_result[round(home_score_pred) == round(away_score_pred)] &lt;- 2</span></pre><p id="5826" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">如果我们考虑上面的例子，用这种方法，A队(1.1)和B队(1.09)都将被分配1个进球，因此这场比赛将被归类为平局，这似乎更合理。</p><p id="fa72" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">下面是通过使用这种简单的舍入和比较方法得出的训练数据的混淆矩阵:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/0a13825dbee030cd64d26a7884a0036b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*unzVuIeU_gqRnK3Os66crg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ou">图4: </strong>比赛结果(主队获胜、客场获胜、平局)的混淆矩阵，用于比较全面的预测比赛分数——图片由作者提供</p></figure><p id="4704" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">我们可以在图4中看到，主队获胜的预测相当不错:217 (167+9+41)中有167被正确预测。预测客队获胜的准确性仍然相当好，然而我们的模型结合我们的舍入方法似乎真的很难正确预测平局。</p><p id="d9d8" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">总的来说，训练集上的<strong class="lt iu">准确度</strong>为<strong class="lt iu"> 65% </strong>，加权F-1分数<strong class="lt iu">为67% </strong>。</p><h2 id="94a8" class="nh la it bd lb ni nj dn lf nk nl dp lj ly nm nn ll ma no np ln mc nq nr lp ns bi translated">2.关于如何更好地分类匹配结果的更复杂的方法</h2><p id="185a" class="pw-post-body-paragraph mo mp it lt b lu lv ju mq lw lx jx mr ly ms mt mu ma mv mw mx mc my mz na me im bi translated">从上面我们可以看到，对预测的团队分数进行舍入，然后简单地进行比较，可以得到65%的准确率。但是用不同的方法有可能得到更好的结果吗？让我们看另一个例子:</p><blockquote class="nw nx ny"><p id="ce6e" class="mo mp ng lt b lu nb ju mq lw nc jx mr nz nt mt mu oa nu mw mx ob nv mz na me im bi translated">假设A队的预测目标是1.49，B队的预测目标是1.51。在上面的舍入示例中，团队A的分数将被舍入为1，团队B的分数将被舍入为2，因此团队B将被宣布为获胜者。但是在这种情况下预测平局不是更好吗，因为两个队的目标预测都非常接近？嗯，是的！但是，我们如何为目标预测之间的差异选择正确的阈值，以便一个团队可以被宣布为赢家或输家？</p></blockquote><p id="0dcb" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">因此，游戏结果的分类(赢、输、平)变为如下:</p><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="f131" class="nh la it od b gy oh oi l oj ok">predicted_result &lt;- rep(NA, length(pois_hs_res))</span><span id="5b0e" class="nh la it od b gy pk oi l oj ok">#home_score_pred contains the poisson home goal predictions for each match<br/>#away_score_pred contains the poisson away goal predictions for each match</span><span id="faa4" class="nh la it od b gy pk oi l oj ok">#assign home team win 0<br/>predicted_result[home_score_pred &gt; away_score_pred+diff] &lt;- 0</span><span id="ba70" class="nh la it od b gy pk oi l oj ok">#assign home away win 1<br/>predicted_result[home_score_pred &lt; awy_score_pred-diff] &lt;- 1</span><span id="78d5" class="nh la it od b gy pk oi l oj ok">#assign draw 2<br/>predicted_result[!(home_score_pred &gt; away_score_pred+diff) &amp; !(home_score_pred &lt; away_score_pred-diff)] &lt;- 2</span></pre><p id="236d" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">因此，本质上，我们正在寻找一种方法，如何最大限度地提高基于进球差异阈值的比赛结果分类的准确性:</p><p id="f092" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">一旦我们选择了一个指标，比如说“加权F1得分”或“准确性”，我们可以简单地对一系列净胜球阈值运行上面的结果分配，看看哪个阈值产生最好的F1得分。让我们做吧！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi po"><img src="../Images/fd7b4384e36adaa0dfab295e6bbef7ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*-YEhrgIgERV33rNcqBoy5A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ou">图5: </strong>一组净胜球阈值的比赛结果分类(赢、输、平)的加权F1分数。—作者图片</p></figure><p id="5a35" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">上面的图5显示了我们的比赛分类(赢、输、平)的F1分数根据我们选择的差异阈值而变化很大。最初，F1分数开始增加到几乎70%,差异阈值为0.41。之后，F1分数开始再次稳定下降，并在图表右侧达到最小值。</p><p id="d6fd" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">从上图中选择检测到的“最佳”差异阈值后，我们运行上面的游戏结果分配，并获得以下混淆矩阵和准确度:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/4c7bddbf95cc6acaa896a85935f770a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nWhSkNqxDufeFJfP2eaBbQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ou">图6: </strong>带有自定义差异阈值的比赛结果(主队获胜、客场获胜、平局)的混淆矩阵—图片由作者提供</p></figure><p id="20c3" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">我们可以看到，与之前的方法相比，主队获胜和客场获胜的预测都增加了！不幸的是，我们的方法仍然难以正确检测和局。一个潜在的改进是使用另一个单独的差异阈值来分配和局。然而，这将使文章比现在更长:)</p><p id="70c2" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">总的来说，<strong class="lt iu">准确率和F1得分</strong>都从大约65%跃升到现在的<strong class="lt iu"> 69%！</strong></p><h1 id="16b2" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">预测2020年欧锦赛</h1><p id="5c9f" class="pw-post-body-paragraph mo mp it lt b lu lv ju mq lw lx jx mr ly ms mt mu ma mv mw mx mc my mz na me im bi translated">受够了无聊的数据争论和建模！让我们最后使用我们的方法来预测2020年欧锦赛小组赛的第一场比赛的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pq"><img src="../Images/62cb02f72485ab3da42dd8e7ae46e4d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*267OQJGd9VQ5e2l-CWog4g.png"/></div></div></figure><p id="f0af" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">你可以看到，通过这个简单的方法，我们在测试集上达到了72% 的<strong class="lt iu">准确率和71% </strong>的加权<strong class="lt iu"> F1得分。18场比赛中有13场预测正确！大多数决斗都预测正确，老实说，谁能想到丹麦会在本届锦标赛中表现如此出色，而西班牙只会与瑞典打成平局？:)</strong></p><blockquote class="nw nx ny"><p id="bb0b" class="mo mp ng lt b lu nb ju mq lw nc jx mr nz nt mt mu oa nu mw mx ob nv mz na me im bi translated">请注意以下几点:主客场球队对进球的依赖只有在比赛场地是<strong class="lt iu">而不是</strong> <strong class="lt iu">中立</strong>时才有意义。然而，在欧洲锦标赛期间，大多数比赛场地都是中立的，因此，通过一个不考虑主客场球队的单一模型来预测两支球队的结果会更合适。</p></blockquote><h2 id="4935" class="nh la it bd lb ni nj dn lf nk nl dp lj ly nm nn ll ma no np ln mc nq nr lp ns bi translated">摘要</h2><p id="6b06" class="pw-post-body-paragraph mo mp it lt b lu lv ju mq lw lx jx mr ly ms mt mu ma mv mw mx mc my mz na me im bi translated">这是一个关于如何通过简单的泊松回归预测足球比分和结果的详细演练，只使用一个预测变量(国际足联在参赛球队之间的排名差异)。总的来说，我们达到了72%的准确率。但是，还有很大的提升空间！例如，我们可以使用更多的特征作为模型的输入，例如在最近几场比赛中每支球队的进球数作为最新表现的指标！</p><p id="dea7" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">如果你有兴趣阅读更多关于这个话题的内容，或者想让你的朋友对即将到来的游戏印象深刻，请给我写一篇评论！:)</p><p id="3c34" class="pw-post-body-paragraph mo mp it lt b lu nb ju mq lw nc jx mr ly nt mt mu ma nu mw mx mc nv mz na me im bi translated">如果你对完整代码感兴趣，请访问我的<a class="ae ky" href="https://github.com/sikli/simple_poissoin_soccer" rel="noopener ugc nofollow" target="_blank"> GitHub </a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pr"><img src="../Images/8473264870f89361092eec2744e9d62c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YCbLOd02hTH3_umH"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@schuh?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">桑德罗·舒赫</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div></div>    
</body>
</html>