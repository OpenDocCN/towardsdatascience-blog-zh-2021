<html>
<head>
<title>The Chi-squared Goodness of Fit Test for Regression Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">回归分析的卡方拟合优度检验</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-chi-squared-goodness-of-fit-test-for-regression-analysis-b2d2e4b487ab?source=collection_archive---------15-----------------------#2021-03-29">https://towardsdatascience.com/the-chi-squared-goodness-of-fit-test-for-regression-analysis-b2d2e4b487ab?source=collection_archive---------15-----------------------#2021-03-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/15e3912aa26de688399f614a78ee9846.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*clra_lwdlw0rnB_p59_2CA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">观察到的和预期的NUMBIDS频率(图片由<a class="ae jd" href="https://sachin-date.medium.com/" rel="noopener">作者</a>提供)</p></figure><div class=""/><div class=""><h2 id="76ce" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">以及如何使用Python、SciPy和Statsmodels来使用它的教程</h2></div><p id="a9a7" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">卡方检验(读作<em class="lr"> Kai- </em>平方，如<em class="lr"> Kai </em> zen或<em class="lr"> Kai </em> ser)是最通用的统计显著性检验之一。</p><p id="33cf" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下是卡方检验的一些用途:</p><ol class=""><li id="7ba5" class="ls lt jg kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated"><strong class="kx jh">分布的拟合优度:</strong>卡方检验可用于确定您的数据是否符合已知的理论概率分布，如正态或泊松分布。</li><li id="1646" class="ls lt jg kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kx jh">回归模型的拟合优度:</strong>卡方检验可用于测量您的训练回归模型在训练、验证或测试数据集上的拟合优度。</li><li id="c32c" class="ls lt jg kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kx jh">最小卡方估计:</strong>对于服从参数分布(如正态分布、泊松分布或二项式分布)的数据集，卡方检验可用于找出观察值服从理论分布的参数范围。</li><li id="394d" class="ls lt jg kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kx jh">独立性检验:</strong>卡方检验可用于检验两个分类随机变量(如年龄和收入，其值已在实验中测量)是否相互独立。</li><li id="cfac" class="ls lt jg kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kx jh">残差分析:</strong>在某些<a class="ae jd" rel="noopener" target="_blank" href="/generalized-linear-models-9ec4dfe3dc3f">广义线性回归模型</a>中，<strong class="kx jh">皮尔逊残差</strong>在残差是独立的同分布正态变量的零假设下服从(缩放)卡方分布，表明拟合模型的拟合优度很高。</li><li id="dd7d" class="ls lt jg kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kx jh">嵌套回归模型的拟合优度:</strong>可用于比较嵌套回归模型对数似然性的<strong class="kx jh">偏差统计量</strong>遵循卡方分布，假设添加回归变量不会增加模型的拟合优度。因此，选择两种型号中较简单的型号可能会更好。</li><li id="fb10" class="ls lt jg kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated"><strong class="kx jh">与G平方检验的关系:</strong>当观察值和期望值几乎相等时，拟合优度的G检验简化为拟合优度的卡方检验。</li></ol><p id="78d3" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本文的其余部分，我们将重点关注卡方检验在回归分析中的应用。</p><p id="9b26" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将使用真实世界的数据集<strong class="kx jh">收购出价</strong>，这是回归建模文献中的一个流行数据集。我们将使用<a class="ae jd" href="https://docs.scipy.org/doc/scipy/reference/stats.html#module-scipy.stats" rel="noopener ugc nofollow" target="_blank"> <em class="lr"> SciPy </em> </a>和<a class="ae jd" href="https://www.statsmodels.org/stable/index.html" rel="noopener ugc nofollow" target="_blank"> <em class="lr"> Statsmodels </em> </a>库作为我们的实现工具。</p><h1 id="ea6c" class="mg mh jg bd mi mj mk ml mm mn mo mp mq km mr kn ms kp mt kq mu ks mv kt mw mx bi translated"><strong class="ak">卡方检验的起源</strong></h1><p id="2a56" class="pw-post-body-paragraph kv kw jg kx b ky my kh la lb mz kk ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">卡方检验基于<strong class="kx jh">卡方分布</strong>。卡方分布是将<em class="lr"> n </em>个独立随机变量的平方相加得到的，每个变量都遵循标准正态分布，即每个正态变量的均值和单位方差都为零。</p><p id="c224" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以符号形式:</p><figure class="ne nf ng nh gt is gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/13f96f9168ccede59f1f71817e9906fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*JwwByXdm3eOTEbm5SJTRcQ.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">以k个标准正态随机变量的平方和表示的𝛘概率分布(图片由<a class="ae jd" href="https://sachin-date.medium.com/" rel="noopener">作者</a></p></figure><p id="f7b5" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">总和中的<em class="lr"> N(0，1) </em>表示均值和单位方差为零的正态分布随机变量。如果你将k个T21这样的变量和它们的“实现”值的平方相加，你会得到一个自由度为k的卡方分布。</p><p id="8b45" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果人们愿意将1/方差比例因子添加到结果分布中，则可以放宽单位方差约束。</p><p id="7d36" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="lr"> 𝛘 (k) </em>分布的均值为<em class="lr"> k </em>，方差为<em class="lr"> 2k </em>。下图取自维基共享资源，显示了随着<em class="lr"> k </em>值的增加，<em class="lr"> 𝛘 (k) </em>的形状:</p><figure class="ne nf ng nh gt is gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/aab8f468f0cf25f1df13e9ab78442c0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*abKKXOsV3jCtva43Ki0Ugg.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">k自由度的Ch平方概率分布(来源:<a class="ae jd" href="https://commons.wikimedia.org/wiki/File:Chi-square_pdf.svg" rel="noopener ugc nofollow" target="_blank">维基媒体</a>下<a class="ae jd" href="https://creativecommons.org/licenses/by/3.0/deed.en" rel="noopener ugc nofollow" target="_blank"> CC BY 3.0 </a>)</p></figure><blockquote class="nj"><p id="7041" class="nk nl jg bd nm nn no np nq nr ns lq dk translated">卡方检验可用于那些被证明在零假设下渐近遵循卡方分布的检验统计量。</p></blockquote></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><p id="10da" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在让我们看看如何使用卡方拟合优度检验。</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><h1 id="0e6d" class="mg mh jg bd mi mj oa ml mm mn ob mp mq km oc kn ms kp od kq mu ks oe kt mw mx bi translated"><strong class="ak">使用卡方检验测试已知概率分布的拟合优度</strong></h1><p id="a515" class="pw-post-body-paragraph kv kw jg kx b ky my kh la lb mz kk ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">为了测试给定的数据集是否服从已知的概率分布，我们使用以下称为皮尔逊卡方统计量的测试统计量:</p><figure class="ne nf ng nh gt is gh gi paragraph-image"><div class="gh gi of"><img src="../Images/14b8fa4920fd16261fe1a8cefcd8678a.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*X2-zbG0BCBrVSqJbVGOeEg.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">检验观察值是否服从某种期望的频率分布的检验统计量(图片由<a class="ae jd" href="https://sachin-date.medium.com/" rel="noopener">作者</a>提供)</p></figure><p id="288c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">其中:</p><p id="987c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="lr"> O_i </em>是随机变量的<em class="lr">与</em>结果的观测频率。<br/> <em class="lr"> E_i </em>是随机变量第<em class="lr">次与第</em>次结果的期望频率。</p><p id="4245" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">可以看出，对于<em class="lr"> O_i </em>和<em class="lr"> E_i </em>的“足够大”的值，并且当<em class="lr"> O_i </em>与<em class="lr"> E_i </em>相差不大，即数据没有严重分散时，<strong class="kx jh"> <em class="lr"> T </em> </strong>遵循具有<em class="lr">N-p</em>自由度的卡方分布，其中<em class="lr"> N </em>是类别的数量例如，当理论分布是泊松分布时，<em class="lr"> p=1 </em>，因为泊松分布只有一个参数——平均利率。</p><h1 id="44dc" class="mg mh jg bd mi mj mk ml mm mn mo mp mq km mr kn ms kp mt kq mu ks mv kt mw mx bi translated"><strong class="ak">示例</strong></h1><p id="25f7" class="pw-post-body-paragraph kv kw jg kx b ky my kh la lb mz kk ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">让我们看看如何在一组实际的观察数据上使用这种检验，我们将假定这些数据是泊松分布的，我们将使用卡方拟合优度检验来证明或否定我们的假设。</p><p id="344d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将使用的观察数据集包含1978年至1985年间记录的126个公司收购活动观察数据。每个观察包含几个参数，例如经历了接管事件的公司的规模(以十亿美元计)。因变量'<strong class="kx jh"> <em class="lr"> y </em> </strong>'是对该公司进行的收购出价的数量。需要注意的一点是，该数据集中的所有126家公司最终都是在对每家公司的最终记录收购出价后的某个时期内被收购的。</p><p id="7e08" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">数据集可以从这里下载<a class="ae jd" href="https://gist.github.com/sachinsdate/08039ec2685b77a4af4b20feca23ec1f" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="ca26" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们从导入所有必需的Python包开始:</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="853f" class="ol mh jg oh b gy om on l oo op"><strong class="oh jh">import </strong>pandas <strong class="oh jh">as </strong>pd<br/><strong class="oh jh">import </strong>numpy <strong class="oh jh">as </strong>np<br/><strong class="oh jh">from </strong>patsy <strong class="oh jh">import </strong>dmatrices<br/><strong class="oh jh">from </strong>matplotlib <strong class="oh jh">import </strong>pyplot <strong class="oh jh">as </strong>plt<br/><strong class="oh jh">from </strong>scipy.stats <strong class="oh jh">import </strong>poisson<br/><strong class="oh jh">import </strong>scipy.stats <strong class="oh jh">as </strong>stats<br/><strong class="oh jh">import </strong>statsmodels.api <strong class="oh jh">as </strong>sm</span></pre><p id="8c9d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们将数据集读入熊猫数据帧:</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="5599" class="ol mh jg oh b gy om on l oo op">df = pd.<strong class="oh jh">read_csv</strong>(<strong class="oh jh">'takeover_bids_dataset.csv'</strong>, header=0, index_col=[0])</span></pre><p id="2208" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">打印出前15行。每行包含一个独特公司的收购相关活动:</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="0216" class="ol mh jg oh b gy om on l oo op">df.<strong class="oh jh">head</strong>(15)</span></pre><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oq"><img src="../Images/7f16edbbf190ef27dbba0127f36f1bdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hyN4vrSEbBeCQNUINA-xDw.png"/></div></div></figure><p id="6fda" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们感兴趣的变量如下:</p><h2 id="45aa" class="ol mh jg bd mi or os dn mm ot ou dp mq le ov ow ms li ox oy mu lm oz pa mw pb bi translated"><strong class="ak">解释变量(X矩阵):</strong></h2><p id="bc4d" class="pw-post-body-paragraph kv kw jg kx b ky my kh la lb mz kk ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated"><em class="lr"> BIDPREM </em>:买入溢价=买入价格/买入前15天的股票市价。<br/> <em class="lr"> FINREST: </em>指示变量(1/0)，表示公司的股权结构是否拟变更。<br/> <em class="lr">机构持股:</em>机构持股比例。<br/><em class="lr">【legl rest:</em>指示变量(1/0)表示被接管的公司是否进行了法律辩护。<br/> <em class="lr"> REALREST: </em>指示变量(1/0)，表示公司的资产结构是否拟变更。<br/> <em class="lr"> REGULATN: </em>指示美国司法部是否干预的指示变量(1/0)。<br/> <em class="lr">规模:</em>以十亿美元计的公司规模<br/> <em class="lr">规模SQ: </em>规模的平方，以说明规模中的任何非线性。<br/> <em class="lr"> WHITEKNT: </em>指示变量(1/0)，表示公司管理层是否邀请了任何友好投标，例如用于避免敌意收购的投标。</p><h2 id="c480" class="ol mh jg bd mi or os dn mm ot ou dp mq le ov ow ms li ox oy mu lm oz pa mw pb bi translated"><strong class="ak">因变量(y向量):</strong></h2><p id="e208" class="pw-post-body-paragraph kv kw jg kx b ky my kh la lb mz kk ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated"><strong class="kx jh"><em class="lr">NUMBIDS</em></strong><em class="lr">:</em>整数，包含对公司进行的收购出价的数量。</p><p id="7872" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">打印因变量的汇总统计数据:NUMBIDS</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="6700" class="ol mh jg oh b gy om on l oo op">stats_labels = [<strong class="oh jh">'Mean NUMBIDS'</strong>, <strong class="oh jh">'Variance NUMBIDS'</strong>, <strong class="oh jh">'Minimum NUMBIDS'</strong>, <strong class="oh jh">'Maximum NUMBIDS'</strong>]</span><span id="d8f6" class="ol mh jg oh b gy pc on l oo op">stats_values = [<strong class="oh jh">round</strong>(df[<strong class="oh jh">'NUMBIDS'</strong>].<strong class="oh jh">mean</strong>(), 2), round(df[<strong class="oh jh">'NUMBIDS'</strong>].<strong class="oh jh">var</strong>(), 2), df[<strong class="oh jh">'NUMBIDS'</strong>].<strong class="oh jh">min</strong>(), df[<strong class="oh jh">'NUMBIDS'</strong>].<strong class="oh jh">max</strong>()]</span><span id="2f1b" class="ol mh jg oh b gy pc on l oo op"><strong class="oh jh">print</strong>(<strong class="oh jh">set</strong>(<strong class="oh jh">zip</strong>(stats_labels, stats_values)))</span></pre><p id="95ee" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们看到以下统计数据:</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="8542" class="ol mh jg oh b gy om on l oo op">{(‘Mean NUMBIDS’, 1.74), (‘Variance NUMBIDS’, 2.05), (‘Minimum NUMBIDS’, 0), (‘Maximum NUMBIDS’, 10)}</span></pre><p id="ec88" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们注意到<em class="lr"> NUMBIDS </em>的平均值是1.74，而方差是2.05。它们很接近，但不相同。存在少量的过度分散，但这不足以排除<em class="lr"> NUMBIDS </em>可能是理论平均速率为1.74的泊松分布的可能性。</p><p id="be09" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们形成两个假设:</p><p id="9fa8" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh"> H0: </strong> <em class="lr"> NUMBIDS </em>遵循平均值为1.74的泊松分布。</p><p id="b2ee" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh"> H1: </strong> H0是假的。<em class="lr"> NUMBIDS </em>不是泊松分布。</p><p id="b47b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将继续我们的探索，用卡方拟合优度检验来证明(或否定)H0。为此，我们将使用以下步骤:</p><ol class=""><li id="3bd4" class="ls lt jg kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated">定义这两个假设。我们已经这样做了。</li><li id="5559" class="ls lt jg kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">为<strong class="kx jh"><em class="lr">y =</em></strong><em class="lr">NUMBIDS</em>变量的每个值计算观察到的频率<em class="lr"> O_i </em>。</li><li id="36d1" class="ls lt jg kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">假设泊松分布<strong class="kx jh"> <em class="lr"> y </em> </strong>，计算<strong class="kx jh"><em class="lr">y =</em></strong><em class="lr">NUMBIDS</em>的每个值的期望频率<em class="lr"> E_i </em>。</li><li id="e034" class="ls lt jg kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">计算我们上面给出的测试统计量。</li><li id="3bdc" class="ls lt jg kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">在卡方表中查找检验统计的p值。如果p值小于0.05，拒绝95%置信水平的H0，否则接受相同置信水平的H0 ( <em class="lr">即NUMBIDS </em>为泊松分布)。</li></ol><p id="37b6" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了计算观察到的频率<em class="lr"> O_i </em>，让我们创建一个分组数据集，按<em class="lr"> NUMBIDS </em>的频率分组。</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="909a" class="ol mh jg oh b gy om on l oo op">grouped_df = df.<strong class="oh jh">groupby</strong>(<strong class="oh jh">'NUMBIDS'</strong>).<strong class="oh jh">count</strong>().<strong class="oh jh">sort_values</strong>(<strong class="oh jh">by</strong>=<strong class="oh jh">'NUMBIDS'</strong>)<br/>grouped_df[<strong class="oh jh">'NUMBIDS_OBS_FREQ'</strong>] = grouped_df[<strong class="oh jh">'SIZESQ'</strong>]</span></pre><p id="af03" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">打印分组的数据集:</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="0cc1" class="ol mh jg oh b gy om on l oo op"><strong class="oh jh">print</strong>(grouped_df[<strong class="oh jh">'NUMBIDS_OBS_FREQ'</strong>])</span></pre><figure class="ne nf ng nh gt is gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/a9a54cfd2186dabbf00015f1ef6bf917.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*lZwRoJgq1G79hY309uop3w.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">观察到的数字频率(图片由<a class="ae jd" href="https://sachin-date.medium.com/" rel="noopener">作者</a>提供)</p></figure><p id="64bd" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们看到<em class="lr">数字&gt; = 5 </em>的频率非常少。卡方检验对于频率非常小的箱是不准确的。为了解决这个问题，我们将对所有<em class="lr"> NUMBIDS &gt; = 5 </em>的频率求和，并将该数字与<em class="lr"> NUMBIDS=5相关联。</em></p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="5104" class="ol mh jg oh b gy om on l oo op">grouped_df.<strong class="oh jh">at</strong>[5, <strong class="oh jh">'NUMBIDS_OBS_FREQ'</strong>] = 5</span></pre><p id="7b9d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们也删除<em class="lr"> NUMBIDS &gt; 5 </em>的行，因为<em class="lr">NUMBIDS = 5</em>捕获所有NUMBIDS &gt; =5的频率。</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="f067" class="ol mh jg oh b gy om on l oo op">grouped_df = grouped_df.<strong class="oh jh">drop</strong>([6,7,10])</span></pre><p id="894c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">同时计算并存储<em class="lr"> NUMBIDS </em>的观测概率。</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="a128" class="ol mh jg oh b gy om on l oo op">grouped_df[<strong class="oh jh">'NUMBIDS_OBS_PROBA'</strong>] = grouped_df[<strong class="oh jh">'NUMBIDS_OBS_FREQ'</strong>]/<strong class="oh jh">len</strong>(df)</span></pre><p id="6d99" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，假设<em class="lr"> NUMBIDS </em>是泊松分布，计算并存储<em class="lr"> NUMBIDS </em>的期望概率。</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="003c" class="ol mh jg oh b gy om on l oo op">grouped_df[<strong class="oh jh">'NUMBIDS_POISSON_PMF'</strong>] = poisson.<strong class="oh jh">pmf</strong>(<strong class="oh jh">k</strong>=grouped_df.<strong class="oh jh">index</strong>, mu=df[<strong class="oh jh">'NUMBIDS'</strong>].<strong class="oh jh">mean</strong>())</span></pre><p id="8b77" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于<em class="lr"> NUMBIDS &gt; =5 </em>，我们将使用泊松<strong class="kx jh">生存函数</strong>，它将给出我们看到<em class="lr"> NUMBIDS &gt; =5的概率。</em></p><p id="eca1" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">生存函数<em class="lr"> S(X=x) </em>给出了观察到大于<em class="lr"> x的<em class="lr"> X </em>值的概率，即S(X=x) = Pr(X &gt; x) </em></p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="7bd0" class="ol mh jg oh b gy om on l oo op">grouped_df.<strong class="oh jh">at</strong>[5, <strong class="oh jh">'NUMBIDS_POISSON_PMF'</strong>] = poisson.<strong class="oh jh">sf</strong>(<strong class="oh jh">k</strong>=4, mu=df[<strong class="oh jh">'NUMBIDS'</strong>].<strong class="oh jh">mean</strong>())</span></pre><p id="1b26" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">计算每个<em class="lr">数字</em>的泊松分布期望频率<em class="lr"> E_i </em></p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="2a8d" class="ol mh jg oh b gy om on l oo op">grouped_df[<strong class="oh jh">'NUMBIDS_POISSON_FREQ'</strong>] = grouped_df[<strong class="oh jh">'NUMBIDS_POISSON_PMF'</strong>]*<strong class="oh jh">len</strong>(df)</span></pre><p id="ea44" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">打印观察值和预期值:</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="e93c" class="ol mh jg oh b gy om on l oo op">print(grouped_df[[<strong class="oh jh">'NUMBIDS_OBS_PROBA'</strong>, <strong class="oh jh">'NUMBIDS_OBS_FREQ'</strong>, <strong class="oh jh">'NUMBIDS_POISSON_PMF'</strong>, <strong class="oh jh">'NUMBIDS_POISSON_FREQ'</strong>]])</span></pre><p id="b652" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们看到以下输出:</p><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pe"><img src="../Images/d2e6613c81fb73d8ce77b144e4c8b1b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4daN_KTJw-cB-BnLVnu7ww.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">观察到的(O_i)和预期的(E _ I<em class="pf">)</em>NUMBIDS的频率(图片由<a class="ae jd" href="https://sachin-date.medium.com/" rel="noopener">作者</a>提供)</p></figure><p id="16ef" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">绘制所有<em class="lr"> i </em>的观察值(<em class="lr"> O_i </em>)和期望值(<em class="lr"> E_i </em>):</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="5c87" class="ol mh jg oh b gy om on l oo op">labels=[<strong class="oh jh">'0'</strong>, <strong class="oh jh">'1'</strong>, <strong class="oh jh">'2'</strong>, <strong class="oh jh">'3'</strong>, <strong class="oh jh">'4'</strong>, <strong class="oh jh">' &gt;=5'</strong>]<br/>x = np.<strong class="oh jh">arange</strong>(len(labels))<br/>width = 0.35<br/>fig, ax = plt.<strong class="oh jh">subplots</strong>()</span><span id="7948" class="ol mh jg oh b gy pc on l oo op">ax.<strong class="oh jh">set_title</strong>(<strong class="oh jh">'Poisson Predicted versus Observed Frequencies of NUMBIDS'</strong>)</span><span id="c1b5" class="ol mh jg oh b gy pc on l oo op">ax.<strong class="oh jh">set_xlabel</strong>(<strong class="oh jh">'NUMBIDS'</strong>)<br/>ax.<strong class="oh jh">set_ylabel</strong>(<strong class="oh jh">'Frequency of NUMBIDS'</strong>)<br/>ax.<strong class="oh jh">set_xticks</strong>(x)<br/>ax.<strong class="oh jh">set_xticklabels</strong>(labels)</span><span id="b987" class="ol mh jg oh b gy pc on l oo op">bar1 = ax.<strong class="oh jh">bar</strong>(<strong class="oh jh">x</strong>=x - width/2, <strong class="oh jh">height</strong>=<strong class="oh jh">list</strong>(grouped_df[<strong class="oh jh">'NUMBIDS_OBS_FREQ'</strong>]), <strong class="oh jh">width</strong>=width, <strong class="oh jh">label</strong>=<strong class="oh jh">'Observed Frequency'</strong>)</span><span id="1308" class="ol mh jg oh b gy pc on l oo op">bar2 = ax.<strong class="oh jh">bar</strong>(<strong class="oh jh">x</strong>=x + width/2, height=list(grouped_df[<strong class="oh jh">'NUMBIDS_POISSON_FREQ'</strong>]), <strong class="oh jh">width</strong>=width, <strong class="oh jh">label</strong>=<strong class="oh jh">'Expected Frequency'</strong>)</span><span id="d2cd" class="ol mh jg oh b gy pc on l oo op">ax.<strong class="oh jh">legend</strong>()<br/>ax.<strong class="oh jh">bar_label</strong>(bar1, padding=3)<br/>ax.<strong class="oh jh">bar_label</strong>(bar2, padding=3)<br/>fig.<strong class="oh jh">tight_layout</strong>()<br/>plt.<strong class="oh jh">show</strong>()</span></pre><p id="371e" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们看到下面的情节:</p><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/15e3912aa26de688399f614a78ee9846.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*clra_lwdlw0rnB_p59_2CA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">NUMBIDS的观察频率和预期频率的柱状图(图片由<a class="ae jd" href="https://sachin-date.medium.com/" rel="noopener">作者</a>提供)</p></figure><p id="a1f4" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在让我们计算卡方检验统计量:</p><figure class="ne nf ng nh gt is gh gi paragraph-image"><div class="gh gi of"><img src="../Images/442419c181f868037f04fa97dba90ee9.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*6X4abFsL55rVzOloecqsIg.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">卡方拟合优度检验统计(图片由<a class="ae jd" href="https://sachin-date.medium.com/" rel="noopener">作者</a>提供)</p></figure><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="136d" class="ol mh jg oh b gy om on l oo op">grouped_df[<strong class="oh jh">'CHI_SQUARED_STAT'</strong>] = np.<strong class="oh jh">power</strong>(grouped_df[<strong class="oh jh">'NUMBIDS_OBS_FREQ'</strong>]-grouped_df[<strong class="oh jh">'NUMBIDS_POISSON_FREQ'</strong>], 2)/grouped_df[<strong class="oh jh">'NUMBIDS_POISSON_FREQ'</strong>]</span><span id="011d" class="ol mh jg oh b gy pc on l oo op">chi_squared_value = grouped_df[<strong class="oh jh">'CHI_SQUARED_STAT'</strong>].<strong class="oh jh">sum</strong>()</span></pre><p id="79c7" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在计算上述统计的p值之前，我们必须确定自由度。以下是总自由度:</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="b542" class="ol mh jg oh b gy om on l oo op">total_degrees_of_freedom = <strong class="oh jh">len</strong>(grouped_df)</span></pre><p id="c52b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们必须将这个数字减少<em class="lr"> p </em>，其中<em class="lr">p</em>=泊松分布的参数数量。所以p=1。</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="0e20" class="ol mh jg oh b gy om on l oo op">reduced_degrees_of_freedom = total_degrees_of_freedom - 1</span></pre><p id="8c83" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">获得自由度为<em class="lr"> (N-p) </em>的卡方检验统计的p值。请注意，我们再次使用生存函数，它给出了观察到大于某个值的结果的概率，在这种情况下，该值是卡方检验统计量。</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="1add" class="ol mh jg oh b gy om on l oo op">chi_squared_p_value = stats.<strong class="oh jh">chi2</strong>.<strong class="oh jh">sf</strong>(<strong class="oh jh">x</strong>=chi_squared_value, <strong class="oh jh">df</strong>=reduced_degrees_of_freedom)</span></pre><p id="0a06" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们还将获得与0.05 (95%置信水平)的临界alpha相对应的测试统计值。我们将使用生存函数的反函数来得到这个值。<br/>自生存函数<em class="lr">S(</em><strong class="kx jh"><em class="lr">X</em></strong><em class="lr">= X)= Pr(</em><strong class="kx jh"><em class="lr">X</em></strong><em class="lr">&gt;X)</em><em class="lr">S的逆(</em><strong class="kx jh"><em class="lr"/></strong><em class="lr">= X)</em>会给你<strong class="kx jh"><em class="lr"/></strong><em class="lr">= X<em class="lr"/></em></p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="2106" class="ol mh jg oh b gy om on l oo op">critical_chi_squared_value_at_95p = stats.<strong class="oh jh">chi2</strong>.<strong class="oh jh">isf</strong>(<strong class="oh jh">q</strong>=0.05, <strong class="oh jh">df</strong>=reduced_degrees_of_freedom)</span></pre><p id="571e" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">打印出我们到目前为止计算出的所有值:</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="f709" class="ol mh jg oh b gy om on l oo op">stats_labels=[<strong class="oh jh">'Degrees of freedom'</strong>, <strong class="oh jh">'Chi-squared test statistic'</strong>, <strong class="oh jh">'p-value'</strong>, <strong class="oh jh">'Maximum allowed Chi-squared test statistic for H0 at alpha=0.05'</strong>]</span><span id="604c" class="ol mh jg oh b gy pc on l oo op">stats_values=[reduced_degrees_of_freedom, chi_squared_value, chi_squared_p_value, critical_chi_squared_value_at_95p]</span><span id="bab0" class="ol mh jg oh b gy pc on l oo op"><strong class="oh jh">print</strong>(<strong class="oh jh">set</strong>(<strong class="oh jh">zip</strong>(stats_labels, stats_values)))</span></pre><p id="5b42" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们看到以下输出:</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="ecf2" class="ol mh jg oh b gy om on l oo op">{('Degrees of freedom', 5), ('p-value', 4.9704641133403614e-05), ('<strong class="oh jh">Chi-squared test statistic</strong>', 27.306905068684152), ('<strong class="oh jh">Maximum allowed Chi-squared test statistic for H0 at alpha=0.05</strong>', 11.070497693516355)}</span></pre><p id="7c8c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们看到卡方拟合优度统计的计算值为27.306905068684152，其p值为4.9704641133403614e-05，远小于<em class="lr"> alpha=0.05 </em>。</p><p id="6156" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，我们得出结论，在95%的置信水平下(甚至在9.99%的置信水平下)，可以坚决拒绝零假设H0，即<em class="lr">数字</em>是泊松分布。</p><p id="3818" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">还要注意，在95%置信水平下接受H0的临界卡方检验统计值是11.07，比27.31小得多。</p><p id="fa91" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以通过绘制卡方(5)来可视化这种情况:</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="0c75" class="ol mh jg oh b gy om on l oo op">plt.<strong class="oh jh">xlabel</strong>(<strong class="oh jh">'Chi-squared distributed random number'</strong>)</span><span id="9a11" class="ol mh jg oh b gy pc on l oo op">plt.<strong class="oh jh">ylabel</strong>(<strong class="oh jh">'Chi-squared(df='</strong>+str(reduced_degrees_of_freedom)+<strong class="oh jh">') probability density'</strong>)</span><span id="20ca" class="ol mh jg oh b gy pc on l oo op">rv = stats.<strong class="oh jh">chi2</strong>.<strong class="oh jh">rvs</strong>(df=reduced_degrees_of_freedom, size=100000)</span><span id="cc16" class="ol mh jg oh b gy pc on l oo op">plt.<strong class="oh jh">hist</strong>(<strong class="oh jh">x</strong>=rv, <strong class="oh jh">bins</strong>=100, <strong class="oh jh">density</strong>=<strong class="oh jh">True</strong>, <strong class="oh jh">histtype</strong>=<strong class="oh jh">'stepfilled'</strong>)</span><span id="e8da" class="ol mh jg oh b gy pc on l oo op">plt.<strong class="oh jh">show</strong>()</span></pre><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pg"><img src="../Images/80d02ca39b770c80f30ade004dd2d5f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0UknpMUT0Btoaf5d-by_DQ.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">𝛘 (5)概率分布显示了数据遵循给定概率分布(在我们的情况下，泊松)的零假设的接受区和拒绝区(图片由<a class="ae jd" href="https://sachin-date.medium.com/" rel="noopener">作者</a>提供)</p></figure></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><h1 id="f1fc" class="mg mh jg bd mi mj oa ml mm mn ob mp mq km oc kn ms kp od kq mu ks oe kt mw mx bi translated">测试回归模型的拟合优度</h1><p id="2330" class="pw-post-body-paragraph kv kw jg kx b ky my kh la lb mz kk ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">我们现在将了解如何使用卡方检验来检验泊松回归模型的拟合优度。</p><p id="8fee" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，让我们用泊松回归模型来拟合我们的收购出价数据集。我们将使用<a class="ae jd" href="https://patsy.readthedocs.io/en/latest/quickstart.html" rel="noopener ugc nofollow" target="_blank"> Patsy </a>使用的语法来构建模型方程。在下面的表达式中，我们说<em class="lr"> NUMBIDS </em>是因变量，RHS上的所有变量是回归的解释变量。</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="2706" class="ol mh jg oh b gy om on l oo op">expr = <strong class="oh jh">'NUMBIDS ~ LEGLREST + REALREST + FINREST + WHITEKNT + BIDPREM + INSTHOLD + SIZE + SIZESQ + REGULATN'</strong></span></pre><p id="03e5" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用Patsy，雕刻出<strong class="kx jh"> <em class="lr"> X </em> </strong>和<strong class="kx jh"> <em class="lr"> y </em> </strong>矩阵:</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="ad74" class="ol mh jg oh b gy om on l oo op">y_train, X_train = <strong class="oh jh">dmatrices</strong>(expr, df, return_type=<strong class="oh jh">'dataframe'</strong>)</span></pre><p id="6bc6" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在训练数据集上建立和拟合泊松回归模型:</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="0807" class="ol mh jg oh b gy om on l oo op">poisson_training_results = sm.<strong class="oh jh">GLM</strong>(y_train, X_train, <strong class="oh jh">family</strong>=sm.families.<strong class="oh jh">Poisson</strong>()).<strong class="oh jh">fit</strong>()</span></pre><p id="9e3d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">打印培训总结:</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="ba2b" class="ol mh jg oh b gy om on l oo op"><strong class="oh jh">print</strong>(poisson_training_results.<strong class="oh jh">summary</strong>())</span></pre><p id="50dc" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们得到以下输出:</p><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ph"><img src="../Images/b8533407d5f4aa7720618c1c972c8ef9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OB1DMn8AGIHEuFQPL6DzFg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">泊松模型训练总结(图片由<a class="ae jd" href="https://sachin-date.medium.com/" rel="noopener">作者</a>)</p></figure><p id="71b2" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">只有3个回归变量——white knt、SIZE和SIZESQ——在alpha值为0.05时具有统计显著性，这可以从它们的z值得到证明。</p><p id="55c2" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">顺便提一下，忽略statsmodels报告的Pearson chi2值。它是回归的皮尔逊残差之和。顺便说一下，这个和也是在零假设下的卡方分布，但这不是我们想要的。</p><p id="a1d6" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们想知道的是，通过增加回归变量，泊松回归模型是否能够解释<em class="lr"> NUMBIDS </em>中的一些方差，从而使模型预测与数据集的拟合度更好。</p><p id="a650" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在前面的部分中，我们已经证明了关于NUMBIDS的以下内容:</p><p id="0af9" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="lr"> Pr(NUMBIDS=k) </em>不服从<em class="lr">泊松(=1.73) </em></p><p id="08cd" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们现在想看看:</p><p id="af74" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="lr">Pr(NUMBIDS = k |</em><strong class="kx jh"><em class="lr">X</em></strong><em class="lr">= X)~泊松(|</em><strong class="kx jh"><em class="lr">X =</em></strong><em class="lr">X)</em></p><p id="3240" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="lr">即NUMBIDS泊松分布是否取决于回归变量的值？</em></p><p id="549c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们首先打印出泊松模型对训练数据集的预测。</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="785e" class="ol mh jg oh b gy om on l oo op"><strong class="oh jh">print</strong>(poisson_training_results.<strong class="oh jh">mu</strong>)</span></pre><p id="9082" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下是它们的样子:</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="dd5b" class="ol mh jg oh b gy om on l oo op">[2.72889817 1.30246609 2.15499739 1.1900047  1.21599906 2.09184785<br/> 1.82652758 1.06685393 0.79514164 1.14477171 0.99898271 1.92814556<br/> 2.20779028 1.43286411 1.73940628 0.90328133 2.27706959 1.87184259<br/> 1.54905093 0.93227952 0.93033507 1.51971811 2.08993763 3.19936595<br/> 1.89919831 1.59212915 1.52079672 1.00089633 2.00393774 1.1054032<br/> 1.57265323 1.76745435 2.00783088 1.61220849 1.83879678 4.41843589<br/> 1.04601311 1.31612754 1.6392279  1.37670449 1.06614718 1.66242252<br/> 2.34573342 2.04544149 0.883722   2.90131042 2.31600229 2.29251975<br/> 0.91892439 2.20332645 1.44903512 1.13939068 3.47003593 0.71567673<br/> 1.6650563  1.69170618 1.03992301 2.84548307 1.69812667 1.27352075<br/> 1.03938293 1.79108836 1.37244044 2.21050863 1.86560189 1.8648059<br/> 1.86403231 1.41217325 1.67946352 0.87193693 2.17762357 3.19137732<br/> 1.57576042 2.58713174 2.76491122 1.85562101 0.95351014 1.07514803<br/> 1.03481096 2.88297676 1.12614708 2.32323011 3.14995344 1.1434731<br/> 1.01097106 1.9373812  1.07089043 1.26067475 1.83816698 1.94861201<br/> 1.53542301 1.78289842 1.27713579 1.99077092 2.13675676 1.92808338<br/> 1.29938303 1.58595018 2.05336739 1.18530808 1.1440799  4.00075889<br/> 1.11596048 1.63979224 2.01608871 1.09786493 2.73455853 1.40900652<br/> 1.15158314 0.9380958  2.58107119 2.16988211 1.07493149 1.17958898<br/> 1.33171499 1.78776301 1.37353721 2.68417969 1.61699478 2.23254292<br/> 1.02306676 1.76736974 2.31367053 1.38449909 0.91364522 4.22397452]</span></pre><p id="2e72" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上述数组中的每个数字都是<em class="lr"> NUMBIDS </em>的期望值<em class="lr">取决于该行回归变量的相应值，即<strong class="kx jh"> <em class="lr"> X=x </em> </strong>。对应于<strong class="kx jh"> <em class="lr"> X </em> </strong>中的126行，共打印了126个期望值。于是，上面的数组给了我们<em class="lr">条件期望</em><strong class="kx jh"><em class="lr"/></strong><em class="lr">|</em><strong class="kx jh"><em class="lr">X</em></strong><em class="lr">的集合。</em></em></p><p id="f348" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们的任务是在给定训练模型生成的泊松率的期望值<em class="lr"> </em>的情况下，计算<em class="lr"> NUMBIDS </em>的每个观察值的预期概率(以及频率)。为此，我们将在训练集中取<em class="lr"> NUMBIDS </em>的每个观察值，并在给定<em class="lr"> </em>值数组中的每个预测比率<em class="lr"> </em>的情况下，计算观察该值的泊松概率。对于该<em class="lr"> NUMBIDS </em>值，我们将对所有这些预测概率进行平均，以获得在训练泊松模型下观察到该<em class="lr"> NUMBIDS </em>值的预测概率。</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="f611" class="ol mh jg oh b gy om on l oo op"><strong class="oh jh">def </strong>get_poisson_conditional_probability(row):<br/>    num_bids = int(row.name)<br/>    <strong class="oh jh">if </strong>num_bids &lt; 5:<br/>        <strong class="oh jh">return </strong>np.<strong class="oh jh">mean</strong>(poisson.<strong class="oh jh">pmf</strong>(<strong class="oh jh">k</strong>=num_bids, mu=poisson_training_results.<strong class="oh jh">mu</strong>))<br/>    <strong class="oh jh">else</strong>: #use the Survival Function for NUMBIDS &gt;=5<br/>        <strong class="oh jh">return </strong>np.<strong class="oh jh">mean</strong>(poisson.<strong class="oh jh">sf</strong>(<strong class="oh jh">k</strong>=num_bids, mu=poisson_training_results.<strong class="oh jh">mu</strong>))</span><span id="d88a" class="ol mh jg oh b gy pc on l oo op">grouped_df[<strong class="oh jh">'PM_NUMBIDS_POISSON_PMF'</strong>] = grouped_df.<strong class="oh jh">apply</strong>(<strong class="oh jh">get_poisson_conditional_probability</strong>, axis=1)</span><span id="c717" class="ol mh jg oh b gy pc on l oo op">grouped_df[<strong class="oh jh">'PM_NUMBIDS_POISSON_FREQ'</strong>] = grouped_df[<strong class="oh jh">'PM_NUMBIDS_POISSON_PMF'</strong>]*<strong class="oh jh">len</strong>(df)</span></pre><p id="bc19" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，我们已经在泊松回归模型下获得了<em class="lr"> NUMBIDS </em>的每个值的预期频率<em class="lr"> E_i </em>，让我们再次对观察频率和预期频率进行卡方拟合优度检验:</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="b3a9" class="ol mh jg oh b gy om on l oo op">stats.<strong class="oh jh">chisquare</strong>(<strong class="oh jh">f_obs</strong>=grouped_df[<strong class="oh jh">'NUMBIDS_OBS_FREQ'</strong>], f_exp=grouped_df[<strong class="oh jh">'PM_NUMBIDS_POISSON_FREQ'</strong>], <strong class="oh jh">ddof</strong>=reduced_degrees_of_freedom)</span></pre><p id="b646" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们看到以下输出:</p><pre class="ne nf ng nh gt og oh oi oj aw ok bi"><span id="d324" class="ol mh jg oh b gy om on l oo op">Power_divergenceResult(<strong class="oh jh">statistic</strong>=33.69923990742465, <strong class="oh jh">pvalue</strong>=nan)</span></pre><p id="4453" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们看到，使用泊松回归模型，我们的卡方统计值为33.69，比我们之前得到的值27.30还要大。p值也太低而无法打印(因此有nan)。泊松回归模型无法解释因变量<em class="lr"> NUMBIDS </em>的方差，其对泊松概率分布的拟合优度很差就是证明(这次以<strong class="kx jh"><em class="lr">X</em></strong>为条件)。<strong class="kx jh">因此，我们拒绝了该数据集的泊松回归模型。</strong></p><p id="61b6" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">或许另一种回归模型，如<a class="ae jd" rel="noopener" target="_blank" href="/negative-binomial-regression-f99031bb25b4">负二项式</a>或<a class="ae jd" rel="noopener" target="_blank" href="/generalized-poisson-regression-for-real-world-datasets-d1ff32607d79">广义泊松</a>模型，能够更好地解释我们之前提到的<em class="lr"> NUMBIDS </em>的过度分散，因此可能比泊松模型具有更好的拟合优度。</p><p id="4a9a" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下是完整的源代码:</p><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="pi pj l"/></div></figure></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><h1 id="ceb7" class="mg mh jg bd mi mj oa ml mm mn ob mp mq km oc kn ms kp od kq mu ks oe kt mw mx bi translated">参考文献、引文和版权</h1><h2 id="6541" class="ol mh jg bd mi or os dn mm ot ou dp mq le ov ow ms li ox oy mu lm oz pa mw pb bi translated">资料组</h2><p id="9665" class="pw-post-body-paragraph kv kw jg kx b ky my kh la lb mz kk ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">目标管理阻力导致的多重投标:一种计数数据方法。<em class="lr">Rev Quant Finan Acc</em><strong class="kx jh">3、</strong>447–457(1993)。<a class="ae jd" href="https://doi.org/10.1007/BF02409622" rel="noopener ugc nofollow" target="_blank">https://doi.org/10.1007/BF02409622</a>T20<strong class="kx jh">PDF下载链接</strong>T23】</p><h2 id="7511" class="ol mh jg bd mi or os dn mm ot ou dp mq le ov ow ms li ox oy mu lm oz pa mw pb bi translated">纸质和图书链接</h2><p id="4942" class="pw-post-body-paragraph kv kw jg kx b ky my kh la lb mz kk ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">Cameron A. Colin，Trivedi Pravin K .，<a class="ae jd" href="http://cameron.econ.ucdavis.edu/racd/count.html" rel="noopener ugc nofollow" target="_blank"> <em class="lr">计数数据回归分析</em> </a>，计量经济学会专论№30，剑桥大学出版社，1998年。国际标准书号:0521635675</p><p id="5148" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">McCullagh P .，Nelder John A .，<a class="ae jd" href="https://www.routledge.com/Generalized-Linear-Models/McCullagh-Nelder/p/book/9780412317606" rel="noopener ugc nofollow" target="_blank"> <em class="lr">广义线性模型</em> </a>，第二版。，CRC出版社，1989，ISBN 0412317605，9780412317606</p><h2 id="5691" class="ol mh jg bd mi or os dn mm ot ou dp mq le ov ow ms li ox oy mu lm oz pa mw pb bi translated">形象</h2><p id="77b0" class="pw-post-body-paragraph kv kw jg kx b ky my kh la lb mz kk ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">本文中的所有图片版权所有<a class="ae jd" href="https://www.linkedin.com/in/sachindate/" rel="noopener ugc nofollow" target="_blank"> Sachin Date </a>在<a class="ae jd" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener ugc nofollow" target="_blank"> CC-BY-NC-SA </a>下，除非图片下面提到了不同的来源和版权。</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><h1 id="072a" class="mg mh jg bd mi mj oa ml mm mn ob mp mq km oc kn ms kp od kq mu ks oe kt mw mx bi translated">相关文章</h1><div class="ip iq gp gr ir pk"><a rel="noopener follow" target="_blank" href="/an-illustrated-guide-to-the-poisson-regression-model-50cccba15958"><div class="pl ab fo"><div class="pm ab pn cl cj po"><h2 class="bd jh gy z fp pp fr fs pq fu fw jf bi translated">泊松回归模型图解指南</h2><div class="pr l"><h3 class="bd b gy z fp pp fr fs pq fu fw dk translated">和使用Python的泊松回归教程</h3></div><div class="ps l"><p class="bd b dl z fp pp fr fs pq fu fw dk translated">towardsdatascience.com</p></div></div><div class="pt l"><div class="pu l pv pw px pt py ix pk"/></div></div></a></div><div class="ip iq gp gr ir pk"><a rel="noopener follow" target="_blank" href="/negative-binomial-regression-f99031bb25b4"><div class="pl ab fo"><div class="pm ab pn cl cj po"><h2 class="bd jh gy z fp pp fr fs pq fu fw jf bi translated">负二项式回归:逐步指南</h2><div class="pr l"><h3 class="bd b gy z fp pp fr fs pq fu fw dk translated">外加一个关于负二项式回归的Python教程</h3></div><div class="ps l"><p class="bd b dl z fp pp fr fs pq fu fw dk translated">towardsdatascience.com</p></div></div><div class="pt l"><div class="pz l pv pw px pt py ix pk"/></div></div></a></div><div class="ip iq gp gr ir pk"><a rel="noopener follow" target="_blank" href="/generalized-poisson-regression-for-real-world-datasets-d1ff32607d79"><div class="pl ab fo"><div class="pm ab pn cl cj po"><h2 class="bd jh gy z fp pp fr fs pq fu fw jf bi translated">真实世界数据集的广义泊松回归</h2><div class="pr l"><h3 class="bd b gy z fp pp fr fs pq fu fw dk translated">以及用Python进行广义泊松回归的分步指南</h3></div><div class="ps l"><p class="bd b dl z fp pp fr fs pq fu fw dk translated">towardsdatascience.com</p></div></div><div class="pt l"><div class="qa l pv pw px pt py ix pk"/></div></div></a></div></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><p id="69dc" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="lr">感谢阅读！如果您喜欢这篇文章，请</em> <a class="ae jd" href="https://timeseriesreasoning.medium.com" rel="noopener"> <strong class="kx jh"> <em class="lr">关注我</em> </strong> </a> <em class="lr">获取关于回归和时间序列分析的技巧、操作方法和编程建议。</em></p></div></div>    
</body>
</html>