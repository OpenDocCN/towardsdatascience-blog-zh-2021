<html>
<head>
<title>How to Build a Digital Twin in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Python构建数字双胞胎</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-build-a-digital-twin-b31058fd5d3e?source=collection_archive---------3-----------------------#2021-07-13">https://towardsdatascience.com/how-to-build-a-digital-twin-b31058fd5d3e?source=collection_archive---------3-----------------------#2021-07-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="1a7e" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/thoughts-and-theory" rel="noopener" target="_blank">思想和理论</a></h2><div class=""/><div class=""><h2 id="7be8" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">锂离子电池数字孪生的Python实现</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/3afdc437b950fff7c4075d0afc1f6380.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jQpfFqi2N8vQUIpMtswItQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片由Pedro Figueras - Pexels提供。哈维尔·马林插图。</p></figure><p id="d94c" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在本教程中，我们将展示如何用Python创建一个简单而实用的数字孪生体。锂离子电池将是我们的有形资产。这个数字孪生将使我们能够分析和预测电池行为，它可以集成到任何虚拟资产管理工作流程中。</p><h1 id="5007" class="ma mb iq bd mc md me mf mg mh mi mj mk kf ml kg mm ki mn kj mo kl mp km mq mr bi translated">虚拟系统和数字双胞胎</h1><p id="1126" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi mx translated"><span class="l my mz na bm nb nc nd ne nf di"> D </span>数字双胞胎是工业4.0的重要组成部分。其基本原理是在虚拟世界中复制物理资产，以便对其动态进行建模。想象一下，我们在城市水管网的某个地方有一台水泵。水泵消耗能量，并以水流和压力的形式释放出来。术语“复制品”指的是能够模拟这种行为的虚拟对象的创建。</p><p id="08f4" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">该泵是整个水管网系统的一部分，还有管道、阀门、仪表和其他附件或子系统。这些子系统都是相互联系的。虚拟化系统需要对所有子系统进行同样的操作。之后，我们可以模拟整个系统，包括它的依赖关系。虚拟系统的目标是模拟现实世界，以便引入变更、评估性能或预测该资产或子系统所涉及的场景(例如维护任务)。</p><p id="a979" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">如前所述，数字孪生是代表一个子系统的虚拟对象。这个“双胞胎”应该和它的“物理双胞胎”一样对输入变量做出反应。这个虚拟对象必须集成一个模型才能做到这一点。数字双胞胎最重要的特征是一个可以在数字环境中模拟“物理”行为的模型。请记住，当我们说“物理”时，我们指的是任何真实世界的实体(可以是锂离子电池、水泵、人、城市或猫)。任何可以建模的东西都可以被虚拟化(图1)。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ng"><img src="../Images/4dc7efcd44a38607643f340f7443fd01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5RDgqIPt6BJEAHeTKmfuvA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated"><strong class="bd nh">图一。</strong>通过模型从物理世界到虚拟世界。图片作者。</p></figure><h1 id="f4de" class="ma mb iq bd mc md me mf mg mh mi mj mk kf ml kg mm ki mn kj mo kl mp km mq mr bi translated">ba 电池上锂-i <strong class="ak">的数字模型</strong></h1><p id="4bd9" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">可充电锂离子电池是一种尖端的电池技术，其电化学依赖于锂离子。除了便携式技术设备之外，这些电池对于电动汽车和配电网络中的能量存储等应用来说也是重要的资产。这些电池最关键的方面是它们的老化成本。经过反复充放电循环后，电池的电池会退化，导致充电容量减少。这种现象一直是开发更持久电池的关键研究领域。它的建模同样也是一个有争议的话题。电池退化对上述技术规划和操作具有重要影响。</p><p id="518e" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">电池寿命下降的物理过程相当复杂。近年来，人们提出了一些测量电池寿命损失的半经验锂离子电池退化模型(Chu et al .，2018；Laresgoiti等人，2015年)。报废电池通常被描述为只能提供其额定最大容量80%的电池。使用其中一个经验模型(Chu等人，2018年)，这种退化可以写成如下:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/1280d1203a30e37386037ed0fd802e68.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*KDd6gBDJxVlKJ0RblUXn7A.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated"><strong class="bd nh">方程式1。</strong>电池续航时间。</p></figure><p id="df1a" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">其中𝐿是电池寿命，<em class="nj"> </em>是初始电池寿命，<em class="nj"> d </em>是每单位时间和每循环的线性化退化率(Chu等人，2018)。该速率可以写成是<em class="nj">放电时间- </em> 𝑡、<em class="nj">放电循环深度-δ、</em>平均充电循环状态- <em class="nj"> σ </em>和电池温度-𝑇𝑐.的函数</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/af76e3bc2930c44755d215178f04fcfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/format:webp/1*9IQZ3LH0oHyuaj1_Un_p1A.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated"><strong class="bd nh">方程式2 </strong>。线性化降解速率。</p></figure><h1 id="218f" class="ma mb iq bd mc md me mf mg mh mi mj mk kf ml kg mm ki mn kj mo kl mp km mq mr bi translated">实验数据</h1><p id="bdc4" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">我们的模型必须根据我们掌握的信息来预测电池寿命。但是，我们希望将该模型与测量值进行比较，以确定我们的模型的准确性。让我们暂停一会儿。</p><blockquote class="nl"><p id="cc22" class="nm nn iq bd no np nq nr ns nt nu lz dk translated">许多数字双胞胎并不基于精确的物理模型，只使用实验数据集和机器学习算法。这是一种非常酷的做事方法。例如，他们可以使用深度神经网络建立一个模型来捕捉数据的真实动态。然而，为了获得可靠的通用模型，将该模型推广到其他对象需要处理大量样本。另一方面，当处理物理模型时，我们需要较少的数据来获得准确的通用模型。</p></blockquote><p id="bdfd" class="pw-post-body-paragraph le lf iq lg b lh nv ka lj lk nw kd lm ln nx lp lq lr ny lt lu lv nz lx ly lz ij bi translated">我们将利用锂离子电池充放电循环的真实数据来构建我们的数字双胞胎。我们将使用美国宇航局艾姆斯预测卓越中心(PCoE)提供的锂离子电池老化数据集。这个数据集对于确定我们的物理模型的准确性和改进它将是有价值的。我们将使用与5号电池相关的数据。我们将绘制出<em class="nj">“容量”</em>特征与循环次数的关系，并将其与我们的物理模型进行比较。在我们开始之前，我们将用变量𝐿( <em class="nj">电池寿命</em>代替<em class="nj"> C </em> ( <em class="nj">电池容量</em>)。等式1将被写成如下:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/8bd556789678f678efbed451f0ca97e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:358/format:webp/1*EvqXaAfd15ZxGYaLnEDS_A.png"/></div></figure><p id="1789" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">其中，𝐶是电池容量，𝐶_0是初始电池容量。对于𝑓𝑑，我们使用了以下近似值:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/47faac6d37062d73a9c08fa010805ce9.png" data-original-src="https://miro.medium.com/v2/resize:fit:326/format:webp/1*kC63dfLSRpY0RnY9ahKDNA.png"/></div></figure><p id="069b" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">其中，𝑖是充电-放电循环，𝑇𝑐是循环期间在电池中测量的温度，𝑡𝑖是放电时间，𝑘和经验常数的值为<em class="nj"> 0.13 </em>。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oc"><img src="../Images/139c422405a23c89bdab544bd53aa8fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QgDFlaD5PMuuHMcc-Zu_7A.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated"><strong class="bd nh">图二</strong>。实验数据与我们的半经验模型的比较。图片作者。</p></figure><p id="371e" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">图2展示了结果。我们的模型精确地预测了观察值(我们得到平均绝对误差——MAE为0.004)。该模型应该收集电池容量行为，其中容量在第一个循环期间缓慢降低，然后在特定点之后加速。这些变化是微妙的，许多工程师利用简单的线性模型来近似这种行为。我们的模型是半经验的，包括各种调整以避免处理PDEs ( <em class="nj">偏微分方程</em>)。</p><h1 id="9393" class="ma mb iq bd mc md me mf mg mh mi mj mk kf ml kg mm ki mn kj mo kl mp km mq mr bi translated">构建混合数字双胞胎</h1><p id="c919" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">我们可以用我们的“模型”来直接创建一个数字双胞胎。但是，为了应用机器学习，我们将使用它来改进我们的模型，使用来自NASA数据集的实验数据。我们的建议如图3所示。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi od"><img src="../Images/a4b284329e5bfb50198340683e4de71a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NT5Fufb3NX7fT8KGxqPHNw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated"><strong class="bd nh">图3。</strong>创造混合数字双胞胎。图片作者。</p></figure><p id="5568" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们正在使用实验数据改进我们的数学，并使用神经网络改进我们模型的输出。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="85b2" class="oj mb iq of b gy ok ol l om on"><strong class="of ja">#Define inputs and outputs</strong></span><span id="9cdf" class="oj mb iq of b gy oo ol l om on"><strong class="of ja"># input: the simulation capacity</strong><br/>X_in = (dfb['C. Capacity'])</span><span id="f71f" class="oj mb iq of b gy oo ol l om on"><strong class="of ja"># output: difference between experimental values and simulation<br/></strong>X_out = (dfb['Capacity']) - (dfb['C. Capacity'])  </span><span id="02ce" class="oj mb iq of b gy oo ol l om on">X_in_train, X_in_test, X_out_train, X_out_test = train_test_split(X_in, X_out, test_size=0.33)</span></pre><p id="9071" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们使用一个非常简单的神经网络:</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="eb11" class="oj mb iq of b gy ok ol l om on">model = Sequential()<br/>model.add(Dense(64, activation='relu', input_shape=(1,)))<br/>model.add(Dense(32, activation='relu'))<br/>model.add(Dense(1))</span></pre><p id="c1ee" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">编译:</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="7a49" class="oj mb iq of b gy ok ol l om on">epochs = 100<br/>loss = 'mse'<br/>model.compile(optimizer = SGD(learning_rate=0.001),          <br/>                          loss=loss,<br/>                          metrics=['mae'], <strong class="of ja">#Mean Absolute Error<br/></strong>)<br/>history = model.fit(X_in_train, <br/>                    X_out_train, <br/>                    shuffle=True, <br/>                    epochs=epochs, <br/>                    batch_size=20, <br/>                    validation_data=(X_in_test, X_out_test),<br/>                    verbose=1)</span></pre><p id="109c" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">比较的结果:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oc"><img src="../Images/d49f35a5a98f0d7bd0a87a47e5fc8982.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w1N4VDsickawVL2p1fGuXQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated"><strong class="bd nh">图4 </strong>。模型结果与实验结果的比较。图片作者。</p></figure><p id="3397" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">正如我们在图4中看到的，神经网络学习了我们的数学模型和实验结果之间的差异的基本理解。现在我们可以把这种学习加入到我们的数学模型中来改进它:</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="3a54" class="oj mb iq of b gy ok ol l om on"><strong class="of ja"># Our digital twin by improving our model with experimental data</strong><br/>X_twin = X_in + model.predict(X_in).reshape(-1)</span></pre><p id="aad1" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">仅此而已。我们有我们的数字双胞胎(或混合双胞胎):</p><ul class=""><li id="be17" class="op oq iq lg b lh li lk ll ln or lr os lv ot lz ou ov ow ox bi translated">我们创造了一个物理模型(或数学模型)</li><li id="a28d" class="op oq iq lg b lh oy lk oz ln pa lr pb lv pc lz ou ov ow ox bi translated">我们将我们的模型与实验数据进行了比较。</li><li id="2c20" class="op oq iq lg b lh oy lk oz ln pa lr pb lv pc lz ou ov ow ox bi translated">通过这种比较，我们能够改进我们的模型。</li></ul><p id="4966" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">最后，在我们的虚拟环境中，我们有一个这种电池的“双胞胎”,预计其性能与现实世界中的电池相似。接下来，我们将对比我们的数学模型和数字模型:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oc"><img src="../Images/02ccec7b1f4278d963fbdaf71e144c01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QYH8RZX8J75RzK9B_0R_uA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated"><strong class="bd nh">图5 </strong>:数学模型与“混合”数字孪生的最终比较。图片作者。</p></figure><p id="f91c" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">图5显示了我们的数字孪生兄弟如何适度地改进了我们的模型。混合数字孪生的好处是，它允许我们采用半经验的数学模型，并使用实验数据来完善它。它具有优于两者的优点，一个是特别的数学模型，因为它可以改进，另一个是ML模型，因为它更通用(因此可以应用于例如其他电池，获得比单独的ML模型更好的精度)。</p><p id="5ad3" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><strong class="lg ja">预测</strong></p><p id="e970" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">通过我们的数字孪生兄弟，我们可以做出预测，以便操作锂离子电池。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oc"><img src="../Images/6ce4024801fbb477c9ca10d24532098b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eaSiBePilqof28ItFehfhA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated"><strong class="bd nh">图六。</strong>使用数字双生子和数学模型进行预测。图片作者。</p></figure><h1 id="5b3d" class="ma mb iq bd mc md me mf mg mh mi mj mk kf ml kg mm ki mn kj mo kl mp km mq mr bi translated">结论</h1><p id="b13a" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">数字双胞胎是工业4.0领域的新兴话题。我们已经展示了如何使用Python制作一个最小的数字孪生。当我们有实验数据集时，我们可以展示“混合”数字双胞胎如何成为虚拟化资产的更现实的方式。此外，开发可靠的模型需要较少的数据。我们可以将更多未来的实验数据测量添加到我们的数字双胞胎中，以进一步改进我们的数学模型。</p></div><div class="ab cl pd pe hu pf" role="separator"><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi"/></div><div class="ij ik il im in"><h2 id="1318" class="oj mb iq bd mc pk pl dn mg pm pn dp mk ln po pp mm lr pq pr mo lv ps pt mq iw bi translated">图书馆</h2><p id="7786" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">我们使用<a class="ae pu" href="https://keras.io/" rel="noopener ugc nofollow" target="_blank"> Keras </a>库用于NN，使用<a class="ae pu" href="https://plotly.com/python/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>用于plots。</p><h2 id="f70e" class="oj mb iq bd mc pk pl dn mg pm pn dp mk ln po pp mm lr pq pr mo lv ps pt mq iw bi translated">感谢</h2><p id="64d3" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">致汉堡理工大学Merten Stender教授，<a class="ae pu" href="mailto:m.stender@tuhh.de" rel="noopener ugc nofollow" target="_blank"> m.stender@tuhh.de </a>及其作品Digital twin for structural dynamics applications(<a class="ae pu" href="https://github.com/mertstend/DigitalTwin_Tutorial" rel="noopener ugc nofollow" target="_blank">此处</a>)。</p><h2 id="ec33" class="oj mb iq bd mc pk pl dn mg pm pn dp mk ln po pp mm lr pq pr mo lv ps pt mq iw bi translated">代码和数据</h2><p id="9a85" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">您可以在<a class="ae pu" href="https://github.com/Javihaus/Digital-Twin-in-python" rel="noopener ugc nofollow" target="_blank"> repo </a>中找到该代码，并在此处找到数据<a class="ae pu" href="https://data.nasa.gov/dataset/Li-ion-Battery-Aging-Datasets/uj5r-zjdb" rel="noopener ugc nofollow" target="_blank">(锂离子电池老化数据集)</a>。</p></div><div class="ab cl pd pe hu pf" role="separator"><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi"/></div><div class="ij ik il im in"><h1 id="e519" class="ma mb iq bd mc md pv mf mg mh pw mj mk kf px kg mm ki py kj mo kl pz km mq mr bi translated">引文</h1><ul class=""><li id="5a08" class="op oq iq lg b lh ms lk mt ln qa lr qb lv qc lz ou ov ow ox bi translated">B.徐、a .乌达洛夫、a .乌尔比格、g .安德森和D. S .克尔申。(2018).用于电池寿命评估的锂离子电池退化建模。IEEE智能电网汇刊第9卷第2期第1131-1140页。doi: 10.1109/TSG.2016.2578950。</li><li id="1918" class="op oq iq lg b lh oy lk oz ln pa lr pb lv pc lz ou ov ow ox bi translated">I .拉雷斯戈伊蒂、s .卡比茨、m .埃克和D. U .绍尔。(2015).模拟锂离子电池在循环过程中的机械退化:固体电解质相间断裂。能源杂志，第300卷，第112-122页。</li></ul></div></div>    
</body>
</html>