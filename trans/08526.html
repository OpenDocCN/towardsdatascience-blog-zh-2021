<html>
<head>
<title>Take your SQL from Good to Great: Part 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让您的SQL从优秀走向卓越:第5部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/take-your-sql-from-good-to-great-part-5-7c996dbcc527?source=collection_archive---------15-----------------------#2021-08-06">https://towardsdatascience.com/take-your-sql-from-good-to-great-part-5-7c996dbcc527?source=collection_archive---------15-----------------------#2021-08-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="cf3c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">UDF能为你做什么？</h2></div><h1 id="e4dc" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">介绍</h1><p id="9d7a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我知道我说过这是一个4部分系列，但谁不喜欢奖金内容？这个版本是关于用户定义函数(UDF)的。</p><p id="2dc1" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">使用以下链接查看该系列的早期版本:</p><ul class=""><li id="899d" class="ly lz iq kz b la lt ld lu lg ma lk mb lo mc ls md me mf mg bi translated">第一部分:<a class="ae mh" rel="noopener" target="_blank" href="/take-your-sql-from-good-to-great-part-1-3ae61539e92a">常用表表达式</a></li><li id="cd18" class="ly lz iq kz b la mi ld mj lg mk lk ml lo mm ls md me mf mg bi translated">第二部分:<a class="ae mh" rel="noopener" target="_blank" href="/take-your-sql-from-good-to-great-part-2-cb03b1b7981b">关于那些日子的一切</a></li><li id="dda1" class="ly lz iq kz b la mi ld mj lg mk lk ml lo mm ls md me mf mg bi translated">第三部分:<a class="ae mh" rel="noopener" target="_blank" href="/take-your-sql-from-good-to-great-part-3-687d797d1ede">其他加入</a></li><li id="857e" class="ly lz iq kz b la mi ld mj lg mk lk ml lo mm ls md me mf mg bi translated">第四部分:<a class="ae mh" rel="noopener" target="_blank" href="/take-your-sql-from-good-to-great-part-4-99a55fd0e7ff">窗口功能</a></li></ul><h1 id="c62f" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">用户定义的函数</h1><p id="66d3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">UDF(<a class="ae mh" href="https://en.wikipedia.org/wiki/User-defined_function" rel="noopener ugc nofollow" target="_blank">用户定义函数</a>)是在SQL中创建定制函数的一种方式。</p><p id="2a90" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">例如，如果我想找到一个数字的立方，我可以在查询中执行以下操作:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="e9e9" class="mw kg iq ms b gy mx my l mz na">--bigquery syntax<br/>SELECT power(&lt;COLUMN&gt;,3) as cubed<br/>FROM &lt;TABLE&gt;</span></pre><p id="8c78" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">但是如果我想创建一个函数来立方任何我可以使用的数字，而不是幂，我可以创建一个名为<strong class="kz ir">的立方:</strong></p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="56d0" class="mw kg iq ms b gy mx my l mz na">--bigquery syntax<br/>CREATE OR REPLACE FUNCTION<br/>   &lt;DATASET&gt;.cubed(x FLOAT64)<br/>   RETURNS FLOAT64 AS ( POWER(x,3) );</span></pre><p id="a595" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">然后，每当我想立方体的东西，我可以调用我们的新功能:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="ba28" class="mw kg iq ms b gy mx my l mz na">SELECT<br/>   &lt;DATASET&gt;.cubed(3),<br/>   &lt;DATASET&gt;.cubed(2.2)</span><span id="15a6" class="mw kg iq ms b gy nb my l mz na">-- 27.0 , 10.648000000000003</span></pre><p id="2211" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">重要的是，现在任何对我的数据库有查询权限的人也可以使用这个新功能。</p><h2 id="f9e4" class="mw kg iq bd kh nc nd dn kl ne nf dp kp lg ng nh kr lk ni nj kt lo nk nl kv nm bi translated">UDFs 101</h2><p id="4327" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">UDF的实现在您使用的每个数据库中都有所不同(有趣！)，所以在使用它们之前，一定要检查您自己的DB文档。但是它们都有一些共同点:</p><ul class=""><li id="d92f" class="ly lz iq kz b la lt ld lu lg ma lk mb lo mc ls md me mf mg bi translated">UDF可以接受输入参数(比如“x”的立方)</li><li id="e64a" class="ly lz iq kz b la mi ld mj lg mk lk ml lo mm ls md me mf mg bi translated">必须输出一个值(任何类型)</li><li id="1be7" class="ly lz iq kz b la mi ld mj lg mk lk ml lo mm ls md me mf mg bi translated">通常不能引用其他的UDF(但是再次检查你的数据库)</li><li id="7d39" class="ly lz iq kz b la mi ld mj lg mk lk ml lo mm ls md me mf mg bi translated">可以是本地的，只存在于当前查询中</li><li id="cbc2" class="ly lz iq kz b la mi ld mj lg mk lk ml lo mm ls md me mf mg bi translated">或者跨模式或数据库共享和存在</li><li id="5213" class="ly lz iq kz b la mi ld mj lg mk lk ml lo mm ls md me mf mg bi translated">通常可以使用SQL之外的其他语言(例如Python、JavaScript、Java)创建，但是请再次检查您的数据库以了解详细信息</li></ul><figure class="mn mo mp mq gt no gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi nn"><img src="../Images/8cf212e35a6db36975a7df9210b20627.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PKm7bDbqkVL9WbXV5C4lcA.png"/></div></div><p class="nv nw gj gh gi nx ny bd b be z dk translated">数据库概念总结。图片作者。</p></figure><h1 id="60d0" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">处于最佳状态</h1><p id="ad7a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">UDF的功能让我们看到了SQL是多么接近于一种“合适的”编码语言。</p><figure class="mn mo mp mq gt no gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi nz"><img src="../Images/dc84b51666eea5a8c822579a80345ebe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kRHBI_gLOtKrV9q3YnwtvQ.png"/></div></div><p class="nv nw gj gh gi nx ny bd b be z dk translated">图片作者。(信不信由你，这个灵感来自这个<a class="ae mh" href="https://www.youtube.com/watch?v=FFroMQlKiag" rel="noopener ugc nofollow" target="_blank">宝石</a></p></figure><p id="53a6" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">Python或R最受欢迎的特性之一是能够通过使用函数来模块化代码以便重用。像pypi、tidyverse和npm这样的平台更进一步，让用户在团队之外和整个用户社区共享这些功能。</p><p id="3223" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">今天，大多数SQL都是作为独立的脚本编写的，但是UDF便于在脚本之间共享逻辑，模拟其他“真正的”编程语言的模块系统。</p><p id="4ca4" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">更重要的是，UDF给了我们一个框架，让SQL更好地为我们和我们周围的人服务。我们可以使用UDF来:</p><h2 id="5672" class="mw kg iq bd kh nc nd dn kl ne nf dp kp lg ng nh kr lk ni nj kt lo nk nl kv nm bi translated">简化不常使用SQL的用户的常见操作</h2><p id="619a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">假设销售团队经常每季度查看一次数据，但是很难获得正确格式的数据。为了提供帮助，我可以创建一个函数，将任意日期(<em class="oa">2020–01–02</em>)转换为四分之一(<em class="oa">Q1–2020</em>)，这样他们就不会与<a class="ae mh" rel="noopener" target="_blank" href="/take-your-sql-from-good-to-great-part-2-cb03b1b7981b">迂腐的日期格式化函数</a>发生冲突，可以继续进行分析。</p><h2 id="d492" class="mw kg iq bd kh nc nd dn kl ne nf dp kp lg ng nh kr lk ni nj kt lo nk nl kv nm bi translated">做一些在SQL中不可能的事情</h2><p id="24a9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">因为您可以使用其他语言来创建UDF，所以您有能力为SQL注入它没有的功能。例如，您可以使用JavaScript NLP库创建一个函数来查找两个单词之间的Levenshtein距离(链接),让您更容易地对文本列进行模糊连接，这在SQL中是众所周知的困难。</p><h1 id="f9f5" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">在最坏的情况下</h1><p id="4a22" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">但我们并非都生活在UDF乌托邦中，这是有原因的。尽管UDF<em class="oa">可能</em>很棒，但它们的缺点经常让我们怀疑它们是否值得我们去费心。</p><p id="0c1d" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">特别是:</p><h2 id="f94e" class="mw kg iq bd kh nc nd dn kl ne nf dp kp lg ng nh kr lk ni nj kt lo nk nl kv nm bi translated">UDF是孤立的🏝</h2><p id="014d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">UDF通常需要管理员权限来创建和维护，这意味着只有某些用户能够看到它们是如何定义的。但是任何用户都可以使用这些相同的功能，这意味着许多人会盲目地使用他们看不到的功能。</p><p id="c33b" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">它们的定制性质也意味着，对于那些在这些功能中挣扎的人来说，没有任何帮助。我的销售团队无法使用谷歌来查看他们为什么会在我创建的季度函数上出错，因为我是唯一知道它如何工作的人。</p><h2 id="9a3c" class="mw kg iq bd kh nc nd dn kl ne nf dp kp lg ng nh kr lk ni nj kt lo nk nl kv nm bi translated">UDF很难理解🤔</h2><p id="7751" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">此外，如果我使用SQL之外的东西(例如JavaScript)构建了一个UDF，我<em class="oa">真的</em>不能和很多人分享。如果它突然停止工作，而我又不在身边，我不确定我的数据团队能否修复它。正如一位睿智的大叔曾经说过的那样:“权力越大，责任越大。”</p><p id="13c9" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">结合起来，这两个缺点威胁到我们使用SQL的基本原因之一:<strong class="kz ir">它是一种低级查询语言</strong>。这意味着虽然它很冗长，但它是相当标准化的。我不用担心有人用不知道函数和方法的奇库；每个人都在使用相同的标准SQL函数和语法。</p><p id="ada4" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">这就是我们的权衡。我们如何使用UDF来帮助我们和我们周围的人更好地使用SQL，而不破坏它作为一种普遍理解的语言的优势？</p><h1 id="172e" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">我最喜欢的UDF</h1><p id="8d40" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">鉴于这种权衡，我喜欢将UDF仅用于两件事:</p><ol class=""><li id="9ca4" class="ly lz iq kz b la lt ld lu lg ma lk mb lo mc ls ob me mf mg bi translated">不需要真正解释的超级简单的事物(如中位数)</li><li id="177a" class="ly lz iq kz b la mi ld mj lg mk lk ml lo mm ls ob me mf mg bi translated">超级先进的东西，只会被少数人使用，我确信这些人了解它们是如何工作的</li></ol><p id="e84d" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">⚠️:我建议不要将UDF用于任何类似业务逻辑的东西(例如，以某种方式计算收入的函数)。对于这样的事情，最好能够向用户展示你做了什么，并解释为什么，因为这是理解结果的基础。</p><h2 id="3b6d" class="mw kg iq bd kh nc nd dn kl ne nf dp kp lg ng nh kr lk ni nj kt lo nk nl kv nm bi translated">我最喜欢的UDF</h2><p id="5579" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">中位数</strong></p><p id="a5a8" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated"><em class="oa">来源:</em><a class="ae mh" href="https://github.com/GoogleCloudPlatform/bigquery-utils/blob/master/udfs/community/median.sql" rel="noopener ugc nofollow" target="_blank"><em class="oa">big query-utils</em></a></p><p id="2afa" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">BigQuery(以及其他)没有针对MEDIAN的原生函数，而是依赖于PERCENTILE_CONT窗口函数。这很好，但是我发现它(1)很烦人，并且(2)很难向初级用户解释，因为它需要理解窗口功能。</p><p id="d1dc" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">为BigQuery编写的这个代码片段计算一列的中值:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="0136" class="mw kg iq ms b gy mx my l mz na"><strong class="ms ir">CREATE</strong> <strong class="ms ir">OR</strong> REPLACE <strong class="ms ir">FUNCTION</strong> &lt;DATASET&gt;.median(arr <strong class="ms ir">ANY</strong> TYPE) <strong class="ms ir">AS</strong> ((      <strong class="ms ir">SELECT</strong> IF (<br/>     MOD(ARRAY_LENGTH(arr), 2) = 0,     (arr[<strong class="ms ir">OFFSET</strong>(DIV(ARRAY_LENGTH(arr), 2) - 1)] + arr[<strong class="ms ir">OFFSET</strong>(DIV(ARRAY_LENGTH(arr), 2))]) / 2,     arr[<strong class="ms ir">OFFSET</strong>(DIV(ARRAY_LENGTH(arr), 2))]<br/>   )<br/>  <strong class="ms ir">FROM<br/></strong>  (<strong class="ms ir">SELECT</strong> ARRAY_AGG(x <strong class="ms ir">ORDER</strong> <strong class="ms ir">BY</strong> x) <strong class="ms ir">AS</strong> arr <strong class="ms ir">FROM</strong> UNNEST(arr) <strong class="ms ir">AS</strong> x)<br/> ));</span></pre><figure class="mn mo mp mq gt no gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi oc"><img src="../Images/71469c723277dfc5c26468457cbdff0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MXYsvGl0d8d81BukPmjUIw.png"/></div></div><p class="nv nw gj gh gi nx ny bd b be z dk translated">用UDF中值绘制盒须图。(<a class="ae mh" href="https://count.co/n/RHmVhHzZpIp?b=7WKfS1XCzmf" rel="noopener ugc nofollow" target="_blank">链接</a>)</p></figure><p id="eb17" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated"><strong class="kz ir">工作日</strong></p><p id="5bb1" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated"><em class="oa">来源:</em> <a class="ae mh" href="https://sql-snippets.count.co/t/udf-weekday/227" rel="noopener ugc nofollow" target="_blank"> <em class="oa"> SQL片段</em> </a></p><p id="eee4" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">这无疑属于“在SQL中要做的简单但烦人的事情”一类。一些方言有办法获得实际的星期名称，但在许多情况下，我不得不一次又一次地做这个可爱的case语句。所以现在可以是一个叫做<strong class="kz ir"> weekday </strong>的函数。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="bdc8" class="mw kg iq ms b gy mx my l mz na"><strong class="ms ir">CREATE</strong> <strong class="ms ir">OR</strong> REPLACE <strong class="ms ir">FUNCTION</strong> &lt;DATASET&gt;.weekday(dt DATE) <strong class="ms ir">RETURNS</strong> STRING <strong class="ms ir">AS</strong> (<br/>     <strong class="ms ir">case when</strong> extract(DAYOFWEEK <strong class="ms ir">from</strong> dt) = 1 <strong class="ms ir">then</strong> 'Sunday'<br/>     <strong class="ms ir">when</strong> extract(DAYOFWEEK <strong class="ms ir">from</strong> dt) = 2 <strong class="ms ir">then</strong> 'Monday'<br/>     <strong class="ms ir">when</strong> extract(DAYOFWEEK <strong class="ms ir">from</strong> dt) = 3 <strong class="ms ir">then</strong> 'Tuesday'<br/>     <strong class="ms ir">when</strong> extract(DAYOFWEEK <strong class="ms ir">from</strong> dt) = 4 <strong class="ms ir">then</strong> 'Wednesday'<br/>     <strong class="ms ir">when</strong> extract(DAYOFWEEK <strong class="ms ir">from</strong> dt) = 5 <strong class="ms ir">then</strong> 'Thursday'<br/>     <strong class="ms ir">when</strong> extract(DAYOFWEEK <strong class="ms ir">from</strong> dt) = 6 <strong class="ms ir">then</strong> 'Friday'<br/>     <strong class="ms ir">when</strong> extract(DAYOFWEEK <strong class="ms ir">from</strong> dt) = 7 <strong class="ms ir">then</strong> 'Saturday'<br/> <strong class="ms ir">end<br/></strong>  );</span></pre><figure class="mn mo mp mq gt no gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi od"><img src="../Images/ec1dbe7e25cbbdec6293724ce3e3e97c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-yjcXsK2kDXbY4P36FUwAQ.png"/></div></div><p class="nv nw gj gh gi nx ny bd b be z dk translated">有了这个UDF，你可以更容易地做一周中的一天的分析。(<a class="ae mh" href="https://count.co/n/Q4ewytTDHBk" rel="noopener ugc nofollow" target="_blank">链接</a>)</p></figure><p id="b371" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated"><strong class="kz ir"> Levenshtein距离</strong></p><p id="9d9b" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated"><em class="oa">来源:</em> <a class="ae mh" href="https://hoffa.medium.com/new-in-bigquery-persistent-udfs-c9ea4100fd83" rel="noopener"> <em class="oa">费利佩·霍法</em> </a></p><p id="981c" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated"><a class="ae mh" href="https://en.wikipedia.org/wiki/Levenshtein_distance" rel="noopener ugc nofollow" target="_blank"> Levenshtein distance </a>通过将一个字符串改变为另一个字符串所需的改变来测量两个字符串之间的“距离”,因此这是一种很有帮助的方法，可以找到除了拼写错误或其他轻微差异之外匹配的单词。</p><p id="0547" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">从技术上来说，这在不使用JavaScript库的情况下用SQL实现是可能的，但这要容易得多</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="cd3c" class="mw kg iq ms b gy mx my l mz na">CREATE OR REPLACE FUNCTION fhoffa.x.levenshtein(a string, b string)<br/>RETURNS INT64<br/>LANGUAGE js AS """<br/>  return fuzzball.distance(a,b);<br/>"""<br/>OPTIONS (library="gs://fh-bigquery/js/fuzzball.umd.min.js");</span></pre><figure class="mn mo mp mq gt no gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi oe"><img src="../Images/4f0f625df607a8af75f6d6e4d9fd34d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DPm_FAvEuy26n_E79_Zk_A.png"/></div></div><p class="nv nw gj gh gi nx ny bd b be z dk translated">使用Levenshtein距离解释用户拼写错误。(<a class="ae mh" href="https://count.co/n/Q4ewytTDHBk?vm=e" rel="noopener ugc nofollow" target="_blank">链接</a>)</p></figure><h1 id="2200" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">UDF的未来角色</h1><p id="9edb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">最近一直在想UDF会在SQL的进化中扮演什么角色。我们对能够轻松重用SQL的渴望变得越来越强烈，这也是我从分析师那里听到的最频繁的请求之一。</p><figure class="mn mo mp mq gt no gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi of"><img src="../Images/68046e2b061a11f5643a54f9a317ad38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iircf1CLAfOo2J9lmPtbTA.png"/></div></div><p class="nv nw gj gh gi nx ny bd b be z dk translated">SQL如何继续进化？图片作者。</p></figure><p id="776e" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">不难想象，UDF是推动SQL走出本地极限并进入新时代的解决方案的一部分——在这个新时代，我们SQL用户可以共同构建强大的代码模块，供所有人分发和共享。</p><p id="976f" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">为了推动这项工作，我们启动了这个<a class="ae mh" href="https://sql-snippets.count.co/" rel="noopener ugc nofollow" target="_blank"> SQL片段集合</a>。在这里，SQL用户可以通过在您公司的数据库之外创建、共享和改进UDF并进入更大的社区，开始朝着开源解决方案努力。</p><h1 id="be25" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">在哪里可以找到更多的UDF👀</h1><ul class=""><li id="c011" class="ly lz iq kz b la lb ld le lg og lk oh lo oi ls md me mf mg bi translated">BigQuery: <a class="ae mh" href="https://github.com/GoogleCloudPlatform/bigquery-utils/blob/master/udfs/community/median.sql" rel="noopener ugc nofollow" target="_blank"> bigquery-utils </a></li><li id="a8ab" class="ly lz iq kz b la mi ld mj lg mk lk ml lo mm ls md me mf mg bi translated">大查询:<a class="ae mh" href="https://hoffa.medium.com/new-in-bigquery-persistent-udfs-c9ea4100fd83" rel="noopener">菲利浦·霍法的公共大查询UDF</a></li><li id="9846" class="ly lz iq kz b la mi ld mj lg mk lk ml lo mm ls md me mf mg bi translated">MySQL: <a class="ae mh" href="https://github.com/mysqludf" rel="noopener ugc nofollow" target="_blank"> mysqludf </a></li><li id="34cb" class="ly lz iq kz b la mi ld mj lg mk lk ml lo mm ls md me mf mg bi translated"><a class="ae mh" href="https://twitter.com/SqlSnippets" rel="noopener ugc nofollow" target="_blank">每日SQL片段twitter feed </a></li></ul><p id="370e" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated"><em class="oa">知道更多UDF的来源？请在评论中告诉我！</em></p></div></div>    
</body>
</html>