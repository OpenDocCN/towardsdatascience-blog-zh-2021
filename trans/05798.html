<html>
<head>
<title>Develop and test Google Cloud Functions locally and deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在本地开发和测试谷歌云功能并进行部署</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/develop-and-test-google-cloud-functions-locally-and-deploy-7908d6573f9d?source=collection_archive---------14-----------------------#2021-05-24">https://towardsdatascience.com/develop-and-test-google-cloud-functions-locally-and-deploy-7908d6573f9d?source=collection_archive---------14-----------------------#2021-05-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="881c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">管理、开发和部署Google云功能的简单设置和模板</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5ad528b27a2318f553664d2d729e3844.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Anew6__sCLjQCqB7sZQXrg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@skyestudios" rel="noopener ugc nofollow" target="_blank">天空工作室</a>在<a class="ae kv" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="3810" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我想在这里描述一下我和我的队友<a class="ls lt ep" href="https://medium.com/u/a322d824778c?source=post_page-----7908d6573f9d--------------------------------" rel="noopener" target="_blank"> Crosi </a>是如何找到一种方法，让我们在本地开发谷歌云功能，然后使用谷歌构建服务以自动化的方式部署它们。我们已经阅读了无数的文献，现在想在这里整理我们的发现。</p><p id="1a79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">目前，我们正致力于建立一个数据湖。我们当时试图找到一种方法，让我们能够开发谷歌云功能，处理来自谷歌云存储的文件。Google允许在Google代码编辑器的web界面上编写云函数。然而，它缺少像PyCharm这样的普通IDE那样的琐碎功能。<em class="lu">无代码完成。没有警告。部署前没有本地测试/执行。我们想要面对这些问题。</em></p><h2 id="2e16" class="lv lw iq bd lx ly lz dn ma mb mc dp md lf me mf mg lj mh mi mj ln mk ml mm mn bi translated">先决条件</h2><p id="dbc2" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">你的电脑应该安装了Google Cloud SDK和git。我假设你对<a class="ae kv" href="https://cloud.google.com/functions/docs/how-to" rel="noopener ugc nofollow" target="_blank">谷歌云功能</a>有基本的了解。</p><p id="fea0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我想介绍以下工作流程，并指导您如何建立它。在克隆了我们的模板库之后，你可以在每个新的分支上创建你自己的云函数。每个分支代表一个云函数。之前可以在本地测试或者运行这个云功能。一旦开发完成，使用Google Cloud Build服务将这个云功能部署到Google Cloud Function服务中。可以说，您的开发与所提供的功能直接相关。未来对云功能分支的每一次推动都会导致云功能的自动重新部署。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/79e0b2b65e8aa0e72c12b1ff45a43b42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6QKFD-x0CVqN1tCJrZeHeA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">目标开发工作流程。您的回购中的每个分支都是一个特定的云功能，将使用云构建进行部署。</p></figure><h1 id="e968" class="mu lw iq bd lx mv mw mx ma my mz na md jw nb jx mg jz nc ka mj kc nd kd mm ne bi translated">步伐</h1><h2 id="0044" class="lv lw iq bd lx ly lz dn ma mb mc dp md lf me mf mg lj mh mi mj ln mk ml mm mn bi translated">可选:设置本地GCP开发的自动身份验证</h2><p id="77c9" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">如果您<strong class="ky ir"> <em class="lu">没有</em> </strong>为本地开发生成密钥文件，请执行以下步骤。</p><ol class=""><li id="426b" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr nk nl nm nn bi translated">打开你的命令行。</li><li id="7b83" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">用<em class="lu"> gcloud </em> : <code class="fe nt nu nv nw b">gcloud config set project your-project-name</code>切换到当前项目</li><li id="00d4" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">用<em class="lu"> gcloud </em>允许本地开发并生成一个密钥文件:<code class="fe nt nu nv nw b">gcloud auth application-default login</code></li><li id="4366" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">弹出一个窗口。确认一切。<em class="lu"> gcloud </em>现在生成一个JSON格式的密钥文件，我们的应用程序通过这个文件自动验证自己的GCP。所以<strong class="ky ir">代码中不需要指定</strong>凭证！</li></ol><h2 id="04f3" class="lv lw iq bd lx ly lz dn ma mb mc dp md lf me mf mg lj mh mi mj ln mk ml mm mn bi translated">使用我们的回购作为模板</h2><div class="nx ny gp gr nz oa"><a href="https://github.com/raki2305/gcp_cloudfunction_dev" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">gcp _云函数_开发</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">这个资源库展示了如何在本地自动开发谷歌云平台(GCP)的云功能…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">github.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo kp oa"/></div></div></a></div><ol class=""><li id="a654" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr nk nl nm nn bi translated">克隆我们的<a class="ae kv" href="https://github.com/raki2305/gcp_cloudfunction_dev" rel="noopener ugc nofollow" target="_blank">库</a>并在<a class="ae kv" href="https://source.cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> Google云资源库</a>上设置它</li><li id="6b9f" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">克隆您刚刚创建的<em class="lu">云存储库</em>。</li></ol><p id="c965" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在用<code class="fe nt nu nv nw b">git branch your-function-name</code>和checkout为每个未来的云功能创建一个单独的分支。</p><p id="7c53" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<em class="lu"> src/ </em>下，你会发现一个<em class="lu"> main.py </em>文件和一个<em class="lu"> requirements.txt </em>:</p><ul class=""><li id="cfde" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr op nl nm nn bi translated"><em class="lu"> main.py </em>包含了你未来的云功能。</li><li id="c307" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr op nl nm nn bi translated">开发完云功能后，在<em class="lu"> requirements.txt </em>中指定所有使用的包。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/f8eaede8bc4e1e142bc46ac96999acc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RLklVUjqf1i_b0EDHWmVOQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd or">这是main.py，你可以单独编辑。</strong></p></figure><p id="33d0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<em class="lu"> utils/，</em>下你会找到一个<em class="lu"> main_local.py </em>。您可以使用该文件来模拟触发器。请注意文件中的注释。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/2387e0ad8a0c2b2047aa33d25a6ce27a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qg2hhTwf_sr78hxKzH2KFQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">这是main_local.py，用于通过执行这个脚本来模拟触发器。</p></figure><p id="cb81" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<em class="lu"> config/，</em>下，你会发现一个<em class="lu"> cloudbuild.yaml </em>文件，它使用<a class="ae kv" href="https://console.cloud.google.com/cloud-build" rel="noopener ugc nofollow" target="_blank"> Google Cloud Build </a>服务自动部署云功能。替换相应的占位符。请注意文件中的注释。你的云函数开发完成后，就可以直接推送到你的git了。</p><h2 id="25f2" class="lv lw iq bd lx ly lz dn ma mb mc dp md lf me mf mg lj mh mi mj ln mk ml mm mn bi translated">使用云构建服务进行部署</h2><p id="117b" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">云构建用于设置CI/CD管道。在左侧的<a class="ae kv" href="https://console.cloud.google.com/cloud-build" rel="noopener ugc nofollow" target="_blank"> Google Cloud Build </a>服务中，单击“触发器”,然后单击“创建触发器”。</p><p id="dbe5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请相应地填写所有内容:</p><ul class=""><li id="8035" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr op nl nm nn bi translated">在<em class="lu">节事件</em>中，请选择“推送至分支”。</li><li id="80a9" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr op nl nm nn bi translated">在<em class="lu">部分，来源</em>请参考你的云储存库和包含你的云功能的分支。</li></ul><p id="b0b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在截面配置中:</p><ul class=""><li id="0518" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr op nl nm nn bi translated">Type = "云构建配置文件(yaml或json)"</li><li id="0157" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr op nl nm nn bi translated">location =/config/cloud build . YAML</li></ul><p id="c373" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后点击“创建”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/d4ca7561becf5c82bc06c74360f4bd94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1MCOOurKlUq5HbLFndCfcw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">下面是一个创建的触发器的例子，您也可以通过单击“运行”来手动运行它。</p></figure><p id="b492" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong>每次推送至指定分支，云功能自动部署。</p><h1 id="8f8f" class="mu lw iq bd lx mv mw mx ma my mz na md jw nb jx mg jz nc ka mj kc nd kd mm ne bi translated">结论</h1><p id="7ebf" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">现在你可以为每个云函数创建一个新的分支。在这个分支中，您可以开发与其他云功能相隔离的云功能。通过<em class="lu"> main_local.py </em>你可以在之前执行它。通过push命令上传的云功能的每次更新都会重新部署云功能。</p><p id="f97f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如有疑问，欢迎留言评论。</p></div></div>    
</body>
</html>