<html>
<head>
<title>Power BI — How to Fit 200 Million Rows in Less than 1GB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Power BI —如何在不到1GB的空间内容纳2亿行数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/power-bi-how-to-fit-200-million-rows-in-less-than-1gb-63ab5a4eb1c0?source=collection_archive---------2-----------------------#2021-07-14">https://towardsdatascience.com/power-bi-how-to-fit-200-million-rows-in-less-than-1gb-63ab5a4eb1c0?source=collection_archive---------2-----------------------#2021-07-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0be9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">非同寻常的任务需要非同寻常的解决方案。了解如何在18 MB Power BI中封装2亿行数据。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/42f3c3c193684bc8383e4dc1ba3b2738.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5_3x6fZ4xE-vMzb4m9Dnpg.jpeg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated"><a class="ae ku" href="https://unsplash.com/photos/uu-Jw5SunYI" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/uu-Jw5SunYI</a></p></figure><p id="12ed" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">当你与技术打交道时，有时你需要接受这样一个事实，即存在某些限制，尤其是在涉及可用资源时。有时，业务需求很难或几乎不可能在当前的环境下实现。</p><p id="ff71" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我最近面临一个相当具有挑战性的任务——将SSAS多维解决方案移植到Power BI。“问题”是客户机有一个Pro许可证(这意味着1 GB的模型大小限制)，事实表中大约有2亿行(并且还在不断增长)！</p><p id="bf9e" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我一看就知道，无论表有多窄多优化，都不可能在1 GB以下容纳2亿行！我已经写了关于数据模型大小优化的<a class="ae ku" rel="noopener" target="_blank" href="/how-to-reduce-your-power-bi-model-size-by-90-76d7c4377f2d">最佳实践</a>，但是在这里根本行不通。</p><h1 id="609f" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">初步考虑</h1><p id="7d98" class="pw-post-body-paragraph kv kw it kx b ky mj ju la lb mk jx ld le ml lg lh li mm lk ll lm mn lo lp lq im bi translated">当我开始思考可能的解决方案时，第一个也是最明显的想法是将Power BI仅用作可视化工具，并与SSAS立方体进行实时连接。然而，这种解决方案有严重的<a class="ae ku" href="https://docs.microsoft.com/en-us/power-bi/connect-data/desktop-ssas-multidimensional#considerations-and-limitations" rel="noopener ugc nofollow" target="_blank">限制</a>——最明显的一个，你不能通过编写报告级别的度量来丰富你的语义模型——这是关键客户的要求之一！因此，Live Connection立即被丢弃…</p><p id="93f8" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">第二个显而易见的解决方案是使用DirectQuery模式将数据导入Power BI。Power BI将直接面向数据仓库中的事实表和维度表，而不是SSAS立方体。尽管有这些限制，直接查询看起来是一个完全合法的(也是唯一可能的)解决方案。这是我能想到的最好的…</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/66746da9ca91f4829f494290205dc157.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2HvRkTTCOz9OG90J_VzoyQ.jpeg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated"><a class="ae ku" href="https://www.pexels.com/photo/macro-outdoors-perspective-rocky-268953/" rel="noopener ugc nofollow" target="_blank">https://www . pexels . com/photo/macro-outdoors-perspective-rocky-268953/</a></p></figure><p id="ff25" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">…直到我发现<a class="ae ku" href="https://dax.tips/2019/10/30/creative-aggs-part-iv-filtered-aggs/" rel="noopener ugc nofollow" target="_blank"> Phil Seamark的博客文章</a>关于过滤聚合，它打开了一个全新的视角！这个关于创造性聚合的系列很棒，但是这个特定的概念给了我启发。</p><h1 id="4437" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">简而言之，过滤聚合</h1><p id="bea3" class="pw-post-body-paragraph kv kw it kx b ky mj ju la lb mk jx ld le ml lg lh li mm lk ll lm mn lo lp lq im bi translated">我不会深入这个概念的细节，因为菲尔比我解释得更好。本质上，这种想法是将“热”和“冷”数据分开，然后利用Power BI中的复合模型特性——在Power BI中导入“热”数据，而“冷”数据将留在数据仓库中，并通过直接查询来定位。最重要的是，在Power BI数据模型中应用聚合将带来更多好处，您将在后面看到这一点。</p><p id="3759" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在，我希望你们熟悉“热”和“冷”数据这两个术语，如果你们不熟悉的话，“热”数据是最近的数据，其中单词<em class="mo">“最近”</em>具有典型的“视情况而定”的含义。它可以是过去X分钟、小时、天、月、年等的数据。这取决于您的具体使用情况。</p><p id="31e2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">就我而言，在与报告用户交谈后，我们得出结论，大部分分析都集中在前3个月的数据上。因此，我们的想法是动态提取“热”数据，如今天之前3个月的数据，并将这些数据存储在Power BI表格模型中。报告消费者将从快速查询中受益，因为数据将被优化压缩并保存在内存中。另一方面，当需要分析旧数据(“冷”数据)时，Power BI将直接进入数据源，并在查询时从那里提取数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/b59a9105e4567dc46fb4968be8e925a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*McfS8YpWu4UT52s03US0iw.jpeg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">https://unsplash.com/photos/_v0xhIT715g<a class="ae ku" href="https://unsplash.com/photos/_v0xhIT715g" rel="noopener ugc nofollow" target="_blank"/></p></figure><p id="8493" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">找到“引爆点”，即分离“热”和“冷”数据的时间点，在这里至关重要。如果您选择对“热”数据使用较短的周期，您将受益于较小的数据模型大小(在Power BI中导入较少的数据)，但是您将不得不忍受更频繁的直接查询。</p><p id="6683" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">但是，理论已经足够了，让我们进入Power BI Desktop，我将向您展示在不到1 GB的空间内适应“2亿行”事实表的所有步骤！</p><h1 id="5409" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">这一切是如何开始的…</h1><p id="cfd5" class="pw-post-body-paragraph kv kw it kx b ky mj ju la lb mk jx ld le ml lg lh li mm lk ll lm mn lo lp lq im bi translated">如您所见，我的原始事实表包含关于体育博彩的数据，大约有2亿行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/ec056c8c342120d9f60848f1f2c553d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_M17jVz1rbOsm1dIEgHPMw.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="61ed" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我还有两个简单的维度表——日期维度和运动类型维度。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/9aa9b2d1692782c47b51331479a7dadd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K_cg3_5TxiGsbTzYtKCsew.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="fc14" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">由于我已经在Power BI中导入了所有数据，我将检查数据模型背后的指标。如您所见，pbix文件大小略低于1 GB。而且，这个数字每天都在增加！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/a727e9a4ac329a2539ad164888746ff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2DPNdKNhfl7lH3JC-EnQOA.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="b6d5" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们应用第一步，分离“热”和“冷”数据。您需要确保这两者之间没有重叠，但也没有间隙，这样您最终会得到正确的结果。</p><p id="92c9" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这里，我们将利用Power BI中的复合模型特性。我已经将我巨大的事实表一分为二:factBetSummaryHot和factBetSummaryCold。“热”表将保存前3个月的数据，在我的例子中，这个表现在有大约430万行。</p><p id="16a9" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我首先在直接查询存储模式下创建了“热”和“冷”表。然后，我将首先在“热”数据上构建一个聚合表，该表将使用导入模式。另一方面,“冷”表包含剩余的大约1 . 9亿行，它将使用直接查询模式。在此基础上，我将构建几个聚合表来覆盖不同的维度属性(例如日期和运动类型)，并对这两个聚合表使用导入模式，因此Power BI将需要切换到直接查询，并将原始数据源仅用于那些对导入模式表不满意的查询！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/4b29877cc945a6ec63a87e21048b71eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IU8sTGoeKMaTWq6xT1DLTw.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="9fff" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">好了，现在让我们开始实现过滤聚合解决方案。我已经将“冷”表切换到直接查询存储模式，如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/7c7e24d563ba1cfd88941590b9e7625d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PqOJFYau_Wno4KWHHUEaYw.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="8eff" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果我现在检查pbix文件的大小，我会发现它只有17mb！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/4979721ba16666f3510afe3e3f0c3b26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NZI4eivdED-dkPIyvw-dEQ.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="3070" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">因此，我实现了最初的请求，将数据放在小于1GB的空间内，因为我设法将数据模型大小从1GB减少到17MB，同时保留了原始数据粒度！</p><h1 id="7f17" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">改进原始解决方案</h1><p id="a672" class="pw-post-body-paragraph kv kw it kx b ky mj ju la lb mk jx ld le ml lg lh li mm lk ll lm mn lo lp lq im bi translated">现在，让我们在“热”数据上创建一个聚合表，并将该表的存储模式设置为Import:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/ae127775941fa7fd6bd08f27a1310520.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7AVPC7Ay0re7VWj1AbpzPQ.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="0bf8" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我不会详细介绍聚合本身，因为有一篇由莎安娜米黄·沃森撰写的精彩文章，您可以从中了解更多关于这一强大功能的信息。</p><p id="e6fa" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">下一步是在新创建的聚合表和维度表之间建立关系:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/14db9a0caeb8590cfe5595dde1338089.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lKd-XuQCAOEqoEHkhmTRHA.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="9f20" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在，这个报告的性能将取决于许多因素。如果用户试图与报告交互，并想要3个月以前的数据，Power BI将通过存储在SQL Server数据库中的大约1 . 9亿行来搜索该数据，必须处理网络延迟、并发请求等问题。</p><p id="2b71" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">比方说，我想分析总利润，这是利润列的简单总和。为了检索正确的数字，我需要对“热”和“冷”表中的值求和，编写以下DAX度量:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="0150" class="mu ls it mq b gy mv mw l mx my">Total Profit Hot &amp; Cold = <br/>                          VAR vProfitHot = SUM(factBetSummaryHot[profit]) <br/>                          VAR vProfitCold = SUM(factBetSummaryCold[profit])<br/>RETURN<br/>vProfitHot + vProfitCold</span></pre><p id="42bd" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在，您可能会假设，如果我们只想查看前3个月的数据，Power BI将只转到一个聚合表，并快速提取数据并呈现给我们。不对！</p><p id="eded" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">下图显示，尽管选择的日期在1月31日和3月30日之间，Power BI还是用了将近12秒的时间准备好我的数据！而且，如果我们看一下性能分析器的数字，您会发现直接查询几乎占用了那段时间的全部时间:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/4b06d9d9fde76e25987fa064520d0aae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ckLghVflJFkvfDBFSyIHSA.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="4328" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">为什么Power BI需要应用直接查询，而我们已经有了一个很好的汇总表来处理这部分数据？嗯，Power BI很聪明。其实很聪明！它足够聪明地在内部转换我们的SUM over profit列并点击聚合表，而不是“访问”它的直接查询孪生兄弟。但是，在某些情况下，它无法自行解决所有问题。在这个场景中，Power BI将所有数据<strong class="kx iu"><em class="mo"/></strong>，甚至从“冷”表中直接查询，然后应用日期过滤器！</p><p id="f00c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这意味着，我们需要“指示”Power BI在数据检索之前评估数据过滤器<strong class="kx iu">！再次感谢Phil Seamark改进了这个方法:)</strong></p><p id="646f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">第一步是在DAX中设置时间的“临界点”。我们可以使用与SQL中完全相同的逻辑来做到这一点，当时我们将巨大的事实表分为“热”和“冷”:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="504f" class="mu ls it mq b gy mv mw l mx my">Time Line = <br/>           VAR maxDate = CALCULATE(<br/>                                 MAX('factBetSummaryHot Agg'[datePlaced]),<br/>                                 ALL()<br/>                                  )<br/>RETURN <br/>    EOMONTH(DATE(YEAR(maxDate),MONTH(maxDate)-3,1),0)</span></pre><p id="c82a" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">该方法将返回“热”和“冷”数据之间的截止日期。然后，我们将在改进版的总利润指标中使用这一结果:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="59da" class="mu ls it mq b gy mv mw l mx my">Total Profit = <br/>               VAR vProfitHot = SUM(factBetSummaryHot[profit])<br/>               VAR vProfitCold = IF(<br/>                                     MIN(dimDate[date]) &lt; [Time Line] ,<br/>                                     SUM(factBetSummaryCold[profit])<br/>                                   )<br/>RETURN<br/>vProfitHot + vProfitCold</span></pre><p id="11db" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这里，我们在每个场景中都从“热”表中返回SUM over profit列，因为它总是在导入模式下命中聚合表。然后，我们向“冷”数据添加一些逻辑—检查日期切片器中的开始日期是否在我们的“临界点”之前—如果是，那么我们需要等待直接查询。</p><p id="0dc7" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">但是，如果没有，那么…</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/54ad4f4fda4f0dbf341aa7cdf75053bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q4D6cL47429c8JY9hmXzTg.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="b42f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如你所见，现在我们在159毫秒内显示了我们的图像！而且，DAX查询用了12毫秒！这次没有直接查询，如果我们在DAX Studio中检查查询，我们会注意到我们的聚合表是匹配的，即使我们在度量中使用了直接查询表作为引用！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/63ce4f819f38b74db4cf11160faa8883.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fYCsNHNdoc0OlemlfHLGqg.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="60e3" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这很好，因为这意味着使用导入模式聚合表将满足最频繁运行的查询(针对前3个月的数据)!</p><h1 id="53d6" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">处理“冷”数据</h1><p id="0d21" class="pw-post-body-paragraph kv kw it kx b ky mj ju la lb mk jx ld le ml lg lh li mm lk ll lm mn lo lp lq im bi translated">作为下一个优化步骤，我想在“冷”数据上构建一个聚合表，这可能会满足最频繁运行的用户查询，这些查询需要在“临界点”(超过3个月)之前提取数据。这将略微增加数据模型的大小，但会显著提高报告的性能。</p><p id="db8f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">因此，只有在一些特定的用例中，当用户需要查看“冷”数据中的一些高级粒度时，Power BI才会直接向底层数据库发出查询。</p><p id="c169" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们根据我们的维度，创建两个包含“冷”数据的聚合表。第一个将根据日期聚合数据:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="681c" class="mu ls it mq b gy mv mw l mx my">SELECT datePlacedID<br/>      ,SUM(profit) profit<br/>      ,SUM(countBet) countBet<br/>FROM factBetSummaryCold<br/>GROUP BY datePlacedID</span></pre><p id="1e5a" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">而第二个将汇总按运动类型分组的数据:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="1ffb" class="mu ls it mq b gy mv mw l mx my">SELECT sportTypeID<br/>      ,SUM(profit) profit<br/>      ,SUM(countBet) countBet<br/>FROM factBetSummaryCold<br/>GROUP BY sportTypeID</span></pre><p id="ff92" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们在这两个聚合表和维度之间建立关系，并为新导入的表设置聚合:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/3602251de19513b78e59cd9af107628c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*am_mD182ycRH9_D1VK5zow.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="da9d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">通过设置优先级属性，您可以“指示”Power BI首先使用哪个聚合表。优先级值越高，相应表格的优先级越高。</p><p id="9408" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们回到我们的报告，一旦我们包括了“临界点”之前的数据，就检查我们的测量的性能:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/3e5a944a18ee0d1c205493def0aaca5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LzHVkqqAJnCrWQX3WcWj2Q.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="7f5b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">厉害！我将日期范围扩展到之前的6个月，我们在198毫秒内获得了结果，而DAX查询仅用了40毫秒！如果我们深入了解DAX Studio，我们可以确认请求的两个“部分”,即“冷”和“热”数据，都是由导入模式聚合表提供的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/1726b07cce5a2b11b96703db24eadea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XCYMVKveByaCBDDpVerN-g.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/ff9f851bed3731b8371324b06361c7a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*elLxC7t169G4Qk5eSOtI7g.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="71ff" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在我们得出结论之前，让我们最后看一下我们的pbix文件大小:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi mz"><img src="../Images/21ce240a237ca0d49a646f7f026a4ead.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eQCzjghJPnEMPuqJaGycCQ.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="eb0b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">太不可思议了:18MB！</p><h1 id="12f8" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">结论</h1><p id="044e" class="pw-post-body-paragraph kv kw it kx b ky mj ju la lb mk jx ld le ml lg lh li mm lk ll lm mn lo lp lq im bi translated">如你所见，我们成功了！最初的请求是将数据模型从SSAS立方体移动到Power BI Pro workspace，而不丢失事实表中的2亿行中的任何一行！我们从近1GB开始，到18MB结束，同时保留了原始数据粒度，并且不影响99%用例的报告性能！</p><p id="96de" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">非同寻常的任务需要非同寻常的解决方案，如果你问我，感谢Phil Seamark的绝妙想法，我们有一个解决方案，即使在Pro限制下也能容纳极其庞大的数据。</p><p id="298f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">本质上，我们刚刚做的是，我们已经设法在18MB中容纳了2亿行…</p><p id="40c4" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">感谢阅读！</p><p id="ebae" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">成为会员，阅读Medium上的每一个故事！</p></div></div>    
</body>
</html>