<html>
<head>
<title>Transfer Learning for Image Classification using Tensorflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于张量流的图像分类迁移学习</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/transfer-learning-for-image-classification-using-tensorflow-71c359b56673?source=collection_archive---------8-----------------------#2021-05-25">https://towardsdatascience.com/transfer-learning-for-image-classification-using-tensorflow-71c359b56673?source=collection_archive---------8-----------------------#2021-05-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="de74" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">案例研究:图像分类预测它是否是一种食物</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d332ca409bff8fdec93acc5e4a654464.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Db1SiAXjt7-2-MtHJQi6Dg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">尼克·萨莫伊洛夫在<a class="ae ky" href="https://unsplash.com/s/photos/food-plate?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="4d29" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="6071" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">图像分类是一项任务，其中计算机将预测图像属于哪一类。在深度学习开始蓬勃发展之前，像图像分类这样的任务无法达到人类水平的性能。这是因为机器学习模型无法学习图像的邻居信息。该模型仅获得像素级信息。</p><p id="9d8b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">得益于深度学习的力量，使用一种称为卷积神经网络(CNN)的模型，图像分类任务可以达到人类水平的性能。</p><p id="c2a7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">CNN是一种深度学习模型，从图像中学习表示。这种模型可以在没有人类参与的情况下从低级到高级特征进行学习。</p><p id="f3c5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">该模型不仅学习像素级的信息。该模型还通过一种称为卷积的机制从图像中学习邻居信息。卷积通过将一个区域中的像素集合相乘并将它们相加为一个值来聚合邻域信息。这些特征将用于将图像分类成一类。</p><p id="8175" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">深度学习虽然可以达到人类水平的性能，但是需要大量的数据。如果我们没有他们呢？我们可以用一个叫做迁移学习的概念。</p><p id="80d2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">迁移学习是一种方法，在这种方法中，我们将使用针对我们的问题在大规模数据上训练过的模型。所以我们只通过微调模型来训练他们。我们将得到的好处是模型将在短时间内训练。</p><p id="717a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">本文将向您介绍如何使用TensorFlow使用迁移学习进行图像分类。因为预处理步骤是必不可少的过程，所以我也将向您展示如何为我们的深度学习模型准备数据。没有进一步，让我们开始吧！</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="9734" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">实施</h1><h2 id="474a" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">导入库</h2><p id="069d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们需要做的第一步是导入库。我们需要TensorFlow，NumPy，os，还有熊猫。如果您还没有安装软件包，您可以使用pip命令来安装这些库。</p><blockquote class="nq nr ns"><p id="b4d2" class="lr ls nt lt b lu mn ju lw lx mo jx lz nu mp mc md nv mq mg mh nw mr mk ml mm im bi translated">请注意，我将使用的TensorFlow是版本2.4.1，所以请确保安装该版本。</p><p id="88c1" class="lr ls nt lt b lu mn ju lw lx mo jx lz nu mp mc md nv mq mg mh nw mr mk ml mm im bi translated">还有，如果你想用GPU来训练深度学习模型，请安装11.0版本的CUDA，因为那个版本支持2.4.1版本的TensorFlow。你可以在这里下载CUDA软件<a class="ae ky" href="https://developer.nvidia.com/cuda-11.0-download-archive" rel="noopener ugc nofollow" target="_blank">T5T7】。</a></p></blockquote><p id="453a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面是安装和加载库的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><h2 id="a259" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">准备数据</h2><p id="c702" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">加载库之后，下一步是准备数据集。在这种情况下，我们将使用一个名为Food-5K的数据集。</p><p id="bcd3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">该数据集由5000幅图像组成，分为食物和非食物两类。此外，数据已经分为训练、验证和测试数据集。我们数据集的文件夹结构看起来像这样，</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="2c30" class="ne la it oa b gy oe of l og oh"><strong class="oa iu">\---Food-5K<br/>    +---evaluation<br/>    |       0_0.jpg<br/>    |       1_0.jpg<br/>    |       <br/>    +---training<br/>    |       0_0.jpg<br/>    |       1_1.jpg<br/>    |       <br/>    \---validation<br/>    |       0_0.jpg<br/>    |       1_0.jpg</strong></span></pre><p id="25f0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">正如您在上面看到的，每个文件夹都由图像组成，其中每个图像文件名都包含它的类和标识符。标识符由下划线分隔。</p><p id="40b6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">对于该文件夹结构，我们需要生成包含图像文件名和标签列的数据帧。准备数据集的代码如下所示，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="7e5c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是数据帧的预览，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="9e58" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下一步是准备一个对象，将图像放入模型中。我们将首先使用tf.keras.preprocessing.image库中的ImageDataGenerator对象。</p><p id="9501" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">使用该对象，我们将生成图像批。此外，我们可以扩大我们的图像，以增加数据集的数量。因为我们也放大那些图像，所以我们也为图像放大方法设置参数。</p><p id="e02b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">此外，因为我们使用数据帧作为关于数据集的信息，所以我们将使用flow_from_dataframe方法来生成批处理并扩充图像。</p><p id="4ced" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面是代码的样子，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><h2 id="133c" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">训练模型</h2><p id="f3fb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">生成批次后，现在我们可以用迁移学习方法训练模型。因为我们使用那种方法，我们不需要从头实现CNN架构。相反，我们将使用现有的和已经过预训练的架构。</p><p id="23cb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们将使用ResNet-50作为我们新模型的主干。我们将创建输入，并根据类的数量用新的线性图层更改ResNet-50的最终线性图层。</p><p id="deec" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面是构建模型的代码，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="d284" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在我们来训练模型。我们将使用fit方法来训练它。下面是代码的样子，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><h2 id="1f2b" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">测试模型</h2><p id="c8a6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我们训练模型之后，现在让我们在测试数据上测试模型。此外，我们需要添加pillow库来加载和调整图像的大小，并添加scikit-learn来计算模型性能。</p><p id="1393" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们将使用scikit-learn库中的classification_report来生成一个关于模型性能的报告。此外，我们将从中可视化混淆矩阵。下面是预测测试数据集及其结果的代码，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="2f70" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">从上面可以看出，该模型的性能已经达到了95%以上。因此，我们可以在构建图像分类器API的情况下使用该模型。</p><h2 id="f047" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">保存模型</h2><p id="ef86" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果您希望将模型用于以后的使用或部署，您可以使用save方法保存模型，如下所示，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="8d82" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果要加载加载模型，可以像这样使用load_model函数，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="5133" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">结束语</h1><p id="0153" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">干得好！现在你知道如何使用TensorFlow实现迁移学习了。希望这篇文章对你有所帮助，尤其是想用有限的数据训练一个深度学习模型的人。</p><p id="f38a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你对这篇文章感兴趣，可以关注我的<strong class="lt iu">媒</strong>。另外，如果你想与我交谈，你可以在<a class="ae ky" href="https://www.linkedin.com/in/alghaniirfan/" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> LinkedIn </strong> </a>上与我联系。</p><p id="9ed3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">谢谢你看我的文章！</p></div></div>    
</body>
</html>