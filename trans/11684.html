<html>
<head>
<title>How to extract real-time intraday data from Google Analytics 4 and Firebase in BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 BigQuery 中从 Google Analytics 4 和 Firebase 中提取实时日内数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-extract-real-time-intraday-data-from-google-analytics-4-and-firebase-in-bigquery-65c9b859550c?source=collection_archive---------11-----------------------#2021-11-19">https://towardsdatascience.com/how-to-extract-real-time-intraday-data-from-google-analytics-4-and-firebase-in-bigquery-65c9b859550c?source=collection_archive---------11-----------------------#2021-11-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b8c5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">并始终为您的自定义报告提供最新数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/27309863c09318c15223f7748746ae50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TGzLKbxMOQHsgOOz"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">杰西卡·路易斯在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="0f6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您是一名<strong class="lb iu"> Firebase </strong>或<strong class="lb iu"> Google Analytics 4 </strong>用户，并且您已经将数据导入到您的<a class="ae ky" href="https://https://console.cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> BigQuery </strong> </a>数据仓库中，那么您可能想要创建<em class="lv">实时</em>定制报告，其中包含您在<em class="lv">日内</em>模式中的数据。问题是，这个整合的数据集每天都在被谷歌自动删除。因此，如果您选择将它作为数据源连接到您在<a class="ae ky" href="https://datastudio.google.com" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">Google Data Studio</strong></a>中的报告，第二天您将找不到它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lw"><img src="../Images/875d81ff981d613e4293678714e00c10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bHe4mlVakxobvN702e65Hw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片<a class="lx ly ep" href="https://medium.com/u/e06a48b3dd48?source=post_page-----65c9b859550c--------------------------------" rel="noopener" target="_blank">💡迈克·沙克霍米罗夫</a></p></figure><p id="f289" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lz translated">例如，我想在我们用<strong class="lb iu"> Data Studio </strong>构建的 BI 解决方案中对<em class="lv">日内</em>表进行实时分析。由于它经常被删除，我无法将它作为数据集连接到谷歌数据工作室。此外，当它被删除时，它不再是一个分区表，您不能使用<em class="lv">通配符</em>后缀进行日期查询。</p><p id="88f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">说到这里，我需要以下内容:</p><ol class=""><li id="fe4d" class="mi mj it lb b lc ld lf lg li mk lm ml lq mm lu mn mo mp mq bi translated"><strong class="lb iu">日内</strong>表不应该自动删除。我想手动操作。</li><li id="a425" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu mn mo mp mq bi translated">由于此<strong class="lb iu"> Firebase </strong>日常数据导出/集成功能的存在。我想集成数据传输将在一个小时内保证第二天交付。</li></ol><p id="343d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我相信这是一个很普遍的问题。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/a47a78d02b7770c2b2b5148d8f348418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*E2bHkIZdDXuB-gXR.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片<a class="lx ly ep" href="https://medium.com/u/e06a48b3dd48?source=post_page-----65c9b859550c--------------------------------" rel="noopener" target="_blank">💡迈克·沙克霍米罗夫</a></p></figure><p id="29b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经向谷歌工程提出了<a class="ae ky" href="https://issuetracker.google.com/issues/204248504" rel="noopener ugc nofollow" target="_blank">一个功能请求</a>，以在需要时启用手动删除，但在写这篇文章时，它仍在进行中<em class="lv"/>。</p><blockquote class="mx"><p id="945f" class="my mz it bd na nb nc nd ne nf ng lu dk translated"><em class="nh">“日内表不应该自动删除。我们希望手动操作。”</em></p></blockquote><p id="7fe1" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated"><em class="lv">虽然这可能需要一段时间。因此，这里有一个解决方案来克服这个问题。</em></p><h1 id="16ec" class="nn no it bd np nq nr ns nt nu nv nw nx jz ny ka nz kc oa kd ob kf oc kg od oe bi translated">如何从日内表中提取数据</h1><blockquote class="of og oh"><p id="9e86" class="kz la lv lb b lc ld ju le lf lg jx lh oi lj lk ll oj ln lo lp ok lr ls lt lu im bi translated"><em class="it">理想情况下，您会希望运行一个调度脚本，其中参数是当天表格的日期后缀。</em></p></blockquote><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><blockquote class="mx"><p id="1468" class="my mz it bd na nb on oo op oq or lu dk translated"><em class="nh">然而事情没那么简单……</em></p></blockquote><h1 id="2c42" class="nn no it bd np nq nr ns nt nu nv nw nx jz os ka nz kc ot kd ob kf ou kg od oe bi translated">日内表被自动删除</h1><p id="c8e2" class="pw-post-body-paragraph kz la it lb b lc ov ju le lf ow jx lh li ox lk ll lm oy lo lp lq oz ls lt lu im bi translated">所以你不知道安排剧本的确切时间。或者，您可以使用<strong class="lb iu"> daily </strong> export 表，但是同样，您必须等到提取准备就绪。我一直在寻找关于日内表删除时间的信息，我发现过去一天的日内表可能还存在几个小时。原因之一是处理大量数据需要更多时间<a class="ae ky" href="https://stackoverflow.com/questions/60796741/intraday-table-for-firebase-analytics-in-bigquery" rel="noopener ugc nofollow" target="_blank"> Stackoverflow </a>。因此，删除过去的表没有固定的时间，但一般来说，它在新的一天之后的几个小时内仍然存在。您在 GA 中设置的时区也会对此产生影响。</p><h1 id="a11d" class="nn no it bd np nq nr ns nt nu nv nw nx jz ny ka nz kc oa kd ob kf oc kg od oe bi translated">无法在 BigQuery 脚本中使用表名参数。</h1><p id="ff4e" class="pw-post-body-paragraph kz la it lb b lc ov ju le lf ow jx lh li ox lk ll lm oy lo lp lq oz ls lt lu im bi translated"><strong class="lb iu"> BigQuery 脚本</strong>是一个强大的工具，但目前(2021–11–20)谷歌的<strong class="lb iu"> BigQuery </strong>脚本不能使用表名参数。根据 BigQuery 文档中的参数化查询]5，查询参数不能用于 SQL 对象标识符</p><blockquote class="of og oh"><p id="d9c4" class="kz la lv lb b lc ld ju le lf lg jx lh oi lj lk ll oj ln lo lp ok lr ls lt lu im bi translated"><em class="it">参数不能替代标识符、列名、表名或查询的其他部分。</em></p></blockquote><h1 id="2221" class="nn no it bd np nq nr ns nt nu nv nw nx jz ny ka nz kc oa kd ob kf oc kg od oe bi translated">第一步。检查原始日内表是否存在</h1><p id="572d" class="pw-post-body-paragraph kz la it lb b lc ov ju le lf ow jx lh li ox lk ll lm oy lo lp lq oz ls lt lu im bi translated">如果数据存在，您可能希望使用此脚本返回<code class="fe pa pb pc pd b">true</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><h1 id="bf87" class="nn no it bd np nq nr ns nt nu nv nw nx jz ny ka nz kc oa kd ob kf oc kg od oe bi translated">第二步。创建一个 BigQuery SQL 脚本(如果存在，执行一些操作，例如插入)</h1><p id="51c3" class="pw-post-body-paragraph kz la it lb b lc ov ju le lf ow jx lh li ox lk ll lm oy lo lp lq oz ls lt lu im bi translated">然后，将执行更新的脚本添加到您的程序中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><h1 id="0110" class="nn no it bd np nq nr ns nt nu nv nw nx jz ny ka nz kc oa kd ob kf oc kg od oe bi translated">第三步。决定如何处理新的日内表副本的 INSERT 语句</h1><p id="c2b4" class="pw-post-body-paragraph kz la it lb b lc ov ju le lf ow jx lh li ox lk ll lm oy lo lp lq oz ls lt lu im bi translated">您可以:</p><ul class=""><li id="10e5" class="mi mj it lb b lc ld lf lg li mk lm ml lq mm lu pe mo mp mq bi translated">用新数据替换整个表</li><li id="462b" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu pe mo mp mq bi translated">仅为所选列添加新记录</li></ul><h1 id="faff" class="nn no it bd np nq nr ns nt nu nv nw nx jz ny ka nz kc oa kd ob kf oc kg od oe bi translated">复制和替换当天事件表</h1><p id="5b90" class="pw-post-body-paragraph kz la it lb b lc ov ju le lf ow jx lh li ox lk ll lm oy lo lp lq oz ls lt lu im bi translated">这个脚本将复制整个表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="e4d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能希望使用与<strong class="lb iu">复制和替换日内事件表</strong>相同的 SQL 脚本，但是将<strong class="lb iu">复制和替换查询</strong>更改为<strong class="lb iu">选择和插入查询</strong>。让我们创建这个脚本来完成以下任务:</p><h2 id="75ef" class="pf no it bd np pg ph dn nt pi pj dp nx li pk pl nz lm pm pn ob lq po pp od pq bi translated"><strong class="ak">解决方案:</strong></h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><h1 id="6cd5" class="nn no it bd np nq nr ns nt nu nv nw nx jz ny ka nz kc oa kd ob kf oc kg od oe bi translated">结论</h1><p id="acda" class="pw-post-body-paragraph kz la it lb b lc ov ju le lf ow jx lh li ox lk ll lm oy lo lp lq oz ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">日内</em> </strong>表与<strong class="lb iu"> <em class="lv">日内</em> </strong>会话表相比可能会有细微的差异，但您无需等待。这些差异是由以下原因造成的:</p><ul class=""><li id="c0f8" class="mi mj it lb b lc ld lf lg li mk lm ml lq mm lu pe mo mp mq bi translated">Google Analytics 允许最多晚发送四个小时的点击，在请求数据时，这些点击可能在当天的表中不可用。</li><li id="f682" class="mi mj it lb b lc mr lf ms li mt lm mu lq mv lu pe mo mp mq bi translated">Google 在收集点击量之后和将数据导出到 BigQuery 之前执行一些数据处理。一般受影响的领域是流量来源和链接的营销产品(AdWords，Campaign Manager 等。)</li></ul><p id="e741" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一般来说，如果这些字段对您的数据堆栈没有任何影响，这是通过与<strong class="lb iu"> Firebase </strong>或<strong class="lb iu"> <em class="lv"> Google Analytics 4 </em> </strong>集成来提高<strong class="lb iu">数据<em class="lv">可用性</em> </strong>的解决方案。</p><h1 id="16cd" class="nn no it bd np nq nr ns nt nu nv nw nx jz ny ka nz kc oa kd ob kf oc kg od oe bi translated">资源</h1><p id="93a4" class="pw-post-body-paragraph kz la it lb b lc ov ju le lf ow jx lh li ox lk ll lm oy lo lp lq oz ls lt lu im bi translated">[1]:<a class="ae ky" href="https://stackoverflow.com/questions/60796741/intraday-table-for-firebase-analytics-in-bigquery" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/60796741/intraday-table-for-firebase-analytics-in-big query</a></p><p id="a0b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[2]:<a class="ae ky" href="https://https://console.cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank">https://https://console . cloud . Google . com/big query</a></p><p id="14ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[3]:<a class="ae ky" href="https://datastudio.google.com" rel="noopener ugc nofollow" target="_blank">https://datastudio.google.com</a></p><p id="67a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[4]:<a class="ae ky" href="https://stackoverflow.com/questions/59372469/create-table-using-a-variable-name-in-the-bigquery-ui" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/59372469/create-table-using-a-variable-name-in-the-big query-ui</a></p><p id="c1ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[5]:<a class="ae ky" href="https://cloud.google.com/bigquery/docs/parameterized-queries#bigquery_query_params_named-web" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/big query/docs/parameterized-queries # big query _ query _ params _ named-web</a></p></div><div class="ab cl pr ps hx pt" role="separator"><span class="pu bw bk pv pw px"/><span class="pu bw bk pv pw px"/><span class="pu bw bk pv pw"/></div><div class="im in io ip iq"><p id="e4cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">原载于【https://mydataschool.com】<a class="ae ky" href="https://mydataschool.com/blog/how-to-extract-real-time-intraday-data-in-firebase-and-bigquery/" rel="noopener ugc nofollow" target="_blank"><em class="lv"/></a><em class="lv">。</em></em></p></div></div>    
</body>
</html>