<html>
<head>
<title>Are your microservices performing the way they should? Jaeger can help!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">您的微服务是否以应有的方式运行？耶格可以帮忙！</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/are-your-microservices-performing-the-way-they-should-jaeger-can-help-6e428f017cc?source=collection_archive---------24-----------------------#2021-08-19">https://towardsdatascience.com/are-your-microservices-performing-the-way-they-should-jaeger-can-help-6e428f017cc?source=collection_archive---------24-----------------------#2021-08-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8000" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">对复杂分布式系统中的服务进行监控和故障排除，比如Kubernetes。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7a04520a64c16d4e9187409435280d81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W09L9O86TP7Y3Jc_4KXBbA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">阿巴斯·特拉尼在<a class="ae ky" href="https://unsplash.com/s/photos/trace?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="09fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您部署了一个应用程序，报告以美元为单位的加密货币的当前价格。如果你想形象化它，想想类似于<a class="ae ky" href="https://coinmarketcap.com/" rel="noopener ugc nofollow" target="_blank">的东西。</a></p><p id="298d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们假设CoinMarketCap在3秒内做出响应。这意味着，如果用户导航到他们的页面，他们可以很快获得他们感兴趣的硬币的价格。另一方面，您的应用程序至少需要8秒钟来提供答案。我敢打赌，一两周之后你就不会有很多用户了！</p><p id="f8b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你需要迅速找出问题所在。怎么花了这么长时间？哪项服务表现不佳？您知道您必须对代码进行一些更改，但是您如何知道从哪里开始呢？在云原生世界中，像获取比特币的美元价格这样简单的事情可能涉及许多微服务。</p><p id="03aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个故事介绍了Jaeger ，这是一个开源的端到端分布式跟踪工具，可以让您观察应用程序内部的情况。</p><blockquote class="lv lw lx"><p id="f246" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><a class="ae ky" href="https://www.dimpo.me/newsletter?utm_source=medium&amp;utm_medium=article&amp;utm_campaign=jaeger" rel="noopener ugc nofollow" target="_blank">学习率</a>是为那些对AI和MLOps的世界感到好奇的人准备的时事通讯。你会在每周五收到我关于最新人工智能新闻和文章的更新和想法。在这里订阅<a class="ae ky" href="https://www.dimpo.me/newsletter?utm_source=medium&amp;utm_medium=article&amp;utm_campaign=jaeger" rel="noopener ugc nofollow" target="_blank"/>！</p></blockquote></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="bb4f" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">监控与可观察性</h1><p id="c830" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">当错误发生时，开发人员需要正确的反馈，这样他们就知道该修复什么。我们有“日志记录”,但是日志记录告诉你发生了什么，但是如果你的代码运行到完成，它不能告诉你为什么它表现不好。</p><p id="a5e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，监控不会告诉我们应用程序内部发生了什么。它会给出诸如内存可用性低之类的指标，但它不会帮助我们查明问题的原因。</p><p id="8cc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们有可观测性。在可观察性中，我们可以直接进入我们的应用程序，观察它的各种过程和功能。我们可以看到服务如何执行以及它们如何交互。然后，我们可以揭示几个问题或发现优化，使我们的应用程序性能更好。</p><p id="8e69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据经验，请记住:<strong class="lb iu">我们监控系统并观察应用程序</strong>。你还会听到人们使用术语<em class="ly">可观察性</em>来对这两个概念进行分组(即监控<em class="ly">和</em>可观察性)。如果您想了解更多关于监控和可观察性的信息，请查看以下内容:</p><div class="ng nh gp gr ni nj"><a rel="noopener follow" target="_blank" href="/monitoring-and-observability-in-cloud-native-architectures-54e68e52b103"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">云本地架构中的监控和可观察性</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">为什么监控对于云原生应用程序至关重要？有哪些工具可以完成这项工作？</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">towardsdatascience.com</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx ks nj"/></div></div></a></div><h1 id="4777" class="mj mk it bd ml mm ny mo mp mq nz ms mt jz oa ka mv kc ob kd mx kf oc kg mz na bi translated">贼鸥</h1><p id="9441" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">Jaeger是领先的开源端到端分布式追踪工具。什么是分布式跟踪？简而言之，就是在微服务的世界里寻迹。它允许您在被监控的应用程序中跟踪请求或事务的过程。</p><p id="3bb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">优步在2015年创建了jaeger，并将其捐赠给了云原生计算基金会(CNCF)。Jaeger收集应用程序信息，而领先的监控工具Prometheus收集系统信息。</p><p id="267e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，与“日志记录”相反，Jaeger告诉你一个函数是如何执行的，而不是它是如何失败的。它通过各种服务跟踪请求，这使得它非常适合测量延迟问题。</p><p id="0a3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">耶格使用轨迹和跨度来实现这一切。所以，一些术语:</p><ul class=""><li id="5119" class="od oe it lb b lc ld lf lg li of lm og lq oh lu oi oj ok ol bi translated">一个<strong class="lb iu">轨迹</strong>是一个通过系统的数据/执行路径，可以被认为是一个有向无环的跨度图。</li><li id="538a" class="od oe it lb b lc om lf on li oo lm op lq oq lu oi oj ok ol bi translated">一个<strong class="lb iu">跨度</strong>表示Jaeger中的一个逻辑工作单元，它有一个操作名、操作的开始时间和持续时间。跨度可以被嵌套和排序以模拟因果关系。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/b8602672e4bae7e45d3048bd3b1d0f82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*evsSLC2uW8ryP7HTbmFVSA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">走线与跨度</p></figure><h2 id="9267" class="os mk it bd ml ot ou dn mp ov ow dp mt li ox oy mv lm oz pa mx lq pb pc mz pd bi translated">装置</h2><p id="6f92" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">为了安装Jaeger服务器，我们依赖Docker提供的便利。因此，我们可以只运行以下命令:</p><pre class="kj kk kl km gt pe pf pg ph aw pi bi"><span id="0824" class="os mk it pf b gy pj pk l pl pm">docker run -d -p5775:5775/udp -p6831:6831/udp -p6832:6832/udp -p5778:5778 -p16686:16686 -p14268:14268 -p9411:9411 jaegertracing/all-in-one:0.8.0</span></pre><p id="9389" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您可以启动您最喜欢的浏览器，Jaeger UI将在<code class="fe pn po pp pf b"><a class="ae ky" href="http://localhost:16686" rel="noopener ugc nofollow" target="_blank">localhost:16686</a></code>等待您:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pq"><img src="../Images/e2780211f933ec3965cb0642f57f95f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q4kDhOQwXJR8-0bu9mRy2A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Jaeger UI——作者图片</p></figure><p id="26dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们将发送跟踪的服务器。接下来，我们需要安装必要的Python包，以便能够发送这些跟踪:</p><pre class="kj kk kl km gt pe pf pg ph aw pi bi"><span id="cf47" class="os mk it pf b gy pj pk l pl pm">pip install jaeger-client</span></pre><h2 id="85ed" class="os mk it bd ml ot ou dn mp ov ow dp mt li ox oy mv lm oz pa mx lq pb pc mz pd bi translated">简单的例子</h2><p id="5ae3" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">正如我们所说，我们希望构建一个应用程序，返回前100种加密货币的价格。因此，首先，我们需要安装Python <code class="fe pn po pp pf b">requests</code>库，这样我们就可以发出HTTP请求:</p><pre class="kj kk kl km gt pe pf pg ph aw pi bi"><span id="80da" class="os mk it pf b gy pj pk l pl pm">pip install requests</span></pre><p id="003d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是初始化一个<code class="fe pn po pp pf b">tracer</code>对象:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pr ps l"/></div></figure><p id="13f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用这个tracer对象来生成我们的跨度。我们需要两个跨度:</p><ol class=""><li id="e2d6" class="od oe it lb b lc ld lf lg li of lm og lq oh lu pt oj ok ol bi translated">第一个将是父跨度。它将跟踪整个过程需要多长时间才能完成。</li><li id="e5c0" class="od oe it lb b lc om lf on li oo lm op lq oq lu pt oj ok ol bi translated">第二个是跟踪检索每种加密货币的信息所需的时间。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pr ps l"/></div></figure><p id="6734" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码首先获取父span中所有可用的crypto，然后为每个crypto发出一个新的请求来获取它的信息并打印它的价格。当然，我们可以在没有第二个请求的情况下这样做，因为我们在第一个调用中获得了我们需要的所有信息，但这是一个用于演示目的的示例。</p><p id="7358" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们现在导航到Jaeger UI，刷新页面，从<code class="fe pn po pp pf b">Service</code>菜单中选择<code class="fe pn po pp pf b">crypto-service</code>并按下<code class="fe pn po pp pf b">Find Traces</code>按钮，我们将得到这个视图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pu"><img src="../Images/a516980bda3fd2ccdba8e0471f196f9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9HZxDDI2undHVGv56O2ZNA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">耶格痕迹——作者图片</p></figure><p id="6f3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过深入研究它收集的101个跨度(1个父节点和100个顶级加密节点)，我们可以看到每个请求的响应时间:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pv"><img src="../Images/ee70057e463145aae30ccc0b09afeffa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UpMvJWTStOVQmZui_eKbYQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">耶格潜伏——作者图片</p></figure><p id="ad5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们又多了一条关于我们需要做得更好的线索！</p><h1 id="79a9" class="mj mk it bd ml mm ny mo mp mq nz ms mt jz oa ka mv kc ob kd mx kf oc kg mz na bi translated">结论</h1><p id="9cec" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">这个故事介绍了Jaeger，领先的开源端到端分布式追踪工具。</p><p id="3a0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用Jaeger，我们可以直接进入我们的应用程序，观察它的各种过程和功能。我们可以看到服务如何执行以及它们如何交互。然后，我们可以揭示几个问题或发现优化，使我们的应用程序性能更好。</p><p id="5008" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在后面的文章中，我们将看到如何用Grafana构建仪表板，向用户公开这些信息，并集成来自Prometheus的监控信息。</p><h1 id="f6ab" class="mj mk it bd ml mm ny mo mp mq nz ms mt jz oa ka mv kc ob kd mx kf oc kg mz na bi translated">关于作者</h1><p id="4e76" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我的名字是<a class="ae ky" href="https://www.dimpo.me/?utm_source=medium&amp;utm_medium=article&amp;utm_campaign=jaeger" rel="noopener ugc nofollow" target="_blank">迪米特里斯·波罗普洛斯</a>，我是一名为<a class="ae ky" href="https://www.arrikto.com/" rel="noopener ugc nofollow" target="_blank">阿里克托</a>工作的机器学习工程师。我曾为欧洲委员会、欧盟统计局、国际货币基金组织、欧洲央行、经合组织和宜家等主要客户设计和实施过人工智能和软件解决方案。</p><p id="290b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有兴趣阅读更多关于机器学习、深度学习、数据科学和数据操作的帖子，请关注我的<a class="ae ky" href="https://towardsdatascience.com/medium.com/@dpoulopoulos/follow" rel="noopener" target="_blank"> Medium </a>、<a class="ae ky" href="https://www.linkedin.com/in/dpoulopoulos/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或Twitter上的<a class="ae ky" href="https://twitter.com/james2pl" rel="noopener ugc nofollow" target="_blank"> @james2pl </a>。</p><p id="b49b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所表达的观点仅代表我个人，并不代表我的雇主的观点或意见。</p></div></div>    
</body>
</html>