<html>
<head>
<title>Python Structural Pattern Matching — Top 3 Use Cases To Get You Started</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 结构化模式匹配——帮助您入门的 3 大用例</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-structural-pattern-matching-top-3-use-cases-to-get-you-started-262160007fa0?source=collection_archive---------12-----------------------#2021-11-22">https://towardsdatascience.com/python-structural-pattern-matching-top-3-use-cases-to-get-you-started-262160007fa0?source=collection_archive---------12-----------------------#2021-11-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b4bf" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Python 3.10 增加了对 switch 语句的支持——这里有 3 个实用的例子来帮助您入门</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2eadb40913ba8edc36e4a6f968f63a3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oc7qxQ30Ny5--Us6FSWBfA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@grzegorzwalczak?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Grzegorz Walczak </a>在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="fceb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python 的等价语句<code class="fe lv lw lx ly b">switch</code>终于在 Python 3.10 中出现了。它隐藏在一个有趣的名字<em class="lz">结构模式匹配</em>的后面，做你所期望的和更多的事情。它支持处理原始数据类型、序列，甚至类和枚举。</p><p id="508e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天我将向你展示如何开始，并讨论在什么情况下你应该使用它。我们将从创建一个基于 Python 3.10 的新环境开始。</p><p id="240d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不想看书？请观看我的视频:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ma mb l"/></div></figure></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="cf6a" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">如何配置 Python 3.10 环境</h1><p id="d2a8" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我们将使用 Anaconda 创建一个新的虚拟环境。如果您使用其他工具来管理 Python 工作流，请在线搜索等效的命令。</p><p id="3479" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从终端逐行执行以下命令，创建一个名为<code class="fe lv lw lx ly b">py310</code>的新 Python 3.10 虚拟环境，安装并启动 Jupyter Lab:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="c15e" class="nk mk it ly b gy nl nm l nn no">conda create — name py310 python=3.10<br/>conda activate py310<br/>conda install jupyter jupyterlab<br/>jupyter lab</span></pre><p id="93a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以使用以下命令来验证您使用的是 Python 3.10(假设您使用的是 Jupyter 或 Python shell):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np mb l"/></div></figure><p id="5475" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你应该看到<code class="fe lv lw lx ly b">3.10.0</code>打印出来，这意味着你可以走了。</p><h1 id="bf15" class="mj mk it bd ml mm nq mo mp mq nr ms mt jz ns ka mv kc nt kd mx kf nu kg mz na bi translated">Python 结构化模式匹配-基本语法</h1><p id="6111" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在深入到用例之前，让我们先了解一下结构模式匹配背后的基本语法。整个事情基于两个关键词:</p><ul class=""><li id="3aa3" class="nv nw it lb b lc ld lf lg li nx lm ny lq nz lu oa ob oc od bi translated"><code class="fe lv lw lx ly b">match</code> —您想要评估条件的受试者。它可能是 API 请求返回的状态代码。</li><li id="f8e3" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated"><code class="fe lv lw lx ly b">case</code> —评估个体条件以查看是否确认匹配。</li></ul><p id="8cfe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是来自<a class="ae ky" href="https://docs.python.org/3/whatsnew/3.10.html" rel="noopener ugc nofollow" target="_blank">官方文档</a>的模式匹配的一般语法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np mb l"/></div></figure><p id="71e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，Python 中的结构化模式匹配不需要在每个案例的结尾使用<code class="fe lv lw lx ly b">break </code>语句。如果在其他案例中没有找到精确匹配，将使用最后一个案例(<code class="fe lv lw lx ly b">_</code>)。</p><p id="cf3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您现在已经了解了基础知识，所以让我们深入到示例中。</p><h1 id="c888" class="mj mk it bd ml mm nq mo mp mq nr ms mt jz ns ka mv kc nt kd mx kf nu kg mz na bi translated">Python 结构化模式匹配-匹配简单值</h1><p id="ea62" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">先说一个简单的。我们将编写一个名为 http_error()的函数，它接受一个状态代码。然后，我们将使用状态代码作为匹配语句的主题，并针对不同的条件编写几个案例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np mb l"/></div></figure><p id="0189" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅供参考，您可以使用|在一个模式中组合多个条件。例如，状态代码 401、403 和 404 返回相同的结果，因此编写三个不同的案例没有意义。</p><p id="3f82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们用不同的状态代码调用 http_error()函数来验证它是否正常工作:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/b43339c9a6d798cb0fa5835b5b58622a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/0*Xo6Bfw6qRTQFKZM5"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="ok">图片 Python 中的基本结构模式匹配(图片由作者提供)</em></p></figure><p id="1321" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，即使你传入一个字符串，这个函数也不会崩溃。接下来，我们将深入更高级的用例。</p><h1 id="a37f" class="mj mk it bd ml mm nq mo mp mq nr ms mt jz ns ka mv kc nt kd mx kf nu kg mz na bi translated">Python 结构化模式匹配-匹配复杂模式</h1><p id="cb4c" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">有时候匹配一个变量是不够的。好消息是——您可以在 Python 的匹配语句中加入几乎任何可以想象的东西。</p><p id="cfa6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看看下面的代码片段——它声明了一个名为<code class="fe lv lw lx ly b">get_service_level()</code>的函数，该函数将用户数据作为字典接受。目标是基于用户<em class="lz">订阅类型</em>(免费，高级)和<em class="lz">消息类型</em>(信息，错误)，返回不同的服务级别。在 info 消息的情况下，不管订阅类型如何，服务级别都是 0。在有错误消息的自由用户的情况下，服务级别是 1。最后，在高级用户出现错误消息的情况下，服务级别是 2:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np mb l"/></div></figure><p id="7568" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在一个关键词后面写一本字典有点不自然，但这是你必须习惯的事情。无论如何，以下是对所有四种可能情况的测试:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/0f1844c1f7c72739983034650a24b768.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0GFsdgtFgdJkTUFG"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="ok">图 2 —匹配 Python 中的复杂模式(图片由作者提供)</em></p></figure><p id="245c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过添加默认案例来进一步改进该功能，但是您已经知道如何做了。</p><h1 id="3ee7" class="mj mk it bd ml mm nq mo mp mq nr ms mt jz ns ka mv kc nt kd mx kf nu kg mz na bi translated">Python 结构化模式匹配-匹配类中的模式</h1><p id="6b21" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">可以对 Python 的类和数据类使用结构模式匹配。文档向您展示了如何使用数据类，所以我将在这里介绍常规的数据类。简而言之，您可以使用一个类名，后跟一个作为 case 模式传递给构造函数的参数列表。</p><p id="4a4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下示例向您展示了如何在 Python 类中实现相同的服务级别逻辑。向构造函数传递了两个参数—订阅类型和消息类型。对于任何信息消息，级别为 0。在自由用户出错的情况下，级别为 1。最后，在高级用户出错的情况下，级别为 2。我们还将添加一个默认案例，只是为了混淆一下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np mb l"/></div></figure><p id="24c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">语法与第二个例子中的不同，但仍然可以理解。我认为它也更容易阅读。假设您有两个以上的参数——将它们作为字典传递会很快变得混乱。</p><p id="efc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们针对四种可能的场景和一种默认情况进行测试:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/4a837c465681428eaf1d15a7dcb220df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*u7L6xCQ7rCpoJNLQ"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="ok">图片 Python 类中的结构模式匹配(图片由作者提供)</em></p></figure><p id="53ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很管用。让我们在这里停止使用实际的例子，把焦点转移到一个重要的问题上——什么时候应该使用结构模式匹配？</p><h1 id="7e03" class="mj mk it bd ml mm nq mo mp mq nr ms mt jz ns ka mv kc nt kd mx kf nu kg mz na bi translated">最后的想法</h1><p id="0a67" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">Python 中早就应该有一个专用的<code class="fe lv lw lx ly b">switch</code>语句了。结构模式匹配打包了 switch 语句所做的一切，甚至更多。这是一种书写和评估条件的新方法。但是正如科里·泰勒曾经说过的那样——<em class="lz">新并不意味着最好</em>。</p><p id="1020" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你所做的只是测试简单的条件，那么在结构模式匹配上费心是没有意义的。此外，结构模式匹配仅在 Python 3.10 中可用。如果您尝试使用旧的 Python 版本，将会得到一个错误。值得升级吗？</p><p id="8ad6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您有更复杂的模式要评估时，主要使用结构化模式匹配，就像今天讨论的那些。</p><p id="058f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lz">你们觉得结构模式匹配怎么样？你是否用它替换了你的一些旧代码，为什么？</em>请在下面的评论区告诉我。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><p id="1c28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lz">喜欢这篇文章吗？成为</em> <a class="ae ky" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="lz">中等会员</em> </a> <em class="lz">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="on oo gp gr op oq"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd iu gy z fp ov fr fs ow fu fw is bi translated">通过我的推荐链接加入 Medium-Dario rade ci</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">medium.com</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe ks oq"/></div></div></a></div></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="4800" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">保持联系</h1><ul class=""><li id="3544" class="nv nw it lb b lc nb lf nc li pf lm pg lq ph lu oa ob oc od bi translated">注册我的<a class="ae ky" href="https://mailchi.mp/46a3d2989d9b/bdssubscribe" rel="noopener ugc nofollow" target="_blank">简讯</a></li><li id="f540" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">在 YouTube<a class="ae ky" href="https://www.youtube.com/c/BetterDataScience" rel="noopener ugc nofollow" target="_blank">上订阅</a></li><li id="3115" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">在<a class="ae ky" href="https://www.linkedin.com/in/darioradecic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上连接</li></ul></div></div>    
</body>
</html>