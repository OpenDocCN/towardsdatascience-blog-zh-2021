<html>
<head>
<title>Train on Cloud GPUs with Azure Machine Learning SDK for Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure Machine Learning SDK for Python在云GPU上进行培训</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/train-on-cloud-gpus-with-azure-machine-learning-sdk-for-python-967c99418df1?source=collection_archive---------11-----------------------#2021-04-21">https://towardsdatascience.com/train-on-cloud-gpus-with-azure-machine-learning-sdk-for-python-967c99418df1?source=collection_archive---------11-----------------------#2021-04-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="33f1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在Azure Machine Learning Studio cloud中的GPU驱动的计算实例上运行机器学习模型的入门指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/637eb3d0ab4bc8777ef271542757938b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jduDU6WixmsMiBFI"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@dpascoa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Daniel Páscoa </a>拍照</p></figure><p id="d22c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最近在做一个项目，需要快速训练一组神经网络。这不能在我的笔记本电脑上完成，因为培训是连续的，没有足够的时间。另外，我不能忍受我的3.1 GHz 2017 MacBook Pro在用tensorflow训练模型时有多迟钝。</p><p id="71e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">开始使用Azure机器学习有一个相当大的障碍。微软的文档很好，但没有提供上下文，所以拼凑必要的组件来运行这个项目最终有点痛苦。为了减轻你的痛苦，这里有一个在Azure cloud中使用GPU计算实例运行机器学习模型的入门指南。</p><h1 id="a67f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">数据</h1><p id="43f4" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在本教程中，我将使用来自<a class="ae ky" href="http://github.com/yangmindy4" rel="noopener ugc nofollow" target="_blank"> Mindy Yang </a>和<a class="ae ky" href="https://github.com/garythung/" rel="noopener ugc nofollow" target="_blank"> Gary Thung </a>的论文<a class="ae ky" href="http://cs229.stanford.edu/proj2016/report/ThungYang-ClassificationOfTrashForRecyclabilityStatus-report.pdf" rel="noopener ugc nofollow" target="_blank">垃圾可回收性分类</a>中的数据可以从google drive文件夹下载原始尺寸和缩减采样尺寸的图像，或者从<a class="ae ky" href="https://www.kaggle.com/asdasdasasdas/garbage-classification" rel="noopener ugc nofollow" target="_blank"> kaggle下载缩减采样尺寸的图像。</a></p><p id="3985" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了对数据有一个概念，这里有一些图片和它们的文件名。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/410546cb2b951a3dc3d09f88937118e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*42U04X4Zc1xUarUF_C1_7w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者在麻省理工学院许可下使用M. Yang和G. Thung的组件制作</p></figure><p id="33d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将数据分为训练集和验证集。分割的代码与使用Azure没有直接关系，所以我没有在这里包括它；然而，用于创建这个项目的所有代码都可以在相关的<a class="ae ky" href="https://github.com/benbogart/getting_started_with_azure_for_ml" rel="noopener ugc nofollow" target="_blank"> github资源库</a>中找到。</p><div class="mt mu gp gr mv mw"><a href="https://github.com/benbogart/getting_started_with_azure_for_ml/blob/master/1_Getting_started_with_Azure_for_Machine_Learning.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd iu gy z fp nb fr fs nc fu fw is bi translated">benbogart/getting _ started _ with _ azure _ for _ ml</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">中型文章《Azure机器学习入门》附带的笔记本…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">github.com</p></div></div></div></a></div><p id="c685" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">至此，是时候设置Azure环境了！</p><h1 id="35fb" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">Azure设置</h1><h2 id="0aa1" class="nf lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">请求GPU配额</h2><p id="9319" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果你还没有Azure帐户，你可以注册一个，并获得200美元的免费点数(截至本文撰写之时)。但是，为了在支持GPU的实例上运行以下培训，您必须将您的帐户升级为“现收现付”，并请求增加GPU计算实例类型的配额。在您切换到“现收现付”后，您的点数将保持有效</p><p id="9470" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">GPU将显著加快训练速度(例如，将我的笔记本电脑与我进行基准测试的模型上支持GPU的计算实例进行比较，每个时期从18分钟缩短到40秒)，并且由于速度的提高还节省了资金。</p><p id="4e42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要请求增加配额，请单击“？”(问号)并选择“新建支持请求”。"</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/d8f4eeb9479a74cb1aaca34e6e5dae87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SSrLc0aCd5wEOTYbyhACYA.png"/></div></div></figure><ul class=""><li id="228a" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu nx ny nz oa bi translated">对于<code class="fe ob oc od oe b">Issue type</code>,选择<code class="fe ob oc od oe b">Service and Subscription Limits (quotas)</code></li><li id="13f0" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu nx ny nz oa bi translated">对于<code class="fe ob oc od oe b">Quota type</code>,选择<code class="fe ob oc od oe b">Machine Learning services</code></li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/4c3e3b56474cbf8bd19bf1452ffc30c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0mzV8ifEs2fFu1fzji9Q3A.png"/></div></div></figure><p id="047c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的屏幕上</p><ul class=""><li id="11ab" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu nx ny nz oa bi translated">选择<code class="fe ob oc od oe b">Enter Details</code></li><li id="f10c" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu nx ny nz oa bi translated">选择您首选的数据中心位置。请记住您选择的位置，以后会用到它。我在这个演示中使用了<code class="fe ob oc od oe b">East US</code>。</li><li id="14c1" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu nx ny nz oa bi translated">从VM系列下拉菜单中选择<code class="fe ob oc od oe b">NCPromo</code>。</li><li id="d94c" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu nx ny nz oa bi translated">为此计算类型选择您希望能够并发运行的CPU内核数量。在这种计算类型中，每个GPU有6个CPU内核，因此对于一个GPU，您应该输入6，对于两个GPU，输入12，依此类推。</li><li id="4b48" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu nx ny nz oa bi translated">点击<code class="fe ob oc od oe b">Save and continue</code></li><li id="1ce0" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu nx ny nz oa bi translated">点击下一步:<code class="fe ob oc od oe b">Review + create &gt;&gt;</code></li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/aac1596aa550749b30855b59b6694f53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lxB4z-_zUH3ts_DFSLxSiw.png"/></div></div></figure><blockquote class="om on oo"><p id="ecbf" class="kz la op lb b lc ld ju le lf lg jx lh oq lj lk ll or ln lo lp os lr ls lt lu im bi translated">注意:该笔记本可以在配备了新帐户的标准DSv2虚拟机上运行，您的模型将需要相当长的时间来训练。</p></blockquote><h2 id="6c45" class="nf lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">安装AzureML python sdk。</h2><p id="a364" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">尽管仍有可能安装AzureML sdk，但当前推荐的最佳实践是仅将您需要的组件安装到您的环境中。</p><p id="a795" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个项目，我们只需要azureml.core，它可以用pip安装，如下所示:</p><pre class="kj kk kl km gt ot oe ou ov aw ow bi"><span id="661f" class="nf lw it oe b gy ox oy l oz pa">pip install azureml.core</span></pre><h2 id="a28a" class="nf lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">设置Azure环境</h2><p id="b300" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在我们将模型传递给Azure进行训练之前，需要进行一些设置。它们是:</p><ol class=""><li id="cdc8" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu pb ny nz oa bi translated">创建工作区</li><li id="2023" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu pb ny nz oa bi translated">定义计算机目标</li><li id="90e6" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu pb ny nz oa bi translated">创建运行环境</li><li id="8ec8" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu pb ny nz oa bi translated">将您的数据上传到数据存储(可选)</li><li id="2e30" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu pb ny nz oa bi translated">定义数据集</li></ol><p id="b63e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将一步一步地介绍它们，并简要解释它们是什么以及它们如何适应整体架构。</p><h2 id="78c2" class="nf lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">创建工作区</h2><p id="55d0" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Azure上的机器学习工作区就像一个项目容器。它位于一个资源组中，包含您将在项目中使用的任何其他资源，如存储或计算。好消息是，可以使用azureml python sdk轻松地创建工作空间及其资源组。</p><p id="98c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像这个设置部分中的所有内容一样，工作区只需要创建一次。把<code class="fe ob oc od oe b">[your-subscription-id]</code>换成，嗯……你能想出来。如果您愿意，您还可以将资源组名称和工作区名称更改为类似于<code class="fe ob oc od oe b">test123</code>这样有创意的名称。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pc pd l"/></div></figure><p id="2553" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将要求您进行身份验证，然后将您的连接信息存储在。azureml子目录，这样你就不用再次认证了。</p><h2 id="37a0" class="nf lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">定义计算目标</h2><p id="77c4" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">计算目标定义了将运行您的培训脚本的虚拟机的类型。</p><ul class=""><li id="de8d" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu nx ny nz oa bi translated"><code class="fe ob oc od oe b">compute_name</code>是用户定义的，可以是对你有意义的任何东西。这是您将来引用计算集群的方式。</li><li id="d9d0" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu nx ny nz oa bi translated"><code class="fe ob oc od oe b">vm_size</code>是您想要在计算集群中使用的计算类型的Azure特定名称。我们正在使用<code class="fe ob oc od oe b">Standard_NC6_Promo</code>，它对应于我们在上面请求配额的计算类型。它有6个CPU核心和一个特斯拉K80 GPU。</li><li id="0dbb" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu nx ny nz oa bi translated"><code class="fe ob oc od oe b">min_nodes</code>是即使没有要处理的内容也将保持活动状态的节点数。这可以减少培训的启动时间，但无论您是否使用这些节点，您都需要付费。我推荐0入门。</li><li id="81f1" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu nx ny nz oa bi translated"><code class="fe ob oc od oe b">max_nodes</code>是该计算目标中一次可以运行的最大节点数。<code class="fe ob oc od oe b">max_nodes</code>必须小于您的cpu配额/每个节点的CPU数量，否则配置将失败。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pc pd l"/></div></figure><h2 id="2b1b" class="nf lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">创建运行环境</h2><p id="64de" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">运行环境定义了脚本和要使用的基本docker映像的依赖关系。微软提供了几个<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/machine-learning/resource-curated-environments" rel="noopener ugc nofollow" target="_blank">策划环境</a>，但是因为ImageDataGenerator需要<code class="fe ob oc od oe b">Pillow,</code>而<code class="fe ob oc od oe b">Pillow</code>不包含在策划环境中，所以我们必须创建自己的容器。</p><ul class=""><li id="d5e5" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu nx ny nz oa bi translated"><code class="fe ob oc od oe b">name</code>传递给<code class="fe ob oc od oe b">Environment</code>的是用户为您的环境定义的名称。我们稍后将使用它来访问环境。</li><li id="a392" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu nx ny nz oa bi translated"><code class="fe ob oc od oe b">CondaDependencies</code>为您的脚本定义pip、conda和pip包依赖关系。</li><li id="293d" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu nx ny nz oa bi translated"><code class="fe ob oc od oe b">env.docker.base_image</code>定义docker容器用作基本图像。这可以来自于<a class="ae ky" href="https://github.com/Azure/AzureML-Containers" rel="noopener ugc nofollow" target="_blank"> AzureML-Containers repo </a>。(您也可以使用一个定制容器<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/machine-learning/how-to-deploy-custom-docker-image#use-an-image-with-the-azure-machine-learning-sdk" rel="noopener ugc nofollow" target="_blank">但是这超出了本文的范围)</a></li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pc pd l"/></div></figure><h2 id="32d5" class="nf lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">将数据上传到数据存储</h2><p id="448c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">AzureML Studio架构中需要理解的一个重要细节是数据存储和数据集之间的区别。<em class="op">一个</em> <strong class="lb iu"> <em class="op">数据存储</em> </strong> <em class="op">是存储</em>。它有多种类型，但是它存储你的数据。</p><p id="b4a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="op"/><strong class="lb iu"><em class="op">数据集</em> </strong> <em class="op">是对存储在数据存储或任何可公开访问的url中的数据</em>的引用。</p><p id="2ed7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个工作区都有一个默认的blob数据存储，这就是我们将在本演示中使用的。</p><ul class=""><li id="7f56" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu nx ny nz oa bi translated">我们用<code class="fe ob oc od oe b">get_default_datastore()</code>获取对默认工作区数据存储的引用</li></ul><p id="3b65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们通过调用数据存储对象上的<code class="fe ob oc od oe b">upload</code>来上传文件，方法是:</p><ul class=""><li id="dd1a" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu nx ny nz oa bi translated"><code class="fe ob oc od oe b">src_dir</code>是上传的本地路径</li><li id="5f20" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu nx ny nz oa bi translated"><code class="fe ob oc od oe b">target_path</code>是您的数据将被上传到数据存储的路径</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pc pd l"/></div></figure><h2 id="e6ee" class="nf lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">定义数据集</h2><p id="7dae" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">现在我们已经上传了数据，我们需要创建指向数据的数据集定义。</p><ul class=""><li id="e034" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu nx ny nz oa bi translated">要创建数据集，调用<code class="fe ob oc od oe b">Dataset.File.from_files</code>并传入一个带有我们的<code class="fe ob oc od oe b">datastore</code>对象和数据存储中数据的路径的元组。</li><li id="513a" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu nx ny nz oa bi translated">然后我们注册数据存储区，这样我们就可以在以后访问它，而不必重新创建它。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pc pd l"/></div></figure><p id="c2e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一次性设置的结束。现在我们有了一个工作区，我们可以在<a class="ae ky" href="https://ml.azure.com/" rel="noopener ugc nofollow" target="_blank">ml.azure.com</a>查看它，它包含一个<code class="fe ob oc od oe b">compute_target</code>，以及一个注册的<code class="fe ob oc od oe b">Environment</code>和<code class="fe ob oc od oe b">Dataset</code>。</p><h1 id="6abb" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">训练模特</h1><p id="10ed" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">此时，在github库中，我创建了一个新的jupyter笔记本。这是为了展示加载我们已经创建的所有资产是多么简单。看看这个:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pc pd l"/></div></figure><h2 id="25ac" class="nf lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">定义一个实验名称</h2><p id="9bbd" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">模型的每次运行都存在于一个实验中。实验就像你跑步的文件夹，让你保持跑步有条理。例如，您可以为CNN迭代创建一个实验，为LSTM迭代创建另一个实验。在这个演示中，我们将创建一个名为“回收”的实验你可以用任何对你有意义的方式对你的跑步进行分组。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pc pd l"/></div></figure><h2 id="1be5" class="nf lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">创建控制脚本</h2><p id="13a4" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">控制脚本是一个独立的python文件(或多个文件)，它被上传到Azure，并在AMLcompute实例上运行以训练您的模型。您可以将参数作为命令行参数发送到您的脚本，我们将在下面看到。</p><p id="6284" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我在这个演示中使用的控制脚本。它执行以下操作:</p><ul class=""><li id="d834" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu nx ny nz oa bi translated">解析传递给脚本的参数</li><li id="1157" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu nx ny nz oa bi translated">为数据创建ImageDataGenerators</li><li id="f34d" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu nx ny nz oa bi translated">建立一个模型</li><li id="600d" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu nx ny nz oa bi translated">符合模型</li><li id="4f83" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu nx ny nz oa bi translated">保存模型及其历史</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pc pd l"/></div></figure><h2 id="6251" class="nf lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">发给Azure！</h2><p id="7504" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">现在我们将它发送到Azure以在云中运行！</p><p id="89ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">一个重要的细节</strong>是控制脚本如何获得数据路径。我们将带有挂载类型的<code class="fe ob oc od oe b">Dataset</code>对象传递给脚本。它将自动为您装载，并且装载路径将代替您的参数中的数据集。这是非常方便的，也没有解释在哪里(至少我找不到)。</p><p id="7b2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">参数按照您在命令行中编写的顺序传递。参数名和值分别传递，但作为一个列表按顺序传递。</p><blockquote class="om on oo"><p id="b155" class="kz la op lb b lc ld ju le lf lg jx lh oq lj lk ll or ln lo lp os lr ls lt lu im bi translated">第一次运行模型时，Azure会构建它的计算容器。这可能需要相当长的时间，但azure会缓存容器，因此后续运行会更快。</p></blockquote><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pc pd l"/></div></figure><h1 id="a736" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">检查培训情况</h1><p id="651c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">要查看培训并监控培训日志，您可以登录Azure Machine Learning Studio。</p><ol class=""><li id="183d" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu pb ny nz oa bi translated">前往<a class="ae ky" href="https://portal.azure.com/" rel="noopener ugc nofollow" target="_blank">https://portal.azure.com/</a>并登录</li><li id="2526" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu pb ny nz oa bi translated">搜索“机器学习”，选择“机器学习”</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/4dd146d78d3cb9c85aeb5a1479808b98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*bpchGb_qZPF1_5MBELPzCA.png"/></div></figure><ol class=""><li id="d91d" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu pb ny nz oa bi translated">选择“azure_trash_demo”</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/33f1dce4f55c133f7c35ea9863ca2c33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aWLATdtSd4iDwxAF0YTW8A.png"/></div></div></figure><ul class=""><li id="a22d" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu nx ny nz oa bi translated">选择“启动工作室”</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/cd37faf21f072f3db71aa5f8c09f78e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RbsScKogxlK0PAwoP5bSXQ.png"/></div></div></figure><ul class=""><li id="4fcd" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu nx ny nz oa bi translated">从左侧菜单中选择<code class="fe ob oc od oe b">Experiments</code></li><li id="ddab" class="ns nt it lb b lc of lf og li oh lm oi lq oj lu nx ny nz oa bi translated">选择<code class="fe ob oc od oe b">recycling</code></li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/96884f589dbbc4da6a8ec5165c6c4b24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MIY9dZ7LiBvoOfgeJQQk3A.png"/></div></div></figure><p id="3907" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你的模型在云中运行。</p><p id="beab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此时，我们没有记录存储任何指标，因此您在这里看到的只是运行时间。在另一篇文章中，我将深入探讨如何使用这个仪表板实时监控你的跑步。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/8bfa844a5a1000c3db611f4c246cf5a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aKo2G2sijx3eOrVZcFv2HA.png"/></div></div></figure><h2 id="8c91" class="nf lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">监控机器学习工作室中的日志</h2><p id="dc62" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">要在模型训练时实时查看日志，请单击运行ID，然后单击输出+日志。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/7b94890234cccbc1c6a44c30c582a1cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4hFnqlAiF5xaOcTWlPeUXA.png"/></div></div></figure><p id="a9cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以通读所有的tensorflow控制台吐槽，看看我们确实是在GPU上训练。日志将定期更新，无需您的参与。</p><p id="f882" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">下载您的模型和日志</strong></p><p id="e63c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个模型对我们没有太大的帮助。最后一步是将训练好的模型和模型历史放回我们的本地计算机，这样我们就可以用惊人的回收预测给我们的朋友留下深刻印象。</p><p id="f930" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦模型训练完成，我们可以下载训练过程中生成的所有文件，包括日志，以及由我们的训练脚本保存到<code class="fe ob oc od oe b">outputs/</code>路径的任何内容，代码如下。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pc pd l"/></div></figure><p id="8242" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">加载模型</strong></p><p id="8cb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经有了可以加载到模型中的文件和训练好的权重。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pc pd l"/></div></figure><pre class="kj kk kl km gt ot oe ou ov aw ow bi"><span id="2952" class="nf lw it oe b gy ox oy l oz pa">Model: "sequential"<br/>_________________________________________________________________<br/>Layer (type)                 Output Shape              Param #   <br/>=================================================================<br/>conv2d (Conv2D)              (None, None, None, 32)    416       <br/>_________________________________________________________________<br/>max_pooling2d (MaxPooling2D) (None, None, None, 32)    0         <br/>_________________________________________________________________<br/>flatten (Flatten)            (None, None)              0         <br/>_________________________________________________________________<br/>dense (Dense)                (None, 6)                 3096774   <br/>=================================================================<br/>Total params: 3,097,190<br/>Trainable params: 3,097,190<br/>Non-trainable params: 0<br/>_________________________________________________________________</span></pre><p id="c7f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">绘制训练历史</strong></p><p id="1417" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以绘制训练历史。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pc pd l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/63fa212338ae6231bc6076d8db9cf2f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*tTRjPUlPYzk4vylEoIMN4g.png"/></div></figure><p id="ddaf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者任何你想要的东西。</p><h1 id="a8c4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">包装它</h1><p id="df7b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我希望这能让你在未来更快的训练！弄清楚这一切可能会很麻烦，但是希望这篇文章能加快你的速度。</p><p id="732f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你知道你可以不止一次为媒体上的文章鼓掌吗？来吧，试试看！给它一些掌声，就像你真的在鼓掌一样。我会听到它，并感谢掌声。</p><h2 id="f72c" class="nf lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">Github回购</h2><p id="faf0" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">您可以查看完整的<a class="ae ky" href="https://github.com/benbogart/getting_started_with_azure_for_ml/" rel="noopener ugc nofollow" target="_blank"> github资源库</a>或者直接跳到下面的第一个笔记本:</p><div class="mt mu gp gr mv mw"><a href="https://github.com/benbogart/getting_started_with_azure_for_ml/blob/master/1_Getting_started_with_Azure_for_Machine_Learning.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd iu gy z fp nb fr fs nc fu fw is bi translated">benbogart/getting _ started _ with _ azure _ for _ ml</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">中型文章《Azure机器学习入门》附带的笔记本…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">github.com</p></div></div></div></a></div><p id="25b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在去做好事吧。</p></div></div>    
</body>
</html>