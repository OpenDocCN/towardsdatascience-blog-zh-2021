<html>
<head>
<title>Hands-on Survival Analysis with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python进行实际生存分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/hands-on-survival-analysis-with-python-270fa1e6fb41?source=collection_archive---------6-----------------------#2021-07-03">https://towardsdatascience.com/hands-on-survival-analysis-with-python-270fa1e6fb41?source=collection_archive---------6-----------------------#2021-07-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2c0d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">公司能从员工流动数据中学到什么</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5e09ee9f995576e5d7c790ba7fac9c75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zqk9SXBRdwmuaxd_phazag.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@boxedwater?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">盒装水更好</a>上<a class="ae ky" href="https://unsplash.com/s/photos/nature?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="83af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">生存分析是一种流行的统计方法，用于调查感兴趣的事件发生之前的预期持续时间。我们可以从医学中回忆起病人的生存时间分析，从工程学中回忆起可靠性分析或无故障时间分析，从经济学中回忆起持续时间分析。</p><p id="2e4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了这些学科之外，生存分析还可以被人力资源团队用来了解和创造关于他们的员工参与度、保留率和满意度的洞察力——这是当今的一个热门话题🌶 🌶 🌶</p><p id="442c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据Achievers<a class="ae ky" href="https://www.achievers.com/resources/white-papers/workforce-institute-2021-engagement-and-retention-report/" rel="noopener ugc nofollow" target="_blank">的员工参与度和保留率报告</a>，52%的员工计划在2021年寻找新工作，最近一项由31个国家的30，000多名员工参与的调查显示，40%的员工正在考虑辞职。《福布斯》将这种趋势称为“<a class="ae ky" href="https://www.forbes.com/sites/karadennison/2021/04/27/why-the-2021-turnover-tsunami-is-happening-and-what-business-leaders-can-do-to-prepare/?sh=7fc949fa4e6d" rel="noopener ugc nofollow" target="_blank">离职海啸</a>”，主要是由疫情的倦怠和Linkedin专家预测大规模人才迁移的到来，并在<a class="ae ky" href="https://www.linkedin.com/signup/cold-join?session_redirect=https%3A%2F%2Fwww%2Elinkedin%2Ecom%2Ffeed%2Fhashtag%2Fgreatresignation&amp;trk=storyline-update_share-update_update-text" rel="noopener ugc nofollow" target="_blank">#大辞职</a>和<a class="ae ky" href="https://www.linkedin.com/signup/cold-join?session_redirect=https%3A%2F%2Fwww%2Elinkedin%2Ecom%2Ffeed%2Fhashtag%2Fgreatreshuffle&amp;trk=storyline-update_share-update_update-text" rel="noopener ugc nofollow" target="_blank">#大洗牌</a>主题下进行讨论。</p><p id="e0f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一如既往,<strong class="lb iu">数据</strong>有助于了解员工敬业度&amp;保留率，以减少人员流动，建立更敬业、更投入、更满意的团队。</p><p id="66d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">人力资源团队可以从员工流动数据中挖掘的一些示例如下:</p><ul class=""><li id="be6e" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><em class="me">留下/离开</em>的员工的某些特征是什么？</li><li id="e952" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ma mb mc md bi translated">不同员工群体之间的流失率有相似之处吗？</li><li id="2631" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ma mb mc md bi translated">员工在一定时间后离职的概率有多大？(即两年后)</li></ul><p id="e1b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将构建一个生存分析来帮助回答这些问题。您也可以在我的GitHub上查看<a class="ae ky" href="https://github.com/Idilismiguzel/Machine-Learning/blob/master/Survival_Analysis/Survival_Analysis.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本</a>以获得完整的分析。开始吧！☕️</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mk"><img src="../Images/aba4c85b3d500598a6a051a5d6e9be31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QQa0wVzGDiHXcTRm"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@dsmacinnes?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">丹妮尔·麦金尼斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="2f16" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">数据选择👥</h1><p id="37e6" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">我们将使用一个虚构的<a class="ae ky" href="https://www.kaggle.com/pavansubhasht/ibm-hr-analytics-attrition-dataset/tasks" rel="noopener ugc nofollow" target="_blank">员工流失率&amp;绩效数据集</a>来探索员工流失率和重要的员工特征，以预测当前员工的生存时间。</p><h1 id="a745" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">背景</h1><p id="8425" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">在对生存函数建模之前，让我们先了解生存分析背后的一些基本术语和概念。</p><ul class=""><li id="c8d9" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">事件</strong>是感兴趣的体验，如生存/死亡或留下/辞职</li><li id="5bdf" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ma mb mc md bi translated"><strong class="lb iu">存活时间</strong>是指感兴趣事件发生前的持续时间，即员工离职前的持续时间</li></ul><h2 id="8441" class="ni mm it bd mn nj nk dn mr nl nm dp mv li nn no mx lm np nq mz lq nr ns nb nt bi translated">审查问题🚫</h2><p id="9e05" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">如果某些个体的事件没有被记录，则删失观察<strong class="lb iu"> </strong>发生在事件时间数据中。这可能是由于两个主要原因:</p><ul class=""><li id="6795" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">事件尚未发生(即存活时间未知/对尚未辞职的人具有误导性)</li><li id="517f" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ma mb mc md bi translated">丢失数据(即丢失)或失去联系</li></ul><p id="7319" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有三种类型的审查:</p><ol class=""><li id="a82f" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nu mb mc md bi translated"><strong class="lb iu"> <em class="me">左删截:</em> </strong> <em class="me">存活持续时间小于观察持续时间</em></li><li id="4b2e" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu nu mb mc md bi translated"><strong class="lb iu"> <em class="me">右删:</em> </strong>生存持续时间大于观察持续时间</li><li id="c33b" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu nu mb mc md bi translated"><strong class="lb iu"> <em class="me">区间-删失:</em> </strong> <em class="me">存活持续时间无法确切定义</em></li></ol><p id="7d61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最常见的类型是右删失型，通常由生存分析来处理。但是，另外两个可能表明数据中存在问题，可能需要进一步调查。</p><h2 id="3469" class="ni mm it bd mn nj nk dn mr nl nm dp mv li nn no mx lm np nq mz lq nr ns nb nt bi translated">生存函数</h2><p id="a436" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated"><strong class="lb iu"> <em class="me"> T </em> </strong>是事件发生时，<strong class="lb iu"> <em class="me"> t </em> </strong>是观察期间的任意时间点，生存<strong class="lb iu"> <em class="me"> S(t) </em> </strong>是<em class="me"> T </em>大于<em class="me"> t. </em>的概率，换句话说，生存函数是个体在时间<em class="me"> t. </em>后存活的概率</p><blockquote class="nv"><p id="1795" class="nw nx it bd ny nz oa ob oc od oe lu dk translated">S(t) = Pr(T &gt; t)</p></blockquote><p id="5116" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">生存曲线的图示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/7b141f80262552b771c8e833df6f1deb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GHfFn5Rbf-5qnHy_g3jxUA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">个体存活超过2年的概率是60%——图片由作者提供</p></figure><p id="77d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">生存函数的一些重要特征:🔆</p><ul class=""><li id="7bd6" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">T ≥ 0且0 &lt; t &lt; ∞</li><li id="cb45" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ma mb mc md bi translated">It is non-increasing</li><li id="529a" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ma mb mc md bi translated">If  【T0】 , then  【T1】 (survival probability is 1 at time 0)</li><li id="870a" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ma mb mc md bi translated">If  【T2】 ∞, then  【T3】 (survival probability goes to 0 as time goes to infinity</li></ul><h2 id="c871" class="ni mm it bd mn nj nk dn mr nl nm dp mv li nn no mx lm np nq mz lq nr ns nb nt bi translated">Hazard Function</h2><p id="0594" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">Hazard function or hazard rate, <strong class="lb iu">和0<em class="me">h(t)</em></strong><em class="me">，</em>是存活到时间<em class="me"> t </em>并且恰好在时间<em class="me"> t </em>经历感兴趣事件的个体的概率。危险函数和生存函数可以通过下面的公式相互推导。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/3c104f75df712525e9ee90e33939a42d.png" data-original-src="https://miro.medium.com/v2/resize:fit:396/format:webp/1*lj-oT1i04SpEHp6gfxJQzQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">冒险函数</p></figure><h1 id="fa86" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">卡普兰-迈耶估计量</h1><p id="4857" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">作为一个非参数估计量，Kaplan-Meier不需要对数据的分布进行初始假设。它还通过从观察到的存活时间计算存活概率来处理右删失观察。它使用来自概率的乘积法则，事实上，它也被称为乘积限估计量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/713f1c4f9fccf59e8783b26cc3272d9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/0*9G613SxskreWMW-T.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">生存概率作为时间t</p></figure><p id="b970" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中:</p><ul class=""><li id="9844" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">d _ I</strong>:t _ I时刻发生的事件数</li><li id="be8b" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ma mb mc md bi translated"><strong class="lb iu"> n_i </strong>:存活到时间t_i的受试者人数</li></ul><p id="9605" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以认为在时间<em class="me"> t_i </em>的生存概率等于在先前时间<em class="me"> t_i-1 </em>的生存概率和在时间<em class="me"> t_i </em>的生存几率百分比的乘积。<em class="me">👇</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/ea3b0cae1e3440ba32a65ba3b0646424.png" data-original-src="https://miro.medium.com/v2/resize:fit:726/format:webp/1*-rjQs1Six5EQ7Wrp7NnvQw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">t=2的生存概率是t=1的生存概率乘以t=2时生存的百分比机会。</p></figure><h2 id="d919" class="ni mm it bd mn nj nk dn mr nl nm dp mv li nn no mx lm np nq mz lq nr ns nb nt bi translated">KMF的生存函数</h2><p id="6d03" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">我们可以用卡普兰-迈耶钳工模型使用<code class="fe ol om on oo b">lifelines</code>包。在对数据进行kmf拟合时，我们应该指定<strong class="lb iu">持续时间</strong>(在公司度过的年数)和<strong class="lb iu">事件观察值</strong>(损耗值:1或0)。</p><pre class="kj kk kl km gt os oo ot ou aw ov bi"><span id="20e5" class="ni mm it oo b gy ow ox l oy oz">from lifelines import KaplanMeierFitter</span><span id="ef5e" class="ni mm it oo b gy pa ox l oy oz"># Initiate and fit<br/>kmf = KaplanMeierFitter()<br/>kmf.fit(durations=df.YearsAtCompany, event_observed=df.Attrition)</span><span id="8551" class="ni mm it oo b gy pa ox l oy oz"># Plot the survival function<br/>kmf.survival_function_.plot()<br/>plt.title('Survival Curve estimated with Kaplan-Meier Fitter')<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/9b46981d589624725620cafe9c00b8ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*oCC5JadFxWU_O-UEmC65xw.png"/></div></figure><pre class="kj kk kl km gt os oo ot ou aw ov bi"><span id="f19b" class="ni mm it oo b gy ow ox l oy oz"># Print survival probabilities at each year<br/>kmf.survival_function_</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/638e46ded209b8ca0997de997f0308cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:438/format:webp/1*2jFfpFpJCNzqXr07Tqe0TA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">时间线一直延续到第40年。</p></figure><p id="b901" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到，个人在公司存活超过2年的概率是92%，而存活超过10年的概率下降到77%。</p><p id="7261" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以用置信区间画出生存函数。</p><pre class="kj kk kl km gt os oo ot ou aw ov bi"><span id="8831" class="ni mm it oo b gy ow ox l oy oz"># Plot the survival function with confidence intervals<br/>kmf.plot_survival_function()<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/bc7850de256634db3af976b001e912be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*UakxUIaIyoDLLlW76Uh--Q.png"/></div></figure><p id="8472" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，较宽的置信区间表明模型在那时不太确定，通常是因为数据点较少。</p><h2 id="bfbf" class="ni mm it bd mn nj nk dn mr nl nm dp mv li nn no mx lm np nq mz lq nr ns nb nt bi translated">KMF不同人群的生存功能</h2><p id="dc30" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">我们可以绘制不同群体(如性别)的生存曲线，看看概率是否会改变。</p><p id="b97e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们根据环境满意度栏来做，我们有以下输入:</p><blockquote class="pe pf pg"><p id="a208" class="kz la me lb b lc ld ju le lf lg jx lh ph lj lk ll pi ln lo lp pj lr ls lt lu im bi translated">1= '低'<br/> 2= '中等'<br/> 3= '高'<br/> 4= '非常高'</p></blockquote><p id="e556" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了简单起见，我将把“低环境满意度”下的“低”和“中”放在一起，把“高环境满意度”下的“高”和“非常高”放在一起。</p><pre class="kj kk kl km gt os oo ot ou aw ov bi"><span id="1f94" class="ni mm it oo b gy ow ox l oy oz"># Define the low and high satisfaction<br/>Low = ((df.EnvironmentSatisfaction == 1) | (df.EnvironmentSatisfaction == 2))</span><span id="2e4c" class="ni mm it oo b gy pa ox l oy oz">High = ((df.EnvironmentSatisfaction == 3) | (df.EnvironmentSatisfaction == 4))</span><span id="59e0" class="ni mm it oo b gy pa ox l oy oz"># Plot the survival function<br/>ax = plt.subplot()</span><span id="2c70" class="ni mm it oo b gy pa ox l oy oz">kmf = KaplanMeierFitter()<br/>kmf.fit(durations=df[Low].YearsAtCompany,<br/>event_observed=df[Low].Attrition, label='Low Satisfaction')<br/>kmf.survival_function_.plot(ax=ax)</span><span id="e075" class="ni mm it oo b gy pa ox l oy oz">kmf.fit(durations=df[High].YearsAtCompany, event_observed=df[High].Attrition, label='High Satisfaction')<br/>kmf.survival_function_.plot(ax=ax)</span><span id="2363" class="ni mm it oo b gy pa ox l oy oz">plt.title('Survival Function based on Environmental Satisfaction')<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/2d11db670ecf026812f990553349a450.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*OQVklAC_gFLtOdWAFu8YxA.png"/></div></figure><p id="c780" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们所见，高环境满意度的个体比低满意度的个体有更高的生存概率。</p><p id="d675" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以对“性别”和“工作-生活平衡”进行同样的分析。</p><div class="kj kk kl km gt ab cb"><figure class="pl kn pm pn po pp pq paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/3131f78b6f45b61ee61348bf8c4cfae8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*pSXjsuBtw9VsLRpWZCDsDA.png"/></div></figure><figure class="pl kn pm pn po pp pq paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/f829fd0c73dbfada7cba5fdbc6b28c2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*1ipwa4hbCvPD8d_SO9avqA.png"/></div></figure></div><p id="980e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的工作生活平衡图中，我们可以看到，与工作生活平衡度低的人相比，工作生活平衡度高的人倾向于在公司呆得更久。</p><p id="0e5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，在性别情节中，男性和女性的生存曲线几乎是齐头并进的，这使得很难理解是否存在差异。为了研究这个问题，我们可以运行一个<strong class="lb iu">对数秩假设检验</strong>。</p><p id="f23e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">零假设表明男性和女性生存曲线是相同的，替代假设表明它们不相同。如果对数秩检验的p值低于0.05，我们可以拒绝零假设。</p><pre class="kj kk kl km gt os oo ot ou aw ov bi"><span id="3555" class="ni mm it oo b gy ow ox l oy oz">from lifelines.statistics import logrank_test</span><span id="7208" class="ni mm it oo b gy pa ox l oy oz"># Define logrank test<br/>output = logrank_test(<br/>durations_A = df[male].YearsAtCompany,<br/>durations_B = df[female].YearsAtCompany,<br/>event_observed_A = df[male].Attrition,<br/>event_observed_B = df[female].Attrition)</span><span id="1f7b" class="ni mm it oo b gy pa ox l oy oz">output.print_summary</span></pre><blockquote class="nv"><p id="a484" class="nw nx it bd ny nz pr ps pt pu pv lu dk translated">p值= 0.18</p></blockquote><blockquote class="pe pf pg"><p id="4a93" class="kz la me lb b lc of ju le lf og jx lh ph oh lk ll pi oi lo lp pj oj ls lt lu im bi translated"><em class="it"> p值大于0.05，我们</em> <strong class="lb iu"> <em class="it">不拒绝</em> </strong> <em class="it">的零假设。换句话说，我们不拒绝男性和女性生存曲线相同的假设。☑️ </em></p></blockquote><p id="7a0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们对“工作-生活平衡”进行对数秩检验；我们发现p值是0.04。它低于0.05，所以我们拒绝零假设。换句话说，我们<strong class="lb iu">拒绝</strong>低工作-生活和高工作-生活平衡的个体的生存曲线相同的假设。</p><p id="1887" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们有两个以上的组(如低、中、高工作-生活平衡)，我们可以使用<code class="fe ol om on oo b">pairwise_lograng_test()</code>或<code class="fe ol om on oo b">multivariate_logrank_test().</code></p><h1 id="1152" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">Cox比例风险模型</h1><p id="8a7a" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">Cox-PH模型是发现个体的存活时间和预测变量之间的关系的回归模型。它适用于分类和数字预测变量。我们将使用Cox-PH模型不仅调查哪些因素对生存有高低影响，而且预测当前员工未来的生存概率。</p><h2 id="f4ff" class="ni mm it bd mn nj nk dn mr nl nm dp mv li nn no mx lm np nq mz lq nr ns nb nt bi translated">用Cox-PH模型预测生存时间</h2><p id="66f6" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">让我们选择一组我们想要研究的列。出于个人好奇，我挑选了以下几个:</p><pre class="kj kk kl km gt os oo ot ou aw ov bi"><span id="6420" class="ni mm it oo b gy ow ox l oy oz">columns_selected = ['Attrition', 'EnvironmentSatisfaction', 'JobInvolvement', 'JobLevel', 'JobSatisfaction', 'PercentSalaryHike', 'RelationshipSatisfaction', 'StockOptionLevel', 'TrainingTimesLastYear', 'YearsAtCompany']</span><span id="2df5" class="ni mm it oo b gy pa ox l oy oz">df = df[columns_selected]</span></pre><p id="82ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将选择的数据拟合到<code class="fe ol om on oo b">CoxPHFitter</code>，并指定生存持续时间和事件列。</p><pre class="kj kk kl km gt os oo ot ou aw ov bi"><span id="ac3c" class="ni mm it oo b gy ow ox l oy oz">from lifelines import CoxPHFitter</span><span id="19a5" class="ni mm it oo b gy pa ox l oy oz"># Initialize and fit the model<br/>coxph = CoxPHFitter()<br/>coxph.fit(df, duration_col='YearsAtCompany', event_col='Attrition')</span><span id="34e8" class="ni mm it oo b gy pa ox l oy oz"># Print model summary<br/>coxph.print_summary()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pw"><img src="../Images/23064121700880a432cd91075814ab34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PfzwEBCs8GVtvCqVkzzPmg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">模型摘要</p></figure><p id="77ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在模型总结中，exp(coef)是风险比，它表示由于相应因子的一个单位变化，基线风险变化的程度。例如，如果环境满意度改变一个单位:</p><ul class=""><li id="c845" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">危险比率:0.79</li><li id="d9d5" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ma mb mc md bi translated">危险变化:0.79–1 =-0.21</li><li id="26be" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ma mb mc md bi translated">存活时间变化:(1/0.79)-1 = 0.26 →存活时间增加26%</li></ul><p id="910a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">模型总结还显示了因素变量的重要性。查看<strong class="lb iu"> p </strong>我们可以了解到“加薪百分比”和“关系满意度”并不显著。我们也可以从下面的因素效应图中看到这一点。</p><pre class="kj kk kl km gt os oo ot ou aw ov bi"><span id="1dd6" class="ni mm it oo b gy ow ox l oy oz"># Plot factor effects <br/>coxph.plot()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi px"><img src="../Images/b3b727eee418b831c8d88aff2c90c7ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*OwVpp5_AlzQlUV4VyHeyFw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">因子效应(较低的效应接近于0)</p></figure><p id="8dc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了预测员工的生存概率，我们需要创建一个包含当前员工的新数据框架:其中自然减员为0，数组指定“在公司的年数”。之后，我们可以预测存活时间。我们需要在<code class="fe ol om on oo b">predict_survival_function</code>中指定在公司工作的年数，以便相应地开始每个人的时间表。</p><pre class="kj kk kl km gt os oo ot ou aw ov bi"><span id="bf40" class="ni mm it oo b gy ow ox l oy oz"># Current employees<br/>df_new = df.loc[df['Attrition'] == 0]</span><span id="382f" class="ni mm it oo b gy pa ox l oy oz"># Years at the company of current employees<br/>df_new_obs = df_new['YearsAtCompany']</span><span id="e832" class="ni mm it oo b gy pa ox l oy oz"># Predict survival probabilities <br/>coxph.predict_survival_function(df_new,conditional_after=df_new_obs)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi py"><img src="../Images/e152107eca3a54ea91f343c38902b887.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*Zw0nKJhez9BZq2EGyPd86A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">预测—列是员工，索引是时间线</p></figure><p id="34b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">员工1在10年后的预计生存概率是80%，而员工4的生存概率是53%</p><p id="9d09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像其他回归模型一样，Cox-PH模型也对数据进行初始假设。为了检查假设是否成立，我们可以使用<code class="fe ol om on oo b">check_assumptions.</code></p><pre class="kj kk kl km gt os oo ot ou aw ov bi"><span id="b8a3" class="ni mm it oo b gy ow ox l oy oz"># Check the Cox-PH model assumptions<br/>coxph.check_assumptions(df)</span></pre><blockquote class="pe pf pg"><p id="db13" class="kz la me lb b lc ld ju le lf lg jx lh ph lj lk ll pi ln lo lp pj lr ls lt lu im bi translated">比例风险假设看起来不错。</p></blockquote><p id="c4b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们很好！🌴</p><p id="ff4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">否则，我们可能需要操纵一些变量。</p><h1 id="f80f" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">结论</h1><p id="4d27" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">在这篇文章中，我们回答了一些公司可能会有的关于他们的员工特征和对自然减员的影响的重要问题。我们使用Kaplan-Meier fitter计算并绘制生存概率，使用Cox-PH模型预测当前员工未来几年的生存概率。这些预测非常有见地，因为它们让我们知道哪些因素降低和增加了生存概率，以及谁是短期内处于风险中的员工。利用这些预测，公司可以付出额外的努力来防止员工流失，并最终建立更积极、更高效、更快乐的团队！🙌</p></div><div class="ab cl pz qa hx qb" role="separator"><span class="qc bw bk qd qe qf"/><span class="qc bw bk qd qe qf"/><span class="qc bw bk qd qe"/></div><div class="im in io ip iq"><h1 id="0158" class="ml mm it bd mn mo qg mq mr ms qh mu mv jz qi ka mx kc qj kd mz kf qk kg nb nc bi translated">奖金</h1><p id="a6e2" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">我们已经了解了如何分析不同群体之间生存曲线的差异。我们可以在<strong class="lb iu"> A/B测试</strong>中使用这个特性——在这里我们可以调查一个新的特性/变化是否会导致存活率的显著变化。</p><p id="1b39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你对A/B测试感兴趣，你可以阅读我下面的文章🌠</p><div class="ql qm gp gr qn qo"><a rel="noopener follow" target="_blank" href="/a-guide-to-a-b-testing-how-to-formulate-design-and-interpret-f820cc62e21a"><div class="qp ab fo"><div class="qq ab qr cl cj qs"><h2 class="bd iu gy z fp qt fr fs qu fu fw is bi translated">A/B测试指南——如何制定、设计和解释</h2><div class="qv l"><h3 class="bd b gy z fp qt fr fs qu fu fw dk translated">用Python实现</h3></div><div class="qw l"><p class="bd b dl z fp qt fr fs qu fu fw dk translated">towardsdatascience.com</p></div></div><div class="qx l"><div class="qy l qz ra rb qx rc ks qo"/></div></div></a></div><p id="6d32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你喜欢阅读生存分析，并发现这篇文章对你的分析有用！</p><p id="6bad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="me">如果你喜欢这篇文章，你可以</em> <strong class="lb iu"> <em class="me"> </em> </strong> <a class="ae ky" href="https://medium.com/@idilismiguzel" rel="noopener"> <strong class="lb iu"> <em class="me">在这里阅读我的其他文章</em></strong></a><strong class="lb iu"><em class="me"/></strong><em class="me">和</em> <a class="ae ky" href="http://medium.com/@idilismiguzel/follow" rel="noopener"> <strong class="lb iu"> <em class="me">关注我上媒</em></strong></a><strong class="lb iu"><em class="me"/></strong>如果有任何问题或建议，请告诉我。✨</p><p id="76d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">喜欢这篇文章吗？ <a class="ae ky" href="https://idilismiguzel.medium.com/membership" rel="noopener"> <strong class="lb iu">成为会员求更！</strong> </a></p></div><div class="ab cl pz qa hx qb" role="separator"><span class="qc bw bk qd qe qf"/><span class="qc bw bk qd qe qf"/><span class="qc bw bk qd qe"/></div><div class="im in io ip iq"><h2 id="6ecf" class="ni mm it bd mn nj nk dn mr nl nm dp mv li nn no mx lm np nq mz lq nr ns nb nt bi translated">参考</h2><ol class=""><li id="a08c" class="lv lw it lb b lc nd lf ne li rd lm re lq rf lu nu mb mc md bi translated"><a class="ae ky" href="https://www.achievers.com/wp-content/uploads/2021/03/Achievers-Workforce-Institute-2021-Engagement-and-Retention-Report.pdf" rel="noopener ugc nofollow" target="_blank">劳动力研究所——2021年雇佣和保留报告</a></li><li id="1e32" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu nu mb mc md bi translated"><a class="ae ky" href="https://www.weforum.org/agenda/2021/06/remote-workers-burnout-covid-microsoft-survey/" rel="noopener ugc nofollow" target="_blank">微软调查</a></li><li id="7ac5" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu nu mb mc md bi translated"><a class="ae ky" href="https://www.forbes.com/sites/karadennison/2021/04/27/why-the-2021-turnover-tsunami-is-happening-and-what-business-leaders-can-do-to-prepare/?sh=7fc949fa4e6d" rel="noopener ugc nofollow" target="_blank"/></li><li id="59c0" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu nu mb mc md bi translated"><a class="ae ky" href="https://www.linkedin.com/news/story/the-great-resignation-is-here-5480770/" rel="noopener ugc nofollow" target="_blank">Linkedin——伟大的辞呈在这里</a></li><li id="9048" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu nu mb mc md bi translated"><a class="ae ky" href="https://lifelines.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">救生索包</a></li></ol></div></div>    
</body>
</html>