<html>
<head>
<title>10 Essential PSQL Commands For Data Engineers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据工程师的 10 个基本 PSQL 命令</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/10-essential-psql-commands-for-data-engineers-c1ea42279160?source=collection_archive---------29-----------------------#2021-10-26">https://towardsdatascience.com/10-essential-psql-commands-for-data-engineers-c1ea42279160?source=collection_archive---------29-----------------------#2021-10-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="30aa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用 PSQL 通过命令行与 PostgreSQL 数据库交互。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7f2efb6ad52643bbaee0426c927a2bcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5wJ459bq74jEuccOgNLlRQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://www.pexels.com/photo/brown-leaf-on-lapotp-3219549/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae ky" href="https://www.pexels.com/@enginakyurt?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Engin Akyurt </a>拍摄</p></figure><h2 id="b4d0" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">建议的点播课程:</h2><p id="3654" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated"><em class="mo">你们中的许多人联系我，要求提供有价值的资源</em> <strong class="lx iu"> <em class="mo">来敲定基于 Python 的数据工程面试</em> </strong> <em class="mo">。下面我分享 3 个我强烈推荐的点播课程:</em></p><ul class=""><li id="63bf" class="mp mq it lx b ly mr mb ms li mt lm mu lq mv mn mw mx my mz bi translated"><a class="ae ky" href="https://imp.i115008.net/zaX10r" rel="noopener ugc nofollow" target="_blank"> <strong class="lx iu"> Python 数据工程纳米学位</strong> </a> <strong class="lx iu"> → </strong> <em class="mo">精品课程！</em></li><li id="08c7" class="mp mq it lx b ly na mb nb li nc lm nd lq ne mn mw mx my mz bi translated"><a class="ae ky" href="https://click.linksynergy.com/deeplink?id=533LxfDBSaM&amp;mid=39197&amp;murl=https%3A%2F%2Fwww.udemy.com%2Fcourse%2Fleetcode-in-python-50-algorithms-coding-interview-questions%2F" rel="noopener ugc nofollow" target="_blank"><strong class="lx iu"><em class="mo">leet code In Python:50 个算法编码面试问题</em></strong></a><strong class="lx iu"><em class="mo"/><em class="mo">→最适合涉及算法的编码回合！</em></strong></li><li id="4504" class="mp mq it lx b ly na mb nb li nc lm nd lq ne mn mw mx my mz bi translated"><a class="ae ky" href="https://platform.stratascratch.com/coding?via=antonello" rel="noopener ugc nofollow" target="_blank"> <strong class="lx iu"> <em class="mo"> Python 高级编码问题(StrataScratch)</em></strong></a><strong class="lx iu"><em class="mo">→</em></strong><em class="mo">我找到的准备 Python 的最佳平台&amp; SQL 编码面试到此为止！比 LeetCode 更好更便宜。</em></li></ul><p id="f4bf" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">希望你也会发现它们有用！现在欣赏:D 的文章</p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h1 id="76c0" class="np la it bd lb nq nr ns le nt nu nv lh jz nw ka ll kc nx kd lp kf ny kg lt nz bi translated"><strong class="ak">简介</strong></h1><p id="6982" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">在您成为数据工程师的过程中，在某些时候，您一定偶然发现了命令行(<em class="mo">也称为终端</em>)。</p><p id="16d8" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">也许是一位同事向你展示如何<a class="ae ky" rel="noopener" target="_blank" href="/connect-to-databases-using-python-and-hide-secret-keys-with-env-variables-a-brief-tutorial-4f68e33a6dc6">创建环境变量</a>？…或者教你使用本地版本控制的最佳实践？…或者你暗暗佩服他们与数据库交互的方式，看起来不费吹灰之力，也不需要现代的数据库管理系统？</p><p id="7373" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">无论您第一次接触命令行，您可能会想<em class="mo">“我想要同样的超级能力……我需要学习如何做到这一点！”。</em></p><blockquote class="oa"><p id="33bf" class="ob oc it bd od oe of og oh oi oj mn dk translated">无论您第一次遇到命令行，您可能会想<em class="ok">“我想要同样的超级能力…我需要学习如何做到这一点！”。</em></p></blockquote><p id="bd3d" class="pw-post-body-paragraph lv lw it lx b ly ol ju ma mb om jx md li on mf mg lm oo mi mj lq op ml mm mn im bi translated">为了帮助你掌握一个最基本的数据工程技能，在本文中，我将向你介绍<code class="fe oq or os ot b">psql</code>以及如何使用它通过终端与 PostgreSQL 数据库进行交互。我还将向您展示我在工作场所反复使用的 10 组命令。</p><p id="1d10" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">但首先，什么是<code class="fe oq or os ot b">psql?</code>…更重要的是，它的利弊是什么？</p><h1 id="ad2d" class="np la it bd lb nq ou ns le nt ov nv lh jz ow ka ll kc ox kd lp kf oy kg lt nz bi translated">psql 如何给你超能力</h1><p id="7f01" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">在<a class="ae ky" href="https://www.postgresql.org/docs/10/app-psql.html" rel="noopener ugc nofollow" target="_blank">PostgreSQL 官方网站</a>上，<code class="fe oq or os ot b">psql</code>被定义为 PostgreSQL 交互终端。</p><p id="9609" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">这意味着，如果您每天使用 PostgreSQL，您可以使用<code class="fe oq or os ot b">psql</code>连接到您喜欢的数据库，输入查询并通过命令行查看查询结果。但是<code class="fe oq or os ot b">psql</code>有什么好处和坏处呢？</p><h2 id="0dad" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">Psql 专业版</h2><ul class=""><li id="f9c4" class="mp mq it lx b ly lz mb mc li oz lm pa lq pb mn mw mx my mz bi translated">允许您与数据库快速交互，使您处于相同的环境中(<em class="mo">终端</em>)，而不像在标准 DBMS 中那样需要配置。这反过来加快了你的工作。</li><li id="fada" class="mp mq it lx b ly na mb nb li nc lm nd lq ne mn mw mx my mz bi translated">通过使用您最喜欢的编辑器或从文件中运行查询，允许您运行简短和更复杂的查询。</li><li id="9c5f" class="mp mq it lx b ly na mb nb li nc lm nd lq ne mn mw mx my mz bi translated">允许您通过在指定的时间间隔执行命令来跟踪表中的更改。</li><li id="f5c7" class="mp mq it lx b ly na mb nb li nc lm nd lq ne mn mw mx my mz bi translated">与标准 DBMS 相比，它可以帮助您几乎毫不费力地检索关于数据库、模式、表和用户的元数据和统计数据。</li></ul><h2 id="019f" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">Psql Cons</h2><ul class=""><li id="6581" class="mp mq it lx b ly lz mb mc li oz lm pa lq pb mn mw mx my mz bi translated">当您需要显示和分析大量列或者交互地改变输出中列的顺序时，这不是最好的工具。当查询返回少量在终端上看起来很整洁的列时,<code class="fe oq or os ot b">psql</code>非常出色。</li><li id="639f" class="mp mq it lx b ly na mb nb li nc lm nd lq ne mn mw mx my mz bi translated">当您希望将查询的输出保存到特定格式的文件中时，这不是最好的工具。尽管这是可以做到的<code class="fe oq or os ot b">psql</code> ( <em class="mo">我将在稍后展示</em>)，现代数据库管理系统提供了更广泛和用户友好的选择范围。</li></ul><p id="b2be" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">既然我多解释了一点<strong class="lx iu"> <em class="mo">当</em> </strong> <code class="fe oq or os ot b">psql</code>应该是你的首选，那我也来分享一下<strong class="lx iu"><em class="mo"/></strong>怎么用吧！</p><h1 id="ffdb" class="np la it bd lb nq ou ns le nt ov nv lh jz ow ka ll kc ox kd lp kf oy kg lt nz bi translated">装置</h1><h2 id="38d9" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">苹果个人计算机</h2><p id="13ee" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">要在 Mac 笔记本电脑上安装<code class="fe oq or os ot b">psql</code>，只需下载<code class="fe oq or os ot b">homebrew</code>，然后执行以下两条命令:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="ea7e" class="kz la it ot b gy pg ph l pi pj">$ brew install postgresql<br/>$ brew services start postgresql</span></pre><p id="3b6f" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">然后，当服务启动后，使用以下命令检查它是否已启动并正在运行:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="3048" class="kz la it ot b gy pg ph l pi pj">$ brew services</span><span id="a3c9" class="kz la it ot b gy pk ph l pi pj"><strong class="ot iu">Name       Status  User    Plist</strong></span><span id="7889" class="kz la it ot b gy pk ph l pi pj">postgresql started anbento /Users/anbento...</span></pre><h2 id="57be" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">窗户</strong></h2><p id="8015" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">要在 Windows 机器上安装<code class="fe oq or os ot b">psql</code>以及其他客户端应用程序，请遵循<a class="ae ky" href="https://www.postgresqltutorial.com/install-postgresql/" rel="noopener ugc nofollow" target="_blank">这篇优秀的教程</a>。</p><h1 id="327c" class="np la it bd lb nq ou ns le nt ov nv lh jz ow ka ll kc ox kd lp kf oy kg lt nz bi translated">你必须知道的 10 个命令</h1><p id="c383" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">与其他终端客户端应用程序一样，<code class="fe oq or os ot b">psql</code>提供了广泛的命令来与 PostgreSQL 数据库进行交互。然而，下面我试着给出了 10 个我每天最常用的命令。</p><h2 id="92ac" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"># 1 连接到 PostgreSQL 数据库</h2><p id="f057" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">与 PG 数据库交互的第一步是连接到它。</p><p id="ed14" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">请记住，如果您通常使用 SSH 隧道或任何其他类型的加密进行连接，您需要在运行下面的命令之前解决这个问题。</p><p id="845c" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">在工作场所，您很可能必须建立到驻留在特定主机上的数据库的连接。如果是这种情况，您应该使用:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="cb19" class="kz la it ot b gy pg ph l pi pj">$ <strong class="ot iu">psql -h host -d database -U user -W</strong></span></pre><p id="742e" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">例如，假设您希望使用以下凭据连接到数据库:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="215c" class="kz la it ot b gy pg ph l pi pj"><strong class="ot iu">database name:</strong> fin_db<em class="mo"><br/></em><strong class="ot iu">host:</strong> localhost<em class="mo"><br/></em><strong class="ot iu">port:</strong> 5000<em class="mo"><br/></em><strong class="ot iu">username</strong> = anbento</span></pre><p id="f93a" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">命令和输出应该是这样的:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="0b3b" class="kz la it ot b gy pg ph l pi pj">$ <strong class="ot iu">psql -h localhost -p 5000 -d fin_db -U anbento -W</strong></span><span id="ab9e" class="kz la it ot b gy pk ph l pi pj">Password for user anbento:</span><span id="541a" class="kz la it ot b gy pk ph l pi pj">psql (14.0, server 12.5 (Ubuntu 12.5–1.pgdg18.04+1))</span><span id="216d" class="kz la it ot b gy pk ph l pi pj">SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256...., bits: 256, compression: off)</span><span id="5668" class="kz la it ot b gy pk ph l pi pj">Type “help” for help.</span><span id="dba0" class="kz la it ot b gy pk ph l pi pj">fin_db=&gt;</span></pre><p id="af56" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">一旦您运行它，您将被提示插入用户的密码。如果连接成功，您会看到屏幕上出现一个光标，前面有数据库名称。</p><p id="c795" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">现在你可以对它进行查询了！</p><h2 id="53bb" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"># 2 列出模式|表|视图|函数|用户</h2><p id="ab2b" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">作为一名数据工程师，有时您可能希望列出当前连接的数据库中可用的模式。</p><p id="9d37" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">这可以通过使用<code class="fe oq or os ot b">\dn</code>命令来实现:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="c780" class="kz la it ot b gy pg ph l pi pj">fin_db-&gt; <strong class="ot iu">\dn</strong></span><span id="dc46" class="kz la it ot b gy pk ph l pi pj">List of schemas<br/>Name              |        Owner<br/>------------------+---------------------<br/>audit             | owner_1<br/>fin_data          | owner_2<br/>fin_config        | owner_3<br/>fin_control       | owner_4<br/>fin_internal      | owner_5<br/>finance_analytics | owner_6<br/>findb             | owner_7<br/>pdl               | owner_8<br/>pdl_map           | owner_9<br/>pdl_ob            | owner_10<br/>pds               | owner_11<br/>...               | ...</span><span id="e4c2" class="kz la it ot b gy pk ph l pi pj">(20 rows)</span></pre><p id="5215" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">如您所见，<code class="fe oq or os ot b">fin_db</code>数据库包括 20 个与特定所有者相关联的模式。然而，如果您在寻找一组特定的模式(假设所有模式都以<code class="fe oq or os ot b">fin_</code>开头)，该怎么办呢？在这种情况下，您应该运行:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="a0c4" class="kz la it ot b gy pg ph l pi pj">db_findb-&gt; <strong class="ot iu">\dn fin_*</strong></span><span id="b9a8" class="kz la it ot b gy pk ph l pi pj">List of schemas<br/>Name          | Owner<br/>— — — — — — — + — — — — — — — — -<br/>fin_adata     | owner_2<br/>fin_config    | owner_3<br/>fin_control   | owner_4<br/>fin_internal  | owner_5</span><span id="583a" class="kz la it ot b gy pk ph l pi pj">(4 rows)</span></pre><p id="b048" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">现在，该命令只显示与提供的正则表达式匹配的 4 个模式。</p><p id="2f33" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">非常相似的命令可用于列出您所连接的数据库的表、视图、函数和用户:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="9134" class="kz la it ot b gy pg ph l pi pj"># Display the list of tables<br/><strong class="ot iu">\dt </strong>or<strong class="ot iu"> \dt + regex</strong></span><span id="c800" class="kz la it ot b gy pk ph l pi pj"># Display the list of views<br/><strong class="ot iu">\dv </strong>or<strong class="ot iu"> \dv + regex</strong></span><span id="7185" class="kz la it ot b gy pk ph l pi pj"># Display the list of functions<br/><strong class="ot iu">\df </strong>or<strong class="ot iu"> \df + regex</strong></span><span id="7628" class="kz la it ot b gy pk ph l pi pj"># Display the list of users<br/><strong class="ot iu">\du </strong>or<strong class="ot iu"> \du + regex</strong></span></pre><h2 id="94db" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"># 3 描述一张桌子</h2><p id="8acb" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">如果您希望通过列出特定表的列、数据类型以及了解哪些字段可以为空来了解更多信息，您应该使用<code class="fe oq or os ot b">\d table_name</code>命令。</p><p id="d085" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">例如，要描述一个名为<code class="fe oq or os ot b">findb.transactions</code>(其中<code class="fe oq or os ot b">findb</code>是模式名)的表，您应该运行:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="bdd7" class="kz la it ot b gy pg ph l pi pj">db_findb-&gt; <strong class="ot iu">\d findb.transactions</strong></span><span id="51a5" class="kz la it ot b gy pk ph l pi pj">Partitioned table “findb.transactions”</span><span id="9d65" class="kz la it ot b gy pk ph l pi pj">Column         | Type        | Collation | Nullable | Default<br/>---------------+-------------+-----------+----------+---------<br/>trx_id         | bigint      |           | not null | <br/>source_id      | bigint      |           |          |<br/>ops_type_id    | bigint      |           | not null |<br/>manual_status  | integer     |           | not null | <br/>source_amount  | numeric     |           | not null |<br/>...            | ...         |...        | ...      |</span></pre><h2 id="683f" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"># 4 运行前一个命令</h2><p id="a638" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">要使用<code class="fe oq or os ot b">psql</code>查询数据库，您只需键入一些 SQL 代码，后跟一个分号<code class="fe oq or os ot b">;</code>。如果省略分号，客户端应用程序将无法理解代码是否准备好执行，并将使您处于编辑模式。</p><p id="7bc8" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">例如，如果您希望计算在<code class="fe oq or os ot b">2021-10-01</code>上创建的<code class="fe oq or os ot b">findb.transactions</code>中的事务总数，您可以运行:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="ce2e" class="kz la it ot b gy pg ph l pi pj">db_findb=&gt; <strong class="ot iu">select count(trx_id)</strong> <br/>           <strong class="ot iu">from findb.transactions</strong><br/>           <strong class="ot iu">where created_at = ‘2021–10–01’;</strong><br/>count<br/>-------<br/>512323</span><span id="926c" class="kz la it ot b gy pk ph l pi pj">(1 row)</span></pre><p id="0087" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">这个查询告诉我们<code class="fe oq or os ot b">512,323</code>是在那个日期创建的。如果您希望再次运行相同的查询，该怎么办？你可以简单地输入<code class="fe oq or os ot b">\g</code>:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="5342" class="kz la it ot b gy pg ph l pi pj">db_findb=&gt; <strong class="ot iu">\g</strong></span><span id="8b61" class="kz la it ot b gy pk ph l pi pj">count<br/>-------<br/>512323</span><span id="458f" class="kz la it ot b gy pk ph l pi pj">(1 row)</span></pre><p id="0f86" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">这适用于所有命令，相当于<code class="fe oq or os ot b">up arrow + enter</code>。</p><h2 id="62d0" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"># 5 从文件中执行命令</h2><p id="c23b" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">有时，SQL 脚本变得更长更复杂，所以您可能想先创建它们，将它们保存到一个文件中，然后用<code class="fe oq or os ot b">psql</code>运行文件中包含的查询。使用<code class="fe oq or os ot b">\i filename</code>可以做到这一点。</p><p id="86d0" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">在下面的示例中，我保存了该查询的等效内容:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="4358" class="kz la it ot b gy pg ph l pi pj">select<br/>TRX_ID<br/>,POSTING_DATE<br/>,SOURCE_AMOUNT<br/>,OPS_TYPE_ID<br/>from FINDB.TRANSACTIONS<br/>where POSTING_DATE = current_date<br/>limit 5;</span></pre><p id="72ef" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">到一个名为<code class="fe oq or os ot b">query_trxs</code>的崇高文本文件。该文件位于我的桌面上，因此为了执行它，我运行:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="e846" class="kz la it ot b gy pg ph l pi pj">db_findb=&gt; <strong class="ot iu">\i /Users/Anbento/Desktop/query_trxs</strong></span><span id="4d62" class="kz la it ot b gy pk ph l pi pj">trx_id     | posting_date | source_amount | ops_type_id<br/>-----------+--------------+---------------+------------+<br/>5122579747 | 2021-10-24   | 386.00        | 18         |<br/>5115148908 | 2021-10-24   | 0.0           | 252        |<br/>5115148971 | 2021-10-24   | 0.6100        | 70         |<br/>5122580187 | 2021-10-24   | 15000.00      | 62         |<br/>5122580337 | 2021-10-24   | 0.38          | 69         |</span><span id="2ee6" class="kz la it ot b gy pk ph l pi pj">(5 rows)</span></pre><h2 id="4605" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"># 6 在编辑器中编写命令</h2><p id="35bb" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">不用说，终端并不是运行长 SQL 查询的最佳工具。为此，<code class="fe oq or os ot b">psql</code>不仅允许你从文件中执行命令，还允许你通过<code class="fe oq or os ot b">\e</code>命令访问默认编辑器。</p><p id="ee6c" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">例如，在我的 Mac 上，该命令将打开<code class="fe oq or os ot b">vim</code>编辑器，因为这是<code class="fe oq or os ot b">psql</code>找到的默认编辑器。如果这也是你的情况，做这两件事:</p><ul class=""><li id="7a0a" class="mp mq it lx b ly mr mb ms li mt lm mu lq mv mn mw mx my mz bi translated">键入<code class="fe oq or os ot b">i</code>进入<code class="fe oq or os ot b">INSERT</code>模式。现在，您将能够键入您的查询。在这种情况下，我试图在<code class="fe oq or os ot b">findb.transactions</code>中找到<code class="fe oq or os ot b">max(trx_id)</code>:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/d767b9a3352cd30a73f84cd5dadfd4c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fgmqLpxUE-97I6fsh6vCsw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我的 vim 编辑器在插入模式下是什么样子</p></figure><ul class=""><li id="3861" class="mp mq it lx b ly mr mb ms li mt lm mu lq mv mn mw mx my mz bi translated">当您对您的查询满意时，键入<code class="fe oq or os ot b">esc</code>，然后键入<code class="fe oq or os ot b">:x!</code>。这将保存您的内容并自动执行 SQL 脚本:</li></ul><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="7a15" class="kz la it ot b gy pg ph l pi pj">db_findb=&gt; <strong class="ot iu">\e</strong></span><span id="ab9c" class="kz la it ot b gy pk ph l pi pj">max_id<br/>— — — — — — <br/>5124302389</span><span id="077c" class="kz la it ot b gy pk ph l pi pj">(1 row)</span></pre><p id="e033" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">但是，如果您的默认 shell 是<code class="fe oq or os ot b">zsh</code>，您可以通过向您的<code class="fe oq or os ot b">~/.zshrc</code>文件添加以下行来切换到您最喜欢的编辑器(例如<code class="fe oq or os ot b">nano</code>),或者如果您的默认 shell 是<code class="fe oq or os ot b">bash</code>，则添加<code class="fe oq or os ot b">~/.bash_profile</code>:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="84f4" class="kz la it ot b gy pg ph l pi pj">export EDITOR=nano<br/>export VISUAL="$EDITOR"</span></pre><p id="2844" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">然后，运行以下命令来更新配置:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="016c" class="kz la it ot b gy pg ph l pi pj">source ~/.zshrc <br/>#or<br/>source ~/.bash_profile</span></pre><p id="7787" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">如果您退出<code class="fe oq or os ot b">psql</code>并重新连接到数据库，当您运行<code class="fe oq or os ot b">\e</code>时，您应该会看到<code class="fe oq or os ot b">nano</code>编辑器正在启动:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pm"><img src="../Images/9fc34cc3f4a056209f37f23c99d21234.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W5DnKkdWqxHBgmcbZBIFCw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">现在 nano 是 psql :D 的默认编辑器</p></figure><h2 id="d7d0" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak"> # 7 启用查询执行时间</strong></h2><p id="f20c" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">数据工程师经常忙于测试某些 SQL 脚本的性能。在这种情况下，了解一个查询运行需要多少时间非常方便。</p><p id="bc6d" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">为了在<code class="fe oq or os ot b">psql</code>上显示执行时间，可以输入<code class="fe oq or os ot b">\timing on</code>。例如，运行与之前相同的文件:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="dbdd" class="kz la it ot b gy pg ph l pi pj">db_findb=&gt; <strong class="ot iu">\timing on</strong><br/>Timing is on.</span><span id="7b56" class="kz la it ot b gy pk ph l pi pj">db_findb=&gt; <strong class="ot iu">\i /Users/Anbento/Desktop/query_trxs</strong></span><span id="92b3" class="kz la it ot b gy pk ph l pi pj">trx_id     | posting_date | source_amount | ops_type_id<br/>-----------+--------------+---------------+------------+<br/>5122579747 | 2021-10-24   | 386.00        | 18         |<br/>5115148908 | 2021-10-24   | 0.0           | 252        |<br/>5115148971 | 2021-10-24   | 0.6100        | 70         |<br/>5122580187 | 2021-10-24   | 15000.00      | 62         |<br/>5122580337 | 2021-10-24   | 0.38          | 69         |</span><span id="ea6a" class="kz la it ot b gy pk ph l pi pj">(5 rows)</span><span id="2f91" class="kz la it ot b gy pk ph l pi pj">Time: 2673.033 ms (00:02.673)</span></pre><p id="d811" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">现在您知道运行查询需要<code class="fe oq or os ot b">2.67secs</code>。</p><p id="4886" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">为了禁用计时，您可以键入<code class="fe oq or os ot b">\timing off</code>来代替。</p><h2 id="c651" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak"> # 8 每隔一段时间重复命令</strong></h2><p id="1e56" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">您是否曾经需要多次运行完全相同的 SQL 脚本？例如，通过将数据加载到特定的表中来检查 ETL 管道是否按预期工作？</p><p id="cc3a" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">如果您的答案是肯定的，那么您很幸运，因为使用<code class="fe oq or os ot b">psql</code>，您可以使用<code class="fe oq or os ot b">\watch + interval (in secs)</code>命令自动运行脚本，次数不限。例如:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="6323" class="kz la it ot b gy pg ph l pi pj">db_findb=&gt; <strong class="ot iu">select<br/>           max(TRX_ID) as max_id<br/>           from FINDB.TRANSACTIONS;</strong></span><span id="ce92" class="kz la it ot b gy pk ph l pi pj">max_id<br/>— — — — — — <br/>5124378773</span><span id="9d39" class="kz la it ot b gy pk ph l pi pj">(1 row)</span><span id="f18c" class="kz la it ot b gy pk ph l pi pj">db_findb=&gt; <strong class="ot iu">\watch 5</strong><br/>Sun Oct 24 18:55:13 2021 (every 5s)</span><span id="3dd2" class="kz la it ot b gy pk ph l pi pj">max_id<br/>— — — — — — <br/>5124378799</span><span id="bba8" class="kz la it ot b gy pk ph l pi pj">(1 row)</span><span id="a3cf" class="kz la it ot b gy pk ph l pi pj">Sun Oct 24 18:55:18 2021 (every 5s)</span><span id="96cb" class="kz la it ot b gy pk ph l pi pj">max_id<br/>— — — — — — <br/>5124378808</span><span id="309a" class="kz la it ot b gy pk ph l pi pj">(1 row)</span></pre><p id="a6a0" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">如您所见，我正在运行我希望以特定时间间隔执行的 SQL 查询，然后我键入<code class="fe oq or os ot b">\watch 5</code>以便该查询每隔<code class="fe oq or os ot b">5 secs</code>开始执行。随着新记录被插入到表中，<code class="fe oq or os ot b">trx_id</code>不断增长。</p><p id="4c53" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">相同的查询会一直运行，直到您用<code class="fe oq or os ot b">ctrl + c</code>杀死它。</p><p id="7e14" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">在:D 这篇文章描述的 10 个命令中，<code class="fe oq or os ot b">\watch</code>命令非常有用，也是我最喜欢的一个</p><h2 id="2578" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"># 9 以 CSV 格式导出数据</h2><p id="957c" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">你猜怎么着？正如我在文章开头提到的，<code class="fe oq or os ot b">psql</code>确实允许您以 CSV 格式导出数据。您可以使用下面的语法通过<code class="fe oq or os ot b">\copy</code>命令来实现:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="0053" class="kz la it ot b gy pg ph l pi pj">\copy (SQL query) TO 'path\file_name.csv' WITH CSV HEADER</span></pre><p id="fc91" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">请记住，在这种情况下，SQL 查询不需要在末尾加上分号<code class="fe oq or os ot b">;</code>(否则<code class="fe oq or os ot b">psql</code>会抛出错误)。另外，如果您希望在 CSV 文件中保留列名，记得在末尾添加<code class="fe oq or os ot b">HEADER</code>。</p><p id="8bf5" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">例如，假设您希望将此查询的结果导出到桌面上的 CSV 文件中:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="4f36" class="kz la it ot b gy pg ph l pi pj">select<br/>TRX_ID<br/>,POSTING_DATE<br/>,SOURCE_AMOUNT<br/>,OPS_TYPE_ID<br/>from FINDB.TRANSACTIONS<br/>where POSTING_DATE = current_date<br/>limit 10</span></pre><p id="29e6" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">然后，您将键入:</p><pre class="kj kk kl km gt pc ot pd pe aw pf bi"><span id="71c9" class="kz la it ot b gy pg ph l pi pj">db_findb=&gt; \copy (<br/>select<br/>TRX_ID<br/>,POSTING_DATE<br/>,SOURCE_AMOUNT<br/>,OPS_TYPE_ID<br/>from FINDB.TRANSACTIONS<br/>where POSTING_DATE = current_date<br/>limit 10<br/>) TO ‘/Users/Anbento/Desktop/query_trxs_v2.csv’ WITH CSV HEADER</span><span id="0368" class="kz la it ot b gy pk ph l pi pj">COPY 10</span></pre><p id="bdd0" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">当您运行这个命令时，它将创建一个名为<code class="fe oq or os ot b">query_trxs_v2</code>的 CSV 文件，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/5d9c22cc0c42165223bdb252501ff2f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iEQSK2dPb7eJYBYGI0PjZg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如你所见，标题在那里！</p></figure><h2 id="6d4d" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"># 10 退出 psql</h2><p id="5795" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">使用<code class="fe oq or os ot b">psql</code>完成后，您可以使用<code class="fe oq or os ot b">\q + enter</code>退出客户端应用程序。或者，您可以使用<code class="fe oq or os ot b">ctrl + z</code>。这将退出客户端应用程序，您将无法在终端上继续工作。</p><h1 id="3156" class="np la it bd lb nq ou ns le nt ov nv lh jz ow ka ll kc ox kd lp kf oy kg lt nz bi translated"><strong class="ak">结论</strong></h1><p id="4c66" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">在这篇文章中，我与你分享了你在成为拥有超能力的数据工程师的旅途中应该掌握的 10 条<code class="fe oq or os ot b">psql</code>命令。这些也是我每天最常使用的命令，所以我希望你按照 80/20 法则从它们开始。</p><p id="5367" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">然而，要知道<code class="fe oq or os ot b">psql</code>提供了非常广泛的命令，为了掌握这个工具，还有很多东西需要你去学习。</p><p id="a3a1" class="pw-post-body-paragraph lv lw it lx b ly mr ju ma mb ms jx md li nf mf mg lm ng mi mj lq nh ml mm mn im bi translated">坚持学习就好！</p></div></div>    
</body>
</html>