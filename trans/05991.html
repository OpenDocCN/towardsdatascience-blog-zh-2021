<html>
<head>
<title>Keep your code clean using Black &amp; Pylint &amp; Git Hooks &amp; Pre-commit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Black &amp; Pylint &amp; Git Hooks和预提交保持代码干净</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/keep-your-code-clean-using-black-pylint-git-hooks-pre-commit-baf6991f7376?source=collection_archive---------3-----------------------#2021-05-29">https://towardsdatascience.com/keep-your-code-clean-using-black-pylint-git-hooks-pre-commit-baf6991f7376?source=collection_archive---------3-----------------------#2021-05-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/7f2fae616fb72ebec5b1a6d47471edcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2C2Sl-GlJV7ki9eTv59Sgw.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">图片来自Pexels公司的Pixabay</p></figure><div class=""/><div class=""><h2 id="65c7" class="pw-subtitle-paragraph kf jh ji bd b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dk translated">合作开发不可或缺的工具</h2></div><p id="f6b7" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">编码可能是一项非常困难的任务，尤其是在与不同的开发人员一起工作的项目中。团队中的每个成员都有自己的编码方式，这会导致非常异构的脚本。<br/>这就是为什么拥有一个类似的<strong class="kz jj">代码格式化程序</strong>和<strong class="kz jj">代码摘要</strong>以便让git提交更干净是很重要的。这可以在分段和提交阶段之间或在CI/CD链期间执行。</p><p id="e19d" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">在本文中，我们将看到如何使用git挂钩作为预提交步骤来实现这一点。</p><h1 id="2406" class="lt lu ji bd lv lw lx ly lz ma mb mc md ko me kp mf kr mg ks mh ku mi kv mj mk bi translated">目录</h1><p id="84aa" class="pw-post-body-paragraph kx ky ji kz b la ml kj lc ld mm km lf lg mn li lj lk mo lm ln lo mp lq lr ls im bi translated">总结如下:</p><ol class=""><li id="dac1" class="mq mr ji kz b la lb ld le lg ms lk mt lo mu ls mv mw mx my bi translated">黑色</li><li id="9d42" class="mq mr ji kz b la mz ld na lg nb lk nc lo nd ls mv mw mx my bi translated">Pylint</li><li id="2b5e" class="mq mr ji kz b la mz ld na lg nb lk nc lo nd ls mv mw mx my bi translated">作为Git Hooks的预提交</li></ol></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="8733" class="lt lu ji bd lv lw nl ly lz ma nm mc md ko nn kp mf kr no ks mh ku np kv mj mk bi translated">黑色</h1><p id="cefb" class="pw-post-body-paragraph kx ky ji kz b la ml kj lc ld mm km lf lg mn li lj lk mo lm ln lo mp lq lr ls im bi translated"><a class="ae nq" href="https://pypi.org/project/black/" rel="noopener ugc nofollow" target="_blank"> Black </a>是故意限制样式配置的python代码格式化程序。它让你的代码更清晰，这样你就可以更专注于内容。由于diffs尽可能小，所以代码审查也更有效。</p><p id="4ede" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">可以使用以下命令行安装:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="87be" class="oa lu ji nw b gy ob oc l od oe">pip install black</span></pre><p id="e775" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">您可以通过键入以下内容在任何python文件上运行black:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="ba61" class="oa lu ji nw b gy ob oc l od oe">Black pathtofile.py</span></pre><figure class="nr ns nt nu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi of"><img src="../Images/098e0133c29d8ddb30a14be432425a2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hwi8MNxgrOktAYGo.gif"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者形象</p></figure><p id="9437" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">可以使用文件<strong class="kz jj"> pyproject.toml </strong>略微配置黑色，该文件应放在项目的根中。以下是此文件的示例:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="06bc" class="oa lu ji nw b gy ob oc l od oe">[tool.black]<br/>line-length = 88<br/>target-version = [‘py36’, ‘py37’, ‘py38’]<br/>include = ‘\.pyi?$’<br/>exclude = '''<br/>/(<br/>  \.toml<br/>  |\.sh<br/>  |\.git<br/>  |\.ini<br/>  |Dockerfile<br/>  |Jenkinfile<br/>)/<br/>'''</span></pre><p id="70a9" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">例如，我们可以选择代码行的长度，还可以设置哪些文件不应该格式化的扩展。</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="6914" class="lt lu ji bd lv lw nl ly lz ma nm mc md ko nn kp mf kr no ks mh ku np kv mj mk bi translated">Pylint</h1><p id="634a" class="pw-post-body-paragraph kx ky ji kz b la ml kj lc ld mm km lf lg mn li lj lk mo lm ln lo mp lq lr ls im bi translated"><a class="ae nq" href="https://pypi.org/project/pylint/" rel="noopener ugc nofollow" target="_blank">pyrint</a>是一个“Python静态代码分析工具”，用于评估已开发脚本的质量。它会引导团队采用相同的标准。</p><p id="fb04" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">可以使用以下命令行安装Pylint:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="5739" class="oa lu ji nw b gy ob oc l od oe">pip install pylint</span></pre><p id="9527" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">要评估给定脚本的编码质量，可以运行:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="659c" class="oa lu ji nw b gy ob oc l od oe">pylint pathtofile.py</span></pre><p id="973e" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated"><strong class="kz jj"> NB </strong>:为了在整个项目中运行pylint，您的存储库应该包括一个<em class="og"> __init__。py </em>文件。</p><p id="1de8" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">与Black一样，Pylint也可以使用文件<strong class="kz jj">进行配置。pyrintc</strong>也放置在项目的根上</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="6cd6" class="oa lu ji nw b gy ob oc l od oe">[MASTER]<br/>jobs=4 #number of processes to use</span><span id="e4f0" class="oa lu ji nw b gy oh oc l od oe">[BASIC]<br/>good-names=nameOfYourProject #names to be considered ok</span><span id="c67c" class="oa lu ji nw b gy oh oc l od oe">[pre-commit-hook]<br/>command=custom_pylint<br/>disable=E0401, C0301</span></pre><p id="2fb3" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">有关配置的更多详细信息，请参见<a class="ae nq" href="https://github.com/kubeflow/examples/blob/master/.pylintrc" rel="noopener ugc nofollow" target="_blank">页面</a>。</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="eb57" class="lt lu ji bd lv lw nl ly lz ma nm mc md ko nn kp mf kr no ks mh ku np kv mj mk bi translated">作为Git Hooks的预提交</h1><p id="c42b" class="pw-post-body-paragraph kx ky ji kz b la ml kj lc ld mm km lf lg mn li lj lk mo lm ln lo mp lq lr ls im bi translated">Git挂钩是在运行git操作时启动的已定义脚本。<br/>挂钩有两种类型:</p><ul class=""><li id="a5cd" class="mq mr ji kz b la lb ld le lg ms lk mt lo mu ls oi mw mx my bi translated"><strong class="kz jj">客户端挂钩</strong>:提交合并后运行</li><li id="2a11" class="mq mr ji kz b la mz ld na lg nb lk nc lo nd ls oi mw mx my bi translated"><strong class="kz jj">服务器端挂钩:</strong>在网络操作上运行，例如在推送提交之后</li></ul><p id="3906" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">在本文中，我们将重点关注客户端工作流，这些工作流可以用下图来描述:</p><figure class="nr ns nt nu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oj"><img src="../Images/c5dc028d0ae44158158f3454123ed182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h4O-Ce_TuYi30uBx9sHvpQ.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者形象</p></figure><p id="c4ca" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">在git存储库中，钩子放在<strong class="kz jj">中。git/hooks/ </strong>。例如，通过将以下代码行添加到Json设置中，可以在VSCode中可视化它们:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="9de0" class="oa lu ji nw b gy ob oc l od oe">"files.exclude": {<br/>     "**/.git": false<br/>}</span></pre><figure class="nr ns nt nu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ok"><img src="../Images/c682e118ca9e1193b40ce2a77650b3be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZzI4OlRu-dqxgz5HNf1qaA.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</p></figure><h2 id="bdad" class="oa lu ji bd lv ol om dn lz on oo dp md lg op oq mf lk or os mh lo ot ou mj ov bi translated">预提交的设置</h2><p id="a18c" class="pw-post-body-paragraph kx ky ji kz b la ml kj lc ld mm km lf lg mn li lj lk mo lm ln lo mp lq lr ls im bi translated">要将提交前操作添加到存储库中，请执行以下操作:</p><p id="6767" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated"><em class="og"> 1。在文件夹中创建文件</em><strong class="kz jj"><em class="og"/></strong><em class="og">。git/hooks/ </em>。名称中不应包含任何扩展名。</p><p id="fd24" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated"><em class="og"> 2。在文件</em>中添加bash命令。在我们的案例中:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="e3f0" class="oa lu ji nw b gy ob oc l od oe">#!/bin/sh</span><span id="01f1" class="oa lu ji nw b gy oh oc l od oe">black .<br/>python lint.py -p ../projectName/</span></pre><p id="2897" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">第一行应用黑色格式化程序，第二行对项目的每个python文件应用林挺。你可以从这个<a class="ae nq" href="https://doedotdev.medium.com/pylint-static-code-analysis-python-script-with-adjustable-threshold-b0d6d2c8647b`" rel="noopener">链接</a>下载lint.py文件:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="ae97" class="oa lu ji nw b gy ob oc l od oe">import argparse<br/>import logging<br/>from pylint.lint import Run<br/><br/><br/>logging.getLogger().setLevel(logging.INFO)<br/><br/>parser = argparse.ArgumentParser(prog="LINT")<br/><br/>parser.add_argument('-p',<br/>                    '--path',<br/>                    help='path to directory you want to run pylint | '<br/>                         'Default: %(default)s | '<br/>                         'Type: %(type)s ',<br/>                    default='./src',<br/>                    type=str)<br/><br/>parser.add_argument('-t',<br/>                    '--threshold',<br/>                    help='score threshold to fail pylint runner | '<br/>                         'Default: %(default)s | '<br/>                         'Type: %(type)s ',<br/>                    default=<strong class="nw jj">7</strong>,<br/>                    type=float)<br/><br/>args = parser.parse_args()<br/>path = str(args.path)<br/>threshold = float(args.threshold)<br/><br/>logging.info('PyLint Starting | '<br/>             'Path: {} | '<br/>             'Threshold: {} '.format(path, threshold))<br/><br/>results = Run([path], do_exit=False)<br/><br/>final_score = results.linter.stats['global_note']<br/><br/>if final_score &lt; threshold:<br/><br/>    message = ('PyLint Failed | '<br/>               'Score: {} | '<br/>               'Threshold: {} '.format(final_score, threshold))<br/><br/>    logging.error(message)<br/>    raise Exception(message)<br/><br/>else:<br/>    message = ('PyLint Passed | '<br/>               'Score: {} | '<br/>               'Threshold: {} '.format(final_score, threshold))<br/><br/>    logging.info(message)<br/><br/>    exit(0)</span></pre><p id="41c3" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated"><strong class="kz jj">注意</strong>:阈值默认设置为7。如果pylint分数低于这个数字，提交将会失败，您必须在再次提交之前清理您的脚本。</p><p id="3698" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated"><em class="og"> 3。通过运行以下bash命令使其可执行</em>:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="4159" class="oa lu ji nw b gy ob oc l od oe">chmod +x .git/hooks/pre-commit</span></pre><p id="4c8a" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">这样做之后，每次提交项目之前，都会格式化皮林特的布莱克和林挺。<br/>我们考虑以下应用程序进行说明:</p><figure class="nr ns nt nu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ow"><img src="../Images/6d03880e967a646467972543a7c63bde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7-l5hgJYuKBCVk-zQAvAIg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</p></figure><p id="25f4" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">当提交新的变更时，我们会得到以下结果:</p><figure class="nr ns nt nu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ox"><img src="../Images/ae1aec9ea4bf5766d3d9f1115ee7704e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3EWTbQZ2Nsf3lngVZ3c7LA.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</p></figure><h2 id="6a8f" class="oa lu ji bd lv ol om dn lz on oo dp md lg op oq mf lk or os mh lo ot ou mj ov bi translated">共享棉绒和格式化程序</h2><p id="1d42" class="pw-post-body-paragraph kx ky ji kz b la ml kj lc ld mm km lf lg mn li lj lk mo lm ln lo mp lq lr ls im bi translated">既然您已经将black设置为格式化程序，将pylint设置为linter，那么您肯定希望您的团队拥有相同的配置。<br/>要做到这一点，您可以使用下面的bash文件，该文件将被放在您的项目的根目录下，并在克隆存储库之后由您团队的每个成员运行:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="f600" class="oa lu ji nw b gy ob oc l od oe">#!/bin/bash</span><span id="3fb5" class="oa lu ji nw b gy oh oc l od oe">echo $"#/bin/sh\nblack .\npython lint.py -p ../projectName/'&gt; .git/hooks/pre-commit<br/>chmod +x .git/hooks/pre-commit</span></pre></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="0f6b" class="lt lu ji bd lv lw nl ly lz ma nm mc md ko nn kp mf kr no ks mh ku np kv mj mk bi translated">结论</h1><p id="d883" class="pw-post-body-paragraph kx ky ji kz b la ml kj lc ld mm km lf lg mn li lj lk mo lm ln lo mp lq lr ls im bi translated">预提交是非常强大的工具，可以保持代码格式良好，并在团队成员中标准化开发方法。同样，除了林挺和格式化之外，它们还可以包括其他检查。<br/>在本文中，我们使用了一种调用已安装的Python库的经典方法，您也可以使用python <strong class="kz jj">模块</strong> <a class="ae nq" href="https://pre-commit.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz jj">预提交</strong> </a>，其中包括对其GitHub库的许多检查和调用。这是非常有效的，但可能很难设置，特别是当面对<strong class="kz jj">代理</strong>过滤器时。</p></div></div>    
</body>
</html>