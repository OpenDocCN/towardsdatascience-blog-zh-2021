<html>
<head>
<title>Election Surveys with Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Plotly进行的选举调查</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/election-surveys-with-plotly-50c904d730de?source=collection_archive---------39-----------------------#2021-07-26">https://towardsdatascience.com/election-surveys-with-plotly-50c904d730de?source=collection_archive---------39-----------------------#2021-07-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d61d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><strong class="ak">堆叠棒线还是发散棒线？</strong></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/211f684660b77d35452b090c3a5a2e82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UDIrU9X6y__hMx7OxDm4ag.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@dotjpg?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">詹妮弗·格里芬</a>在<a class="ae ky" href="https://unsplash.com/s/photos/election-surveys?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="32e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2021年，阿根廷将举行全国立法选举。PASO(<em class="lv">Primarias Abiertas simultáneas y Obligatorias</em>，同步强制性公开初选)将于9月12日举行，而大选将于11月14日举行。众议院将更新其257个席位中的127个，参议院将更新其54个席位中的24个。这被认为是一次超越性的选举，因为执政党距离在众议院获得自己的多数席位只有7名代表。由于它已经在参议院占多数，有利的结果将使它获得完全的立法控制权。</p><p id="c1d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">竞选活动尚未开始，因为参加不同选举联盟竞选的所有候选人尚未确定。尽管如此，每周还是会发布几项民意调查，试图确立选民的未来行为。其中一些调查关注仅有的两个有机会赢得选举的选举力量的主要政治对象的形象，作为预测选民在投票时行为的代理人。</p><p id="ec12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一位主要的民意调查者询问了现任总统、前两任总统、在任的两位主要州长以及反对党主要政党的主席的形象。当然，显示结果的最佳方式是通过某种数据可视化技术。</p><p id="5ff2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下文中，我指出了Plotly允许显示选举调查结果的两种选择。</p><h1 id="96a7" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated"><strong class="ak">备选项1: 100%堆叠水平条</strong></h1><p id="71ad" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">人们认为<strong class="lb iu">调查应该是对称的，因为正面或正面的回答与负面或负面的回答数量相等。</strong>当然，中立的回应也不能缺席(以免在立场严格中立的情况下，强迫被回应者选择任何一方)。也不应该没有“不知道-不回答”选项，以包括被调查者对所研究项目的无知程度。</p><p id="27f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">显示调查结果最常用的图表之一是1 <strong class="lb iu"> 00%堆积水平条形图</strong>。一个<a class="ae ky" rel="noopener" target="_blank" href="/stacked-bar-graphs-why-how-f1b68a7454b7">堆积条形图</a>显示了一组条形或矩形，每个条形或矩形代表一个被划分为子类别的主类别。每个子类别的数值由一个接一个堆叠的矩形线段的长度表示。在调查结果的特殊情况下，矩形<strong class="lb iu">水平定向。</strong>此外，在100%堆积条形图的情况下，每个区段代表每个子类别的<strong class="lb iu">百分比</strong>，注意百分比的总和必须等于100。</p><p id="94f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下100%堆积条形图显示了阿根廷主要政治家的形象水平。该图根据正面图像按降序排序。堆叠的条的顺序如下:正图像；中性形象；负面形象；政客的无知。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/eea4580369de5ae7754dbbb9f1215d79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mgzGwt12n5FfcM2OO0wPew.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1:作者用Plotly制作的100%堆积水平条形图。</p></figure><p id="80c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">获得图1的代码如下:</p><p id="d374" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们将<a class="ae ky" rel="noopener" target="_blank" href="/scatter-plots-with-plotly-express-1b7f5579919b"> Plotly Express </a>导入为<em class="lv"> px，</em>Plotly . graph _ objects模块导入为<em class="lv"> go </em>，Pandas和Colorlover库分别导入为<em class="lv"> pd </em>和<em class="lv"> cl </em>:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="6a5b" class="mz lx it mv b gy na nb l nc nd">import plotly.express as px</span><span id="f758" class="mz lx it mv b gy ne nb l nc nd">import plotly.graph_objects as go</span><span id="abd0" class="mz lx it mv b gy ne nb l nc nd">import pandas as pd</span><span id="0cfe" class="mz lx it mv b gy ne nb l nc nd">import colorlover as cl</span></pre><p id="4e9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们创建了包含调查结果的数据框架，并根据正面形象的级别对其进行了分类:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="afdd" class="mz lx it mv b gy na nb l nc nd">surv = {‘Pol_List’: [‘PB’, ‘HRL’, ‘AF’, ‘CFK’, ‘MM’, ‘AK’],</span><span id="6648" class="mz lx it mv b gy ne nb l nc nd">        ‘Posit’: [43.9, 39.8, 26.8, 26.7, 24.8, 21.7],</span><span id="54fc" class="mz lx it mv b gy ne nb l nc nd">        ‘Neutr’: [14.3, 25.5, 10.6, 6.0, 26.4, 9.1],</span><span id="be03" class="mz lx it mv b gy ne nb l nc nd">        ‘No_Op’: [4.8, 4.2, 0.4, 0.5, 0.7, 2.1],</span><span id="80bb" class="mz lx it mv b gy ne nb l nc nd">        ‘Negat’: [37.0, 30.5, 62.2, 66.8, 48.1, 67.1]</span><span id="27ff" class="mz lx it mv b gy ne nb l nc nd">        }</span><span id="e49f" class="mz lx it mv b gy ne nb l nc nd">df_surv = pd.DataFrame(surv)</span><span id="35a3" class="mz lx it mv b gy ne nb l nc nd">df_surv = df_surv.sort_values(by=’Posit’, ascending = True)</span><span id="9ab4" class="mz lx it mv b gy ne nb l nc nd">images  = [‘Negat’, ‘No_Op’, ‘Neutr’, ‘Posit’]</span></pre><p id="a451" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们准备创建我们的图表。</p><p id="c64b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">plotly的通常程序是使用方法<code class="fe nf ng nh mv b">.add_trace(go.Bar())</code>生成图形，然后使用方法<code class="fe nf ng nh mv b">.update_layout()</code>和<code class="fe nf ng nh mv b">.update_xaxes</code>对其进行操作。最后用<code class="fe nf ng nh mv b">.show()</code>显示图表，用<code class="fe nf ng nh mv b"> .write_image()</code>导出。</p><p id="6db5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要将<code class="fe nf ng nh mv b">.add_trace(go.Bar())</code>方法放在<em class="lv">中，以便</em>循环遍历数据帧，提取政治家的首字母(<code class="fe nf ng nh mv b">y = df_surv[‘Pol_List’]</code>)和调查中记录的量化值<code class="fe nf ng nh mv b">(x = df_surv[column]</code>。用<code class="fe nf ng nh mv b"> orientation = ‘h’</code>我们表示我们的条将水平定向，用<code class="fe nf ng nh mv b"> text</code>和<code class="fe nf ng nh mv b"> textposition</code>我们将在矩形段内包含数值。<code class="fe nf ng nh mv b">cl.scales</code>选择一个色标，以便快速辨别正值和负值。</p><p id="a4bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nf ng nh mv b">fig.update.layout</code>允许我们设置标题文本和字体，以及图例的方向和位置。包含<code class="fe nf ng nh mv b">barmode = ‘stack’</code>非常重要，以确保杆段一个接一个地堆叠。</p><p id="85ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们指出，在x轴上，我们不想放置标尺或网格，因为它们对我们讲故事来说是不必要的。</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="0500" class="mz lx it mv b gy na nb l nc nd">fig = go.Figure()</span><span id="3f33" class="mz lx it mv b gy ne nb l nc nd">for column in df_surv.columns[1:5]:</span><span id="794c" class="mz lx it mv b gy ne nb l nc nd">    fig.add_trace(go.Bar(</span><span id="7524" class="mz lx it mv b gy ne nb l nc nd">                  x = df_surv[column],</span><span id="f6c5" class="mz lx it mv b gy ne nb l nc nd">                  y = df_surv[‘Pol_List’],</span><span id="4fce" class="mz lx it mv b gy ne nb l nc nd">                  name = column,</span><span id="4033" class="mz lx it mv b gy ne nb l nc nd">                  orientation = ‘h’,</span><span id="22c8" class="mz lx it mv b gy ne nb l nc nd">                  text = df_surv[column],</span><span id="d972" class="mz lx it mv b gy ne nb l nc nd">                  textposition = ‘auto’,  </span><span id="8d8d" class="mz lx it mv b gy ne nb l nc nd">                  marker_color=cl.scales[<br/>                                 str(len(images))]’div’]’RdBu’]            <br/>                                 images.index(column)]</span><span id="fb60" class="mz lx it mv b gy ne nb l nc nd">                 ))</span><span id="a0a7" class="mz lx it mv b gy ne nb l nc nd">fig.update_layout(</span><span id="1467" class="mz lx it mv b gy ne nb l nc nd">                  title = ‘Image of Argentinian Politicians’,</span><span id="d4ab" class="mz lx it mv b gy ne nb l nc nd">                  title_font= dict(family = ‘Arial’, size = 30),</span><span id="59f1" class="mz lx it mv b gy ne nb l nc nd">                  barmode = ‘stack’,</span><span id="d677" class="mz lx it mv b gy ne nb l nc nd">                  legend_orientation =’h’,</span><span id="cc3a" class="mz lx it mv b gy ne nb l nc nd">                  legend_traceorder=”normal”,</span><span id="fea8" class="mz lx it mv b gy ne nb l nc nd">                  legend_x = 0.10, legend_y = 1.1,</span><span id="7d32" class="mz lx it mv b gy ne nb l nc nd">                  )</span><span id="593f" class="mz lx it mv b gy ne nb l nc nd">fig.update_xaxes(</span><span id="c809" class="mz lx it mv b gy ne nb l nc nd">                 visible = False,</span><span id="90e9" class="mz lx it mv b gy ne nb l nc nd">                 showgrid = False)</span><span id="0588" class="mz lx it mv b gy ne nb l nc nd">fig.write_image(path + ‘Survey1.png’)</span><span id="5b5e" class="mz lx it mv b gy ne nb l nc nd">fig.show()</span></pre><h1 id="6b68" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated"><strong class="ak">备选方案2:发散堆积条形图</strong></h1><p id="c238" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/diverging-bars-why-how-3e3ecc066dce">发散堆积条形图</a>是之前描述的堆积条形图的延伸，增加了一条垂直基线<strong class="lb iu">。概念上的想法是<strong class="lb iu">否定回答放在基线的左边，而肯定回答放在基线的右边</strong>。这种特殊的设计便于对各种类别的积极或有利的反应和不利或消极的反应进行比较。</strong></p><p id="1f16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个条形被分成水平矩形段，一个接一个地堆叠。正如所有条形图的特点一样，每段的长度与要表示的数值成正比。根据要绘制的数据集的特征，该数值可以是绝对值或百分比。</p><p id="3725" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了将否定回答放在基线的左侧，我们继续将相应的列转换为负值，并根据该列进行排序:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="064d" class="mz lx it mv b gy na nb l nc nd">df_surv['Negat'] = df_surv['Negat'] * -1</span><span id="f9df" class="mz lx it mv b gy ne nb l nc nd">df_surv = df_surv.sort_values(by=['Negat'], ascending = False)</span></pre><p id="6f8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们继续用相同的方法<code class="fe nf ng nh mv b">.add_trace(go.Bar())</code>绘制图表，使用的代码等同于之前用100%堆积水平条表示的代码。</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="76a4" class="mz lx it mv b gy na nb l nc nd">fig2 = go.Figure()</span><span id="0658" class="mz lx it mv b gy ne nb l nc nd">for column in df_surv.columns[1:5]:</span><span id="d42f" class="mz lx it mv b gy ne nb l nc nd">    fig2.add_trace(go.Bar(</span><span id="a0ec" class="mz lx it mv b gy ne nb l nc nd">                   x = df_surv[column],</span><span id="2c34" class="mz lx it mv b gy ne nb l nc nd">                   y = df_surv['Pol_List'],</span><span id="0512" class="mz lx it mv b gy ne nb l nc nd">                   name = column,</span><span id="66a4" class="mz lx it mv b gy ne nb l nc nd">                   orientation = 'h',</span><span id="e5bb" class="mz lx it mv b gy ne nb l nc nd">                   text = df_surv[column],</span><span id="7848" class="mz lx it mv b gy ne nb l nc nd">                   textposition = 'auto',<br/>                   marker_color=cl.scales[<br/>                                 str(len(images))]’div’]’RdBu’]            <br/>                                 images.index(column)]</span><span id="5a24" class="mz lx it mv b gy ne nb l nc nd">                 ))</span></pre><p id="09f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们必须在update.layout方法中做两处修改:现在我们指定<code class="fe nf ng nh mv b">barmode = ‘relative’</code>和<code class="fe nf ng nh mv b">legend_traceorder=”reversed”.</code></p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="c581" class="mz lx it mv b gy na nb l nc nd">fig2.update_layout(</span><span id="7247" class="mz lx it mv b gy ne nb l nc nd">                   title   = 'Image of Argentinian Politicians',</span><span id="0256" class="mz lx it mv b gy ne nb l nc nd">                   title_font= dict(family = 'Arial', size = 30),</span><span id="fb9f" class="mz lx it mv b gy ne nb l nc nd">                   barmode = 'relative',</span><span id="e39b" class="mz lx it mv b gy ne nb l nc nd">                   legend_orientation ='h',</span><span id="b333" class="mz lx it mv b gy ne nb l nc nd">                   legend_traceorder="rerversed",</span><span id="cf42" class="mz lx it mv b gy ne nb l nc nd">                   legend_x = 0.10, legend_y = 1.1,</span><span id="6e35" class="mz lx it mv b gy ne nb l nc nd">                   )</span></pre><p id="2ea7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们画一条中心垂直线，表示发散的堆叠棒线:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="8c20" class="mz lx it mv b gy na nb l nc nd"># Draw a central vertical line</span><span id="963d" class="mz lx it mv b gy ne nb l nc nd">fig2.add_shape(type='line',</span><span id="e6bd" class="mz lx it mv b gy ne nb l nc nd">               x0 = 0.5, y0 = -0.5,</span><span id="cab0" class="mz lx it mv b gy ne nb l nc nd">               x1 = 0.5, y1 = 5.5,</span><span id="c3a5" class="mz lx it mv b gy ne nb l nc nd">               line=dict(color = 'yellow', width = 3))</span></pre><p id="fc67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在x轴上，我们保留默认选项来显示数字值和网格，这增强了故事的讲述:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="0a5a" class="mz lx it mv b gy na nb l nc nd">fig2.update_xaxes(</span><span id="86e1" class="mz lx it mv b gy ne nb l nc nd">                  visible  = True,</span><span id="53b7" class="mz lx it mv b gy ne nb l nc nd">                  showgrid = True)</span><span id="04cb" class="mz lx it mv b gy ne nb l nc nd">fig2.write_image( path + 'Divergent1.png')</span><span id="f1a3" class="mz lx it mv b gy ne nb l nc nd">fig2.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/0971e838c660198f0829456bbed9fc6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2H7x0ZEkhHCpGyHNxI4voQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2:作者用Plotly做的发散堆积条形图。</p></figure><p id="4a6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">发散堆积条形图中的一个常见替代方法是将中性响应放置在正响应和负响应之间，并在代表中性响应的线段中心画一条垂直线。图3示出了用具有这些特征的Matplotlib制作的图:SD:强烈不同意；d:不同意；n:中性；答:同意；山:非常同意。很明显，这种布局很难对阳性和阴性反应进行直接比较，因为它们不是从同一基线开始的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/a2c3dba73a29c3f157cdbf6c03aea366.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*RzBqTV0NHRfSzCtE7_LrPg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3:作者用Matplotlib制作的发散堆积条形图。</p></figure><p id="41f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以选择讲述你的故事。</p><p id="39e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你对这篇文章感兴趣，请阅读我以前的(<strong class="lb iu">https://medium.com/@dar.wtz)</strong>:</p><p id="d9b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">棒棒糖和哑铃图，有曲线、平均值或中值？</p><div class="nj nk gp gr nl nm"><a rel="noopener follow" target="_blank" href="/lollipop-dumbbell-charts-with-plotly-696039d5f85"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">Plotly的棒棒糖和哑铃图表</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">均值还是中值？</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">towardsdatascience.com</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa ks nm"/></div></div></a></div><p id="4e88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">斜率图表，为什么和如何，用斜率讲故事</p><div class="nj nk gp gr nl nm"><a rel="noopener follow" target="_blank" href="/slope-charts-why-how-11c2a0bc28be"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">斜率图表，为什么和如何</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">用斜坡讲故事</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">towardsdatascience.com</p></div></div><div class="nv l"><div class="ob l nx ny nz nv oa ks nm"/></div></div></a></div></div></div>    
</body>
</html>