<html>
<head>
<title>Forgot to make a Christmas card? Let’s make one with AI!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">忘记做圣诞卡了？我们用 AI 做一个吧！</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/forgot-to-make-a-christmas-card-lets-make-one-with-ai-f2e1808b37a0?source=collection_archive---------33-----------------------#2021-12-21">https://towardsdatascience.com/forgot-to-make-a-christmas-card-lets-make-one-with-ai-f2e1808b37a0?source=collection_archive---------33-----------------------#2021-12-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1c8c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在 OpenCV 和 UbiOps 的一点帮助下</h2></div><h1 id="32c7" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">介绍</h1><p id="0198" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">圣诞节又到了，我想这将是一个用编码和人工智能做些有趣事情的好机会！让我们制作一个简单的图像处理应用程序，给图片中的每个人一顶漂亮的圣诞老人帽子，并挂上一些圣诞装饰品，使图片更加喜庆。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi lt"><img src="../Images/1054f8233a6edcb4eee205fd3151f79f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BJEnvukVs_iTcmcy"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">模型的输入和输出示例。图片由作者提供。</p></figure><p id="f500" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">你可以通过使用令牌<code class="fe mp mq mr ms b">Token b1cc8511a5c8d59dfc43834b426deec265fa7729</code>前往<a class="ae mo" href="https://requests.ubiops.com/projects/anouk-demo-project/deployments/christmas-model" rel="noopener ugc nofollow" target="_blank">这个页面</a>来尝试这个应用的工作演示。填写完令牌后，您可以单击“连接”按钮，然后您将被带到一个可以上传图片的界面。只需点击运行按钮，该应用程序将为您的图像添加一些节日欢呼。</p><p id="2f9d" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated"><em class="mt">免责声明:确保每个面部上方都有足够的空间放置圣诞帽。此外，图像分辨率越高，建模时间越长。分辨率较低的图像效果更好！</em></p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mu"><img src="../Images/ca517834159bd76bd2fa6278aec5e775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E_dhsJuPFqp4svJ-"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated">交互式演示屏幕。图片由作者提供。</p></figure><h1 id="1821" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">应用程序的工作方式</h1><p id="1b54" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们看看这个应用程序是如何工作的。它实际上相对简单，只需要大约 50 行代码。它分 4 步工作:</p><ol class=""><li id="18cd" class="mv mw iq kz b la mj ld mk lg mx lk my lo mz ls na nb nc nd bi translated">在输入图像上调整圣诞装饰图像的大小并叠加</li><li id="6782" class="mv mw iq kz b la ne ld nf lg ng lk nh lo ni ls na nb nc nd bi translated">检测输入图像中的人脸(使用哈尔级联)</li><li id="e0e3" class="mv mw iq kz b la ne ld nf lg ng lk nh lo ni ls na nb nc nd bi translated">把圣诞帽戴在脸上</li><li id="da19" class="mv mw iq kz b la ne ld nf lg ng lk nh lo ni ls na nb nc nd bi translated">保存生成的图像并将其作为输出返回</li></ol><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi lt"><img src="../Images/cc29701c507e3128f2a4a921061800a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*w4wRuVpWV58oIYR6"/></div></div><p class="mf mg gj gh gi mh mi bd b be z dk translated"><em class="nj">模型的示意图。由</em><a class="ae mo" href="https://www.freepik.com" rel="noopener ugc nofollow" target="_blank"><em class="nj">Freepik</em></a><em class="nj">制作的图标来自</em><a class="ae mo" href="http://www.flaticon.com" rel="noopener ugc nofollow" target="_blank"><em class="nj">www.flaticon.com</em></a><em class="nj">。作者提供的示意图。</em></p></figure><p id="d761" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">app 本身在<a class="ae mo" href="https://ubiops.com/" rel="noopener ugc nofollow" target="_blank"> UbiOps </a>中服务，部署后自动生成界面。</p><h1 id="36e4" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">代码</h1><p id="cb12" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">下面你可以看到上传到 UbiOps 的代码。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="0e1b" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">在<code class="fe mp mq mr ms b">__init__</code>函数中，我们通过加载必要的叠加图像和用于人脸检测的 Haar 级联分类器来初始化模型。分类器是一个标准的分类器，默认由<a class="ae mo" href="https://opencv.org/" rel="noopener ugc nofollow" target="_blank"> open-cv </a>提供。你可以很容易地把这个换成不同的 Haar 级联分类器来进行人脸检测。如果你想更多地了解哈尔喀斯，<a class="ae mo" rel="noopener" target="_blank" href="/face-detection-with-haar-cascade-727f68dafd08">Girija Shankar be hera</a><a class="nm nn ep" href="https://medium.com/u/15521c3a84a9?source=post_page-----f2e1808b37a0--------------------------------" rel="noopener" target="_blank">的这篇文章</a>很棒！</p><p id="0a21" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">每次向模型发出请求时，都会调用<code class="fe mp mq mr ms b">request</code>函数，所以这是主要代码块所在的地方。我们从读入输入图像并检查其尺寸开始。try-except 子句的存在是因为我们无法预先知道输入图像是 BGR 图像还是二进制图像，这将影响 frame.shape 返回的值。一旦我们知道了图像的尺寸，我们就可以调整圣诞装饰图像的大小，并使用<a class="ae mo" href="https://github.com/cvzone/cvzone" rel="noopener ugc nofollow" target="_blank"> cvzone </a>将它们覆盖在输入图像上。</p><p id="2a35" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">之后，我们将输入图像转换为灰度图像以进行快速处理，并使用我们的分类器来检测人脸。我们遍历找到的面，并对每个面执行以下操作:</p><ul class=""><li id="34fc" class="mv mw iq kz b la mj ld mk lg mx lk my lo mz ls no nb nc nd bi translated">我们检查面部是否大于最小阈值，以确保我们筛选出一些错误的检测。</li><li id="5b99" class="mv mw iq kz b la ne ld nf lg ng lk nh lo ni ls no nb nc nd bi translated">我们调整圣诞帽图像的大小以适合头部的大小</li><li id="94f4" class="mv mw iq kz b la ne ld nf lg ng lk nh lo ni ls no nb nc nd bi translated">我们把圣诞帽放在脸的上方</li></ul><p id="97db" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">最后，我们将生成的图像写入一个 PNG 文件，并将其作为输出返回。</p><h1 id="c739" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">其他必要的文件</h1><p id="1491" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了正确部署应用程序，我们需要的不仅仅是代码本身。我们还需要一个详细说明代码依赖关系的需求文件，当然还有所有的图像文件和 Haar cascade 文件。</p><p id="d0fa" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">对于此模型，requirements.txt 文件如下所示:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="f7f0" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">我们使用的图像取自<a class="ae mo" href="https://pngtree.com/freepng/santa-claus-red-christmas-hat-cartoon_5594267.html" rel="noopener ugc nofollow" target="_blank"> pngtree </a>和<a class="ae mo" href="https://www.pngkey.com/maxpic/u2e6t4r5y3q8i1u2/" rel="noopener ugc nofollow" target="_blank"> pngkey </a>，Haar cascade 文件是 OpenCV 的标准文件。</p><p id="f4b9" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">我们只需要一个文件来将模型部署到 UbiOps，那就是<a class="ae mo" href="https://ubiops.com/docs/deployments/deployment-package/ubiops-yaml/" rel="noopener ugc nofollow" target="_blank"> ubiops.yaml </a>。当我们将代码推送到 UbiOps 时，会生成一个 Docker 映像，其中安装了所有 Python 依赖项。然而，在我们的例子中，我们需要的不仅仅是 Python 依赖。<a class="ae mo" href="https://stackoverflow.com/questions/55313610/importerror-libgl-so-1-cannot-open-shared-object-file-no-such-file-or-directo" rel="noopener ugc nofollow" target="_blank"> Opencv 需要一些额外的操作系统级包</a>，这些包通常已经安装在你的本地机器上，但不在 Docker 镜像中。我们需要告诉 UbiOps 安装 APT，这正是 ubiops.yaml 的作用。我们需要的是这样的:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h1 id="9c93" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">为应用服务</h1><p id="805b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">代码由 UbiOps 中的一个<strong class="kz ir"> python 3.8 部署</strong>提供，其中<code class="fe mp mq mr ms b">input_image</code>作为输入，<code class="fe mp mq mr ms b">festive_image</code>作为输出。我们使用的完整部署包可以在<a class="ae mo" href="https://github.com/UbiOps/tutorials/tree/master/ready-deployments/christmas-model" rel="noopener ugc nofollow" target="_blank">这里</a>找到。UbiOps 通过我们可以使用的 API 端点公开代码，但它也自动生成一个简单的接口。这个接口对于这个模型来说已经足够好了，所以我们只需要创建一个 API 令牌来访问这个接口，这样就完成了！你已经创建了一个简单的图像处理应用程序来转换你的图像，添加一些非常需要的节日欢呼。</p><h1 id="57da" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">后续步骤</h1><p id="a719" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">当然，本文中描述的模型非常简单，有时可能会错误地将背景噪声识别为人脸。为了避免这种情况，可以使用不同的面部检测算法，或者在面部循环中使用不同的滤波器参数。<a class="ae mo" rel="noopener" target="_blank" href="/a-guide-to-face-detection-in-python-3eab0f6b9fc1">这篇文章</a>由<a class="nm nn ep" href="https://medium.com/u/ddcee06de4c8?source=post_page-----f2e1808b37a0--------------------------------" rel="noopener" target="_blank">马尔·杨奇煜</a>撰写，是关于 Python 中不同人脸检测方法的很好的参考资料。</p><p id="c198" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">然而，代码中的主要步骤适用于广泛的用例，而不仅仅是这个圣诞用例。这个应用程序可能只是让你的图像更快乐一点，但它确实告诉你如何检测人脸，以及如何根据这些数据改变图像。例如，如果你把圣诞帽换成太阳镜并改变偏移量，你可以很容易地制作一个 Snapchat 滤镜。随意摆弄代码，创造出完全不同的东西。希望这个圣诞模型能给你一些探索 Python 中图像处理的灵感。</p><p id="d8d4" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">请在评论中告诉我你对我的实现有什么看法，不要忘记添加你的圣诞图片！</p><p id="17bc" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">您对 Python 的图像识别和处理感兴趣吗？那你也应该看看 <a class="ae mo" href="https://ubiops.com/building-a-low-code-app-powered-by-ai/" rel="noopener ugc nofollow" target="_blank"> <em class="mt">这篇文章讲的是一个用 Python 和 Mendix 做的年龄估算器 app </em> </a> <em class="mt">。</em></p></div></div>    
</body>
</html>