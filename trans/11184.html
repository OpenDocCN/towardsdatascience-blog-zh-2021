<html>
<head>
<title>Build REST API for Machine Learning Models using Python and Flask-RESTful</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python和Flask-RESTful为机器学习模型构建REST API</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-rest-api-for-machine-learning-models-using-python-and-flask-restful-7b2cd8d87aa0?source=collection_archive---------1-----------------------#2021-11-02">https://towardsdatascience.com/build-rest-api-for-machine-learning-models-using-python-and-flask-restful-7b2cd8d87aa0?source=collection_archive---------1-----------------------#2021-11-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="148c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">数据科学家可以遵循的最小工作示例</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/87d4922a50c5fc7c566f8afe42de0c67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*z2lBT46idpMUZFps"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@marcinjozwiak" rel="noopener ugc nofollow" target="_blank"> Marcin Jozwiak </a>在<a class="ae ky" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="fa43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="#a199" rel="noopener ugc nofollow"> 1。简介</a> <br/> <a class="ae ky" href="#73c5" rel="noopener ugc nofollow"> 2。环境设置</a> <br/> ∘ <a class="ae ky" href="#22b9" rel="noopener ugc nofollow"> 2.1使用conda </a> <br/> ∘ <a class="ae ky" href="#3053" rel="noopener ugc nofollow"> 2.2使用pip </a> <br/> ∘ <a class="ae ky" href="#15ba" rel="noopener ugc nofollow"> 2.3为它创建一个conda环境</a> <br/> <a class="ae ky" href="#73d4" rel="noopener ugc nofollow"> 3 .培养一个最小ML模型</a> <br/> <a class="ae ky" href="#6672" rel="noopener ugc nofollow"> 4。构建REST API </a> <br/> ∘ <a class="ae ky" href="#83e8" rel="noopener ugc nofollow"> 4.1理解代码</a> <br/> ∘ <a class="ae ky" href="#5ff4" rel="noopener ugc nofollow"> 4.2旋起REST API </a> <br/> <a class="ae ky" href="#ba08" rel="noopener ugc nofollow"> 5 .测试API </a> <br/> <a class="ae ky" href="#b913" rel="noopener ugc nofollow">结论</a> <br/> <a class="ae ky" href="#0df6" rel="noopener ugc nofollow">关于我</a> <br/> <a class="ae ky" href="#1d89" rel="noopener ugc nofollow">参考文献</a></p><p id="f0e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注</strong>:本帖提到的所有代码和结果都可以从我的<a class="ae ky" href="https://github.com/zhouxu-ds/ds-tools/tree/master/flask/flask_api" rel="noopener ugc nofollow" target="_blank"> GitHub页面</a>访问。</p><h1 id="a199" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak"> 1。简介</strong></h1><p id="9ccf" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">作为数据科学家，我们不仅需要构建模型，还需要部署它们，并使它们在完整的系统中有用。在许多情况下，我们需要与其他开发人员合作，将模型保存在单独的位置并使用API将模型提供给其他应用程序几乎总是一个好主意。</p><p id="5d67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应用程序编程接口(API)是一种web服务，它允许访问其他应用程序可以通过标准HTTP协议访问的特定数据和方法，而表述性状态转移(REST)是web服务最流行的API架构风格之一。另一方面，Python是数据科学家最喜欢的语言，有两种流行的web框架:Django和Flask。与Django相比，Flask以轻量级和快速开发著称。它也有许多扩展来为vanilla Flask应用程序添加特定的功能，Flask-RESTful是一个完美的选择，可以让构建一个功能完整的REST API变得非常容易。</p><p id="9cf3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我将带你通过一个例子和你需要遵循的所有代码，来了解如何使用Flask-RESTful构建一个最小可行的REST API。这篇文章有三个主要部分:</p><ul class=""><li id="d5fe" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated"><strong class="lb iu">制作一个ML模型</strong>:一个使用玩具数据集的简单模型</li><li id="bec9" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">构建一个REST API:</strong>post的主要部分。为刚做好的ML模型服务</li><li id="11c8" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">测试API </strong>:通过调用API使用模型进行预测</li></ul><h1 id="73c5" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">2.环境设置</h1><p id="1cf1" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">因为这是一个最小的例子，所以不需要很多包。可以用<code class="fe ng nh ni nj b">conda</code>也可以用<code class="fe ng nh ni nj b">pip</code>。对于下面的2.1到2.3，选择任何一种你感兴趣的方法。完成这些之后，你可以直接跳到第三部分。</p><h2 id="22b9" class="nk lw it bd lx nl nm dn mb nn no dp mf li np nq mh lm nr ns mj lq nt nu ml nv bi translated">2.1使用conda</h2><p id="4989" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果您安装了conda，您可以运行:</p><p id="95f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ng nh ni nj b">conda install -c conda-forge numpy scikit-learn flask-restful requests</code></p><h2 id="3053" class="nk lw it bd lx nl nm dn mb nn no dp mf li np nq mh lm nr ns mj lq nt nu ml nv bi translated">2.2使用画中画</h2><p id="191c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果没有安装conda，<code class="fe ng nh ni nj b">pip</code>也可以通过运行:</p><p id="ac24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ng nh ni nj b">pip install numpy scikit-learn flask-restful requests</code></p><h2 id="15ba" class="nk lw it bd lx nl nm dn mb nn no dp mf li np nq mh lm nr ns mj lq nt nu ml nv bi translated">2.3为it创造康达环境</h2><p id="8d81" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">有时，为不同的项目保留不同的环境是有益的，因此如果您想创建另一个虚拟环境，可以运行以下命令:</p><p id="59b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ng nh ni nj b">conda create --name flask_api -c conda-forge numpy scikit-learn flask-restful requests</code></p><p id="65e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它将创建另一个名为<code class="fe ng nh ni nj b">flask_api</code>的环境，安装了这些软件包，您可以通过运行以下命令切换到新环境:</p><p id="12b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ng nh ni nj b">conda activate flask_api</code></p><p id="5384" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你也可以使用<code class="fe ng nh ni nj b">pip</code>创建虚拟环境，但是我将跳过这一步，因为你可以很容易地在网上找到教程。</p><h1 id="73d4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">3.训练最小ML模型</h1><p id="8d65" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">东西摆好之后，我们先来搭建一个玩具ML模型。要获得更完整的代码和结果，请参考<a class="ae ky" href="https://github.com/zhouxu-ds/ds-tools/blob/master/flask/flask_api/train_model.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本</a>，但以下是该部分的最低可行代码，也可以从<a class="ae ky" href="https://github.com/zhouxu-ds/ds-tools/blob/master/flask/flask_api/train_model.py" rel="noopener ugc nofollow" target="_blank">这里</a>下载。我们把它命名为<code class="fe ng nh ni nj b">train_model.py</code>，你可以使用<code class="fe ng nh ni nj b">python train_model.py</code>来运行</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="de73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你熟悉机器学习，并且有过一些使用<code class="fe ng nh ni nj b">scikit-learn</code>的实践经验，那么代码应该对你有意义。</p><p id="36c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基本上，我们首先加载一个玩具数据集<code class="fe ng nh ni nj b">iris</code>，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/b345863de15b9d6c5aa04ba6fcbb2fbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*3bSdZPSDbXspioGBa5twGg.png"/></div></figure><p id="fecf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有150条记录。它们中的每一种都有4个特征，并被标记为3类中的一类(刚毛藻、杂色藻和海滨藻)。</p><p id="6dfc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在此示例中，我们直接训练模型并跳过微调部分，然后使用模型对测试集进行预测:</p><pre class="kj kk kl km gt nz nj oa ob aw oc bi"><span id="a5a6" class="nk lw it nj b gy od oe l of og">[0 2 0 1 2 2 2 0 2 0 1 0 0 0 1 2 2 1 0 1 0 1 2 1 0 2 2 1 0 0 0 1 2 0 2 0 1 1]</span></pre><p id="b8ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中数字代表3类中的每一类。通过与真实标签比较，我们发现准确率为97%，混淆矩阵如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/783b641521db0319cc0e03bd17a16b23.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*e15oi7-JKqPkf1QR6LWfHw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1:测试集上模型预测的混淆矩阵(直接来自模型对象)</p></figure><p id="0f9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的表现已经足够好了(可能现实生活中太好了)。然后，我们通过在pickle文件中序列化来保存训练好的模型。</p><h1 id="6672" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">4.构建REST API</h1><h2 id="83e8" class="nk lw it bd lx nl nm dn mb nn no dp mf li np nq mh lm nr ns mj lq nt nu ml nv bi translated">4.1理解代码</h2><p id="5fb8" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">现在，一个简单的模型已经准备好了，让我们构建一个REST API。同样，下面是代码，我会一步一步地解释它。也可以从<a class="ae ky" href="https://github.com/zhouxu-ds/ds-tools/blob/master/flask/flask_api/api.py" rel="noopener ugc nofollow" target="_blank">我的GitHub </a>下载。我们把这个命名为<code class="fe ng nh ni nj b">api.py</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><pre class="kj kk kl km gt nz nj oa ob aw oc bi"><span id="b165" class="nk lw it nj b gy od oe l of og">app = Flask(__name__)<br/>api = Api(app)</span></pre><p id="a239" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们导入模块，上面的两行应该几乎总是存在于代码的顶部，以初始化flask app和API。</p><pre class="kj kk kl km gt nz nj oa ob aw oc bi"><span id="e5ef" class="nk lw it nj b gy od oe l of og"><em class="oi"># Create parser for the payload data<br/></em>parser = reqparse.RequestParser()<br/>parser.add_argument(<strong class="nj iu">'data'</strong>)</span></pre><p id="fc75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码块创建了一个请求解析器来解析将随请求一起发送的参数。在我们的例子中，由于我们服务于ML模型，我们通常以JSON序列化格式发送数据，并将键命名为<code class="fe ng nh ni nj b">data</code>，因此我们要求解析器查找请求中包含的数据。</p><pre class="kj kk kl km gt nz nj oa ob aw oc bi"><span id="4c55" class="nk lw it nj b gy od oe l of og"><em class="oi"># Define how the api will respond to the post requests<br/></em>class IrisClassifier(Resource):<br/>    def post(self):<br/>        args = parser.parse_args()<br/>        X = np.array(json.loads(args[<strong class="nj iu">'data'</strong>]))<br/>        prediction = model.predict(X)<br/>        return jsonify(prediction.tolist())<br/><br/>api.add_resource(IrisClassifier, <strong class="nj iu">'/iris'</strong>)</span></pre><p id="dc13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们通过继承从<code class="fe ng nh ni nj b">flask-restful</code>导入的<code class="fe ng nh ni nj b">Resource</code>类来创建一个名为<code class="fe ng nh ni nj b">IrisClassifier</code>的类，它已经定义了处理不同类型请求的各种方法，包括<code class="fe ng nh ni nj b">get</code> <code class="fe ng nh ni nj b">post</code> <code class="fe ng nh ni nj b">put</code> <code class="fe ng nh ni nj b">delete</code>等等。我们的目标是重写<code class="fe ng nh ni nj b">post</code>方法，告诉它如何使用模型对给定数据进行预测。因为我们的API的目的是服务于ML模型，我们只需要<code class="fe ng nh ni nj b">post</code>方法，不用担心其他的。</p><p id="8deb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe ng nh ni nj b">post</code>方法中，我们首先调用刚刚定义的解析器来获取参数。数据(最初是np.array)在JSON中被序列化为字符串格式，所以我们使用<code class="fe ng nh ni nj b">json.loads</code>将其反序列化为一个列表，然后返回到一个NumPy数组。预测部分和<code class="fe ng nh ni nj b">scikit-learn</code>模型一直做的一样。在最后一步，我们需要将预测的标签(np.array)放回列表，并调用从<code class="fe ng nh ni nj b">flask</code>导入的<code class="fe ng nh ni nj b">jsonify</code>函数再次序列化它，以便它们以正确的格式返回给应用程序。</p><p id="5853" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在定义了类之后，我们将我们的<code class="fe ng nh ni nj b">IrisClassifier</code>(本质上是一个修改过的<code class="fe ng nh ni nj b">resource</code>类)连同访问它的相对路径一起添加到我们的API中，在我们的例子中是<code class="fe ng nh ni nj b">/iris</code>。如果我们只是在本地运行flask，那么ML模型的整个URL将类似于<code class="fe ng nh ni nj b"><a class="ae ky" href="http://127.0.0.1:5000/iris" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:5000/iris</a></code>。</p><pre class="kj kk kl km gt nz nj oa ob aw oc bi"><span id="242c" class="nk lw it nj b gy od oe l of og">if __name__ == <strong class="nj iu">'__main__'</strong>:<br/>    <em class="oi"># Load model<br/>    </em>with open(<strong class="nj iu">'model.pickle'</strong>, <strong class="nj iu">'rb'</strong>) as f:<br/>        model = pickle.load(f)<br/><br/>    app.run(debug=True)</span></pre><p id="4d30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe ng nh ni nj b">api.py</code>代码的最后一部分，我们加载从上一节保存的模型，以便应用程序知道如果需要任何预测，从哪里获取模型。然后，我们在调试模式下运行flask应用程序，如果发生任何错误，它只允许在浏览器中直接执行任意代码。</p><h2 id="5ff4" class="nk lw it bd lx nl nm dn mb nn no dp mf li np nq mh lm nr ns mj lq nt nu ml nv bi translated">4.2启动REST API</h2><p id="6d4e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果您有保存为<code class="fe ng nh ni nj b">api.py</code>的代码，您可以使用:</p><p id="48f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ng nh ni nj b">python api.py</code></p><p id="4749" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将会出现如下信息:</p><pre class="kj kk kl km gt nz nj oa ob aw oc bi"><span id="8d2a" class="nk lw it nj b gy od oe l of og">* Serving Flask app "api" (lazy loading)<br/> * Environment: production<br/>   WARNING: This is a development server. Do not use it in a production deployment.<br/>   Use a production WSGI server instead.<br/> * Debug mode: on<br/> * Running on <a class="ae ky" href="http://127.0.0.1:5000/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:5000/</a> (Press CTRL+C to quit)<br/> * Restarting with stat<br/> * Debugger is active!<br/> * Debugger PIN: 117-609-315</span></pre><p id="0da5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那你就可以走了！</p><h1 id="ba08" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">5.测试API</h1><p id="2429" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果您遵循了前面的章节，那么您应该已经在本地机器上运行了REST API。现在是测试的时候了，看看是否有效。同样，下面是您需要复制、粘贴和运行的所有代码(最少)。更多完整的代码和结果，请参见<a class="ae ky" href="https://github.com/zhouxu-ds/ds-tools/blob/master/flask/flask_api/test_api.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本</a>，或者下面的代码，您可以在这里访问<a class="ae ky" href="https://github.com/zhouxu-ds/ds-tools/blob/master/flask/flask_api/test_api.py" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="cc57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我会一步一步地解释代码。我们把它命名为<code class="fe ng nh ni nj b">test_api.py</code>，你可以通过调用<code class="fe ng nh ni nj b">python test_api.py</code>来运行它</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><pre class="kj kk kl km gt nz nj oa ob aw oc bi"><span id="8fd6" class="nk lw it nj b gy od oe l of og"><em class="oi"># Load data<br/></em>iris = load_iris()<br/><br/><em class="oi"># Split into train and test sets using the same random state<br/></em>X_train, X_test, y_train, y_test = \<br/>    train_test_split(iris[<strong class="nj iu">'data'</strong>], iris[<strong class="nj iu">'target'</strong>], random_state=12)</span></pre><p id="d5a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导入相关模块后，首先要做的是获取一个数据子集(仅特性)来测试API返回的预测。为了便于比较，我们可以使用我们在第3节中拆分的相同测试集。我们可以加载iris数据集，并使用相同的随机状态(12)来获得数据的确切子集<code class="fe ng nh ni nj b">X_test</code>。</p><pre class="kj kk kl km gt nz nj oa ob aw oc bi"><span id="4bbb" class="nk lw it nj b gy od oe l of og"><em class="oi"># Serialize the data into json and send the request to the model<br/></em>payload = {<strong class="nj iu">'data'</strong>: json.dumps(X_test.tolist())}<br/>y_predict = requests.post(<strong class="nj iu">'http://127.0.0.1:5000/iris'</strong>, data=payload).json()</span></pre><p id="d9ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们创建一个<code class="fe ng nh ni nj b">payload</code>变量，将<code class="fe ng nh ni nj b">X_test</code>的列表序列化为JSON格式，key为<code class="fe ng nh ni nj b">data</code>，就像我们在<code class="fe ng nh ni nj b">api.py</code>中定义的那样，这样我们的API就知道在哪里可以找到输入数据。然后，我们将有效负载发送到我们定义的端点，并获得预测结果。</p><pre class="kj kk kl km gt nz nj oa ob aw oc bi"><span id="60b8" class="nk lw it nj b gy od oe l of og"><em class="oi"># Make array from the list<br/></em>y_predict = np.array(y_predict)<br/>print(y_predict)</span></pre><p id="abe8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一步是可选的，但是我们可以将数据返回到NumPy数组并打印出预测，这与我们之前在第3节中创建模型时得到的结果完全相同。混淆矩阵也完全相同:</p><pre class="kj kk kl km gt nz nj oa ob aw oc bi"><span id="0ea0" class="nk lw it nj b gy od oe l of og">[0 2 0 1 2 2 2 0 2 0 1 0 0 0 1 2 2 1 0 1 0 1 2 1 0 2 2 1 0 0 0 1 2 0 2 0 1 1]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/924cb59fcd329ff788a30815216fa2f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*r95xg1YBd37UAcTtSbLEoA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1:测试集上模型预测的混淆矩阵(来自REST API)</p></figure><p id="dbd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在REST API端，在使用了<code class="fe ng nh ni nj b">post</code>方法之后，我们可以看到显示响应为200的消息，这意味着请求已经被成功处理:</p><pre class="kj kk kl km gt nz nj oa ob aw oc bi"><span id="1d8a" class="nk lw it nj b gy od oe l of og">127.0.0.1 - - [01/Nov/2021 17:01:42] "POST /iris HTTP/1.1" 200 -</span></pre><p id="4852" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我们已经测试了刚刚构建的REST API，并获得了与原始模型对象返回的结果完全相同的结果。我们的API管用！</p><h1 id="b913" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="d8cc" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们刚刚介绍了使用Python和Flask-RESTFul构建一个全功能REST API所需的基本知识和步骤。如果我们只看API构建部分(第4节)，它确实非常简单——不到30行代码，其中大多数只是标准语句。修改代码也非常容易:您所需要做的就是替换您想要使用的模型，指定<code class="fe ng nh ni nj b">post</code>方法如何工作，并给出访问API的正确路径。</p><p id="3309" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了进一步利用我们刚刚构建的REST API来为其他应用程序提供我们的机器学习模型，我们可以将它部署在服务器上，或者使用任何流行的云web托管服务:AWS、Google Cloud、Heroku等。通过适当的配置，任何获得许可的人都可以从世界上的任何地方访问我们的模型。</p><p id="8649" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读！如果你喜欢这篇文章，请<strong class="lb iu">关注我的频道</strong>和/或<a class="ae ky" href="https://zhouxu-ds.medium.com/membership" rel="noopener"> <strong class="lb iu">成为我今天的推荐会员</strong> </a>(非常感谢🙏).我会继续写下去，分享我关于数据科学的想法和项目。如果你有任何问题，请随时联系我。</p><div class="ok ol gp gr om on"><a href="https://zhouxu-ds.medium.com/membership" rel="noopener follow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd iu gy z fp os fr fs ot fu fw is bi translated">通过我的推荐链接加入Medium周(乔)徐</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">阅读周(Joe)徐(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">zhouxu-ds.medium.com</p></div></div><div class="ow l"><div class="ox l oy oz pa ow pb ks on"/></div></div></a></div><h1 id="0df6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">关于我</h1><p id="f080" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我是赛诺菲的数据科学家。我拥抱技术，每天都在学习新技能。欢迎您通过<a class="ae ky" href="https://zhouxu-ds.medium.com/" rel="noopener">媒体博客</a>、<a class="ae ky" href="https://www.linkedin.com/in/zhouxu-ds/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或<a class="ae ky" href="https://github.com/zhouxu-ds" rel="noopener ugc nofollow" target="_blank"> GitHub </a>联系我。我的观点是我自己的，而不是我雇主的观点。</p><p id="c456" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请看我的其他文章:</p><ul class=""><li id="bc0f" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/time-series-pattern-recognition-with-air-quality-sensor-data-4b94710bb290">利用空气质量传感器数据进行时间序列模式识别</a></li><li id="e858" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><a class="ae ky" href="https://medium.com/@zhouxu-ds/understanding-sigmoid-logistic-softmax-functions-and-cross-entropy-loss-log-loss-dbbbe0a17efb" rel="noopener">理解分类问题中的Sigmoid、Logistic、Softmax函数和交叉熵损失(对数损失)</a></li><li id="39c3" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/real-time-typeahead-search-with-elasticsearch-aws-opensearch-88410d5b31a1">使用Elasticsearch (AWS OpenSearch)进行实时类型预测搜索</a></li><li id="2c07" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/loan-default-prediction-for-profit-maximization-45fcd461582b">利润最大化的贷款违约预测</a></li><li id="2b86" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/loan-default-prediction-an-end-to-end-ml-project-with-real-bank-data-part-1-1405f7aecb9e">使用Berka数据集进行贷款违约预测</a></li></ul><h1 id="1d89" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">参考</h1><p id="7fe2" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">[1]如何将Python请求模块与REST API一起使用:<a class="ae ky" href="https://www.nylas.com/blog/use-python-requests-module-rest-apis/" rel="noopener ugc nofollow" target="_blank">https://www . nylas . com/blog/Use-Python-Requests-Module-REST-API/</a></p><p id="7b45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[2] Python REST API教程—构建Flask REST API:<a class="ae ky" href="https://www.youtube.com/watch?v=GMppyAPbLYk&amp;t=3769s&amp;ab_channel=TechWithTim" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=GMppyAPbLYk&amp;t = 3769s&amp;ab _ channel = TechWithTim</a></p></div></div>    
</body>
</html>