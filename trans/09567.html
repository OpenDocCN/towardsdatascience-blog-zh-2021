<html>
<head>
<title>Face Landmark Detection using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Python的人脸标志点检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/face-landmark-detection-using-python-1964cb620837?source=collection_archive---------2-----------------------#2021-09-06">https://towardsdatascience.com/face-landmark-detection-using-python-1964cb620837?source=collection_archive---------2-----------------------#2021-09-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3220" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">dlib和mediapipe库的比较。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/eebc0137d3700e2a756200ce4c14092c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sTaTawbwbixJFzyQMIh2JA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">德米特里·秋科夫在<a class="ae ky" href="https://unsplash.com/s/photos/selfie?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="6b44" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="c9e2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">人脸标志点检测是一项计算机视觉任务，我们希望从人脸中检测和跟踪关键点。这项任务适用于许多问题。</p><p id="e8e8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">例如，我们可以使用关键点来检测人的头部姿势位置和旋转。有了这个，我们就可以追踪司机是否注意了。此外，我们可以使用关键点来更容易地应用增强现实。基于这项任务，我们可以产生很多解决方案。</p><p id="92e8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">值得庆幸的是，我们不必详细理解面部标志检测的概念。我们可以使用预先构建的库，如dlib、OpenCV和mediapipe。在本文中，我将向您展示如何使用dlib和mediapipe实现人脸地标检测。</p><p id="ed22" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">没有进一步，让我们开始吧！</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="61b1" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">基于Dlib的人脸标志点检测</h1><p id="3805" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Dlib是一个应用机器学习和计算机视觉解决方案的库。这个库是基于C++语言的，但是我们可以使用像Python这样的语言来使用这个库。通过使用这个库，我们可以应用的解决方案之一是面部标志检测。现在让我们进入实现阶段。</p><h2 id="b6a2" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">安装库</h2><p id="c1a4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">安装库可能会成为一个问题。如果我们没有好的向导，安装库可能需要几天时间。Dlib就是其中之一。因为它使用C++作为主要语言，所以我们必须安装C++工具来安装库。</p><p id="031c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">安装它需要几个步骤。以下是步骤:</p><ul class=""><li id="fac9" class="nq nr it lt b lu mn lx mo ma ns me nt mi nu mm nv nw nx ny bi translated">首先，安装CMake。你可以在这里下载软件<a class="ae ky" href="https://cmake.org/download/" rel="noopener ugc nofollow" target="_blank"><strong class="lt iu"/></a>。如果您使用的是Windows，请先找到CMake文件路径。然后，在环境变量中将路径设置为可执行路径。</li><li id="4648" class="nq nr it lt b lu nz lx oa ma ob me oc mi od mm nv nw nx ny bi translated">然后，安装带有C++依赖项的Visual Studio。你可以在这里 下载软件<a class="ae ky" href="https://visualstudio.microsoft.com/downloads/" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">。对于依赖关系，您可以查看下面的截图:</strong></a></li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/c03dacabb30814d687acc380dd07f302.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QbXj3rgSZ1WPIlzC1bgC0A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">截图由作者捕捉</p></figure><ul class=""><li id="0ad4" class="nq nr it lt b lu mn lx mo ma ns me nt mi nu mm nv nw nx ny bi translated">安装Visual Studio后，下一步是安装Python。为了使您的安装更简单，我推荐您安装Anaconda。你可以在这里 下载<a class="ae ky" href="https://www.anaconda.com/products/individual-d" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">。对于Python版本，我建议您使用3.6.6版本以避免任何错误。</strong></a></li><li id="2b58" class="nq nr it lt b lu nz lx oa ma ob me oc mi od mm nv nw nx ny bi translated">最后，使用pip安装CMake、dlib和OpenCV库。下面是执行该操作的命令:</li></ul><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="cbfc" class="ne la it og b gy ok ol l om on"><strong class="og iu">pip install cmake<br/>pip install dlib <br/>pip install opencv-contrib-python</strong></span></pre><h2 id="f49e" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">导入库</h2><p id="eb0a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">安装完库之后，下一步是将它们导入到我们的代码中。我们将导入OpenCV来从网络摄像头获取输入，导入NumPy来进行数值计算，导入Dlib来检测人脸的关键点。</p><p id="d1c3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面是实现这一点的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><h2 id="72d5" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">初始化对象</h2><p id="ff96" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在让我们初始化几个变量。我们将初始化三个必须需要的变量:</p><ul class=""><li id="1e19" class="nq nr it lt b lu mn lx mo ma ns me nt mi nu mm nv nw nx ny bi translated">用于检测一个或多个面部的<strong class="lt iu">检测器</strong>。我们在变量内部设置了<strong class="lt iu">dlib . get _ frontier _ face _ detector</strong>函数。</li><li id="c100" class="nq nr it lt b lu nz lx oa ma ob me oc mi od mm nv nw nx ny bi translated">用于从面部检测关键点的<strong class="lt iu">预测器</strong>。我们在变量内部设置了<strong class="lt iu"> dlib.shape_predictor </strong>函数。该功能需要一个预先训练好的模型位置作为参数，您可以在这里 下载<a class="ae ky" href="https://github.com/italojs/facial-landmarks-recognition/blob/master/shape_predictor_68_face_landmarks.dat" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">。</strong></a></li><li id="0482" class="nq nr it lt b lu nz lx oa ma ob me oc mi od mm nv nw nx ny bi translated"><strong class="lt iu"> cv2。VideoCapture </strong>用于从网络摄像头捕捉图像的对象。此外，我们为从网络摄像头捕捉图像设置了一个值为0的参数。</li></ul><p id="2e9d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们编写初始化变量的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><h2 id="7148" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">人脸标志检测机制</h2><p id="fcb9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">正如你从上面看到的，我们通过使用预训练模型来初始化面部标志检测器。该模型基于集合回归树，因为该模型将预测连续的数字。你可以在这里 阅读关于<a class="ae ky" href="http://kth.diva-portal.org/smash/get/diva2:713097/FULLTEXT01" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">车型的详细信息。</strong></a></p><p id="a599" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">该模型在iBUG-300 W数据集上进行训练，其中包含图像及其对应的68个面部标志点。一般来说，这些标志点属于鼻子、眼睛、嘴和脸的边缘。你可以在这里 下载数据集<a class="ae ky" href="https://ibug.doc.ic.ac.uk/resources/facial-point-annotations/" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">。</strong></a></p><p id="7bba" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面是面部标志位置的可视化:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/dd413ab9fcce88932d6c316c3557c0b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*SeFXG-7yN9SA_3e7RKJpnQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">这张图片是由来自CMU的Brandon Amos创建的</p></figure><h2 id="403d" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">实现人脸标志点检测</h2><p id="dd97" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在你知道面部标志检测算法是如何工作的了。现在让我们实现算法。为了实现这一点，您可以查看下面的代码以及每行代码的解释:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="90ea" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">通过将所有代码组合成一个，现在让我们来尝试代码！如果代码没有任何错误，网络摄像头将显示结果以及关键点。我的情况是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/caaa8d9883b2e1946911bc9e549b6d3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0UhQDAM1cALZXuqQnoZDgQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">该图像由作者捕获。</p></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="faa8" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">基于Mediapipe的人脸标志检测</h1><p id="2293" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Mediapipe是一个实现基于ML的计算机视觉解决方案的工具。这个工具是由谷歌开发的。</p><p id="4246" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这个工具包含各种计算机视觉解决方案，如人脸检测，姿态估计，物体检测等等。</p><p id="c50e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这个库的优点是你可以在很多平台上应用这些解决方案，比如web、移动、PC等等。</p><p id="8b23" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在上一节中，我已经向您解释了如何使用dlib实现面部标志检测。现在让我们使用Mediapipe实现面部标志检测。</p><h2 id="471a" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">该机制</h2><p id="f2e2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">该库使用BlazeFace模型来检测面部标志。BlazeFace是一个深度学习模型，已经针对智能手机等低规格设备进行了优化。因此，我们可以实时使用该模型。</p><p id="7ae5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">BlazeFace包含两个主要步骤。首先，该模型检测图像上的一个或多个人脸。第二，图像通过使用回归检测大约468个面部关键点。</p><p id="3778" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">与dlib库不同的是，这个模型检测的是3D坐标。这些x和y坐标是根据图像比例归一化的。通过进行屏幕和模型x坐标之间的相对计算来检索z坐标。更多详情<a class="ae ky" href="https://google.github.io/mediapipe/solutions/face_mesh.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">可点击</strong> </a>阅读。</p><p id="6fc3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面是一个面的展平网格及其相应的索引:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/a3126024cd55eab00efef3b8cf94da2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Nnq0vgfnQx1JiDgDePt9g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片摘自TensorFlow的<a class="ae ky" href="https://github.com/tensorflow/tfjs-models/tree/master/facemesh" rel="noopener ugc nofollow" target="_blank"> <strong class="bd ot"> GitHub资源库</strong> </a> <strong class="bd ot">。</strong></p></figure><h2 id="47f9" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">实现人脸标志点检测</h2><p id="0743" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">一般来说，实现面部标志检测的管道与dlib库相同。它从导入库、初始化对象、检测人脸及其标志开始，并完成。</p><p id="530f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面是实现这一点的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="9d17" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您正确实现了代码，图像将显示在您的计算机上。以下是我的结果预览:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/1248abfb4ecd1f1bdf00da56fdfe5090.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VrRqkjnQ250YdPgu"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">该图像由作者捕获。</p></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="2dc0" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">比较</h1><p id="e4dc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们已经使用dlib和mediapipe浏览了人脸标志检测库。我们可以说两个库都很好用。因此，我们可以快速构建我们的解决方案。</p><p id="0876" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然而，它们之间存在差异。dlib库需要C++依赖它。这就是为什么我们需要CMake和Visual Studio来安装这个库。</p><p id="b0a2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">此外，这个库需要一个特定的python库。因此，如果没有受支持的Python版本来运行库，就必须创建一个虚拟环境。</p><p id="4a1f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">另一方面，安装mediapipe更容易。你只需要从pip安装就可以了。因此，在使用mediapipe时，您不必担心更多的安装问题。</p><p id="6e6c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这种情况下，dlib只能检测关键点的2D坐标。另一方面，媒体管道可以检测关键点的3D坐标。因此，您可以使用mediapipe库中的这些关键点来估计头部姿势。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="29a7" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">结束语</h1><p id="e818" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">干得好！现在你知道如何使用Python实现人脸标志检测了。我已经向您展示了用于实现该解决方案的库，如dlib和mediapipe。</p><p id="55e4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我希望它能帮助你实现一个计算机视觉解决方案。还有，我希望它能成为你构建更复杂应用的基础。</p><p id="5f97" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你对我的文章感兴趣，你可以在Medium上关注我，看更多这样的文章。还有，如果你有什么问题，可以在<a class="ae ky" href="https://www.linkedin.com/in/alghaniirfan/" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> LinkedIn </strong> </a>联系我。</p><p id="4ead" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">谢谢你看我的文章！</p><h2 id="80c7" class="ne la it bd lb nf ng dn lf nh ni dp lj ma nj nk ll me nl nm ln mi nn no lp np bi translated">参考</h2><p id="9b8c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">[1]<a class="ae ky" href="https://www.pyimagesearch.com/2017/04/03/facial-landmarks-dlib-opencv-python/" rel="noopener ugc nofollow" target="_blank">https://www . pyimagesearch . com/2017/04/03/face-landmarks-DLI b-opencv-python/</a><br/><a class="ae ky" href="https://www.analyticsvidhya.com/blog/2021/07/facial-landmark-detection-simplified-with-opencv/" rel="noopener ugc nofollow" target="_blank">https://www . analyticsvidhya . com/blog/2021/07/face-landmark-detection-simplified-with-opencv/</a></p></div></div>    
</body>
</html>