<html>
<head>
<title>Creating Azure Databricks with Bicep and Azure DevOps YAML Pipelines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Bicep和Azure DevOps YAML管道创建Azure数据块</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-azure-databricks-with-bicep-and-azure-devops-yaml-pipelines-4bf85be30cc7?source=collection_archive---------20-----------------------#2021-08-20">https://towardsdatascience.com/creating-azure-databricks-with-bicep-and-azure-devops-yaml-pipelines-4bf85be30cc7?source=collection_archive---------20-----------------------#2021-08-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="40d3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">继续DataOps自动化系列，在这篇文章中，我将演示如何使用基础设施作为代码，通过Bicep和Azure DevOps YAML管道在Azure中部署它，来创建您的Databricks工作区。我们去看看吧！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cf056e9555b618624283f37738ee19b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q45YY42etgKPognuoFZJmA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@benjopen?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">本杰明·乔朋</a>在<a class="ae ky" href="https://unsplash.com/s/photos/brick-construction?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="abe4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在之前的文章中，您可以查看如何<a class="ae ky" rel="noopener" target="_blank" href="/dataops-automation-creating-azure-data-factory-with-git-integration-using-bicep-376fd3b5bc81">使用Bicep </a>创建具有git集成的Azure数据工厂，以及为Azure数据工厂创建CI/CD管道的最简单的方法<a class="ae ky" rel="noopener" target="_blank" href="/azure-data-factory-ci-cd-made-simple-building-and-deploying-your-arm-templates-with-azure-devops-30c30595afa5"/></p><p id="17a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在文章的最后，你可以检查一个完整的YAML管道阅读使用！</p><h1 id="89db" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">什么是二头肌模板？</h1><p id="fafc" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果您不熟悉Bicep，这是一个用于ARM模板的DSL，它具有更清晰的语法、对模块更好的支持以及其他出色的特性。它还有一个很好的<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/quickstart-create-bicep-use-visual-studio-code?tabs=CLI&amp;WT.mc_id=devops-34401-jagord" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码扩展</a>，在从头构建模板方面帮助很大。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/d025860cd051d864577f333603738325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/0*FsceF8fsND7cZ2BM.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Visual Studio代码的很好的扩展！—图片来自<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/install#development-environment" rel="noopener ugc nofollow" target="_blank">微软文档</a></p></figure><p id="8f4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您使用bicep模板运行部署时，它会转换文件并生成本机ARM模板，类似于Typescript和Javascript之间发生的情况。</p><p id="41be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想了解更多，查看官方文档<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/overview" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><h1 id="0931" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">将基础设施创建为Azure数据块的代码</h1><h2 id="c69d" class="mt lw it bd lx mu mv dn mb mw mx dp mf li my mz mh lm na nb mj lq nc nd ml ne bi translated">使用Azure CLI创建资源组</h2><p id="0551" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">要部署我们的Databricks工作区，我们需要在您的Azure订阅中创建一个资源组。最简单的方法是通过Azure CLI。为此，您需要使用命令<code class="fe nf ng nh ni b">az login</code>登录，然后运行以下命令:</p><pre class="kj kk kl km gt nj ni nk nl aw nm bi"><span id="1078" class="mt lw it ni b gy nn no l np nq">az group create -name RG-Databricks -location northeurope</span></pre><p id="e4d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将参数名称和位置替换为最适合您需求的名称和位置。</p><h2 id="7825" class="mt lw it bd lx mu mv dn mb mw mx dp mf li my mz mh lm na nb mj lq nc nd ml ne bi translated">为Azure数据块创建Bicep模板</h2><p id="1a44" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Azure Databricks的Bicep模板非常简单，有4个主要部分:</p><p id="848e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">参数:</strong></p><ul class=""><li id="beb1" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">工作区名称:如果您不提供值，它将使用一个<code class="fe nf ng nh ni b">uniqueString</code>函数，这将确保它总是相同的，因为这是基于资源组id的。</li><li id="f21e" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">位置:默认情况下，这是使用资源组位置</li><li id="d277" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">SKU:默认值是试用，所以请务必在您的现实生活场景中替换它；).</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="d297" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">变量:</strong>模板也有变量<code class="fe nf ng nh ni b">managedResourceGroupName</code>。该资源组将由Azure Databricks管理，以便稍后创建您的集群。</p><p id="7160" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">资源:</strong>这里我们只有一个资源，即Databrics工作区。这是消费API版本<code class="fe nf ng nh ni b">2018–04–01</code>。</p><p id="c0f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">输出:</strong>这个部分包含了您需要公开的变量。这意味着它们可以在部署过程的后期被其他过程访问。</p><h1 id="6ae4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用Azure DevOps YAML管道部署Bicep</h1><h2 id="b242" class="mt lw it bd lx mu mv dn mb mw mx dp mf li my mz mh lm na nb mj lq nc nd ml ne bi translated">构建二头肌模板</h2><p id="f594" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">正如我之前所说，将二头肌模板移植到手臂模板中是可能的。因此，为了确保我们的模板是有效的，让我们这样做！</p><p id="bfb9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了构建它，您还将使用Azure CLI。命令也很简单:</p><pre class="kj kk kl km gt nj ni nk nl aw nm bi"><span id="546f" class="mt lw it ni b gy nn no l np nq">az bicep build --file &lt;your file&gt; --outdir &lt;your directory&gt;</span></pre><p id="7ea3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了创建Azure DevOps YAML管道，我们将在AzureCLI任务中运行上面的命令:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="0fbe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将二头肌移植到手臂模板后，它将作为部署人工制品部署，读取以供使用:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/8e37bc7a528d0b9bf8fd66c8a2f48e3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GhTEFX4p8uW0MOolGJJRsQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者准备的图像</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/a4b8cf02c95b406c9c7c12fa994927db.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*GsfTVy6oBm0Deal_YVFUcw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者准备的图像</p></figure><p id="9da9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">构建您的二头肌是一个很好的实践，因为您可以验证其中没有错误，并收集所有需要部署的文件。</p><h2 id="99ba" class="mt lw it bd lx mu mv dn mb mw mx dp mf li my mz mh lm na nb mj lq nc nd ml ne bi translated">使用YAML管道部署Bicep</h2><p id="c504" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">有了构建步骤中生成的工件，现在我们就可以在我们的环境中部署它们了。为此，有必要在构建YAML中再添加一个阶段，其中包含运行ARM模板的指令:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="8a82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它使用负责将ARM模板运行到Azure订阅中的任务<code class="fe nf ng nh ni b">AzureResourceManagerTemplateDeployment@3</code>。你可以在这里获得关于这个任务<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/deploy/azure-resource-group-deployment?view=azure-devops" rel="noopener ugc nofollow" target="_blank">的更多信息。</a></p><p id="b05e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个阶段代表发展阶段。要在其他环境中部署它，您只需复制它并根据您的环境替换值:)</p><h1 id="4034" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">现实生活中的例子</h1><p id="d57e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了在更现实的情况下检查这些例子，我一直在GitHub存储库中工作，其中有一些管道配置和工作的例子。你可以在DevOps Nights GitHub这里查看:<a class="ae ky" href="https://github.com/devopsnights/azuredevops-yaml-quickstart-templates" rel="noopener ugc nofollow" target="_blank">DevOps Nights/azuredevops-YAML-quick start-templates(github.com)</a></p><h1 id="a2f1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">数据布里克斯YAML管道公司</h1><p id="0e9a" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">正如下面所承诺的，你可以检查一个完整的Azure DevOps YAML管道配置和工作:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div></figure><h1 id="6f86" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="573f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Bicep已经成为Azure的一个非常相关的工具，并且很有可能成为Azure中基础设施的默认工具。所以现在就开始熟悉吧，以后会很有关系的:)</p><p id="a877" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇文章能帮到你，下次再见！</p></div></div>    
</body>
</html>