<html>
<head>
<title>Advanced SQL operations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">高级SQL操作</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/advanced-sql-operations-8856084a95a8?source=collection_archive---------13-----------------------#2021-06-26">https://towardsdatascience.com/advanced-sql-operations-8856084a95a8?source=collection_archive---------13-----------------------#2021-06-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6552" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">查看更高级的SQL操作，以从爱尔兰天气数据集中提取额外的数据洞察。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ba69163a2a457fcf46998d618338ac79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TkzbjuAJnA3WKZxL"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">施泰耶·希勒沃特在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="c16d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上一篇文章中，我们开始了解可以执行的基本SQL操作。这些操作帮助我们对数据集有了初步的了解。他们确保我们优化了解释器，以有效地分析数据。</p><div class="ls lt gp gr lu lv"><a href="https://medium.com/codex/weathering-the-sql-interpreter-13ebaa175955" rel="noopener follow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">经受SQL解释器的考验</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">理解解释器是如何构造SQL查询的，可以使数据专家的工作变得更加容易</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">medium.com</p></div></div><div class="me l"><div class="mf l mg mh mi me mj kp lv"/></div></div></a></div><p id="bcb5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文旨在更深入地研究和回顾更高级的SQL操作。</p><p id="f582" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">鲜明的</strong></p><p id="e7cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">distinct操作旨在显示列中包含的唯一值。查看数据集时，可能存在多个重复值。一些列可能包含一些离散值，这些值会产生一个简短的唯一值列表。而具有大范围值的列(如连续列)会有大量离散值。意识到这种差异有助于理解列的基数。对于连续变量，划分为单独范围值的方法可以提供更多信息。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">代码1.1概述了列中的不同值</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mm"><img src="../Images/c7a4db2741b5bf8a0b95d58f614f318b.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*1Z1f04hdoWich4tZcqEY2A.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">SQL输出1.1是对county列的不同查询的结果</p></figure><p id="2596" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从代码1.1和下面的输出中，我们可以看到county列有一个简短的唯一值列表。对continuous temperature列执行相同的操作会产生一个更大的列表。</p><p id="fbd8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">联合</strong></p><p id="7eb0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">UNION操作旨在将两个或多个查询的结果组合成一个结果输出。在大多数数据库中，有两种选择。首先，UNION语句组合了来自所提供查询的所有唯一值。这旨在将输出减少到最少数量的值。小心地按正确的顺序排列查询可以减少显示错误结果顺序的机会。第二个选项是UNION ALL语句，它旨在将所有值组合在一起，而不执行任何重复的检查。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">代码1.2通过联合合并两个查询结果</p></figure><p id="acd4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从代码1.2开始，我们创建了两个查询，这两个查询组合起来显示一个数据集中的汇总值。我们需要确保每个查询中显示的相同列的顺序相同。如果一个列只存在于一个查询中，那么相应的列应该在另一个查询中设置为缺失值。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mn"><img src="../Images/fef628c85e5e987b9daddaef52d31f0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JMuYYFFjaGVPFsFHgR-WKQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">SQL Output 1.2来自两个SQL查询结果的所有不同值的联合</p></figure><p id="7031" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的输出显示两个查询已经堆叠在一起，并且所有的唯一值都保留了下来。</p><p id="0435" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">排序依据</strong></p><p id="be02" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以正确的顺序输出有助于向最终用户显示附加信息。使用order by语句，我们能够以类似于group by语句的方式对结果进行排序。可以使用各种列，例如:现有列、列别名或聚合函数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">代码1.3查询同一订单的两个变体</p></figure><p id="6c92" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">代码1.3中显示的代码显示了同一查询的变体，在感兴趣的列后添加了关键字DESC。包含此关键字可确保结果以降序显示，因为默认操作是升序。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/abd3400fa2b5f1f8017a47880cdb79c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*8qorzvgx7qLGhsR10w-OYw.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">SQL输出1.3创建最高温度的降序</p></figure><p id="6db9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">SQL输出1.3突出显示了应用于最高温度的下降操作的结果。</p><p id="7631" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">极限和偏移</strong></p><p id="980b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当第一次与数据集交互时，我们有兴趣了解数据样本是什么样的。通过查看数据样本，我们可以获得关于列如何显示的有价值的见解。它允许开发人员快速产生数据分析想法。此外，当开始产生派生变量时，我们可以通过在较小的样本上执行它们来减少操作的开销。一旦我们对样本的操作感到满意，就可以将它们转移到整个群体。然而，我们必须始终意识到，小样本可能与总体差异很大，因此需要进行其他分析，以确保不会产生奇怪的结果。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">代码1.4极限方法的两种变化</p></figure><p id="f943" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从上面显示的代码中，我们可以看到每次都提取顶部的记录，并使用偏移量进行了轻微的修改。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/f6c86d518f40ef1664c2031ceaaff86f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*oRmYpUNUO7pjAd7IWmoDng.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">选择顶部记录的SQL输出1.4结果</p></figure><p id="4d63" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如SQL输出1.4所示，在应用了其他SQL操作之后，已经提取了顶部的记录。此示例从整个数据集中为筛选的数据挑选出最高温度。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/e919d2ddde19941edb769ae2aa0db4ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*f1dIxNfeWGlcVjtRztPa_g.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">偏移前两个结果行后，SQL输出上限值的1.5个结果</p></figure><p id="1bce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过引入偏移操作，我们能够排除前两个结果并显示下一个最佳输出。如果您意识到输出将包含一些可能影响列解释方式的异常值，这种分析可能会很有用。</p><p id="ff61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">窗口</strong></p><p id="3b18" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">旨在从结果集中创建一个包含一行或多行的窗口。有很多种方法可以应用于这种操作。我们展示了一些高级方法，可以帮助快速总结感兴趣窗口中的列。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">代码1.5使用窗口对结果进行分区</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/8baf2a7af06a73c1257b7138c975b6fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*fG3Yw5x7HVxDpRbKtYsYdQ.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">SQL输出1.6从窗口order by方法创建等级值</p></figure><p id="7b48" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">row_number突出显示了partition子句中的行数。而等级显示了与其他值相比的相对等级。在上面的输出中，我们看到窗口操作的相似值显示为相同的等级值。</p></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h2 id="f75c" class="mz na iq bd nb nc nd dn ne nf ng dp nh lf ni nj nk lj nl nm nn ln no np nq nr bi translated">结论</h2><p id="9e49" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">使用高级SQL技术确实有助于提高从数据集发现的数据洞察力。在本文中，我们看到了检查唯一值如何有助于开发聚合统计数据。然而，随着订单语句的添加，最高或最低值可以真正显示出来。union的使用有助于堆叠数据集分析，这对于时间序列输出非常有效。当我们窥视数据集内部时，引入限制可以帮助初始发现过程。最后，对窗口功能的简要介绍有助于在单独的窗口中查看数据。</p></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><p id="2852" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nx">感谢阅读</em></p></div></div>    
</body>
</html>