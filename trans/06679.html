<html>
<head>
<title>How to Create Time Features for Data Science Models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为数据科学模型创建时间要素</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-time-features-for-data-science-models-22b902df5115?source=collection_archive---------36-----------------------#2021-06-15">https://towardsdatascience.com/how-to-create-time-features-for-data-science-models-22b902df5115?source=collection_archive---------36-----------------------#2021-06-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5898" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为您的机器学习算法创建分类时间箱的独特方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/728b7411cfe0c6f22b3789d95b2989c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k3ucbwWRlCQzg4T6DkACZw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@goumbik?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">卢卡斯·布拉塞克</a>在<a class="ae ky" href="https://unsplash.com/s/photos/time?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片【1】。</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="59a4" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">目录</h1><ol class=""><li id="c0f8" class="ly lz it ma b mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">介绍</li><li id="ca50" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated">创建时间要素</li><li id="eee7" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated">摘要</li><li id="a949" class="ly lz it ma b mb mq md mr mf ms mh mt mj mu ml mm mn mo mp bi translated">参考</li></ol><h1 id="5050" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">介绍</h1><p id="40bd" class="pw-post-body-paragraph na nb it ma b mb mc ju nc md me jx nd mf ne nf ng mh nh ni nj mj nk nl nm ml im bi translated">数据科学建模最困难的部分之一是利用时间。时间可以有多种用途。有特定于时间序列的建模，但是您也可以用不同的方式来看待时间。我们将研究这种方法，即将时间转换成一个分类变量(<em class="nn"> s </em>)。虽然转换后顺序将被剥离，但时间的周期性仍将能够被您使用的机器学习算法识别。对于本例，我们将使用新兴算法CatBoost来正确使用这些时间特性。例如，正常情况下，订购的时间是一天中从0到24的小时数。但是，算法仍然足够智能，可以将要素视为bin或类别(也可以是对象或分类数据类型)，而不是数字数据类型。话虽如此，如果您想了解如何将时间戳转换为分类特征以用于数据科学建模的独特方法，请继续阅读下面的内容。</p><h1 id="dd66" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">创建时间要素</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/04ce0269b818ebbd32e2521bc0c57c16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ce9nHdPTKRvHtOtdjQkGqw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用的代码示例(相同时间特征值)。作者截图[2]。</p></figure><p id="4075" class="pw-post-body-paragraph na nb it ma b mb np ju nc md nq jx nd mf nr nf ng mh ns ni nj mj nt nl nm ml im bi translated">下面，我们将描述用例或一般问题，以便您可以看到创建时间功能有用的示例。我们将展示这段对话的Python代码。最后，我们将在一些简单的代码后看看我们的特性是什么样的。对于未来的工作，您还可以通过将时间要素用作分类/对象或数值数据类型来比较模型，比较它们在精度或误差方面的变化。</p><blockquote class="nu nv nw"><p id="c35e" class="na nb nn ma b mb np ju nc md nq jx nd nx nr nf ng ny ns ni nj nz nt nl nm ml im bi translated">用例</p></blockquote><p id="cabc" class="pw-post-body-paragraph na nb it ma b mb np ju nc md nq jx nd mf nr nf ng mh ns ni nj mj nt nl nm ml im bi translated">用例是预测进入餐馆的人数。尽管我们可以使用一天中的几个小时或一天中的半个小时作为数字特征，但就本文而言，我们可以使用这两个特征作为分类特征，最终将由CatBoost机器学习算法进行目标编码。</p><blockquote class="nu nv nw"><p id="7fa0" class="na nb nn ma b mb np ju nc md nq jx nd nx nr nf ng ny ns ni nj nz nt nl nm ml im bi translated">密码</p></blockquote><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="d38a" class="of lh it ob b gy og oh l oi oj">from datetime import datetime, timedelta<br/>import pandas as pd<br/>import numpy as np</span><span id="3017" class="of lh it ob b gy ok oh l oi oj">date_today = datetime.now()<br/>date_range = pd.date_range(date_today — timedelta(7), date_today, freq='D')</span><span id="ec0e" class="of lh it ob b gy ok oh l oi oj">df = pd.DataFrame({'date_time_stamp': date_range})<br/>df.head(5)</span></pre><p id="f099" class="pw-post-body-paragraph na nb it ma b mb np ju nc md nq jx nd mf nr nf ng mh ns ni nj mj nt nl nm ml im bi translated">在上面的代码片段中，我们首先导入必要的库。接下来，我们创建从现在的<em class="nn">到过去七天的随机时间戳数据。然后，我们可以查看带有<code class="fe ol om on ob b">df.head()</code>的时间戳，它们都是一个主数据帧的一部分。</em></p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="0e41" class="of lh it ob b gy og oh l oi oj">df['hour'] = ['{}:{:02d}'.format(r.hour, (r.minute // 60) * 60) for r in df['date_time_stamp']]<br/>df['30_min'] = ['{}:{:02d}'.format(r.hour, (r.minute // 30) * 30) for r in df['date_time_stamp']]</span><span id="2909" class="of lh it ob b gy ok oh l oi oj">df[['date_time_stamp', 'hour', '30_min']].head(5)</span></pre><p id="e187" class="pw-post-body-paragraph na nb it ma b mb np ju nc md nq jx nd mf nr nf ng mh ns ni nj mj nt nl nm ml im bi translated">在这个代码块中，我们看到我们正在创建两个时间特征。第一个是小时特性，它本质上是说— <em class="nn">这个非常具体的时间戳在哪个小时？</em>下一部分与此类似，但更细化，它说的是— <em class="nn">这一分钟的半小时是多少？</em></p><p id="0c1a" class="pw-post-body-paragraph na nb it ma b mb np ju nc md nq jx nd mf nr nf ng mh ns ni nj mj nt nl nm ml im bi translated">例如，如果时间戳的分钟是12:46 pm，那么<code class="fe ol om on ob b">30_min</code>将是12:30 ( <em class="nn">本质上是从12:30到1:00 pm </em>的一组值)</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="88a1" class="of lh it ob b gy og oh l oi oj">df.dtypes</span></pre><p id="5fbb" class="pw-post-body-paragraph na nb it ma b mb np ju nc md nq jx nd mf nr nf ng mh ns ni nj mj nt nl nm ml im bi translated">在最后这段代码中，我们看到可以查看列的数据类型。第一个将返回<code class="fe ol om on ob b">datetime64[ns]</code>，两个新计算的要素将在分类要素列表中使用，作为<code class="fe ol om on ob b">object</code>或<code class="fe ol om on ob b">categorical</code>数据类型。</p><blockquote class="nu nv nw"><p id="4edc" class="na nb nn ma b mb np ju nc md nq jx nd nx nr nf ng ny ns ni nj nz nt nl nm ml im bi translated">这些特性在算法中是如何工作的</p></blockquote><ul class=""><li id="a4d3" class="ly lz it ma b mb np md nq mf oo mh op mj oq ml or mn mo mp bi translated">这两个要素以及您可以进一步创建的其他要素可用于CatBoost模型的分类要素列表中，CatBoost模型的一部分将使用目标编码，简单来说，就是特定时间要素条柱的平均目标。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/3fda0caa0a68e9f0dbf773fd72362f3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ze6i21MIomGE9fXczXebyg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">半小时/ 30分钟示例(不同的时间特征值)。作者截图[3]。</p></figure><p id="328d" class="pw-post-body-paragraph na nb it ma b mb np ju nc md nq jx nd mf nr nf ng mh ns ni nj mj nt nl nm ml im bi translated">您可以在上面的第一个屏幕截图<strong class="ma iu">中看到，两个时间特性的输出具有相同的值，这是因为半小时周期仍在30的另一侧。如果您在30+的日期时间尝试这样做，您将看到该值发生变化。那就是<strong class="ma iu">第二张</strong>截图不一样的地方，紧接着上图。出于用例的考虑，您最有可能期望餐厅的人数在大约<code class="fe ol om on ob b">12:00</code>和<code class="fe ol om on ob b">12:30</code>以及<code class="fe ol om on ob b">6:00</code>和<code class="fe ol om on ob b">6:30</code>(分别为<em class="nn">午餐和晚餐时间</em>)时具有最高的平均目标值，而当餐厅关门前有一股人流时，可能会有一些新的发现，也许是<code class="fe ol om on ob b">9:30</code>。</strong></p><h1 id="1543" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">摘要</h1><p id="ab08" class="pw-post-body-paragraph na nb it ma b mb mc ju nc md me jx nd mf ne nf ng mh nh ni nj mj nk nl nm ml im bi translated">时间很重要，在开发数据科学模型时不应忽视。然而，它可能是棘手的，可以以多种方式消耗。我们创建时间特征的方式是独特的，因为我们将一个示例时间戳转换为两个分类特征。我们看到，当时间为13:14时，半小时功能或<code class="fe ol om on ob b">30_min</code>与小时功能相同，但当时间为13:32时，则不同。当然，在数据科学模型中，时间还有更多使用方式。</p><blockquote class="nu nv nw"><p id="8093" class="na nb nn ma b mb np ju nc md nq jx nd nx nr nf ng ny ns ni nj nz nt nl nm ml im bi translated">总而言之，我们执行了以下操作:</p></blockquote><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="59cb" class="of lh it ob b gy og oh l oi oj">* created a mock dataset</span><span id="f984" class="of lh it ob b gy ok oh l oi oj">* isolated a timestamp</span><span id="cf80" class="of lh it ob b gy ok oh l oi oj">* created two features from that one timestamp</span><span id="df79" class="of lh it ob b gy ok oh l oi oj">* realized those two features could be used as categorical features</span></pre><p id="4f9d" class="pw-post-body-paragraph na nb it ma b mb np ju nc md nq jx nd mf nr nf ng mh ns ni nj mj nt nl nm ml im bi translated">我希望你觉得我的文章既有趣又有用。如果您同意《时代》杂志的这一专题创作，请随时在下面发表评论——为什么或为什么不同意？在你的机器学习算法中，还有哪些利用时间的方式？你使用的主要技术和Python库是什么？</p><p id="6b3e" class="pw-post-body-paragraph na nb it ma b mb np ju nc md nq jx nd mf nr nf ng mh ns ni nj mj nt nl nm ml im bi translated"><em class="nn">请随时查看我的个人资料、</em> <a class="ot ou ep" href="https://medium.com/u/abe5272eafd9?source=post_page-----22b902df5115--------------------------------" rel="noopener" target="_blank"> <em class="nn">马特Przybyla </em> </a>、<em class="nn">等文章，也可以在LinkedIn上联系我。</em></p><h1 id="93d6" class="lg lh it bd li lj mv ll lm ln mw lp lq jz mx ka ls kc my kd lu kf mz kg lw lx bi translated">参考</h1><p id="c9f9" class="pw-post-body-paragraph na nb it ma b mb mc ju nc md me jx nd mf ne nf ng mh nh ni nj mj nk nl nm ml im bi translated">[1]照片由<a class="ae ky" href="https://unsplash.com/@goumbik?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">卢卡斯·布拉塞克</a>在<a class="ae ky" href="https://unsplash.com/s/photos/time?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a>(2017)上拍摄</p><p id="c743" class="pw-post-body-paragraph na nb it ma b mb np ju nc md nq jx nd mf nr nf ng mh ns ni nj mj nt nl nm ml im bi translated">[2] M.Przybyla，所用代码示例截图(<em class="nn">相同时间特征值</em>)，(2021)</p><p id="2d9c" class="pw-post-body-paragraph na nb it ma b mb np ju nc md nq jx nd mf nr nf ng mh ns ni nj mj nt nl nm ml im bi translated">[3] M.Przybyla，半小时/ 30分钟截图示例(<em class="nn">不同时间特征值</em>)，(2021)</p></div></div>    
</body>
</html>