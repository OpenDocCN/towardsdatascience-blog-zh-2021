<html>
<head>
<title>Building A Server Settings Configuration For My Notebook Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为我的笔记本电脑服务器构建服务器设置配置</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-server-settings-configuration-for-my-notebook-server-b0a7258e50f3?source=collection_archive---------36-----------------------#2021-12-13">https://towardsdatascience.com/building-a-server-settings-configuration-for-my-notebook-server-b0a7258e50f3?source=collection_archive---------36-----------------------#2021-12-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="5fd5" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">Jockey.jl</h2><div class=""/><div class=""><h2 id="92d1" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用Jockey.jl创建服务器配置</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/3bedbbca0cac7e691f2f5ffe75ed7fff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6obVrT8CdhETmOXRcrchsA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">(图片由<a class="ae lh" href="http://Unsplash.com" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae lh" href="https://pixabay.com/images/id-156765/" rel="noopener ugc nofollow" target="_blank">openclipbart</a></p></figure><h1 id="c7f2" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">介绍</h1><p id="ff61" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">最近，我开始为Julia开发一个新的Julia包，名为Jockey.jl. Jockey.jl将会有很多工作，它由一个通用的、基于Julia的虚拟会话服务器组成，该服务器将调用返回到JavaScript会话中。这种方法的酷之处在于，它允许我使用一些非常棒的Julian方法来处理数据，并使用JSON作为这两种方法和接口之间的中间媒介。考虑到这一点，Julia方面的东西仍然需要各种各样的补充，比如身份验证、基于会话的用户帐户、数据格式化(用于保存和加载文件)。)</p><p id="c710" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">为了方便创建这些东西，接下来可能需要创建的一个东西是服务器设置。我们不能忘记这些将在一揽子计划的其余部分发挥多大的作用。然而，在此之前，这个存储库中缺少一样东西，它阻止路由器服务于开发中的登录页面。</p><h1 id="d563" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">资产问题</h1><p id="fda2" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">在我们开始构建这个超级酷的配置文件之前，我需要给Jockey环境添加一个新的依赖项和一个图标。出于某种原因，精灵要求我们有一个窗口。ico文件，所以我将使用get a .ico文件并把它粘贴在那里。我认为这是我们需要承认的关于精灵的事情。像这样的事情破坏我们的应用程序是很奇怪的，但是不管有多奇怪——确实是这样。</p><p id="5a3b" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">还有一件事，如果你想在Github上查看，你可以在这里:</p><div class="nb nc gp gr nd ne"><a href="https://github.com/ChifiSource/Jockey.jl" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd jd gy z fp nj fr fs nk fu fw jc bi translated">GitHub-chifi source/Jockey . JL:Jockey IDE/笔记本服务器</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">骑师IDE/笔记本服务器。在GitHub上创建一个帐户，为ChifiSource/Jockey.jl的开发做出贡献。</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">github.com</p></div></div><div class="nn l"><div class="no l np nq nr nn ns lb ne"/></div></div></a></div></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><h1 id="ee37" class="li lj it bd lk ll oa ln lo lp ob lr ls ki oc kj lu kl od km lw ko oe kp ly lz bi translated">设置类型</h1><p id="a187" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">为了创建新的设置，我们要做的第一件事是在一个新的部分中创建新的设置类型。</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="39c4" class="ok lj it og b gy ol om l on oo">mutable struct JSettings<br/>  mode::Symbol<br/>  Host::Connection<br/>end<br/>mutable struct HostInfo<br/>  server_port::Int64<br/>  server_host::String<br/>  admin_name::String<br/>  admin_password::String<br/>end</span></pre><p id="54f2" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">这两种新的类型只是作为包的容器，最终用来操作一切。我将在这篇文章旁边适当地记录所有这些，以便重申这些都做了什么。HostInfo结构保存服务器的核心信息。请注意，所有这些都是在服务器启动时处理的，而且还保存在默认的配置文件中。</p><h1 id="89c5" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">会议</h1><p id="978a" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">现在，在一个新的会话文件中，我将创建另一个名为session的类型:</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="0bbe" class="ok lj it og b gy ol om l on oo">mutable struct JSession<br/>  ID::Int64<br/>  auth::Int64<br/>  KeyBindings::Dict<br/>  Enabled Extensions::Dict<br/>  username::String<br/>  settings::JSettings</span><span id="a569" class="ok lj it og b gy op om l on oo">end</span></pre><p id="66c7" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">现在，我们启动服务器的第一个目标是将所有的服务器参数(定义为关键字参数)组装成适当的类型。我将在主要骑师文件中为这两个人添加必要的内容，</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="9983" class="ok lj it og b gy ol om l on oo">include("ServerController/Session.jl")<br/>include("ServerController/Settings.jl")</span></pre><p id="4fb2" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">现在我们正在使用的下一个方法是runjy()。这是使用关键字参数来控制服务器核心启动的主函数。让我们看一下相应的doc-string，每当我们测试这段代码时，我们很快就会在终端中看到它:</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="5c8a" class="ok lj it og b gy ol om l on oo">"""<br/>Usage Functions<br/>### runjy()<br/>The runjy() server begins a Genie server hosting a new Jockey notebook server.<br/>Ultimately, this is the foundation where one will configure server settings and<br/>decide what sort of system they want to run jockey with. The core server settings<br/>are controllable through the key-word arguments to this function.<br/>##### Key-word arguments<br/>- host = 127.0.0.1<br/>IP address one wishes to host this connection on.<br/>- port = 8000<br/>Port which the server should run on.<br/>- mode = :user<br/>Available mode options are :user, :admin, :headless. Admin mode will grant access<br/> to a user account system, and Jockey authentication systems. Headless mode will<br/> begin a worker process, which can be further managed using the management<br/>   interface.<br/>- pwd = 123<br/>Password for use at administrator login screen. **You can ignore this if not in<br/>  admin mode!**<br/>"""</span></pre><p id="30b6" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">所有这些参数都已经在这个函数中提供了，我们只需要将它们放入相应的类型中，然后在环境中定义这些类型——为返回做好准备。这是我们当前的功能:</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="af78" class="ok lj it og b gy ol om l on oo">function runjy(;port = 8000, host = "127.0.0.1",<br/>  mode = :user,<br/>  pwd = 123,<br/>  admin = "admin")<br/>  JockeyPoll("New Jockey Server starting on port ", port)<br/>  run(`./bin/server`)<br/>end</span></pre><p id="dbdd" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">经过一点修改后，我修改了会话以包含一个完整的标识符类型。</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="0150" class="ok lj it og b gy ol om l on oo">mutable struct JSession<br/>  ID::Identifier<br/>  KeyBindings::Dict<br/>  Enabled Extensions::Dict<br/>  username::String<br/>end<br/>mutable struct Identifier<br/>  id::Int64<br/>  auth::Int64<br/>  username::Int64<br/>  status::Int64<br/>end</span></pre><p id="45ea" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">回到runjy()函数，我将添加一些新的调用来构造HostInfo和全局设置。</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="432e" class="ok lj it og b gy ol om l on oo">function runjy(;port = 8000, host = "127.0.0.1",<br/>  mode = :user,<br/>  pwd = 123,<br/>  admin = "admin")<br/>  HI = HostInfo(port, host, admin, pwd)<br/>  global jsettings = JSettings(mode, HI)</span></pre><p id="e4a0" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">最后，我们需要创建的最后一个组件是会话。</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="b3cd" class="ok lj it og b gy ol om l on oo">global jsession = JSession(Id, KB, ext, username)</span></pre><p id="006b" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">这些在这个环境中被全局定义是有原因的。</p><h1 id="ddc5" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">汤姆</h1><p id="59a7" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">现在我们已经有了引入新功能的基本方法，我们将使用TOML.jl包创建一些基本的TOML配置文件。让我们寻找我们的环境并添加这个包。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oq"><img src="../Images/d025b7385b19fce5b17aca46d15c9d17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4psmJ0-dmrq87sYH7CjLqQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">(图片由作者提供)</p></figure><p id="3c67" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">这当然就像用Pkg REPL激活骑师环境，然后添加TOML一样简单。我们将从这个库中使用的主要函数是parse。我们首先将数据放入字典，然后输出到一个新的TOML文件。这当然会回到runjy()函数中:</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="5303" class="ok lj it og b gy ol om l on oo">function runjy(;port = 8000, host = "127.0.0.1",<br/>  mode = :user,<br/>  pwd = "123",<br/>  admin = "admin")<br/>  HI = HostInfo(port, host, admin, pwd)<br/>  global settings = JSettings(mode, HI)<br/>  setting_dict = Dict("port" =&gt; string(port), "host" =&gt; host,<br/>  "admin" =&gt; admin, "mode" =&gt; string(mode))<br/>  open("config/env/settings.toml", "w") do io<br/>           TOML.print(io, setting_dict)<br/>         end</span><span id="cb66" class="ok lj it og b gy op om l on oo">JockeyPoll(string("New Jockey Server starting on port ", port))<br/>  run(`./bin/server`)<br/>end</span></pre><p id="93e7" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们的最后一步是编辑环境源文件，这将允许我们非常容易地从加载的配置中更改IP。</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="3835" class="ok lj it og b gy ol om l on oo">server_sett = TOML.parsefile("config/env/settings.toml")<br/>port = server_sett["port"]<br/>host = server_sett["host"]<br/>print(string("https://", host, ":", port))</span></pre><p id="f85f" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">然后我们只需在我们的设置常量中替换它:</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="e33d" class="ok lj it og b gy ol om l on oo">const config = Settings(<br/>  server_port                     = parse(Int64, port),<br/>  server_host                     = host,<br/>  log_level                       = Logging.Info,<br/>  log_to_file                     = false,<br/>  server_handle_static_files      = true,<br/>  path_build                      = "build",<br/>  format_julia_builds             = true,<br/>  format_html_output              = true<br/>)</span></pre><p id="3958" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">现在，经过一些小的调试和调整，我们有了基本的服务器设置加载器，有了一个可以修改的可保存文件。这些设置中有很多不是针对初始连接的，将会在管理面板中提供。</p><h1 id="6d50" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">结论</h1><p id="ab6f" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">好消息是设置加载部分现在有了一个基础版，让我们现在回到REPL来看看我们的工作。</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="e583" class="ok lj it og b gy ol om l on oo">(<a class="ae lh" href="http://twitter.com/v1" rel="noopener ugc nofollow" target="_blank">@v1</a>.6) pkg&gt; activate Jockey<br/>  Activating environment at `~/dev/Jockey/Project.toml`</span><span id="ee43" class="ok lj it og b gy op om l on oo">shell&gt; cd Jockey<br/>/home/emmac/dev/Jockey</span><span id="e8fe" class="ok lj it og b gy op om l on oo">include("src/Jockey.jl")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi or"><img src="../Images/06f9da83fce883873a60b640f52b429a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RQLY7LrJsRWGSuvLHyhchQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">(图片由作者提供)</p></figure><p id="2997" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">现在我们可以完全按照上面说的去做，我也要用</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="4b49" class="ok lj it og b gy ol om l on oo">using Jockey</span></pre><p id="2518" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">对于最终用户来说，他们不需要采购环境或进行这些种类的包含。他们只需要做</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="d82c" class="ok lj it og b gy ol om l on oo">using Jockey</span></pre><p id="623c" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">让我们使用runjy()启动一个服务器。或者，我们可以跑？(runjy)为了了解关于此功能的更多信息:</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="a31b" class="ok lj it og b gy ol om l on oo">julia&gt; runjy(port = 8054, admin = "Emmy")<br/>[Jockey]  New Jockey Server starting on port 8054</span></pre><p id="ceb1" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">精灵现在将启动，然后砰！我们有一台服务器在运行！</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi os"><img src="../Images/3aa594207c8f4b33c095eea47fe914b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4S20RGqqFQsphHdensD-nQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">(图片由作者提供)</p></figure><p id="9bcd" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">现在如果我们去</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="8776" class="ok lj it og b gy ol om l on oo"><a class="ae lh" href="http://127.0.0.1:8054/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8054/</a></span></pre><p id="7963" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们可以看到骑师登陆页面:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ot"><img src="../Images/3e7f8da41fa284d62f302ffc6a636bcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fM38NH8jLWErq70LPIOL4g.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">(图片由作者提供)</p></figure><p id="d042" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">有一个图像丢失，按钮图标不直，因为还有工作要做，但让我们看看设置文件:</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="0a38" class="ok lj it og b gy ol om l on oo">admin = "Emmy"<br/>host = "127.0.0.1"<br/>mode = "user"<br/>port = "8054"</span></pre><p id="8a23" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">现在我们有一个简单的方法来访问服务器配置和其他设置——比如扩展，我们可以将它们加载到一个子目录中。未来将包含会话的第一个实现，并为管理会话创建一个后端。另一个重要部分实际上是为会话创建前端部分。有一些很酷的功能，我肯定希望在这方面增加。</p><p id="da02" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">感谢您阅读我的文章，我希望这看我的骑师代码很酷！</p></div></div>    
</body>
</html>