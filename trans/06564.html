<html>
<head>
<title>2 Tricky SQL Questions You Might Be Asked at Data Scientist Interviews</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在数据科学家面试中，你可能会被问到的两个棘手的SQL问题</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/2-tricky-sql-questions-you-might-be-asked-at-data-scientist-interviews-168f5226c023?source=collection_archive---------6-----------------------#2021-06-13">https://towardsdatascience.com/2-tricky-sql-questions-you-might-be-asked-at-data-scientist-interviews-168f5226c023?source=collection_archive---------6-----------------------#2021-06-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6acb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">SQL是一个强大的数据分析和操作工具。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/81d684183aa2e2afca1fe4b11c84c524.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pXvBFVUl1Y-pxMZ5aAWolg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">戴安娜·波莱希娜在<a class="ae ky" href="https://unsplash.com/s/photos/two?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="9da9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL是数据科学家的必备技能，这是不争的事实。大多数公司使用关系数据库来存储他们的数据，而SQL是我们与他们交互所需要的。</p><p id="29da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL代表结构化查询语言，但是它能够执行的不仅仅是查询数据库。我们可以使用SQL来完成典型的探索性数据分析过程中的任务。在这个意义上，它类似于其他数据分析工具，如Python中的Pandas和r中的data table。</p><p id="f0cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将讨论在数据科学家面试中可能会被问到的两个棘手的SQL问题。我知道第一个问题实际上是在面试时被问到的。我认为另外两个也很有可能被问到。如果没有，它遵循的程序肯定会有帮助。</p><p id="1c9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我假设您对编写SQL查询有基本的了解。如果没有，你仍然可以继续，因为我会试着解释每一步的作用。</p><p id="2195" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注</strong>:关系数据库管理系统有MySQL、SQL Server、PostgreSQL等几种。尽管它们大多采用相同的SQL语法，但可能会有一些细微的差别。在本文中，我们将使用PostgreSQL。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="c13f" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">问题1</h2><p id="55b5" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">假设您有一个包含不同城市每日气温值的天气表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/b7a8de447df8ee0a543b696fbc504028.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dyM_uEnj66LztiHFm2PLsA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">天气表(图片由作者提供)</p></figure><p id="6785" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如何创建一个包含当天和第二天温差的表？对于第一行，差异列应包含值1.2。</p><p id="f919" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以分两步完成这项任务:</p><ol class=""><li id="7ba7" class="nb nc it lb b lc ld lf lg li nd lm ne lq nf lu ng nh ni nj bi translated">创建一个公共表表达式(cte ),将第二天的温度作为新列</li><li id="061c" class="nb nc it lb b lc nk lf nl li nm lm nn lq no lu ng nh ni nj bi translated">使用步骤1中创建的公共表表达式，计算温差</li></ol><p id="85c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一步中定义的表可以通过将temperature列移动一行，然后将其连接到原始表来创建。我们还需要考虑城市名称。我们不能使用城市B的温度作为城市a的第二天温度。</p><p id="abab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">移位可以通过滞后或超前功能来完成。由于我们对第二天感兴趣，所以我们将使用lead函数。我们还需要按城市进行分区，并按日期对行进行排序。因此，我们确保为每一行输入适当的第二天温度。</p><p id="a661" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第二步中，我们将从第一步中创建的表中选择所有列，并计算温度和第二天温度列之间的差异。</p><p id="5d3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是执行此操作的SQL查询:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="c187" class="mc md it nq b gy nu nv l nw nx">WITH cte AS(<br/>   SELECT<br/>      W1.*, <br/>      LEAD(W2.temperature, 1) OVER(PARTITION BY W2.city ORDER BY <br/>      W2.date) AS temp_next                                                   <br/>   FROM weather W1                                                                                                                                                   <br/>   LEFT JOIN weather W2                                                                                                                                              <br/>   ON W1.date = W2.date and W1.city = W2.city<br/>)                                                                                                                       SELECT <br/>   *, <br/>   COALESCE((temp_next - temperature), 0) AS temp_diff <br/>FROM cte;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/086dd0c00887736ab0ebf3425685b035.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xXpGEvJIlB70e-dw6yZVwQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="70fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">coalesce函数可用于替换因连接而导致的缺失值。由于最后几天没有第二天的值，我们可以将差值设为0。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="7d2f" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">问题2</h2><p id="41b9" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">假设我们有下表，其中包含了墨尔本房屋的一些特征及其价格。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/75627037003dab6da7fe9a01b98ea2f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KGIs2GYEDGWpss4T-vwLdw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">melb表格的前5行(图片由作者提供)</p></figure><p id="aa45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据集包含一个日期列，我认为它代表了房子被张贴出售的日期。我们想看看一周中的某一天是否会对房价产生影响。例如，周末发布的房屋价格可能比一周发布的价格高。</p><p id="3d2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此任务涉及基于派生列的分组操作。我们将创建一个分类变量，包含从日期列中提取的星期几信息。</p><p id="0495" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，该列将用于对观察值(即行)进行分组。</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="d20f" class="mc md it nq b gy nu nv l nw nx">SELECT <br/>   EXTRACT(dow from date) AS day_of_week,   <br/>   ROUND(CAST(AVG(price/1000000) AS numeric),3) AS avg_price_mio FROM melb <br/>GROUP BY day_of_week <br/>ORDER BY avg_price_mio DESC;</span><span id="dcd2" class="mc md it nq b gy oa nv l nw nx">day_of_week | avg_price_mio<br/>------------+---------------<br/>          5 |         1.123<br/>          0 |         1.120<br/>          4 |         1.093<br/>          6 |         1.077<br/>          3 |         1.073<br/>          2 |         1.048<br/>          1 |         1.023</span></pre><p id="d526" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">聚合将应用于price列。我想用两个小数点显示平均值，所以我也使用了cast和round方法。</p><p id="0bd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，结果按平均价格降序排列。</p><p id="f295" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">顺便说一下，本例中使用的<a class="ae ky" href="https://www.kaggle.com/dansbecker/melbourne-housing-snapshot" rel="noopener ugc nofollow" target="_blank">数据集</a>可以从Kaggle下载。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="5211" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">结论</h2><p id="86e7" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们已经做了两个例子来演示一些复杂的SQL查询。这种操作证明SQL能够执行数据分析和操作，就像Pandas对于Python和data table对于r一样。</p><p id="30d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL是数据科学生态系统中的一个重要工具。事实上，使用SQL执行数据分析和操作任务比使用外部工具从数据库中检索所有数据更可取。</p><p id="c40d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>