<html>
<head>
<title>Acquire and Analyze Weather and Climate Data with Python and Tableau</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python和Tableau获取和分析天气和气候数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/acquire-and-analyze-weather-and-climate-data-with-python-and-tableau-4878e8759152?source=collection_archive---------1-----------------------#2021-04-15">https://towardsdatascience.com/acquire-and-analyze-weather-and-climate-data-with-python-and-tableau-4878e8759152?source=collection_archive---------1-----------------------#2021-04-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4be9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">美国国家海洋和大气管理局(NOAA)存储了大量的天气和气候数据。了解如何编写Python程序来调用API来检索数据，并使用Tableau Public或其他可视化工具对其进行分析。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b89c70fb9ca70a76012e6d359ecda68c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0nmcWWUqjTIqS6F4GWuTvQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">戏剧性的云。照片由<a class="ae ky" href="https://unsplash.com/s/photos/weather?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@noaa?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> NOAA </a>提供。</p></figure><p id="8f6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">天气和气候数据是宝贵的资源，不仅可以预测天气，还可以用于行业、政府和个人生活中的许多目的。将数据分析和数据科学技术应用于这些数据以通知和支持决策的机会几乎是无穷无尽的。</p><p id="2f79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">NOAA的<a class="ae ky" href="https://www.ncdc.noaa.gov/" rel="noopener ugc nofollow" target="_blank">国家环境信息中心</a> (NCEI)是世界上最广泛的天气和气候数据收集中心。它的数据库包含超过37pb的大气、海岸、海洋和地球物理数据。本文描述了数据、如何下载其数据文件，以及使用调用其数据服务API的Python程序获取数据的说明。它还演示了一个Tableau公共仪表板，以可视化使用API检索的一组示例风数据。</p><h1 id="f36c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">天气和气候数据的使用</h1><p id="5c8e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">天气和气候数据服务于社会的多种需求。以下是一些例子:</p><ul class=""><li id="94b9" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated"><strong class="lb iu">农业</strong> —农民可以利用天气数据来决定何时种植和收获作物，施用化肥和除草剂，等等。</li><li id="dd3a" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">过敏</strong> —天气在过敏季节起着重要作用，尤其是对那些与花粉和其他植物材料有关的过敏。</li><li id="ff7e" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">建筑和道路施工</strong> —天气可能影响室外施工作业。</li><li id="0e69" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">土木工程</strong> —设计桥梁、道路和隧道等结构的工程师必须意识到天气对这些结构及其材料的短期和长期影响。</li><li id="4a89" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">气候学</strong> —气候科学家使用天气和气候数据来了解过去、现在和潜在的未来气候。</li><li id="06da" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">服装和时尚</strong>——我们穿的服装种类随着季节和天气条件的变化而变化。有些人根据季节选择他们的风格和颜色。</li><li id="cfec" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">应急管理</strong> —应急管理人员使用天气和气候数据来确定灾难性事件的潜在风险，如野火、龙卷风、飓风和洪水。</li><li id="a31c" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">法医气象学</strong> —法医气象学家分析天气数据，拼凑过去的天气事件。</li><li id="4771" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">林业和土地管理</strong> —林业工作者使用天气和气候数据来管理森林，了解干旱的影响，降低火灾风险，等等。例如，<a class="ae ky" href="https://www.fs.fed.us/naturalresources/weather/index.shtml" rel="noopener ugc nofollow" target="_blank">美国林务局</a>运营着一个广泛的自动气象站网络。</li><li id="2a68" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">人口迁移</strong> —天气和气候是人们用来帮助他们决定居住地的因素。</li><li id="4cd5" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">户外娱乐</strong>——户外活动，如徒步旅行、航海、滑雪、露营、钓鱼和打猎，因季节和天气而异。人们评估历史气候和天气数据以及当前条件和预测，以选择户外活动的最佳时间。</li><li id="3992" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">产品销售和营销</strong> —例如，零售商使用天气数据来确定何时在商店中储备某些类型的商品，如泳衣或滑雪板。</li><li id="f0e2" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">运输</strong> —运输可能会受到天气的影响。例如，在冬天可能结冰的内陆水道上用驳船装运谷物和其他散装货物会受到天气的影响。</li><li id="d47d" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">旅游和旅行</strong> —人们依靠天气和气候数据来计划去他们选择的目的地的短期和长期旅行。</li><li id="0d10" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">波浪活动和水动力影响</strong> —来自安装在浮标上的气象仪器的数据可以帮助预测波浪和天气对海岸线和海滩的影响。</li><li id="8dbd" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">天气预报</strong> —气象学家使用气候和天气数据来帮助他们预测未来的天气。</li></ul><h1 id="a63c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">数据概述</h1><p id="6e5e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">NCEI是美国环境数据的主要权威。它管理着大量的大气、海岸、地球物理和海洋研究数据的档案。</p><p id="c0ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">NCEI管理着各种各样的数据<a class="ae ky" href="https://www.ncei.noaa.gov/products" rel="noopener ugc nofollow" target="_blank">产品</a>，其中很多都是向公众开放的。不胜枚举，超出了本文的范围，下面是其数据产品类别的一些示例:</p><ul class=""><li id="c19e" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">气温和大气特性</li><li id="50fb" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">北极和海冰</li><li id="f52c" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">生态系统和自然资源</li><li id="f41a" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">地磁学</li><li id="a8b4" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">自然灾害、灾难和恶劣天气</li><li id="e992" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">海洋气候</li><li id="ee6c" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">沉淀</li><li id="0b33" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">太空天气</li><li id="c924" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">美国和地区气候</li></ul><h1 id="ea37" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">下载天气和气候数据</h1><p id="6b45" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">除了应用程序编程接口(API)，NCEI还提供了查找、请求和下载天气和气候数据的工具。</p><h1 id="5ae6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">找到一个电台，订购并下载其数据</h1><p id="238e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">位于美国和世界各地的气象观测站收集了由NCEI管理的大部分气象数据。导航至<a class="ae ky" href="https://www.ncdc.noaa.gov/cdo-web/datatools/findstation" rel="noopener ugc nofollow" target="_blank"> <em class="ng">数据工具:查找电台</em> </a>页面，按城市、县、州、邮政编码或国家搜索电台。</p><p id="2edd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的例子中，我使用<em class="ng"> Find a Statio </em> n工具来搜索加利福尼亚州圣何塞的一个位置、每日摘要类别、日期范围2000-01-01到2020-12-31以及风数据类别。请注意地图上加利福尼亚州弗里蒙特和圣何塞的观测站符号。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/142c0fe503014f6613f4004ef623ce13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*krEY_JwVPzfZUqE2"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据工具:找一个站。作者捕获的图像。</p></figure><p id="9cb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我点击圣何塞的车站标志时，弹出一个<em class="ng">车站详情</em>窗口，如下图所示。请注意“GHCND:.”右侧的ID值的组成部分该值“USW00023293”是圣何塞国际机场观测站的唯一标识符。稍后将在调用NCEI数据服务API时使用该ID，以通过编程方式检索该气象站捕获的气象数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/c3447e78538e757b75e4bc503b88c3a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/0*gtrHhheNHMDLj4AI"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">气象观测站详情。作者捕获的图像。</p></figure><p id="1783" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要开始检索此数据，请单击[添加到购物车]按钮。然后，单击屏幕右上角的[购物车(免费数据)…]按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/a136a5a429b6ebf8988630a5a9238c66.png" data-original-src="https://miro.medium.com/v2/resize:fit:596/0*vIQD80c3kqD0tBdA"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据购物车按钮。作者捕获的图像。</p></figure><p id="350b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<em class="ng">购物车:每日摘要</em>页面上，选择“自定义GHCN-每日CSV”格式。此选项将导致下载逗号分隔值(CSV)文件中的风数据。文件格式类似于Python程序在调用数据服务API后保存的CSV文件。</p><p id="5909" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看搜索值，包括“日期范围”准备就绪后，单击[继续]按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/2778554f82ab21f8a099b1b4f3060098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4HxkuaOJO_bZnNZO"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">购物车:每日汇总页。作者捕获的图像。</p></figure><p id="f5dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<em class="ng">自定义选项:每日摘要</em>页面上，进行如下图所示的选择。注意“标准”的<em class="ng">单位</em>值将以英里每小时(MPH)为单位返回风速值。选择“公制”将返回以米每秒为单位的风速值。</p><p id="4f10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文后面还将使用“平均风速(AWND)”数据类型来演示Tableau Public中数据的可视化。“最快2分钟风速(WSF2)”和“最快5分钟风速(WSF5)”数据类型仅用于演示。</p><p id="1063" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“AWND”、“WSF2”和“WSF5”数据类型值将在稍后调用数据服务API时使用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/5b6d86e7bebbf773329cf16c098718c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UdCRPry4Xa8nlwSP"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">自定义选项:每日摘要页面。作者捕获的图像。</p></figure><p id="9f32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出现<em class="ng">查看订单</em>页面时，查看您的选择并输入两次您的电子邮件地址。准备好后，点击[提交订单]按钮。在几秒钟或几分钟内，NCEI将向您发送第一封确认订单提交的电子邮件和第二封确认订单完成的电子邮件。完成电子邮件包含下载符合您选择标准的数据文件的链接。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/4b9b284901421121462a55d9b8cb86f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_9wJ2Q4-k0NrGF_Z"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">气候数据在线请求电子邮件主题行。作者捕获的图像。</p></figure><p id="1711" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开第二封“订单完成…”电子邮件。单击[下载]链接下载数据文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/a29a3fa1d8b650802a13d9a3168f40c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4DLpTIIBubH4YzQI"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">部分气候数据在线请求完成电子邮件。点击[下载]按钮下载数据文件。作者捕获的图像。</p></figure><p id="1c89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在文本编辑器中打开下载的CSV文件。它应该类似于下面显示的文件。注意，第一行中的列名(NCEI称之为“数据类型”)对应于后续行中逗号分隔的数据值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/a351eca38e260c3772555648745276f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QLt5Ug5JrLxQ3ox_"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">下载的每日风力数据CSV文件示例。作者捕获的图像。</p></figure><h1 id="2214" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">其他数据搜索工具集</h1><p id="7f06" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">搜索观测站并选择和下载其数据是从NCEI数据集中检索数据的多种方法之一。使用<a class="ae ky" href="https://www.ncdc.noaa.gov/cdo-web/" rel="noopener ugc nofollow" target="_blank"> <em class="ng">气候数据在线</em> </a>页面上的链接探索其他方法。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/4f614c529ae9b877b1771ab2440ab1a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*g6B6y_gMs9D027qD"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">气候数据在线页面。图片由作者提供。</p></figure><p id="4019" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">NOAA还提供了一站式数据搜索平台，可以交互式地查找和查看各种数据。一些数据可供下载。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/a3a13b8d378c747556fdc32b5c32389b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*N0z45MGzRYj0PkhI"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">NOAA一站式数据搜索平台主页。作者捕获的图像。</p></figure><h1 id="09a1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">用Python调用Access数据服务API</h1><p id="fdb7" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">NCEI提供了四个RESTful APIs来获取天气和气候数据。本文描述了如何使用数据服务API来获取几个气象站的每日汇总数据。</p><p id="7415" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据服务API根据发送到web服务器的参数和预定义的URL检索数据。请参见简短的<a class="ae ky" href="https://www.ncei.noaa.gov/support/access-data-service-api-user-documentation" rel="noopener ugc nofollow" target="_blank">数据服务API文档</a>了解其工作原理。</p><h1 id="a123" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">URL和参数</h1><p id="2cb6" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">要使用数据服务API，请将参数追加到此预定义的URL:</p><p id="03f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://www.ncei.noaa.gov/access/services/data/v1" rel="noopener ugc nofollow" target="_blank"><em class="ng">https://www.ncei.noaa.gov/access/services/data/v1</em></a></p><p id="f2d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一节中描述的示例代码将查询daily-summaries数据集，以检索2000年1月1日至2020年12月31日期间美国几个地点每天的日平均风速值。API返回AWND和其他风速值，单位为英里/小时(MPH)。要检索所需的数据，请将这些参数附加到上面显示的URL中:</p><ul class=""><li id="833f" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated"><strong class="lb iu">数据集</strong> —“每日汇总”数据集提供汇总的每日天气数据，包括风数据。</li><li id="72fb" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">数据类型</strong> —我们对本例中的日平均风速(‘AWND’)感兴趣。但是为了将来可能的使用，该参数值被设置为获得最快的2分钟风速(“WSF2”)和最快的5秒风速(“WSF5”)。要获得这三种类型，请将dataTypes参数值设置为“AWND，WSF2，WSF5”</li><li id="aa39" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">站</strong> —在本例中，我们感兴趣的是这些站的日平均风速:芝加哥奥黑尔国际机场、罗彻斯特国际机场(明尼苏达州)和圣何塞国际机场。在逗号分隔的列表中向API提供这些工作站的标识符:“USW00094846、USW00014925、USW00023293”。在<a class="ae ky" href="https://www.ncdc.noaa.gov/cdo-web/datatools/findstation" rel="noopener ugc nofollow" target="_blank"> <em class="ng">数据工具中搜索电台id:如本文前一节所述，查找电台</em> </a>页面。</li><li id="59db" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">开始日期</strong> —将检索从2000年1月1日到2020年12月31日的记录。因此，在本例中，将设置值“2000–01–01”。</li><li id="8346" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">结束日期</strong> —因为我们对2020年的数据感兴趣，所以将该值设置为“2020–12–31”。</li><li id="ec87" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">边界框</strong> —设置边界框值，从坐标内包含的地理位置选择数据。它包括四个逗号分隔的数字。南北从-90度到90度，东西从-180度到180度。对于此示例，将boundingBox设置为' 90，-180，-90，180 '。</li><li id="9087" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">单位</strong> —数值为“公制”或“标准”对于平均风速数据类型，“标准”值将以英里/小时为单位返回风速。</li></ul><p id="392c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是将参数附加到基本URL后得到的完整URL:</p><p id="9931" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://www.ncei.noaa.gov/access/services/data/v1/?dataset=daily-summaries&amp;dataTypes=AWND,WSF2,WSF5&amp;stations=USW00094846,USW00014925,USW00023293&amp;startDate=2000-01-01&amp;endDate=2020-12-31&amp;boundingBox=90,-180,-90,180&amp;units=standard" rel="noopener ugc nofollow" target="_blank">https://www.ncei.noaa.gov/access/services/data/v1/?dataset = daily-summaries&amp;data types = AWND，WSF2，WSF5 &amp; stations=USW00094846，USW00014925，usw 00023293&amp;start date = 2000-01-01&amp;end date = 2020-12-31&amp;bounding box = 90，-180，-90，180 &amp; units=standard </a></p><h1 id="e08e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">Python代码</h1><h2 id="1bf0" class="nr lw it bd lx ns nt dn mb nu nv dp mf li nw nx mh lm ny nz mj lq oa ob ml oc bi translated">类c_ncei_data_service_api</h2><p id="5a40" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">文件c_ncei_data_service_api.py定义了c_ncei_data_service_api类。以下部分描述了它的功能。</p><p id="3dd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> __init__()构造函数</strong></p><p id="48e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当程序创建c_ncei_data_service_api类的实例时，会调用__init__()构造函数。它接受这些输入参数:</p><ul class=""><li id="026e" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated"><strong class="lb iu">数据集</strong> —包含所需数据的NCEI数据集的名称。</li><li id="5019" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu"> data_types </strong> —从数据集中返回的字段。它由逗号分隔的字段名称列表组成。</li><li id="b30e" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">站</strong> —这些是感兴趣的观测站的唯一标识符。该参数由逗号分隔的工作站id列表组成。</li><li id="031e" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">开始日期时间</strong> —要检索的数据的第一个日期。</li><li id="f7d5" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">结束日期时间</strong> —检索数据的最后日期。</li><li id="002b" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu"> bounding_box </strong> —参见上一节对boundingBox的描述。</li></ul><p id="864d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该函数执行以下步骤:</p><ol class=""><li id="05e9" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu od my mz na bi translated">设置变量self。_base_api_url设置为NCEI服务数据api的基本url的值。</li><li id="931d" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu od my mz na bi translated">使用输入参数调用self.call_api()来检索请求的数据。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">c_ncei_data_service_api类模块顶部__init__()函数的定义。注意“import requests”指令，这是使用requests.get()向NCEI数据服务API提交请求所必需的。</p></figure><p id="faad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:默认情况下，对URL的调用将返回CSV格式的数据。请参阅文档，了解为检索JSON和其他类型的数据而设置的参数。</p><p id="0661" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> call_api()函数</strong></p><p id="873e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">call_api()函数从指定的NCEI数据集中检索数据。它执行以下步骤:</p><ol class=""><li id="850a" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu od my mz na bi translated">向基本URL追加参数以创建full_url变量。请注意，除了函数的输入参数之外，它还设置了API的“单位”参数。</li><li id="9074" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu od my mz na bi translated">用requests.get()函数提交URL。产生的数据集(如果有)将被返回到“响应”变量中。</li><li id="5e83" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu od my mz na bi translated">将“response.text”变量返回到构造函数。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">c_ncei_data_service_api类模块中的call_api()函数。该函数使用requests.data()提交NCEI数据服务API请求的完整URL。</p></figure><p id="7c04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> get_data()函数</strong></p><p id="0a00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">get_data()函数将数据集数据返回给它的调用者。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">c_ncei_data_service_api类模块中的get_data()函数。</p></figure><p id="fc99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> write_data_file()函数</strong></p><p id="125a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">函数的作用是:写URL调用返回的数据，并保存在self中。_dataset变量转换为文本文件。它执行以下步骤:</p><ol class=""><li id="bdb5" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu od my mz na bi translated">以写入模式打开参数中指定的文件。</li><li id="e0dd" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu od my mz na bi translated">把价值写在自我里。_dataset变量添加到文件中。</li><li id="86c9" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu od my mz na bi translated">关闭文件。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">c_nei_data_service_api类模块内的write_data_file()函数。</p></figure><h2 id="8f93" class="nr lw it bd lx ns nt dn mb nu nv dp mf li nw nx mh lm ny nz mj lq oa ob ml oc bi translated">控制器模块</h2><p id="c5b0" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">控制器模块导入c_ncei_data_service_api模块，并执行以下步骤:</p><ol class=""><li id="e102" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu od my mz na bi translated">使用__init__()构造函数描述中描述的参数创建c_ncei_data_service_api类的实例。此步骤将从NCEI数据集中检索数据。</li><li id="6794" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu od my mz na bi translated">将检索到的数据打印到显示器上。</li><li id="dd0b" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu od my mz na bi translated">将检索到的数据写入指定的文件。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">控制器模块创建并调用c_ncei_data_service_api类的一个实例。然后，它将从API返回的数据打印到屏幕上，并将其写入文件。</p></figure><h1 id="2c89" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">可能的类和程序改进</h1><p id="5266" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我开发c_ncei_data_service_api类和控制器模块是为了演示和学习的目的。以下是一些添加功能并使模块更加健壮和适合生产的想法:</p><ul class=""><li id="94f8" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">添加<strong class="lb iu">错误处理</strong>以从错误中正常恢复，并在需要时重试部分代码。</li><li id="84e8" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">将有关程序操作的信息，如开始和结束的日期和时间、错误信息、输入参数以及检索到的记录数量写入一个<strong class="lb iu">日志文件</strong>。</li><li id="ca2f" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">修改<strong class="lb iu"> call_api()函数</strong>来处理更多的输入参数，比如想要的输出数据格式(CSV、JSON、PDF等)。</li></ul><h2 id="0eb5" class="nr lw it bd lx ns nt dn mb nu nv dp mf li nw nx mh lm ny nz mj lq oa ob ml oc bi translated">运行程序</h2><p id="5bfb" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">运行控制器模块以创建c_ncei_data_service_api的实例，从ncei数据服务api检索所需的数据，显示数据，并将其写入文件。输出文件应该类似于下面显示的输出<em class="ng"> weather_data.csv </em>文件中的示例。第一行包含列标题，而后面的行包含数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/5712e79e0de2150fd6bb50c6ab1a150f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*59-lXGxP9mHSsMdwtIGMFA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">通过调用NCEI数据服务API检索CSV文件。作者捕获的图像。</p></figure><h1 id="d9a6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">其他NCEI原料药</h1><p id="3142" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">虽然本文探索了数据服务API的使用，但NCEI也提供了这些API:</p><ul class=""><li id="0c69" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated"><a class="ae ky" href="https://www.ncei.noaa.gov/support/access-search-service-api-user-documentation" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">搜索服务API </strong> </a> —基于一组参数发现数据集和数据。</li><li id="41f4" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><a class="ae ky" href="https://www.ncei.noaa.gov/support/access-support-service" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">访问支持服务API </strong> </a> —基于一组参数发现关于数据集的元数据和属性。</li><li id="6e4c" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><a class="ae ky" href="https://www.ncei.noaa.gov/support/access-order-service" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">访问订单服务API </strong> </a> —根据一组参数检索以前订单的信息。</li></ul><p id="53b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<a class="ae ky" href="https://www.ncei.noaa.gov/access" rel="noopener ugc nofollow" target="_blank">访问页面</a>了解更多关于NCEI数据集的信息。它提供了数据发现工具、数据访问信息和开发人员工具的链接，包括API、地图服务目录、气候数据web服务和官方NOAA GitHub知识库。</p><h1 id="e7a6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">分析Tableau Public中的数据</h1><p id="5cad" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">伊利诺伊州的芝加哥被称为“风城”我住在明尼苏达州东南部，那也是一个多风的地方。为了直观地比较芝加哥地区和明尼苏达州东南部最大的城市罗切斯特的日平均风速，我在Tableau Public中加载了用数据服务API检索的数据。在那里，我创建了一个<a class="ae ky" href="https://public.tableau.com/profile/randall.runtsch#!/vizhome/DailyAverageWindspeedforSelectU_S_Locations/WindbyLocation" rel="noopener ugc nofollow" target="_blank"><em class="ng"/></a>日平均风速的仪表盘。我儿子住在加州圣何塞附近，所以圣何塞国际机场的风速也会显示出来。</p><p id="46d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果令我吃惊。罗切斯特国际机场(明尼苏达州)的风速一直高于芝加哥奥黑尔国际机场。这两个机场的风力都比圣何塞国际机场大得多。</p><p id="90a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从2000年到2020年，这些位置的日平均风速为英里每小时:</p><ul class=""><li id="2921" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">罗切斯特国际机场(明尼苏达州)——11.31英里/小时</li><li id="b352" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">芝加哥奥黑尔国际机场——9.52英里/小时</li><li id="9dda" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">圣何塞国际机场——6.44英里/小时</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/8e1eabb4367b620b9ebbb8e08444825c.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/0*UmQiQVxt3sTn-N5o"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">2000年至2020年三个地点的日平均风速。作者捕获的图像。</p></figure><p id="0718" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仪表板还显示了年、月、年和季节的日平均风速。北半球的气象季节定义如下。</p><ul class=""><li id="b4e2" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">春天——三月、四月和五月。</li><li id="99b8" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">夏季——六月、七月和八月。</li><li id="7119" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">秋季——九月、十月和十一月。</li><li id="d9b3" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">冬季——十二月、一月和二月。</li></ul><p id="70c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">资料显示，春天和冬天是罗切斯特和芝加哥风最大的季节，夏天最平静。圣何塞全年风力相对较小。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/5797fa6abeb4f0983a9ba5ca2b3df6aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7d7w9gWBSB-Mvonx"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">2000年至2020年三个地点按季节的日平均风速。作者捕获的图像。</p></figure><p id="8b65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为本文准备的仪表板图代表了Tableau Public、Tableau和Microsoft Power BI等工具中数据可视化的一小部分可能性。</p><h1 id="7027" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">摘要</h1><p id="1751" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">天气和气候数据是宝贵的资产，数据分析师和数据科学家可以利用这些资产为个人和组织提供信息，并支持各方面的决策。美国国家海洋和大气管理局的NCEI服务拥有超过37pb的数据，管理着巨大的资产。它还提供了各种用户友好的搜索和下载工具，以及一组API，使数据对任何人都可用。</p><p id="57c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以随意使用和修改c_ncei_data_service_api Python类和控制器模块来查询各种天气数据集，以满足您的需求。通过API和程序访问数据提供了一种将天气和气候数据集成到数据分析或数据科学解决方案、网站或软件应用程序中的方法。</p></div><div class="ab cl oj ok hx ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="im in io ip iq"><p id="1769" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Randy Runtsch是一名作家、数据工程师、数据分析师、程序员、摄影师和自行车手。他和妻子住在美国明尼苏达州东南部。</p><p id="d01f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Randy撰写了大量关于利用公共数据集中的数据的文章。参见最近的文章，<a class="ae ky" rel="noopener" target="_blank" href="/use-public-datasets-cataloged-on-data-gov-to-power-data-science-projects-1a7d84e9212b"> <em class="ng">使用Data.gov上编目的公共数据集来推动数据科学项目</em> </a>，以了解在<a class="ae ky" href="https://www.data.gov/" rel="noopener ugc nofollow" target="_blank">data.gov</a>上编目的280，000+政府数据集的收集情况。</p></div></div>    
</body>
</html>