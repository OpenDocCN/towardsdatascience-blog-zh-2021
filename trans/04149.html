<html>
<head>
<title>Setting Up a New M1 MacBook for Data Science</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为数据科学设置新的M1 MacBook</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/new-m1-who-dis-677e085baffd?source=collection_archive---------1-----------------------#2021-04-08">https://towardsdatascience.com/new-m1-who-dis-677e085baffd?source=collection_archive---------1-----------------------#2021-04-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1d9e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个Python/熊猫的家伙在苹果芯片上开店</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c286cbafa523d76015e1cdc6312fa673.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FpGVOavTIIyY4_WrqgfBsw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">形象唤起工艺！</p></figure><p id="1e6e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2021年4月，我有幸打开了一台全新的2020 M1苹果MacBook Air。</p><h1 id="d99d" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">TL；博士；医生</h1><p id="2561" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">如果你希望在你的新M1 MacBook上原生运行Python库(即没有Rosetta 2翻译),省下很多麻烦:<a class="ae mr" href="https://github.com/conda-forge/miniforge/" rel="noopener ugc nofollow" target="_blank">使用miniforge </a>。它就像miniconda，但默认支持苹果M1。</p><h1 id="5503" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">为什么是麦克？</h1><p id="2b20" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我会考虑安装Ubuntu，但我对一些商业化的mac/win专用应用程序如Adobe Lightroom情有独钟。我考虑过切换到Windows(并使用WSL2):这样，我仍然可以拥有我愚蠢的GUI应用程序和Linuxy开发环境，然后在硬件上挥霍。但是MacBooks的工业设计有一点很特别！我喜欢把MacBook air放在背包里随身携带的轻松感觉。我已经在macOS上扎下了根。</p><p id="cf1c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我知道苹果芯片的一些<a class="ae mr" rel="noopener" target="_blank" href="/top-3-reasons-why-i-sold-my-m1-macbook-pro-as-a-data-scientist-abad1226f52a">问题</a>:新的arm64处理器架构对数据科学库兼容性提出了挑战。基本上，这是<strong class="la iu">太新</strong>——我不习惯有这个问题。尽管如此，新的苹果芯片还是<a class="ae mr" href="https://www.youtube.com/watch?v=cAjarAgf0nI&amp;ab_channel=TheDevDoctor" rel="noopener ugc nofollow" target="_blank"><strong class="la iu"/></a><strong class="la iu"/>快，开发者社区正在努力弥合这一差距。</p><p id="903b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它也不是你能以这个价格买到的最强大的笔记本电脑。也就是说，在一个生产ML的重担越来越多地在云服务器上执行的世界里，UX对我来说可能比我本地日常机器上的原始计算能力更重要。我已经掌握了AWS的基础知识，并且正在上Docker、Kubernetes、Terraform等课程。必要时，我仍然可以在运行plaidML的旧x86 Hackintosh桌面上运行shell。</p><h1 id="2131" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">为什么是新的？</h1><p id="4074" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我一直在易贝上购买二手的2016-2018款MacBooks(小心翼翼地避免蝴蝶键盘)，以取代我的2012款(不再支持最新的macOS)，但后来我的雇主介入，提出直接给我买一台新的苹果机器，所以我接受了他们的提议。谢谢雇主！我相信，随着时间的推移，与所有流行的数据科学库的完全兼容将会到来，并且这台计算机将比旧计算机运行得更快，寿命更长。</p><p id="d2cd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以现在我有了一台闪亮的新MacBook。由于缺少花哨的管理设置脚本，我按照以下顺序安装了新硬件:</p><h1 id="69e8" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">大苏尔上的前几个按键</h1><ul class=""><li id="1c4d" class="ms mt it la b lb mm le mn lh mu ll mv lp mw lt mx my mz na bi translated">微风吹过欢迎屏幕:没有Siri，只有英语</li><li id="da39" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">隐藏码头。为什么要让dock保持可见，尤其是在笔记本电脑上，因为屏幕空间非常宝贵？</li><li id="228a" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">Dock:切换卡通“精灵”最小化动画到更高级的“比例”</li><li id="213f" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">连接到我手机的WiFi热点，以登录LastPass</li><li id="faa8" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">从LastPass复制我的家庭wifi密码(许多随机字符)</li><li id="c908" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">使用复制的密码从移动热点切换到家庭WiFi</li><li id="21cb" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">下载Chrome，使其成为默认浏览器</li><li id="08d0" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">登录chrome上的Google账户，安装我的各种扩展:LastPass，RegEx search，Privacy Badger，AdBlock，Grammarly，JSONview，Wikiwand，打开当前旁边的标签，等等。</li><li id="4ebc" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">将触控板灵敏度设定为最大。</li><li id="016b" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">操作系统附带的一些应用程序:Garageband、Keynote、iMovie、Pages、Numbers。我更喜欢谷歌的云应用程序作为MS Office的替代品，以及用于视频和音频编辑的免费<strong class="la iu"> DaVinci Resolve </strong>和<strong class="la iu"> Reaper </strong>。</li><li id="2165" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">关闭大部分iCloud的东西。仅保留“查找我的Mac”和“钥匙串”。我用dropbox + google来管理文件、日历、联系人等等</li></ul><h1 id="bc5c" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">开发相关设置</h1><ul class=""><li id="669d" class="ms mt it la b lb mm le mn lh mu ll mv lp mw lt mx my mz na bi translated">前往https://brew.sh/<a class="ae mr" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">安装自制软件。虽然这是下载xcode工具和诸如此类的东西…</a></li><li id="3f3c" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">从我的私人rc GitHub repo: <code class="fe ng nh ni nj b">.zshrc</code>、<code class="fe ng nh ni nj b">.vimrc</code>和iTerm prefs文件中下拉个人配置文件</li><li id="a55a" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">Brew完成下载。按照说明<a class="ae mr" href="https://stackoverflow.com/questions/35677031/adding-home-brew-to-path" rel="noopener ugc nofollow" target="_blank">将brew二进制文件添加到PATH </a>环境变量中。brew最新版本中的说明可能与堆栈链接中的不同，但它很好地解释了正在发生的事情。</li><li id="008f" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated"><code class="fe ng nh ni nj b">% brew install awscli</code>对于云开发的事情。经受<code class="fe ng nh ni nj b">% aws configure</code>。</li></ul><h2 id="cc0b" class="nk lv it bd lw nl nm dn ma nn no dp me lh np nq mg ll nr ns mi lp nt nu mk nv bi translated">一些更有生活质量的东西</h2><ul class=""><li id="63bf" class="ms mt it la b lb mm le mn lh mu ll mv lp mw lt mx my mz na bi translated"><code class="fe ng nh ni nj b">% brew install flycut spectacle</code> —我不知道没有这些剪贴板历史和屏幕空间管理工具，我将如何完成任何事情。</li><li id="021e" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">哎呀，奇观没有<a class="ae mr" href="https://developer.apple.com/documentation/apple-silicon/about-the-rosetta-translation-environment" rel="noopener ugc nofollow" target="_blank"> <strong class="la iu"> rosetta </strong> </a> <strong class="la iu">就跑不了。我猜这是不可避免的。是时候安装大家最喜欢的新翻译环境了。希望每个人都能很快移植到arm64上。</strong></li><li id="589d" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">打开FlyCut粘性挡板。不知道没有这个怎么用FlyCut。</li><li id="eee8" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">因为我喜欢一眼就能看出我的电脑有多忙:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/1cc185cc88724634e0728ab3dde933f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cuwb1zlqiE5f47R_pNLLxQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">通过参数计方便的CPU温度和利用率统计</p></figure><ul class=""><li id="9485" class="ms mt it la b lb lc le lf lh ny ll nz lp oa lt mx my mz na bi translated"><code class="fe ng nh ni nj b">% brew install dropbox</code>因为云存储是关键</li><li id="10b9" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated"><code class="fe ng nh ni nj b">% brew install whatsapp slack android-messages</code>用于通讯。</li><li id="1335" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">因为没有音乐我在做什么</li></ul><h2 id="8a1e" class="nk lv it bd lw nl nm dn ma nn no dp me lh np nq mg ll nr ns mi lp nt nu mk nv bi translated">回到开发的事情</h2><ul class=""><li id="2694" class="ms mt it la b lb mm le mn lh mu ll mv lp mw lt mx my mz na bi translated"><code class="fe ng nh ni nj b">% brew install pyenv git-open thefuck</code>因为我需要能够<a class="ae mr" href="https://github.com/pyenv/pyenv" rel="noopener ugc nofollow" target="_blank">管理我的本地python版本</a>，所以我喜欢能够<a class="ae mr" href="https://github.com/paulirish/git-open" rel="noopener ugc nofollow" target="_blank">从终端</a>打开GitHub repo网页，并且<a class="ae mr" href="https://github.com/nvbn/thefuck" rel="noopener ugc nofollow" target="_blank">这个插件</a>是一件有趣/令人愉快的事情:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/09c33b5c73c66357bc27b686d9d8ef06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZGCfiA7fiFw_zwVd9Fl_zQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">“thefuck”的常见乐趣。这个木桶实际上叫做visual studio代码btw</p></figure><ul class=""><li id="27e7" class="ms mt it la b lb lc le lf lh ny ll nz lp oa lt mx my mz na bi translated">设置<a class="ae mr" href="https://github.com/VundleVim/Vundle.vim" rel="noopener ugc nofollow" target="_blank"> vundle </a>，主要用于vim中的航空公司和相关行号。我应该和vim一起变好…</li><li id="43d9" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated"><code class="fe ng nh ni nj b">% brew install visual-studio-code</code>因为不，我不只是用vim</li><li id="0eff" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">同步vscode设置并确保扩展准备就绪。我喜欢Python Docstring生成器、SonarLint、Vim模拟器等等</li><li id="9ce1" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">因为我需要我的终端文本在每次打开一个新的会话时变大一点。我做了一个额外的iTerm2应用程序的副本，选中了“使用Rosetta打开”。我可能会更多地利用iTerm2的特性。</li></ul><h1 id="3ac4" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">麻烦开始了</h1><ul class=""><li id="cbac" class="ms mt it la b lb mm le mn lh mu ll mv lp mw lt mx my mz na bi translated">因为这正是我最近一直在用的</li></ul><p id="84f4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我的python 3.8.6构建失败了，我认为是因为它与新芯片不兼容。现在怎么办？</p><ul class=""><li id="0065" class="ms mt it la b lb lc le lf lh ny ll nz lp oa lt mx my mz na bi translated">因为我们最终都要拥抱未来。它在苹果芯片上开箱即用。</li><li id="fc22" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated"><code class="fe ng nh ni nj b">% pyenv global 3.9.4</code>因为我说<code class="fe ng nh ni nj b">python</code>的时候就是想要这个</li><li id="8086" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">试着在venv中安装各种大的令人讨厌的python库，比如<code class="fe ng nh ni nj b">opencv</code>。注意红色错误信息墙。我将回到这一点。</li><li id="35da" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">尝试从源代码安装opencv。这是痛苦的，感觉草图，导致绝望当它在第一次尝试时对我不起作用。乐叹。</li></ul><p id="b95f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是我预料中的路障。我知道并不是每个人都已经将他们的Python数据科学库移植到苹果M1芯片上。我希望避免过多地依赖Rosetta翻译器，所以我会坚持尝试从源代码中构建一些东西或找到解决方法。</p><ul class=""><li id="da13" class="ms mt it la b lb lc le lf lh ny ll nz lp oa lt mx my mz na bi translated">成功<a class="ae mr" href="https://github.com/numpy/numpy/issues/17807#issuecomment-733863375" rel="noopener ugc nofollow" target="_blank">直接从最新的源repo  </a>安装NumPy <strong class="la iu">。这给了我希望，我可以让事情在arm64架构上自然地工作。</strong></li><li id="a414" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">运行<code class="fe ng nh ni nj b">% pip install scikit-learn</code>是一个<strong class="la iu">禁忌</strong>，即使NumPy是从源代码构建的。相反，我将尝试使用与安装NumPy】相同的<a class="ae mr" href="https://github.com/numpy/numpy/issues/17807#issuecomment-733863375" rel="noopener ugc nofollow" target="_blank">方法:克隆sklearn的主git repo，并在本地安装pip(使用一些标志绕过挑剔的PEP标准)。</a></li><li id="077f" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">这不起作用，因为没有安装依赖关系<code class="fe ng nh ni nj b">scipy</code>。我将尝试以同样的方式安装每个依赖项…这导致了失望之路</li><li id="fe70" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">从源代码构建东西是令人沮丧的。没有递归依赖解析。我是不是就应该洞穴<a class="ae mr" rel="noopener" target="_blank" href="/new-apple-silicon-m1-macbook-air-the-dream-laptop-for-machine-learning-engineers-a1590fbd170f?gi=c57f36beaf82"> <strong class="la iu">成为康达人</strong> </a>？</li></ul><h1 id="e7fc" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">就用MiniForge</h1><ul class=""><li id="937f" class="ms mt it la b lb mm le mn lh mu ll mv lp mw lt mx my mz na bi translated">我彻底屈服了，跑了<code class="fe ng nh ni nj b">% brew install miniforge</code>。这就行了。</li><li id="44f1" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">似乎不错。试试<code class="fe ng nh ni nj b">% conda create -n .venv python=3.9.2</code>。新环境工程。</li><li id="d4f5" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">假设我想安装一些晦涩的Python包，它们存在于PyPi上，但不存在于conda forge上。我可以尝试:<code class="fe ng nh ni nj b">% pip install [obscure_library_name]</code>，看看它在哪个依赖项上失败了，然后递归地运行:<code class="fe ng nh ni nj b">% conda install [dependency]</code>，直到我可以完全安装我想要的晦涩的库。它并不漂亮，但目前为止还能用。<strong class="la iu">还是不用Rosetta！</strong></li><li id="c024" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">上面的方法对OpenCV不起作用，所以我按照这个人的<a class="ae mr" href="https://sayak.dev/install-opencv-m1/" rel="noopener ugc nofollow" target="_blank">指南再次尝试从源代码</a>构建OpenCV。这一次，我喝了更多的咖啡因，并愿意按照指示去开球。它非常有效。</li></ul><h1 id="7af5" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">最后</h1><p id="79ea" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">这是我在新的M1 MacBook Air上开店的理由和过程。</p><p id="a70c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">起初，我尝试使用pyenv以一种非常普通的方式管理python venvs，但是效果不是很好。</p><p id="a7d0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我最终只是通过brew安装了MiniForge(类似于MiniConda ),这对于管理venvs很有效。当我们在苹果芯片和开源数据科学(和其他)库之间架起桥梁时，MiniForge的“强调支持各种CPU架构”就派上了用场。</p></div></div>    
</body>
</html>