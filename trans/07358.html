<html>
<head>
<title>Publishing Open-Source Python Packages to PyPI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将开源Python包发布到PyPI</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/publishing-open-source-python-packages-to-pypi-4a1458416572?source=collection_archive---------33-----------------------#2021-07-04">https://towardsdatascience.com/publishing-open-source-python-packages-to-pypi-4a1458416572?source=collection_archive---------33-----------------------#2021-07-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6ac9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">造了很酷的东西？通过将它发布到PyPI，使它易于访问！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bc36ca6db808370f16ae82cd96b580f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SLqQbIRzSzJVdmhm"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@hiteshchoudhary?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">在</a><a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="ab7f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">Python包索引(PyPI)</h1><p id="c6bc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Python包索引是可用于Python编程的软件库的存储库。PyPI使得分发和访问不属于标准Python库的有用项目变得容易。</p><p id="26c2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">将自己的开源项目发布到PyPI非常简单。在本文中，我们将介绍如何:</p><ul class=""><li id="53c5" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">为PyPI准备好您的包</li><li id="107e" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">手动构建您的包并上传到PyPI</li><li id="d6c5" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">在发布之前用<a class="ae ky" href="https://test.pypi.org/" rel="noopener ugc nofollow" target="_blank"> TestPyPI </a>测试你的包</li><li id="fdb1" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">版本控制</li><li id="e7d2" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">使用CircleCI将存储库的主分支与PyPI同步</li></ul><p id="94ab" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我将使用我的一个存储库作为例子:<a class="ae ky" href="https://github.com/happilyeverafter95/pdf-wrangler" rel="noopener ugc nofollow" target="_blank"> pdf-wrangler </a>，一个用于更简单的pdf提取的PDFMiner包装器。这个项目在PyPI上的<a class="ae ky" href="https://pypi.org/project/pdf-wrangler/" rel="noopener ugc nofollow" target="_blank">这里</a>托管。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/35a7b32db76e2d7068cd219277e749cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-cs_fa36XF3J4-AtalGFmg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">截图来自<a class="ae ky" href="https://pypi.org/" rel="noopener ugc nofollow" target="_blank">https://pypi.org/</a></p></figure><h1 id="cdd6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">为PyPI准备您的包</h1><p id="a67f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">首先，您需要在根目录下创建一个<code class="fe nh ni nj nk b">setup.py</code>文件来提供关于您的包的一些信息。这是<code class="fe nh ni nj nk b">pdf-wrangler.</code>的<code class="fe nh ni nj nk b">setup.py</code>文件的第一次迭代</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="7021" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最关键的字段是:</p><ul class=""><li id="2b0d" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated"><strong class="lt iu"> name: </strong>出现在PyPI上的包的名称(这个名称必须是惟一的，所以要确保没有同名的包存在)</li><li id="ab25" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><strong class="lt iu">版本:</strong>这是您的软件包的唯一版本</li><li id="b6b9" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">安装要求:这指定了你的包的依赖关系</li><li id="b7b3" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><strong class="lt iu">python _ requires:</strong>python版本需求</li><li id="ed8b" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><strong class="lt iu"> url: </strong>链接到项目代码库所在的位置</li></ul><p id="0251" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这里，我也导入自述文件作为详细描述。简短和详细的描述都将显示在PyPI页面上。</p><h1 id="0171" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">构建并上传您的包</h1><p id="1ecf" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">一旦我们创建了<code class="fe nh ni nj nk b">setup.py</code>文件，我们就可以开始构建和上传了。</p><h2 id="a8af" class="nn la it bd lb no np dn lf nq nr dp lj ma ns nt ll me nu nv ln mi nw nx lp ny bi translated">建设</h2><p id="eff3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">“构建”过程为您的包创建一个源归档文件和wheel，由以下命令启动:</p><pre class="kj kk kl km gt nz nk oa ob aw oc bi"><span id="6032" class="nn la it nk b gy od oe l of og">python setup.py sdist bdist_wheel</span></pre><p id="42c6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这将创建一个<code class="fe nh ni nj nk b">dist</code>目录，其中包含上传所需的所有文件。您应该使用<code class="fe nh ni nj nk b">.gitignore</code>将这个目录从您的存储库中排除，这样它就不会使您的代码混乱。</p><h2 id="2f7c" class="nn la it bd lb no np dn lf nq nr dp lj ma ns nt ll me nu nv ln mi nw nx lp ny bi translated">上传</h2><p id="aa3b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">首先，我们需要<a class="ae ky" href="https://pypi.org/account/register/" rel="noopener ugc nofollow" target="_blank">在PyPI上创建一个账户</a>。我建议在TestPyPI上创建一个帐户，这样你可以在上传之前在一个单独的索引上测试你的包。</p><p id="d289" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">注意:</strong>新版本一旦发布，就没有办法覆盖，所以要确保你发布的所有东西都经过了适当的测试！</p><p id="24b3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">根据它的文档，<a class="ae ky" href="https://pypi.org/project/twine/" rel="noopener ugc nofollow" target="_blank"> twine </a>是一个“在PyPI上发布Python包的工具”。使用<code class="fe nh ni nj nk b">twine</code>，我们可以在安装后从命令行发布包。</p><pre class="kj kk kl km gt nz nk oa ob aw oc bi"><span id="1fb1" class="nn la it nk b gy od oe l of og">pip install twine</span></pre><p id="610b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要上传到<strong class="lt iu">测试</strong>索引，在根目录下运行以下命令:</p><pre class="kj kk kl km gt nz nk oa ob aw oc bi"><span id="f2f8" class="nn la it nk b gy od oe l of og">twine upload --repository-url https://test.pypi.org/legacy/ dist/*</span></pre><p id="f509" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">准备好上传到实际的PyPI索引后，在根目录下运行以下命令:</p><pre class="kj kk kl km gt nz nk oa ob aw oc bi"><span id="c403" class="nn la it nk b gy od oe l of og">twine upload dist/*</span></pre><p id="190c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe nh ni nj nk b">twine upload</code>命令将提示您使用您的PyPI用户名和密码进行身份验证。一旦通过认证，<code class="fe nh ni nj nk b">twine</code>将上传并分享您可以找到您的包裹的网址(您也应该能够通过在PyPI上的谷歌搜索轻松找到您的包裹)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/249b88b8fab3321cbaff6bc28cecc142.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lEOEAXOMwhm5PAkU0tt6JA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">截图来自<a class="ae ky" href="https://pypi.org/project/pdf-wrangler/" rel="noopener ugc nofollow" target="_blank">https://pypi.org/project/pdf-wrangler/</a></p></figure><h1 id="420c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">版本控制</h1><p id="140e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果您尝试上传同一个版本两次，您将会遇到此错误，告诉您每个版本必须是唯一的:</p><pre class="kj kk kl km gt nz nk oa ob aw oc bi"><span id="ec43" class="nn la it nk b gy od oe l of og">HTTPError: 400 Client Error: File already exists. See https://pypi.org/help/#file-name-reuse for url: https://upload.pypi.org/legacy</span></pre><p id="78e9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如前所述，版本在<code class="fe nh ni nj nk b">setup.py</code>文件中指定。每次我们想上传一个新版本的包，我们必须改变版本。</p><p id="2ad6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">有两种常用的版本化方案:</p><h2 id="1084" class="nn la it bd lb no np dn lf nq nr dp lj ma ns nt ll me nu nv ln mi nw nx lp ny bi translated"><strong class="ak">日期方案</strong></h2><p id="0bcf" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您可以使用发布日期来版本化您的软件包。例如，从今天开始的新版本将是<code class="fe nh ni nj nk b">pdf_wrangler==20210704</code></p><p id="2139" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">使用日期进行版本控制的缺点是，它不会考虑同一日期单位的多个版本。</p><h2 id="f70e" class="nn la it bd lb no np dn lf nq nr dp lj ma ns nt ll me nu nv ln mi nw nx lp ny bi translated">基于序列的方案</h2><p id="eb4b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">对于基于序列的方案，每个版本都是由点分隔的数值序列。最常用的格式是:</p><pre class="kj kk kl km gt nz nk oa ob aw oc bi"><span id="7bd1" class="nn la it nk b gy od oe l of og">MAJOR.MINOR.MICRO</span></pre><ul class=""><li id="c549" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">重大变更是软件的重大修订，通常会以一种不总是向后兼容的方式彻底改变API /现有特性</li><li id="ef0b" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">次要是指较小(但相当大)的更改，如功能改进，当最终用户升级时，这些更改几乎没有风险</li><li id="197b" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">微小的改变通常是为修复错误而保留的</li></ul><h1 id="785b" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">用PyPI同步主/主分支</h1><p id="3794" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果您想要将您的主分支与PyPI同步，以便您不需要手动构建和上传您的发行版，您将需要一个CI/CD工具来执行我们前面运行的命令。<a class="ae ky" href="https://github.com/happilyeverafter95/pdf-wrangler/blob/main/.circleci/config.yml" rel="noopener ugc nofollow" target="_blank">这里的</a>是<code class="fe nh ni nj nk b">pdf-wrangler</code>使用CircleCI的一个例子。</p><p id="d7b9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">之前，我们通过以下方式手动上传了包:</p><ul class=""><li id="09f8" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">构建新的发行版(记住版本也需要更新)</li><li id="df36" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">使用<code class="fe nh ni nj nk b">twine</code>上传到PyPI</li></ul><p id="95c2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们可以通过CircleCI构建和部署步骤自动运行这些命令。我们可以利用有用的CircleCI环境变量，比如<code class="fe nh ni nj nk b">CIRCLE_BRANCH</code>,这样我们就可以只同步主分支的变更。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="3fd5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们看一下<code class="fe nh ni nj nk b">build-and-test</code>工作流程中的每一步:</p><ul class=""><li id="e265" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated"><code class="fe nh ni nj nk b">Run tests</code>使用<code class="fe nh ni nj nk b">pytest</code>执行我们的测试，这样我们就可以放心地发布变更</li><li id="c9f4" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><code class="fe nh ni nj nk b">init .pypirc</code>跟踪使用我们的PyPI帐户进行身份验证所需的必要环境变量；密码(这是一个秘密)作为一个秘密环境变量保存在CircleCI项目设置中</li><li id="f476" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><code class="fe nh ni nj nk b">create packages</code>为主分支上的变更构建分发包</li><li id="1009" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><code class="fe nh ni nj nk b">upload to pypi</code>执行<code class="fe nh ni nj nk b">twine</code>命令对主分支进行修改(确保<code class="fe nh ni nj nk b">twine</code>作为项目依赖项的一部分安装)</li></ul></div><div class="ab cl oi oj hx ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="im in io ip iq"><p id="5a62" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如您所见，发布您自己的开源Python包并不困难。希望这对你有帮助！</p><h1 id="32ef" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">感谢您的阅读！</h1><p id="8629" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><a class="ae ky" href="https://medium.com/@mandygu" rel="noopener">通过Medium </a>关注我的最新动态。😃</p><p id="d3ab" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">作为一个业余爱好项目，我还在<a class="ae ky" href="http://www.dscrashcourse.com/" rel="noopener ugc nofollow" target="_blank">www.dscrashcourse.com</a>建立了一套全面的<strong class="lt iu">免费</strong>数据科学课程和练习题。</p><p id="06bf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">再次感谢您的阅读！📕</p></div></div>    
</body>
</html>