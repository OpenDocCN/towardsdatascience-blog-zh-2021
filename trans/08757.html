<html>
<head>
<title>Working with DICOM-THREADED</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用DICOM-线程</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/working-with-dicom-threaded-6a066ad6dbbd?source=collection_archive---------36-----------------------#2021-08-12">https://towardsdatascience.com/working-with-dicom-threaded-6a066ad6dbbd?source=collection_archive---------36-----------------------#2021-08-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3826" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">标准很重要，您应该能够与它们一起工作！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9551b696feaa295f61fa6a0c9af10734.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OTmAtXvGPEcRfH6UQ1Nf7Q.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">卢多维克·沙雷特在<a class="ae kv" href="https://unsplash.com/s/photos/x-ray?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="0a4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">标准很重要。我是德国人，所以我知道我在说什么。我们有很多标准和规则，比如“德国工业规范”(DIN)。在这里，我们以纸张的大小或打印文档的样式为例。今天我们要讨论的是在医学图像计算中非常重要的一个标准，DICOM。这是医学数字成像和通信的简称。当我在Kaggle上进行<a class="ae kv" href="https://www.kaggle.com/c/siim-covid19-detection" rel="noopener ugc nofollow" target="_blank">SIIM Covid-Detection Challenge</a>时，我偶然发现了这个规范，今天我想向你展示如何使用它们进行机器学习。</p><p id="52d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个挑战中，以及在野外，DICOM最常用作交换医学图像的文件格式。但问题出现了，如何打开和解析它们？我们如何在图像分类任务中使用它们？这就是我想向你解释它们的原因。我们将使用Python和<a class="ae kv" href="https://arxiv.org/pdf/2006.01174.pdf" rel="noopener ugc nofollow" target="_blank"> BIMCV新冠肺炎+ </a>数据集一起完成这项工作。它包含超过2000个扫描，可以在Kaggle挑战页面下载。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="9873" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated"><strong class="ak">py DICOM库</strong></h1><p id="e2e0" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">首先我们需要安装pydicom库。用<strong class="ky ir"> pip </strong>或<strong class="ky ir"> conda </strong>安装后。我们导入lib并输出第一幅图像的内容。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="52b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您现在打印我们的<strong class="ky ir"> dicom_img </strong>对象，您可以看到一长串信息。这是dicoms最大的优点和缺点。你有许多可选字段，很容易填错，或者根本不填。但是我们现在讨论的是最重要的属性:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="4e05" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated"><strong class="ak">我们的转换代码</strong></h1><p id="7a68" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">但是现在我们只有一个DICOM数据集对象，我们需要的是一个实际的图像。通过这个简单的方法，我们可以将DICOM像素阵列转换成8位的numpy阵列:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="51bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如你所看到的，我们有两个额外的开关<strong class="ky ir"> voi_lut </strong>和<strong class="ky ir"> fix_mono </strong>。<strong class="ky ir"> voi_lut </strong>开关始终为真，因为如果我们对像素进行转换，我们会使用它，但这里有一个转折。如果我们的DICOM扫描中没有VOI·LUT序列，pydicom会保持数组不变。第二个开关解决了以<strong class="ky ir">单色1 </strong>格式存储的扫描的问题，因为在这种格式中，最小值以白色显示，而不是黑色，同样，这仅在存在<strong class="ky ir">单色1 </strong>扫描时才会发生。</p><p id="1700" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">转换后，我们现在可以显示我们的图像，但有一些困扰我。</p><p id="0037" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一些信息可能会丢失！DICOM扫描提供了另一个有趣的属性:<strong class="ky ir">位存储</strong>和<strong class="ky ir">位分配</strong>。DICOM扫描总是为每个像素分配一些位(1、8或16)，并实际存储一些位(8、12、16)。在上面的DICOM扫描中，我们存储了12位，因此我们需要一个更好的函数来根据分配的位进行转换，因此我们不使用详细信息:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="87ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到目前为止做得不错。现在让我们显示PIL的图像:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi my"><img src="../Images/59dae16af95a40e4468fcd4c06047344.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*VKgOtYHElalxLyeT1NbK_A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">卡格尔·SIIM·科维德19号挑战赛的肺部CT扫描</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="9cd4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如您在我的代码的顶部看到的，您可以调整图像的输出大小以及应该使用多少线程。这段代码不会改变路径或数据，而是创建一个带有后缀<em class="mz"> _converted </em>的新文件夹。如果您想添加一个argparser，可以随意修改代码。</p><p id="831f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">建议:</strong></p><ul class=""><li id="b151" class="na nb iq ky b kz la lc ld lf nc lj nd ln ne lr nf ng nh ni bi translated">检查DCM扫描的可用大小，否则您会缩放得太多/太少</li><li id="5ad1" class="na nb iq ky b kz nj lc nk lf nl lj nm ln nn lr nf ng nh ni bi translated">使用PyTorch的8位PNGs，否则您将运行在seg fault错误！</li></ul><p id="6066" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的阅读，如果您有任何进一步的问题，请联系我。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="82e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">参考资料:</p><p id="99e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如前所述，数据取自卡格尔比赛<a class="ae kv" href="https://www.kaggle.com/c/siim-covid19-detection/data" rel="noopener ugc nofollow" target="_blank">SIIM·科维德19 </a>。</p></div></div>    
</body>
</html>