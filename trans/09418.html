<html>
<head>
<title>Learn what a depth chart is and how to create it in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解什么是深度图以及如何用Python创建深度图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/learn-what-a-depth-chart-is-and-how-to-create-it-in-python-323d065e6f86?source=collection_archive---------16-----------------------#2021-09-01">https://towardsdatascience.com/learn-what-a-depth-chart-is-and-how-to-create-it-in-python-323d065e6f86?source=collection_archive---------16-----------------------#2021-09-01</a></blockquote><div><div class="fc ij ik il im in"/><div class="io ip iq ir is"><figure class="iu iv gp gr iw ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi it"><img src="../Images/367da768a913697e0ef6a6c6bcb8aa5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0l7-vV_6zXMjAZzpRLM2xw.jpeg"/></div></div><p class="je jf gj gh gi jg jh bd b be z dk translated">由<a class="ae ji" href="https://unsplash.com/@austindistel?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">奥斯汀·迪斯特尔</a>在<a class="ae ji" href="https://unsplash.com/s/photos/crypto?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><div class=""/><div class=""><h2 id="cfd2" class="pw-subtitle-paragraph ki jk jl bd b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dk translated">使用币安的API获取订单数据</h2></div><p id="4241" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">如果你曾经冒险进入任何一个加密货币交易所，我敢肯定你已经看到了一个深度图，就像上图中的那个。在本文中，我想快速讨论深度图实际上是什么，我们可以从中推断出什么样的信息，然后展示如何使用Python创建深度图。</p><p id="cea1" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">请记住，这是一篇专注于获取订单簿数据和创建适当的可视化的文章。这不是一条投资建议！</p><h1 id="8d7a" class="lw lx jl bd ly lz ma mb mc md me mf mg kr mh ks mi ku mj kv mk kx ml ky mm mn bi translated">深度图——是什么？</h1><p id="1ee5" class="pw-post-body-paragraph la lb jl lc b ld mo km lf lg mp kp li lj mq ll lm ln mr lp lq lr ms lt lu lv io bi translated"><strong class="lc jm">深度图</strong>是一种可视化，它告诉我们特定资产(股票、商品、密码等)的需求和供给。)价格不同。它基于订单簿数据，即未结买卖订单的数量，包括资产的数量。此类订单的数量越大，该资产的市场流动性就越强。</p><p id="661d" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">交易员利用实时供求来评估资产价格的可能走向。此外，它还用于估计在不导致价格上涨的情况下可以购买的资产单位数量。举个例子，一个流动性很强的资产(有大量买家和卖家)的价格在一个大订单完成后不太可能有太大变化。缺乏流动性的资产就不一样了。</p><h1 id="ae35" class="lw lx jl bd ly lz ma mb mc md me mf mg kr mh ks mi ku mj kv mk kx ml ky mm mn bi translated">Python中的示例</h1><p id="f597" class="pw-post-body-paragraph la lb jl lc b ld mo km lf lg mp kp li lj mq ll lm ln mr lp lq lr ms lt lu lv io bi translated">和往常一样，我们从导入所需的库开始。</p><figure class="mt mu mv mw gt ix"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="3b2f" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">为了创建深度图，我们需要访问订单簿数据。我们从<a class="ae ji" href="https://accounts.binance.com/en/register?ref=13670520" rel="noopener ugc nofollow" target="_blank">币安</a> ( <em class="mz">免责声明</em>:附属链接)获得数据，这是最受欢迎的加密交易所之一。我们可以通过多种方式访问数据:</p><ul class=""><li id="776f" class="na nb jl lc b ld le lg lh lj nc ln nd lr ne lv nf ng nh ni bi translated">通过Python的<code class="fe nj nk nl nm b">requests</code>库使用币安的API，</li><li id="0a47" class="na nb jl lc b ld nn lg no lj np ln nq lr nr lv nf ng nh ni bi translated">使用非官方的<code class="fe nj nk nl nm b">python-binance</code>库，</li><li id="34da" class="na nb jl lc b ld nn lg no lj np ln nq lr nr lv nf ng nh ni bi translated">使用<code class="fe nj nk nl nm b">binance-connector</code>图书馆。</li></ul><p id="902c" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">我们将采用最后一种选择。我们从实例化币安客户端开始。对于这个特定的端点，我们不需要帐户和API密钥。然而，如果你计划更广泛地使用他们的API，你可能想要<a class="ae ji" href="https://www.binance.com/en-NG/support/faq/360002502072" rel="noopener ugc nofollow" target="_blank">设置它</a>。然后，我们使用<code class="fe nj nk nl nm b">depth</code>方法为<code class="fe nj nk nl nm b">ETHUSDT</code>对下载订单簿数据。</p><figure class="mt mu mv mw gt ix"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="dc07" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">返回的数据存储在一个带有以下关键字的字典中:<code class="fe nj nk nl nm b">[‘lastUpdateId’, ‘bids’, ‘asks’]</code>。出价和要价被存储为列表的列表，所以我们需要使用下一个代码片段将它们转换成一个<code class="fe nj nk nl nm b">pandas</code>数据帧。</p><figure class="mt mu mv mw gt ix"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="e2f9" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">数据帧如下所示:</p><figure class="mt mu mv mw gt ix gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/28019aa31b9877f3b8887ad3232381db.png" data-original-src="https://miro.medium.com/v2/resize:fit:526/format:webp/1*8tWc_AGxliSO2FrrP_vGkQ.png"/></div><p class="je jf gj gh gi jg jh bd b be z dk translated">作者图片</p></figure><p id="0e4c" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">我们也可以使用<code class="fe nj nk nl nm b">describe</code>方法来检查数据。</p><pre class="mt mu mv mw gt nt nm nu nv aw nw bi"><span id="bed1" class="nx lx jl nm b gy ny nz l oa ob">df.groupby("side").price.describe()</span></pre><figure class="mt mu mv mw gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi oc"><img src="../Images/9844055e944f27e3cc1b92e4943fd517.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VOHVfsXGPpR235F94HVaFg.png"/></div></div><p class="je jf gj gh gi jg jh bd b be z dk translated">作者图片</p></figure><p id="1712" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">我们可以看到每边包含100个观察值。我们可以要求每边多达5000次观察。更多详情，请参见<a class="ae ji" href="https://binance-docs.github.io/apidocs/spot/en/#order-book" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="2174" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">作为探索订单簿数据的第一步，我们可以使用散点图将其可视化。</p><figure class="mt mu mv mw gt ix"><div class="bz fp l di"><div class="mx my l"/></div></figure><figure class="mt mu mv mw gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi od"><img src="../Images/fcfb378a16c0b75006a2ce7e2e15047d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J-Eqe1U-I7GmW7ugkZmJFg.png"/></div></div><p class="je jf gj gh gi jg jh bd b be z dk translated">作者图片</p></figure><p id="60a9" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">虽然我们已经可以看到更多的数据细节，但很难根据图表做出任何决定。这就是为什么我们需要更多的聚合。作为探索这些数据的第二步，让我们绘制一个直方图。</p><figure class="mt mu mv mw gt ix"><div class="bz fp l di"><div class="mx my l"/></div></figure><figure class="mt mu mv mw gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi oe"><img src="../Images/914c4435b0a6b22c09ff59e30fe9bb9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*21DpUEAXBJCawILh36Rtdg.png"/></div></div><p class="je jf gj gh gi jg jh bd b be z dk translated">作者图片</p></figure><p id="34f3" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">直方图显示了具体价格的出价和要价数量，但是它掩盖了交易量。这意味着价格为3300美元、数量为0.1个硬币的数据点实际上与价格为3301美元、数量为100个硬币的数据点价值相同。</p><p id="d38c" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">该图中所有条形的总和将是200，因为我们有那么多数据点。</p><p id="918c" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">我们可以通过创建一个加权直方图将关于数量的信息合并到分析中，这只需要对代码做一点修改。</p><figure class="mt mu mv mw gt ix"><div class="bz fp l di"><div class="mx my l"/></div></figure><figure class="mt mu mv mw gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi of"><img src="../Images/a9956aa5c731c6488851369b0f133e33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iDXWMT937N3TILAYL0OQng.png"/></div></div><p class="je jf gj gh gi jg jh bd b be z dk translated">作者图片</p></figure><p id="177f" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">这个情节已经传达了一个更准确的关于供求的故事。但很难据此做出决定。假设您想要购买50个ETH。使用加权直方图，您无法判断您需要以什么价格出价来确保您的购买订单将被匹配引擎满足。这就是深度图发挥作用的地方。</p><p id="b6c7" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">为了回答上面的问题，我们需要以升序排列的数量和价格信息的累积和。同样，对于与上面相同的问题，但重点是要价，我们需要降序排列的类比信息。</p><p id="9206" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">我们可以通过使用<strong class="lc jm">经验累积分布函数</strong> ( <strong class="lc jm"> ECDF </strong>)得到上述信息。<code class="fe nj nk nl nm b">seaborn</code>附带了一个方便的函数(<code class="fe nj nk nl nm b">sns.ecdfplot</code>)，我们可以用它来获取图表。为了得到我们确切需要的，我们必须指定一些参数:</p><ul class=""><li id="d186" class="na nb jl lc b ld le lg lh lj nc ln nd lr ne lv nf ng nh ni bi translated"><code class="fe nj nk nl nm b"><em class="mz">weights</em>=”quantity”</code> —确保ECDF按数量加权，就像我们对加权直方图所做的那样，</li><li id="fb43" class="na nb jl lc b ld nn lg no lj np ln nq lr nr lv nf ng nh ni bi translated"><code class="fe nj nk nl nm b"><em class="mz">stat</em>=”count”</code> —因此我们使用计数，并且该图没有标准化到范围[0，1]，</li><li id="0531" class="na nb jl lc b ld nn lg no lj np ln nq lr nr lv nf ng nh ni bi translated"><code class="fe nj nk nl nm b"><em class="mz">complementary</em>=True</code>—当我们想要颠倒累计和的顺序时。我们只在出价的情况下使用这个。</li></ul><figure class="mt mu mv mw gt ix"><div class="bz fp l di"><div class="mx my l"/></div></figure><figure class="mt mu mv mw gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi og"><img src="../Images/37e1cb064b4bf9cc765565486da35c63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SnKuwq3OZHRGwUkyuOzxoQ.png"/></div></div><p class="je jf gj gh gi jg jh bd b be z dk translated">作者图片</p></figure><p id="ae6b" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">利用这个图，我们可以回答前面提出的问题。为了相对确定我们50 ETH的订单将被完成，我们应该提供大约3392.5美元每ETH。</p><h1 id="f40c" class="lw lx jl bd ly lz ma mb mc md me mf mg kr mh ks mi ku mj kv mk kx ml ky mm mn bi translated">外卖食品</h1><ul class=""><li id="df54" class="na nb jl lc b ld mo lg mp lj oh ln oi lr oj lv nf ng nh ni bi translated">深度图是一种显示特定资产在不同价格下的需求和供给的可视化形式。</li><li id="7c4c" class="na nb jl lc b ld nn lg no lj np ln nq lr nr lv nf ng nh ni bi translated">我们可以基于订单簿数据构建深度图表，即特定价格的买卖订单列表。</li><li id="c74e" class="na nb jl lc b ld nn lg no lj np ln nq lr nr lv nf ng nh ni bi translated">查看深度图，我们可以估计购买/出售一定数量资产的目标价格，以确保交易所的匹配引擎将履行订单。</li></ul><p id="0df3" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">您可以在我的<a class="ae ji" href="https://github.com/erykml/medium_articles/blob/master/Quantitative%20Finance/depth_chart.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到本文使用的代码。此外，欢迎任何建设性的反馈。你可以在推特上或者评论里联系我。</p><p id="4ac9" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">喜欢这篇文章吗？成为一个媒介成员，通过无限制的阅读继续学习。如果你使用<a class="ae ji" href="https://eryk-lewinson.medium.com/membership" rel="noopener">这个链接</a>成为会员，你将支持我，不需要你额外付费。提前感谢，再见！</p><p id="2a83" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">您可能还会对以下内容感兴趣:</p><div class="iu iv gp gr iw ok"><a rel="noopener follow" target="_blank" href="/mplfinance-matplolibs-relatively-unknown-library-for-plotting-financial-data-62c1c23177fd"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd jm gy z fp op fr fs oq fu fw jk bi translated">mpl finance——matplolib相对不为人知的用于绘制金融数据的库</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">包括快速创建图表的方法，如烛台，连科，或点和图</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">towardsdatascience.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy jc ok"/></div></div></a></div><div class="iu iv gp gr iw ok"><a rel="noopener follow" target="_blank" href="/stockstats-a-handy-stocks-oriented-pandas-dataframe-wrapper-a879a06d9c3f"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd jm gy z fp op fr fs oq fu fw jk bi translated">stock stats——一个方便的面向股票的熊猫数据框架包装器</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">只需调用列名即可访问各种技术指标！</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">towardsdatascience.com</p></div></div><div class="ot l"><div class="oz l ov ow ox ot oy jc ok"/></div></div></a></div><div class="iu iv gp gr iw ok"><a rel="noopener follow" target="_blank" href="/the-simplest-way-to-create-an-interactive-candlestick-chart-in-python-ee9c1cde50d8"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd jm gy z fp op fr fs oq fu fw jk bi translated">用Python创建交互式烛台图表的最简单方法</h2><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">towardsdatascience.com</p></div></div><div class="ot l"><div class="pa l ov ow ox ot oy jc ok"/></div></div></a></div><h1 id="6d44" class="lw lx jl bd ly lz ma mb mc md me mf mg kr mh ks mi ku mj kv mk kx ml ky mm mn bi translated">参考</h1><ul class=""><li id="392b" class="na nb jl lc b ld mo lg mp lj oh ln oi lr oj lv nf ng nh ni bi translated"><a class="ae ji" href="https://github.com/binance/binance-connector-python" rel="noopener ugc nofollow" target="_blank">https://github.com/binance/binance-connector-python</a></li></ul></div></div>    
</body>
</html>