<html>
<head>
<title>Keep your Data Factory clean with generic datasets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用通用数据集保持数据工厂整洁</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-factory-generic-datasets-a998b832f060?source=collection_archive---------18-----------------------#2021-07-19">https://towardsdatascience.com/data-factory-generic-datasets-a998b832f060?source=collection_archive---------18-----------------------#2021-07-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3778" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何在Azure数据工厂中为Blob存储和SQL DB创建通用的、可重用的数据集</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6ab376925a5a09e4307693d72ce884e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*01IMR8gb7kwdEP5iFYrGow.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@cremajoe?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">克丽玛乔</a>在<a class="ae kv" href="https://unsplash.com/s/photos/reusable?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="7c72" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你有没有遇到过Azure数据工厂设置有一英里长的数据集列表，因为每个数据集都是为一个管道而创建的？我确实有。在本文中，我将向您展示如何创建通用的、可重用的数据集来保持工厂整洁。</p><p id="0f5e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文组织如下:</p><ol class=""><li id="7d9d" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">如何为Blob存储创建通用数据集</li><li id="cff2" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">如何为SQL数据库创建通用数据集</li><li id="4d1e" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">用法示例</li></ol><p id="d5d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请参见我的<strong class="ky ir">注释</strong>中的常见问题:<strong class="ky ir"> 1) </strong>您可能需要为某个字段设置<em class="mg"> None </em>值，当其他字段没有值时，该字段是不可见的，<strong class="ky ir"> 2) </strong>找到字段的动态内容编辑器可能很棘手，以及<strong class="ky ir"> 3) </strong>如何在管道属性中包含特殊字符，如\t或\n(制表符或换行符)。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h2 id="040e" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">1.如何为Blob存储创建通用数据集</h2><p id="8ddf" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">为了创建一个通用的、可重用的Blob存储数据集，我们将像往常一样创建一个数据集，并给它一个描述性的名称。这里我将我的数据集命名为miiastorage_delimitedtext，其中miiastorage是我的存储帐户，delimitedtext是指我为数据集选择的格式类型。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/7f64b068d738b24a54966d88636776d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BMmS6sYfqLB6vooHXVMTxA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建后初始数据集属性的屏幕截图。</p></figure><p id="3e3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们将为我们希望在使用该数据集时能够动态设置的每个设置创建一个参数。在这里，我决定参数化一切，但你可能总是有相同的编码等。除了容器和路径之外，我已经给了所有设置默认值，因为无论如何在使用它们的时候它们都不能为空。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/b91f5ad909c41f9b902618aac5b8e653.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sbwkUOQiV02bKhtcX4bLHw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示数据集参数的屏幕截图。除了容器和路径之外，其他都有一个默认值，因为几乎每次引用该数据集时，这些值都会发生变化。行分隔符参数默认值似乎没有设置，但它是在json代码中设置的，我将在本文后面介绍。</p></figure><p id="022d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们设置带有动态内容的数据集属性来引用这些参数。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/9f9ca03a470ef6d9369be8af39f39a20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ErKfGBUsSsiGgMKSeJUZyA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示属性设置的屏幕截图，其中每个属性都用数据集参数的动态内容引用来定义。</p></figure><p id="85fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注1 </strong>:当压缩类型为<em class="mg">无</em>时，压缩级别必须设置为<em class="mg">无</em>。使用基本属性时，压缩级别默认为<em class="mg">无</em>，压缩级别不可见(= <em class="mg">无</em>)。</p><p id="8882" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注2 </strong>:寻找动态内容链接有时很棘手。这里有两个流程可以帮你找到方向。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/058fca8d5a3023c83143b7fee996a7e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*e077rm7yYzI3e2ktDbryZQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">当编辑框可见时，如何为数据工厂中的下拉菜单设置动态内容的示例流程。步骤1是下拉菜单的初始视图。当编辑复选框被选中时，下拉列表变为文本框(步骤2)，当文本框被激活时，动态内容链接出现(步骤3)。第4步展示了动态内容设置后的样子。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/1d78fa30dc90868572388926df195d79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*P2Zigq_lTd6XFCld_PN5Tg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">当编辑框不可见时，如何为数据工厂中的下拉菜单设置动态内容的示例流程。步骤1是下拉菜单的初始视图。单击下拉菜单两次以打开和关闭它(步骤2)。菜单关闭时会出现动态内容链接(步骤3)。第4步展示了动态内容设置后的样子。</p></figure><p id="9497" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注3 </strong>:数据工厂编辑器对特殊字符如\t (tab)和\n(换行符)进行转义。这意味着，当您在编辑器中的文本字段中键入\n时，它实际上会\\n并中断您的管道。要添加这些字符，你可以尝试遵循Azure的提示，从文本编辑器中复制粘贴，或者你可以通过json代码编辑器添加你的特殊字符。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/3a605722fa607ee8fb23f8a94d37bd85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UanYk1Z3mP5-p5lzh_0dbg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示列和行分隔符字段如何具有特殊字符(如制表符或换行符)将被编辑器转义的额外信息的屏幕截图。Azure建议您从文本编辑器中复制并粘贴所需的字符。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/87ada276b253f0112e2b7fdca3c9943f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oG-PDPI_CFd9k_zxDIdAdw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数据工厂截图，json代码编辑器可以从右上角进入。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/5299366eda71ef52c8f66d9b9af39a37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oC3-92PbGlCpAN4RnIxjag.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数据工厂json代码编辑器截图。在第28行，我已经将换行符的默认值定义为\n。</p></figure></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h2 id="8607" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">2.如何为SQL数据库创建通用数据集</h2><p id="3909" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">然后是SQL数据库数据集。让我们像往常一样从创建数据集开始。同样，我们希望尽可能通用地命名它，不需要一开始就为它定义任何表。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/03c226fd3f3f66911103c6c203fceffc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3E2SEsWa9emnIK8Jnp5Uhg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在没有定义表的情况下创建Azure SQL数据库数据集属性后的屏幕截图。</p></figure><p id="1ab5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们检查“Edit”框，它将“Table”输入字段扩展为两个字段，一个用于模式，一个用于表。这允许我们添加动态内容，通过它我们可以引用数据集参数。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/6cda49df8c4c4e0e63ad33693533360e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OuBBnZsJhTNyFeyKw6RLfg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Azure SQL数据库数据集属性的屏幕截图。选中“编辑”复选框，将“表名”字段展开为单独的“模式”和“表名”字段，以允许添加动态内容。</p></figure><p id="8e5b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们为这个数据集定义参数。我们需要的唯一参数是“模式名”和“表名”。我没有定义任何缺省值，因为这些参数经常在用例之间变化。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/66330f67c289642546a508938ffe77ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NYh5fid-Fvi_VTWGasurww.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">架构和表名的Azure SQL数据库数据集参数的屏幕截图。通常，不需要缺省值，因为这些参数在用例之间经常变化。</p></figure><p id="13a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们在动态内容中添加对这些参数的引用，这样就完成了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/5fd3c110b2d8aca1f108cf89cd20a2b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Ptn_FRV6jgmydiuXPHmVg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Azure SQL数据库数据集属性的屏幕截图，其中架构和表名称是动态设置的。</p></figure></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h2 id="33c3" class="mo mp iq bd mq mr ms dn mt mu mv dp mw lf mx my mz lj na nb nc ln nd ne nf ng bi translated">3.用法示例</h2><p id="3c84" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">让我们创建一个简单的管道来演示用法。管道包含复制活动，该活动将CSV文件的内容从blob存储复制到SQL数据库。</p><p id="087b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于源代码，我们只需要定义容器和路径参数，因为我的默认参数对这个文件很好。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/1b1d8674b507e2644c90c3ec139ec277.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fmW1R8dTndVhIq6pnJPC7w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">带有源数据集示例设置的屏幕截图。</p></figure><p id="232a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于接收器，我们只需要填充模式和表名字段。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/e202a96e9c7636b3c0ca874958fcb475.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PvbXJLtI0SOD_6Nc9BCNKg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">包含接收器数据集示例设置的屏幕截图。</p></figure><p id="9b2a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们可以调试我们的管道了。该表将被创建到我的数据库中，其结构与我的存储帐户中的CSV文件相同，因为我选择了“自动创建表”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/3947a8bd4ca63053bb8a3a8e1efe8005.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b2Jp1jBY28oE-FaXk_qeXw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">调试运行成功后数据工厂视图的屏幕截图。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/084065bd3c51fa3d6e41ee7a7c44f7fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5HGlMRpWPe30cbw0mSa1QQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">该屏幕截图显示了我的数据库中的简单SELECT *查询，以展示现在已经创建了表并传输了数据。</p></figure></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><p id="3476" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的阅读！如果你学到了新的东西或者喜欢这篇文章，<a class="ae kv" href="https://medium.com/@miiaramo/follow" rel="noopener">在Medium </a>上关注我。我发表关于数据工程和数据科学的文章。你可以从be <a class="ae kv" href="http://miiaramo.github.io" rel="noopener ugc nofollow" target="_blank">网页</a>了解更多关于我的信息。</p><p id="6b4c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用我没有提到的连接器来实现这一点，你会有困难吗？请在评论中告诉我，我会尽力帮助你😊</p></div></div>    
</body>
</html>