<html>
<head>
<title>How to Track the Progress of Parallel Tasks In Python with TQDM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用TQDM跟踪Python中并行任务的进度</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-track-the-progress-of-parallel-tasks-in-python-with-tqdm-6d93339f03fe?source=collection_archive---------4-----------------------#2021-09-05">https://towardsdatascience.com/how-to-track-the-progress-of-parallel-tasks-in-python-with-tqdm-6d93339f03fe?source=collection_archive---------4-----------------------#2021-09-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="25e1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将TQDM与多处理相结合</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b1113fb79e6cd972c5521edf4e22cdfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UO8NrG4YUGxkrC88"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马克-奥利维耶·乔多因在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="fa69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python是一种很棒的编程语言。这是一把用于多个领域的瑞士刀:分析和可视化数据，训练机器学习模型，构建API，抓取网站，DevOps，MLOps，显然还有更多事情。</p><p id="1b7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种语言的多功能性，除了其他的<a class="ae ky" href="https://hackernoon.com/why-is-python-so-slow-e5074b6fe55b" rel="noopener ugc nofollow" target="_blank">东西</a>之外，也是有代价的:<strong class="lb iu">与其他编程语言相比，Python是缓慢的</strong>。</p><blockquote class="lv lw lx"><p id="1fff" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">那么，我应该换一种语言吗？</p></blockquote><p id="ee16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不急。有很多方法可以提高Python的速度。</p><p id="4bbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本帖中，<strong class="lb iu">我们将把多重处理视为其中一种方式。</strong>我们将看到如何在用例中利用它，以及如何使用<strong class="lb iu">稍加修改的TQDM版本来跟踪并行任务的进度。</strong></p><p id="dc13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你知道，<a class="ae ky" href="https://github.com/tqdm/tqdm" rel="noopener ugc nofollow" target="_blank"> TQDM </a>，这个很棒的进度条，你可能以前用过，用来跟踪你的for循环的进度。</p><p id="d2fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天，我们将看到它是如何被用来跟踪并行任务的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/f080459bb3c5becbd6e6cf2a485f55be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/0*j3Ee3InpZVk_dWJX"/></div></figure><p id="e3f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好的，我们来看看。🔍</p><h1 id="394a" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">什么是多重处理？</h1><p id="425f" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">多重处理允许您创建可以并发运行的程序，并利用工作站的多个内核。</p><p id="fda9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当进程启动时，每个进程都有自己的内存。这使得在使用多重处理时很难共享多个对象。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/6e0aef43c265854c26773f433c04ecd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*4htKx4-xpp_MGkhIMK48DQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="ec1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您有CPU密集型操作，如数据处理(标记化、图像增强、过滤等)时，多处理非常有用。).</p><p id="a6c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名数据科学家，您可以使用多处理来加速您的工作负载。</p><h1 id="ab2a" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">p_tqdm:并行任务的进度条</h1><p id="d7b1" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">正如你可能猜到的，“p”代表平行。</p><blockquote class="lv lw lx"><p id="757a" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><code class="fe nb nc nd ne b"><strong class="lb iu">p_tqdm</strong></code>是对<a class="ae ky" href="https://github.com/uqfoundation/pathos/blob/master/pathos/multiprocessing.py" rel="noopener ugc nofollow" target="_blank"> pathos.multiprocessing </a>和<a class="ae ky" href="https://github.com/tqdm/tqdm" rel="noopener ugc nofollow" target="_blank"> tqdm </a>的包装。</p><p id="afa3" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">与Python的默认多处理库不同，pathos提供了一个更加灵活的并行映射，可以应用几乎任何类型的函数——包括lambda函数、嵌套函数和类方法——并且可以轻松处理带有多个参数的函数。tqdm应用于pathos的平行图之上，并显示一个进度条，包括预计完成时间。— <a class="ae ky" href="https://github.com/swansonk14/p_tqdm" rel="noopener ugc nofollow" target="_blank"> Github </a>。</p></blockquote><p id="80f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里没有什么要补充的，让我们看看这个包装器的运行情况。</p><p id="5908" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您有一大串数字要处理。</p><p id="1e90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了简单起见，我们假设这种“繁重的处理”将包括等待5毫秒并向一个数字添加一个常数(当然，您可以在这里想象任何更复杂的方式)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="ea10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们依次运行这个函数，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="5c39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据TQDM，这些任务需要<strong class="lb iu"> 8分42秒(~ 10000x0.05s秒)</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/d246d9e6a68e22b88bae73dcdfdb83c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*UjOY7qIDDSgPPeE-gkuE4A.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者GIF</p></figure><p id="996f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果我们尝试同时运行这些任务，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="7e8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到完成它们所需的时间是<strong class="lb iu">大约42秒，大约等于500 / 12，12是我的笔记本电脑的内核数。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/c9e4eaf26531c77c1f9d1926c981c3e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*rXgYikErk6K-VJGwzQJasQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GIF格式</p></figure><p id="5cb5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">👉如果您想将内核数量设置为较低的值，您可以添加<code class="fe nb nc nd ne b">num_cpus</code> kwarg。这就像打字一样简单:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="5fdf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">👉除了使用p_map，您还可以使用:</p><ul class=""><li id="b09a" class="nj nk it lb b lc ld lf lg li nl lm nm lq nn lu no np nq nr bi translated"><code class="fe nb nc nd ne b">p_imap</code>:做同样的事情，但不是返回一个列表，而是返回一个迭代器</li><li id="520e" class="nj nk it lb b lc ns lf nt li nu lm nv lq nw lu no np nq nr bi translated"><code class="fe nb nc nd ne b">p_umap</code>`:返回一个无序列表(处理速度不是特别快)</li><li id="5c3e" class="nj nk it lb b lc ns lf nt li nu lm nv lq nw lu no np nq nr bi translated"><code class="fe nb nc nd ne b">p_uimap</code>:返回无序元素的迭代器</li></ul><h1 id="cd3d" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">资源</h1><ul class=""><li id="97df" class="nj nk it lb b lc mv lf mw li nx lm ny lq nz lu no np nq nr bi translated"><a class="ae ky" href="https://github.com/swansonk14/p_tqdm" rel="noopener ugc nofollow" target="_blank">https://github.com/swansonk14/p_tqdm</a></li><li id="0fb7" class="nj nk it lb b lc ns lf nt li nu lm nv lq nw lu no np nq nr bi translated"><a class="ae ky" href="https://github.com/tqdm/tqdm" rel="noopener ugc nofollow" target="_blank">https://github.com/tqdm/tqdm</a></li><li id="3359" class="nj nk it lb b lc ns lf nt li nu lm nv lq nw lu no np nq nr bi translated"><a class="ae ky" href="https://medium.com/@rviswa00/multi-processing-in-python-to-speed-up-your-data-science-8a810267b07" rel="noopener">https://medium . com/@ rvi swa 00/multi-processing-in-python-to-speed-your-data-science-8a 810267 b07</a></li><li id="ad81" class="nj nk it lb b lc ns lf nt li nu lm nv lq nw lu no np nq nr bi translated"><a class="ae ky" href="https://timber.io/blog/multiprocessing-vs-multithreading-in-python-what-you-need-to-know/" rel="noopener ugc nofollow" target="_blank">https://timber . io/blog/multi processing-vs-multi threading-in-python-what-you-need-to-know/</a></li><li id="5f32" class="nj nk it lb b lc ns lf nt li nu lm nv lq nw lu no np nq nr bi translated"><a class="ae ky" href="https://hackernoon.com/why-is-python-so-slow-e5074b6fe55b" rel="noopener ugc nofollow" target="_blank">https://hackernoon.com/why-is-python-so-slow-e5074b6fe55b</a></li></ul><h1 id="97d8" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">感谢阅读🙏</h1><p id="53db" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">谢谢你坚持到最后。我希望您发现在您的项目中使用<code class="fe nb nc nd ne b">p_tqdm</code>来并行化工作负载并轻松直观地跟踪它们的进度是有用的。</p><p id="8d7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们演示的例子非常简单，但是您可以想象在许多场景中<code class="fe nb nc nd ne b">p_tqdm</code>会派上用场。作为一名数据科学家，每当我抓取数据或处理数据时，我的脚本通常会花时间运行。能够在并行化这些操作的同时跟踪它们是非常有趣的。</p><p id="b970" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我如何使用<code class="fe nb nc nd ne b">p_tqdm</code>来加速刮擦:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/1a8e800b8896c9394931275238664d04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pQizkzxQO1cH-EKqlJiF7Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者提供的图片——用于抓取的样板代码</p></figure><p id="0ddc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想玩这个库，不要犹豫在<a class="ae ky" href="https://github.com/swansonk14/p_tqdm" rel="noopener ugc nofollow" target="_blank"> Github </a>上查看它的代码。</p><p id="e9d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我就这些了。下次见！👋</p></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><h1 id="5947" class="md me it bd mf mg oi mi mj mk oj mm mn jz ok ka mp kc ol kd mr kf om kg mt mu bi translated">新到中？你可以订阅每月5美元，并解锁无限的文章——<a class="ae ky" href="https://ahmedbesbes.medium.com/membership" rel="noopener">点击这里。</a></h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/1b586e346fcd112818f995351d5f7a91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tSxuHBuYGsSbR82U"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@karsten116?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卡斯滕·怀恩吉尔特</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div></div>    
</body>
</html>