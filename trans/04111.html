<html>
<head>
<title>Why you should not rely on t-SNE, UMAP or TriMAP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么你不应该依赖t-SNE，UMAP或TriMAP</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/why-you-should-not-rely-on-t-sne-umap-or-trimap-f8f5dc333e59?source=collection_archive---------7-----------------------#2021-04-07">https://towardsdatascience.com/why-you-should-not-rely-on-t-sne-umap-or-trimap-f8f5dc333e59?source=collection_archive---------7-----------------------#2021-04-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="ece5" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/making-sense-of-big-data" rel="noopener" target="_blank">理解大数据</a></h2><div class=""/><div class=""><h2 id="7339" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用PaCMAP来提高可解释性和速度</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/3bec25d66dae562e3e06f814214ce6af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W4uYMwhS8j8n3z5WylTdlw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者创作的情节</p></figure><p id="1ff1" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">t-SNE、UMAP和TriMap等降维技术在数据科学领域中无处不在，鉴于它们令人印象深刻的视觉性能(结合易用性)，它们因此可以在给定数据集的任何完整探索性数据分析中找到。然而，这些特定的方法(t-SNE、UMAP和三分图)可能不应该是你降维的首选。在这篇文章中，我将解释为什么，并推荐最近发表的2020年的替代方案，它更容易理解，结果质量更高，运行速度更快，需要的手动调整更少——所有这些都是好东西👍 🍾</p><p id="76fa" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在我们开始之前，我要指出，我本人一直是(现在仍然是)t-SNE、UMAP和TriMAP的忠实用户。可悲的是，这些技术的内部工作的技术细节经常被忽略，尤其是对于经验较少的从业者，这对于视觉结果的解释具有后果。具体来说，了解每个算法在保留<em class="md">全局</em>与<em class="md">局部</em>结构方面的权衡是很重要的。除了解释问题，t-SNE(如在<code class="fe me mf mg mh b">scikit-learn</code>中)等常用的实现可能会慢得令人恼火，导致浪费大量时间来设置算法，潜在地微调它们，最后随着人们不断重启他们的<code class="fe me mf mg mh b">everything_in_here.ipynb</code>笔记本，一遍又一遍地运行它们。最后，也许是最重要的，当我们已经知道最终的标签(例如，对于典型显示的基准，如MNIST，Cifar10等)时，许多算法可以在教程设置中进行调整，以产生超级令人印象深刻的视觉效果。)，但当在现实生活中对未知数据集使用它时，知道如何解释给定的可视化要困难得多，因为我们不一定事先知道关于数据集的全部信息——在这里，默认情况下更经常第一次就“正确”的算法无疑是一种优势。</p><p id="a35f" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在这篇文章中，我们简要回顾了各种降维技术背后的直觉，然后介绍并回顾了一种更新的PaCMAP⁴算法。这种新算法设法改善了全局与局部的权衡，在没有参数调整的情况下表现良好，速度快，易于使用。此外，该算法的超参数非常直观，并且可以用于在关注局部结构和关注全局结构之间平滑过渡。我并不主张放弃诸如PCA、t-SNE、UMAP、三分图等方法，但对于大多数意图和目的，我认为PaCMAP等算法应该是你的首选，尤其是如果你是一个新手或有急事。</p><p id="fb38" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">PS。我与PaCMAP的创建者没有任何关系，但是我强烈建议您去阅读他们的论文，以获得更深入的介绍！</p><h2 id="5f94" class="mi mj it bd mk ml mm dn mn mo mp dp mq lq mr ms mt lu mu mv mw ly mx my mz iz bi translated">降维方法</h2><p id="4b87" class="pw-post-body-paragraph lh li it lj b lk na kd lm ln nb kg lp lq nc ls lt lu nd lw lx ly ne ma mb mc im bi translated">降低高维数据集的维度(例如，如果我们在表格数据集中有超过3列)允许我们潜在地获得对数据集中底层聚类的更多理解，或者获得对数据分布的直觉(例如，用于比较训练和测试数据集)。目标是在数据中保留尽可能多的“结构”/信息，使得在原始高维空间中相距较远的点在低维空间中也相距较远，对于相距较近的点则相反。总的来说，这些算法可以分为两个主要原型；那些旨在保持<em class="md">局部</em>结构(彼此非常相似的观察)和那些旨在保持<em class="md">全局</em>结构(彼此非常不相似的观察)。</p><p id="523e" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">众所周知，用这些算法创建的可视化投影可能会产生误导，例如，反映不存在的聚类或暗示聚类彼此接近，尽管它们并不接近。因此，在解释使用降维算法进行的任何投影时保持非常保守的态度，并对算法本身有所了解是一个好主意。下面简要回顾几个著名算法的直觉。</p><p id="8d03" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj jd"> PCA: </strong>这里数据(潜在相关的)被重构为不相关的主成分，这些主成分包含由方差度量的数量递减的信息。使用这种方法仅可视化第一个初始组件(描述大部分方差)本质上是一种主要捕获数据的<em class="md">全局</em>结构的方法。</p><p id="6f1b" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj jd"> t-SNE: </strong>这里使用梯度下降来寻找低维嵌入，其中点<em class="md"> i </em>和<em class="md"> j </em>之间的相对距离与原始高维空间中的相对距离相匹配，在不太直观的<em class="md">困惑度</em>参数的控制下，该参数确定用于高维空间中相对距离计算的条件分布的标准偏差。该方法主要关注<em class="md">局部</em>结构，因为它在相对距离计算中关注最近的邻居。</p><p id="2645" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj jd"> UMAP: </strong>这里构建一个最近邻的加权图，顶点是观测值/数据点，然后使用随机梯度下降优化一个低维图，使其在结构上尽可能与高维图相似。与t-SNE相比，UMAP有很多优势，因为它更好地保留了全局结构，速度更快，并且具有稍微更多的可解释超参数，但其核心是在图形的构造中使用最近邻居之间的距离，因此专注于<em class="md">局部</em>结构。</p><p id="03bb" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj jd">三重图</strong>:这里三元组(三个观察值的集合)主要是从最近的邻居创建的，但是一部分三元组也包含一个或两个随机采样点。然后，该算法尝试使用批量梯度下降来寻找较低维度的嵌入，这保持了三元组的距离排序。从理论上讲，这种方法设法同时包含了<em class="md">局部</em>和<em class="md">全局</em>结构，但在实践中，通常会发现它容易与局部结构发生冲突。</p><h2 id="f76f" class="mi mj it bd mk ml mm dn mn mo mp dp mq lq mr ms mt lu mu mv mw ly mx my mz iz bi translated">PaCMAP简介</h2><p id="3c72" class="pw-post-body-paragraph lh li it lj b lk na kd lm ln nb kg lp lq nc ls lt lu nd lw lx ly ne ma mb mc im bi translated">在<a class="ae nf" href="https://arxiv.org/abs/2012.04456" rel="noopener ugc nofollow" target="_blank"> PaCMAP论文</a>中，他们表明t-SNE、UMAP和TriMAP等方法都可以被视为基于图的算法，节点是观察值，边构成这些观察值之间的相似性度量——给定高维图，定义并优化损失函数，以找到结构相似的图的低维表示。基于这种认识，他们首先研究了已知算法的损失函数以及各种虚拟损失函数，并由此能够推导出构成“理想”损失函数的几个关键原则(论文第4节)。其次，他们研究如何优化低维图，以保持局部和全局图结构，再次表明大多数算法是如何<em class="md">近视的</em>(即关注局部结构)。作者提出了一种使用中-近观察值对的方法，以及在收敛期间动态选择哪些图形元素被优化，使得算法最初获得正确的全局结构，随后细化局部结构(论文的第5部分)。</p><p id="a5ed" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">选择更好的损失函数和建议的图优化技术的结合构成了新方法<em class="md"> PaCMAP </em>，作者表明该方法在局部和全局结构上都具有良好的性能。此外，它们表明，所建议的算法对初始化相当鲁棒，并且通过使用默认超参数在所选数据集上工作良好，同时在所有11个测试数据集上明显快于最快的其他算法。</p><h2 id="78a8" class="mi mj it bd mk ml mm dn mn mo mp dp mq lq mr ms mt lu mu mv mw ly mx my mz iz bi translated">比较结果</h2><p id="f321" class="pw-post-body-paragraph lh li it lj b lk na kd lm ln nb kg lp lq nc ls lt lu nd lw lx ly ne ma mb mc im bi translated">让我们重新运行论文中的一些实验，比较几种算法的结果。运行PaCMAP就像运行任何其他降维算法一样简单——在我自己的比较中，我测试了以下PyPi包中的算法:来自<code class="fe me mf mg mh b">scikit-learn==0.24.1</code>的t-SNE、<code class="fe me mf mg mh b">umap-learn==0.5.1</code>的UMAP、<code class="fe me mf mg mh b">trimap==1.0.15</code>的TriMAP和<code class="fe me mf mg mh b">pacmap==0.3</code>的PaCMAP。为了创建我的嵌入，我使用了下面的小代码片段——这里的要点是我使用了所有的默认设置，没有调整。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="3fa7" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在论文中，他们有一个很好的可视化效果，他们使用不同的技术将一只猛犸象的3D图像还原到2D。尝试重新创建，我得到了以下所有默认超级参数的结果:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ni"><img src="../Images/2c6ec97c29075f6c01fda07ff1d25050.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ylEO74opUB8WGziDe2fzJA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者创作的情节</p></figure><p id="c282" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">很明显，t-SNE，至少在默认参数下，主要关注局部结构，UMAP更好地捕捉了全局结构，TriMAP在全局结构方面做得很好，但在局部结构方面失败了(参见feet &amp; horns)，而PaCMAP似乎捕捉了全局和局部结构。与此同时，PaCMAP仅用时8.4秒，比TriMAP的12.56秒、UMAP的24秒和t-SNE的69秒都要快。</p><p id="58b5" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我对算法进行了更多的压力测试，对经典的MNIST数据集(60，000张训练图像，784个像素列)进行了相同的测试。结果如下，同样使用所有默认超级参数:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nj"><img src="../Images/7f05c9d2b5fb12d00cfd7d5ddd533203.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UUIqLpPC06m9pUMjWT-U6w.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者创作的情节，颜色表示MNIST不同的数字图像</p></figure><p id="34db" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在这里，我们看到t-SNE将聚类均匀地分布在中心周围，这可能有助于保持局部结构，但似乎不包含太多关于全局结构的信息——此外，我们看到该算法实际上似乎也识别出一些错误的聚类(红色、棕色和紫色的聚类，我们只“知道”，因为我们有这些标签)。同样，这些结果与PaCMAP论文中看到的一致，表明t-SNE和UMAP主要关注本地结构，TriMAP关注全球结构，而PaCMAP同时关注两者。</p><p id="f3a1" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这两个例子与PaCMAP论文中显示的内容非常吻合——我鼓励每个人都去阅读这篇论文，看看更多的例子、量化和解释。</p><h2 id="4752" class="mi mj it bd mk ml mm dn mn mo mp dp mq lq mr ms mt lu mu mv mw ly mx my mz iz bi translated">结论</h2><p id="5a04" class="pw-post-body-paragraph lh li it lj b lk na kd lm ln nb kg lp lq nc ls lt lu nd lw lx ly ne ma mb mc im bi translated">如前所述，我并不主张放弃PCA，t-SNE，UMAP，TriMAP等。然而，时间往往是至关重要的，因此我认为PaCMAP提供了两个相当大的好处；1)默认情况下，局部和全局结构都被捕获，如果需要，可以很容易地使用超级参数在局部和全局结构之间改变焦点，2)速度更快。在降维不是分析的核心部分，并且您没有时间彻底调查大量超参数、算法等的情况下，这些好处尤其重要。</p><p id="c3af" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">一个完整的分析应该包括多种算法和超参数，同时确保可以根据对特定算法的了解来解释每个实验之间的差异。</p><p id="7b0e" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">最后，感谢PaCMAP论文的作者。</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><p id="f854" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">[1]劳伦斯·范德·马腾和杰弗里·辛顿，使用t-SNE可视化数据(2008)，机器学习研究杂志9，2579–2605</p><p id="fe2e" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">[2]利兰·麦金尼斯，约翰·希利，詹姆斯·梅尔维尔，UMAP:一致流形逼近与降维投影(2018)，<a class="ae nf" href="https://arxiv.org/abs/1802.03426" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/abs/1802.03426</a></p><p id="8e4a" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">[3] Ehsan Amid，Manfred K. Warmuth，TriMap:使用三元组进行大规模降维(2019)，【https://arxiv.org/abs/1910.00204 T2】</p><p id="274a" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">[4]王英凡，，辛西娅·鲁丁，亚龙·沙波什尼克，理解降维工具如何工作:解读t-SNE、UMAP、TriMAP和PaCMAP用于数据可视化的实证方法(2020)，<a class="ae nf" href="https://arxiv.org/abs/2012.04456" rel="noopener ugc nofollow" target="_blank">，</a></p></div></div>    
</body>
</html>