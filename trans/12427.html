<html>
<head>
<title>The Nice Way To Deploy An ML Model Using Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Docker 部署 ML 模型的好方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-nice-way-to-deploy-an-ml-model-using-docker-91995f072fe8?source=collection_archive---------3-----------------------#2021-12-19">https://towardsdatascience.com/the-nice-way-to-deploy-an-ml-model-using-docker-91995f072fe8?source=collection_archive---------3-----------------------#2021-12-19</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="45a5" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">使用 FastAPI 部署 ML 模型并在 VSCode 中轻松封装它的快速指南。</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/3c5d174c93857df6655befc7deacfade.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QAokhXB8T_VzaqDK"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kz" href="https://unsplash.com/@heftiba?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Toa Heftiba </a>拍摄的照片</p></figure><p id="f44c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当由团队中的不同开发人员构建和运行 ML 项目时，存在与 ML 项目相关的挑战。有时，依赖项可能会不匹配，给同一个项目中的其他依赖库带来麻烦。此外，如果你提供一个必须以特定方式执行的项目，你还需要有一个清晰的每一步的文档。</p><p id="30cf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">通过使用 Docker，所有这些都可以变得更加容易和快捷。有了容器化，你可以节省很多时间，<em class="lw">和</em>有助于从长远来看平滑你的应用程序的部署过程。</p><blockquote class="lx ly lz"><p id="bcef" class="la lb lw lc b ld le jv lf lg lh jy li ma lk ll lm mb lo lp lq mc ls lt lu lv in bi translated">如果您正在寻找一个包含为您的项目手动构建和运行 docker 映像的完整步骤的指南，您可以在本文中找到它:</p></blockquote><div class="md me gq gs mf mg"><a href="https://pub.towardsai.net/how-to-dockerize-your-data-science-project-a-quick-guide-b6fa2d6a8ba1" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab fp"><div class="mi ab mj cl cj mk"><h2 class="bd iv gz z fq ml fs ft mm fv fx it bi translated">如何对您的数据科学项目进行分类——快速指南</h2><div class="mn l"><h3 class="bd b gz z fq ml fs ft mm fv fx dk translated">我是如何一直用这些简单易行的步骤做到的！</h3></div><div class="mo l"><p class="bd b dl z fq ml fs ft mm fv fx dk translated">pub.towardsai.net</p></div></div><div class="mp l"><div class="mq l mr ms mt mp mu kt mg"/></div></div></a></div><p id="4275" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然而，在本教程中，我将介绍一个更简单的过程来简化 Docker 开发，这个过程完全可以在 VSCode 本身的帮助下完成。</p><p id="9ac2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们回顾一下构建模型的每一步，然后是 API，最后是 dockerizing。👇</p><h1 id="0e6c" class="mv mw iu bd mx my mz na nb nc nd ne nf ka ng kb nh kd ni ke nj kg nk kh nl nm bi translated">构建我们的 ML 模型</h1><p id="4394" class="pw-post-body-paragraph la lb iu lc b ld nn jv lf lg no jy li lj np ll lm ln nq lp lq lr nr lt lu lv in bi translated">我们将使用 Spacy 来构建一个简单的情感分类器，它为传递给它的任何一段文本输出两个结果:</p><p id="2c3a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">极性</strong> —它是一个位于[-1，1]范围内的浮点数，其中 1 表示完全肯定的陈述，而-1 表示完全否定的陈述。</p><p id="a9d1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">主观性</strong>—<em class="lw">主观</em>句一般指个人观点、情感或判断，而<em class="lw">客观</em>则指事实信息。它<strong class="lc iv"> </strong>是一个位于[0，1]范围内的浮点数。</p><p id="7fcb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，让我们安装一些包来开始我们的开发:</p><pre class="kk kl km kn gu ns nt nu nv aw nw bi"><span id="d39c" class="nx mw iu nt b gz ny nz l oa ob">pipenv shell # make a new virtual environment</span><span id="010f" class="nx mw iu nt b gz oc nz l oa ob">pipenv install pydantic fastapi uvicorn spacy spacytextblob # the packages to install</span></pre><p id="6f23" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，将<strong class="lc iv"> cd </strong>放到项目中，并制作一个名为“model.py”的新文件。</p><p id="4417" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们填写该文件的代码:</p><pre class="kk kl km kn gu ns nt nu nv aw nw bi"><span id="62dd" class="nx mw iu nt b gz ny nz l oa ob">import spacy</span><span id="9299" class="nx mw iu nt b gz oc nz l oa ob">from spacytextblob.spacytextblob import SpacyTextBlob</span><span id="fdb0" class="nx mw iu nt b gz oc nz l oa ob">from pydantic import BaseModel</span><span id="9f1b" class="nx mw iu nt b gz oc nz l oa ob"><br/>class SentimentQueryModel(BaseModel): <br/>    text : str</span><span id="9cdc" class="nx mw iu nt b gz oc nz l oa ob">class SentimentModel:<br/>    def get_sentiment(self, text):</span><span id="438a" class="nx mw iu nt b gz oc nz l oa ob">        nlp = spacy.load('en_core_web_sm')</span><span id="2c7e" class="nx mw iu nt b gz oc nz l oa ob">        nlp.add_pipe("spacytextblob")</span><span id="1a26" class="nx mw iu nt b gz oc nz l oa ob">        doc = nlp(text)</span><span id="05c1" class="nx mw iu nt b gz oc nz l oa ob">        polarity = doc._.polarity</span><span id="8aea" class="nx mw iu nt b gz oc nz l oa ob">        subjectivity = doc._.subjectivity</span><span id="a3c6" class="nx mw iu nt b gz oc nz l oa ob">        return polarity, subjectivity</span></pre><p id="c3b0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们使用<strong class="lc iv">sentitenquerymodel</strong>来包含我们对这个模型的唯一查询——我们将为其预测情感的文本，以及<strong class="lc iv">sentitenmodel</strong>作为加载 spacy tokeniser 和 spacytextblob 库并为我们的给定文本执行情感预测的类。</p><p id="bf8a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们现在将进入下一步，构建我们的 API。</p><h1 id="e1c9" class="mv mw iu bd mx my mz na nb nc nd ne nf ka ng kb nh kd ni ke nj kg nk kh nl nm bi translated">制作 API</h1><p id="4e74" class="pw-post-body-paragraph la lb iu lc b ld nn jv lf lg no jy li lj np ll lm ln nq lp lq lr nr lt lu lv in bi translated">FastAPI 是一种更新、更好的方法，可以将您的机器学习模型部署为 REST API，以便在您的 web 应用程序中使用。</p><p id="2d03" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们在一个名为“main.py”的新文件中使用我们的“model.py ”,并用它构建一个 REST API:</p><pre class="kk kl km kn gu ns nt nu nv aw nw bi"><span id="1e1d" class="nx mw iu nt b gz ny nz l oa ob">import uvicorn</span><span id="0d5b" class="nx mw iu nt b gz oc nz l oa ob">from fastapi import FastAPI</span><span id="d1e0" class="nx mw iu nt b gz oc nz l oa ob">from model import SentimentModel, SentimentQueryModel</span><span id="40fd" class="nx mw iu nt b gz oc nz l oa ob">app = FastAPI()</span><span id="b1f9" class="nx mw iu nt b gz oc nz l oa ob">model = SentimentModel()<br/></span><span id="418a" class="nx mw iu nt b gz oc nz l oa ob">@app.post('/predict')</span><span id="4fca" class="nx mw iu nt b gz oc nz l oa ob">    def predict(data: SentimentQueryModel):</span><span id="5fab" class="nx mw iu nt b gz oc nz l oa ob">        data = data.dict()</span><span id="2128" class="nx mw iu nt b gz oc nz l oa ob">        polarity, subjectivity = model.get_sentiment(data['text'])</span><span id="2c0c" class="nx mw iu nt b gz oc nz l oa ob">        return { 'polarity': polarity,</span><span id="3d64" class="nx mw iu nt b gz oc nz l oa ob">                  'subjectivity': subjectivity</span><span id="837c" class="nx mw iu nt b gz oc nz l oa ob">        }</span><span id="178e" class="nx mw iu nt b gz oc nz l oa ob">if __name__ == '__main__':<br/>    uvicorn.run(app, host='0.0.0.0', port=8000)</span></pre><p id="5e9b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这个 API 现在将在本地主机端口 8000 上运行，我们将通过在终端中运行来验证这一点:</p><pre class="kk kl km kn gu ns nt nu nv aw nw bi"><span id="e19f" class="nx mw iu nt b gz ny nz l oa ob">python main.py</span></pre><p id="b4b4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您将看到输出:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj od"><img src="../Images/4b48641f2de3b62b92be53f35c1cad2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C3AfqLa6BJjGESNwWkbapQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">按作者排序的图像—运行 FastAPI 的终端输出</p></figure><p id="817a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您导航到<strong class="lc iv"> localhost:8000/docs </strong>，您将能够在浏览器本身中查看和测试 API！这不是很棒吗？</p><p id="bf25" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是现在我们有了模型和 API，我们终于可以继续用它来制作 Docker 容器了！</p><h1 id="69d9" class="mv mw iu bd mx my mz na nb nc nd ne nf ka ng kb nh kd ni ke nj kg nk kh nl nm bi translated">用码头工人集装箱化</h1><p id="88aa" class="pw-post-body-paragraph la lb iu lc b ld nn jv lf lg no jy li lj np ll lm ln nq lp lq lr nr lt lu lv in bi translated">确保您的 VSCode 中安装了 Docker by Microsoft 扩展。接下来，在你的机器上启动 Docker Desktop。</p><p id="d95b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，进入 VSCode，输入:Command + Shift + P，调出命令面板。输入“添加 Docker 文件”,你将得到一个选项来添加 Docker 文件到你的项目中。这一流程大大简化了我们的整个工作流程。</p><p id="403a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">按照说明操作，保持端口号为<strong class="lc iv"> 8080 </strong>。不要忘记端口 8000 是用于我们的 API 本身，所以我们需要一个不同的 Docker 来运行！</p><p id="64dc" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，只需右键单击侧边栏中的 Dockerfile 并选择“构建图像”。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oe"><img src="../Images/fa8a26bf04dc708d74e79002c71359d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FlZozMeMvMx-hc7VsiRCeQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">按作者分类的图像——构建 docker 图像</p></figure><p id="9126" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在构建映像时，您将开始在终端中看到输出。</p><p id="3b5e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">接下来，您可以切换到 VSCode 侧栏上的 Docker 选项卡。</p><p id="3a9a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这里，您将看到系统中已有的图像列表。我们刚刚构建的新图像也将在这里显示如下:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj of"><img src="../Images/9424c51797d478bd5e57caa9ea804cea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*tHP3zHp7_R1y-MpPkWaybQ.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">按作者分类的图像—展示构建的 docker 图像</p></figure><p id="7c97" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在你只需要右击图像名称下的“<strong class="lc iv">最新</strong>，选择<strong class="lc iv">运行</strong>选项。</p><p id="1f00" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可以通过右键单击构建的容器并单击“查看日志”选项来查看启动日志。</p><p id="eee8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，当您导航到<strong class="lc iv"> localhost:8000/docs </strong>时，您将看到以下屏幕:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj og"><img src="../Images/31808ebcbc0edeb6c641e5827f69194c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2LOxl1RzGEJy-WN_aIw4CQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">按作者排序的图片— API docs +在浏览器中执行！</p></figure><p id="b41c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您只需单击“Execute ”,这将产生如下输出:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oh"><img src="../Images/ba70984c5c98ace3d4097dfee543d096.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Bx175Iq0n3bsx4S08UjBg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">按作者分类的图像— API 输出响应</p></figure><h1 id="4d19" class="mv mw iu bd mx my mz na nb nc nd ne nf ka ng kb nh kd ni ke nj kg nk kh nl nm bi translated">几句临别赠言…</h1><p id="c50e" class="pw-post-body-paragraph la lb iu lc b ld nn jv lf lg no jy li lj np ll lm ln nq lp lq lr nr lt lu lv in bi translated">所以，现在你有了它——从 ML 模型制作一个 API 并使用 Docker 将其容器化的完整管道！</p><p id="206d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">正如您现在可能已经理解的那样，VSCode 使得任何对 Docker 了解不多的人都可以非常容易地在一个容器中快速启动他们的项目。我希望这篇初学者教程有助于您熟悉使用 Docker 部署 ML 模型。</p><blockquote class="lx ly lz"><p id="ce93" class="la lb lw lc b ld le jv lf lg lh jy li ma lk ll lm mb lo lp lq mc ls lt lu lv in bi translated">也请查看<a class="ae kz" href="https://neptune.ai/blog/model-deployment-mistakes" rel="noopener ugc nofollow" target="_blank">这篇关于在模型部署过程中要避免的常见错误的文章</a>！</p></blockquote><p id="ed32" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">将来，<a class="ae kz" href="https://ipom.medium.com" rel="noopener">我会回来</a>制作一些更复杂的模型，并用 Docker 将它们打包。所以<a class="ae kz" href="https://ipom.medium.com" rel="noopener">跟我来</a>留在圈子里！</p><h2 id="4364" class="nx mw iu bd mx oi oj dn nb ok ol dp nf lj om on nh ln oo op nj lr oq or nl os bi translated"><a class="ae kz" href="https://ipom.medium.com/membership/" rel="noopener"> <strong class="ak"> <em class="ot">成为一名中等会员，从不错过我每周发表的任何一篇数据科学文章。</em> </strong> </a> <strong class="ak"> <em class="ot">在此加入👇</em>T9】</strong></h2><div class="md me gq gs mf mg"><a href="https://ipom.medium.com/membership/" rel="noopener follow" target="_blank"><div class="mh ab fp"><div class="mi ab mj cl cj mk"><h2 class="bd iv gz z fq ml fs ft mm fv fx it bi translated">通过我的推荐链接加入 Medium</h2><div class="mn l"><h3 class="bd b gz z fq ml fs ft mm fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="mo l"><p class="bd b dl z fq ml fs ft mm fv fx dk translated">ipom.medium.com</p></div></div><div class="mp l"><div class="ou l mr ms mt mp mu kt mg"/></div></div></a></div></div><div class="ab cl ov ow hy ox" role="separator"><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa"/></div><div class="in io ip iq ir"><h1 id="ea80" class="mv mw iu bd mx my pc na nb nc pd ne nf ka pe kb nh kd pf ke nj kg pg kh nl nm bi translated">和我联系吧！</h1><blockquote class="lx ly lz"><p id="bcd9" class="la lb lw lc b ld le jv lf lg lh jy li ma lk ll lm mb lo lp lq mc ls lt lu lv in bi translated">在推特上关注我。<br/>订阅我的<a class="ae kz" href="https://yashprakash.substack.com" rel="noopener ugc nofollow" target="_blank">数据科学刊物</a>。<br/> <a class="ae kz" href="https://github.com/yashprakash13/data-another-day" rel="noopener ugc nofollow" target="_blank">查看我所有数据科学文章的完整代码库！</a></p></blockquote><p id="ad78" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我的另外几篇文章你可能会感兴趣:</p><div class="md me gq gs mf mg"><a rel="noopener follow" target="_blank" href="/heres-how-to-use-jupyter-notebooks-on-steroids-with-deepnote-c35251222358"><div class="mh ab fp"><div class="mi ab mj cl cj mk"><h2 class="bd iv gz z fq ml fs ft mm fv fx it bi translated">以下是如何在 Deepnote 上使用 Jupyter 笔记本的方法</h2><div class="mn l"><h3 class="bd b gz z fq ml fs ft mm fv fx dk translated">在本教程中，了解 Google Colab 的完美替代方案！</h3></div><div class="mo l"><p class="bd b dl z fq ml fs ft mm fv fx dk translated">towardsdatascience.com</p></div></div><div class="mp l"><div class="ph l mr ms mt mp mu kt mg"/></div></div></a></div><div class="md me gq gs mf mg"><a rel="noopener follow" target="_blank" href="/the-nice-way-to-manage-your-data-science-workflow-7fb92a2ee4a2"><div class="mh ab fp"><div class="mi ab mj cl cj mk"><h2 class="bd iv gz z fq ml fs ft mm fv fx it bi translated">管理数据科学工作流的好方法</h2><div class="mn l"><h3 class="bd b gz z fq ml fs ft mm fv fx dk translated">在初学者示例中学习使用 Prefect 构建 ETL 管道</h3></div><div class="mo l"><p class="bd b dl z fq ml fs ft mm fv fx dk translated">towardsdatascience.com</p></div></div><div class="mp l"><div class="pi l mr ms mt mp mu kt mg"/></div></div></a></div></div></div>    
</body>
</html>