<html>
<head>
<title>A Practical Guide to MLOps in AWS Sagemaker — Part I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS Sagemaker中的MLOps实用指南—第一部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-practical-guide-to-mlops-in-aws-sagemaker-part-i-1d28003f565?source=collection_archive---------3-----------------------#2021-06-03">https://towardsdatascience.com/a-practical-guide-to-mlops-in-aws-sagemaker-part-i-1d28003f565?source=collection_archive---------3-----------------------#2021-06-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d782" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何在AWS Sagemaker中实现CI/CD模型开发和评估管道？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/fe6f5d19e8a7c204c50465b15cc66eb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mVWgg26LqhTPk29M.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">梵高，文森特。<em class="kv">星夜</em>。(<a class="ae kw" href="https://www.vangoghgallery.com/painting/starry-night.html" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="ec30" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这个指南是我自己在AWS上寻找一个完整的端到端的模型开发、评估和部署工作的挫折的结果。我在那里看到的所有指南和教程都只覆盖了一部分，而没有完全联系起来。我想写一些东西，帮助人们了解构建模型和部署模型的完整工作，以便前端开发人员可以在他们的网站和应用程序上访问它。</p><p id="7cab" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">所以，让我们开始吧！</p><p id="9387" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我将本指南分为两部分。</p><p id="c09b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">1.使用AWS Sagemaker Studio进行模型开发和评估。</p><p id="d355" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">2.使用AWS Lambda和REST API的模型部署</p><p id="ff39" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">先决条件:</strong></p><p id="0a39" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"> AWS账户——运行整个教程的费用不到0.50美元，所以不要担心。</strong></p><p id="4863" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">对Python的理解——如今大部分机器学习工作都是用Python完成的。</strong></p><p id="8035" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">耐心——失败是成功最重要的先决条件，所以继续尝试，直到成功。</p><h1 id="e673" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">第1部分:模型开发</h1><p id="da72" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">我们将在Sagemaker Studio中建立一个项目来构建我们的开发管道。</p><p id="8751" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">1.登录您的<strong class="kz ir"> AWS账户</strong>，从服务列表中选择<strong class="kz ir"> Sagemaker </strong>。</p><p id="603c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">2.选择<strong class="kz ir"> Sagemaker工作室</strong>并使用<strong class="kz ir">快速启动</strong>创建工作室。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/20898421345421e32c65ee8a77139653.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-VKtUNtqnkfz1ivM6RSAoQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用快速启动选项设置sagemaker studio。(图片由作者提供)</p></figure><p id="0af3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">一旦工作室准备就绪，用你刚刚创建的用户打开工作室。创建应用程序可能需要几分钟的时间，但是一旦一切就绪，我们就可以创建项目了。需要理解的是，我们只能创建一个工作室，但是该工作室中有多个用户，并且每个用户都可以在该工作室中创建多个项目。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/3ae6c83fd82c55c8c8c1628bbc5d2301.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L0AKk6RaQfFsfjixOeBV1Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Sagemaker控制面板。(图片由作者提供)</p></figure><p id="c09c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">3.从左侧导航栏中选择<strong class="kz ir"> Sagemaker组件和注册表</strong>，并选择<strong class="kz ir">创建项目。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/4b472c109fa3feef131b63588a956a29.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/format:webp/1*MpZGr6vJqQj0WUwUpG3ZMQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建项目选项。(图片由作者提供)</p></figure><p id="e05a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">默认情况下，Sagemaker提供了可用于构建、评估主机模型的模板。我们将使用一个这样的模板，并修改它以适应我们的用例。</p><p id="d6b5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">4.从列表中选择<strong class="kz ir">用于模型开发、评估和部署的MLOps模板</strong>并创建一个项目。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/5f973822db56714b5e90d3f548a69319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HzPUzgT18BiMB7tFdxA4hw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Sagemaker项目模板。(图片由作者提供)</p></figure><p id="973f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">一旦您的新项目被创建，您将发现2个预构建的存储库。第一个定义您的模型开发和评估，另一个将您的模型构建到一个包中，并将其部署到一个端点以供API使用。在本指南中，我们将修改第一个模板来运行我们自己的用例。</p><p id="8c34" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">5.克隆第一个存储库，这样我们就可以修改我们需要的文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mu"><img src="../Images/ba0ca558e9c0500f03be161ad3897d1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DKEKgYwtpTFbaF3hqoXO7Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">项目存储库。(图片由作者提供)</p></figure><p id="84d3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们将要处理的用例是一个客户流失模型，用于预测客户将来是否会退订服务。由于本笔记本背后的想法是学习云中的模型开发和部署，所以我不会深入研究数据，而是直接进入管道开发。</p><p id="cdd3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这是我们刚刚克隆的存储库的文件结构，现在让我们看一下将要使用的一些文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/79809ab98f4c8aef2b5bf195e6a696b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*bsfRWZyEpr06iQR5y-NPkA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">存储库文件结构。(图片由作者提供)</p></figure><p id="c419" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">文件夹<strong class="kz ir"> pipelines </strong>包含创建我们的模型开发管道所需的文件，默认情况下，该管道被命名为<strong class="kz ir">鲍鱼。</strong></p><p id="e189" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir"> pipeline.py </strong>定义了我们管道的组件，目前，它是用默认值定义的，但是我们将为我们的用例更改代码。</p><p id="ebf9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">preprocess.py和evaluate.py 定义了我们需要在管道中为预处理和评估步骤执行的代码。</p><p id="3712" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">codebuild-buildspec-yml 创建并编排管道。</p><p id="3e23" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">您可以将更多步骤添加到<strong class="kz ir"> pipeline.py </strong>和相应的处理文件中，模板还定义了一个<strong class="kz ir"> test </strong>文件夹和一个<strong class="kz ir"> test_pipelines.py </strong>文件，该文件可用于构建单独的测试管道。</p><p id="96dc" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">6.将文件夹<strong class="kz ir">鲍鱼</strong>重命名为<strong class="kz ir">客户流失</strong>在<strong class="kz ir">code build-build spec-yml</strong>文件中进行更改以反映这一更改。</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="ad76" class="nb lu iq mx b gy nc nd l ne nf"><strong class="mx ir">run-pipeline --module-name pipelines.customer_churn.pipeline \</strong></span></pre><p id="adf5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">7.我们需要将数据下载到我们默认的AWS s3存储桶中以供使用，我们可以使用笔记本来完成这项工作。从studio中的文件选项卡在存储库中创建一个新的笔记本，选择一个带有基本数据科学python包的内核，然后将下面的代码粘贴到单元格中并运行。</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="c391" class="nb lu iq mx b gy nc nd l ne nf"><strong class="mx ir">!aws s3 cp s3://sagemaker-sample-files/datasets/tabular/synthetic/churn.txt ./<br/>import os<br/>import boto3<br/>import sagemaker<br/>prefix = 'sagemaker/DEMO-xgboost-churn'<br/>region = boto3.Session().region_name<br/>default_bucket = sagemaker.session.Session().default_bucket()<br/>role = sagemaker.get_execution_role()<br/>RawData = boto3.Session().resource('s3')\<br/>.Bucket(default_bucket).Object(os.path.join(prefix, 'data/RawData.csv'))\<br/>.upload_file('./churn.txt')<br/>print(os.path.join("s3://",default_bucket, prefix, 'data/RawData.csv'))</strong></span></pre><p id="5a42" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">现在我们需要修改<strong class="kz ir"> pipeline.py、evaluate.py和preprocess.py </strong>中的代码来满足我们的需求。</p><p id="e6f0" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">8.出于指南的目的，从<a class="ae kw" href="https://github.com/akash-agni/Sagemaker_Notebooks" rel="noopener ugc nofollow" target="_blank">链接</a>中复制代码以更新<strong class="kz ir"> pipeline.py、preprocess.py和evaluate.py </strong>中的代码，但确保仔细阅读代码以更好地理解细节。</p><p id="6975" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">一切就绪，一旦我们更新了这3个文件中的代码，我们就准备好运行我们的第一个管道执行，但是当我们尝试实现CI/CD模板时，这将在我们提交和推送代码后自动完成。</p><p id="a97a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">9.从侧面导航栏中选择<strong class="kz ir"> GIT </strong>选项卡，然后选择您已经修改的文件以添加到暂存区，并将更改提交和推送至远程存储库。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/1cc8fa7711937f284ccbcf0a322304b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*UTOLtU3S3dEREAdaf_HBsg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">提交更改并将代码推送到远程。(图片由作者提供)</p></figure><p id="2b70" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">现在转到项目页面上的<strong class="kz ir">pipeline</strong>选项卡，选择您创建的管道以检查运行的执行情况，您应该会发现一个<strong class="kz ir">成功的</strong>作业在我们克隆库时自动执行，另一个作业将处于<strong class="kz ir">执行</strong>状态，您刚刚通过推送代码执行了该作业，现在双击该作业以查看管道图和更多详细信息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/99d1563404851a20601d10b817d889cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U4kQuorF8z5tSbccSgq4nw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">管道的“执行”选项卡。(图片由作者提供)</p></figure><p id="3642" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">万岁！！恭喜你刚刚完成了你的第一份培训工作。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/48d5e7ee63390657d8ae8326b533aaca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YCpZy40dsHA-FLncyj1Bhw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">管道图。(图片由作者提供)</p></figure><p id="55e0" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">除非出了差错，你应该看到你的工作<strong class="kz ir">成功了，</strong>但是记住如果它很容易，任何人都会做。失败是走向成功的第一步。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/627223b1d9367a2a0f0702d3f73d431f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LUxO5e2y0nr9Rqo3cZqSDw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">通往成功的道路是崎岖的。(图片由作者提供)</p></figure><p id="2341" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">管道完成后，它将创建一个模型并将其添加到您的模型组中，因为我们已经在管道中添加了一个“手动”模型批准条件，所以我们需要选择模型并手动批准它，以创建一个可用于推理的端点。</p><p id="3842" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">10.转到项目主页上的<strong class="kz ir">模型组</strong>选项卡，选择已经创建的模型，您可以查看<strong class="kz ir">指标</strong>页面来查看评估阶段的结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/cd96e32af600d0ed29ba6c0d36d5b182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7X8LsGeq5-KyL1ZvjqgNVg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">您的模型的度量。(图片由作者提供)</p></figure><p id="d394" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">11.如果您对指标满意，您可以选择右上角的<strong class="kz ir">批准</strong>选项来批准模型。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/06e4c1d700370efff2dec49d676db6d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*00fAWqKUMNn4xvB0gn4P_w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">模型批准页面。(图片由作者提供)</p></figure><p id="b644" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">当我们的第二个存储库出现时，一旦您批准了在第二个存储库中定义的模型部署管道，它将执行以部署和托管一个新的<strong class="kz ir">端点</strong>，我们可以使用它从我们的API进行推理。</p><h1 id="8bd1" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">结论</h1><p id="a0ef" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">我试图让本指南保持使用Sagemaker的观点，因为它很长，而且还有第2部分要写。这里的目标是通过实现一个简单的项目来快速概述Sagemaker的不同组件。我给读者的建议是，不要一步一步地遵循指南，用你自己的想法和步骤进行实验，你会经常失败，但你会学到很多东西，这就是议程。希望你喜欢阅读这个指南，就像我喜欢把它放在一起一样。欢迎在评论中提出任何建议或反馈，我们很乐意听到它们。</p><p id="5b76" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><a class="ae kw" rel="noopener" target="_blank" href="/a-practical-guide-to-mlops-using-aws-sagemaker-part-ii-c5159b4b51aa"><strong class="kz ir">AWS Sagemaker中的MLOps实用指南—第二部分</strong> </a></p></div></div>    
</body>
</html>