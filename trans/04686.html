<html>
<head>
<title>An RFM Analysis with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python进行RFM分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/an-rfm-customer-segmentation-with-python-cf7be647733d?source=collection_archive---------3-----------------------#2021-04-23">https://towardsdatascience.com/an-rfm-customer-segmentation-with-python-cf7be647733d?source=collection_archive---------3-----------------------#2021-04-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1eac" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">以及如何从it中快速释放洞察力和商业价值</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2fca79474615945988e62ba8f1feffb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1kGbZSGA9fowHRCBipL2Lg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Dilyara Garifullina 在<a class="ae kv" href="https://unsplash.com/s/photos/pie-chart?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="febb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">是时候重温一下我的Python技能了！👩🏻‍💻</p><p id="9bc9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本周，我想走技术路线，分享一个最近使用<a class="ae kv" href="https://en.wikipedia.org/wiki/RFM_(market_research)" rel="noopener ugc nofollow" target="_blank"> RFM框架</a>的Python练习。这是一种通过三个方面来确定客户价值的方法:</p><ul class=""><li id="06d3" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">最近:用户最后一次采取行动(例如登录、下订单)是什么时候？</li><li id="bb58" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">频率:用户采取这个动作多少次？</li><li id="eb78" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">货币价值:这个用户一生的货币价值总和是多少？</li></ul><p id="cfd3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我的工作受到了同一个数据集上许多有用帖子的极大启发，比如<a class="ae kv" rel="noopener" target="_blank" href="/recency-frequency-monetary-model-with-python-and-how-sephora-uses-it-to-optimize-their-google-d6a0707c5f17">这个</a>。在这篇文章中，我想分享我的<a class="ae kv" href="https://www.kaggle.com/yaowenling/rfm-customer-segmentation" rel="noopener ugc nofollow" target="_blank"> RFM细分分析</a>，并重点关注我发现的一些有用的提示，以快速从模型输出中带来商业价值。</p><ul class=""><li id="5c78" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">将绝对最近值、频率值和货币值转换为相对值，以减少与实际客户生命周期相关的偏差。</li><li id="39ac" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">生成简单、启发式的业务逻辑，以快速的方式交付业务价值。</li><li id="b243" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">将这些细分市场与其他数据集结合起来，以更深入地了解您的客户群。</li></ul></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="5f19" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">数据集描述和问题陈述</h1><p id="33e9" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">在我们深入细节之前，我想快速浏览一下我们的数据集是什么样子，以及我们的目标是解决什么问题。</p><p id="a39a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的原始数据是包含以下字段的交易记录表:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="a502" class="np mo iq nl b gy nq nr l ns nt">&lt;class 'pandas.core.frame.DataFrame'&gt;<br/>Int64Index: 406829 entries, 0 to 541908<br/>Data columns (total 8 columns):<br/> #   Column       Non-Null Count   Dtype  <br/>---  ------       --------------   -----  <br/> 0   InvoiceNo    406829 non-null  object <br/> 1   StockCode    406829 non-null  object <br/> 2   Description  406829 non-null  object <br/> 3   Quantity     406829 non-null  int64  <br/> 4   InvoiceDate  406829 non-null  object <br/> 5   UnitPrice    406829 non-null  float64<br/> 6   CustomerID   406829 non-null  float64<br/> 7   Country      406829 non-null  object <br/>dtypes: float64(2), int64(1), object(5)<br/>memory usage: 27.9+ MB</span></pre><p id="33bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通常，我们会在客户层面上汇总数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/5412b2ee966b82aed9e0d31dc21c7fd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w7R8BKrSf7qa8VYiGOt8LA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="fb81" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们希望将RFM框架应用于该聚合数据集，并回答以下问题:</p><ol class=""><li id="8e29" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nv ly lz ma bi translated">新近性、频率和货币价值之间有关联吗？</li><li id="476a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nv ly lz ma bi translated">我们应该如何定义我们最有价值的客户(MVC)？我们的客户中有百分之多少是最有价值的客户？</li><li id="f514" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nv ly lz ma bi translated">我们是否能够创造独特的细分市场并据此设计CRM活动来提高客户参与度和/或盈利能力？</li></ol></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="abc5" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">将绝对值转换为相对值，以减少客户寿命的偏差。</h1><p id="1bcd" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">我在许多教程中注意到的一点是，计算中使用了绝对数字。换句话说，我们有以下内容:</p><ul class=""><li id="4f00" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">最近=最近一次操作和今天之间的时间间隔</li><li id="71f3" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">频率=从用户注册日期到今天的操作次数</li><li id="c169" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">货币价值=用户一生中的总收入</li></ul><p id="713e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这一步之后，一个典型的方法是通过基于每个单独列的四分位数创建存储桶来计算最近/频率/货币得分。例如，在“频率”列上，我们执行以下操作:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="395f" class="np mo iq nl b gy nq nr l ns nt">customer_data["FrequencyScore"] = pd.cut(customer_data["Frequency"], <br/>                                       bins=[-1, <br/>                                         np.percentile(customer_data["Frequency"], 25), <br/>                                             np.percentile(customer_data["Frequency"], 50), <br/>                                             np.percentile(customer_data["Frequency"], 75), <br/>                                             customer_data["Frequency"].max()], <br/>                                       labels=[1, 2, 3, 4]).astype("int")</span></pre><p id="3b14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，对于最近得分，我们需要给出相反的标签，因为客户越活跃，最近值就越低。:)</p><p id="4496" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦我们获得了每个维度的分数，我们就可以通过将这三个分数相加来计算RFM的总分数。总体RFM得分越高(从3到12)，客户越有价值。</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="94a3" class="np mo iq nl b gy nq nr l ns nt">customer_data["RFM"] = customer_data["RecencyScore"] + customer_data["FrequencyScore"] + customer_data["MonetaryScore"]</span></pre><p id="c6e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种方法很容易实现，但它容易与实际的客户生命周期产生偏差。例如，与过去6个月内注册的客户相比，12个月前注册的客户自然具有更低的新近度(假设用户参与度在整个生命周期内普遍下降)、更高的频率和更高的货币价值(假设在用户活动和货币化方面同类)。因此，签约12个月的客户的RFM分数可能被高估了。</p><p id="0324" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了解释这种偏差，在计算个人得分之前，我会先将最近发生的事、发生的频率和货币价值标准化。例如，我会做相对频率=最近/一生。</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="98c8" class="np mo iq nl b gy nq nr l ns nt">customer_data["RelFrequency"] = customer_data["Frequency"] / customer_data["Lifetime"]</span></pre><p id="69b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后我会根据相对频率计算频率得分:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="d90a" class="np mo iq nl b gy nq nr l ns nt">customer_data["FrequencyScore"] = pd.cut(customer_data["RelFrequency"], <br/>                                       bins=[-1, <br/>                                             np.percentile(customer_data["RelFrequency"], 25), <br/>                                             np.percentile(customer_data["RelFrequency"], 50), <br/>                                             np.percentile(customer_data["RelFrequency"], 75), <br/>                                             customer_data["RelFrequency"].max()], <br/>                                       labels=[1, 2, 3, 4]).astype("int")</span></pre><p id="c45f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我的笔记本上，你可以找到使用绝对值的<code class="fe nw nx ny nl b">rfm_abs</code>RFM分割和使用相对值的<code class="fe nw nx ny nl b">rfm_rel</code>。在这里，我只附上在这两种方法下每个RFM细分市场的中值客户生命周期。正如我们所看到的，使用绝对值的RFM细分市场的客户生命周期有较大的差异，而使用相对值的RFM细分市场的客户生命周期相当稳定。更具体地说，对于第一种方法，我们看到那些RFM分数为5和6(因此处于活动的下限)的人具有明显更短的寿命(因此是更近期的客户)。这种方法似乎“惩罚”了最近的客户，因为他们的频率和金额较低。</p><p id="8125" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一方面，<strong class="ky ir">我们的方法设法减少了RFM细分中与客户寿命相关的偏差！</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/16847d9ff78dd977bf378be12809c8b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8vLSPEGE-TNyU-wN3YLZiA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="15f8" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">生成简单、启发式的业务逻辑，以快速的方式交付业务价值。</h1><p id="bb9e" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">到目前为止一切顺利！</p><p id="ada3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">许多教程都以生成RFM分段标签(3–12)结束，包含以下汇总统计数据:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/ce9baf106d1b7f2285f498f8cbee96c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*byc2HydzqvLZdlZM8BTBFQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">RFM分割结果</p></figure><p id="1243" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这张表回答了我们的前两个问题:</p><ol class=""><li id="1cb2" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nv ly lz ma bi translated">在最近、频率和货币价值之间确实存在正相关关系。</li><li id="7682" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nv ly lz ma bi translated">我们的MVC是那些总RFM分数为11和12的人，即他们平均有7次以上的交易，在其一生中产生超过2K的交易，并且他们的最后一次交易是在过去2周内。这类客户约占我们总客户群的16%。</li></ol><p id="fa5b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，在现实生活中，这种输出可能不足以快速创造商业价值。一方面，我们得到的桶彼此差别不大，我们有机会合并一些部分。另一方面，逻辑本身相当复杂-如果我们想要严格遵循逻辑，我们需要将笔记本电脑部署到生产中，这需要大量的工程工作，并且产生大量商业价值的不确定性很高。</p><p id="dfeb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们想快速行动。因此，我想根据上面的RFM分割结果生成一些简单的启发式逻辑，并将它们应用到生产中进行分析和操作。请注意，没有完美的逻辑——这里我只分享一组我认为最有区别的标准。</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="6030" class="np mo iq nl b gy nq nr l ns nt">customer_data["last_order_within_l60d"] = customer_data["Recency"]&lt;60 # Had transactions in the last 60 days</span><span id="b93b" class="np mo iq nl b gy ob nr l ns nt">customer_data["more_than_two_orders"] = customer_data["Frequency"]&gt;2 # Logged in more than twice</span><span id="7634" class="np mo iq nl b gy ob nr l ns nt">customer_data["value_higher_than_2k"] = customer_data["MonetaryValue"]&gt;2000 # Sum of value higher than 2K</span><span id="be34" class="np mo iq nl b gy ob nr l ns nt">customer_data.groupby(["last_order_within_l60d", "more_than_two_orders", "value_higher_than_2k"]).count()["Lifetime"]</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/c22f055fc7cd8ca125b347cd139b29e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*TKzFjUtwPzEZfQsTL43ypQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="7d2d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基于上面的分支，我定义了五个最终段(在括号中，您可以找到段的大小):</p><ol class=""><li id="b12e" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nv ly lz ma bi translated"><strong class="ky ir">高参与度&amp;高价值</strong> (523)是最近2个月有最后一笔交易，成交2笔以上，平均贡献2K以上的人。</li><li id="2139" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nv ly lz ma bi translated"><strong class="ky ir">高参与度&amp;低值</strong> (876)是和Group1一样活跃，但贡献不到2K的人。</li><li id="93f8" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nv ly lz ma bi translated"><strong class="ky ir">近期活动&amp;低频</strong> (811)是指最近2个月内有最后一笔交易但交易不超过2笔的人。这些客户的货币价值也较低。显然，这个群体中的大多数客户是最近获得的客户(他们的平均寿命只有45天)。</li><li id="a678" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nv ly lz ma bi translated"><strong class="ky ir">【老】活动&amp;高频</strong> (523)是最近2个月没有任何交易的人。然而，他们平均有2笔以上的交易。这些客户在旅程开始时非常活跃，但最近不那么活跃了。我们需要想办法让他们重新参与进来。</li><li id="fb27" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nv ly lz ma bi translated"><strong class="ky ir">低参与度&amp;低值</strong> (1426)是最近2个月没有任何交易，交易不超过2笔，贡献收入最低的人。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/c3627598aedba705f94851799c066ce2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GuzwC3MLTgPLGU2pCsVO2w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="df14" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">与其他数据集结合，释放更多洞察力和价值。</h1><p id="8e7a" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">基于我们在上面获得的知识，有许多使用案例。这里我想详细阐述一下我在工作中用过的两个用例。</p><p id="264e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一种方法是将这个客户价值分数作为一个新的维度附加到BI数据集(用户资料、跟踪事件、购买记录等)。结合现有的指标和仪表板，这可以帮助您回答以下问题:</p><ul class=""><li id="efbb" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">我们的MVC的社会经济特征(收入、职业等)和人口统计学特征(年龄、性别、婚姻状况等)是什么？这为我们如何瞄准并获得更多这样的客户提供了启示。</li><li id="d0cd" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">与其他群体相比，我们的MVC有明显不同的用户旅程吗？我们如何优化MVC的旅程体验？</li><li id="fea2" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">与其他集团相比，我们的MVC是否拥有重要的市场份额？这可能会给我们一些启发，以改善对他们的推荐。</li></ul><p id="5660" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一个用例是将此标签发送到CRM工具，并将其用于定制的互动交流。以我上面生成的最终细分为例:对于第2组<strong class="ky ir">高参与度&amp;低价值</strong>和第3组<strong class="ky ir">近期活动&amp;低频率</strong>，我们应该通过个性化推荐关注货币化(例如订单数量、平均订单价值)，而对于第4组<strong class="ky ir">老活动&amp;高频率</strong>，我们应该尝试重新吸引他们，并让他们回到我们的网站/应用程序。结合其他数据集的特征，我们能够设计有针对性的内容和媒体，以接触到个人客户并最大限度地提高转化率。</p><p id="5b9a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样。让我知道你的想法和反馈！</p></div></div>    
</body>
</html>