<html>
<head>
<title>How to build a Dynamic Bar Chart in Observablehq through sqlite3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何通过sqlite3在Observablehq中构建动态条形图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-build-a-dynamic-bar-chart-in-observablehq-through-sqlite3-f8f8b6509ac8?source=collection_archive---------29-----------------------#2021-07-19">https://towardsdatascience.com/how-to-build-a-dynamic-bar-chart-in-observablehq-through-sqlite3-f8f8b6509ac8?source=collection_archive---------29-----------------------#2021-07-19</a></blockquote><div><div class="fc ik il im in io"/><div class="ip iq ir is it"><h2 id="97e4" class="iu iv iw bd b dl ix iy iz ja jb jc dk jd translated" aria-label="kicker paragraph">数据可视化</h2><div class=""/><div class=""><h2 id="03f5" class="pw-subtitle-paragraph kc jf iw bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">一个现成的笔记本，利用了Observablehq提供的最新sqlite3特性</h2></div><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj ku"><img src="../Images/50ef2a767abfb751be0799745f1c3cc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GeiVJehHk3HNHRRq"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">照片由<a class="ae lk" href="https://unsplash.com/@lukechesser?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卢克·切瑟</a>在<a class="ae lk" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="8f65" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">最近，Observablehq团队发布了一个新功能，允许将sqlite3数据库导入笔记本。这个特性非常强大，因为它允许通过经典的SQL语法动态查询数据集。Mike Bostock提供的原始教程可在<a class="ae lk" href="https://observablehq.com/@observablehq/sqlite" rel="noopener ugc nofollow" target="_blank">此链接</a>获得。</p><p id="8fe6" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">在本教程中，我利用新的sqlite3特性构建了一个简单的条形图，它可以根据用户的选择动态更新。</p><p id="bd03" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">作为示例数据集，我使用通用食品数据库，该数据库由data.world提供，可通过链接获得<a class="ae lk" href="https://data.world/alexandra/generic-food-database" rel="noopener ugc nofollow" target="_blank">。下表显示了通用食品数据库的快照:</a></p><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj mh"><img src="../Images/9b57ce237b39b5428d44cf3bdefcb506.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JA_SxAi-E9V_xDcF5Et3KQ.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="bb0a" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">在本教程中，我们将构建一个动态条形图，显示每个子组的项目数，前提是该组。组选择是通过下拉选择完成的。</p><h1 id="cd28" class="mi mj iw bd mk ml mm mn mo mp mq mr ms kl mt km mu ko mv kp mw kr mx ks my mz bi translated">将CSV文件转换为。</h1><p id="18ad" class="pw-post-body-paragraph ll lm iw ln b lo na kg lq lr nb kj lt lu nc lw lx ly nd ma mb mc ne me mf mg ip bi translated">通用食品数据库以CSV文件发布，因此，在下载后，必须将其转换为. db文件。然后，它可以作为文件附件上传到可观察的笔记本中。</p><p id="ac16" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">为了执行到的转换。db，首先我们必须从<a class="ae lk" href="https://www.sqlite.org/download.html" rel="noopener ugc nofollow" target="_blank">其官网</a>下载sqlite3。我们可以解压缩下载的文件夹，并从命令行进入该文件夹。从sqlite3文件夹中，我们可以启动sqlite3命令:</p><pre class="kv kw kx ky gu nf ng nh ni aw nj bi"><span id="0921" class="nk mj iw ng b gz nl nm l nn no">./sqlite3</span></pre><p id="8253" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">现在sqlite3终端打开，我们可以创建一个新的数据库，即<code class="fe np nq nr ng b">food_db</code>:</p><pre class="kv kw kx ky gu nf ng nh ni aw nj bi"><span id="72dc" class="nk mj iw ng b gz nl nm l nn no">.open food_db</span></pre><p id="79f6" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我们可以按如下方式导入通用食物表:</p><pre class="kv kw kx ky gu nf ng nh ni aw nj bi"><span id="d4ea" class="nk mj iw ng b gz nl nm l nn no">.mode csv                                                               .import /path/to/your/file/generic-food.csv food_table</span></pre><p id="5ecd" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">在前面的示例中，我们已经将CSV文件导入到了food_table表中。现在我们可以检查该表是否已被正确导入:</p><pre class="kv kw kx ky gu nf ng nh ni aw nj bi"><span id="5aee" class="nk mj iw ng b gz nl nm l nn no">.schema</span></pre><p id="83cc" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">输出应该如下所示:</p><pre class="kv kw kx ky gu nf ng nh ni aw nj bi"><span id="feac" class="nk mj iw ng b gz nl nm l nn no">CREATE TABLE food_table(<br/>   "FOOD NAME" TEXT,<br/>   "SCIENTIFIC NAME" TEXT,<br/>   "GROUP" TEXT,<br/>   "SUB GROUP" TEXT<br/>);</span></pre><p id="6dec" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">如果我们查看运行sqlite3命令的文件夹，我们可以看到有一个名为<code class="fe np nq nr ng b">food_db</code>的文件。这个文件可以作为Observablehq提供的<code class="fe np nq nr ng b">sqlite()</code>函数的输入。</p><h1 id="9c75" class="mi mj iw bd mk ml mm mn mo mp mq mr ms kl mt km mu ko mv kp mw kr mx ks my mz bi translated">将数据库加载到Observable</h1><p id="f6a4" class="pw-post-body-paragraph ll lm iw ln b lo na kg lq lr nb kj lt lu nc lw lx ly nd ma mb mc ne me mf mg ip bi translated">现在我们可以在Observable中创建新的笔记本并导入数据库。我们可以单击页面右上角的三个点，然后选择文件附件:</p><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div class="gi gj ns"><img src="../Images/a369e4420207d6af44ee4e1e373154ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*uDiXsTYxR9Oy8l_QoV1f6w.png"/></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="880f" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我们从文件系统中选择文件，并将其上传到可观察的笔记本中。我们可以通过下面一行代码加载数据库:</p><pre class="kv kw kx ky gu nf ng nh ni aw nj bi"><span id="4708" class="nk mj iw ng b gz nl nm l nn no">db = FileAttachment("food_db").sqlite()</span></pre><p id="ddf6" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我们可以通过<code class="fe np nq nr ng b">describe()</code>函数列出数据库中包含的所有表格:</p><pre class="kv kw kx ky gu nf ng nh ni aw nj bi"><span id="607e" class="nk mj iw ng b gz nl nm l nn no">db.describe()</span></pre><p id="045c" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">它给出了以下输出:</p><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj nt"><img src="../Images/624b5830f3d17545908c5ba7e4f706b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xK2-eAj4ep6z_SJsnvxxHg.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="7629" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated"><code class="fe np nq nr ng b">describe()</code>函数也可以接收表名作为输入:</p><pre class="kv kw kx ky gu nf ng nh ni aw nj bi"><span id="bdb3" class="nk mj iw ng b gz nl nm l nn no">db.describe('food_table')</span></pre><p id="5da3" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">它给出了以下输出:</p><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj nu"><img src="../Images/e27b82285353b8edf8b5a0983a768664.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lFP4brxVGMBTxGQgCvJpgw.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><h1 id="a738" class="mi mj iw bd mk ml mm mn mo mp mq mr ms kl mt km mu ko mv kp mw kr mx ks my mz bi translated">查询数据库</h1><p id="77e9" class="pw-post-body-paragraph ll lm iw ln b lo na kg lq lr nb kj lt lu nc lw lx ly nd ma mb mc ne me mf mg ip bi translated">我们准备查询数据库。我们可以使用SQL语法来构建任何查询。例如，如果我们想要列出所有组，我们可以运行以下查询:</p><pre class="kv kw kx ky gu nf ng nh ni aw nj bi"><span id="6062" class="nk mj iw ng b gz nl nm l nn no">groups = db.query('SELECT DISTINCT(`GROUP`) from food_table')</span></pre><p id="686e" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">下图显示了<code class="fe np nq nr ng b">group</code>变量的快照:</p><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj nv"><img src="../Images/f59910c73bc85ceb28333fe5fb7eaaa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6FxfpuGcBm0XBwKF3QOtPw.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><p id="4e20" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我们可以构建一个包含所有组的下拉菜单:</p><pre class="kv kw kx ky gu nf ng nh ni aw nj bi"><span id="0839" class="nk mj iw ng b gz nl nm l nn no">viewof term = Inputs.select(groups.map(d =&gt; d.GROUP), {value: "Vegetables", label: "Group"})</span></pre><p id="7817" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">注意，我们已经将<code class="fe np nq nr ng b">group</code>变量转换为一个对象列表。下拉选择的输出如下所示:</p><figure class="kv kw kx ky gu kz"><div class="bz fq l di"><div class="nw nx l"/></div></figure><p id="ebdc" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我们可以通过询问属于通过下拉选择选择的组的所有子组来再次查询数据库:</p><pre class="kv kw kx ky gu nf ng nh ni aw nj bi"><span id="f886" class="nk mj iw ng b gz nl nm l nn no">data = db.query('SELECT count(*) AS value, `SUB GROUP` AS name FROM food_table WHERE `GROUP` LIKE $1 GROUP BY name ORDER BY value DESC', [`%${term}%`])</span></pre><p id="7953" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">我们可以将结果显示为表格:</p><pre class="kv kw kx ky gu nf ng nh ni aw nj bi"><span id="e657" class="nk mj iw ng b gz nl nm l nn no">Inputs.table(data)</span></pre><p id="4c6a" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">它给出了以下输出:</p><figure class="kv kw kx ky gu kz gi gj paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gi gj ny"><img src="../Images/9cf25bb9ee7dae686fc8bb7735eb9505.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5tPJy5zL5we6nH9yX1_2FQ.png"/></div></div><p class="lg lh gk gi gj li lj bd b be z dk translated">作者图片</p></figure><h1 id="53e2" class="mi mj iw bd mk ml mm mn mo mp mq mr ms kl mt km mu ko mv kp mw kr mx ks my mz bi translated">构建条形图</h1><p id="b30a" class="pw-post-body-paragraph ll lm iw ln b lo na kg lq lr nb kj lt lu nc lw lx ly nd ma mb mc ne me mf mg ip bi translated">最后，我们可以按照<a class="ae lk" href="https://observablehq.com/@d3/bar-chart" rel="noopener ugc nofollow" target="_blank">链接</a>中提供的示例来构建条形图。结果如下所示:</p><figure class="kv kw kx ky gu kz"><div class="bz fq l di"><div class="nw nx l"/></div></figure><p id="da88" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">如果您回到本文并在下拉选择中选择另一个组，您应该会在条形图中看到变化。仅此而已！</p><h1 id="71cc" class="mi mj iw bd mk ml mm mn mo mp mq mr ms kl mt km mu ko mv kp mw kr mx ks my mz bi translated">摘要</h1><p id="7af7" class="pw-post-body-paragraph ll lm iw ln b lo na kg lq lr nb kj lt lu nc lw lx ly nd ma mb mc ne me mf mg ip bi translated">在本教程中，我已经说明了如何利用Observable提供的新的sqlite3特性来构建一个动态条形图。</p><p id="5240" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">完整的笔记本可以从<a class="ae lk" href="https://observablehq.com/@alod83/how-to-build-a-dynamic-bar-chart-through-sqlite3" rel="noopener ugc nofollow" target="_blank">这里</a>下载。</p><p id="e2fb" class="pw-post-body-paragraph ll lm iw ln b lo lp kg lq lr ls kj lt lu lv lw lx ly lz ma mb mc md me mf mg ip bi translated">如果你想了解我的研究和其他活动的最新情况，你可以在<a class="ae lk" href="https://twitter.com/alod83" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae lk" href="https://www.youtube.com/channel/UC4O8-FtQqGIsgDW_ytXIWOg?view_as=subscriber" rel="noopener ugc nofollow" target="_blank"> Youtube </a>和<a class="ae lk" href="https://github.com/alod83" rel="noopener ugc nofollow" target="_blank"> Github </a>上关注我。</p><h1 id="bfb6" class="mi mj iw bd mk ml mm mn mo mp mq mr ms kl mt km mu ko mv kp mw kr mx ks my mz bi translated">相关文章</h1><div class="nz oa gq gs ob oc"><a rel="noopener follow" target="_blank" href="/how-to-insert-an-observablehq-graph-into-a-html-page-57a9f4546ecf"><div class="od ab fp"><div class="oe ab of cl cj og"><h2 class="bd jg gz z fq oh fs ft oi fv fx jf bi translated">如何将Observablehq图形插入HTML页面</h2><div class="oj l"><h3 class="bd b gz z fq oh fs ft oi fv fx dk translated">一个快速的教程，用你的观察制作精彩的HTML页面。</h3></div><div class="ok l"><p class="bd b dl z fq oh fs ft oi fv fx dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq le oc"/></div></div></a></div><div class="nz oa gq gs ob oc"><a rel="noopener follow" target="_blank" href="/some-interesting-articles-and-resources-on-data-visualisation-that-i-discovered-in-june-c00b58d15946"><div class="od ab fp"><div class="oe ab of cl cj og"><h2 class="bd jg gz z fq oh fs ft oi fv fx jf bi translated">我在六月份发现的一些关于数据可视化的有趣文章和资源</h2><div class="oj l"><h3 class="bd b gz z fq oh fs ft oi fv fx dk translated">从网上收集的一些关于数据可视化的最新有趣文章和资源的摘要。</h3></div><div class="ok l"><p class="bd b dl z fq oh fs ft oi fv fx dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="or l on oo op ol oq le oc"/></div></div></a></div><div class="nz oa gq gs ob oc"><a rel="noopener follow" target="_blank" href="/how-to-improve-d3-js-graphs-with-annotations-252fbb9c5bb5"><div class="od ab fp"><div class="oe ab of cl cj og"><h2 class="bd jg gz z fq oh fs ft oi fv fx jf bi translated">如何改进带注释的D3.js图形</h2><div class="ok l"><p class="bd b dl z fq oh fs ft oi fv fx dk translated">towardsdatascience.com</p></div></div><div class="ol l"><div class="os l on oo op ol oq le oc"/></div></div></a></div></div></div>    
</body>
</html>