<html>
<head>
<title>Forecasting the 2020 US Election Using Multilevel Regression with Post-stratification</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用后分层多水平回归预测2020年美国大选</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/forecasting-the-2020-us-election-using-multilevel-regression-with-post-stratification-bbf2f93585fb?source=collection_archive---------15-----------------------#2021-07-18">https://towardsdatascience.com/forecasting-the-2020-us-election-using-multilevel-regression-with-post-stratification-bbf2f93585fb?source=collection_archive---------15-----------------------#2021-07-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/bb24b04043d4dc1122784cbda1178f7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xk-U2hD34_2NnYM0NeiYSQ.jpeg"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图片来源:Pixabay</p></figure><div class=""/><div class=""><h2 id="1be0" class="pw-subtitle-paragraph kc je jf bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">总统选举，特朗普，政治民调，PYMC3，Python</h2></div><h1 id="8e1d" class="ku kv jf bd kw kx ky kz la lb lc ld le kl lf km lg ko lh kp li kr lj ks lk ll bi translated">如何评估美国的公众舆论</h1><p id="3269" class="pw-post-body-paragraph lm ln jf lo b lp lq kg lr ls lt kj lu lv lw lx ly lz ma mb mc md me mf mg mh ij bi translated">估计州一级意见最常用的方法叫做<strong class="lo jg"> <em class="mi">分解</em> </strong>。这个过程很简单，也很容易实现:在合并了一组全国性的民意调查后，您可以计算出按州分列的意见百分比。</p><p id="a647" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated"><strong class="lo jg"> <em class="mi">分解</em> </strong>的问题在于，它需要收集超过10年或更长时间的大量全国性调查，以在每个州内创建足够的样本量。此外，<strong class="lo jg"> <em class="mi">分解</em> </strong>不能纠正抽样问题，可能会模糊州意见中的时间动态。</p><p id="4ad7" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">为了克服这些缺点，<a class="ae mo" href="https://en.wikipedia.org/wiki/Multilevel_regression_with_poststratification" rel="noopener ugc nofollow" target="_blank"> <strong class="lo jg"> <em class="mi">带后分层的多水平回归</em></strong></a>(<strong class="lo jg"><em class="mi">MRP</em></strong>)被开发出来从全国民调中估计美国各州层面的意见。</p><h1 id="42c6" class="ku kv jf bd kw kx ky kz la lb lc ld le kl lf km lg ko lh kp li kr lj ks lk ll bi translated">什么是<strong class="ak"> <em class="mp">后分层多水平回归</em> </strong> (MRP)？</h1><p id="e31b" class="pw-post-body-paragraph lm ln jf lo b lp lq kg lr ls lt kj lu lv lw lx ly lz ma mb mc md me mf mg mh ij bi translated">MRP首先使用多级回归将个人调查响应建模为人口统计和地理预测的函数，在数据确定的范围内部分汇集各州的受访者。最后一步是后分层，其中每种人口地理应答类型的估计值按每种类型在实际州人口中的百分比进行加权(后分层)。</p><p id="479e" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">假设我们进行了一项调查，询问人们是否支持同性婚姻。我们有一个1000人的调查，其中700人为男性，300人为女性。我们可以利用调查结果来计算支持同性婚姻的人的比例。但是，我们知道男女之间的人口分布大致是50%/50%，而不是我们调查所暗示的70%/30%。因此，仅从我们的调查中得出的原始结果就过度代表了男性的观点。</p><p id="46e0" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">鉴于我们知道更广泛人群的性别分布，我们可以重新加权(分层后)我们的结果:所以在这个例子中，支持同性婚姻的人的比例估计为:</p><p id="b86d" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated"><strong class="lo jg"><em class="mi">0.5×男性比例+0.5×女性比例</em> </strong></p><p id="a368" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">这种技术被称为后分层。我们需要调查数据和可靠的人口普查数据，以获得人口权重。数据可以根据许多不同的类别重新加权，如年龄、教育、性别、种族等。</p><h1 id="9019" class="ku kv jf bd kw kx ky kz la lb lc ld le kl lf km lg ko lh kp li kr lj ks lk ll bi translated">预测2020年美国大选</h1><p id="03b0" class="pw-post-body-paragraph lm ln jf lo b lp lq kg lr ls lt kj lu lv lw lx ly lz ma mb mc md me mf mg mh ij bi translated">在本帖中，我们将按照示例<a class="ae mo" href="https://www.tellingstorieswithdata.com/mrp.html#ref-wang2015forecasting" rel="noopener ugc nofollow" target="_blank">这里</a>和<a class="ae mo" href="https://austinrochford.com/posts/2017-07-09-mrpymc3.html" rel="noopener ugc nofollow" target="_blank">这里</a>使用分解技术&amp; MRP和两个数据集(一个民调数据集和一个人口普查数据集)预测2020年美国大选。我们走吧！</p><h1 id="ec25" class="ku kv jf bd kw kx ky kz la lb lc ld le kl lf km lg ko lh kp li kr lj ks lk ll bi translated">选举民调数据</h1><p id="866f" class="pw-post-body-paragraph lm ln jf lo b lp lq kg lr ls lt kj lu lv lw lx ly lz ma mb mc md me mf mg mh ij bi translated">我不能分享数据集，但是，下面是如何获取数据的说明:</p><ol class=""><li id="692e" class="mq mr jf lo b lp mj ls mk lv ms lz mt md mu mh mv mw mx my bi translated">转到网站:【https://www.voterstudygroup.org T4】。</li><li id="b9a2" class="mq mr jf lo b lp mz ls na lv nb lz nc md nd mh mv mw mx my bi translated">点击“国家景观”。</li><li id="bd04" class="mq mr jf lo b lp mz ls na lv nb lz nc md nd mh mv mw mx my bi translated">点击“获取最新的国家景观数据”。</li><li id="b9be" class="mq mr jf lo b lp mz ls na lv nb lz nc md nd mh mv mw mx my bi translated">填写您的姓名和电子邮件地址，然后点击“提交请求”。</li><li id="2619" class="mq mr jf lo b lp mz ls na lv nb lz nc md nd mh mv mw mx my bi translated">您将收到一封带有下载链接的电子邮件，单击此链接。</li><li id="e0f5" class="mq mr jf lo b lp mz ls na lv nb lz nc md nd mh mv mw mx my bi translated">我们会下载。dta文件。</li><li id="1ee0" class="mq mr jf lo b lp mz ls na lv nb lz nc md nd mh mv mw mx my bi translated">解压下载的“nation scape-data release _ weekly materials _ DTA _ 200910 _ 161918”，然后打开文件夹“phase_2_v20200814”。</li><li id="abe5" class="mq mr jf lo b lp mz ls na lv nb lz nc md nd mh mv mw mx my bi translated">有很多dta.files，我用的是“ns20200625.dta”，指的是2020年6月25日。</li></ol><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">poll_data.py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nk"><img src="../Images/a21ef664400bc6550129ceac866f9a6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5uoCHRlhFVZl1jAiwr3seQ.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">表1</p></figure><p id="a366" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">数据中有许多特征，这个分析将需要七个:“投票_2020”，“种族_民族”，“教育”，“州”，“性别”，“年龄”，“人口普查_地区”。</p><h1 id="3773" class="ku kv jf bd kw kx ky kz la lb lc ld le kl lf km lg ko lh kp li kr lj ks lk ll bi translated">电子设计自动化(Electronic Design Automation)</h1><pre class="ne nf ng nh gt nl nm nn no aw np bi"><span id="ae46" class="nq kv jf nm b gy nr ns l nt nu">df.vote_2020.value_counts(normalize=True)</span></pre><figure class="ne nf ng nh gt is gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/f81bc1a86b6c13e347551dad776bf349.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*iqm_PPL5BqwTDLat2sHAMQ.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图1</p></figure><p id="b9d3" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">在数据中，大约42%的人说他们会投票给拜登，38%的人说他们会投票给特朗普，10%的人不确定，以此类推。</p><h2 id="1703" class="nq kv jf bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">各州的民意测验答卷人数量</h2><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">respondents _ by _ state.py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oh"><img src="../Images/89dde87f6af8b41aaf08cad14d5c7fe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eOh253a72FzgRbCG0lOB3w.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图2</p></figure><p id="b3eb" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">很明显，越大的州，越多的受访者。值得注意的是，每个州都有回答者。</p><h2 id="c72e" class="nq kv jf bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">按州和种族分列的受访者</h2><ol class=""><li id="a22b" class="mq mr jf lo b lp lq ls lt lv oi lz oj md ok mh mv mw mx my bi translated">我们将种族简化为四类:“白人”、“黑人”、“亚裔”和“其他”。</li><li id="580a" class="mq mr jf lo b lp mz ls na lv nb lz nc md nd mh mv mw mx my bi translated">因为我们对特朗普的选民感兴趣，所以会重新编码“vote_2020”变量。</li></ol><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">状态_种族. py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ol"><img src="../Images/14d507b7c952c7e388ac2b13e14ba38a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iOY3K7e7l9nbCnn5uDzIaA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图3</p></figure><p id="4bca" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">所有的州都有白人受访者，几个州没有黑人和/或亚裔受访者，甚至更多的州只有很少的黑人和/或亚裔受访者。</p><h2 id="d2f4" class="nq kv jf bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">按州和性别分列的受访者</h2><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">state_gender.py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi om"><img src="../Images/85d70ebae35b25b4bc5cdbdecd2d4488.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sk8I_9Fesdy8mSFIAujxGA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图4</p></figure><p id="e010" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">一个州(WY)没有女性答卷人，所有其他州都有男性和女性答卷人。</p><h2 id="66a3" class="nq kv jf bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">估计对特朗普的支持</h2><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">disa_trump.py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi on"><img src="../Images/0dacdeae5773d0d8fdbd0c2c3eba32cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EZj4lzyp_4eUqgR8eGIZ3Q.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图5</p></figure><p id="ba48" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">阿肯色州的支持度最高，佛蒙特州对特朗普的支持度最低。</p><h2 id="ed9b" class="nq kv jf bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">按年龄和性别给特朗普投票</h2><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">年龄_性别. py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oo"><img src="../Images/1357bfa43b642bef750b1a24fd0ba29d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ie2SUWfH-BOwXs5zY2nhfw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图6</p></figure><p id="83a3" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">在这次民意调查中，大约35-45岁的男性是特朗普最大的投票群体。</p><h2 id="6536" class="nq kv jf bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">简化教育和年龄变量</h2><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">sim_edu_age.py</p></figure><p id="86ae" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">我们将通过结合性别(2类)、种族(4类)、年龄(4类)和教育(4类)的所有可能组合来探索特朗普的选民。</p><h2 id="a016" class="nq kv jf bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">按性别给特朗普投票</h2><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">gender_group.py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div class="gh gi op"><img src="../Images/e5525996a4eee8d6ea15c2fa222751eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*gwaivNG3QhweXjDQC-siUg.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">表2</p></figure><p id="7dbf" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">在表示将投票给特朗普的选民中，大约43%是女性，57%是男性。</p><h2 id="01a2" class="nq kv jf bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">按年龄类别投票给特朗普</h2><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">age_cat.py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/d03b65edb9159c3ce3d7005ab78da410.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*KsgUelsBt9liI5BYA2-veQ.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">表3</p></figure><p id="e853" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">30-44岁是最大的投票群体，其次是60岁及以上。</p><h2 id="14f1" class="nq kv jf bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">按年龄和性别给特朗普投票</h2><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">ageCat_genderCat.py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div class="gh gi or"><img src="../Images/a7813c275d21bba094314cd8239aea90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*Ye09SmcJrRocXyfJycFl-A.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">表4</p></figure><h2 id="49df" class="nq kv jf bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">按种族给川普投票</h2><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">race.py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi os"><img src="../Images/3c37f839f91d4df041c2b88be8406367.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*jB13FLZ3pbNtffj3wLa-zw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">表5</p></figure><h2 id="3097" class="nq kv jf bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">按种族和性别给特朗普投票</h2><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">race_gender.py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/4d5c9e64bcab9c31507dd5325b38e90a.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/1*FPajA4FUbrZdogzWspj94w.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">表6</p></figure><h2 id="79ae" class="nq kv jf bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">按种族和年龄给特朗普投票</h2><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">race_age.py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/f009520a4ca203db0de57253585b3fde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*xyUcEjFxX-B67KB-JU5BDQ.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">表7</p></figure><h2 id="8079" class="nq kv jf bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">教育投票给川普</h2><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">edu _猫. py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/eee4242944979df7d02cd940391b5fb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*XPG1AJu3sYEN-kTGaRFieQ.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">表8</p></figure><h2 id="1229" class="nq kv jf bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">按教育和性别给特朗普投票</h2><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">edu_gender.py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/bae4562d1d7439326b6b969ccb2a09a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*iLrzE6KGg_5Vv40S011wuQ.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">表9</p></figure><h2 id="bb26" class="nq kv jf bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">按教育和种族给特朗普投票</h2><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">edu_race.py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/1a8d948382c0b4632c27e13b82fed919.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*Fd4yvN_LUoi3CyGgltj8og.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">表10</p></figure><h2 id="bc05" class="nq kv jf bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">按教育和年龄给特朗普投票</h2><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">edu _时代. py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/cec7f898f1dfebaf4831f228c7371a35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*Ud5B8PCw_JHLPBQftU42Nw.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">表11</p></figure><h1 id="57e8" class="ku kv jf bd kw kx ky kz la lb lc ld le kl lf km lg ko lh kp li kr lj ks lk ll bi translated">多层模式</h1><p id="66fa" class="pw-post-body-paragraph lm ln jf lo b lp lq kg lr ls lt kj lu lv lw lx ly lz ma mb mc md me mf mg mh ij bi translated">我们的多级投票模型将包括州、种族、性别、教育、年龄和投票等因素。为了加速推断，我们计算了这些因素的独特组合的数量，以及每个组合有多少受访者会投票给特朗普。</p><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">encode_uniq.py</p></figure><p id="ac1b" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">这种减少将数据集中的行数减少了近70%。</p><pre class="ne nf ng nh gt nl nm nn no aw np bi"><span id="1362" class="nq kv jf nm b gy nr ns l nt nu">uniq_dt_df.shape[0] / dt_df.shape[0]</span></pre><figure class="ne nf ng nh gt is gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/f726ad5df7d43b71b6ce6fb3f30803f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:510/format:webp/1*pBTU9Y-16CtZ-w3xLJM3oA.png"/></div></figure><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">多级. py</p></figure><p id="9a89" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">现在我们准备好用PyMC3指定模型，从在<code class="fe pa pb pc nm b">theano.shared</code>中包装预测器开始。</p><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">shared.py</p></figure><p id="d9ed" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">我们指定α_state的多级(分层)模型。</p><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">hierarchical_normal.py</p></figure><p id="8df3" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">我们指定参数如下:</p><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">参数. py</p></figure><p id="86c9" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">最后，我们使用NUTS指定模型的可能性和样本。</p><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">样本. py</p></figure><p id="dab1" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">我们可以使用Gelman Rubin测试来正式验证链的收敛性。接近1.0的值表示收敛。</p><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">赫尔曼·鲁宾</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pd"><img src="../Images/76660bd900f46cbb666276f1b045c6a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*r0Hhs-CImUKHEr5e_OBYUw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图6</p></figure><h1 id="6e04" class="ku kv jf bd kw kx ky kz la lb lc ld le kl lf km lg ko lh kp li kr lj ks lk ll bi translated">分层后数据</h1><p id="f01e" class="pw-post-body-paragraph lm ln jf lo b lp lq kg lr ls lt kj lu lv lw lx ly lz ma mb mc md me mf mg mh ij bi translated">我们将使用IPUMS美国人口普查和美国社区调查数据。同样，我无法分享数据集，以下是获取数据集的步骤:</p><ol class=""><li id="0da3" class="mq mr jf lo b lp mj ls mk lv ms lz mt md mu mh mv mw mx my bi translated">进入https://ipums.org IPUMS网站:<a class="ae mo" href="https://ipums.org/" rel="noopener ugc nofollow" target="_blank"/>，然后点击“美国IPUMS”上的“访问网站”。</li><li id="d795" class="mq mr jf lo b lp mz ls na lv nb lz nc md nd mh mv mw mx my bi translated">点击“获取数据”。</li><li id="7156" class="mq mr jf lo b lp mz ls na lv nb lz nc md nd mh mv mw mx my bi translated">如果你以前没有做过，你需要创建一个帐户，然后等待确认。</li><li id="ebbb" class="mq mr jf lo b lp mz ls na lv nb lz nc md nd mh mv mw mx my bi translated">一旦您有了一个帐户，请转到“选择样品”并取消选择除2019年ACS之外的所有产品。</li><li id="bcaf" class="mq mr jf lo b lp mz ls na lv nb lz nc md nd mh mv mw mx my bi translated">我们需要得到我们感兴趣的变量。在家庭中，我们想要“STATEICP”，而在个人中，我们想要“性别”、“年龄”、“教育程度”和“种族”。</li><li id="0226" class="mq mr jf lo b lp mz ls na lv nb lz nc md nd mh mv mw mx my bi translated">选择所有内容后，“查看购物车”，我们要将数据格式更改为”。dta”。它应该小于300MB，然后提交请求。</li><li id="543d" class="mq mr jf lo b lp mz ls na lv nb lz nc md nd mh mv mw mx my bi translated">你应该会收到一封邮件，说你的数据可以在几分钟内下载。</li><li id="64bb" class="mq mr jf lo b lp mz ls na lv nb lz nc md nd mh mv mw mx my bi translated">我下载了“usa_00002.dta”并保存在我的数据文件夹中。</li></ol><p id="2d87" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">我们现在可以开始清理数据，包括重新组织年龄类别、教育类别、种族类别，并将州名改为两个字母的州缩写，这与我们之前分析的调查数据一致。</p><pre class="ne nf ng nh gt nl nm nn no aw np bi"><span id="b28e" class="nq kv jf nm b gy nr ns l nt nu">census_df = pd.read_stata('data/usa_00002.dta')<br/>census_df.head()</span></pre><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pe"><img src="../Images/20b75c249519e286ea1e59e0db358a73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S_cjC0vpEP2V-IEmYwq1xw.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">表12</p></figure><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">post_stra.py</p></figure><p id="a002" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">创建每个子单元的计数和各州的比例后，与之前的州数据合并。现在我们终于有了分层后的数据:</p><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pf"><img src="../Images/74f9b129e49bca0c160c6dd63ba1b07b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RkgTpbyVqmLsN4lEszuJBg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">表13</p></figure><p id="739e" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">同样，我们将类别变量编码为数字，并以与之前相同的方式对组合数据进行编码。</p><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">ps_encode.py</p></figure><p id="aa81" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">现在，我们将PyMC3模型中的<code class="fe pa pb pc nm b">theano.shared</code>变量的值设置为后分层数据，并从后验预测分布中取样。</p><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">ps_mean.py</p></figure><p id="fcf0" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">我们通过对每个州内的人口统计单元进行加权求和来完成后分层步骤，以从州级投票分布中产生后验预测样本。州级民意测验的最简单概括是后验期望均值。</p><p id="a7f9" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">下图显示了MRP对各州特朗普支持率的估计。</p><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">mrp_trump.py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oh"><img src="../Images/3e31db17632f61fe3e1aeb72a7b66c3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YB-Ckirvtsu_fiXny1SpbA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图7</p></figure><p id="19ea" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">我们可以看一下我们的估计值，比较每个状态的估计值在分解和MRP之间的差异。</p><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">mrp_disa.py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/8a80a89312d0e0e6b77f0df61cbadd83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*o4Z5gpkanl5isKt2n9C7lg.png"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图8</p></figure><h1 id="e486" class="ku kv jf bd kw kx ky kz la lb lc ld le kl lf km lg ko lh kp li kr lj ks lk ll bi translated">特朗普是如何得到黑人支持的？</h1><p id="0b31" class="pw-post-body-paragraph lm ln jf lo b lp lq kg lr ls lt kj lu lv lw lx ly lz ma mb mc md me mf mg mh ij bi translated">我们试着用两个估计来回答这个问题。</p><p id="413b" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">首先，我们绘制了黑人男性对特朗普支持率的分解估计。我们意识到，在许多州，民意测验专家很少或根本没有调查黑人。因此，这些州的黑人男性对特朗普的支持度不能用分解法来衡量。</p><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">黑人_男人_disa.py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ph"><img src="../Images/9be31fe26b6594cd433b3ad435fca778.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FuiV17AKGiOI6s5-yhgoNQ.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图9</p></figure><p id="9fd8" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">在使用MRP时，我们能够估计所有州的黑人男性对特朗普的支持度。</p><figure class="ne nf ng nh gt is"><div class="bz fp l di"><div class="ni nj l"/></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">黑人_男人_mrp.py</p></figure><figure class="ne nf ng nh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pi"><img src="../Images/0fba37c00e46bd9924c1598e1a032921.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N5WFIRMhZWgILr3u8ArFWg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">图10</p></figure><p id="258a" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">Jupyter笔记本可以在<a class="ae mo" href="https://github.com/susanli2016/Machine-Learning-with-Python/blob/master/Multilevel%20regression%20with%20post-stratification_election2020.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。祝你周末愉快。</p><p id="02e4" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated">参考资料:</p><p id="9627" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated"><a class="ae mo" href="https://scholar.princeton.edu/sites/default/files/jkastellec/files/mrp_primer.pdf" rel="noopener ugc nofollow" target="_blank">https://scholar . Princeton . edu/sites/default/files/jkstellec/files/MRP _ primer . pdf</a></p><div class="ip iq gp gr ir pj"><a href="https://austinrochford.com/posts/2017-07-09-mrpymc3.html" rel="noopener  ugc nofollow" target="_blank"><div class="pk ab fo"><div class="pl ab pm cl cj pn"><h2 class="bd jg gy z fp po fr fs pp fu fw je bi translated">MRPyMC3 -多水平回归和PyMC3后分层</h2><div class="pq l"><h3 class="bd b gy z fp po fr fs pp fu fw dk translated">几周前，YouGov正确地预测了2017年英国大选的结果是一个无多数议会</h3></div><div class="pr l"><p class="bd b dl z fp po fr fs pp fu fw dk translated">austinrochford.com</p></div></div></div></a></div><p id="1904" class="pw-post-body-paragraph lm ln jf lo b lp mj kg lr ls mk kj lu lv ml lx ly lz mm mb mc md mn mf mg mh ij bi translated"><a class="ae mo" href="https://www.tellingstorieswithdata.com/mrp.html#ref-wang2015forecasting" rel="noopener ugc nofollow" target="_blank">https://www . tellingstorieswithdata . com/MRP . html # ref-Wang 2015预测</a></p></div></div>    
</body>
</html>