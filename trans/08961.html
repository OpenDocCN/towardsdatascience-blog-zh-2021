<html>
<head>
<title>Node.JS DevOps: Simplify Your Life with GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">节点。JS DevOps:用GitHub操作简化您的生活</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/node-js-devops-github-actions-2a1b2be1741f?source=collection_archive---------24-----------------------#2021-08-18">https://towardsdatascience.com/node-js-devops-github-actions-2a1b2be1741f?source=collection_archive---------24-----------------------#2021-08-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="30e7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何打包和部署node.js应用程序，并发布到npmjs、docker hub和其他目标</h2></div><p id="affd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">读过我的文章的人都知道我对DevOps和云采用的未来的愿景(仅<a class="ae le" href="https://betterprogramming.pub/devops-appops-f096cdbb02ac" rel="noopener ugc nofollow" target="_blank"> DevOps已死，NoOps长命百岁</a>举一个例子)。为了解释它而不超出范围，我相信自动化和现成的解决方案(云、工具等)。)让我们只关注应用。这种方法引导开发人员采用可持续的方法</p><blockquote class="lf"><p id="9d12" class="lg lh it bd li lj lk ll lm ln lo ld dk translated">我们应该总是找到一种自动化的方式来进行部署，这种方式是免费的，而且只需付出有限的努力。</p></blockquote><p id="34a9" class="pw-post-body-paragraph ki kj it kk b kl lp ju kn ko lq jx kq kr lr kt ku kv ls kx ky kz lt lb lc ld im bi translated">在本文中，我将与您分享我在部署我的第一个<a class="lu lv ep" href="https://medium.com/u/96cd9a1fb56?source=post_page-----2a1b2be1741f--------------------------------" rel="noopener" target="_blank"> Node.js </a>开源项目<a class="ae le" href="https://github.com/zeppaman/mongo-event-sourcing" rel="noopener ugc nofollow" target="_blank">MESS(MongoDB Event Sourcing System)</a>时采用的配置。该配置是一个单独的YAML文件，可以为您的GitHub库释放无限的能量。</p><p id="67cb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我在这里意识到的是一个简单的配置，它满足了当今企业应用程序的所有基本需求:</p><ul class=""><li id="84c6" class="lw lx it kk b kl km ko kp kr ly kv lz kz ma ld mb mc md me bi translated">自动版本代码</li><li id="7e0d" class="lw lx it kk b kl mf ko mg kr mh kv mi kz mj ld mb mc md me bi translated">在每个版本上运行测试</li><li id="e518" class="lw lx it kk b kl mf ko mg kr mh kv mi kz mj ld mb mc md me bi translated">将人工制品发布到NPMJS(如果你有图书馆或者你通过NPM传递)</li><li id="f0ed" class="lw lx it kk b kl mf ko mg kr mh kv mi kz mj ld mb mc md me bi translated">发布您的docker容器，准备好进入容器存储库</li></ul><p id="9b93" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所有这些特性可能看起来很难实现，但是你会发现使用<a class="lu lv ep" href="https://medium.com/u/8df3bf3c40ae?source=post_page-----2a1b2be1741f--------------------------------" rel="noopener" target="_blank"> GitHub </a>动作或多或少会实现。本指南将通过几个简单的步骤来解释这些技巧:</p><ol class=""><li id="6f04" class="lw lx it kk b kl km ko kp kr ly kv lz kz ma ld mk mc md me bi translated">创建简单的node.js应用程序</li><li id="ce65" class="lw lx it kk b kl mf ko mg kr mh kv mi kz mj ld mk mc md me bi translated">使用GitHub操作添加工作流程</li><li id="a048" class="lw lx it kk b kl mf ko mg kr mh kv mi kz mj ld mk mc md me bi translated">使用<em class="ml"> Semver </em>自动标记源代码</li><li id="2f4a" class="lw lx it kk b kl mf ko mg kr mh kv mi kz mj ld mk mc md me bi translated">每次提交时推送NPM.js</li><li id="dee8" class="lw lx it kk b kl mf ko mg kr mh kv mi kz mj ld mk mc md me bi translated">每次提交时推送Docker Hub</li></ol><p id="25f6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看看它有多简单！</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mm"><img src="../Images/140c86787ef8e2e9ad4821e36b1c2674.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wAoKGu5h2c1YtqEm"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">托马斯·毕晓普在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="848e" class="nj nk it bd nl nm nn no np nq nr ns nt jz nu ka nv kc nw kd nx kf ny kg nz oa bi translated">创建简单的node.js应用程序</h1><p id="a1e8" class="pw-post-body-paragraph ki kj it kk b kl ob ju kn ko oc jx kq kr od kt ku kv oe kx ky kz of lb lc ld im bi translated">很明显，在开始本教程最酷的部分之前，我们需要部署一些东西。为此，我们只需要一个简单的node.js应用程序。第一步是使用npm CLI创建一个新的。</p><pre class="mn mo mp mq gt og oh oi oj aw ok bi"><span id="e2cc" class="ol nk it oh b gy om on l oo op">npm init <br/>npm install express --save</span></pre><p id="3151" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的命令初始化节点应用程序并将express安装为web服务器。出于演示目的，我们可以创建一个带有一些虚拟端点的应用程序。用以下内容创建一个名为<code class="fe oq or os oh b">main.js</code>的文件:</p><p id="419d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，您可以通过输入run命令的定义来改变npm包。在下一个示例中，我使用supervisor在开发环境和常规生产节点上进行热重装。</p><p id="4bdf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">键入<code class="fe oq or os oh b">npm run serve</code>实时查看您的应用程序。</p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="a721" class="nj nk it bd nl nm nn no np nq nr ns nt jz nu ka nv kc nw kd nx kf ny kg nz oa bi translated">使用GitHub操作添加工作流程</h1><p id="311d" class="pw-post-body-paragraph ki kj it kk b kl ob ju kn ko oc jx kq kr od kt ku kv oe kx ky kz of lb lc ld im bi translated">一旦我们有了要测试的虚拟应用程序，我们必须将它提交给一个公共或私有的GitHub repo。这一步对所有开发人员来说应该很容易，所以我不会浪费时间解释它😃</p><p id="fe93" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦代码被推送，你可以打开GitHub页面，点击“Action”，然后点击“New Workflow”按钮，如下图所示。</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi ot"><img src="../Images/95e55c652f4fff6e707836563f593fd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xU2gUdhNyhfZhh6MMobZ9Q.png"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">创建新的工作流</p></figure><p id="9016" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将询问使用什么样的模板，在我们的例子中，我们将选择node.js模板，但这并不排除对所有其他可用操作的do访问。</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi ou"><img src="../Images/d81170ce3ca9a0b6fa9754fd422850ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*usNJmoLACPy_HLs907rdfA.png"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">选择正确的模板</p></figure><p id="6474" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们已经准备好设置工作流了！</p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="fb27" class="nj nk it bd nl nm nn no np nq nr ns nt jz nu ka nv kc nw kd nx kf ny kg nz oa bi translated">使用Semver自动标记源代码</h1><p id="a7dd" class="pw-post-body-paragraph ki kj it kk b kl ob ju kn ko oc jx kq kr od kt ku kv oe kx ky kz of lb lc ld im bi translated">首先，对那些不习惯的人说几句话。SemVer 是一个语义版本编号系统，简而言之，它根据提交历史计算软件的版本。在一个示例中，它在每次提交时增加补丁号(1.0.x)或增加次要版本(1。X.0)每次合并主控形状上的特征分支时。可以想象，您可以修改约定来满足您的编号要求。</p><p id="ca97" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要启用自动版本控制，您只需添加以下步骤:</p><figure class="mn mo mp mq gt mr"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="4cdc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如您在代码中看到的，有两个不同的步骤。第一个是启用管理<em class="ml"> semver </em>标签的插件，第二个是简单地将它显示在控制台上。这里的技巧是为第一步添加一个id，这将允许您使用像<code class="fe oq or os oh b">${{steps.version-bump.outputs.newTag}}</code>这样的输出变量。此时，我们已经完成了版本控制。是的，因为这个包自动标记每个提交并改变<code class="fe oq or os oh b">package.json</code>版本属性。</p><p id="51de" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好了，现在是时候把我们的代码推到NPM了！</p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="7d47" class="nj nk it bd nl nm nn no np nq nr ns nt jz nu ka nv kc nw kd nx kf ny kg nz oa bi translated">每次提交时推送NPM.js</h1><p id="5b14" class="pw-post-body-paragraph ki kj it kk b kl ob ju kn ko oc jx kq kr od kt ku kv oe kx ky kz of lb lc ld im bi translated">NPM的蹬踏很容易。第一步是使用NPM令牌添加一个秘密值，您可以从您在NPM的个人资料中获取该值。秘密部分可以在GitHub的“设置”标签下找到。在下一张图中，你会看到<code class="fe oq or os oh b">NPM_TOKEN</code>和其他我们将用于docker支持的设置。</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi ox"><img src="../Images/6fe3a4654b61daac87f727a54c978fad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2iPD3A8iXtSo-G6jhOY0RA.png"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">GitHub秘密</p></figure><p id="faf3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们可以将以下配置添加到工作流中:</p><figure class="mn mo mp mq gt mr"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="39c9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这一步使用<code class="fe oq or os oh b">package.json</code>文件中的信息在NPM上测试和发布代码。仅此而已！只需跳到下一节，将我们的代码也发布到docker。</p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="ef3b" class="nj nk it bd nl nm nn no np nq nr ns nt jz nu ka nv kc nw kd nx kf ny kg nz oa bi translated">每次提交时推送Docker Hub</h1><p id="f588" class="pw-post-body-paragraph ki kj it kk b kl ob ju kn ko oc jx kq kr od kt ku kv oe kx ky kz of lb lc ld im bi translated">在docker上启用部署的第一步是创建一个Docker映像进行提交。为此，只需添加一个包含以下内容的<code class="fe oq or os oh b">Dockerfile</code>:</p><pre class="mn mo mp mq gt og oh oi oj aw ok bi"><span id="b530" class="ol nk it oh b gy om on l oo op">ROM node:alpine as builder <br/>WORKDIR /usr/src/app <br/>COPY ./ /usr/src/app <br/>RUN npm install  </span><span id="452a" class="ol nk it oh b gy oy on l oo op">FROM node:alpine as app <br/>WORKDIR /usr/src/app C<br/>OPY --from=builder /usr/src/app /usr/src/app <br/>ENTRYPOINT ["/bin/sh", "-c" , "pwd &amp; ls &amp; npm run serve"]</span></pre><p id="06d4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要构建和发布Docker图像，您只需将另一段代码添加到工作流YAML中。下一个就够了:</p><figure class="mn mo mp mq gt mr"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="cca5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">YAML执行以下步骤:登录、获取图像信息、构建和发布。变量<code class="fe oq or os oh b">DOCKER_USERNAME,DOCKER_PASSWORD</code>是GitHub的秘密。为了安全起见，您可以使用auth令牌来代替密码。这可以由您的Docker Hub帐户档案生成。在这个例子中，我使用了一个双标签:我用“最新的”来标记每张图片，并添加了一个基于<em class="ml">永远</em>的标签。这个技巧是通过在同一个图像上添加两个标签来实现的，设置为:</p><pre class="mn mo mp mq gt og oh oi oj aw ok bi"><span id="fb74" class="ol nk it oh b gy om on l oo op">tags: zeppaman/mongo-event-sourcing:latest, zeppaman/mongo-event-sourcing:${{ steps.version-bump.outputs.newTag }}</span></pre><p id="ff0d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如您所见，我使用了标记步骤的输出变量。现在所有的配置都完成了，我们有了管道集。很简单，对吧？</p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="129e" class="nj nk it bd nl nm nn no np nq nr ns nt jz nu ka nv kc nw kd nx kf ny kg nz oa bi translated">带什么回家</h1><p id="301a" class="pw-post-body-paragraph ki kj it kk b kl ob ju kn ko oc jx kq kr od kt ku kv oe kx ky kz of lb lc ld im bi translated">GitHub action是实现构建管道的一个非常简单的工具。该设置很容易与NPM和Docker集成，这使得您的应用程序很容易被所有基于容器的平台使用。我指的是Kubernetes和其他云平台。此外，您还可以通过npm进行部署，以共享库或允许定制您的应用程序。</p><p id="4bd0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是为什么我为我的开源应用程序选择这个设置，我很容易找到一个可以帮助用户顺利采用它的设置。</p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><p id="3025" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="ml">喜欢这篇文章吗？成为</em> <a class="ae le" href="https://daniele-fontani.medium.com/membership" rel="noopener"> <em class="ml">中等会员</em> </a> <em class="ml">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><h2 id="4e47" class="ol nk it bd nl oz pa dn np pb pc dp nt kr pd pe nv kv pf pg nx kz ph pi nz pj bi translated">参考</h2><ul class=""><li id="c7a5" class="lw lx it kk b kl ob ko oc kr pk kv pl kz pm ld mb mc md me bi translated"><a class="ae le" href="https://github.com/zeppaman/mongo-event-sourcing" rel="noopener ugc nofollow" target="_blank">GitHub项目</a></li><li id="f416" class="lw lx it kk b kl mf ko mg kr mh kv mi kz mj ld mb mc md me bi translated"><a class="ae le" href="https://www.npmjs.com/package/mongo-event-sourcing" rel="noopener ugc nofollow" target="_blank">NPM套餐</a></li><li id="5647" class="lw lx it kk b kl mf ko mg kr mh kv mi kz mj ld mb mc md me bi translated"><a class="ae le" href="https://hub.docker.com/r/zeppaman/mongo-event-sourcing" rel="noopener ugc nofollow" target="_blank">码头工人图像</a></li></ul></div></div>    
</body>
</html>