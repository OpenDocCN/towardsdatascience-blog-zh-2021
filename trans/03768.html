<html>
<head>
<title>What is a Query folding in Power BI and why should I care?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是Power BI中的查询折叠，我为什么要关心它？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/what-is-a-query-folding-in-power-bi-and-why-should-i-care-5b89f42f38d7?source=collection_archive---------1-----------------------#2021-03-29">https://towardsdatascience.com/what-is-a-query-folding-in-power-bi-and-why-should-i-care-5b89f42f38d7?source=collection_archive---------1-----------------------#2021-03-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ebaf" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">"这会破坏查询折叠吗？"“您的查询会折叠吗？”…也许有人问过你这些问题，但你会说:“问…什么？!"在这一系列文章中，我们来学习幂查询中最重要的一个概念！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/438a3abcc1842b952fc4789b20af48a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h6Snozt6tL5KdpIMX1x37Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.pexels.com/photo/green-grass-field-with-wind-turbines-under-blue-sky-6604984/" rel="noopener ugc nofollow" target="_blank">https://www . pexels . com/photo/green-grass-field-with wind-turbines-under-blue-sky-6604984/</a></p></figure><blockquote class="kz la lb"><p id="1442" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">"这会破坏查询折叠吗？"“您的查询会折叠吗？”…也许有人问过你这些问题，但你会说:“问…什么？!"</p><p id="c0ad" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">或者，您可能听说过Power BI中的查询折叠，但不知道如何在现实生活中利用它。</p><p id="3a40" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">如果你认识到自己处于(至少)上述两种情况中的一种，那么请继续阅读这篇简短的系列博文！</p></blockquote><p id="c06e" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">好吧，你很想知道什么是查询折叠。但是，首先…在你开始之前，我们需要一些理论基础，这些基础将把查询折叠特性放在适当的环境中。</p><h2 id="563f" class="mc md it bd me mf mg dn mh mi mj dp mk lz ml mm mn ma mo mp mq mb mr ms mt mu bi translated">数据整形</h2><p id="6b9e" class="pw-post-body-paragraph lc ld it lf b lg mv ju li lj mw jx ll lz mx lo lp ma my ls lt mb mz lw lx ly im bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/power-bi-101-data-shaping-in-a-nutshell-1df4681bdfd3">我已经写过关于数据成形</a>的文章，以及为什么它是数据准备阶段的关键概念之一。现在，我想以一种(也许)不同寻常的方式对此进行阐述:</p><p id="1c9c" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">我想你们都知道托马斯·莫尔写的一本书，叫做《乌托邦》。</p><p id="b300" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">在那个故事里，一切都很完美，每个人都很满意。在一个理想的世界中，让我们称之为“数据乌托邦”，我们有干净的、高质量的数据，这些数据只是“按原样”飞入我们的报告，而不需要在此过程中执行任何类型的翻新或转换。不幸的是，“数据乌托邦”只能存在于书本中——现实更加残酷——因为我们必须在培育数据的同时应对一系列挑战。</p><p id="8f66" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">也就是说，我们必须吸收的一个关键概念是数据整形。一旦您熟悉了您的数据，并意识到您计划在您的<strong class="lf iu"> <em class="le">商业智能</em> </strong>解决方案中使用的数据中可能存在的陷阱，您就应该执行数据整形过程。</p><p id="95d4" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">我有意使用术语“商业智能”而不是“Power BI”，因为这是一个通用概念，也应该在Power BI解决方案之外使用。</p><p id="2bc5" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">简而言之，在数据成为数据模型的一部分之前，数据整形就是数据整合的过程。关键要记住的是两个字:之前！因此，我们应该在数据进入报告本身之前进行数据整形。数据整形可以在不同的地方进行，也可以在数据准备过程中的不同时间点进行，这取决于您应用数据整形技术的位置。</p><p id="22dc" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><strong class="lf iu"> <em class="le">应该在哪里进行数据整形？</em>T11】</strong></p><p id="d729" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">源数据库——这是最明显的选择，在大多数情况下也是最理想的场景。它基于提取-转换-加载(ETL)数据的传统数据仓库原则。在这个场景中，您定义想要提取的数据(并不需要数据库中的所有数据，并且通常不建议导入所有数据)。然后，您决定是否需要对数据进行转换，以更好地满足您的报告需求，例如，您是否需要执行货币转换，或者您是否需要符合国家和城市名称。</p><p id="9c84" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">你能认出下图中的城市吗？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/df1b2e591bd1fe3015ec574f6814e2be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r9O-L7-BuSrcD19I6DzloA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.pexels.com/photo/skyline-photo-of-empire-state-building-in-new-york-city-2190283/" rel="noopener ugc nofollow" target="_blank">https://www . pexels . com/photo/skyline-photo-of-empire-state-building-in-new York-city-2190283/</a></p></figure><p id="70b9" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">是的，是纽约。或者，是NYC？或者，是纽约市？这三个名字哪个是正确的？是的，它们都是正确的-但是如果您像这样在您的数据模型中导入数据，您将得到不正确的结果-因为每个纽约、NYC和纽约市将被视为一个单独的实体。这一点，以及更多潜在的警告，需要在数据整形阶段解决，这就是为什么花一些时间处理数据很重要。</p><h2 id="7aaa" class="mc md it bd me mf mg dn mh mi mj dp mk lz ml mm mn ma mo mp mq mb mr ms mt mu bi translated">电源查询</h2><p id="729c" class="pw-post-body-paragraph lc ld it lf b lg mv ju li lj mw jx ll lz mx lo lp ma my ls lt mb mz lw lx ly im bi translated">如果您不在源端执行数据转换，下一站是Power Query——它是Power BI中的内置工具，<a class="ae ky" rel="noopener" target="_blank" href="/power-query-tips-for-every-power-bi-developer-da9ebd3dcd93">使您能够对数据执行各种转换</a>。根据微软的官方文档，您可以应用300多种不同的转换，而且这个数字还在不断增加！</p><p id="5c1a" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">Power Query的关键优势在于，您只需很少或不需要任何编码技能就可以执行复杂的数据转换！此外，您在数据转换过程中应用的所有步骤都将被保存，因此每次刷新数据集时，这些步骤都将被自动应用以形成您的数据，并为通过报表进行消费做好准备。</p><p id="0d8d" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">Power Query的底层是一个Mashup引擎，它使您的数据整形能够顺利运行。Power Query使用非常强大的M语言进行数据操作。现在，你可能会问自己，这些关于数据整形、强大查询、Mashup引擎、M语言等等的故事是怎么回事。与查询折叠有关。我不怪你，这是一个公平的问题，但我们很快会回来回答它。</p><h2 id="83bf" class="mc md it bd me mf mg dn mh mi mj dp mk lz ml mm mn ma mo mp mq mb mr ms mt mu bi translated">什么是查询折叠？</h2><p id="af9c" class="pw-post-body-paragraph lc ld it lf b lg mv ju li lj mw jx ll lz mx lo lp ma my ls lt mb mz lw lx ly im bi translated">对于一些数据源，例如关系数据库，以及非关系数据源，例如OData、AD或Exchange，Mashup engine能够将M语言“翻译”成底层数据源能够“理解”的语言，在大多数情况下是SQL。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8cea1bf01265cf269844f0c33b04b252.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eNl6NWyHzRtnXzoTf8AMBw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.pexels.com/photo/black-cables-1054397/" rel="noopener ugc nofollow" target="_blank">https://www.pexels.com/photo/black-cables-1054397/</a></p></figure><p id="cdf1" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">通过将复杂的计算和转换直接推送到数据源，Power Query利用了健壮的关系数据库引擎的功能，这些引擎是为了以最有效的方式处理大量数据而构建的。</p><p id="645a" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">Power Query的Mashup引擎能够创建一个SQL语句，将您的转换背后的所有M语句组合起来，这就是我们所说的查询折叠。</p><p id="c544" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">或者，让我们简单地说:<strong class="lf iu"> <em class="le">如果Mashup引擎能够生成一个将要在数据源端执行的SQL查询，我们称该查询为</em> </strong>。</p><h2 id="d582" class="mc md it bd me mf mg dn mh mi mj dp mk lz ml mm mn ma mo mp mq mb mr ms mt mu bi translated">支持查询折叠的数据源</h2><p id="cd55" class="pw-post-body-paragraph lc ld it lf b lg mv ju li lj mw jx ll lz mx lo lp ma my ls lt mb mz lw lx ly im bi translated">如前所述，查询折叠最明显的受益者是关系数据库源，如SQL Server、Oracle或MySQL。然而，不仅仅是SQL数据库利用了查询折叠的概念。本质上，任何支持某种查询语言的数据源都可以利用查询折叠。其他数据源包括OData、SSAS、Sharepoint列表、Exchange和AD。</p><p id="a0a1" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">另一方面，当您使用Excel文件、BLOB存储文件、平面文件等数据源时。在Power BI数据集中，查询不能折叠。</p><h2 id="9736" class="mc md it bd me mf mg dn mh mi mj dp mk lz ml mm mn ma mo mp mq mb mr ms mt mu bi translated">支持查询折叠的数据转换</h2><p id="865f" class="pw-post-body-paragraph lc ld it lf b lg mv ju li lj mw jx ll lz mx lo lp ma my ls lt mb mz lw lx ly im bi translated">然而，对于一般支持查询折叠的数据源，重要的是要记住<strong class="lf iu">不是所有的转换</strong>都可以被折叠并推送到数据源。所以，要明确的是，SQL数据库支持查询折叠这一事实并不一定意味着您的查询会折叠！有一些强大的查询转换不能简单地推送到SQL数据库引擎。</p><p id="7c27" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">通常，Power查询转换中的一些细微差异可能对最终结果以及查询是否会折叠起决定性作用。在本系列的下一部分中，我将向您展示一些细微的区别。</p><p id="93cd" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">一般来说，在Power Query中应用以下转换时，可以将其“转换”为一条SQL语句:</p><ul class=""><li id="e4ca" class="nb nc it lf b lg lh lj lk lz nd ma ne mb nf ly ng nh ni nj bi translated">删除列</li><li id="fe34" class="nb nc it lf b lg nk lj nl lz nm ma nn mb no ly ng nh ni nj bi translated">重命名列</li><li id="971e" class="nb nc it lf b lg nk lj nl lz nm ma nn mb no ly ng nh ni nj bi translated">使用静态值或超级查询参数过滤行，因为它们被视为SQL中的WHERE子句谓词</li><li id="84f9" class="nb nc it lf b lg nk lj nl lz nm ma nn mb no ly ng nh ni nj bi translated">分组和汇总，这在SQL的Group by子句中是等价的</li><li id="803f" class="nb nc it lf b lg nk lj nl lz nm ma nn mb no ly ng nh ni nj bi translated">基于相同源的<strong class="lf iu">可折叠</strong>查询的合并——因为该操作可以转换为SQL中的JOIN。当我说合并可折叠查询时，这意味着如果您连接两个SQL server表，它将工作，但如果您尝试连接SQL表和Excel文件，它将不会工作</li><li id="c475" class="nb nc it lf b lg nk lj nl lz nm ma nn mb no ly ng nh ni nj bi translated">追加基于相同源的<strong class="lf iu">可折叠</strong>查询——该转换与SQL中的UNION ALL操作符相关</li><li id="51bd" class="nb nc it lf b lg nk lj nl lz nm ma nn mb no ly ng nh ni nj bi translated">用简单的逻辑添加自定义列。简单的逻辑是什么意思？使用在SQL语言中有等效项的M函数，例如数学函数或文本操作函数</li><li id="5a86" class="nb nc it lf b lg nk lj nl lz nm ma nn mb no ly ng nh ni nj bi translated">透视和取消透视转换</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/b9659724b16d001fe008b76887a504be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*VsjHi5ooI4f-EOYxplKHTA.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.pexels.com/photo/wood-red-industry-writing-3018978/" rel="noopener ugc nofollow" target="_blank">https://www . pexels . com/photo/wood-red-industry-writing-3018978/</a></p></figure><p id="ef85" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">另一方面，一些会阻止查询折叠的转换有:</p><ul class=""><li id="b486" class="nb nc it lf b lg lh lj lk lz nd ma ne mb nf ly ng nh ni nj bi translated">如前所述，合并基于不同来源的查询</li><li id="ed37" class="nb nc it lf b lg nk lj nl lz nm ma nn mb no ly ng nh ni nj bi translated">基于不同的源追加(联合)查询——与前一种情况类似的逻辑</li><li id="4d1b" class="nb nc it lf b lg nk lj nl lz nm ma nn mb no ly ng nh ni nj bi translated">添加具有复杂逻辑的自定义列，或者使用一些在SQL中没有对应项的M函数</li><li id="f0cd" class="nb nc it lf b lg nk lj nl lz nm ma nn mb no ly ng nh ni nj bi translated">添加索引列</li><li id="7c21" class="nb nc it lf b lg nk lj nl lz nm ma nn mb no ly ng nh ni nj bi translated">更改列数据类型。这是一个典型的“视情况而定”的案例。我将在本系列的下一部分向您展示它所依赖的东西，但是请记住，更改列数据类型可以是可折叠的和不可折叠的转换</li></ul><h2 id="d9fc" class="mc md it bd me mf mg dn mh mi mj dp mk lz ml mm mn ma mo mp mq mb mr ms mt mu bi translated">结论</h2><p id="25ef" class="pw-post-body-paragraph lc ld it lf b lg mv ju li lj mw jx ll lz mx lo lp ma my ls lt mb mz lw lx ly im bi translated">通过学习数据整形和Power查询，我们为理解Power BI中的查询折叠特性，或者更好地说是Power Query Editor中的查询折叠特性打下了坚实的理论基础。</p><p id="765c" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">在本系列的下一部分中，我们将研究为什么查询折叠如此重要，以及为什么我们应该关心查询是否折叠。我们还将学习如何检查查询是否折叠，以及为什么人们说细节决定成败…</p><p id="f751" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">感谢阅读！</p><p id="42ac" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><a class="ae ky" href="https://datamozart.medium.com/membership" rel="noopener">成为会员，阅读媒体上的每一个故事！</a></p><p id="40da" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">订阅<a class="ae ky" href="http://eepurl.com/gOH8iP" rel="noopener ugc nofollow" target="_blank">这里</a>获取更多有见地的数据文章！</p></div></div>    
</body>
</html>