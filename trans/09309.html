<html>
<head>
<title>Deep understanding of the ARIMA model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对ARIMA模式的深刻理解</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deep-understanding-of-the-arima-model-d3f0751fc709?source=collection_archive---------3-----------------------#2021-08-29">https://towardsdatascience.com/deep-understanding-of-the-arima-model-d3f0751fc709?source=collection_archive---------3-----------------------#2021-08-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="cc51" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="5e08" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">探索时间序列的特征——平稳性、稳定性、自相关性</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/4084278dcd685ba7ff3445a0885646a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UtLG2Al5bybvrRYguEnh8w.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片来自<a class="ae lh" href="https://unsplash.com/photos/rmM8V7L1BhM" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><h1 id="613e" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">时间序列快速介绍</h1><p id="b9a0" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">通常，时间序列预测模型可以写成</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/f6dffb6b3fbcf553e8c0b90d49055b58.png" data-original-src="https://miro.medium.com/v2/resize:fit:636/format:webp/1*6xXgZwP-9NUD70j02RQonQ.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">Eq 0.2时间序列预测模型的定义</p></figure><p id="0a30" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">其中，yₜ是要预测的变量(<a class="ae lh" href="https://en.wikipedia.org/wiki/Dependent_and_independent_variables" rel="noopener ugc nofollow" target="_blank">因变量</a>，或响应变量)，t是进行预测的时间，h是预测范围，Xₜ是在时间t用于进行预测的变量(<a class="ae lh" href="https://en.wikipedia.org/wiki/Dependent_and_independent_variables" rel="noopener ugc nofollow" target="_blank">自变量</a>)，θ是函数<em class="nc"> g </em>中参数的向量，εₜ₊ₕ表示误差。值得注意的是，观察到的数据根据观察时间是唯一有序的<em class="nc">，但它不必依赖于时间，即时间(观察值的指数)不必是独立变量之一。</em></p><h2 id="9ca9" class="nd lj it bd lk ne nf dn lo ng nh dp ls mj ni nj lu mn nk nl lw mr nm nn ly iz bi translated">时间序列的一些可能性质</h2><p id="b01a" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated"><strong class="mc jd">平稳性</strong>:平稳过程<em class="nc">是随机过程，其均值、方差和自相关结构不随时间变化。</em>它也可以用数学术语正式定义，但在本文中，这不是必需的。直观地说，如果一个时间序列是平稳的，我们看它们的一些部分，它们应该非常相似——时间序列看起来是平坦的，形状不取决于时间的变化。(快速查知识:f(t) = sin(t)是平稳过程吗？肯定不是，因为它不是随机的，平稳性不是它的属性之一)</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi no"><img src="../Images/69a9fd53b70e7128ad6386a63f13f3d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:690/format:webp/1*hA65GONtR9Sj4ryH0hxceA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图1.1平稳性示例。图片来自<a class="ae lh" href="https://www.wikiwand.com/en/White_noise" rel="noopener ugc nofollow" target="_blank">维基百科(白噪音)</a></p></figure><p id="b82e" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">图1.1显示了平稳过程的最简单的例子——白噪声。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi np"><img src="../Images/0574a40c1adf962e6ad4da723153c5fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*MjI0g2l1hRqBTMep2QawdA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图1.2非平稳时间序列示例。作者制作的图表。</p></figure><p id="7423" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">上图1.2显示了一个非平稳的时间序列。为什么会这样呢？我们可以看到明显的趋势，这意味着方差随着时间而变化。但是，如果我们使用线性回归拟合一条线(以捕捉趋势)并移除趋势，数据现在具有恒定的位置和方差，但由于周期行为，它仍然不是静止的，这不是随机的。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nq"><img src="../Images/b36ebd07fa81e9aad7c82bd6cf7ee868.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3cg9COProxB1wa0Zna70Sw.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图1.3(左)为原始数据拟合一条线，图1.4(右)为去除趋势后的结果。作者制作的图表</p></figure><p id="e6b3" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">使用ARMA对时间序列建模时，其中一个假设是数据是平稳的。</p><p id="dfa8" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated"><strong class="mc jd">季节性</strong>:季节性是<em class="nc">在短于一年的特定时间间隔内表现出某些变化的特性</em>(当然也可以是不同的时期。如果我们在一天中观察每小时的温度，并在几天内收集数据，那么这个周期就是一天，它也可能具有季节性-峰值可能出现在下午2点或3点。这意味着我们不必用常识在季节性的背景下解释<em class="nc">季节</em>)、月度、季度等。季节性时间序列的一个非常典型的例子是用电量，在夏季，用电量通常较高，例如，因为有空调。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/b03b0f454aefef3ac35ca8f8347c5d76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*sjBHk8NUguBS1MxmKTprQA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图1.5美国用电量的季节性曲线图。图片来自<a class="ae lh" href="https://en.wikipedia.org/wiki/Seasonality?oldformat=true" rel="noopener ugc nofollow" target="_blank">维基百科(季节性)</a></p></figure><p id="0055" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">图1.5显示了具有季节性的数据，我们可以很容易地看到，在7月和8月有一个用电高峰，在1月和12月有一个较小的高峰。图1.5中绘制的数据是美国从1973年到2010年的用电量。<code class="fe ns nt nu nv b">usmelec</code>是r中内置的数据集。整个期间的用电量如下所示</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/f651d4e3b52cfe3b1b03e631832bd54d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*T2Lm0q-vibpB1keWZ1sLrA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图1.6美国1973年至2010年的用电量。作者制作的图表</p></figure><p id="ece5" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">季节性的存在要求我们调整预测的方式。比如我们要卖空调，就需要用历年同季的销量来预测未来的月销量，而不是最接近的月份。</p><h1 id="b3a4" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">逐步定义ARIMA</h1><h2 id="ec93" class="nd lj it bd lk ne nf dn lo ng nh dp ls mj ni nj lu mn nk nl lw mr nm nn ly iz bi translated">技术说明:后移运算符</h2><p id="e9c9" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated"><em class="nc">这是什么？</em>它是一个将变量xₜ后移的算子，有时表示为b(后移),有时表示为l(滞后),在本文中，我们将采用符号b。它定义为</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/0effa0d1a6aad28e2be9ea274197da6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:230/format:webp/1*H1vggHd0FIao6393GJJTwA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">等式2.1后移算子的定义</p></figure><p id="d7e9" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">以及满足B⁻ B = 1的向前移位算子B⁻。</p><p id="f0c0" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated"><em class="nc">我们为什么需要这个？</em>这是因为它使我们能够以简洁的方式明确地回移——就多项式而言，这也有助于我们定义更复杂的模型。当我们用一个东西来表示数学中的某个东西时，看看它支持哪些运算总是很重要的。在这种情况下，我们很容易看到，后移运算符允许对它进行所有的算术运算:加、减、乘、除、取幂等。</p><p id="3ff6" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">这意味着，例如，在xₜ上使用<em class="nc">运算符</em> (1-B)得到xₜ-xₜ₋₁的差，如果我们想再次得到xₜ和xₜ₋₁的差，我们在xₜ上使用<em class="nc">运算符</em> (1-B)，得到(1–2 b+b)xₜ= xₜ-2xₜ₋₁+ xₜ₋₂.这和(xₜ-xₜ₋₁)-(xₜ₋₁-xₜ₋₂).)是一样的在这个例子中，我们遇到了一阶和二阶差分(方程2.12，2.13)，这将在后面解释。</p><h2 id="e007" class="nd lj it bd lk ne nf dn lo ng nh dp ls mj ni nj lu mn nk nl lw mr nm nn ly iz bi translated">自回归模型</h2><p id="1a79" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">阶为p的自回归模型，缩写为<strong class="mc jd"> AP(p)，将当前值建模为先前p值</strong>的线性组合。这个模型就是这样得名的，它本身就是一个线性回归。我们在定义中看到了很多术语，但该模型仍然被认为是<em class="nc">单变量</em>，因为当前值取决于其过去值。这些值是同一变量在不同时间点的值，所以毕竟只涉及一个变量。更一般化的模型是<em class="nc"> VAR </em>(向量自回归)，允许多元时间序列。形式上,(单变量)自回归模型被定义为</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/f9aa5606324c324dd1edca2cbdf47c69.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*UOJnJvmpf-AsfKDuvlvR_g.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">情商。2.2自回归模型的正式定义</p></figure><p id="a1f8" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">其中wₜ ~ wn(0，σᵥᵥ)，ϕ₁，ϕ₂,…，ϕp (ϕp ≠ 0)为参数。wn表示“白噪声”，它具有均值为0且方差为σᵥᵥ的正态分布。有时方程2.2的右边也有一个常数，用c表示(<a class="ae lh" href="https://otexts.com/fpp2/AR.html" rel="noopener ugc nofollow" target="_blank"> <em class="nc">预测:原理与实践第8.3章</em> </a>)。常量所起的作用将在<strong class="mc jd"> ARIMA </strong>小节中解释。</p><p id="ee4e" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">根据后移算子，自回归模型被定义为</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/61c8bce4e4139ce3c694de55b5c2cfe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*_SsRoHvEzt4RrC-oHx7h8A.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">等式2.3使用后移运算符定义AR模型</p></figure><h2 id="b77b" class="nd lj it bd lk ne nf dn lo ng nh dp ls mj ni nj lu mn nk nl lw mr nm nn ly iz bi translated">移动平均模型</h2><p id="4547" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">q阶移动平均模型，缩写为<strong class="mc jd"> MA(q)，将当前值建模为前面q个误差项</strong>的线性组合(与自回归模型不同，在移动平均中，关注的是<em class="nc">误差项</em>)。形式上，它被定义为</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/1cc2c081543cb6b9db45b078d9d6320f.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*1-BZnlwqwFKEcV7pRYNN_Q.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">情商。2.4移动平均线模型的正式定义</p></figure><p id="b306" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">其中wₜ ~ wn(0，σᵥᵥ)，θ₁，θ₂,…，θq (θq ≠ 0)为参数。wn表示“白噪声”，它具有均值为0且方差为σᵥᵥ的正态分布，类似于自回归模型的定义。这也是一个单变量模型。也可以在定义中添加一个常数(<a class="ae lh" href="https://otexts.com/fpp2/MA.html" rel="noopener ugc nofollow" target="_blank"> <em class="nc">预测:原理与实践第8.4章</em> </a>)。</p><p id="031f" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">根据后移运算符，移动平均模型可以定义为</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/bb8076e75cd83077e06964172bc7bbed.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*Is8pESaD3qoLPOvi68_bCg.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">等式2.5使用后移运算符定义MA模型</p></figure><p id="c798" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">与自回归模型不同，这种移动平均模型的名字并不那么明显。根据第48页的脚注<em class="nc">单变量Box-Jenkins模型预测(2009)</em>:Pankratz的概念和案例:<em class="nc">“标签‘移动平均’在技术上是不正确的，因为MA系数可能为负，且总和可能不为1。这个标签是约定俗成的。”</em></p><p id="b32b" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">另一个令人困惑的事情是一个看起来像移动平均模型的概念，<em class="nc">移动平均</em>，又名滚动平均或移动平均，用于<em class="nc">平滑时间序列</em>。事实上，它是一个完全不同的工具——它不是用来预测的。我们用简单移动平均线的例子来说明这一点</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/afd9d4a89959bc45f1bc0b582b8658a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*FlglvazGnLMmEH6OrDTWnw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">等式2.6，2.7简单移动平均线</p></figure><p id="cbde" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">观察公式后，我们可以看到，我们需要第k个值来计算第k个移动平均线。</p><h2 id="d4af" class="nd lj it bd lk ne nf dn lo ng nh dp ls mj ni nj lu mn nk nl lw mr nm nn ly iz bi translated">自回归移动平均模型</h2><p id="7fae" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">ARMA模型是<strong class="mc jd">AR和MA </strong>的组合，相当自明。ARMA考虑了过去的值和过去的误差项，并用两个多项式描述了(弱)平稳随机过程。形式上，如果时间序列是平稳的并且</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi od"><img src="../Images/9be41bdceeb94bf1cbe328ebc03c5982.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*Jz3Eu9lzv5WqGikbLv9Tkw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">方程2.8 ARMA的正式定义</p></figure><p id="24af" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">其中ϕp ≠ 0，θq ≠ 0，wₜ ~ wn(0，σᵥᵥ)，σᵥᵥ &gt; 0。如前所述，参数p和q分别是自回归阶和移动平均阶。就后移算子而言，ARIMA模型可以写成</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/aefb3a80b688d985731e0e8908185650.png" data-original-src="https://miro.medium.com/v2/resize:fit:322/format:webp/1*2Nz1SL74FZpvRHW8xC4ChQ.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">等式2.9根据后移算子定义的ARIMA模型</p></figure><p id="ddb0" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">这种重写并不简单。它揭示了模型中可能出现的一个严重问题— <em class="nc">参数的冗余</em>。如果多项式ϕ(b = 0和θ(B) = 0有公共因子，那么模型将包含冗余参数。这将使模型变得非常复杂。什么时候会出现这种情况？当我们试图用ARMA(1，1)模型拟合一个白噪声序列(xₜ = wₜ)时，程序会这样做，但我们得到的模型会有多余的参数。因此，我们需要去除冗余以简化模型，并且可以使用协方差分析来去除冗余。</p><p id="cd90" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">等式2.8所示的定义是<em class="nc">非季节性</em> ARMA。但经常发生的是，数据是季节性的。如果我们想消除季节性，我们应该怎么做？答案是引入一个滞后<em class="nc"> h(季节周期的长度)</em>，这就引出了季节ARMA (SARMA)，记为ARMA(P，Q)ₕ)，其形式为</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi np"><img src="../Images/e09f986a7b52b2a66c71cfc74312770b.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*hzHLqZduedPJLDrp7g69sw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">方程2.10季节性ARMA的定义</p></figure><p id="c355" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">这种去除季节效应的方法对应于我们之前描述过的:<em class="nc">利用八月份的数据预测八月份的销售额</em>。h应该等于什么？这取决于季节性的频率，例如，如果季节性变化在一年中的某些特定月份出现一次，则h = 12，如果它在一年的每个季度出现一次，则h = 4。如果我们将季节性ARMA和非季节性ARMA结合起来(将季节性和非季节性算子相乘)，我们将得到一层概括——混合季节ARMA。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi of"><img src="../Images/af300c1465851c6250a304bb9b22d78d.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/format:webp/1*1T4ZS5Deojjg6qDC-t-Lkw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">混合季节ARMA模型</p></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi og"><img src="../Images/0ac89448b488de56936d0990778834f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:422/format:webp/1*Qp7jDyf0srRxvXEZUBcQvg.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">混合季节ARMA的符号</p></figure><h2 id="e92f" class="nd lj it bd lk ne nf dn lo ng nh dp ls mj ni nj lu mn nk nl lw mr nm nn ly iz bi translated">自回归综合移动平均(ARIMA)模型</h2><p id="fdb9" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">ARIMA模型是基于差分序列的ARMA模型，<strong class="mc jd">差分</strong>有时也称为<strong class="mc jd"/>。那么什么是差异呢？它是一种去除序列非平稳性的技术(这种技术去除了非恒定趋势，这意味着它只产生均值平稳性，而不是方差)。它取两次观察的差值。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/e4d14f12e306ded46c918ac883f2ced3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*4SKDXHtr6f2FhEzUhmdRTA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">等式2.12和等式2.13的区别</p></figure><p id="ff2a" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">当然，我们可以多次改变观测值。等式2.12和等式2.13给出了一阶差分和二阶差分的例子。显而易见，差分不同于微分——差分只是<em class="nc">取差</em>，同时，微分<em class="nc">计算变化率</em>。ARIMA模型通常用ARIMA(p，d，q)来表示，参数的含义总结如下表</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oi"><img src="../Images/53145ebc18f5fb920bd75880b22c2f47.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*XXCS3cdbN5YvmzrBms_fOg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">标签。2.1模型中的参数。(作者自制)</p></figure><p id="899d" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">现在是时候介绍ARIMA模型的正式定义了，</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/d11b565b31d5c8a243239c6b4e8d3054.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*CAgvezF7cfwJE-5-1R2rJw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">方程2.14 ARIMA模型的定义</p></figure><p id="c22c" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">在yₜ'表示差分序列的地方，其他参数的定义方式与ARMA模型中的相同。如前所述，可以将一个常数添加到模型中，该常数表示<em class="nc">漂移</em>。通过涉及ARIMA(0，1，0)模型(没有自回归或移动平均项，使用一阶差分建模)的示例，可以很容易理解:</p><p id="9ae8" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">无参数:模型是xₜ = xₜ₋₁ + εₜ，是随机游走。</p><p id="0301" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">带参数:模型为xₜ = c+ xₜ₋₁ + εₜ.这是一个有漂移的随机游走。</p><p id="72fb" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated"><em class="nc">常量为过程增加了非常量趋势。</em>(这句话看起来很诡异，但是我们需要注意的是，公式xₜ = c+ xₜ₋₁+ εₜ是递归的，在每次解出一个常数的时候用stack up)这个常数有多大的影响力？很多。我们可以从两个随机行走的模拟中看到这一点，一个有漂移，一个没有漂移</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/2cd0455e31b5ee75e2cab5aea8d6574b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*hSHZLGoj8FCLxQ-YKkds2A.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图2.1无漂移(左)和有漂移(右)的随机游走模拟。作者制作的图表。</p></figure><p id="a6c2" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">然而，这种差异并没有考虑到季节性。为了消除季节性，我们需要考虑季节性差异(xₜ和xₜ₋ₕ之间的差异)，这就带来了季节性自回归综合移动平均(SARIMA)模型。萨里玛和SARMA之间的关系非常类似于ARIMA和ARMA之间的关系——萨里玛是有差异的SARMA，但现在我们不仅需要考虑非季节性差异，还需要考虑季节性差异。我们用<strong class="mc jd"> ▽ </strong> ᴰ和<strong class="mc jd"> ▽ </strong> ᵈ分别表示季节性差异和非季节性差异。<em class="nc"> D </em>是季节差异的程度。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/a2eb416315bc61155d3af8ab8da2c916.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/1*-zw9lV61EqUAxcgTooB3Mg.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">情商。2.15季节性ARIMA模型</p></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi om"><img src="../Images/c2a914d3f6e3dfe8cd2206ebff2ca9b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:530/format:webp/1*kAb8DmWxRCsO3Xqi_n3uBg.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">季节性ARIMA的符号</p></figure><h1 id="0ae6" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">实践中的ARIMA</h1><p id="8af5" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">如圣经<em class="nc">预测:原则和实践</em>中所述，有一种<a class="ae lh" href="https://otexts.com/fpp2/arima-r.html#modelling-procedure" rel="noopener ugc nofollow" target="_blank">拟合ARIMA模型的一般方法</a>:预处理，直到数据变得稳定；提供给计算ARIMA模型的函数；比较模型；检查结果(残差)；如果不够好，迭代，否则使用结果模型做预测。</p><p id="29fb" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">在R中，使用<em class="nc">最大似然估计</em> (MLE)来估计参数，最大化似然函数。在给定我们的模型的参数(ϕ，θ，…)的情况下，可能性等于产生观察值x的概率。为了比较这些模型，使用了<em class="nc"> Akaike信息标准</em> (AIC)，该标准评估了信息的损失，也惩罚了模型的复杂性(估计参数的数量)。我们选择具有最小AIC值的模型。</p><h2 id="c761" class="nd lj it bd lk ne nf dn lo ng nh dp ls mj ni nj lu mn nk nl lw mr nm nn ly iz bi translated">自动化的</h2><p id="b40c" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">如果我们想要使用一个自动化的过程来构建模型，函数<code class="fe ns nt nu nv b">auto.arima</code>就在我们的支配之下。它使用分步过程(Hyndman-Khandakar算法)来有效地遍历模型空间。函数<code class="fe ns nt nu nv b">auto.arima</code>负责对数据进行差分以使数据稳定(是否d = 0)，选择超参数，并根据AIC选择最佳模型。</p><p id="4f96" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">我们用去年8月16日到今年8月26日的油价来展示自动化的ARIMA过程。我们想要实现的是使用2020年8月16日至2021年8月16日的数据来预测未来10天的油价，然后将结果与真实值进行比较。(在本文中，目的主要是向读者介绍ARIMA模型的原理，所以这实际上是一个粗略的股票预测，像回溯测试之类的东西不包括在内)</p><pre class="ks kt ku kv gt on nv oo op aw oq bi"><span id="b5d2" class="nd lj it nv b gy or os l ot ou"># read data<br/># Datasource: <a class="ae lh" href="https://finance.yahoo.com/quote/OIL/history?p=OIL" rel="noopener ugc nofollow" target="_blank">https://finance.yahoo.com/quote/OIL/history?p=OIL</a><br/>dataOil &lt;- read.csv2(file = "data/OIL.csv", sep=",")<br/>head(dataOil)</span><span id="93d8" class="nd lj it nv b gy ov os l ot ou"># split into training and test data<br/>lenOil &lt;- nrow(dataOil)<br/>trainSize &lt;- ceiling(lenOil-10)</span><span id="2205" class="nd lj it nv b gy ov os l ot ou"># take the first 12 month <br/>train.oil &lt;- dataOil[1:trainSize, ]<br/>test.oil &lt;- slice_tail(dataOil, n=lenOil-trainSize)</span><span id="009d" class="nd lj it nv b gy ov os l ot ou"># convert to time series<br/>train.close &lt;- train.oil$Close<br/>train.close &lt;- as.numeric(train.close)</span><span id="dc72" class="nd lj it nv b gy ov os l ot ou"># frequency is set to be one because we have only one year of data<br/>train.close.ts &lt;- ts(data=train.close, frequency=1)</span><span id="0311" class="nd lj it nv b gy ov os l ot ou"># plot the training data <br/>plot(train.close, type='l', ylab='Close price', main="One year oil price")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ow"><img src="../Images/4c777d18051c827ba299375a036de128.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*dGc09EVRm5umBnI7kVjzag.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图3.1 2020年8月26日至2021年8月26日油价</p></figure><p id="0534" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">显然，我们可以看到一个趋势，时间序列不是平稳的，但没有变化方差的证据，所以我们不准备做任何转换。模型构建的其余部分由<code class="fe ns nt nu nv b">auto.arima.</code>负责，但我们需要做的是检查残差，以确保它们看起来像随机噪声，这部分由<code class="fe ns nt nu nv b">checkresiduals</code>完成，它应用了永盒测试。如果Ljung-Box检验<em class="nc">的p值</em>大于0.05，我们<strong class="mc jd">不能拒绝</strong>残差独立分布<em class="nc">的零假设</em>。因此，这个模型是可接受的，否则，我们将需要选择一个新的。</p><pre class="ks kt ku kv gt on nv oo op aw oq bi"><span id="1aa9" class="nd lj it nv b gy or os l ot ou">start &lt;- length(train.close.ts)<br/>test.index &lt;- seq(start, start+9)<br/>test.close &lt;- as.numeric(test.oil$Close)</span><span id="382e" class="nd lj it nv b gy ov os l ot ou">aa.train &lt;- auto.arima(train.close.ts) <br/># --&gt; AIC = 157.11<br/>checkresiduals(aa.train)<br/># --&gt; p-value = 0.07454</span><span id="c2c7" class="nd lj it nv b gy ov os l ot ou">plot(forecast(aa.train, h=10))<br/>lines(test.index, test.close)</span></pre><p id="8a47" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">与8月17日至8月26日(过去10天)的油价实际值相比，结果如下。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/1e416cddc00def1fe5f45eea62a0ff7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*anDZzgSVktNrwXo61Aq2jA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图3.2预测结果</p></figure><h2 id="e156" class="nd lj it bd lk ne nf dn lo ng nh dp ls mj ni nj lu mn nk nl lw mr nm nn ly iz bi translated">客户模型</h2><p id="9fbb" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">自动化过程可能无法找到适合我们的模型。如果它没有通过永盒测试，我们需要自己选择超参数。因此，有时我们可能需要选择自己的模型(使用<code class="fe ns nt nu nv b">Arima</code>)。与自动化流程相比，为了使用我们自己的模型，除了之外<em class="nc">我们还需要做什么？首先，在观察数据之后，我们需要考察数据的偏相关。(要了解更多关于偏相关的信息<a class="ae lh" rel="noopener" target="_blank" href="/partial-correlation-508353cd8b5">点击这里</a>)。</em></p><pre class="ks kt ku kv gt on nv oo op aw oq bi"><span id="a8b0" class="nd lj it nv b gy or os l ot ou"># plot the partial difference <br/>dif.train &lt;- difference(train.close.ts)<br/>ggtsdisplay(dif.train, plot.type='partial')</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/9cc1f4c3c02f3b88c29c3275586decef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*5rbpulEJyjkYqCyNR0Kg4w.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图3.3一阶差分、自相关和偏自相关</p></figure><p id="6145" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">图中所示的差看起来相当稳定，因此我们将只使用一阶差。但是我们仍然可以执行单位根测试来检查平稳性。对此，我们有几个备选方案，这里我们使用扩展的迪基-富勒测试(ADF，在R中它是<code class="fe ns nt nu nv b">adf.test</code>，如果我们设置<code class="fe ns nt nu nv b">k=0</code>，那么它就变成简单的迪基-富勒测试)。</p><pre class="ks kt ku kv gt on nv oo op aw oq bi"><span id="e152" class="nd lj it nv b gy or os l ot ou"># ADF test<br/>dif.train &lt;- na.remove(dif.train)<br/>adf.test(dif.train)<br/># --&gt; p-value smaller than 0.01</span></pre><p id="c480" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">根据结果，我们可以<strong class="mc jd">拒绝</strong>一阶差分为 <strong class="mc jd"> <em class="nc">非平稳</em> </strong>的零假设。因此我们设置<strong class="mc jd"> d=1 </strong>。根据偏自协方差，显示<em class="nc">平稳时间序列与其自身的滞后值之间的相关性，消除了更短滞后的影响</em>，变量xₜ与xₜ₊₄相关，那么我们可以尝试设置<strong class="mc jd"> p = 4 </strong>。剩下的就是<strong class="mc jd"> q </strong>了，我们可以从0开始尝试，逐渐增加。至于季节性，它并没有真正显示在图表中，因此我们可以将<strong class="mc jd">季节性</strong> (P，D，Q)的参数保留为缺省值0。应该加漂移吗？从图3.2中的增加趋势来看，似乎是的，我们可以将<code class="fe ns nt nu nv b">include.drift</code>设为真。</p><pre class="ks kt ku kv gt on nv oo op aw oq bi"><span id="3a7f" class="nd lj it nv b gy or os l ot ou"># manually try the different parameters<br/>fit.m1 &lt;- Arima(train.close.ts, order=c(4,1,0), include.drift=TRUE)<br/>fit.m1<br/># --&gt; AIC = 156.15</span><span id="9808" class="nd lj it nv b gy ov os l ot ou">fit.m2 &lt;- Arima(train.close.ts, order=c(4,1,1), include.drift=TRUE)<br/>fit.m2<br/># --&gt; AIC = 157.61 <br/># after trying some more other values of q, we will find out<br/># that increasing q doesn't really decrease the AIC</span><span id="9671" class="nd lj it nv b gy ov os l ot ou">checkresiduals(fit.m1)<br/># --&gt; p-value = 0.4187</span><span id="0047" class="nd lj it nv b gy ov os l ot ou">plot(forecast(fit.m1, h=10))<br/>lines(test.index, test.close)</span></pre><p id="e294" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">我们的定制模型具有稍低的AIC值，然而该图看起来几乎与图3.2所示的相同。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/6694201c99198146cb2f27d247cc9b16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*WjkFTflJze_pPjHI-DMPHw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图3.4预测-定制模型的结果</p></figure><p id="f41a" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated"><em class="nc">总结</em></p><p id="1a76" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">在这篇文章中，首先，我们快速地介绍了时间序列的形式定义和时间序列中可能出现的一些典型性质。之后，随着ARMA和ARIMA的扩展——季节性ARMA (SARMA)和季节性ARIMA(萨里玛)，我们逐渐熟悉了ARIMA的定义。最后，我们建立了一个模型，对油价进行了自动和人工的短期预测。</p></div><div class="ab cl ox oy hx oz" role="separator"><span class="pa bw bk pb pc pd"/><span class="pa bw bk pb pc pd"/><span class="pa bw bk pb pc"/></div><div class="im in io ip iq"><h2 id="43e1" class="nd lj it bd lk ne nf dn lo ng nh dp ls mj ni nj lu mn nk nl lw mr nm nn ly iz bi translated">参考</h2><p id="12c8" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">[1]<em class="nc">NIST/sema tech</em><a class="ae lh" href="http://www.itl.nist.gov/div898/handbook/" rel="noopener ugc nofollow" target="_blank"><em class="nc">电子版统计方法手册</em> </a> <em class="nc"> </em> (2012)。</p><p id="02ed" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">[2]沃森，M. W. <a class="ae lh" href="https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.86.4466&amp;rep=rep1&amp;type=pdf" rel="noopener ugc nofollow" target="_blank">时间序列:经济预测</a> (2001)。<em class="nc">国际社会百科全书&amp;行为科学</em>，15721–15724。</p><p id="ece3" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">[3] Hyndman，R. J .，&amp; Athanasopoulos，G. <a class="ae lh" href="https://books.google.cz/books?hl=cs&amp;lr=&amp;id=_bBhDwAAQBAJ&amp;oi=fnd&amp;pg=PA7&amp;dq=Forecasting:+principles+and+practice&amp;ots=TihVtkUMHK&amp;sig=74BT_4wjk6Q81fVs9mX0RQgiVeE&amp;redir_esc=y#v=onepage&amp;q=Forecasting%3A%20principles%20and%20practice&amp;f=false" rel="noopener ugc nofollow" target="_blank"> <em class="nc">预测:原理与实践</em> </a> <em class="nc"> </em> (2018)。OTexts。</p><p id="5849" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">[4] Pankratz，A. (2009年)。<a class="ae lh" href="https://books.google.cz/books?hl=cs&amp;lr=&amp;id=4wlg2wtgEHYC&amp;oi=fnd&amp;pg=PP2&amp;dq=Forecasting+with+univariate+Box-Jenkins+models:+Concepts+and+cases&amp;ots=8RLy7Wrb3E&amp;sig=U0iEQ3_AItJ3zcCB4MpPhcu0vgs&amp;redir_esc=y#v=onepage&amp;q=Forecasting%20with%20univariate%20Box-Jenkins%20models%3A%20Concepts%20and%20cases&amp;f=false" rel="noopener ugc nofollow" target="_blank"> <em class="nc">单变量Box-Jenkins模型预测:概念与案例</em> </a>(第224卷)。约翰·威利的儿子们。</p><p id="4ed2" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">[5] Hyndman，R. J .，&amp; Khandakar，Y. (2008年)。<a class="ae lh" href="https://www.jstatsoft.org/article/view/v027i03" rel="noopener ugc nofollow" target="_blank">自动时间序列预测:R </a>的预测包。<em class="nc">统计软件杂志</em>，<em class="nc"> 27 </em> (1)，1–22。</p><p id="875e" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">[6]埃尼，D. (2015年)。<a class="ae lh" href="http://scirp.org/html/59043_59043.htm" rel="noopener ugc nofollow" target="_blank">尼日利亚瓦里镇降雨量的季节性ARIMA建模和预测</a>。<em class="nc">地球科学与环境保护杂志</em>，<em class="nc"> 3 </em> (06)，91。</p><p id="c23b" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated">【7】<a class="ae lh" href="https://en.wikipedia.org/wiki/Autoregressive_integrated_moving_average?oldformat=true" rel="noopener ugc nofollow" target="_blank">自回归综合移动平均线</a>。(2021年4月29日)。在<em class="nc">维基百科</em>里。</p></div><div class="ab cl ox oy hx oz" role="separator"><span class="pa bw bk pb pc pd"/><span class="pa bw bk pb pc pd"/><span class="pa bw bk pb pc"/></div><div class="im in io ip iq"><p id="a0ff" class="pw-post-body-paragraph ma mb it mc b md mx kd mf mg my kg mi mj mz ml mm mn na mp mq mr nb mt mu mv im bi translated"><a class="ae lh" href="https://medium.com/science-and-philosophy/subjectivism-in-decision-science-926c29feb7bb" rel="noopener">我对建模和预测哲学的一些看法</a>:)</p></div></div>    
</body>
</html>