<html>
<head>
<title>Python-Powered Monte Carlo Simulations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python支持的蒙特卡罗模拟</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-powered-monte-carlo-simulations-fc3c71b5b83f?source=collection_archive---------6-----------------------#2021-10-25">https://towardsdatascience.com/python-powered-monte-carlo-simulations-fc3c71b5b83f?source=collection_archive---------6-----------------------#2021-10-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="aff8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用SciPy的概率分布进行情景分析</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/21a81316a792c0b6f27d5f287d61fcce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*gCRARkScH72rwQ__YFGkxw.jpeg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">蒙特卡洛，<a class="ae ku" href="https://pixabay.com/photos/architecture-fly-big-city-boats-5072768/" rel="noopener ugc nofollow" target="_blank">图片</a>由<a class="ae ku" href="https://pixabay.com/users/16018388-16018388/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=5072768" rel="noopener ugc nofollow" target="_blank">卢卡·阮</a>来自<a class="ae ku" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=5072768" rel="noopener ugc nofollow" target="_blank">皮克斯拜</a>，免费用于商业用途</p></figure><p id="f0b2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">本教程将演示如何在Python中建立蒙特卡罗模拟模型。我们将:</p><ul class=""><li id="fac6" class="lr ls it kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">使用SciPy的内置分布，具体来说:正态、贝塔、威布尔；</li><li id="8ea7" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">为beta-PERT分布添加新的分布子类；</li><li id="912a" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">用拉丁超立方体抽样抽取随机数；</li><li id="7ddb" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">并建立三个蒙特卡罗仿真模型。</li></ul><h1 id="eac7" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">0.属国</h1><p id="543c" class="pw-post-body-paragraph kv kw it kx b ky mx ju la lb my jx ld le mz lg lh li na lk ll lm nb lo lp lq im bi translated">除了我们的全天候包pandas和numpy之外，该脚本还导入了SciPy的<em class="nc"> stats </em>库。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h1 id="c632" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">蒙特卡罗模拟的概念</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/76db728967ee176109a94256f5687c73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*JjZ0-osEmcs7mv-FeYsC6Q.jpeg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated"><a class="ae ku" href="https://pixabay.com/photos/game-bank-casino-monte-carlo-monaco-188882/" rel="noopener ugc nofollow" target="_blank">图片</a>由<a class="ae ku" href="https://pixabay.com/users/hans-2/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=188882" rel="noopener ugc nofollow" target="_blank">汉斯·布拉克斯米尔</a>从<a class="ae ku" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=188882" rel="noopener ugc nofollow" target="_blank">皮克斯拜</a>获得，免费用于商业用途</p></figure><p id="aaa4" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">蒙特卡罗(MC)方法</strong>是一种模拟技术，为模型的<em class="nc">输出</em>变量构建概率分布，其中一些<em class="nc">输入</em>参数是随机变量。MC方法有时被称为<em class="nc">多概率模拟</em>技术，因为它整合了多个随机变量，而这些变量的综合效应很难用封闭形式的方程来描述。</p><p id="5f3a" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">20世纪40年代末，约翰·冯·诺依曼和斯坦尼斯劳·乌姆在洛斯阿拉莫斯实验室工作时发明了MC方法。当他们试图应用确定性方法计算中子碰撞时，他们走进了死胡同。乌姆的想法是使用随机抽样，由早期的“超级计算机”ENIAC支持，以获得近似解。政府保密条例规定了一个代号；冯·诺伊曼和乌姆的一位同事建议把这个地方命名为<em class="nc">蒙特卡洛</em>，乌姆的叔叔在二战前经常去那里的赌场:他“只是必须去蒙特卡洛”赌博。(<a class="ae ku" href="https://en.wikipedia.org/wiki/Stanislaw_Ulam" rel="noopener ugc nofollow" target="_blank"> U </a>日<a class="ae ku" href="https://en.wikipedia.org/wiki/Stanislaw_Ulam" rel="noopener ugc nofollow" target="_blank">上午)</a></p><p id="11eb" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">MC模拟问题的一个例子:一个企业想要模拟一个新产品的未来成功，并建立如下的模拟模型:</p><ul class=""><li id="f470" class="lr ls it kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">预期销售量，v，作为一个随机变量，遵循beta-PERT分布，从3点估计值得出；</li><li id="a239" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">产品的价格p将通过谈判确定——一些客户可能会要求批量折扣或提前付款折扣；计划者决定将公司将实现的平均价格的不确定性建模为平均值为20、标准差为2的正态随机变量；</li><li id="bc1d" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">产品的原材料成本m将受到即将到来的供应商价格上涨的影响，由另一个正态分布来估计；</li><li id="7e01" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">该模型应该提供多种结果:收入，利润，总成本。</li></ul><p id="5b58" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">一般来说，模拟模型采用被定义为随机变量的输入参数；然后，它返回每个输出变量的概率分布，每个变量都是其输入参数的函数。该函数可以是简单的和或积、输入的指数运算，或者——我们将在示例中看到——包含嵌套随机变量的高阶函数。目标变量将显示一个密度函数，描述输入变量的分布如何相互作用。</p><p id="133c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">仿真模型通过从输入分布中采样来导出输出分布。1，000或100，000次迭代提供了描述每个输入变量行为的数据点。输出变量的等式将这些输入转换为输出变量的尽可能多的样本。一旦我们获得了这个样本，我们就可以像任何内置的SciPy分布一样检查它的模式——它的平均值、分位数和离群值倾向。</p><h1 id="696b" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">2.拉丁超立方体采样</h1><p id="460c" class="pw-post-body-paragraph kv kw it kx b ky mx ju la lb my jx ld le mz lg lh li na lk ll lm nb lo lp lq im bi translated">NumPy的<em class="nc"> random </em>库提供了用统一随机数填充数组的方法。SciPy的每个分发对象都带有生成随机变量的<em class="nc"> rvs() </em>方法。然而，蒙特卡罗模拟需要大量的随机数，对于这种情况，<em class="nc">分层抽样</em>方法，如<strong class="kx iu">拉丁超立方体抽样(LHS) </strong>是更好的方法。</p><p id="1949" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">LHS将样本空间分成不重叠的单元，每个单元具有相等的概率。LHS确保从样本空间的完整范围内更均匀地抽取随机数。它防止采样随机数的<em class="nc">聚集</em>，这会扭曲频率曲线。LHS样本将导致更精确的模拟结果。这将导致更低的标准误差，更少的迭代。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="7fcd" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">出于演示的目的，我们使用SciPy的LatinHyperCube采样器创建了一个由10个随机数组成的小数组。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/3130d47e6c146c0968e0498be93edd77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*dgEOXobh1peYYw19xY1m_Q.png"/></div></figure><p id="d09c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">制服(0；1)随机数在生成之后，可以被重新缩放以填充更大的范围，例如在0和100之间。然而，对于我们的目的，0到1之间的标准随机数满足要求。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ng"><img src="../Images/4fc69ee3b34463c3b8bee58ae45a96eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hZSYXVZKRU9fBfQYgmd-bA.png"/></div></div></figure><p id="ab42" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在下一章中，我们将使用LHS样本来生成特定分布的随机变量:PERT、正态和威布尔函数。</p><h1 id="c6ef" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">3.模拟中模拟不确定性的概率分布</h1><h2 id="dde5" class="nl mg it bd mh nm nn dn ml no np dp mp le nq nr mr li ns nt mt lm nu nv mv nw bi translated">3.1用于专家评估建模的PERT分布</h2><p id="fcdf" class="pw-post-body-paragraph kv kw it kx b ky mx ju la lb my jx ld le mz lg lh li na lk ll lm nb lo lp lq im bi translated">我的上一篇文章“用beta-PERT分布对专家评估建模”是一篇教程，解释了<strong class="kx iu"> PERT分布</strong> ( <a class="ae ku" rel="noopener" target="_blank" href="/python-scenario-analysis-modeling-expert-estimates-with-the-beta-pert-distribution-22a5e90cfa79"> Python场景分析:用beta-PERT分布对专家评估建模|走向数据科学</a>)。</p><p id="90f7" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果一个领域、过程或行业专家可以为一个随机过程提供所谓的<em class="nc">三点估计</em>(<a class="ae ku" href="https://en.wikipedia.org/wiki/Three-point_estimation" rel="noopener ugc nofollow" target="_blank">三点估计</a>),包括最坏情况、可能情况和最好情况的结果，那么pert函数就可以将这些点连接起来，这是非常确切的。它会将这些点转化为概率分布，我们可以将它分配给模拟模型中的随机变量。</p><p id="8423" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">SciPy的123个分布目录不包含PERT函数。因此，我们将其创建为继承自SciPy的<em class="nc"> rv_continuous </em>父类的新子类。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="fc71" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">对于我们的例子，我们用四个参数来实例化PERT子类，这四个参数预测新产品的销售量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="97df" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们选择这个PERT分布来模拟预期的销售数量，最有可能的值是12，000个单位，最小为8，000个单位，最大为18，000个单位。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/701277ee41939cf85cc577382cdb8a4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:526/format:webp/1*t3PaZqkBDZw5cVieoYYKGQ.png"/></div></figure><p id="495f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">其平均预期值将为12，333个销售单位。它有一个小的正偏度，仍然类似于正态分布；和-0.62的中度负过度峰度，这使其成为一个宽峰或大体积分布，其尾部的异常值比正态分布少。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="5842" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">第3行抽取N=10，000个均匀随机变量的LHS样本。然后第4行将该数组作为其输入参数。<em class="nc">百分点</em> <em class="nc">函数ppf() </em>将10，000个标准统一数字解释为概率，并计算10，000个PERT分位数，用这些分位数填充数组randP。</p><p id="b5f2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">直方图显示了模拟的PERT分布的形状。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/eb905076cf88e9052d0216aa57dc1f38.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*1frzg6Ad_0VgB7ULjpRe6Q.png"/></div></figure><h2 id="efb2" class="nl mg it bd mh nm nn dn ml no np dp mp le nq nr mr li ns nt mt lm nu nv mv nw bi translated">3.2正态分布</h2><p id="05fa" class="pw-post-body-paragraph kv kw it kx b ky mx ju la lb my jx ld le mz lg lh li na lk ll lm nb lo lp lq im bi translated">我们应用相同的方法(减去创建新的分布子类的需要)从正态分布中抽取10，000个LHS样本，我们期望这些样本反映销售价格和原材料单位成本中固有的不确定性。平均售价将为€ 20，标准差为€ 2。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/15944537feadd9394a94b2144336de7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:614/format:webp/1*xbI4dW7bz08KGGFrW50x2Q.png"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/6afec075a33d68a6f718ba9bb2015aba.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*tFMGzpHrnLxKlxpd-iK1Jg.png"/></div></figure><p id="a58f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">第二个正态分布模拟原材料单位成本，平均值为€ 13，标准偏差为€ 1.40。</p><h2 id="6bb0" class="nl mg it bd mh nm nn dn ml no np dp mp le nq nr mr li ns nt mt lm nu nv mv nw bi translated">3.3模拟1-模拟随机变量的总和与乘积</h2><p id="8f33" class="pw-post-body-paragraph kv kw it kx b ky mx ju la lb my jx ld le mz lg lh li na lk ll lm nb lo lp lq im bi translated">我们创建了三个随机变量，代表三个因素的不确定性，这三个因素将决定新产品产生利润的机会或损失的风险:</p><ul class=""><li id="23be" class="lr ls it kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">体积v的1x PERT</li><li id="d256" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">2x正常——对于销售价格p和原材料单位成本m；</li></ul><p id="31b2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们假设其他成本，那些与供应商价格无关的成本，可以通过一个确定性变量o来反映。</p><p id="e2af" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">为了计算模拟模型的目标变量——产品的毛利GP，我们将随机变量联系在一起，如下所示:</p><ul class=""><li id="b493" class="lr ls it kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">v =数量，p =价格，m =原材料单位成本，o =其他单位成本</li><li id="a4b8" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">GP = v * (p — m — o)</li></ul><p id="5290" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">作为第二个产出变量，我们可以模拟与GP平行的收入R。一般来说，一旦我们定义了输入随机变量，我们就可以用任意多的输出变量建立模拟模型。每个输出变量都可以由一个或多个输入随机变量组合而成，并由它自己的10，000个变量的数组来描述。</p><ul class=""><li id="18bd" class="lr ls it kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">R = v * p</li></ul><p id="8050" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这就建立了我们简单的模拟模型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/9b490152d083e338d507bf905cfb8f33.png" data-original-src="https://miro.medium.com/v2/resize:fit:590/format:webp/1*hfBncqYxU1yynr8CbKhgVw.png"/></div></figure><p id="b4c2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">为了查看返回毛利随机变量GP的分布的数组的属性，我们编写了一个函数<em class="nc"> dist_properties() </em>，该函数将读取数组并返回其矩和选定的分位数。</p><p id="93e4" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">对于偏度和峰度，我们使用SciPy的<em class="nc"> skew() </em>和峰度<em class="nc"> () </em>函数，其结果需要借助numpy的<em class="nc"> asscalar() </em>转换方法从数组转换成平面数。我们在字典<em class="nc"> dict_moments </em>中收集它们的值，并在其中添加度量的名称。第14行中的list comprehension逐行打印字典的内容。</p><p id="be55" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">然后我们计算第17ff行中的分位数，将它们收集到另一个字典中，<em class="nc"> dict_quantiles </em>，并使用第27行中的list comprehension将其打印出来。</p><p id="7314" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们合并两个字典，矩和分位数，形成一个综合字典，<em class="nc"> dict_metrics </em>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/e1d8d49664c585fb749c6ae02c339bfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/format:webp/1*bDAHBdJfe9Utg-o94EpBUw.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/5709e67c7dd17be839879a907dfb26a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:524/format:webp/1*QoW2eLw5mTD-3svUhAM6Zg.png"/></div></figure><p id="8cfd" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">平均利润将达到€ 49，250，接近中位数。</p><p id="8528" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">偏度和峰度都相当适中，这意味着与正态分布相比，有适度的离群值倾向。</p><p id="a23c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果销售价格和原材料单位成本同时趋向于最坏的结果，列表中的分位数揭示了新产品将产生损失的5%的风险。利润将以90%的概率超过€ 10，731(10%的分位数)。</p><p id="e759" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在下一章中，我们将更进一步，建立一个高阶仿真模型。虽然第一个模型仅从随机变量的和与积中组装输出变量，但我们现在将开发一个包括<em class="nc">嵌套</em>随机变量的模拟模型。</p><h2 id="5a73" class="nl mg it bd mh nm nn dn ml no np dp mp le nq nr mr li ns nt mt lm nu nv mv nw bi translated">3.5模拟2 —嵌套分布</h2><p id="cde1" class="pw-post-body-paragraph kv kw it kx b ky mx ju la lb my jx ld le mz lg lh li na lk ll lm nb lo lp lq im bi translated">如果你读过我以前的文章(<a class="ae ku" rel="noopener" target="_blank" href="/probability-distributions-with-pythons-scipy-3da89bf60565">概率分布介绍和用Python的SciPy </a>拟合分布)，你会记得我们已经应用了威布尔分布来解决<strong class="kx iu">故障前时间</strong>或<strong class="kx iu">部件寿命</strong>问题。一个部件的寿命通常可以由一个<strong class="kx iu">威布尔</strong>分布来模拟，其形状反映了<em class="nc">故障率</em>和一个设定所谓的<em class="nc">特征寿命</em>的比例参数。</p><p id="8e41" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">第一艘前往火星的宇宙飞船将配备电子电路板，其典型寿命可能为5万个工作小时。为了估计船舶设计中需要的冗余度，我们将模拟多少小时后所有电路的哪一部分会烧坏。</p><p id="b8c7" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们假设，非常符合现实，威布尔分布的两个参数——形状和特征寿命——是不确定的。因此，我们将这些分布参数估计为它们自己的随机变量。威布尔形状及其标度可以在由它们的分布模式设定的边界内波动。</p><ul class=""><li id="2b98" class="lr ls it kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">对于形状参数，工程团队估计它应该正态分布在平均值1.5左右，标准偏差为0.1。</li><li id="de2a" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">对于特征寿命，我们采用工程团队在45，000、50，000和60，000小时运行时提供的最大、可能和最小值的三点估算值。然后我们推导出一个PERT分布来反映不确定性的范围。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="3969" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">两个辅助函数通过拉丁超立方体采样抽取10，000个随机变量。</p><ul class=""><li id="8ede" class="lr ls it kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated"><em class="nc"> wei_shp() </em>返回正态分布的形状参数。</li><li id="2330" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated"><em class="nc"> wei_charlife() </em>返回特征寿命的PERT变量数组。</li><li id="c344" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">我们将Weibull位置参数(也称为等待时间)设置为0，这意味着产品故障会在生产完成和质量测试开始后立即出现。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/3725ad88bf13521755149b27366db6a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*SprCp0O2ObmhDmfhxpPnxw.png"/></div></figure><p id="cb87" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在第7行中，我们将随机变量组合成一个威布尔输出变量，表示故障前的时间。威布尔函数调用辅助函数来获取其形状和比例参数。目标变量<em class="nc"> rand_CL </em>将保存一个由10，000个模拟输出组成的数组，这些输出以小时为单位表示组件的寿命。</p><p id="2a7f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">有三种嵌套分布的结果:PERT和正态随机变量充当威布尔分布的参数。我们可以将结果标记为灵活的或随机的威布尔分布，而不是参数为点值的固定分布。</p><p id="c42f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">对于如何查看结果的属性，我们可以在两个选项之间进行选择:</p><ul class=""><li id="f4a4" class="lr ls it kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">将它作为一个数组进行分析，就像我们对之前的模拟结果所做的那样</li><li id="fcec" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">应用SciPy的<em class="nc"> rv_histogram类</em>，它将输出数组打包成一个直方图，并将其转换成一个“真实的”SciPy概率分布，为此我们可以调用像pdf和ppf这样的分布函数。</li></ul><p id="6849" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们来看看直方图类。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/99bad06808efc14a200742299f46a46b.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*Jqt8l1Ra61__dMNxp_o-xg.png"/></div></figure><p id="db20" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">图表用蓝色显示了我们在数组rand_CL中模拟的装箱寿命。在orange中，它绘制了概率密度函数，这个函数是由<em class="nc"> rv_histogram </em>类从数组中得到的。</p><p id="c34f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">函数<em class="nc"> histdist_properties() </em>计算<em class="nc"> histdist </em>概率分布的属性。这个函数在某些方面与我们之前写的函数<em class="nc">distribution _ properties()</em>不同。<em class="nc"> rv_histogram </em>类并不是在所有情况下都提供相同的分布属性。例如，最小值和最大值必须从。<em class="nc">支持()</em>方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="9389" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们调用<em class="nc"> histdist_properties() </em>函数并获得列表度量。数据帧不仅包含累积分布函数和分位数，还包含一列随机变量。采样功能<em class="nc">。rvs() </em>使我们能够从我们的输出分布中抽取一些随机数——或者如果需要的话抽取几千个，尽管没有LHS方法的分层抽样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/8892912f247a713de7e749a51df3344c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*UIq9etwEpYP7I3wIuHPN6w.png"/></div></figure><p id="4399" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">上面，我们分析了<em class="nc"> rv_histogram </em>从数组中导出的连续<em class="nc">分布</em>。如图所示，分布曲线与阵列数据并不完全相同。</p><p id="76ac" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">下面，我们对10，000个输出数字的原始数组调用函数<em class="nc"> dist_properties() </em>，并解释矩和分位数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/ae732b39de5f7771e36c7e4ada51993b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*ZTcr9c0XhFxz3sRwJ_y00w.png"/></div></figure><ul class=""><li id="e762" class="lr ls it kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">部件的平均寿命将达到45，647小时；</li><li id="a9d2" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">寿命将是右偏的，自然地，异常值将持续超过100，000小时；</li><li id="72e4" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">峰度是独特的——分布是薄峰的，其尾部有长期存活成分的倾向；</li><li id="8813" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">11，076小时后，10%的部件将会烧坏。</li></ul><p id="a30d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">任务控制中心告诉我们11，000小时的操作将标志着关键的阈值。在完成这些使用时间后，电路将不再是关键任务。分位数意味着，就电路板而言，飞船在设计时应该考虑到至少10%的冗余度:增加备用电路板，这些电路板将自动打开，作为那些开始出现故障的电路板的替代品。</p><p id="ec23" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">所以我们的太空船几乎准备好发射了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/dee89f037e18483b6d91fc07ac54e364.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*WtW7tp3JS_sPBhW9XselNQ.jpeg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated"><a class="ae ku" href="https://pixabay.com/photos/steel-mill-factory-hall-production-4646843/" rel="noopener ugc nofollow" target="_blank">图片</a>作者<a class="ae ku" href="https://pixabay.com/users/tama66-1032521/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4646843" rel="noopener ugc nofollow" target="_blank">彼得H </a>来自<a class="ae ku" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4646843" rel="noopener ugc nofollow" target="_blank">皮克斯贝</a>，免费用于商业用途</p></figure><h2 id="98d9" class="nl mg it bd mh nm nn dn ml no np dp mp le nq nr mr li ns nt mt lm nu nv mv nw bi translated">3.6模型3:固定参数模拟</h2><p id="9911" class="pw-post-body-paragraph kv kw it kx b ky mx ju la lb my jx ld le mz lg lh li na lk ll lm nb lo lp lq im bi translated">作为最后一项练习，让我们检查威布尔模型对其形状和特征寿命的不确定性有多敏感。</p><p id="1d8a" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们将使用“固定形式”的威布尔分布进行蒙特卡罗模拟。</p><ul class=""><li id="e2e5" class="lr ls it kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">形状参数将固定为平均值1.5；</li><li id="8b45" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">特征寿命:PERT分布的平均值:50，500小时。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/08528936eb5a76fc29992c38ba8befd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*fqEgdAa9lsKJ2cdLO16WQA.png"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/32fb8cf302de2d57b5e5407bdf3478c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:572/format:webp/1*-wyWrJSDoA7H3SI-Knx5GQ.jpeg"/></div></figure><p id="901c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们再次调用<em class="nc"> dist_properties() </em>函数，并将其指标插入到数据帧中，这样我们就可以并排比较固定威布尔和之前嵌套的“灵活”威布尔。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ok"><img src="../Images/cf4439521aa636bcdb28c4538b5b040a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ua-2AZHU83C5L1abonU92g.png"/></div></div></figure><p id="de6d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">正如预期的那样，我们看到固定威布尔变量的标准偏差较低，这是在形状和比例参数没有不确定性的情况下产生的。但是差别很小。显然，柔性威布尔模型的形状和尺度参数的不确定性非常接近于我们在固定威布尔模型中使用的平均值。较低的偏度和峰度显示出异常值和不对称性的倾向有所降低。</p><p id="1f9d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">参数具有不同值或不同分布的模拟可能会显示由增加的不确定性引起的较大差异。</p><h1 id="3161" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">4.结论</h1><p id="2731" class="pw-post-body-paragraph kv kw it kx b ky mx ju la lb my jx ld le mz lg lh li na lk ll lm nb lo lp lq im bi translated">今天的教程到此结束。</p><p id="4aa6" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们浏览了三个蒙特卡罗模拟的例子，它们是用SciPy库提供的工具箱创建的。</p><ul class=""><li id="a5a5" class="lr ls it kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">第一个模型——利润模拟——展示了随机变量的简单求和与乘积。</li><li id="72f4" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第二个模拟——威布尔失效时间——解释了嵌套随机变量的概念，即概率分布的参数本身就是随机变量。</li><li id="95c5" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第三次模拟大胆假设分布的参数是精确已知的。如果我们在模拟模型中忽略不确定性的来源，我们可能会低估可能结果的传播，除非不确定性浓缩为参数的平均值。</li></ul><p id="3887" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">Jupyter笔记本可以从GitHub下载:<a class="ae ku" href="https://github.com/h3ik0th/MonteCarloSim" rel="noopener ugc nofollow" target="_blank">h3ik0th/montecallosim:用SciPy(github.com)进行蒙特卡洛模拟</a></p><ul class=""><li id="be80" class="lr ls it kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">蒙特卡洛，图片由<a class="ae ku" href="https://pixabay.com/users/16018388-16018388/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=5072768" rel="noopener ugc nofollow" target="_blank">卢卡·阮</a>来自<a class="ae ku" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=5072768" rel="noopener ugc nofollow" target="_blank">皮克斯拜</a>，免费用于商业用途</li><li id="98eb" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">蒙特卡洛赌场，图片由来自<a class="ae ku" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=188882" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae ku" href="https://pixabay.com/users/hans-2/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=188882" rel="noopener ugc nofollow" target="_blank"> Hans Braxmeier </a>提供，免费用于商业用途</li><li id="0ab0" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">由<a class="ae ku" href="https://pixabay.com/users/tama66-1032521/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4646843" rel="noopener ugc nofollow" target="_blank">彼得·H</a>从<a class="ae ku" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4646843" rel="noopener ugc nofollow" target="_blank">皮克斯拜</a>工厂，免费用于商业用途</li><li id="1744" class="lr ls it kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">所有其他图片:作者</li></ul></div></div>    
</body>
</html>