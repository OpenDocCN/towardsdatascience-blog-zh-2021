<html>
<head>
<title>📧 Automate Email Sending with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">📧使用Python自动发送电子邮件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automate-email-sending-with-python-74128c7ca89a?source=collection_archive---------4-----------------------#2021-07-07">https://towardsdatascience.com/automate-email-sending-with-python-74128c7ca89a?source=collection_archive---------4-----------------------#2021-07-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2e93" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">ETL管道的权威代码片断集合</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e5b598e3929c8fd8a528d15911eab053.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i8Qnk0Ivpyos0KwzOVxFaQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片[A.Vaccaro]</p></figure><h1 id="f4c8" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">0.介绍</h1><p id="113e" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">通常，当执行复杂的ETL管道或简单的脚本时，我们需要从邮箱甚至<strong class="ls iu"> <em class="mm">中读取，自动发送带有任何类型附件(<em class="mm"> CSV、PDF、JPEG等)的</em> </em></strong>。)<em class="mm">图一</em>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/51520ae325f3fc2525604ce3558d5838.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PE2xaxoW1bExidty2MJWLw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1——一个简单的ETL管道可能以给涉众的电子邮件通知结束。[图片由作者A.Vaccaro提供]</p></figure><p id="a95b" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">正如我们可以想象的，<strong class="ls iu"> <em class="mm"> Python是在有或没有我们监督的情况下自动发送任何种类电子邮件的理想伴侣</em> </strong>。</p><p id="9962" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">问题是，尽管有一个简单的<strong class="ls iu"> <em class="mm">包来处理这一切</em> </strong>，但我们在网络上找到的指南往往是支离破碎、不完整的。</p><p id="314a" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">有了这篇文章我想<strong class="ls iu"> <em class="mm">收集并展示</em> </strong>你一劳永逸的<strong class="ls iu"> <em class="mm">最简单的方法</em> </strong> <strong class="ls iu"> <em class="mm">自动发送邮件</em> </strong> ( <em class="mm"> HTML或不</em> ) <strong class="ls iu"> <em class="mm">带或不带附件</em> </strong>。</p><p id="a965" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">🔖所以…请随意将这篇文章添加到您的<strong class="ls iu"> <em class="mm">书签中，以备将来使用</em> </strong>！</p><h1 id="86a7" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">1.在后台</h1><p id="7518" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">我们当中有谁从未需要配置自己的邮箱来阅读电脑/智能手机上的电子邮件？</p><p id="fba5" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">在那一刻，我们当然意识到发送、接收和存储电子邮件需要使用服务提供商 。其中最常见的当然是谷歌邮件、微软Outlook和苹果iTunes。</p><p id="059f" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">因此，不可避免地要谈一下描述电子邮件服务提供商特征的<strong class="ls iu"> <em class="mm"> 3个著名协议</em> </strong>:</p><ul class=""><li id="fd27" class="ms mt it ls b lt mn lw mo lz mu md mv mh mw ml mx my mz na bi translated"><strong class="ls iu"> <em class="mm"> SMTP </em> </strong>:是用于发送邮件的<strong class="ls iu"> <em class="mm">协议。</em> </strong>其首字母缩写代表<em class="mm">简单邮件传输协议</em>。这就是我们将在本文中使用的。</li><li id="65e8" class="ms mt it ls b lt nb lw nc lz nd md ne mh nf ml mx my mz na bi translated">另一方面，<strong class="ls iu"> <em class="mm"> IMAP </em> </strong>和<strong class="ls iu"> <em class="mm"> POP </em> </strong>是另外两个流行的协议，分别用于从/在我们的客户端中<strong class="ls iu"> <em class="mm">读取</em> </strong>和<strong class="ls iu"> <em class="mm">下载</em> </strong>电子邮件。</li></ul><h1 id="8c76" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">2.流动</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bef30d14bba40fd9a921ff79796a9aae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6qgCoG-8kHv3tPTW9KUOeg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2 —电子邮件生命周期。[图片由作者A.Vaccaro提供]</p></figure><p id="8210" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">我们即将实施的流程非常简单:</p><ol class=""><li id="5021" class="ms mt it ls b lt mn lw mo lz mu md mv mh mw ml ng my mz na bi translated">使用Python，我们将实例化一个与服务提供商的<strong class="ls iu"> <em class="mm">加密连接</em></strong>(STARTTLS)；</li><li id="6fb8" class="ms mt it ls b lt nb lw nc lz nd md ne mh nf ml ng my mz na bi translated">收到我们的邮件后，我们的服务商(<em class="mm">发件人服务器</em>)会通过SMTP  发送<strong class="ls iu"> <em class="mm">给收件人服务商(<em class="mm">收件人服务器</em>)；</em></strong></li><li id="6aae" class="ms mt it ls b lt nb lw nc lz nd md ne mh nf ml ng my mz na bi translated">收件人的客户端可以使用收件人的服务器<strong class="ls iu"> <em class="mm">通过IMAP或POP阅读电子邮件</em> </strong>。</li></ol><h1 id="4c91" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">3.我们需要什么</h1><p id="fdcf" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">这就是我们所需要的:</p><ul class=""><li id="6c6e" class="ms mt it ls b lt mn lw mo lz mu md mv mh mw ml mx my mz na bi translated"><strong class="ls iu">smtplib</strong>:Python的<em class="mm">标准库</em>包之一，用很少几行代码发送电子邮件。我们不需要安装这个软件包。</li><li id="8572" class="ms mt it ls b lt nb lw nc lz nd md ne mh nf ml mx my mz na bi translated"><strong class="ls iu"> SMTP设置</strong>:让我们看看我们的服务提供商(<em class="mm">，我们打算从那里发送邮件</em>)的文档，寻找<strong class="ls iu"> <em class="mm"> SMTP主机名</em> </strong>和<strong class="ls iu"> <em class="mm"> SMTP主机端口</em> </strong>。下面我给你留了一个表格，总结了最常见的设置:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ab9f73db73072dc53f2a943a7c333237.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HaucHv_ENjkZs2fXHQDbRA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3 — TODO ( <a class="ae nh" href="https://support.google.com/mail/answer/7126229" rel="noopener ugc nofollow" target="_blank">谷歌邮箱</a>、<a class="ae nh" href="https://support.microsoft.com/it-it/office/impostazioni-pop-imap-e-smtp-per-outlook-com-d088b986-291d-42b8-9564-9c414e2aa040" rel="noopener ugc nofollow" target="_blank">微软Outlook </a>、<a class="ae nh" href="https://support.apple.com/it-it/HT202304" rel="noopener ugc nofollow" target="_blank">苹果iCloud </a> e <a class="ae nh" href="https://it.aiuto.yahoo.com/kb/o-IMAP-sln4075.html" rel="noopener ugc nofollow" target="_blank">雅虎邮箱</a>)【图片由作者提供— A.Vaccaro】</p></figure><p id="1fce" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">在继续之前，让<strong class="ls iu"> <em class="mm">定义参数</em> </strong>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="39ba" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated"><em class="mm">注意:收件人和发件人是一样的，因为就本文的目的而言，我们最好给自己发邮件</em>😅<em class="mm">。</em></p><p id="9e90" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">让我们从<strong class="ls iu"> <em class="mm">代码片段</em> </strong>开始吧！</p><h1 id="a1c4" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">4.如何发送不带附件的电子邮件</h1><p id="5d51" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">让我们从最简单的例子开始:发送一封没有附件的文本邮件。</p><p id="a917" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">在这个例子中，像在其他例子中一样，我们将使用<strong class="ls iu"><em class="mm">MIME Multipart</em></strong>格式，这将允许我们一次组合电子邮件的一部分。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/436723f34dca2f9c5f7477c3cc00989e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nIRvo_oehOhuymoFr-YOJg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4-带有MIMEText对象的简单电子邮件。[图片由作者A.Vaccaro提供]</p></figure><p id="ca86" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">让我们从导入<code class="fe nk nl nm nn b">smptlib</code>包以及<code class="fe nk nl nm nn b">MIMEMultipart</code>和<code class="fe nk nl nm nn b">MIMEText</code>模块开始。然后，我们可以通过输入我们的凭证来实例化与服务提供者的连接。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="d262" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">在创建MIMEMultipart()对象之后，我们用关于发送者、接收者和主题的数据填充它的头部。</p><p id="bb11" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">最后，让我们定义并填充MIMEText()和<strong class="ls iu"> <em class="mm">发送消息</em> </strong>。</p><p id="c9ee" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">搞定了。极其简单！</p><h1 id="7050" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">5.如何发送不带附件的HTML电子邮件</h1><p id="2a46" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">这与前面的例子非常相似。</p><p id="445a" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">唯一的区别？MIMEText对象类型必须是“html ”, mime multipart必须是“alternative”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d1adc8ced9ef2a38ffca389275de6dcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tRkKqSYE1u1CmEOsNAZXRA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图5-用MIMEText对象实现的HTML电子邮件。[图片由作者A.Vaccaro提供]</p></figure><p id="6c66" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">让我们像以前一样重写所有内容，插入刚才提到的两个属性。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="199c" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">超级简单。让我们继续附件…</p><h1 id="b0fc" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">6.如何发送带附件的电子邮件</h1><p id="3705" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">MIMEMultipart的<strong class="ls iu"> <em class="mm">模块化</em> </strong>终将浮出水面。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/766ce3f916a59aac1ff23e112466eb54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z89n386mbYeSrykn9MY1kg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图6 —包含文本和附件的电子邮件。[图片由作者A.Vaccaro提供]</p></figure><p id="1d1c" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">在这种情况下，实际上，为文本组件实例化一个<strong class="ls iu"> <em class="mm"> MIMEText </em> </strong>和为附件实例化一个(或多个)<strong class="ls iu"><em class="mm">mime application</em></strong>就足够了。</p><p id="cfb7" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">我们最后将<strong class="ls iu"> <em class="mm">把它们放在一起</em> </strong>在一个MIMEMultipart对象中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="5aa3" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">我们可以看到，要将<strong class="ls iu">文件<em class="mm">正确地附加到</em>文件</strong>中，就必须以“<em class="mm">字节</em>格式打开它。因此在<code class="fe nk nl nm nn b">open()</code>函数中需要“<em class="mm"> rb </em>”。</p><p id="57b8" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">最后，为了正确地构造MIME对象，我们还向MIMEApplication对象添加了“Content-Disposition”属性，以指示附件的名称。</p><h1 id="0ca2" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">7.结论</h1><p id="8fb3" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">IT工具发展非常迅速。尽管如此，电子邮件仍然是任何一种交流方式的基础(或多或少有些复杂)。</p><p id="bea2" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">此外，正如我们在本文中看到的，使用Python自动发送电子邮件极其简单。</p><p id="d714" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">我希望已经阐明了你的想法，并能够适当地综合任何需要。</p><p id="2fb2" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">为了其他的一切…让我们保持联系吧！</p></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><p id="282f" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated"><a class="ae nh" href="https://emojipedia.org/handshake/" rel="noopener ugc nofollow" target="_blank">🤝</a> <em class="mm">如有任何疑问、反馈或协作要求，请随时</em> <strong class="ls iu"> <em class="mm">联系我</em></strong><a class="ae nh" href="http://bit.ly/alessiovaccaroLinkedIn" rel="noopener ugc nofollow" target="_blank"><strong class="ls iu"><em class="mm">Linkedin</em></strong></a><em class="mm">。我会很高兴和你聊天！</em></p><p id="7128" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated"><a class="ae nh" href="https://emojipedia.org/backhand-index-pointing-right/" rel="noopener ugc nofollow" target="_blank">👉</a>要获得更多像这样的内容，并保持对即将到来的文章的更新，不要忘记<strong class="ls iu"> <em class="mm">在Medium </em> </strong>上关注我。</p><p id="654e" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">🙏如需参考本文，请联系我。谢谢你。</p></div></div>    
</body>
</html>