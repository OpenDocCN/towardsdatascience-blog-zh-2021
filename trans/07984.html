<html>
<head>
<title>select() vs selectExpr() in Spark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spark中的select()与selectExpr()</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/select-vs-selectexpr-in-spark-412a59416615?source=collection_archive---------7-----------------------#2021-07-22">https://towardsdatascience.com/select-vs-selectexpr-in-spark-412a59416615?source=collection_archive---------7-----------------------#2021-07-22</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="0138" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">讨论Spark中select()和selectExpr()方法的区别</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/fda72189be88a48a82ec9603300bfbf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hgFe2YFnwzt_K2TfE7aSrQ.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">亚历山大·席默克在<a class="ae kz" href="https://unsplash.com/s/photos/select?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h2 id="e7c3" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">介绍</h2><p id="343a" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">列选择无疑是Spark数据帧(和数据集)上最常用的操作之一。Spark有两个内置的方法可以用来这样做，即<code class="fe mp mq mr ms b">select()</code>和<code class="fe mp mq mr ms b">selectExpr()</code>。</p><p id="3187" class="pw-post-body-paragraph lw lx iu ly b lz mt jv mb mc mu jy me lj mv mg mh ln mw mj mk lr mx mm mn mo in bi translated">在今天的文章中，我们将讨论如何使用它们，并解释它们的主要区别。此外，我们将讨论何时应该使用其中一种。</p></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><p id="4c8a" class="pw-post-body-paragraph lw lx iu ly b lz mt jv mb mc mu jy me lj mv mg mh ln mw mj mk lr mx mm mn mo in bi translated">在讨论如何使用<code class="fe mp mq mr ms b">select()</code>和<code class="fe mp mq mr ms b">selectExpr()</code>进行选择之前，让我们创建一个样本数据帧，作为本文的参考</p><pre class="kk kl km kn gu nf ms ng nh aw ni bi"><span id="4494" class="la lb iu ms b gz nj nk l nl nm">from pyspark.sql import SparkSession</span><span id="c070" class="la lb iu ms b gz nn nk l nl nm">spark_session = SparkSession.builder \<br/>    .master('local[1]') \<br/>    .appName('Example') \<br/>    .getOrCreate()</span><span id="d267" class="la lb iu ms b gz nn nk l nl nm">df = spark_session.createDataFrame(<br/>    [<br/>       (1, 'Giorgos', 'Developer', 28),<br/>       (2, 'Andrew', 'Architect', 31),<br/>       (3, 'Maria', 'Manager', 31),<br/>       (4, 'Ben', 'Developer', 29),<br/>    ],<br/>    ['id', 'name', 'occupation', 'age']<br/>)</span><span id="cff1" class="la lb iu ms b gz nn nk l nl nm">df.show()</span><span id="f9d4" class="la lb iu ms b gz nn nk l nl nm">+---+--------+----------+---+<br/>| id|    name|occupation|age|<br/>+---+--------+----------+---+<br/>|  1| Giorgos| Developer| 28|<br/>|  2|  Andrew| Architect| 31|<br/>|  3|   Maria|   Manager| 31|<br/>|  4|     Ben| Developer| 29|<br/>+---+--------+----------+---+</span></pre></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><h2 id="918b" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">选择()</h2><p id="c6ad" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated"><code class="fe mp mq mr ms b"><a class="ae kz" href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.sql.DataFrame.select.html" rel="noopener ugc nofollow" target="_blank">pyspark.sql.DataFrame.select()</a></code>是一个转换函数，它返回一个新的数据帧，其中包含输入中指定的所需列。它接受一个参数<code class="fe mp mq mr ms b">columns</code>，可以是<code class="fe mp mq mr ms b">str</code>、<code class="fe mp mq mr ms b">Column</code>或<code class="fe mp mq mr ms b">list</code>，以防您想要选择多个列。该方法投射一组表达式，并将返回一个新的Spark数据帧。</p><p id="b295" class="pw-post-body-paragraph lw lx iu ly b lz mt jv mb mc mu jy me lj mv mg mh ln mw mj mk lr mx mm mn mo in bi translated">以下表达式将返回一个包含原始数据帧所有列的新数据帧:</p><pre class="kk kl km kn gu nf ms ng nh aw ni bi"><span id="0bcc" class="la lb iu ms b gz nj nk l nl nm">df.select('*').show()</span><span id="3174" class="la lb iu ms b gz nn nk l nl nm">+---+--------+----------+---+<br/>| id|    name|occupation|age|<br/>+---+--------+----------+---+<br/>|  1| Giorgos| Developer| 28|<br/>|  2|  Andrew| Architect| 31|<br/>|  3|   Maria|   Manager| 31|<br/>|  4|     Ben| Developer| 29|<br/>+---+--------+----------+---+</span></pre><p id="15e1" class="pw-post-body-paragraph lw lx iu ly b lz mt jv mb mc mu jy me lj mv mg mh ln mw mj mk lr mx mm mn mo in bi translated">如果您只想选择列的子集，可以如下所示进行操作:</p><pre class="kk kl km kn gu nf ms ng nh aw ni bi"><span id="a3c5" class="la lb iu ms b gz nj nk l nl nm">df.select('id', 'name').show()</span><span id="8772" class="la lb iu ms b gz nn nk l nl nm">+---+--------+<br/>| id|    name|<br/>+---+--------+<br/>|  1| Giorgos|<br/>|  2|  Andrew|<br/>|  3|   Maria|<br/>|  4|     Ben|<br/>+---+--------+</span></pre></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><h2 id="7447" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">selectExpr()</h2><p id="58e8" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated"><code class="fe mp mq mr ms b"><a class="ae kz" href="https://spark.apache.org/docs/3.1.1/api/python/reference/api/pyspark.sql.DataFrame.selectExpr.html" rel="noopener ugc nofollow" target="_blank">pyspark.sql.DataFrame.selectExpr()</a></code>与<code class="fe mp mq mr ms b">select()</code>相似，唯一的区别是它接受将要执行的SQL表达式(字符串格式)。同样，该表达式将根据提供的输入从原始数据中返回一个新的数据帧。</p><p id="70b9" class="pw-post-body-paragraph lw lx iu ly b lz mt jv mb mc mu jy me lj mv mg mh ln mw mj mk lr mx mm mn mo in bi translated">另外，与<code class="fe mp mq mr ms b">select()</code>不同，这个方法只接受字符串。例如，为了将列<code class="fe mp mq mr ms b">age</code>乘以2以及<code class="fe mp mq mr ms b">id</code>和<code class="fe mp mq mr ms b">name</code>列，您需要执行以下语句:</p><pre class="kk kl km kn gu nf ms ng nh aw ni bi"><span id="147a" class="la lb iu ms b gz nj nk l nl nm">df.selectExpr('id', 'name', 'age * 2').show()</span><span id="2ddf" class="la lb iu ms b gz nn nk l nl nm">+---+--------+-------+<br/>| id|    name|age * 2|<br/>+---+--------+-------+<br/>|  1| Giorgos|     28|<br/>|  2|  Andrew|     31|<br/>|  3|   Maria|     31|<br/>|  4|     Ben|     29|<br/>+---+--------+-------+</span></pre></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><p id="c64f" class="pw-post-body-paragraph lw lx iu ly b lz mt jv mb mc mu jy me lj mv mg mh ln mw mj mk lr mx mm mn mo in bi translated">因此，当您只需要从一个特定的Spark数据帧中选择一个列的子集时，<code class="fe mp mq mr ms b">select()</code>方法非常有用。另一方面，当您需要选择特定的列，同时还需要对特定的列应用某种转换时，<code class="fe mp mq mr ms b">selectExpr()</code>就派上了用场。</p></div><div class="ab cl my mz hy na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="in io ip iq ir"><h2 id="5bd1" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">最后的想法</h2><p id="b2fd" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">在今天的文章中，我们讨论了Spark中<code class="fe mp mq mr ms b">select()</code>和<code class="fe mp mq mr ms b">selectExpr()</code>方法的区别。我们展示了如何使用两者对Spark数据帧进行选择，并强调了何时使用其中一个。</p><p id="38f9" class="pw-post-body-paragraph lw lx iu ly b lz mt jv mb mc mu jy me lj mv mg mh ln mw mj mk lr mx mm mn mo in bi translated">你可以在下面阅读更多关于Spark的文章。</p><div class="no np gq gs nq nr"><a rel="noopener follow" target="_blank" href="/distinct-vs-dropduplicates-in-spark-3e28af1f793c"><div class="ns ab fp"><div class="nt ab nu cl cj nv"><h2 class="bd iv gz z fq nw fs ft nx fv fx it bi translated">Spark中的distinct()与dropDuplicates()</h2><div class="ny l"><h3 class="bd b gz z fq nw fs ft nx fv fx dk translated">Spark中distinct()和dropDuplicates()有什么区别？</h3></div><div class="nz l"><p class="bd b dl z fq nw fs ft nx fv fx dk translated">towardsdatascience.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of kt nr"/></div></div></a></div><div class="no np gq gs nq nr"><a rel="noopener follow" target="_blank" href="/sparksession-vs-sparkcontext-vs-sqlcontext-vs-hivecontext-741d50c9486a"><div class="ns ab fp"><div class="nt ab nu cl cj nv"><h2 class="bd iv gz z fq nw fs ft nx fv fx it bi translated">spark session vs spark context vs SQLContext vs hive context</h2><div class="ny l"><h3 class="bd b gz z fq nw fs ft nx fv fx dk translated">SparkSession、SparkContext HiveContext和SQLContext有什么区别？</h3></div><div class="nz l"><p class="bd b dl z fq nw fs ft nx fv fx dk translated">towardsdatascience.com</p></div></div><div class="oa l"><div class="og l oc od oe oa of kt nr"/></div></div></a></div><div class="no np gq gs nq nr"><a rel="noopener follow" target="_blank" href="/how-to-efficiently-convert-a-pyspark-dataframe-to-pandas-8bda2c3875c3"><div class="ns ab fp"><div class="nt ab nu cl cj nv"><h2 class="bd iv gz z fq nw fs ft nx fv fx it bi translated">加快PySpark和Pandas数据帧之间的转换</h2><div class="ny l"><h3 class="bd b gz z fq nw fs ft nx fv fx dk translated">将大火花数据帧转换为熊猫时节省时间</h3></div><div class="nz l"><p class="bd b dl z fq nw fs ft nx fv fx dk translated">towardsdatascience.com</p></div></div><div class="oa l"><div class="oh l oc od oe oa of kt nr"/></div></div></a></div></div></div>    
</body>
</html>