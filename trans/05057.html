<html>
<head>
<title>Developing and Deploying a COMPLETE Project Using FastAPI, Jinja2, SQLAlchemy, Docker, and AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用FastAPI、Jinja2、SQLAlchemy、Docker和AWS开发和部署一个完整的项目</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/developing-and-deploying-a-complete-project-using-fastapi-jinja2-sqlalchemy-docker-and-aws-1b504a1a2be4?source=collection_archive---------8-----------------------#2021-05-04">https://towardsdatascience.com/developing-and-deploying-a-complete-project-using-fastapi-jinja2-sqlalchemy-docker-and-aws-1b504a1a2be4?source=collection_archive---------8-----------------------#2021-05-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/c6d745b932d8930a53114b1ed3e38799.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*52Y6-1wnXFhyEpyi-DSILQ.gif"/></div><p class="jx jy gj gh gi jz ka bd b be z dk translated">作者Gif。</p></figure><h1 id="841b" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">介绍</h1><p id="fd76" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">你可以在rdok.net的<a class="ae lx" href="http://rdok.net/" rel="noopener ugc nofollow" target="_blank">上访问最终版app。代码在</a><a class="ae lx" href="https://github.com/Deffro/random-dose-of-knowledge" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上是开源的。这主要是一篇程序性文章。目的是描述创建应用程序的完整过程，而不是用代码片段轰炸读者。</p><p id="05b9" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><strong class="lb iu">这个应用程序是关于什么的？</strong>这款应用名为“随机知识剂量”,外观如下</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi md"><img src="../Images/4ec39d19d5e6da32dad4c7c0935ef99c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g2imEIf1GYsSseDttfmnPw.png"/></div></div><p class="jx jy gj gh gi jz ka bd b be z dk translated">图片由作者提供。</p></figure><p id="f9f2" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">有4个按钮，每个按钮来自一个特定的子编辑。当用户点击一个按钮时，会显示这个子编辑的随机帖子以及顶部的评论。我想你对Reddit很熟悉，但不熟悉也没关系。你可以把这款应用想象成一个用户可以不断点击按钮来了解一些很酷的事实的地方。在页面的底部，有一个交互式图表，显示每个按钮的累计点击次数。</p><h2 id="c92a" class="mm kc it bd kd mn mo dn kh mp mq dp kl lk mr ms kp lo mt mu kt ls mv mw kx mx bi translated">如何阅读这篇文章</h2><ul class=""><li id="2c1d" class="my mz it lb b lc ld lg lh lk na lo nb ls nc lw nd ne nf ng bi translated"><strong class="lb iu">潜在读者1: </strong>只对过程感兴趣。希望以一种非常抽象和快速的方式看到创建这样一个项目的步骤。</li></ul><blockquote class="nh ni nj"><p id="fdde" class="kz la nk lb b lc ly le lf lg lz li lj nl ma lm ln nm mb lq lr nn mc lu lv lw im bi translated">如果你是reader 1，不要像这样分块读内容，不要读代码片段。</p></blockquote><p id="9f42" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">预计时间:5分钟。</p><ul class=""><li id="8b9e" class="my mz it lb b lc ly lg lz lk no lo np ls nq lw nd ne nf ng bi translated"><strong class="lb iu">潜在读者2: </strong>对自己不知道的具体部分感兴趣。如何用FastAPI使用HTML？如何对项目进行归档？如何在EC2上部署？</li></ul><blockquote class="nh ni nj"><p id="04bc" class="kz la nk lb b lc ly le lf lg lz li lj nl ma lm ln nm mb lq lr nn mc lu lv lw im bi translated">如果你是读者2，快速浏览文章，找到你想了解的内容和/或关键词。</p></blockquote><p id="3c13" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">预计时间:视情况而定。</p><ul class=""><li id="609a" class="my mz it lb b lc ly lg lz lk no lo np ls nq lw nd ne nf ng bi translated"><strong class="lb iu">潜在读者3: </strong>对流程和代码感兴趣。想要为自己重新创建这个应用程序。</li></ul><blockquote class="nh ni nj"><p id="d885" class="kz la nk lb b lc ly le lf lg lz li lj nl ma lm ln nm mb lq lr nn mc lu lv lw im bi translated">如果你是reader 3，克隆GitHub代码。阅读文章中的所有内容。再读一遍。复制它。</p></blockquote><p id="c0cb" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">预计时间:最多8小时。</p><p id="e280" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><strong class="lb iu">使用的框架/软件/技术/平台:</strong></p><ul class=""><li id="ef5d" class="my mz it lb b lc ly lg lz lk no lo np ls nq lw nd ne nf ng bi translated">饭桶</li><li id="1915" class="my mz it lb b lc nv lg nw lk nx lo ny ls nz lw nd ne nf ng bi translated">米尼康达</li><li id="dbbc" class="my mz it lb b lc nv lg nw lk nx lo ny ls nz lw nd ne nf ng bi translated">FastAPI</li><li id="ec32" class="my mz it lb b lc nv lg nw lk nx lo ny ls nz lw nd ne nf ng bi translated">SQLAlchemy</li><li id="8172" class="my mz it lb b lc nv lg nw lk nx lo ny ls nz lw nd ne nf ng bi translated">HTML，CSS</li><li id="a3c6" class="my mz it lb b lc nv lg nw lk nx lo ny ls nz lw nd ne nf ng bi translated">Jinja2</li><li id="1446" class="my mz it lb b lc nv lg nw lk nx lo ny ls nz lw nd ne nf ng bi translated">Reddit API</li><li id="c074" class="my mz it lb b lc nv lg nw lk nx lo ny ls nz lw nd ne nf ng bi translated">蟒蛇(熊猫，Plotly)</li><li id="5e1a" class="my mz it lb b lc nv lg nw lk nx lo ny ls nz lw nd ne nf ng bi translated">码头工人</li><li id="2dc6" class="my mz it lb b lc nv lg nw lk nx lo ny ls nz lw nd ne nf ng bi translated">AWS EC2，ECR</li></ul><h1 id="a6e3" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">1.Git和虚拟环境</h1><p id="94cf" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">首先，创建一个将承载您的应用程序的文件夹。我的叫做<em class="nk">随机知识剂量。</em> <a class="ae lx" href="https://docs.anaconda.com/anaconda/install/" rel="noopener ugc nofollow" target="_blank">下载</a> anaconda或miniconda创建虚拟环境。进入文件夹，打开终端，键入:</p><pre class="me mf mg mh gt oa nu ob oc aw od bi"><span id="2fb3" class="mm kc it nu b gy oe of l og oh">git init. # initialize git repository<br/>conda create -n <em class="nk">rdok</em> python=3.8 # create a virt. env. called rdok<br/>conda activate rdok # activate it</span></pre><p id="a6b7" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">创建一个名为requirements.txt的文件，并在其中写入:</p><pre class="me mf mg mh gt oa nu ob oc aw od bi"><span id="ff80" class="mm kc it nu b gy oe of l og oh">fastapi<br/>uvicorn<br/>SQLAlchemy<br/>pandas<br/>plotly<br/>aiofiles<br/>requests<br/>Jinja2<br/>python-multipart</span></pre><p id="1baf" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">在终端类型:<code class="fe nr ns nt nu b">pip install -r requirements.txt</code></p><p id="80f7" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">我们现在有了git和一个虚拟环境，其中包含了我们需要的所有包。</p><h1 id="11ed" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">2.在本地创建应用程序</h1><p id="7c1a" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">在这一部分，我给出了文件结构，解释了文件，我们<strong class="lb iu">看了一眼</strong>一些文件中最重要的部分。完整的文件在GitHub上。</p><pre class="me mf mg mh gt oa nu ob oc aw od bi"><span id="389a" class="mm kc it nu b gy oe of l og oh"><strong class="nu iu">random-dose-of-knowledge/</strong><br/>    |-- .gitignore<br/>    |-- Dockerfile<br/>    |-- requirements.txt<br/>    <strong class="nu iu">|-- app/</strong><br/>    |-- __init__.py<br/>    |-- main.py<br/>        <strong class="nu iu">|-- db/</strong><br/>        |    |-- __init__.py<br/>        |    |-- database.py<br/>        |    |-- random-knowledge.db<br/>        <strong class="nu iu">|-- models/</strong><br/>        |    |-- __init__.py<br/>        |    |-- sql_table_entities.py<br/>        <strong class="nu iu">|-- utils/</strong><br/>        |    |-- __init__.py<br/>        |    |-- reddit_api.py<br/>        <strong class="nu iu">|-- templates/</strong><br/>        |    |-- base.html<br/>        |    |-- index.html<br/>        <strong class="nu iu">|-- static/</strong><br/>        |    <strong class="nu iu">|-- css/</strong><br/>        |    |    |-- style.css<br/>        |    <strong class="nu iu">|-- images/</strong><br/>        |    |    |-- favicon.png</span></pre><h2 id="12f6" class="mm kc it bd kd mn mo dn kh mp mq dp kl lk mr ms kp lo mt mu kt ls mv mw kx mx bi translated">。gitignore</h2><p id="2cf6" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">包含git不会跟踪的所有文件和文件夹。<a class="ae lx" href="https://drive.google.com/file/d/1FxxGSsw4SNGncHsKSgZsgc9aZgwbIIFy/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">这里是</a></p><h2 id="da12" class="mm kc it bd kd mn mo dn kh mp mq dp kl lk mr ms kp lo mt mu kt ls mv mw kx mx bi translated">Dockerfile文件</h2><p id="8ad5" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">包括组装docker图像的命令。稍后会有更多内容</p><h2 id="570e" class="mm kc it bd kd mn mo dn kh mp mq dp kl lk mr ms kp lo mt mu kt ls mv mw kx mx bi translated">__init__。巴拉圭</h2><p id="0255" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">将这个空文件包含在目录中，让python将它们视为包</p><h2 id="0d23" class="mm kc it bd kd mn mo dn kh mp mq dp kl lk mr ms kp lo mt mu kt ls mv mw kx mx bi translated">随机知识数据库</h2><p id="0790" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">我们的数据库</p><h2 id="8576" class="mm kc it bd kd mn mo dn kh mp mq dp kl lk mr ms kp lo mt mu kt ls mv mw kx mx bi translated">database.py</h2><p id="2290" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">使用SQLAlchemy创建数据库连接的脚本</p><figure class="me mf mg mh gt ju"><div class="bz fp l di"><div class="oi oj l"/></div></figure><h2 id="6ff4" class="mm kc it bd kd mn mo dn kh mp mq dp kl lk mr ms kp lo mt mu kt ls mv mw kx mx bi translated">sql _表_实体. py</h2><p id="5941" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">包括我们数据库的表的定义</p><figure class="me mf mg mh gt ju"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="d176" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">在表‘posts’和‘comments’之间存在一对多的关系，因为一篇文章可以有多个评论。</p><h2 id="3265" class="mm kc it bd kd mn mo dn kh mp mq dp kl lk mr ms kp lo mt mu kt ls mv mw kx mx bi translated">如何将数据插入这些表格:</h2><p id="400e" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">下面是main.py在表中插入数据的主要部分。特别注意第25行。</p><blockquote class="nh ni nj"><p id="2d62" class="kz la nk lb b lc ly le lf lg lz li lj nl ma lm ln nm mb lq lr nn mc lu lv lw im bi translated">在第4行的<code class="fe nr ns nt nu b">subreddit: str = Form('todayilearned')</code>中，我们定义了一个类型为<code class="fe nr ns nt nu b">str</code>的参数<code class="fe nr ns nt nu b">subreddit</code>。它的值将是按钮单击的表单输出。例如，如果用户点击“科学”按钮，表单的输出将是“科学”。<br/>T3】</p><p id="24fd" class="kz la nk lb b lc ly le lf lg lz li lj nl ma lm ln nm mb lq lr nn mc lu lv lw im bi translated">从第4行可以看出，默认值是“todayilearned”。</p></blockquote><figure class="me mf mg mh gt ju"><div class="bz fp l di"><div class="oi oj l"/></div></figure><h2 id="0ecd" class="mm kc it bd kd mn mo dn kh mp mq dp kl lk mr ms kp lo mt mu kt ls mv mw kx mx bi translated">reddit_api.py</h2><p id="2038" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">Python工作完成的文件。定义连接到Reddit API、获取请求、预处理从Reddit帖子和评论中提取的数据的函数。此外，还要定义创建应用程序情节的函数。</p><blockquote class="nh ni nj"><p id="e267" class="kz la nk lb b lc ly le lf lg lz li lj nl ma lm ln nm mb lq lr nn mc lu lv lw im bi translated"><strong class="lb iu">如何使用Reddit API </strong>。到这里<a class="ae lx" href="https://www.reddit.com/prefs/apps" rel="noopener ugc nofollow" target="_blank">去</a>。滚动到底部。点击“创建另一个应用程序”。插入一个名称，选择脚本，将描述和关于url留空，输入一个网站(可以是你的个人网站，github或linkedin)到重定向uri。您的CLIENT_ID是“个人使用脚本”。你的秘密钥匙就是“秘密”。为了连接，您还需要您的REDDIT_USERNAME和REDDIT_PASSWORD。将后者保存在. txt文件中</p></blockquote><h2 id="ba1b" class="mm kc it bd kd mn mo dn kh mp mq dp kl lk mr ms kp lo mt mu kt ls mv mw kx mx bi translated">base.html和index.html</h2><p id="f4ec" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">这些文件位于需要在main.py中定义的templates文件夹中(见下面main.py脚本第2行)<br/>可以用FastAPI创建一个完整的网站，而不仅仅是返回json文件。我的应用程序是一个单页网站。index.html是包含在网站所有其他页面中的基础文件(在我的例子中，只有index.html)。index.html是该应用程序的登录页面。</p><blockquote class="nh ni nj"><p id="80f5" class="kz la nk lb b lc ly le lf lg lz li lj nl ma lm ln nm mb lq lr nn mc lu lv lw im bi translated"><strong class="lb iu"> FastAPI + Jinja2 + HTML </strong>。将FastAPI函数的结果返回到HTML页面:<br/> 1。在函数<br/> <code class="fe nr ns nt nu b">@app.get('/', response_class=HTMLResponse)</code>的装饰器中定义response_class</p><p id="b6d0" class="kz la nk lb b lc ly le lf lg lz li lj nl ma lm ln nm mb lq lr nn mc lu lv lw im bi translated">2.在请求类型<br/> <code class="fe nr ns nt nu b"><em class="it">def my_function(request: Request):</em></code>的函数中定义一个参数</p><p id="0bc6" class="kz la nk lb b lc ly le lf lg lz li lj nl ma lm ln nm mb lq lr nn mc lu lv lw im bi translated">3.返回指定着陆的TemplateResponse。html页面、请求参数和要传递的变量</p><p id="0b61" class="kz la nk lb b lc ly le lf lg lz li lj nl ma lm ln nm mb lq lr nn mc lu lv lw im bi translated"><code class="fe nr ns nt nu b">return templates.TemplateResponse('index.html', { 'request': request, 'variable1': var_1, 'variable2': var_2})</code></p><p id="be7e" class="kz la nk lb b lc ly le lf lg lz li lj nl ma lm ln nm mb lq lr nn mc lu lv lw im bi translated">4.使用Jinja2 <br/>在HTML中使用传递的变量，例如，如果var_1是一个数据帧，我们可以这样使用它:<br/> <code class="fe nr ns nt nu b"><em class="it">{% for i, row in var_1.iterros() %}<br/> &lt;div class="row"&gt;<br/> {{row['body']}}<br/> &lt;/div&gt;<br/>{% endfor %}</em></code></p></blockquote><h2 id="c690" class="mm kc it bd kd mn mo dn kh mp mq dp kl lk mr ms kp lo mt mu kt ls mv mw kx mx bi translated">main.py</h2><p id="7c01" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">调用和运行应用程序的脚本。下面的代码包含main.py文件的<strong class="lb iu">最基本的</strong>(导入除外)</p><figure class="me mf mg mh gt ju"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="7c9d" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">第12行运行名为“app”的应用程序，如文件“main”的第1行所定义。该应用程序将在本地<strong class="lb iu"> localhost:8000 </strong>上提供</p><p id="9d81" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><strong class="lb iu">此时应用程序已经准备好，你可以在本地运行它:</strong> <code class="fe nr ns nt nu b">python main.py</code></p></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><h1 id="d06b" class="kb kc it bd kd ke or kg kh ki os kk kl km ot ko kp kq ou ks kt ku ov kw kx ky bi translated">3.将应用程序归档</h1><p id="889c" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated"><a class="ae lx" href="https://www.docker.com/get-started" rel="noopener ugc nofollow" target="_blank">安装</a>对接器。</p><p id="140f" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">请参考文件结构以了解路径。<strong class="lb iu">创建Dockerfile </strong>:</p><pre class="me mf mg mh gt oa nu ob oc aw od bi"><span id="6179" class="mm kc it nu b gy oe of l og oh"># install python in the container<br/>FROM python:3.8.8-slim </span><span id="bbc1" class="mm kc it nu b gy ow of l og oh"># copy the local requirements.txt file to the <br/># /app/requirements.txt in the container<br/># (the /app dir will be created)<br/>COPY ./requirements.txt /app/requirements.txt</span><span id="5fa9" class="mm kc it nu b gy ow of l og oh"># install the packages from the requirements.txt file in the container<br/>RUN pip install -r /app/requirements.txt</span><span id="e2cd" class="mm kc it nu b gy ow of l og oh"># expose the port that uvicorn will run the app<br/>EXPOSE 8000</span><span id="1686" class="mm kc it nu b gy ow of l og oh"># copy the local app/ folder to the /app fodler in the container<br/>COPY app/ /app</span><span id="4e43" class="mm kc it nu b gy ow of l og oh"># set the working directory in the container to be the /app<br/>WORKDIR /app</span><span id="8666" class="mm kc it nu b gy ow of l og oh"># execute the command python main.py (in the WORKDIR) to start the app<br/>CMD ["python", "main.py"]</span></pre><p id="6563" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><strong class="lb iu">从docker文件构建一个docker映像</strong>。转到Dockerfile所在的文件夹。类型:</p><p id="2a1a" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><code class="fe nr ns nt nu b">docker build -t rdok:1.1 .</code></p><p id="b78f" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">别忘了圆点！图像的名称是rdok，标签是1.1</p><p id="959a" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><strong class="lb iu">查看图像</strong>:</p><p id="daae" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><code class="fe nr ns nt nu b">docker images</code></p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi ox"><img src="../Images/40a9179fd1a5bdf96140a1f51699e02a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9EyXWAAFiawnpY4YHqiWJQ.png"/></div></div></figure><p id="5abb" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><strong class="lb iu">从图像创建一个容器:</strong></p><p id="fda8" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><code class="fe nr ns nt nu b">docker run --name rdok -d -p 80:8000 rdok:1.1</code></p><p id="13b1" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">使用name，我们用-d指定容器的名称<br/>，容器将在分离模式下运行<br/>使用-p 80:8000，我们将本地端口80绑定到docker端口8000 <br/> rdok:1.1是映像的名称</p><blockquote class="nh ni nj"><p id="249d" class="kz la nk lb b lc ly le lf lg lz li lj nl ma lm ln nm mb lq lr nn mc lu lv lw im bi translated"><strong class="lb iu">奖金。</strong>我们可以把本地app文件夹和docker app文件夹连接起来。docker应用程序中的更改将被复制到本地文件夹中，反之亦然。容器也将是持久的。如果我们停止甚至删除容器，更改将会保留。为此，将以下内容添加到docker run命令中:</p><p id="c659" class="kz la nk lb b lc ly le lf lg lz li lj nl ma lm ln nm mb lq lr nn mc lu lv lw im bi translated"><code class="fe nr ns nt nu b">-v absolute/path/to/the/local/app:/app</code></p><p id="8f6a" class="kz la nk lb b lc ly le lf lg lz li lj nl ma lm ln nm mb lq lr nn mc lu lv lw im bi translated">左侧是我们的/app/文件夹所在的本地机器上的绝对路径。右边部分是我们之前在容器中创建的/app/文件夹(在Dockerfile中)。</p></blockquote><p id="84a6" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">检查运行容器:</p><p id="b4e2" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><code class="fe nr ns nt nu b">docker ps</code></p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi oy"><img src="../Images/b2f99d675ac7ffb9fd1e3e4ce3c1db01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9O7XWICHFjnJkONbImSD5A.png"/></div></div></figure><p id="d6a2" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">应用程序正在运行！转到localhost:80或者简单的<strong class="lb iu"> localhost </strong>。</p><h1 id="7529" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">4.在AWS上部署</h1><p id="1ace" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">在<a class="ae lx" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS </a>上记账并连接。按照图片中的步骤创建一个<strong class="lb iu"> EC2 </strong>实例。这将是我们的服务器，将托管我们的应用程序:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi oz"><img src="../Images/2cd9dd989bd4a303c8007e9fd81b44ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QMwu_pduMAAjRX-zPaMvIA.png"/></div></div><p class="jx jy gj gh gi jz ka bd b be z dk translated">图片由作者提供。</p></figure><p id="e7dd" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">在终端中，导航至<code class="fe nr ns nt nu b">.pem</code>键并键入:</p><p id="5b60" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><code class="fe nr ns nt nu b">chmod 400 my_key_pair.pem</code></p><p id="bd76" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">如果你在windows机器上<a class="ae lx" href="https://superuser.com/questions/1296024/windows-ssh-permissions-for-private-key-are-too-open" rel="noopener ugc nofollow" target="_blank">这样做，而不是</a>。</p><p id="1ea7" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">继续连接到您的实例。在你的终端中(你在一个有<code class="fe nr ns nt nu b">.pem</code>键的文件夹中)运行下图中的最后一个命令。</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi pa"><img src="../Images/32df9e793d1dd569edba00cb2ad64027.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ifX2WhBJQ3pIiUBAaExAjA.png"/></div></div><p class="jx jy gj gh gi jz ka bd b be z dk translated">图片由作者提供。</p></figure><p id="5ccc" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">你现在在你的实例里面。运行以下命令在实例中安装Docker:</p><pre class="me mf mg mh gt oa nu ob oc aw od bi"><span id="a8d8" class="mm kc it nu b gy oe of l og oh">sudo yum update -y<br/>sudo yum install docker<br/>sudo service docker start<br/>sudo usermod -a -G docker ec2-user<br/>sudo dockerd</span></pre><p id="4969" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">现在重新启动实例，并按照上述相同的步骤再次连接。</p><p id="30b3" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">类型:</p><pre class="me mf mg mh gt oa nu ob oc aw od bi"><span id="3db4" class="mm kc it nu b gy oe of l og oh">systemctl start docker<br/>sudo service docker start</span></pre><p id="82ba" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">Docker已安装！</p></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><h2 id="b143" class="mm kc it bd kd mn mo dn kh mp mq dp kl lk mr ms kp lo mt mu kt ls mv mw kx mx bi translated">现在让我们在AWS上创建一个<strong class="ak"> ECR </strong> Docker容器注册表。</h2><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi pb"><img src="../Images/5be2d7bc65d045cc868ebe9707ec0888.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ylbw-x1ZhG6c8Mj2TvFoNw.png"/></div></div><p class="jx jy gj gh gi jz ka bd b be z dk translated">图片由作者提供。</p></figure><p id="2735" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">在继续之前，<a class="ae lx" href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html" rel="noopener ugc nofollow" target="_blank">下载AWS CLI </a>，并通过<a class="ae lx" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html" rel="noopener ugc nofollow" target="_blank">使用您的AWS凭证验证</a>进行配置。</p><p id="3930" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">认证后，转到您的ECR，选择存储库并单击“查看推送命令”。</p><p id="7179" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">将会打开一个窗口，指导您如何将本地docker映像推送到ECR实例。</p><p id="fe17" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">这些命令将在您的本地计算机上运行:</p><ol class=""><li id="4cad" class="my mz it lb b lc ly lg lz lk no lo np ls nq lw pc ne nf ng bi translated"><code class="fe nr ns nt nu b">aw ecr get-login-pa...</code>验证本地机器和ECR之间的连接。</li><li id="5878" class="my mz it lb b lc nv lg nw lk nx lo ny ls nz lw pc ne nf ng bi translated"><code class="fe nr ns nt nu b">docker build..</code>建立形象。我们已经在docker部分建立了我们的应用程序的Docker图像。</li><li id="b3d1" class="my mz it lb b lc nv lg nw lk nx lo ny ls nz lw pc ne nf ng bi translated">它复制并重命名本地图像。键入<code class="fe nr ns nt nu b">docker images</code>查看。</li><li id="27ce" class="my mz it lb b lc nv lg nw lk nx lo ny ls nz lw pc ne nf ng bi translated"><code class="fe nr ns nt nu b">docker push..</code>将复制的图像推送到ECR存储库。</li></ol><p id="0580" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">我们的图像现在存放在我们的ECR存储库中。让我们把它放到我们的EC2存储库中。</p><p id="d05e" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">转到EC2实例中的终端。</p><p id="5483" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">我们首先必须认证EC2和ECR之间的连接。像在本地机器上一样运行相同的<code class="fe nr ns nt nu b">aw ecr get-login-pa...</code>命令，然后执行<code class="fe nr ns nt nu b">docker pull name-of-the-copied-image</code>。</p><p id="adf8" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">现在我们的图像在我们的服务器里了！键入<code class="fe nr ns nt nu b">docker images</code>即可查看。</p><p id="f7c5" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">让我们运行它:</p><p id="f3c2" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><code class="fe nr ns nt nu b">docker run --name my-app -d -p 80:8000 IMAGE_NAME:TAG</code></p><h2 id="b7f2" class="mm kc it bd kd mn mo dn kh mp mq dp kl lk mr ms kp lo mt mu kt ls mv mw kx mx bi translated">超级重要的一步</h2><p id="0432" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">在EC2仪表板上转到AWS网站，单击存储库，然后转到“安全”选项卡。单击“安全组”下的链接。接下来，单击“编辑入站规则”。单击“添加规则”。类型:HTTP，协议TCP，端口范围80，源自定义0.0.0.0/0并保存。</p><p id="260c" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">您的规则应该是这样的:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi pd"><img src="../Images/904f29878d94ceda2428ca8b747e4ced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fYp0bi6DFbwoKgxWOBP5UA.png"/></div></div><p class="jx jy gj gh gi jz ka bd b be z dk translated">图片由作者提供。</p></figure><p id="56e3" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">要访问你的应用，请访问<strong class="lb iu">公共IPv4地址</strong>，但要写http而不是https。</p></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><p id="9a13" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">恭喜你！您已到达这篇文章的结尾。我希望你在这个项目中学到了和我一样多的东西。</p><p id="f739" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">最后，我再次分享这个项目的<a class="ae lx" href="https://github.com/Deffro/random-dose-of-knowledge/tree/main" rel="noopener ugc nofollow" target="_blank"> GitHub链接</a>。</p><p id="ded2" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">你可以在<a class="ae lx" href="https://www.linkedin.com/in/dimitrios-effrosynidis/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上和我联系。</p><p id="2dda" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">回头见！</p></div></div>    
</body>
</html>