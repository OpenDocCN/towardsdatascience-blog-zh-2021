<html>
<head>
<title>Building an End-To-End Analytic solution in Power BI: Part 3 — Level Up with Data Modeling!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Power BI中构建端到端分析解决方案:第3部分——提高数据建模水平！</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-an-end-to-end-analytic-solution-in-power-bi-part-3-level-up-with-data-modeling-cfbf3e4e2cd?source=collection_archive---------20-----------------------#2021-08-11">https://towardsdatascience.com/building-an-end-to-end-analytic-solution-in-power-bi-part-3-level-up-with-data-modeling-cfbf3e4e2cd?source=collection_archive---------20-----------------------#2021-08-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0ec5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在我们清理和塑造了我们的数据之后，是时候升级游戏了！了解为什么星型模式和Power BI是天作之合，以及如何在Power BI中直接构建它！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/15027559c1b35eeb2e8439b72ed3a1c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NENOjw0j9Hy_USIiFLf_DQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.pexels.com/photo/green-neon-bubble-level-on-metal-bracket-in-dark-room-3829224/" rel="noopener ugc nofollow" target="_blank">福克斯在pexels.com拍摄的图片</a></p></figure><blockquote class="kz la lb"><p id="39b4" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">当我与不深入Power BI世界的人交谈时，我经常得到的印象是，他们认为Power BI只是一个可视化工具。虽然这在一定程度上是对的，但在我看来，他们没有看到更大的图景，或者更好的说法是，他们看到的只是冰山一角！这个冰山一角是那些闪亮的仪表盘，KPI箭头，花哨的人工智能东西，等等。</p><p id="c5c9" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">然而，事情远不止如此，因为真实的东西就在表面之下…</p><p id="d592" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">在这一系列文章中，我将向您展示如何使用Power BI来创建一个成熟的分析解决方案。从不提供任何有用信息的原始数据开始，构建不仅仅是好看的可视化，而是提取可用于定义适当行动的洞察力——我们称之为知情决策。</p></blockquote><ul class=""><li id="5ca4" class="lz ma it lf b lg lh lj lk mb mc md me mf mg ly mh mi mj mk bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/building-an-end-to-end-analytic-solution-in-power-bi-part-1-understanding-the-business-problem-85db9e2d745b"> <em class="le">第一部分——理解业务问题</em> </a></li><li id="1354" class="lz ma it lf b lg ml lj mm mb mn md mo mf mp ly mh mi mj mk bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/building-an-end-to-end-analytic-solution-in-power-bi-part-2-preparing-the-data-c5a1641ec897"> <em class="le">第二部分—准备数据</em> </a></li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/3f20371d22b0deff2fad80ba265d80bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yM1eyw03OUZb3wX8tPahuQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="537b" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">在我们奠定了构建端到端分析解决方案流程背后的一些理论背景，并解释了为什么在构建解决方案之前理解业务问题<em class="le">至关重要，并应用了一些基本的数据分析和数据转换之后，现在是时候升级我们的游戏并花些时间来阐述我们的分析解决方案的最佳数据模型了。提醒一下，我们使用了一个关于纽约机动车碰撞的公开数据集，可以在<a class="ae ky" href="https://data.cityofnewyork.us/Public-Safety/Motor-Vehicle-Collisions-Crashes/h9gi-nx95" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</em></p><h2 id="724a" class="mr ms it bd mt mu mv dn mw mx my dp mz mb na nb nc md nd ne nf mf ng nh ni nj bi translated">简而言之，数据建模</h2><p id="a61a" class="pw-post-body-paragraph lc ld it lf b lg nk ju li lj nl jx ll mb nm lo lp md nn ls lt mf no lw lx ly im bi translated">当您构建一个分析解决方案时，创建一个<strong class="lf iu"> <em class="le">高效</em> </strong>解决方案的关键先决条件之一是拥有一个合适的数据模型。我不会深入解释如何构建企业数据仓库、OLTP和OLAP模型设计之间的区别、谈论规范化等等，因为这些都是您需要掌握的极其广泛和重要的主题，尽管您使用的是Power BI或其他开发工具。</p><p id="69ff" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">解析解决方案中最常见的数据建模方法是<em class="le">维度建模</em>。本质上，这个概念假设所有的表都应该被定义为事实表或维度表。事实表存储事件或观察结果，如销售交易、汇率、温度等。另一方面，维度表是描述性的—它们包含关于实体的数据—产品、客户、位置、日期…</p><blockquote class="kz la lb"><p id="6a82" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">请务必记住，这一概念并不仅仅与Power BI相关，它是一个通用概念，已经在各种数据解决方案中使用了几十年！</p></blockquote><p id="60da" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">如果你真的想从事数据领域的工作(不一定是Power BI)，我强烈推荐阅读这本书:<a class="ae ky" href="https://www.kimballgroup.com/data-warehouse-business-intelligence-resources/books/data-warehouse-dw-toolkit/" rel="noopener ugc nofollow" target="_blank"> <strong class="lf iu">《数据仓库工具包:维度建模权威指南</strong> </a>，作者Ralph Kimball和Margy Ross。这是所谓的维度建模的“圣经”,并彻底解释了在构建解析解决方案中使用维度建模的整个过程和好处。</p><h2 id="6cba" class="mr ms it bd mt mu mv dn mw mx my dp mz mb na nb nc md nd ne nf mf ng nh ni nj bi translated">星象图和权力BI——天作之合！</h2><p id="dba3" class="pw-post-body-paragraph lc ld it lf b lg nk ju li lj nl jx ll mb nm lo lp md nn ls lt mf no lw lx ly im bi translated">现在，事情变得越来越有趣了！对立双方之间正在进行讨论——是使用包含所有数据的单一平面表更好(就像我们目前在纽约碰撞数据集中使用的那样),还是规范化这个“胖”表并创建一个维度模型(称为星型模式)更有意义？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/1ecb8154697f6ea9d7cd04250a3b641a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*klAp4UvJFoi0hbVYCsWI6Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="e904" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">在上图中，你可以看到一个典型的维度建模的例子，叫做星型模式。我想我不需要向你解释它为什么被这样称呼:)你可以在Power BI <a class="ae ky" href="https://docs.microsoft.com/en-us/power-bi/guidance/star-schema" rel="noopener ugc nofollow" target="_blank">这里</a>阅读更多关于星型模式相关性的内容。有一个有趣的讨论，星形模式是否是比在数据模型中只有一个表更有效的解决方案——星形模式反对者的主要论点是性能——在他们看来，如果没有连接、关系等，Power BI应该工作得更快。</p><p id="ce1e" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">然后，<em class="le"> Amir Netz </em>，微软分析公司的首席技术官和负责构建<a class="ae ky" rel="noopener" target="_blank" href="/how-to-reduce-your-power-bi-model-size-by-90-76d7c4377f2d"> VertiPaq引擎</a>的人员之一，在Twitter上澄清了所有的不确定性:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/1a7f56358847c12ed2d0845fdca8c14e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bKpDAwHqeE7G92CfIP4rqQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><p id="93ea" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">如果你不相信一个完全知道事情如何在引擎盖下工作的人，那么也有一些由经验证的专家提供的额外的精彩解释，为什么星型模式应该是你在Power BI中建模数据的首选方式，例如【Patrick(立方体中的家伙)的这个视频，或者<a class="ae ky" href="https://www.youtube.com/watch?v=qEWrYO1ioe0" rel="noopener ugc nofollow" target="_blank"> Alberto Ferrari (SQL BI) </a>的这个视频。</p><p id="cd3f" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">而且，这不仅仅关乎效率，还关乎在您的报告中获得准确的结果！<a class="ae ky" href="https://www.sqlbi.com/articles/the-importance-of-star-schemas-in-power-bi/" rel="noopener ugc nofollow" target="_blank">在这篇文章</a>中，Alberto展示了在一个平面表上编写DAX计算如何会导致意想不到的(或者说不准确的)结果。</p><p id="f5fe" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">不用深入解释为什么应该使用星型模式，让我向您展示使用一个平面表会产生不正确的数字，即使是一些琐碎的计算！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/f34860f09927c57eb01e99b8c50c6cdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h3lKklM9Dt6SryJK8YYtsw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="2867" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">这是我的平面表，其中包含一些关于销售的虚拟数据。假设业务请求是找出客户的平均年龄。如果有人问你顾客的平均年龄是多少，你会怎么回答？30，对吗？我们有一个20岁、30岁和40岁的客户，所以平均年龄是30岁，对吗？来看看实力BI怎么说…</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="44ff" class="mr ms it ns b gy nw nx l ny nz">AVG Customer Age = AVERAGE(Table1[Customer Age])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/006c030043876f58dd7863f0d606bd7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z1PwrCnVC-d3iOSrwi8gWw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="ebce" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">这怎么可能呢？！32真的吗？！让我们看看我们是如何得到这个意外的(不正确的)数字的…如果我们将所有客户年龄值相加，我们将得到320…320除以10(这是销售数字)，瞧！好了，这是你的32个普通顾客的年龄！</p><p id="4cf5" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">现在，我将开始构建一个维度模型，并将客户数据放入一个单独的维度表中，删除重复的数据并保留customers维度中的唯一值:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/fd04e2f75e99aa58772386925bfe5d96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_g-az7HS5Dh0JtPYxG0Mzg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="29e1" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">我还从原始销售表中删除了客户年龄，并在客户键列中建立了这两者之间的关系:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/816bcdf1c16f44ef85824bb64086c561.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jSwTcoz16SAJL4yh1RAgnA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="fd71" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">最后，我只需要重写我的度量来引用新创建的维度表:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="0e15" class="mr ms it ns b gy nw nx l ny nz">AVG Customer Age = AVERAGE(Customers[Customer Age])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/5a607591dfbe41e09448fb833235ddc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nxtLtYl3DxDkVeps2B5A-Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4a83" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">当然，有一种方法可以编写更复杂的DAX，甚至可以用一个平面表来检索正确的结果。但是，为什么要这样做呢？我相信我们会同意，最直观的方法是像我一样编写一个度量，并用一个简单的DAX语句返回一个适当的数字。</p><p id="80a5" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">所以，不仅仅是效率的问题，还有准确性的问题！因此，这里的关键要点是:<strong class="lf iu"> <em class="le">尽可能将您的数据建模为星型模式！</em>T9】</strong></p><h2 id="bd1f" class="mr ms it bd mt mu mv dn mw mx my dp mz mb na nb nc md nd ne nf mf ng nh ni nj bi translated">为NYC碰撞数据集构建星型模式</h2><p id="ab9f" class="pw-post-body-paragraph lc ld it lf b lg nk ju li lj nl jx ll mb nm lo lp md nn ls lt mf no lw lx ly im bi translated">既然我们已经得出结论，星型模式是可行的，那么让我们开始为数据集构建最佳数据模型。第一步是去掉缺失值超过90%的列，因为我们无法从中提取任何信息。我已经删除了9列，现在还剩下20列。</p><p id="3173" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">乍一看，我有5个潜在的维度表要创建:</p><ul class=""><li id="248c" class="lz ma it lf b lg lh lj lk mb mc md me mf mg ly mh mi mj mk bi translated">日期维度</li><li id="2e5a" class="lz ma it lf b lg ml lj mm mb mn md mo mf mp ly mh mi mj mk bi translated">时间限度</li><li id="50e0" class="lz ma it lf b lg ml lj mm mb mn md mo mf mp ly mh mi mj mk bi translated">位置维度(区+邮政编码)</li><li id="0f3b" class="lz ma it lf b lg ml lj mm mb mn md mo mf mp ly mh mi mj mk bi translated">促成因素维度</li><li id="9407" class="lz ma it lf b lg ml lj mm mb mn md mo mf mp ly mh mi mj mk bi translated">车辆类型尺寸</li></ul><p id="74dd" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">但是，在我们继续创建它们之前，我想对我的崩溃时间列应用一个额外的转换。因为我们不需要在分钟级别上分析数据(要求的是小时级别的粒度)，所以我将值四舍五入到起始小时:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/71570d2062a3d94082cc98673e9deceb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K4kq5A1Mac3crnVNKat7MA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="04a2" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">我现在将复制我的原始平面表4次(对于所需的每个维度，除了日期维度，因为我想使用一组更复杂的属性，例如星期几)。不要担心，因为我们将只保留每个维度中的相关列，并删除所有其他列。以下是位置维度的一个示例:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/d974a72f3cd76991b1012bea2721eae2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6eDnjyRX4EGa_0wv1kCQRw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="51d2" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">下一个重要步骤是确保我们在每个维度中都有唯一的值，这样我们就可以在维度和事实表之间建立适当的1-M关系。我现在将选择我的所有维度列并删除重复项:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/cf6850fa02f4aa16ae4f48e147c7d67a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VzecD2vyrrqGqzHmtwTdzQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="de43" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">我们需要对数据模型中的每个维度都这样做！从这里开始，由于我们在原始表中没有“经典的”键列(例如，在前面的例子中，当我们计算平均客户年龄时，我们在原始平面表中有Customer键列)，有两种可能的方法:更简单的方法假设在文本列上建立关系——这“本身”没有问题，但是它可能对大型模型中的数据模型大小有影响。</p><p id="2e68" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">因此，我们将走另一条路，为我们的每个维度创建一个代理键列。按照维度建模中的定义，代理键不具有任何业务意义——它只是一个简单的整数(或bigint)值，该值按顺序递增并唯一地标识表中的行。</p><p id="f600" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">使用索引列转换在Power Query中创建代理键非常简单。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/506f421d65e525af11ac82a3a8cdf100.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*idBjzeROslq4tyMR_PgFtg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="64cc" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">这里只需要注意一点:默认情况下，使用索引列转换将<a class="ae ky" rel="noopener" target="_blank" href="/what-is-a-query-folding-in-power-bi-and-why-should-i-care-5b89f42f38d7">中断查询折叠</a>。然而，由于我们处理的是根本不支持查询折叠的CSV文件，我们可以安全地应用索引列转换。</p><p id="411e" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">下一步是将这个整数列添加到事实表中，并将其用作维度表的外键，而不是文本值。如何才能实现这一点？我将简单地将位置维度与我的碰撞事实表合并:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/78183881f770652889798f46d713d13b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HyLcMfyP0BQ2zf1qPjaZ5w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="d1b2" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">出现提示后，我将对唯一标识维度表中一行的列执行合并操作(在本例中，是行政区和邮政编码的组合键):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/735a975ac2a0ba602c02b5c5ff9ee2d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1beaSf6JFlHI6t3eR6AE-A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="95b2" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">在Power Query应用这种转换之后，我将能够展开合并后的位置表，并从那里获取索引列:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/d24d95815395e18aeac5e56ad7b8eb34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WikrWWEDwpYKrR9bJElzTg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="98fe" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">现在，我可以使用这一个整数列作为Location维度表的外键，只需删除两个属性列BOROUGH和ZIP CODE——这样，我的表不仅更加整洁，而且还需要更少的内存空间——我们现在有一个整数列，而不是两个文本列！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/5d689138fb12d434acbc72912ed90f30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qalp4VbNkFdIO2V1eLemjg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="cff6" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">我将对其他维度(除了时间维度)应用相同的逻辑—包括索引列作为外键，并删除原始文本属性。</p><h2 id="2774" class="mr ms it bd mt mu mv dn mw mx my dp mz mb na nb nc md nd ne nf mf ng nh ni nj bi translated">用日期维度和关系增强数据模型</h2><p id="009b" class="pw-post-body-paragraph lc ld it lf b lg nk ju li lj nl jx ll mb nm lo lp md nn ls lt mf no lw lx ly im bi translated">现在，我们已经完成了Power Query editor中的数据建模，并准备好进入Power BI，通过使用DAX创建一个日期维度来增强我们的数据模型。我们也可以在Power Query中使用M来完成，但是我有意将它留给DAX，只是为了向您展示Power BI中数据建模的多种不同功能。</p><p id="8ddb" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">为了使DAX时间智能功能以正确的方式工作，<a class="ae ky" rel="noopener" target="_blank" href="/tiq-part-3-ultimate-guide-to-date-dimension-creation-98b951ffa68c">设置正确的日期/日历维度</a>至关重要。</p><p id="8abc" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">为了创建一个日期维度，我使用了由SQL BI人员提供的<a class="ae ky" href="https://www.sqlbi.com/articles/creating-a-simple-date-table-in-dax/" rel="noopener ugc nofollow" target="_blank">这个</a>脚本。</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="c1f1" class="mr ms it ns b gy nw nx l ny nz">Date =<br/>VAR MinYear = YEAR ( MIN ( Collisions[CRASH DATE] ) )<br/>VAR MaxYear = YEAR ( MAX ( Collisions[CRASH DATE] ) )<br/>RETURN<br/>ADDCOLUMNS (<br/>    FILTER (<br/>        CALENDARAUTO( ),<br/>        AND ( YEAR ( [Date] ) &gt;= MinYear, YEAR ( [Date] ) &lt;= MaxYear )<br/>    ),<br/>    "Calendar Year", "CY " &amp; YEAR ( [Date] ),<br/>    "Month Name", FORMAT ( [Date], "mmmm" ),<br/>    "Month Number", MONTH ( [Date] ),<br/>    "Weekday", FORMAT ( [Date], "dddd" ),<br/>    "Weekday number", WEEKDAY( [Date] ),<br/>    "Quarter", "Q" &amp; TRUNC ( ( MONTH ( [Date] ) - 1 ) / 3 ) + 1<br/>i</span></pre><p id="5955" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">在我将这个<a class="ae ky" rel="noopener" target="_blank" href="/tiq-part-2-your-majesty-date-dimension-b4d54db84be9">表标记为数据表</a>之后，就该构建我们的星型模式模型了。我将切换到模型视图并建立表之间的关系:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/d7b8c6304b5dcaa4a441c58c24b2adbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YCrry4czLF_IrURnL3MFkQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="26ae" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">这让你想起什么了吗？没错，看起来就像上面的星形插图。因此，我们遵循Power BI中关于数据建模的最佳实践，构建了一个星型模式模型。不要忘记，我们能够在不离开Power BI桌面环境的情况下做到这一点，只使用Power Query Editor，并且不编写任何代码！我听到了，我听到了，但是日期维度的DAX代码不算:)</p><h2 id="33d6" class="mr ms it bd mt mu mv dn mw mx my dp mz mb na nb nc md nd ne nf mf ng nh ni nj bi translated">结论</h2><p id="ca89" class="pw-post-body-paragraph lc ld it lf b lg nk ju li lj nl jx ll mb nm lo lp md nn ls lt mf no lw lx ly im bi translated">我们的分析解决方案正在慢慢改进。在我们执行必要的数据清理和整形后，我们通过构建星型模式模型达到了更高的水平，这将使我们的Power BI分析解决方案能够高效地执行并提高整体可用性——既消除了不必要的复杂性，又能够为不同的计算编写更简单的DAX代码。</p><p id="e59a" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">正如您所看到的，我们再次证明了Power BI不仅仅是一个可视化工具！</p><p id="d683" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">在本系列的下一部分，我们将最终移动到球场的那一边，开始构建一些很酷的视觉效果，利用我们在后台创建的数据模型的功能。</p><p id="8830" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">感谢阅读！</p><p id="afee" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp md lr ls lt mf lv lw lx ly im bi translated">成为会员，阅读Medium上的每一个故事！</p></div></div>    
</body>
</html>