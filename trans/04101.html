<html>
<head>
<title>Graphing mortality</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">死亡率图表</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/graphing-mortality-a39fc504bf7a?source=collection_archive---------41-----------------------#2021-04-06">https://towardsdatascience.com/graphing-mortality-a39fc504bf7a?source=collection_archive---------41-----------------------#2021-04-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8551" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">仿效国家统计局的死亡率图表。</h2></div><p id="e283" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">国家统计局的每周报告展示了一张死亡登记的图表。读者可以看到2015年至2019年的注册范围，以及最近一年。我们可以为其他国家仿效这个图表。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/2ef6ffbbdb64b2507ea2bd09efc9f61d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*Y3hFdwoxdwoZ90Hm7V_pVQ.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">这些数字是死亡登记的数字。(图片:<a class="ae le" href="https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages/deaths/bulletins/deathsregisteredweeklyinenglandandwalesprovisional/weekending19march2021" rel="noopener ugc nofollow" target="_blank"> ONS </a>)</p></figure><p id="4286" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://ourworldindata.org/excess-mortality-covid" rel="noopener ugc nofollow" target="_blank">我们的数据世界</a>整理了两个来源的全因死亡率数据。加州大学的研究人员维护着人类死亡率数据库。该数据库依赖欧统局和各国统计局。Ariel Karlinsky和Dmitry Kobak收集了世界死亡率数据。</p><p id="824d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例子国家是瑞典。瑞典统计局每周发布死亡档案更新。与国家统计局不同的是，初步数据显示的是死亡发生的日期——某人死亡的时间。<strong class="kk iu">存在死亡日期未知的死亡。对于这些死亡中的大多数，瑞典当局知道月份。</strong></p><h1 id="42c1" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">搭建桌子</h1><p id="fac0" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">我们可以通过R中的步骤来制作这种风格的图形。我们首先从<a class="ae le" href="https://ourworldindata.org/excess-mortality-covid" rel="noopener ugc nofollow" target="_blank">我们的数据世界网站</a>下载基本数据文件:</p><pre class="lg lh li lj gt mo mp mq mr aw ms bi"><span id="7e17" class="mt ls it mp b gy mu mv l mw mx">owid_all_cause_deaths_df &lt;- read_csv(file = "excess-mortality-raw-death-count.csv")</span></pre><p id="1215" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们对行进行过滤，得到瑞典的死亡数字:</p><pre class="lg lh li lj gt mo mp mq mr aw ms bi"><span id="9ae1" class="mt ls it mp b gy mu mv l mw mx">sweden_deaths_df &lt;- owid_all_cause_deaths_df %&gt;%<br/>  filter(Entity == "Sweden") %&gt;%<br/>  mutate(Day = as_date(Day))</span></pre><p id="0f4e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了获得2015年至2019年的范围，我们制定了一个总结框架。然后，<code class="fe my mz na mp b">fill</code>函数将第52周的值复制到第53周。大多数年份没有53周:</p><pre class="lg lh li lj gt mo mp mq mr aw ms bi"><span id="219a" class="mt ls it mp b gy mu mv l mw mx">sweden_summ_df &lt;- sweden_deaths_df %&gt;%<br/>  select(Day, 6:10) %&gt;%<br/>  pivot_longer(2:6,<br/>               names_to = "owid_measure",<br/>               values_to = "deaths_all_ages") %&gt;%<br/>  group_by(Day) %&gt;%<br/>  summarise(deaths_2015_2019_min = min(deaths_all_ages, na.rm = FALSE),<br/>            deaths_2015_2019_max = max(deaths_all_ages, na.rm = FALSE)) %&gt;%<br/>  fill(deaths_2015_2019_min,<br/>       deaths_2015_2019_max)</span></pre><p id="9698" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将这些汇总统计数据加入到主要的每周数据中，创建了一个“整洁”的表格:</p><pre class="lg lh li lj gt mo mp mq mr aw ms bi"><span id="08f4" class="mt ls it mp b gy mu mv l mw mx">sweden_deaths_tidy_df &lt;- full_join(sweden_deaths_df,<br/>                                   sweden_summ_df,<br/>                                   by = "Day") %&gt;%<br/>  select(Day, average_deaths_2015_2019_all_ages,<br/>         deaths_2020_all_ages, deaths_2015_2019_min,<br/>         deaths_2015_2019_max) %&gt;%<br/>  pivot_longer(2:3,<br/>               names_to = "owid_measure",<br/>               values_to = "deaths_all_ages")</span></pre><h1 id="3cc4" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">创建图表</h1><p id="d1ed" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated"><strong class="kk iu">最后，我们创建图表。</strong>我们从它的核心开始:</p><pre class="lg lh li lj gt mo mp mq mr aw ms bi"><span id="4971" class="mt ls it mp b gy mu mv l mw mx">sweden_deaths_gg &lt;- sweden_deaths_tidy_df %&gt;%<br/>  ggplot(aes(x = Day)) +<br/>  geom_line(aes(y = deaths_all_ages,<br/>                colour = owid_measure,<br/>                linetype = owid_measure),<br/>            size = 1.5) +<br/>  geom_ribbon(aes(ymin = deaths_2015_2019_min,<br/>                  ymax = deaths_2015_2019_max,<br/>                  fill = owid_measure),<br/>              alpha = 0.3) +</span></pre><p id="9e1c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们希望2015年至2019年的平均值是一条虚线。这个系列的色调较浅。2020年的死亡线应该是实线，有明显的颜色:</p><pre class="lg lh li lj gt mo mp mq mr aw ms bi"><span id="d18d" class="mt ls it mp b gy mu mv l mw mx">scale_linetype_manual(values = c("dotted", "solid")) +<br/>  scale_fill_manual(values = c("white", "#0AFFFF")) +<br/>  scale_colour_manual(values = c("#008080", "#800000")) +</span></pre><p id="90f1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们更改轴刻度，使其看起来更好，带有漂亮的断点:</p><pre class="lg lh li lj gt mo mp mq mr aw ms bi"><span id="65d5" class="mt ls it mp b gy mu mv l mw mx">scale_x_date(date_labels = "%d-%b",<br/>               breaks = sweden_breaks,<br/>               expand = c(0,0)) +<br/>  scale_y_continuous(labels = label_comma(),<br/>                     breaks = pretty_breaks(),<br/>                     limits = c(0,2700)) +</span></pre><p id="5883" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">标签是下一部分，关闭图例:</p><pre class="lg lh li lj gt mo mp mq mr aw ms bi"><span id="d8da" class="mt ls it mp b gy mu mv l mw mx">labs(title = "Sweden suffered two waves of high deaths in 2020.",<br/>       subtitle = "Number of deaths reported to Statistics Sweden by week. Excludes deaths with unknown dates.",<br/>       x = "Week of death",<br/>       y = "",<br/>       caption = "Source: Our World in Data: Excess mortality during the Coronavirus pandemic (COVID-19).") +<br/>  theme(legend.position = "none") +</span></pre><p id="130c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们添加了带有<code class="fe my mz na mp b">geom_text</code>的直接标签，分别采用两种颜色:</p><pre class="lg lh li lj gt mo mp mq mr aw ms bi"><span id="c071" class="mt ls it mp b gy mu mv l mw mx">geom_text(data = filter(sweden_deaths_tidy_df,<br/>                          Day == as_date("2020-06-28") &amp;<br/>                            owid_measure == "deaths_2020_all_ages"),<br/>            aes(x = Day, y = deaths_all_ages, label = "Deaths in 2020"),<br/>            color = "#800000", vjust = -2, size = 5, fontface = "bold") +<br/>  geom_text(data = filter(sweden_deaths_tidy_df,<br/>                          Day == as_date("2020-06-28") &amp;<br/>                            owid_measure == "deaths_2020_all_ages"),<br/>            aes(x = Day, y = deaths_2015_2019_min,<br/>                label = "Average and range of deaths\n2015 to 2019"),<br/>            color = "#008080", vjust = 1.5, size = 5, fontface = "bold")</span></pre><p id="5d52" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">瑞典的死亡率图表在这里:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nb"><img src="../Images/76f763f24411df76534e06ecec841ea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HcG-9awa1ao1Fo-fgh44wg.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">第53周的平均值和范围与第52周相同。(图片:<a class="ae le" href="https://rpubs.com/anthonybmasters/sweden-mortality-2020" rel="noopener ugc nofollow" target="_blank"> R酒馆</a>)</p></figure></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><p id="5558" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">完整的R代码可以在<a class="ae le" href="https://rpubs.com/anthonybmasters/sweden-mortality-2020" rel="noopener ugc nofollow" target="_blank"> R Pubs </a>和<a class="ae le" href="https://github.com/anthonybmasters/rstudio-2021/tree/main/All%20Cause%20Mortality" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p></div></div>    
</body>
</html>