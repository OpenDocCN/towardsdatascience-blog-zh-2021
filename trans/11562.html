<html>
<head>
<title>PyCaret Time Series Module Architecture Overview</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PyCaret时序模块架构概述</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pycaret-time-series-module-architecture-overview-57336a2f39c7?source=collection_archive---------19-----------------------#2021-11-15">https://towardsdatascience.com/pycaret-time-series-module-architecture-overview-57336a2f39c7?source=collection_archive---------19-----------------------#2021-11-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c30a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在引擎盖下寻找</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d34c5ac0836472fb4c16bf3f316179a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sVYjBQheyaOHGCeW"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在PyCaret时间序列模块的引擎盖下看——照片由<a class="ae ky" href="https://unsplash.com/@aliivan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Alison Ivansek </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="321b" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">📚概观</h1><p id="af5a" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">理解任何软件包的底层架构都有助于确保我们尽可能地使用它。这并不意味着一个人必须了解其中的每一行代码，但有时，只是有一个概述会有所帮助。</p><p id="caf2" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">本文旨在提供对<code class="fe mz na nb nc b">pycaret</code>时间序列模块的架构概述，并展示在评估使用<code class="fe mz na nb nc b">pycaret</code>开发的模型时，这些信息可能会派上用场的例子。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="b2f0" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">📖建议的先前阅读</h1><p id="f443" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">如果你还没有这样做，我推荐下面的短文。它讲述了<code class="fe mz na nb nc b">pycaret</code>如何使用基于回归的预测模型(我们将在本文后面讨论)</p><p id="fa9c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">👉<a class="ae ky" href="https://github.com/pycaret/pycaret/discussions/1760" rel="noopener ugc nofollow" target="_blank">用于时间序列预测的简化回归模型</a></p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="3fda" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">📗体系结构</h1><p id="84fc" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated"><code class="fe mz na nb nc b">pycaret</code>时间序列模块建立在<code class="fe mz na nb nc b">sktime</code>之上，后者是时间序列分析的统一框架。<code class="fe mz na nb nc b">sktime</code>的目标是做时间序列分析，就像<code class="fe mz na nb nc b">sklearn</code>做机器学习一样。如果你愿意，你可以在这里阅读更多关于它的内容，但是这并不是本文所必需的，因为我将给出一个快速的概述。</p><p id="5428" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><code class="fe mz na nb nc b">sktime</code>提供了一个框架来:</p><ol class=""><li id="4af9" class="nd ne it ma b mb mu me mv mh nf ml ng mp nh mt ni nj nk nl bi translated">使用简化回归技术创建带有<code class="fe mz na nb nc b">sklearn</code>回归变量的时间序列模型(参见建议的上一篇阅读)。</li><li id="57b1" class="nd ne it ma b mb nm me nn mh no ml np mp nq mt ni nj nk nl bi translated">用类似于<code class="fe mz na nb nc b">sklearn</code>提供的转换创建模型管道。</li><li id="45d1" class="nd ne it ma b mb nm me nn mh no ml np mp nq mt ni nj nk nl bi translated">使用适配器连接到其他时序包(如<code class="fe mz na nb nc b"><a class="ae ky" href="https://github.com/alan-turing-institute/sktime/blob/v0.8.1/sktime/forecasting/base/adapters/_statsmodels.py#L17" rel="noopener ugc nofollow" target="_blank">statsmodels</a></code>、<code class="fe mz na nb nc b"><a class="ae ky" href="https://github.com/alan-turing-institute/sktime/blob/v0.8.1/sktime/forecasting/base/adapters/_pmdarima.py#L14" rel="noopener ugc nofollow" target="_blank">pmdarima</a></code>、<code class="fe mz na nb nc b"><a class="ae ky" href="https://github.com/alan-turing-institute/sktime/blob/4e06cb0231cdabb74bf88d0cb4f2b721fc863fe3/sktime/forecasting/base/adapters/_tbats.py#L18" rel="noopener ugc nofollow" target="_blank">tbats</a></code>、<code class="fe mz na nb nc b"><a class="ae ky" href="https://github.com/alan-turing-institute/sktime/blob/v0.8.1/sktime/forecasting/base/adapters/_fbprophet.py#L19" rel="noopener ugc nofollow" target="_blank">prophet</a></code>等)。</li><li id="2144" class="nd ne it ma b mb nm me nn mh no ml np mp nq mt ni nj nk nl bi translated">允许用户使用<a class="ae ky" href="https://github.com/alan-turing-institute/sktime/blob/v0.8.1/extension_templates/forecasting.py" rel="noopener ugc nofollow" target="_blank">扩展模板</a>创建他们自己的预测模型。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/4a8e995c2b37b46df8fbdc0658bcff9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hpJzvk2Yvupk7MVrO8aiXg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">PyCaret时序模块:架构概述[图片由作者提供]</p></figure><p id="8006" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">虽然用户可以直接使用<code class="fe mz na nb nc b">sktime</code>库来创建模型，但是管理工作流和模型比较过程仍然需要手动处理(类似于在<code class="fe mz na nb nc b">sklearn</code>中直接构建模型)。令人欣慰的是，<code class="fe mz na nb nc b">pycaret</code>通过将这些模型、管道和适配器包装在如下所示的方便的框架中，提供了一种用几行代码实现这一点的方便方法。</p><pre class="kj kk kl km gt ns nc nt nu aw nv bi"><span id="2007" class="nw lh it nc b gy nx ny l nz oa">#### Create different types of models ----<br/><br/># ARIMA model from `pmdarima`<br/>arima_model = exp.create_model("arima")<br/><br/># ETS and Exponential Smoothing models from `statsmodels`<br/>ets_model = exp.create_model("ets")<br/>exp_smooth_model = exp.create_model("exp_smooth")<br/><br/># Reduced Regression model using `sklearn` Linear Regression<br/>lr_model = exp.create_model("lr_cds_dt")</span></pre><p id="0dae" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">因此，当你在<code class="fe mz na nb nc b">pycaret</code>中创建一个时间序列模型时，你会得到一个<code class="fe mz na nb nc b">sktime</code>适配器、管道或者一个你自己开发的<code class="fe mz na nb nc b">sktime</code>兼容模型。</p><pre class="kj kk kl km gt ns nc nt nu aw nv bi"><span id="1499" class="nw lh it nc b gy nx ny l nz oa">#### Check model types ----<br/>print(type(arima_model))      # sktime `pmdarima` adapter <br/>print(type(ets_model))        # sktime `statsmodels` adapter<br/>print(type(exp_smooth_model)) # sktime `statsmodels` adapter<br/>print(type(lr_model))         # Your custom sktime compatible model</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/33800cbcc4fb48bded0a3a93d98a7011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*t-vxfIHOvXJCPJ5eRs84Ng.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">[图片由作者提供]</p></figure><p id="fdf7" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">但是，人们可以从这些模型中提取出比肉眼看到的更多的信息。例如，如果您使用<code class="fe mz na nb nc b">pycaret</code>创建的模型名为<code class="fe mz na nb nc b">model</code>，那么通过调用<code class="fe mz na nb nc b">model._forecaster</code>可以轻松提取底层包装库模型、<code class="fe mz na nb nc b">sktime</code>管道或您的自定义<code class="fe mz na nb nc b">sktime</code>兼容模型。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/b1f30dbfcee6bc2d6929cadec1feea0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7pB1V9heDn2dT1xVFUfCzg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">模型对象和可用方法[作者图片]</p></figure><pre class="kj kk kl km gt ns nc nt nu aw nv bi"><span id="f459" class="nw lh it nc b gy nx ny l nz oa">#### Access internal models using `_forecaster` ----<br/>print(type(arima_model._forecaster))<br/>print(type(ets_model._forecaster))<br/>print(type(exp_smooth_model._forecaster))<br/>print(type(lr_model._forecaster))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/8c13e82106dc80f8010b1fcca7434f55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*Czgh8yy6F9wTEUhGFjDq9Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">[图片由作者提供]</p></figure><p id="2fd0" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">从这一点开始，您可以使用本地库方法/函数或者<code class="fe mz na nb nc b">sktime</code>包装器来提取关于您的模型的有价值的信息。</p><pre class="kj kk kl km gt ns nc nt nu aw nv bi"><span id="6be6" class="nw lh it nc b gy nx ny l nz oa">#### What hyperparameters were used to train the model? ----<br/>print(arima_model)<br/><br/>#### Access statistical fit properties using underlying `pmdarima`<br/>arima_model._forecaster.summary()<br/><br/>#### Alternately, use sktime's convenient wrapper to do so ---- <br/>arima_model.summary()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/72277f6a52fe3e3a1189a719bbf72f34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*eDkT1GetWSS9yrGPLVToMg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ARIMA模型参数[图片由作者提供]</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/91ded22085f74708aaf9991c4e16498b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*gOfxXjSya4wwqhG8vnPrTA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ARIMA模型统计摘要[图片由作者提供]</p></figure><p id="fe98" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">例如，上面的图像向我们展示了ARIMA模型是按照截距的要求建立的。拟合得出截距值为5.798。我们将在另一篇文章中讨论这些统计细节(见建议的下一篇文章)，但现在，只要知道这些信息可以很容易地访问。</p><p id="c647" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">类似地，我们可以使用类似于<code class="fe mz na nb nc b">sklearn</code>中的方法提取关于管道的信息。</p><pre class="kj kk kl km gt ns nc nt nu aw nv bi"><span id="5d83" class="nw lh it nc b gy nx ny l nz oa">#### sktime pipelines are similar to sklearn.<br/>#### Access steps using `named_steps` attribute<br/>print(lr_model._forecaster.named_steps.keys())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/6308c16a92a571a28c62701f4f598d61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*0g1XVVU1SOykA8PKYC-Izg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">模型管道步骤[图片由作者提供]</p></figure><p id="b21f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">因此，这个模型实际上是一个包含3个步骤的管道——一个条件去理性化器，接着是去渲染器，然后是实际预测器。您可以通过调用<code class="fe mz na nb nc b">named_steps</code>来获得关于这些步骤的更多细节。例如，我们可以看到预测器实际上是使用<code class="fe mz na nb nc b">sklearn</code> <code class="fe mz na nb nc b">LinearRegression</code>的基于回归的模型。这就是我们在构建<code class="fe mz na nb nc b">lr_cds_dt</code>模型时所要求的(<code class="fe mz na nb nc b">lr</code>代表线性回归，<code class="fe mz na nb nc b">cds</code>代表条件反季节器，<code class="fe mz na nb nc b">dt</code>代表Detrender)。</p><pre class="kj kk kl km gt ns nc nt nu aw nv bi"><span id="3250" class="nw lh it nc b gy nx ny l nz oa">#### Details about the steps ----<br/>pprint(lr_model._forecaster.named_steps)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/a58ccd67b909d483d798a6b5ba8f986a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f7A99oVOmuiU8wCwH4hZqQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">模型管道细节[图片由作者提供]</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="8b4b" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">🚀结论</h1><p id="8e02" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">虽然<code class="fe mz na nb nc b">pycaret</code>提供了一个低代码环境来创建和管理建模工作流，但是如果我们深入观察，还有更多的事情可以做。这篇文章只是触及了可能性的表面。在以后的文章中，我们将看看如何使用<code class="fe mz na nb nc b">pycaret</code>来理解底层模型的工作，比如ARIMA。在那之前，如果你愿意在我的社交渠道上与我联系(我经常发布关于时间序列分析的文章)，你可以在下面找到我。暂时就这样了。预测快乐！</p><p id="c474" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">🔗<a class="ae ky" href="https://www.linkedin.com/in/guptanick/" rel="noopener ugc nofollow" target="_blank">领英</a></p><p id="c1f3" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">🐦<a class="ae ky" href="https://twitter.com/guptanick13" rel="noopener ugc nofollow" target="_blank">推特</a></p><p id="b239" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">📘<a class="ae ky" href="https://github.com/ngupta23" rel="noopener ugc nofollow" target="_blank"> GitHub </a></p><p id="1b1a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><em class="oh">喜欢这篇文章吗？成为</em> <a class="ae ky" href="https://ngupta13.medium.com/membership" rel="noopener"> <strong class="ma iu"> <em class="oh">中等会员</em> </strong> </a> <em class="oh">继续</em> <strong class="ma iu"> <em class="oh">无限制学习</em> </strong> <em class="oh">。如果您使用下面的链接，</em> <strong class="ma iu"> <em class="oh">，我将收取您的一部分会员费，您无需支付额外费用</em> </strong> <em class="oh">。</em></p><div class="oi oj gp gr ok ol"><a href="https://ngupta13.medium.com/membership" rel="noopener follow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd iu gy z fp oq fr fs or fu fw is bi translated">通过我的推荐链接加入Medium—Nikhil Gupta</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">阅读Nikhil Gupta(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">ngupta13.medium.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz ks ol"/></div></div></a></div></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="3a77" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">📗资源</h1><ul class=""><li id="0ea4" class="nd ne it ma b mb mc me mf mh pa ml pb mp pc mt pd nj nk nl bi translated"><a class="ae ky" href="https://nbviewer.ipython.org/github/ngupta23/medium_articles/blob/main/time_series/pycaret/pycaret_ts_architecture.ipynb" rel="noopener ugc nofollow" target="_blank"><strong class="ma iu"/></a>【Jupyter Notebook】(可在Google Colab中打开)包含本文代码</li></ul></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="ed34" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">📖建议下一次阅读</h1><p id="66a0" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated"><a class="ae ky" href="https://medium.com/p/692e10ca02f2" rel="noopener">使用PyCaret的时间序列模块了解ARIMA模型—第一部分</a></p><p id="893c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><a class="ae ky" href="https://github.com/pycaret/pycaret/discussions/1867" rel="noopener ugc nofollow" target="_blank">向PyCaret添加自定义时间序列模型</a></p></div></div>    
</body>
</html>