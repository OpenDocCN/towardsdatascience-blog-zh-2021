<html>
<head>
<title>Working with Flux.jl Models on the Hugging Face Hub 🤗</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在拥抱面中枢上使用Flux.jl模型🤗</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/working-with-flux-jl-models-on-the-hugging-face-hub-b95af2b80a47?source=collection_archive---------18-----------------------#2021-10-13">https://towardsdatascience.com/working-with-flux-jl-models-on-the-hugging-face-hub-b95af2b80a47?source=collection_archive---------18-----------------------#2021-10-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/bd11fdd320f7d9b84b5b67da1ffbd9e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vKZVt9F3XWtvOSpm2nRBtA.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</p></figure><p id="15e0" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">本文将详细介绍如何在<a class="ae ld" href="https://fluxml.ai" rel="noopener ugc nofollow" target="_blank">flux . JL</a>(100%朱莉娅·迪普·学习包)中保存模型，然后从Hugging Face Hub上传或检索它。对于那些不知道什么是<a class="ae ld" href="https://huggingface.co" rel="noopener ugc nofollow" target="_blank">抱脸</a> (HF)的人来说，它就像GitHub一样，只是针对机器学习模型。传统上，机器学习模型通常会被锁起来，只有创建它们的团队才能访问。HF正在机器学习生态系统中掀起风暴，因此了解如何在您的机器学习工作流程中使用platfrom至关重要。让我们深入了解如何使用您最喜欢的Julia ML软件包来处理HF🤗！</p><p id="623e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如果你以前从未使用过Flux.jl，你可以在这里找到安装说明:【https://fluxml.ai/Flux.jl/stable/#Installation<a class="ae ld" href="https://fluxml.ai/Flux.jl/stable/#Installation" rel="noopener ugc nofollow" target="_blank">，下面还有一个关于你为什么会想使用它的快速视频:</a></p><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="li lj l"/></div></figure></div><div class="ab cl lk ll hx lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="im in io ip iq"><p id="3ae0" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">编辑:我和我的合著者很高兴地告诉大家，我们的新书《朱莉娅速成班》已经开始预售了</p><div class="ls lt gp gr lu lv"><a href="https://logankilpatrick.gumroad.com/l/juliacrashcourse" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd iu gy z fp ma fr fs mb fu fw is bi translated">朱莉娅速成班(电子书预购)</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">Julia速成课程是使用Julia编程语言的实践指南，是为初学者编写的。我们接受…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">logankilpatrick.gumroad.com</p></div></div><div class="me l"><div class="mf l mg mh mi me mj jz lv"/></div></div></a></div></div><div class="ab cl lk ll hx lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="im in io ip iq"><p id="131b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">好了，现在我们已经安装了Flux，并且您知道我们为什么可能要使用它，让我们创建一个简单的模型:</p><pre class="le lf lg lh gt mk ml mm mn aw mo bi"><span id="3c32" class="mp mq it ml b gy mr ms l mt mu">julia&gt; using Flux<br/>julia&gt; model = Chain(Dense(10,5,relu),Dense(5,2),softmax)<br/>Chain(Dense(10, 5, relu), Dense(5, 2), softmax)</span></pre><p id="99e4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">然后，我们可以导入<a class="ae ld" href="https://github.com/JuliaIO/BSON.jl" rel="noopener ugc nofollow" target="_blank"> BSON包</a>(这就是我们如何保存我们的模型，以便他们可以被其他人在拥抱脸上消费)</p><pre class="le lf lg lh gt mk ml mm mn aw mo bi"><span id="c647" class="mp mq it ml b gy mr ms l mt mu">julia&gt; using BSON: <a class="ae ld" href="http://twitter.com/save" rel="noopener ugc nofollow" target="_blank">@save</a></span></pre><p id="c810" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">最后，我们实际上可以通过执行以下操作来保存模型:</p><pre class="le lf lg lh gt mk ml mm mn aw mo bi"><span id="0c39" class="mp mq it ml b gy mr ms l mt mu">julia&gt; <a class="ae ld" href="http://twitter.com/save" rel="noopener ugc nofollow" target="_blank">@save</a> "mymodel.bson" model</span></pre><p id="1b9b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">接下来，我们将把模型上传到拥抱脸中心，然后尝试在新的会话中下载它。如果您想了解更多关于Flux中的模型构建，请查看下面的视频:</p><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="li lj l"/></div></figure></div><div class="ab cl lk ll hx lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="im in io ip iq"><p id="45f6" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">前往:<a class="ae ld" href="https://huggingface.co" rel="noopener ugc nofollow" target="_blank">https://huggingface.co</a>并创建一个帐户。我不会经历所有这些步骤，因为它相当简单，但如果你遇到任何问题，请张贴在拥抱脸话语实例上:<a class="ae ld" href="https://discuss.huggingface.co" rel="noopener ugc nofollow" target="_blank">https://discuss.huggingface.co</a></p><p id="e0a8" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在您已经在HF Hub上启动并运行，我们将在右上角选择您的个人资料图标，然后选择“新型号”。</p><figure class="le lf lg lh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/331b2f1246bf1ed0b558f99d01dc39b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yGhwX4X-omuvu-4na6XLPw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</p></figure><p id="4a34" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">从那里，填写相关的细节，然后创建模型。你可以在这里找到我创建的基本模型:<a class="ae ld" href="https://huggingface.co/LoganKilpatrick/BasicFluxjlModel" rel="noopener ugc nofollow" target="_blank">https://huggingface.co/LoganKilpatrick/BasicFluxjlModel</a></p><p id="8873" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在您创建了基本的模型卡之后，下一步就是以BSON格式上传模型。如果你导航回到<a class="ae ld" href="https://docs.julialang.org/en/v1/stdlib/REPL/" rel="noopener ugc nofollow" target="_blank">朱莉娅·REPL</a>，你可以键入<code class="fe mw mx my ml b">;</code>然后<code class="fe mw mx my ml b">pwd</code>来找到你在本地保存模型的地方。我的保存在我的桌面上，以便于查找。在HF上，转到右侧的“文件和版本”和“添加文件”。现在你应该有一个自述文件和一个BSON格式的模型保存到拥抱脸中心了！接下来，如何将模型放回你的电脑或其他人的电脑？</p></div><div class="ab cl lk ll hx lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="im in io ip iq"><p id="87ce" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">所以现在我们有一个模型保存到HF Hub，下一件事你可能想做的是下载别人的通量模型(像我的:<a class="ae ld" href="https://huggingface.co/LoganKilpatrick/BasicFluxjlModel" rel="noopener ugc nofollow" target="_blank">https://huggingface.co/LoganKilpatrick/BasicFluxjlModel</a>)。</p><p id="1aee" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">HF提供了一个<a class="ae ld" href="https://huggingface.co/docs/hub/how-to-downstream" rel="noopener ugc nofollow" target="_blank"> Python库来与Hub </a>交互。由于我还没有时间用pure Julia重新编写整个包，我们将开发出可靠的PyCall.jl包，它允许我们在Julia REPL会话或脚本中直接运行Python代码。</p><p id="b6ed" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">花一些时间来遵循PyCall安装指南:<a class="ae ld" href="https://github.com/JuliaPy/PyCall.jl#installation" rel="noopener ugc nofollow" target="_blank">https://github.com/JuliaPy/PyCall.jl#installation</a>，如果有任何不清楚的地方，请做开放问题。</p><p id="7d04" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">好了，现在你已经启动并运行了，让我们使用它吧！</p><pre class="le lf lg lh gt mk ml mm mn aw mo bi"><span id="e0da" class="mp mq it ml b gy mr ms l mt mu">julia&gt; using PyCall</span><span id="08f0" class="mp mq it ml b gy mz ms l mt mu">julia&gt; hf = pyimport("huggingface_hub")<br/>PyObject &lt;module 'huggingface_hub' from '/Users/logankilpatrick/.julia/conda/3/lib/python3.8/site-packages/huggingface_hub/__init__.py'&gt;</span></pre><p id="ba51" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">注意，这里假设您已经在我们通过PyCall使用的同一个Python环境中安装了<em class="lr"> huggingface_hub </em> Python包。</p><p id="01f6" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">那么我们到底有什么呢？我们用PyCall导入了一个Python包到Julia？是啊！现在我们已经导入了它，我们可以像平常使用Python包一样使用它:</p><pre class="le lf lg lh gt mk ml mm mn aw mo bi"><span id="be08" class="mp mq it ml b gy mr ms l mt mu">julia&gt; hf.snapshot_download(repo_id="LoganKilpatrick/BasicFluxjlModel", revision="main")<br/>Downloading: 100%|██████████████████████████| 1.18k/1.18k [00:00&lt;00:00, 345kB/s]<br/>Downloading: 100%|██████████████████████████████| 711/711 [00:00&lt;00:00, 130kB/s]<br/>Downloading: 100%|█████████████████████████| 10.3k/10.3k [00:00&lt;00:00, 2.07MB/s]<br/>"/Users/logankilpatrick/.cache/huggingface/hub/LoganKilpatrick__BasicFluxjlModel.077a4b77d6175a09c156a20cf5bed0eac35c97ee"</span></pre><p id="728d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在我们已经将模型repo保存在本地，让我们再次将朱莉娅repo切换到命令行模式，键入<code class="fe mw mx my ml b">;</code>，然后将目录更改到模型文件的位置。</p><pre class="le lf lg lh gt mk ml mm mn aw mo bi"><span id="ded4" class="mp mq it ml b gy mr ms l mt mu">shell&gt; cd "/Users/logankilpatrick/.cache/huggingface/hub/LoganKilpatrick__BasicFluxjlModel.077a4b77d6175a09c156a20cf5bed0eac35c97ee"</span></pre><p id="ecd4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">为了再次检查我们做得是否正确，我将运行一个list命令:</p><pre class="le lf lg lh gt mk ml mm mn aw mo bi"><span id="2f53" class="mp mq it ml b gy mr ms l mt mu">shell&gt; ls -l<br/>total 32<br/>-rw - - - - 1 logankilpatrick staff 711 Oct 13 08:37 README.md<br/>-rw - - - - 1 logankilpatrick staff 10260 Oct 13 08:37 mymodel.bson</span></pre><p id="54c0" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">太好了！我们在那里看到了模型。现在让我们把它装回通量。</p><pre class="le lf lg lh gt mk ml mm mn aw mo bi"><span id="89ad" class="mp mq it ml b gy mr ms l mt mu">julia&gt; using BSON: <a class="ae ld" href="http://twitter.com/load" rel="noopener ugc nofollow" target="_blank">@load</a><br/>julia&gt; <a class="ae ld" href="http://twitter.com/load" rel="noopener ugc nofollow" target="_blank">@load</a> "mymodel.bson" model<br/>julia&gt; model<br/>Chain(Dense(10, 5, relu), Dense(5, 2), softmax)</span></pre><p id="cd9d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">嘣！我们做到了🎊！我们成功地用Flux创建了一个模型，上传到Hub，然后下载了一个新的模型(或者是你创建的同一个)加载回Flux / Julia。</p><p id="a920" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">下一步是保持训练模型并上传/分享它们。拥抱脸中心是一个与其他ML研究者和实践者合作的非常时髦的方式，所以我会在那里见到你！</p><p id="b640" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">另外，我还在HF上创建了一个Julia语言组织，所以如果你有一些令人印象深刻的模型想要分享，ping我和我可以将你添加到该组织(<a class="ae ld" href="https://huggingface.co/JuliaLanguage" rel="noopener ugc nofollow" target="_blank">https://huggingface.co/JuliaLanguage</a>)。</p><p id="8489" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">~洛根·基尔帕特里克(【https://twitter.com/OfficialLoganK】T2</p></div></div>    
</body>
</html>