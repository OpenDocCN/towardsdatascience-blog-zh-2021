<html>
<head>
<title>A Simple Guide to Improving Your Skills in Scheduling Queries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">提高查询调度技能的简单指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-simple-guide-to-improve-your-skills-in-scheduling-queries-40df2aea1f24?source=collection_archive---------25-----------------------#2021-06-16">https://towardsdatascience.com/a-simple-guide-to-improve-your-skills-in-scheduling-queries-40df2aea1f24?source=collection_archive---------25-----------------------#2021-06-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4497" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">创建计划查询时可以遵循的一些基本原则和策略。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/79a1ed554e0c289206f12f35af761d6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3t1L9D6f2_pRT23_"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@loic?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Djim Loic </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="059a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我作为数据专家的日常工作中，查询是您将面临的最常见的任务之一。当您重复使用这些查询来生成报告、仪表板甚至培训数据时，我们将需要高效地调度和管理它们。</p><p id="af6b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我想分享一些原则和策略，您可以使用这些原则和策略根据您的具体情况创建一个计划查询。如果您是数据分析师或数据科学家的新手，我希望这些知识会派上用场。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="e678" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">要遵循的一些原则</h1><p id="8065" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在我的日常活动中，我发现这些原则在执行和管理我的预定查询时帮助很大。它不会在一夜之间到来，你必须一点一点地开始做，并让自己适应它。</p><h2 id="766a" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated"><strong class="ak">声明你的变量/参数</strong></h2><p id="d9d8" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">它可以是开始和结束日期或时间戳、过滤器中使用的特定变量等。这是一个很好的实践，因为您可以根据自己的需要快速更改它。</p><p id="f65b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，当您从多个表中进行查询时，日期筛选器可能会在多个子查询中使用，这种方法使您只需更改参数，而不必更改子查询的<strong class="ky ir"> ALL </strong>中的<strong class="ky ir"> WHERE </strong>子句</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">要在查询中使用的开始和结束日期变量/参数声明</p></figure><h2 id="9ccd" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated"><strong class="ak">首先处理数据的小子集</strong></h2><p id="1030" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">首先使用一小部分数据组成查询(如果可能的话)。您可以首先使用过去1天或过去7天的数据，然后基于这些数据创建一个完全运行的计划查询(根据第一条原则，您可能只需更改参数😃).</p><h2 id="8424" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated"><strong class="ak">使用分区！</strong></h2><p id="6c8a" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">最常见的是按日期分区。此外，我发现使用date local作为您的分区(在您的调度查询中)非常有帮助。因为您的报告经常需要您根据当地时间<strong class="ky ir">中的某个时间段进行过滤，这可以节省您运行查询的时间和成本。</strong></p><p id="6ca2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要了解表中分区的更多信息，您可以访问此链接:<a class="ae kv" href="https://www.sqlshack.com/database-table-partitioning-sql-server/" rel="noopener ugc nofollow" target="_blank">https://www . SQL shack . com/database-table-partitioning-SQL-server/</a></p><h2 id="1fad" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated"><strong class="ak">避免使用从另一个预定查询创建的表</strong></h2><p id="6083" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">如果可能的话，总是使用主表作为SQL查询的源。它可以是直接从事务数据库、数据仓库、数据集市提取的表，或者是您和其他人都认为这些表是您所需数据的主要来源的任何类型的表。</p><p id="037a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您使用另一个计划查询中的表并一直这样做，您可能会失去对更改和执行时间的跟踪，如果一些计划失败并导致您的仪表板停止工作，情况可能会很混乱。</p><h2 id="0074" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated"><strong class="ak">要清楚，要干净</strong></h2><p id="5012" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">像在编程语言实践中一样，编写清晰的SQL查询，必要时添加注释，尽可能使用清晰的变量或别名。这将有助于您和您的团队理解查询中正在发生的事情，并使您在将来需要重新访问它进行更新时变得更加容易。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">不太清楚和非常清楚的SQL查询示例</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="97e4" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">一些你可以使用的策略</h1><p id="8175" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">创建查询后，就该安排它了。如果你的查询不需要产生任何表，那么<strong class="ky ir"> <em class="nk">你可以忽略这些策略</em> </strong>。但是，通常您需要将结果存储在一个表中，以便在报告工具、仪表板甚至基本的机器学习管道中使用。</p><h2 id="2088" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated"><strong class="ak">替换所有策略</strong></h2><p id="f4a3" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这是最简单的策略，只需运行您的查询，然后将其存储在一个表中。它可以是每日生成的销售线索/销售列表、上个月的流失客户列表等。</p><p id="0cfe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我不认为我需要解释更多关于这个策略，它已经很明显了。</p><h2 id="54a3" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated"><strong class="ak">简单追加策略</strong></h2><p id="bf00" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">当您需要不断地向表中添加新数据时，可以使用这种策略，比如监控仪表板。</p><p id="bc4b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，您需要创建您的初始表作为您的基表，然后您可以根据您的需要，每天、每周、每月使用您的预定查询追加更多的数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/f632e62372ffb68bd8cdb724858f6baf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RVdlOSWYdlv5dUYzxowGMQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">简单附加策略(图片由作者提供)</p></figure><p id="f243" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果需要，不要忘记设置分区👍</p><h2 id="4a2e" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated"><strong class="ak">窗口追加策略</strong></h2><p id="b833" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">有时，您会处理不断更新的数据，这些数据可能来自事件跟踪器或其他一些系统，我们预计从这些数据源提取数据会有延迟，例如firebase事件数据。</p><p id="2d2a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设您已经使用计划查询制作了昨天数据的快照，并将其存储在您的表中，但是在您运行计划查询之后，您的主数据源中的数据会有一些更新，此外，您不知道确切的数据更新/插入时间。这会使您的表中的数据无效或不完整，因此您的报告中产生的信息也无效。</p><p id="fba6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这种情况下，最好以窗口方式运行追加策略。因为在每次运行中，我们都用新的数据替换数据，所以我们可以减少无效或不完整数据的可能性。您可以根据在您的数据环境中最有意义的方式来设置窗口时段。对于每日计划查询，我通常将窗口设置为3到7天。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/e3d31e532471c9ce54af58f952880be6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZXYCGq6PnTOZ9ZbZjgVwRg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">窗口附加策略(作者图片)</p></figure><h2 id="bd77" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated"><strong class="ak">计算然后替换策略</strong></h2><p id="2534" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在某些用例中，您需要根据以前的数字计算一些数字，就像运行计算一样。</p><p id="2696" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，我们希望有一个不断更新的特定用户的每周总支出，根据这个支出金额，我们希望给我们的客户特殊待遇。</p><p id="d3cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种问题实际上可以通过简单地根据我们的每日/每周附加表(来自前面的策略)合计用户的所有支出来解决。当数据变得太大时，将来可能会出现不好的情况，运行这种聚合查询的成本会很高。</p><p id="e0c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，您可以简单地一次性捕获每个用户的最新周总支出作为基表，然后通过简单地添加<strong class="ky ir">previous _ total _ spending+current _ week _ total _ spending</strong>来逐步更新该值。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/e5be6ae74d1e04cde921ec771db96032.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AqPaNmUlJaX2fjsMuPIyGQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">计算然后替换策略(图片由作者提供)</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="a8ef" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结束语</h1><p id="ec86" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">处理查询确实是数据专业人员最常执行的任务之一。随着时间的推移，我们必须提高工作效率，以便更快地交付成果和见解。到一天结束时，我们可以开始花更多的时间来解决越来越多的业务问题。</p><p id="9b61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的一些策略是基于我的经验，可能会有更多的策略来探索其他用例。我很开放，如果你有反馈或想补充一些我在这里错过的其他策略，将不胜感激！</p><p id="da10" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，快乐学习！！！🚀</p></div></div>    
</body>
</html>