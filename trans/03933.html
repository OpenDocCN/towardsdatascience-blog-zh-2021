<html>
<head>
<title>Terraform + SageMaker Part 1: Terraform Initialization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Terraform + SageMaker第1部分:Terraform初始化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/terraform-sagemaker-part-1-terraform-initialization-a6470611ea92?source=collection_archive---------8-----------------------#2021-04-02">https://towardsdatascience.com/terraform-sagemaker-part-1-terraform-initialization-a6470611ea92?source=collection_archive---------8-----------------------#2021-04-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/2a8c4b11f34e77058ea23df19b50864a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ey6u9n2qTRSuTcXgu2HdRA.png"/></div></div></figure><h2 id="2249" class="jc jd je bd b dl jf jg jh ji jj jk dk jl translated" aria-label="kicker paragraph">Terraform + SageMaker</h2><div class=""/><div class=""><h2 id="4372" class="pw-subtitle-paragraph kk jn je bd b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dk translated">帮助您开始使用Terraform在AWS SageMaker上创建资源</h2></div><p id="87fb" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">大家好。今天，我们开始了一个关于使用Terraform在AWS SageMaker上创建资源的新系列。我想你可能很熟悉SageMaker是什么，即使只是非常一般的水平。简单来说，SageMaker就是AWS的机器学习服务。多年来，AWS在这一特定服务上投入了大量精力，显然是为了应对数据科学/机器学习实践在所有行业中的爆炸式增长。跟上这种增长有点困难！甚至我也很乐意承认我对SageMaker Studio这样的新东西不太熟悉，但我很高兴能在这个新系列的帖子中与大家一起了解更多。</p><p id="121e" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">即使你对SageMaker有一个大概的了解，你也可能不知道Terraform是什么。说实话，我自己也不知道Terraform，直到我工作的公司采用了它。Terraform是HashiCorp创建的“基础设施代码”产品，用于将基础设施资源部署到各种平台上。它本身并不是一个AWS产品，但它被设计成可以很好地与AWS交互。</p><p id="0270" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">很自然地，我希望你问自己这样一个问题，“为什么是Terraform？”我们将在下一节中介绍这一点，在接下来的几节中，我们将开始使用Terraform在AWS上创建您的第一个资源。显而易见，在第一篇文章中，我们不会触及SageMaker，但是我们为后面的文章打下了基础。相信我，你不会想错过这篇文章的！</p><p id="44f7" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">至此，让我们开始讨论为什么我们要使用Terraform。</p><h1 id="b692" class="ly lz je bd ma mb mc md me mf mg mh mi kt mj ku mk kw ml kx mm kz mn la mo mp bi translated">为什么是Terraform？</h1><p id="7643" class="pw-post-body-paragraph lc ld je le b lf mq ko lh li mr kr lk ll ms ln lo lp mt lr ls lt mu lv lw lx im bi translated">当您与AWS控制台交互来做诸如创建S3桶、提供EC2实例或几乎所有其他事情时，您基本上是在发出软件命令来创建资源。AWS控制台可以很好地指导您理解如何正确地提供给定的资源。但是控制台并不适合一次性创建或销毁大量资源。因为AWS控制台基本上是执行软件命令来创建这些基础设施资源，所以我们可以创建软件脚本来自动化这些资源的创建，就像我们自动化软件所能做的任何事情一样。</p><p id="721a" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">因此，如果你像我一样是一个初学者，你可能不希望在不使用AWS资源时让它们一直运行。如果设置正确，Terraform可以帮助您快速设置或在几秒钟内吹走您的资源。想想在控制台界面中设置一个S3存储桶需要多长时间。有了Terraform，我可以在比一个人在控制台上创建一个S3桶更短的时间内创建一个完整的资源库。不错！</p><p id="bbc9" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">如果你参加过任何AWS认证，你可能还记得AWS有自己的名为云形成的服务，可以让你做到这一点。你可能会合理地问，为什么我们要使用地形而不是云的形成。不要误解我，云形成是一项伟大的服务，但Terraform提供了云形成的许多其他好处。其中一些包括以下内容:</p><ul class=""><li id="5dab" class="mv mw je le b lf lg li lj ll mx lp my lt mz lx na nb nc nd bi translated"><strong class="le jo">平台不可知</strong>:虽然我们在这个系列中只使用AWS，但是Terraform也可以在其他平台上提供资源，包括谷歌云平台、微软Azure等等。您不一定能够在其他平台上使用您的AWS Terraform脚本，但是因为Terraform是它自己的脚本语言，所以这些知识可以很好地移植到其他平台上。</li><li id="b7b0" class="mv mw je le b lf ne li nf ll ng lp nh lt ni lx na nb nc nd bi translated"><strong class="le jo">状态管理</strong> : Terraform提供了一些非常健壮的选项来维护你的资源状态。我们将在下一节中详细讨论这一点，但如果您使用HashiCorp的更高级的产品，如Terraform Cloud或Terraform Enterprise，您确实可以使用这种状态管理做一些非常高级的事情。说到高级的东西…</li><li id="ded7" class="mv mw je le b lf ne li nf ll ng lp nh lt ni lx na nb nc nd bi translated"><strong class="le jo">前哨政策</strong>:这是我们不会在本系列中讨论的高级主题和高级功能之一，但是前哨政策基本上执行所有Terraform provisioners必须遵守的某些规则。假设您为一家大型公司工作，该公司需要为部署的每项资源指定一组特定的标记。创建一个前哨政策可以帮助以非常简化的方式实现这一点！</li></ul><p id="1a5d" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">好处太多了，无法一一列举。虽然上面提到的那些高级特性不是免费的，但是我们可以免费使用标准的Terraform命令行操作。当然，您在AWS上提供的资源可能不是免费的，但是发出我们将在本系列中学习的Terraform命令是没有成本的。</p><p id="2450" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">在我们开始初始化Terraform之前，让我们简单地谈谈状态管理。</p><h1 id="5656" class="ly lz je bd ma mb mc md me mf mg mh mi kt mj ku mk kw ml kx mm kz mn la mo mp bi translated">地形状态管理</h1><p id="737a" class="pw-post-body-paragraph lc ld je le b lf mq ko lh li mr kr lk ll ms ln lo lp mt lr ls lt mu lv lw lx im bi translated">当我们在自己选择的平台上创建资源时——在我们的例子中是AWS——terra form以一个<strong class="le jo"> Terraform状态文件</strong>的形式管理它所提供的资源。Terraform状态文件通常是一个以<code class="fe nj nk nl nm b">.tfstate</code>后缀结尾的文件，它保存了迄今为止您使用Terraform脚本提供的所有信息。如果您对这些脚本中的任何一个进行调整，Terraform CLI命令将分析<code class="fe nj nk nl nm b">tfstate</code>文件，以查看它需要采取什么操作。例如，如果资源不在<code class="fe nj nk nl nm b">tfstate</code>文件中，那么Terraform将为您创建新的资源。如果资源存在，但有一些轻微的配置更改，Terraform将适当地更新资源，并使用新的配置信息更新<code class="fe nj nk nl nm b">tfstate</code>文件。</p><p id="0f6b" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">正如你可能猜到的，这个<code class="fe nj nk nl nm b">tfstate</code>文件有一些“陷阱”。首先，如果你在一个团队中合作，使用同一个<code class="fe nj nk nl nm b">tfstate</code>文件来提供各种资源，那么你就冒着基本上踩到对方的脚趾并破坏你的<code class="fe nj nk nl nm b">tfstate</code>文件的风险。这是一个非常重要的考虑因素，但是由于本系列将更多地关注单用户使用，所以我不打算在本系列中讨论状态管理的这一方面。当在多人之间工作时，这仍然是一个需要考虑的非常重要的话题，所以我建议你<a class="ae nn" href="https://www.terraform.io/docs/language/state/index.html" rel="noopener ugc nofollow" target="_blank">查看Terraform的网站</a>以了解更多关于状态锁定以避免腐败的信息。</p><p id="0ea4" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们将在本帖中讨论的更重要的“问题”与<code class="fe nj nk nl nm b">tfstate</code>文件本身的性质有关。正如您可能猜到的那样，<code class="fe nj nk nl nm b">tfstate</code>文件可能包含非常敏感的信息，因为它基本上告诉了世界您向任何平台提供了什么。它甚至可能包含您不想公开的敏感元数据。幸运的是，Terraform提供了许多解决方案来保证你的<code class="fe nj nk nl nm b">tfstate</code>文件的安全。如果我希望你能从这一段中得到什么，那就是:<strong class="le jo">不要把你的</strong> <code class="fe nj nk nl nm b"><strong class="le jo">tfstate</strong></code> <strong class="le jo">文件发布到任何公共场所，尤其是GitHub </strong>。坏演员就在那里，如果可能的话，他们会利用这一点。但是不用担心！在这篇文章中，我们将采取的一个行动是建立一个S3桶来存放你的<code class="fe nj nk nl nm b">tfstate</code>文件，并且能够从你的本地机器上与它远程交互。</p><p id="e76e" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">好了，现在我们准备好进入岗位了！让我们从设置我们需要的东西开始，以便能够正确地使用Terraform。</p><h1 id="1a1e" class="ly lz je bd ma mb mc md me mf mg mh mi kt mj ku mk kw ml kx mm kz mn la mo mp bi translated">让我们准备好使用Terraform</h1><p id="1de1" class="pw-post-body-paragraph lc ld je le b lf mq ko lh li mr kr lk ll ms ln lo lp mt lr ls lt mu lv lw lx im bi translated">为了使用Terraform，我们需要具备以下条件:</p><ul class=""><li id="88df" class="mv mw je le b lf lg li lj ll mx lp my lt mz lx na nb nc nd bi translated">安装Terraform CLI</li><li id="24d2" class="mv mw je le b lf ne li nf ll ng lp nh lt ni lx na nb nc nd bi translated">在本地机器上设置凭证以与AWS交互</li><li id="e946" class="mv mw je le b lf ne li nf ll ng lp nh lt ni lx na nb nc nd bi translated">为状态管理设置S3时段</li></ul><p id="6dfe" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">让我们在下面的小节中快速讨论一下如何做这些事情。</p><h2 id="8984" class="no lz je bd ma np nq dn me nr ns dp mi ll nt nu mk lp nv nw mm lt nx ny mo jk bi translated">安装Terraform CLI</h2><p id="5ca1" class="pw-post-body-paragraph lc ld je le b lf mq ko lh li mr kr lk ll ms ln lo lp mt lr ls lt mu lv lw lx im bi translated">第一点非常简单明了。安装Terraform CLI的方法有很多，我将带您去查看<a class="ae nn" href="https://learn.hashicorp.com/tutorials/terraform/install-cli" rel="noopener ugc nofollow" target="_blank"> Terraform的官方文档</a>。如果你一直在关注我最近的其他帖子，我实际上是在一台带有树莓Pi“计算附件”的iPad上完成这篇帖子的我不仅在我的iPad上写这篇文章，而且我使用Textastic应用程序编写了Terraform脚本，然后将它们传输到我的Raspberry Pi，以实际执行Terraform命令。太酷了！</p><h2 id="10ae" class="no lz je bd ma np nq dn me nr ns dp mi ll nt nu mk lp nv nw mm lt nx ny mo jk bi translated">在本地机器上设置AWS凭证</h2><p id="fb23" class="pw-post-body-paragraph lc ld je le b lf mq ko lh li mr kr lk ll ms ln lo lp mt lr ls lt mu lv lw lx im bi translated">因为我们将与位于远程S3存储桶中的<code class="fe nj nk nl nm b">tfstate</code>文件进行交互，所以您需要正确设置您的本地凭证，以便与您的AWS帐户进行交互。如果您之前已经设置了AWS CLI，那么您可能已经准备好了。如果你以前没有做过，这里有官方的AWS文档告诉你如何设置这些证书。与<code class="fe nj nk nl nm b">tfstate</code>文件一样，<strong class="le jo">请注意不要在公共场合分享这些凭证</strong>。同样，坏演员会利用他们，他们会运行你的AWS法案。请像对待您的社会安全号码一样对待这些凭证。</p><h2 id="c76d" class="no lz je bd ma np nq dn me nr ns dp mi ll nt nu mk lp nv nw mm lt nx ny mo jk bi translated">为状态管理创建S3存储桶</h2><p id="974b" class="pw-post-body-paragraph lc ld je le b lf mq ko lh li mr kr lk ll ms ln lo lp mt lr ls lt mu lv lw lx im bi translated">至于为州管理层设置S3存储桶，我们在这里真的没有什么特别要做的。因为我们使用您的AWS凭证与AWS交互，所以您不必将它设为公共存储桶。事实上，我强烈建议不要将水桶公开。(也欢迎您使用预先存在的桶。)使用AWS控制台创建一个bucket非常简单，但是为了以防万一，这里有关于如何做的文档。一旦你的S3桶被创建，我们就准备继续前进。在下一节中，您将看到Terraform如何使用这个桶。</p><h1 id="4563" class="ly lz je bd ma mb mc md me mf mg mh mi kt mj ku mk kw ml kx mm kz mn la mo mp bi translated">编写您的第一个Terraform文件</h1><p id="836f" class="pw-post-body-paragraph lc ld je le b lf mq ko lh li mr kr lk ll ms ln lo lp mt lr ls lt mu lv lw lx im bi translated">好吧，希望前期工作过程是相当无痛的！我们现在准备开始利用Terraform来创建我们的第一个资源。为了保持事情超级简单，我们将创建的唯一东西是一个超级基本的IAM角色，它只能列出S3桶。我选择教这个的原因是因为a)它非常简单，b)我的角色在AWS上是免费的。所以如果你忘记删除角色，没什么大不了的。</p><p id="0cce" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">(补充说明:我保证我们在本帖中所做的不会让你暴露任何漏洞。这不是什么秘密的“特洛伊木马”会让你的AWS账户对黑客开放。如果操作得当，我们正在创建的这个IAM角色基本上什么都不能做。我还会教你如何用Terraform删除资源，这样你就可以保证你的账户里不会留下任何你不想要的东西。)</p><p id="62c7" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">如果你想看我在这篇文章中使用的精确的Terraform文件，<a class="ae nn" href="https://github.com/dkhundley/terraform-sagemaker-tutorial" rel="noopener ugc nofollow" target="_blank">点击这里查看我的GitHub库</a>。尽管这确实包含了我正在使用的S3 bucket的纯文本名称，但是您不能对它做任何事情，因为您没有我的AWS凭证。如果你选择克隆我的回购协议，你将需要更新Terraform后端件，以匹配您自己的相应桶。</p><p id="7cae" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">在这篇文章中，我们不会过多地探究Terraform文件是如何构造的，但我们会在这里介绍一些基础知识。首先，Terraform希望在以<code class="fe nj nk nl nm b">.tf</code>后缀结尾的文件中提供资源。从技术上讲，你可以把所有你想要的东西都塞进一个单独的<code class="fe nj nk nl nm b">.tf</code>文件中。如果你熟悉Kubernetes YAMLs，这里的概念是一样的。尽管从技术上讲，你可以把所有的东西都塞进一个<code class="fe nj nk nl nm b">.tf</code>文件中，但是逻辑上把它们分成你认为合适的独立文件总是有意义的。(我个人喜欢将单个AWS资源与直接关联的IAM策略/角色捆绑到它自己的文件中。)</p><p id="d84d" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">当初始化Terraform以便在给定平台上使用时，Terraform将始终寻找一个<code class="fe nj nk nl nm b">provider</code>块。在这种情况下，我们使用AWS，并将资源部署到地区<code class="fe nj nk nl nm b">us-east-1</code>。(您可以根据自己的喜好更改区域，这没关系。)它将寻找的另一件事是看你是否愿意利用远程后端进行状态管理。鉴于我们已经设置了AWS凭证和bucket，实际的Terraform文件非常简单。以下是我的脚本:</p><pre class="nz oa ob oc gt od nm oe of aw og bi"><span id="90f4" class="no lz je nm b gy oh oi l oj ok">terraform {<br/>  backend "s3" {<br/>    bucket = "dkhundley-terraform-test"<br/>    key    = "terraform-sagemaker-tutorial.tfstate"<br/>    region = "us-east-1"<br/>  }<br/>}</span><span id="846e" class="no lz je nm b gy ol oi l oj ok">provider "aws" {<br/>  region = "us-east-1"<br/>}</span></pre><p id="12ea" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">这个脚本基本上是这样说的:我想将Terraform资源部署到AWS(美国东部1区)，我想在这个给定的bucket中使用一个带有这个键的远程<code class="fe nj nk nl nm b">tfstate</code>文件。你想叫它什么都可以。所以本质上，如果你想效仿我的做法，你唯一需要改变的就是S3桶的名字。</p><p id="4087" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">好了，这就是我们需要做的后端设置！现在，让我们快速展示我们将使用Terraform创建的IAM角色的脚本:</p><pre class="nz oa ob oc gt od nm oe of aw og bi"><span id="3b81" class="no lz je nm b gy oh oi l oj ok">## DATA BLOCKS<br/>## ----------------------------------------------------------------</span><span id="8939" class="no lz je nm b gy ol oi l oj ok"># Creating the data that will be used by the IAM policy<br/>data "aws_iam_policy_document" "s3_ls_policy_data" {<br/>  statement {<br/>    actions = [<br/>      "s3:ListAllMyBuckets"<br/>    ]</span><span id="add7" class="no lz je nm b gy ol oi l oj ok">resources = [<br/>      "arn:aws:s3:::*"<br/>    ]<br/>  }<br/>}</span><span id="790c" class="no lz je nm b gy ol oi l oj ok"># Creating the assume role policy data<br/>data "aws_iam_policy_document" "s3_ls_assume_role_data" {<br/>  statement {<br/>    actions = ["sts:AssumeRole"]</span><span id="0e8e" class="no lz je nm b gy ol oi l oj ok">principals {<br/>      type        = "Service"<br/>      identifiers = ["s3.amazonaws.com"]<br/>    }<br/>  }<br/>}</span><span id="b447" class="no lz je nm b gy ol oi l oj ok">## RESOURCE BLOCKS<br/>## ----------------------------------------------------------------</span><span id="66d5" class="no lz je nm b gy ol oi l oj ok"># Creating the IAM policy using the data block from above<br/>resource "aws_iam_role_policy" "s3_ls_policy" {<br/>  name   = "s3_ls_iam_policy"<br/>  policy = data.aws_iam_policy_document.s3_ls_policy_data.json<br/>  role   = aws_iam_role.s3_ls_role.id<br/>}</span><span id="0576" class="no lz je nm b gy ol oi l oj ok"># Creating the IAM role associated to the resources above<br/>resource "aws_iam_role" "s3_ls_role" {<br/>  name               = "s3_ls_iam_role"<br/>  description        = "This role allows for all S3 buckets to be listed."<br/>  assume_role_policy = data.aws_iam_policy_document.s3_ls_assume_role_data.json<br/>}</span></pre><p id="b633" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">同样，我们不会深入探究所有这些语法的含义。在高层次上，我想提出几件事:</p><ul class=""><li id="e892" class="mv mw je le b lf lg li lj ll mx lp my lt mz lx na nb nc nd bi translated"><strong class="le jo">资源块</strong>:这些是“橡胶遇到道路”的代码块，实际上提供了所需的资源。第一组引号中的字符串定义了Terraform定义的资源类型，因此您必须使用它们的精确语法。第二组引号中的字符串是您想要为资源指定的任意名称。因为Terraform允许您在Terraform代码的其他部分引用该资源，所以为您的资源取一个您能记住的名称总是一个好主意。</li><li id="5026" class="mv mw je le b lf ne li nf ll ng lp nh lt ni lx na nb nc nd bi translated"><strong class="le jo">数据块</strong>:这些数据块通常用于为您计划提供的资源提供额外的配置。在这种情况下，数据块提供了应该如何设置IAM策略的配置。</li><li id="210d" class="mv mw je le b lf ne li nf ll ng lp nh lt ni lx na nb nc nd bi translated"><strong class="le jo">注释</strong>:就像Python一样，用<code class="fe nj nk nl nm b">#</code>符号开始一段代码将允许你用适当的注释来注释你的脚本。你可以看到我在上面用它们来描述每个代码块在做什么。</li></ul><p id="96f6" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">Terraform提供了一个非常强大的文档库，说明如何在AWS上提供几乎所有的资源。(由于AWS不断推出新内容，Terraform可能无法在第一天支持新的AWS服务，但他们非常擅长在新的Terraform版本中更新他们的内容。)要查看这方面的示例，<a class="ae nn" href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role" rel="noopener ugc nofollow" target="_blank">下面是我引用的文档</a>来创建IAM角色本身。</p><p id="e899" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">如果你像我一样构造你的代码，你现在应该有两个Terraform文件:</p><ul class=""><li id="c29d" class="mv mw je le b lf lg li lj ll mx lp my lt mz lx na nb nc nd bi translated">后端. tf</li><li id="c23c" class="mv mw je le b lf ne li nf ll ng lp nh lt ni lx na nb nc nd bi translated">iam.tf</li></ul><p id="0aea" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们将在后面的文章中讨论可重用的地形变量。现在，这个简单的设置将很好地让我们开始。现在让我们实际看看Terraform CLI是如何配置这些资源的。</p><h1 id="d0a5" class="ly lz je bd ma mb mc md me mf mg mh mi kt mj ku mk kw ml kx mm kz mn la mo mp bi translated">使用Terraform CLI进行资源调配</h1><p id="0f63" class="pw-post-body-paragraph lc ld je le b lf mq ko lh li mr kr lk ll ms ln lo lp mt lr ls lt mu lv lw lx im bi translated">现在是时候进入有趣的部分了！有趣是因为我们将在最后一节看到劳动成果很快变成现实。为了快速总结我们将在这些小节中做什么，让我们快速说出下面这些项目符号中的主题:</p><ul class=""><li id="d533" class="mv mw je le b lf lg li lj ll mx lp my lt mz lx na nb nc nd bi translated">执行一个<code class="fe nj nk nl nm b">terraform init</code></li><li id="aab5" class="mv mw je le b lf ne li nf ll ng lp nh lt ni lx na nb nc nd bi translated">验证和格式化您的<code class="fe nj nk nl nm b">tf</code>文件</li><li id="2e97" class="mv mw je le b lf ne li nf ll ng lp nh lt ni lx na nb nc nd bi translated">使用Terraform在AWS上创建资源</li><li id="6a8d" class="mv mw je le b lf ne li nf ll ng lp nh lt ni lx na nb nc nd bi translated">用Terraform破坏你的AWS资源</li></ul><h2 id="064c" class="no lz je bd ma np nq dn me nr ns dp mi ll nt nu mk lp nv nw mm lt nx ny mo jk bi translated">执行一个"<code class="fe nj nk nl nm b">terraform init"</code></h2><p id="98e0" class="pw-post-body-paragraph lc ld je le b lf mq ko lh li mr kr lk ll ms ln lo lp mt lr ls lt mu lv lw lx im bi translated">如上所述，Terraform将首先寻找<code class="fe nj nk nl nm b">provider</code>和<code class="fe nj nk nl nm b">backend</code>，以了解它应该如何正确地与您的AWS帐户进行交互。为了开始“交流”,你首先需要执行<code class="fe nj nk nl nm b">terraform init</code>命令。它还将下载将资源部署到AWS所需的适当插件。如果该命令成功运行，您应该会看到以下内容:</p><figure class="nz oa ob oc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi om"><img src="../Images/08c4798afc0c40a2dda856b1822a8775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6KlQeUcW2Wn-oLl_Z0XXuQ.jpeg"/></div></div><p class="on oo gj gh gi op oq bd b be z dk translated">作者截图</p></figure><p id="816f" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">初始化到此为止！让我们继续验证和格式化您的文件。</p><h2 id="fd39" class="no lz je bd ma np nq dn me nr ns dp mi ll nt nu mk lp nv nw mm lt nx ny mo jk bi translated">验证和格式化您的“tf”文件</h2><p id="b194" class="pw-post-body-paragraph lc ld je le b lf mq ko lh li mr kr lk ll ms ln lo lp mt lr ls lt mu lv lw lx im bi translated">这些步骤实际上并不是必需的，但是它们有助于让您在尝试读取/调试代码时更加轻松。通过运行<code class="fe nj nk nl nm b">terraform validate</code>命令，Terraform将确保您的Terraform文件一切就绪，而无需实际提供任何东西。如果你把事情搞砸了，Terraform会告诉你出了什么问题。为了让你看清楚这是什么样子，我将在我的Terraform中注释掉一个必需的部分。让我们看看当我运行我的<code class="fe nj nk nl nm b">terraform validate</code>命令时会发生什么…</p><figure class="nz oa ob oc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi or"><img src="../Images/5650d38f5de598cc5ccda7b0fe84d97c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SegzI34krn3WOFir5aRZUA.jpeg"/></div></div><p class="on oo gj gh gi op oq bd b be z dk translated">作者截图</p></figure><p id="882c" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">如您所见，我第一次运行<code class="fe nj nk nl nm b">validate</code>命令输出时，非常清楚地指出了我哪里出错了以及如何修复。当我第二次运行<code class="fe nj nk nl nm b">terraform validate</code>命令时，Terraform给我开了绿灯，我的东西看起来不错！</p><p id="eb71" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">后一个命令根本不是必需的，但仍然很好。通过运行<code class="fe nj nk nl nm b">terraform fmt</code>命令，Terraform将查看您的<code class="fe nj nk nl nm b">tf</code>文件，并尽可能使一切变得美好。这包括排列您的所有资源参数，使<code class="fe nj nk nl nm b">=</code>符号全部对齐。同样，完全不是必需的，但我个人认为它很有帮助。</p><h2 id="00aa" class="no lz je bd ma np nq dn me nr ns dp mi ll nt nu mk lp nv nw mm lt nx ny mo jk bi translated">使用Terraform创建AWS资源</h2><p id="0b32" class="pw-post-body-paragraph lc ld je le b lf mq ko lh li mr kr lk ll ms ln lo lp mt lr ls lt mu lv lw lx im bi translated">随着您的Terraform文件得到验证，我们终于可以使用它们在AWS上提供我们的资源了！现在，如果您想在正式创建资源之前了解它们将如何变化，运行<code class="fe nj nk nl nm b">terraform plan</code>命令是个好主意。这个命令将清楚地说明事情将如何变化。这里有一个例子，说明这对于我们的小IAM角色创建意味着什么:</p><figure class="nz oa ob oc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi os"><img src="../Images/b97f81d5856f49bab6a1af296f54f261.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LUlEmKNAuSBY9NFppG9blw.png"/></div></div><p class="on oo gj gh gi op oq bd b be z dk translated">作者截图</p></figure><p id="9735" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">如果一切对您来说都很好，那么您可以通过运行<code class="fe nj nk nl nm b">terraform apply</code>命令来创建这些资源。通过不带任何标志运行这个命令，Terraform将向您显示一个类似于<code class="fe nj nk nl nm b">terraform plan</code>的输出，除了它还会提示您通过输入<code class="fe nj nk nl nm b">yes</code>来确认更改。进入<code class="fe nj nk nl nm b">yes</code>后，Terraform会相应地创建资源，并相应地记录创建成功。</p><figure class="nz oa ob oc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ot"><img src="../Images/c6a9ae703ce9951b58095c6e57e8a6b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*853bXkAieT9KfCURyFItsQ.jpeg"/></div></div><p class="on oo gj gh gi op oq bd b be z dk translated">作者截图</p></figure><p id="7cf4" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">这就对了。您在AWS上使用Terraform创建的第一批资源！如果您进入IAM控制台，您现在应该能够看到我们在其中创建的IAM角色。非常酷！！！</p><figure class="nz oa ob oc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ou"><img src="../Images/c4a6fd1c4878a356a6a5011b8fe55e90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x01FU1H8YwUL7ov0QpQUOQ.png"/></div></div><p class="on oo gj gh gi op oq bd b be z dk translated">作者截图</p></figure><p id="6400" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">当然，如果你不想保留这个资源，我可以理解，所以让我们以破坏我们刚刚创建的东西来结束这篇文章。</p><h2 id="151c" class="no lz je bd ma np nq dn me nr ns dp mi ll nt nu mk lp nv nw mm lt nx ny mo jk bi translated">用Terraform摧毁你的AWS资源</h2><p id="311d" class="pw-post-body-paragraph lc ld je le b lf mq ko lh li mr kr lk ll ms ln lo lp mt lr ls lt mu lv lw lx im bi translated">正如你可能猜到的那样，用Terraform破坏资源和创造资源一样简单。我们不跑<code class="fe nj nk nl nm b">terraform apply</code>，而是跑<code class="fe nj nk nl nm b">terraform destroy</code>。同样，Terraform会提示您通过输入<code class="fe nj nk nl nm b">yes</code>确认销毁这些资源，然后Terraform会继续销毁我们刚刚创建的IAM角色。</p><figure class="nz oa ob oc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ov"><img src="../Images/60c008622a3c26fd18de12c8a79dc8ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kBaePkxIJcpjEHuDCRV7bw.jpeg"/></div></div><p class="on oo gj gh gi op oq bd b be z dk translated">作者截图</p></figure><p id="5800" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">噗！这些资源现在都没有了。</p><p id="fe7d" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">今天的帖子到此结束！我希望你不要太失望，我们今天实际上没有得到任何与SageMaker相关的东西，但我向你保证，这个基础帖子将为我们提供很好的服务，因为我们会在后续的帖子中继续。感谢你坚持读完这篇长文！下一集见。😃</p></div></div>    
</body>
</html>