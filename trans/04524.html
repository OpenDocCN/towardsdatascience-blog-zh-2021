<html>
<head>
<title>Introduction to Data Pipelines with Singer.io</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Singer.io数据管道简介</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introduction-to-data-pipelines-with-singer-io-ca57969d2cb1?source=collection_archive---------16-----------------------#2021-04-18">https://towardsdatascience.com/introduction-to-data-pipelines-with-singer-io-ca57969d2cb1?source=collection_archive---------16-----------------------#2021-04-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="da80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">数据管道在各种数据平台中扮演着至关重要的角色，无论是预测分析还是商业智能，或者仅仅是各种异构数据存储之间的ETL(提取—传输—加载)。它们都依赖于实时或批量接收数据，并进一步处理这些数据以获得见解和做出预测，或者只是总结和重塑数据以用于报告。让我们探索数据管道的解剖结构，以便更好地理解这个概念，然后我们将开始使用Python中称为<a class="ae kl" href="https://www.singer.io/" rel="noopener ugc nofollow" target="_blank"> Singer </a>的开源ETL工具创建数据管道。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/7348a08f81b0c5d70eeea6c1b68e1836.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yU5fDl44r5XrtWzy"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated"><a class="ae kl" href="https://unsplash.com/@sigmund?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">西格蒙德</a>在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><h1 id="8469" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">什么是数据管道？</h1><p id="90b4" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">就像水管将水从水源输送到目的地一样，我们也使用数据管道将数据从一个源系统输送到目的地系统。使用数据管道的几种情况:</p><p id="bd97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1)在异构数据存储之间同步数据。例如，将数据从Oracle数据库实例同步到PostgreSQL数据库实例。</p><p id="23c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2)在数据清理、整形、汇总等之后，将数据从暂存区移动到生产系统。例如，从各种网站收集的数据可以被收集在暂存区中，该暂存区然后以结构化的方式适合消费，然后被传送到数据库。</p><p id="e61f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3)从中央数据源将分段数据分布到各个子系统。例如:由一个组织在Google Sheets中收集的各种产品的调查数据可能会被划分并广播给相应的产品团队进行处理。</p><h1 id="47c7" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">数据管道的关键特征</h1><p id="664c" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated"><strong class="jp ir"> 1)数据频率:</strong>目标系统要求数据的速度，即定期小批量或实时。管道应该能够保持目标系统所需的数据传输频率。</p><p id="41d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 2)弹性:</strong>数据管道的容错性和弹性如何，即如果管道因突然的数据加载或被忽略的代码错误而崩溃，数据不应丢失。</p><p id="db62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3)可扩展性:</strong>如果数据负载增加，用于开发数据管道的工具和技术必须能够重新配置数据管道，以扩展到更多的硬件节点。</p><h1 id="291c" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">什么是<em class="mf">歌手</em>？</h1><p id="f44d" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated"><em class="mg">歌手</em>的核心目标是成为“编写移动数据脚本的开源标准”。它涉及使用标准化脚本进行数据提取和接收，可以根据需要与各种源/目标混合和匹配。</p><h2 id="d0f3" class="mh ld iq bd le mi mj dn li mk ml dp lm jy mm mn lq kc mo mp lu kg mq mr ly ms bi translated">歌手的核心特征</h2><p id="c3ae" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">1)Tap——从中提取数据的数据源称为Tap，Singer网站上有现成的Tap可供使用，也可以创建自定义Tap。</p><p id="44c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2)目标—从Tap获取数据的数据目标称为目标。与Taps一样，我们可以使用歌手网站上的现成目标，也可以创建自己的目标。</p><p id="d46e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3)数据交换格式——在singer中，JSON (JavaScript对象符号)格式被用作数据交换格式，使其与源/目标无关。</p><p id="bd35" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Taps和目标很容易与基于Unix的管道操作符结合在一起，而不需要任何守护程序或复杂的插件。</p><p id="b9f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5)它通过维护调用之间的状态来支持增量提取，即时间戳可以在调用之间存储在JSON文件中，以记录目标消耗数据的最后实例。</p><h2 id="df29" class="mh ld iq bd le mi mj dn li mk ml dp lm jy mm mn lq kc mo mp lu kg mq mr ly ms bi translated">Singer中数据管道的组件</h2><p id="0f82" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">我们可以根据我们的要求为歌手定制水龙头/水槽，或者只安装和使用歌手网站上已经有的<a class="ae kl" href="https://www.singer.io/#taps" rel="noopener ugc nofollow" target="_blank">水龙头/水槽。</a></p><h1 id="ab44" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">用Singer构建数据管道</h1><p id="f3e0" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">让我们创建一个数据管道，从REST API获取雇员记录，并使用Singer的tap和sink方法将它们插入PostgreSQL数据库表。</p><blockquote class="mt mu mv"><p id="b5e4" class="jn jo mg jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">先决条件:Python环境和PostgreSQL数据库实例。</p></blockquote><p id="dee8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于Singer.io需要设置tap和sink，我们将为两者创建单独的virtualenvs，以避免版本冲突，因为它们中的每一个都可能依赖于不同的库。这被认为是与Singer合作的最佳实践。</p><h2 id="568e" class="mh ld iq bd le mi mj dn li mk ml dp lm jy mm mn lq kc mo mp lu kg mq mr ly ms bi translated">设置Tap: Rest API</h2><p id="7767" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">在这个演示中，我们将创建自己的Tap来从REST API中获取雇员记录。</p><p id="88dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1)创建并激活虚拟</p><pre class="kn ko kp kq gt mz na nb nc aw nd bi"><span id="b298" class="mh ld iq na b gy ne nf l ng nh">python3 -m venv ~/.virtualenvs/Singer.io_rest_tap</span><span id="10a1" class="mh ld iq na b gy ni nf l ng nh">source ~/.virtualenvs/Singer.io_rest_tap/bin/activate</span></pre><p id="8019" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2)安装Singer python库</p><pre class="kn ko kp kq gt mz na nb nc aw nd bi"><span id="c6c7" class="mh ld iq na b gy ne nf l ng nh">pip install singer-python</span></pre><p id="043f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3)在您喜欢的编辑器中打开一个名为tap_emp_api.py的新文件，并添加以下代码</p><pre class="kn ko kp kq gt mz na nb nc aw nd bi"><span id="ee11" class="mh ld iq na b gy ne nf l ng nh">import singer</span><span id="f166" class="mh ld iq na b gy ni nf l ng nh">import urllib.request</span><span id="87ac" class="mh ld iq na b gy ni nf l ng nh">import json</span><span id="b55c" class="mh ld iq na b gy ni nf l ng nh">#Here is a dummy JSON Schema for the sample data passed by our REST API.</span><span id="e31d" class="mh ld iq na b gy ni nf l ng nh">schema = {‘properties’: {</span><span id="c03e" class="mh ld iq na b gy ni nf l ng nh">‘id’: {‘type’: ‘string’},</span><span id="7814" class="mh ld iq na b gy ni nf l ng nh">‘employee_name’: {‘type’: ‘string’},</span><span id="c4ce" class="mh ld iq na b gy ni nf l ng nh">‘employee_salary’: {‘type’: ‘string’},</span><span id="dd9f" class="mh ld iq na b gy ni nf l ng nh">‘employee_age’: {‘type’: ‘string’},</span><span id="f35c" class="mh ld iq na b gy ni nf l ng nh">‘profile_image’: {‘type’: ‘string’}}}</span><span id="5f39" class="mh ld iq na b gy ni nf l ng nh">#Here we make the HTTP request and parse the response</span><span id="861e" class="mh ld iq na b gy ni nf l ng nh">with urllib.request.urlopen(‘http://dummy.restapiexample.com/api/v1/employees') as response:</span><span id="2a11" class="mh ld iq na b gy ni nf l ng nh">emp_data = json.loads(response.read().decode(‘utf-8’))</span><span id="e823" class="mh ld iq na b gy ni nf l ng nh">#next we call singer.write_schema which writes the schema of the employees stream</span><span id="6ea3" class="mh ld iq na b gy ni nf l ng nh">singer.write_schema(‘employees’, schema, ‘id’)</span><span id="ddf3" class="mh ld iq na b gy ni nf l ng nh">#then we call singer.write_records to write the records to that stream</span><span id="eb5d" class="mh ld iq na b gy ni nf l ng nh">singer.write_records(‘employees’, records=emp_data[“data”])</span></pre><h2 id="8966" class="mh ld iq bd le mi mj dn li mk ml dp lm jy mm mn lq kc mo mp lu kg mq mr ly ms bi translated">设置目标:PostgreSQL</h2><p id="edaf" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">PostgreSQL的一个目标已经在Singer网站上可用，所以我们将设置一个virtualenv来安装它。</p><p id="a1bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1)创建并激活虚拟</p><pre class="kn ko kp kq gt mz na nb nc aw nd bi"><span id="2224" class="mh ld iq na b gy ne nf l ng nh">python3 -m venv ~/.virtualenvs/Singer.io_postgres_target</span><span id="8158" class="mh ld iq na b gy ni nf l ng nh">source ~/.virtualenvs/Singer.io_ postgres_target /bin/activate</span></pre><p id="cd15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2)安装Singer python库</p><pre class="kn ko kp kq gt mz na nb nc aw nd bi"><span id="5bba" class="mh ld iq na b gy ne nf l ng nh">pip install singer-target-postgres</span></pre><p id="4583" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3)接下来，我们需要在以下位置创建一个配置文件</p><blockquote class="mt mu mv"><p id="37f5" class="jn jo mg jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated"><em class="iq"> ~/。virtualenvs/singer . io _ postgres _ target/bin/target _ postgres _ config . JSON</em></p></blockquote><p id="033b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用postgres连接信息和目标postgres模式，如下所示:</p><pre class="kn ko kp kq gt mz na nb nc aw nd bi"><span id="b536" class="mh ld iq na b gy ne nf l ng nh">{</span><span id="7d05" class="mh ld iq na b gy ni nf l ng nh">“postgres_host”: “localhost”,</span><span id="b301" class="mh ld iq na b gy ni nf l ng nh">“postgres_port”: 5432,</span><span id="a6f7" class="mh ld iq na b gy ni nf l ng nh">“postgres_database”: “singer_demo”,</span><span id="fa31" class="mh ld iq na b gy ni nf l ng nh">“postgres_username”: “postgres”,</span><span id="ce3c" class="mh ld iq na b gy ni nf l ng nh">“postgres_password”: “postgres”,</span><span id="3350" class="mh ld iq na b gy ni nf l ng nh">“postgres_schema”: “public”</span><span id="3565" class="mh ld iq na b gy ni nf l ng nh">}</span></pre><h1 id="ba2f" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">使用Singer数据管道</h1><p id="2df2" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">一旦我们设置了龙头和目标，就可以通过简单地敲击由壳体中的管道操作者分开的龙头和目标来使用管道，即</p><pre class="kn ko kp kq gt mz na nb nc aw nd bi"><span id="9224" class="mh ld iq na b gy ne nf l ng nh">python ~/.virtualenvs/Singer.io_rest_tap/bin/tap_emp_api.py | ~/.virtualenvs/Singer.io_postgres_target/bin/target-postgres — config database_config.json</span></pre><p id="081d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就对了。根据我们为Tap创建的database_config文件和模式，从API获取的所有记录都将被插入到一个表中。很简单，不是吗？！</p><h2 id="c30d" class="mh ld iq bd le mi mj dn li mk ml dp lm jy mm mn lq kc mo mp lu kg mq mr ly ms bi translated">下一步是什么？</h2><p id="9794" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">浏览<a class="ae kl" href="https://www.singer.io" rel="noopener ugc nofollow" target="_blank"> Singer.io </a>文档，根据您的使用案例尝试各种点击/目标组合，或者创建您自己的点击和目标。</p><p id="a867" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还可以探索数据管道编排工具，如<a class="ae kl" href="https://airflow.apache.org/" rel="noopener ugc nofollow" target="_blank">气流</a>和<a class="ae kl" href="https://github.com/spotify/luigi" rel="noopener ugc nofollow" target="_blank"> Luigi </a>，它们也具有广泛的功能。</p><p id="5c7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我即将发布的帖子中，我会提供一些关于气流的有趣指南。直到那时..保持快乐的管道您的数据管道！</p></div></div>    
</body>
</html>