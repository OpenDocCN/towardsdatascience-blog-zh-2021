<html>
<head>
<title>SQL Challenge: Case Study</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL挑战:案例研究</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/sql-challenge-case-study-7bd75eb864ac?source=collection_archive---------1-----------------------#2021-10-30">https://towardsdatascience.com/sql-challenge-case-study-7bd75eb864ac?source=collection_archive---------1-----------------------#2021-10-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7779" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">顶级技术公司提出的SQL挑战的逐步演练</h2></div></div><div class="ab cl ki kj hx kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="im in io ip iq"><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/1d7f5941c887ca4af95c77b5873517d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BMnzXwkpB8V1Hy0b"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">艾米丽·莫特在<a class="ae lf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="cf41" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在<a class="ae lf" rel="noopener" target="_blank" href="/acing-the-sql-challenge-d8b8feb0a041">的上一篇文章</a>中，我谈到了如何使用框架来解决SQL挑战。今天我就来做一个<a class="ae lf" href="https://platform.stratascratch.com/coding/2029-the-most-popular-client_id-among-users-using-video-and-voice-calls?python=" rel="noopener ugc nofollow" target="_blank">这个挑战</a>的演练，2021年2月微软问的。在你继续阅读这篇文章之前，我强烈建议你尝试自己解决这个问题。你练习解决SQL问题越多，你就能越好地解决它们。好吧，让我们开始吧！</p><h1 id="d9ad" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">阅读提示</h1><p id="bfaf" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">这个问题要求我们:</p><blockquote class="mz na nb"><p id="a013" class="lg lh nc li b lj lk ju ll lm ln jx lo nd lq lr ls ne lu lv lw nf ly lz ma mb im bi translated">根据至少有50%的事件发生在以下列表中的用户数，选择最受欢迎的client_id:“收到视频通话”、“发送视频通话”、“收到语音通话”、“发送语音通话”。</p></blockquote><p id="ff97" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在我开始研究这个问题之前，我想想象一下数据集中的信息是如何出现的。让我们运行一个简单的SELECT语句来检查存储在表fact_events中的数据。</p><pre class="kq kr ks kt gt ng nh ni nj aw nk bi"><span id="b27b" class="nl md it nh b gy nm nn l no np">SELECT *<br/>FROM fact_events<br/>LIMIT 10</span></pre><p id="16fe" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">该查询返回以下输出:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nq"><img src="../Images/4caf708cb2a1c76d345c976e8b2d1bfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KeHd1O0OJwJ_UK-pnj18Wg.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">作者截图(<a class="ae lf" href="https://platform.stratascratch.com/coding-question/output-preview" rel="noopener ugc nofollow" target="_blank"> StrataScratch网站</a>)</p></figure><p id="7bdf" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">出于好奇，我想知道所提供的列表中的所有值是否都出现在数据集中:</p><pre class="kq kr ks kt gt ng nh ni nj aw nk bi"><span id="f4a7" class="nl md it nh b gy nm nn l no np">SELECT <br/>    event_type<br/>FROM fact_events<br/>WHERE event_type IN ('video call received',<br/>                    'video call sent', 'voice call received',<br/>                    'voice call sent')<br/>GROUP BY event_type</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/117d3e1c31560b5e00df213af16d50b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*cxudiOiZKY90-VIjSU-OwQ.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">作者图片</p></figure><p id="fd97" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">看起来只包括了4个值中的2个。尽管其他两个值没有出现在当前数据集中，但它们可能会在数据追加到表中时出现。你不能假设数据会保持不变。因此，让我们在过滤器中保留所有4个值。</p><p id="775f" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">太好了！我现在对我正在做的事情有了更好的了解。下一步是分析提示，以便我们可以提出一个策略来应对这一挑战。</p><h2 id="b74c" class="nl md it bd me ns nt dn mi nu nv dp mm lp nw nx mo lt ny nz mq lx oa ob ms oc bi translated">笔和纸</h2><p id="cc9b" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">对于这一步，我喜欢把我的想法写在一张纸上📝然而，请随意使用你的电脑、iPad或其他最适合你的设备。这里，我们需要分析提示，以准确理解要求我们做什么。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi od"><img src="../Images/c0f7ca9cff4d8adc864ce0af6eae0997.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kq4VuQ3LJDMPFm03-9Fw4g.png"/></div></div><p class="lb lc gj gh gi ld le bd b be z dk translated">作者图片</p></figure><p id="e9f0" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在这种情况下，提示似乎分为三个部分:</p><ol class=""><li id="7ad4" class="oe of it li b lj lk lm ln lp og lt oh lx oi mb oj ok ol om bi translated">从上面的列表中找到发生了50%事件的用户</li><li id="d7ff" class="oe of it li b lj on lm oo lp op lt oq lx or mb oj ok ol om bi translated">计算步骤(1)中找到的用户数量</li><li id="73ad" class="oe of it li b lj on lm oo lp op lt oq lx or mb oj ok ol om bi translated">根据步骤(2)选择用户数量最多的客户端id</li></ol><p id="8e31" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我还会做如下假设:</p><ul class=""><li id="dae7" class="oe of it li b lj lk lm ln lp og lt oh lx oi mb os ok ol om bi translated">我不需要使用customer_id和event_id列</li><li id="ff06" class="oe of it li b lj on lm oo lp op lt oq lx or mb os ok ol om bi translated">时机并不重要</li><li id="edec" class="oe of it li b lj on lm oo lp op lt oq lx or mb os ok ol om bi translated">我用给定列表中事件的数量除以所有事件的数量来计算50%。</li><li id="fc96" class="oe of it li b lj on lm oo lp op lt oq lx or mb os ok ol om bi translated">我在统计用户总数，即使他们在列中出现多次。提示没有指定通过识别用户在数据集中出现的<strong class="li iu">不同</strong>次数来选择最流行的client_id。</li></ul><p id="a243" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在面试的这一点上，你应该花时间去理解挑战，并向面试官传达最初的想法。此外，如果你有任何问题，请随时向面试官寻求澄清。没有面试官在场的情况下，让我们进入下一步吧！</p><h1 id="7594" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">第一步</h1><p id="0604" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">首先，让我们在下面的列表中获取具有50%或更多事件的用户:“收到视频呼叫”、“发送视频呼叫”、“收到语音呼叫”和“发送语音呼叫”为了得到百分比，我们将在一个CASE语句中使用<a class="ae lf" href="https://machinelearningmastery.com/why-one-hot-encode-data-in-machine-learning/" rel="noopener ugc nofollow" target="_blank">一键编码</a>，将列表中的值返回为1，其他值返回为0。CASE语句总和将是分子。分母是event_type列中所有元素的计数。</p><pre class="kq kr ks kt gt ng nh ni nj aw nk bi"><span id="73c2" class="nl md it nh b gy nm nn l no np">CAST(SUM(<br/>            CASE<br/>                WHEN event_type IN ('video call received',<br/>                    'video call sent', 'voice call received',<br/>                    'voice call sent')<br/>                    THEN 1<br/>                ELSE 0<br/>            END) AS FLOAT)  / COUNT(event_type)</span></pre><p id="5a93" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">接下来，我们将在GROUP BY/HAVING子句中包装条件。记住，我们需要用列表中至少50%的事件对user_id 进行过滤。为此，我们需要执行聚合，根据条件进行过滤，最后按user_id进行分组。</p><pre class="kq kr ks kt gt ng nh ni nj aw nk bi"><span id="b4d4" class="nl md it nh b gy nm nn l no np">SELECT  <br/>    user_id<br/>FROM fact_events<br/>GROUP BY user_id<br/>HAVING CAST(SUM(<br/>            CASE<br/>                WHEN event_type IN ('video call received',<br/>                    'video call sent', 'voice call received',<br/>                    'voice call sent')<br/>                    THEN 1<br/>                ELSE 0<br/>            END) AS FLOAT)  / COUNT(event_type) &gt;= 0.5</span></pre><p id="5d8f" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">完成第一步后，我们得到以下输出:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/374dbba1d9f9d89648b28ae624518c81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*zwYrjv-ytzF3VEW1wcIdfA.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">作者图片</p></figure><h1 id="5ebc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">第二步</h1><p id="fff1" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">现在我们知道只有2个用户拥有列表中至少50%的事件，让我们通过client_id和user_id找出用户的数量。</p><pre class="kq kr ks kt gt ng nh ni nj aw nk bi"><span id="d19e" class="nl md it nh b gy nm nn l no np">SELECT <br/>    client_id, <br/>    user_id, <br/>    COUNT(user_id)<br/>FROM fact_events<br/>WHERE user_id in <br/>        (SELECT  <br/>            user_id<br/>        FROM fact_events<br/>        GROUP BY user_id<br/>        HAVING CAST(SUM(<br/>            CASE<br/>                WHEN event_type IN ('video call received',<br/>                    'video call sent', 'voice call received',<br/>                    'voice call sent')<br/>                    THEN 1<br/>                ELSE 0<br/>            END) AS FLOAT)  / COUNT(event_type) &gt;= 0.5)<br/>GROUP BY <br/>    client_id, <br/>    user_id<br/>ORDER BY COUNT (user_id) DESC</span></pre><p id="9f80" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">输出已经指向了我们的答案。请注意，client_id“桌面”有7 + 4 = 11个用户，而“移动”只有3个。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/f4f535bb67bf31ffee7038d419991f2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*w9JFbIaJhLrdhSjGKvISyw.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">作者图片</p></figure><h1 id="567f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">第三步</h1><p id="3869" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">在最后一步，我们将清理上面的输出，只返回拥有最多用户的client_id。这里不需要对SQL脚本进行太多的修改。我没有按client_id和user_id分组，而是只按client_id分组。我还确保限制返回最多用户数的client_id的行数。如果不限制选择，在最终输出中还会返回“mobile”。</p><pre class="kq kr ks kt gt ng nh ni nj aw nk bi"><span id="4658" class="nl md it nh b gy nm nn l no np">--final query</span><span id="b636" class="nl md it nh b gy ov nn l no np">SELECT <br/>    client_id<br/>FROM fact_events<br/>WHERE user_id in <br/>        (SELECT  <br/>            user_id<br/>        FROM fact_events<br/>        GROUP BY user_id<br/>        HAVING CAST(SUM(<br/>            CASE<br/>                WHEN event_type IN ('video call received',<br/>                    'video call sent', 'voice call received',<br/>                    'voice call sent')<br/>                    THEN 1<br/>                ELSE 0<br/>            END) AS FLOAT)  / COUNT(event_type) &gt;= 0.5)<br/>GROUP BY <br/>    client_id<br/>ORDER BY COUNT(user_id) DESC<br/>LIMIT 1</span></pre><p id="b963" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">最终输出:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/c13d16b2d01d33d8785ee03ae28569a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*0ieDkXJUYNegfOGlMH5ADg.png"/></div><p class="lb lc gj gh gi ld le bd b be z dk translated">作者图片</p></figure><h1 id="b6c2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="cfac" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">我希望你喜欢这个演练！有大量的资源供你练习面试问题。一些最受欢迎的网站是Leetcode、StrataScratch和InterviewQuery，但我相信你可以找到许多其他网站，为你赢得DA面试做好准备。别忘了在下面的评论中分享反馈或提出问题！</p><p id="dbcd" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><em class="nc">本帖最后编辑于2021年10月30日。这里表达的观点仅属于我自己，并不代表我的雇主的观点。</em></p></div></div>    
</body>
</html>