<html>
<head>
<title>How to Build a Web App to Transcribe Audio Using Python and AssemblyAI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python和AssemblyAI构建一个转录音频的Web应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-build-a-web-app-to-transcribe-audio-using-python-and-assemblyai-18f197253fd8?source=collection_archive---------11-----------------------#2021-04-27">https://towardsdatascience.com/how-to-build-a-web-app-to-transcribe-audio-using-python-and-assemblyai-18f197253fd8?source=collection_archive---------11-----------------------#2021-04-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="76ab" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我们将使用Streamlit建立一个web应用程序，让用户上传他们的音频。AssemblyAI的API将用于转录这个音频。我们也将建立一些很酷的动画</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/27451b025a026b7b2d3ffa132594533d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*mi_B_xeZMR8gtTcR"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">Web应用程序的屏幕截图</p></figure><p id="ec67" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以在<a class="ae lq" href="https://share.streamlit.io/mesmith027/assemblyai_webapp/main/main.py" rel="noopener ugc nofollow" target="_blank">这里</a>找到部署的应用</p><p id="7656" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">转录是将音频转换为文本的过程。虽然你可以实现一个机器学习模型来从音频中获取文本，但这很麻烦。</p><ul class=""><li id="9d57" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">从音频信号中提取特征需要丰富的音频信号处理知识。</li><li id="66ca" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">必须从各种来源挖掘/搜集大量数据。</li><li id="6e32" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">需要具备PyTorch或TensorFlow等机器学习库的知识。</li></ul><p id="3f95" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">幸运的是，AssemblyAI有一个免费的版本，让我们通过几个请求就可以转录音频。</p><p id="e214" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，我们将构建一个web应用程序，它可以使用AssemblyAI和<a class="ae lq" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>转录音频，Streamlit是一个Python库，用于构建机器学习模型的ui。</p><p id="66c3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以在这里找到带有完整<a class="ae lq" href="https://github.com/rahulbanerjee26/AssemblyAI_WebApp" rel="noopener ugc nofollow" target="_blank">源代码的回购协议。</a></p><h1 id="0c0c" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">要求</h1><ul class=""><li id="7533" class="lr ls it kw b kx mx la my ld mz lh na ll nb lp lw lx ly lz bi translated">一个AssemblyAI账户(免费注册<a class="ae lq" href="https://app.assemblyai.com/login/" rel="noopener ugc nofollow" target="_blank">这里</a></li><li id="2800" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">一个AssemblyAI API密钥(你可以在这里找到它<a class="ae lq" href="https://app.assemblyai.com/dashboard/" rel="noopener ugc nofollow" target="_blank"/></li><li id="7232" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">Python 3.5+的基础知识(注意:本教程我将使用Python 3.9)</li><li id="5f12" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">虽然不是必需的，但是熟悉<a class="ae lq" href="https://docs.python-requests.org/en/master/" rel="noopener ugc nofollow" target="_blank">请求库</a>会有所帮助</li></ul><h1 id="c116" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">我们将使用的库</h1><h1 id="76ac" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">AssemblyAI</h1><p id="27a5" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated"><a class="ae lq" href="https://www.assemblyai.com/" rel="noopener ugc nofollow" target="_blank"> AssemblyAI </a>用于将音频转换为文本。它提供了一个REST API，可以在任何调用REST API的语言中使用，比如JavaScript、PHP、Python等。我们将使用Python向API发出请求。</p><h1 id="2d0c" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">细流</h1><p id="f057" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated"><a class="ae lq" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>是一个开源的应用框架，用于构建机器学习模型的UI，无需了解HTML、CSS或JavaScript。它有一个广泛的预建组件库，可以用来在几分钟内构建一个简单的UI。</p><h1 id="6d3a" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">要求</h1><p id="1c49" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">我们将使用<a class="ae lq" href="https://requests.readthedocs.io/" rel="noopener ugc nofollow" target="_blank">请求库</a>向AssemblyAI的REST API发出请求。</p><h1 id="0822" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">Python-dotenv</h1><p id="e3c3" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">我们将使用<a class="ae lq" href="https://pypi.org/project/python-dotenv/" rel="noopener ugc nofollow" target="_blank"> Python-dotenv </a>库来读取变量。环境文件。</p><h1 id="c827" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">设置项目目录</h1><p id="1a89" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">使用命令行创建新的文件夹/目录</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="26d6" class="nk mg it ng b gy nl nm l nn no">mkdir ASSEMBLYAI</span></pre><p id="e3b5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了保持秘密凭证的秘密性，将凭证存储在. env文件中是一个很好的做法。然后，我们可以使用<a class="ae lq" href="https://pypi.org/project/python-dotenv/" rel="noopener ugc nofollow" target="_blank"> Python-dotenv </a>库从。环境文件。如果愿意，我们也可以将它们存储在环境变量中。</p><p id="c307" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在您创建的新目录ASSEMBLYAI中，创建两个新的Python文件和一个. env文件</p><p id="bcd3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="np">如果使用Windows: </em></p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="a9b1" class="nk mg it ng b gy nl nm l nn no">New-Item main.py, transcribe.py, .env</span></pre><p id="f651" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="np">如果使用macOS或Linux: </em></p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="f04f" class="nk mg it ng b gy nl nm l nn no">touch touch main.py &amp;&amp; transcribe.py &amp;&amp; touch .env</span></pre><p id="5bc8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">文件main.py将包含与Streamlit UI相关的所有代码，而文件transcribe.py将包含帮助器函数和与AssemblyAI的API交互的代码。</p><p id="191f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以从<a class="ae lq" href="https://s3-us-west-2.amazonaws.com/blog.assemblyai.com/audio/8-7-2018-post/7510.mp3" rel="noopener ugc nofollow" target="_blank">这里</a>下载一个样本MP3文件。将文件命名为“testData ”,并将其保存在ASSEMBLYAI目录中。</p><h1 id="efa2" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">设置项目环境</h1><p id="ade8" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">确保你在ASSEMBLYAI目录下，如果你不只是使用cd命令来改变目录。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="c5c9" class="nk mg it ng b gy nl nm l nn no">cd ASSEMBLYAI</span></pre><h1 id="db7a" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">如果这是你第一次使用虚拟环境，你必须安装<a class="ae lq" href="https://pypi.org/project/virtualenv/" rel="noopener ugc nofollow" target="_blank"> virtualenv </a></h1><p id="b67b" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated"><em class="np">如果使用Windows: </em></p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="c959" class="nk mg it ng b gy nl nm l nn no">python -m pip install — user virtualenv</span></pre><p id="03d0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="np">如果使用macOS或Linux: </em></p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="84b3" class="nk mg it ng b gy nl nm l nn no">python3 -m pip install — user virtualenv</span></pre><h1 id="52ee" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">首先，我们需要通过在命令行上输入以下代码来创建一个虚拟环境:</h1><p id="c30c" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated"><em class="np">如果使用Windows: </em></p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="91fb" class="nk mg it ng b gy nl nm l nn no">python -m venv venv</span></pre><p id="8d5e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="np">如果使用macOS或Linux: </em></p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="a22b" class="nk mg it ng b gy nl nm l nn no">Python3 -m venv venv</span></pre><p id="f4d5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，我们需要在命令行中使用以下命令来激活本地虚拟环境:</p><p id="8408" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="np">如果使用Windows: </em></p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="81e5" class="nk mg it ng b gy nl nm l nn no">venv/Scripts/activate</span></pre><p id="38bd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="np">如果使用macOS或Linux: </em></p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="2fa6" class="nk mg it ng b gy nl nm l nn no">source venv/bin/activate</span></pre><p id="c59a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有关如何设置虚拟环境的更多详细信息，请参考<a class="ae lq" href="https://packaging.python.org/guides/installing-using-pip-and-virtual-environments/" rel="noopener ugc nofollow" target="_blank">本网站</a>。</p><p id="99b2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要分别安装Requests、Steamlit和Python-dotenv库，我们可以在命令行上输入这一行:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="2d44" class="nk mg it ng b gy nl nm l nn no">pip install streamlit, requests, python-dotenv</span></pre><p id="3a49" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将安装所需的最新库。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/108c784d8ad6433ac1f47865a6d1c87b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/0*-9UBiB72T-fxoJ_p"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="a44b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是你的文件结构应该看起来的样子。</p><h1 id="2e48" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">将API密钥添加到。环境文件</h1><ul class=""><li id="a3b5" class="lr ls it kw b kx mx la my ld mz lh na ll nb lp lw lx ly lz bi translated">打开。您在“设置项目环境”一节中创建的env文件。</li><li id="74bd" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">添加以下内容:</li></ul><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="c9b5" class="nk mg it ng b gy nl nm l nn no">API_TOKEN = “Your API Key”</span></pre><ul class=""><li id="048e" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">将字符串“Your API Key”替换为<a class="ae lq" href="https://app.assemblyai.com/dashboard/" rel="noopener ugc nofollow" target="_blank"> Assembly AI </a>给你的API Key。</li></ul><h1 id="174a" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">如何克隆回购并运行它</h1><ul class=""><li id="0ef7" class="lr ls it kw b kx mx la my ld mz lh na ll nb lp lw lx ly lz bi translated">去<a class="ae lq" href="https://github.com/rahulbanerjee26/AssemblyAI_WebApp" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>下载。</li><li id="6415" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">启动命令行，将目录更改为下载的文件夹。</li><li id="99e6" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">按照上一节设置虚拟环境。</li><li id="abea" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">激活虚拟环境。</li><li id="9691" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">在下载的文件夹中创建一个. env文件，并添加API密钥。(参考上一节。)</li><li id="813a" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">要安装所需的库，您可以手动键入名称并安装它们，或者使用提供的requirements.txt文件。</li></ul><p id="116e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="np">如果使用Windows: </em></p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="ea6f" class="nk mg it ng b gy nl nm l nn no">pip install streamlit, requests, python-dotenv</span></pre><p id="e6eb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="np">如果使用macOS或Linux: </em></p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="1865" class="nk mg it ng b gy nl nm l nn no">pip install streamlit requests python-dotenv</span></pre><p id="6da4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">或者</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="a54e" class="nk mg it ng b gy nl nm l nn no">pip install -r requirements.txt</span></pre><ul class=""><li id="e91e" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">一旦成功安装了所有要求，请键入以下命令</li></ul><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="d6e4" class="nk mg it ng b gy nl nm l nn no">streamlit run main.py</span></pre><p id="c7e9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这应该会运行webapp。您可以尝试上传文件。</p><h1 id="c2a8" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">转录mp3文件</h1><p id="967d" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">在构建UI之前，我们需要几个助手函数，我们可以用它们将文件上传到AssemblyAI的服务器，供模型处理并返回转录的文本。</p><p id="67d8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">助手函数的代码应该写在<strong class="kw iu">transcripte . py</strong>文件中</p><h1 id="655b" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">导入所需的模块</h1><p id="9fbc" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">这段代码应该出现在<strong class="kw iu">转录. py </strong>文件的开头</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="f1ed" class="nk mg it ng b gy nl nm l nn no">import os<br/>from dotenv import load_dotenv<br/>import requests</span></pre><h1 id="0923" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">助手功能1:将本地音频文件上传到AssemblyAI</h1><p id="b523" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">我们需要编写的第一个函数是上传存储在本地机器上的音频文件的方法。这个函数应该存在于<strong class="kw iu">转录. py </strong>文件中</p><p id="d9e6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">AssemblyAI模型期望文件可以通过URL访问。因此，我们需要将音频文件上传到blob存储，以便通过URL访问。幸运的是，AssemblyAI提供了一种快速简单的方法来实现这一点。</p><p id="5228" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们需要向以下AssemblyAI API端点发出POST请求:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="e69f" class="nk mg it ng b gy nl nm l nn no"><a class="ae lq" href="https://api.assemblyai.com/v2/upload" rel="noopener ugc nofollow" target="_blank">https://api.assemblyai.com/v2/upload</a></span></pre><p id="3896" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该响应将包含一个指向该文件的临时URL，我们可以将该URL传递回AssemblyAI ' transcript` API端点。该URL是仅可由AssemblyAI服务器访问的私有URL。</p><p id="0baa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所有上传的内容转录后会立即删除，永远不会保存。</p><p id="32f1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将使用之前安装的Python请求库来发出POST请求</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="a751" class="nk mg it ng b gy nl nm l nn no">def get_url(token,data):<br/> ‘’’<br/> Parameter:<br/> token: The API key<br/> data : The File Object to upload<br/> Return Value:<br/> url : Url to uploaded file<br/> ‘’’<br/> headers = {‘authorization’: token}<br/> response = requests.post(‘https://api.assemblyai.com/v2/upload',<br/> headers=headers,<br/> data=data)<br/> url = response.json()[“upload_url”]<br/> print(“Uploaded File and got temporary URL to file”)<br/> return url</span></pre><ul class=""><li id="4624" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">该函数接受两个参数:API令牌和要上传的文件对象</li><li id="e87b" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">我们向上述AssemblyAI Upload API端点发出POST请求，并将API令牌和文件对象作为请求体的一部分。</li><li id="f2f8" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">响应对象包含上传文件的URL。该URL由函数返回。</li></ul><h1 id="528d" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">助手功能2:上传文件进行转录</h1><p id="41ce" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">现在我们有了一个函数来获取音频文件的URL，我们将使用这个URL并向端点发出请求，端点将实际转录文件。这个函数也应该存在于transcribe.py文件中</p><p id="2a07" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最初，当我们请求转录时，音频文件具有“排队”状态。我们将在最后一个帮助函数中更多地讨论文件是如何从“排队”到“完成”的。现在，我们只需要向转录端点以及文件的URL发出请求。我们需要向以下AssemblyAI API端点发出请求:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="7808" class="nk mg it ng b gy nl nm l nn no"><a class="ae lq" href="https://api.assemblyai.com/v2/transcript" rel="noopener ugc nofollow" target="_blank">https://api.assemblyai.com/v2/transcript</a></span></pre><p id="2114" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个函数与前面的函数非常相似。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="bf0e" class="nk mg it ng b gy nl nm l nn no">def get_transcribe_id(token,url):<br/> ‘’’<br/> Parameter:<br/> token: The API key<br/> url : Url to uploaded file<br/> Return Value:<br/> id : The transcribe id of the file<br/> ‘’’<br/> endpoint = “https://api.assemblyai.com/v2/transcript"<br/> json = {<br/> “audio_url”: url<br/> }<br/> headers = {<br/> “authorization”: token,<br/> “content-type”: “application/json”<br/> }<br/> response = requests.post(endpoint, json=json, headers=headers)<br/> id = response.json()[‘id’]<br/> print(“Made request and file is currently queued”)<br/> return id</span></pre><ul class=""><li id="db6b" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">该函数接受两个参数:API令牌和来自前面函数的音频文件URL。</li><li id="4d0f" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">我们向AssemblyAI“抄本”API端点发出POST请求..如果音频文件当前未在处理中，则新文件会立即被处理。如果有正在进行的转录，则新的音频文件将排队，直到前一个作业完成。</li></ul><p id="d2bd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您希望能够同时运行多个作业，您将需要<a class="ae lq" href="https://www.assemblyai.com/pricing" rel="noopener ugc nofollow" target="_blank">升级到高级计划</a></p><ul class=""><li id="e01e" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">响应对象将包含转录的ID。这个ID和一个单独的端点将用于获取转录的状态。</li><li id="7740" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">该函数将返回这个ID</li></ul><h1 id="a8cf" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">助手功能3:下载音频转录</h1><p id="7f9b" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">一旦我们有了音频文件的转录ID，我们就可以向以下AssemblyAI API端点发出GET请求，以检查转录的状态:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="560a" class="nk mg it ng b gy nl nm l nn no"><a class="ae lq" href="https://api.assemblyai.com/v2/transcript/{transcribe_id}" rel="noopener ugc nofollow" target="_blank">https://api.assemblyai.com/v2/transcript/{transcribe_id}</a></span></pre><p id="2363" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">只要没有遇到错误，转录的状态就从“排队”变为“处理中”再变为“完成”。</p><p id="d067" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将需要轮询这个端点，直到我们得到一个状态为“completed”的响应对象。</p><p id="79ca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以利用一个<a class="ae lq" href="https://www.w3schools.com/python/python_while_loops.asp" rel="noopener ugc nofollow" target="_blank"> <em class="np"> while循环</em> </a>不断向端点发出请求。在循环的每次迭代中，我们将检查转录的状态。循环将继续运行，直到状态为“完成”。发出请求并等待状态完成的过程称为轮询。我们将在“构建Streamlit UI”一节中实现这个轮询特性。</p><p id="8be8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面的函数将简单地获取处方的当前状态。这个函数应该存在于<strong class="kw iu">转录. py </strong>文件中</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="722c" class="nk mg it ng b gy nl nm l nn no">def get_text(token,transcribe_id):<br/> ‘’’<br/> Parameter:<br/> token: The API key<br/> transcribe_id: The ID of the file which is being<br/> Return Value:<br/> result : The response object<br/> ‘’’ <br/>endpoint= f”https://api.assemblyai.com/v2/transcript/{transcribe_id}"<br/>headers = {<br/> “authorization”: token<br/> }<br/> result = requests.get(endpoint, headers=headers).json()<br/> return result</span></pre><h1 id="3426" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">助手功能4:从UI请求转录</h1><p id="f5a0" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">我们的第三个函数将连续调用前面的两个函数。</p><p id="e3b6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该功能也将连接到我们的Streamlit UI中的“上传”按钮。该函数只有一个参数:file对象。该函数将执行以下操作</p><ul class=""><li id="aca5" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">它将从我们的。环境文件。</li><li id="e16c" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">它将使用令牌来调用先前定义的函数</li><li id="2566" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">它将返回转录ID</li></ul><p id="9aba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是该函数的代码片段。这个函数应该存在于<strong class="kw iu">transcripte . py</strong>文件中:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="c87c" class="nk mg it ng b gy nl nm l nn no">def upload_file(fileObj):<br/> ‘’’<br/> Parameter:<br/> fileObj: The File Object to transcribe<br/> Return Value:<br/> token : The API key<br/> transcribe_id: The ID of the file which is being transcribed<br/> ‘’’<br/> load_dotenv()<br/> token = os.getenv(“API_TOKEN”)<br/> file_url = get_url(token,fileObj)<br/> transcribe_id = get_transcribe_id(token,file_url)<br/> return token,transcribe_id</span></pre><ul class=""><li id="8193" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">我们将使用<strong class="kw iu"> load_dotenv() </strong>函数来加载我们的。环境文件。然后我们将使用操作系统库中的<strong class="kw iu"> get() </strong>函数，从。环境文件。</li><li id="75f0" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">调用<strong class="kw iu"> get_url() </strong>函数，将文件对象和令牌作为参数。</li><li id="3836" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">用<strong class="kw iu"> get_url() </strong>函数返回的令牌和<strong class="kw iu"> file_url </strong>调用<strong class="kw iu">get _ transcripte _ id()</strong>函数。</li><li id="70b4" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">返回令牌和转录ID。</li></ul><h1 id="2477" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">构建Streamlit UI</h1><p id="0b6f" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">现在我们已经有了所有需要的助手函数，我们可以开始在Streamlit UI上工作了。</p><p id="ac34" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然而，在进入Streamlit UI的实际代码之前，让我们看一下我们将使用的Streamlit组件。</p><ul class=""><li id="ef0a" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated"><strong class="kw iu"> header(string)、subheader(string)、text(string) </strong> —这些组件在我们的UI上显示各种大小的文本。<strong class="kw iu"> header() </strong>可以认为是&lt; h1 &gt;标签，<strong class="kw iu"> subheader() </strong>是&lt; h2 &gt;而<strong class="kw iu"> text() </strong>是&lt; p &gt;</li><li id="f958" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated"><strong class="kw iu"> file_uploader(label) </strong> —创建一个上传文件的按钮。参数标签是显示在按钮上方的字符串。它返回一个文件对象。我们将使用它来接受来自用户的文件</li><li id="b77d" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated"><strong class="kw iu">进度(整数)</strong> —创建一个进度条。整数必须介于0和100之间。它表示指定任务完成的百分比。如果我们创建一个每次迭代睡眠时间为0.1 s b/w的for循环，我们就可以创建一个很酷的进度条动画。</li><li id="05ca" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated"><strong class="kw iu"> spinner(label) </strong> —只要我们在标签的代码块中，标签就会显示。</li><li id="d394" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">气球() —这是展示气球的，是啊，真酷🎈</li></ul><h1 id="564b" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">构建用户界面的组件</h1><p id="6cfa" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">下面的代码应该写在<strong class="kw iu"> main.py </strong>文件中。main.py文件将是我们的web应用程序的入口点。</p><p id="e8cc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，我们需要导入所有需要的模块和库</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="e985" class="nk mg it ng b gy nl nm l nn no">import streamlit as st<br/>from transcribe import *<br/>import time</span></pre><p id="da5a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">转录</strong>是<strong class="kw iu">的名字</strong>这个文件带有我们的帮助函数。</p><p id="6f8c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了确保您当前已经导入了库，您可以尝试在命令行中运行以下命令。在运行该命令之前，确保您的虚拟环境已激活，并且您当前位于根文件夹(ASSEMBLYAI)中:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="de2d" class="nk mg it ng b gy nl nm l nn no">streamlit run main.py</span></pre><p id="6102" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您应该会看到一个空白的web应用程序。要重新运行应用程序，您可以单击汉堡菜单，然后单击重新运行，或者您可以打开web应用程序，然后按“Ctrl + R”或“Cmnd + R”</p><p id="b594" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们首先创建一个标题和上传按钮。</p><p id="4a83" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<strong class="kw iu"> main.py </strong>文件中输入以下代码:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="4002" class="nk mg it ng b gy nl nm l nn no">st.header(“Transcribe Audio”)<br/>fileObject = st.file_uploader(label = “Please upload your file” )</span></pre><p id="e2d6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">重新运行应用程序后，您应该会看到以下内容</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ns nt di nu bf nv"><div class="gh gi nr"><img src="../Images/1b3d32a2247c9e5b7326ab435fdbed89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*v_EOqCBaiITZXqg_"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="2769" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最初，变量是“None”，一旦文件被上传，变量的值就是文件对象。</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="5c5e" class="nk mg it ng b gy nl nm l nn no">if fileObject:<br/> token, t_id = upload_file(fileObject)<br/> result = {}<br/> #polling<br/> sleep_duration = 1<br/> percent_complete = 0<br/> progress_bar = st.progress(percent_complete)<br/> st.text(“Currently in queue”)<br/> while result.get(“status”) != “processing”:<br/> percent_complete += sleep_duration<br/> time.sleep(sleep_duration)<br/> progress_bar.progress(percent_complete/10)<br/> result = get_text(token,t_id)<br/>sleep_duration = 0.01<br/>for percent in range(percent_complete,101):<br/> time.sleep(sleep_duration)<br/> progress_bar.progress(percent)</span></pre><ul class=""><li id="986e" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">本质上，如果变量<strong class="kw iu"> fileObject </strong>不为“None”，我们调用<strong class="kw iu"> upload_file </strong>函数。</li><li id="33a9" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">我们使用while循环来轮询端点。</li><li id="ef74" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">创建一个进度条，在while循环的每一次迭代中，程序会休眠一秒钟，并将进度条的百分比递增1</li><li id="0ecc" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">一旦状态变为“处理中”，睡眠时间将减少到0.01秒。这导致了一个非常酷的动画，开始时，进度条进展缓慢，一旦文件被处理，它的进展真的很快</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ns nt di nu bf nv"><div class="gh gi nw"><img src="../Images/a939730c394f726ca95d515442e24726.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YrXTHfRhBz9oCp9R"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者GIF</p></figure><ul class=""><li id="d9f6" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">进度条显示为100%时，我们再次轮询端点。这一次检查状态是否为“已完成”。我们使用<strong class="kw iu"> spinner() </strong>函数在投票时在屏幕上显示文本:</li></ul><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="24e5" class="nk mg it ng b gy nl nm l nn no">st.balloons()<br/>st.header(“Transcribed Text”)<br/>st.subheader(result[‘text’])</span></pre><ul class=""><li id="5b82" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">一旦状态为“完成”，我们退出while，并使用<strong class="kw iu"> balloons() </strong>函数在屏幕上循环显示气球。</li><li id="21c8" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">最后，我们在屏幕上显示转录的文本。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/469f62d24a6ad6df131049cd9f6dfac5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*TPv6E7Yg3y_VSihw"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><h1 id="0c62" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">结论</h1><p id="50e3" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">恭喜你！👏您已经成功构建了一个可以转录音频的web应用程序。您可以在web应用程序的基础上构建一些附加功能</p><ul class=""><li id="fc80" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">AssemblyAI允许用户指定<a class="ae lq" href="https://docs.assemblyai.com/guides/transcribing-with-a-different-acoustic-or-custom-language-model" rel="noopener ugc nofollow" target="_blank">声学模型和/或语言模型</a>。您可以使用Streamli的选择框构建一个类似<a class="ae lq" href="https://docs.streamlit.io/en/latest/api.html#control-flow" rel="noopener ugc nofollow" target="_blank">的下拉</a>功能。</li><li id="5046" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">添加一个功能，让用户记录他们的声音，并转录它。这可能有点复杂，因为Streamlit没有任何内置组件来录制语音。但是，您可以使用HTML和JavaScript来构建这样一个特性。查看<a class="ae lq" href="https://discuss.streamlit.io/t/speech-to-text-on-client-side-using-html5-and-streamlit-bokeh-events/7888" rel="noopener ugc nofollow" target="_blank">这个答案</a>供参考。</li></ul></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><blockquote class="oe of og"><p id="9129" class="ku kv np kw b kx ky ju kz la lb jx lc oh le lf lg oi li lj lk oj lm ln lo lp im bi translated">在<a class="ae lq" href="https://www.linkedin.com/in/rahulbanerjee2699/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>、<a class="ae lq" href="https://twitter.com/rahulbanerjee99" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上与我联系</p><p id="572b" class="ku kv np kw b kx ky ju kz la lb jx lc oh le lf lg oi li lj lk oj lm ln lo lp im bi translated">我最近开始了一个修改版的#100daysofcode挑战。我的目标是写与Python、数据科学或编程相关的内容。关注我在<a class="ae lq" href="https://medium.com/daily-programming-tips" rel="noopener">媒体</a>上的进度</p></blockquote></div></div>    
</body>
</html>