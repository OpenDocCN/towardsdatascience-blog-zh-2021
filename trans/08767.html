<html>
<head>
<title>Create organization diagrams in a few lines of code (The 5-minute learn)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用几行代码创建组织图(5分钟学习)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/create-organization-diagrams-in-a-few-lines-of-code-the-5-minute-learn-dcca81dac3a2?source=collection_archive---------8-----------------------#2021-08-13">https://towardsdatascience.com/create-organization-diagrams-in-a-few-lines-of-code-the-5-minute-learn-dcca81dac3a2?source=collection_archive---------8-----------------------#2021-08-13</a></blockquote><div><div class="fc ij ik il im in"/><div class="io ip iq ir is"><div class=""/><div class=""><h2 id="99c3" class="pw-subtitle-paragraph js iu iv bd b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj dk translated">如何用R和Python来实现</h2></div><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/64dae312e8206582ac2dba336266a612.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TA6xUfvOg19WYlwtA5qi_w.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">作者生成</p></figure><p id="37aa" class="pw-post-body-paragraph la lb iv lc b ld le jw lf lg lh jz li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">组织结构图非常受欢迎，但创建起来确实令人头疼。创建它们的手动软件既烦人又费时。如果我们只用几行代码就能把它们组装起来，那不是很好吗？</p><p id="d207" class="pw-post-body-paragraph la lb iv lc b ld le jw lf lg lh jz li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">好消息是，只要有正确的数据，你就可以做到，因为组织图是一种特殊类型的图表，称为树或树状图。树是一个图，其中任意两个顶点之间只有一条路径。因为我们拥有使用数据科学语言处理和可视化图表的工具，所以我们可以使用这些工具来创建组织图。在本文中，我将向您展示如何操作，首先使用R，然后使用Python。r有更好的viz选项，但是你也可以用Python生成一个基本的组织结构图。</p><p id="3aae" class="pw-post-body-paragraph la lb iv lc b ld le jw lf lg lh jz li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">为了举例说明，我们将使用<em class="lw"> Chinook </em>开源数据库，您可以在这里下载<a class="ae lx" href="https://www.sqlitetutorial.net/wp-content/uploads/2018/03/chinook.zip" rel="noopener ugc nofollow" target="_blank">。下载后解压找到一个叫<code class="fe ly lz ma mb b">chinook.db</code>的文件。这是一个示例数据库，与您在任何组织中找到的数据库没有什么不同，但显然为了演示的目的，它更小更简单。</a></p><h2 id="58a7" class="mc md iv bd me mf mg dn mh mi mj dp mk lj ml mm mn ln mo mp mq lr mr ms mt mu bi translated">R里怎么做</h2><p id="e7ab" class="pw-post-body-paragraph la lb iv lc b ld mv jw lf lg mw jz li lj mx ll lm ln my lp lq lr mz lt lu lv io bi translated">在R中，在我们做了一些数据操作之后，我们将通过从数据中创建一个<code class="fe ly lz ma mb b">igraph</code>对象，然后使用令人敬畏的<code class="fe ly lz ma mb b">ggraph</code>包来可视化它。</p><p id="c344" class="pw-post-body-paragraph la lb iv lc b ld le jw lf lg lh jz li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">首先让我们使用<code class="fe ly lz ma mb b">RSQLite</code>包连接到我们的数据库，并查看表格:</p><pre class="kl km kn ko gt na mb nb nc aw nd bi"><span id="48f8" class="mc md iv mb b gy ne nf l ng nh">library(RSQLite)</span><span id="4a68" class="mc md iv mb b gy ni nf l ng nh">con &lt;- dbConnect(<br/>  drv = RSQLite::SQLite(),<br/>  "chinook.db"<br/>)</span><span id="e90f" class="mc md iv mb b gy ni nf l ng nh">RSQLite::dbListTables(con)</span><span id="e205" class="mc md iv mb b gy ni nf l ng nh">## [1] "albums"          "artists"         "customers"       "employees"       "genres"          "invoice_items"  <br/> ## [7] "invoices"        "media_types"     "playlist_track"  "playlists"       "sqlite_sequence" "sqlite_stat1"   <br/>## [13] "tracks"</span></pre><p id="1957" class="pw-post-body-paragraph la lb iv lc b ld le jw lf lg lh jz li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">让我们下载并快速浏览一下<code class="fe ly lz ma mb b">employees</code>表的字段名:</p><pre class="kl km kn ko gt na mb nb nc aw nd bi"><span id="51de" class="mc md iv mb b gy ne nf l ng nh">employees &lt;- dbGetQuery(con, "SELECT * FROM employees")<br/>colnames(employees)</span><span id="c4cd" class="mc md iv mb b gy ni nf l ng nh">## [1] "EmployeeId" "LastName"   "FirstName"  "Title"      "ReportsTo"  "BirthDate"  "HireDate"   "Address"    "City"      <br/>## [10] "State"      "Country"    "PostalCode" "Phone"      "Fax"        "Email"</span></pre><p id="97bf" class="pw-post-body-paragraph la lb iv lc b ld le jw lf lg lh jz li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">您能看到我们如何使用<code class="fe ly lz ma mb b">ReportsTo</code>列来形成组织图的基础吗？事实上，我们从这个数据库中需要做的就是<code class="fe ly lz ma mb b">EmployeeId</code>和<code class="fe ly lz ma mb b">ReportsTo</code>字段，但是我们也将使用<code class="fe ly lz ma mb b">FirstName</code>使它更友好(假设它们都是唯一的)。</p><pre class="kl km kn ko gt na mb nb nc aw nd bi"><span id="9c08" class="mc md iv mb b gy ne nf l ng nh">library(dplyr)<br/>(emps &lt;- employees |&gt; <br/>  dplyr::select(EmployeeId, FirstName, ReportsTo))</span><span id="4870" class="mc md iv mb b gy ni nf l ng nh">##   EmployeeId FirstName ReportsTo<br/>## 1          1    Andrew        NA<br/>## 2          2     Nancy         1<br/>## 3          3      Jane         2<br/>## 4          4  Margaret         2<br/>## 5          5     Steve         2<br/>## 6          6   Michael         1<br/>## 7          7    Robert         6<br/>## 8          8     Laura         6 </span></pre><p id="4f20" class="pw-post-body-paragraph la lb iv lc b ld le jw lf lg lh jz li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">现在，我们可以使用<code class="fe ly lz ma mb b">EmployeeId</code>和<code class="fe ly lz ma mb b">ReportsTo</code>对表本身进行连接，以创建一个在图表中使用的报告关系边列表:</p><pre class="kl km kn ko gt na mb nb nc aw nd bi"><span id="9571" class="mc md iv mb b gy ne nf l ng nh">(edgelist &lt;- emps |&gt; <br/>  dplyr::inner_join(<br/>    emps, <br/>    by = c("EmployeeId" = "ReportsTo")<br/>  ) |&gt; <br/>  dplyr::select(from = FirstName.x, to = FirstName.y))</span><span id="162a" class="mc md iv mb b gy ni nf l ng nh">##      from       to<br/>## 1  Andrew    Nancy<br/>## 2  Andrew  Michael<br/>## 3   Nancy     Jane<br/>## 4   Nancy Margaret<br/>## 5   Nancy    Steve<br/>## 6 Michael   Robert<br/>## 7 Michael    Laura</span></pre><p id="207f" class="pw-post-body-paragraph la lb iv lc b ld le jw lf lg lh jz li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">现在我们已经拥有了在<code class="fe ly lz ma mb b">igraph</code>中创建图形对象所需的一切:</p><pre class="kl km kn ko gt na mb nb nc aw nd bi"><span id="7240" class="mc md iv mb b gy ne nf l ng nh">library(igraph)<br/>(orgchart &lt;- igraph::graph_from_data_frame(<br/>  edgelist<br/>))</span><span id="d4bf" class="mc md iv mb b gy ni nf l ng nh">## IGRAPH e155618 DN-- 8 7 -- <br/>## + attr: name (v/c)<br/>## + edges from e155618 (vertex names):<br/>## [1] Andrew -&gt;Nancy    Andrew -&gt;Michael  Nancy  -&gt;Jane     Nancy  ## -&gt;Margaret Nancy  -&gt;Steve    Michael-&gt;Robert  <br/>## [7] Michael-&gt;Laura</span></pre><p id="6a93" class="pw-post-body-paragraph la lb iv lc b ld le jw lf lg lh jz li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">不错！最后一步是想象它。您可以使用树状图布局、肘形边和节点标签用<code class="fe ly lz ma mb b">ggraph</code>创建一个漂亮的可视化:</p><pre class="kl km kn ko gt na mb nb nc aw nd bi"><span id="f585" class="mc md iv mb b gy ne nf l ng nh">library(ggraph)<br/>ggraph(orgchart, layout = "dendrogram") +<br/>  geom_edge_elbow() +<br/>  geom_node_label(aes(label = name), fill = "lightblue") +<br/>  theme_void()</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi nj"><img src="../Images/524ab445fd84ed75be7f17a529bbdca4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PUM3smHvdc_mTrojZDsyTA.png"/></div></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">作者生成的图像</p></figure><h2 id="5825" class="mc md iv bd me mf mg dn mh mi mj dp mk lj ml mm mn ln mo mp mq lr mr ms mt mu bi translated">用Python怎么做</h2><p id="2a6c" class="pw-post-body-paragraph la lb iv lc b ld mv jw lf lg mw jz li lj mx ll lm ln my lp lq lr mz lt lu lv io bi translated">要连接到<code class="fe ly lz ma mb b">chinook</code>并获取员工详细信息:</p><pre class="kl km kn ko gt na mb nb nc aw nd bi"><span id="d5fc" class="mc md iv mb b gy ne nf l ng nh">import sqlite3, pandas as pd<br/>con=sqlite3.connect('chinook.db')</span><span id="d87d" class="mc md iv mb b gy ni nf l ng nh">qry="""<br/>SELECT EmployeeId, FirstName, ReportsTo<br/>FROM employees<br/>"""</span><span id="ab58" class="mc md iv mb b gy ni nf l ng nh">emps=pd.read_sql(qry, con)</span><span id="6b8e" class="mc md iv mb b gy ni nf l ng nh">##    EmployeeId FirstName  ReportsTo<br/>## 0           1    Andrew        NaN<br/>## 1           2     Nancy        1.0<br/>## 2           3      Jane        2.0<br/>## 3           4  Margaret        2.0<br/>## 4           5     Steve        2.0<br/>## 5           6   Michael        1.0<br/>## 6           7    Robert        6.0<br/>## 7           8     Laura        6.0</span></pre><p id="eaf1" class="pw-post-body-paragraph la lb iv lc b ld le jw lf lg lh jz li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">要生成边列表:</p><pre class="kl km kn ko gt na mb nb nc aw nd bi"><span id="1c61" class="mc md iv mb b gy ne nf l ng nh">edgelist=pd.merge(emps, emps, left_on='EmployeeId', right_on='ReportsTo')</span><span id="b707" class="mc md iv mb b gy ni nf l ng nh">edgelist.rename(<br/>  columns={'FirstName_x' :'from', 'FirstName_y' :'to'},<br/>  inplace=True<br/>)</span><span id="ceb0" class="mc md iv mb b gy ni nf l ng nh">edgelist=edgelist[['from', 'to']]</span><span id="be88" class="mc md iv mb b gy ni nf l ng nh">##       from        to<br/>## 0   Andrew     Nancy<br/>## 1   Andrew   Michael<br/>## 2    Nancy      Jane<br/>## 3    Nancy  Margaret<br/>## 4    Nancy     Steve<br/>## 5  Michael    Robert<br/>## 6  Michael     Laura</span></pre><p id="7117" class="pw-post-body-paragraph la lb iv lc b ld le jw lf lg lh jz li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">创建一个<code class="fe ly lz ma mb b">networkx</code>图形对象:</p><pre class="kl km kn ko gt na mb nb nc aw nd bi"><span id="bcb7" class="mc md iv mb b gy ne nf l ng nh">import networkx as nx</span><span id="c7b4" class="mc md iv mb b gy ni nf l ng nh">orgchart=nx.from_pandas_edgelist(edgelist, <br/>source='from', target='to')</span></pre><p id="9c24" class="pw-post-body-paragraph la lb iv lc b ld le jw lf lg lh jz li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">Python对图形可视化的支持肯定比R更基本。然而，如果你已经在你的系统上安装了graphviz(例如<code class="fe ly lz ma mb b">brew install graphviz</code>或<code class="fe ly lz ma mb b">sudo apt-get install graphviz</code>)并且安装了<code class="fe ly lz ma mb b">pydot</code>包，你可以用它来获得一个基本的可视化:</p><pre class="kl km kn ko gt na mb nb nc aw nd bi"><span id="c0fb" class="mc md iv mb b gy ne nf l ng nh">p=nx.drawing.nx_pydot.to_pydot(orgchart)<br/>p.write_png('orgchart.png')</span></pre><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/5ef8ad15ff7e59ce1fb5f55b1d51f57e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*bI2kPrnLKI4DoOP3RoIM3Q.png"/></div><p class="kw kx gj gh gi ky kz bd b be z dk translated">作者生成</p></figure></div><div class="ab cl nl nm hz nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="io ip iq ir is"><p id="e39a" class="pw-post-body-paragraph la lb iv lc b ld le jw lf lg lh jz li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">最初我是一名纯粹的数学家，后来我成为了一名心理计量学家和数据科学家。我热衷于将所有这些学科的严谨性应用到复杂的人的问题上。我也是一个编码极客和日本RPG的超级粉丝。在 <a class="ae lx" href="https://www.linkedin.com/in/keith-mcnulty/" rel="noopener ugc nofollow" target="_blank"> <em class="lw"> LinkedIn </em> </a> <em class="lw">或</em><a class="ae lx" href="https://twitter.com/dr_keithmcnulty" rel="noopener ugc nofollow" target="_blank"><em class="lw">Twitter</em></a><em class="lw">上找我。也可以看看我的博客上的</em><a class="ae lx" href="http://drkeithmcnulty.com/" rel="noopener ugc nofollow" target="_blank"><em class="lw">drkeithmcnulty.com</em></a><em class="lw">或者我的</em> <a class="ae lx" href="https://www.routledge.com/Handbook-of-Regression-Modeling-in-People-Analytics-With-Examples-in-R/McNulty/p/book/9781032041742" rel="noopener ugc nofollow" target="_blank"> <em class="lw">教科书上的人物分析</em> </a> <em class="lw">。</em></p></div></div>    
</body>
</html>