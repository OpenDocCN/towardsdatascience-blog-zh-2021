<html>
<head>
<title>Web Visualization with Plotly and Flask.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Plotly和Flask实现Web可视化。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/web-visualization-with-plotly-and-flask-3660abf9c946?source=collection_archive---------0-----------------------#2021-05-02">https://towardsdatascience.com/web-visualization-with-plotly-and-flask-3660abf9c946?source=collection_archive---------0-----------------------#2021-05-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="87d5" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">数据可视化</h2><div class=""/><div class=""><h2 id="2a8a" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">当Plotly plus Flask更容易和更灵活时，为什么要使用Dash</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/615cd85a94ff96d76f470ec2dbb8b00d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OZybgTXe44Nr3_KG"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">使用Plotly和Flask的多页web应用程序—图片由作者提供</p></figure><p id="2c96" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">你为什么想用Python写HTML？这让我困惑。但如果你想写一个Dash应用程序，这就是你需要做的。</p><p id="fdb7" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">虽然我知道将所有代码放在一个文件中有一定的满足感，但在我看来，如果你对HTML有足够的了解，可以用另一种语言编写代码，那么你肯定也有足够的知识用HTML编写代码！</p><p id="f4c7" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我很想让Dash成为编写web可视化应用程序的解决方案，但我不相信。</p><p id="ad83" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">请考虑以下情况:</p><ol class=""><li id="1efa" class="md me it lj b lk ll ln lo lq mf lu mg ly mh mc mi mj mk ml bi translated">Dash应用程序基本上是一个Flask应用程序，它整合了Plotly。</li><li id="775b" class="md me it lj b lk mm ln mn lq mo lu mp ly mq mc mi mj mk ml bi translated">编写一个使用Ploty的实际Flask应用程序并不困难。</li><li id="d6e9" class="md me it lj b lk mm ln mn lq mo lu mp ly mq mc mi mj mk ml bi translated">编写Flask应用程序可以让您更好地控制您所编写的内容，并且更加灵活。</li></ol><p id="9f61" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">因此，虽然我承认Dash是一个构造良好、用心良苦的工具，可以用来创建复杂而令人印象深刻的web应用程序，但我想提出一个我认为更简单的解决方案——至少对于简单的web应用程序来说是这样。</p><p id="5bda" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们将看到使用Flask构建包含Plotly图表的多页面web应用程序是多么简单(对于Dash的开源版本来说，这不是一项简单的任务)。</p><p id="778d" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">但是首先让我们快速比较一下一个简单的Dash应用程序和它的Flask等价物。</p><h1 id="415c" class="mr ms it bd mt mu mv mw mx my mz na nb ki nc kj nd kl ne km nf ko ng kp nh ni bi translated">简单的Dash应用程序</h1><p id="c7f8" class="pw-post-body-paragraph lh li it lj b lk nj kd lm ln nk kg lp lq nl ls lt lu nm lw lx ly nn ma mb mc im bi translated">下面列出了Dash教程的一个稍微修改的版本——原来的教程是<a class="ae no" href="https://dash.plotly.com/layout" rel="noopener ugc nofollow" target="_blank">这里是</a>，你可以从<a class="ae no" href="https://github.com/plotly/dash-docs/blob/master/dash_docs/chapters/getting_started/examples/getting_started_layout_1.py" rel="noopener ugc nofollow" target="_blank"> github </a>下载源代码。</p><p id="d04d" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">它有几个部分。首先，我们导入适当的库，然后在下一行，我们启动一个Dash应用程序。接下来，我们定义一个熊猫数据帧，然后画一个条形图，把它放入变量<em class="np">图</em>。</p><p id="d6ff" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">最后一部分为应用程序创建布局。创建布局基本上就是在Python中将网页定义为文档对象模型。定义的页面由一个标题“Hello Dash”和一些文本“Dash:Python的web应用程序框架”组成。最后是图表。</p><pre class="ks kt ku kv gt nq nr ns nt aw nu bi"><span id="7355" class="nv ms it nr b gy nw nx l ny nz">import dash<br/>import dash_core_components as dcc<br/>import dash_html_components as html<br/>import plotly.express as px<br/>import pandas as pd</span><span id="feeb" class="nv ms it nr b gy oa nx l ny nz">app = dash.Dash(__name__)</span><span id="9b52" class="nv ms it nr b gy oa nx l ny nz">df = pd.DataFrame({<br/>   'Fruit': ['Apples', 'Oranges', 'Bananas', 'Apples', 'Oranges', 'Bananas'],<br/>   'Amount': [4, 1, 2, 2, 4, 5],<br/>   'City': ['SF', 'SF', 'SF', 'Montreal', 'Montreal', 'Montreal']<br/>})</span><span id="d4b8" class="nv ms it nr b gy oa nx l ny nz">fig = px.bar(df, x='Fruit', y='Amount', color='City',  <br/>   barmode='group')</span><span id="6130" class="nv ms it nr b gy oa nx l ny nz">app.layout = html.Div(children=[<br/>   html.H1(children='Hello Dash'),<br/>   html.Div(children='''<br/>   Dash: A web application framework for Python.<br/>   '''),<br/>   dcc.Graph(<br/>      id='example-graph',<br/>      figure=fig<br/>   )<br/>]) </span><span id="590f" class="nv ms it nr b gy oa nx l ny nz">if __name__ == '__main__':<br/>   app.run_server(debug=True)</span></pre><p id="fb4e" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><em class="np">代码转载由Plotly提供—版权所有2019 Plotly，</em> <a class="ae no" href="https://github.com/plotly/dash-docs/blob/master/LICENSE" rel="noopener ugc nofollow" target="_blank"> <em class="np">麻省理工学院许可</em> </a></p><p id="8b2a" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这并不难理解，它会生成一个如下所示的网页:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ob"><img src="../Images/af688b374021480aba84fd0cefa92db5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*W_FVEXGsQnauUsKW"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">使用Dash的单页web应用程序—图片由作者提供</p></figure><p id="21a0" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">现在让我们看看烧瓶当量。</p><h1 id="0e70" class="mr ms it bd mt mu mv mw mx my mz na nb ki nc kj nd kl ne km nf ko ng kp nh ni bi translated">一个简单的烧瓶+ Plotly应用程序</h1><p id="2c74" class="pw-post-body-paragraph lh li it lj b lk nj kd lm ln nk kg lp lq nl ls lt lu nm lw lx ly nn ma mb mc im bi translated">一个使用Plotly的Flask app就有点不一样了。首先，有两个部分:Flask应用程序本身和一个或多个HTML模板。Flask应用程序的工作类似于Dash应用程序，但不构建实际的网页。网页是一个HTML模板，我们将Plotly数据从Flask应用程序传递给它，这样它就可以显示图表。</p><p id="b736" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">Flask部分的结构与Dash类似:首先是(略有不同的)imports，然后是Flask app，但现在有所不同。代码的下一部分在一个名为<em class="np"> notdash() </em>的函数定义中，它有一个<em class="np"> app.route </em>装饰器。</p><pre class="ks kt ku kv gt nq nr ns nt aw nu bi"><span id="f78b" class="nv ms it nr b gy nw nx l ny nz">from flask import Flask, render_template<br/>import pandas as pd<br/>import json<br/>import plotly<br/>import plotly.express as px</span><span id="d261" class="nv ms it nr b gy oa nx l ny nz">app = Flask(__name__)</span><span id="2613" class="nv ms it nr b gy oa nx l ny nz"><strong class="nr jd">@</strong>app.route('/')<br/>def notdash():<br/>   df = pd.DataFrame({<br/>      'Fruit': ['Apples', 'Oranges', 'Bananas', 'Apples', 'Oranges', <br/>      'Bananas'],<br/>      'Amount': [4, 1, 2, 2, 4, 5],<br/>      'City': ['SF', 'SF', 'SF', 'Montreal', 'Montreal', 'Montreal']<br/>   })</span><span id="ff98" class="nv ms it nr b gy oa nx l ny nz">   fig = px.bar(df, x='Fruit', y='Amount', color='City', <br/>      barmode='group')</span><span id="9aaa" class="nv ms it nr b gy oa nx l ny nz">   graphJSON = json.dumps(fig, cls=plotly.utils.PlotlyJSONEncoder)</span><span id="ece5" class="nv ms it nr b gy oa nx l ny nz">   return render_template('notdash.html', graphJSON=graphJSON)</span></pre><p id="d10c" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在Flask中，url被映射到函数上，装饰器告诉我们哪个函数对应于一个特定的URL，或者路由。在我们的例子中，我们有一个名为<em class="np"> notdash() </em>的函数，这个函数用于url“/”(即网站的根URL)。我们很快就会看到，使用Flask，我们可以用不同的URL指定其他页面。</p><p id="a04b" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">(如果您需要快速建立和运行Flask应用程序，请参见<a class="ae no" href="https://jones-alan.medium.com/how-to-create-and-run-a-flask-app-533b7b101c86" rel="noopener">如何创建和运行Flask应用程序</a>5分钟简介)</p><p id="b3c8" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在<em class="np"> notdash() </em>中，我们创建了dataframe，并且像在以前的版本中一样，在变量<em class="np"> fig </em>中创建了一个绘图。现在我们稍微改变一下。我们的下一步是使用<em class="np"> json.dumps() </em>和Plotly附带的json编码器将plot转换成JSON。这样做的原因是，网页将使用Plotly Javascript库来呈现绘图，这需要将Plotly图表编码为JSON。</p><p id="0233" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">下一行代码告诉Flask使用一个名为<em class="np">notdash.html</em>的HTML模板，并将JSON代码传递给它。</p><p id="2672" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">模板是将要显示的网页。它相当于Dash应用程序的布局，但我们在HTML文件中编写实际的HTML:HTML的主体包含一个标题(显示一条消息)和一个<em class="np"> &lt; div &gt; </em>元素，该元素将包含Plotly图表(为了让Plotly工作，我们需要给这个<em class="np"> &lt; div &gt; </em>一个id，并将其class属性设置为<em class="np"> chart </em>)。</p><p id="f3d3" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">文件的其余部分是几行Javascript样板代码，这些代码在任何Flask/Plotly应用程序中都很常见。首先，我们导入Plotly Javascript库。然后我们创建自己的脚本，为导入的JSON代码设置一个变量，然后从Plotly库中调用<em class="np"> plot </em>方法来显示图表。</p><p id="3ea0" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">注意，我们告诉Python将JSON数据放入HTML的方式是使用符号<em class="np"> {{name}} </em>，其中<em class="np"> name </em>是从Python传递给模板的参数，花括号表示它是参数的占位符。</p><pre class="ks kt ku kv gt nq nr ns nt aw nu bi"><span id="17b9" class="nv ms it nr b gy nw nx l ny nz">&lt;!doctype <em class="np">html</em>&gt;<br/>&lt;html&gt;<br/> &lt;body&gt;<br/>  &lt;h1&gt;Hello Plotly (but not Dash)&lt;/h1&gt;<br/>  &lt;div <em class="np">id</em>='chart' <em class="np">class</em>='chart'”&gt;&lt;/div&gt;<br/>&lt;/body&gt;</span><span id="9e95" class="nv ms it nr b gy oa nx l ny nz">&lt;script <em class="np">src</em>='https://cdn.plot.ly/plotly-latest.min.js'&gt;&lt;/script&gt;<br/>&lt;script <em class="np">type</em>='text/javascript'&gt;<br/>  var graphs = {{graphJSON | safe}};<br/>  Plotly.plot('chart',graphs,{});<br/>&lt;/script&gt;</span><span id="bbeb" class="nv ms it nr b gy oa nx l ny nz">&lt;/html&gt;</span></pre><p id="3a19" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">它看起来是这样的:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ob"><img src="../Images/32092abbbc538840db59d615e58e9939.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X4N1tNZ4PRwSeofX"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">使用Plotly和Flask的单页web应用程序—图片由作者提供</p></figure><p id="57af" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">非常类似于Dash版本，对吗？。</p><p id="aeba" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我不得不承认，我的非破折号版本稍微长一些，但从我的角度来看，将你的网页写成HTML文件并用Python编写你的web应用程序更符合逻辑。</p><p id="4ec1" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">更重要的是，它允许你灵活地编写多页应用程序。</p><h1 id="1a4e" class="mr ms it bd mt mu mv mw mx my mz na nb ki nc kj nd kl ne km nf ko ng kp nh ni bi translated">多页应用程序</h1><p id="b814" class="pw-post-body-paragraph lh li it lj b lk nj kd lm ln nk kg lp lq nl ls lt lu nm lw lx ly nn ma mb mc im bi translated">在本节中，我们将制作一个由三个页面组成的应用程序:两个包含不同图表的页面和一个包含其他两个页面链接的索引页面。当您有许多不同的图表或仪表板要包含在一个网站上时，这可能是您经常想要做的事情，但是当使用Dash时，这并不简单。</p><p id="f8cd" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">下图显示了该应用程序的三个页面。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/615cd85a94ff96d76f470ec2dbb8b00d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OZybgTXe44Nr3_KG"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">使用Plotly和Flask的多页web应用程序—图片由作者提供</p></figure><p id="eff5" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">它比前一个稍微复杂一些，因为图表页面(<em class="np">notdash2.html</em>)现在有三个参数，图表(和以前一样)加上一个标题和一个描述HTML代码中的占位符是<em class="np"> {{graphJSON}} </em>、<em class="np"> {{header}} </em>和<em class="np"> {{description}}。</em></p><p id="d05c" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">Flask代码现在有三个路径用于三个页面。第一个是web应用程序的根，另外两个是两个图表页面。请注意，这些图表具有相同的模板，因为它们使用相同的布局，但是不同的标题、描述和图表被传递给这些模板。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="5767" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">所以我认为，这并不太难，一个多页面的web应用程序使用Plotly来显示Flask应用程序中熊猫数据帧的图表。</p><h2 id="458b" class="nv ms it bd mt oe of dn mx og oh dp nb lq oi oj nd lu ok ol nf ly om on nh iz bi translated">复试</h2><p id="3917" class="pw-post-body-paragraph lh li it lj b lk nj kd lm ln nk kg lp lq nl ls lt lu nm lw lx ly nn ma mb mc im bi translated">但是，我听说你死于羊毛短跑爱好者说，什么样的回调？回调是一种破折号机制，它允许网页更新以响应输入的变化。嗯，我们也可以用HTML和Flask来做。但不是在这里。如果有足够的兴趣，我将在这篇文章之后再写一篇关于这方面的文章。如果你想在这篇文章和其他文章发表时得到通知，请考虑订阅我的免费、不定期的时事通讯。</p><p id="037d" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><em class="np">更新:后续文章在此:</em> <a class="ae no" rel="noopener" target="_blank" href="/an-interactive-web-dashboard-with-plotly-and-flask-c365cdec5e3f"> <em class="np">一个带Plotly和Flask的交互式Web仪表盘</em> </a></p><h2 id="6c52" class="nv ms it bd mt oe of dn mx og oh dp nb lq oi oj nd lu ok ol nf ly om on nh iz bi translated">密码</h2><p id="e105" class="pw-post-body-paragraph lh li it lj b lk nj kd lm ln nk kg lp lq nl ls lt lu nm lw lx ly nn ma mb mc im bi translated">如果您从上面的要点中复制代码，不要忘记HTML模板需要放在一个文件夹中，<em class="np"> templates，</em>或者，您可以在我的Github存储库中找到所有的源代码— <a class="ae no" href="https://alanjones2.github.io/Flask-Plotly/" rel="noopener ugc nofollow" target="_blank">参见Github页面。</a></p><h2 id="9ea4" class="nv ms it bd mt oe of dn mx og oh dp nb lq oi oj nd lu ok ol nf ly om on nh iz bi translated">那么，Dash还是Flask？</h2><p id="61ba" class="pw-post-body-paragraph lh li it lj b lk nj kd lm ln nk kg lp lq nl ls lt lu nm lw lx ly nn ma mb mc im bi translated">我确信使用Dash进行web可视化可能有很好的理由，我并不完全反对。我在这里的目的是展示，在我看来，至少对于简单的应用程序来说，有一种替代方案至少和Dash一样好。希望一直有用。</p></div><div class="ab cl oo op hx oq" role="separator"><span class="or bw bk os ot ou"/><span class="or bw bk os ot ou"/><span class="or bw bk os ot"/></div><div class="im in io ip iq"><p id="a01e" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">一如既往，感谢阅读。如果你想知道我什么时候发表新文章，请考虑注册下面的电子邮件提醒，或者订阅我偶尔发布的简讯<a class="ae no" href="https://technofile.substack.com/" rel="noopener ugc nofollow" target="_blank"> Technofile </a>。</p><p id="9e59" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果你不是一个媒体订阅者，那就注册吧，这样你就可以每月花5美元阅读尽可能多的文章。在这里注册<a class="ae no" href="https://alan-jones.medium.com/membership" rel="noopener"/>，我将赚取一小笔佣金。</p></div></div>    
</body>
</html>