<html>
<head>
<title>An Accessible Guide to Named Entity Recognition</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">命名实体识别的简易指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/named-entity-recognition-5324503d70da?source=collection_archive---------28-----------------------#2021-12-29">https://towardsdatascience.com/named-entity-recognition-5324503d70da?source=collection_archive---------28-----------------------#2021-12-29</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="f45a" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">如何使用自然语言处理从文本中自动识别适当的实体</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/00c03bdfa024307e180d4d693ed44d95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*af8EmtzRs6nROOkM.jpg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">鲍勃·鲍伊在<a class="ae kz" href="https://unsplash.com/s/photos/washington-dc?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="9942" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">什么是命名实体识别？</h1><p id="0b8b" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated"><a class="ae kz" href="https://en.wikipedia.org/wiki/Named-entity_recognition" rel="noopener ugc nofollow" target="_blank">命名实体识别</a>或 NER 是一种对文本中的命名实体进行识别和分类的技术。这些实体是在<a class="ae kz" href="https://www.dataknowsall.com/pos.html" rel="noopener ugc nofollow" target="_blank">词性标注</a>和<a class="ae kz" href="https://www.dataknowsall.com/nounphrase.html" rel="noopener ugc nofollow" target="_blank">名词短语分块</a>之上的一个级别，其中代替识别语法部分；它将单词识别和分类为它们真正的实体。公认的主要类别有:</p><pre class="kk kl km kn gu mo mp mq bn mr ms bi"><span id="7005" class="mt lb iu mp b be mu mv l mw mx">PERSON:      People, including fictional.<br/>NORP:        Nationalities or religious or political groups.<br/>FAC:         Buildings, airports, highways, bridges, etc.<br/>ORG:         Companies, agencies, institutions, etc.<br/>GPE:         Countries, cities, states.<br/>LOC:         Non-GPE locations, mountain ranges, bodies of water.<br/>PRODUCT:     Objects, vehicles, foods, etc. (Not services.)<br/>EVENT:       Named hurricanes, battles, wars, sports events, etc.<br/>WORK_OF_ART: Titles of books, songs, etc.<br/>LAW:         Named documents made into laws.<br/>LANGUAGE:    Any named language.<br/>DATE:        Absolute or relative dates or periods.<br/>TIME:        Times smaller than a day.<br/>PERCENT:     Percentage, including ”%“.<br/>MONEY:       Monetary values, including unit.<br/>QUANTITY:    Measurements, as of weight or distance.<br/>ORDINAL:     “first”, “second”, etc.<br/>CARDINAL:    Numerals that do not fall under another type.</span></pre><p id="5d04" class="pw-post-body-paragraph ls lt iu lu b lv my jv lx ly mz jy ma mb na md me mf nb mh mi mj nc ml mm mn in bi translated">有很多库可以选择；这些天我选择的工具是 SpaCy。它强大的 API 和模型只需几行代码就可以使用，正如我们将在后面看到的，我们可以用它来训练我们的模型。为了展示它的威力，让我们来看看它的运行情况。</p><h1 id="63bd" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">有空间的 NER</h1><p id="3a69" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">我们先从一篇<strong class="lu iv"> Teslarati </strong>文章中的一段开始:<a class="ae kz" href="https://www.teslarati.com/tesla-new-york-city-12-million-model-3-order/" rel="noopener ugc nofollow" target="_blank">特斯拉可能从纽约市获得价值 1236 万美元的 Model 3 订单</a>。</p><pre class="kk kl km kn gu mo mp mq bn mr ms bi"><span id="eab6" class="mt lb iu mp b be mu mv l mw mx">import spacy<br/>from spacy import displacy<br/>nlp = spacy.load("en_core_web_sm")<br/><br/>text = "IN THE MATTER OF a proposed contract between the Department of Citywide Administrative Services of the City of New York and Tesla, Inc., located at 3500 Deer Creek Rd., Palo Alto, CA 94304, for procuring Tesla Model 3 All-Electric Sedans. The contract is in the amount of $12,360,000.00. The term of the contract shall be five years from date of Notice of Award. The proposed contractor has been selected by Sole Source Procurement Method, pursuant to Section 3-05 of the Procurement Policy Board Rules. If the plan does go through, the $12.36 million could effectively purchase about 274 units of the base Model 3 Rear-Wheel-Drive, which cost $44,990 under Tesla's current pricing structure."<br/><br/>doc = nlp(text)<br/>displacy.render(doc, style="ent")</span></pre><p id="c3d7" class="pw-post-body-paragraph ls lt iu lu b lv my jv lx ly mz jy ma mb na md me mf nb mh mi mj nc ml mm mn in bi translated">Spacy 有一个奇妙的能力来渲染<strong class="lu iv"> NER </strong>标签与文本一致，这是一个奇妙的方式来查看在原始文章的上下文中被识别的内容。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nd"><img src="../Images/6c8084611496f76ba0c51c5e5339004b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GF65WkSPj9_NOvgTNxwuFg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">作者图片</p></figure><h1 id="9323" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">培训自定义实体</h1><p id="75ce" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">如果你是一名在 DC 报道华府的记者，训练有素的 NER 模特是非常棒的。然而，我们大多数人都不是。如果你在一个产品团队中，你想<strong class="lu iv">更新</strong>模型，以包含<strong class="lu iv">新的实体</strong>来映射你的业务，那该怎么办？幸运的是，这可以通过<strong class="lu iv">空间</strong>实现。我将使用一个开发人员在 StackOverflow 上的帖子来说明这个过程，他正在使用我公司的一个 API。在重新训练模型之前，让我们看看输出。</p><h1 id="01fc" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">以前</h1><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ne"><img src="../Images/76b3a3be1c97b51d03053c4d284fb8ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Li1wLby44dZ_zNCjKBVhA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">作者图片</p></figure><h1 id="2724" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">训练模型</h1><p id="8170" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">从头开始训练一个新的模型或者更新现有的模型是可能的。以下示例将向您展示如何使用新实体<strong class="lu iv">和新现有实体下的新单词</strong>更新现有模型。我所在的行业，像许多其他行业一样，有许多特定的语言需要被涵盖，以给 NER 提供适当的背景。产品名称、新组织，对我来说，我甚至要教它什么是 API。</p><p id="84c7" class="pw-post-body-paragraph ls lt iu lu b lv my jv lx ly mz jy ma mb na md me mf nb mh mi mj nc ml mm mn in bi translated">我们需要建立一个<strong class="lu iv">训练集</strong>，它可以由你创建的句子构成，或者你可以从数据集中提取它们。您可以为您想要培训的每个<strong class="lu iv">新实体</strong>添加<strong class="lu iv">一个</strong>或<strong class="lu iv">两个</strong>示例。我还构建了一个实用函数，它简化了 Spacy 所需的<code class="fe nf ng nh mp b">tuple</code>格式的创建。</p><pre class="kk kl km kn gu mo mp mq bn mr ms bi"><span id="76af" class="mt lb iu mp b be mu mv l mw mx">def built_spacy_ner(text, target, type):<br/>    start = str.find(text, target)<br/>    end = start + len(target)<br/><br/>    return (text, {"entities": [(start, end, type)]})</span></pre><p id="bbd9" class="pw-post-body-paragraph ls lt iu lu b lv my jv lx ly mz jy ma mb na md me mf nb mh mi mj nc ml mm mn in bi translated">我们可以用上面的函数传入<code class="fe nf ng nh mp b">text</code>、<code class="fe nf ng nh mp b">target</code>和<code class="fe nf ng nh mp b">type</code>来获得正确格式化的元组。结果是一个列表。</p><pre class="kk kl km kn gu mo mp mq bn mr ms bi"><span id="5a51" class="mt lb iu mp b be mu mv l mw mx">TRAIN_DATA = []<br/>TRAIN_DATA.append(<br/>  built_spacy_ner("I work for Autodesk.", "Autodesk", "ORG")<br/>  )</span></pre><p id="8b6d" class="pw-post-body-paragraph ls lt iu lu b lv my jv lx ly mz jy ma mb na md me mf nb mh mi mj nc ml mm mn in bi translated">最终的格式是一个带有原始<code class="fe nf ng nh mp b">string</code>的<code class="fe nf ng nh mp b">tuple</code>和一个带有实体的<code class="fe nf ng nh mp b">start</code>和<code class="fe nf ng nh mp b">end</code>位置的<code class="fe nf ng nh mp b">dictionary</code>在<code class="fe nf ng nh mp b">string</code>及其<code class="fe nf ng nh mp b">type</code>中。下面是我在例子中使用的全套训练数据。我们可以看到添加了新的实体类型<code class="fe nf ng nh mp b">API</code>、<code class="fe nf ng nh mp b">SERVICE</code>和<code class="fe nf ng nh mp b">FORMAT</code>，现有的实体<code class="fe nf ng nh mp b">ORG</code>和<code class="fe nf ng nh mp b">PRODUCT</code>有了新的条目。</p><pre class="kk kl km kn gu mo mp mq bn mr ms bi"><span id="3846" class="mt lb iu mp b be mu mv l mw mx">[('Model Derivative API provides translation', <br/>  {'entities': [(0, 20, 'API')]}),<br/> ('I want to create a cloud-based service to Revit Server.',<br/>  {'entities': [(61, 73, 'PRODUCT')]}),<br/> ("I'm new to the Forge API unsure where a design parameter is",<br/>  {'entities': [(15, 24, 'API')]}),<br/> ('I would like to automate Revit with the Design Automation API',<br/>  {'entities': [(40, 61, 'API')]}),<br/> ("I've uploaded a Revit model to my OSS bucket.",<br/>  {'entities': [(34, 37, 'SERVICE')]}),<br/> ('Autodesk Forge is my Platform of choice',<br/>  {'entities': [(0, 14, 'PRODUCT')]}),<br/> ('The native file format for Revit is RVT.',<br/>  {'entities': [(36, 39, 'FORMAT')]}),<br/> ('I work for Autodesk.', <br/>  {'entities': [(11, 19, 'ORG')]}),<br/> ('The Model Derivative API used in conjunction with the Viewer',<br/>  {'entities': [(4, 24, 'API')]}),<br/> ('Changes are sent to a central BIM 360 server.',<br/>  {'entities': [(30, 37, 'PRODUCT')]}),<br/> ('All of this is possible on IFC.', <br/>  {'entities': [(27, 30, 'FORMAT')]})]</span></pre><p id="c58c" class="pw-post-body-paragraph ls lt iu lu b lv my jv lx ly mz jy ma mb na md me mf nb mh mi mj nc ml mm mn in bi translated"><strong class="lu iv">注:</strong>我经历(和阅读)的一件事是，如果你提供了太多的文本示例，它会过拟合，最终除了你训练过的示例之外，什么也认不出来。我开始尝试训练整个<code class="fe nf ng nh mp b">DataFrame</code>，但是它基本上消除了预先训练的实体。</p><p id="01c2" class="pw-post-body-paragraph ls lt iu lu b lv my jv lx ly mz jy ma mb na md me mf nb mh mi mj nc ml mm mn in bi translated">有了训练数据后，我们需要用新的实体更新可用的实体。</p><pre class="kk kl km kn gu mo mp mq bn mr ms bi"><span id="fec7" class="mt lb iu mp b be mu mv l mw mx"># adding a named entity label<br/>ner = nlp.get_pipe('ner')<br/><br/># Iterate through training data and add new entitle labels.<br/>for _, annotations in TRAIN_DATA:<br/>  for ent in annotations.get("entities"):<br/>    ner.add_label(ent[2])</span></pre><p id="50e8" class="pw-post-body-paragraph ls lt iu lu b lv my jv lx ly mz jy ma mb na md me mf nb mh mi mj nc ml mm mn in bi translated">接下来，我们需要训练模型。我们首先要确保我们只通过选择与<code class="fe nf ng nh mp b">ner</code>相关的<code class="fe nf ng nh mp b">pipe_names</code>来更新<strong class="lu iv"> NER </strong>型号。然后，我们遍历训练数据，利用<code class="fe nf ng nh mp b">Example</code>函数，并用每个新实体更新 NER 模型。</p><pre class="kk kl km kn gu mo mp mq bn mr ms bi"><span id="b7a7" class="mt lb iu mp b be mu mv l mw mx"># creating an optimizer and selecting a list of pipes NOT to train<br/>optimizer = nlp.create_optimizer()<br/>other_pipes = [pipe for pipe in nlp.pipe_names if pipe != 'ner']<br/><br/>with nlp.disable_pipes(*other_pipes):<br/>    for itn in range(10):<br/>        random.shuffle(TRAIN_DATA)<br/>        losses = {}<br/><br/>        # batch the examples and iterate over them<br/>        for batch in spacy.util.minibatch(TRAIN_DATA, size=2):<br/>            for text, annotations in batch:<br/>                doc = nlp.make_doc(text)<br/>                example = Example.from_dict(doc, annotations)<br/>                nlp.update([example], drop=0.35, sgd=optimizer, losses=losses)<br/><br/>print("Final loss: ", losses)</span></pre><p id="d147" class="pw-post-body-paragraph ls lt iu lu b lv my jv lx ly mz jy ma mb na md me mf nb mh mi mj nc ml mm mn in bi translated">这是它的基础。在为您的生产全面训练模型时，您应该阅读 Spacy 文档，以了解如何将其部署到生产环境中。</p><h1 id="ec06" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">在...之后</h1><p id="e197" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">最后，让我们尝试使用<strong class="lu iv">新模型</strong>再次处理我们的文本。</p><pre class="kk kl km kn gu mo mp mq bn mr ms bi"><span id="b8b4" class="mt lb iu mp b be mu mv l mw mx">doc = nlp(text)<br/>displacy.render(doc, style="ent", jupyter=True)</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ni"><img src="../Images/4b4e819a9e1c8c0c4e0b83d2e77e1da0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EU5_VUDxz46DTqRgXrDZHg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">作者图片</p></figure><p id="886e" class="pw-post-body-paragraph ls lt iu lu b lv my jv lx ly mz jy ma mb na md me mf nb mh mi mj nc ml mm mn in bi translated">我们可以看到更新后的结果正确地标记了<code class="fe nf ng nh mp b">APIs</code>，它现在正确地捕捉了<strong class="lu iv"> Autodesk Forge </strong>和<strong class="lu iv"> Revit </strong>的<code class="fe nf ng nh mp b">PRODUCTS</code>，最后，<strong class="lu iv"> IFC </strong>被列为<code class="fe nf ng nh mp b">ORG</code>，这应该是基于训练的。这些结果显示了调整<strong class="lu iv"> NER 模型</strong>以满足你的短期实验的特定需求的前景。</p><h1 id="0b84" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">NER 与 NLTK</h1><p id="7044" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated"><strong class="lu iv">自然语言工具包</strong> (NLTK)也提供了<strong class="lu iv"> NER </strong>功能。让我们看看上面的原始段落，并通过 NLTK 的 NER 运行它。</p><pre class="kk kl km kn gu mo mp mq bn mr ms bi"><span id="6825" class="mt lb iu mp b be mu mv l mw mx">for sent in sent_tokenize(text):<br/>   for chunk in ne_chunk(pos_tag(word_tokenize(sent))):<br/>      if hasattr(chunk, 'label'):<br/>         print(chunk.label(), ' '.join(c[0] for c in chunk))</span></pre><pre class="nj mo mp mq bn mr ms bi"><span id="5fe8" class="mt lb iu mp b be mu mv l mw mx">ORGANIZATION Department<br/>ORGANIZATION Citywide Administrative Services<br/>ORGANIZATION City<br/>GPE New York<br/>PERSON Tesla<br/>PERSON Palo Alto<br/>PERSON Tesla Model<br/>PERSON Award<br/>PERSON Sole Source<br/>ORGANIZATION Procurement Policy Board Rules<br/>PERSON Tesla</span></pre><p id="7d11" class="pw-post-body-paragraph ls lt iu lu b lv my jv lx ly mz jy ma mb na md me mf nb mh mi mj nc ml mm mn in bi translated"><strong class="lu iv"> NLTK </strong>似乎没有为这个特定的文本标记项目以及空间。几个区别只有三种类型的标签被识别，其中 spacy 有<code class="fe nf ng nh mp b">cardinal</code>、<code class="fe nf ng nh mp b">date</code>、<code class="fe nf ng nh mp b">money</code>和<code class="fe nf ng nh mp b">law</code>都从相同的文本中被识别。此外，<strong class="lu iv">帕洛阿尔托</strong>和<strong class="lu iv">特斯拉</strong>被错误地识别为人和其他几个被错误标记的物品。我的经验是，虽然 NLTK 肯定功能齐全，但 Spacy<strong class="lu iv">总体表现更好。</strong></p><h1 id="033f" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">结论</h1><p id="0fc8" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">我希望您喜欢这个快速浏览，尤其是用不同的实体来训练 NER 模型的能力，这些实体为您的用例改进了 NER。本文中使用的完整源代码可以在<a class="ae kz" href="https://github.com/broepke/NER" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p><p id="fbd9" class="pw-post-body-paragraph ls lt iu lu b lv my jv lx ly mz jy ma mb na md me mf nb mh mi mj nc ml mm mn in bi translated">如果你喜欢阅读这样的故事，并想支持我成为一名作家，可以考虑报名成为一名媒体成员。一个月 5 美元，让你可以无限制地访问成千上万篇文章。如果你使用<a class="ae kz" href="https://medium.com/@broepke/membership" rel="noopener">我的链接</a>注册，我会赚一小笔佣金，不需要你额外付费。</p></div></div>    
</body>
</html>