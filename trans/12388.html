<html>
<head>
<title>Chipotle Site Selection Using CBG Clustering — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 CBG 聚类法进行墨西哥薄饼店选址——第一部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/chipotle-site-selection-using-cbg-clustering-part-1-7ab8b76b79c5?source=collection_archive---------32-----------------------#2021-12-16">https://towardsdatascience.com/chipotle-site-selection-using-cbg-clustering-part-1-7ab8b76b79c5?source=collection_archive---------32-----------------------#2021-12-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7317" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">地理空间数据可以帮助预测 Chipotle 将在哪里开设新的位置吗？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1de567528497d52c0e78c23aaf1cc20e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*17ghKVZHwZ23kTLghLGc1Q.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Emile Mbunzama 在<a class="ae kv" href="https://unsplash.com/s/photos/ice-cream?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="21a3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">本文中的所有分析都是使用 SafeGraph CBG 数据和模式数据完成的。请引用 SafeGraph 作为本文的参考。</em></p><p id="582f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文是围绕人口普查区块组数据聚类的两篇系列文章中的第一篇。这个项目的目的是使用 CBG 聚类来预测 Chipotle 未来的选址。选址是像 Chipotle 这样寻求扩张到新地点的大公司特许经营的主要兴趣点。在 2020 年和 2021 年之间，Chipotle 在美国开设了 100 多个新地点，使其成为测试这种选址算法的理想候选人。本文将重点介绍如何使用美国人口普查局和 SafeGraph 的邻域模式数据首先创建聚类，然后将这些聚类与 Chipotle 位置进行匹配。</p><p id="4685" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文将主要使用 Sklearn 的 K-Means 聚类算法来产生聚类，并将这些聚类归属于美国各地的 Chipotle 位置。可以通过<a class="ae kv" href="http://safegraph.com/" rel="noopener ugc nofollow" target="_blank">安全图</a>访问 Chipotle 地点数据和美国人口普查区块组数据。SafeGraph 是一家数据提供商，为数百家企业和类别提供 POI 数据。它向学术界免费提供数据。对于这个项目，我选择使用 SafeGraph Places 数据来运行我的分析。地点数据的模式可以在这里找到:<a class="ae kv" href="https://docs.safegraph.com/docs/core-places" rel="noopener ugc nofollow" target="_blank">模式信息</a></p><h1 id="809b" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">CBG 数据选择:选择哪种人口统计学？</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ml"><img src="../Images/889f79334467bd170605ae8003f5b42e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7CU2cDRzZZwJv0jFkLNsWA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@viniciusamano?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">vini cius“amnx”Amano</a>在<a class="ae kv" href="https://unsplash.com/s/photos/candy?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="ca3d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下代码片段允许我们从 SafeGraph 包中访问美国人口普查数据的字段描述:</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="ae6f" class="mr lu iq mn b gy ms mt l mu mv">!pip install -q --upgrade git+https://github.com/SafeGraphInc/safegraph_py</span><span id="d1a5" class="mr lu iq mn b gy mw mt l mu mv">from safegraph_py_functions import safegraph_py_functions as sgpy</span><span id="7d5e" class="mr lu iq mn b gy mw mt l mu mv">from safegraph_py_functions import cbg_functions as sgpy_cbg<br/></span><span id="b51e" class="mr lu iq mn b gy mw mt l mu mv">df = sgpy_cbg.get_cbg_field_descriptions()</span><span id="4169" class="mr lu iq mn b gy mw mt l mu mv">df['field_level_1'].value_counts()</span><span id="0ab0" class="mr lu iq mn b gy mw mt l mu mv">df = df[df['field_level_1'] == 'Estimate']</span><span id="ca7e" class="mr lu iq mn b gy mw mt l mu mv">df.to_csv('census.csv')</span></pre><p id="3c2c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">字段描述用于提供实际人口普查数据集中的要素。由于该数据集提供了 7500 多个要素，因此使用该表可以更直接、更简单地选择分析所需的要素。需要注意的是，为了便于分析，我们将字段描述表限制为仅包含“估计”记录，而不是同时包含“估计”和“置信度”记录。“估计”记录是提供数值的记录，这些数值可以与给定人口普查区块组中特定人口统计的计数相关联。这是我们希望在分析中使用的信息。字段描述表如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/6cbb9843dc8cdad3edd66f7b7e73e92d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d_U5kSfmMbVFZSbPFqWz3g.png"/></div></div></figure><p id="8695" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然这个表有点晦涩难懂，但它本质上可以归结为这个表中的每条记录都对应于实际人口普查数据中的一个唯一列。有了这些信息，现在很明显，选择正确的人口统计对于这个项目生成的聚类的准确性是非常重要的。出于这个项目的目的，我们选择考虑与年龄、性别、收入和其他因素(如房屋所有权和工作时间)相关的特征。总的来说，我们研究了聚类算法的大约 70 个特性，其代码如下所示:</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="8c8d" class="mr lu iq mn b gy ms mt l mu mv">census_cols = sgpy_cbg.get_census_columns(['B01001e1',</span><span id="b052" class="mr lu iq mn b gy mw mt l mu mv">'B01001e10','B01001e11','B01001e12','B01001e13','B01001e14',</span><span id="532b" class="mr lu iq mn b gy mw mt l mu mv">'B01001e15','B01001e16','B01001e17','B01001e18','B01001e19',</span><span id="3bba" class="mr lu iq mn b gy mw mt l mu mv">'B01001e20','B01001e21','B01001e22','B01001e23','B01001e24',</span><span id="0a38" class="mr lu iq mn b gy mw mt l mu mv">'B01001e25','B01001e27','B01001e28','B01001e29','B01001e30',</span><span id="dfd1" class="mr lu iq mn b gy mw mt l mu mv">'B01001e31','B01001e32','B01001e33','B01001e34','B01001e35',</span><span id="9141" class="mr lu iq mn b gy mw mt l mu mv">'B01001e36','B01001e37','B01001e38','B01001e39','B01001e40',</span><span id="a74e" class="mr lu iq mn b gy mw mt l mu mv">'B01001e41','B01001e42','B02001e1','B02001e10','B02001e2',</span><span id="aed5" class="mr lu iq mn b gy mw mt l mu mv">'B09019e2','B09019e20','B09019e21','B09019e22','B09019e23',</span><span id="3677" class="mr lu iq mn b gy mw mt l mu mv">'B09019e24','B09019e25','B09019e26','B09019e3','B09019e4',</span><span id="b721" class="mr lu iq mn b gy mw mt l mu mv">'B09019e5','B09019e6','B09019e7','B09019e8','B09019e9',</span><span id="11ae" class="mr lu iq mn b gy mw mt l mu mv">'B19001e1','B19001e10','B19001e11','B19001e12','B19001e13',</span><span id="7c12" class="mr lu iq mn b gy mw mt l mu mv">'B19001e14','B19001e15','B19001e16','B19001e17','B19001e2',</span><span id="2fb7" class="mr lu iq mn b gy mw mt l mu mv">'B19001e3','B19001e4','B19001e5','B19001e6','B19001e7',</span><span id="8b43" class="mr lu iq mn b gy mw mt l mu mv">'B19001e8','B19001e9'], 2019)</span></pre><p id="a600" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些生成的要素的数据框架如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/325304e985ff5e43b78928f251146d29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mv-LMHEMXgjOr9RaVCrGPg.png"/></div></div></figure><p id="290e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">稍微清理数据(将所有数值转换为浮点数)后，我们可以将该数据追加到 SafeGraph 邻域模式数据中，这将为我们提供与特定人口普查区块组的原始访问者数量、这些访问者到达相关 CBG 的距离以及在相关 CBG 停留的平均时间相关的列。在邻域模式数据中，可能有更多有用的列，但为了简单起见，我们只使用这些列</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="6849" class="mr lu iq mn b gy ms mt l mu mv">patterns = patterns[['area', 'raw_stop_counts', 'raw_device_counts', 'distance_from_home', 'distance_from_primary_daytime_location', 'median_dwell']]</span><span id="6ded" class="mr lu iq mn b gy mw mt l mu mv">patterns['census_block_group'] = patterns['area']</span><span id="94a5" class="mr lu iq mn b gy mw mt l mu mv">patterns = patterns.drop(['area'], axis = 1)</span><span id="6e5d" class="mr lu iq mn b gy mw mt l mu mv">df = df.merge(patterns, on = 'census_block_group')</span></pre><p id="ab4e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这导致两个数据帧合并在一起:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/d1c5c2808f840fd8783446ebca016600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lBxq0KpAPVhnhblg_bJpAw.png"/></div></div></figure><h1 id="318c" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">CBG 聚类:最后一步</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/c6b6e8d479260df159e4c37746998e48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nsb_XQHyWbxtW1qmvYAbwQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在<a class="ae kv" href="https://unsplash.com/s/photos/candy?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae kv" href="https://unsplash.com/@billow926?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">翻滚 926 </a>拍照</p></figure><p id="1c9e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该过程的第一步是对创建的数据集使用 K-means 聚类，并根据提供的特征对记录进行聚类。为了这个实验的目的，我们选择创建 50 个集群。下面的代码片段执行此操作。请注意，将大量记录聚集到少数几个分类中会导致运行时间过长:</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="6b44" class="mr lu iq mn b gy ms mt l mu mv">model = KMeans(init="random",</span><span id="1493" class="mr lu iq mn b gy mw mt l mu mv">n_clusters=50,</span><span id="56b7" class="mr lu iq mn b gy mw mt l mu mv">n_init=1000,</span><span id="b753" class="mr lu iq mn b gy mw mt l mu mv">max_iter=400,</span><span id="9c1f" class="mr lu iq mn b gy mw mt l mu mv">random_state=42)</span><span id="47e0" class="mr lu iq mn b gy mw mt l mu mv">model.fit(df[1:])</span><span id="947a" class="mr lu iq mn b gy mw mt l mu mv">pred = model.predict(df)</span></pre><p id="0994" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要查看跨集群 id 的记录分布，可以使用下面的代码片段:</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="8254" class="mr lu iq mn b gy ms mt l mu mv">freq = {}</span><span id="427d" class="mr lu iq mn b gy mw mt l mu mv">for item in pred:</span><span id="90a7" class="mr lu iq mn b gy mw mt l mu mv">    if (item in freq):</span><span id="b5b6" class="mr lu iq mn b gy mw mt l mu mv">        freq[item] += 1</span><span id="6a5b" class="mr lu iq mn b gy mw mt l mu mv">    else:</span><span id="fa54" class="mr lu iq mn b gy mw mt l mu mv">        freq[item] = 1</span></pre><p id="65e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了可视化这个分布，我们可以使用下面的代码片段来绘制它:</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="85b7" class="mr lu iq mn b gy ms mt l mu mv">plt.bar(freq.keys(), freq.values())</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/b5455fd7d2bb1beea7524e4dabcd56f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*UtreLh6nYsUTlgJJ8yI2qA.png"/></div></figure><p id="70ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从这个分布中我们可以看到，记录甚至不是在聚类之间分布的，这表明每个记录的特征变化导致 k-means 算法独立地做出决定来分配聚类 ID。</p><h1 id="9af1" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak">结论:</strong></h1><p id="29e6" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">从<strong class="ky ir"> </strong>这篇文章中，我们能够看到 SafeGraph 提供的人口普查区块数据、邻里模式数据和每月模式数据的多功能性。使用这三个数据集，我们能够得出一组超过 70 个特征，我们认为这些特征对于 Chipotle 特许经营店未来选址过程至关重要。这些人口统计数据包括年龄、性别、收入和其他因素，如房屋所有权和工作时间。然后，我们使用邻域模式数据将这些特征与其他一些特征相关联，例如特定人口普查区块组的原始访问者数量、这些访问者到达相关 CBG 的距离以及在相关 CBG 逗留的平均时间。使用这些数据，我们将 CBG 信息加入到 2020 年 Chipotle 的月度模式数据中。这个完整的数据然后被用于将数据聚类成 50 个独特的聚类。对于本项目的下一步和下一篇文章，我们将重点关注使用 2021 Chipotle 数据作为地面实况，并查看哪些集群接收新位置。</p><p id="ce7b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls">提问？</em> </strong></p><p id="7920" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我邀请你在<a class="ae kv" href="https://www.safegraph.com/academics" rel="noopener ugc nofollow" target="_blank"> SafeGraph 社区</a>的<strong class="ky ir"> #help </strong>频道问他们，这是一个面向数据爱好者的免费 Slack 社区。获得支持、共享您的工作或与 GIS 社区中的其他人联系。通过 SafeGraph 社区，学者们可以免费访问美国、英国和加拿大 700 多万家企业的数据。</p></div></div>    
</body>
</html>