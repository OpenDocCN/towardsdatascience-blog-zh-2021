<html>
<head>
<title>How to plot Worldwide antibiotic resistance data using Geopandas in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python中的Geopandas绘制全球抗生素耐药性数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-plot-worldwide-antibiotic-resistance-data-using-geopandas-in-python-3be4d03f28ef?source=collection_archive---------42-----------------------#2021-04-13">https://towardsdatascience.com/how-to-plot-worldwide-antibiotic-resistance-data-using-geopandas-in-python-3be4d03f28ef?source=collection_archive---------42-----------------------#2021-04-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dee8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">制作信息丰富的Geopandas图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f17b6f84b5945930ee31c871e0f81e38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e4ilVa_CJkkKloEAG7qINA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Stephen Fordham(作者)使用Python中的Geopandas库制作的图像</p></figure><h2 id="2dde" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">介绍</h2><p id="5947" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">越来越多的细菌出现了抗生素耐药性。令人担忧的是，对最后手段抗生素的耐药性正在上升。在本教程中，我将演示如何使用Python中的Geopandas库作为工具来引起全球对抗生素耐药性的关注。为此，我使用了两个数据源:</p><ol class=""><li id="c127" class="mn mo it lw b lx mp ma mq lh mr ll ms lp mt mm mu mv mw mx bi translated">抗性评分数据集，其中抗性评分1至3对应于细菌对最终抗生素的抗性增加。</li><li id="4b9b" class="mn mo it lw b lx my ma mz lh na ll nb lp nc mm mu mv mw mx bi translated">来自ArcGIS的数据集，包含每个国家的地理坐标。</li></ol><h2 id="eeed" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">如何绘制阻力位</h2><p id="b718" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">目标是获取世界上所有国家的几何信息，并将这些数据与另一个列出全球抗生素耐药性得分的数据源合并。最后，我将演示如何绘制全球抗生素耐药性地图，这将作为一个有用的汇总信息图，有助于检测高和低耐药性区域。此外，通过绘制包括没有可用信息的区域的整个地图，将暴露可能缺乏监控的区域(至少对于此处使用的数据集而言)。</p><p id="be1e" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh nd me mf ll ne mh mi lp nf mk ml mm im bi translated">我遵循以下工作流程:</p><ol class=""><li id="c905" class="mn mo it lw b lx mp ma mq lh mr ll ms lp mt mm mu mv mw mx bi translated">读入数据集</li><li id="4441" class="mn mo it lw b lx my ma mz lh na ll nb lp nc mm mu mv mw mx bi translated">代表性提取(消除偏倚)</li><li id="036c" class="mn mo it lw b lx my ma mz lh na ll nb lp nc mm mu mv mw mx bi translated">数据清理</li><li id="bd6e" class="mn mo it lw b lx my ma mz lh na ll nb lp nc mm mu mv mw mx bi translated">合并数据集</li><li id="3488" class="mn mo it lw b lx my ma mz lh na ll nb lp nc mm mu mv mw mx bi translated">测绘</li></ol><p id="74ba" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh nd me mf ll ne mh mi lp nf mk ml mm im bi translated">如果您想访问这里使用的Jupyter笔记本，可以在我的<a class="ae ng" href="https://github.com/StephenFordham/Geopandas_mapping_tutorial" rel="noopener ugc nofollow" target="_blank"> Github页面</a>上找到。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h2 id="2250" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">1.解析数据集:世界各国和抗生素耐药性得分</h2><p id="57f1" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">首先，使用geopandas read_file函数读取来源于<a class="ae ng" href="https://hub.arcgis.com/datasets/a21fdb46d23e4ef896f31475217cbb08_1?geometry=151.172%2C-89.998%2C-151.172%2C-79.513" rel="noopener ugc nofollow" target="_blank"> rcG </a>的形状文件。该文件包含与每个国家相关的必要几何信息。生成的对象是一个geopandas数据帧，其行为类似于本地pandas数据帧。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/59d7c114463c5317ef438765e60c1560.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5m4Th8RTFjgc6Iye0B3aTg.png"/></div></div></figure><p id="6f2b" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh nd me mf ll ne mh mi lp nf mk ml mm im bi translated">接下来，我们将使用pandas read_csv函数读取阻力分数数据集。我们可以简单地检查数据帧的头部，以确认数据已经被正确解析。我们现在可以创建一个新的列，使用lambda函数提取分数，如代码片段所示。我还重命名了这些列，以更准确地反映它们的内容。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/c520b4d15902dd8d6ed21808b2a3c713.png" data-original-src="https://miro.medium.com/v2/resize:fit:546/format:webp/1*t49D8iA5o9w85U19KsO17g.png"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/042f03346e8653f5f5adc67b670d9663.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8l91IXkHDwX4GKv63HSXqA.png"/></div></div></figure><h2 id="3c18" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">2.代表性国家抽样</h2><p id="4fd0" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">理想情况下，阻力分数应尽可能提供更多信息。为了实现这一点，明智的做法是对有≥ 10个分离株的国家进行代表性采样。这将有助于避免我们在以后绘图时引入偏差。这可以通过对country列执行groupby方法调用并对这个groupby对象调用size方法来实现。然后，我们可以根据没有应用大小筛选的groupby对象进行筛选，对值进行排序，并检索由≥ 10个隔离区表示的所有国家/地区。下面的代码片段演示了如何实现这一步。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/2d260fee47c832e2c6f3d9fa87920c2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5_J8ozqAo2AYgHushtuipQ.png"/></div></div></figure><p id="f64f" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh nd me mf ll ne mh mi lp nf mk ml mm im bi translated">现在我们有了一个代表性国家的列表，我们可以过滤原始res数据框架以产生一个新的数据框架，该数据框架对平均耐药性得分进行平均，并且只包括≥ 10个分离物的国家。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="fca4" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh nd me mf ll ne mh mi lp nf mk ml mm im bi translated">res数据框架现在在国家和抗性分数之间有一个很好的连接关系。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/5499ea7b41695e438e45ebe48787eb11.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/format:webp/1*FY2xdxczIYl24ln097qZzg.png"/></div></figure><h2 id="64e0" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">3.数据清理</h2><p id="966f" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">我们接下来需要执行一点数据清理。这是必需的，因为有时国家可能有不同的名称。合并时，我们需要一个通用名称，因此包括美国在内的国家信息不会出现在单独的行中，例如一行代表“美国”，另一行代表“美国”。为了识别共享国家和非共享国家，我创建了一个简单的for循环，遍历resistance score数据帧中的国家。对于不在geopandas数据框架gdf中的每个国家，它将被添加到名为different_countries的列表中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="3f12" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh nd me mf ll ne mh mi lp nf mk ml mm im bi translated">这两份清单显示了61个共同的国家和6个在两个数据框架之间不同的国家。我们必须要么删除这些国家，要么重新命名。对于重命名，我们将使用geopandas数据框架中的国家名称作为正式名称。</p><p id="23d7" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh nd me mf ll ne mh mi lp nf mk ml mm im bi translated">我选择删除条目:“未知”、“加勒比”和“香港”。未知不能被合理地绘制出来，加勒比海不够精确，我选择不把香港和中国捆绑在一起，因为我希望看到mainland China单独的阻力分数。这些条目在res数据帧中标识，随后使用pandas drop方法删除。这可以在下面的结果数据帧中看到，特别是索引61和62处的行<em class="nv">现在</em>缺失。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/abcd0887590bddebb9ac5476df4dd9bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2w0VeMRolnOzxeiH8NZq3Q.png"/></div></div></figure><p id="cdaa" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh nd me mf ll ne mh mi lp nf mk ml mm im bi translated">现在需要更改国名，英国、坦桑尼亚和美国。这包括首先确认它们在geopandas数据帧gdf中的原始名称。我们可以在res数据帧中找到它们的原始名称，并使用pandas at方法轻松地更改它们。要使用这种方法，我们只需要与行相关的索引和列名。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/d8ddd11efa9835392e34725f0575e697.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*_itdn6kdlk5jtiG3V0ltyg.png"/></div></figure><h2 id="a52d" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">4.合并数据帧</h2><p id="5609" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">最后，我们只需要合并两个数据源，这样我们就有了一个包含每个国家的阻力分数和几何图形的数据框架。为此，我们从res数据框架中的国家中过滤geopandas数据框架。然后，我们可以将结果对象data与相似国家列上的res数据帧合并，现在我们有一个名为res_df的数据帧，其中包含阻力分数和几何信息。</p><p id="ed31" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh nd me mf ll ne mh mi lp nf mk ml mm im bi translated">我们可以在这里停下来，绘制res_df数据框架，但是最好包括所有国家，甚至那些没有记录监测数据的国家。</p><p id="1c3a" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh nd me mf ll ne mh mi lp nf mk ml mm im bi translated">为此，我们使用波浪符号并过滤geopandas数据框架gdf，以查找不在原始res数据框架中的国家。我们将这个新的数据帧标记为others，并将其指定为a列，其中阻力分数列为np.NaN。我们最后将res_df和others数据帧连接到公共对象res_geo中。下面的代码片段演示了这是如何实现的。</p><p id="6ec1" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh nd me mf ll ne mh mi lp nf mk ml mm im bi translated">注意:可以画np。在Geopandas对象上使用plot方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="76d8" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh nd me mf ll ne mh mi lp nf mk ml mm im bi translated">合并后的数据帧如下所示。然而，对象res_geo是一个pandas数据帧，需要转换为geopandas数据帧以便绘图。这可以通过实例化GeoDataFrame类的实例并将res_geo作为参数传递来实现。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/b34dd4c43cf50e23b05bc3595134c0a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*6FIYpRsBDJ8hlSqR2FBJjg.png"/></div></figure><h2 id="d015" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">5.测绘</h2><p id="a874" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">我们可以绘制地图，指定图形大小、我们要用于绘制数据的列、颜色映射以及国家之间的边缘颜色和宽度。这产生了一个需要进一步优化的拼凑的情节。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/df6802509687ddc76976f661a1efede5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oAqGHT_YoGOxrd7Dhcofjg.png"/></div></div></figure><p id="0e0a" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh nd me mf ll ne mh mi lp nf mk ml mm im bi translated">我们已经做了艰苦的工作，创建了资源地理数据库作为数据框架。通过一些小的修改，我们可以极大地改善映射，使其更具吸引力和可解释性。为了改善这一点，我们可以添加一个图例，一个更生动配色方案，包括没有监测数据的国家，并给它们贴上这样的标签，并提供一个合理的标题。</p><p id="2c4a" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh nd me mf ll ne mh mi lp nf mk ml mm im bi translated">这些变化显示为传递给方法图的参数。如果您对其他颜色映射选项感兴趣，Geopandas构建所基于的库matplotlib有大量颜色字符串可供选择。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/d20c92512e9781188e978577012c5930.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1TtMe3hbZtbvQEarbcBOKg.png"/></div></div></figure><h2 id="21c2" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">摘要</h2><p id="92d3" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">Geopandas是支持地理绘图的有用工具。对于本教程，我创建了一个conda虚拟环境，并按照安装说明<a class="ae ng" href="https://geopandas.org/getting_started.html" rel="noopener ugc nofollow" target="_blank">在这里</a>通过conda安装geopandas，并在Jupyter笔记本中进行在线绘图。如果你感兴趣，我已经创建了一个Jupyter笔记本，在我的<a class="ae ng" href="https://github.com/StephenFordham/Geopandas_mapping_tutorial" rel="noopener ugc nofollow" target="_blank"> GitHub页面</a>上详细描述了所有这些步骤，在那里也可以找到这两个数据集。虽然这里给出的例子是专门针对抗生素耐药性的，但概述的过程可以作为支持任何其他地理空间绘图的指南。</p></div></div>    
</body>
</html>