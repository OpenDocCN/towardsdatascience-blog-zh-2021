<html>
<head>
<title>Regression Modelling with TensorFlow Made Easy — Train Your First Model in 10 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用TensorFlow简化回归建模—在10分钟内训练您的第一个模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/regression-modelling-with-tensorflow-made-easy-train-your-first-model-in-10-minutes-497d829c7338?source=collection_archive---------7-----------------------#2021-10-05">https://towardsdatascience.com/regression-modelling-with-tensorflow-made-easy-train-your-first-model-in-10-minutes-497d829c7338?source=collection_archive---------7-----------------------#2021-10-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c0bb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从数据收集和准备到模型训练和评估—包括源代码。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/efd8c10f89c31127a518dc6181f19b42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-SPhptIV_WtVywj9ntL4vw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">克里斯蒂安·维利奇科夫在Unsplash<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">上拍摄的照片</a></p></figure><p id="e3a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如今，深度学习是一件大事。见鬼，这甚至是大多数数据科学工作的要求，甚至是入门级的工作。没有比回归更好的入门讲座了。您已经了解了基础统计学和机器学习的概念，现在是时候将神经网络融入其中了。</p><p id="5ac2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章将告诉你如何做。最终，你将拥有一个预测房价的全功能模型，你可以将它附加到你的投资组合中——在做了一些修改之后，这是你的首选。</p><p id="5804" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不想看书？请观看我的视频:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="2ad4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天的文章涵盖以下主题:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="6871" class="mc md it ly b gy me mf l mg mh"><strong class="ly iu">· </strong><a class="ae ky" href="#da81" rel="noopener ugc nofollow"><strong class="ly iu">Dataset used</strong></a><br/><strong class="ly iu">· </strong><a class="ae ky" href="#524c" rel="noopener ugc nofollow"><strong class="ly iu">Dataset exploration and preparation</strong></a><br/>  ∘ <a class="ae ky" href="#4dc7" rel="noopener ugc nofollow">Deleting unnecessary columns</a><br/>  ∘ <a class="ae ky" href="#455c" rel="noopener ugc nofollow">Feature engineering</a><br/>  ∘ <a class="ae ky" href="#4b17" rel="noopener ugc nofollow">Target variable visualization</a><br/>  ∘ <a class="ae ky" href="#4e53" rel="noopener ugc nofollow">Data preparation for ML</a><br/>· <a class="ae ky" href="#bc82" rel="noopener ugc nofollow"><strong class="ly iu">Training a regression model with TensorFlow</strong></a><br/>  ∘ <a class="ae ky" href="#8539" rel="noopener ugc nofollow">Loss tracking</a><br/>  ∘ <a class="ae ky" href="#61fb" rel="noopener ugc nofollow">Building a model</a><br/>  ∘ <a class="ae ky" href="#c0c7" rel="noopener ugc nofollow">Making predictions</a><br/>  ∘ <a class="ae ky" href="#684a" rel="noopener ugc nofollow">Model evaluation</a></span></pre><p id="0884" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在<a class="ae ky" href="https://github.com/better-data-science/TensorFlow" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上下载源代码。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="da81" class="mp md it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">使用的数据集</h1><p id="17f9" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">今天让我们把事情简单化，坚持使用一个众所周知的<a class="ae ky" href="https://www.kaggle.com/shree1992/housedata" rel="noopener ugc nofollow" target="_blank">房价数据集</a>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/fbb3e6f48d35b4abdc779f5ff180de77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YjjByccRcz9JOmyaYs-2Dg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片Kaggle的房价数据集(图片由作者提供)</p></figure><p id="03f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它有一堆最初无法用神经网络模型使用的特性，所以你必须花一些时间来处理它们。下载数据集，提取ZIP文件，并将CSV数据集放在安全的地方。</p><p id="a869" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后激活安装了TensorFlow 2+的虚拟环境，启动JupyterLab。您可以自由使用任何其他IDE，但下面所有的截图都将来自Jupyter。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="524c" class="mp md it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">数据集探索和准备</h1><p id="5068" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">第一步是导入Numpy和Pandas，然后导入数据集。下面的代码片段实现了这一点，并随机打印了几行:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="a1b9" class="mc md it ly b gy me mf l mg mh">import numpy as np<br/>import pandas as pd<br/><br/>df = pd.read_csv('data/data.csv')<br/>df.sample(5)</span></pre><p id="9be9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是数据集的外观:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/c0f75a0a8e0055b1bb087b4777c3ef89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-bnd2BDy5xWCBBZXu9_U_A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片2-房价数据集(图片由作者提供)</p></figure><p id="de89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你绝对不能以这种格式传递给神经网络。</p><h2 id="4dc7" class="mc md it bd mq nn no dn mu np nq dp my li nr ns na lm nt nu nc lq nv nw ne nx bi translated">删除不必要的列</h2><p id="0a5a" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">因为我们想避免花太多时间准备数据，所以最好去掉大部分非数字特征。只保留<code class="fe ny nz oa ly b">city</code>列，因为它很容易编码:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="5f4a" class="mc md it ly b gy me mf l mg mh">to_drop = ['date', 'street', 'statezip', 'country']<br/>df = df.drop(to_drop, axis=1)<br/><br/>df.head()</span></pre><p id="22ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/3d449e31c506abaddb66c856e35bbef4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lf26AdVHCbcOK7NJIflpDQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3-移除大部分字符串列后的数据集(作者提供的图片)</p></figure><p id="a961" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您肯定可以保留所有列，并对它们进行一些特性工程。这可能会提高模型的性能。但即使这样也足够满足你今天的需求了。</p><h2 id="455c" class="mc md it bd mq nn no dn mu np nq dp my li nr ns na lm nt nu nc lq nv nw ne nx bi translated">特征工程</h2><p id="827b" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">现在，您将花一些时间调整数据集。<code class="fe ny nz oa ly b">yr_renovated</code>列的值有时为0。我想那是因为房子没有翻新。您将创建几个要素-房屋年龄、房屋是否翻修过、是否在过去10年翻修过以及是否在过去30年翻修过。</p><p id="136a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以对每个提到的特性使用列表理解。方法如下:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="2a9f" class="mc md it ly b gy me mf l mg mh"><strong class="ly iu"># How old is the house?</strong><br/>df['house_age'] = [2021 - yr_built for yr_built in df['yr_built']]<br/><br/><strong class="ly iu"># Was the house renovated and was the renovation recent?</strong><br/>df['was_renovated'] = [1 if yr_renovated != 0 else 0 <br/>    for yr_renovated in df['yr_renovated']]<br/>df['was_renovated_10_yrs'] = [1 if (2021 - yr_renovated) &lt;= 10 <br/>    else 0 for yr_renovated in df['yr_renovated']]<br/>df['was_renovated_30_yrs'] = [1 if 10 &lt; (2021 - yr_renovated) &lt;= 30<br/>    else 0 for yr_renovated in df['yr_renovated']]<br/><br/><strong class="ly iu"># Drop original columns</strong><br/>df = df.drop(['yr_built', 'yr_renovated'], axis=1)<br/>df.head()</span></pre><p id="3f22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是数据集现在的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/2d0f5e4c2d26abc66226ffbdbf08e50a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xlU2JcYSslEi9Sl8EwxTvg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片4-特征工程后的数据集(1)(图片由作者提供)</p></figure><p id="e33d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来让我们处理<code class="fe ny nz oa ly b">city</code>列。许多城市只列出了几栋房子，因此您可以声明一个函数来删除所有不常出现的城市值。这就是<code class="fe ny nz oa ly b">remap_location()</code>函数要做的——如果那个城市的房子少于50栋，它会被其他的东西代替。这只是减少选项数量的一种方式:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="0838" class="mc md it ly b gy me mf l mg mh">def remap_location(data: pd.DataFrame, <br/>                   location: str, <br/>                   threshold: int = 50) -&gt; str:<br/>    if len(data[data['city'] == location]) &lt; threshold:<br/>        return 'Rare'<br/>    return location</span></pre><p id="3a9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来测试一下这个功能——<em class="od">西雅图</em>的城市有很多房子，而<em class="od">秋天的城市</em>只有11:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl oe"><img src="../Images/65e79bc5ae43c64328edda912a791a04.png" data-original-src="https://miro.medium.com/v2/format:webp/1*98QaQMZW9CkafHoMKPF8WQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图5-重新映射城市值(图片由作者提供)</p></figure><p id="d457" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将这个函数应用于所有城市，并打印一个10行的样本:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="2cab" class="mc md it ly b gy me mf l mg mh">df['city'] = df['city'].apply(<br/>    lambda x: remap_location(data=df, location=x)<br/>)<br/>df.sample(10)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/7238567f067e60662f8ca578e9e08f33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*njS22f9I-6mLDEUNx096_Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片6-特征工程后的数据集(2)(图片由作者提供)</p></figure><p id="fccd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一切看起来都是应该的，那我们继续吧。</p><h2 id="4b17" class="mc md it bd mq nn no dn mu np nq dp my li nr ns na lm nt nu nc lq nv nw ne nx bi translated">目标变量可视化</h2><p id="dc7b" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">每当你处理价格时，目标变量不太可能是正态分布的。这个住房数据集也不例外。让我们通过导入Matplotlib并用直方图可视化分布来验证它:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="9f06" class="mc md it ly b gy me mf l mg mh">import matplotlib.pyplot as plt<br/>from matplotlib import rcParams<br/>rcParams['figure.figsize'] = (16, 6)<br/>rcParams['axes.spines.top'] = False<br/>rcParams['axes.spines.right'] = False<br/><br/>plt.hist(df['price'], bins=100);</span></pre><p id="49a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它看起来是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/3a06df82080371a4f27a561dec9e0482.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aUtLCBkA1Kr5Hn-k57p7yw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图7 —目标变量直方图(1)(图片由作者提供)</p></figure><p id="7271" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">离群值肯定是存在的，所以接下来让我们来处理它们。最常见的事情是计算Z分数。它们让你知道一个值离平均值有多少标准差。在正态分布的情况下，任何低于或高于3个标准差的都被归类为异常值。价格的分布不是正态分布，但是我们仍然要做Z测试来移除最右边的房子。</p><p id="3358" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以用Scipy计算Z值。您将把它们指定为一个新的数据集列— <code class="fe ny nz oa ly b">price_z</code>，然后只保留Z的绝对值小于或等于3的行。</p><p id="7a1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有大约50栋价格为0美元的房子，所以你也要删除它们:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="30b5" class="mc md it ly b gy me mf l mg mh">from scipy import stats<br/><br/><strong class="ly iu"># Calculate Z-values</strong><br/>df['price_z'] = np.abs(stats.zscore(df['price']))<br/><br/><strong class="ly iu"># Filter out outliers</strong><br/>df = df[df['price_z'] &lt;= 3]<br/><br/><strong class="ly iu"># Remove houses listed for $0</strong><br/>df = df[df['price'] != 0]<br/><br/><strong class="ly iu"># Drop the column</strong><br/>df = df.drop('price_z', axis=1)<br/><br/><strong class="ly iu"># Draw a histogram</strong><br/>plt.hist(df['price'], bins=100);</span></pre><p id="9137" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是现在的分布情况:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/07327be991f4d6a42ca79833148e4269.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wb5xyaTDY25-y2FgIaOv2A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图8 —目标变量直方图(2)(图片由作者提供)</p></figure><p id="936a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仍然有一点倾斜，但是让我们宣布它<em class="od">足够好</em>。</p><p id="016a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为最后一步，让我们将数据转换成机器学习的格式。</p><h2 id="4e53" class="mc md it bd mq nn no dn mu np nq dp my li nr ns na lm nt nu nc lq nv nw ne nx bi translated">ML的数据准备</h2><p id="c966" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">神经网络喜欢只看到相同规模的数字数据。我们的数据集不是，我们也有一些非数字数据。这就是数据缩放和一次性编码发挥作用的地方。</p><p id="490c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您现在可以单独转换每个功能，但有一个更好的方法。您可以使用Scikit-Learn中的<code class="fe ny nz oa ly b">make_column_transformer()</code>函数来一次性应用缩放和编码。</p><p id="e311" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以忽略<code class="fe ny nz oa ly b">waterfront</code>、<code class="fe ny nz oa ly b">was_renovated</code>、<code class="fe ny nz oa ly b">was_renovated_10_yrs</code>和<code class="fe ny nz oa ly b">was_renovated_30_yrs</code>等特征，因为它们已经是您需要的格式:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="be0d" class="mc md it ly b gy me mf l mg mh">from sklearn.compose import make_column_transformer<br/>from sklearn.preprocessing import MinMaxScaler, OneHotEncoder<br/><br/>transformer = make_column_transformer(<br/>    (MinMaxScaler(), <br/>        ['sqft_living', 'sqft_lot','sqft_above', <br/>         'sqft_basement', 'house_age']),<br/>    (OneHotEncoder(handle_unknown='ignore'), <br/>        ['bedrooms', 'bathrooms', 'floors', <br/>         'view', 'condition'])<br/>)</span></pre><p id="8dde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们将特征从目标变量中分离出来，并将数据集分成训练和测试部分。训练集将占80%的数据，我们将使用其他所有数据进行测试:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="3fda" class="mc md it ly b gy me mf l mg mh">from sklearn.model_selection import train_test_split<br/><br/>X = df.drop('price', axis=1)<br/>y = df['price']<br/><br/>X_train, X_test, y_train, y_test = train_test_split(<br/>    X, y, test_size=0.2, random_state=42<br/>)</span></pre><p id="a38b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，你可以应用一分钟前声明的变换。您将调整和转换训练特征，并且仅将转换应用于测试集:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="12bb" class="mc md it ly b gy me mf l mg mh"><strong class="ly iu"># Fit</strong><br/>transformer.fit(X_train)<br/><br/><strong class="ly iu"># Apply the transformation</strong><br/>X_train = transformer.transform(X_train)<br/>X_test = transformer.transform(X_test)</span></pre><p id="d0ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将无法直接检查<code class="fe ny nz oa ly b">X_train</code>和<code class="fe ny nz oa ly b">X_test</code>，因为它们现在存储为稀疏矩阵:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl oe"><img src="../Images/9f6ce4d9663aad31337dc9ded5458739.png" data-original-src="https://miro.medium.com/v2/format:webp/1*a0ODUcsXnDzK56vtTxl_Vw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图9-稀疏矩阵(图片由作者提供)</p></figure><p id="fb19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">TensorFlow将无法读取该格式，因此您必须将其转换为多维Numpy数组。您可以使用<code class="fe ny nz oa ly b">toarray()</code>功能。这里有一个例子:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="6356" class="mc md it ly b gy me mf l mg mh">X_train.toarray()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl oe"><img src="../Images/7969451bd08fc20bc7b15e5cedbd1767.png" data-original-src="https://miro.medium.com/v2/format:webp/1*7r4Bo2aVMbxaHvJsH28bUw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图10-稀疏矩阵到Numpy数组(图片由作者提供)</p></figure><p id="c3a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将这两个特性集转换成一个Numpy数组，就可以开始了:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="7273" class="mc md it ly b gy me mf l mg mh">X_train = X_train.toarray()<br/>X_test = X_test.toarray()</span></pre><p id="4120" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后来训练模型。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="bc82" class="mp md it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">使用TensorFlow训练回归模型</h1><p id="9d1b" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">现在，您将构建一个由完全连接的层组成的顺序模型。有许多导入工作要做，所以让我们先把它解决掉:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="cf1b" class="mc md it ly b gy me mf l mg mh">import tensorflow as tf<br/>from tensorflow.keras import Sequential<br/>from tensorflow.keras.layers import Dense<br/>from tensorflow.keras.optimizers import Adam<br/>from tensorflow.keras import backend as K</span></pre><h2 id="8539" class="mc md it bd mq nn no dn mu np nq dp my li nr ns na lm nt nu nc lq nv nw ne nx bi translated">损失跟踪</h2><p id="5df9" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">你正在处理这里的房价，所以如果你跟踪它，比如说，均方差，损失可能会很大。这个指标对你来说也不是很有用，因为它基本上是告诉你你的模型在平方单位上有多错误。</p><p id="4f72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以计算MSE的平方根，回到原来的单位。默认情况下不支持该指标，但是我们可以手动声明它。请记住，您必须使用Keras后端的函数才能使它工作:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="8ab5" class="mc md it ly b gy me mf l mg mh">def rmse(y_true, y_pred):<br/>    return K.sqrt(K.mean(K.square(y_pred - y_true)))</span></pre><h2 id="61fb" class="mc md it bd mq nn no dn mu np nq dp my li nr ns na lm nt nu nc lq nv nw ne nx bi translated">建立模型</h2><p id="7c0f" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">现在你终于可以声明一个模型了。这将是一个简单的，只有256，256和128个单位的三个隐藏层。请随意尝试这些，因为建立神经网络没有对错之分。这些层之后是一个节点的输出层，因为您预测的是一个数值。</p><p id="b1e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您将使用RMSE编译一个模型，作为一种跟踪损失和评估指标的方法，并使用Adam优化器优化该模型。</p><p id="f38d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，您将根据100个时期的训练数据训练模型:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="5fa7" class="mc md it ly b gy me mf l mg mh">tf.random.set_seed(42)<br/><br/>model = Sequential([<br/>    Dense(256, activation='relu'),<br/>    Dense(256, activation='relu'),<br/>    Dense(128, activation='relu'),<br/>    Dense(1)<br/>])<br/><br/>model.compile(<br/>    loss=rmse,<br/>    optimizer=Adam(),<br/>    metrics=[rmse]<br/>)<br/><br/>model.fit(X_train, y_train, epochs=100)</span></pre><p id="3d7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">培训应该在一分钟左右完成，具体取决于硬件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/46ce66eaa0742bbd14869a56f4f50b3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rXYTKRv9zgRs4Da8n3SoTA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图11 —使用TensorFlow进行回归模型训练(图片由作者提供)</p></figure><p id="466c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">训练集的最终RMSE值刚刚超过192000，这意味着对于一个普通的房子，该模型的价格估计错误192000美元。</p><h2 id="c0c7" class="mc md it bd mq nn no dn mu np nq dp my li nr ns na lm nt nu nc lq nv nw ne nx bi translated">做预测</h2><p id="930f" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">您可以对测试集进行预测:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="026e" class="mc md it ly b gy me mf l mg mh">predictions = model.predict(X_test)<br/>predictions[:5]</span></pre><p id="b468" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是前五个预测的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl oe"><img src="../Images/6cd055c489dbd6e23153bdedf85cbe29.png" data-original-src="https://miro.medium.com/v2/format:webp/1*-RLjCB7S-Y9oRduHFTUmDQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片12 —前5个预测(图片由作者提供)</p></figure><p id="0c1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想计算任何指标，你必须把它们转换成一维数组。您可以使用Numpy的<code class="fe ny nz oa ly b">ravel()</code>函数来实现:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="1ed9" class="mc md it ly b gy me mf l mg mh">predictions = np.ravel(predictions)<br/>predictions[:5]</span></pre><p id="9e71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl oe"><img src="../Images/0b09be1a46804d29844d3db7d5c4a8bb.png" data-original-src="https://miro.medium.com/v2/format:webp/1*NgZDJaIIDgwFd93GxaXwHA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图13-作为1D数组的前5个预测(图片由作者提供)</p></figure><h2 id="684a" class="mc md it bd mq nn no dn mu np nq dp my li nr ns na lm nt nu nc lq nv nw ne nx bi translated">模型评估</h2><p id="dfe2" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">现在让我们通过使用RMSE来评估测试集上的预测:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="8885" class="mc md it ly b gy me mf l mg mh">rmse(y_test, predictions).numpy()</span></pre><p id="2566" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将得到191000作为错误值，这表明模型没有过度拟合训练数据。对于更多的时期，使用更复杂的模型训练可能会得到更好的结果。这是你可以自己尝试的事情。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="df9a" class="mp md it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">离别赠言</h1><p id="18d1" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">这就做到了——到目前为止，您已经训练了一个简单的神经网络模型，并且知道如何对新数据进行预测。不过，你还有很多可以改进的地方。</p><p id="c6c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，你可以花更多的时间准备数据。我们删除了日期-时间特性、街道信息、邮政编码等等，这些对模型性能可能很有价值。问题是——这些需要太多的时间来准备，我想让这些文章简短一些。</p><p id="b8d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以向网络添加额外的层，增加神经元的数量，选择不同的激活函数，选择不同的优化器，添加丢弃层，等等。可能性几乎是无穷无尽的，所以一切都归结于实验。</p><p id="7e66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一篇文章将介绍如何使用TensorFlow建立分类模型，如果您想了解更多信息，请继续关注。</p><p id="ced2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="1676" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="od">喜欢这篇文章吗？成为</em> <a class="ae ky" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="od">中等会员</em> </a> <em class="od">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="oj ok gp gr ol om"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">通过我的推荐链接加入Medium-Dario rade ci</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">medium.com</p></div></div><div class="ov l"><div class="ow l ox oy oz ov pa ks om"/></div></div></a></div></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="653b" class="mp md it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">保持联系</h1><ul class=""><li id="1a28" class="pb pc it lb b lc ng lf nh li pd lm pe lq pf lu pg ph pi pj bi translated">注册我的<a class="ae ky" href="https://mailchi.mp/46a3d2989d9b/bdssubscribe" rel="noopener ugc nofollow" target="_blank">简讯</a></li><li id="46e7" class="pb pc it lb b lc pk lf pl li pm lm pn lq po lu pg ph pi pj bi translated">订阅<a class="ae ky" href="https://www.youtube.com/c/BetterDataScience" rel="noopener ugc nofollow" target="_blank"> YouTube </a></li><li id="94ac" class="pb pc it lb b lc pk lf pl li pm lm pn lq po lu pg ph pi pj bi translated">在<a class="ae ky" href="https://www.linkedin.com/in/darioradecic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上连接</li></ul></div></div>    
</body>
</html>