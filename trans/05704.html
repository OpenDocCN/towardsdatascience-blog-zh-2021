<html>
<head>
<title>How to Do Sentiment Analysis with Augmented Data Using Transformers and Transfer Learning — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用转换器和迁移学习对扩充数据进行情感分析——第2部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-do-sentiment-analysis-with-augmented-data-using-transformers-transfer-learning-part-2-70fbf70a6137?source=collection_archive---------21-----------------------#2021-05-21">https://towardsdatascience.com/how-to-do-sentiment-analysis-with-augmented-data-using-transformers-transfer-learning-part-2-70fbf70a6137?source=collection_archive---------21-----------------------#2021-05-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="90fc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">关于如何执行NLP的两部分系列的最后一部分——用很少或没有标记的数据进行情感分析。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e87135222216fe39604dca092487b018.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T6pED4e4Do-IZyDV"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">伊莱恩·卡萨普在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="bc92" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是无可争议的。我们生活在一个数据的世界里。自从互联网普及以来，数据呈指数级增长，根据福布斯的数据，世界上90%的数据是在2016年至2018年之间产生的，这意味着，从人类历史的黎明到2016年，所有之前产生的数据只占据了另外10%的份额。今天，这个数字少了很多。</p><p id="23e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我相信数据是知识的燃料。今天数据无处不在。</p><p id="1fb5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，挑战在于理解它。每天有近50亿个YouTube视频被观看，每天有5亿条推文在Twitter上发布。随着社交媒体平台和在线新闻网站的兴起，获取事实、想法、观点和错误信息比以往任何时候都更容易。然而有一个阻碍，那里的数据是杂乱的，非结构化的，有时甚至是完全错误的。我们如何以一种有意义的方式利用这些信息的力量？在这篇文章中，我们将看看一种方法做到这一点。</p><p id="69e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<a class="ae kv" href="https://medium.com/p/87a838cd0baa" rel="noopener">上一节</a>中，我们对一小部分金融文章进行了数据扩充。这产生了一个新的数据集，它比原来的源大50多倍，大到足以继续我们的下一步工作:<strong class="ky ir">情感分析</strong>。</p><p id="b501" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">情感分析是<em class="ls">自然语言处理</em> ( <strong class="ky ir"> <em class="ls"> NLP </em> </strong>)的一种形式，它识别和量化文本数据情感状态以及其中的主题、人物和实体的主观信息。传统上使用诸如朴素贝叶斯或支持向量机的算法来执行。这在历史上也是一项受监督的任务，使用标记的数据集来训练算法，需要人工仔细选择、分类和标记的大型数据集。</p><p id="7190" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">今天，共识是明确的，深度学习方法在大多数NLP任务上比其他方法实现了更好的准确性。现在，NLP中无可争议的王者是被称为变形金刚的大型预训练模型。他们的体系结构旨在解决序列到序列的任务，同时处理长范围的输入和输出依赖，并注意重复。</p><p id="00f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">变形金刚的特别之处不仅在于大多数变形金刚都经过了大量数据的训练，并且经过了高度优化，即使在使用现成的变形金刚时也非常有用，还在于它们可以很容易地进行微调，即使在很少或没有数据的情况下也能表现出色。</p><p id="ed41" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">精细</strong> - <strong class="ky ir">深度学习中的调整</strong>涉及使用先前模型的权重来训练另一个类似的<strong class="ky ir">深度学习</strong>过程，以实现期望的输出或增强目标任务的性能。在这个练习中，我选择了来自Transformers或简单的<strong class="ky ir"> BERT的模型双向编码器表示。</strong></p><p id="672f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> Bert </strong>是一个“双向”半监督模型。这意味着BERT在训练阶段从令牌上下文(小文本单元)的左侧和右侧学习信息，并使用从具有8亿单词的'<a class="ae kv" href="https://en.wikipedia.org/w/index.php?title=BooksCorpus&amp;action=edit&amp;redlink=1" rel="noopener ugc nofollow" target="_blank">图书语料库</a>和具有2500万单词的<a class="ae kv" href="https://en.wikipedia.org/wiki/English_Wikipedia" rel="noopener ugc nofollow" target="_blank">英语维基百科</a>中提取的未标记数据对其进行预训练。Bert通过预测屏蔽词来工作，特别是通过引导和跟随单词的特定短语的词。</p><p id="8137" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我喜欢做的第一件事是将我的超参数设置为常量，这将使我的工作容易得多，因为我需要对代码进行的所有更改都在一个地方。</p><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="7925" class="ly lz iq lu b gy ma mb l mc md">MODEL_NAME = 'bert-based-cased'<br/>BATCH_SIZE = 125<br/>LR = 1e-4<br/>MAX_LEN = 100<br/>EPOCHS = 10<br/>LABEL_NUM = 2<br/>device = 'cuda'  # use gpu if no graphics card found</span></pre><p id="7512" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里的超参数定义为:</p><ul class=""><li id="6afc" class="me mf iq ky b kz la lc ld lf mg lj mh ln mi lr mj mk ml mm bi translated">' MODEL_NAME' —这是Transformers用来下载我们将使用的模型的参数</li><li id="e1f9" class="me mf iq ky b kz mn lc mo lf mp lj mq ln mr lr mj mk ml mm bi translated">‘BATCH _ SIZE’—是将通过网络传播的样本数</li><li id="f06e" class="me mf iq ky b kz mn lc mo lf mp lj mq ln mr lr mj mk ml mm bi translated">LR——控制模型学习的速度</li><li id="1568" class="me mf iq ky b kz mn lc mo lf mp lj mq ln mr lr mj mk ml mm bi translated">' MAX_LEN' —是我们将输入模型的序列的最大长度。</li><li id="4aff" class="me mf iq ky b kz mn lc mo lf mp lj mq ln mr lr mj mk ml mm bi translated">“时期”—是模型将通过数据集的周期数</li><li id="f1b8" class="me mf iq ky b kz mn lc mo lf mp lj mq ln mr lr mj mk ml mm bi translated">‘LABEL _ NUM’—我们正在寻找的类的数量</li><li id="2201" class="me mf iq ky b kz mn lc mo lf mp lj mq ln mr lr mj mk ml mm bi translated">‘设备’—如果您可以访问图形卡，请使用‘cuda ’,否则请使用‘GPU’</li></ul><p id="a0cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们训练模型之前，我们需要做一些内务处理工作。首先，我们将在数据中对标记的类进行编码，然后将数据分成训练、测试和验证部分。训练和验证将用于训练和监控我们的模型，而测试将用于衡量模型完成训练后的预测性能。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="8444" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">大多数标记器对于一个模型是唯一的，当试图在Bert上执行强化学习时，我们必须使用它自己的标记器，明显地命名为<strong class="ky ir">bertokenizer。</strong></p><p id="f25c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，标记化的数据被打包到所谓的<strong class="ky ir">数据加载器</strong>中。DataLoader是一个可迭代的容器，用于批量向模型提供数据。训练和验证数据都需要在数据加载器中，以便模型能够高效地学习和验证自身。为了构造它们，我构建了一个助手函数，它将接受一个数据输入并返回一个DataLoader容器。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="fe71" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦构建了数据加载器，我们就可以继续训练模型了。对于我们的优化器，我们选择Adam，每个时期的步骤数将通过数据加载器中的元素数乘以时期数来计算。</p><p id="b80e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将添加一个调度器，每当一个批处理被提供给模型时，这个调度器就会被调用。我们还通过使用PyTorch的<em class="ls">‘nn . utils . clip _ grad _ norm’将渐变从模型中裁剪掉，避免了渐变爆炸(当许多渐变连接成一个矢量时)。</em></p><p id="dfdc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在每次迭代中，模型将从我们的数据中学习并计算其损失分数，如果一切正确，损失分数将继续降低，直到模型训练完成。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="7af1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随后，我们将编写代码的验证部分。一旦完成，它将返回每个数据加载器批次的平均损失、预测和数据的真实值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="5719" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用预测值和实际值来计算F1分数。F1将精确度和召回率结合起来，得出给定数据集上的模型精确度。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="25eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来我们将训练两个模型。一个使用原始数据，另一个使用本系列第一部分创建的扩充数据集。我们将计算它们各自的准确性和F1分数，最后根据看不见的数据测试这两个模型，看看它们的表现如何。</p><p id="7bb7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在小型/原始数据源上训练的模型的结果如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mu"><img src="../Images/f3994e93dbd5744da74e2ccc4a37d13c.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*a-xC7wjzS62AjNXRxDLxrw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">根据原始数据训练的模型的输出</p></figure><p id="ac7c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到第三个时期，我们的训练或验证损失都没有低于0.6。这个糟糕的分数告诉我们，该模型没有足够的数据来学习和归纳。F1分数没有达到0.5，并且差的准确性反映在模型不能准确预测几乎所有的新样本上。</p><p id="6b20" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，在扩充数据集上训练的模型的结果描绘了更好的画面:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/0fe70844c925197bd3a01c0e0c18be5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*j4lvby8u7eVdPFoQ7Ae_Ew.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">根据扩充数据训练的模型的输出</p></figure><p id="8339" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到最后一个时期，我们的训练和验证损失都很低，彼此非常接近。F1得分达到0.99，准确性得分也是如此。然后，该模型被用于预测来自看不见的文章的值，并且能够在99%的时间内正确预测实际情绪。</p><p id="2fa9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如您所看到的，在扩充数据集上训练的模型非常适合识别我们的测试数据，因此我们可以得出结论，它已经被调整得足够好，可以对金融数据进行良好的情感分析。</p><h2 id="4d76" class="ly lz iq bd mv mw mx dn my mz na dp nb lf nc nd ne lj nf ng nh ln ni nj nk nl bi translated">结论:</h2><p id="434a" class="pw-post-body-paragraph kw kx iq ky b kz nm jr lb lc nn ju le lf no lh li lj np ll lm ln nq lp lq lr ij bi translated">在这个由两部分组成的系列文章中，我们介绍了在缺乏大量标签数据的情况下，使用transformers进行数据扩充和强化学习如何帮助我们创建最先进的分类模型。</p><p id="56c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你错过了它，并且你是一个好奇的人，想知道如何从头开始做数据扩充，点击<a class="ae kv" href="https://medium.com/p/87a838cd0baa/edit" rel="noopener">这里</a>跳到这个系列的第一部分:<a class="ae kv" href="https://medium.com/p/87a838cd0baa/edit" rel="noopener"> <em class="ls">使用变形金刚&amp;同义词替换情感分析</em> </a>扩充你的小数据集</p><h2 id="2d26" class="ly lz iq bd mv mw mx dn my mz na dp nb lf nc nd ne lj nf ng nh ln ni nj nk nl bi translated">来源:</h2><ul class=""><li id="db53" class="me mf iq ky b kz nm lc nn lf nr lj ns ln nt lr mj mk ml mm bi translated">福布斯:<a class="ae kv" href="https://www.forbes.com/sites/bernardmarr/2018/05/21/how-much-data-do-we-create-every-day-the-mind-blowing-stats-everyone-should-read/?sh=48e5381860ba" rel="noopener ugc nofollow" target="_blank">我们每天创造多少数据？每个人都应该阅读的令人兴奋的统计数据</a></li><li id="0d5c" class="me mf iq ky b kz mn lc mo lf mp lj mq ln mr lr mj mk ml mm bi translated">SeedScientific: <a class="ae kv" href="https://seedscientific.com/how-much-data-is-created-every-day/" rel="noopener ugc nofollow" target="_blank">每天产生多少数据？27惊人的统计数据</a></li><li id="97a7" class="me mf iq ky b kz mn lc mo lf mp lj mq ln mr lr mj mk ml mm bi translated">我的回购:<a class="ae kv" href="https://github.com/cmazzoni87/SentimentAnalysis" rel="noopener ugc nofollow" target="_blank">https://github.com/cmazzoni87/ComputerVisionRegression</a></li><li id="c85d" class="me mf iq ky b kz mn lc mo lf mp lj mq ln mr lr mj mk ml mm bi translated">伯特变形金刚文档:<a class="ae kv" href="https://huggingface.co/transformers/model_doc/bert.html" rel="noopener ugc nofollow" target="_blank">https://huggingface.co/transformers/model_doc/bert.html</a></li></ul></div></div>    
</body>
</html>