<html>
<head>
<title>Predicting Singapore HDB Resale Price: Data Preparation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测新加坡HDB转售价格:数据准备</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-singapore-hdb-resale-price-data-preparation-be39152b8c69?source=collection_archive---------27-----------------------#2021-08-01">https://towardsdatascience.com/predicting-singapore-hdb-resale-price-data-preparation-be39152b8c69?source=collection_archive---------27-----------------------#2021-08-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="259b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何通过必要的特征工程工作来操纵数据集，以便为进一步的分析和建模做准备</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5bbfdb2a205c8494d98d97d9542b1609.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*32jwfrcNhRyrxB6JwohqPw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/s/photos/hdb?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@minimxlist_?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Muhd Asyraaf </a>拍摄</p></figure><p id="4c22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在新加坡，对于即将成家立业的年轻上班族来说，当他们的预算有限时，HDB(新加坡公共住房)将是他们的首选。然而，对于那些正在考虑选择哪套HDB公寓的人来说，这可能会成为一个真正令人头疼的问题:城镇地区、附近的设施(如学校、购物中心)、公寓类型等。为了让人们在面临如此重大的选择时更轻松，我决定对新加坡HDB转售价格进行研究，探索影响HDB转售价格的关键因素，并为打算在不久的将来购买HDB的人提供一些建议。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="eb0b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">了解数据集</h1><p id="73a7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">可以从data.gov.sg的<a class="ae ky" href="https://data.gov.sg/dataset/resale-flat-prices" rel="noopener ugc nofollow" target="_blank">检索到HDB的转售数据。以下是原始数据集中可用列的示例:</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/c51efa13c14a2e547f4a4bda43210ac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nojo-B9YnibG-rcA8kvHtQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自HDB转售价格数据集的样本数据(图片由作者提供)</p></figure><p id="4f40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是我第一次看这些专栏时的一些第一印象:</p><p id="173f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">月</strong>:以年月的格式给出。我们可以从这一栏中检索年数据，这在分析HDB转售价格的时间趋势时可能是有用的。</p><p id="8a03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">城镇</strong>:城镇位置应该是影响HDB转售价格的关键因素之一——我们通常认为，在相同户型的情况下，HDB果园公寓的转售价格要比怡顺公寓高得多。</p><p id="b282" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">户型</strong>:有7种不同的户型:1室、2室、3室、4室、5室、EC、多代。其中四房HDB公寓是新加坡最受欢迎的公寓。我们可以考虑使用4个房间数据样本来构建模型。</p><p id="01b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">楼层范围</strong>:该列以字符串而非数字的形式给出，如果我们想用它来建立模型，可能需要做一些相应的数据处理。</p><p id="eae1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">平板模型</strong>:同样，也有大量不同的平板模型(35种不同类型)。这一因素将在整体统一价格中发挥重要作用。例如，DBSS(设计、建造和销售方案)公寓会有更高的转售价格，因为它允许买家根据自己的风格设计HDB。</p><p id="3b7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">剩余租期:新加坡HDB租期99年。此列数据有相当多的空值，并且是根据不同的年份计算的。在构建模型时，我们可能需要相应地调整该列数据。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="34dd" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">特征工程</h1><p id="ca02" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在对数据集有了一些粗略的想法后，我们可能会开始进行数据争论。以下是我为预处理相应的数据列所做的一些特征工程工作:</p><p id="7e78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">城镇:</strong>为了使用这个数据列作为回归模型的输入，我已经按城镇聚集了数据集，并采用每个城镇的中间转售价格来减去总的中间转售价格。结果(“town_premium”列)可以解释为当他们选择这个位置时需要额外支付的金额。例如，在武吉梅拉赫购买HDB公寓平均需要多付12.8万英镑，而如果选择武吉潘江地区的HDB公寓，则可以少付5.6万英镑。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/7019bc123605c5e2c280e7df04a794fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ipg9EOQ6jdVSJTwIGQgEuA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">预处理“城镇”列(图片由作者提供)</p></figure><p id="b4e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> Flat_Model </strong>:对“Flat_Model”栏也做了类似的预处理。如前所述，我们确实看到DBSS HDB公寓的转售价格高于平均水平，人们可能需要为这种类型的公寓平均支付约35K。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/194d2ed3060bfc09aee66b17487860d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WT4-vedKpaa4Ax-WuKG0yA.png"/></div></div></figure><p id="ebdd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我只是简单地从给定字符串中的两个数字中取平均值。例如，对于“04到06”的范围，我将只指定楼层为5。这应该是一个足够好的近似值，因为对于每个类别来说，楼层范围跨度并不是真的更大(3或5层的差异)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/aa9c4ef2208d8182dbcd56a3bea65ca4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u1dqvWQu-4WWRo6HCdT7Ew.png"/></div></div></figure><p id="b758" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">剩余租赁</strong>:原始剩余租赁列包含空值，根据取数日期的年份不同，引用到不同的年份。我用以下公式重新计算了转售日的剩余租赁价值:</p><p id="724f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">公式</strong>:remain _ lease = lease _ start _ date+99–转售_年</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7e48" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">我们能从“街道名”中得到什么？</h1><p id="01c4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在，我们已经预处理了原始数据集中的大多数列。看起来都不错……等等，“街道名称”一栏怎么样？</p><p id="8e41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如前所述，这一栏实际上显示了每个HDB公寓的地理位置数据。这实际上是HDB转售价格的一个关键因素，因为它会表明HDB是否靠近任何捷运站，或者附近是否有任何购物中心。根据我在HDB租房的经验，这个信息应该很重要，我相信它也适用于HDB的转售价格。</p><p id="bf6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以尝试使用GoogleMap或其他可用的地图API来提取不同街道名称、捷运站和主要购物中心的经度和纬度。然后我们可以获得从这些街道名称到最近的捷运和购物中心的相对距离，作为转售价格预测的指标。</p><p id="6f7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在做了一些研究后，我注意到<a class="ae ky" href="https://docs.onemap.sg/" rel="noopener ugc nofollow" target="_blank"> Onemap.sg </a>提供了一个API，使用户能够方便地查询给定特定地址的经度和纬度。我编写了一个简单的python脚本来使用一个地图API查询位置信息。</p><p id="e5e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以做同样的事情来检索新加坡捷运/购物中心的经度/纬度信息。新加坡捷运站列表可在<a class="ae ky" href="https://en.wikipedia.org/wiki/List_of_Singapore_MRT_stations" rel="noopener ugc nofollow" target="_blank">这里</a>找到，新加坡主要商场列表可从<a class="ae ky" href="https://en.wikipedia.org/wiki/List_of_shopping_malls_in_Singapore" rel="noopener ugc nofollow" target="_blank">这里</a>提取。</p><p id="dacb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要获取的另一条信息是，给定街道名称，哪一个是最近的购物中心/捷运站。我们可以用for循环来计算街道名称与每个购物中心/MRT的相对距离，然后相应地获得最小距离目标。附上示例代码以供参考:</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="ebcf" class="ni md it ne b gy nj nk l nl nm"><em class="nn">##Sample Script to obtain the closest shopping mall name given street name</em></span><span id="22cf" class="ni md it ne b gy no nk l nl nm">import openpyxl<br/>import numpy as np</span><span id="43d3" class="ni md it ne b gy no nk l nl nm">def calculate_distance(x,y):<br/>    return np.sqrt(((x[0]-y[0])*110.574)**2 + ((x[1]-y[1])*111.32)**2)</span><span id="5833" class="ni md it ne b gy no nk l nl nm">wb = openpyxl.load_workbook('Street_Name_List.xlsx')<br/>wb2 = openpyxl.load_workbook('Shopping_Mall_List.xlsx')<br/>sheet = wb['Sheet1']<br/>sheet2 = wb2['Sheet1']<br/>for row in range (2, sheet.max_row +1):<br/>   Distance = 200<br/>   MRT = 0<br/>   if sheet['B'+str(row)].value is not None:<br/>      for k in range (2, sheet2.max_row + 1):<br/>         x1 = sheet['B'+str(row)].value<br/>         x2 = float(sheet2['B'+str(k)].value)<br/>         y1 = sheet['C'+str(row)].value<br/>         y2 = float(sheet2['C'+str(k)].value)<br/>         #print (type(x1),type(x2),y1,y2)<br/>         Dis_Temp = calculate_distance([x1,y1],[x2,y2])<br/>         if Dis_Temp &lt; Distance:<br/>            Distance = Dis_Temp<br/>            MRT = k<br/>         else:<br/>            continue<br/>   else:<br/>      continue<br/>   print(MRT)<br/>   print(sheet2['A'+str(MRT)].value)<br/>   sheet['F'+str(row)].value = sheet2['A'+str(MRT)].value</span><span id="64c9" class="ni md it ne b gy no nk l nl nm">wb.save('Street_Name_List.xlsx')<br/>print('Job Done.')</span></pre><p id="38c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您一直这样做，现在您应该已经获得了数据集中每个街道名称的封闭MRT/购物中心名称。有了从API查询的所有经度/纬度数据，我们可以很容易地计算出从每条街道到最近的捷运/购物中心的相对距离。为了便于可视化，我将相对距离(公里)转换为从相应街道步行所需的时间(分钟)(1分钟步行被映射为平均80米的距离)。</p><p id="98af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我能想到的另一个有趣的指标是从最近的捷运站到中央商务区的公共交通出行时间(例如，莱佛士广场捷运站)。这可能是年轻的工作成年人使用捷运作为主要交通工具的一个重要指标，因为在新加坡买车并不是每个人都能负担得起的。</p><p id="858b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用OneMap API路由服务来查询公共交通的行驶时间，而不是根据我们自己的估计来计算时间。关于API使用的更多细节可以在<a class="ae ky" href="https://docs.onemap.sg/#route" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="d79a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过上面提到的所有特征工程工作，我们最终获得了具有以下期望特征的数据集:</p><p id="fed4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(注:步行时间到捷运，步行时间到购物中心和旅行时间到来福士都是以分钟为单位。town_premium和flat_model_premium均以新加坡元为单位)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/414468fcb5a610331d5bf0789367abc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YUoptjf0DqUbGQweqijWGw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用于转售价格预测模型的最终数据集(图片由作者提供)</p></figure><p id="231c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们继续建模之前，我们将首先探索更多关于数据集的内容，并从中发现一些有趣的模式。这将在下一篇文章中讨论(见下文)。感谢阅读！</p><div class="nq nr gp gr ns nt"><a href="https://medium.com/@tianjie1112/predicting-singapore-hdb-resale-price-eda-and-modeling-94af7d26798d" rel="noopener follow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd iu gy z fp ny fr fs nz fu fw is bi translated">预测新加坡HDB转售价格:EDA和建模</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">进行EDA并尝试不同的ML模型来预测转售价格</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">medium.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh ks nt"/></div></div></a></div></div></div>    
</body>
</html>