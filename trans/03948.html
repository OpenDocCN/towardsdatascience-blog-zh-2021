<html>
<head>
<title>Understanding One Way ANOVA</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解单因素方差分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/understanding-one-way-anova-df44f02922fe?source=collection_archive---------23-----------------------#2021-04-02">https://towardsdatascience.com/understanding-one-way-anova-df44f02922fe?source=collection_archive---------23-----------------------#2021-04-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/747b762c89b15136e48d0ed22e24edb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sWyJQAWWkX3KDcvS"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">由<a class="ae jg" href="https://unsplash.com/@kmuza?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卡洛斯·穆扎</a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><div class=""/><div class=""><h2 id="2fb0" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">理解差异驱动因素的真正有用的工具</h2></div><p id="c460" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi lu translated">今天，我们将在Excel中进行一些数据科学研究！是的，与一些人的想法相反，在Excel中进行合理的分析是可能的。</p><p id="b991" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Sure statsmodels也有一个ANOVA(方差分析)库，但我第一次在Excel中看到它是在很多年前，当时就想“这是什么？”。</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div class="gh gi md"><img src="../Images/513142eac87b51bc2473d918f28a6b2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*kNeIAPCgyV7iOGr-NwNRHw.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">Excel方差分析(来源:微软)</p></figure><p id="0785" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">方差分析是比较因素和分解方差的非常有用的工具。它与聚类也有很多相似之处。让我们进入我们的例子。</p><h1 id="ef7a" class="mi mj jj bd mk ml mm mn mo mp mq mr ms kp mt kq mu ks mv kt mw kv mx kw my mz bi translated">财务数据的方差分析示例</h1><p id="c020" class="pw-post-body-paragraph ky kz jj la b lb na kk ld le nb kn lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">这里有一些标签命名的数据，你可以复制并直接粘贴到Excel中。它是能源股每个季度的月度回报——假设我们有一个假设，即季节性是能源股回报的一个重要决定因素。</p><p id="48a8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="nf">(需要以这种方式组织，以便正确运行ANOVA分析。)</em></p><pre class="me mf mg mh gt ng nh ni nj aw nk bi"><span id="ba2d" class="nl mj jj nh b gy nm nn l no np">Spring   Summer   Fall   Winter       <br/>2.13%   4.40%   -6.20%   -5.35%       <br/>4.94%   -2.90%   -4.45%   4.93%       <br/>1.33%   2.74%   -7.73%   -1.12%       <br/>-2.50%   -3.80%   -7.09%   -2.70%       <br/>7.67%   -5.41%   10.32%   4.91%       <br/>-4.62%   -5.35%   -0.31%   -8.38%       <br/>7.44%   4.95%   2.76%   -2.09%       <br/>7.36%   -1.38%   0.21%   -0.31%       <br/>-1.66%   1.18%   5.21%   3.84%</span></pre><p id="64d8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将使用Excel的数据分析工具对其进行方差分析(如上图所示)。请耐心听我说一会儿——我马上会解释什么是方差分析。举个例子就简单多了。</p><p id="c494" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">输出如下所示:</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/e091f54b75c4275ba92c9270301d5c07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*NkTq3rtN33a4VoInFeIpRw.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">方差分析输出(来源:作者)</p></figure><p id="a883" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">汇总表非常简单。它只提供基本的汇总统计数据，例如每个变量的平均值和方差。有趣的是，我们可以看到，在分析期间，能源股的平均回报率仅在春季(我定义为3月、4月、5月)为正，而能源股在秋季表现出最大的波动性。</p><p id="d52b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第二个表格是ANOVA，是行动所在的地方。SS代表平方和。一旦你花了一些时间在统计上，你就会意识到这一切都与方差有关——测量它，解释它，分解它。在统计领域，方差是对不确定性的估计；所以统计学家和数据科学家总是试图建模和解释它。</p><pre class="me mf mg mh gt ng nh ni nj aw nk bi"><span id="a584" class="nl mj jj nh b gy nm nn l no np">The equation for variance is:</span><span id="8943" class="nl mj jj nh b gy nr nn l no np"><strong class="nh jk">Sample Variance = sum(Xi - mean(X))^2/(n-1)</strong></span></pre><p id="6a04" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">分子<code class="fe ns nt nu nh b">sum(Xi — mean(X))^2</code>就是我们所说的离差平方和或简称平方和(SS)。它只是每个观察值和平均值之间的平方差之和。例如，要计算能源股回报的总SS(不按季节分时段)，我们将:</p><ol class=""><li id="1c50" class="nv nw jj la b lb lc le lf lh nx ll ny lp nz lt oa ob oc od bi translated">计算能源指数的月平均回报。</li><li id="3471" class="nv nw jj la b lb oe le of lh og ll oh lp oi lt oa ob oc od bi translated">取我们刚刚计算的平均值，从能源指数的每个月收益中减去它。</li><li id="6e4c" class="nv nw jj la b lb oe le of lh og ll oh lp oi lt oa ob oc od bi translated">对步骤2中的每个值求平方。</li><li id="0dc9" class="nv nw jj la b lb oe le of lh og ll oh lp oi lt oa ob oc od bi translated">将步骤3中的所有值相加。</li></ol><h2 id="1577" class="nl mj jj bd mk oj ok dn mo ol om dp ms lh on oo mu ll op oq mw lp or os my ot bi translated">那又怎样？</h2><p id="31fe" class="pw-post-body-paragraph ky kz jj la b lb na kk ld le nb kn lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">因为离差平方和(在本文中我称之为SS)是方差方程中的分子，它与方差高度相关。保持观察次数不变，SS越高，变量的方差越高。</p><h2 id="165f" class="nl mj jj bd mk oj ok dn mo ol om dp ms lh on oo mu ll op oq mw lp or os my ot bi translated">现在让我们回到方差分析</h2><p id="7df6" class="pw-post-body-paragraph ky kz jj la b lb na kk ld le nb kn lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">ANOVA为什么叫方差分析？这是因为方差分析是一个试图将方差分解为其来源的过程。</p><p id="f967" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">记得我们从一个假设开始——什么季节对能源股的表现有影响。让我们想想如何测试这一点。</p><p id="7719" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">如果季节很重要，我们会期望数据看起来像什么？</strong>一旦我们按季节将数据分类成桶，我们预计每个季节桶内的回报变化将非常小，而跨季节桶的变化将非常大。换句话说，<strong class="la jk">我们期望跨季节时段的高SS和每个季节时段内的低SS</strong><em class="nf">(无意中，一些聚类算法通过最大化跨类方差同时最小化类内方差来工作)。</em>这在右边的图中有直观的描述。</p><p id="9d17" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果季节不重要，我们还能期待什么？这将与我们刚才描述的相反。我们应该期望看到跨季节时段的低ss(低变化)和每个时段内的高SS(高变化)。换句话说，排序前和排序后的变化看起来差不多(左图)。</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ou"><img src="../Images/28127efd3f3bfadbf62350fc78e6420b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UB9vgNZIkbFN9pKkGvVDmg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">不同状态下的分布情况(来源:作者)</p></figure><p id="f495" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这听起来越来越像假设测试了。基本上，方差分析就是这样的:</p><blockquote class="ov"><p id="2628" class="ow ox jj bd oy oz pa pb pc pd pe lt dk translated">方差分析是检验不同组的均值是否显著不同的一种方法。</p></blockquote><h1 id="3f53" class="mi mj jj bd mk ml mm mn mo mp mq mr ms kp pf kq mu ks pg kt mw kv ph kw my mz bi translated">解释我们的方差分析结果</h1><p id="f7eb" class="pw-post-body-paragraph ky kz jj la b lb na kk ld le nb kn lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">但我喜欢ANOVA的是它分解变异来源的方式(解释变异基本上就是解释方差)。</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/a63f86d44d0fd119dddeeb89135db865.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*qS5sJVD0ni2_Wj2Ya26rLg.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">变异的来源(来源:作者)</p></figure><p id="733e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是我之前展示的同一个ANOVA输出——绿色数字是各组之间的<strong class="la jk">差异的统计数据(通过将各组的平均值与总体平均值进行比较来衡量，即夏季的平均值或冬季的平均值是否与总体平均值有很大差异？)</strong>而黄色数字是一个群体内<strong class="la jk">变化的统计数据(仅在冬季期间能量回报就有多少变化)</strong>？总变化只是所有能量观测的总SS，与季节无关。</p><pre class="me mf mg mh gt ng nh ni nj aw nk bi"><span id="f272" class="nl mj jj nh b gy nm nn l no np">So ANOVA breaks out variation as follows:</span><span id="520c" class="nl mj jj nh b gy nr nn l no np">Total SS = Between Groups SS + Within Groups SS</span><span id="7692" class="nl mj jj nh b gy nr nn l no np">Where SS is an estimate for variation</span></pre><p id="07f6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们可以检查我们上面描述的情况:</p><ul class=""><li id="e408" class="nv nw jj la b lb lc le lf lh nx ll ny lp nz lt pj ob oc od bi translated">如果组间变异高于组内变异，那么季节一定很重要。</li><li id="37fc" class="nv nw jj la b lb oe le of lh og ll oh lp oi lt pj ob oc od bi translated">如果组间差异相对于组内差异不是很大，那么季节就无关紧要了。</li></ul><p id="3ae1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们用来定量测试我刚才描述的内容的F统计量是从绿色和黄色的数字中计算出来的，如下所示:</p><pre class="me mf mg mh gt ng nh ni nj aw nk bi"><span id="3386" class="nl mj jj nh b gy nm nn l no np">F = (SS_between/df_between) / (SS_within/df_within)<br/>= (0.00677/3) / (0.07816/32) = 0.924</span><span id="785b" class="nl mj jj nh b gy nr nn l no np">The intuition around why we divide SS by df (degrees of freedom) is that we need to do so in order to normalize it. The more observations there are, the higher the SS - so in order to compare variables with unequal numbers of observations we need to normalize SS by dividing it by df.</span></pre><p id="9cd4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是我们的测试统计。如果您需要复习假设检验，我在这里介绍了一些基础知识:</p><div class="is it gp gr iu pk"><a rel="noopener follow" target="_blank" href="/data-science-fundamentals-a-b-testing-cb371ceecc27"><div class="pl ab fo"><div class="pm ab pn cl cj po"><h2 class="bd jk gy z fp pp fr fs pq fu fw ji bi translated">数据科学基础— A/B测试</h2><div class="pr l"><h3 class="bd b gy z fp pp fr fs pq fu fw dk translated">我们用一个简单的例子来探究A/B测试的来龙去脉</h3></div><div class="ps l"><p class="bd b dl z fp pp fr fs pq fu fw dk translated">towardsdatascience.com</p></div></div><div class="pt l"><div class="pu l pv pw px pt py ja pk"/></div></div></a></div><p id="c7ff" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是在高水平上，F-统计量越大，我们观察到由于随机机会而观察到的情况的可能性就越小。在这种情况下，我们的零假设是均值在统计上没有差异——或者组内的差异胜过组间的差异。</p><p id="5e5f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我们的例子中，要达到5%的显著水平，我们需要看到F统计值为2.90或更高。由于我们的F统计量仅为0.924，我们无法拒绝零假设。思考我们的结论的一种更直观的方式是查看0.44的p值(这是从F统计得出的)——<strong class="la jk">0.44的p值意味着有44%的机会观察到我们由于随机机会而做的事情</strong>。那是相当高的！难怪我们没能拒绝零假设。</p><h2 id="fc9c" class="nl mj jj bd mk oj ok dn mo ol om dp ms lh on oo mu ll op oq mw lp or os my ot bi translated">理解变异的来源</h2><p id="4c8e" class="pw-post-body-paragraph ky kz jj la b lb na kk ld le nb kn lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">现在我们已经解决了技术问题，让我们稍微关注一下直觉。划分<code class="fe ns nt nu nh b">SS_between/SS_total = 0.00677/0.08493 = 8%</code>。这意味着只有8%的变化是由季节引起的。因此，季节不是能源股回报的主要驱动因素。</p><p id="8276" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一个很好的问题是“SS_between相对于SS_total(不变)有多高，均值的差异才具有统计显著性？这在解释变异时意味着什么？</p><p id="c523" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要达到2.90的F统计值，SS_between需要达到0.0182，几乎是原来的3倍。在这种情况下，季节可以解释总变异的21.4%。因此，即使发现均值在统计上不同，每个时段内仍可能存在显著差异。</p><h1 id="154d" class="mi mj jj bd mk ml mm mn mo mp mq mr ms kp mt kq mu ks mv kt mw kv mx kw my mz bi translated">结论</h1><p id="edfb" class="pw-post-body-paragraph ky kz jj la b lb na kk ld le nb kn lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">让我们用一个方框图来结束吧，这是我最喜欢的一种方法，可以形象化不同类别之间的差异。</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div class="gh gi pz"><img src="../Images/321314a9822b1bc29a8a9edd6cbb79f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*y9VSme_Gwis4DBWEPmLpNQ.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">能量回报的箱线图(来源:作者)</p></figure><p id="a987" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以看到，虽然春季回报率较高，但所有季节的总体分布或多或少都是相互叠加的——正如我们在未能拒绝零假设时发现的那样。</p><p id="de8f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">方差分析是一个很好的工具，可以帮助你理解观察到的差异的驱动因素。例如，如果您试图了解是什么导致了购物者花费的差异，您可以将购物者分类，并使用ANOVA测试分类的质量。这就像一个反向聚类分析。在聚类中，首先进行排序，然后试图找出这些聚类的含义。通过方差分析，你假设某个分类很重要，然后你测试自己是否正确。</p><p id="2b71" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这可能会有点乏味，但得出的结果肯定更容易理解(也更容易向你的老板解释)。干杯！</p></div></div>    
</body>
</html>