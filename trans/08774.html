<html>
<head>
<title>On the Validation of UMAP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于UMAP的验证</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/on-the-validating-umap-embeddings-2c8907588175?source=collection_archive---------15-----------------------#2021-08-13">https://towardsdatascience.com/on-the-validating-umap-embeddings-2c8907588175?source=collection_archive---------15-----------------------#2021-08-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2422" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">验证亚马逊DenseClus中UMAP嵌入的一个实例</h2></div><p id="810b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">没有大量实际的<em class="lb"> </em>工作来验证<a class="ae lc" href="https://arxiv.org/abs/1802.03426" rel="noopener ugc nofollow" target="_blank">一致流形逼近和投影(UMAP </a>)。在这篇博文中，我将展示一个真实的例子，希望提供一种额外的方法来验证算法的结果。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ld"><img src="../Images/0df6175908d230811d7b57e2e1b9384f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OZ3gMF1pZTk-oAs8"/></div></div><p class="lp lq gj gh gi lr ls bd b be z dk translated">Artem Verbo在<a class="ae lc" href="https://unsplash.com/search/photos/cat-cute?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="69d8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一般来说，通常的做法是基于下游任务来验证UMAP收敛。例如，在分类的情况下，您使用一个客观的度量标准，如<a class="ae lc" href="https://en.wikipedia.org/wiki/F-score" rel="noopener ugc nofollow" target="_blank"> F1-Score </a>作为评估维度减少的代理性能度量标准。然而，高F1分数<strong class="kh ir"> <em class="lb">并不能保证</em></strong>UMAP准确地捕捉到了数据的结构。下游任务的高精度只是告诉你数据在低维是可分离的，在给定输入的情况下表现良好。</p><p id="77e5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">简单地说，使用一个度量来评估底层数据的结构保持性<strong class="kh ir">和</strong>一个下游任务度量。可信度和连续性是前者。</p><p id="160b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇博文将带你了解如何使用亚马逊的<a class="ae lc" href="https://github.com/awslabs/amazon-denseclus" rel="noopener ugc nofollow" target="_blank">dense clus</a>包运行可信度和连续性作为额外的检查，以确认UMAP收敛到一个稳定的结果。</p><h2 id="648b" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">在那之前，UMAP是什么？</h2><p id="559f" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">UMAP是一种针对高维数据的非线性降维技术。“视觉上类似于t-SNE算法(也使其黯然失色)，UMAP假设数据均匀分布在一个<a class="ae lc" href="https://en.wikipedia.org/wiki/Locally_connected" rel="noopener ugc nofollow" target="_blank">局部连通的</a>黎曼流形上，黎曼度量是局部恒定或近似局部恒定的”(参见:<a class="ae lc" href="https://umap-learn.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> UMAP:统一流形近似和降维投影— umap 0.3文档“</a>)</p><p id="ea16" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<a class="ae lc" href="https://arxiv.org/abs/1802.03426" rel="noopener ugc nofollow" target="_blank"> UMAP论文</a> (UMAP:一致流形逼近和投影麦金尼斯等2018)中，有一些分析需要拓扑学博士才能完全理解。</p><p id="9883" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，让我们把它定义为一种基于<strong class="kh ir">邻居的</strong>降维方法，它可以处理数字和/或分类数据。</p><p id="fc6a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你想要更深层次的理解，查看上面的UMAP文档链接或者作者的PyData演讲。</p><h2 id="1054" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">安装UMAP</h2><p id="f123" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">无论如何，让我们收集一些数据。</p><p id="2d83" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您将直接从<a class="ae lc" href="https://github.com/awslabs/aws-customer-churn-pipeline" rel="noopener ugc nofollow" target="_blank"> Churn管道</a> repo中获取一个数据来运行该示例。</p><p id="3fd1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">原始客户流失数据集是公开可用的，并在丹尼尔·t·拉罗斯的《T2发现数据中的知识》一书中有所提及。作者将其归功于加州大学欧文分校的机器学习数据集仓库。</p><pre class="le lf lg lh gt mr ms mt mu aw mv bi"><span id="cda4" class="lt lu iq ms b gy mw mx l my mz">import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>import pandas as pd<br/>import numpy as np<br/><br/>%matplotlib inline<br/><br/>sns.set_style("darkgrid", {"axes.facecolor": ".9"})<br/>sns.set(rc={"figure.figsize": (10, 8)})<br/><br/>SEED = 42<br/>np.random.seed(SEED)  # set the random seed as best we can<br/><br/>data_url = "https://raw.githubusercontent.com/awslabs/aws-customer-churn-pipeline/main/data/churn.txt"<br/>df = pd.read_csv(data_url).sample(n=2000, random_state=SEED)<br/>df.drop(["Phone","Area Code"], axis=1, inplace=True)</span></pre><p id="1b35" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，既然已经加载了一个数据集，就给它安装<a class="ae lc" href="https://github.com/awslabs/amazon-denseclus" rel="noopener ugc nofollow" target="_blank"> Amazon DenseClus </a>。在幕后，DenseClus运行着UMAP，将相干组与混合类型的数据进行拟合。<a class="ae lc" href="https://aws.amazon.com/blogs/opensource/introducing-denseclus-an-open-source-clustering-package-for-mixed-type-data/" rel="noopener ugc nofollow" target="_blank">点击这里</a>阅读这篇博文中的更多信息。</p><p id="c172" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">实际上，下面的代码适合两个UMAP图层，一个用于数值数据，一个用于分类数据，然后将这两个图层结合起来。在很大程度上，预处理步骤是在幕后进行的。</p><pre class="le lf lg lh gt mr ms mt mu aw mv bi"><span id="e0b5" class="lt lu iq ms b gy mw mx l my mz">from denseclus.DenseClus import DenseClus<br/><br/><br/>clf = DenseClus(<br/>    random_state=SEED,<br/>    cluster_selection_method='leaf',<br/>    umap_combine_method="intersection_union_mapper"<br/>)<br/><br/>clf.fit(df)</span></pre><p id="59f2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，您在这里为可再现性设置了一个种子，这意味着UMAP将在单核上运行。在现实世界中，您不会在单个内核上运行。这意味着，由于算法的随机性质，实际结果在运行之间会有所不同。</p><pre class="le lf lg lh gt mr ms mt mu aw mv bi"><span id="b114" class="lt lu iq ms b gy mw mx l my mz">clf.numerical_umap_.embedding_</span><span id="ec20" class="lt lu iq ms b gy na mx l my mz">array([[4.1107535, 6.445445 , 7.030162 ],<br/>       [5.704323 , 3.341485 , 8.94879  ],<br/>       [6.6701894, 3.3435433, 8.452102 ],<br/>       ...,<br/>       [4.8372636, 6.5357466, 7.2330604],<br/>       [5.3695483, 2.8402767, 8.08292  ],<br/>       [5.979106 , 3.3134317, 7.6845136]], dtype=float32)</span></pre><h2 id="d77e" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">诚信是有用的</h2><p id="6574" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">可信度和连续性衡量降维后数据结构的保留程度。</p><p id="9b6b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Statis el al 2016的论文《在降维参数空间中语义控制的Adaptvive Equalisation》中找到了很好的解释:“这里，使用秩序来测量点<em class="lb"> i </em>在高维空间中相对于其<em class="lb"> k </em>最近邻点的距离，并且测量每个秩在低维空间中变化的程度。对于n个样本，设<em class="lb"> r(i，j) </em>为样本<em class="lb"> i </em>到样本<em class="lb"> j </em>在高维空间<em class="lb"> Uki </em>中的距离等级。同理，设<em class="lb">rˇ(I，j) </em>为低维空间<em class="lb"> Vki </em>中样本<em class="lb"> i </em>与样本<em class="lb"> j </em>之间距离的秩。使用最近的邻居，如果这些<em class="lb"> k </em>邻居也被放置在低维空间中的点I附近，则地图被认为是可信的。”</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi nb"><img src="../Images/ba94fe3fc359b6d6a4dada933205a50c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZnrjmyT6tEngCGPrZliG_A.png"/></div></div><p class="lp lq gj gh gi lr ls bd b be z dk translated">来源:“降维参数空间中语义控制的自适应均衡”，Stasis等人，2016年</p></figure><p id="c136" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Continuity it的情况下，Stasis指出，它“测量原始数据点簇被保留的程度，可以被认为是可信度的逆，在低维空间中找到接近点I的样本点，但在高维平面中没有。”</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi nc"><img src="../Images/d8d426f7d0d64f651fb6586f6b3ce7fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sUkunV9HO8Bcw8N0ateBhQ.png"/></div></div><p class="lp lq gj gh gi lr ls bd b be z dk translated">来源:“降维参数空间中语义控制的自适应均衡”，Stasis等人，2016年</p></figure><p id="6411" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每个计算的分数输出在0和1之间。分数越高，原始数据集的局部结构在UMAP嵌入中保留得越多。</p><p id="8189" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">UMAP有一个Numba优化计算(在验证子模块下)，可以很好地扩展到中等大小的数据。如这里的所示<a class="ae lc" href="https://github.com/lmcinnes/umap/issues/6" rel="noopener ugc nofollow" target="_blank">，另一个参考文献在</a><a class="ae lc" href="https://github.com/scikit-learn/scikit-learn/blob/ccd3331f7eb3468ac96222dc5350e58c58ccba20/sklearn/manifold/t_sne.py#L394" rel="noopener ugc nofollow" target="_blank"> SKLearn库</a>中。</p><p id="b35e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就像上面一样，K点上的成对距离是在原始数据和嵌入之间取得的。如果发现任何意想不到的邻居，它们将根据原始数据按等级比例受到惩罚。</p><p id="3a4d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好了，让我们检查一下嵌入是否在底层数据中捕获了它的邻居。</p><h2 id="cfad" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">对数据运行验证</h2><p id="1eb3" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">对于本例，您将设置K=30，查看30个相邻点进行比较。</p><p id="49d7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">注意:您在这里使用默认的欧几里德距离计算，但是请记住，它支持备选的成对或平方距离。归根结底，这是一个具体问题的选择。</em></p><pre class="le lf lg lh gt mr ms mt mu aw mv bi"><span id="ec6f" class="lt lu iq ms b gy mw mx l my mz">from umap import validation<br/><br/>K = 30<br/><br/>numerical_trustworthiness = validation.trustworthiness_vector(source=clf.numerical_umap_._raw_data<br/>                                  ,embedding=clf.numerical_umap_.embedding_<br/>                                  ,max_k=K)<br/><br/>categorical_trustworthiness = validation.trustworthiness_vector(source=clf.categorical_umap_._raw_data<br/>                                  ,embedding=clf.categorical_umap_.embedding_<br/>                                  ,max_k=K)<br/><br/><br/>_=plt.plot(numerical_trustworthiness)<br/>_=plt.plot(categorical_trustworthiness)<br/>_=plt.ylabel("Value of K")<br/>_= plt.xlabel(f"Trustworthiness score")<br/>_=plt.title(f"Trustworthiness at {K}")<br/>_=plt.legend(["numerical T", "categorical T"], loc="upper right")</span></pre><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="ab gu cl nd"><img src="../Images/b8332294c750285d248b0963ed905901.png" data-original-src="https://miro.medium.com/v2/format:webp/1*eyz-G8fKoy_AXeO97IQxqg.png"/></div><p class="lp lq gj gh gi lr ls bd b be z dk translated">作者图片</p></figure><p id="3fc4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一般来说，0.80以上的分数被认为是<strong class="kh ir">“好”</strong>的成绩。较低的分数表示您需要查看输入数据和UMAP参数以找到更好的拟合。查看从K=1到K=30的数字嵌入的可信度，我们看到在K=5时可信度达到0.96，然后在K=30时进一步下降到0.90。</p><p id="264f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，对于分类嵌入，K=5设置为0.94，然后在K=30时下降到0.93，显示出比数值数据更好的稳定性。</p><p id="394d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">DenseClus默认使用邻居的K=30来生成UMAP嵌入，因此这是一个合理的比较。</p><h2 id="06d4" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">结论</h2><p id="eb7e" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">在这篇博文中，您学习了如何在DenseClus中验证UMAP嵌入，方法是使用可信度来查看源数据和嵌入之间的相邻点有多远。</p><p id="85af" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">DenseClus 提供了一种简单的方法来演示如何以这种方式验证多个嵌入。信不信由你，DenseClus将两者结合到第三个嵌入空间来计算集群！但是，该空间没有可比较的输入数据，因为它是通过UMAP图之间的集合运算创建的。这里进一步验证成功的最佳方式是继续运行下游任务。</p><p id="76d7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你读到这里，感谢你的阅读:)</p><p id="83b9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请记住，您只是触及了这里的皮毛。基于下游任务方法，以可信度作为约束，可以调整多个可用的底层超参数。</p><p id="92c9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个例子的笔记本贴在DenseClus的Github repo <a class="ae lc" href="https://github.com/awslabs/amazon-denseclus/blob/main/notebooks/Validation%20For%20UMAP.ipynb" rel="noopener ugc nofollow" target="_blank">下面这里</a>。</p><h2 id="92d5" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">参考</h2><p id="c633" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">“一致流形逼近和降维投影”，麦金尼斯，利兰；约翰·希利；詹姆斯·梅尔维尔2018“邻里</p><p id="0bdc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">“非线性投影方法中的保存:实验研究”，Venna 2001年</p><p id="1370" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">“降维参数空间中语义控制的自适应均衡”，Stasis等人，2016年</p></div></div>    
</body>
</html>