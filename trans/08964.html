<html>
<head>
<title>Network Visualizations with GRANDstack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GRANDstack的网络可视化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/network-visualizations-with-grandstack-a07deb0a0c3a?source=collection_archive---------27-----------------------#2021-08-18">https://towardsdatascience.com/network-visualizations-with-grandstack-a07deb0a0c3a?source=collection_archive---------27-----------------------#2021-08-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c01d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何结合Neo4j、Graphql和React来开发一个图形探索工具</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/324444ade7db2b7a950248293e39ba31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VNIJVYKKgNKfQ5rlm-q6CA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">哈利波特世界的网络可视化。图片由作者提供。</p></figure><p id="f22a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这些年来，我参与了几个Neo4j项目。几乎所有的项目都有一个共同点，即需要开发一个定制的网络可视化工具，使最终用户无需学习任何Cypher查询语言语法就可以浏览图形。这篇博文将展示我开发的一个简单的网络可视化工具，它可以让你可视化并探索哈利波特的世界。可视化应用程序是使用GRANDstack构建的。所有代码都可以在<a class="ae lr" href="https://github.com/tomasonjo/neo4j-hp-viz" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/86c0279f415f201b66cd24881088e5b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*16V1YYeJKebn9GkGxP0ZwQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来自https://grandstack.io/的<a class="ae lr" href="https://grandstack.io/" rel="noopener ugc nofollow" target="_blank">。由4.0在CC下授权。</a></p></figure><p id="180b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae lr" href="https://grandstack.io/" rel="noopener ugc nofollow" target="_blank">大钉</a>由四部分组成:</p><ul class=""><li id="88ac" class="lt lu iq kx b ky kz lb lc le lv li lw lm lx lq ly lz ma mb bi translated">Neo4j数据库:存储网络数据的原生图形数据库</li><li id="ff40" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">graph QL:API的数据查询和操作语言</li><li id="956f" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">Apollo:一套协同工作来创建GraphQL数据流的工具。</li><li id="d1a5" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">React:一个JavaScript库，用于构建基于组件的可重用用户界面</li></ul><h2 id="7a7b" class="mh mi iq bd mj mk ml dn mm mn mo dp mp le mq mr ms li mt mu mv lm mw mx my mz bi translated">Neo4j数据库</h2><p id="e2dd" class="pw-post-body-paragraph kv kw iq kx b ky na jr la lb nb ju ld le nc lg lh li nd lk ll lm ne lo lp lq ij bi translated">Neo4j是一个本地图形数据库，适合存储、操作和查询网络数据。如果你是一个完全的Neo4j初学者，想了解更多，建议你看看<a class="ae lr" href="https://neo4j.com/developer/get-started/" rel="noopener ugc nofollow" target="_blank"> Neo4j介绍页面</a>。</p><p id="86c1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">《哈利·波特》网络数据来自我不久前写的一篇博客，在这篇博客中，我使用了<a class="ae lr" href="https://medium.com/neo4j/turn-a-harry-potter-book-into-a-knowledge-graph-ffc1c45afcc8" rel="noopener"> NLP来提取《哈利·波特》和《魔法石》中人物之间的联系。图表模式模型如下:</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/759f6a601bc7a54698a6fe48499b84dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*RYzwwNxrq9ucFKBD92IQyg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">哈利波特宇宙图形模式。图片由作者提供。</p></figure><p id="52f9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我们图表的中心是这本书的人物。有些角色属于像格兰芬多或斯莱特林这样的霍格沃茨学院。人物也是忠于各个群体的。例如，赫敏·格兰杰致力于促进小精灵福利的<em class="ng">协会。</em>网络还包含人物之间的家庭关系信息。最后，角色之间的交互也存储在数据库中。这是一个关于哈利波特的子图可视化示例:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/97a94da20afe80c3b1ac955832e5efa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2rjROtZP8nCrgD0KjJkMAQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">围绕哈利波特的样本子图。图片由作者提供。</p></figure><p id="1392" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我已经在<a class="ae lr" href="https://github.com/tomasonjo/neo4j-hp-viz" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>中添加了数据集文件以及如何将数据加载到Neo4j中的说明。</p><h2 id="da0f" class="mh mi iq bd mj mk ml dn mm mn mo dp mp le mq mr ms li mt mu mv lm mw mx my mz bi translated">GraphQL端点</h2><p id="42b3" class="pw-post-body-paragraph kv kw iq kx b ky na jr la lb nb ju ld le nc lg lh li nd lk ll lm ne lo lp lq ij bi translated">GraphQL最初由脸书开发，后来在2015年公开发布。GraphQL是一种用于API的查询语言和服务器端运行时，它优先向客户端精确地提供它们请求的数据。GraphQL服务是通过定义类型和这些类型上的字段，然后为每个字段提供函数来创建的。Neo4j开发了一个<a class="ae lr" href="https://github.com/neo4j/graphql" rel="noopener ugc nofollow" target="_blank"> GraphQL库</a>，可以快速开发与Neo4j数据库交互的GraphQL服务器。此外，该库自动提供检索GraphQL模式中定义的类型和字段所需的函数。当然，如果您愿意，您总是可以为任何字段提供一个定制的解析器。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="c401" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这里，我在模式中定义了两种类型。类型名必须与Neo4j中的节点标签相同。Neo4j GraphQL库默认提供完整的CRUD支持。在我们的网络可视化工具中，我们将只从Neo4j读取数据，从不更新数据库。由于我们不需要完整的CRUD支持，我们可以将创建、更新和删除突变排除在生成之外。您可以将应该通过GraphQL端点可用的节点的属性包含在一个类型的字段中。</p><p id="7a14" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">例如，我们可以使用这两种模式类型在客户机中检索关于House或Group节点的信息。检索房屋节点信息的GraphQL查询示例如下:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="6f40" class="mh mi iq nl b gy np nq l nr ns">query house {<br/>   houses {<br/>     name<br/>   }<br/>}</span></pre><p id="f905" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个查询的结果是:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="cbe6" class="mh mi iq nl b gy np nq l nr ns">{ "data": {<br/>   "houses": [<br/>   { "name": "Gryffindor"},<br/>   { "name": "Slytherin"},<br/>   { "name": "Hufflepuff"},<br/>   { "name": "Ravenclaw"}]<br/>  }<br/>}</span></pre><p id="42ae" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">嗯，那很简单！对于基本的CRUD操作，您甚至不需要了解任何Cypher查询语言。Neo4j GraphQL库还提供了对分页、排序和过滤查询的支持。在<a class="ae lr" href="https://neo4j.com/docs/graphql-manual/current/" rel="noopener ugc nofollow" target="_blank">文档</a>中了解更多信息。接下来，我们可以为一个角色构造一个模式类型。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="b7af" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">字符类型有点复杂。这里，我们介绍了<code class="fe nt nu nv nl b">@relationship</code>指令。如果你还记得图形模式，一个角色可以属于一个家族，也可以忠于一个团体。为了检索关于角色的房子的信息，我们必须遍历BELONGS_TO关系。在<code class="fe nt nu nv nl b">@relationship</code>指令中，您指定要遍历的关系类型及其方向。关系的方向可以是传出或传入。</p><p id="460e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们的应用程序包括一个自动完成特性。我们将使用Neo4j的全文搜索特性来实现前端的自动完成功能。您可以在<code class="fe nt nu nv nl b">Query</code>类型下定义定制的GraphQL查询。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="47de" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是我们需要为GraphQL服务器生成的大部分代码，以便与Neo4j交互。我还添加了交互类型，但是它非常基本，没有引入额外的功能，所以我在这里跳过了它。</p><h2 id="c652" class="mh mi iq bd mj mk ml dn mm mn mo dp mp le mq mr ms li mt mu mv lm mw mx my mz bi translated">前端反应组件</h2><p id="a3ac" class="pw-post-body-paragraph kv kw iq kx b ky na jr la lb nb ju ld le nc lg lh li nd lk ll lm ne lo lp lq ij bi translated">现在我们已经准备好了数据库和GraphQL服务器，我们可以继续开发前端了。我已经使用了<a class="ae lr" href="https://www.npmjs.com/package/vis-react" rel="noopener ugc nofollow" target="_blank"> vis-react </a>进行网络可视化。我选择它是因为它同时公开了节点/边数据集和网络对象。我们需要节点/边数据集来创建动态网络可视化，而网络对象用于添加交互性。</p><p id="5690" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Apollo客户端库提供了两个React挂钩，用于从GraphQL端点检索数据。首先是<code class="fe nt nu nv nl b">useQuery</code>钩。当react组件装载和呈现时，Apollo客户机自动执行指定的查询。您可以如下定义<code class="fe nt nu nv nl b">useQuery</code>挂钩:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="fb5e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，您需要定义GraphQL查询。在这里，我指定要检索PageRank值大于0，16的所有字符。此外，我只对name、pagerank和community字段感兴趣，所以我可以指定查询只检索这些字段。接下来，您可以通过使用useQuery功能来定义Reach挂钩。最后，将获取的数据与交互信息相结合，然后输入到vis-react库中，以生成下面的网络可视化。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/324444ade7db2b7a950248293e39ba31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VNIJVYKKgNKfQ5rlm-q6CA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">哈利波特世界的网络可视化。图片由作者提供。</p></figure><p id="c9c5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Apollo客户端库提供的第二个React钩子是<code class="fe nt nu nv nl b">useLazyQuery</code>。<code class="fe nt nu nv nl b">useLazyQuery</code>钩子是为响应其他事件而运行查询而设计的。例如，您可以通过单击按钮来执行查询，或者在我们的示例中，通过在可视化中选择一个节点来选择一个字符来填充弹出窗口。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="9b98" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，在characterData别名下的函数return中可以获得角色的数据。注意，我在GraphQL查询中使用了<code class="fe nt nu nv nl b">where</code>谓词来获取特定字符的数据。我已经使用了<a class="ae lr" href="https://www.npmjs.com/package/react-modal" rel="noopener ugc nofollow" target="_blank"> react-modal </a>库来生成弹出窗口，因此代码如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="a481" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有时您希望能够在函数中访问GraphQL返回。在我们的示例应用程序中，我们需要将自动完成选项从函数返回到输入组件。要实现这一点，您可以访问Apollo客户端，并等待查询通过异步函数完成。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="3f9e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通过组合自动完成、弹出和其他查询，我创建了以下网络探索组件:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/23e4c24b8f8b28a4e78962c24eb66d2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*G2leMYlTiWjBu4hPpE-8Jw.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">哈利波特网络示例探索。作者视频。</p></figure><h2 id="a60f" class="mh mi iq bd mj mk ml dn mm mn mo dp mp le mq mr ms li mt mu mv lm mw mx my mz bi translated">结论</h2><p id="1bf1" class="pw-post-body-paragraph kv kw iq kx b ky na jr la lb nb ju ld le nc lg lh li nd lk ll lm ne lo lp lq ij bi translated">希望这篇博文能帮助你开始大规模的网络探索和可视化。如果你有任何想法如何改善这个应用程序，请让我知道生长激素问题或创建一个拉请求。</p><p id="fe38" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">和往常一样，代码可以在<a class="ae lr" href="https://github.com/tomasonjo/neo4j-hp-viz" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p></div></div>    
</body>
</html>