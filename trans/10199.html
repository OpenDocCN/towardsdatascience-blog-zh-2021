<html>
<head>
<title>Landcover Analysis using Python and ArcGIS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python和ArcGIS进行土地覆盖分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/landcover-analysis-using-python-and-arcgis-74223a2c508a?source=collection_archive---------27-----------------------#2021-09-27">https://towardsdatascience.com/landcover-analysis-using-python-and-arcgis-74223a2c508a?source=collection_archive---------27-----------------------#2021-09-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6728" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在Jupyter笔记本中创建数据地图或执行空间分析</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f6782b2f389b89b7c48be5c0ab1bc3a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j0uMQrkJr6_MfkPcRgTRoA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">美国地质调查局提供的陆地卫星图像</p></figure><p id="1bad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ArcGIS是地质统计分析的顶级平台之一。将ArcGIS库与python结合使用，您将能够分析shapefiles、显示Landsat卫星影像、创建数据地图，以及在Jupyter笔记本中完成更多工作！使用这个库可以创建无限数量的数据科学项目，但对于本文，我将重点关注一个简单的NDVI(归一化差异植被指数)分析。</p><p id="fc4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们开始之前，确保你已经安装了所有必要的库，在ESRI的网站上查看<a class="ae ky" href="https://pro.arcgis.com/en/pro-app/latest/arcpy/get-started/what-is-arcpy-.htm" rel="noopener ugc nofollow" target="_blank"> arcpy，了解更多你需要的东西。以下是我在分析中使用的所有库:</a></p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="c240" class="ma mb it lw b gy mc md l me mf"><strong class="lw iu">import</strong> <strong class="lw iu">pandas</strong> <strong class="lw iu">as</strong> <strong class="lw iu">pd</strong><br/><strong class="lw iu">from</strong> <strong class="lw iu">datetime</strong> <strong class="lw iu">import</strong> datetime<br/><strong class="lw iu">from</strong> <strong class="lw iu">IPython.display</strong> <strong class="lw iu">import</strong> Image<br/><strong class="lw iu">from</strong> <strong class="lw iu">IPython.display</strong> <strong class="lw iu">import</strong> HTML<br/><strong class="lw iu">import</strong> <strong class="lw iu">matplotlib.pyplot</strong> <strong class="lw iu">as</strong> <strong class="lw iu">plt<br/>import sys<br/>import</strong> <strong class="lw iu">arcgis</strong><br/><strong class="lw iu">from</strong> <strong class="lw iu">arcgis.gis</strong> <strong class="lw iu">import</strong> GIS<br/><strong class="lw iu">from</strong> <strong class="lw iu">arcgis.raster.functions</strong> <strong class="lw iu">import</strong> apply, clip, remap, colormap<br/><strong class="lw iu">from</strong> <strong class="lw iu">arcgis.geometry</strong> <strong class="lw iu">import</strong> lengths, areas_and_lengths, project<br/><strong class="lw iu">from</strong> <strong class="lw iu">arcgis.geometry</strong> <strong class="lw iu">import</strong> Point, Polyline, Polygon, Geometry<br/><strong class="lw iu">from</strong> <strong class="lw iu">arcgis.geocoding</strong> <strong class="lw iu">import</strong> geocode<br/><strong class="lw iu">from</strong> <strong class="lw iu">arcgis.features</strong> <strong class="lw iu">import</strong> FeatureLayer</span></pre><h1 id="334c" class="mg mb it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated"><strong class="ak"> 1。定义你的区域</strong></h1><p id="6c43" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li mz lk ll lm na lo lp lq nb ls lt lu im bi translated">这部分完全取决于你，对于这个项目，我将使用纽约市。选择区域后，您需要找到与该位置相关的要素图层文件。通常，这可以通过使用ESRI的RESTful API找到，下面是我如何找到NYC的FeatureLayer:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="681e" class="ma mb it lw b gy mc md l me mf">nyc_fl = FeatureLayer('https://gisservices.its.ny.gov/arcgis/rest/services/NYS_Civil_Boundaries/FeatureServer/4')<br/>ny_df = pd.DataFrame.spatial.from_layer(nyc_fl)<br/>nyc_df = ny_df.iloc[32:33]</span></pre><p id="2dbf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这给了我一个地理数据框架，我挑出了覆盖纽约县的第32行。在我确定了面积之后，我只是把空间部分转换成一个shapefile。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/65a95468835aecb998677dc8bdba8929.png" data-original-src="https://miro.medium.com/v2/resize:fit:596/format:webp/1*lstLqAmO0EljSVvKoQJ4Pw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="e140" class="mg mb it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">2.获取卫星图像</h1><p id="4475" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li mz lk ll lm na lo lp lq nb ls lt lu im bi translated">这就是我们如何定义我们的要素图层的土地覆盖。NDVI分析的工作原理是基于卫星图像的每个像素分析颜色。最简单的方法是使用ESRI的陆地卫星图像:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d0ce" class="ma mb it lw b gy mc md l me mf">landsat_item = gis.content.search('title:Multispectral Landsat', 'Imagery Layer', outside_org=<strong class="lw iu">True</strong>)[0]<br/>landsat = landsat_item.layers[0]</span></pre><p id="d74d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您可以使用Landsat项目，定义理想的云量百分比(尽可能保持低的百分比)并设置开始和结束日期:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="b7a6" class="ma mb it lw b gy mc md l me mf">selected = landsat.filter_by(where="(Category = 1) AND (cloudcover &lt;=0.05)",time=[datetime(2020, 4, 1), datetime(2020, 6, 30)],                              geometry=arcgis.geometry.filters.intersects(area['extent']))  </span><span id="2b56" class="ma mb it lw b gy nd md l me mf">df = selected.query(out_fields="AcquisitionDate, GroupName, CloudCover, DayOfYear",                   order_by_fields="AcquisitionDate").sdf </span><span id="44af" class="ma mb it lw b gy nd md l me mf">df['AcquisitionDate'] = pd.to_datetime(df['AcquisitionDate'], unit='ms')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/bdb91a5cd76672753e7d91b5142707df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SSGFgYaY2D7RMY_EDm2ONw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">美国地质调查局提供的陆地卫星图像</p></figure><h1 id="b1b2" class="mg mb it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">3.添加NDVI滤镜并创建一个剪辑</h1><p id="72cb" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li mz lk ll lm na lo lp lq nb ls lt lu im bi translated">现在你有了你的卫星图像，你可以应用“NDVI原始数据”函数来计算每个像素的NDVI</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4f75" class="ma mb it lw b gy mc md l me mf">nyc_colorized = apply(nyc_image, 'NDVI Raw')</span></pre><p id="003d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您可以使用我们之前定义的shapefile来获得您所在区域的完美剪辑</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d025" class="ma mb it lw b gy mc md l me mf">nyc_clip = clip(nyc_colorized,nyc_poly)<br/>nyc_clip.extent = area['extent']</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/80a359f527b2ca5b33d95afedc9e7652.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*8hJ3fMJFKVvI2niQZvNstg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="41a6" class="mg mb it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">4.颜色变换</h1><p id="4064" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li mz lk ll lm na lo lp lq nb ls lt lu im bi translated">NDVI值的范围从-1到1，由你决定如何对你的土地覆盖进行分类，但是我建议<a class="ae ky" href="https://gisgeography.com/ndvi-normalized-difference-vegetation-index/" rel="noopener ugc nofollow" target="_blank">阅读更多关于这个值代表什么的</a>。对于这个项目，我将土地覆盖分为三组:水，混凝土和植被。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="9fcc" class="ma mb it lw b gy mc md l me mf">masked = colormap(remap(nyc_clip, <br/>                        input_ranges=[-1,0,     <em class="ng"># water</em><br/>                                     -0.1, 0.4, <em class="ng"># Concrete</em><br/>                                     0.4, 1],   <em class="ng"># Vegetation, Trees      </em><br/>                        output_values=[1, 2, 3]),<br/>                        colormap=[[1, 1, 255, 248], [2, 144, 148, 148], [3,14,247,22]], astype='u8')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/2170a1642fa77094db9fedc5eee8dec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/format:webp/1*0LM0c7r8lriPj2TLcAUqfg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="854e" class="mg mb it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">4.分析</h1><p id="a259" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li mz lk ll lm na lo lp lq nb ls lt lu im bi translated">现在你有了你的色彩映射表，你可以分析它了！</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d65c" class="ma mb it lw b gy mc md l me mf">xpixel = (nyc_clip.extent['xmax'] - nyc_clip.extent['xmin']) / 800<br/>ypixel = (nyc_clip.extent['ymax'] - nyc_clip.extent['ymin']) / 400<br/><br/>full_res = masked.compute_histograms(nyc_clip.extent,<br/>                                   pixel_size={'x':xpixel, 'y': ypixel})<br/>total_pix = 0<br/>hist = full_res['histograms'][0]['counts'][0:]<br/><strong class="lw iu">for</strong> x <strong class="lw iu">in</strong> hist[1:]:<br/>    total_pix += x</span><span id="3b84" class="ma mb it lw b gy nd md l me mf">colors=['#0EF716','#01FFF8','#909494']<br/>labels =[ (hist[1]/sum(hist)), (hist[2]/sum(hist)), (hist[3]/sum(hist)) ]<br/>plt.pie(hist, labels=['', 'Water', 'Concrete', 'Green Cover'],colors=colors,<br/>        shadow=<strong class="lw iu">True</strong>)<br/>plt.title('Landcover of New York City')<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/5873a1ead4d3dd15945a3f10bfbda0bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*bvj9BeT4etdnI7zxV6s7kg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="776b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这只是一个项目想法，但我希望你能以此为灵感，创造出更好的东西。想知道您所在位置的土地覆盖在这些年里发生了怎样的变化？更改开始和结束日期以创建多个色彩映射表。想知道云量如何影响精确度吗？提高云量百分比，比较两者。想要在简历中添加一个独特的、以空间为重点的数据科学项目吗？考虑将ArcGIS与python结合使用！</p><p id="bdff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读！</p><p id="f921" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完整笔记本:<a class="ae ky" href="https://github.com/Bench-amblee/geo/blob/main/nyc_landcover.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/Bench-amble/geo/blob/main/NYC _ land cover . ipynb</a></p></div></div>    
</body>
</html>