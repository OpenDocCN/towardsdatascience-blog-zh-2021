<html>
<head>
<title>Version control your database Part 1: creating migrations and seeding</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">版本控制您的数据库第1部分:创建迁移和播种</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/version-control-your-database-part-1-creating-migrations-and-seeding-992d86c90170?source=collection_archive---------7-----------------------#2021-05-20">https://towardsdatascience.com/version-control-your-database-part-1-creating-migrations-and-seeding-992d86c90170?source=collection_archive---------7-----------------------#2021-05-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="27e2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">轻松规划、验证和安全地应用对数据库的更改</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7150284b52f9593bdfa2e15762c8886e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4fitaE9zB5wNlp4byoBU5w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">想象一下，这些盒子里塞满了模式和表格(图片由<a class="ae ky" href="https://www.pexels.com/@ketut-subiyanto" rel="noopener ugc nofollow" target="_blank">赖爷·苏比扬托</a>在<a class="ae ky" href="https://www.pexels.com/photo/crop-man-packing-box-with-duct-tape-4246106/" rel="noopener ugc nofollow" target="_blank">像素</a>上拍摄)</p></figure><p id="f6b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您没有在数据库中处理迁移，那么您就错过了。就像Git管理对源代码的更改一样，您可以使用迁移来跟踪对数据库的更改。执行和恢复更改，并将数据库恢复到以前的状态。</p><p id="71dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设置迁移比您想象的要简单，而且优势巨大。迁移是独立于数据库的，提供一个真实的来源，跟踪变化，甚至可以用一些数据播种您的数据库。当您阅读完本文后，您将能够:</p><ul class=""><li id="d6c3" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">创建带有索引和外键的表</li><li id="270c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在开发数据库中轻松规划、验证和安全应用更改，然后将所有更改同步到生产数据库</li><li id="0400" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">重置开发数据库(全部撤消，再次迁移)</li><li id="12a2" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在数据库中创建所有指定的表，包括索引和关联</li><li id="1fe9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">为数据库设定种子(插入数据)</li><li id="693a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">执行到任何数据库的迁移(例如PostgreSQL和SQL Server)</li></ul><p id="7e9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将试着用实例展示所有这些特性，这些实例使用您可以重用的真实代码。我将这个过程分为4个步骤:设置、创建迁移、执行和撤销，最后是播种。不要因为这篇文章的长度而气馁，你可以使用简单的步骤轻松完成。我们走吧！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/ff4e7365070d3763fd05a44a78525969.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6dibx2mkzHhCngAqJpfj1w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的计划已经制定，让我们开始吧(照片由<a class="ae ky" href="https://unsplash.com/@homajob" rel="noopener ugc nofollow" target="_blank">斯科特·格雷厄姆</a>在<a class="ae ky" href="https://unsplash.com/photos/5fNmWej4tAA" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄)</p></figure><h1 id="8e73" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">步骤1:设置</h1><p id="fb33" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在这一步的最后，Sequelize安装完毕，可以使用了。如果你是一个有经验的程序员，那么跳过“解释”部分。在这一部分的底部，您可以找到所有命令的摘要。</p><h2 id="e085" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">1.1安装NPM</h2><p id="28a5" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated"><a class="ae ky" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">安装NPM </a>。用<code class="fe nt nu nv nw b">npm -v</code>验证</p><p id="086f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">说明:<br/>对于这个项目，你需要安装<a class="ae ky" href="https://www.w3schools.com/whatis/whatis_npm.asp" rel="noopener ugc nofollow" target="_blank">NPM</a>JavaScript包管理系统。它类似于Python中的pip，您可以使用它来安装软件包。在此下载NPM <a class="ae ky" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">并遵循安装说明。一旦安装完成，你应该能够打开一个终端(如命令提示符)并运行<code class="fe nt nu nv nw b">nmp -v</code>。如果您的是阿瑟版本(如<em class="nx"> v14.15.4 </em>),则节点安装正确。</a></p><h2 id="b2e1" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">1.2设置您的项目</h2><p id="2b7f" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">打开终端，导航到您的项目文件夹并执行<code class="fe nt nu nv nw b">npm init</code></p><p id="a6d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">解释:<br/>创建一个你想要创建这个项目的文件夹，例如<code class="fe nt nu nv nw b">c:/migrationtool</code>。<br/>打开一个终端，导航到这个文件夹:<code class="fe nt nu nv nw b">cd c:/migrationtool</code> <br/>调用<code class="fe nt nu nv nw b">npm init</code>新建一个项目。NPM会问你一些关于项目名称、版本、描述和作者姓名的问题。这些都不是必填项，可以跳过，也可以以后填写。完成后，项目文件夹中会出现一个名为“package.json”的文件。在这里，我们所有的项目元数据都将被注册。</p><h2 id="624a" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">1.3安装软件包</h2><p id="127e" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在根文件夹中执行</p><pre class="kj kk kl km gt ny nw nz oa aw ob bi"><span id="c898" class="nh ml it nw b gy oc od l oe of"># installing packages<br/>npm install --save sequelize sequelize-cli<br/>npm install --save pg pg-hstore   # for PostgreSQL<br/>npm install --save tedious        # for SQL Server</span></pre><p id="ea58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">说明:<br/>我们的项目准备好了，让我们安装我们的包吧！首先我们需要Sequelize和Sequelize-cli。这些包允许我们开始进行和执行迁移:<code class="fe nt nu nv nw b">npm install --save sequelize sequelize-cli</code>。这是允许我们创建迁移的主包。<br/>为了实际执行这些迁移(例如创建数据库、表或新列), Sequelize需要了解更多关于数据库的信息。出于演示目的，我们将在项目中使用两种数据库:PostgreSQL和SQL Server。为了让Sequelize与这些数据库一起工作，我们需要安装一些额外的包:<code class="fe nt nu nv nw b">npm install — save pg pgh-store tedious</code>。如果你使用另一个数据库，如mysql sqllite或许多其他数据库，你可以在这里选择使用哪个包。你会注意到出现了一个新文件夹；节点_模块。我们所有的软件包都安装在这里。我们的package.json文件也扩展了，跟踪我们所有已安装的包。</p><h2 id="e4e8" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">1.4初始化序列</h2><p id="6bd1" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在你的根文件夹中执行<code class="fe nt nu nv nw b">npx sequelize-cli init </code>并运行所有步骤</p><p id="03c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">说明:<br/>我们所有的包都安装好了。初始化序列:<code class="fe nt nu nv nw b">npx sequelize-cli init</code>。请注意，我们在这里使用的是NPX，而不是NPM。NPX用来执行我们和NPM一起安装的包。<br/>命令完成后，您会注意到又出现了三个文件夹:</p><ul class=""><li id="4a57" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">config:保存数据库凭证之类的文件</li><li id="c642" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">模型:保存将数据库表表示为模型的文件</li><li id="047e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">seeders:在表格中插入和删除数据的文件</li></ul><h2 id="bfe4" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">1.5配置序列</h2><p id="3943" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">Sequelize已经可以使用了。在我们深入研究之前，我们将让Sequelize的工作变得更简单一些<br/>我们将让配置的工作变得更简单一些。根据我的经验，JS文件比JSON更容易使用。转到config文件夹，将<em class="nx"> config.json </em>改为<em class="nx"> config.js </em>。然后调整内容从</p><pre class="kj kk kl km gt ny nw nz oa aw ob bi"><span id="9957" class="nh ml it nw b gy oc od l oe of">{<br/>  "development": {</span></pre><p id="d9de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到</p><pre class="kj kk kl km gt ny nw nz oa aw ob bi"><span id="4f28" class="nh ml it nw b gy oc od l oe of">module.exports: {<br/>    "development": {</span></pre><p id="ebfc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们对“我们需要告诉Sequelize如何处理新情况”进行了更改。转到项目的根目录(<code class="fe nt nu nv nw b">c:/migrationtool/</code>)并创建一个新文件。将这个文件命名为<code class="fe nt nu nv nw b">.sequelizerc</code>。请注意，这个文件没有名称，只有扩展名。打开文件并添加下面的内容。这告诉Sequelize我们现在使用config.js而不是config.json。</p><pre class="kj kk kl km gt ny nw nz oa aw ob bi"><span id="b218" class="nh ml it nw b gy oc od l oe of">const path = require('path');<br/> module.exports = {<br/>   "config": path.resolve('./config', 'config.js'),<br/>    "models-path": path.resolve('./models'),<br/>    "migrations-path": path.resolve('./migrations'),<br/>    "seeders-path": path.resolve('./seeders')<br/> }</span></pre><p id="33ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">乐趣开始前的最后一步:转到models文件夹(<code class="fe nt nu nv nw b">c://migrationtool/models</code>)并打开index.js文件。在第8行，将config.json替换为config.js。</p><h2 id="07e6" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">摘要</h2><p id="2f02" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们准备好出发了！在我们进入下一步之前，检查一下我们使用的命令。</p><pre class="kj kk kl km gt ny nw nz oa aw ob bi"><span id="49d6" class="nh ml it nw b gy oc od l oe of">#Creating folder<br/>cd c:/<br/>mkdir migrationtool<br/>cd migrationtool</span><span id="81f5" class="nh ml it nw b gy og od l oe of">#Setting up project<br/>npm init</span><span id="3aee" class="nh ml it nw b gy og od l oe of"># installing packages<br/>npm install --save sequelize sequelize-cli<br/>npm install --save pg pg-hstore   # for PostgreSQL<br/>npm install --save tedious        # for SQL Server</span><span id="fd7e" class="nh ml it nw b gy og od l oe of"># Initialize Sequelize<br/>npx sequelize-cli init</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/fc0dc35bc36fc0055ecdad0f732b39e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_jWCMINPRLLftkotT0OGmA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">续集到了，我们开始吧。(照片由<a class="ae ky" href="https://unsplash.com/@handiworknyc" rel="noopener ugc nofollow" target="_blank"> Handiwork NYC </a>在<a class="ae ky" href="https://unsplash.com/photos/x6pnKtPZ-8s" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄)</p></figure><h1 id="024a" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">步骤2:创建迁移</h1><p id="b063" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在Sequelize中，迁移是一个JavaScript文件。它的内容描述了在执行和撤销时应该发生什么，例如“创建一个名为‘person data’的模式。让我们创建一个！</p><h2 id="47e7" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">2.1创建我们的首次迁移</h2><p id="1690" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在您的根文件夹中执行以下命令。<br/> <code class="fe nt nu nv nw b">npx sequelize-cli migration:create -- name create_schemas</code>。这将告诉sequelize创建一个新的迁移。执行这个命令将在我们的migrations-folder中生成一个文件，名称如下:“20210519183705-create _ schemas . js”。在里面你会发现下面的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的第一次迁徙</p></figure><p id="0bea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，迁移包含两个功能“向上”和“向下”。第一个函数将包含实现我们想要做的事情的所有代码；创建模式。第二个功能将取消“向上”功能；它是它的对立面。让我们完成第一次迁移:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">为我们的迁移采取一些行动</p></figure><p id="2443" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码告诉queryInterface创建一个名为“app”的模式。</p><h2 id="fe20" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">2.2创建表迁移</h2><p id="54a0" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">让我们加快一点速度；我们将使用<code class="fe nt nu nv nw b">npx sequelize-cli migration:create -- name create_country_table</code>创建新的迁移。为新创建的迁移提供以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">这在我们的模式中创建了一个新表</p></figure><p id="e2a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种迁移有点奇特。首先，它创建了一个事务，在该事务中定义了一个包含几列的表。然后，它将we索引添加到表中，然后提交它。事务是为了确保要么一切成功，要么什么都没有。如果创建其中一个索引失败，它将回滚到创建表。down函数只是删除新创建的表。</p><p id="d885" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还要注意，创建和修改的列都有默认值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl ok"><img src="../Images/e9dd08f9a8bb4e8d2e2f0282fd4759b6.png" data-original-src="https://miro.medium.com/v2/0*JBMD3HumY-7qkzl0"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的迁移已经确定，让我们构建数据库模型吧！(图<a class="ae ky" href="https://www.pexels.com/@jeshoots-com-147458" rel="noopener ugc nofollow" target="_blank">jeshoots.com</a>在<a class="ae ky" href="https://www.pexels.com/photo/floor-plan-on-table-834892/" rel="noopener ugc nofollow" target="_blank">像素</a>上)</p></figure><h1 id="61cf" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">3.执行和撤销我们的迁移</h1><p id="1094" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们的数据库中还没有发生任何事情。我们刚刚生成了一些现在必须执行的指令。我们希望将指令迁移到数据库中。首先，我们将定义我们的数据库连接，然后我们将使用该连接告诉数据库如何执行迁移</p><h2 id="df06" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">3.1设置数据库连接</h2><p id="42dc" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">编辑config.js文件的内容(在root/config文件夹中)。我已经创建了两个数据库连接:</p><pre class="kj kk kl km gt ny nw nz oa aw ob bi"><span id="bf83" class="nh ml it nw b gy oc od l oe of">module.exports = {<br/>  development: {<br/>    username: "mike",<br/>    password: "my_secret_password",<br/>    database: "country_db_dev",<br/>    host: "localhost",<br/>    port: "5432",<br/>    dialect: "postgres"<br/>  },<br/>  production: {<br/>    username: "mike",<br/>    password: "my_secret_password",<br/>    database: "country_db",<br/>    host: "localhost",<br/>    port: "1433",<br/>    dialect: "mssql"<br/>  }<br/>}</span></pre><p id="4141" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">解释:<br/>我做了两个连接:开发和生产。这些文件允许我们的迁移工具连接到数据库来执行迁移。</p><p id="9a92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们告诉Sequelize执行迁移时，它需要知道要连接到哪个数据库。为此，我们将NODE_ENV设置为我们的一个数据库连接的名称。我们有“开发”和“生产”。让我们与“发展”联系起来。在您的根文件夹中打开一个终端，执行下面的一行(与您的操作系统匹配):</p><pre class="kj kk kl km gt ny nw nz oa aw ob bi"><span id="b8c3" class="nh ml it nw b gy oc od l oe of"># On windows<br/>SET NODE_ENV=development<br/># On OSX<br/>export NODE_ENV=development<br/>#On powershell<br/>$env:NODE_ENV="development"</span></pre><h2 id="c8d3" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">3.2执行迁移</h2><p id="a5e7" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">既然Sequelize知道向何处写入，我们就可以执行迁移了。请注意，在上一步中，我们已经定义了数据库。我们可以执行到任何数据库的迁移，在本文的步骤1.3中我们已经为这些数据库下载了包。这样，我们可以在PostgreSQL中测试我们的迁移，然后将所有内容迁移到我们的SQL Server生产数据库中！<br/>让我们执行:</p><pre class="kj kk kl km gt ny nw nz oa aw ob bi"><span id="8cb1" class="nh ml it nw b gy oc od l oe of">npx sequelize-cli db:migrate</span></pre><p id="7ec6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码将执行所有的迁移，在其中创建我们的模式和一个表，请看:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/c610ce3f2c4d529b1ffb61bafd383991.png" data-original-src="https://miro.medium.com/v2/resize:fit:436/format:webp/1*ktk2cmd8T36Ym59dzkZBQA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们漂亮的表，有列、主键和索引</p></figure><h2 id="ad96" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">3.3撤消迁移</h2><p id="3a57" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">等等，回去！调用下面的代码删除表和模式。<code class="fe nt nu nv nw b">npx sequelize-cli db:migrate:undo:all</code>。看看你的数据库里面，都是干净的！您也可以通过在下面的命令<br/> <code class="fe nt nu nv nw b">npx sequelize-cli db:migrate:undo:all — to XXXXXXXXXXXXXX-create_country_table.js</code>中指定文件名来撤销直到一个特定的迁移</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/50d7c330a9a6eb68d8e997b645397ce4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mztwq0vGSXqTY5WqjwJDVg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们已经成功执行了！(图byu <a class="ae ky" href="https://unsplash.com/@spacex" rel="noopener ugc nofollow" target="_blank"> SpaceX </a>上<a class="ae ky" href="https://unsplash.com/photos/-p-KCm6xB9I" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><h1 id="b5e3" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">4.播种</h1><p id="380f" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">为数据库设定种子非常类似于创建迁移。让我们快速浏览一下代码。</p><h2 id="d079" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">4.1创建种子</h2><p id="f409" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">第一步:生成种子文件<br/> <code class="fe nt nu nv nw b">npx sequelize-cli seed:generate --name seed_country_table</code> <br/>，内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">这将在我们之前创建的表中插入两条记录。向下删除它们</p></figure><h2 id="8b20" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">4.2执行种子</h2><p id="75f0" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">用<code class="fe nt nu nv nw b">npx sequelize-cli db:seed:all</code>执行</p><h2 id="3385" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">4.3撤销种子</h2><p id="5811" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">比如用<br/>撤销种子用<code class="fe nt nu nv nw b">npx sequelize-cli db:seed:undo</code> ` <br/>或者直到一个特定的种子像<br/>T3】</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/0494b3a133253b844c1c81c104c8b37c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v_TOO7LlluGs-JxXyBhpJQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">很难相信这些小种子会成长为一个漂亮的关系数据库模型</p></figure><h1 id="7438" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">结论</h1><p id="0dd1" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们今天完成了相当多的工作！我们已经完成了以下工作:</p><ul class=""><li id="2065" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">安装的节点</li><li id="585e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">已安装的序列和所有必要的软件包</li><li id="3cd4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">配置序列</li><li id="a099" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">创造了一些迁移</li><li id="7d55" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">执行和撤消迁移</li><li id="45ad" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">创造了一些种子</li><li id="d1c7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">已执行和未执行的种子</li></ul><p id="689c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击<a class="ae ky" href="https://mikehuls.medium.com/version-control-your-database-part-2-migrations-and-seeds-for-table-relations-d4fb185d95d8" rel="noopener"> <strong class="lb iu">此处</strong> </a>进入下一部分，我们将关注更高级的内容；我们将开始创建表和策略之间的关联，一旦它所依赖的记录被删除，记录应该如何操作。<a class="ae ky" href="https://mikehuls.medium.com/membership" rel="noopener">关注我</a>敬请期待！</p><p id="0af0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">—迈克</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/8ac47049f05d15a970578ce736accb47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lATXcWtWJRSMOvoCLSnaAA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">这是一篇很长的文章，所以这里有一只小猫，如果你还和我在一起！(照片由<a class="ae ky" href="https://unsplash.com/@joecleary" rel="noopener ugc nofollow" target="_blank">乔·克利里</a>在<a class="ae ky" href="https://unsplash.com/photos/klH-f7mw2Ws" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄)</p></figure></div></div>    
</body>
</html>