<html>
<head>
<title>How NOT to Analyze Time Series</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何不分析时间序列</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-common-mistake-to-avoid-when-working-with-time-series-data-eedf60a8b4c1?source=collection_archive---------10-----------------------#2021-09-29">https://towardsdatascience.com/a-common-mistake-to-avoid-when-working-with-time-series-data-eedf60a8b4c1?source=collection_archive---------10-----------------------#2021-09-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/b17ddcacdc98819915b859898db78262.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BCNlSmMEA4OKy2bj"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">艾萨克·史密斯在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="1fba" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我看到初级数据科学家和面试候选人犯的最常见的时间序列数据错误之一是假设数据有规律的跳动，没有间隙。这是一个糟糕的假设。</p><p id="35ce" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以一次面试练习为例，我向候选人提供了一个数据集，其中包含数百个应用程序的下载和使用指标。我要求候选人从投资的角度来看，找出哪些应用是有趣的，并暗示增长可能是有趣的一个很好的指标。候选人通常会直接计算增长率，方法是将每个应用程序的最新分数与最新分数之前的分数进行比较，然后根据计算出的增长率对应用程序进行排名。这假设每个系列中的最新数据点代表相同的时间点，并且相应的先前点在1个时间单位之外。事实证明，我提供的数据集不是这样的，会导致不正确的结果。数据集中的许多时间序列都有缺失的数据点，并且刻度的间隔不均匀或不一致。正如您在下面的可视化示例中看到的，不考虑变化的分笔成交点大小和数据缺口的简单逐点分析就像将苹果与橙子进行比较。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi le"><img src="../Images/f2e1aafadc6094861f4d2be205a3a6e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wW9gkFuLVj9pg7n6yX4aIg.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">两个不均匀勾选的时间序列-作者图片</p></figure><p id="c8f9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">大多数真实世界的数据集将遭受这种类型的问题，因为它们通常是从有缺陷的系统和过程中排出的，这些系统和过程在设计时没有考虑到分析用例。因此，在进行任何分析或建模之前，理解数据中的这些缺陷并正确地解释它是很重要的。否则，很可能导致垃圾进，垃圾出。</p><p id="e9eb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么，对于时间序列数据，我们如何做到这一点呢？我通常遵循的步骤是</p><ol class=""><li id="354c" class="lj lk it ki b kj kk kn ko kr ll kv lm kz ln ld lo lp lq lr bi translated">通过直观查看示例时间序列，了解时间序列的时间范围和刻度粒度</li><li id="704e" class="lj lk it ki b kj ls kn lt kr lu kv lv kz lw ld lo lp lq lr bi translated">将每个时间序列中的实际刻度数与(最大值减去最小值时间戳)除以刻度间距得出的理论刻度数进行比较。该比率有时被称为填充比率-远小于1的值意味着缺少很多刻度。</li><li id="b721" class="lj lk it ki b kj ls kn lt kr lu kv lv kz lw ld lo lp lq lr bi translated">筛选出填充率低的系列。我经常使用40%作为信息内容不足的界限，但这可能会根据手头的具体任务而有所不同。</li><li id="7c63" class="lj lk it ki b kj ls kn lt kr lu kv lv kz lw ld lo lp lq lr bi translated">通过向上采样到更精细的分辨率，标准化跨时间序列的刻度间距。</li><li id="ae48" class="lj lk it ki b kj ls kn lt kr lu kv lv kz lw ld lo lp lq lr bi translated">为您的分析使用适当的插值方法填充上采样分笔成交点。例如，采用最后已知的值，或者线性/二次插值等</li></ol><p id="7a4c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是我用PySpark实现这种时间序列标准化方法的一些示例代码:</p><figure class="lf lg lh li gt ju"><div class="bz fp l di"><div class="lx ly l"/></div></figure><p id="3bcc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">值得注意的一点是——我在分组的PySpark数据帧上使用了<code class="fe lz ma mb mc b">applyInPandas</code>方法进行插值。在底层，它使用了pandasUDF，相对于PySpark中的普通UDF，它提供了巨大的性能提升。通过Apache Arrow实现更高效的数据传输，通过Pandas矢量化实现更高效的计算，从而提高了性能。只要有可能，总是尽量使用pandasUDF。参见<a class="ae kf" href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.sql.functions.pandas_udf.html" rel="noopener ugc nofollow" target="_blank"> API文档</a>了解更多信息。</p><p id="cdc1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了更直观地说明代码执行时底层时间序列发生了什么，下面是流程各个阶段的图表。希望这能让人们明白，不经过标准化，就不能简单地开始逐点计算增长指标。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi md"><img src="../Images/b92508fcc6026bdf090c4808f4f4ad0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7WasONeNsr7FIfgzRwZ3Ww.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">开始，不均匀打勾时间序列-作者图片</p></figure><p id="fe99" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以1分钟为间隔进行上采样，并使用最后一个已知值进行插值，得出以下时间序列</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/f7155433a3b8fb5174bfee8651893376.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CYdTRUudXKjP3NLNa81XwQ.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">向上采样并用最后一个已知值填充-图片由作者提供</p></figure><p id="cde6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上采样和线性插值产生以下结果</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mf"><img src="../Images/8670dffe355453d25aea716d39fd94a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WQjHmRVZwSnq4MS4oRuYKw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">向上采样和线性插值—图片由作者提供</p></figure><p id="5eb0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">只是为了好玩，五次多项式插值</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mg"><img src="../Images/8c2dada8156c0ee992a09a35cd82b0f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gGCKRY0fFMcJK1lsg9akcw.png"/></div></div></figure><p id="25e2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">希望这是一次有益的讨论，我已经帮助你避免将来犯这样的错误。如果您有任何意见或问题，请随时联系我们。<a class="ae kf" href="https://twitter.com/yifei_huang" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae kf" href="https://www.linkedin.com/in/yifeihuangdatascience/" rel="noopener ugc nofollow" target="_blank">Linkedin</a>|<a class="ae kf" href="https://yifei-huang.medium.com/" rel="noopener">Medium</a></p></div></div>    
</body>
</html>