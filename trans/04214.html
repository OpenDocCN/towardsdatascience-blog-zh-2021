<html>
<head>
<title>Estimating Bike Availability from NYC Bike Share Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">根据纽约市自行车份额数据估计自行车的可用性</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/estimating-bike-availability-from-nyc-bike-share-data-7cfc4655d5f6?source=collection_archive---------27-----------------------#2021-04-09">https://towardsdatascience.com/estimating-bike-availability-from-nyc-bike-share-data-7cfc4655d5f6?source=collection_archive---------27-----------------------#2021-04-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4fc1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用熊猫来重组花旗自行车的行程记录，以估计一个车站全天可用的自行车数量</h2></div><p id="2917" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">自行车共享系统要想取得成功，会员必须随时随地都可以使用自行车。对于像纽约市的Citi Bike这样使用带码头的固定站点的系统，在骑行结束时必须有空码头，以便会员可以归还自行车并上路。</p><p id="a5bb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">自行车和空码头的可用性是任何自行车共享系统的有用指标。虽然Citi Bike没有提供这方面的信息，但可以根据现有的出行数据进行估算。在本文中，我将展示如何做到这一点。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/13bdd4e24c803a1fa035ec7543443621.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hVgIw1cvwsWYeU_H5reQQw.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">宾州车站附近的自行车站——图片由作者提供</p></figure><p id="68e5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如何确定自行车(和码头)的可用性？Citi Bike以网络服务的形式提供了一个关于站点状态的<em class="lr">实时</em>反馈，包括可用自行车和停靠站的数量。在<a class="ae ls" href="https://www.citibikenyc.com/system-data" rel="noopener ugc nofollow" target="_blank">花旗自行车系统数据</a>页面上可以找到描述和URL的链接。</p><p id="5d1b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">获得<em class="lr">历史</em>数据更成问题。使用电台状态信息需要编写一个程序，定期查询节目源并保存信息。这在过去已经完成并可用，例如在<a class="ae ls" href="http://theopenbus.com" rel="noopener ugc nofollow" target="_blank">theopenbus.com</a>，但自2019年4月以来一直没有更新。</p><p id="5472" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，Citi Bike每月提供tripdata文件，记录每次行程，包括起止时间和站点。使用这些数据来估计自行车的可用性是可能的。</p><p id="a8bf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本文是探索花旗自行车提供的自行车份额数据系列的一部分。其他文章包括:</p><p id="f752" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae ls" rel="noopener" target="_blank" href="/exploring-bike-share-data-3e3b2f28760c">探索纽约市自行车共享数据</a> —介绍使用Jupyter、Python、Pandas和Seaborn进行数据准备和分析。</p><p id="1d7e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae ls" rel="noopener" target="_blank" href="/interpolating-nyc-bike-share-data-to-discover-rebalancing-movements-6cf8a80eb902">内插纽约自行车共享数据以发现再平衡运动</a>-解释如何使用花旗自行车为每次骑行提供的数据来发现自行车何时在骑行之间移动以进行再平衡。</p><h1 id="8e1b" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">估计自行车和码头的可用性</h1><p id="90bd" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">在每次旅行中，一辆自行车在一个车站上车，在另一个车站下车。当一辆自行车被取走时，起点站就少了一辆<em class="lr">自行车；当它被放下时，在终点站还有一辆<em class="lr">自行车。</em></em></p><p id="b307" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了表示这个活动，我首先阅读一个月的tripdata文件。我把它分成两个数据帧:一个用于接送，一个用于接送。然后，我将两个数据帧连接起来，并按照旅程开始的时间进行排序。这提供了每个站点的所有活动，因此我可以看到自行车数量如何波动。</p><p id="ca57" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，这种方法有两个问题:</p><ul class=""><li id="8331" class="mq mr iq kh b ki kj kl km ko ms ks mt kw mu la mv mw mx my bi translated">月初车站里自行车的数量还不知道。</li><li id="f24e" class="mq mr iq kh b ki mz kl na ko nb ks nc kw nd la mv mw mx my bi translated">它没有考虑到重新平衡、因维修而移除的自行车或添加到系统中的自行车。</li></ul><p id="fab0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但这些都不是不可克服的问题。</p><h2 id="a2cd" class="ne lu iq bd lv nf ng dn lz nh ni dp md ko nj nk mf ks nl nm mh kw nn no mj np bi translated">下载数据和导入库</h2><p id="1cb4" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">从下载并解压一个月的数据开始。Tripdata文件可以从上面链接的数据页面下载，该页面还包括可用列的描述。在这篇文章中，我使用了2020年9月的数据。</p><p id="14e3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Linux命令提示符下输入以下命令:</p><pre class="lc ld le lf gt nq nr ns nt aw nu bi"><span id="4186" class="ne lu iq nr b gy nv nw l nx ny">mkdir bikeshare &amp;&amp; cd bikeshare<br/>wget <a class="ae ls" href="https://s3.amazonaws.com/tripdata/202009-citibike-tripdata.csv.zip" rel="noopener ugc nofollow" target="_blank">https://s3.amazonaws.com/tripdata/202009-citibike-tripdata.csv.zip</a> <br/>unzip 202009-citibike-tripdata.zip<br/>rm -f 202009-citibike-tripdata.zip</span></pre><p id="c184" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在您的<code class="fe nz oa ob nr b">bikeshare</code>目录中创建一个Jupyter笔记本。这里用到的所有代码都可以在GitHub上找到，名为<a class="ae ls" href="https://github.com/ckran/bikeshare/blob/main/availability.ipynb" rel="noopener ugc nofollow" target="_blank">avail ability . ipynb</a>。</p><p id="9bf0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">导入所需的库:</p><pre class="lc ld le lf gt nq nr ns nt aw nu bi"><span id="a262" class="ne lu iq nr b gy nv nw l nx ny">import pandas as pd<br/>import seaborn as sns<br/>import matplotlib.pyplot as plt<br/>from matplotlib.dates import DateFormatter</span></pre><p id="d198" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将tripdata加载到数据帧中。九月对花旗自行车来说是一个繁忙的月份，实际上是迄今为止最繁忙的月份，有近200万次骑行，所以为了减少数据帧的大小，我只阅读我需要用<code class="fe nz oa ob nr b">usecols</code>的列。我希望开始和结束时间值被读取为<code class="fe nz oa ob nr b">datetime</code>值，所以对它们使用<code class="fe nz oa ob nr b">parse_date</code>。</p><pre class="lc ld le lf gt nq nr ns nt aw nu bi"><span id="9916" class="ne lu iq nr b gy nv nw l nx ny">df = pd.read_csv('~/bikeshare/202009-citibike-tripdata.csv',\<br/>        usecols=['starttime','start station id',\<br/>                 'stoptime','end station id'],\<br/>        parse_dates=['starttime','stoptime'])<br/>df.info()</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/53b42d591d8053109a263cf4f64b5f5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*mwj1ZMyF4bkbwyU6dAJ77w.png"/></div></figure><h2 id="c727" class="ne lu iq bd lv nf ng dn lz nh ni dp md ko nj nk mf ks nl nm mh kw nn no mj np bi translated">调整资金组合</h2><p id="24b6" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">为了确保在需要时有自行车和码头可用，Citi Bike通过将自行车从有剩余的车站转移到需要的地方来“重新平衡”自行车。虽然这些运动中的大部分不会出现在tripdata文件中，但是可以通过在系统中骑自行车来推断它们。当一辆自行车似乎从一个站点移动到另一个站点而没有骑手时，我认为这是一次重新平衡(或维护)的移动。</p><p id="03b6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">参见我的文章<a class="ae ls" rel="noopener" target="_blank" href="/interpolating-nyc-bike-share-data-to-discover-rebalancing-movements-6cf8a80eb902">内插纽约市自行车共享数据以发现再平衡运动</a>，了解确定这些运动发生的时间和地点的方法。我创建了一个拼花文件，其中记录了每次移动，格式与实际乘坐相同。</p><blockquote class="od oe of"><p id="7cf5" class="kf kg lr kh b ki kj jr kk kl km ju kn og kp kq kr oh kt ku kv oi kx ky kz la ij bi translated">要从Python中读取一个Parquet文件，请安装pyarrow库:<br/> <code class="fe nz oa ob nr b"><em class="iq">conda install -c conda-forge pyarrow</em></code></p></blockquote><p id="8aa9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以按照那篇文章中的描述创建文件，并在本地读取它，或者从我的Github存储库中读取一个保存的副本:</p><pre class="lc ld le lf gt nq nr ns nt aw nu bi"><span id="f150" class="ne lu iq nr b gy nv nw l nx ny">dfrebal = pd.read_parquet \ ('<a class="ae ls" href="https://github.com/ckran/bikeshare/blob/main/202009-citibike-reblance.parquet" rel="noopener ugc nofollow" target="_blank">https://github.com/ckran/bikeshare/blob/main/202009-citibike-reblance.parquet</a>')</span></pre><p id="f7f9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该文件具有与tripdata文件相同的列和39，560个条目，这表示找到的重新平衡移动的数量。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/6f0352de4ba0cd2626e71e8696076b8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*PH39H-HwO5ZvYAGjalUtYg.png"/></div></figure><p id="8a4d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将tripdata文件中的游乐设备与再平衡运动连接起来，使它们都在一个数据帧中。</p><pre class="lc ld le lf gt nq nr ns nt aw nu bi"><span id="25ad" class="ne lu iq nr b gy nv nw l nx ny">df = pd.concat([df,dfrebal])<br/>df.reset_index(drop=True, inplace=True)<br/>df</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/3e585c005c1f5309bfd11fcbe80a75aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*P2twb9PpkAhvRGZZIEB0LQ.png"/></div></figure><h2 id="1d6d" class="ne lu iq bd lv nf ng dn lz nh ni dp md ko nj nk mf ks nl nm mh kw nn no mj np bi translated">从旅行到行动的重组</h2><p id="62e8" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">通过创建两个数据帧，将一行中的每个行程(包括开始和结束时间及站点)拆分为两行，并增加一列<code class="fe nz oa ob nr b">act</code>来指示发生的动作:</p><ul class=""><li id="d73e" class="mq mr iq kh b ki kj kl km ko ms ks mt kw mu la mv mw mx my bi translated"><code class="fe nz oa ob nr b">dfs</code>(拾音器)<code class="fe nz oa ob nr b">starttime</code>、<code class="fe nz oa ob nr b">start station id</code>和<code class="fe nz oa ob nr b">act</code>设置为-1</li><li id="5e6f" class="mq mr iq kh b ki mz kl na ko nb ks nc kw nd la mv mw mx my bi translated"><code class="fe nz oa ob nr b">dfe</code>(下降)<code class="fe nz oa ob nr b">stoptime</code>、<code class="fe nz oa ob nr b">end station id</code>和<code class="fe nz oa ob nr b">act</code>设置为+1</li></ul><pre class="lc ld le lf gt nq nr ns nt aw nu bi"><span id="43ad" class="ne lu iq nr b gy nv nw l nx ny">dfs=df[['starttime','start station id']].assign(act=-1)<br/>dfe=df[['stoptime','end station id']].assign(act=1)</span></pre><p id="b657" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">重命名中的列，使它们匹配并将两个数据框架连接成一个新的数据框架。</p><pre class="lc ld le lf gt nq nr ns nt aw nu bi"><span id="9963" class="ne lu iq nr b gy nv nw l nx ny">dfs.columns=['docktime','stationid','act']<br/>dfe.columns=['docktime','stationid','act']<br/>dfse=pd.concat([dfs,dfe])</span></pre><h2 id="14f3" class="ne lu iq bd lv nf ng dn lz nh ni dp md ko nj nk mf ks nl nm mh kw nn no mj np bi translated">按时间排序</h2><p id="be5f" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">最后，按<code class="fe nz oa ob nr b">docktime</code>对数据帧进行排序；删除并重新创建索引。</p><pre class="lc ld le lf gt nq nr ns nt aw nu bi"><span id="7f02" class="ne lu iq nr b gy nv nw l nx ny">dfse.sort_values(by=['docktime'], inplace=True) <br/>dfse.reset_index(drop=True, inplace=True) <br/>dfse.head(100)</span></pre><p id="3ae8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，所有的接送都按照发生的顺序进行:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ol"><img src="../Images/ee0ec5f31583264f89b35771a6e512f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*PYWppyhB8-Sd_no7v-8CjQ.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">车站开始和停止</p></figure><h1 id="b873" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">可视化车站流量</h1><p id="f522" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">使用花旗自行车时，唯一真正重要的自行车(或码头)可用性是你所站的车站。这种分析对单个站最有用。</p><p id="5c27" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以前，我在一家软件公司工作，办公室就在宾夕法尼亚车站的正上方。我最熟悉的花旗自行车站在第七大道对面，名为<strong class="kh ir"> W 31 St &amp; 7 Ave. </strong>在早高峰期间，它基本上是空的，因为通勤者会在佩恩站从他们的火车上下来，拿起自行车，很快清空了所有的码头。白天，骑手们来来往往，但通常只有几辆自行车。在下午高峰期间，花旗自行车站会挤满人，因为通勤者会在进入火车站之前归还他们的自行车。事实上，当我下班后去那里取自行车时，总有人在等着码头开放。我想看看那个车站的用法图是否能反映我的经历。</p><h2 id="5a46" class="ne lu iq bd lv nf ng dn lz nh ni dp md ko nj nk mf ks nl nm mh kw nn no mj np bi translated">获取电台名称</h2><p id="0c7b" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">虽然tripdata文件包含每次旅行的车站名称，但我没有将它们包含在dataframe中，因为这样做会使data frame非常大，因为几乎有200万行，但现在我需要它们。</p><p id="4e6e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要在我的图表中包含站点名称，请创建一个数据框架作为查找表，每个站点占一行(大约只有一千个站点)。</p><pre class="lc ld le lf gt nq nr ns nt aw nu bi"><span id="a61c" class="ne lu iq nr b gy nv nw l nx ny">dfstations = \<br/>  pd.read_csv('~/bikeshare/202009-citibike-tripdata.csv',\<br/>  usecols=['start station id','start station name']).\<br/>  drop_duplicates()                <br/>dfstations.columns=['stationid','station name']<br/>dfstations.set_index('stationid',drop=True, inplace=True)</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi om"><img src="../Images/8d73de0a21dcc6afc0807dbbdad11a40.png" data-original-src="https://miro.medium.com/v2/resize:fit:614/format:webp/1*_Cz9v5aYroDoauapa_jvmw.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">电台ID和名称查找表</p></figure><h2 id="8e7e" class="ne lu iq bd lv nf ng dn lz nh ni dp md ko nj nk mf ks nl nm mh kw nn no mj np bi translated">为一个站创建一个数据帧</h2><p id="b486" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">首先从<code class="fe nz oa ob nr b">dfstations</code>数据帧中获取感兴趣站点的站点ID。然后创建一个新的数据帧，只包含该站的行。</p><pre class="lc ld le lf gt nq nr ns nt aw nu bi"><span id="65c5" class="ne lu iq nr b gy nv nw l nx ny">sid = dfstations.loc[dfstations['station name']\<br/>     =='W 31 St &amp; 7 Ave'].index[0]</span><span id="d4d7" class="ne lu iq nr b gy on nw l nx ny">dfstation = dfse.loc[(dfse.stationid==sid) ]<br/>dfstation.reset_index(drop=True, inplace=True)</span></pre><h2 id="6b47" class="ne lu iq bd lv nf ng dn lz nh ni dp md ko nj nk mf ks nl nm mh kw nn no mj np bi translated">计算一个站点的自行车数量</h2><p id="4805" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">通过计算<code class="fe nz oa ob nr b">act</code>列的累计和，我可以看到车站自行车数量的增加和减少:</p><pre class="lc ld le lf gt nq nr ns nt aw nu bi"><span id="fd27" class="ne lu iq nr b gy nv nw l nx ny">dfstation = dfstation.assign(cnt = dfstat.act.cumsum())<br/>dfstation.head(10)</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/6c5e9683275075cfb95d274b8b5ff75a.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*Jqe4Z06pAjpR9b997KDaww.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">运行总和的车站活动</p></figure><p id="9f43" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从9月1日午夜开始，它显示自行车的数量随着骑车人放下自行车而增加，随着他们捡起自行车而减少。问题是<code class="fe nz oa ob nr b">cnt</code>从<em class="lr">零</em>辆自行车开始，这是不准确的。随着越来越多的自行车被捡起来，数量将下降到零以下，这当然是不可能的。</p><p id="9799" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我可以通过计算曾经达到的最小数字并将其添加到第一个单元格来避免这种情况。这个数字是猜测，但总比没有强。然后重新计算。</p><pre class="lc ld le lf gt nq nr ns nt aw nu bi"><span id="a09b" class="ne lu iq nr b gy nv nw l nx ny">dfstation.at[0, 'act'] =+ abs(dfstation.act.cumsum().min())</span><span id="3888" class="ne lu iq nr b gy on nw l nx ny">dfstation = dfstation.assign(cnt = dfstat.act.cumsum())<br/>dfstation.head(10)</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/2b87647a07d48e3e74142e2bcfa2285e.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*bs-R7hLdbPpkgC8jwR5gog.png"/></div></figure><h2 id="4e75" class="ne lu iq bd lv nf ng dn lz nh ni dp md ko nj nk mf ks nl nm mh kw nn no mj np bi translated">该月的绘图可用性</h2><p id="78dd" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">现在，我可以创建一个图表，显示这个站点九月份的可用自行车数量。每当地块触底时，车站是空的，当它触顶时，车站是满的。</p><pre class="lc ld le lf gt nq nr ns nt aw nu bi"><span id="71ec" class="ne lu iq nr b gy nv nw l nx ny">sns.set(font_scale = 1)<br/>plt.figure(figsize=(20,5))<br/>ax=sns.lineplot(data=dfstation , x='docktime', y='cnt' ) <br/>ax.set_xlabel('Day')<br/>ax.set_ylabel('Available Bikes') ;</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi op"><img src="../Images/854e9f4ec6e7a7a82592ff4dca103ad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6VSJqj0FkBk9Rq7Yn9j-VQ.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated"><strong class="bd oq">W 31 St&amp;7 Ave</strong>2020年9月使用——图片由作者提供</p></figure><p id="c23e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">月图显示了可用性的变化，但它太压缩了，我看不出这是否是我所期望的。一天一天地看可能更好。</p><h2 id="ee04" class="ne lu iq bd lv nf ng dn lz nh ni dp md ko nj nk mf ks nl nm mh kw nn no mj np bi translated">绘制一天的可用性</h2><p id="3141" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">我选择了9月8日，那天是劳动节的第二天。我使用<code class="fe nz oa ob nr b">DateFormatter</code>将日期值格式化为一天中的小时。</p><pre class="lc ld le lf gt nq nr ns nt aw nu bi"><span id="2a7d" class="ne lu iq nr b gy nv nw l nx ny">sns.set(font_scale = 1)<br/>plt.figure(figsize=(20,8))<br/>ax=sns.lineplot(data=dfstation.loc[dfstation.docktime.dt.day == 8],\<br/>    x='docktime', y='cnt'  ) <br/>ax.set_ylabel('Available Bikes')<br/>ax.set_xlabel('Hour of Day') <br/>ax.set_title('Citi Bike station - '+station+' - September 8, 2020')<br/>ax.xaxis.set_major_formatter(DateFormatter("%H")) ;</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi or"><img src="../Images/609a759596ca95a94896cc5bd5853bab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HfBFFztvF3od26L4UbpK0w.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">一个站点一天的站点使用量</p></figure><p id="5de5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这显示了车站在一天中的大部分时间都是空的或接近空的，直到下午它经常是满的。这是我所期望的。</p><p id="ff94" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，这个车站靠近一个交通枢纽。位于商业区或居民区的车站呢？</p><h2 id="216f" class="ne lu iq bd lv nf ng dn lz nh ni dp md ko nj nk mf ks nl nm mh kw nn no mj np bi translated">其他站点的可用性</h2><p id="4dc4" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">要查看其他站，请将代码放入函数中:</p><pre class="lc ld le lf gt nq nr ns nt aw nu bi"><span id="b802" class="ne lu iq nr b gy nv nw l nx ny">def availabilty (station,day):<br/>    # inputs: station name, day <br/>    # requires: dfstations, dfse <br/>    sid = dfstations.loc[dfstations['station name']==station]\<br/>        .index[0] # lookup station id <br/>    dfstation = dfse.loc[(dfse.stationid==sid) ] <br/>    dfstation.reset_index(drop=True, inplace=True)<br/>    dfstation = dfstation.assign(cnt = dfstation.act.cumsum()) <br/>    dfstation.at[0, 'act'] =+ abs(dfstation.act.cumsum().min())<br/>    dfstation = dfstation.assign(cnt = dfstation.act.cumsum()) <br/>    <br/>    # Create chart <br/>    sns.set(font_scale = 2)<br/>    plt.figure(figsize=(20,8))<br/>    ax=sns.lineplot(data=dfstation.\<br/>     loc[dfstation.docktime.dt.day == day],x='docktime',y='cnt' ) <br/>    ax.set_ylabel('Available Bikes')<br/>    ax.set_xlabel('Hour of Day') <br/>    ax.set_title\<br/>     ('Citi Bike Station - ' + station +' - September ' + str(day))<br/>    ax.xaxis.set_major_formatter(DateFormatter("%H")) ;</span></pre><p id="1ade" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我将在洛克菲勒中心的一个电视台播放，这是一个大型会议酒店附近的大型办公楼群。加油站在早上六点到九点之间加满油，一天的大部分时间都是满的，下午五点后很快就空了，一天的其余时间几乎都是空的。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi os"><img src="../Images/5402ce2b1c4881b05b87ed86e48625e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gBZ3QnuEsthe-xxW-2XmVA.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">洛克菲勒中心的花旗自行车——作者图片</p></figure><p id="40d5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我将查看一个大型公寓楼附近的一个车站的主要居民区。那个车站一夜爆满，在早高峰和全天都是空的，然后在晚高峰又被填满。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ot"><img src="../Images/81df015ac22abdc913fb118fb6b4461b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZdnLmAjQV1BgVUeGV4zexw.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">施托伊弗桑特镇附近的花旗自行车——图片由作者提供</p></figure><h1 id="818a" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">结论</h1><p id="a01b" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">尽管Citi Bike不提供有关自行车和码头可用性的历史数据，但可以从反映实际站点使用情况的tripdata文件中得出估计值。</p></div></div>    
</body>
</html>