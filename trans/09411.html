<html>
<head>
<title>Custom Loss Function in TensorFlow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">张量流中的自定义损失函数</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/custom-loss-function-in-tensorflow-eebcd7fed17a?source=collection_archive---------9-----------------------#2021-09-01">https://towardsdatascience.com/custom-loss-function-in-tensorflow-eebcd7fed17a?source=collection_archive---------9-----------------------#2021-09-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="49f6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过创建要优化的函数来定制您的算法</h2></div><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="kn ko l"/></div></figure><p id="c3da" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">在我们进入机器学习和深度学习世界的旅程中，很快将有必要从整体上处理模型、优化器、损失函数、层和算法的其他基本组件的定制。<strong class="kr iu"> Tensorflow </strong>和<strong class="kr iu"> Keras </strong>有大量预先实现和优化的损失函数，在工作环境中很容易调用。然而，可能有必要开发<strong class="kr iu">个性化和原始损失函数</strong>，以完全满足我们对模型表征的需求。</p><h2 id="fe4d" class="ll lm it bd ln lo lp dn lq lr ls dp lt ky lu lv lw lc lx ly lz lg ma mb mc md bi translated">为什么要看这篇文章？</h2><p id="9e6f" class="pw-post-body-paragraph kp kq it kr b ks me ju ku kv mf jx kx ky mg la lb lc mh le lf lg mi li lj lk im bi translated">在本文和上面的youtube视频中，我们将回忆损失函数和成本函数的基本概念，然后我们将看到如何使用Keras API在tensorflow中创建一个自定义损失函数并子类化Keras的基类“loss”。然后，我们将看到如何创建一个示例损失，在这种情况下，一个定制的回归问题的准确性。我提醒你遵循我的<a class="ae mj" href="https://medium.com/@marcosanguineti" rel="noopener">中</a>个人资料来支持这项工作。你可以在我的个人资料上找到这个系列的所有其他文章，在我的YouTube频道上找到这个系列的所有其他视频。您还可以在git <a class="ae mj" href="https://github.com/GitMarco27/TMML" rel="noopener ugc nofollow" target="_blank">存储库</a>中找到所有脚本。</p><h2 id="bd33" class="ll lm it bd ln lo lp dn lq lr ls dp lt ky lu lv lw lc lx ly lz lg ma mb mc md bi translated">损失函数</h2><p id="d6dd" class="pw-post-body-paragraph kp kq it kr b ks me ju ku kv mf jx kx ky mg la lb lc mh le lf lg mi li lj lk im bi translated">在数学优化、统计学、机器学习和<strong class="kr iu">深度学习</strong>中<a class="ae mj" href="https://en.wikipedia.org/wiki/Loss_function" rel="noopener ugc nofollow" target="_blank"> <strong class="kr iu">损失函数</strong> </a>(也称为代价函数或误差函数)是定义一系列值和一个实数之间的相关性的函数。这个数字在概念上代表了与一个事件或一组价值相关的<strong class="kr iu">成本</strong>。通常，优化程序的目标是<strong class="kr iu">最小化</strong>损失函数。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/73d7b17af407f839d2eec3e41a0ddacd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hX2OxD_ezOllgLE8"/></div></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">照片由<a class="ae mj" href="https://unsplash.com/@volkanolmez?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">沃尔坎·奥尔梅斯</a>在<a class="ae mj" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="4bc3" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">正如官方<a class="ae mj" href="https://en.wikipedia.org/wiki/Loss_function" rel="noopener ugc nofollow" target="_blank">维基百科页面</a>所述，“良好的统计实践要求选择与特定应用环境中经历的实际变化一致的<strong class="kr iu">估计函数</strong>。因此，在实践中，选择何种统计方法来模拟一个应用问题，取决于对因问题具体情况而产生的成本的了解。”</p><p id="b8cb" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">对于大多数优化算法，希望有一个损失函数是全局<strong class="kr iu">连续的</strong>和<strong class="kr iu">可微的</strong>。两个非常常用的目标函数是<strong class="kr iu">均方误差</strong>和<strong class="kr iu">偏差</strong>。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/3378f72c43d279314992d25a50d78edc.png" data-original-src="https://miro.medium.com/v2/resize:fit:322/1*hF5SPqSDJp8YN4nTWt8LlA.gif"/></div></figure><p id="5700" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">“然而，<strong class="kr iu">偏差</strong>(利用绝对值)的缺点是在<em class="mw"> a=0 </em>处不可微分。一个<strong class="kr iu">二次函数</strong>有一个缺点，就是当对一组数值<em class="mw"> a </em>求和时，最终的和往往是一些特别大的数据<em class="mw"> a </em>的值，而不是平均值的表达式。”</p><p id="ffa8" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">目标函数的选择不是任意的，有时会受到希望利用的期望属性的限制。</p><h2 id="cb95" class="ll lm it bd ln lo lp dn lq lr ls dp lt ky lu lv lw lc lx ly lz lg ma mb mc md bi translated">张量流中的自定义损失函数</h2><p id="9fb7" class="pw-post-body-paragraph kp kq it kr b ks me ju ku kv mf jx kx ky mg la lb lc mh le lf lg mi li lj lk im bi translated">在我们的例子中，我们使用的数据集已经在本系列的其他视频和文章中使用过。我说的是NASA开发的<a class="ae mj" href="https://archive.ics.uci.edu/ml/datasets/airfoil+self-noise" rel="noopener ugc nofollow" target="_blank">自噪声数据集</a>，找到这篇<a class="ae mj" rel="noopener" target="_blank" href="/custom-layers-in-tensorflow-4dbd7c194b6e">文章</a>了解更多信息。在使用<strong class="kr iu"> Tensorflow </strong>和<strong class="kr iu"> Keras </strong>开发人工智能算法的过程中，我最喜欢的功能之一是能够完全定制训练的每个方面，同时保持这些API使用的简单性和流畅性。</p><p id="cd3f" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">为了理解<strong class="kr iu">自定义损失函数</strong>的重要性，让我们从一个简短的例子开始。您想在数据集上训练一个回归变量，但数据中有太多噪音。您可能会继续进行数据预处理(数据清理、删除/修复异常值……)，但是让我们假设这个过程还不够。在加载、标准化和拆分数据之后，您已经创建了神经网络拓扑，但是您仍然需要编译您的模型并定义适当的优化器和损失函数。均方误差(<strong class="kr iu"> mse </strong>)可能会过多地惩罚异常值，而平均绝对误差(<strong class="kr iu"> mae </strong>)不会对它们进行足够的惩罚，并且训练可能会太长且不准确。对于这个特定的应用程序，我们可以考虑一个完全自定义的损失函数，Keras API没有提供。对于这个应用，<strong class="kr iu"> Huber损耗</strong>可能是一个不错的解决方案！我们可以找到这个预实现的损失函数(<em class="mw"> tf.keras.losses.Huber </em>)，但是让我们创建这个损失函数的完整定制版本。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="mx ko l"/></div></figure><p id="07f8" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">我们可以注意到，我们只需指定自定义损失函数的参数:模型输出的真实值和预测值。但是，Tensorflow语法只需要这两个参数，不需要其他参数。要生成一个参数损失函数，我们可以继续使用给出的解决方法:一个double函数，外部函数返回内部方法。这允许我们在此范围内引入新的属性，即定义Huber损失函数的阈值！</p><p id="f5ed" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">为了从我们的算法中获得最佳效果，我们可以:</p><ol class=""><li id="b5fe" class="my mz it kr b ks kt kv kw ky na lc nb lg nc lk nd ne nf ng bi translated">更喜欢我们函数的矢量化实现</li><li id="511d" class="my mz it kr b ks nh kv ni ky nj lc nk lg nl lk nd ne nf ng bi translated">仅使用TensorFlow操作，以受益于TensorFlow的图形功能</li><li id="5105" class="my mz it kr b ks nh kv ni ky nj lc nk lg nl lk nd ne nf ng bi translated">返回包含每个实例一个损失的张量，而不是平均损失。这允许Keras在必要时应用类别/样本权重。</li></ol><p id="1e39" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">在参考YouTube视频/Colab笔记本中，我为一个回归问题创建了一个<strong class="kr iu">自定义精度损失</strong>，定义为:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/38413501dd8edeb09d169e8e6e0757c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:326/1*iX1363sLIvmKm_fqWNZH4w.gif"/></div></figure><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="mx ko l"/></div></figure><p id="84f0" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">我们只需用我们的客户损失编译我们的模型，并训练回归器。对于这个应用程序，我已经子类化了<em class="mw"> tf.keras.losses.Loss的Loss类，但这不是强制性的。</em></p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/7642363f596d58fea90b0a9e12adb861.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*GtJiwSeiGCPyWGpEn5HFIw.png"/></div><p class="mr ms gj gh gi mt mu bd b be z dk translated">损失函数趋势-按作者分类的图像</p></figure><h2 id="4fcb" class="ll lm it bd ln lo lp dn lq lr ls dp lt ky lu lv lw lc lx ly lz lg ma mb mc md bi translated">结论</h2><p id="72f0" class="pw-post-body-paragraph kp kq it kr b ks me ju ku kv mf jx kx ky mg la lb lc mh le lf lg mi li lj lk im bi translated">我们回顾了损失函数的关键概念，了解了如何在Tensorflow中为两个不同的问题创建完全定制的损失函数，并举例说明了一个应用案例。我们看到了一些从我们的实现中获得最佳效果的方法。我希望你喜欢这篇文章，欢迎任何反馈。</p><p id="2c81" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated"><br/>下次见，马尔科</p><h1 id="294b" class="no lm it bd ln np nq nr lq ns nt nu lt jz nv ka lw kc nw kd lz kf nx kg mc ny bi translated">3分钟机器学习</h1><p id="0878" class="pw-post-body-paragraph kp kq it kr b ks me ju ku kv mf jx kx ky mg la lb lc mh le lf lg mi li lj lk im bi translated">3分钟机器学习是一系列与人工智能、深度学习和数据科学相关的教程、视频和文章。你可以在YouTube 上找到完整的视频集。GitHub <a class="ae mj" href="https://github.com/GitMarco27/TMML" rel="noopener ugc nofollow" target="_blank">库</a>包含了文章和视频中显示的所有Google Colab笔记本。希望这些内容对你有用，或者只是你感兴趣。欢迎任何反馈。</p><p id="076d" class="pw-post-body-paragraph kp kq it kr b ks kt ju ku kv kw jx kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">查看其他剧集:</p><ul class=""><li id="af34" class="my mz it kr b ks kt kv kw ky na lc nb lg nc lk nz ne nf ng bi translated"><a class="ae mj" rel="noopener" target="_blank" href="/images-generation-with-neural-style-transfer-and-tensorflow-a823b0353b06">用神经风格转移和张量流生成图像</a></li><li id="557d" class="my mz it kr b ks nh kv ni ky nj lc nk lg nl lk nz ne nf ng bi translated"><a class="ae mj" rel="noopener" target="_blank" href="/cats-vs-dogs-convolutional-classifier-44ec04c8eb7a">猫VS狗卷积分类器</a></li><li id="2ac9" class="my mz it kr b ks nh kv ni ky nj lc nk lg nl lk nz ne nf ng bi translated"><a class="ae mj" rel="noopener" target="_blank" href="/plot-a-tensorflow-model-with-keras-functional-api-f2db639dbbd8">使用Keras Functional API绘制张量流模型</a></li><li id="e5bc" class="my mz it kr b ks nh kv ni ky nj lc nk lg nl lk nz ne nf ng bi translated"><a class="ae mj" rel="noopener" target="_blank" href="/neural-network-for-predicting-the-energy-performance-of-a-building-5c2bf5820ebe">预测建筑物能源性能的神经网络</a></li><li id="4deb" class="my mz it kr b ks nh kv ni ky nj lc nk lg nl lk nz ne nf ng bi translated"><a class="ae mj" rel="noopener" target="_blank" href="/custom-layers-in-tensorflow-4dbd7c194b6e">tensor flow中的自定义图层</a></li></ul></div></div>    
</body>
</html>