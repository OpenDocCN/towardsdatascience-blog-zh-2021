<html>
<head>
<title>A Data Scientist’s Guide to Fetching COVID-19 Data in 2022</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">获取 2022 年新冠肺炎数据的数据科学家指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-data-scientists-guide-to-fetching-covid-19-data-in-2022-d952b4697?source=collection_archive---------7-----------------------#2021-12-24">https://towardsdatascience.com/a-data-scientists-guide-to-fetching-covid-19-data-in-2022-d952b4697?source=collection_archive---------7-----------------------#2021-12-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="abe0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">有时候，完成一件事的最好方法是自己动手。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/537934fd1a2a78961a6c9a3f59feb3d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y-d6g4-EpSjaYTJJPHLdzA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">用于显示县数据的自定义 Grafana 仪表板。(图片由作者提供)</p></figure><p id="6e6a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在疫情的早期，数据科学家和分析师构建 COVID 跟踪仪表板是一种流行的做法。许多公共 API 被启动，但是这些服务一个接一个地被离线。截至 2021 年 12 月，<a class="ae lr" href="https://github.com/nytimes/covid-19-data" rel="noopener ugc nofollow" target="_blank">New York Times GitHub repository</a>仍然是最后的高质量 COVID 数据源之一，但即使是这个数据源也不全面，在您的项目中使用起来可能会很尴尬(它是通过 CSV 文件分发的)。</p><p id="5dd6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">尽管聚合器停止发布精选数据，各州卫生部门继续努力报告各县的 COVID 统计数据。例如，天气频道在显示当前 COVID 信息时，将每个州的卫生部门作为其数据源。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/0e27321a2009d8da7646b2886cad37dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j95riA-F77aMWVQ8oQZ3mw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Weather.com 直接从美国获取数据。(图片由作者提供)</p></figure><p id="8ace" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">比起依赖像《纽约时报》这样的中间人，你可以很容易地编写自己的脚本直接从美国获取。在本文中，我将向您展示如何快速接收县的 COVID 数据。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="9b98" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">动机</h1><p id="3b58" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">几周前，一位客户向我咨询如何自动跟踪特定位置的新冠肺炎数据。两年来，他一直手动搜索并将数据输入到一个大型电子表格中，这个过程占用了他在<em class="mx">实际</em>工作的大量时间。</p><p id="1b35" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我承诺我会研究我们的选择，很快我意识到大多数流行的 API 已经被关闭了。我从《纽约时报》开始搜集信息，尽管我们需要的几个县没有出现在数据集中。然后我考虑去浏览天气频道，但是我突然明白了:</p><p id="5349" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="mx">为什么我不能直接从美国获取数据？毕竟，这正是 NYT 这样的聚合网站正在做的事情。</em></p><p id="7b6f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">所以经过几个小时的研究，我写了一些<a class="ae lr" href="https://github.com/bmeares/covid" rel="noopener ugc nofollow" target="_blank">插件</a>并拼凑了一个<a class="ae lr" href="https://grafana.mrsm.io/d/S7WRSZ27k/covid-cases?orgId=1&amp;refresh=30m" rel="noopener ugc nofollow" target="_blank"> Grafana 仪表盘</a>(如上图)来可视化我的发现。我的客户非常高兴，所以我决定在这篇文章中写下我的发现。</p><h1 id="a599" class="ma mb iq bd mc md my mf mg mh mz mj mk jw na jx mm jz nb ka mo kc nc kd mq mr bi translated">获取数据</h1><p id="01a6" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">为了将数据导入 Pandas，让我们使用内置的 SQLite 数据库<code class="fe nd ne nf ng b">sql:local</code>来存储我们的数据。您可以随时使用自己的数据库，例如，如果您想要构建自己的 Grafana 仪表盘。</p><p id="fae5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我已经将我的提取器脚本发布为<code class="fe nd ne nf ng b"><a class="ae lr" href="https://github.com/bmeares/covid" rel="noopener ugc nofollow" target="_blank">covid</a></code> <a class="ae lr" href="https://github.com/bmeares/covid" rel="noopener ugc nofollow" target="_blank">海泡石插件</a>——一种用于提取数据的 Python 模块格式。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/7448a88938dc58daf050ca50accf4db8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uzWqB46vkjHcQGt4dbG1-Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">该插件允许您按县摄取 COVID 数据。(图片由作者提供)</p></figure><p id="8e76" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我在插件的<a class="ae lr" href="https://github.com/bmeares/covid" rel="noopener ugc nofollow" target="_blank"> GitHub 库</a>上提供了使用信息，下面我将更深入地介绍我是如何决定获取数据的。首先<a class="ae lr" href="https://meerschaum.io/get-started/" rel="noopener ugc nofollow" target="_blank">从<a class="ae lr" href="https://pypi.org/project/meerschaum/" rel="noopener ugc nofollow" target="_blank"> PyPI </a>安装海泡石</a>并安装<code class="fe nd ne nf ng b">covid</code>插件。</p><pre class="kg kh ki kj gt ni ng nj nk aw nl bi"><span id="b6ca" class="nm mb iq ng b gy nn no l np nq">$ pip install -U --user meerschaum<br/>$ mrsm install plugin covid</span></pre><p id="923c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">用连接器<code class="fe nd ne nf ng b">plugin:covid</code>和实例<code class="fe nd ne nf ng b">sql:local</code>注册一个管道，当出现提示时，输入与您的县对应的 FIPS 代码列表。</p><pre class="kg kh ki kj gt ni ng nj nk aw nl bi"><span id="f6f5" class="nm mb iq ng b gy nn no l np nq">$ mrsm register pipe -c plugin:covid -m cases -i sql:local</span><span id="2019" class="nm mb iq ng b gy nr no l np nq">❓ Please enter a list of FIPS codes separated by commas: 08031,48113,45043,45045,45007,37107,37021,47157,47147</span></pre><p id="ecd6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们已经设置好了管道，让数据流动起来。运行<code class="fe nd ne nf ng b">sync pipes</code>命令获取数据——第一次可能需要一分钟左右。</p><pre class="kg kh ki kj gt ni ng nj nk aw nl bi"><span id="e42e" class="nm mb iq ng b gy nn no l np nq">mrsm sync pipes -i sql:local</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/104cd69c6be806c9836f06d2e820a48a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GsejU_qv_EhPLTphXVCLSQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">同步来自科罗拉多州、德克萨斯州和纽约时报的九个县的数据。(图片由作者提供)</p></figure><p id="6fa6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">就是这样！可以用<code class="fe nd ne nf ng b">--loop</code>和<code class="fe nd ne nf ng b">--min-seconds</code>连续同步，<code class="fe nd ne nf ng b">-d</code>或<code class="fe nd ne nf ng b">--daemon</code>标志作为后台作业运行命令。</p><pre class="kg kh ki kj gt ni ng nj nk aw nl bi"><span id="58c6" class="nm mb iq ng b gy nn no l np nq">mrsm sync pipes -i sql:local --loop --min-seconds 3600 -d</span></pre><h1 id="d07b" class="ma mb iq bd mc md my mf mg mh mz mj mk jw na jx mm jz nb ka mo kc nc kd mq mr bi translated">敲进管子里</h1><p id="b463" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">下面是一个片段，演示了访问管道数据的方法:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">接入您的管道并检索数据帧。(作者代码)</p></figure><h1 id="206e" class="ma mb iq bd mc md my mf mg mh mz mj mk jw na jx mm jz nb ka mo kc nc kd mq mr bi translated">它是如何工作的</h1><p id="d5f9" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">这是文章的一部分，我拉开帷幕，说出我的秘密。<code class="fe nd ne nf ng b">covid</code>插件本身只执行其他插件并组合它们的结果；例如，<code class="fe nd ne nf ng b"><a class="ae lr" href="https://github.com/bmeares/US-covid" rel="noopener ugc nofollow" target="_blank">US-covid</a></code> <a class="ae lr" href="https://github.com/bmeares/US-covid" rel="noopener ugc nofollow" target="_blank">插件</a>从《纽约时报》获取:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">从纽约时报获取数据。(作者代码)</p></figure><p id="b663" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从特定州获取数据的难度各不相同——例如，加利福尼亚州提供 CSV，因此解析类似于 NYT:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">从加州卫生部门下载数据。(作者代码)</p></figure><p id="c71a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是其他州就没这么简单了。<code class="fe nd ne nf ng b"><a class="ae lr" href="https://github.com/bmeares/TX-covid" rel="noopener ugc nofollow" target="_blank">TX-covid</a></code> <a class="ae lr" href="https://github.com/bmeares/TX-covid" rel="noopener ugc nofollow" target="_blank">插件</a>下载并解析包含评论的 XLSX 电子表格，并为每天添加一个新列。解析这种深奥的格式是一件非常头痛的事情，这说明了为什么 Meerschaum 的插件系统如此强大。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/2596f378ea3f647ca0faed1df1bd40aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GsJtIhsdIjfchj2YyI49rA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">德克萨斯州在一个格式奇怪的电子表格中分发 COVID 数据。(图片由作者提供)</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">解析德州的 COVID 数据需要一些技巧。(作者代码)</p></figure><p id="fe6b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">像加利福尼亚一样，佐治亚州以 CSV 形式分发数据，但是您首先需要提取一个 ZIP 文件来获得您正在寻找的数据集。下面是我从<code class="fe nd ne nf ng b"><a class="ae lr" href="https://github.com/bmeares/GA-covid/" rel="noopener ugc nofollow" target="_blank">GA-covid</a></code> <a class="ae lr" href="https://github.com/bmeares/GA-covid/" rel="noopener ugc nofollow" target="_blank">插件</a>中得到的解决方案:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">您需要提取一个 ZIP 文件来解析 Georgia 的数据。(作者代码)</p></figure><p id="9c7b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，Colorado 公开了一个 RESTful API，感觉比其他州少了很多 jank(尽管这个 API 看起来并不完全是功能性的，所以它并不是没有 jankiness 的一部分)。以下节选自<code class="fe nd ne nf ng b"><a class="ae lr" href="https://github.com/bmeares/CO-covid/" rel="noopener ugc nofollow" target="_blank">CO-covid</a></code> <a class="ae lr" href="https://github.com/bmeares/CO-covid/" rel="noopener ugc nofollow" target="_blank">插件</a>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">获取科罗拉多的数据看起来比原来容易。(作者代码)</p></figure><h1 id="b8cb" class="ma mb iq bd mc md my mf mg mh mz mj mk jw na jx mm jz nb ka mo kc nc kd mq mr bi translated">结论</h1><p id="d957" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">海泡石已经非常模块化了，而<code class="fe nd ne nf ng b"><a class="ae lr" href="https://github.com/bmeares/covid/" rel="noopener ugc nofollow" target="_blank">covid</a></code> <a class="ae lr" href="https://github.com/bmeares/covid/" rel="noopener ugc nofollow" target="_blank">插件</a>也以类似的方式工作。如果你想投稿，你可以<a class="ae lr" href="https://meerschaum.io/reference/plugins/writing-plugins/" rel="noopener ugc nofollow" target="_blank">为你的州编写并发布一个插件</a>，并在<code class="fe nd ne nf ng b"><a class="ae lr" href="https://github.com/bmeares/covid/pulls" rel="noopener ugc nofollow" target="_blank">covid</a></code> <a class="ae lr" href="https://github.com/bmeares/covid/pulls" rel="noopener ugc nofollow" target="_blank">插件库</a>中打开一个 PR。</p><p id="5c32" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你可能注意到我写插件的时候用了<code class="fe nd ne nf ng b">duckdb</code>。我主要是从 SQL 的角度考虑，DuckDB 很好地弥合了 SQL 和 Pandas 之间的差距。要在海泡石插件中使用第三方库，将依赖项添加到一个全局<code class="fe nd ne nf ng b">required</code>列表中(类似于<code class="fe nd ne nf ng b">requirements.txt</code>)，以<code class="fe nd ne nf ng b">plugin:</code>开头的需求被视为海泡石插件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">COVID 插件所需的依赖项。(作者代码)</p></figure><p id="5ea3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我希望这篇文章对如何获取新冠肺炎数据有所启发。没有人知道各州将保持他们的 COVID 报告多长时间，但进入 2022 年，这些插件可以帮助您的项目提供动力，就像他们为我的客户所做的那样。</p></div></div>    
</body>
</html>