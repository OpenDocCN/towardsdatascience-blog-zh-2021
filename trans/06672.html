<html>
<head>
<title>Active Learning Tutorial with the Nvidia Transfer Learning Toolkit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Nvidia转移学习工具包的主动学习教程</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/active-learning-tutorial-with-the-nvidia-transfer-learning-toolkit-b41489985713?source=collection_archive---------29-----------------------#2021-06-15">https://towardsdatascience.com/active-learning-tutorial-with-the-nvidia-transfer-learning-toolkit-b41489985713?source=collection_archive---------29-----------------------#2021-06-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bc6f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何使用主动学习和英伟达TLT从快速原型到生产就绪对象检测系统</h2></div><p id="62d3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每个机器学习项目中最大的挑战之一是在训练机器学习模型之前，对收集的数据进行整理和注释。通常，神经网络需要如此多的数据，以至于简单地注释所有样本对于中小型公司来说成为不可逾越的障碍。本教程展示了如何仅基于一小部分可用数据制作一个原型，然后通过主动学习迭代改进它，直到模型可以生产。</p><p id="355c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">主动学习描述了一个只有一小部分可用数据被注释的过程。然后，在该子集上训练机器学习模型，并且使用来自该模型的预测来选择要注释的下一批数据。由于训练神经网络可能需要大量时间，因此使用预训练模型并根据可用数据点对其进行微调是有意义的。这就是Nvidia Transfer Learning Toolkit发挥作用的地方。该工具包提供了大量预训练的计算机视觉模型和功能，用于训练和评估深度神经网络。</p><p id="4f1e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来的部分将是关于使用英伟达TLT在<a class="ae lb" href="https://conservancy.umn.edu/handle/11299/206575" rel="noopener ugc nofollow" target="_blank"> MinneApple数据集</a>上构建一个水果检测模型，并使用来自<a class="ae lb" href="https://www.lightly.ai/" rel="noopener ugc nofollow" target="_blank"> Lightly </a>的主动学习功能迭代改进该模型，这是一个计算机视觉数据监管平台。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/0c7ca4f2e32033d5d23c119a93492af1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RyUSzzKocEUhwk6LdsAQkA.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">来自<a class="ae lb" href="https://conservancy.umn.edu/handle/11299/206575" rel="noopener ugc nofollow" target="_blank"> MinneApple数据集</a>的示例图像。</p></figure><h2 id="3f50" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">为什么要水果检测？</h2><p id="e72e" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">准确检测和计数水果是自动化收获过程的关键一步。果实计数可用于预测预期产量，从而及早发现低产年份。此外，水果检测数据集中的图像通常包含大量目标，因此需要更长的时间来注释，这反过来又增加了每幅图像的成本。这使得主动学习的好处更加明显。</p><h2 id="97e3" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">为什么是明尼阿波利斯？</h2><p id="ca2c" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">MinneApple由670张果园中苹果的高分辨率图像组成，每个苹果都标有一个边界框。少量的图片使它非常适合快速浏览教程。</p><h1 id="68f0" class="mq lt iq bd lu mr ms mt lx mu mv mw ma jw mx jx md jz my ka mg kc mz kd mj na bi translated">我们开始吧</h1><p id="2594" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">本教程跟随它的<a class="ae lb" href="https://github.com/lightly-ai/NvidiaTLTActiveLearning/tree/main" rel="noopener ugc nofollow" target="_blank"> Github对应部分</a>。如果您想亲自体验本教程，可以随意克隆存储库并进行尝试。</p><h2 id="01b4" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">上传数据集</h2><p id="314d" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">要用<a class="ae lb" href="https://www.lightly.ai/" rel="noopener ugc nofollow" target="_blank">轻</a>做主动学习，首先需要把你的数据集上传到平台上。命令<code class="fe nb nc nd ne b">lightly-magic</code>训练自监督模型以获得良好的图像表示，然后将图像连同图像表示一起上传到平台。由于自我监督，这一步不需要标签，因此您可以立即开始处理原始数据。如果想跳过训练，可以设置<code class="fe nb nc nd ne b">trainer.max_epochs=0</code>。在下面的命令中，用平台上的令牌替换<code class="fe nb nc nd ne b">MY_TOKEN</code>。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nf ng l"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">将数据集嵌入并上传到<a class="ae lb" href="https://app.lightly.ai" rel="noopener ugc nofollow" target="_blank"> Lightly web-app </a>的命令。</p></figure><p id="fe51" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">出于隐私原因，也可以上传缩略图，甚至只是元数据，而不是完整的图像。更多信息见<a class="ae lb" href="https://docs.lightly.ai/lightly.cli.html#lightly.cli.upload_cli.upload_cli" rel="noopener ugc nofollow" target="_blank">此链接</a>。</p><p id="7572" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上传完成后，您可以在<a class="ae lb" href="https://app.lightly.ai/" rel="noopener ugc nofollow" target="_blank"> Lightly平台</a>中直观地浏览您的数据集。你可能会发现不同的图像群。摆弄一下，看看你能得到什么样的见解。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nh"><img src="../Images/b012ed1b9c63abe10ef8ff4c4af88ab7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*gxgWco5KxqtOCsNJanUCXw.gif"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">在<a class="ae lb" href="https://app.lightly.ai" rel="noopener ugc nofollow" target="_blank"> Lightly web-app </a>中探索您的数据集。</p></figure><h2 id="5050" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">初始取样</h2><p id="1a9d" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">现在，让我们选择一批初始图像进行注释和训练。</p><p id="8db1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Lightly提供了不同的采样策略，其中最突出的是<code class="fe nb nc nd ne b">CORESET</code>和<code class="fe nb nc nd ne b">RANDOM</code>采样。<code class="fe nb nc nd ne b">RANDOM</code>采样将很好地保留数据集的基本分布，而<code class="fe nb nc nd ne b">CORESET</code>最大化数据集的异质性。在<a class="ae lb" href="https://app.lightly.ai" rel="noopener ugc nofollow" target="_blank"> Lightly Platform </a>中探索我们的数据集时，我们注意到许多不同的集群。因此，我们选择<code class="fe nb nc nd ne b">CORESET</code>采样来确保每个聚类都在训练数据中有所表示。</p><p id="05a3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要进行初始采样，您可以使用<a class="ae lb" href="https://github.com/lightly-ai/NvidiaTLTActiveLearning/tree/main" rel="noopener ugc nofollow" target="_blank"> Github库</a>中提供的脚本，或者您可以编写自己的Python脚本。该脚本应该包括以下步骤。</p><p id="f0c1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建一个API客户端来与Lightly API通信。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="a3d8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建一个主动学习代理，作为进行主动学习的界面。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="fc4d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，创建一个采样配置，进行一个主动学习查询，并使用一个助手函数将带注释的图像移动到<code class="fe nb nc nd ne b">data/train</code>目录中。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="6486" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nb nc nd ne b">query</code>将在Lightly平台中自动创建一个名为<code class="fe nb nc nd ne b">initial-selection</code>的新标签。</p><h2 id="0523" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">训练和推理</h2><p id="7c60" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">现在我们已经有了带注释的训练数据，让我们在上面训练一个对象检测模型，看看效果如何！使用Nvidia Transfer Learning Toolkit从命令行训练YOLOv4对象检测器。迁移学习最酷的一点是，你不必从头开始训练一个模型，因此需要更少的带注释的图像来获得好的结果。</p><p id="6a2b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先从Nvidia注册表下载一个预先训练的对象检测模型。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nf ng l"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">从NGC英伟达下载ResNet-18检查点的命令。</p></figure><p id="ffa9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在采样的训练数据上微调对象检测器就像下面的命令一样简单。确保用你从<a class="ae lb" href="https://ngc.nvidia.com/catalog" rel="noopener ugc nofollow" target="_blank"> Nvidia账户</a>获得的API令牌替换你的_KEY。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nf ng l"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">命令在所选图像上训练水果检测模型。</p></figure><p id="23f6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">既然您已经对数据集上的对象检测器进行了微调，那么您可以进行推断，看看它的工作情况如何。</p><p id="e945" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对整个数据集进行推断的好处是，您可以轻松地找出模型对哪些图像表现不佳或有很多不确定性。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nf ng l"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">命令使用训练好的水果检测模型进行推理。</p></figure><p id="d79b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面你可以看到两个训练后的例子图像。很明显，该模型在未标记的图像上表现不佳。因此，向训练数据集添加更多样本是有意义的。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi ni"><img src="../Images/a3d0399a1959c2e80863a931f9c5ff02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WgnaNQiUtzx2MQBzx11GiA.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">来自训练集和未标记集的图像示例。该模型在图像中缺少来自未标记数据的多个苹果。这意味着这个模型对于生产来说还不够精确。</p></figure><h2 id="b7cf" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">主动学习步骤</h2><p id="4979" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">您可以使用上一步的推论来确定哪些图像导致了模型问题。使用Lightly，您可以轻松地选择这些图像，同时确保您的训练数据集不会充斥着重复的图像。</p><p id="cbc8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本节将介绍如何选择图像来完善您的训练数据集。您可以再次使用<code class="fe nb nc nd ne b">active_learning_query.py</code>脚本，但这一次您必须指出已经存在一组预先选择的图像，并将脚本指向存储推理的位置。</p><p id="9f03" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意，<code class="fe nb nc nd ne b">n_samples</code>参数表示主动学习查询后的样本总数。最初的选择包含100个样本，我们希望将另外100个样本添加到标记集。因此，我们设置<code class="fe nb nc nd ne b">n_samples=200</code>。</p><p id="6b8c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用<code class="fe nb nc nd ne b">CORAL</code>代替<code class="fe nb nc nd ne b">CORESET</code>作为采样方法。<code class="fe nb nc nd ne b">CORAL</code>同时最大化样本数据中主动学习得分的多样性和总和。</p><p id="c793" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该脚本的工作方式与之前非常相似，但有一个显著的不同:这一次，所有推断的标签都被加载并用于计算每个样本的主动学习分数。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="6bd3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">脚本的其余部分与初始选择几乎相同:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h2 id="9513" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">再培训</h2><p id="8a85" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">您可以在新的数据集上重新训练我们的对象检测器，以获得更好的模型。为此，您可以使用与前面相同的命令。如果要从最后一个检查点继续训练，请确保用resume_model_path替换specs文件中的pretrain_model_path。</p><p id="bca1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你对重新训练后的表现仍然不满意，你可以再次重复训练、预测和主动学习步骤——这就是所谓的主动学习循环。由于所有三个步骤都是作为脚本实现的<a class="ae lb" href="https://github.com/lightly-ai/NvidiaTLTActiveLearning" rel="noopener ugc nofollow" target="_blank">，迭代花费很少的精力，并且是持续改进模型的一个很好的方法。</a></p><p id="97a6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><p id="1c8e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Philipp Wirth <br/>机器学习工程师<br/> lightly.ai</p></div></div>    
</body>
</html>