<html>
<head>
<title>An Underappreciated Workflow Tool for ML/AI: MLOps Airflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个不被重视的ML/AI工作流工具:MLOps气流</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/under-appreciated-workflow-tool-airflow-a078a3c71a67?source=collection_archive---------23-----------------------#2021-05-25">https://towardsdatascience.com/under-appreciated-workflow-tool-airflow-a078a3c71a67?source=collection_archive---------23-----------------------#2021-05-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><h1 id="df7a" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">介绍</h1><p id="600a" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">Airflow是一种工作流管理工具，在MLOps中经常被低估和较少使用。我在各种任务中使用airflow来自动化其中的许多任务，从以特定间隔运行人工智能模型，到重新训练模型，批处理，抓取网站，投资组合跟踪，定制新闻提要等。在这篇文章中，我们将回顾气流的基础知识以及如何开始。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lm"><img src="../Images/94705b182f824bf64b5e46c1ecb196b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vWk0uKX5S9XQ63OL"/></div></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">布雷特·乔丹在<a class="ae mc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="e2a9" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">什么是气流？</h1><p id="989f" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><a class="ae mc" href="https://airflow.apache.org/" rel="noopener ugc nofollow" target="_blank"> Airflow </a>是开发人员调度、执行和监控工作流程的工具。Airflow最初由Airbnb开发，目前是Apache孵化器项目。Airflow的最大优势是可以使用纯python代码创建工作流。它为开发人员提供了灵活性，可以根据需要阐明工作流，并以特定的频率调度或运行它。</p><p id="67fe" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">Airflow还可以连接从AWS Lambda到GCP数据流的云服务。在大多数场景中，大到中等规模的组织使用Airflow来处理大量的数据，并在其上执行一些数据操作。它也可以在集群模式下运行。AWS和GCP提供了气流的管理实例，以便与其他云服务一起使用。</p><ol class=""><li id="d584" class="mi mj it kq b kr md kv me kz mk ld ml lh mm ll mn mo mp mq bi translated"><a class="ae mc" href="https://aws.amazon.com/managed-workflows-for-apache-airflow/" rel="noopener ugc nofollow" target="_blank"> AWS管理的气流工作流程</a></li><li id="53e9" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated"><a class="ae mc" href="https://cloud.google.com/composer/docs#docs" rel="noopener ugc nofollow" target="_blank"> GCP云作曲</a></li></ol><p id="257a" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated"><strong class="kq iu">气流术语</strong></p><p id="ed74" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated"><strong class="kq iu">DAG</strong>:DAG是一个有向无环图，代表一个单独的工作流。Dag指示执行的工作流顺序。</p><p id="4980" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated"><strong class="kq iu">操作符</strong>:操作符表示DAG的每一步正在执行什么任务。如python_operator、s3_file_transform_operator等。您可以在这里查看<a class="ae mc" href="https://airflow.apache.org/docs/apache-airflow/stable/_api/airflow/operators/index.html" rel="noopener ugc nofollow" target="_blank">操作员列表</a></p><h1 id="98c9" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">装置</h1><p id="7ebd" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">安装可以在本地完成，也可以在基于云Linux的实例中轻松完成。否则气流码头集装箱可供您使用。</p><p id="1821" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">气流安装:<a class="ae mc" href="https://airflow.apache.org/docs/apache-airflow/stable/installation.html" rel="noopener ugc nofollow" target="_blank">https://air flow . Apache . org/docs/Apache-air flow/stable/installation . html</a></p><p id="7861" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">需要安装一些系统包，可以在上面的链接中看到，最后，在虚拟环境中安装python包。</p><pre class="ln lo lp lq gt mw mx my mz aw na bi"><span id="2be1" class="nb jr it mx b gy nc nd l ne nf">pip install apache-airflow</span></pre><p id="2231" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">在设置上可能会有一些挑战。但是，一旦您调试并修复了它，您可能会在启动web界面后看到如下所示的web界面。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi ng"><img src="../Images/632945022d7207ae74d956a16bcc5d89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XvK7voxCm4VujCM16DPVNw.png"/></div></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">作者图片</p></figure><h1 id="af21" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">经营者</h1><p id="0c02" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">操作员是气流工作流程的核心部分。运算符可以是不同的类型。一些常用的运算符有</p><ul class=""><li id="e8d3" class="mi mj it kq b kr md kv me kz mk ld ml lh mm ll nh mo mp mq bi translated"><code class="fe ni nj nk mx b">BashOperator</code> - Bash命令被执行</li><li id="2645" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll nh mo mp mq bi translated"><code class="fe ni nj nk mx b">PythonOperator</code> -调用python函数</li><li id="2e62" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll nh mo mp mq bi translated"><code class="fe ni nj nk mx b">EmailOperator</code> -发送电子邮件</li><li id="1921" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll nh mo mp mq bi translated"><code class="fe ni nj nk mx b">SimpleHttpOperator</code> -发送一个HTTP请求</li></ul><p id="f6af" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">这样的例子不胜枚举。你可以点击查看<a class="ae mc" href="https://airflow.apache.org/docs/apache-airflow/stable/_api/airflow/operators/index.html" rel="noopener ugc nofollow" target="_blank">的完整列表。你可能会注意到一些云运营商也在列表中。所以你不需要从头开始写代码。</a></p><h1 id="ccdd" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">执行</h1><p id="d30e" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">可以使用web UI、命令行或按计划触发工作流。</p><p id="0757" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated"><strong class="kq iu">默认参数</strong></p><p id="1b9a" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">下面是我们可以定制的一些参数。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi nl"><img src="../Images/b6244cf957fcede326a2b31757ade4d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*SxYD2lGzAWwyZgAUwZZ84g.png"/></div></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">按作者列出的工作流参数</p></figure><p id="8416" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated"><strong class="kq iu">气流代码</strong></p><p id="227e" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">这里我们将使用一个简单的dag来安排它。Python运算符可用于调用带有附加参数的python函数。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/7055ca5f31a3871455176a809706c6e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:60/0*dDTIA0cuUgEkfHjW"/></div></figure><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi nn"><img src="../Images/70c32f812ce4a95882d10563ac381c0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IjC57PtROfhZkLW1.png"/></div></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">作者的简单Dag代码</p></figure><p id="228c" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">您还可以在气流门户中看到气流的执行。下面是我的本地主机门户，它显示了DAG的执行。红色表示执行失败。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi no"><img src="../Images/cb203d6186476402b34cfaa30f06f2c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jNycFnMqGeTzZHsc.png"/></div></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">按作者列出的Dag执行</p></figure><h1 id="091d" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">频繁调度</h1><p id="631f" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">通常一次性设置是为了测试或开发。实时设置和自动交易需求不涉及日常设置，而实时系统会出现在画面中。理想情况下，我喜欢一切都自动化，所以它不需要我的干预。这是气流闪耀的地方。在下面的部分中，您可以执行一系列计划选项。</p><p id="1f0c" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">你甚至可以一分钟一分钟地计划。但是，我觉得有点矫枉过正。气流可以安装在云中持续执行。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/d1753fc7d7f382c4775abb97d72b1a27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/0*-4poBiRni2pCNx2i.png"/></div><p class="ly lz gj gh gi ma mb bd b be z dk translated">按作者安排工作流</p></figure><h1 id="fb99" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">云中的设置</h1><p id="d063" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">Airflow可用作云提供商的托管服务，或用于在云中执行airflow的定制安装。查看这篇好的<a class="ae mc" href="https://medium.com/@abraham.pabbathi/airflow-on-aws-ec2-instance-with-ubuntu-aff8d3206171" rel="noopener">文章</a>，了解在EC2实例中安装的分步说明。</p><h1 id="9aa1" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">用例</h1><p id="f8ec" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">检查我的其他文章，看看气流用例。在这里，我们将回顾气流的一些使用案例:</p><ol class=""><li id="1d2a" class="mi mj it kq b kr md kv me kz mk ld ml lh mm ll mn mo mp mq bi translated">经常运行人工智能模型预测</li><li id="5877" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated">创建服务的完整产品安装</li><li id="adbf" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated">执行数据工程操作，如数据迁移</li><li id="bc01" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated">基于某些触发条件购买股票/密码</li><li id="78b4" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated">基于条件和人工智能的自动投资组合再平衡</li><li id="36ef" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated">基于反馈开始人工智能模型训练</li></ol><p id="6fda" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">这样的例子不胜枚举。</p><h1 id="0e6e" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">最后的想法</h1><p id="6056" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">Airflow是一个很棒的工作流工具，它为想要自动化大量工作的python开发人员和技术投资者提供了更大的灵活性。选项是无限的，以自动化的方式涵盖了各种各样的使用案例。</p><p id="0183" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated"><strong class="kq iu">参考文献</strong>:</p><p id="7ae7" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated"><a class="ae mc" href="https://medium.com/@abraham.pabbathi/airflow-on-aws-ec2-instance-with-ubuntu-aff8d3206171" rel="noopener">https://medium . com/@ Abraham . pabba thi/air flow-on-AWS-ec2-instance-with-Ubuntu-aff8d 3206171</a></p></div><div class="ab cl nq nr hx ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="im in io ip iq"><p id="cfcf" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated"><em class="nx">请订阅我的</em> <a class="ae mc" href="https://makemoneywithcode.substack.com/welcome" rel="noopener ugc nofollow" target="_blank"> <strong class="kq iu"> <em class="nx">简讯</em> </strong> </a> <em class="nx">获取我的文章和其他更新的免费工作代码。</em></p></div></div>    
</body>
</html>