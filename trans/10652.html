<html>
<head>
<title>6 Examples to Perform Efficient Data Analysis and Manipulation with R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">6个使用R执行高效数据分析和操作的示例</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/6-examples-to-perform-efficient-data-analysis-and-manipulation-with-r-73db4ef6efc9?source=collection_archive---------23-----------------------#2021-10-12">https://towardsdatascience.com/6-examples-to-perform-efficient-data-analysis-and-manipulation-with-r-73db4ef6efc9?source=collection_archive---------23-----------------------#2021-10-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0e7a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">r使它变得简单、高效和快速。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4e1180ba7d8ee51a3cbec7b56069b4d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B9g05UuHJSqgwbhIjR0OUQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@andersjilden?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">安德斯·吉尔登</a>在<a class="ae ky" href="https://unsplash.com/s/photos/fast?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="3b34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python和R是数据科学生态系统中的主流编程语言。我开始用Python学习数据科学，我建议你也这样做。</p><p id="05b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">自从我开始作为一名数据科学家工作以来，我一直在广泛地使用Python和R。然而，当涉及到数据分析和操作时，我倾向于选择R而不是Python。</p><p id="5d00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将探索r的数据表包的一些优秀特性。即使对于大型数据集，它也是简单而高效的。</p><p id="b5c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用Kaggle上提供的关于奥运会历史的数据集。它是在知识共享许可下共享的，所以我们可以公开使用和共享它。</p><p id="547a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就像Python一样，R有几个简化和加速数据科学任务的包。我们将使用数据表包，它有点像Python熊猫的R等价物。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4e28" class="ma mb it lw b gy mc md l me mf">install.packages("data.table") #install</span><span id="a9a7" class="ma mb it lw b gy mg md l me mf">library(data.table)  #import</span></pre><p id="9ed9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以用<code class="fe mh mi mj lw b">fread</code>函数读取数据集。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1a8c" class="ma mb it lw b gy mc md l me mf">dt &lt;- fread("athlete_events.csv")</span><span id="6f2c" class="ma mb it lw b gy mg md l me mf">dim(dt)<br/>271116   15</span></pre><p id="47c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该数据集包含超过27万行和15列。每条线代表一名运动员和他/她在给定运动中的表现。对于本文中的例子，我们不需要所有的列。让我们先过滤一些列。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4810" class="ma mb it lw b gy mc md l me mf">dt &lt;- dt[, c("Sex","Age","Height","Weight",<br/>             "Team","Sport","Medal")]</span><span id="4447" class="ma mb it lw b gy mg md l me mf">head(dt)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mk"><img src="../Images/3524564029f6ca10cbfc0739e9ea656d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GPCerlQh1RYix1Wb86lTPw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><h2 id="a39f" class="ma mb it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">示例1</h2><p id="fa31" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">找出获得奖牌总数最多的5个国家。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6b0d" class="ma mb it lw b gy mc md l me mf">dt[!is.na(Medal), .N, Team][order(-N)][1:5]</span><span id="4994" class="ma mb it lw b gy mg md l me mf">            Team       N<br/>1: United States    5219<br/>2:  Soviet Union    2451<br/>3:       Germany    1984<br/>4: Great Britain    1673<br/>5:        France    1550</span></pre><p id="ec1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个逗号之前的表达式过滤掉了medal列中的空值，N是r的count函数。第二个逗号之后的列是用于分组的列。由于我们对每个国家获得的奖牌感兴趣，所以我们在这里写团队栏。最后，结果按计数降序排列。如果N前面没有负号，结果将按升序排序。</p><p id="ce75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在一小段代码中，我们实现了过滤、分组、聚集和排序。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h2 id="877d" class="ma mb it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">示例2</h2><p id="26de" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">创建一个列，表明运动员是否获得了奖牌，而不考虑奖牌的类型。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="bc48" class="ma mb it lw b gy mc md l me mf">dt[, is_medal := ifelse(is.na(Medal),0,1)]</span><span id="7b1f" class="ma mb it lw b gy mg md l me mf">head(dt)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/a9ea713718d82e0bb5dafaec3d06b94b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hExiR3uXZZlDw-3OtBqa8g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="ab13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“:=”表达式就地创建一个新列，以便修改当前数据表。<code class="fe mh mi mj lw b">ifelse</code>函数评估给定的条件并相应地赋值。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h2 id="e6ad" class="ma mb it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">示例3</h2><p id="61d2" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">“:=”表达式的一个好处是它也适用于分组。例如，我们可能需要创建一个列来显示每个国家获得的奖牌总数。</p><p id="2253" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一种方法是单独计算这个值，然后按团队名称与原始表合并。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4f6e" class="ma mb it lw b gy mc md l me mf">medals &lt;- dt[, .(medal_count = sum(is_medal)), Team]</span><span id="5ec1" class="ma mb it lw b gy mg md l me mf">dt &lt;- merge(dt, medals, by="Team", all.x = TRUE)</span></pre><p id="cd6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据表还提供了一个更简单的解决方案:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="0d6c" class="ma mb it lw b gy mc md l me mf">dt[, medal_count := sum(is_medal), Team]</span></pre><p id="a545" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它计算每支队伍获得的奖牌数，并将数值适当地放入奖牌数列。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/0727ef945c8aa2451b908495b5ebbc8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VF5vvHxHbBynKahGAN2TbA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h2 id="2930" class="ma mb it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">实例4</h2><p id="6203" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">创建一个包含每个国家运动员的平均体重指数(身体质量指数)的列。</p><p id="f714" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一种方法是计算每个运动员的身体质量指数，然后取平均值。然而，如果我们不想添加额外的身体质量指数列，我们可以直接计算每个国家的平均身体质量指数。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="662c" class="ma mb it lw b gy mc md l me mf">dt[, avg_bmi := mean(Weight / (Height/100)**2, na.rm=TRUE), Team]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/96bfb1e64b1d33b5a079fed3b9cc3628.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O6H5UowuD-LuisqA8eAuhw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="d3ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将<code class="fe mh mi mj lw b">na.rm</code>参数设置为真很重要。否则，即使组中只有一个null值，结果也是null。“丹麦/瑞典”队的平均bmi值为空，因为该队的所有身高和体重值都为空。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h2 id="775f" class="ma mb it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">实例5</h2><p id="d320" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们之前已经计算了每个国家获得的奖牌数。我们也来算算这些奖牌来自多少个运动项目。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a1f2" class="ma mb it lw b gy mc md l me mf">dt[is_medal==1, .(number_of_sports = uniqueN(Sport)), Team][order(-number_of_sports)][1:5]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/33be3f39e84cbf9fc8ab09465e508d0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*YiD8hrikkyJk7SytctBmYQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">前5名(图片由作者提供)</p></figure><p id="4c3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">美国在47个不同的项目中赢得了奖牌。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h2 id="0edd" class="ma mb it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">实例6</h2><p id="fe24" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们可以在一次操作中计算多个聚合。让我们分别计算那些赢得和没有赢得奖牌的男性和女性的平均年龄、身高和体重。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2cd4" class="ma mb it lw b gy mc md l me mf">dt[, .(avg_age = mean(Age, na.rm=T),<br/>       avg_height = mean(Height, na.rm=T),<br/>       avg_weight = mean(Weight, na.rm=T)),<br/>   .(Sex, is_medal)]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/7af3d707ddd2fb610a9a29c87555ac31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*VWtSKb3-o7Rzcimlh8aCoQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="4082" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以根据需要在括号中列出任意多的聚合。因为我们对基于性别和奖牌的分组都感兴趣，所以我们使用这两个列进行分组。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h2 id="0f33" class="ma mb it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">结论</h2><p id="e963" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们做了6个例子来演示数据表包如何高效地执行数据分析和操作。我们在这篇文章中所涉及的只是它的一小部分功能。然而，典型的任务大多涉及像这些例子中的基本操作。</p><p id="c108" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>