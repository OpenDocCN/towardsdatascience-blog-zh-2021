<html>
<head>
<title>Social Network Analysis: Community Detection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">社会网络分析:社区检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/social-network-analysis-community-detection-2b19e836c76c?source=collection_archive---------16-----------------------#2021-06-23">https://towardsdatascience.com/social-network-analysis-community-detection-2b19e836c76c?source=collection_archive---------16-----------------------#2021-06-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="923e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用R从<a class="ae kf" href="https://www.yelp.com/dataset" rel="noopener ugc nofollow" target="_blank"> Yelp API </a>中提取用户数据并创建网络图</h2></div><p id="dc52" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在线社交平台使世界各地的人们能够相互交流，并与他们有共同兴趣的人建立关系。这可以在现实生活中观察到——自然地，我们倾向于与和我们相似的人发展和维持关系。具有相似兴趣的人倾向于相互吸引，并在<strong class="ki ir">社区</strong>中联系在一起——彼此拥有相似特征的人群或团体。由于人们倾向于与类似的人聚集在一起，我们可以使用<strong class="ki ir">社区检测</strong>来识别具有高学历(联系)的用户，并查看他们在网络中能走多远。</p><p id="24e4" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">用户数据提取— </strong>由于我们只对用户数据感兴趣，我们将只提取以下变量:</p><ul class=""><li id="4072" class="lc ld iq ki b kj kk km kn kp le kt lf kx lg lb lh li lj lk bi translated">User_id — Yelp用户ID；这是制作节点和边所需要的</li><li id="dbd6" class="lc ld iq ki b kj ll km lm kp ln kt lo kx lp lb lh li lj lk bi translated">姓名—用户的名字</li><li id="428b" class="lc ld iq ki b kj ll km lm kp ln kt lo kx lp lb lh li lj lk bi translated">审核计数—用户撰写的审核数量</li><li id="e3ca" class="lc ld iq ki b kj ll km lm kp ln kt lo kx lp lb lh li lj lk bi translated">Yelp自—用户加入Yelp的日期</li><li id="8d23" class="lc ld iq ki b kj ll km lm kp ln kt lo kx lp lb lh li lj lk bi translated">朋友—按用户id包含用户所有朋友的列表</li><li id="8767" class="lc ld iq ki b kj ll km lm kp ln kt lo kx lp lb lh li lj lk bi translated">粉丝—用户拥有的粉丝数量</li><li id="6319" class="lc ld iq ki b kj ll km lm kp ln kt lo kx lp lb lh li lj lk bi translated">精英—用户拥有精英身份的年数</li><li id="307c" class="lc ld iq ki b kj ll km lm kp ln kt lo kx lp lb lh li lj lk bi translated">平均星级—用户对所有已写评论的平均评分</li></ul><p id="29e8" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">Yelp数据非常大，所以从json文件中提取数据需要很长时间。</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="14a1" class="lz ma iq lv b gy mb mc l md me">library(jsonlite)<br/>library(dplyr)<br/>library(stringr)<br/>library(tidyr)<br/>library(tidyjson)<br/>library(tidyverse)<br/>library(igraph)</span><span id="22af" class="lz ma iq lv b gy mf mc l md me">user_out &lt;- lapply(readLines("yelp_academic_dataset_user.json"), fromJSON)</span><span id="9462" class="lz ma iq lv b gy mf mc l md me">#parse through each user's data and only obtain columns we are interested in</span><span id="2a31" class="lz ma iq lv b gy mf mc l md me">yelp_parse &lt;- function(x) {<br/>  <br/>  parse_list &lt;- list(user_id = x$user_id, <br/>                     name = x$name, <br/>                     review_count = x$review_count, <br/>                     yelping_since = x$yelping_since, <br/>                     elite = x$elite, <br/>                     friends = x$friends, <br/>                     fans = x$fans, <br/>                     average_stars = x$average_stars)<br/>  <br/>  parse_list &lt;- lapply(parse_list, FUN = function(x) ifelse(is.null(x), "", x))<br/>  <br/>  df &lt;- data_frame(user_id=parse_list$user_id,<br/>                   name=parse_list$name, <br/>                   review_count = parse_list$review_count, <br/>                   yelping_since=parse_list$yelping_since, <br/>                   elite = parse_list$elite, <br/>                   friends = parse_list$friends, <br/>                   fans = parse_list$fans, <br/>                   average_stars = parse_list$average_stars)<br/>  df<br/>}</span><span id="c6a0" class="lz ma iq lv b gy mf mc l md me">user_list &lt;- lapply(user_out, FUN = yelp_parse)</span><span id="dae3" class="lz ma iq lv b gy mf mc l md me">#should now have a dictionary with only keys and values we want</span><span id="e76d" class="lz ma iq lv b gy mf mc l md me">#now, make this into a table<br/>user_df &lt;- data.frame(matrix(unlist(user_list), nrow=length(user_list), byrow=TRUE),stringsAsFactors=FALSE)</span></pre><p id="631a" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">网络图— </strong>让我们用r中的igraph包制作两张对比2005年和2015年加入的用户的图，10年后会有什么不同？</p><p id="5c50" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">制作网络图需要非常长的时间，所以我们将我们的子集限制在100k个节点，并创建最大度数的用户的子图。</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="352f" class="lz ma iq lv b gy mb mc l md me">#remove users with no friends<br/>sample &lt;- subset(user_df, friends != "None")</span><span id="2acf" class="lz ma iq lv b gy mf mc l md me">#make a subset; we only need to retain data of users with some social activity<br/>sub &lt;- subset(sample, year == 2005 &amp; review_count &gt;= 2 &amp; no_of_friends &gt;= 2)</span><span id="68c6" class="lz ma iq lv b gy mf mc l md me">#make links (nodes and edges)<br/>sample_friends &lt;- sub %&gt;% select(user_id, friends)<br/>sample_users &lt;- strsplit(sample_friends$friends, split = ",")<br/>sample_dat &lt;- data.frame(user_id = rep(sample_friends$user_id, sapply(sample_users, length)), friends = unlist(sample_users))</span><span id="dd1c" class="lz ma iq lv b gy mf mc l md me">#network is still too big, take a random sample of 100k nodes<br/>samp_net &lt;- sample_n(sample_dat, 100000)</span><span id="e198" class="lz ma iq lv b gy mf mc l md me">#make network <br/>network &lt;- graph.data.frame(samp_net)<br/>network_s &lt;- simplify(network)</span><span id="c25c" class="lz ma iq lv b gy mf mc l md me">net_deg &lt;- degree(network_s)<br/>all_degree &lt;- degree(network, mode = 'all')</span><span id="f783" class="lz ma iq lv b gy mf mc l md me">#graph user with max degrees<br/>sub_all &lt;- subcomponent(network_s, which(all_degree == max(all_degree)), 'all')<br/>g_sub &lt;- induced_subgraph(network_s, sub_all)</span><span id="d298" class="lz ma iq lv b gy mf mc l md me">#communities<br/>graph.com &lt;- fastgreedy.community(as.undirected(g_sub))<br/>V(g_sub)$color &lt;- graph.com$membership + 1</span><span id="26eb" class="lz ma iq lv b gy mf mc l md me">#create pdf graph for high resolution (try zooming in!)<br/>pdf("communities2005.pdf", 10,10)<br/>plot(g_sub, <br/>     vertex.color = V(g_sub)$color,<br/>     vertex.size = 1,<br/>     vertex.label = NA,<br/>     vertex.frame.color = adjustcolor("#41424c", alpha.f = 0.25),<br/>     edge.arrow.size = 0.1,<br/>     edge.color = adjustcolor("#41424c", alpha.f = 0.20),<br/>     edge.width = 1.5,<br/>     edge.arrow.mode=0,<br/>     layout=layout_with_lgl,<br/>     asp = 0.9,<br/>     dpi=300<br/>) <br/>dev.off()</span></pre><div class="lq lr ls lt gt ab cb"><figure class="mg mh mi mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><img src="../Images/f2e40eafedb87f4cea53570b5b9dd0d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*inTCtoJbe5khbZ3D"/></div></figure><figure class="mg mh mi mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><img src="../Images/3ace73e5e213f07da130bf97c787ffd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*w1T8zQWqWRuIAMUB"/></div><p class="mt mu gj gh gi mv mw bd b be z dk mx di my mz translated">于2005年(左)和2015年(右)加入的用户社区。</p></figure></div><p id="2bc0" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">左边的图表更加密集，这可能是因为在平台上存在时间更长的Yelpers有更多的时间在Yelp上建立自己的声誉，并在社区中建立自己的地位。另一方面，2015年加入的Yelpers，社区密度小，边少→连接少。来自2015年社区的一个有趣的见解是，橙色圆点的密集区域集中在网络底部附近，这意味着有一个拥有类似特征的大型用户社区。</p><p id="f108" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">从我们的社区子图中，我们可以发现<strong class="ki ir">小团体</strong>:</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="3c20" class="lz ma iq lv b gy mb mc l md me">#cliques/communities<br/>cliques &lt;- max_cliques(g_sub)<br/>cliqueBP &lt;- matrix(c(rep(paste0("cl", seq_along(cliques)), sapply(cliques, length)), names(unlist(cliques))), ncol=2, )</span><span id="6c3e" class="lz ma iq lv b gy mf mc l md me">#shows which clique users belong to<br/>bp &lt;- graph_from_edgelist(cliqueBP, directed = F)</span><span id="ce3d" class="lz ma iq lv b gy mf mc l md me">#to graph cliques, use the same code as above, but replace g_sub with bp</span></pre><figure class="lq lr ls lt gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi na"><img src="../Images/5d564af11fb78b6874aea62a5a77dbf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4-MVk3X2JklemrEbDe9NUA.png"/></div></div><p class="mt mu gj gh gi mv mw bd b be z dk translated">这个看起来很酷，但是还没有太大用处。我们肯定能看到集群！</p></figure><p id="7cb1" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我们可以利用这一点来深入了解一个流行的Yelper的网络，以可视化他们的势力范围。</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="2248" class="lz ma iq lv b gy mb mc l md me">#show largest clique from subgraph of user with the max number of degrees to identify bridge</span><span id="289b" class="lz ma iq lv b gy mf mc l md me">pdf("cliques2015.pdf", 10,10)<br/>plot(bp, <br/>     vertex.size = all_degree,<br/>     vertex.color = adjustcolor("lightgoldenrod3", alpha.f = 0.6),<br/>     edge.color = adjustcolor("#41424c", alpha.f = 0.3),<br/>     vertex.frame.color = adjustcolor("#41424c", alpha.f = 0.3),<br/>     vertex.label = ifelse(V(bp)$name %in% top_d1$user_id, top_d1$name, NA),<br/>     vertex.label.color = "darkred",<br/>     layout=layout_with_lgl,<br/>     asp = 0.8,<br/>     dpi = 300)<br/>dev.off()</span></pre><figure class="lq lr ls lt gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nb"><img src="../Images/1332e720214649141631a269505aa96c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YcWt0PgfRJWnyoNtTbu5AQ.png"/></div></div><p class="mt mu gj gh gi mv mw bd b be z dk translated">显示了集团相对于其他集团的位置，这就是为什么我们看到他们的一些名字出现不止一次。名字是子集中朋友数量最多的用户的名字。</p></figure><p id="8547" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">每个节点(用户)的大小表示他们的连接(好友数量)。每条边(链接)显示节点(用户的朋友)之间的连接。米歇尔和布莱恩特出现两次，因为这表明他们的影响力出现在不止一个群体中。</p><p id="ac74" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在上面的小团体中，我们发现Paige具有最高的<strong class="ki ir">中间中心性— </strong>一个节点(用户)充当两个节点之间的桥梁的次数的度量。</p><div class="lq lr ls lt gt ab cb"><figure class="mg mh nd mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><img src="../Images/10ed1f41c8407c5ea6d06a923dbcc174.png" data-original-src="https://miro.medium.com/v2/resize:fit:610/format:webp/1*DrHkHT7cKW5KVRL8cXdWeQ.png"/></div></figure><figure class="mg mh ne mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><img src="../Images/283b1e86d68216c8502951a2cd0db7bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*pvvn8TvhMW2-84xAQzqhbw.png"/></div></figure><figure class="mg mh nf mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><img src="../Images/2b80fe857d325c0b1e8068c9024241ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:552/format:webp/1*QtJcwNpvqwBqGzPRvjMKZw.png"/></div><p class="mt mu gj gh gi mv mw bd b be z dk ng di nh mz translated">蓝色节点连接两个黄色节点的网络示例。第一个网络(左)具有最高的介数中心性。</p></figure></div><p id="f4d2" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">桥梁很重要，因为它们连接了社会网络中的两个不同群体；他们有助于弥合不同社区之间的差距！</strong>桥梁的一个例子是能够与技术和非技术团队成员交流和解释数据的人。另一个例子是当你的朋友向你介绍他们的新朋友时，你的朋友充当了桥梁。</p></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><ul class=""><li id="d504" class="lc ld iq ki b kj kk km kn kp le kt lf kx lg lb lh li lj lk bi translated">我们可以使用中间中心性来找到<em class="nc">谁</em>有很大的影响力，并看看他们的影响力可以在不同的社区之间传播多远。</li><li id="f158" class="lc ld iq ki b kj ll km lm kp ln kt lo kx lp lb lh li lj lk bi translated">我们还可以将此应用于其他社交媒体数据，以识别潜在的影响者。理想情况下，我们应该挑选能够影响不同群体的影响者，这就是中间中心性派上用场的地方！</li></ul></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><p id="117e" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">参考文献:</strong></p><p id="57bb" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">《社会网络中的社区检测》电线在JSM 2017。</p><p id="fa41" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">王，亚历克斯，迈克尔张，和Il-Horn汉恩。《社会推动:在线产品评级中朋友社会影响力的准实验研究》。"</p><p id="6853" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><a class="ae kf" href="https://maelfabien.github.io/machinelearning/graph_3/#" rel="noopener ugc nofollow" target="_blank">图形算法</a></p><p id="afab" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><a class="ae kf" href="https://igraph.org/r/doc/" rel="noopener ugc nofollow" target="_blank"> igraph R包装手册</a></p><blockquote class="np nq nr"><p id="cd7a" class="kg kh nc ki b kj kk jr kl km kn ju ko ns kq kr ks nt ku kv kw nu ky kz la lb ij bi translated">如果你有任何问题或想要我写的R代码，请随时联系我在m.delacruz@uci.edu</p></blockquote></div></div>    
</body>
</html>