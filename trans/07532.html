<html>
<head>
<title>Why Load Testing is Essential to Take Your ML App to Production</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么负载测试对于将您的ML应用程序投入生产至关重要</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/why-load-testing-is-essential-to-take-your-ml-app-to-production-faab0df1c4e1?source=collection_archive---------25-----------------------#2021-07-09">https://towardsdatascience.com/why-load-testing-is-essential-to-take-your-ml-app-to-production-faab0df1c4e1?source=collection_archive---------25-----------------------#2021-07-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="c974" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/notes-from-industry" rel="noopener" target="_blank">行业笔记</a></h2><div class=""/><div class=""><h2 id="f8e7" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用Locust对Flask ML应用程序进行负载测试</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/9b828598899fecb16744561d3458ef84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eFwsF8OfaFHE0-v0"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片来自<a class="ae lh" href="https://unsplash.com/photos/2JDDn7iSGH8" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="f2f9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">随着我继续在数据科学、人工智能、人工智能的世界里航行，无论你想叫它什么，我继续发现越来越多的术语，这些术语最初是我害怕涉足的。正如我在<a class="ae lh" rel="noopener" target="_blank" href="/transitioning-from-pre-health-to-a-career-in-data-science-tech-2c3b61a57bf5">之前的一篇文章</a>中提到的，我来自一个非技术背景的人，经常把关键的软件术语，比如“<a class="ae lh" href="https://www.geeksforgeeks.org/types-software-testing/" rel="noopener ugc nofollow" target="_blank">测试</a>”藏在心底。在获得了更多构建由ML驱动的应用程序的经验后，我明白了一种特殊形式的测试的必要性，这种测试被称为<a class="ae lh" href="http://tryqa.com/what-is-load-testing-in-software/" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd">【负载测试】</strong> </a>，也被称为性能测试。负载测试是一种模拟或测试应用程序预期流量的方式。在Flask服务器上抛出一个端点并期望它保持运行是很容易的，但是在现实中，顺序测试一个<strong class="lk jd">端点</strong>并不能显示关于<strong class="lk jd">端点性能</strong>的真实情况。这就是为什么我们将使用一个名为<a class="ae lh" href="https://locust.io/" rel="noopener ugc nofollow" target="_blank"><strong class="lk jd">Locust</strong></a><strong class="lk jd"/>的开源Python工具来<strong class="lk jd">模拟我们的端点的</strong>多个<strong class="lk jd">并发用户</strong>，看看它如何保持明智的性能。这种类型的测试对于理解您可能需要对您的<strong class="lk jd">项目/软件</strong>进行的<strong class="lk jd">优化</strong>所带来的变化以及关于<strong class="lk jd">成本节约</strong>以正确利用您正在使用的服务器是至关重要的。</p><p id="9fdd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本文中，我们将构建一个基本的ML powered Flask应用程序，但我们不会太关注这些步骤，因为它主要是测试我们用应用程序创建的端点。</p><h1 id="7f60" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">目录</h1><ol class=""><li id="3a3f" class="mw mx it lk b ll my lo mz lr na lv nb lz nc md nd ne nf ng bi translated">构建烧瓶应用程序和ML模型</li><li id="1a03" class="mw mx it lk b ll nh lo ni lr nj lv nk lz nl md nd ne nf ng bi translated">创建蝗虫脚本</li><li id="f28c" class="mw mx it lk b ll nh lo ni lr nj lv nk lz nl md nd ne nf ng bi translated">模拟用户</li><li id="efc9" class="mw mx it lk b ll nh lo ni lr nj lv nk lz nl md nd ne nf ng bi translated">整个代码和结论</li></ol><h1 id="205d" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">构建烧瓶应用程序和ML模型</h1><p id="69b8" class="pw-post-body-paragraph li lj it lk b ll my kd ln lo mz kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">在我们开始负载测试之前，我们必须创建我们的模型，并在一个简单的Flask应用程序上进行推理。对于我们的模型，我们将使用一个回归数据集，使用随机森林模型来预测<a class="ae lh" href="https://www.kaggle.com/harinir/petrol-consumption" rel="noopener ugc nofollow" target="_blank">汽油消耗量</a>。下面的代码有助于将我们的模型训练和部署成一种Flask可以加载和处理的推断格式。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="np nq l"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">模型结构</p></figure><p id="9b4a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在我们已经建立了模型，我们可以使用Flask服务器来使这个模型可用于推理。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="np nq l"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">Flask服务器</p></figure><p id="e601" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们的模型现在可以在我们的服务器上的<strong class="lk jd">/预测</strong>路径下进行推理。为了确保我们的端点正常工作，我们创建了另一个文件，并使用<a class="ae lh" href="https://docs.python-requests.org/en/master/" rel="noopener ugc nofollow" target="_blank">请求</a>库来测试推断。在这种情况下，使用另一个工具如<a class="ae lh" href="https://learning.postman.com/docs/designing-and-developing-your-api/mocking-data/mocking-with-examples/" rel="noopener ugc nofollow" target="_blank"> Postman </a>也是可行的。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="np nq l"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">测试API</p></figure><p id="7fab" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要测试这个脚本，请确保您的flask服务器已经安装了<strong class="lk jd"> flask，运行</strong>并执行API测试脚本来查看模型结果。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/e16004cb66eaebcc52039e2a3b709974.png" data-original-src="https://miro.medium.com/v2/resize:fit:224/format:webp/1*0nFV3T2x0uJIhyruIzr_uw.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">API测试结果(作者截图)</p></figure><p id="cadd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，我们已经有了为推理加载的模型的API，并且我们准备好开始用Locust进行负载测试。如果您想了解更多关于在Flask上部署ML模型的知识，请查看这篇很棒的文章<a class="ae lh" rel="noopener" target="_blank" href="/how-to-easily-deploy-machine-learning-models-using-flask-b95af8fe34d4"/>，它专门围绕这个主题。</p><h1 id="d7cd" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">创建蝗虫脚本</h1><p id="8148" class="pw-post-body-paragraph li lj it lk b ll my kd ln lo mz kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">如前所述，Locust帮助模拟同时拥有许多用户，您可以在您的<strong class="lk jd"> locustfile.py </strong>中定义一个<strong class="lk jd">任务</strong>来执行这个模拟。任务是locust中的关键特性，每次我们开始负载测试时，都会为用户创建一个我们创建的类的实例，它们执行Python脚本中定义的任务。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="np nq l"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">导入和设置</p></figure><p id="c3d9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，我们从Locust导入必要的模块，然后创建一个类，该类将包含我们用于模拟的主要功能。继承HttpUser <strong class="lk jd">使</strong>用户能够<strong class="lk jd">处理我们想要加载测试的HTTP请求</strong>，比如我们例子中的端点。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="np nq l"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">在我们班里</p></figure><p id="8860" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在执行任何Locust任务之前调用On_Start，当用户停止执行任务时调用On_Stop。现在我们创建一个任务，将模拟数据发布到我们的API。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="np nq l"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">发布模拟数据进行模拟</p></figure><p id="b21f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们现在已经准备好测试我们的简单的Locust脚本，为了学习更多关于Locust的知识并开始使用您自己的脚本，请查看他们的文档<a class="ae lh" href="https://docs.locust.io/en/stable/quickstart.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><h1 id="dce4" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">模拟用户</h1><p id="ceb9" class="pw-post-body-paragraph li lj it lk b ll my kd ln lo mz kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">随着我们所有的资源准备就绪，我们现在终于可以看到蝗虫在行动，并查看它提供的一些指标。确保您的flask服务器已经启动，要运行我们的locust文件，只需在终端中键入<strong class="lk jd"> locust </strong>。如果您的locust脚本没有命名为locustfile.py，确保使用<strong class="lk jd"> locust -f filename.py </strong>指向它。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ns"><img src="../Images/39f16155ef69d9ece1dd3a8f12143944.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SQ1lhtg6PV3-5SJXuYOMdg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者截图</p></figure><p id="e8e7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您应该到达如下屏幕，对于主机，您通常应该输入您正在使用的实际IP。点击开始，你会看到蝗虫在行动。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nt"><img src="../Images/6de556154e84b300f1ce146d4162a1bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LDAhC8IbF1KlgvjT_pZchQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者截图</p></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nt"><img src="../Images/d2a72c064874cbfc47e897368a776e9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ESyuwvHxTAzBMxohlgO5dg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">RPS(作者截图)</p></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nu"><img src="../Images/ac4a70c75e3103c557617a654171b8df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L0uj9iteB5VwRWZL2mHPiA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">响应时间(作者截图)</p></figure><p id="1b41" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在您的终端中单击stop之后，您应该会看到一些通用的统计数据，您也可以将其下载为csv文件，以运行进一步的分析或可视化。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nv"><img src="../Images/e2ba449394e8ed227c9e7b06a9018f83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1_d1mtVRCHkVTx3o5AcKFA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">综合统计(作者截图)</p></figure><p id="444a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们看到，Locust跟踪各种指标，如<strong class="lk jd">请求/秒</strong>、<strong class="lk jd">平均吞吐量</strong>、<strong class="lk jd">响应时间</strong>，以及<strong class="lk jd">端到端延迟</strong>的<strong class="lk jd">百分点</strong>。在浏览文档时，您可以使用更高级的Locust功能，下载这些统计数据来运行您自己的函数或服务，以确定您的应用程序的限制，或者当您接近某个延迟或吞吐量阈值时，您不希望越过该阈值。</p><h1 id="4f7c" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">整个代码和结论</h1><div class="nw nx gp gr ny nz"><a href="https://github.com/RamVegiraju/Locust-ML" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd jd gy z fp oe fr fs of fu fw jc bi translated">RamVegiraju/Locust-ML</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">为ML回归模型提供服务的Flask应用程序的蝗虫脚本-RamVegiraju/蝗虫-ML</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">github.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on lb nz"/></div></div></a></div><p id="d7c3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要访问该应用程序的完整代码，请查看上面的链接。Locust是一种非常干净的方法，可以帮助您以高效而简单的方式对应用程序进行负载测试。关于负载/性能测试，还有许多其他的软件或方法，但是我只想强调负载测试在将你的应用提升到生产水平时的普遍重要性。从<strong class="lk jd">节约成本</strong>到<strong class="lk jd">优化</strong>您的<strong class="lk jd">资源</strong>，负载测试对于了解您的端点实际上如何应对您在实时场景中预期的流量至关重要。</p><p id="4b24" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我希望这篇文章是对蝗虫和负载测试的一个很好的介绍。请随时在LinkedIn上与我联系，或者在Medium上关注我，了解我更多的写作内容。分享任何想法或反馈，谢谢阅读！</p></div></div>    
</body>
</html>