<html>
<head>
<title>Bringing all of the infrastructures as a code through ARM Templates</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过ARM模板将所有基础设施作为一个代码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/bringing-all-of-the-infrastructures-as-a-code-through-arm-templates-ba9987ccac1f?source=collection_archive---------39-----------------------#2021-09-22">https://towardsdatascience.com/bringing-all-of-the-infrastructures-as-a-code-through-arm-templates-ba9987ccac1f?source=collection_archive---------39-----------------------#2021-09-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cdf1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用ARM模板通过ARM模板将虚拟机和存储帐户置于安全的私有虚拟网络中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9c79459c479d70a2d842b3588f044045.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ayDFDv5VDVuWefTEONHwNg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">奥马尔·弗洛雷斯在<a class="ae ky" href="https://unsplash.com/s/photos/network?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="63cf" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">动机:</h1><p id="a027" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">假设我们已经有了一个基础设施。有时我们可能需要再次复制相同的基础架构。手动操作肯定会在迁移阶段给我们带来错误。因此，我们将利用来自Azure的名为Azure ARM Templates的服务，以幂等的方式部署我们的基础设施。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="f0ca" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">建筑:</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/1a2ded522a9cfb457c373485d045b1c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*sjG-bVbtEOrFrV67JsD22A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">苏拉布什雷斯塔。通过ARM模板1将所有基础设施作为一个代码。2021.JPEG文件。</p></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="6b5e" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">先决条件:</h1><ol class=""><li id="0391" class="na nb it lt b lu lv lx ly ma nc me nd mi ne mm nf ng nh ni bi translated">Azure Blob存储</li><li id="805e" class="na nb it lt b lu nj lx nk ma nl me nm mi nn mm nf ng nh ni bi translated">Azure虚拟机</li><li id="9797" class="na nb it lt b lu nj lx nk ma nl me nm mi nn mm nf ng nh ni bi translated">Azure VNet</li></ol></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="9edb" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">Azure虚拟网络:</h1><p id="5b97" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Azure虚拟网络是Azure在云中的网络。这个虚拟网络可以细分成不同的子网。在本练习中，我们将创建一个带有一个子网的虚拟网络，该子网是私有的，不能访问互联网。点击<strong class="lt iu">虚拟网络，填写详细信息，点击<strong class="lt iu">查看+创建。</strong></strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/2a4b3fe0f9609fdbaace4e4bdaba20cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zk2l_wohkmnQlo0Obo-n8Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">苏拉布什雷斯塔。通过ARM模板2将所有基础设施作为一个代码。2021.JPEG文件。</p></figure><p id="d59d" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated">您的虚拟网络将成功部署。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/6a076e9eac17ebffe934f6f64ab71f54.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*IylphsZqxP4ff20QuGwd4w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">苏拉布什雷斯塔。通过ARM模板3将所有基础设施作为一个代码。2021.JPEG文件。</p></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="877d" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">Azure虚拟机:</h1><p id="8743" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在，我们在VNet中创建一个Azure虚拟机。点击<strong class="lt iu"> Azure虚拟机，</strong>填写基本细节，选择刚刚创建的<strong class="lt iu"> VNet </strong>，点击<strong class="lt iu">审核+创建。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/07bcfa6499c8f5447b0116a37564e635.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OIeazFxINi-N1tj7JgkrfA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">苏拉布什雷斯塔。通过ARM模板4将所有基础架构作为一个代码。2021.JPEG文件。</p></figure><p id="9be9" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated">部署应成功完成</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/bc82d344eebea096494e81a524159e25.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*oAQR-miXaHrY6hBW7vvfpw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">苏拉布什雷斯塔。通过ARM模板5将所有基础设施作为一个代码。2021.JPEG文件。</p></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="433d" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">Azure Blob存储:</h1><p id="eede" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们创建Azure Blob存储。点击<strong class="lt iu">存储账户，+创建，</strong>填写基本信息，点击<strong class="lt iu">审核+创建。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/45df418d2fcae5a117e67690f99f02c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BZnkeh5VSy2mt2OMTVYEyA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">苏拉布什雷斯塔。通过ARM模板6将所有基础设施作为一个代码。2021.JPEG文件。</p></figure><p id="efe3" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated">您的部署将被创建。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/bf1e1cc38148aabb891e3cfbfb118ac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*dTL3ykwxXwxiwDBpeIhICA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">苏拉布什雷斯塔。通过ARM模板7将所有基础设施作为一个代码。2021.JPEG文件。</p></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="c1ec" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">ARM模板:</h1><p id="b81a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">ARM模板是以JSON形式编写基础设施以获得最大可用性的幂等方法。创建虚拟机、虚拟网络和子网是一个非常漫长的过程，我们在创建过程中可能会出现错误，因此，ARM模板是首选。我已经创建了ARM模板，并且在我的<a class="ae ky" href="https://github.com/codexponent/azure-arm-infrastructure" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上。但是不要担心，我会教你如何编写ARM模板，更重要的是生成它们，因为从头开始编写非常困难。</p><p id="1ba8" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated">假设我已经创建了一些基础设施，我想为它创建一个ARM模板。进入<strong class="lt iu">资源组，</strong>选择<strong class="lt iu">资源，</strong>和<strong class="lt iu">导出模板。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/1b20fdaeb8117cee5079aa90a84ee2ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SSgBMehCrVkcXERUqCNjvQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">苏拉布什雷斯塔。通过ARM模板8将所有基础设施作为一个代码。2021.JPEG文件。</p></figure><p id="cd0f" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated">然后点击<strong class="lt iu">下载</strong>按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/2c9682145ea9310c280b19d4ed7e485d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kX4SK8LDiD0MWt_15jHBVg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">苏拉布什雷斯塔。通过ARM模板9将所有基础设施作为一个代码。2021.JPEG文件。</p></figure><p id="d10d" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated">您将获得template.json和parameter.json。template . JSON包含您想要使用其详细信息创建的基础结构，parameter . JSON包含您想要为资源指定的唯一名称。在这篇文章中，我将添加我的默认值。您可以通过parameter.json添加唯一的名称，并输入下面给出的命令。</p><p id="245e" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated">在您使用CLI执行命令后，它可能无法运行，因为您必须对JSON文件进行一些整理，比如删除订阅id以实现动态可用性，还需要删除不必要的键值对。对于这篇文章，你不必担心，因为我提供的JSON已经发挥到了极致。打开代码后，这里是您需要线性输入的命令。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="06dc" class="of la it ob b gy og oh l oi oj">az create group --name prem-vm --location eastus</span><span id="e9d4" class="of la it ob b gy ok oh l oi oj">az deployment group create --resource-group prem-rg --template-file template.json</span></pre></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="0042" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">演示:</h1><p id="8d16" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">正如在体系结构中承诺的那样，让我们检查一下虚拟机和存储帐户。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/3938c178cfa10fe5d7bf6cb6e90a3b10.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*TB4jP9k_kqL3qUo6L3OLNw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">苏拉布什雷斯塔。通过ARM模板10将所有基础架构作为一个代码。2021.JPEG文件。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/8b4a298bb79d43edb3ed3d6777620d7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jWEKIaIO6mrxHjOkx2F47w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">苏拉布什雷斯塔。通过ARM模板11将所有基础设施作为一个代码。2021.JPEG文件。</p></figure><p id="23a6" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated">我们的两个资源都在我们创建的虚拟网络中。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="0366" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">结论:</h1><p id="5c65" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们展示了如何利用Azure ARM模板轻松创建复杂的基础设施。这只是最低限度，因为我们可以向ARM模板添加越来越多的内容。还有其他工具，如Terraform和Pulumi，我们可以利用它们以声明和命令的方式编写IaC代码。可能性是无限的，选择是无限的，你想做什么取决于你自己。如果你遇到任何问题或难以遵循这些步骤，请在下面评论这篇文章或在tsulabh4@gmail.com给我发消息。你也可以在<a class="ae ky" href="https://www.linkedin.com/in/sulabhshrestha/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>和<a class="ae ky" href="https://github.com/codexponent" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上和我联系。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="c9ec" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">资源:</h1><p id="4eee" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">[1] Azure虚拟网络:<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/Azure/Virtual-Network/Virtual-networks-overview</a></p><p id="fcfa" class="pw-post-body-paragraph lr ls it lt b lu np ju lw lx nq jx lz ma nr mc md me ns mg mh mi nt mk ml mm im bi translated">[2] ARM模板:<a class="ae ky" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/overview" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/azure-resource-manager/templates/overview</a></p></div></div>    
</body>
</html>