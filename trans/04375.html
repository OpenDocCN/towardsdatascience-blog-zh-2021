<html>
<head>
<title>Getting NYT Article Data and Saving It to a SQL Database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">获取NYT文章数据并将其保存到SQL数据库中</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/getting-newspaper-article-data-and-saving-it-to-a-sql-database-651602ee929f?source=collection_archive---------34-----------------------#2021-04-13">https://towardsdatascience.com/getting-newspaper-article-data-and-saving-it-to-a-sql-database-651602ee929f?source=collection_archive---------34-----------------------#2021-04-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="436b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">从纽约时报API获取文章数据并保存到SQLite数据库</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ef81b98cfef0ca088c7e5cb44f72cf60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s6pG2ZsJC3fCirTf"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">斯蒂芬·瓦伦丁在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="3d35" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">介绍</h1><p id="ab2e" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">本周，我决定学习更多关于文字处理的知识，从基于报纸数据构建一些文字云开始。同时，我想提高我收集数据并将其保存到数据库中的知识。</p><p id="523e" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我在这里的主要目标是获取并保存一些我可以使用的有趣数据。我认为2020年的报纸文章会很有趣，可以看到每个月的新闻主题。</p><p id="9e7a" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">最初，我从不同的报纸档案中寻找文章。有许多很棒的工具，但我能找到的提供API的工具并不多。我发现《纽约时报》确实有一个API，提供与他们的文章相关的数据。</p><p id="5ce4" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">这是一篇记录我的学习历程的文章，从API获取数据并保存到SQLite DB。</p><h1 id="95cb" class="ld le iq bd lf lg mw li lj lk mx lm ln jw my jx lp jz mz ka lr kc na kd lt lu bi translated">关于API</h1><p id="d761" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">这些API可在https://developer.nytimes.com/apis<a class="ae kv" href="https://developer.nytimes.com/apis" rel="noopener ugc nofollow" target="_blank">获得</a></p><p id="4207" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我发现API的文档(包括<a class="ae kv" href="https://developer.nytimes.com/faq" rel="noopener ugc nofollow" target="_blank">https://developer.nytimes.com/faq</a>的常见问题解答)对入门非常有用。</p><p id="500c" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">《纽约时报》提供了许多不同的API，包括Books API，其中包含有关畅销书列表和书评的信息，Film API，用于电影评论，以及Community API，其中包含有关用户生成的内容(如评论)的信息。</p><p id="4f0e" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在本文中，我使用的是归档API(<a class="ae kv" href="https://developer.nytimes.com/docs/archive-product/1/overview" rel="noopener ugc nofollow" target="_blank">https://developer . nytimes . com/docs/Archive-product/1/overview</a>)。如果您将年份和月份传递给API，它将返回该月的文章数据。文章数据告诉我们很多事情，包括NYT网站上的全文，发表时间，标题和导语。</p><h2 id="1c64" class="nb le iq bd lf nc nd dn lj ne nf dp ln me ng nh lp mi ni nj lr mm nk nl lt nm bi translated">获取访问权限</h2><p id="3368" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">使用API的第一步是建立一个帐户并获得访问权限(<a class="ae kv" href="https://developer.nytimes.com/get-started" rel="noopener ugc nofollow" target="_blank">https://developer.nytimes.com/get-started</a>)</p><h2 id="a29b" class="nb le iq bd lf nc nd dn lj ne nf dp ln me ng nh lp mi ni nj lr mm nk nl lt nm bi translated">要求</h2><p id="86c3" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">我使用了<em class="nn">请求</em>、<em class="nn"> sqlite3 </em>和<em class="nn">时间。</em></p><h1 id="2bcf" class="ld le iq bd lf lg mw li lj lk mx lm ln jw my jx lp jz mz ka lr kc na kd lt lu bi translated">步伐</h1><p id="4484" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">我在这里经历三个步骤。我:</p><ol class=""><li id="cd4e" class="no np iq lx b ly mr mb ms me nq mi nr mm ns mq nt nu nv nw bi translated">连接到API以浏览可用的数据，并查看我想要保存的数据。</li><li id="a4b1" class="no np iq lx b ly nx mb ny me nz mi oa mm ob mq nt nu nv nw bi translated">基于我要保存的数据建立一个数据库表。</li><li id="de14" class="no np iq lx b ly nx mb ny me nz mi oa mm ob mq nt nu nv nw bi translated">获取一年中每个月的数据并保存到数据库中。</li></ol><h1 id="d8d1" class="ld le iq bd lf lg mw li lj lk mx lm ln jw my jx lp jz mz ka lr kc na kd lt lu bi translated">探索数据</h1><p id="64b4" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">在这里，我导入我将使用的内容。<em class="nn">请求</em>将调用API，<em class="nn"> sqlite3 </em>用于与数据库和<em class="nn">时间</em>交互，因此脚本可以在调用之间休眠。医生建议两次通话间隔6秒，以避免达到极限。</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="5337" class="nb le iq od b gy oh oi l oj ok">import requests<br/>import sqlite3<br/>import time</span></pre><p id="6cfa" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在这一行中，我发出一个初始请求来查看数据是什么样子的。您的纽约时报API帐户中生成的API密钥将放在[您的API密钥]占位符中。使用这个API进行身份验证非常简单</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="b39e" class="nb le iq od b gy oh oi l oj ok">data_2020_01 = requests.get("<a class="ae kv" href="https://api.nytimes.com/svc/archive/v1/2020/1.json?api-key=rukHkq9CptpyckwG9qfMpHX7C06rn9zK" rel="noopener ugc nofollow" target="_blank">https://api.nytimes.com/svc/archive/v1/2020/1.json?api-key=</a>[YOUR API KEY]")</span></pre><p id="789e" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">归档API将数据作为JSON响应返回。该信息在API网站上给出，但是也可以检查请求响应头，以查看返回的内容类型。是“应用/json”:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/664fc41929cdcae9596354c6454d57dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*ZlQePWcNiAqgRYWyYI1bTg.png"/></div></div></figure><p id="30ae" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">知道了这一点，我可以使用Requests自己的JSON解码器将响应转换成python字典:</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="a524" class="nb le iq od b gy oh oi l oj ok">data_2020_01_json = data_2020_01.json()</span></pre><p id="150e" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">打印数据显示这是一本字典。文章本身包含在字典的列表中:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi om"><img src="../Images/511a6076796c5c6a0aa52e209fddca5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*yTfF0gGXwNct_hOVypW23A.png"/></div></figure><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="21a1" class="nb le iq od b gy oh oi l oj ok">data_2020_01_articles = data_2020_01_json['response']['docs']</span></pre><p id="0e68" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">该列表的长度为4480，这意味着它包含以下数量的文章:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi on"><img src="../Images/f044d6dab2ef8b179c2cebfc8a4354e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*_PpUVJYMbqx-H2JuFnREEQ.png"/></div></figure><p id="1075" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">为了探究一篇文章，我在列表中取一个数字，直到4480，来查看它。例如，在位置10的文章:</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="f40f" class="nb le iq od b gy oh oi l oj ok">data_2020_01_articles[10]</span></pre><p id="fe1b" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">关于这篇文章有很多信息——比如它的web_url、lead_paragraph、它在哪个部分(section_name)以及它发表的时间(pub_date)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/6ac329aea1005ee81103a1054a7da234.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*MC6zGrYtuVxoEmrKRN_3FQ.png"/></div></figure><p id="163f" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我想先保存标题、引导段落和出版日期。我认为材料的类型也可能是有趣的，还有字数、主要标题、印刷页、新闻桌和版块名称。</p><h1 id="e108" class="ld le iq bd lf lg mw li lj lk mx lm ln jw my jx lp jz mz ka lr kc na kd lt lu bi translated">数据库</h1><p id="bcc9" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">数据库有许多选项。这里我使用SQL lite。这样做的一个主要优点是我可以很容易地用python创建它并与之交互。我在<a class="ae kv" href="https://docs.python.org/3/library/sqlite3.html" rel="noopener ugc nofollow" target="_blank">https://docs.python.org/3/library/sqlite3.html</a>使用文档工作</p><h2 id="5325" class="nb le iq bd lf nc nd dn lj ne nf dp ln me ng nh lp mi ni nj lr mm nk nl lt nm bi translated">构建数据库</h2><p id="0dfe" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">我想在我们的数据库中保存作为一行返回的每篇文章，并为上面提到的每个字段(即，主标题，打印页面，新闻桌面等)列。,)</p><p id="8785" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我正在创建的特定列:</p><p id="2a21" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated"><strong class="lx ir"> _id </strong>(这将是文章的唯一id。API为每篇文章返回一个)，<strong class="lx ir"> web_url </strong>，<strong class="lx ir"> main_headline </strong>，<strong class="lx ir"> pub_date </strong>，<strong class="lx ir"> news_desk </strong>，<strong class="lx ir"> section_name </strong>，<strong class="lx ir"> type_of_material </strong>，<strong class="lx ir"> word_count </strong>。</p><h2 id="abd4" class="nb le iq bd lf nc nd dn lj ne nf dp ln me ng nh lp mi ni nj lr mm nk nl lt nm bi translated">创建数据库和表</h2><p id="fb40" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">使用python直接连接和创建数据库:</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="407e" class="nb le iq od b gy oh oi l oj ok">connection = sqlite3.connect('nytimes_articles.db')</span></pre><p id="7421" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">创建一个游标对象，以便我可以开始执行查询:</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="f15b" class="nb le iq od b gy oh oi l oj ok">cur = connection.cursor()</span></pre><p id="6b5c" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">使用游标的execute方法创建表:</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="33e6" class="nb le iq od b gy oh oi l oj ok">cur.execute('''CREATE TABLE articles(_id TEXT, lead_pargraph TEXT,  web_url TEXT, main_headline TEXT, pub_date TEXT, news_desk TEXT, section_name TEXT, type_of_material TEXT, word_count INT)''')</span></pre><h1 id="1bf7" class="ld le iq bd lf lg mw li lj lk mx lm ln jw my jx lp jz mz ka lr kc na kd lt lu bi translated">保存数据</h1><p id="dbcf" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">所以，我想得到一年中每个月的数据。早些时候，我获取了一个月的数据，以探索数据的结构，但现在我需要编写一个函数来获取每个月的数据，然后将每个月的数据保存到刚刚创建的数据库中。</p><p id="3f50" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在这里，我编写了一个函数来为我想要获取数据的每个月生成一个URL。</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="659a" class="nb le iq od b gy oh oi l oj ok">def generate_urls():<br/>    month_range = range(1,13)<br/>    api_key = "[YOUR API KEY]"<br/>    urls = []<br/>    for month in month_range:<br/>        url = (f"<a class="ae kv" href="https://api.nytimes.com/svc/archive/v1/2020/{month}.json?api-key={api_key" rel="noopener ugc nofollow" target="_blank">https://api.nytimes.com/svc/archive/v1/2020/{month}.json?api-key={api_key</a>}")<br/>        urls.append(url)<br/>    return urls</span></pre><p id="5616" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我将遍历我要访问的url列表(由上述函数返回，访问每个URL，并使用每个月返回的数据，遍历文章列表。然后，我将数据库中每一行的值添加为一个元组，然后将每个元组存储在一个列表中。每个月结束后，我都会把这些写在数据库里。</p><p id="bb87" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">重要的是，数据以与数据库中的列相同的顺序保存在元组中，即:_id、lead_paragraph、web_url、main_headline、pub_date、news_desk、section_name、type_of_material、word_count</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="4974" class="nb le iq od b gy oh oi l oj ok">month_urls = generate_urls()</span><span id="a404" class="nb le iq od b gy op oi l oj ok">for month in month_urls:<br/>    data = requests.get(month)<br/>    data_json = data.json()<br/>    data_articles = data_json['response']['docs']   <br/>    values_for_db = []</span><span id="e22b" class="nb le iq od b gy op oi l oj ok">for article in data_articles:<br/>        row = (article['_id'], article['lead_paragraph'], article['web_url'], article['headline']['main'], article['pub_date'], article['news_desk'], article['section_name'], article['type_of_material'], article['word_count'])<br/>        values_for_db.append(row)<br/>    <br/>    cur.executemany('INSERT INTO articles VALUES (?,?,?,?,?,?,?,?,?)', values_for_db)<br/>    time.sleep(6)<br/>    connection.commit()</span><span id="9a1a" class="nb le iq od b gy op oi l oj ok">connection.close()</span></pre><h1 id="a728" class="ld le iq bd lf lg mw li lj lk mx lm ln jw my jx lp jz mz ka lr kc na kd lt lu bi translated">数据</h1><p id="6f98" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">我使用了SQLite的DB浏览器来查看文章数据。在这里，我可以很容易地看到保存了什么。55，493篇文章的数据:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/edd39d9cf802f45d3b08a18d9dba0e4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*PL4x_t-b8QvEf1BlW40ubw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="3d5a" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我发现使用这个API非常简单，它有很多关于纽约时报上文章的有趣信息。虽然API没有提供整篇文章的文本，但是lead_paragraph字段应该是每篇文章中提到的内容的一个很好的指示器。今年，我计划在文字云可视化之前对文本进行命名实体识别。这也可能是用于情感分析的有趣数据。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="f45d" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">介绍图片是<a class="ae kv" href="https://unsplash.com/@valentinsteph?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">斯蒂芬·瓦伦丁</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的一张照片。其他所有图片均由作者拍摄。本文中使用的代码可以在这里找到:</p><div class="or os gp gr ot ou"><a href="https://github.com/LiamConnors/Medium-articles" rel="noopener  ugc nofollow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd ir gy z fp oz fr fs pa fu fw ip bi translated">Liam Connors/Medium-文章</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">我在媒体上发表的文章的代码。为LiamConnors/Medium-articles开发创建一个…</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">github.com</p></div></div><div class="pd l"><div class="pe l pf pg ph pd pi kp ou"/></div></div></a></div></div></div>    
</body>
</html>