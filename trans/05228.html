<html>
<head>
<title>How to Convert Loops to List Comprehensions in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中将循环转换成列表理解</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-convert-loops-to-list-comprehension-in-python-15efcc696759?source=collection_archive---------10-----------------------#2021-05-08">https://towardsdatascience.com/how-to-convert-loops-to-list-comprehension-in-python-15efcc696759?source=collection_archive---------10-----------------------#2021-05-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9de2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">做同样的事，但要更快</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/869f31634a281b2f2a068606c2eb5514.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UNJ2pHsh-kUiy-tAkvGEwA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@acharki95?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">阿齐兹·阿查基</a>在<a class="ae ky" href="https://unsplash.com/s/photos/change?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="b55a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">列表理解用于创建基于可重复项的列表。它还可以被描述为用更简单、更吸引人的语法来表示for和if循环。列表理解相对来说比循环要快。</p><p id="0a12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">列表理解的语法其实很容易理解。然而，当涉及到复杂和嵌套的操作时，弄清楚如何构造一个列表理解可能会有点棘手。</p><p id="af0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，首先编写循环版本可以更容易地编写理解列表的代码。我们将通过几个例子来演示如何将循环语法转换成列表理解。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/ae183432ffdfa7283dd3b5ab06980928.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*34v9uRNWR18yHUF3.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">列表理解的基本结构(图片由作者提供)</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="5dd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从一个简单的例子开始。我们有一个5个整数的列表，想要创建一个包含每一项的平方的列表。下面是执行此操作的for循环。</p><pre class="kj kk kl km gt md me mf mg aw mh bi"><span id="f80a" class="mi mj it me b gy mk ml l mm mn">lst_a = [1, 2, 3, 4, 5]</span><span id="606f" class="mi mj it me b gy mo ml l mm mn">lst_b = []<br/>for i in lst_a:<br/>   lst_b.append(i**2)</span><span id="0145" class="mi mj it me b gy mo ml l mm mn">print(lst_b)<br/>[1, 4, 9, 16, 25]</span></pre><p id="b27b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同一任务的列表理解版本:</p><pre class="kj kk kl km gt md me mf mg aw mh bi"><span id="fd7e" class="mi mj it me b gy mk ml l mm mn">lst_b = [i**2 for i in lst_a]</span><span id="91ee" class="mi mj it me b gy mo ml l mm mn">print(lst_b)<br/>[1, 4, 9, 16, 25]</span></pre><p id="f999" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经注意到列表理解是如何简化语法的。它是一个强大的一行程序。下图说明了这种转换。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/bce912d59d9d2521ea2e60f95254cf3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*5XcGoF3d2RSLl3nuphtj1Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="565d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">列表理解从最后一个操作开始。然后，我们放置定义for循环的线。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="e27a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">列表理解中的运算可能比单一的数学运算更复杂。考虑下面的名字列表。</p><pre class="kj kk kl km gt md me mf mg aw mh bi"><span id="3a75" class="mi mj it me b gy mk ml l mm mn">names = ["John Doe", "Jane Doe", "Mike Fence"]</span></pre><p id="eb96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们希望创建一个只包含名字的列表。下面是完成此任务的循环:</p><pre class="kj kk kl km gt md me mf mg aw mh bi"><span id="8aef" class="mi mj it me b gy mk ml l mm mn">first_names = []<br/>for name in names:<br/>   first_names.append(name.split(" ")[0])</span><span id="e66d" class="mi mj it me b gy mo ml l mm mn">print(first_names)<br/>['John', 'Jane', 'Mike']</span></pre><p id="b97d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先在空格字符处拆分名称字符串，然后取第一个单词。将这个循环转换为列表理解与前面的例子非常相似。</p><pre class="kj kk kl km gt md me mf mg aw mh bi"><span id="f827" class="mi mj it me b gy mk ml l mm mn">first_names = [name.split(" ")[0] for name in names]</span><span id="922d" class="mi mj it me b gy mo ml l mm mn">print(first_names)<br/>['John', 'Jane', 'Mike']</span></pre></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="8ce6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以在列表理解中放置条件语句。让我们重复前面的例子，但有一个条件。名字列表将只包含以字母j开头的名字。</p><pre class="kj kk kl km gt md me mf mg aw mh bi"><span id="156f" class="mi mj it me b gy mk ml l mm mn">first_names = []<br/>for name in names:<br/>   if name.startswith("J"):<br/>      first_names.append(name.split(" ")[0])</span><span id="2a92" class="mi mj it me b gy mo ml l mm mn">print(first_names)<br/>['John', 'Jane']</span></pre><p id="5c7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用<code class="fe mq mr ms me b">startswith</code>方法来应用期望的条件。相同的条件被添加到如下的列表理解中。</p><pre class="kj kk kl km gt md me mf mg aw mh bi"><span id="2984" class="mi mj it me b gy mk ml l mm mn">first_names = [name.split(" ")[0] for name in names if name.startswith("J")]</span><span id="9e4f" class="mi mj it me b gy mo ml l mm mn">print(first_names)<br/>['John', 'Jane']</span></pre><p id="d5f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图演示了这种转换。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/2dd4d35767d166a55f64d860ea28ce31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d11iI7mP9xjgTNqgSppx6w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="2995" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们把最后的操作放在列表理解的开头。然后，我们按照彩色框的指示，从上到下进行操作。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="86fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你遵循这个逻辑，你可以很容易地将复杂的循环转换成列表理解。让我们以一个稍微复杂一点的例子来结束。考虑下面的3个列表。</p><pre class="kj kk kl km gt md me mf mg aw mh bi"><span id="e646" class="mi mj it me b gy mk ml l mm mn">lst_a = [[4,3,5], [1,5,3,8], [1,6,2,4]]</span></pre><p id="34f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们希望创建一个新列表，包含嵌套列表中所有大于3的数字。</p><pre class="kj kk kl km gt md me mf mg aw mh bi"><span id="9c2c" class="mi mj it me b gy mk ml l mm mn">mylist = []</span><span id="2463" class="mi mj it me b gy mo ml l mm mn">for lst in lst_a:<br/>   for item in lst:<br/>      if item &gt; 3:<br/>         mylist.append(item)</span><span id="bc07" class="mi mj it me b gy mo ml l mm mn">print(mylist)<br/>[4, 5, 5, 8, 6, 4]</span></pre><p id="3586" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行此任务的列表理解是:</p><pre class="kj kk kl km gt md me mf mg aw mh bi"><span id="d9ef" class="mi mj it me b gy mk ml l mm mn">mylist = [item for lst in lst_a for item in lst if item &gt; 3]</span></pre><p id="a3ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然这个循环比前几个循环更复杂，但将其转换为列表理解的逻辑是相同的。</p><p id="4884" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它从循环中的最后一个操作开始。然后，我们沿着从上到下的循环。循环中的每一行在理解中都是连续的。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="aebd" class="mi mj it bd mu mv mw dn mx my mz dp na li nb nc nd lm ne nf ng lq nh ni nj nk bi translated">结论</h2><p id="2ec6" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">一般来说，列表理解比循环更快。它通过将整个列表加载到内存中来提高速度。</p><p id="ee92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当处理大型列表(例如10亿个元素)时，这种方法有一个缺点。这可能会导致您的计算机崩溃，由于内存需求的极端数额。</p><p id="7a5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这种大型列表，更好的替代方法是使用一个生成器，它不会在内存中创建大型数据结构。生成器在项目被调用时创建它们。</p><p id="57bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>