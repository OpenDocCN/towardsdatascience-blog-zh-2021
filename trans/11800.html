<html>
<head>
<title>Refactoring a Jupyter notebook into a maintainable pipeline: A step-by-step guide (Part I)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Jupyter笔记本重构为可维护的管道:分步指南(第一部分)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/refactoring-a-jupyter-notebook-into-a-maintainable-pipeline-a-step-by-step-guide-part-i-e9e9789c3368?source=collection_archive---------15-----------------------#2021-11-24">https://towardsdatascience.com/refactoring-a-jupyter-notebook-into-a-maintainable-pipeline-a-step-by-step-guide-part-i-e9e9789c3368?source=collection_archive---------15-----------------------#2021-11-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="e24d" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">从Jupyter开发可维护的项目</h2><div class=""/><div class=""><h2 id="c70b" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">将Jupyter笔记本转换成模块化可维护项目的详细指南。</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/d357a3b621c2bb04140c8113863c167c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3koNEGL1L6Ri6h-x2QMAmg.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片作者。</p></figure><blockquote class="le lf lg"><p id="7f58" class="lh li lj lk b ll lm ka ln lo lp kd lq lr ls lt lu lv lw lx ly lz ma mb mc md ij bi translated"><strong class="lk ja"> <em class="iq">更新:我们发布了</em> </strong> <code class="fe me mf mg mh b"><a class="ae mi" href="https://github.com/ploomber/soorgeon" rel="noopener ugc nofollow" target="_blank"><strong class="lk ja"><em class="iq">soorgeon</em></strong></a></code> <strong class="lk ja"> <em class="iq">，一款自动重构遗留笔记本的工具！</em>T15】</strong></p><p id="49b8" class="lh li lj lk b ll lm ka ln lo lp kd lq lr ls lt lu lv lw lx ly lz ma mb mc md ij bi translated">更新:第二部<a class="ae mi" href="https://ploomber.io/blog/refactor-nb-ii/" rel="noopener ugc nofollow" target="_blank">此处可用</a>。</p></blockquote><p id="6e5a" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">在过去的几个月里，我们与许多数据团队进行了交谈，以帮助他们开始使用<a class="ae mi" href="https://github.com/ploomber/ploomber" rel="noopener ugc nofollow" target="_blank"> Ploomber </a>来开发可维护的和生产就绪的管道。经常出现的一个问题是，<em class="lj">我们如何重构现有的笔记本电脑？</em>这个博客系列提供了一步一步的指南，将单体Jupyter笔记本转换成可维护的流水线。</p><p id="165c" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">为了确保你知道第二部何时上映，<a class="ae mi" href="https://twitter.com/intent/user?screen_name=ploomber" rel="noopener ugc nofollow" target="_blank">在Twitter上关注我们</a>或<a class="ae mi" href="https://www.getrevue.co/profile/ploomber" rel="noopener ugc nofollow" target="_blank">订阅我们的时事通讯</a>。让我们开始吧。</p><h1 id="4ae3" class="mm mn iq bd mo mp mq mr ms mt mu mv mw kf mx kg my ki mz kj na kl nb km nc nd bi translated">介绍</h1><p id="59b8" class="pw-post-body-paragraph lh li iq lk b ll ne ka ln lo nf kd lq mj ng lt lu mk nh lx ly ml ni mb mc md ij bi translated">驻留在<code class="fe me mf mg mh b">.ipynb</code>中的代码变得非常混乱。因此，在笔记本创建几天后，这样的文件包含数百个单元格和几十个表格和图表是很常见的。</p><p id="5725" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">这种笔记本就是我们所说的Jupyter monolith:一个包含从数据加载、清理、绘图等所有内容的笔记本。不幸的是，维护Jupyter monolith是非常困难的，因为任务之间没有明确的界限，并且没有一种简单的方法来单独测试各个部分。所以我们的目标是把一个凌乱的笔记本变成这样:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nj"><img src="../Images/a3a08917bc59b7be21306515bced1289.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y_ki6LE1V9bQFg_dK3EfBA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片作者。</p></figure><h1 id="3687" class="mm mn iq bd mo mp mq mr ms mt mu mv mw kf mx kg my ki mz kj na kl nb km nc nd bi translated">步骤1:确保笔记本运行</h1><p id="e145" class="pw-post-body-paragraph lh li iq lk b ll ne ka ln lo nf kd lq mj ng lt lu mk nh lx ly ml ni mb mc md ij bi translated">假设您的项目目前如下所示:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="594d" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">这种文件布局是典型的:<code class="fe me mf mg mh b">.py</code>文件可能包含一些实用函数，但是大部分代码都在<code class="fe me mf mg mh b">analysis.ipynb</code>笔记本中。在重构我们的代码之前，让我们首先添加三个有助于我们测试管道的文件:</p><ol class=""><li id="6124" class="nm nn iq lk b ll lm lo lp mj no mk np ml nq md nr ns nt nu bi translated">从属关系:<code class="fe me mf mg mh b">requirements.txt</code></li><li id="8f48" class="nm nn iq lk b ll nv lo nw mj nx mk ny ml nz md nr ns nt nu bi translated">Ploomber管道规格:<code class="fe me mf mg mh b">pipeline.yaml</code></li><li id="17c4" class="nm nn iq lk b ll nv lo nw mj nx mk ny ml nz md nr ns nt nu bi translated">一份<code class="fe me mf mg mh b">analysis.ipynb</code>(取名<code class="fe me mf mg mh b">pipeline.ipynb</code>)。我们创建一个副本来保存我们的原始输出单元格作为参考。</li></ol><p id="95ed" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">如果你已经有一个<code class="fe me mf mg mh b">requirements.txt</code>，使用它。否则，创建一个包含以下内容的文件:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="829a" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">您的<code class="fe me mf mg mh b">pipeline.yaml</code>应该是这样的:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="7450" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">然后，添加以下内容作为<code class="fe me mf mg mh b">pipeline.ipynb</code>的顶部单元格:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="5234" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">并用<code class="fe me mf mg mh b">parameters</code>标记该单元格。<a class="ae mi" href="https://ploomber.io/s/params" rel="noopener ugc nofollow" target="_blank">点击此处</a>获取细胞标记说明。</p><p id="78c9" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">此时，您的项目如下所示:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="627d" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">现在，让我们创建一个虚拟环境并运行我们的管道。创建虚拟环境的确切步骤取决于您使用的包管理器和虚拟环境管理器；如果在Linux/macOS上使用<code class="fe me mf mg mh b">pip</code>，这里有一些示例代码:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="c74b" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">由于缺少依赖关系，管道可能会崩溃(也就是说，您将看到一个<code class="fe me mf mg mh b">ModuleNotFound</code>错误)。所以首先，使用<code class="fe me mf mg mh b">pip install {name}</code>安装任何缺失的依赖项，并在<code class="fe me mf mg mh b">requirements.txt</code>中添加一个带有包名的新行；请重试，直到管道运行。</p><p id="032f" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">我们的<code class="fe me mf mg mh b">requirements.txt</code>文件包含运行项目所需的依赖项列表。尽管如此，它并没有指定特定的版本；因此，今天运行<code class="fe me mf mg mh b">pip install -r requirements.txt</code>并在一个月后运行它将会产生一组不同的依赖版本(例如<code class="fe me mf mg mh b">pandas 1.2</code>对<code class="fe me mf mg mh b">pandas 1.3</code>)，这可能会破坏我们的管道。要防止这种情况，请执行以下操作:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="e16d" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated"><code class="fe me mf mg mh b">pip freeze</code>打印依赖项及其相应版本的详尽列表。下次运行您的管道时，您可以执行<code class="fe me mf mg mh b">pip install -r requirements.lock.txt</code>来获得您当前拥有的相同环境。确保每次修改<code class="fe me mf mg mh b">requirements.txt</code>时都重新生成<code class="fe me mf mg mh b">requirements.lock.txt</code>。</p><p id="3310" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">如果您消除了<code class="fe me mf mg mh b">ModuleNotFound</code>错误，但是您仍然看到其他类型的错误，您的管道可能由于不同的原因而损坏。所以让我们进入下一阶段来解决这个问题。</p><h1 id="145c" class="mm mn iq bd mo mp mq mr ms mt mu mv mw kf mx kg my ki mz kj na kl nb km nc nd bi translated">步骤2:使用数据样本进行冒烟测试</h1><p id="7994" class="pw-post-body-paragraph lh li iq lk b ll ne ka ln lo nf kd lq mj ng lt lu mk nh lx ly ml ni mb mc md ij bi translated">数据管道往往是长时间运行的过程，可能需要几个小时才能运行。为了加速调试过程，我们让它快速失败，修复错误，然后重复。</p><p id="ca10" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">要启用快速测试，首先，在<code class="fe me mf mg mh b">analysis.ipynb</code>笔记本的<code class="fe me mf mg mh b">parameters</code>单元格中添加一个新变量:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="4647" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">并向您的<code class="fe me mf mg mh b">pipeline.yaml</code>添加一个新参数:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="98fb" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">我们希望<code class="fe me mf mg mh b">sample</code>参数控制是使用整个数据集还是一个样本。现在，定位笔记本中正在加载或下载<em class="lj">原始数据</em>的所有单元格，例如:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="5198" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">并在那里使用<code class="fe me mf mg mh b">sample</code>参数:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="0305" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">您可以用一部分数据重现数据管道中的许多错误。这里的目标是加快执行时间，以便更快地删除这些错误。既然我们的管道默认使用一个样本运行，让我们重新运行它:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="4aea" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">要运行整个数据集，执行<code class="fe me mf mg mh b">ploomber build --help</code>，您将看到要传递的CLI参数来切换<code class="fe me mf mg mh b">sample</code>参数。</p><p id="561c" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">继续使用示例运行管道，直到它成功执行。</p><h2 id="4681" class="oa mn iq bd mo ob oc dn ms od oe dp mw mj of og my mk oh oi na ml oj ok nc iw bi translated">解决常见不兼容问题的一些建议</h2><p id="1a71" class="pw-post-body-paragraph lh li iq lk b ll ne ka ln lo nf kd lq mj ng lt lu mk nh lx ly ml ni mb mc md ij bi translated">在执行笔记本时，一个常见的错误来源是最初用于开发它的依赖版本(如<code class="fe me mf mg mh b">pandas 1.2</code>)与最新版本(如<code class="fe me mf mg mh b">pandas 1.3</code>)不同。如果任何库引入了破坏API的更改，您的管道将不再运行。修复依赖版本问题是一个反复试验的过程，所以要注意错误的类型，并查看库的文档来寻找API中的变化。如果是这种情况，请降级依赖关系，直到问题得到解决:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="66bf" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">如果您做了这样的更改，记得再次生成<code class="fe me mf mg mh b">requirements.lock.txt</code>文件。</p><p id="2724" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">如果由于API更改而无法追溯错误，事情会变得更加复杂，所以让我们进入下一步。</p><h1 id="34b6" class="mm mn iq bd mo mp mq mr ms mt mu mv mw kf mx kg my ki mz kj na kl nb km nc nd bi translated">第三步:修复破裂的管道</h1><p id="1d58" class="pw-post-body-paragraph lh li iq lk b ll ne ka ln lo nf kd lq mj ng lt lu mk nh lx ly ml ni mb mc md ij bi translated"><em class="lj">注意:如果步骤1中创建的管道运行正常，可以跳过这一步。</em></p><p id="9012" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">这一步的目标是确保您的笔记本从开始运行到结束。最有可能的是，该项目不包含任何测试，所以您必须知道代码是否做了它应该做的事情的唯一参考是原始的<code class="fe me mf mg mh b">analysis.ipynb</code>笔记本和记录的输出。</p><p id="6599" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">在Jupyter中打开<code class="fe me mf mg mh b">pipeline.ipynb</code>并从上到下运行它(确保转动<code class="fe me mf mg mh b">sample=False</code>以使用整个数据集)。然后，在每个单元格上，比较<code class="fe me mf mg mh b">analysis.ipynb</code>的输出(如果有的话),确保它匹配。这就是你的判断发挥作用的地方，因为一些代码行可能涉及随机过程(例如，绘制随机数)；因此，输出不会完全匹配。</p><p id="cd0e" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">继续，直到:</p><ol class=""><li id="72fe" class="nm nn iq lk b ll lm lo lp mj no mk np ml nq md nr ns nt nu bi translated">输出不匹配，或者</li><li id="ba01" class="nm nn iq lk b ll nv lo nw mj nx mk ny ml nz md nr ns nt nu bi translated">密码被破解了</li></ol><h2 id="f259" class="oa mn iq bd mo ob oc dn ms od oe dp mw mj of og my mk oh oi na ml oj ok nc iw bi translated">如果密码被破解了</h2><p id="2887" class="pw-post-body-paragraph lh li iq lk b ll ne ka ln lo nf kd lq mj ng lt lu mk nh lx ly ml ni mb mc md ij bi translated">如果某个单元格出现问题，请执行以下操作:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="89a5" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">前面的命令从最新引发的异常开始调试会话。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="9c82" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated"><code class="fe me mf mg mh b">%pdb</code>进入Python调试器；学习如何使用它对于调试Python代码是非常宝贵的。Ploomber的文档包含了一个在数据科学项目中使用调试器的例子。如果您想在调试模式下学习每个可用的命令，请查阅<a class="ae mi" href="https://docs.python.org/3/library/pdb.html#debugger-commands" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="03a7" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">希望通过使用调试器，您能够找到并修复错误。</p><h2 id="0046" class="oa mn iq bd mo ob oc dn ms od oe dp mw mj of og my mk oh oi na ml oj ok nc iw bi translated">如果输出不匹配</h2><p id="a70c" class="pw-post-body-paragraph lh li iq lk b ll ne ka ln lo nf kd lq mj ng lt lu mk nh lx ly ml ni mb mc md ij bi translated">这个场景比前一个场景更具挑战性，因为我们的代码没有失败，所以我们不知道在哪里调试。然而，您可能对代码中失败的地方有所了解；在每个地方，您都可以启动调试会话。</p><p id="a314" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">假设故障单元如下所示:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="2d4e" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">在仔细检查之后，您确定<code class="fe me mf mg mh b">process_data_frame</code>调用了<code class="fe me mf mg mh b">some_function</code>，并且错误可能就在那里。所以你去<code class="fe me mf mg mh b">some_function</code>源代码并编辑它:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="cbae" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">现在，当调用<code class="fe me mf mg mh b">process_data_frame(df)</code>时，依次调用<code class="fe me mf mg mh b">some_function(df)</code>，调试会话将开始。</p><p id="0f86" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">调试不是一件容易的事情，但是使用调试器比在你的代码中使用<code class="fe me mf mg mh b">print</code>语句要好得多。查看Ploomber文档中的调试示例<a class="ae mi" href="https://ploomber.readthedocs.io/en/latest/user-guide/debugging.html" rel="noopener ugc nofollow" target="_blank">来学习一些调试技巧。</a></p><h1 id="7359" class="mm mn iq bd mo mp mq mr ms mt mu mv mw kf mx kg my ki mz kj na kl nb km nc nd bi translated">第四步:将<code class="fe me mf mg mh b">.ipynb</code>转换为<code class="fe me mf mg mh b">.py</code></h1><p id="b1e3" class="pw-post-body-paragraph lh li iq lk b ll ne ka ln lo nf kd lq mj ng lt lu mk nh lx ly ml ni mb mc md ij bi translated">此时，您应该能够从头到尾无误地执行您的管道。这个步骤和接下来的步骤确保您的管道保持可维护性和稳定性。</p><p id="3590" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">对每个<code class="fe me mf mg mh b">git push</code>进行小的提交和测试对于确保您知道何时您的管道中断是至关重要的。此外，在修改了十行代码的提交中发现问题要比在二十次提交和数百行源代码更改之后容易得多。不幸的是，<code class="fe me mf mg mh b">.ipynb</code>很难管理，因为它们是包含代码和输出的JSON文件。例如，如果您有一个<code class="fe me mf mg mh b">pipeline.ipynb</code>文件，编辑单个单元格，并提交新版本，您将看到如下内容:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ol"><img src="../Images/6eac8f41cf325d88b2fcf6e90ca4092e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*szQapA5DOxhKvWkEp0r7Vg.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片作者。</p></figure><p id="f622" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">杂乱无章，很难说是什么发生了变化。为了解决笔记本不同的问题，我们将使用<code class="fe me mf mg mh b">jupytext</code>把我们的<code class="fe me mf mg mh b">.ipynb</code>文件转换成<code class="fe me mf mg mh b">.py</code>:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="f487" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">但是不要担心！多亏了jupytext的Jupyter插件，你仍然可以将它们作为笔记本打开。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi om"><img src="../Images/a36ecc9a839bdf8d8eee8d75106e3ac7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9W5o8fcl2SZtF_9Zf67anA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片作者。</p></figure><p id="f473" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated"><em class="lj">注意:</em> Jupytext有许多输出格式，查看<a class="ae mi" href="https://github.com/mwouts/jupytext" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多信息。</p><p id="ec75" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">一旦您将<code class="fe me mf mg mh b">pipeline.ipynb</code>转换为<code class="fe me mf mg mh b">.py</code>，请更新您的<code class="fe me mf mg mh b">pipeline.yaml</code>文件:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="7c3c" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">确保一切仍然正常工作:</p><pre class="kp kq kr ks gt on mh oo op aw oq bi"><span id="205a" class="oa mn iq mh b gy or os l ot ou">ploomber build</span></pre><p id="29b6" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">如果管道运行，删除<code class="fe me mf mg mh b">pipeline.ipynb</code>。</p><h1 id="fdb8" class="mm mn iq bd mo mp mq mr ms mt mu mv mw kf mx kg my ki mz kj na kl nb km nc nd bi translated">下一个</h1><p id="8b12" class="pw-post-body-paragraph lh li iq lk b ll ne ka ln lo nf kd lq mj ng lt lu mk nh lx ly ml ni mb mc md ij bi translated">到目前为止，我们能够在一个全新的环境中执行我们的管道:我们安装依赖项，然后执行<code class="fe me mf mg mh b">ploomber build</code>，但是我们的管道仍然是一个整体:我们所有的代码都在一个文件中。在本系列的下一部分中，我们将解决这个问题，并开始将我们的逻辑分成更小的步骤。</p><p id="70ff" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">为了确保你知道第二部何时上映，<a class="ae mi" href="https://twitter.com/intent/user?screen_name=ploomber" rel="noopener ugc nofollow" target="_blank">在Twitter上关注我们</a>或<a class="ae mi" href="https://www.getrevue.co/profile/ploomber" rel="noopener ugc nofollow" target="_blank">订阅我们的时事通讯</a>。回头见！</p><blockquote class="le lf lg"><p id="6da5" class="lh li lj lk b ll lm ka ln lo lp kd lq lr ls lt lu lv lw lx ly lz ma mb mc md ij bi translated">更新:第二部<a class="ae mi" href="https://ploomber.io/blog/refactor-nb-ii/" rel="noopener ugc nofollow" target="_blank">此处可用。</a></p></blockquote><p id="99d1" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated">发现错误？<a class="ae mi" href="https://github.com/ploomber/posts/issues/new?title=Issue%20in%20post%3A%20%22Refactoring%20a%20Jupyter%20notebook%20into%20a%20maintainable%20pipeline%3A%20A%20step-by-step%20guide%20%28Part%20I%29%22" rel="noopener ugc nofollow" target="_blank">点击这里让我们知道</a>。</p></div><div class="ab cl ov ow hu ox" role="separator"><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa"/></div><div class="ij ik il im in"><p id="f97c" class="pw-post-body-paragraph lh li iq lk b ll lm ka ln lo lp kd lq mj ls lt lu mk lw lx ly ml ma mb mc md ij bi translated"><em class="lj">原载于</em><a class="ae mi" href="https://ploomber.io/posts/refactor-nb-i" rel="noopener ugc nofollow" target="_blank"><em class="lj">ploomber . io</em></a><em class="lj">。</em></p></div></div>    
</body>
</html>