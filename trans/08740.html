<html>
<head>
<title>Masking Geo-Spatial Level 3 Satellite Images Using Shapefiles: A Grid-Based Approach</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨Shapefilesæ©è”½åœ°ç†ç©ºé—´3çº§å«æ˜Ÿå›¾åƒ:åŸºäºç½‘æ ¼çš„æ–¹æ³•</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://towardsdatascience.com/masking-geo-spatial-level-3-satellite-images-using-shapefiles-a-grid-based-approach-c88d7a108f4a?source=collection_archive---------19-----------------------#2021-08-12">https://towardsdatascience.com/masking-geo-spatial-level-3-satellite-images-using-shapefiles-a-grid-based-approach-c88d7a108f4a?source=collection_archive---------19-----------------------#2021-08-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="072f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">å¦‚ä½•ä½¿ç”¨ç›¸åº”åŒºåŸŸçš„shapefileå¤„ç†å’Œå±è”½ç‰¹å®šåŒºåŸŸæ‰€éœ€çš„å¤§æ°”ä¸‰çº§æ•°æ®</h2></div></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/52358e3564a0006e9850a983b6a20dca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Mj251aybXu2VURTk"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">ç¾å›½å®‡èˆªå±€åœ¨<a class="ae lc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>æ‹æ‘„çš„ç…§ç‰‡</p></figure><h1 id="46ae" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">ä»‹ç»</h1><p id="22da" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">è®©æˆ‘ä»¬å…ˆä»<strong class="lx ir">é¥æ„Ÿçš„æ¦‚å¿µè¯´èµ·ã€‚</strong>è¿™æ˜¯ä¸€é¡¹é€šè¿‡ä¼ æ„Ÿå™¨(å¦‚å«æ˜Ÿ)æ”¶é›†æ•°æ®çš„è‡ªç„¶ç ”ç©¶ã€‚è¿™äº›ä¼ æ„Ÿå™¨å¯ä»¥ç›‘æµ‹å’Œæ”¶é›†åœ°çƒä¸åŒæ–¹é¢çš„æ•°æ®ã€‚å…¶ä¸­ä¸€äº›åŒ…æ‹¬æ¤è¢«æ•°æ®ã€å¤§æ°”æ•°æ®ã€æµ·æ´‹æ•°æ®ç­‰ã€‚ä»–ä»¬ä»¥çƒ­å›¾æˆ–å›¾åƒçš„å½¢å¼æä¾›æ•°æ®ã€‚å›¾åƒå¤„ç†å’Œå±è”½æ˜¯ä»ä¼ æ„Ÿå™¨æ”¶é›†çš„æ•°æ®ä¸­æå–ä¿¡æ¯æ‰€éœ€çš„åŸºæœ¬å·¥å…·ã€‚æœ¬æ–‡é‡ç‚¹ä»‹ç»å¦‚ä½•ä½¿ç”¨ç›¸åº”åŒºåŸŸçš„shapefileå¤„ç†å’Œå±è”½ç‰¹å®šåŒºåŸŸæ‰€éœ€çš„<strong class="lx ir">å¤§æ°”NO2 </strong>æ•°æ®ã€‚è¿™é‡Œä½¿ç”¨çš„æ•°æ®æ˜¯ç”±è‡­æ°§ç›‘æµ‹ä»ªå™¨(OMI)æ”¶é›†çš„ã€‚æ•°æ®æ˜¯ä»Earthdataç½‘ç«™ä¸‹è½½çš„ï¼Œä½ å¯ä»¥ä»ä¸‹é¢çš„é“¾æ¥ä¸‹è½½æ•°æ®ã€‚</p><p id="5787" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated"><a class="ae lc" href="https://search.earthdata.nasa.gov/search/granules?p=C1266136111-GES_DISC&amp;pg[0][v]=f&amp;pg[0][gsk]=-start_date&amp;q=omi%20no2&amp;tl=1628603996.133!3" rel="noopener ugc nofollow" target="_blank">https://search.earthdata.nasa.gov/search/granules?p = c 1266136111-GES _ DISC&amp;pg[0][v]= f&amp;pg[0][GSK]=-start _ date&amp;q = OMI % 20no 2&amp;TL = 1628603996.133ï¼3 </a>ï¼ï¼</p><h1 id="ccb0" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">æ•°æ®æè¿°</h1><p id="e55f" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">è¿™é‡Œä½¿ç”¨çš„æ•°æ®æ˜¯OMIå«æ˜Ÿè®°å½•çš„3çº§äºŒç»´ç½‘æ ¼å«æ˜Ÿæ•°æ®ã€‚æ•°æ®çš„åˆ†è¾¨ç‡ä¸º(0.25 x 0.25)åº¦ç½‘æ ¼ã€‚æ•°æ®ç”±å¯¹æµå±‚æŸ±çŠ¶<strong class="lx ir">äºŒæ°§åŒ–æ°®</strong>æ°”ä½“ç»„æˆã€‚æ•°æ®é›†çš„è¯¦ç»†ç»“æ„å¯ä»¥æå–å¦‚ä¸‹:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mw"><img src="../Images/d0ebfd4ed28e0c34bb9c3c27abcea899.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ga64bkrCrpHyo3rR0aBtA.png"/></div></div></figure><p id="8a18" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated"><em class="mx">*åœ¨æ–‡ä»¶åä¸­ä½¿ç”¨æ‚¨è‡ªå·±çš„æ–‡ä»¶è·¯å¾„* </em></p><p id="bfd3" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">ä¸»æ•°æ®å­—æ®µä½äºæ•°æ®é›†çš„æ•°æ®å­—æ®µå­æ ‘ä¸‹ã€‚æœ‰å››ä¸ªæ•°æ®å˜é‡ï¼Œå¦‚ä¸‹æ‰€è¿°:</p><blockquote class="my mz na"><p id="337c" class="lv lw mx lx b ly mr jr ma mb ms ju md nb mt mg mh nc mu mk ml nd mv mo mp mq ij bi translated"><strong class="lx ir"> ColumnAmountNo2: </strong>æ€»çš„No2æŸ±å¯†åº¦ã€‚</p><p id="dd06" class="lv lw mx lx b ly mr jr ma mb ms ju md nb mt mg mh nc mu mk ml nd mv mo mp mq ij bi translated"><strong class="lx ir">columnaumntno 2 cloudscreened:</strong>æ»¤é™¤äº‘å™ªå£°åçš„æ€»NO2æŸ±å¯†åº¦ã€‚</p><p id="1ab6" class="lv lw mx lx b ly mr jr ma mb ms ju md nb mt mg mh nc mu mk ml nd mv mo mp mq ij bi translated"><strong class="lx ir">columnaumntno 2 drop:</strong>å¯¹æµå±‚åŒºåŸŸNO2çš„æŸ±å¯†åº¦ã€‚</p><p id="e8b7" class="lv lw mx lx b ly mr jr ma mb ms ju md nb mt mg mh nc mu mk ml nd mv mo mp mq ij bi translated"><strong class="lx ir">columnaumntno 2 ropcloudscreened:</strong>æ— äº‘å™ªå£°çš„å¯¹æµå±‚åŒºåŸŸNO2çš„æŸ±å¯†åº¦ã€‚</p></blockquote><p id="f0de" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ•°æ®å˜é‡<strong class="lx ir">columnamountno 2 ropcloudscreened</strong>ã€‚</p><h1 id="464f" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">å·¥å…·å’ŒæŠ€æœ¯</h1><p id="c1d2" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">Python 3.7è¢«ç”¨ä½œæå–å’Œå¤„ç†æ•°æ®é›†çš„ä¸»è¦è¯­è¨€ã€‚è¿™ä¸ªç‰ˆæœ¬å¾ˆé‡è¦ï¼Œå› ä¸ºå¦ä¸€ä¸ªåä¸º<em class="mx"> geopandas </em>çš„åŒ…ä¸èƒ½åœ¨pythonçš„æ›´é«˜ç‰ˆæœ¬ä¸Šå·¥ä½œã€‚Jupyterç¬”è®°æœ¬ç”¨äºæ‰§è¡Œè„šæœ¬ã€‚æ•°æ®é›†é‡‡ç”¨. he5æ–‡ä»¶æ ¼å¼ã€‚ä¸ºäº†ä»æ•°æ®æ–‡ä»¶ä¸­è¯»å–å’Œæå–æ•°æ®ï¼Œéœ€è¦ä¸€ä¸ªåä¸º<em class="mx"> h5py </em>çš„ä¸“é—¨åŒ…ã€‚æ‰€æœ‰è¿™äº›éƒ½å¯ä»¥åœ¨condaç¯å¢ƒä¸­è·å¾—ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Anacondaé€šè¿‡ç»™å®šçš„é“¾æ¥è¿›è¡Œå®‰è£…ã€‚</p><div class="ne nf gp gr ng nh"><a href="https://www.anaconda.com/products/individual" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd ir gy z fp nm fr fs nn fu fw ip bi translated">Anaconda |ä¸ªäººç‰ˆ</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">Anacondaçš„å¼€æºä¸ªäººç‰ˆæ˜¯åœ¨ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸Šæ‰§è¡ŒPython/Ræ•°æ®ç§‘å­¦å’Œæœºå™¨å­¦ä¹ çš„æœ€ç®€å•çš„æ–¹æ³•</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">www.anaconda.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv kw nh"/></div></div></a></div><p id="4bc7" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">æ‰§è¡Œä»£ç æ‰€éœ€çš„åŒ…æœ‰:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mw"><img src="../Images/7dce83a21d28e1786322cf93018dc7b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lt3gyLLtIVQUovi2ymcgtg.png"/></div></div></figure><h1 id="5ebf" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">å¯¼å…¥æ•°æ®</h1><p id="6344" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">ä¸ºäº†å¯¼å…¥æ•°æ®ï¼Œéœ€è¦åä¸º<em class="mx"> os </em>çš„åŒ…ï¼Œè¿™æ˜¯pythonä¸­çš„ä¸€ä¸ªå†…ç½®åŒ…ã€‚å®ƒéå†ç»™å®šçš„è·¯å¾„ï¼Œå¹¶å°†æ–‡ä»¶å¤¹ä¸­åŒ…å«çš„æ‰€æœ‰æ–‡ä»¶åè¯»å…¥pythonä¸­çš„ä¸€ä¸ªåˆ—è¡¨ã€‚ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„è·¯å¾„æˆåŠŸæ£€ç´¢æ•°æ®é›†åç§°åï¼Œéœ€è¦ä½¿ç”¨<em class="mx"> h5py </em>åŒ…æå–æ•°æ®ã€‚</p><p id="a616" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">åœ¨æå–æ•°æ®æ—¶ï¼Œæ•°æ®éœ€è¦è¢«æ¸…ç†ï¼Œå³æ‰€æœ‰å°äºé›¶çš„åƒç´ å€¼éœ€è¦è¢«è¿‡æ»¤å¹¶ç”¨NaNå€¼æ›¿æ¢ã€‚æ•°æ®æå–å’Œæ¸…ç†ä¸€æ¬¡å®Œæˆï¼ŒèŠ‚çœäº†ä¸€äº›è®¡ç®—å¼€é”€ï¼Œä¹Ÿå‡å°‘äº†ä»£ç çš„å¤§å°ã€‚æ¸…é™¤æ•°æ®åï¼Œæ²¿è½´=0å–æ‰€æœ‰æ•°æ®çš„å¹³å‡å€¼ï¼Œå¾—åˆ°å¹³å‡æ•°æ®ã€‚</p><p id="42af" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">#æ³¨:<em class="mx">æ ¹æ®éœ€è¦å–å¹³å‡å€¼ã€‚å¦‚æœæ¯å¤©éƒ½è¦è¿›è¡Œä¸€äº›åˆ†æï¼Œå¯ä»¥è·³è¿‡å‡å€¼æ­¥éª¤ï¼Œå•ç‹¬è¿è¡Œæ¯ä¸ªæ•°æ®çš„å±è”½ã€‚</em></p><p id="3cb3" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">æ•´ä¸ªè¿‡ç¨‹éœ€è¦åˆ†ä¸¤æ­¥å®Œæˆ:</p><ul class=""><li id="8eea" class="nw nx iq lx b ly mr mb ms me ny mi nz mm oa mq ob oc od oe bi translated">æ”¶é›†æ‰€æœ‰æ•°æ®æ–‡ä»¶åã€‚</li><li id="f0a4" class="nw nx iq lx b ly of mb og me oh mi oi mm oj mq ob oc od oe bi translated">ä½¿ç”¨h5pyæå–æ•°æ®ã€‚</li></ul><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mw"><img src="../Images/cb93010a87b346ff1c14af0732cc539a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nrlN2pZFAtyvj8wj3BWL_g.png"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">æ­£åœ¨æ”¶é›†ç›¸å…³è·¯å¾„ä¸­çš„æ‰€æœ‰æ–‡ä»¶</p></figure><pre class="kn ko kp kq gt ok ol om on aw oo bi"><span id="14f8" class="op le iq ol b gy oq or l os ot">def extractData(filenames):<br/>    data = []<br/>    for fname in filenames:<br/>        fHandle = hdf.File(fname,'r')<br/>        #Data extraction<br/>        #Use any one of the data variable from data description<br/>        dataNo2 = fHandle['HDFEOS/GRIDS/ColumnAmountNO2/Data Fields/ColumnAmountNO2TropCloudScreened'][:]<br/>        dataNo2[dataNo2 &lt; 0] = np.nan #cleaning <br/>        data.append(dataNo2)<br/>    dataArray = np.array(data)<br/>    mean = np.nanmean(dataArray, axis=0)<br/>    return mean</span></pre><p id="6a72" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">è¿™é‡Œï¼Œ<strong class="lx ir"> <em class="mx"> fHandle </em> </strong>å†…çš„è·¯å¾„æ˜¯å–è‡ªæ•°æ®æè¿°çš„è·¯å¾„ã€‚</p><h1 id="d09e" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">è¯»å–å½¢çŠ¶æ–‡ä»¶</h1><p id="02f9" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">å‡ºäºæµ‹è¯•ç›®çš„ï¼Œä½¿ç”¨äº†å°åº¦å›½å®¶è¾¹ç•Œshapefileã€‚è¯»å–å’Œå¤„ç†å½¢çŠ¶æ–‡ä»¶<em class="mx">éœ€è¦geopandas </em>ã€‚Geopandasæ˜¯pythonä¸­çš„ä¸€ä¸ªåŒ…ï¼Œå¹¿æ³›ç”¨äºåœ°ç†æ•°æ®å¤„ç†ã€‚å‡ºäºå¯è§†åŒ–çš„ç›®çš„ï¼Œä½¿ç”¨matplotlibã€‚</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ou"><img src="../Images/12a4d9737b552263a917d3aeec2efcf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3anh3eXWdXDrQq1Q0OWb2Q.png"/></div></div></figure><h1 id="b008" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">åˆ›å»ºçº¬åº¦å’Œç»åº¦åˆ—è¡¨</h1><p id="6a11" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">ä¸ºäº†å°†å›¾åƒæ•°æ®è½¬æ¢æˆç½‘æ ¼åœ°ç†æ•°æ®é›†ï¼Œæ¯ä¸ªæ•°æ®ç‚¹çš„ç¡®åˆ‡ä½ç½®å¿…é¡»ä¸å…¨çƒåæ ‡ç³»ç»Ÿä¸Šçš„ç›¸åº”ä½ç½®(çº¬åº¦å’Œç»åº¦)ç›¸å…³è”ã€‚ä¸ºäº†å…³è”æ•°æ®ï¼Œä½¿ç”¨æ•°æ®çš„åˆ†è¾¨ç‡ç”Ÿæˆçº¬åº¦å’Œç»åº¦å‘é‡ã€‚ç”±äºNO2æ•°æ®æ˜¯ä¸–ç•Œæ•°æ®ï¼Œçº¬åº¦çš„ç•Œé™è¢«è®¾ç½®ä¸º<strong class="lx ir"> [-90ï¼Œ90] </strong>ï¼Œç»åº¦çš„ç•Œé™è¢«è®¾ç½®ä¸º<strong class="lx ir"> [-180ï¼Œ180ã€‘ã€‚</strong>ç”±äºæ•°æ®çš„åˆ†è¾¨ç‡ä¸º0.25åº¦ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé—´éš”ä¸º0.25çš„ç­‰é—´è·æ•°ç»„ï¼Œå¹¶ä¿æŒçº¬åº¦å’Œç»åº¦çš„ç•Œé™ã€‚</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mw"><img src="../Images/2b01511246763fa4c590119efea38d7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fpqEeHJDldJSlkLMmVFiwg.png"/></div></div></figure><h1 id="0962" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">ä»shapefileè·å–è¾¹ç•Œ</h1><p id="7f26" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">ä¸ºäº†å°†å…¨å±€æ•°æ®è£å‰ªä¸ºshapefileçš„åæ ‡ï¼Œéœ€è¦ä»æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„å„ä¸ªshapefileä¸­æå–çº¬åº¦å’Œç»åº¦è¾¹ç•Œã€‚è¿™å°†è¿›ä¸€æ­¥ç”¨äºåœ¨å±è”½åé‡æ–°ç ”ç£¨æ•°æ®ï¼Œå¹¶å°†æ•°æ®è£å‰ªåˆ°æ‰€éœ€çš„åæ ‡ã€‚è¿™å¯ä»¥é€šè¿‡ç”¨shapefileçš„è¾¹ç•Œç”Ÿæˆå¦ä¸€ç»„çº¬åº¦å’Œç»åº¦åˆ—è¡¨æ¥å®Œæˆã€‚</p><p id="9857" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">ä¸€ä¸ªshapefileå¯èƒ½ç”±å¤šä¸ªå¤šè¾¹å½¢ç»„æˆï¼Œå®ƒéœ€è¦ä»æ‰€æœ‰å¤šè¾¹å½¢ä¸­è·å–çº¬åº¦å’Œç»åº¦åæ ‡ã€‚å–å…¶ä¸­çš„æœ€å¤§å€¼å’Œæœ€å°å€¼å°†æä¾›æ€»shapefileçš„è¾¹ç•Œï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre class="kn ko kp kq gt ok ol om on aw oo bi"><span id="b40f" class="op le iq ol b gy oq or l os ot">def getBounds(shape):<br/>    x1 = []<br/>    y1 = []<br/>    for i in range(len(shape)):<br/>        if(isinstance(shape.iloc[i].geometry, shapely.geometry.polygon.Polygon)):  <br/>            x = shape.exterior.iloc[i].coords.xy[0]<br/>            y = shape.exterior.iloc[i].coords.xy[1]<br/>            x1.append(min(x))<br/>            x1.append(max(x))<br/>            y1.append(min(y))<br/>            y1.append(max(y))<br/>        else:<br/>            for poly in shape.iloc[i].geometry:<br/>                x = poly.exterior.coords.xy[0]<br/>                y = poly.exterior.coords.xy[1]<br/>                x1.append(min(x))<br/>                x1.append(max(x))<br/>                y1.append(min(y))<br/>                y1.append(max(y))</span><span id="91ab" class="op le iq ol b gy ov or l os ot">return x1,y1</span><span id="2dd8" class="op le iq ol b gy ov or l os ot">def getBoundary(shape,res):<br/>    x,y = getBounds(shape)<br/>    my_lats = np.arange(np.min(y)-res/2, np.max(y)+res/2, res)<br/>    my_lons = np.arange(np.min(x)-res/2, np.max(x)+res/2, res)<br/>    return(my_lats,my_lons)</span></pre><h1 id="a0d2" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">åˆ›å»ºå’Œè£å‰ªåœ°ç†æ•°æ®æ¡†</h1><p id="615e" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´ä½¿ç”¨æ–‡ä»¶ä¸­çš„åŸå§‹æ•°æ®ã€‚ä½†æ˜¯ä¸ºäº†ä»¥åå±è”½æ•°æ®ï¼Œéœ€è¦å°†è¿™äº›æ•°æ®è½¬æ¢æˆç”±åœ°ç†ç‚¹ç»„æˆçš„åœ°ç†æ•°æ®æ¡†æ¶ã€‚è¿™å¯ä»¥ä½¿ç”¨<em class="mx"> geopandas </em>åº“è½»æ¾å®Œæˆã€‚</p><p id="4550" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">åˆ›å»ºæ•°æ®æ¡†æ—¶ï¼Œå¯ä½¿ç”¨shapefilesçš„çº¬åº¦å’Œç»åº¦è¾¹ç•Œè£å‰ªæ•°æ®ã€‚å‰ªè¾‘çš„æ¦‚å¿µå¯ä»¥ç”¨å¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ‘„åƒæœºçš„æ¦‚å¿µæ¥è§£é‡Šã€‚</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ow"><img src="../Images/950850f5318d818b6a8327cfdf74f899.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PU8DSWfNvQs0qrHCvT06NQ.jpeg"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">ä¸–ç•Œå’Œè§†å£æ¡†å›¾</p></figure><p id="7ac9" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œä¸–ç•Œæ˜¯ç»åº¦ä»-180åˆ°+180ï¼Œçº¬åº¦ä»-90åˆ°+90çš„å®é™…æ•°æ®ã€‚è§†åŒºçš„åæ ‡ç”±shapefileçš„è¾¹ç•Œå†³å®šã€‚</p><pre class="kn ko kp kq gt ok ol om on aw oo bi"><span id="774a" class="op le iq ol b gy oq or l os ot">def createGeoData(lt,ln,mean_No,shape):<br/>    lat = []<br/>    lon = []<br/>    data = []<br/>    for i in range(len(lt)):<br/>        for j in range(len(ln)):<br/>            lat.append(lt[i])<br/>            lon.append(ln[j])<br/>            data.append(mean_No[i][j])<br/>            <br/>    Geo_Dataset = pd.DataFrame({'latitude':lat, 'longitude': lon, 'NO2':data})<br/>    #clip data with shape file boundaries<br/>    x1, y1 = getBoundary(shape,0.25)<br/>    temp = Geo_Dataset[Geo_Dataset['latitude']&gt;int(min(x1))]<br/>    temp = temp[temp['latitude']&lt;int(max(x1))]<br/>    temp = temp[temp['longitude']&gt;int(min(y1))]<br/>    temp = temp[temp['longitude']&lt;int(max(y1))]<br/>    crc = {'init':'epsg:4326'}<br/>    geometry = [Point(xy) for xy in zip(temp['longitude'], temp['latitude'])]<br/>    geo_df = gpd.GeoDataFrame(temp,crs=crc,geometry=geometry)<br/>    geo_df.reset_index(drop=True, inplace=True)<br/>    return geo_df</span></pre><h1 id="cd51" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">å±è”½æ•°æ®</h1><p id="d1bf" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">ç”±äºæ•°æ®è¢«è½¬æ¢ä¸ºç”±å‡ ä½•(ç‚¹)ç»„æˆçš„åœ°ç†æ•°æ®æ¡†ï¼Œå› æ­¤è¿™äº›ç‚¹å¯ç›´æ¥ç”¨äºæ£€æŸ¥æ•°æ®æ˜¯å¦åŒ…å«åœ¨shapefileçš„ä»»ä½•é¢ä¸­ã€‚è¿™é‡Œä½¿ç”¨äº†æ£€æŸ¥å¤šè¾¹å½¢å†…éƒ¨ç‚¹çš„æ¦‚å¿µã€‚è¿™æ˜¯é€šè¿‡ä½¿ç”¨shapelyåº“ä¸­çš„ç‚¹å’Œé¢åŒ…æ¥æ‰§è¡Œçš„ã€‚shapefileçš„ä»»ä½•ä¸€ä¸ªå¤šè¾¹å½¢å†…çš„ç‚¹ä¿æŒä¸å˜ï¼Œå…¶ä½™çš„ç‚¹è¢«èµ‹äºˆä¸€ä¸ªNaNå€¼ã€‚</p><pre class="kn ko kp kq gt ok ol om on aw oo bi"><span id="05c9" class="op le iq ol b gy oq or l os ot">def mask(map1, geo_df):<br/>    pol = map1.geometry<br/>    pts = geo_df.geometry<br/>    test = geo_df<br/>    l,t,df = [],[],[]<br/>    for k in range(len(pts)):<br/>        flag = True<br/>        for i in range(len(pol)):<br/>            if(pol[i].contains(pts[k])):<br/>                l.append(geo_df.latitude[k])<br/>                t.append(geo_df.longitude[k])<br/>                df.append(geo_df.NO2[k])<br/>                flag = False<br/>                break<br/>            #end if<br/>        #end for<br/>        if(flag):<br/>            l.append(np.nan)<br/>            t.append(np.nan)<br/>            df.append(np.nan)<br/>        #end if<br/>    #end for<br/>    newdf = pd.DataFrame({'latitude':l, 'longitude': t, 'NO2':df})<br/>    return newdf</span></pre><h1 id="13a8" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">é‡æ–°åˆ’åˆ†æ•°æ®</h1><p id="e677" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">å°†æ•°æ®è½¬æ¢ä¸ºåœ°ç†æ•°æ®æ¡†æ—¶ï¼Œæ•°æ®è¢«å±•å¹³ä»¥ä¾¿äºè£å‰ªã€‚å› æ­¤ï¼Œåœ¨å±è”½æ•°æ®ä¹‹åï¼Œæ•°æ®éœ€è¦é‡æ–°ç½‘æ ¼åŒ–ä»¥ä¾¿å¯è§†åŒ–ã€‚</p><p id="21c3" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">ç”±äºæ•°æ®å·²ç»è¢«è£å‰ªï¼Œæ•°æ®çš„å½¢çŠ¶åº”è¯¥ç­‰äºè¾¹ç•Œçº¬åº¦æ•°ç»„çš„é•¿åº¦ä¹˜ä»¥ä»shapefileè·å¾—çš„è¾¹ç•Œç»åº¦æ•°ç»„çš„é•¿åº¦ã€‚</p><p id="f5f0" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated"># <em class="mx">æ³¨æ„:å¦‚æœæ•°æ®çš„å½¢çŠ¶ä¸ç»™å®šçš„æ¡ä»¶ä¸åŒ¹é…ï¼Œæ£€æŸ¥è¾¹ç•Œæ˜¯å¦è¢«æ­£ç¡®æ£€ç´¢ï¼Œå‰ªè£æ˜¯å¦æ­£ç¡®å®Œæˆã€‚</em></p><p id="a414" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ›å»ºç½‘æ ¼å¹¶ç”¨æ•°æ®å¡«å……</p><pre class="kn ko kp kq gt ok ol om on aw oo bi"><span id="735c" class="op le iq ol b gy oq or l os ot">def createGrid(my_lats, my_lons,mask):<br/>    grd = np.zeros((len(my_lats),len(my_lons)))<br/>    print(grd.shape, mask.NO2.shape)<br/>    k = 0<br/>    for i in range(len(my_lats)):<br/>        for j in range(len(my_lons)):<br/>            grd[i][j] = mask.NO2[k]<br/>            k = k+1<br/>        #end for<br/>    #end for<br/>    return grd</span></pre><h1 id="e285" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated"><strong class="ak">å¯è§†åŒ–</strong></h1><p id="29e0" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">ä¸ºäº†å¯è§†åŒ–æ•°æ®ï¼Œä½¿ç”¨äº†<em class="mx"> Matplotlib </em>ã€‚å…³äºå¯è§†åŒ–æ²¡æœ‰å¤ªå¤šè¦è§£é‡Šçš„ğŸ˜†ã€‚åªéœ€æ ¹æ®æ‚¨çš„éœ€è¦ä¿®æ”¹é¢œè‰²æ å‚æ•°ã€‚</p><pre class="kn ko kp kq gt ok ol om on aw oo bi"><span id="7033" class="op le iq ol b gy oq or l os ot">def plot(grd, map1, x1,y1):<br/>    plt.rcParams["font.weight"] = "bold"<br/>    fig,ax = plt.subplots(figsize=(15,15))<br/>    map1.plot(ax=ax, alpha=0.7, color='none')<br/>    ax.set_title("No2 Distribution", fontweight='bold', size=20)<br/>    ax.set_xlabel('Longitude (E)', fontsize = 20)<br/>    ax.set_ylabel('Latitude (N)', fontsize = 20)<br/>    bounds = [int(min(x1)),int(max(x1)),int(min(y1)),int(max(y1))]<br/>    img = ax.imshow(grd,aspect='auto',interpolation='none', origin='lower', extent=bounds)<br/>    cb = fig.colorbar(img)<br/>    cb.ax.tick_params(labelsize=18)<br/>    cb.set_label('mol cm^-2', labelpad=-57, size=14)<br/>    ax.tick_params(labelsize = 20, width = 2.0)<br/>    img.set_clim(0.1*1e16, 0.5*1e16)<br/>    plt.show()</span></pre><h1 id="0eb0" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">æ‰§è¡Œ</h1><p id="29fe" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ä¸Šè¿°è¿™äº›å‡½æ•°æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æœ‰ä¸€ä¸ªè°ƒç”¨ä¸Šè¿°å‡½æ•°çš„åºåˆ—ã€‚å®ƒåœ¨è¿™é‡Œ</p><pre class="kn ko kp kq gt ok ol om on aw oo bi"><span id="e55a" class="op le iq ol b gy oq or l os ot">filenames = []<br/>for path, subdirs, files in os.walk(r'path to your own data'):<br/>    for filename in files:<br/>        f = path +'/'+filename<br/>        filenames.append(str(f))</span><span id="e3f0" class="op le iq ol b gy ov or l os ot">mean_data = extractData(filenames)<br/>latitude = np.arange(-90,90,0.25)<br/>longitude = np.arange(-180,180,0.25)<br/>m = readSHape(shpFile)<br/>geo_df = createGeoData(latitude,longitude,mean_data,m)<br/>msk = mask(m, geo_df)<br/>my_lat,my_lon = getBoundary(m,0.25)<br/>data = createGrid(my_lat,my_lon,msk)<br/>plot(data,m, my_lon, my_lat)</span></pre><h1 id="7d9d" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">ç»“æœ</h1><p id="41ef" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ‰€æœ‰ç¼–ç çš„è¾“å‡ºğŸ˜ƒ</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ox"><img src="../Images/1c257f0f2b401af259afed24910bf942.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NaUDtkeVtMZQ0LzIOyb3xg.png"/></div></div></figure><h1 id="57f4" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">ç»“è®º</h1><p id="1975" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">å¦‚æ‚¨æ‰€è§ï¼Œå…¨å±€æ•°æ®è¢«éšè—åœ¨shapefileä¸­ã€‚è¿™äº›æ–¹æ³•é€‚ç”¨äºæ‰€æœ‰åœ°ç†åŒºåŸŸæˆ–è¾¹ç•Œshapefileã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„åœ°ç†ç©ºé—´åˆ†æå·¥å…·ã€‚</p></div></div>    
</body>
</html>