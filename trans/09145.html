<html>
<head>
<title>How to Iterate Over Rows in a Pandas DataFrame</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何迭代熊猫数据框架中的行</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-iterate-over-rows-in-a-pandas-dataframe-6aa173fc6c84?source=collection_archive---------3-----------------------#2021-08-24">https://towardsdatascience.com/how-to-iterate-over-rows-in-a-pandas-dataframe-6aa173fc6c84?source=collection_archive---------3-----------------------#2021-08-24</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="623a" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">讨论如何在pandas中迭代行，以及为什么最好避免(如果可能的话)</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/7d717235834920cfe3ecf7e4fdcf6ddf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-EUd4NGFQT6QVQBG0PwA8g.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">由<a class="ae kz" href="https://unsplash.com/@thevisualiza?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">迪尔</a>在<a class="ae kz" href="https://unsplash.com/s/photos/repetition?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><h2 id="fffe" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">介绍</h2><p id="2521" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">对pandas数据帧进行迭代绝对不是一个最佳实践，你应该只在绝对必要的时候，并且当你已经尝试了所有其他可能的更优雅和更有效的选择时，才考虑这样做。</p><blockquote class="mp"><p id="936f" class="mq mr iu bd ms mt mu mv mw mx my mo dk translated">遍历熊猫对象一般<strong class="ak">慢</strong>。在许多情况下，不需要手动迭代这些行，并且可以避免</p><p id="f686" class="mq mr iu bd ms mt mu mv mw mx my mo dk translated">— <a class="ae kz" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/basics.html#iteration" rel="noopener ugc nofollow" target="_blank">熊猫文档</a></p></blockquote><p id="cd87" class="pw-post-body-paragraph lw lx iu ly b lz mz jv mb mc na jy me lj nb mg mh ln nc mj mk lr nd mm mn mo in bi translated">在今天的文章中，我们将讨论如何避免在pandas中遍历数据帧。在选择迭代方法之前，我们还将浏览一份“清单”,您可能每次都需要参考它。此外，我们将探讨在没有其他选项适合您的特定用例的情况下如何做到这一点。最后，我们将讨论为什么在迭代熊猫对象时应该避免修改它们。</p></div><div class="ab cl ne nf hy ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="in io ip iq ir"><h2 id="85a6" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">真的需要遍历行吗？</h2><p id="1746" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">正如pandas官方文档中所强调的，通过数据帧的迭代是非常低效的，并且通常可以避免。通常，pandas新成员不熟悉矢量化的概念，也不知道pandas中的大多数操作应该(也可以)在非迭代环境中执行。</p><p id="015e" class="pw-post-body-paragraph lw lx iu ly b lz nl jv mb mc nm jy me lj nn mg mh ln no mj mk lr np mm mn mo in bi translated">在尝试遍历pandas对象之前，您必须首先确保以下选项都不符合您的用例需求:</p><ul class=""><li id="93c4" class="nq nr iu ly b lz nl mc nm lj ns ln nt lr nu mo nv nw nx ny bi translated"><strong class="ly iv">迭代矢量化</strong> : pandas提供了丰富的内置方法，其性能得到了优化。大多数操作都可以使用这些方法中的一种来执行。此外，您甚至可以查看一下<code class="fe nz oa ob oc b">numpy</code>并检查它的任何功能是否可以在您的上下文中使用。</li><li id="fc0a" class="nq nr iu ly b lz od mc oe lj of ln og lr oh mo nv nw nx ny bi translated"><strong class="ly iv">将函数应用于行:</strong>一个常见的需求是将函数应用于每一行，比如说，一次只能应用于一行，而不能应用于整个数据帧或序列。在这种情况下，最好使用<code class="fe nz oa ob oc b"><a class="ae kz" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" rel="noopener ugc nofollow" target="_blank">apply()</a></code>方法，而不是遍历pandas对象。要了解更多细节，你可以参考pandas文档的这一部分，它解释了如何将你自己的或另一个库的函数应用于pandas对象。</li><li id="6d5e" class="nq nr iu ly b lz od mc oe lj of ln og lr oh mo nv nw nx ny bi translated"><strong class="ly iv">迭代操作:</strong>如果您需要执行迭代操作，同时性能也是一个问题，那么您可能需要考虑cython或numba。关于这些概念的更多细节，你可以阅读熊猫文档的这一部分。</li><li id="8794" class="nq nr iu ly b lz od mc oe lj of ln og lr oh mo nv nw nx ny bi translated"><strong class="ly iv">打印一个数据帧:</strong>如果你想打印一个数据帧，那么只需使用<code class="fe nz oa ob oc b"><a class="ae kz" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_string.html" rel="noopener ugc nofollow" target="_blank">DataFrame.to_string()</a></code>方法，以便将数据帧呈现为一个控制台友好的表格输出。</li></ul></div><div class="ab cl ne nf hy ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="in io ip iq ir"><h2 id="e6bf" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">迭代数据帧的行</h2><p id="0415" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">如果以上选项都不适合您，那么您可能仍然希望遍历熊猫对象。您可以使用<code class="fe nz oa ob oc b">iterrows()</code>或<code class="fe nz oa ob oc b">itertuples()</code>内置方法来实现。</p><p id="4c43" class="pw-post-body-paragraph lw lx iu ly b lz nl jv mb mc nm jy me lj nn mg mh ln no mj mk lr np mm mn mo in bi translated">在查看这两种方法的运行之前，让我们创建一个示例数据帧，我们将使用它进行迭代。</p><pre class="kk kl km kn gu oi oc oj ok aw ol bi"><span id="6b3b" class="la lb iu oc b gz om on l oo op">import pandas as pd</span><span id="674a" class="la lb iu oc b gz oq on l oo op"><br/>df  = pd.DataFrame({<br/>    'colA': [1, 2, 3, 4, 5],<br/>    'colB': ['a', 'b', 'c', 'd', 'e'],<br/>    'colC': [True, True, False, True, False],<br/>})</span><span id="8698" class="la lb iu oc b gz oq on l oo op">print(df)<br/><em class="or">   colA colB   colC<br/>0     1    a   True<br/>1     2    b   True<br/>2     3    c  False<br/>3     4    d   True<br/>4     5    e  False</em></span></pre></div><div class="ab cl ne nf hy ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="in io ip iq ir"><ul class=""><li id="bb61" class="nq nr iu ly b lz nl mc nm lj ns ln nt lr nu mo nv nw nx ny bi translated"><code class="fe nz oa ob oc b"><a class="ae kz" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows" rel="noopener ugc nofollow" target="_blank"><strong class="ly iv">pandas.DataFrame.iterrows(</strong></a><strong class="ly iv">)</strong></code>方法用于将DataFrame行作为<code class="fe nz oa ob oc b">(index, Series)</code>对进行迭代。请注意，该方法不会跨行保存<code class="fe nz oa ob oc b">dtypes</code>，因为该方法会将每一行转换为<code class="fe nz oa ob oc b">Series</code>。如果您需要保留pandas对象的dtypes，那么您应该使用<code class="fe nz oa ob oc b">itertuples()</code>方法。</li></ul><pre class="kk kl km kn gu oi oc oj ok aw ol bi"><span id="9553" class="la lb iu oc b gz om on l oo op">for index, row in <strong class="oc iv">df.iterrows</strong>():<br/>    print(row['colA'], row['colB'], row['colC'])</span><span id="74ae" class="la lb iu oc b gz oq on l oo op"><em class="or">1 a True<br/>2 b True<br/>3 c False<br/>4 d True<br/>5 e False</em></span></pre><ul class=""><li id="5f48" class="nq nr iu ly b lz nl mc nm lj ns ln nt lr nu mo nv nw nx ny bi translated"><code class="fe nz oa ob oc b"><a class="ae kz" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.itertuples.html#pandas.DataFrame.itertuples" rel="noopener ugc nofollow" target="_blank"><strong class="ly iv">pandas.DataFrame.itertuples()</strong></a></code>方法用于以命名元组的形式迭代数据帧行。<strong class="ly iv">一般来说，</strong> <code class="fe nz oa ob oc b"><strong class="ly iv">itertuples()</strong></code> <strong class="ly iv">预计会比</strong> <code class="fe nz oa ob oc b"><strong class="ly iv">iterrows()</strong></code> <strong class="ly iv">快。</strong></li></ul><pre class="kk kl km kn gu oi oc oj ok aw ol bi"><span id="3f15" class="la lb iu oc b gz om on l oo op">for row in <strong class="oc iv">df.itertuples</strong>():<br/>    print(row.colA, row.colB, row.colC)</span><span id="42c4" class="la lb iu oc b gz oq on l oo op"><em class="or">1 a True<br/>2 b True<br/>3 c False<br/>4 d True<br/>5 e False</em></span></pre><p id="b0de" class="pw-post-body-paragraph lw lx iu ly b lz nl jv mb mc nm jy me lj nn mg mh ln no mj mk lr np mm mn mo in bi translated">关于Python 中<strong class="ly iv">命名元组的更多细节，你可以阅读下面的文章。</strong></p><div class="os ot gq gs ou ov"><a rel="noopener follow" target="_blank" href="/what-are-named-tuples-in-python-59dc7bd15680"><div class="ow ab fp"><div class="ox ab oy cl cj oz"><h2 class="bd iv gz z fq pa fs ft pb fv fx it bi translated">Python中的命名元组是什么</h2><div class="pc l"><h3 class="bd b gz z fq pa fs ft pb fv fx dk translated">Python中一个被忽略的扩展数据类型</h3></div><div class="pd l"><p class="bd b dl z fq pa fs ft pb fv fx dk translated">towardsdatascience.com</p></div></div><div class="pe l"><div class="pf l pg ph pi pe pj kt ov"/></div></div></a></div></div><div class="ab cl ne nf hy ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="in io ip iq ir"><h2 id="7cf6" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">迭代行时修改</h2><p id="e9f3" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">在这一点上，重要的是要强调<strong class="ly iv">你不应该修改你正在迭代的pandas数据帧或系列</strong>。根据pandas对象的数据类型，迭代器可能返回对象的副本，而不是视图。在这种情况下，向副本中写入任何内容都不会达到预期的效果。</p><p id="8559" class="pw-post-body-paragraph lw lx iu ly b lz nl jv mb mc nm jy me lj nn mg mh ln no mj mk lr np mm mn mo in bi translated">例如，假设我们想要将<code class="fe nz oa ob oc b">colA</code>中每一行的值加倍。<strong class="ly iv">迭代方法不会奏效</strong>:</p><pre class="kk kl km kn gu oi oc oj ok aw ol bi"><span id="0e77" class="la lb iu oc b gz om on l oo op">for index, row in df.iterrows():<br/>  row['colA'] = row['colA'] * 2</span><span id="345c" class="la lb iu oc b gz oq on l oo op">print(df)<br/><em class="or">   colA colB   colC<br/>0     1    a   True<br/>1     2    b   True<br/>2     3    c  False<br/>3     4    d   True<br/>4     5    e  False</em></span></pre><p id="1cc1" class="pw-post-body-paragraph lw lx iu ly b lz nl jv mb mc nm jy me lj nn mg mh ln no mj mk lr np mm mn mo in bi translated">在类似的用例中，你应该使用<code class="fe nz oa ob oc b">apply()</code>方法。</p><pre class="kk kl km kn gu oi oc oj ok aw ol bi"><span id="1264" class="la lb iu oc b gz om on l oo op">df['colA'] = df['colA'].apply(<!-- -->lambda x: x * 2<!-- -->)</span><span id="4e78" class="la lb iu oc b gz oq on l oo op">print(df)<br/><em class="or">   colA colB   colC<br/>0     2    a   True<br/>1     4    b   True<br/>2     6    c  False<br/>3     8    d   True<br/>4    10    e  False</em></span></pre></div><div class="ab cl ne nf hy ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="in io ip iq ir"><h2 id="5efc" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">最后的想法</h2><p id="e3a1" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">在今天的文章中，我们讨论了为什么在处理pandas对象时避免迭代方法是重要的，而更喜欢矢量化或任何其他适合您特定用例的方法。</p><p id="60fa" class="pw-post-body-paragraph lw lx iu ly b lz nl jv mb mc nm jy me lj nn mg mh ln no mj mk lr np mm mn mo in bi translated">pandas提供了一组丰富的内置方法，这些方法针对大型pandas对象进行了优化，您应该始终优先选择这些方法，而不是其他迭代解决方案。如果您仍然想要/必须迭代一个数据帧或系列，您可以使用<code class="fe nz oa ob oc b">iterrows()</code>或<code class="fe nz oa ob oc b">itertuples()</code>方法。</p><p id="7e5c" class="pw-post-body-paragraph lw lx iu ly b lz nl jv mb mc nm jy me lj nn mg mh ln no mj mk lr np mm mn mo in bi translated">最后，我们讨论了为什么必须避免修改正在迭代的pandas对象，因为这可能不会像预期的那样工作。</p></div><div class="ab cl ne nf hy ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="in io ip iq ir"><p id="6914" class="pw-post-body-paragraph lw lx iu ly b lz nl jv mb mc nm jy me lj nn mg mh ln no mj mk lr np mm mn mo in bi translated"><a class="ae kz" href="https://gmyrianthous.medium.com/membership" rel="noopener"> <strong class="ly iv">成为会员</strong> </a> <strong class="ly iv">阅读媒体上的每一个故事。你的会员费直接支持我和你看的其他作家。</strong></p></div><div class="ab cl ne nf hy ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="in io ip iq ir"><p id="676e" class="pw-post-body-paragraph lw lx iu ly b lz nl jv mb mc nm jy me lj nn mg mh ln no mj mk lr np mm mn mo in bi translated"><strong class="ly iv">你可能也会喜欢</strong></p><div class="os ot gq gs ou ov"><a rel="noopener follow" target="_blank" href="/how-to-efficiently-convert-a-pyspark-dataframe-to-pandas-8bda2c3875c3"><div class="ow ab fp"><div class="ox ab oy cl cj oz"><h2 class="bd iv gz z fq pa fs ft pb fv fx it bi translated">加快PySpark和Pandas数据帧之间的转换</h2><div class="pc l"><h3 class="bd b gz z fq pa fs ft pb fv fx dk translated">将大火花数据帧转换为熊猫时节省时间</h3></div><div class="pd l"><p class="bd b dl z fq pa fs ft pb fv fx dk translated">towardsdatascience.com</p></div></div><div class="pe l"><div class="pk l pg ph pi pe pj kt ov"/></div></div></a></div></div><div class="ab cl ne nf hy ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu ov"><a rel="noopener follow" target="_blank" href="/how-to-drop-rows-in-pandas-dataframes-with-nan-values-in-certain-columns-7613ad1a7f25"><div class="ow ab fp"><div class="ox ab oy cl cj oz"><h2 class="bd iv gz z fq pa fs ft pb fv fx it bi translated">如何删除Pandas数据帧中某些列中有NaN值的行</h2><div class="pc l"><h3 class="bd b gz z fq pa fs ft pb fv fx dk translated">讨论从pandas数据帧中删除某些列中值为空的行的多种方法</h3></div><div class="pd l"><p class="bd b dl z fq pa fs ft pb fv fx dk translated">towardsdatascience.com</p></div></div><div class="pe l"><div class="pl l pg ph pi pe pj kt ov"/></div></div></a></div></div><div class="ab cl ne nf hy ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu ov"><a rel="noopener follow" target="_blank" href="/what-is-machine-learning-e67043a3a30c"><div class="ow ab fp"><div class="ox ab oy cl cj oz"><h2 class="bd iv gz z fq pa fs ft pb fv fx it bi translated">什么是机器学习</h2><div class="pc l"><h3 class="bd b gz z fq pa fs ft pb fv fx dk translated">讨论机器学习的学习方法、类型和实际应用</h3></div><div class="pd l"><p class="bd b dl z fq pa fs ft pb fv fx dk translated">towardsdatascience.com</p></div></div><div class="pe l"><div class="pm l pg ph pi pe pj kt ov"/></div></div></a></div></div></div>    
</body>
</html>