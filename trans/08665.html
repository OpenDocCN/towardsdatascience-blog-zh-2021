<html>
<head>
<title>Email Attachment Ingestion</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">电子邮件附件摄取</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/email-attachment-ingestion-fc4994c42819?source=collection_archive---------17-----------------------#2021-08-10">https://towardsdatascience.com/email-attachment-ingestion-fc4994c42819?source=collection_archive---------17-----------------------#2021-08-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4ec6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">AWS中的电子邮件附件自动化工作流</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c1799645751d6d84a27249b94c782e50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LCXfJ-jEWPOizCTg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@campaign_creators?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">活动发起人</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="4aa4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我一直在和另一位媒体作家<a class="lv lw ep" href="https://medium.com/u/2efb976b82b3?source=post_page-----fc4994c42819--------------------------------" rel="noopener" target="_blank">本·奥尔尼</a>谈论电子邮件附件自动化。处理电子邮件附件并将数据存储在数据库中的操作。我想看看我是否能让它在亚马逊AWS上工作。</p><p id="b73c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在Medium上发现了一篇非常棒的文章，描述了如何将电子邮件附件放入亚马逊S3网站。这是一篇写得非常好的文章，非常清楚地描述了这个过程。我认为只有几个部分可以更详细地介绍，比如亚马逊IAM中的角色，可能还有更多关于安全性的内容。</p><div class="lx ly gp gr lz ma"><a rel="noopener follow" target="_blank" href="/extract-email-attachment-using-aws-624614a2429b"><div class="mb ab fo"><div class="mc ab md cl cj me"><h2 class="bd iu gy z fp mf fr fs mg fu fw is bi translated">使用AWS提取电子邮件附件</h2><div class="mh l"><h3 class="bd b gy z fp mf fr fs mg fu fw dk translated">创造了使用AWS执行ETL操作的可能性</h3></div><div class="mi l"><p class="bd b dl z fp mf fr fs mg fu fw dk translated">towardsdatascience.com</p></div></div><div class="mj l"><div class="mk l ml mm mn mj mo ks ma"/></div></div></a></div><p id="5341" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面这篇文章详细解释了推理和过程。由于显而易见的原因，我不打算再谈论它了。我将提供一个快速总结和一些改进，然后描述下一部分。</p><p id="f98a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在亚马逊S3<a class="ae ky" href="https://aws.amazon.com/s3" rel="noopener ugc nofollow" target="_blank">中存储原始附件</a>很棒，但这只是其中的一半。下一部分是如何在亚马逊RDS中处理和存储这些附件。这部分有点棘手，尤其是如果你想以一种安全的方式来做这件事。我设法让它工作，我将按照我认为最有意义的顺序告诉你每一步。我将在前进到下一部分之前，包括有用的验证，以确认每个“<strong class="lb iu">构建块</strong>”的工作。</p><p id="c903" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我典型的分阶段设计解决方案的方式。这是一个相当复杂的端到端工作流程，因此确保每个步骤都能够独立工作非常重要，否则您会在结束时发现它不起作用，然后故障排除会变得更加复杂。</p><h2 id="034a" class="mp mq it bd mr ms mt dn mu mv mw dp mx li my mz na lm nb nc nd lq ne nf ng nh bi translated">步骤1:亚马逊AWS IAM角色</h2><p id="3334" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我喜欢在开始时创建服务角色。你在哪个阶段这样做并不重要，但我个人喜欢在需要的时候准备好。</p><p id="f64a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">登录<a class="ae ky" href="https://console.aws.amazon.com/iam" rel="noopener ugc nofollow" target="_blank"> AWS IAM </a>，从菜单中选择“<a class="ae ky" href="https://console.aws.amazon.com/iamv2/home#/roles" rel="noopener ugc nofollow" target="_blank">角色</a>，然后选择“<strong class="lb iu">创建角色</strong>”。</p><p id="eeb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">附加以下内置策略:</p><ul class=""><li id="4c44" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated">CloudWatchFullAccess</li><li id="9f20" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">AmazonRDSFullAccess</li><li id="e3a7" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">AmazonRDSDataFullAccess</li><li id="49de" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">亚马逊3完全访问</li><li id="b872" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">AWSLambdaVPCAccessExecutionRole</li><li id="9db8" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">awslambdabasiceexecutionrole</li></ul><p id="0417" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个非常宽松的角色，允许Lambda访问CloudWatch、RDS、VPC和S3。它可以被多个项目使用。如果您在生产环境中部署这个解决方案，您将希望创建一个更具限制性的策略，只允许Lambda访问需要的内容。</p><p id="003c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击“<strong class="lb iu">下一步:标签</strong>，然后点击“<strong class="lb iu">下一步:回顾</strong>”。</p><p id="a1f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于“<strong class="lb iu">角色名</strong>”，调用它的<strong class="lb iu">RoleForLambdaToAWSServices</strong>，然后“<strong class="lb iu">创建角色</strong>”。</p><h2 id="903a" class="mp mq it bd mr ms mt dn mu mv mw dp mx li my mz na lm nb nc nd lq ne nf ng nh bi translated"><strong class="ak">步骤2:创建我们的S3存储桶</strong></h2><p id="5a79" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">正如我上面提到的，我们需要两个S3水桶。一个用于传入的原始电子邮件和附件，另一个用于将附件移动到Lambda获取的RDS中。</p><p id="f600" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以给这些桶起任何你喜欢的名字，但是我建议这样:</p><ul class=""><li id="370c" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated">my bucket-附件</li><li id="d98b" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">my bucket-已处理</li></ul><p id="c0f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“<strong class="lb iu"> mybucket </strong>”应该是对你的描述。S3存储桶需要是全球唯一的。</p><p id="8b89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请登录<a class="ae ky" href="https://console.aws.amazon.com/s3" rel="noopener ugc nofollow" target="_blank"> AWS S3 </a>并立即创建您的两个桶。</p><h2 id="a605" class="mp mq it bd mr ms mt dn mu mv mw dp mx li my mz na lm nb nc nd lq ne nf ng nh bi translated">第三步:创建我们的专用邮件服务器</h2><p id="c56c" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">为此，我们将使用<a class="ae ky" href="https://console.aws.amazon.com/workmail" rel="noopener ugc nofollow" target="_blank"> AWS工作邮件</a>。这样做有很好的成本效益原因，如果你想知道背后的原因，请参考<a class="ae ky" rel="noopener" target="_blank" href="/extract-email-attachment-using-aws-624614a2429b">原文</a>。</p><p id="8b54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击<strong class="lb iu">创建组织</strong>。</p><p id="bc84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<strong class="lb iu">组织设置</strong>下，您可以选择合适的选项。我选择了“<strong class="lb iu">免费测试域</strong>”(这个可以以后改)。对于“<strong class="lb iu">别名</strong>”，为您的组织/项目命名。例如“<strong class="lb iu"> myorg </strong>”，然后点击“<strong class="lb iu">创建组织</strong>”。</p><p id="e874" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建完成后，打开你的新组织邮件服务器，点击“<strong class="lb iu">用户</strong>”。您将看到一个默认的“<strong class="lb iu">管理员</strong>”帐户，您无法删除该帐户。您需要添加一个新用户。</p><p id="926a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也许是这样的:</p><ul class=""><li id="a532" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated">用户名:代理</li><li id="fc7d" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">名字:MyOrg</li><li id="b9df" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">姓氏:代理人</li><li id="c6b9" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">显示名称:MyOrg代理</li></ul><p id="b440" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将创建一个新的电子邮件地址，“<strong class="lb iu">agent@myorg.awsapps.com</strong>”。这将是您发送带有处理附件的电子邮件的电子邮件地址。出于本教程的目的，它将接受来自任何人的带有任何附件的电子邮件。这带来了安全风险。一旦你做到了这一点，我建议添加过滤功能，只允许“T2”白名单中的“T3”被允许的发件人，也许还可以过滤一些附件的内容。这真的很重要，所以以后不要忽视它。</p><p id="2447" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有几种方法可以做到这一点。在工作邮件服务器上过滤，通过登录“<a class="ae ky" href="https://mapi.awsapps.com/mail" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"/></a>”【agent@myorg.awsapps.com】账户过滤(用你的组织名称替换“<strong class="lb iu"> myorg </strong>”)，或者在我们不久将讨论的Lambda函数中过滤。我会说Lambda函数将是我的首选方法，因为它给了我们最多的控制，但也许你会想做一个组合过滤。</p></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><p id="cebd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">亚马逊工作邮件每个用户每月4.00美元，包括每个用户50 GB的邮箱存储。您可以开始为多达25个用户提供30天的免费试用。</p></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><h2 id="141d" class="mp mq it bd mr ms mt dn mu mv mw dp mx li my mz na lm nb nc nd lq ne nf ng nh bi translated"><strong class="ak">第四步:亚马逊简单电子邮件服务(SES) </strong></h2><p id="47ac" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我们现在有了由<a class="ae ky" href="https://console.aws.amazon.com/workmail" rel="noopener ugc nofollow" target="_blank"> AWS WorkMail </a>提供的邮件服务器。通过部署<a class="ae ky" href="https://console.aws.amazon.com/workmail" rel="noopener ugc nofollow" target="_blank"> AWS工作邮件</a>，<a class="ae ky" href="https://console.aws.amazon.com/ses" rel="noopener ugc nofollow" target="_blank"> AWS SES </a>将自动配置为处理域的传入邮件。</p><p id="4140" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们想在这里做一些有趣的事情，那就是添加一个电子邮件接收“规则集”来发送接收到的电子邮件的副本，并将其存储在我们的<a class="ae ky" href="https://console.aws.amazon.com/s3" rel="noopener ugc nofollow" target="_blank"> S3桶</a>中。正如我之前提到的，可能类似于“<strong class="lb iu"> mybucket-attachments </strong>”。如果您还没有这样做，请登录<a class="ae ky" href="https://console.aws.amazon.com/s3" rel="noopener ugc nofollow" target="_blank"> AWS S3 </a>并使用默认选项创建您的两个空桶。</p><p id="6495" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击<a class="ae ky" href="https://console.aws.amazon.com/ses" rel="noopener ugc nofollow" target="_blank"> AWS SES </a>中<strong class="lb iu">邮件接收</strong>下的<strong class="lb iu">规则集</strong>。</p><p id="671f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击<strong class="lb iu">查看活动规则集</strong>按钮。</p><p id="77d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在位置1应该有一个现有的规则，这就是处理<a class="ae ky" href="https://console.aws.amazon.com/workmail" rel="noopener ugc nofollow" target="_blank"> AWS工作邮件</a>的传入电子邮件。我们想通过点击“<strong class="lb iu">创建规则</strong>来创建一个新的规则。</p><p id="3efa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">收件人应该是您的“<strong class="lb iu">代理人</strong>”电子邮件……例如“<strong class="lb iu">agent@myorg.awsapps.com</strong>”。点击<strong class="lb iu">添加收件人</strong>，然后<strong class="lb iu">下一步</strong>。</p><p id="e85b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">添加动作</strong>应为“<strong class="lb iu"> S3 </strong>”:</p><ul class=""><li id="5b86" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated">S3铲斗:<strong class="lb iu">我的铲斗-附件</strong>(或者你管它叫什么)</li></ul><p id="744e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击<strong class="lb iu">下一步</strong>。</p><p id="eca1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您希望为您的规则命名，例如“myorg-email-to-s3-bucket ”。其他一切保持默认。</p><p id="b040" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击“<strong class="lb iu">下一步</strong>，然后“<strong class="lb iu">创建规则</strong>”。</p><p id="f139" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果一切按计划进行，你应该有两条规则。一个用于处理来自<a class="ae ky" href="https://console.aws.amazon.com/workmail" rel="noopener ugc nofollow" target="_blank"> AWS工作邮件</a>的入站电子邮件，在位置2新创建的规则用于处理将原始电子邮件复制到S3存储桶。</p><h2 id="129a" class="mp mq it bd mr ms mt dn mu mv mw dp mx li my mz na lm nb nc nd lq ne nf ng nh bi translated">第五步:确认它工作到这一点！</h2><p id="fa45" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">给你的新邮箱地址“<strong class="lb iu">agent@myorg.awsapps.com</strong>”发送一封带有文本文件附件的邮件(这也适用于二进制附件，但用简单的CSV或文本文件更容易演示)。目前，邮件内容和附件内容并不重要。只是一些小而轻的东西来测试这个。</p><p id="35ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您登录webmail，“<strong class="lb iu">https://myorg.awsapps.com/mail</strong>”并确认您在“<strong class="lb iu">代理人</strong>”邮箱中收到了该邮件。假设你也称你的用户为<strong class="lb iu">代理</strong>。</p><h2 id="dd5b" class="mp mq it bd mr ms mt dn mu mv mw dp mx li my mz na lm nb nc nd lq ne nf ng nh bi translated">步骤6:使用Lambda向S3发送工作邮件</h2><p id="cac7" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">第一步是打开<a class="ae ky" href="https://console.aws.amazon.com/lambda" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>控制台，点击<strong class="lb iu">创建功能</strong>。通过Scratch选择<strong class="lb iu">Author</strong>，给你的函数起一个名字(比如<strong class="lb iu"> email-to-s3-bucket </strong>)，选择<strong class="lb iu"> Python 3.8 </strong>运行时。这是撰写本文时可用的最高Python版本。</p><p id="ee5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">展开“<strong class="lb iu">更改默认执行角色</strong>，选择“<strong class="lb iu">使用现有角色</strong>”，选择我们在开始时创建的角色。我把我的命名为“<strong class="lb iu">RoleForLambdaToAWSServices</strong>”。</p><p id="58d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击<strong class="lb iu">创建功能</strong>。</p><p id="cbc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在“<strong class="lb iu">代码源</strong>下，编辑“<strong class="lb iu"> lambda_function.py </strong>”文件，替换为下面的代码。</p><p id="279e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在两个地方修改了原始作者代码。我们没有将处理后的电子邮件保存在“<strong class="lb iu"> mybucket-attachments </strong>”中，而是保存在我们的第二个S3存储桶“<strong class="lb iu"> mybucket-processed </strong>”中。请确保将下面的“<strong class="lb iu"> mybucket-processed </strong>”替换为您的目标S3铲斗。这一部分很重要，因为这将触发事件，以便稍后将CSV的内容摄入RDS。</p><pre class="kj kk kl km gt oi oj ok ol aw om bi"><span id="19d7" class="mp mq it oj b gy on oo l op oq">s3.upload_file('/tmp/attach.csv', '<strong class="oj iu">mybucket-processed</strong>', 'attach-upload-' + timestamp + '.csv')</span></pre><p id="ad13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还加入了一个发件人白名单。这很重要，因为你不想处理来自每个人的邮件。</p><pre class="kj kk kl km gt oi oj ok ol aw om bi"><span id="0820" class="mp mq it oj b gy on oo l op oq"># sender whitelist<br/>if fromAddress not in ['<a class="ae ky" href="mailto:sender@domain.com" rel="noopener ugc nofollow" target="_blank">sender@domain.com</a>']:<br/>    raise PermissionError(f'{fromAddress} not in whitelist!')</span></pre><p id="1024" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只需将“<strong class="lb iu">sender@domain.com</strong>”替换为允许的发件人电子邮件地址列表。你可以删去这三行，但这是不可取的。事实上，在生产环境中，我也会对附件进行一些检查，以确认它们看起来是合法的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Sandeep Madamanchi<a class="lv lw ep" href="https://medium.com/u/880221be771b?source=post_page-----fc4994c42819--------------------------------" rel="noopener" target="_blank">的原始代码</a></p></figure><p id="47b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你完成后，确保你的<strong class="lb iu">部署</strong>。</p><h2 id="be7a" class="mp mq it bd mr ms mt dn mu mv mw dp mx li my mz na lm nb nc nd lq ne nf ng nh bi translated">步骤7:配置AWS S3来使用我们新的Lambda函数</h2><p id="423f" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">打开<a class="ae ky" href="https://console.aws.amazon.com/s3" rel="noopener ugc nofollow" target="_blank"> AWS S3 </a>控制台，点击“<strong class="lb iu">铲斗</strong>，打开我们的“<strong class="lb iu"> mybucket-attachments </strong>”铲斗。</p><p id="003a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击“<strong class="lb iu">属性</strong>，向下滚动到“<strong class="lb iu">事件通知</strong>，点击“<strong class="lb iu">创建事件通知</strong>”。</p><ul class=""><li id="77f2" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated">事件名称:"<strong class="lb iu">创建对象</strong>"</li><li id="2e82" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">事件类型:"<strong class="lb iu">放</strong>"，"<strong class="lb iu">贴</strong>"</li><li id="8cb3" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">Lambda函数:"<strong class="lb iu">电子邮件转s3桶</strong>"</li></ul><p id="36fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击<strong class="lb iu">保存修改</strong></p><h2 id="a926" class="mp mq it bd mr ms mt dn mu mv mw dp mx li my mz na lm nb nc nd lq ne nf ng nh bi translated">第八步:我们来测试一下！</h2><p id="6aa2" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">从Lambda函数中的白名单地址发送一封电子邮件，附件为“<strong class="lb iu">agent@myorg.awsapps.com</strong>”。我推荐像基本CSV这样的小东西，只是为了验证它的工作。给它一个测试对象和身体，让这个变得有趣。</p><ol class=""><li id="ce2d" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ot nt nu nv bi translated">如果你登录，“<a class="ae ky" href="https://myorg.awsapps.com/mail" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">https://myorg.awsapps.com/mai</strong>l</a>”你应该会看到你的邮件。</li><li id="3cd5" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ot nt nu nv bi translated">打开<a class="ae ky" href="https://console.aws.amazon.com/cloudwatch" rel="noopener ugc nofollow" target="_blank"> AWS CloudWatch </a>，然后打开<strong class="lb iu">日志</strong>，然后打开<strong class="lb iu">日志组</strong>。您应该看到Lambda函数的日志文件，“email-to-s3-bucket ”。打开它，确认你看到了你的电子邮件被接收和处理的日志。</li><li id="3ef7" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ot nt nu nv bi translated">打开你的AWS S3桶。您应该在“<strong class="lb iu"> mybucket-attachments </strong>中看到原始电子邮件，在“<strong class="lb iu"> mybucket-processed </strong>中看到电子邮件附件。</li></ol><p id="671c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果这三项看起来都没问题，那么到目前为止你做得很好。我的已经工作了，我在我的“<strong class="lb iu">my bucket-processed</strong>”S3桶中看到“<strong class="lb iu">attach-upload-2021–8–23–1–59 . CSV</strong>”。如果我打开附件，我可以看到我用电子邮件发送的CSV附件的内容。</p><p id="7068" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还尝试从一个不在白名单上的地址发送附件，我可以在CloudWatch日志中看到它被拒绝，因为发件人地址不在白名单上。我还确认了被拒绝的电子邮件没有保存在S3的任何一个桶中。</p><h2 id="0139" class="mp mq it bd mr ms mt dn mu mv mw dp mx li my mz na lm nb nc nd lq ne nf ng nh bi translated">步骤9:准备RDS数据库安全组/访问列表</h2><p id="7594" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">虽然您可以在创建RDS数据库实例时创建安全组，但我建议您提前创建。</p><p id="8e95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开<a class="ae ky" href="https://console.aws.amazon.com/vpc" rel="noopener ugc nofollow" target="_blank"> AWS VPC </a>控制台，点击“<strong class="lb iu">您的VPCs </strong>”。请记下“<strong class="lb iu"> IPv4 CIDR </strong>”。在我的例子中是“<strong class="lb iu"> 172.31.0.0/16 </strong>”。</p><p id="f93f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开<a class="ae ky" href="https://console.aws.amazon.com/ec2" rel="noopener ugc nofollow" target="_blank"> AWS EC2 </a>控制台，点击<strong class="lb iu">网络&amp;安全</strong>下的<strong class="lb iu">安全组</strong>。点击<strong class="lb iu">创建安全组</strong>。</p><p id="a35b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">基本详情:</strong> <br/> *安全组名称:acl-rds-mysql-in <br/> *描述:acl-rds-mysql-in</p><p id="1bad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">入站规则("添加规则1"): <br/> </strong> *类型:MySQL/Aurora <br/> *来源:MySQL <br/> *目的地:MyIP</p><p id="6cc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">入站规则("添加规则2"): <br/> </strong> *类型:MySQL/Aurora <br/> *来源:MySQL <br/> *目的地:自定义<br/> * <strong class="lb iu"> 172.31.0.0/16 ← </strong>添加您的VPC子网</p><p id="bd60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击<strong class="lb iu">创建安全组</strong></p><h2 id="0025" class="mp mq it bd mr ms mt dn mu mv mw dp mx li my mz na lm nb nc nd lq ne nf ng nh bi translated">步骤10:部署RDS MySQL实例</h2><p id="2de3" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">打开<a class="ae ky" href="https://console.aws.amazon.com/rds" rel="noopener ugc nofollow" target="_blank"> AWS RDS </a>控制台，点击<strong class="lb iu">创建数据库</strong>。部署数据库时有许多配置选项，所以如果我没有提到什么，请假设您将配置选项保留为默认选项。</p><p id="e8fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">关闭数据库创建方法:<br/> </strong> *标准创建</p><p id="b8f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">引擎选项:</strong> <br/> *引擎类型:MySQL <br/> <br/> <strong class="lb iu">模板</strong> <br/> *自由层</p><p id="8558" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">设置:</strong> <br/> *数据库集群标识符:附件<br/> *主用户名:管理员<br/> *检查:自动生成密码</p><p id="bead" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> DB实例类:</strong> <br/> * db.t2.micro</p><p id="a20c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">连接:</strong> <br/> *虚拟私有云(VPC):默认VPC <br/> *公共访问:是(MySQL工作台所需)<br/> * VPC安全组:选择现有的<br/> —现有的VPC安全组:acl-rds-mysql-in(我们在步骤9中创建的)<br/> —删除“默认”<br/> *可用性区域:无首选项</p><p id="d4f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">数据库认证:</strong> <br/> *选择:密码认证</p><p id="d4f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">附加配置:</strong> <br/> *初始数据库名称:附件<br/> *取消选中:启用自动备份<br/> *取消选中:启用增强监控<br/> *取消选中:启用删除保护</p><p id="bc35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击<strong class="lb iu">创建数据库</strong></p><p id="d04e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建数据库需要几分钟时间。如果您如上所述选择了“<strong class="lb iu">自动生成密码</strong>”，创建后会弹出一个对话框，提示“<strong class="lb iu">查看连接详情</strong>”。你需要注意这一点。如果您愿意，也可以在创建表单中设置自己的密码。</p><h2 id="d741" class="mp mq it bd mr ms mt dn mu mv mw dp mx li my mz na lm nb nc nd lq ne nf ng nh bi translated">步骤11:下载并安装MySQL Workbench</h2><p id="787b" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">下载并安装<a class="ae ky" href="https://dev.mysql.com/downloads/workbench" rel="noopener ugc nofollow" target="_blank"> MySQL工作台</a>。这是一个免费的MySQL桌面客户端，可以让你连接到你的数据库。安装后，您需要创建一个新的连接，并从上面的“<strong class="lb iu">查看连接详细信息</strong>”中输入详细信息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/b55fcd5ac525ec4babc5d57ed855eecf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zMnH0E1zBQbf2RgavG1voA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="d738" class="mp mq it bd mr ms mt dn mu mv mw dp mx li my mz na lm nb nc nd lq ne nf ng nh bi translated"><strong class="ak">步骤12:为Lambda准备依赖关系</strong></h2><p id="5773" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我们将使用Python库"<strong class="lb iu"> pymysql </strong>"从Lambda访问我们的RDS实例。“<strong class="lb iu"> pymysql </strong>”不附带Lambda，需要手动上传。</p><p id="a4ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我用的是Mac电脑，但对于其他操作系统来说，这个过程是相似的。</p><pre class="kj kk kl km gt oi oj ok ol aw om bi"><span id="c66c" class="mp mq it oj b gy on oo l op oq">~ % mkdir lambda_tmp<br/>~ % cd lambda_tmp <br/>lambda_tmp % pip install -t . pymysql<br/>lambda_tmp % zip -r lambda.zip .</span></pre><p id="cbac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将把lambda.zip上传到我们的lambda函数中。完成此操作后，您可以删除此本地临时目录。</p><h2 id="4f90" class="mp mq it bd mr ms mt dn mu mv mw dp mx li my mz na lm nb nc nd lq ne nf ng nh bi translated">步骤13:为RDS摄取创建AWS Lambda函数</h2><p id="3a76" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">下一步是打开<a class="ae ky" href="https://console.aws.amazon.com/lambda" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>控制台，点击<strong class="lb iu">创建功能</strong>。选择“<strong class="lb iu"> Author by Scratch </strong>，给你的函数起一个名字(例如“<strong class="lb iu"> s3-bucket-to-rds </strong>”)，选择“<strong class="lb iu"> Python 3.8 </strong>运行时。这是撰写本文时可用的最高Python版本。</p><p id="0a9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">展开“<strong class="lb iu">更改默认执行角色</strong>”，选择“<strong class="lb iu">使用现有角色</strong>”，选择我们开始创建的角色。我把我的命名为“<strong class="lb iu">RoleForLambdaToAWSServices</strong>”。</p><p id="7b6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">展开“<strong class="lb iu">高级设置</strong>，在“<strong class="lb iu">网络</strong>下选择您默认的VPC。我们这样做的原因是，出于安全原因，我们的RDS MySQL安全组只允许来自VPC内部的连接。如果我们不这样做，Lambda函数将无法访问我们的RDS实例。在<strong class="lb iu">子网</strong>下，选择所有与VPC相关的子网。对于“<strong class="lb iu">安全组</strong>，选择默认的VPC安全组。它应该允许任何东西进出Lambda。</p><p id="de04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击<strong class="lb iu">创建功能</strong>。</p><p id="bf1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在“<strong class="lb iu">代码源</strong>”部分，点击“<strong class="lb iu">从</strong>上传”并上传上面创建的“<strong class="lb iu"> lambda.zip </strong>”。然后在项目根目录下创建一个名为“<strong class="lb iu"> lambda_function.py </strong>的新文件。我们稍后会添加一些内容，但它应该是这样的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/139d822ed17b7ab9fe3dfade4162b7ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q8h3V8BaAPf08mBiP1FD_w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="abd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击顶部的“<strong class="lb iu"> +添加触发器</strong>，选择“<strong class="lb iu"> S3 </strong>”。</p><ul class=""><li id="282e" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated">存储桶:<strong class="lb iu"> mybucket-processed </strong>(这是S3存储桶，附件在被接收和处理后被移动到该存储桶)</li><li id="9106" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">事件类型:<strong class="lb iu">所有对象创建事件</strong></li><li id="6c66" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">后缀:<strong class="lb iu">。csv </strong>(每个附件文件类型添加一个触发器)</li></ul><p id="0c17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在它要做的是，每当一个新对象被添加到我们的“<strong class="lb iu">my bucket-processed</strong>”bucket时，它将调用这个Lambda函数。我们现在要做的是添加一些代码，将附件的内容接收到RDS MySQL中。</p><p id="cd1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开我们创建的“<strong class="lb iu"> lambda_function.py </strong>”，添加下面的代码。请确保在第6行更新可用区域。我用的是"<strong class="lb iu"> eu-west-1 </strong>"但是你可能用的是别的。第22–25行是您的RDS MySQL数据库凭证。你需要在这里添加你自己的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="1418" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">6号线其实真的很重要。你可能没见过boto3客户端是这样写的。之所以用这种扩展的形式来写，是因为我已经用VPC(“专用网络”)保护了Lambda、RDS和S3之间的连接。默认情况下，所有这些通信将通过互联网，这是不确定的。事实上，你在网上找到的所有指南，包括这篇文章，都是以“快速而肮脏”的方式完成的。您将您的解决方案暴露于外部互联网的风险很大。通过虚拟专用网络建立所有连接有点复杂，但值得一试。</p><p id="daca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你把你的Lambda函数添加到VPC时，你会注意到你的Lambda函数不再能够访问S3。您需要在VPC中添加一个S3端点。使用“<strong class="lb iu"> boto3 </strong>时，S3网址默认为<em class="ow">虚拟</em>。因为它需要互联网接入来解析到区域特定的URL。这会导致Lambda函数挂起，直到超时。</p><p id="64bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">解决这个问题的方法是在VPC创建一个S3端点。打开<a class="ae ky" href="https://console.aws.amazon.com/vpc" rel="noopener ugc nofollow" target="_blank"> AWS VPC </a>控制台。打开“<strong class="lb iu">虚拟私有云</strong>下的“<strong class="lb iu">端点</strong>”。单击“创建端点”。您需要添加S3网关，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/278c632845fd274bc5997d1330c35fe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ip3UEiXBS96639L6wSd3Xg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="1655" class="mp mq it bd mr ms mt dn mu mv mw dp mx li my mz na lm nb nc nd lq ne nf ng nh bi translated">第十四步:都做好了！</h2><p id="8539" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">这一切都应该工作，但让我们给这个测试和验证的方式。</p><p id="2d33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">准备</strong></p><ul class=""><li id="c84c" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated">清空你的两个<a class="ae ky" href="https://console.aws.amazon.com/s3" rel="noopener ugc nofollow" target="_blank"> S3桶</a>。</li><li id="e50d" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">清空您的两个<a class="ae ky" href="https://console.aws.amazon.com/cloudwatch" rel="noopener ugc nofollow" target="_blank"> CloudWatch日志组</a>中的日志。</li><li id="99f0" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">为自己创建一个CSV文件(我将自己的文件命名为“<strong class="lb iu"> input.csv </strong>”)</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/7ff1ac57ea229754e783a22e7a5a07ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:188/format:webp/1*04H1WCa-IG5WT0Dq17HbIw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="bbc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">测试</strong></p><p id="1296" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">发邮件给你的“<strong class="lb iu">代理人</strong>”<a class="ae ky" href="https://console.aws.amazon.com/workmail" rel="noopener ugc nofollow" target="_blank">工作邮箱</a>地址，附上“<strong class="lb iu"> input.csv </strong>”即可。除非你想，否则不需要添加主题或正文。</p><p id="f4b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以“<strong class="lb iu">代理人</strong>”的身份登录您的<a class="ae ky" href="https://console.aws.amazon.com/workmail" rel="noopener ugc nofollow" target="_blank">工作邮件</a>网络邮件门户，并确认您看到了该邮件。</p><p id="f1b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开<a class="ae ky" href="https://console.aws.amazon.com/cloudwatch" rel="noopener ugc nofollow" target="_blank"> CloudWatch </a>日志组，打开<a class="ae ky" href="https://console.aws.amazon.com/s3" rel="noopener ugc nofollow" target="_blank"> S3 </a>中与接收邮件相关的日志组并保存。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/05bbf20a099dfb16d90d384db7c32ec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UzBVPpTREUheR9a6TZ1_7Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="9247" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的已经到了，目前处理的还不错。</p><p id="1a16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">前往<a class="ae ky" href="https://console.aws.amazon.com/s3" rel="noopener ugc nofollow" target="_blank"> S3 </a>并打开您的<em class="ow">*附件* </em>铲斗。您配置的接收电子邮件的桶。如果一切按计划进行，您应该会在桶中看到原始电子邮件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/f190081cb4d1544c6c18aa81149ee953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pUbjep85IPetA3hW3eJ03g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7b90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，Lambda函数会将附件复制到您的* <em class="ow">已处理的* </em>桶中。如果您打开* <em class="ow"> processed* </em> bucket，它实际上应该是空的，因为RDS lambda函数会在附件被处理后将其删除。在这一点上，您可以做的一个测试是查看桶，确保那里没有未处理的附件。如果你这么做了，那么Lambda函数中有东西坏了。</p><p id="a5f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您有任何与S3和Lambda集成相关的问题，最好看看Lambda函数是否与您的存储桶相关联。你这样做的方法是打开你的S3桶，转到“<strong class="lb iu">属性</strong>，向下滚动到“<strong class="lb iu">事件通知</strong>，你应该看到那里的事件和相关的Lambda函数。如果你没有看到一个Lambda函数与你的两个S3桶相关联，那么你在某个地方犯了一个错误。</p><p id="7a83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开<a class="ae ky" href="https://console.aws.amazon.com/cloudwatch" rel="noopener ugc nofollow" target="_blank"> CloudWatch </a>日志组，打开将附件从<a class="ae ky" href="https://console.aws.amazon.com/s3" rel="noopener ugc nofollow" target="_blank"> S3 </a>存储到<a class="ae ky" href="https://console.aws.amazon.com/rds" rel="noopener ugc nofollow" target="_blank"> RDS </a>的相关日志组。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/181d166c882805a1ee850a3a4abb5dc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FYFF4lS8D1qc_1gXcxPW1g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6bdb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了，这说明第二个Lambda函数已经被触发了。让我们看看日志的内容。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/65dc11e793c7faa517b70176d4f192e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*otdC1FheG2wlUD15jg3xpA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="2abe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这看起来都处理得很好，但是让我们在MySQL Workbench中确认一下。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/5523ec5fa46c3a71045eb59961fd6a39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ErTaC9n3QDA5-bUoOQmnuA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="b2df" class="mp mq it bd mr ms mt dn mu mv mw dp mx li my mz na lm nb nc nd lq ne nf ng nh bi translated">太神奇了！</h2><p id="c745" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">这显示了接收带有附件的电子邮件并将内容存储在数据库中的完整的端到端自动化工作流。很酷的东西。</p><p id="dfca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢本·奥尔尼和我一起集思广益。他有一些很棒的文章，建议你去看看。</p><p id="66df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">他最近的一部真的很有趣…</p><div class="lx ly gp gr lz ma"><a href="https://medium.com/geekculture/exploring-the-use-of-ai-and-machine-learning-for-mortgage-recommendations-95a22ea07d13" rel="noopener follow" target="_blank"><div class="mb ab fo"><div class="mc ab md cl cj me"><h2 class="bd iu gy z fp mf fr fs mg fu fw is bi translated">探索人工智能和机器学习在抵押贷款推荐中的应用。</h2><div class="mh l"><h3 class="bd b gy z fp mf fr fs mg fu fw dk translated">抵押技术和API:</h3></div><div class="mi l"><p class="bd b dl z fp mf fr fs mg fu fw dk translated">medium.com</p></div></div><div class="mj l"><div class="pe l ml mm mn mj mo ks ma"/></div></div></a></div><h1 id="3ffd" class="pf mq it bd mr pg ph pi mu pj pk pl mx jz pm ka na kc pn kd nd kf po kg ng pp bi translated">迈克尔·惠特尔</h1><ul class=""><li id="219d" class="nn no it lb b lc ni lf nj li pq lm pr lq ps lu ns nt nu nv bi translated"><strong class="lb iu"> <em class="ow">如果你喜欢这个，请</em> </strong> <a class="ae ky" href="https://whittle.medium.com/" rel="noopener"> <strong class="lb iu"> <em class="ow">跟我上媒</em> </strong> </a></li><li id="356c" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated"><strong class="lb iu"> <em class="ow">有兴趣合作吗？让我们连线上</em></strong><a class="ae ky" href="https://www.linkedin.com/in/miwhittle/" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="ow">LinkedIn</em></strong></a></li></ul></div></div>    
</body>
</html>