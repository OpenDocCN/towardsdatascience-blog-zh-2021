<html>
<head>
<title>The New Generation Data Lake</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">新一代数据湖</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-new-generation-data-lake-54e10e02b757?source=collection_archive---------5-----------------------#2021-09-20">https://towardsdatascience.com/the-new-generation-data-lake-54e10e02b757?source=collection_archive---------5-----------------------#2021-09-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1d92" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">千万亿字节架构，不容错过！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1041b303913783a73b361c4624a6cdaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hyEr_MiwlsVAubMjWxRIQA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="kv">图片由休伯特·纽菲尔德拍摄:</em><a class="ae kw" href="https://unsplash.com/photos/7S21XSxKxVk" rel="noopener ugc nofollow" target="_blank"><em class="kv">https://unsplash.com/photos/7S21XSxKxVk</em></a></p></figure><p id="b329" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">用于机器学习项目的数据量持续增长。数据科学家和数据工程师已经转向数据湖来存储海量数据并寻找有意义的见解。多年来，数据湖体系结构已经发展到以可接受的读/写速度大规模扩展到数百TB。但是大多数数据湖，无论是开源的还是私有的，都已经达到了Pb级的性能/成本墙。</p><p id="4e50" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">快速查询扩展到Pb级需要新的架构。幸运的是，新的开源Pb架构已经出现。关键要素来自开源解决方案提供的新表格格式，如<a class="ae kw" href="https://hudi.apache.org/" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir"/><strong class="kz ir">【胡迪】</strong></a><strong class="kz ir"/><a class="ae kw" href="https://delta.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir">三角洲湖</strong></a><strong class="kz ir"/>和<a class="ae kw" href="https://iceberg.apache.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz ir">阿帕奇冰山</strong></a><strong class="kz ir"/>。这些组件使数据湖能够以惊人的速度扩展到Pb级。</p><p id="6ab1" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了更好地认识这些新的表格格式是如何帮助我们的，我们需要了解当前数据湖架构的哪些组件伸缩性好，哪些组件伸缩性不好。不幸的是，当单个部分无法扩展时，它就会成为瓶颈，并阻止整个数据湖高效地扩展到Pb。</p><p id="3683" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们将重点关注开源数据湖生态系统，以更好地了解哪些组件可以很好地扩展，哪些组件可以防止数据湖扩展到Pb。然后我们将看到冰山如何帮助我们大规模扩展。这里学到的经验可以应用于专有数据湖。</p><p id="02b4" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">数据湖架构</strong></p><p id="b205" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如下图所示，典型的数据湖体系结构有两个主要层。存储层是数据所在的位置，计算层是执行计算和分析操作的位置。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lt"><img src="../Images/439bacaecff6a442af49b74164ba46f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rtly_4NQv2BpWv7_bckH6g.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="98cc" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">对象存储和文件格式—可扩展</strong></p><p id="9125" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">数据湖存储由对象存储处理。我们可以通过简单地添加更多的服务器来大规模扩展对象存储。这些容器跨越不同的服务器，使得对象存储具有极大的可伸缩性、弹性以及(几乎)故障安全性。</p><p id="d3fb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如今，最受欢迎的对象存储是亚马逊Web Services提供的<a class="ae kw" href="https://aws.amazon.com/pm/serv-s3/?trk=ps_a134p000004f2aOAAQ&amp;trkCampaign=acq_paid_search_brand&amp;sc_channel=PS&amp;sc_campaign=acquisition_US&amp;sc_publisher=Google&amp;sc_category=Storage&amp;sc_country=US&amp;sc_geo=NAMER&amp;sc_outcome=acq&amp;sc_detail=amazon%20s3&amp;sc_content=S3_e&amp;sc_matchtype=e&amp;sc_segment=488982706716&amp;sc_medium=ACQ-P|PS-GO|Brand|Desktop|SU|Storage|S3|US|EN|Text&amp;s_kwcid=AL!4422!3!488982706716!e!!g!!amazon%20s3&amp;ef_id=CjwKCAjwyvaJBhBpEiwA8d38vGc_Lr0hi5Jkxq3g1hUxTNsf3NiB8GnWg86miqh-W-xJ0a7rjyl7lhoCssoQAvD_BwE:G:s&amp;s_kwcid=AL!4422!3!488982706716!e!!g!!amazon%20s3" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir"/></a><strong class="kz ir"/><strong class="kz ir">(</strong>简单存储服务)和<a class="ae kw" href="https://hadoop.apache.org/docs/r1.2.1/hdfs_design.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kz ir"> Hadoop分布式文件系统</strong></a><strong class="kz ir">【HDFS】</strong>。一个扁平的、大规模可扩展的分布式水平架构被用于本地化这些容器和其中的对象。当然，你可以在GCP、Azure上找到非常相似的服务。</p><p id="f8f6" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><a class="ae kw" href="https://parquet.apache.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz ir">阿帕奇拼花</strong></a><strong class="kz ir"/><a class="ae kw" href="https://orc.apache.org/" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir">阿帕奇ORC</strong></a><strong class="kz ir"/>都是常用的文件格式。他们使用列存储文件格式，在分析使用方面，这比基于行的文件格式可伸缩性好得多。这些文件管理系统在读/写操作期间只读取所需的列，这大大加快了读/写速度。</p><p id="73ac" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">具有上述对象存储和文件格式系统的存储层如下所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lt"><img src="../Images/eb53aa8fe46cbf4d447357cd61766819.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1a0gm_HxHVCxTauLbOqWOA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="9b7f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">数据处理—可扩展</strong></p><p id="1683" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">计算层管理所有执行命令，包括创建读取更新删除(CRUD)以及执行高级查询和分析计算。它还包含元存储，元存储包含并管理元数据和文件位置等信息，以及需要以事务方式更新的其他信息。</p><p id="9653" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><a class="ae kw" href="https://spark.apache.org/" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir">Apache Spark</strong></a><strong class="kz ir"/>是比较流行的开源数据处理框架之一，因为它可以轻松处理大规模数据集。实验表明Spark的处理速度比Hadoop快100倍。speed通过缓存数据、在内存中运行计算和执行多线程并行操作来实现其可伸缩性和速度。Spark APIs允许开源数据湖的许多组件与Spark一起工作。</p><p id="8fbc" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><a class="ae kw" href="https://prestodb.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir">presto SQL</strong></a><strong class="kz ir"/>，现在更名为<strong class="kz ir">Trino</strong>，是一个分布式SQL查询引擎，旨在对大型数据集进行快速分析。Trino最初是由脸书在2013年开发的。它可以通过单个查询访问和查询来自多个不同数据源的数据，并执行来自Hadoop和S3等独立存储系统中的表的连接。它使用一个协调器来管理在一个机器集群上运行的一群工人。</p><p id="2fc2" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">Presto没有自己的元商店。Presto协调器需要调用一个元存储来知道文件存储在哪个容器中。在对不同的节点执行查询计划之前，它会生成一个查询计划。尽管Presto协调器很有效，但由于其架构，它代表了单点故障和瓶颈。</p><p id="d7f1" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">尽管Spark和Presto都被用作数据湖的SQL接口，但它们的用途不同。Presto旨在创建和处理大型数据集的大型查询。数据科学家和数据分析师使用它来探索大量数据。另一方面，Spark主要由数据工程师用于数据准备、处理和转换。由于它们的目的不同，所以它们通常都共存于数据湖环境中。</p><p id="9d4d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">元商店—不太可扩展</strong></p><p id="66bc" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">元商店管理系统在大规模扩展时会遇到问题。让我们看看如何。</p><p id="b55c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在开源数据湖中常用的<a class="ae kw" href="https://hive.apache.org/" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir">Apache Hive</strong></a><strong class="kz ir"/>Meta Store是脸书在2010年开发的。Hive使用关系数据库管理系统(RDBMS)来跟踪表的元数据，比如位置、索引和模式。“RDBMS”不容易扩展到Pb级，因此可能成为巨大数据湖的速度瓶颈。Hive使用map-reduce，这涉及到在将SQL查询发送到正确的容器之前对其进行翻译。当访问大量数据存储时，这会大大降低查询速度。Hive的另一个缺点是它没有版本控制管理系统。</p><p id="c587" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><a class="ae kw" href="https://projectnessie.org/" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir">Nessie</strong></a><strong class="kz ir"/>比Hive更新，规模更大。它使用一个可扩展的后端数据存储，如<a class="ae kw" href="https://aws.amazon.com/dynamodb/" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir">Amazon DynamoDB</strong></a><strong class="kz ir"/>来存储元数据。Nessie提供了一个设计良好的受Git启发的数据版本控制系统。它的API使它很容易与Spark、Hive或Iceberg集成。然而，Nessie数据存储驻留在计算层，它不能像对象存储那样扩展，因此可能成为瓶颈。</p><p id="c091" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">具有上述数据处理、元数据管理和表格格式的数据湖体系结构如下所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lt"><img src="../Images/7007339fead7e137797e609488a03c9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O1WEchtFV6KvMpVLN1Q3PA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="786e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">现在，让我们看看Iceberg如何克服这些元存储瓶颈。</p><p id="401c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">冰山的关键</strong></p><p id="b6f1" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">Apache Iceberg是网飞创建的一种表格式规范，用于提高大型数据湖查询的性能。它是Pb级数据湖的重要组成部分。Ryan Blue，网飞的Iceberg的创造者，<a class="ae kw" href="https://www.youtube.com/watch?v=nWwQMlrjhy0&amp;t=138s" rel="noopener ugc nofollow" target="_blank">解释了</a>他们如何能够将Atlas系统的查询规划性能时间从使用Hive和Parquet的9.6分钟减少到使用Iceberg的42秒。</p><p id="b440" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">Iceberg管理位于对象存储桶中数据旁边的文件中的表定义和信息(文件元数据)。可伸缩性的关键是Iceberg元存储可以分布在对象存储中的多个资源上。这为数据湖提供了巨大的元存储可伸缩性，避免了上述驻留在计算级别的其他元存储所造成的瓶颈。冰山表架构的详细描述可以在<a class="ae kw" href="https://www.dremio.com/apache-iceberg-an-architectural-look-under-the-covers/#:~:text=Ryan%20Blue%2C%20the%20creator%20of,because%20of%20these%20directory%20listings" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="833a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">Iceberg附带了一组数据处理引擎可以使用的API和库。文件仍然使用Avro、Parquet或ORC等文件格式存储。</p><p id="d911" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">Iceberg不使用传统的基于日期的分片来管理存储桶，而是使用自己的优化规则来提高灵活性和速度。使用Iceberg的分片方法极大地优化了历史查询速度。Iceberg可以与Nessie集成进行版本控制管理，并回滚到以前的表、分区和模式布局实例。</p><p id="8829" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">Iceberg提供了Java和Python两种语言的SDK。这个SDK可以通过Spark、Presto Flink和Hive访问。即使您选择使用Iceberg作为您的表格式，您仍然需要使用Spark和/或Presto这样的工具来查询Iceberg。在撰写本文时，Iceberg Python SDK仅限于读取操作，但是如果您不想直接将应用程序与Iceberg集成，您可以随时使用Spark甚至Presto，这可能是一个挑战。</p><p id="a0c9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">带有冰山文件格式管理组件的新的Pb级开源数据湖如下所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lt"><img src="../Images/17718d72eaf8a00cdad6efe0bbfc708e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ttYzddH5RCBfDjUaOmGDLQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="0fe1" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在不久的将来，机器学习平台将在其架构中包括基于Iceberg等技术的新数据湖，为数据科学家提供大规模可扩展的数据湖，以实现他们最雄心勃勃的项目。</p></div></div>    
</body>
</html>