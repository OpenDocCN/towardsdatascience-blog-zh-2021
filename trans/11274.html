<html>
<head>
<title>Using Codex to translate Keras to fastai</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Codex 将 Keras 翻译成 fastai</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-codex-to-translate-keras-to-fastai-8471a4596755?source=collection_archive---------25-----------------------#2021-11-04">https://towardsdatascience.com/using-codex-to-translate-keras-to-fastai-8471a4596755?source=collection_archive---------25-----------------------#2021-11-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/ab4031c6c9f56c98ebe029912968de90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zdADuc9cZYn5Vrsq8uW4Qw.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</p></figure><div class=""/><div class=""><h2 id="cb86" class="pw-subtitle-paragraph kf jh ji bd b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dk translated">Codex 能成为深度学习框架的中间人吗？</h2></div><p id="df72" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">OpenAI 的<a class="ae lt" href="https://openai.com/blog/openai-codex/" rel="noopener ugc nofollow" target="_blank"> Codex </a>提供了一组特定于计算机语言的操作，可以用来从英语语言描述中生成代码，自动记录代码，并在编码语言之间进行翻译。在过去的几个月里，我一直在探索 Codex 的能力，包括它从英语提示中<a class="ae lt" rel="noopener" target="_blank" href="/back-to-the-future-with-codex-and-cobol-766782f5ae8f">生成 web 应用程序的能力</a>和从 COBOL 中生成<a class="ae lt" rel="noopener" target="_blank" href="/codex-translates-cobol-into-javascript-266205d606c0">现代代码的能力。我很好奇 Codex 将如何处理两个不同深度学习框架之间的翻译。</a></p><h2 id="3000" class="lu lv ji bd lw lx ly dn lz ma mb dp mc lg md me mf lk mg mh mi lo mj mk ml mm bi translated">挑战</h2><p id="792a" class="pw-post-body-paragraph kx ky ji kz b la mn kj lc ld mo km lf lg mp li lj lk mq lm ln lo mr lq lr ls im bi translated">我有幸写了两本书，一本是关于使用结构化数据的<a class="ae lt" href="https://www.amazon.com/Deep-Learning-Structured-Data-Mark/dp/1617296724/ref=sr_1_1?crid=PJ88C9FDGR0R&amp;dchild=1&amp;keywords=%22deep+learning+with+structured+data%22&amp;qid=1635993870&amp;qsid=130-4637480-5001025&amp;sprefix=deep+learning+with+structured+data+%2Caps%2C100&amp;sr=8-1&amp;sres=1617296724%2C149203486X%2C0439438306%2C1412996481%2CB084TQ5RGK%2C054532114X%2C0545103339%2C3319659626&amp;srpt=ABIS_BOOK" rel="noopener ugc nofollow" target="_blank">深度学习的</a>，其中展示了用 Keras(tensor flow 的高级深度学习框架)编写的深度学习示例，另一本是关于使用 fastai 的<a class="ae lt" href="https://www.amazon.com/Deep-Learning-fastai-Cookbook-easy/dp/1800208103/ref=sr_1_1?crid=3SYARIO8M3ZU3&amp;dchild=1&amp;keywords=%22deep+learning+with+fastai+cookbook%22&amp;qid=1635994009&amp;qsid=130-4637480-5001025&amp;s=books&amp;sprefix=deep+learning+with+fastai+cookbook+%2Cstripbooks-intl-ship%2C90&amp;sr=1-1&amp;sres=B0971LB85Z&amp;srpt=ABIS_BOOK\" rel="noopener ugc nofollow" target="_blank">深度学习的，fastai 是基于 PyTorch 构建的高级框架。在写第二本书的过程中，我需要创建一个现有 Keras 应用程序的 fastai 实现。当我写这本书的时候，我通过反复试验“手工”创建了 fastai 应用程序，直到我得到大致相当于 Keras 代码的工作代码。如果我在写书的时候能够接触到 Codex，我会利用它从 Keras 自动生成 fastai 吗？在这篇文章中，我将描述一个实验来回答这个问题。</a></p><h2 id="c047" class="lu lv ji bd lw lx ly dn lz ma mb dp mc lg md me mf lk mg mh mi lo mj mk ml mm bi translated">MNIST——深度学习的“你好世界”</h2><p id="51cf" class="pw-post-body-paragraph kx ky ji kz b la mn kj lc ld mo km lf lg mp li lj lk mq lm ln lo mr lq lr ls im bi translated">你可以解决的最简单的深度学习问题是使用手写数字的 MNIST 数据集来训练一个模型，该模型可以预测手写数字图像中描绘的数字。</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/7c0ebdc98de1d313cc156f0200149a90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*1ZJnAmgRvHtC1egz54XUyw.jpeg"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">来自 MNIST 的示例图像</p></figure><p id="a29b" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">你可以说，为 MNIST 创建一个模型是深度学习的“你好世界”。</p><p id="854e" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">我关于 fastai 的书包含了 MNIST 模型的 Keras 和 fastai 实现的并排比较。这个比较说明了这两个框架之间的差异，并为熟悉 Keras 的开发人员探索 fastai 奠定了基础。</p><h2 id="e38f" class="lu lv ji bd lw lx ly dn lz ma mb dp mc lg md me mf lk mg mh mi lo mj mk ml mm bi translated">实验</h2><p id="dc1e" class="pw-post-body-paragraph kx ky ji kz b la mn kj lc ld mo km lf lg mp li lj lk mq lm ln lo mr lq lr ls im bi translated">为了锻炼 Codex 从 Keras 翻译到 fastai 的能力，我决定采用我为我的书手工转换成 fastai 的相同的 Keras MNIST 实现，看看 Codex 是否可以正确地完成翻译。</p><p id="6720" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">以下是 Keras MNIST 实现的起点，改编自<a class="ae lt" href="https://github.com/tensorflow/docs/blob/master/site/en/tutorials/quickstart/beginner.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/tensor flow/docs/blob/master/site/en/tutorials/quick start/beginner . ipynb</a>:</p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="mx my l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">克拉斯 MNIST 模型</p></figure><p id="c78f" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">为了让 Codex 将它翻译成 fastai，我使用了以下提示模式:</p><pre class="mt mu mv mw gt mz na nb nc aw nd bi"><span id="9a89" class="lu lv ji na b gy ne nf l ng nh">// Rewrite this as a fastai model</span><span id="df9f" class="lu lv ji na b gy ni nf l ng nh">[ Keras code goes here ]</span><span id="1f2f" class="lu lv ji na b gy ni nf l ng nh">// fastai version:</span></pre><p id="8801" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">食品法典委员会得出的结果看起来像 fastai 一样合理:</p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="mx my l"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">fastai 输出从 Keras 输入产生 Codex</p></figure><p id="09d8" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">我把这段代码复制到了 Colab 笔记本上，但是它不能正常工作。为了让它在 Colab 中正确运行，我需要做两处修改:</p><ul class=""><li id="71e1" class="nj nk ji kz b la lb ld le lg nl lk nm lo nn ls no np nq nr bi translated">用笔记本的 include 语句替换 include 语句:</li></ul><pre class="mt mu mv mw gt mz na nb nc aw nd bi"><span id="d13f" class="lu lv ji na b gy ne nf l ng nh">#import fastai<br/>#from fastai.vision.all import * <br/>!pip install -Uqq fastbook<br/>from fastbook import *<br/>from fastai.vision.all import *</span></pre><ul class=""><li id="a08f" class="nj nk ji kz b la lb ld le lg nl lk nm lo nn ls no np nq nr bi translated">注释掉编译语句:</li></ul><pre class="mt mu mv mw gt mz na nb nc aw nd bi"><span id="e2c8" class="lu lv ji na b gy ne nf l ng nh">#hello_world_model.compile(optimizer=optim.Adam,<br/>#              loss_func=nn.CrossEntropyLoss(),<br/>#              metrics=[accuracy])</span></pre><p id="a189" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">通过这些改变，我能够在 Colab 中成功运行 fastai 代码，并获得一个有效的 MNIST 深度学习模型:</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ns"><img src="../Images/0a0c05a8b3cb6bbbf6d9a4f0a988c365.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rf7I2_Z65szwI5XGjrWmQg.png"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">由 Codex 训练 MNIST 模型生成的 fastai 代码</p></figure><p id="5988" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">虽然 Codex 生成的 fastai 代码进行了一些小的修改，但它并不完全等同于 Keras 输入代码。特别是，输入的 Keras 代码包括显示测试数据集的模型损失和准确性的语句:</p><pre class="mt mu mv mw gt mz na nb nc aw nd bi"><span id="c728" class="lu lv ji na b gy ne nf l ng nh">test_scores = hello_world_model.evaluate(x_test,  y_test, verbose=2) <br/>print('Loss for test dataset:', test_scores[0])<br/>print('Accuracy for test dataset:', test_scores[1])</span></pre><p id="66c1" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">Codex 生成的 fastai 代码包括以下语句，用于在测试集上训练模型，但它并不像原始 Keras 代码那样显示聚合结果:</p><pre class="mt mu mv mw gt mz na nb nc aw nd bi"><span id="a55d" class="lu lv ji na b gy ne nf l ng nh">test_dl = dls.test_dl(get_image_files(path/'testing'))preds,_ = learn.get_preds(dl=test_dl)</span></pre><h2 id="7bce" class="lu lv ji bd lw lx ly dn lz ma mb dp mc lg md me mf lk mg mh mi lo mj mk ml mm bi translated">结论</h2><p id="b4b9" class="pw-post-body-paragraph kx ky ji kz b la mn kj lc ld mo km lf lg mp li lj lk mq lm ln lo mr lq lr ls im bi translated">给定 MNIST 深度学习模型的 Keras 代码作为输入，Codex 能够产生 fastai 代码作为输出(经过几次小的修改)，成功训练了 MNIST 深度学习模型。以下是我的主要观察结果:</p><ul class=""><li id="7cfc" class="nj nk ji kz b la lb ld le lg nl lk nm lo nn ls no np nq nr bi translated">一方面，这令人印象深刻。使用 Keras 框架的代码与使用 fastai 的代码有很大不同，作为一个人，我花了几次尝试，以 Keras 代码为起点，为 MNIST 开发 fastai 代码。Codex 第一次尝试就产生了(几乎)正常工作的 fastai 代码。我不必摆弄提示或对输入的 Keras 代码做任何更改。</li><li id="8e30" class="nj nk ji kz b la nt ld nu lg nv lk nw lo nx ls no np nq nr bi translated">另一方面，我不得不怀疑 Codex 是否简单地“记住”了作为 github 语料库一部分的 Keras 和 fastai MNIST 实现。例如，我用 fastai 书编写的<a class="ae lt" href="https://www.amazon.com/Deep-Learning-fastai-Cookbook-easy/dp/1800208103/ref=sr_1_1?crid=3SYARIO8M3ZU3&amp;dchild=1&amp;keywords=%22deep+learning+with+fastai+cookbook%22&amp;qid=1635994009&amp;qsid=130-4637480-5001025&amp;s=books&amp;sprefix=deep+learning+with+fastai+cookbook+%2Cstripbooks-intl-ship%2C90&amp;sr=1-1&amp;sres=B0971LB85Z&amp;srpt=ABIS_BOOK\" rel="noopener ugc nofollow" target="_blank">深度学习的代码(包括</a><a class="ae lt" href="https://github.com/PacktPublishing/Deep-Learning-with-fastai-Cookbook/blob/main/ch1/mnist_hello_world.ipynb" rel="noopener ugc nofollow" target="_blank">这个手写的 fastai MNIST 应用</a>和它的同伴<a class="ae lt" href="https://github.com/PacktPublishing/Deep-Learning-with-fastai-Cookbook/blob/main/ch1/keras_sequential_api_hello_world.py" rel="noopener ugc nofollow" target="_blank"> Keras MNIST 应用</a>)自 2021 年年中以来一直在 github 中，所以 Codex 的训练集可能包括了我书中的例子，而 Codex 所做的只是从它在训练集中看到的手写的 MNIST 应用中“查找”fastai 语句。</li></ul><p id="7f4e" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">总的来说，我不得不说，我对 Codex 能够从 Keras 代码中生成(几乎)有效的 fastai 代码印象深刻。甚至将“hello world”从一个框架自动翻译到另一个框架也是一种成就。我期待着用更具挑战性的 Keras 到 fastai 翻译来测试 Codex。</p><p id="61ff" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">与本文主题相同的视频:<a class="ae lt" href="https://youtu.be/xUMBiMP4xNw" rel="noopener ugc nofollow" target="_blank">https://youtu.be/xUMBiMP4xNw</a></p></div></div>    
</body>
</html>