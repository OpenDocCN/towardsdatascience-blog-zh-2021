<html>
<head>
<title>Just Start with the Dask LocalCluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">就从Dask本地集群开始吧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/just-start-with-the-dask-localcluster-saturn-cloud-7dbfe5a89c9a?source=collection_archive---------42-----------------------#2021-07-14">https://towardsdatascience.com/just-start-with-the-dask-localcluster-saturn-cloud-7dbfe5a89c9a?source=collection_archive---------42-----------------------#2021-07-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6c15" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Dask很棒，LocalCluster是最简单的入门方式</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/68d6c9c609a24268108db3879ecf7c64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*elTofpDMMRW3SW7g0q4isA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">克里斯汀·休姆在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="417b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">本文是关于实践中使用Dask的系列文章的第一篇。本系列的每一篇文章对初学者来说都足够简单，但是为实际工作提供了有用的提示。本系列的下一篇文章是关于循环的</em> <a class="ae kv" href="https://saturncloud.io/blog/local-cluster/" rel="noopener ugc nofollow" target="_blank"> <em class="ls">并行化，以及其他使用dask.delayed </em> </a> <em class="ls">的令人尴尬的并行操作。</em></p><p id="b8c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Saturn Cloud，<a class="ae kv" href="https://www.saturncloud.io" rel="noopener ugc nofollow" target="_blank">我们管理着一个数据科学平台</a>，该平台提供Jupyter笔记本、Dask集群以及部署模型、仪表盘和作业的方法。我们已经看到一些客户在完全不必要的情况下开始使用多节点集群。当您第一次使用Dask时，应该选择LocalCluster。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="03e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有许多方法可以运行Dask集群。这篇文章敦促用户尽可能简单地开始，并通过简单的方法来做到这一点。</p><h1 id="7fe0" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">尽可能简单</h1><p id="3be3" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">我们托管和管理多节点Dask集群。这些集群甚至可以使用GPU。有了Saturn，用户只需点击几下鼠标，就可以访问包含数百个GPU的集群。</p><p id="bb0f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是等等。</p><p id="a7c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">仅仅因为你有一辆法拉利，并不意味着你应该开着它去杂货店。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/09ab2d0d32a39c1a12b6255129026f23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LDhBjQ854dWjzZ83"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@b_atchison98?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">布兰登·艾奇森</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="b1ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">越简单越好。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/7964f9566db23980bcdb582c378a7a6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EvyZLhJ2hGapIggm"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">鲁道夫·马里在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="5ab9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您的缩放顺序应该是:</p><ol class=""><li id="e8b2" class="mz na iq ky b kz la lc ld lf nb lj nc ln nd lr ne nf ng nh bi translated">从熊猫开始。这通常就够了。</li><li id="f039" class="mz na iq ky b kz ni lc nj lf nk lj nl ln nm lr ne nf ng nh bi translated">内存不足？用熊猫配更大的机器。<a class="ae kv" href="https://www.linkedin.com/feed/update/urn:li:activity:6799017968677330944" rel="noopener ugc nofollow" target="_blank"> Saturn现在拥有4tb内存的Jupyter实例</a></li><li id="69bd" class="mz na iq ky b kz ni lc nj lf nk lj nl ln nm lr ne nf ng nh bi translated">尝试Dask本地集群</li><li id="1080" class="mz na iq ky b kz ni lc nj lf nk lj nl ln nm lr ne nf ng nh bi translated">尝试多节点(也可能是多GPU) Dask集群</li></ol><p id="6615" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一般来说，你的堆栈越简单，你花在修补上的时间就越少，而你花在生产上的时间就越多。我写这篇文章是因为我花了时间与那些在不需要时使用多节点集群的用户交谈。这是我们的错——我们让它们很容易旋转起来。</p><h1 id="721b" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">为什么是LocalCluster？</h1><p id="a673" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">你的电脑有多个内核(我的有4个)。如果您正在编写常规的Python代码，您可能只利用了其中的一个内核。您的一些代码(特别是调用NumPy的代码，例如矩阵乘法)正在利用多个内核，因为NumPy知道如何这样做。Python <strong class="ky ir">不知道</strong>如何在多核上自动执行你写的代码。</p><p id="9250" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用dask集群(以及了解如何在Dask上并行化的库)允许您利用系统上的所有内核。Dask附带了一些并行模块，比如<code class="fe nn no np nq b">dask.dataframe</code>和<code class="fe nn no np nq b">dask.array</code>。其他库，如Xarray和dask-ml `也与dask集成。</p><p id="dec0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Dask可以帮助您通过多节点集群扩展到巨大的数据集。Dask还可以通过LocalCluster帮助您利用计算机上的所有内核</p><h2 id="8a28" class="nr mb iq bd mc ns nt dn mg nu nv dp mk lf nw nx mm lj ny nz mo ln oa ob mq oc bi translated">LocalCluster比多节点Dask集群更容易</h2><p id="e30a" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">用一台机器工作更容易。在单台机器上，<a class="ae kv" href="https://htop.dev/" rel="noopener ugc nofollow" target="_blank"> htop </a>可以帮助您了解您的系统运行情况。在单台机器上，您不必担心将代码或数据文件复制到您的计算机集群中。在一台机器上，您可以在终端中看到整个Dask集群的所有日志。</p><h2 id="3db6" class="nr mb iq bd mc ns nt dn mg nu nv dp mk lf nw nx mm lj ny nz mo ln oa ob mq oc bi translated">多重处理呢？</h2><p id="1960" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">多重处理非常适合令人尴尬的并行问题。对于非尴尬的并行问题，您将需要一个像Dask这样的工具，它知道如何在多个内核上并行化复杂的操作。由于Dask可以处理这两种类型的并行问题，所以您只需学习一种语法。此外，您还可以使用Dask仪表盘来监控您的工作。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/5d7a225c37c50657fce11ee4de27b182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KoPmULFGWyPSaSpSa8xzyw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Hugo Shi截图</p></figure><p id="853b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于非令人尴尬的并行问题，您将需要一个像Dask这样的工具，它知道如何在多个内核上并行化复杂的操作。</p><h1 id="06f9" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">如何使用LocalCluster</h1><p id="180d" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">有许多方法可以使用LocalCluster。我会给你看最好的。</p><h1 id="9175" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">不要做什么</h1><p id="9399" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">Dask让入门变得非常非常容易。创建一个Dask客户端，你就自动得到了一个<code class="fe nn no np nq b">LocalCluster</code></p><pre class="kg kh ki kj gt oe nq of og aw oh bi"><span id="fc77" class="nr mb iq nq b gy oi oj l ok ol">&gt;&gt;&gt; from dask.distributed import Client &gt;&gt;&gt; c = Client() &gt;&gt;&gt; c.cluster LocalCluster(16ff34f9, 'tcp://127.0.0.1:35257', workers=4, threads=8, memory=41.92 GB) &gt;&gt;&gt;</span></pre><p id="c9c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">还可以在Python中显式使用LocalCluster</p><pre class="kg kh ki kj gt oe nq of og aw oh bi"><span id="34e9" class="nr mb iq nq b gy oi oj l ok ol">&gt;&gt;&gt; from dask.distributed import Client &gt;&gt;&gt; from dask.distributed import LocalCluster &gt;&gt;&gt; cluster = LocalCluster() &gt;&gt;&gt; client = Client(cluster)</span></pre><p id="7218" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我在部署生产数据管道时使用这种方法，但是我不喜欢为了研究而这样做。如果您有多个Python会话或笔记本，这种方法很容易让您意外地在您的计算机上结束多个集群。这也使得查看日志和找到Dask仪表板的地址变得更加困难。</p><h1 id="e85b" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">做什么</h1><p id="8c72" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">打开一个终端。</p><pre class="kg kh ki kj gt oe nq of og aw oh bi"><span id="a23f" class="nr mb iq nq b gy oi oj l ok ol">$ dask-scheduler</span></pre><p id="c8fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开第二个终端。</p><pre class="kg kh ki kj gt oe nq of og aw oh bi"><span id="eb71" class="nr mb iq nq b gy oi oj l ok ol">$ dask-worker tcp://127.0.0.1:8786</span></pre><p id="5316" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您的Python会话(可能是Jupyter笔记本)中，执行以下操作:</p><pre class="kg kh ki kj gt oe nq of og aw oh bi"><span id="2674" class="nr mb iq nq b gy oi oj l ok ol">from dask.distributed import Client client = Client('tcp://127.0.0.1:8786')</span></pre><p id="99cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">给你。<code class="fe nn no np nq b">dask-scheduler</code>的默认地址是<code class="fe nn no np nq b">tcp://127.0.0.1:8786</code>，第二个命令足以设置连接到调度程序的Dask workers。这种方法最好的一点是，您所有工作的所有日志都在第二个终端中。要关闭它，只需在两个终端点击<code class="fe nn no np nq b">ctrl-c</code>。</p><h2 id="24f9" class="nr mb iq bd mc ns nt dn mg nu nv dp mk lf nw nx mm lj ny nz mo ln oa ob mq oc bi translated">进程和线程</h2><p id="00ce" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">Python有个烦人的东西叫做<a class="ae kv" href="https://wiki.python.org/moin/GlobalInterpreterLock" rel="noopener ugc nofollow" target="_blank">全局解释器锁</a>。你不需要了解太多，除了这意味着Python不能很好地利用多线程。这条规则的一般例外是主要进行I/O(下载数据)的代码，或者主要利用C++和其他非python库的代码(例如NumPy)。</p><p id="8cc3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们接触过的大多数用户最好使用线程上的进程(也可以混合使用)。我是这样在我的机器上做的。</p><ol class=""><li id="b96e" class="mz na iq ky b kz la lc ld lf nb lj nc ln nd lr ne nf ng nh bi translated">我有40 GB的RAM(谢谢<a class="ae kv" href="https://system76.com/laptops/lemur" rel="noopener ugc nofollow" target="_blank"> System76！</a>！)</li><li id="beba" class="mz na iq ky b kz ni lc nj lf nk lj nl ln nm lr ne nf ng nh bi translated">我有4个内核。所以我想要4个工人。</li><li id="d4b7" class="mz na iq ky b kz ni lc nj lf nk lj nl ln nm lr ne nf ng nh bi translated">这意味着每个工人可以消耗10 GB的内存。</li></ol><pre class="kg kh ki kj gt oe nq of og aw oh bi"><span id="2bf6" class="nr mb iq nq b gy oi oj l ok ol">$ dask-worker tcp://127.0.0.1:8786 --nprocs 4 --memory-limit 10GB</span></pre><h1 id="fcd8" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">结论</h1><p id="3837" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">从简单开始，逐步扩大规模。在Saturn，我们可以为您的所有本地集群需求提供4tb的实例。如果这还不够，您还可以在多节点(和多GPU)集群上运行相同的代码，只需点击几下鼠标。祝你快乐！</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="b875" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">声明:我是<a class="ae kv" href="https://www.saturncloud.io/s/home/" rel="noopener ugc nofollow" target="_blank">土星云</a>的CTO。我们让您的团队轻松连接云资源。想用Jupyter和Dask？部署模型、仪表板或作业？在笔记本电脑或4 TB Jupyter实例上工作？完全透明地了解谁在使用哪些云资源？我们做所有这些，甚至更多。</p><p id="b1f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">最初发布于2021年8月8日</em><a class="ae kv" href="https://saturncloud.io/blog/local-cluster/" rel="noopener ugc nofollow" target="_blank"><em class="ls">https://Saturn cloud . io</em></a><em class="ls">。</em></p></div></div>    
</body>
</html>