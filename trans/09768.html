<html>
<head>
<title>Boolean Masking with Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫布尔掩蔽</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/boolean-masking-with-pandas-b21b7714d0b6?source=collection_archive---------7-----------------------#2021-09-13">https://towardsdatascience.com/boolean-masking-with-pandas-b21b7714d0b6?source=collection_archive---------7-----------------------#2021-09-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="71a8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">过滤熊猫数据帧</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9abbbe1763eba4686cdc35ed2b999938.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SHGUXKQLmT74qCxUm8Bpng.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">拉里·科斯塔莱斯在<a class="ae kv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="fda7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<a class="ae kv" href="https://medium.com/@tebeka" rel="noopener"> <strong class="ky ir"> Miki Tebeka </strong> </a>的优秀“<a class="ae kv" href="https://www.linkedin.com/learning/faster-pandas" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">更快的熊猫</strong></a><strong class="ky ir">”</strong><em class="ls"/>课程中的一个主题是如何使用布尔掩码来过滤熊猫中的数据。我想实践我所学的，所以我更新了一个<a class="ae kv" href="https://github.com/lspope/cookpad_reviews_analysis" rel="noopener ugc nofollow" target="_blank">最近的项目</a>来使用布尔遮罩。我认为这是一个非常有用的技术，所以我想分享一下我是如何更新代码的。我将向您展示如何在一些直接取自我的项目的 之前的<strong class="ky ir"> <em class="ls">和</em> </strong>之后的<strong class="ky ir"> <em class="ls">代码片段中使用布尔掩码。</em></strong></p><p id="6173" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们深入片段之前，我将提供一些背景。我想分析一个流行的烹饪应用的评论。我下载了这些评论，并重点关注了2019年和2020年发布的评论。为什么是这个时间范围？我想看看COVID之前和期间的应用评价是否有所不同。我的家庭在2020年增加了家庭烹饪，我很好奇烹饪应用的评论是否会显示应用使用和/或用户享受的增加。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="d04f" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">如何使用布尔掩码</h2><p id="8c48" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">现在，让我们通过检查一些 之前的<strong class="ky ir"> <em class="ls">和</em> </strong>之后的<strong class="ky ir"> <em class="ls">代码片段来学习如何使用布尔掩码。</em></strong></p><p id="2536" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的代码筛选数据集，只使用年份为2019或2020的行。</p><p id="dfec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls">之前:</em> </strong></p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="453d" class="ma mb iq mz b gy nd ne l nf ng">#reviewTimestamp is a datetime object</span><span id="5a48" class="ma mb iq mz b gy nh ne l nf ng">reviews_df = all_reviews_df[(all_reviews_df[‘reviewTimestamp’].dt.year == 2019) | (all_reviews_df[‘reviewTimestamp’].dt.year == 2020)]</span></pre><p id="cda7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls">后:</em> </strong></p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="e4c8" class="ma mb iq mz b gy nd ne l nf ng">pre_mask = all_reviews_df[‘reviewTimestamp’].dt.year == 2019<br/>during_mask = all_reviews_df[‘reviewTimestamp’].dt.year == 2020</span><span id="eca9" class="ma mb iq mz b gy nh ne l nf ng">reviews_df = all_reviews_df[pre_mask | during_mask]</span></pre><p id="239b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面还有一个例子。该代码过滤数据集，以找到2019年和2020年的“高”和“低”评论。</p><p id="1aa5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls">之前:</em> </strong></p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="feef" class="ma mb iq mz b gy nd ne l nf ng">top_reviews_2019 = reviews_df[(reviews_df[‘reviewTimestamp’].dt.year == 2019) &amp; (reviews_df[‘score’] == 5)][‘content’].to_list()</span><span id="da20" class="ma mb iq mz b gy nh ne l nf ng">low_reviews_20191 = reviews_df[(reviews_df[‘reviewTimestamp’].dt.year == 2019) &amp; (reviews_df[‘score’] &lt; 3)][‘content’].to_list()</span><span id="73d4" class="ma mb iq mz b gy nh ne l nf ng">top_reviews_2020 = reviews_df[(reviews_df[‘reviewTimestamp’].dt.year == 2020) &amp; (reviews_df[‘score’] == 5)][‘content’].to_list()</span><span id="87e8" class="ma mb iq mz b gy nh ne l nf ng">low_reviews_2020 = reviews_df[(reviews_df[‘reviewTimestamp’].dt.year == 2020) &amp; (reviews_df[‘score’] &lt; 3)][‘content’].to_list()</span></pre><p id="73d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls">后:</em> </strong></p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="d1b1" class="ma mb iq mz b gy nd ne l nf ng">pre_mask = reviews_df[‘reviewTimestamp’].dt.year == 2019<br/>during_mask = reviews_df[‘reviewTimestamp’].dt.year == 2020<br/>high_mask = reviews_df[‘score’] == 5<br/>low_mask = reviews_df[‘score’] &lt; 3</span><span id="166b" class="ma mb iq mz b gy nh ne l nf ng">high_reviews_2019 = reviews_df[pre_mask &amp; high_mask][‘content’].to_list()</span><span id="a7dc" class="ma mb iq mz b gy nh ne l nf ng">low_reviews_2019 = reviews_df[pre_mask &amp; low_mask][‘content’].to_list()</span><span id="2499" class="ma mb iq mz b gy nh ne l nf ng"><br/>high_reviews_2020 = reviews_df[during_mask &amp; high_mask][‘content’].to_list()</span><span id="2e47" class="ma mb iq mz b gy nh ne l nf ng">low_reviews_2020 = reviews_df[during_mask &amp; low_mask][‘content’].to_list()</span></pre></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="de8b" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">为什么使用布尔掩码？</h2><p id="f453" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">为什么我发现做这些改变很有用？第一个原因是它使代码更容易阅读和修改。例如，我可能会用2018年和2019年的COVID前时间框架以及2020年和2021年的COVID期间时间框架来更新分析。我只需要更新布尔掩码定义中的标准，而不是遍历代码并替换我过滤数据集的每个地方的标准。</p><p id="3f16" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第二个原因是，有人告诉我使用布尔掩码可以提高性能。我使用<a class="ae kv" href="https://ipython.org/" rel="noopener ugc nofollow" target="_blank"> IPython </a>交互命令shell中的<strong class="ky ir"> <em class="ls"> </em> </strong> <a class="ae kv" href="https://ipython.readthedocs.io/en/stable/interactive/magics.html?highlight=%25%25timeit#magic-timeit" rel="noopener ugc nofollow" target="_blank"> %timeit </a>魔法命令(在单元模式下)对我的代码进行了性能测试。我的性能检查显示，使用布尔掩码的代码比使用常规条件过滤的代码更快。在我的电脑上，代码比T11快了7倍。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/61593e062f2ba7ff4126865e7c1ebb93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xuMkMAm7He3wNb4eBgfEaQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由作者提供</p></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="94d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您已经看到了一些如何使用布尔掩码的示例，并且知道了应该考虑在代码中使用它们的原因。请随时提出建议，并让我知道这些内容是否对您有所帮助。</p><p id="d42b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编码快乐！</p></div></div>    
</body>
</html>