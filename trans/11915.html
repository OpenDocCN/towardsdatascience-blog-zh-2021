<html>
<head>
<title>MySQL data connector for your data warehouse solution</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">适用于数据仓库解决方案的MySQL数据连接器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/mysql-data-connector-for-your-data-warehouse-solution-db0d338b782d?source=collection_archive---------26-----------------------#2021-11-29">https://towardsdatascience.com/mysql-data-connector-for-your-data-warehouse-solution-db0d338b782d?source=collection_archive---------26-----------------------#2021-11-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a0dd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何构建一个数据库，并以块的形式导出数百万行，流式传输，捕获实时数据更改或提取数据并将其保存到云中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0c929140fba93491ce2ea315a5e25edb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KQzK24cA_jDLT267"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@rseneca?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">丽塔·塞内卡</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><h1 id="3c0a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">为您的数据仓库构建MySQL数据连接器</h1><p id="160e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">假设您是一名<strong class="lt iu">数据工程师</strong>，您的任务是从您的<strong class="lt iu"> <em class="mn"> MySQL </em> </strong>数据库实例和您的<strong class="lt iu"> <em class="mn">数据仓库</em> </strong>中同步数据。这是一个非常常见的<strong class="lt iu">场景</strong>，其中您需要连接最流行的数据源和您的数据仓库解决方案，即雪花、红移或BigQuery。</p><p id="fa0e" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">这篇文章详细总结了如何在不使用任何第三方应用程序的情况下从关系数据库(MySQL)中提取和保存数据。是用<strong class="lt iu"> <em class="mn"> AWS Lambda </em> </strong>函数构建的<strong class="lt iu">node . js</strong><strong class="lt iu"><em class="mn">server less</em></strong>应用的详细教程。这个微服务将从MySQL数据库中提取数据，并可以在您的机器上本地运行或/和按计划从AWS帐户运行。同样的应用程序还有一个更高级的例子，它创建了<strong class="lt iu">节点。JS </strong> <code class="fe mt mu mv mw b">streams</code>从MySQL提取数据并保存到你的<strong class="lt iu"> <em class="mn"> AWS S3数据湖</em> </strong>。</p><h1 id="5500" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">概述</h1><p id="d6c2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">你将学习如何:</p><ul class=""><li id="78c0" class="mx my it lt b lu mo lx mp ma mz me na mi nb mm nc nd ne nf bi translated">用<strong class="lt iu"> AWS Lambda </strong>创建一个简单的<strong class="lt iu"> Node.js </strong> app。</li><li id="73c5" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">使用Node.js <strong class="lt iu"> streams </strong>来优化内存消耗。</li><li id="cfb7" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">提取数据并以CSV和JSON格式保存在本地。</li><li id="f533" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">导出到云存储中。</li><li id="c369" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">使用<code class="fe mt mu mv mw b">yaml</code> config进行查询。</li><li id="6d2b" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">部署和安排它。</li></ul><blockquote class="nl nm nn"><p id="e30c" class="lr ls mn lt b lu mo ju lw lx mp jx lz no mq mc md np mr mg mh nq ms mk ml mm im bi translated"><code class="fe mt mu mv mw b"><em class="it">$ npm run test</em></code> <em class="it">命令会将一亿行数据批量导出到云存储中。</em></p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/93fe6dbeee8c7b7816e3a36ae971fca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rbzPe1zPatEuMbgOtKLBwQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片<a class="ns nt ep" href="https://medium.com/u/e06a48b3dd48?source=post_page-----db0d338b782d--------------------------------" rel="noopener" target="_blank">💡迈克·沙克霍米罗夫</a></p></figure><p id="fab0" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">本教程可能对数据工程师和所有使用MySQL数据库或想学习如何连接各种任意数据源和数据仓库解决方案的人有用。</p><h1 id="e2dd" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">先决条件、库和设置</h1><p id="0bff" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu">工具</strong></p><ul class=""><li id="c68f" class="mx my it lt b lu mo lx mp ma mz me na mi nb mm nc nd ne nf bi translated">已安装Node.js和节点包管理器</li><li id="c143" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">对云计算(Amazon Web Services帐户)、AWS CLI和AWS SDK有基本的了解</li><li id="7b42" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">Google Cloud Platform或AWS帐户，具体取决于您使用的云存储。</li><li id="7d31" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">Shell(命令行界面)命令和脚本(高级)。</li></ul><p id="c303" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated"><strong class="lt iu">技巧</strong></p><ul class=""><li id="ecd1" class="mx my it lt b lu mo lx mp ma mz me na mi nb mm nc nd ne nf bi translated">良好的节点知识。JS(中级)。您将创建一个Lambda函数。</li><li id="6998" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">你必须了解Node。JS基本概念，即异步函数、节点包和代码如何工作。</li><li id="1911" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">基本调试(控制台、打印报表)</li><li id="a466" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">循环:即用于</li><li id="d3c5" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">分支:if、if/else、开关</li><li id="2f7a" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">Shell命令和脚本，就像您希望从命令行使用AWS CLI部署Lambda并能够在本地测试它一样。</li></ul><h1 id="ad2f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">如何使用MySQL原生特性导出数据</h1><p id="d84f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您可能希望使用<code class="fe mt mu mv mw b"><a class="ae ky" href="https://dev.mysql.com/doc/refman/5.7/en/select-into.html" rel="noopener ugc nofollow" target="_blank">SELECT * INTO 'file.csv'</a></code>来实现这一点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="d6af" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">稍加调整和改变，你就会获得想要的结果。</p><blockquote class="nw"><p id="6ace" class="nx ny it bd nz oa ob oc od oe of mm dk translated">但是，这是手动操作…</p></blockquote><p id="5716" class="pw-post-body-paragraph lr ls it lt b lu og ju lw lx oh jx lz ma oi mc md me oj mg mh mi ok mk ml mm im bi translated">请记住，您可能希望使用索引列来限制<code class="fe mt mu mv mw b">where</code>子句中的范围。否则，您的数据库将会遇到困难。</p><h1 id="9c02" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">带有节点的非常基本的MySQL数据连接器。射流研究…</h1><blockquote class="nl nm nn"><p id="8b0f" class="lr ls mn lt b lu mo ju lw lx mp jx lz no mq mc md np mr mg mh nq ms mk ml mm im bi translated"><strong class="lt iu"> <em class="it">跳过</em> </strong>这部分如果你是在用node.js <code class="fe mt mu mv mw b">streaming</code>、数据转换和<code class="fe mt mu mv mw b">S3 upload</code>等更高级的例子之后。</p></blockquote><ul class=""><li id="b583" class="mx my it lt b lu mo lx mp ma mz me na mi nb mm nc nd ne nf bi translated">为你的Lamda微服务新建一个文件夹:<br/> <code class="fe mt mu mv mw b">$ mkdir mysql-connector</code> <br/> <code class="fe mt mu mv mw b">$ cd mysql-connector<br/></code> <code class="fe mt mu mv mw b">$ npm init</code></li><li id="6dfc" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">使用<code class="fe mt mu mv mw b">npm</code>为其安装<a class="ae ky" href="https://www.npmjs.com/package/mysql2" rel="noopener ugc nofollow" target="_blank"> mysql </a>包:<br/> <code class="fe mt mu mv mw b">$npm i mysql2@2.0.0</code></li><li id="80de" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">安装run-local-lambda包。我们将使用它在本地触发和测试Lambda:<br/><code class="fe mt mu mv mw b">$ npm i run-local-lambda@1.1.1</code></li><li id="3760" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">在您的Lambda根目录中创建一个<code class="fe mt mu mv mw b">config</code>文件来定义要使用的管道配置和表:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><ul class=""><li id="3ce8" class="mx my it lt b lu mo lx mp ma mz me na mi nb mm nc nd ne nf bi translated">在主应用程序文件<code class="fe mt mu mv mw b">./app.js</code>中创建一个<code class="fe mt mu mv mw b">async</code>函数，从<code class="fe mt mu mv mw b">./config.json</code>文件运行<strong class="lt iu"> SQL查询</strong>。</li></ul><p id="802e" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated"><strong class="lt iu">你的应用程序文件夹现在应该是这样的:</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="3c0c" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated"><strong class="lt iu">您的主应用程序文件</strong> <code class="fe mt mu mv mw b"><strong class="lt iu">./app.js</strong></code> <strong class="lt iu">应该是这样的:</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><blockquote class="nl nm nn"><p id="50a4" class="lr ls mn lt b lu mo ju lw lx mp jx lz no mq mc md np mr mg mh nq ms mk ml mm im bi translated">这是如何以编程方式从MySQL导出数据的要点。很简单。</p></blockquote><p id="00de" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">在命令行中运行<code class="fe mt mu mv mw b">$ npm run test</code>，这将从MySQL数据库中导出数据。请确保您的凭据和数据库主机地址正确无误。</p><blockquote class="nw"><p id="eedd" class="nx ny it bd nz oa ob oc od oe of mm dk translated">现在您可以在您的<code class="fe mt mu mv mw b">./config.json</code>文件中更改SQL查询，并以编程方式运行它。</p></blockquote><h1 id="6931" class="kz la it bd lb lc ld le lf lg lh li lj jz ol ka ll kc om kd ln kf on kg lp lq bi translated">如何使用Node.js <code class="fe mt mu mv mw b">stream</code>并从MySQL导出数据</h1><blockquote class="nw"><p id="c671" class="nx ny it bd nz oa ob oc od oe of mm dk translated"><em class="oo">首先，为什么要用node . js</em><a class="ae ky" href="https://nodejs.org/api/stream.html" rel="noopener ugc nofollow" target="_blank"><em class="oo">stream</em></a><em class="oo">？</em></p></blockquote><p id="3919" class="pw-post-body-paragraph lr ls it lt b lu og ju lw lx oh jx lz ma oi mc md me oj mg mh mi ok mk ml mm im bi translated">如果你的数据集超过了你的内存，那么你应该像我们在<strong class="lt iu">步骤1 </strong>中所做的那样分块提取数据。那<code class="fe mt mu mv mw b">stream</code>是干什么用的。<strong class="lt iu">它可以帮助你优化应用程序的内存并导出数据，而无需将所有行加载到内存中。</strong></p><blockquote class="nl nm nn"><p id="c405" class="lr ls mn lt b lu mo ju lw lx mp jx lz no mq mc md np mr mg mh nq ms mk ml mm im bi translated">如果你使用AWS Lambda或GCP云功能，这有助于节省资金，并且不会过度配置内存资源。</p></blockquote><p id="af26" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">通常，128 Mb的分配内存<strong class="lt iu">足以</strong>导出几百万行。</p><blockquote class="nl nm nn"><p id="7341" class="lr ls mn lt b lu mo ju lw lx mp jx lz no mq mc md np mr mg mh nq ms mk ml mm im bi translated"><em class="it">所以有了Node.js </em> <code class="fe mt mu mv mw b"><em class="it">stream</em></code> <em class="it">你可以更高效的把MySQL连接到你的数据仓库。</em></p></blockquote><p id="2258" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated"><strong class="lt iu">它的要旨</strong></p><p id="fc13" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">假设您想从MySQL中逐行提取数据，并在本地保存为CSV格式。以下示例适用于npm包<code class="fe mt mu mv mw b">mysql2</code>和<code class="fe mt mu mv mw b">csv-stringify</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="7cc4" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">尝试创建一个函数，并用lambda的<code class="fe mt mu mv mw b">npm run test</code>命令运行它。</p><h1 id="e4c5" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">如何用<code class="fe mt mu mv mw b">stream</code>高效地从MySQL导出数据并在本地保存为CSV</h1><p id="d5df" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">你所需要的只是一个<code class="fe mt mu mv mw b">queryDbAndSave()</code>函数。尝试将下面的<code class="fe mt mu mv mw b">async</code>示例添加到您的<code class="fe mt mu mv mw b">processEvent()</code>函数中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="11ea" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated"><strong class="lt iu">把这个加到你的</strong> <code class="fe mt mu mv mw b"><strong class="lt iu">processEvent()</strong></code> <strong class="lt iu">函数里，就像这样:</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="6517" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated"><strong class="lt iu">下一个</strong>在你的命令行运行:<code class="fe mt mu mv mw b">$ npm run test</code>。</p><blockquote class="nl nm nn"><p id="7a42" class="lr ls mn lt b lu mo ju lw lx mp jx lz no mq mc md np mr mg mh nq ms mk ml mm im bi translated"><em class="it">有想法了？酷毙了。让我们继续举更多的例子。</em></p></blockquote><h1 id="22ff" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">如何将数据从MySQL导出，并通过管道<code class="fe mt mu mv mw b">stream</code>传输到GCP的云存储或AWS S3</h1><p id="1b99" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这个例子将把你的SQL查询结果保存到<strong class="lt iu"> AWS S3 </strong>或者<strong class="lt iu"> GCP云存储</strong>中，不需要过度配置内存资源。</p><p id="eb75" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">在我的场景中，我希望将结果查询到我的<strong class="lt iu"> <em class="mn"> S3数据湖桶</em> </strong>，并将JSON转换为<a class="ae ky" href="http://ndjson.org/" rel="noopener ugc nofollow" target="_blank"> ndJSON </a>。</p><p id="2c75" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">这样，当文件在云存储中被创建时，我可以很容易地用其他的<em class="mn">服务</em> 进一步触发<strong class="lt iu"> <em class="mn">数据摄取</em> </strong>。如果你想学习如何做，请查看我的教程<strong class="lt iu">如何处理数据加载到你的数据仓库</strong>。</p><div class="op oq gp gr or os"><a rel="noopener follow" target="_blank" href="/how-to-handle-data-loading-in-bigquery-with-serverless-ingest-manager-and-node-js-4f99fba92436"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">如何使用无服务器摄取管理器和Node.js处理BigQuery中的数据加载</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">文件格式、yaml管道定义、转换和事件触发器，让您能够简单可靠地接收数据…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">towardsdatascience.com</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg ks os"/></div></div></a></div><p id="8356" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">对于<code class="fe mt mu mv mw b">stream-save</code>查询结果，您可能想要向您的<code class="fe mt mu mv mw b">queryDbAndSave()</code>函数添加一个新的<strong class="lt iu">分支</strong>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="4c91" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">此示例适用于相同的模块，但您可能也想包括这些模块:</p><ul class=""><li id="9bf4" class="mx my it lt b lu mo lx mp ma mz me na mi nb mm nc nd ne nf bi translated"><code class="fe mt mu mv mw b">npm i aws-sdk@2.1001.0</code>撰写本文时，AWS Lambda环境中使用的。检查当前环境<a class="ae ky" href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtimes.html" rel="noopener ugc nofollow" target="_blank">这里的</a>，这样您就可以简单地将其从部署工件中排除。</li><li id="2e37" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated"><code class="fe mt mu mv mw b">through2@4.0.2"</code>一个更容易构建的包装库<code class="fe mt mu mv mw b">streams</code>。</li></ul><p id="ce0e" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">所以现在如果再添加一个<strong class="lt iu"> <em class="mn"> MySQL管道</em> </strong>到你的<code class="fe mt mu mv mw b">./config.json</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><blockquote class="nl nm nn"><p id="a222" class="lr ls mn lt b lu mo ju lw lx mp jx lz no mq mc md np mr mg mh nq ms mk ml mm im bi translated"><em class="it">在你的命令行运行</em> <code class="fe mt mu mv mw b"><em class="it">$ npm run test</em></code> <em class="it">。</em></p></blockquote><blockquote class="nw"><p id="82b1" class="nx ny it bd nz oa ph pi pj pk pl mm dk translated"><em class="oo">它将从MySQL中导出数据，并以</em> <code class="fe mt mu mv mw b"><em class="oo">stream</em></code> <em class="oo">模式将其</em> <strong class="ak"> <em class="oo">保存为一个文件</em> </strong> <em class="oo">到您的云存储中。</em></p></blockquote><h1 id="c1c8" class="kz la it bd lb lc ld le lf lg lh li lj jz ol ka ll kc om kd ln kf on kg lp lq bi translated">如何将数据导出为一个<code class="fe mt mu mv mw b">stream</code>并将其分块保存到云存储中</h1><p id="46a3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您可能还想将数据<strong class="lt iu">保存在本地</strong>或保存到<strong class="lt iu"> AWS S3 </strong>中，即保存在<strong class="lt iu"> <em class="mn">批处理模式</em> </strong>中。下面的片段解释了如何做到这一点。</p><p id="67c5" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">您可能希望在<code class="fe mt mu mv mw b">./app.js</code> : <code class="fe mt mu mv mw b">const BATCH_SIZE = process.env.BATCH_SIZE || 3000;</code>的顶部声明输出文件的批量大小</p><p id="f560" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">那么您可能想要评估SQL查询的大小。您可以为此使用另一个异步函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="8acc" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">向您的<code class="fe mt mu mv mw b">queryDbAndSave()</code>函数添加另一个分支，并在每次检查是否到了结束时间时分块导出数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="7734" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated"><strong class="lt iu">最终解决方案为</strong><code class="fe mt mu mv mw b"><strong class="lt iu">./app.js</strong></code><strong class="lt iu"><code class="fe mt mu mv mw b"><strong class="lt iu">processEvent()</strong></code><strong class="lt iu">功能:</strong>别忘了运行<code class="fe mt mu mv mw b">$npm i moment</code>。<code class="fe mt mu mv mw b">./app.js</code>将使用构造文件的键来保存对象。</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h1 id="db8e" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">如何使用yaml配置</h1><p id="5129" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">最终的解决方案可以在这个<a class="ae ky" href="https://aws.amazon.com/blogs/database/capturing-data-changes-in-amazon-aurora-using-aws-lambda/" rel="noopener ugc nofollow" target="_blank">仓库</a>中找到，为你的MySQL管道使用<code class="fe mt mu mv mw b">npm config</code>和<code class="fe mt mu mv mw b">yaml</code>定义。</p><blockquote class="nl nm nn"><p id="3cd3" class="lr ls mn lt b lu mo ju lw lx mp jx lz no mq mc md np mr mg mh nq ms mk ml mm im bi translated">我更喜欢使用 <code class="fe mt mu mv mw b"><em class="it">yaml</em></code> <em class="it">只是因为当你添加那些长的SQL查询时更容易阅读。</em></p></blockquote><p id="ca1e" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">样品<code class="fe mt mu mv mw b">./config/staging.yaml</code>通常会看起来:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="0f06" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">在我看来，当你需要区分<code class="fe mt mu mv mw b">live</code>和<code class="fe mt mu mv mw b">staging</code>环境时，这也更直观。在你的命令行运行<code class="fe mt mu mv mw b">$ npm i config</code>。所以你最终的应用程序文件夹用<code class="fe mt mu mv mw b">./config/</code>代替<code class="fe mt mu mv mw b">./config.json</code>看起来会像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h1 id="155d" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">如何部署解决方案</h1><p id="670b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">有三种方法可以做到。</p><ol class=""><li id="4164" class="mx my it lt b lu mo lx mp ma mz me na mi nb mm pm nd ne nf bi translated">初学者可能会选择使用web UI，要么将解决方案部署为<strong class="lt iu"> AWS Lambda </strong>或<strong class="lt iu"> GCP云功能</strong></li><li id="d4cf" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm pm nd ne nf bi translated">更高级的用户可能想要创建一个部署shell脚本<code class="fe mt mu mv mw b">./deploy.sh</code>,如下所示。在命令行中运行<code class="fe mt mu mv mw b">$ ./deploy.sh</code>，它将部署Lambda:</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="29d0" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">3.使用Tarraform或AWS Cloudformation部署代码为的<strong class="lt iu">基础设施。方便的AWS Cloudformation模板可以在github上的这个项目的资源库中找到。</strong></p><p id="3110" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">在部署期间，确保您正确配置了所有访问<strong class="lt iu">角色</strong>和<strong class="lt iu">安全组</strong>。例如，当您的MySQL数据库在AWS中时，您的Lambda函数必须部署在同一个VPC中才能访问它。一旦你在Lambda中启用了VPC支持，你的函数就不能再访问VPC之外的任何东西，包括S3。具体到S3，你可以使用[VPC端点][15]来解决这个问题。</p><h1 id="11bf" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="5704" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这是一个简单可靠的<strong class="lt iu"> <em class="mn">数据导出</em> </strong>解决方案，允许你以低内存使用的方式从<strong class="lt iu"> MySQL数据库</strong>中提取数据。这样你就可以创建一个快速可靠的<strong class="lt iu"> <em class="mn"> MySQL数据连接器</em> </strong>并拥有一些令人敬畏的特性:</p><ul class=""><li id="881d" class="mx my it lt b lu mo lx mp ma mz me na mi nb mm nc nd ne nf bi translated">通过从命令行运行<code class="fe mt mu mv mw b">$npm run test</code>以编程方式提取MySQL数据。</li><li id="0f79" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">使用<code class="fe mt mu mv mw b">yaml</code>定义来描述你的<strong class="lt iu"> <em class="mn"> MySQL管道</em> </strong>。</li><li id="2dbb" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">执行<code class="fe mt mu mv mw b">dryRun</code>来评估SQL大小。</li><li id="06f5" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">使用<code class="fe mt mu mv mw b">Node.js streams</code>导出数据，以避免内存过度配置。</li><li id="0b37" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">在本地设备上保存数据导出。</li><li id="53aa" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">将数据作为一个文件或成块保存到<strong class="lt iu">云</strong>中。</li><li id="10c3" class="mx my it lt b lu ng lx nh ma ni me nj mi nk mm nc nd ne nf bi translated">以<strong class="lt iu">基础设施为代码的一键式部署和调度</strong></li></ul><p id="a9a4" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">查看<a class="ae ky" href="https://github.com/mshakhomirov/pipelinetools" rel="noopener ugc nofollow" target="_blank"> Github库</a>了解更多信息。</p><p id="c02d" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">一些实时集成可能会很昂贵，而且通常依赖于你拥有的数据量。想象一下，插入到MySQL中的每一行都会触发Lambda导出并插入到您的数据仓库中。有一种更好的方法来像这样监视和控制数据摄取。</p><p id="6673" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">就在几天前，我用它从MySQL中导出了5600万行。然后我将它们分块保存到AWS S3的数据湖中。例如，我有一个数据加载管理器，每次文件进入数据湖时，它都会将数据发送到我的BigQuery数据仓库。</p><div class="op oq gp gr or os"><a rel="noopener follow" target="_blank" href="/how-to-handle-data-loading-in-bigquery-with-serverless-ingest-manager-and-node-js-4f99fba92436"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">如何使用无服务器摄取管理器和Node.js处理BigQuery中的数据加载</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">文件格式、yaml管道定义、转换和事件触发器，让您能够简单可靠地接收数据…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">towardsdatascience.com</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg ks os"/></div></div></a></div><p id="8896" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">因此，导出我的MySQL数据并将其加载到我的数据仓库既快又容易。</p><h1 id="0653" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">资源</h1><p id="fece" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">[1]:<a class="ae ky" rel="noopener" target="_blank" href="/how-to-handle-data-loading-in-bigquery-with-serverless-ingest-manager-and-node-js-4f99fba92436">https://towardsdatascience . com/how-to-handle-data-loading-in-big query-with-server less-ingest-manager-and-node-js-4f 99 FBA 92436</a></p><p id="da5b" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">[2]:<a class="ae ky" href="https://dev.mysql.com/doc/refman/5.7/en/select-into.html" rel="noopener ugc nofollow" target="_blank">https://dev.mysql.com/doc/refman/5.7/en/select-into.html</a></p><p id="0a1d" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">[3]:<a class="ae ky" href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/AuroraMySQL.Integrating.SaveIntoS3.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/Amazon rds/latest/aurora user guide/aurora MySQL。Integrating.SaveIntoS3.html</a></p><p id="0ea6" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">[4]:<a class="ae ky" href="https://www.npmjs.com/package/mysql2" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/mysql2</a></p><p id="8a13" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">【5】:【https://nodejs.org/api/stream.html T2】</p><p id="e725" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">[6]:【http://ndjson.org/ T4】</p><p id="b6e3" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">[7]:<a class="ae ky" href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtimes.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/lambda/latest/DG/lambda-runtimes . html</a></p><p id="c0bd" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">[8]:<a class="ae ky" href="https://aws.amazon.com/blogs/database/capturing-data-changes-in-amazon-aurora-using-aws-lambda/" rel="noopener ugc nofollow" target="_blank">https://AWS . Amazon . com/blogs/database/captureing-data-changes-in-Amazon-aurora-using-AWS-lambda/</a></p><p id="e558" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">[9]:<a class="ae ky" href="https://stackoverflow.com/questions/12333260/export-a-mysql-table-with-hundreds-of-millions-of-records-in-chunks" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/12333260/export-a-MySQL-table-with-亿万记录分块</a></p><p id="3754" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">[10]:<a class="ae ky" href="https://stackoverflow.com/questions/1119312/mysql-export-into-outfile-csv-escaping-chars/1197023" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/1119312/MySQL-export-into-outfile-CSV-escaping-chars/1197023</a></p><p id="b02e" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">[11]:<a class="ae ky" href="https://joshuaotwell.com/select-into-outfile-examples-in-mysql/" rel="noopener ugc nofollow" target="_blank">https://joshuaotwell . com/select-into-outfile-examples-in-MySQL/</a></p><p id="10a1" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">[12]:<a class="ae ky" href="https://github.com/sidorares/node-mysql2/issues/677" rel="noopener ugc nofollow" target="_blank">https://github.com/sidorares/node-mysql2/issues/677</a></p><p id="7497" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">[13]:<a class="ae ky" href="https://aws.amazon.com/blogs/database/best-practices-for-exporting-and-importing-data-from-amazon-aurora-mysql-to-amazon-s3/" rel="noopener ugc nofollow" target="_blank">https://AWS . Amazon . com/blogs/database/best-practices-for-export-and-import-data-from-Amazon-aurora-MySQL-to-Amazon-S3/</a></p><p id="665c" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">[14]:<a class="ae ky" href="https://blog.risingstack.com/node-js-mysql-example-handling-hundred-gigabytes-of-data/" rel="noopener ugc nofollow" target="_blank">https://blog . rising stack . com/node-js-MySQL-example-handling-Bai-gigabytes-of-data/</a></p></div><div class="ab cl pn po hx pp" role="separator"><span class="pq bw bk pr ps pt"/><span class="pq bw bk pr ps pt"/><span class="pq bw bk pr ps"/></div><div class="im in io ip iq"><p id="0c87" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated"><em class="mn">原载于</em><a class="ae ky" href="https://mydataschool.com/blog/mysql-data-connector-for-your-data-warehouse/" rel="noopener ugc nofollow" target="_blank"><em class="mn">https://mydataschool.com</em></a><em class="mn">。</em></p></div></div>    
</body>
</html>