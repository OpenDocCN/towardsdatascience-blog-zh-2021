<html>
<head>
<title>Using Neo4j Graph Database to Analyze Twitter Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Neo4j图形数据库分析Twitter数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-neo4j-graph-database-to-analyze-twitter-data-6e3d38042af1?source=collection_archive---------10-----------------------#2021-04-13">https://towardsdatascience.com/using-neo4j-graph-database-to-analyze-twitter-data-6e3d38042af1?source=collection_archive---------10-----------------------#2021-04-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="415a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">收集Twitter数据，将其存储在图形数据库中，并使用图形算法进行分析。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ecf17e75809695b535740d5a43587e94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bD4a7RbcvwKOiHFTLUVRmg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。Neo4j浏览器生成的图形。推特数据收集于2021年2月19日。地点是泰国。黄色圆圈代表一条推文。靠近中心的红色圆圈代表发布推文的用户。该用户获得最高的中心性分数。蓝色圆圈代表转发。蓝色圆圈周围的红色圆圈代表发布转发的用户。</p></figure><p id="9211" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将开发一个应用程序来收集Twitter数据，并将它们存储在Neo4j图形数据库中。然后，我们将使用一些图形查询、中心性算法和社区检测算法来分析数据。在本文中，我们将讨论:</p><ul class=""><li id="eb7f" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">Neo4j图形数据库</li><li id="1847" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">Twitter数据建模</li><li id="048a" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">收集Twitter数据</li><li id="0d97" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">分析数据</li></ul><h1 id="a7c5" class="mf mg iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">Neo4j图形数据库</h1><p id="05c5" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">图形数据库是NoSQL数据存储技术之一。有一些图形数据库实现。在本文中，我们将使用Neo4j图形数据库。以下是它的优点:</p><ul class=""><li id="cd41" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">Neo4j社区版是开源和免费的。</li><li id="4016" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">易于安装和使用。</li><li id="eb78" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">数据库驱动程序有几种语言版本，包括Java和Python。</li></ul><p id="1cb5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我们的读者对Neo4j图形数据库没有任何经验，我们建议从<a class="ae nc" href="https://neo4j.com/download/" rel="noopener ugc nofollow" target="_blank">这里</a>下载Neo4j桌面。然后，看一些教程。安装之后，为Twitter数据添加一个本地数据库。</p><h1 id="2abe" class="mf mg iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">Twitter数据建模</h1><p id="e928" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">在这一部分，我们将讨论如何在图形数据库中建模Twitter对象。一般规则是:</p><ul class=""><li id="1c28" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">一个对象可以是一个节点。对象类型或类将是一个标签。</li><li id="f034" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">对象关联是一种关系。关联类型将是关系类型。</li></ul><p id="55f0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们感兴趣的Twitter对象将是图形数据库中的节点。这些是标签:</p><ul class=""><li id="daa8" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">自录音再现装置发出的高音</li><li id="769e" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">转发</li><li id="707c" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">用户</li><li id="e719" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">标签</li></ul><p id="9709" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这些对象之间的关系将是图形数据库关系。这些是关系:</p><ul class=""><li id="d07f" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">POST代表用户发布推文。</li><li id="32c5" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">RT表示用户发布了一条转发消息。</li><li id="b929" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">标签代表用户用标签来标记推文。</li><li id="c99e" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">REPLY代表对另一条推文的回复。</li><li id="bbc9" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">引用是指引用另一条推文的推文。</li><li id="a9c5" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">提及表示提及用户的推文。</li></ul><p id="e271" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下图显示了节点标签和关系类型。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/5383bfbac8244dd9df7d6994d97bc947.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qUXym4UXTQXDNcsXIm4zGQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。它是由下面的cypher命令生成的。</p></figure><p id="8f70" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们已经使用Neo4j浏览器通过使用以下命令来生成图片:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Neo4j cypher命令生成上面的模式图像</p></figure><p id="890c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们还需要在一些节点标签上创建约束，以确保我们不会创建重复的对象。每个Twitter对象都有一个唯一的id。以下是命令:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Neo4j cypher命令在节点标签上创建约束</p></figure><h1 id="7124" class="mf mg iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">收集Twitter数据</h1><p id="de51" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">在开始分析之前，我们需要收集数据。我们将构建一个Java应用程序来检索推文、转发、用户、标签和相关数据。所有这些对象都是相关的。使用图模型对它们建模是很自然的。然后，我们将它们存储在图形数据库中。</p><h2 id="ad04" class="ng mg iq bd mh nh ni dn ml nj nk dp mp le nl nm mr li nn no mt lm np nq mv nr bi translated">TweetsSavior类</h2><p id="8df0" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">下面的代码显示了TweetsSavior类。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="c56c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">“main”方法从命令行参数中获取参数。变量名是不言自明的。然后，创建TweetData对象。实例化流处理程序对象。最后，调用流处理程序对象的run方法。</p><h2 id="e2a5" class="ng mg iq bd mh nh ni dn ml nj nk dp mp le nl nm mr li nn no mt lm np nq mv nr bi translated">TweetData接口</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="d239" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个接口是应用程序和存储Twitter对象的数据库之间的抽象层。有了这一层，将来我们可以很容易地用一种类型的数据库替换另一种类型的数据库。比如用neo4j数据库替换SQL数据库。这个接口有一个重要的方法。saveTweet将处理并保存Tweet和相关对象到底层数据库。</p><h2 id="cd55" class="ng mg iq bd mh nh ni dn ml nj nk dp mp le nl nm mr li nn no mt lm np nq mv nr bi translated">TweetDataFactory类</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="ced2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们已经使用简单的工厂类创建了一个实现TweetData接口的对象。在这种情况下，工厂将实例化一个TweetGraphData类的对象。</p><h2 id="141d" class="ng mg iq bd mh nh ni dn ml nj nk dp mp le nl nm mr li nn no mt lm np nq mv nr bi translated">TweetGraphData类</h2><p id="44be" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">以下代码显示了TweetGraphData类。它是TweetData接口的一个实现，将数据存储在一个图形数据库中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="0f7e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">saveTweet方法创建一个可调用的任务，并将其提交给executor服务。当许多推文在短时间内到来时，利用executor服务是有益的。executor服务将为我们管理线程和任务队列。</p><h2 id="f689" class="ng mg iq bd mh nh ni dn ml nj nk dp mp le nl nm mr li nn no mt lm np nq mv nr bi translated">TweetGraphTask类</h2><p id="5e7f" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">这是一个可调用的任务，执行处理和保存tweet和相关对象的实际工作。代码依赖于:</p><ul class=""><li id="8861" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">不管这条微博是不是转发。</li><li id="a0a9" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">这条推文是否是对另一条推文的回复。</li><li id="bd57" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">不管它是否引用了另一条推文。</li><li id="bb0a" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">这条推文是否有标签，或者是否提到了其他用户。</li></ul><p id="b34c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">代码很长，但是很简单。它使用一些Neo4j Cypher查询来创建或更新图形节点。代码可以在<a class="ae nc" href="https://gist.github.com/mananai/dd09f514f29a78bbf239219a999ab10d" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h2 id="555b" class="ng mg iq bd mh nh ni dn ml nj nk dp mp le nl nm mr li nn no mt lm np nq mv nr bi translated">StreamHandler类</h2><p id="2626" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">下面的代码显示了收集tweet数据的StreamHandler类。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="fa3b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们有run方法作为我们的切入点，并且有主要的逻辑。它执行以下操作:</p><ul class=""><li id="50ac" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">创建一个Twitter流对象。</li><li id="94f8" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">当新的tweet到达时，它将调用Twitter流对象的onStatus方法。</li><li id="b821" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">我们的<em class="ns"> onStatus </em>调用“Tweet data<em class="ns">”</em>对象的saveTweet方法，并传递tweet对象。</li><li id="f267" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">在while循环中，它每15分钟获取一次当前的Twitter趋势。然后，它使用Twitter趋势作为我们希望从Twitter流中获得的过滤关键字。</li></ul><p id="38ef" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">回顾一下这个应用程序，下面的序列图显示了我们的关键类之间的交互。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/ab3f1e66e89a51161159bd5f68cb4904.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f0g7Ty1QsuJ_Mms8CSgJIg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片作者。序列图是由Certiv Analytics在eclipse上的序列插件生成的</p></figure><p id="a500" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们把地点定在泰国，2021年2月19日运行程序，时间是早上8点到第二天早上8点。我们得到了159，276条推文，3，078，281条转发，11，047个标签和403，991个用户。注意，这些并不是所有的用户，而是当天参与活动的用户。我们的读者须知，那天有一项对政府的不信任动议。Twitter上的活动可能会比平时多一点。<br/>所以，我们收集了大量的Twitter数据。让我们看看我们能用它做什么。</p><h1 id="1047" class="mf mg iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">分析数据</h1><p id="24f3" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">我们使用Cypher语言查询Neo4j图形数据库。就像我们用SQL语言查询关系数据库一样。Cypher只是一种不同的语言，因为图形数据库有不同的体系结构。我们的读者可以在这里查阅Cypher语言文档<a class="ae nc" href="https://neo4j.com/developer/cypher/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="6c4c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将从使用一些Cypher查询来分析数据开始。然后，我们将对我们的数据应用图中心算法。它应该能够识别网络中心的用户。最后，我们将尝试一种图社区检测算法。它根据用户的交互将用户分成不同的组。</p><h2 id="86e7" class="ng mg iq bd mh nh ni dn ml nj nk dp mp le nl nm mr li nn no mt lm np nq mv nr bi translated">追随者计数</h2><p id="33e8" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">我们想知道的一件重要事情是谁是有影响力的用户。这很简单，因为我们已经有了这样的属性。每个用户节点都有一些属性。“关注者计数”告诉用户有多少关注者。我们使用下面的查询来查找按关注者数量排序的前10名用户。下面显示了Cypher查询和结果。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="e6e6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们稍微讨论一下Cypher查询。</p><ul class=""><li id="b7cc" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">第一行是匹配子句。这意味着我们需要带有用户标签的节点。</li><li id="f278" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第二行是where子句。这意味着我们需要具有特定属性的节点。</li><li id="2002" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第三行是where子句的一部分。这意味着我们只需要关注者少于3，700，000的用户，因为关注者更多的用户可能是非本地用户。</li><li id="c491" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第四行是return子句。它告诉我们需要什么属性作为回报。</li><li id="3bbe" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">最后一行告诉数据库按照追随者计数降序排列结果，并只返回特定数量的行。</li></ul><p id="f1e9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，我们在数据库中找出最有影响力的用户。这些用户拥有数百万粉丝。</p><p id="237b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来我们想知道的是关注者计数的分布。我们认为很少用户有很多追随者。大多数用户只有几个追随者。让我们看看是真是假。因此，我们将绘制追随者计数直方图。我们将使用JFreechart库编写一个Java代码来绘制图表。Java源文件如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="247f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是结果直方图:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/60a03af368675e14c453be38937081bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EAF5hp3Ps86eair0TReUjw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="d9b3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在图表中，我们将最大关注人数限制为400，000。此外，我们需要在频率轴上使用对数标度，以使图形看起来更好。否则，我们将只能看到第一个条形。第一个箱的频率比其余箱的频率大得多。(第一个箱频率是400，577。第二箱频率是1，207。)</p><p id="2720" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从图表来看，很明显大多数用户只有几个追随者。很少有人有很多追随者。</p><p id="6c27" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们将计算追随者计数的百分位数。在我们继续之前，我们需要安装APOC库。详情请看这篇<a class="ae nc" href="https://medium.com/neo4j/explore-new-worlds-adding-plugins-to-neo4j-26e6a8e5d37e" rel="noopener">文章</a>。</p><p id="a9b7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">密码查询和结果如下。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="b02b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下是百分位值:</p><ul class=""><li id="8257" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">50%的用户关注者少于60人。</li><li id="b7ec" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">75%的用户拥有不到200名关注者。</li><li id="f575" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">90%的用户拥有不到536个关注者。</li><li id="ea25" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">99%的用户拥有不到6，222名关注者。</li></ul><p id="f4cc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有趣的是，平均关注人数是1374人。然而，90%的人只有不到536个追随者。平均值没有意义，因为跟随者计数分布不是正态分布。它严重倾斜。</p><h2 id="23e5" class="ng mg iq bd mh nh ni dn ml nj nk dp mp le nl nm mr li nn no mt lm np nq mv nr bi translated">热门标签</h2><p id="9a38" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">接下来，我们将确定热门标签。我们使用下面的查询来完成。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="e0c1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个查询比前一个稍微复杂一点。</p><ul class=""><li id="f017" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">第一行是匹配模式。这里，我们希望匹配标签、推文或转发以及用户。</li><li id="4137" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第二行是where子句。这意味着模式中的变量t要么是tweet，要么是retweet。</li><li id="7a37" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第三条和第四条是退货条款。它告诉数据库返回hashtag文本、tweet和retweet计数、用户计数和每个用户的tweet计数。</li><li id="3c07" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">在最后一行，我们按照tweet计数降序排列结果。然后，取特定数量的顶行。</li></ul><p id="8778" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们将制作热门标签的图表。我们将使用Cypher query和一些Java代码来实现它。这里的代码是<a class="ae nc" href="https://gist.github.com/mananai/726496f330ab4e4971665814bb5a305b" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/9df69dbc1d81909e87c65fd5416b03d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ahFCCfQxL9DnSgEV4bwKA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="ae49" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从结果中，我们注意到以下情况:</p><ul class=""><li id="e1bb" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">热门标签是政治、流行歌手/偶像或电视节目。</li><li id="047a" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">我们有每个用户的推文。它显示了用户平均产生多少条推文和转发。我们注意到，对于一些标签，每个用户的tweets很高。看起来这些用户做得很好，让他们的标签在Twitter上流行起来。</li><li id="574a" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">从我们的数据来看，每个用户发布超过十条推文的标签是流行歌手/偶像。</li></ul><h2 id="cf7d" class="ng mg iq bd mh nh ni dn ml nj nk dp mp le nl nm mr li nn no mt lm np nq mv nr bi translated">按时间推文量</h2><p id="fab1" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">这种分析是为了观察推文量在一天中的变化。高峰期是什么时候？对于每个Tweet或Retweet节点，都有一个存储创建日期时间的createdAt属性。我们需要将其转换为Cypher可以理解的类型，然后将其分解为年、月、日和小时。然后，计算每小时的推文和转发次数。<br/>下面是要做的查询任务。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><ul class=""><li id="ee21" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">第一行是匹配节点。</li><li id="8826" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第二行是WHERE子句，指定每个节点必须是tweet或retweet。</li><li id="764f" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第三行是WITH子句。我们调整时区，然后将时间戳转换为日期时间类型。</li><li id="cbf9" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第四行是另一个WITH子句。它将日期时间值分解为年、月、日和小时。</li><li id="4150" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第5行和第6行计算tweet和retweet节点。我们使用case-when语句来区分tweets和retweets。</li><li id="8a82" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第7和第8个是WHERE子句。它只包括特定年份、月份、日期范围和时间的推文或转发。</li><li id="a8ba" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第9行是退货条款。它返回年、月、日、小时、tweet计数和retweet计数。</li><li id="05b6" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">最后一行是排序结果。</li></ul><p id="6a00" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们使用查询结果来绘制tweet音量。这里是<a class="ae nc" href="https://gist.github.com/mananai/62b959ba9bff4281e86ff2e29b3366d8" rel="noopener ugc nofollow" target="_blank">代码</a>。图表如下。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/1a2bad16c9de9a957f9616c1b87e7138.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MYYTh4QAt2ueQ0-a6TNT_g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="1959" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下是我们的观察结果:</p><ul class=""><li id="ac9a" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">正如所料，转发量远远高于推文量。</li><li id="4d2e" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">转发量在13:00–23:00左右达到峰值并趋于平缓。</li><li id="c7b8" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">推文音量在18:00-22:00左右达到峰值并趋于平缓。</li><li id="150b" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">午夜后交易量减少，6点左右又回升。</li></ul><h2 id="0dfb" class="ng mg iq bd mh nh ni dn ml nj nk dp mp le nl nm mr li nn no mt lm np nq mv nr bi translated">安装图形数据科学库</h2><p id="e799" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">我们稍后将使用的中心性和社区检测算法是图形数据科学库的一部分。我们需要将它安装在图形数据库中。详情请看这篇<a class="ae nc" href="https://medium.com/neo4j/explore-new-worlds-adding-plugins-to-neo4j-26e6a8e5d37e" rel="noopener">文章</a>。</p><h2 id="1585" class="ng mg iq bd mh nh ni dn ml nj nk dp mp le nl nm mr li nn no mt lm np nq mv nr bi translated">用户投影</h2><p id="a96d" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">在我们继续之前，我们需要建立一个用户预测。这是一个内存中的图表，显示了一个用户如何连接到另一个用户。图形算法稍后会在上面运行。</p><p id="c6f8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们确定了三种类型的用户连接:</p><ul class=""><li id="0afd" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">用户转发、引用或回复推文。另一个用户发布了这条推文。</li><li id="5211" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">用户发布转发、引用或回复推文。那条推文提到了另一个用户。</li><li id="89e2" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">一个用户发布了一条提到另一个用户的推文。</li></ul><p id="3401" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下是创建投影图的命令。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><ul class=""><li id="708d" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">第一行是对图形数据科学库中的过程的调用。</li><li id="0d2a" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第二行是图形投影名称。我们稍后会提到它。</li><li id="6763" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第3行指定了要包含在投影中的节点。我们取所有用户节点。</li><li id="95c2" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第4-11行定义了图表中包含的关系。有三种结合在一起的关系类型。</li><li id="b5fd" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">最后一行是选项。</li></ul><h2 id="7f24" class="ng mg iq bd mh nh ni dn ml nj nk dp mp le nl nm mr li nn no mt lm np nq mv nr bi translated">中心</h2><p id="d970" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">我们将使用中心算法来识别位于网络中心的用户。有一些算法可用。我们决定使用PageRank算法。该算法根据传入关系的数量来衡量每个节点的重要性。它还考虑了源节点的重要性。<br/>我们使用下面的命令来运行PageRank算法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><ul class=""><li id="0e89" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">第一行是对图形数据科学库中算法的调用。它还指定了算法将运行的投影。这是我们之前创建的投影。</li><li id="e4f9" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第二行存储从算法到变量的输出。</li><li id="c3ed" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第三和第四个指定返回值。</li><li id="4d1b" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第5个告诉数据库按照PageRank分数对结果进行排序，只返回前10个用户。</li></ul><p id="8756" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">根据中心性结果，以下是我们的观察结果:</p><ul class=""><li id="f50c" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">和热门标签结果一样，最高分属于政治人物、新闻机构和流行偶像。</li><li id="28cc" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">最高PageRank分数的用户是MP。他在当天的不信任案中进行了辩论。</li><li id="c68f" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">名单中十个有七个来自反对党。</li><li id="66be" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">列表中的用户具有较高的追随者计数。但没那么高。一个拥有不到10k的用户仍然进入了我们的十大名单。所以，要看当天的活动。</li></ul><h2 id="11f3" class="ng mg iq bd mh nh ni dn ml nj nk dp mp le nl nm mr li nn no mt lm np nq mv nr bi translated">社区检测</h2><p id="41f5" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">社区检测算法评估节点是如何聚集或划分的。这个库有一些算法可以使用。我们决定使用卢万算法。下面是Cypher查询和结果。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><ul class=""><li id="0a53" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">第一行是对库中Louvain算法的调用。投影名称是一个参数。</li><li id="b5d6" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第二行说明了输出、节点id和社区id。</li><li id="d2f2" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第三行使用WITH子句计算社区大小并将结果存储在变量中。</li><li id="f0bb" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第四行是WHERE子句。我们只想要拥有超过1000名用户的社区。</li><li id="32a4" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第五行是返回子句。我们返回社区id和社区大小。注意，社区id只是一个数字，没有任何意义。</li><li id="429a" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">在最后一行，我们按照大小降序排列社区。</li></ul><p id="84fe" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，我们确定了几十个社区，但我们对每个社区一无所知。我们可以做进一步的分析，看看每个社区都在发什么话题。下面的Cypher查询可以做到这一点。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><ul class=""><li id="dbc6" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">第1-5行调用Louvain算法。它做的事情与前面的查询相同。</li><li id="60de" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第6-9行是查询的另一部分。它会识别每个社区的标签或被提及的用户。</li><li id="cc3c" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第10-13个提取标签或屏幕名称</li><li id="862e" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">第14列指定了我们想要的结果列。我们也只返回每个社区的前5个标签或提到的昵称。</li><li id="76d2" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">在最后一行，我们按照大小降序排列社区。</li></ul><p id="63bf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们讨论一下结果。</p><ul class=""><li id="d3c1" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">最大的社区拥有230，000+用户。其中三家拥有超过10，000名用户。</li><li id="4096" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">每个社区讨论政治、流行偶像或电视节目。</li><li id="9009" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">政治是那天的热门话题。一些社区的用户除了偶像标签之外还讨论政治。</li></ul><h1 id="0c57" class="mf mg iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">图形数据库的利弊</h1><p id="3102" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">在使用Neo4j图表数据库进行Twitter分析后，我们发现了这些优点和缺点。</p><h2 id="ca55" class="ng mg iq bd mh nh ni dn ml nj nk dp mp le nl nm mr li nn no mt lm np nq mv nr bi translated">优点:</h2><ul class=""><li id="7f5d" class="lr ls iq kx b ky mx lb my le nv li nw lm nx lq lw lx ly lz bi translated">Cypher query比SQL query可读性更强、更紧凑，尤其是在有关系的情况下。</li><li id="84cb" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">Neo4j图形数据库有一些图形算法可供使用。</li></ul><h2 id="dd14" class="ng mg iq bd mh nh ni dn ml nj nk dp mp le nl nm mr li nn no mt lm np nq mv nr bi translated">缺点:</h2><ul class=""><li id="3021" class="lr ls iq kx b ky mx lb my le nv li nw lm nx lq lw lx ly lz bi translated">Neo4j数据库是一个比较新的产品。可用的工具不多。</li></ul><p id="d641" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从性能上来说，已经够快了。凭借300多万个节点和600多万个关系，我们可以在我们老化的MacBook Pro 2014年中期模型上在几秒钟内运行大多数查询。</p><h1 id="079c" class="mf mg iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">结论</h1><p id="3c28" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">在本文中，我们讨论开发一个Java应用程序来收集Twitter数据。然后，存储到Neo4j图形数据库中。我们以几种不同的方式分析数据:</p><ul class=""><li id="6979" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">我们用追随者数量的最高值来识别用户。绘制跟踪计数直方图。</li><li id="73ab" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">我们确定热门标签。</li><li id="f668" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">我们想象推特的流量在一天中是如何变化的。</li><li id="e00c" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">我们找出位于网络中心的顶级用户。</li><li id="9af4" class="lr ls iq kx b ky ma lb mb le mc li md lm me lq lw lx ly lz bi translated">最后，我们根据用户的活动将他们划分到社区中。</li></ul><p id="e872" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是我们分析数据的几个样本。我们可以做得更多。在图形数据科学库中，我们还没有研究的其他算法是可用的。我们希望我们的读者了解我们可以用图形数据库做什么。</p></div></div>    
</body>
</html>