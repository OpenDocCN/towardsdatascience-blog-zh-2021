<html>
<head>
<title>Smoothing Splines in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R中的平滑样条</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/smoothing-splines-in-r-and-python-f6b50d4a7f59?source=collection_archive---------17-----------------------#2021-10-14">https://towardsdatascience.com/smoothing-splines-in-r-and-python-f6b50d4a7f59?source=collection_archive---------17-----------------------#2021-10-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="e46b" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">线性模型的扩展</h2><div class=""/><div class=""><h2 id="306c" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">这篇文章讨论了关于平滑样条的基础知识和r。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/eb1aaa12483b820663b719677e95d8fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zq2WKJEuTapXjV0I"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">安娜斯塔西娅·马莱在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="8c09" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi me translated"><span class="l mf mg mh bm mi mj mk ml mm di"> O </span>关于<a class="ae lh" rel="noopener" target="_blank" href="/regression-splines-in-r-and-python-cfba3e628bcd">有很多方法可以解决这个问题，但是有一个捷径可以避免在建模中考虑这些问题。这是<strong class="lk jd">平滑样条</strong>。</a></p><h2 id="b824" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">平滑样条的概念</h2><p id="c1e6" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">平滑样条曲线将<strong class="lk jd"> <em class="nk"> X </em> </strong>的每个唯一值作为一个结，而不是请求一系列预先选择的结。等等！是不是意味着它最多给原模型增加了<em class="nk"> N </em> ( <em class="nk"> N </em> =观察次数)额外的自由度？是不是太合身了？</p><p id="595b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">不要惊慌。为了解决过度拟合问题，平滑样条在其<strong class="lk jd"> <em class="nk">损失函数</em> </strong>中引入了<strong class="lk jd"> <em class="nk">惩罚项</em> </strong>。惩罚项鼓励更平滑的线并惩罚变化。</p><p id="9bb9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">具体地，平滑样条的损失函数等于残差平方和(<strong class="lk jd"> <em class="nk"> RSS </em> </strong>)和平滑项的和，</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nl"><img src="../Images/483510e0f0cf16de1bbe68fada4b3066.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yidvRpymXSo3e-L4UuUcUA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">光滑样条的损失函数。(图片来自James，Gareth等人《统计学习导论》。第112卷。纽约:施普林格，2013年。)</p></figure><p id="978f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">其中g是模型函数，λ是非负调谐参数，g′′是二阶导数的平方。</p><p id="1aff" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以看到上面损失函数中的第一项简单来说就是<strong class="lk jd"> <em class="nk"> RSS </em> </strong>。第二项，即<strong class="lk jd"> <em class="nk">惩罚项</em> </strong>，鼓励更平滑的拟合。为什么二阶导数的和与拟合的平滑度相关联？</p><p id="7c92" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">众所周知，点<em class="nk"> A </em>的一阶导数测量了函数在<em class="nk"> A </em>的斜率。并且在<em class="nk"> A </em>处的二阶导数测量在<em class="nk"> A </em>处的斜率变化。然后，我们再次查看损失函数方程，我们可以很容易地理解，一个更摆动的曲线将导致一个更大的平滑项。因为我们的目标是最小化整个损失函数，所以我们更喜欢较小的平滑项，这对应于更平滑的线。很简单，不是吗？</p><p id="1b59" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这个平滑样条的想法让你想起什么了吗？是的，我肯定你还记得<a class="ae lh" rel="noopener" target="_blank" href="/a-practical-suggestion-in-linear-regression-cb639fd5ccdb"> <strong class="lk jd"> <em class="nk">岭</em> </strong>或<strong class="lk jd"> <em class="nk">套索</em> </strong>回归</a>在损失函数中使用惩罚项来缩小线性模型的系数。类似于<strong class="lk jd"> <em class="nk">脊</em> </strong>或<strong class="lk jd"> <em class="nk">套索</em> </strong>回归，光滑样条的损失函数既有“<strong class="lk jd">偏差</strong>项，也有“<strong class="lk jd">方差</strong>项。RSS测量模型的偏差，平滑项测量模型的方差。</p><p id="9907" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">看到了吗？在统计建模中，偏差-方差权衡无处不在。我们想要的只是在它们之间找到一个平衡点，最好地“描述”真实的数据。</p><h2 id="f646" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">平滑样条曲线中的参数调整</h2><p id="bc03" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">您可能已经注意到，通过平滑样条曲线中的这些设置，平滑参数<strong class="lk jd"> λ </strong>在平衡偏差和方差方面起着非常重要的作用。</p><p id="af70" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果<strong class="lk jd"> λ </strong>超级巨大，那么它对拟合函数的粗糙程度惩罚很大，那么这个模型就是一条直线，因为一条直线的二阶导数为零。</p><p id="9d62" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果<strong class="lk jd"> λ </strong>为0，则完全不惩罚粗糙度，那么模型是完美的过拟合，并且跟随每个训练点。</p><p id="9010" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一种更直接的方式来可视化大λ<strong class="lk jd">对小λ </strong>的<strong class="lk jd">，</strong></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nm"><img src="../Images/e05e409e885864149ed25f65ba7a19d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r491GpdAEHeRdRhH7lQULg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图示了更大和更小的λ(图片来自<a class="ae lh" href="https://stats.stackexchange.com/questions/41369/optimal-choice-of-smooth-spline-parameter" rel="noopener ugc nofollow" target="_blank">https://stats . stack exchange . com/questions/41369/optimal-choice-of-smooth-spline-parameter</a>)</p></figure><p id="ca36" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">红色虚线表示较大的λ，蓝色/黑色曲线表示较小的λ。您可以看到曲线粗糙度的差异。</p><p id="ea04" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">即使我们避免选择节点的数量和位置，我们仍然需要<strong class="lk jd">调整平滑样条中的平滑参数</strong> λ。</p><p id="ba20" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">谢天谢地，通过<a class="ae lh" rel="noopener" target="_blank" href="/end-to-end-project-of-game-prediction-based-on-lebrons-stats-using-three-machine-learning-models-38c20f49af5f">交叉验证</a>可以简单解决。对应于最小测试集误差的λ是要使用的最终平滑参数。</p><p id="0f6e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于大多数模型来说，留一交叉验证(<em class="nk"> LOOCV </em>)听起来比k重交叉验证更耗费时间和资源，因为它需要(N - k)次额外的参数调整迭代。</p><p id="a694" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，LOOCV是平滑样条曲线中平滑参数调整的最简单方法。原因是LOOCV RSS的总和可以仅使用一个原始数据拟合所有数据来计算。这一招并不适用于所有型号。如果你对为什么会这样的理论部分感兴趣，可以参考经典著作，<a class="ae lh" href="https://web.stanford.edu/~hastie/ElemStatLearn/printings/ESLII_print12_toc.pdf" rel="noopener ugc nofollow" target="_blank"><strong class="lk jd"><em class="nk">ESL II</em></strong>T5】by</a><a class="ae lh" href="http://www-stat.stanford.edu/~hastie/" rel="noopener ugc nofollow" target="_blank">特雷弗·哈斯蒂</a>，<a class="ae lh" href="http://www-stat.stanford.edu/~tibs/" rel="noopener ugc nofollow" target="_blank">罗伯特·蒂布拉尼</a>，以及<a class="ae lh" href="http://www-stat.stanford.edu/~jhf" rel="noopener ugc nofollow" target="_blank">杰罗姆·弗里德曼</a>。</p><h2 id="3e70" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">光滑样条的实现</h2><p id="b25f" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">好了，了解了平滑样条的基本概念后，让我展示一下在<strong class="lk jd"> R </strong>中的实现。</p><p id="aea1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">幸运的是，已经有了用于平滑样条的内置函数，所以r中的标准实现非常简单。我将只展示基本实现，但是您可能需要在真实情况下专门修改代码。</p><p id="749a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在<strong class="lk jd"> <em class="nk"> R </em> </strong>中，我们将使用示例数据集<strong class="lk jd"> <em class="nk">工资</em> </strong>中的<a class="ae lh" href="https://www.statlearning.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd"> ISLR </strong> </a>。执行平滑样条的R包是<a class="ae lh" href="https://www.rdocumentation.org/packages/splines/versions/3.6.2" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd"> <em class="nk">样条</em> </strong> </a>。我们将使用<strong class="lk jd"> <em class="nk">函数smooth.spline() </em> </strong>，</p><pre class="ks kt ku kv gt nn no np nq aw nr bi"><span id="16ee" class="mn mo it no b gy ns nt l nu nv">library(splines)<br/>library(ISLR)<br/>attach(Wage)<br/>spl_mod &lt;- smooth.spline(age, wage, cv= TRUE) </span></pre><p id="2ba9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">其中<em class="nk">年龄</em>和<em class="nk">工资</em>分别表示自变量和因变量为<strong class="lk jd"> <em class="nk">年龄</em> </strong>和<strong class="lk jd"> <em class="nk">工资</em> </strong>(变量名称)。这里cv表示该函数执行交叉验证以自动选择最佳平滑参数。</p><p id="28bf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">就是这样。</p><p id="1428" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我希望这篇短文能帮助你更好地理解非线性数据建模中的样条。如果你对我关于数据和建模的文章感兴趣，请<a class="ae lh" href="https://jianan-lin.medium.com/subscribe" rel="noopener">订阅</a>我的Medium账号。谢谢大家！</p></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/c8fa8f80ed813d9101d685350c44e08e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zUKMv3DR0HGcVOCt"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">威尔·斯图尔特在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h2 id="94fb" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">参考资料:</h2><div class="od oe gp gr of og"><a href="https://stats.stackexchange.com/questions/41369/optimal-choice-of-smooth-spline-parameter" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd jd gy z fp ol fr fs om fu fw jc bi translated">光滑样条参数的最佳选择？</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">感谢您为交叉验证提供答案！请务必回答问题。提供详细信息并分享…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">stats.stackexchange.com</p></div></div><div class="op l"><div class="oq l or os ot op ou lb og"/></div></div></a></div><p id="3217" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">詹姆斯、加雷斯等人<em class="nk">统计学习导论</em>。第112卷。纽约:施普林格，2013年。</p></div></div>    
</body>
</html>