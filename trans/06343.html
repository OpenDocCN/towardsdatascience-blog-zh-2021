<html>
<head>
<title>4 Machine Learning System Architectures</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">4机器学习系统架构</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/4-machine-learning-system-architectures-e65e33481970?source=collection_archive---------24-----------------------#2021-06-07">https://towardsdatascience.com/4-machine-learning-system-architectures-e65e33481970?source=collection_archive---------24-----------------------#2021-06-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="606c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将机器学习投入生产</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b8d6708b8a7e32fa0be644007f444ac5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TRuxuv-xJ3Vcf8I4"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安德斯·吉尔登在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="e336" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我大力提倡边做边学，事实证明这可能是学习机器学习的最佳方式。如果你是一名机器学习工程师(也可能是一名数据科学家)，当一个项目在<a class="ae ky" rel="noopener" target="_blank" href="/the-machine-learning-workflow-1d168cf93dea">机器学习工作流程</a>的模型评估阶段结束时，你可能永远不会有成就感，就像你典型的Kaggle竞赛一样——不，我并不反对Kaggle，我认为它是一个提高你建模技能的伟大平台。</p><p id="be7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是将模型投入生产，这通常是大多数机器学习课程都忽略的主题。</p><div class="lv lw gp gr lx ly"><a rel="noopener follow" target="_blank" href="/the-machine-learning-workflow-1d168cf93dea"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">机器学习工作流程</h2><div class="mf l"><p class="bd b dl z fp md fr fs me fu fw dk translated">towardsdatascience.com</p></div></div><div class="mg l"><div class="mh l mi mj mk mg ml ks ly"/></div></div></a></div><blockquote class="mm mn mo"><p id="6df5" class="kz la mp lb b lc ld ju le lf lg jx lh mq lj lk ll mr ln lo lp ms lr ls lt lu im bi translated">声明:这篇文章是用机器学习模型的<a class="ae ky" href="https://www.udemy.com/course/deployment-of-machine-learning-models/" rel="noopener ugc nofollow" target="_blank">部署</a>课程(Udemy)的笔记写的</p></blockquote><h2 id="f8d1" class="mt mu it bd mv mw mx dn my mz na dp nb li nc nd ne lm nf ng nh lq ni nj nk nl bi translated">服务于ML模型的格式</h2><p id="d7ab" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">一旦训练并导出了机器学习模型，下一步就是想出一种方法来持久化该模型。例如，我们可以用<code class="fe nr ns nt nu b">pickle</code>序列化模型对象—参见下面的代码。</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="1b86" class="mt mu it nu b gy nz oa l ob oc"><strong class="nu iu">import </strong>pickle<strong class="nu iu"><br/>import</strong> pandas <strong class="nu iu">as</strong> pd<strong class="nu iu"><br/>from</strong> sklearn.metrics <strong class="nu iu">import</strong> accuracy_score <br/><strong class="nu iu">from</strong> sklearn.datasets <strong class="nu iu">import</strong> load_breast_cancer<br/><strong class="nu iu">from</strong> sklearn.linear_model <strong class="nu iu">import</strong> LogisticRegression  <br/><strong class="nu iu">from</strong> sklearn.model_selection <strong class="nu iu">import</strong> train_test_split</span><span id="4fb0" class="mt mu it nu b gy od oa l ob oc"><em class="mp"># loading the data set</em><br/>dataset = load_breast_cancer(as_frame=<strong class="nu iu">True</strong>)<br/>df = pd.DataFrame(data= dataset.data)<br/>df["target"] = dataset.target</span><span id="bab5" class="mt mu it nu b gy od oa l ob oc"><em class="mp"># Seperating to X and Y </em><br/>X = df.iloc[:, :-1]<br/>y = df.iloc[:, -1]<br/><br/><em class="mp"># splitting training and test</em><br/>X_train, X_test, y_train, y_test = train_test_split(X, y, train_size=0.75, shuffle=<strong class="nu iu">True</strong>, random_state=24)</span><span id="7294" class="mt mu it nu b gy od oa l ob oc"><em class="mp"># training logistic regression model</em><br/>lr = LogisticRegression(C=0.01)<br/>lr.fit(X_train, y_train)</span><span id="526a" class="mt mu it nu b gy od oa l ob oc"><em class="mp"># serializing the model</em> <br/>lr_dump = pickle.dumps(lr)</span><span id="f076" class="mt mu it nu b gy od oa l ob oc"><em class="mp"># making predictions with the model </em><br/>clf = pickle.loads(lr_dump)<br/>y_preds = clf.predict(X_test)</span></pre><blockquote class="mm mn mo"><p id="bf79" class="kz la mp lb b lc ld ju le lf lg jx lh mq lj lk ll mr ln lo lp ms lr ls lt lu im bi translated"><strong class="lb iu">注</strong>:当编写代码将机器学习模型投入生产时，工程师将上述代码模块化为训练和推理脚本，以遵守软件工程最佳实践。</p><p id="4b3e" class="kz la mp lb b lc ld ju le lf lg jx lh mq lj lk ll mr ln lo lp ms lr ls lt lu im bi translated">训练脚本的结尾由模型被转储到pickle文件的点来定义，而推理脚本在模型被加载以对新实例进行预测后开始。</p></blockquote><p id="191b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为模型提供服务的其他方法包括:</p><ul class=""><li id="5136" class="oe of it lb b lc ld lf lg li og lm oh lq oi lu oj ok ol om bi translated"><strong class="lb iu"> MLFlow </strong> — MLFlow提供了一种通用的序列化格式，可与python中的各种机器学习框架集成</li><li id="ff86" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated">与语言无关的交换格式(即ONNX、PFA和PMML)</li></ul><p id="2190" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">知道我们有其他选择总是好的，因为流行的<code class="fe nr ns nt nu b">pickle</code>(或<code class="fe nr ns nt nu b">joblib</code>)格式有一些缺点。</p><h2 id="f986" class="mt mu it bd mv mw mx dn my mz na dp nb li nc nd ne lm nf ng nh lq ni nj nk nl bi translated">应用中嵌入的第一型号</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/cfb4e326543b8eaa9807867bc95df131.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*V5aaAMtIZmlryZZJSBZFVw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">嵌入式架构示例；作者图片</p></figure><ul class=""><li id="22e2" class="oe of it lb b lc ld lf lg li og lm oh lq oi lu oj ok ol om bi translated"><strong class="lb iu">预培训</strong>:是</li><li id="1672" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated"><strong class="lb iu">即时预测</strong>:是</li></ul><p id="69db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，经过训练的模型作为依赖项嵌入到应用程序中。例如，我们可以通过<code class="fe nr ns nt nu b">pip</code>安装将模型安装到应用程序中，或者可以在构建时将经过训练的模型从文件存储(即AWS S3)拉入应用程序中。</p><p id="2f6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种情况的一个例子是，如果我们有一个用来预测属性值的flask应用程序。我们的Flask应用程序将提供一个HTML页面，我们可以使用该页面作为一个界面来收集用户想要了解其估计价值的房产信息。Flask应用程序将这些细节作为输入，将它们转发给模型进行预测，然后将它们返回给客户端。</p><p id="38d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的例子中，预测将被返回到用户的浏览器，但是，我们可以改变这种方法，将模型嵌入到移动设备中。</p><p id="9e82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种方法比其他方法简单得多，但是需要权衡简单性和灵活性。例如，要进行模型更新，整个应用程序必须重新部署(在移动设备上，需要发布新版本)。</p><h2 id="d98d" class="mt mu it bd mv mw mx dn my mz na dp nb li nc nd ne lm nf ng nh lq ni nj nk nl bi translated">#2专用模型API</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/923d52a6c2f386a51cb91c5855fa40f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NrzDR1kwpdy1nND7L3DX6w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">示例专用ML模型API</p></figure><ul class=""><li id="4814" class="oe of it lb b lc ld lf lg li og lm oh lq oi lu oj ok ol om bi translated"><strong class="lb iu">预训练</strong>:是</li><li id="5013" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated"><strong class="lb iu">即时预测:</strong>是的</li></ul><p id="b31a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种架构中，经过训练的机器学习模型成为独立的机器学习API服务的依赖项。从Flask应用程序扩展到预测上面的属性值示例，当表单被提交到Flask应用程序服务器时，该服务器可能会使用REST、gRPC、SOAP或消息传递(即RabbitMQ)对专用于机器学习并专门负责返回预测的独立微服务进行另一次调用。</p><p id="076f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与嵌入式模型方法不同，这种方法在简单性和灵活性之间做出了妥协。由于我们必须维护一个独立的服务，这种架构的复杂性增加了，但是由于模型部署现在独立于主要的应用程序部署，因此有了更多的灵活性。此外，模型微服务或主服务器可以单独扩展，以处理更大的流量或潜在地服务于其他应用。</p><h2 id="7bf3" class="mt mu it bd mv mw mx dn my mz na dp nb li nc nd ne lm nf ng nh lq ni nj nk nl bi translated">#3模型作为数据发布</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/4dd7396c9ff61222595f3126afdafd1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lq57XsYW655w7hwtWXMnkw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">流式部署示例；作者图片</p></figure><ul class=""><li id="c8f6" class="oe of it lb b lc ld lf lg li og lm oh lq oi lu oj ok ol om bi translated"><strong class="lb iu">预培训:</strong>是</li><li id="851f" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated"><strong class="lb iu">即时预测:</strong>是的</li></ul><p id="83cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种架构中，我们的培训流程将一个经过培训的模型发布到一个流式平台(即Apache Kafka ),该平台将在运行时由应用程序使用，而不是在构建时使用——有资格订阅任何模型更新。</p><p id="baf9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简单性和灵活性之间的权衡这个反复出现的主题又一次出现了。维护这个原型所需的基础设施需要更复杂的工程设计，但是ML模型可以在不需要重新部署任何应用程序的情况下进行更新——这是因为模型可以在运行时被吸收。</p><p id="f54c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了扩展我们对属性示例的预测值，应用程序将能够从指定的流服务(如Apache Kafka)的专用主题中进行消费。</p><h2 id="da57" class="mt mu it bd mv mw mx dn my mz na dp nb li nc nd ne lm nf ng nh lq ni nj nk nl bi translated">#4离线预测</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/c8d178c2f02635b67ead2a66065c1331.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uiQqBwaGQDYOJlyKk9U4Ng.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">离线架构示例；作者图片</p></figure><ul class=""><li id="1267" class="oe of it lb b lc ld lf lg li og lm oh lq oi lu oj ok ol om bi translated"><strong class="lb iu">预培训:</strong>是</li><li id="8b89" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated"><strong class="lb iu">即时预测:</strong>否</li></ul><p id="dec5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种方法是我们将要探索的唯一的异步方法。预测由应用程序或作为调度作业异步触发和运行。预测将被收集和存储—这就是应用程序通过用户界面提供预测的用途。</p><p id="c702" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">行业中的许多人已经脱离了这种架构，但在某种意义上，预测在返回给用户之前可以被检查，这要宽容得多。因此，我们降低了ML系统出错的风险，因为预测不是即时的。</p><p id="f3b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于简单性和灵活性的权衡，这个系统为了更多的灵活性而牺牲了简单性。</p><h2 id="832e" class="mt mu it bd mv mw mx dn my mz na dp nb li nc nd ne lm nf ng nh lq ni nj nk nl bi translated">包裹</h2><p id="863a" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">有时，仅仅做一些分析，构建多个模型，并对它们进行评估会变得相当无聊。如果是这样的话，那么下一步可能是学习将机器学习模型投入生产，这是你工具箱中的一项强大技能。强调一下，对于您的模型部署来说，没有所谓的“最佳”系统架构。只有满足系统需求的最佳折衷方案。</p><p id="887a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mp">感谢您的阅读！</em></p><p id="2cb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">联系我:</strong><br/><a class="ae ky" href="https://www.linkedin.com/in/kurtispykes/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a><br/><a class="ae ky" href="https://twitter.com/KurtisPykes" rel="noopener ugc nofollow" target="_blank">Twitter</a></p><p id="13e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢阅读这样的故事，并希望支持我的写作，可以考虑成为一名灵媒。每月支付5美元，你就可以无限制地阅读媒体上的故事。如果你使用<a class="ae ky" href="https://kurtispykes.medium.com/membership" rel="noopener">我的注册链接</a>，我会收到一小笔佣金。</p><p id="cb5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">已经是会员了？<a class="ae ky" href="https://kurtispykes.medium.com/subscribe" rel="noopener">订阅</a>在我发布时得到通知。</p><div class="lv lw gp gr lx ly"><a href="https://kurtispykes.medium.com/subscribe" rel="noopener follow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">每当Kurtis Pykes发表文章时都收到一封电子邮件。</h2><div class="ow l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">每当Kurtis Pykes发表文章时都收到一封电子邮件。通过注册，您将创建一个中型帐户，如果您还没有…</h3></div><div class="mf l"><p class="bd b dl z fp md fr fs me fu fw dk translated">kurtispykes.medium.com</p></div></div><div class="mg l"><div class="ox l mi mj mk mg ml ks ly"/></div></div></a></div><h2 id="e97c" class="mt mu it bd mv mw mx dn my mz na dp nb li nc nd ne lm nf ng nh lq ni nj nk nl bi translated">相关文章</h2><div class="lv lw gp gr lx ly"><a href="https://medium.datadriveninvestor.com/machine-learning-in-the-cloud-66bd25bc1a2b" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">云中的机器学习</h2><div class="ow l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">生产机器学习模型</h3></div><div class="mf l"><p class="bd b dl z fp md fr fs me fu fw dk translated">medium.datadriveninvestor.com</p></div></div><div class="mg l"><div class="oy l mi mj mk mg ml ks ly"/></div></div></a></div><div class="lv lw gp gr lx ly"><a href="https://medium.datadriveninvestor.com/machine-learning-engineers-must-read-these-5-books-583e81922b84" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">机器学习工程师必须阅读这5本书</h2><div class="ow l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">打造机器学习工程师</h3></div><div class="mf l"><p class="bd b dl z fp md fr fs me fu fw dk translated">medium.datadriveninvestor.com</p></div></div><div class="mg l"><div class="oz l mi mj mk mg ml ks ly"/></div></div></a></div><div class="lv lw gp gr lx ly"><a rel="noopener follow" target="_blank" href="/essential-skills-for-machine-learning-engineers-720938c6e12b"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">机器学习工程师的基本技能</h2><div class="mf l"><p class="bd b dl z fp md fr fs me fu fw dk translated">towardsdatascience.com</p></div></div><div class="mg l"><div class="pa l mi mj mk mg ml ks ly"/></div></div></a></div></div></div>    
</body>
</html>