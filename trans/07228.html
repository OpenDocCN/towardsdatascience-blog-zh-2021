<html>
<head>
<title>3 Methods to Create Conditional Columns with Python Pandas and Numpy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python Pandas和Numpy创建条件列的3种方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-methods-to-create-conditional-columns-with-python-pandas-and-numpy-a6cd4be9da53?source=collection_archive---------3-----------------------#2021-07-01">https://towardsdatascience.com/3-methods-to-create-conditional-columns-with-python-pandas-and-numpy-a6cd4be9da53?source=collection_archive---------3-----------------------#2021-07-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1f44" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">扩展您的数据操作和特征工程技能。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/46effea75979b9f69d05535ffcb155c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XSa4ev_Wbp9uUshC3_jt6g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com/s/photos/paint?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@kellitungay?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Kelli Tungay </a>拍摄的照片</p></figure><p id="63bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python可以说是数据科学生态系统中最流行的编程语言。如此受欢迎的原因之一是用于数据科学的Python库的丰富选择。</p><p id="db26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些库为执行数据操作提供了快速、灵活和高效的方法。Pandas和Numpy是两个流行的Python库，用于数据分析和操作任务。</p><p id="6845" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基于数据集中的现有列派生新列是数据预处理中的典型任务。这也是特征工程的重要组成部分。在某些情况下，新列是根据其他列上的某些条件创建的。</p><p id="8a68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将介绍3种方法，它们可用于根据其他列的某些条件创建新列。正如我们将在示例中看到的，Pandas和Numpy为执行这项任务提供了很大的灵活性。</p><p id="9f82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从导入库和创建样本数据框开始。以下数据框包含Kaggle上墨尔本住房<a class="ae ky" href="https://www.kaggle.com/dansbecker/melbourne-housing-snapshot" rel="noopener ugc nofollow" target="_blank">数据集</a>的一部分。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="3ae4" class="ma mb it lw b gy mc md l me mf">import numpy as np<br/>import pandas as pd</span><span id="ec98" class="ma mb it lw b gy mg md l me mf">melb = pd.read_csv("/content/melb_data.csv", usecols = ["Address", "Regionname", "Type", "Rooms", "Distance", "Price"])</span><span id="e4c4" class="ma mb it lw b gy mg md l me mf">melb.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/c25641f933e5204de77302865b17df66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xHO0d6-SDMcPrfp5fOQU7g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="4d49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该数据集包含墨尔本一些房屋的特征及其价格。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="3378" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">1.熊猫在哪里起作用</h2><p id="4542" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">第一种方法是熊猫的where功能。它允许根据以下规则或标准创建新列:</p><ul class=""><li id="09db" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated">符合条件的值保持不变</li><li id="c14f" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">不符合条件的值将被替换为给定值</li></ul><p id="2232" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，我们可以基于price列创建一个新列。如果价格高于140万，则新列的值为“class1”。否则，它将采用与price列中相同的值。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="7e60" class="ma mb it lw b gy mc md l me mf">melb["new1"] = melb.Price.where(melb.Price &lt; 1400000, "class1")</span><span id="ee28" class="ma mb it lw b gy mg md l me mf">melb.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/ae78b94c3706d9410b6c79e9803dea38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TV767KA8dNcJnom24kRdgA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="fdad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">where函数的第一个参数指定条件。第二个是替换不符合条件的值的值。我们的条件是价格低于140万英镑。第一、第三和第五列不符合条件，因此新列采用这些行中的“class1”值。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="4298" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">2.Numpy where函数</h2><p id="848a" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">虽然名字相同，但熊猫和Numpy的where功能却大不相同。首先，Numpy的where函数提供了更大的灵活性。它对待特定情况的方式也与熊猫不同。</p><p id="9b32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas where函数只允许更新不满足给定条件的值。但是，Numpy的where函数允许更新满足和不满足给定条件的值。</p><p id="5525" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码块创建一个名为“new2”的列。where函数中的第一个参数指定条件。第二个参数指示用于符合条件的行的值。第三个参数是不满足给定条件的行的值。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f49c" class="ma mb it lw b gy mc md l me mf">melb["new2"] = np.where(<br/>   (melb.Rooms == 3) &amp; (melb.Price &gt; 1400000), <br/>   "class1", <br/>   "other"<br/>)</span><span id="c740" class="ma mb it lw b gy mg md l me mf">melb.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/49f614d30ab059da3b16a1b16d58d22e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8IUtaKVf4wjNOko3GZwURQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="f614" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只有截图中的第三行符合给定的条件集，因此它取值“class1”。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="c8d6" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">3.数字选择功能</h2><p id="1763" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">select函数比前两种方法更强大。我们可以用它来给出一组条件和一组值。因此，我们能够为每个条件分配一个特定的值。</p><p id="1f7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先定义条件和相关的值。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="769a" class="ma mb it lw b gy mc md l me mf">filters = [<br/>   (melb.Rooms == 3) &amp; (melb.Price &gt; 1400000),<br/>   (melb.Rooms == 2) &amp; (melb.Price &lt; 1400000),<br/>   (melb.Price &lt; 900000)<br/>]</span><span id="b0de" class="ma mb it lw b gy mg md l me mf">values = ["class1", "class2", "class3"]</span></pre><p id="255e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果一栋房子有3个房间，其价格超过140万英镑，则新列的值为“class1”。如果一栋房子有2个房间，价格低于140万，则价值为“class2”，以此类推。类似于写一堆if-else语句。</p><p id="0934" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用select函数应用这些条件和值，如下所示:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="662e" class="ma mb it lw b gy mc md l me mf">melb["new3"] = np.select(filters, values)</span><span id="3ada" class="ma mb it lw b gy mg md l me mf">melb.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/10056c8737079022cf0101c4314a9538.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zry9NK6hzAXfAdblup6ofA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="fe16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一行和第五行不满足任何给定的条件。默认情况下，这些行的值为0。但是，可以使用默认参数对其进行更改。</p><p id="6458" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是演示默认参数用法的另一个示例。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ef46" class="ma mb it lw b gy mc md l me mf">melb["new4"] = np.select(filters, values, default="no_class")</span><span id="8a4a" class="ma mb it lw b gy mg md l me mf">melb.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/5b0c4e7e07c9f0d2f015b722f2c3f7aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6mDXjbVv6zEHbUVKLWte6Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="5285" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">结论</h2><p id="bf8d" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我们已经介绍了在数据框中有条件地创建新列的3种不同方法。根据您需要的灵活性或任务的复杂程度，您可以选择最适合自己的方法。</p><p id="18fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">永远记住，越简单越好。因此，选择简单的方法，除非你需要使用多个条件和值。</p><p id="6b7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>