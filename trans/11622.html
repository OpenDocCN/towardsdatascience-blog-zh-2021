<html>
<head>
<title>The Power of mutate( ) for Data Wrangling in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在R中mutate()处理数据争论的能力</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-power-of-mutate-for-data-wrangling-in-r-172dd2b0be73?source=collection_archive---------7-----------------------#2021-11-17">https://towardsdatascience.com/the-power-of-mutate-for-data-wrangling-in-r-172dd2b0be73?source=collection_archive---------7-----------------------#2021-11-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="79ee" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一系列代码片段，将帮助您使用R语言转换数据。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5347d13cc0e65dec59e723c98a574f40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mrymy_h_8NdLvSx2rzxN7A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">罗斯·芬登在<a class="ae ky" href="https://unsplash.com/s/photos/change?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="f1ef" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我周围看到的大部分数据角力和转换相关的帖子都在用熊猫。我，作为一个熊猫爱好者，已经写了一些。但是很高兴知道还有其他伟大的工具可以帮助你进行同样的转变。有时候这更容易，有时候没那么容易。</p><h2 id="96e1" class="mc md it bd me mf mg dn mh mi mj dp mk lp ml mm mn lt mo mp mq lx mr ms mt mu bi translated">Tidyverse</h2><p id="39e7" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">当我几年前学习R语言时，我必须导入许多库来处理数据，比如<code class="fe na nb nc nd b">dplyr</code>、<code class="fe na nb nc nd b">tidyr</code>等。现在，在tidyverse包出现后，你只需添加那行<code class="fe na nb nc nd b">library(tydiverse)</code>，你就可以很好地完成本文中显示的所有转换。</p><p id="253e" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">提醒:在R中安装库只需要<code class="fe na nb nc nd b">install.packages("lib name")</code>。</p><p id="1fbf" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">让我们开始编码吧。首先，我将创建这个简单的数据集作为我们的示例。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="c488" class="mc md it nd b gy ni nj l nk nl"># creating a dataframe<br/>df &lt;- data.frame(col1=c(1,2,3,4,5,7,6,8,9,7),<br/>                 col2=c(2,3,4,5,6,5,5,4,6,3),<br/>                 col3=c(5,7,8,9,9,3,5,3,8,9),<br/>                 col4=c(43,54,6,3,8,5,6,4,4,3))</span><span id="9bde" class="mc md it nd b gy nm nj l nk nl">     col1 col2 col3 col4<br/>1     1    2    5   43     <br/>2     2    3    7   54      <br/>3     3    4    8    6      <br/>4     4    5    9    3      <br/>5     5    6    9    8      <br/>6     7    5    3    5      <br/>7     6    5    5    6      <br/>8     8    4    3    4       <br/>9     9    6    8    4      <br/>10    7    3    9    3     </span></pre><h2 id="98e6" class="mc md it bd me mf mg dn mh mi mj dp mk lp ml mm mn lt mo mp mq lx mr ms mt mu bi translated">变异( )</h2><p id="cd34" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated"><code class="fe na nb nc nd b">mutate()</code>是一个添加新变量并保留现有变量的dplyr函数。那是<a class="ae ky" href="https://dplyr.tidyverse.org/reference/mutate.html" rel="noopener ugc nofollow" target="_blank">文档</a>说的。因此，当您想要添加新变量或更改数据集中已有的变量时，这是您的好帮手。</p><p id="828b" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">给定我们的数据集<code class="fe na nb nc nd b">df</code>，我们可以很容易地添加带有计算的列。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="7bf1" class="mc md it nd b gy ni nj l nk nl"># Add mean, std and median of columns</span><span id="ba40" class="mc md it nd b gy nm nj l nk nl">mutate(df, mean_col1 = mean(col1),<br/>       std_col2 = sd(col2), <br/>       median_col3 = median(col3))</span><span id="ad18" class="mc md it nd b gy nm nj l nk nl">     col1 col2 col3 col4 mean_col1 std_col2 median_col3<br/>1     1    2    5   43       5.2 1.337494         7.5<br/>2     2    3    7   54       5.2 1.337494         7.5<br/>3     3    4    8    6       5.2 1.337494         7.5<br/>4     4    5    9    3       5.2 1.337494         7.5<br/>5     5    6    9    8       5.2 1.337494         7.5<br/>6     7    5    3    5       5.2 1.337494         7.5<br/>7     6    5    5    6       5.2 1.337494         7.5<br/>8     8    4    3    4       5.2 1.337494         7.5<br/>9     9    6    8    4       5.2 1.337494         7.5<br/>10    7    3    9    3       5.2 1.337494         7.5</span></pre><p id="45f3" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">添加一个新变量。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="c9fe" class="mc md it nd b gy ni nj l nk nl"># Create new Variable<br/>new_var &lt;- c('a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j')</span><span id="fb65" class="mc md it nd b gy nm nj l nk nl"># Add it to the dataset<br/>mutate(df, new_var)</span></pre><p id="90cf" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">用更改的数据替换变量。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="553b" class="mc md it nd b gy ni nj l nk nl"># Change column 1 to proportions<br/>mutate(df, col1=proportions(col1)<br/>           col2 = col2*100)</span><span id="4e25" class="mc md it nd b gy nm nj l nk nl">      col1     col2 col3 col4<br/>1  0.01923077  200    5   43<br/>2  0.03846154  300    7   54<br/>3  0.05769231  400    8    6<br/>4  0.07692308  500    9    3<br/>5  0.09615385  600    9    8<br/>6  0.13461538  500    3    5<br/>7  0.11538462  500    5    6<br/>8  0.15384615  400    3    4<br/>9  0.17307692  600    8    4<br/>10 0.13461538  300    9    3</span></pre><h2 id="1c44" class="mc md it bd me mf mg dn mh mi mj dp mk lp ml mm mn lt mo mp mq lx mr ms mt mu bi translated">将mutate与其他函数结合使用</h2><p id="950d" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">Mutate可以和其他伟大的功能结合使用。让我们看几个例子。</p><h2 id="0d52" class="mc md it bd me mf mg dn mh mi mj dp mk lp ml mm mn lt mo mp mq lx mr ms mt mu bi translated">变异和重新编码</h2><p id="0226" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated"><code class="fe na nb nc nd b">recode()</code>是一种改变变量内观察值的方法。可以和<code class="fe na nb nc nd b">mutate()</code>一起使用。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="7af2" class="mc md it nd b gy ni nj l nk nl"># Change letters from 'new_var' to numbers</span><span id="0612" class="mc md it nd b gy nm nj l nk nl">mutate(df, new_var = recode(new_var,<br/>       'a' = 1, 'b' = 2, 'c' = 3, 'd' = 4, 'e' = 5,<br/>       'f' = 6, 'g' = 7, 'h' = 8, 'i' = 9, 'j' = 10)<br/>       )</span><span id="c51c" class="mc md it nd b gy nm nj l nk nl">      col1 col2 col3 col4 new_var<br/>1     1    2    5   43       1<br/>2     2    3    7   54       2<br/>3     3    4    8    6       3<br/>4     4    5    9    3       4<br/>5     5    6    9    8       5<br/>6     7    5    3    5       6<br/>7     6    5    5    6       7<br/>8     8    4    3    4       8<br/>9     9    6    8    4       9<br/>10    7    3    9    3      10</span></pre><h2 id="c437" class="mc md it bd me mf mg dn mh mi mj dp mk lp ml mm mn lt mo mp mq lx mr ms mt mu bi translated">变异和替换</h2><p id="044a" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated"><code class="fe na nb nc nd b">replace()</code>类似于recode，但是它是来自base R的一个包，您可以使用它来基于一列值或逐个地更改观察值。</p><p id="6893" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe na nb nc nd b">replace</code>函数接收变量列、要更改的<em class="nn">索引列表</em>和值列表。另一个选择是指向你想要改变的某个值和替换值。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="d02f" class="mc md it nd b gy ni nj l nk nl"># replace using index list<br/>mutate(df,<br/>       new_var = replace(new_var, c(1,2,3,4,5,6,7,8,9,10), c(1,2,3,4,5,6,7,8,9,10))<br/>       )</span><span id="9c06" class="mc md it nd b gy nm nj l nk nl"># replace using value to be changed<br/>mutate(df,<br/>       new_var = replace(new_var, new_var=='a', 1)</span></pre><h2 id="9069" class="mc md it bd me mf mg dn mh mi mj dp mk lp ml mm mn lt mo mp mq lx mr ms mt mu bi translated">变异和切割</h2><p id="7f3b" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated"><code class="fe na nb nc nd b">cut()</code>是以R为基数的函数，用于转换数值范围内的观察值，并将这些值放入箱中。</p><p id="51dc" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在下面的例子中，我使用<code class="fe na nb nc nd b">cut</code>为第1列创建两个库[ <em class="nn">从最小值到平均值和从平均值到最大值</em> ]。那么第一个容器中的每个值将收到标签“低于平均值”，而第二个容器得到“高于平均值”。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="f493" class="mc md it nd b gy ni nj l nk nl"># Labeling with cut<br/>mutate(df, col1_label_avg = cut(col1, <br/>                            c(-Inf, mean(col1), max(col1)),<br/>                            c('lower than avg', 'above the avg') <br/>                                )<br/>       )</span><span id="a4e2" class="mc md it nd b gy nm nj l nk nl">      col1 col2 col3 col4    col1_label_avg<br/>1     1    2    5   43      lower than avg<br/>2     2    3    7   54      lower than avg<br/>3     3    4    8    6      lower than avg<br/>4     4    5    9    3      lower than avg<br/>5     5    6    9    8      lower than avg<br/>6     7    5    3    5      above the avg<br/>7     6    5    5    6      above the avg<br/>8     8    4    3    4      above the avg<br/>9     9    6    8    4      above the avg<br/>10    7    3    9    3      above the avg</span></pre><h2 id="f7b7" class="mc md it bd me mf mg dn mh mi mj dp mk lp ml mm mn lt mo mp mq lx mr ms mt mu bi translated">变异和转化</h2><p id="9960" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated"><code class="fe na nb nc nd b">transmute()</code>是dplyr包中的另一个函数。它增加新的变量，同时减少其他变量。我们可以使用它来添加col1标签，并删除练习中其他不必要的列。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="8f27" class="mc md it nd b gy ni nj l nk nl">mutate(df, col1_label_avg = cut(col1, <br/>                       c(-Inf, mean(col1), max(col1)),<br/>                       c('lower than avg', 'above the avg'))<br/>) %&gt;% <br/>  transmute(col1, col1_label_avg) #drops other cols</span><span id="cbb8" class="mc md it nd b gy nm nj l nk nl">     col1   col1_label_avg<br/>1     1     lower than avg<br/>2     2     lower than avg<br/>3     3     lower than avg<br/>4     4     lower than avg<br/>5     5     lower than avg<br/>6     7     above the avg<br/>7     6     above the avg<br/>8     8     above the avg<br/>9     9     above the avg<br/>10    7     above the avg</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/5ffde9ab2cac7e5dfbd39caa728eb1aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8mfJzsTbZfR3JOLE1c_bKA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@poleznova?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> vitamina poleznova </a>在<a class="ae ky" href="https://unsplash.com/s/photos/select?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h2 id="6808" class="mc md it bd me mf mg dn mh mi mj dp mk lp ml mm mn lt mo mp mq lx mr ms mt mu bi translated">变异和选择</h2><p id="a803" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated"><code class="fe na nb nc nd b">select()</code>是dplyr中的一个函数，工作方式很像SQL语句。它选择您需要的列，并按照它们列出的顺序排列它们。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="ca31" class="mc md it nd b gy ni nj l nk nl"># Performing a transformation and selecting columns<br/>df %&gt;% <br/>  mutate( col1_pct = proportions(col1) ) %&gt;% <br/>  select (col1, col1_pct)</span></pre><p id="a965" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们可以创建一些转换，并使用select按照我们想要的方式对列进行排序。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="d381" class="mc md it nd b gy ni nj l nk nl">df %&gt;% <br/>  <strong class="nd iu"># add new column and calc proportion of col1</strong><br/>  mutate( new_var, col1_pct = proportions(col1) ) %&gt;% <br/> <strong class="nd iu"> # change values in new_var from letters to numbers, add as new col</strong><br/>  mutate( new_var_numbers = replace(new_var,  1:10, 1:10) ) %&gt;%<br/> <strong class="nd iu"> # select the transformed columns in the desired order</strong><br/>  select (col1_pct, col1, new_var_numbers, new_var,)</span><span id="271e" class="mc md it nd b gy nm nj l nk nl">    col1_pct    col1    new_var_numbers   new_var<br/>1  0.01923077    1               1         a<br/>2  0.03846154    2               2         b<br/>3  0.05769231    3               3         c<br/>4  0.07692308    4               4         d<br/>5  0.09615385    5               5         e<br/>6  0.13461538    7               6         f<br/>7  0.11538462    6               7         g<br/>8  0.15384615    8               8         h<br/>9  0.17307692    9               9         i<br/>10 0.13461538    7              10         j</span></pre><h2 id="ec3a" class="mc md it bd me mf mg dn mh mi mj dp mk lp ml mm mn lt mo mp mq lx mr ms mt mu bi translated">在你走之前</h2><p id="487a" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">你可以用<code class="fe na nb nc nd b">mutate()</code>做很多事情。这是R语言中一个强大的方法，当与其他方法结合时，它增加了可能性。</p><p id="c93c" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">通过实践并应用到您的数据探索中来利用它。将它与本帖中介绍的其他一些功能一起使用。</p><ul class=""><li id="bf1c" class="np nq it li b lj lk lm ln lp nr lt ns lx nt mb nu nv nw nx bi translated"><code class="fe na nb nc nd b">mutate()</code>:增加或改变变量。对变量进行计算。</li><li id="bf6f" class="np nq it li b lj ny lm nz lp oa lt ob lx oc mb nu nv nw nx bi translated"><code class="fe na nb nc nd b">recode()</code>:改变变量内的观察值。</li><li id="f668" class="np nq it li b lj ny lm nz lp oa lt ob lx oc mb nu nv nw nx bi translated"><code class="fe na nb nc nd b">replace()</code>:类似于recode，但是您可以使用列表来更改值。</li><li id="f08d" class="np nq it li b lj ny lm nz lp oa lt ob lx oc mb nu nv nw nx bi translated"><code class="fe na nb nc nd b">cut()</code>:将观察值放入数值范围。</li><li id="d7fb" class="np nq it li b lj ny lm nz lp oa lt ob lx oc mb nu nv nw nx bi translated"><code class="fe na nb nc nd b">transmute()</code>:添加新变量并丢弃其他未列出的变量。</li><li id="736b" class="np nq it li b lj ny lm nz lp oa lt ob lx oc mb nu nv nw nx bi translated"><code class="fe na nb nc nd b">select()</code>:用于选择或重新定位变量。</li></ul><p id="84d4" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">如果你对这些内容感兴趣，别忘了关注我。</p><div class="od oe gp gr of og"><a href="https://medium.com/gustavorsantos" rel="noopener follow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd iu gy z fp ol fr fs om fu fw is bi translated">古斯塔夫·桑托斯</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">让我们做出更好的决定。数据驱动的决策。我用Python，R，Excel，SQL创建数据科学项目。</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">medium.com</p></div></div><div class="op l"><div class="oq l or os ot op ou ks og"/></div></div></a></div></div></div>    
</body>
</html>