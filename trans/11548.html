<html>
<head>
<title>Simplify Your Functions with Functools’ Partial and Singledispatch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Functools 的部分和单一分派简化您的功能</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/simplify-your-functions-with-functools-partial-and-singledispatch-b7071f7543bb?source=collection_archive---------5-----------------------#2021-11-15">https://towardsdatascience.com/simplify-your-functions-with-functools-partial-and-singledispatch-b7071f7543bb?source=collection_archive---------5-----------------------#2021-11-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1d72" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">处理具有许多参数和数据类型的函数</h2></div><h1 id="ef56" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">动机</h1><p id="a657" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">你有没有遇到过像下面这样有很多参数的函数，</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="9e3b" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">…或者一个带有不同数据类型参数的函数？</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mi"><img src="../Images/2e3a7d58d6ddbb15e73e31f27815fcc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lFzhI4BadqxEgE1kyCjHRQ.png"/></div></div><p class="mp mq gj gh gi mr ms bd b be z dk translated">作者图片</p></figure><p id="8af6" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">在本文中，您将了解上面的函数可能出错的地方以及如何简化它们。</p><h1 id="3710" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">functools.partial</h1><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="mt mc l"/></div></figure><p id="6690" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">为了理解<code class="fe mu mv mw mx b">functools.partial</code>是如何有用的，让我们从一个例子开始。假设您有一个如下所示的数据集:</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="my mc l"/></div></figure><p id="0eca" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">您可能决定创建一个函数来获取每列中超过特定阈值的行数:</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="mz mc l"/></div></figure><p id="45d2" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">然后调用上面的函数，对每个参数使用不同的值:</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="na mc l"/></div></figure><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="nb mc l"/></div></figure><p id="83e3" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">以这种方式创建函数没有任何问题。然而，如果我们想试验不同的<code class="fe mu mv mw mx b">threshold</code>和<code class="fe mu mv mw mx b">column</code>值，<code class="fe mu mv mw mx b">df</code>就变得多余了。</p><p id="2aa4" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">有没有一种方法可以让我们用<strong class="lc iu">参数</strong> <code class="fe mu mv mw mx b"><strong class="lc iu">df</strong></code> <strong class="lc iu">固定</strong>来创建另一个类似于原始函数的函数？是的，那可以用<code class="fe mu mv mw mx b">functools.partial</code>来完成。</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="nc mc l"/></div></figure><p id="cb49" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">现在函数<code class="fe mu mv mw mx b">get_acount_above_threshold_per_col</code>只需要两个参数<code class="fe mu mv mw mx b">threshold</code>和<code class="fe mu mv mw mx b">column</code>！</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/793f5b2906909dad07fec94b7386a09d.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Az5G5N4RDKpPMYxgf_GM3A.png"/></div></figure><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="na mc l"/></div></figure><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="na mc l"/></div></figure><p id="e39f" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">相当酷！如果我们想为列<code class="fe mu mv mw mx b">magnesium</code>试验不同的阈值，我们可以再次使用方法<code class="fe mu mv mw mx b">partial</code>来进一步简化函数。</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="nc mc l"/></div></figure><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/787486e748277487ba4d252b43dd731e.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*F8ILHJREy5TD1g1XXsw-vQ.png"/></div></figure><p id="1733" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">让我们来玩玩我们的新功能。</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="na mc l"/></div></figure><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="na mc l"/></div></figure><p id="3db6" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">酷！</p><h1 id="c99c" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">functools.singledispatch</h1><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="mt mc l"/></div></figure><p id="d2dd" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">假设您的函数接受两种类型的数据，一种是字典，一种是列表。</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="mz mc l"/></div></figure><p id="4859" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">在函数中使用 if-else 语句调用另一个函数:</p><ul class=""><li id="4daa" class="nf ng it lc b ld md lg me lj nh ln ni lr nj lv nk nl nm nn bi translated">如果数据类型为 dictionary，您将调用函数<code class="fe mu mv mw mx b">process_dict</code></li><li id="8db2" class="nf ng it lc b ld no lg np lj nq ln nr lr ns lv nk nl nm nn bi translated">如果数据是列表类型，您将调用函数<code class="fe mu mv mw mx b">process_list</code></li></ul><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="nt mc l"/></div></figure><p id="c965" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">这很好，但是随着数据类型的增加，函数变得更加复杂。有没有一种方法可以不使用 if-else 语句来处理不同的数据类型<strong class="lc iu">？这时候<code class="fe mu mv mw mx b">functools.singledispatch</code>就派上用场了。</strong></p><p id="4be1" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated"><code class="fe mu mv mw mx b">singledispatch</code>将根据当前函数第一个参数的类型选择正确的函数。</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/137f96623caf42e6eff08b21c9f87e97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*tFphjycc2OOT-S6ex1Gn9w.png"/></div></figure><p id="b3a8" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">要使用<code class="fe mu mv mw mx b">singledispatch</code>，只需:</p><ul class=""><li id="4187" class="nf ng it lc b ld md lg me lj nh ln ni lr nj lv nk nl nm nn bi translated">将装饰器<code class="fe mu mv mw mx b">@singledispatch</code>添加到函数<code class="fe mu mv mw mx b">process_data</code></li><li id="6b9f" class="nf ng it lc b ld no lg np lj nq ln nr lr ns lv nk nl nm nn bi translated">将装饰者<code class="fe mu mv mw mx b">@process_data.register</code>添加到<code class="fe mu mv mw mx b">process_dict</code>和<code class="fe mu mv mw mx b">process_list</code>中。</li></ul><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nv"><img src="../Images/0097c61a6bfb99d2eba16914c387346c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bLnEiARWIsQyZmqxDkbZQg.png"/></div></div></figure><p id="d092" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">让我们试试这些新功能，看看它们是否工作正常。当第一个输入是类型<code class="fe mu mv mw mx b">dict</code>时，应该调用函数<code class="fe mu mv mw mx b">process_dict</code>。</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/6858ab0f02952db72a6e2c4d670ba280.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*QjgLjwwTeQXGrVjfouEgQA.png"/></div></figure><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="nw mc l"/></div></figure><p id="8dd5" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">当第一个输入是类型<code class="fe mu mv mw mx b">list</code>时，应该调用函数<code class="fe mu mv mw mx b">process_list</code>。</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/2b0815bddfb2f9230c7c290266663a9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*qyhAIPny-Lp0AczX_OftVg.png"/></div></figure><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="nw mc l"/></div></figure><p id="bf1f" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">当第一个输入是类型<code class="fe mu mv mw mx b">str</code>时，将调用函数<code class="fe mu mv mw mx b">process_data</code>，因为没有为该数据类型实现函数。</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/b6a86d5590ce3901a03d4fc9f42e6234.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*py55iGkhKym8ssWtcMkTwQ.png"/></div></figure><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="nx mc l"/></div></figure><p id="8ec5" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">很酷，不是吗？</p><h1 id="403d" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">结论</h1><p id="35fe" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">恭喜你！你刚刚学会了如何使用<code class="fe mu mv mw mx b">functools.partial</code>和<code class="fe mu mv mw mx b">functools.dispatch</code>来简化你的功能。我希望这篇文章能给你动力，让你当前的代码更具可读性。</p><p id="2b1f" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">随意发挥，并在这里叉这篇文章的源代码:</p><div class="ny nz gp gr oa ob"><a href="https://github.com/khuyentran1401/Data-science/blob/master/python/functools%20example.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">数据科学/func tools example . ipynb at master khuyentran 1401/数据科学</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">收集有用的数据科学主题以及代码和文章-Data-science/func tools example . ipynb at master…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">github.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op mn ob"/></div></div></a></div></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><p id="499e" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">我喜欢写一些基本的数据科学概念，并尝试不同的数据科学工具。你可以在<a class="ae ox" href="https://www.linkedin.com/in/khuyen-tran-1ab926151/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae ox" href="https://twitter.com/KhuyenTran16" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上联系我。</p><p id="8cb3" class="pw-post-body-paragraph la lb it lc b ld md ju lf lg me jx li lj mf ll lm ln mg lp lq lr mh lt lu lv im bi translated">如果你想查看我写的所有文章的代码，请点击这里。在 Medium 上关注我，了解我的最新数据科学文章，例如:</p><div class="ny nz gp gr oa ob"><a rel="noopener follow" target="_blank" href="/python-clean-code-6-best-practices-to-make-your-python-functions-more-readable-7ea4c6171d60"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">Python 干净代码:让 Python 函数更具可读性的 6 个最佳实践</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">停止编写需要 3 分钟以上才能理解的 Python 函数</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="oy l om on oo ok op mn ob"/></div></div></a></div><div class="ny nz gp gr oa ob"><a rel="noopener follow" target="_blank" href="/3-python-tricks-to-read-create-and-run-multiple-files-automatically-5221ebaad2ba"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">自动读取、创建和运行多个文件的 3 个 Python 技巧</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">用 Python 和 Bash For Loop 自动化枯燥的东西</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="oz l om on oo ok op mn ob"/></div></div></a></div><div class="ny nz gp gr oa ob"><a rel="noopener follow" target="_blank" href="/stop-using-print-to-debug-in-python-use-icecream-instead-79e17b963fcc"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">在 Python 中停止使用 Print 进行调试。用冰淇淋代替</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">你是使用打印还是日志来调试你的代码？用冰淇淋代替。</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="pa l om on oo ok op mn ob"/></div></div></a></div><div class="ny nz gp gr oa ob"><a rel="noopener follow" target="_blank" href="/simulate-real-life-events-in-python-using-simpy-e6d9152a102f"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">使用 SimPy 在 Python 中模拟真实事件</h2><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="pb l om on oo ok op mn ob"/></div></div></a></div></div></div>    
</body>
</html>