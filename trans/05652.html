<html>
<head>
<title>Serverless Machine Learning Pipelines with Vertex AI: An Introduction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于顶点人工智能的无服务器机器学习管道:介绍</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/serverless-machine-learning-pipelines-with-vertex-ai-an-introduction-30af8b53188e?source=collection_archive---------2-----------------------#2021-05-20">https://towardsdatascience.com/serverless-machine-learning-pipelines-with-vertex-ai-an-introduction-30af8b53188e?source=collection_archive---------2-----------------------#2021-05-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="401e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">谷歌终于做到了，现在梦想成真了:我们现在能够从以前的人工智能平台运行无服务器的Kubeflow管道</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ed150606b711f7cac8465d0ba026d6b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pwfyhTHcBe1TVzRV"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@mitchel3uo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">米切尔罗</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="0815" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于在小公司(或小团队)工作的数据科学家和ML工程师来说，有一个大问题:人力资源和时间的极度缺乏。正因为如此，我们能够使用甚至测试的技术范围非常有限。</p><p id="8b29" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在MLOps方面，范围是一个问题。GCP上没有任何托管的MLOps管道解决方案，采用实验管道的唯一方法是部署一个成熟的Kubeflow实例。我们可以依靠人工智能平台管道，进行半管理部署，但GKE集群保姆仍然存在问题，这需要时间(而且很无聊)。</p><p id="7256" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://cloud.google.com/vertex-ai" rel="noopener ugc nofollow" target="_blank"> Vertex AI </a>从天而降，用一种管理有序且价格合理的替代方案来解决我们的MLOps问题。Vertex AI附带了所有的AI平台经典资源，加上一个ML元数据存储，一个完全管理的功能存储和一个完全管理的Kubeflow Pipelines runner。</p><p id="4a3f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我们将讨论ML管道，Kubeflow管道，如何创建它们来满足您的自定义ML需求，以及如何在Vertex AI管道中运行它们并分析它们的结果，并附有一个小的示例代码。</p><p id="ada7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你只是为了示例代码而来，那么<a class="ae kv" href="https://github.com/piEsposito/vertex-ai-tutorials" rel="noopener ugc nofollow" target="_blank">这里</a>就是了。</p><h1 id="dbbe" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">快速回顾一下MLOps</h1><p id="e097" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如<a class="ae kv" href="https://cloud.google.com/vertex-ai/docs/pipelines/introduction" rel="noopener ugc nofollow" target="_blank">顶点AI docs </a>状态:</p><blockquote class="mp mq mr"><p id="649c" class="kw kx ms ky b kz la jr lb lc ld ju le mt lg lh li mu lk ll lm mv lo lp lq lr ij bi translated">机器学习操作(<em class="iq"> MLOps </em>)是将DevOps策略应用于机器学习(ML)系统的实践。DevOps策略让您高效地构建和发布代码变更，并监控系统以确保您满足可靠性目标。</p><p id="ccfd" class="kw kx ms ky b kz la jr lb lc ld ju le mt lg lh li mu lk ll lm mv lo lp lq lr ij bi translated">MLOps扩展了这一实践，以帮助您减少从数据接收到在生产中部署模型所花费的时间，从而让您能够监控和了解您的ML系统。</p></blockquote><p id="a7e1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">总之，MLOps是让您“组织”您的数据科学和ML领域以创建可靠系统的实践，以满足您公司的需求。</p><p id="772c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，要应用良好的MLOps实践，您需要可靠、易用的工具，以便您可以管理、监控和执行所有数据作业，从接收到建模再到监控。</p><h1 id="3348" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">管道、库伯流和顶点</h1><p id="a3d2" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">要应用MLOps，最重要的步骤之一是实验，因此我们需要一个强大的实验工具。我们希望能够跟踪我们的实验，比较它们，重现它们，并保存所有使用的结果和数据。</p><p id="4f46" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://github.com/kubeflow/pipelines" rel="noopener ugc nofollow" target="_blank"> Kubeflow管道</a>来解决这个问题。简而言之，KFP是一个致力于在Kubernetes上运行ML工作流(作为模型训练的实验)的工具包，它以一种非常聪明的方式完成它:</p><p id="09bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与其他方法一样，Kubeflow让我们将工作流定义为一系列Python函数，这些函数相互传递结果和工件。</p><p id="350b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于每个Python函数，我们可以定义依赖关系(对于所使用的库), Kubeflow将创建一个容器，以隔离的方式运行每个函数，并将任何想要的对象传递给工作流的下一步。我们可以设置所需的资源(如内存或GPU)，它将为我们的工作流步骤提供这些资源。感觉像魔术一样。</p><p id="285d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦您运行了您的管道，您将能够在一个漂亮的UI中看到它，就像这样:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/307776e1438441da4f0b9847ca18bc82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zrT9pYgWz2kpIwEewgU3qw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:作者打印，运行示例开放源代码</p></figure><p id="73f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">唯一的问题是Kubeflow管道必须部署在Kubernetes集群上。如果你在一家使用敏感数据的小公司工作，你将面临权限、VPC以及部署和使用它的许多问题，这使得它有点难以被采用</p><p id="8921" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Vertex AI通过一个托管管道运行器解决了这个问题:你可以定义一个管道，它将执行它，负责提供所有资源，存储所有你想要的工件，并通过每个想要的步骤传递它们。</p><p id="9f3f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在将看到如何使用sklearn breast_cancer_dataset定义Kubeflow管道并在Vertex AI中运行它。</p><h1 id="9bab" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">定义管道:带有玩具数据集的定制示例</h1><p id="f657" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们现在用3个简单的步骤定义一个管道，在KFP称为…</p><ol class=""><li id="f42f" class="mx my iq ky b kz la lc ld lf mz lj na ln nb lr nc nd ne nf bi translated">接收数据并分离训练和测试分割。</li><li id="aa94" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">使用步骤1中分离的列车，训练出模型。</li><li id="8ff5" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">使用步骤2中的模型和步骤1中的测试分割，评估我们的ROC曲线和混淆矩阵模型。</li></ol><p id="e894" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，让我们安装Kubeflow Pipelines SDK:</p><p id="7d33" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nl nm nn no b">pip3 install kfp --upgrade</code></p><p id="2a10" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这篇文章的Github repo中看到完整的Jupyter笔记本。我们将在这里仔细检查每个代码块，使其更容易理解。首先，一些进口:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="77f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们从<code class="fe nl nm nn no b">kfp.v2</code>导入，因为它是新的Kubeflow Pipelines SDK版本，与Vertex AI兼容。我们引入了代表“特定领域语言”的<code class="fe nl nm nn no b">dsl</code>，因为它是管道定义SDK的主要模块。</p><p id="8b49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们从<code class="fe nl nm nn no b">kfp.v2.dsl</code>导入工件、数据集、输入、模型、输出、度量和分类度量，因为它们是我们在组件之间传递对象的方式。当我们定义一个组件时，我们在参数类型上声明can state，暗示组件的输入和输出。</p><p id="00cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这样，它创建了一个具有“path”(用于在组件之间存储和重用对象)和“metadata”(用于存储对象元数据)属性的对象，还创建了一些特定于类型的方法，如ClassificationMetrics方法，用于在UI上绘制漂亮的ROC曲线。</p><p id="2a8f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看它在第一个例子中是如何工作的，这个例子是<code class="fe nl nm nn no b">get_data</code>操作符:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="5fa0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意，我们没有返回任何值，但是我们将组件的参数定义为<code class="fe nl nm nn no b">dataset_train: Output[Data]</code>。这意味着，在函数上，我们可以访问类数据集的输出对象(将在函数的使用中创建),带有路径和元数据属性。</p><p id="3e74" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这样，您可以将数据集保存在特定的路径上，并在需要时在下一个操作符上访问它。调用对象组件后，可以访问它的<code class="fe nl nm nn no b">outputs</code>属性。例如，如果你想访问<code class="fe nl nm nn no b">dataset_train</code>对象，你可以在定义完整管道时使用:<code class="fe nl nm nn no b">ds_train = get_data().outputs["dataset_train"]</code>来完成。</p><p id="6306" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还使用了<code class="fe nl nm nn no b">@component</code>装饰器，在这里我们可以定义创建能够运行我们功能的容器所需的包。</p><p id="199a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于train步骤，我们将使用我们的一个输出对象，并访问之前创建的一个对象。让我们看看这是怎么做到的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="d6e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们所要做的就是定义<code class="fe nl nm nn no b">dataset: Input[Dataset]</code>，如果我们在调用组件时传递<code class="fe nl nm nn no b">get_data().outputs["dataset_train"]</code>，它将访问<code class="fe nl nm nn no b">dataset_train</code>对象，并通过使用它的<code class="fe nl nm nn no b">path</code>属性下载它。</p><p id="bc6a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意，我们还为我们的模型定义了一些元数据:<code class="fe nl nm nn no b">train_score</code>表示模型在训练时间中的得分，它的<code class="fe nl nm nn no b">framework</code>。</p><p id="2bb5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个逻辑在我们的最后一个组件上继续:对训练数据集的模型评估:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="9d52" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在这里新做的是传递输出指标和分类指标对象。这将让我们在顶点AI UI上为ROC曲线和混淆矩阵保存模型分类指标和一些漂亮的交互图。</p><p id="5394" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完成所有工作后，我们只需创建管道并将其编译成一个json文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="ca0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，我们可以访问前面步骤的输出。我们把它编译成一个json文件，然后可以提交它在Vertex AI上运行。确保你在你的GCP项目上激活了顶点人工智能，并且你在GCP上被正确认证。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><h1 id="ce5b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">检查用户界面</h1><p id="8349" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">恭喜你。点击jupyter上的链接，您将被引导至管道运行。您会看到类似这样的内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/c3521659612fcb7076418567c3ea16bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*_vygl2wYQAdApZcg6nYN9g.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:作者。从我的GCP控制台打印。</p></figure><p id="383c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您还可以检查度量图:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/4e909cffae05e7257e7f5d47ad727f8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*eaLVJItbeQkNPIf3IvWZ6A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:作者，来自我的控制台的美丽打印</p></figure><p id="bb56" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">很漂亮，对吧？</p><h1 id="c0d6" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="9dfb" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">就是这样。有了Vertex AI，你将拥有更轻松更美好的生活，拥有所有与MLOps相关的事物。在顶点管道中还可以做更多的事情，比如使用TFx或其他顶点人工智能工具作为特征库。每一个试图举办盛宴的人都知道我在说什么。</p><p id="f917" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你确实喜欢这篇文章，在Github 上开始<a class="ae kv" href="https://github.com/piEsposito/vertex-ai-tutorials" rel="noopener ugc nofollow" target="_blank">回购，在LinkedIn上ping我，或者做任何你想做的事情。如果你有任何反馈，对帖子的修正，或者只是想谈谈，请联系我们。</a></p><p id="ff6f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我是数据科学家@ Acordo Certo，也是机器学习领域的谷歌开发者专家。我是MLOps的拥护者，对Vertex AI一见钟情。</p><p id="ef3b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是一些其他链接:</p><div class="nt nu gp gr nv nw"><a href="https://github.com/piEsposito/vertex-ai-tutorials" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd ir gy z fp ob fr fs oc fu fw ip bi translated">piEsposito/vertex-ai教程</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">顶点人工智能工具教程。通过在…上创建帐户，为piEsposito/vertex-ai教程开发做出贡献</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">github.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok kp nw"/></div></div></a></div><div class="nt nu gp gr nv nw"><a href="https://github.com/piEsposito" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd ir gy z fp ob fr fs oc fu fw ip bi translated">piEsposito -概述</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">数据科学家，MLOps @ Acordo Certo。piEsposito有14个存储库。在GitHub上关注他们的代码。</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">github.com</p></div></div><div class="of l"><div class="ol l oh oi oj of ok kp nw"/></div></div></a></div><div class="nt nu gp gr nv nw"><a href="https://www.linkedin.com/in/piesposito/" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd ir gy z fp ob fr fs oc fu fw ip bi translated">Piero (Pi) Esposito -数据科学家，MLOps - Acordo Certo | LinkedIn</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">我是Pi，数据科学家@ Acordo Certo，前深度学习工程实习生@ Intel。以…为背景</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">www.linkedin.com</p></div></div><div class="of l"><div class="om l oh oi oj of ok kp nw"/></div></div></a></div></div></div>    
</body>
</html>