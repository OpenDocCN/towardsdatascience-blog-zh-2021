<html>
<head>
<title>Model Tree: handle Data Shifts mixing Linear Model and Decision Tree</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模型树:处理混合线性模型和决策树的数据转移</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/model-tree-handle-data-shifts-mixing-linear-model-and-decision-tree-facfd642e42b?source=collection_archive---------34-----------------------#2021-05-17">https://towardsdatascience.com/model-tree-handle-data-shifts-mixing-linear-model-and-decision-tree-facfd642e42b?source=collection_archive---------34-----------------------#2021-05-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e9e4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">模拟和建模特征和标签偏移</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2b0def3f3c021e45fedd6f6a50ca5a93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VxIlmWken0dus-Ec"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">康纳·乐迪在Unsplash<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">拍摄的照片</a></p></figure><p id="6e91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有训练出来的模型都容易变得陈旧无用。众所周知，一段时间后，所有的模型都不再准确。这是正常的，并且是由于数据流中可能发生的时间偏移。特别是，大多数涉及人类活动建模的应用程序都必须被监控并不断更新。例如，一些需求或市场趋势的变化可能会影响客户的购买力。如果我们不能考虑客户习惯的变化，随着时间的推移，我们的预测就会变得不可信。</p><p id="b285" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">给定一个监督训练的模型，我们可能会遇到两种相反的情况，影响未来的表现。<strong class="lb iu">特征分布的变化或目标分布的变化</strong>。特征分布的变化是有害的，因为我们的模型对以前看不到的数据进行预测。相反，标签分布的变化是不好的，因为我们的模型被训练成接近不同的基本事实。</p><p id="14f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本帖中，<strong class="lb iu">我们做了一个实验来测试一些模型随着时间的推移经受住数据变化的能力</strong>。我们考虑线性模型、决策树和线性树。我们想看看不同的制度变化如何影响未来测试数据预测的准确性。这使我们能够详细阐述这三种算法处理不可避免的数据偏移的能力。</p><p id="3a2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">线性树，正如我在之前的文章中介绍的，是模型树的一个特例。他们在传递的数据上构建一个树，评估适合线性模型的最佳分割。拟合的模型产生基于树的结构，在叶子中具有线性模型。换句话说，它根据简单的决策规则计算对数据集进行分区的多重线性回归。每个人都可以使用<a class="ae ky" href="https://github.com/cerlymarco/linear-tree" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">线性树</strong> </a>包轻松实现线性树。它可以用作scikit-learn BaseEstimator来包装来自<code class="fe lv lw lx ly b">sklearn.linear_model</code>的每个线性估计器，并构建一个最佳树结构。</p><h1 id="bca0" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">实验设置</h1><p id="4df9" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">对于我们的实验，我们使用一些在分类环境中生成的人工数据。我们将数据集划分为一些时间块，用于训练(包括超参数搜索)和评估模型的性能。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/a40e07141191900f7709f9d3293d211d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*hfEOUjQKrodv_y9Ssyuy0A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">训练测试时间分割策略(图片由作者提供)</p></figure><p id="466b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如上一节所介绍的，我们使用三种不同的模型:线性模型、决策树和线性树。我们通过改变测试起点来估算时间的流逝。我们考虑4个测试块，在不同的日期计算每个模型类型的评估。这使我们能够跟踪模型在一段时间内的行为。</p><p id="7ebe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们提出了三种不同版本的实验:<em class="mx">无偏移</em>、<em class="mx">特征偏移</em>和<em class="mx">标签偏移</em>。</p><h1 id="7c09" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">没有轮班</h1><p id="7b2b" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">在<em class="mx">“无变化”</em>的背景下，我们假设未来会看到同样的数据分布。这是更完美也更不现实的场景。它是完美的，因为我们在相似的数据上训练和测试我们的模型，产生稳定的结果。这是不现实的，因为我们必须幸运地遇到这样的情况。我们生活在一个动态的世界中，一切都容易快速变化，破坏我们的模型性能。</p><p id="58e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，我们从这种情况出发来拟合我们感兴趣的模型。我们在选定的时间块上用超参数调谐来执行训练。对测试集的评估总结在下图中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi my"><img src="../Images/f4c69cd0462c8d9664e9b1b1f556eaae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*OKe9THFYe2ypI1D0f64tgg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">没有移位的表演(图片由作者提供)</p></figure><p id="649e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如所料，随着时间的推移，模型的精度保持不变。决策树和线性树达到相同的分数。</p><h1 id="4e31" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">特征转移</h1><p id="8967" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">在<em class="mx">“特性变化”</em>的环境中，我们可能会遇到一些特性分布随着时间的推移而变化。我们模拟两个不同时间段的两班倒。这可以简单地通过添加一些常量值来改变分布的中心位置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/712543bfdbed57583285a4b6015f8a80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nspfImd3jh7qz9_ySnLgNw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">多年来的特征分布(图片由作者提供)</p></figure><p id="334b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">预测看不见值可能会导致错误的预测。使用基于树的算法很容易成像，其中数据可能落在最未探索的分割部分。显然，在这种情况下，与<em class="mx">“无变化”</em>情况相比，我们必须预计性能会普遍下降。我们的模型没有经过处理分布变化的训练，所以我们记录的精度下降了至少10个点。我们观察到的是，关于决策树，线性树存活得更好。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/e3c8d3b1ba71f6acf0fc7799263a1c82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*wlIjlcwukg93vTD51ufbkg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">功能变化的表演(图片由作者提供)</p></figure><h1 id="8da3" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">标签移位</h1><p id="77f2" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">在<em class="mx">“标签变化”</em>环境中，我们可能会遇到目标分布随时间的变化。我们模拟这种场景，保持相同的特征生成过程，但是在两个不同的时间段中改变标签平衡。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/ec9e7a1bd41dd74110f547e79f0ca064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bmxtnnY0RgpfN5lVjxc5rA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">历年标签分布情况(图片由作者提供)</p></figure><p id="1388" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，我们使用一种算法，根据给定的标签分布进行训练，来预测具有不同标签平衡的数据。达到次优结果是正常的(特别是对于基于树的算法)，因为模型不期望特定类出现这么多。我们记录的性能随着时间的推移保持不变，但与<em class="mx">‘无变化’</em>的情况相比有所恶化。和以前一样，线性树在决策树中存活得更好。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/e426331e5cf0049a2d6ec01053b7e895.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*gHgd4uu1ac2AP4Rqwey4qw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">标签转换的表演(图片由作者提供)</p></figure><p id="19df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们所有存在移位的实验中，我们记录了线性树的良好生存行为。与标准决策树和简单线性模型相比，它们的性能下降较少。它们更好地概括的能力是线性近似和树状结构中的数据分割的联合的结果。这使得当数据落入未探索的分割区域时，线性树更加准确，这在时间数据移动的情况下尤其突出。</p><h1 id="0901" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">摘要</h1><p id="a3c1" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">在这篇文章中，我们模拟了一些时态数据移动的情况。当我们预期时间变化时，线性树被证明是测试和验证的好模型。尽管它们没有被广泛采用，但它们是非常简单而强大的预测算法，代表了经典决策树的有价值的替代品。</p></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><p id="5de1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/cerlymarco/MEDIUM_NoteBook" rel="noopener ugc nofollow" target="_blank">T3】查看我的GITHUB回购T5】</a></p><p id="459e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">保持联系:<a class="ae ky" href="https://www.linkedin.com/in/marco-cerliani-b0bba714b/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a></p></div></div>    
</body>
</html>