<html>
<head>
<title>Automatic Spectral Identification Using Deep Metric Learning with 1D RegNet and AdaCos</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用1D RegNet和AdaCos的深度度量学习进行自动光谱识别</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automatic-spectral-identification-using-deep-metric-learning-with-1d-regnet-and-adacos-8b7fb36f2d5f?source=collection_archive---------14-----------------------#2021-08-13">https://towardsdatascience.com/automatic-spectral-identification-using-deep-metric-learning-with-1d-regnet-and-adacos-8b7fb36f2d5f?source=collection_archive---------14-----------------------#2021-08-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d34b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">引入强大的深度度量学习，实现更加精确和稳定的自动光谱分析，从数据库中识别物质</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6c755a5c0c237021dea1f000444aaaa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IBcY1D_QlSisyPUIVoNPuA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@nci" rel="noopener ugc nofollow" target="_blank">国家癌症研究所</a>在<a class="ae kv" href="https://unsplash.com" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="f1f7" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">背景和动机</h1><p id="eafd" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi mk translated">像《犯罪现场调查》、《法律与秩序》和《法医档案》这样的电视节目向大众观众介绍了法医学，并生动地展示了科学证据对破案的重要性。留在现场的一小块碎片可以推翻凶手的不在场证明，从而指认凶手。基于光谱分析的物质鉴定在法医学中起着至关重要的作用。同样，材料识别过程对于制造部门和材料研究中的故障推理至关重要。<br/>光谱，如无机材料的X射线衍射(XRD)和有机材料的傅里叶变换红外光谱(FT-IR ),是鉴定成分的典型方法。独特的光谱特征，即所谓的<strong class="lq ir">“光谱指纹”</strong>，使我们能够通过将测得的光谱与数据库中的光谱进行比较来识别材料。识别准确度大致基于光谱数据库的搜索引擎算法以及从经过仔细检索的样品中获得的无噪声光谱数据的程度。然而，样品量不足或其他物质的污染可能会使光谱数据变得嘈杂，难以识别。具体来说，大多数数据库搜索算法利用输入光谱的峰值位置。然而，峰移通常发生在小样本的情况下，导致可识别性差。没有人类专家的帮助，搜索引擎结果不会成为值得信赖的分析。更鲁棒的识别算法可以使搜索结果本身成为更可靠的分析结果。因此，深度学习，一种更准确的识别机器学习模型，可能会使法医分析过程自动化。</p><blockquote class="mt"><p id="200d" class="mu mv iq bd mw mx my mz na nb nc mj dk translated">下面会解释这段代码，GitHub上也有！</p></blockquote><div class="nd ne nf ng nh ni"><a href="https://github.com/ma921/XRDidentifier" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">GitHub-ma 921/xr identifier:py torch实现从COD</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">COD数据库中XRD光谱鉴定的Pytorch实现。详细情况在我在Medium上的博客里有解释…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">github.com</p></div></div></div></a></div><h1 id="3998" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">机器学习策略</h1><p id="8c29" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">但是，我们如何利用深度学习来解决这个嘈杂的样本识别问题呢？我脑海中立即浮现的想法是<strong class="lq ir">卷积神经网络</strong>，表示为CNN，这是一个非常成功的用于对象识别的深度学习分类器。但是等等，这里有<strong class="lq ir">与平常图像分类任务的四个不同点</strong>。</p><blockquote class="nr ns nt"><p id="0fed" class="lo lp nu lq b lr nv jr lt lu nw ju lw nx ny lz ma nz oa md me ob oc mh mi mj ij bi translated">1.输入光谱不是2D张量，而是<strong class="lq ir">一维</strong>，不像图像。<br/> 2。任务的目标是<strong class="lq ir">不是分类而是识别</strong>。也就是要识别的类数超过一万，像人脸识别任务。<br/> 3。与图像噪声类型不同，独特噪声包含在原始光谱中。<br/> 4。光谱数据库由每种材料的单一光谱组成，没有任何变化或噪音样品。</p></blockquote><p id="c249" class="pw-post-body-paragraph lo lp iq lq b lr nv jr lt lu nw ju lw lx ny lz ma mb oa md me mf oc mh mi mj ij bi translated">让我们来研究一下每个问题。数字对应每个问题。</p><h2 id="f5c3" class="od kx iq bd ky oe of dn lc og oh dp lg lx oi oj li mb ok ol lk mf om on lm oo bi translated">1.1D有线电视新闻网</h2><p id="7048" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">首先，维度的差异对迁移学习有影响。在图像分类任务中，我们可以使用GitHub上发布的预训练模型，使我们能够减少我们应该准备的数据数量。幸运的是，GitHub上有几个1D-CNN模型，但没有针对spectra的预训练模型。在我尝试的这些模型中，<strong class="lq ir">1D-雷格内特</strong>效果最好。RegNet是由脸书研究人员创建的源于神经架构搜索(NAS)的最先进的CNN模型(<a class="ae kv" href="https://arxiv.org/pdf/2003.13678.pdf" rel="noopener ugc nofollow" target="_blank">论文</a>)。RegNet的原始版本仅用于2D图像。但是，多亏了佐治亚理工学院的研究人员，1D版的RegNet可以在GitHub上找到。资源库的链接在这里:<br/><a class="ae kv" href="https://github.com/hsd1503/resnet1d" rel="noopener ugc nofollow" target="_blank">https://github.com/hsd1503/resnet1d</a></p><h2 id="2df1" class="od kx iq bd ky oe of dn lc og oh dp lg lx oi oj li mb ok ol lk mf om on lm oo bi translated">2.深度度量学习</h2><p id="db4f" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">其次，我们应该把这个光谱识别问题看作<strong class="lq ir">少拍度量学习</strong>，人脸识别也是如此。一般来说，分类任务需要每个类别超过100个样本。在我们的设置中，每个类的可用光谱是1或2，这意味着少量的学习。其次，分类任务一般对待100类以下；否则，精度会降低。超过5000个类，我们通常会将问题从学习区分每个类的标准转换为学习衡量样本相似性的评估度量。这就是所谓的度量学习。这在人脸识别上非常有效，更好的是，我们所要做的度量学习就是替换损失函数。<a class="ae kv" href="https://arxiv.org/abs/1801.09414" rel="noopener ugc nofollow" target="_blank"> CosFace </a>、<a class="ae kv" href="https://arxiv.org/abs/1801.07698" rel="noopener ugc nofollow" target="_blank"> ArcFace </a>是使用CNN进行深度度量学习的开创性损失函数。如今，这些损失函数发展到了<a class="ae kv" href="https://arxiv.org/abs/1905.00292" rel="noopener ugc nofollow" target="_blank"> AdaCos </a>，自动识别CosFace的超参数，无需额外的调谐程序就能很好地工作。AdaCos实现可在此处获得:<br/><a class="ae kv" href="https://github.com/4uiiurz1/pytorch-adacos/blob/master/metrics.py" rel="noopener ugc nofollow" target="_blank">https://github . com/4 uiiurz 1/py torch-AdaCos/blob/master/metrics . py</a></p><h2 id="fb0f" class="od kx iq bd ky oe of dn lc og oh dp lg lx oi oj li mb ok ol lk mf om on lm oo bi translated">3.贝叶斯去噪预处理</h2><p id="da2a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">第三，要考虑光谱中独特噪声的去噪过程。频谱中的噪声类型可以大致分为两类:白噪声和背景噪声。背景噪音来自样品架、样品板或不充分结晶样品的信号。在<a class="ae kv" href="https://www.sciencedirect.com/science/article/abs/pii/S0169743914002032?via%3Dihub" rel="noopener ugc nofollow" target="_blank">珠</a>出现之前，移除一直由人工完成。由于贝叶斯稀疏分析的能力，我们可以用很少的超参数自动对这两种噪声类型进行去噪。资源库在这里:<br/><a class="ae kv" href="https://github.com/skotaro/pybeads" rel="noopener ugc nofollow" target="_blank">https://github.com/skotaro/pybeads</a></p><h2 id="72f6" class="od kx iq bd ky oe of dn lc og oh dp lg lx oi oj li mb ok ol lk mf om on lm oo bi translated">4.基于物理学的数据增强</h2><p id="8f7f" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">即使我们考虑少量的学习设置，每个类1或2个训练数据也是不够的。这是因为相同的材料有几种不同的光谱。变量及其原因如下:</p><blockquote class="nr ns nt"><p id="860c" class="lo lp nu lq b lr nv jr lt lu nw ju lw nx ny lz ma nz oa md me ob oc mh mi mj ij bi translated">1.<strong class="lq ir">峰值缩放</strong>；由于粉末样品中晶体取向的排列差异，导致峰值强度偏离数据库中的标准光谱<br/> 2。<strong class="lq ir">巅峰淘汰</strong>；由于实验仪器设置<br/> 3，从数据库中的标准光谱中删除一些峰。<strong class="lq ir">模式转换</strong>；由于样品中的应变或实验条件，当模式从数据库中的标准光谱向下或向上移动时。<br/> 4。<strong class="lq ir">峰值分裂</strong>；由于晶体结构紊乱，数据库中标准光谱出现新峰。</p></blockquote><p id="772c" class="pw-post-body-paragraph lo lp iq lq b lr nv jr lt lu nw ju lw lx ny lz ma mb oa md me mf oc mh mi mj ij bi translated">因此，1或2个数据无法将这些光谱变化告诉深度学习模型。因此，我们应该应用数据扩充。感谢麻省理工学院的研究人员，这里提供了1-3的数据增强代码:<br/><a class="ae kv" href="https://github.com/PV-Lab/autoXRD" rel="noopener ugc nofollow" target="_blank">https://github.com/PV-Lab/autoXRD</a></p><p id="91cc" class="pw-post-body-paragraph lo lp iq lq b lr nv jr lt lu nw ju lw lx ny lz ma mb oa md me mf oc mh mi mj ij bi translated">关于峰分裂，我们可以使用pymatgen库来创建无序晶体结构及其X射线衍射光谱。</p></div><div class="ab cl op oq hu or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="ij ik il im in"><h1 id="e9b2" class="kw kx iq bd ky kz ow lb lc ld ox lf lg jw oy jx li jz oz ka lk kc pa kd lm ln bi translated">问题设置</h1><p id="e872" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">让我们设置一个具体的问题来理解上面的策略。假设我们想鉴定未知的结晶粉末样本。我们可以测量X射线衍射(XRD)作为指纹图谱。我们只知道这个样本中一定含有锂。<br/>可通过晶体学开放数据库(COD)访问XRD光谱数据库，使用pymatgen将晶体信息文件(CIF)转换为XRD光谱。根据化学需氧量，迄今为止报告的锂化合物有8172种。检查8172个与目标样本相似的光谱对人类来说是不可行的，因此我们考虑将候选范围缩小到5个。最有可能的候选人的识别准确率不重要，但是指定的5个候选人必须包含真实材料。假设准确率应该在95%以上。因此，我们可以将这个问题公式化如下:</p><blockquote class="mt"><p id="5cc0" class="mu mv iq bd mw mx my mz na nb nc mj dk translated">使用光谱识别技术，我们如何从8，172个候选样本中识别出未知样本，并达到95%以上的前5名准确度？</p></blockquote></div><div class="ab cl op oq hu or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="ij ik il im in"><h1 id="84e0" class="kw kx iq bd ky kz ow lb lc ld ox lf lg jw oy jx li jz oz ka lk kc pa kd lm ln bi translated">代码</h1><p id="0d86" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">Python库要求:</p><ul class=""><li id="3747" class="pb pc iq lq b lr nv lu nw lx pd mb pe mf pf mj pg ph pi pj bi translated">pymatgen</li><li id="d663" class="pb pc iq lq b lr pk lu pl lx pm mb pn mf po mj pg ph pi pj bi translated">pytorch</li><li id="d98e" class="pb pc iq lq b lr pk lu pl lx pm mb pn mf po mj pg ph pi pj bi translated">sci kit-学习</li></ul><p id="dc82" class="pw-post-body-paragraph lo lp iq lq b lr nv jr lt lu nw ju lw lx ny lz ma mb oa md me mf oc mh mi mj ij bi translated">环境；Python 3.7.3，Pytorch 1.4.0，</p><h1 id="f0b7" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">数据集构建</h1><h2 id="c2e0" class="od kx iq bd ky oe of dn lc og oh dp lg lx oi oj li mb ok ol lk mf om on lm oo bi translated">从COD下载CIF</h2><p id="bcd1" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们将使用<a class="ae kv" href="http://www.crystallography.net/cod/index.php" rel="noopener ugc nofollow" target="_blank"> COD </a>来构建数据集。首先点击左侧表格中的<strong class="lq ir">访问COD数据&gt;搜索</strong>页面。之后，在“<strong class="lq ir"> 1至8元素</strong>搜索框中输入“李”，然后点击<strong class="lq ir">发送</strong>。跳转到搜索结果页面后，您将看到文本“<strong class="lq ir">结果:选择</strong>中有8172个条目”。点击“<strong class="lq ir">CIF网址列表</strong>，即可下载“<strong class="lq ir"> COD-selection.txt </strong>”。这样，您可以获得8，172个cif URLs的列表。<br/>接下来，下面的python代码将从COD中集体下载所有的cif文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pp pq l"/></div></figure><h2 id="2a14" class="od kx iq bd ky oe of dn lc og oh dp lg lx oi oj li mb ok ol lk mf om on lm oo bi translated">将CIF转换为XRD光谱</h2><p id="d87b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">第一步，您需要检查pymatgen是否能够读取cif文件。不幸的是，有些CIF文件不能被pymatgen读取。下面的<strong class="lq ir"> read_CIF </strong>模块可以将CIF解释为pymatgen可读的结构数据，保存为任意名称的pickle文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pp pq l"/></div></figure><p id="9c5a" class="pw-post-body-paragraph lo lp iq lq b lr nv jr lt lu nw ju lw lx ny lz ma mb oa md me mf oc mh mi mj ij bi translated">接下来，我们可以使用下面的<strong class="lq ir"> XRDspectra </strong>模块将pymatgen结构数据转换为XRD光谱。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pp pq l"/></div></figure><p id="580b" class="pw-post-body-paragraph lo lp iq lq b lr nv jr lt lu nw ju lw lx ny lz ma mb oa md me mf oc mh mi mj ij bi translated">因此，在按顺序运行上述代码后，我们获得一个名为<strong class="lq ir"> XRD_epoch5.pkl </strong>的XRD光谱数据库。LiTaO3等晶体名称被转换成数字int标签。在<strong class="lq ir"> material_labels.csv </strong>中总结了数字标签和人类可理解的晶体名称之间的对应关系。</p><h1 id="9d6c" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">深度度量学习模型(1D-RegNet + AdaCos)</h1><p id="2567" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">首先，从<a class="ae kv" href="https://github.com/hsd1503/resnet1d" rel="noopener ugc nofollow" target="_blank">这个库</a>下载<strong class="lq ir"> net1d.py </strong>。然后，执行以下代码来训练深度度量学习模型。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pp pq l"/></div></figure><p id="79c3" class="pw-post-body-paragraph lo lp iq lq b lr nv jr lt lu nw ju lw lx ny lz ma mb oa md me mf oc mh mi mj ij bi translated">因此，您可以使用下面的代码可视化学习曲线(<strong class="lq ir"> learning_curve.csv </strong>)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pp pq l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pr"><img src="../Images/9c1c197ecd953306c4f559a85166753e.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*Y_Jub4PAEzKww1RxY9LVlA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者创建的学习曲线</p></figure><p id="4d4c" class="pw-post-body-paragraph lo lp iq lq b lr nv jr lt lu nw ju lw lx ny lz ma mb oa md me mf oc mh mi mj ij bi translated">我们可以看到，在第100个历元时，<strong class="lq ir">验证前5名的准确度达到了</strong> <strong class="lq ir"> 97.3 </strong>，这意味着我们的目标已经达到。测试准确度是相同的(97.3)，因此与验证数据集的过度拟合无关。</p><p id="cf72" class="pw-post-body-paragraph lo lp iq lq b lr nv jr lt lu nw ju lw lx ny lz ma mb oa md me mf oc mh mi mj ij bi translated">这个代码在GitHub也有，链接<a class="ae kv" href="https://github.com/ma921/XRDidentifier" rel="noopener ugc nofollow" target="_blank">这里</a>。玩吧，就像你是法医一样！</p><blockquote class="mt"><p id="419b" class="mu mv iq bd mw mx my mz na nb nc mj dk translated">如果你喜欢这篇文章，请在Medium、GitHub和Twitter上关注我！</p><p id="4059" class="mu mv iq bd mw mx my mz na nb nc mj dk translated">推特:<a class="ae kv" href="https://twitter.com/masaki_adachi" rel="noopener ugc nofollow" target="_blank">https://twitter.com/masaki_adachi</a><br/>GitHub:<a class="ae kv" href="https://github.com/ma921" rel="noopener ugc nofollow" target="_blank">https://github.com/ma921</a></p></blockquote></div></div>    
</body>
</html>