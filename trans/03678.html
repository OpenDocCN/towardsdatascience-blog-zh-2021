<html>
<head>
<title>Build your own arcpy helper package</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建您自己的arcpy助手包</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-your-own-arcpy-helper-package-6842e2f6d339?source=collection_archive---------32-----------------------#2021-03-25">https://towardsdatascience.com/build-your-own-arcpy-helper-package-6842e2f6d339?source=collection_archive---------32-----------------------#2021-03-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b545" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">告别剪切粘贴Python</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/22255d725029bf414258f788d0eca920.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*P-g8iD6lOscMZRsX"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">沃洛季米尔·赫里先科在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="6f37" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Esri的arcpy package for Python是最全面的地理信息管理、分析和可视化工具包。</p><p id="b987" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种详尽的功能集是以代码的简洁性为代价的。看似简单的操作实现起来可能会很复杂，Esri的ArcGIS软件可能会增加学习曲线。</p><p id="884e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Pythonic的格言<em class="ls">应该有一个……显而易见的方法去做</em>并不一定适用。</p><p id="8333" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于技术需求和个人偏好的混合，每个组织都将以自己的方式组装和配置脚本。结果可能是大量重复的代码，以及复制和粘贴的强烈诱惑。更糟糕的是，在一个部门内，同样的行为可能以不同的方式实施。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lt"><img src="../Images/79318dec8349ce4dbf2410acd8de565d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*t0aNfvUeqkR4rUjT"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">轮子:不要重新发明它。乔恩·卡塔赫纳在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="bf72" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">软件工程的一个关键原则是不要重复你自己(干)。<a class="ae kv" href="https://docs.python.org/3/tutorial/modules.html" rel="noopener ugc nofollow" target="_blank"> Python的模块框架</a>是为帮助我们实现这一目标而量身定制的。然而，从地理学家-GIS分析师(像我一样)的角度来看，当您第一次面对一项复杂的任务时，将arcpy与模块开发结合起来可能会感觉像以毒攻毒。这当然是一个我推迟了几年的问题！</p><p id="2768" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">事实上，抽象掉重复的逻辑有很多好处。它确保了一致性，有助于维护，并增加了脚本的可读性。您可以进行渐进的改进，并立即看到它们在所有项目中的应用！短期的痛苦伴随着明确的长期收益。</p><p id="94f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是你需要知道的开始。我假设您已经安装了ArcGIS Pro，并且可以从命令行运行python和pip。你可以在这里找到下面所有代码<a class="ae kv" href="https://github.com/countmapula/archelpy" rel="noopener ugc nofollow" target="_blank">的模板。</a></p><p id="7ae0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">结构</strong></p><p id="0bc8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我认为90%以上的arcpy项目都是由单独的脚本组成的。</p><p id="ab20" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们刚刚找到一种方法来做我们一直试图做的事情时，我们不倾向于用额外的复杂性把它弄乱。</p><p id="ecaa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">没有必要每次想要自动化某件事情时都创建一个成熟的Python项目。然而，当我们包装所有最重要的代码时，我们应该尝试遵循最佳实践。</p><p id="5ed3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设我们有以下c:\files\parent_folder文件夹结构</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="66ac" class="lz ma iq lv b gy mb mc l md me">parent_folder</span><span id="1a03" class="lz ma iq lv b gy mf mc l md me">    module_name</span><span id="a924" class="lz ma iq lv b gy mf mc l md me">    tests</span></pre><p id="6a86" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我用一个很基本的例子。假设我们想要调用arcpy。每次我们调用AddMessage()时都以一种特殊的方式。我们将调用我们的包archelpy，并创建一个messages.py模块。</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="9752" class="lz ma iq lv b gy mb mc l md me">archelpy</span><span id="609f" class="lz ma iq lv b gy mf mc l md me">    archelpy</span><span id="cbce" class="lz ma iq lv b gy mf mc l md me">        __init__.py<br/>        messages.py</span><span id="8657" class="lz ma iq lv b gy mf mc l md me">    tests</span></pre><p id="2eee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个基本的<em class="ls"> messages.py </em>示例在脚本工具界面中将时间戳应用于arcpy消息。这有助于确定漫长流程中哪个部分最耗时。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">消息. py</p></figure><p id="4644" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以决定创建相应的模块来管理属性域、索引、切片缓存或任何数量的其他技术问题，</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="1e53" class="lz ma iq lv b gy mb mc l md me">archelpy</span><span id="adeb" class="lz ma iq lv b gy mf mc l md me">    archelpy</span><span id="ddd4" class="lz ma iq lv b gy mf mc l md me">        __init__.py<br/>        caching.py<br/>        domains.py<br/>        indexes.py        <br/>        messages.py</span><span id="7195" class="lz ma iq lv b gy mf mc l md me">    tests</span></pre><p id="8ab1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">测试</strong></p><p id="f5fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">单元测试是另一个经常被归为“太难”的话题。</p><p id="881c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于许多工作流来说，编写测试可能是多余的。另一方面，它们可能非常有益。</p><p id="c591" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">据说<a class="ae kv" href="https://dzone.com/articles/write-testable-code#:~:text=Testable%20code%20is%20code%20of,straightforward%20to%20maintain%20and%20extend." rel="noopener ugc nofollow" target="_blank">可测试代码是高质量的代码</a>。测试鼓励深思熟虑的设计，不鼓励过于复杂或混乱的代码。测试还以其他开发人员能够理解的方式记录了工具的目的和预期行为。随着项目的发展，他们通过验证行为和确保质量来提供安心。</p><p id="0eca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Python内置的unittest框架允许我们检查我们的逻辑是否以我们期望的方式调用了arcpy(或其他第三方模块)。</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="6919" class="lz ma iq lv b gy mb mc l md me">archelpy<br/>__init__.py</span><span id="0d69" class="lz ma iq lv b gy mf mc l md me">    archelpy</span><span id="7e3f" class="lz ma iq lv b gy mf mc l md me">        __init__.py<br/>        messages.py</span><span id="cfea" class="lz ma iq lv b gy mf mc l md me">    tests</span><span id="f70c" class="lz ma iq lv b gy mf mc l md me">        __init__.py<br/>        test_messages.py</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">测试消息. py</p></figure><p id="dc1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意<em class="ls">测试_*。命名约定很重要。</em></p><p id="cc0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从父目录中运行下面的命令将通过在整个项目中搜索测试文件来执行我们的测试套件，</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="f89e" class="lz ma iq lv b gy mb mc l md me">cd c:\files\archelpy</span><span id="df31" class="lz ma iq lv b gy mf mc l md me">python -m unittest discover -v</span></pre><p id="aaf2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这种情况下，我们应该看到这样的结果，</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="2885" class="lz ma iq lv b gy mb mc l md me">testAddMessageParameters (tests.test_messages.HelpyMessagesTestCase)</span><span id="3c7d" class="lz ma iq lv b gy mf mc l md me">Uses assert_called_with() to make sure that our code passes ... ok</span><span id="e535" class="lz ma iq lv b gy mf mc l md me">----------------------------------------------------------------------</span><span id="6658" class="lz ma iq lv b gy mf mc l md me">Ran 1 test in 0.003s</span><span id="16e9" class="lz ma iq lv b gy mf mc l md me">OK</span></pre><p id="7777" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在实践中，您将创建更多的测试，并将它们组织到不同的文件和目录中。这时，unittest中的discover特性变得特别有用。</p><p id="4f09" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">打造</strong></p><p id="914f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们已经准备好分发包裹了。如果你想大方一点，你可以开源它并把它添加到PyPi中。对于专有工作，您更愿意将安装资源保存在安全的地方。</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="96b3" class="lz ma iq lv b gy mb mc l md me">cd c:\&lt;path&gt;\archelpy</span></pre><p id="2ae2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ArcGIS Pro的Python安装附带了setuptools和wheels，它们会创建一个名为wheel文件的pip兼容安装程序。whl)。</p><p id="80ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在名为setup.py的文件的顶层目录中定义我们的包属性，</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="3162" class="lz ma iq lv b gy mb mc l md me">archelpy</span><span id="780a" class="lz ma iq lv b gy mf mc l md me">setup.py</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">setup.py模板</p></figure><p id="6cf0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行以下命令，</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="b640" class="lz ma iq lv b gy mb mc l md me">python setup.py bdist_wheel</span></pre><p id="7ec3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将在项目中生成许多工件，包括一个. whl文件，您可以用它来安装您的模块！</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="177e" class="lz ma iq lv b gy mb mc l md me">archelpy</span><span id="25e0" class="lz ma iq lv b gy mf mc l md me">    dist </span><span id="2cb5" class="lz ma iq lv b gy mf mc l md me">        archelpy-0.1.0-py3-none-any.whl</span></pre><p id="8d95" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">安装</strong></p><p id="5079" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用pip来安装使用新创建的wheel文件的模块，</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="8c41" class="lz ma iq lv b gy mb mc l md me">pip install c:\files\archelpy\archelpy-0.1.0-py3-none-any.whl</span></pre><p id="084e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您应该会看到以下结果，</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="7012" class="lz ma iq lv b gy mb mc l md me">Processing c:\files\archelpy\archelpy-0.1.0-py3-none-any.whl<br/>Installing collected packages: archelpy<br/>Successfully installed archelpy-0.1.0</span></pre><p id="0ac9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">使用！</strong></p><p id="5974" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像这样在脚本工具中导入archelpy，</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="77fb" class="lz ma iq lv b gy mb mc l md me">from archelpy import messages</span><span id="b1af" class="lz ma iq lv b gy mf mc l md me">messages.time_message("Hello!", arcpy)</span></pre><p id="9738" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你已经准备好了！当您对软件包进行改进时，使用以下命令重新构建wheel文件并更新安装，</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="ed66" class="lz ma iq lv b gy mb mc l md me">pip install &lt;wheel file&gt; --upgrade</span></pre><p id="c074" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">快乐脚本！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/89de5b8695d1a371eaf7e43cdc2aa9e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pUIiiZmVzKXm6t46"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@uomo_libero?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> uomo libero </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="108f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">感谢</strong></p><p id="982c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">参见起亚Eisinga的<a class="ae kv" href="https://medium.com/analytics-vidhya/how-to-create-a-python-library-7d5aea80cc3f" rel="noopener">这篇</a>文章，对包装进行了更深入的讨论。</p><p id="d5d5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">参见来自帕特里克·肯尼迪的<a class="ae kv" href="https://www.patricksoftwareblog.com/python-unit-testing-structuring-your-project/" rel="noopener ugc nofollow" target="_blank">这篇</a>文章，以及来自Ian Firkin的<a class="ae kv" href="https://notesfromthelifeboat.com/post/testing-arcpy-2/" rel="noopener ugc nofollow" target="_blank">这篇</a>文章，分别了解关于测试Python和arcpy的更多细节。</p></div></div>    
</body>
</html>