<html>
<head>
<title>How To Change Column Type in Pandas DataFrames</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何更改Pandas数据框架中的列类型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-change-column-type-in-pandas-dataframes-d2a5548888f8?source=collection_archive---------3-----------------------#2021-07-08">https://towardsdatascience.com/how-to-change-column-type-in-pandas-dataframes-d2a5548888f8?source=collection_archive---------3-----------------------#2021-07-08</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="7480" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">探索在pandas中改变列的数据类型的3种不同选择</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/6e02c9243a298f584b3761c8c8dd94b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gVAWc8XQjAQc6Hcqx2NT0Q.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@mcarsience_photography?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">梅根·卡森</a>在<a class="ae kz" href="https://unsplash.com/s/photos/transform?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><h2 id="dc5c" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">介绍</h2><p id="9233" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">在处理熊猫数据帧时，最常见的操作之一是<strong class="ly iv">数据</strong> <strong class="ly iv">类型(或</strong> <code class="fe mp mq mr ms b"><strong class="ly iv">dtype</strong></code> <strong class="ly iv">)转换</strong>。在今天的文章中，我们将探索3种不同的方法来改变熊猫的栏目类型。这些方法是</p><ul class=""><li id="ca51" class="mt mu iu ly b lz mv mc mw lj mx ln my lr mz mo na nb nc nd bi translated"><code class="fe mp mq mr ms b">astype()</code></li><li id="e52b" class="mt mu iu ly b lz ne mc nf lj ng ln nh lr ni mo na nb nc nd bi translated"><code class="fe mp mq mr ms b">to_numeric()</code></li><li id="dd9d" class="mt mu iu ly b lz ne mc nf lj ng ln nh lr ni mo na nb nc nd bi translated"><code class="fe mp mq mr ms b">convert_dtypes()</code></li></ul></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><p id="fd63" class="pw-post-body-paragraph lw lx iu ly b lz mv jv mb mc mw jy me lj nq mg mh ln nr mj mk lr ns mm mn mo in bi translated">在开始讨论可以用来更改某些列的类型的各种选项之前，让我们首先创建一个伪数据帧，我们将在整篇文章中使用它作为示例。</p><pre class="kk kl km kn gu nt ms nu nv aw nw bi"><span id="8d08" class="la lb iu ms b gz nx ny l nz oa">import pandas as pd</span><span id="e39e" class="la lb iu ms b gz ob ny l nz oa">df = pd.DataFrame(<br/>  [<br/>    ('1', 1, 'hi'),<br/>    ('2', 2, 'bye'),<br/>    ('3', 3, 'hello'),<br/>    ('4', 4, 'goodbye'),<br/>  ],<br/>  columns=list('ABC')<br/>)</span><span id="da7a" class="la lb iu ms b gz ob ny l nz oa">print(df)</span><span id="ce6a" class="la lb iu ms b gz ob ny l nz oa">#    A  B        C<br/># 0  1  1       hi<br/># 1  2  2      bye<br/># 2  3  3    hello<br/># 3  4  4  goodbye</span><span id="7f85" class="la lb iu ms b gz ob ny l nz oa">print(df.dtypes)</span><span id="a70d" class="la lb iu ms b gz ob ny l nz oa"># A    object<br/># B     int64<br/># C    object<br/># dtype: object</span></pre></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h2 id="fdb2" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用astype()</h2><p id="ab1c" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated"><code class="fe mp mq mr ms b"><a class="ae kz" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.astype.html" rel="noopener ugc nofollow" target="_blank">DataFrame.astype()</a></code>方法用于将熊猫列转换为指定的<em class="oc">数据类型</em>。指定的dtype可以是内置Python、<code class="fe mp mq mr ms b">numpy</code>或<code class="fe mp mq mr ms b">pandas</code> dtype。</p><p id="9385" class="pw-post-body-paragraph lw lx iu ly b lz mv jv mb mc mw jy me lj nq mg mh ln nr mj mk lr ns mm mn mo in bi translated">假设我们想要将列<code class="fe mp mq mr ms b">A</code>(目前是一个类型为<code class="fe mp mq mr ms b">object</code>的字符串)转换成一个保存整数的列。为此，我们只需在pandas DataFrame对象上调用<code class="fe mp mq mr ms b">astype</code>，并显式定义我们希望转换列的dtype。</p><pre class="kk kl km kn gu nt ms nu nv aw nw bi"><span id="2796" class="la lb iu ms b gz nx ny l nz oa"><strong class="ms iv">df['A'] = df['A'].astype(int)</strong></span><span id="5f4e" class="la lb iu ms b gz ob ny l nz oa">print(df)</span><span id="7342" class="la lb iu ms b gz ob ny l nz oa">#    A  B        C<br/># 0  1  1       hi<br/># 1  2  2      bye<br/># 2  3  3    hello<br/># 3  4  4  goodbye</span><span id="3ba8" class="la lb iu ms b gz ob ny l nz oa">print(df.dtypes)</span><span id="5213" class="la lb iu ms b gz ob ny l nz oa"># A     int64<br/># B     int64<br/># C    object<br/># dtype: object</span></pre></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><p id="4d39" class="pw-post-body-paragraph lw lx iu ly b lz mv jv mb mc mw jy me lj nq mg mh ln nr mj mk lr ns mm mn mo in bi translated">您甚至可以一次转换多个列。举个例子，</p><pre class="kk kl km kn gu nt ms nu nv aw nw bi"><span id="2ce1" class="la lb iu ms b gz nx ny l nz oa"><strong class="ms iv">df = df.astype({"A": int, "B": str})</strong></span><span id="ec77" class="la lb iu ms b gz ob ny l nz oa">print(df)</span><span id="adfc" class="la lb iu ms b gz ob ny l nz oa">#    A  B        C<br/># 0  1  1       hi<br/># 1  2  2      bye<br/># 2  3  3    hello<br/># 3  4  4  goodbye</span><span id="6fe3" class="la lb iu ms b gz ob ny l nz oa">print(df.dtypes)</span><span id="f0a7" class="la lb iu ms b gz ob ny l nz oa"># A     int64<br/># B    object<br/># C    object<br/># dtype: object</span></pre></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><p id="35c7" class="pw-post-body-paragraph lw lx iu ly b lz mv jv mb mc mw jy me lj nq mg mh ln nr mj mk lr ns mm mn mo in bi translated">此外，您甚至可以指示<code class="fe mp mq mr ms b">astype()</code>在观察到所提供的dtype的无效数据时如何行动。这可以通过传递相应的<code class="fe mp mq mr ms b">errors</code>参数来实现。您可以选择<code class="fe mp mq mr ms b">'raise’</code>无效数据异常或<code class="fe mp mq mr ms b">'ignore’</code>抑制异常。</p><p id="c35c" class="pw-post-body-paragraph lw lx iu ly b lz mv jv mb mc mw jy me lj nq mg mh ln nr mj mk lr ns mm mn mo in bi translated">例如，假设我们有一个混合了<code class="fe mp mq mr ms b">dtypes</code>和<code class="fe mp mq mr ms b">Series</code>的列，如下所示:</p><pre class="kk kl km kn gu nt ms nu nv aw nw bi"><span id="1332" class="la lb iu ms b gz nx ny l nz oa">s = pd.Series(['1', '2', 'hello'])</span><span id="f661" class="la lb iu ms b gz ob ny l nz oa">print(s)<br/># 0        1<br/># 1        2<br/># 2    hello<br/># dtype: object</span></pre><p id="4f8c" class="pw-post-body-paragraph lw lx iu ly b lz mv jv mb mc mw jy me lj nq mg mh ln nr mj mk lr ns mm mn mo in bi translated">现在，如果我们试图将该列转换为<code class="fe mp mq mr ms b">int</code>，将会引发一个<code class="fe mp mq mr ms b">ValueError</code>:</p><pre class="kk kl km kn gu nt ms nu nv aw nw bi"><span id="0fe7" class="la lb iu ms b gz nx ny l nz oa">s = s.astype(int)<br/>ValueError: invalid literal for int() with base 10: 'hello'</span></pre><p id="03a3" class="pw-post-body-paragraph lw lx iu ly b lz mv jv mb mc mw jy me lj nq mg mh ln nr mj mk lr ns mm mn mo in bi translated">我们可以通过传递<code class="fe mp mq mr ms b">errors='ignore'</code>来抑制<code class="fe mp mq mr ms b">ValueError</code>。在这种情况下，原始对象将被返回</p><pre class="kk kl km kn gu nt ms nu nv aw nw bi"><span id="6f97" class="la lb iu ms b gz nx ny l nz oa">s = s.astype(int, <!-- -->errors='ignore'<!-- -->)<br/>print(s)</span><span id="9f39" class="la lb iu ms b gz ob ny l nz oa"># 0        1<br/># 1        2<br/># 2    hello<br/># dtype: object</span></pre><p id="eb80" class="pw-post-body-paragraph lw lx iu ly b lz mv jv mb mc mw jy me lj nq mg mh ln nr mj mk lr ns mm mn mo in bi translated"><em class="oc">从1.3.0版本开始，用于将时区简单类型转换为时区感知类型的</em> <code class="fe mp mq mr ms b"><em class="oc">astype</em></code> <em class="oc">已被弃用。你现在应该用</em> <code class="fe mp mq mr ms b"><a class="ae kz" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.dt.tz_localize.html#pandas.Series.dt.tz_localize" rel="noopener ugc nofollow" target="_blank"><em class="oc">Series.dt.tz_localize()</em></a></code>代替<em class="oc">。</em></p></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h2 id="bccf" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用to_numeric()</h2><p id="5733" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated"><code class="fe mp mq mr ms b"><a class="ae kz" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_numeric.html" rel="noopener ugc nofollow" target="_blank">pandas.to_numeric</a></code>用于将非数字<code class="fe mp mq mr ms b">dtypes</code>列转换为最合适的数字时间。例如，为了将列<code class="fe mp mq mr ms b">A</code>转换为<code class="fe mp mq mr ms b">int</code>,您需要运行的全部内容是</p><pre class="kk kl km kn gu nt ms nu nv aw nw bi"><span id="7bcb" class="la lb iu ms b gz nx ny l nz oa"><strong class="ms iv">df['A'] = pd.to_numeric(df['A'])</strong></span><span id="4957" class="la lb iu ms b gz ob ny l nz oa">print(df)<br/>#    A  B        C<br/># 0  1  1       hi<br/># 1  2  2      bye<br/># 2  3  3    hello<br/># 3  4  4  goodbye</span><span id="cbdd" class="la lb iu ms b gz ob ny l nz oa">print(df.dtypes)<br/># A     int64<br/># B     int64<br/># C    object<br/># dtype: object</span></pre><p id="df89" class="pw-post-body-paragraph lw lx iu ly b lz mv jv mb mc mw jy me lj nq mg mh ln nr mj mk lr ns mm mn mo in bi translated">现在，如果您想将多个列转换成数字，那么您必须使用如下所示的<code class="fe mp mq mr ms b">apply()</code>方法:</p><pre class="kk kl km kn gu nt ms nu nv aw nw bi"><span id="bcc0" class="la lb iu ms b gz nx ny l nz oa"><strong class="ms iv">df[["A", "B"]] = df[["A", "B"]].apply(pd.to_numeric)</strong></span><span id="8897" class="la lb iu ms b gz ob ny l nz oa">print(df.dtypes)<br/># A     int64<br/># B     int64<br/># C    object<br/># dtype: object</span></pre><p id="c46b" class="pw-post-body-paragraph lw lx iu ly b lz mv jv mb mc mw jy me lj nq mg mh ln nr mj mk lr ns mm mn mo in bi translated"><code class="fe mp mq mr ms b">to_numeric()</code>也接受<code class="fe mp mq mr ms b">errors</code>参数(像<code class="fe mp mq mr ms b">astype()</code>一样),但是它有一个额外的选项，即<code class="fe mp mq mr ms b"><em class="oc">'</em>coerce<em class="oc">'</em></code> <em class="oc"> </em>将所有不能使用指定的<code class="fe mp mq mr ms b">dtype</code>解析的值设置为<code class="fe mp mq mr ms b">NaN</code>。要了解更多细节，请务必查看官方<a class="ae kz" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_numeric.html" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="f0f7" class="pw-post-body-paragraph lw lx iu ly b lz mv jv mb mc mw jy me lj nq mg mh ln nr mj mk lr ns mm mn mo in bi translated"><em class="oc">你可能还想看看</em> <code class="fe mp mq mr ms b"><em class="oc">to_datetime()</em></code> <em class="oc">和</em> <code class="fe mp mq mr ms b"><em class="oc">to_timedelta()</em></code> <em class="oc">方法，如果你想把一列分别投射到</em> <code class="fe mp mq mr ms b"><em class="oc">datetime</em></code> <em class="oc">或</em> <code class="fe mp mq mr ms b"><em class="oc">timedelta</em></code> <em class="oc">的话。</em></p></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h2 id="1201" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用<code class="fe mp mq mr ms b">convert_dtypes()</code></h2><p id="eef7" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated"><code class="fe mp mq mr ms b"><a class="ae kz" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.convert_dtypes.html#pandas.DataFrame.convert_dtypes" rel="noopener ugc nofollow" target="_blank">convert_dtypes()</a></code>方法包含在pandas版本<code class="fe mp mq mr ms b">1.0.0</code>中，用于使用支持<code class="fe mp mq mr ms b">pd.NA</code>(缺失值)的<code class="fe mp mq mr ms b">dtypes</code>将列转换为最佳的<code class="fe mp mq mr ms b">dtypes</code>。这意味着<code class="fe mp mq mr ms b">dtype</code>将在运行时根据指定列中包含的值来确定。</p><pre class="kk kl km kn gu nt ms nu nv aw nw bi"><span id="b8c9" class="la lb iu ms b gz nx ny l nz oa"><strong class="ms iv">df = df.convert_dtypes()</strong></span><span id="0868" class="la lb iu ms b gz ob ny l nz oa">print(df.dtypes)</span><span id="67e5" class="la lb iu ms b gz ob ny l nz oa"># A    string<br/># B     Int64<br/># C    string<br/># dtype: object</span></pre><p id="b1a5" class="pw-post-body-paragraph lw lx iu ly b lz mv jv mb mc mw jy me lj nq mg mh ln nr mj mk lr ns mm mn mo in bi translated">注意列A和C是如何被转换成<code class="fe mp mq mr ms b">string</code>类型的(最初它们是<code class="fe mp mq mr ms b">object</code>类型)。尽管这对于列<code class="fe mp mq mr ms b">C</code>来说相当准确，但理想情况下，我们希望将列<code class="fe mp mq mr ms b">A</code>转换为int列。如果你想让这个方法算出应该用什么<code class="fe mp mq mr ms b">dtypes</code>，这基本上是你必须付出的代价。如果这不是您所期待的，您仍然可以使用本文前面提到的任何方法来显式指定目标<code class="fe mp mq mr ms b">dtypes</code>。</p></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h2 id="bfbc" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">最后的想法</h2><p id="82d0" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">在今天的文章中，我们探讨了pandas中的许多选项，可以用来转换数据帧中特定列的数据类型。我们讨论了如何使用<code class="fe mp mq mr ms b">astype()</code>来显式指定列的<code class="fe mp mq mr ms b">dtypes</code>。此外，我们还探索了如何使用<code class="fe mp mq mr ms b">to_numeric()</code>方法将列转换成数字类型。最后，我们展示了如何使用<code class="fe mp mq mr ms b">convert_dtypes()</code>方法，根据每个列中包含的值计算出最合适的<code class="fe mp mq mr ms b">dtypes</code>列。</p></div></div>    
</body>
</html>