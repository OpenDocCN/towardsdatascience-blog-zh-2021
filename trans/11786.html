<html>
<head>
<title>How to Write Awesome Python Classes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何编写出色的Python类</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-write-awesome-python-classes-f2e1f05e51a9?source=collection_archive---------1-----------------------#2021-11-24">https://towardsdatascience.com/how-to-write-awesome-python-classes-f2e1f05e51a9?source=collection_archive---------1-----------------------#2021-11-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dd3b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这是一种魔法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1bac902b259e75a635fb6759da34e374.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5QvB5J1O0DxAHIMu"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Artem Maltsev 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="0a90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python是大多数数据科学和机器学习项目的首选语言。然而，并不是每个数据科学家都一定是经验丰富的Python开发人员，他们知道并利用了该语言提供的所有优秀特性。这当然可以理解，但同时也是不幸的。为什么？因为了解一门语言的细节可以让你编写出重复性更低、可读性更强、可维护性更好的代码。总的来说，当充分利用一门语言时，你的代码质量会变得更高，更重要的是，你和你的同事会有更多的乐趣，我想这是我们都喜欢的。</p><p id="f3f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是为什么我想帮助提升你的Python知识，这样你就可以写出更棒的代码，也许会给你的伙伴或同事留下深刻印象，并获得更多乐趣！具体来说，在这篇文章中，我想谈一谈所谓的<em class="lv">邓德、特殊或神奇的</em>方法。好奇想知道这些是什么？让我们开始吧。</p><h1 id="c088" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">神奇的方法</h1><p id="e6b9" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">正如标题所言，我们将讨论<em class="lv"> Python魔术方法</em>。有时，你可能还会读到关于<em class="lv"> dunder </em>或<em class="lv"> special </em>方法，它们指的是同一个东西。在这篇文章中，我将使用术语魔术方法。那么那些神奇的方法是什么呢？</p><h2 id="acbc" class="mt lx it bd ly mu mv dn mc mw mx dp mg li my mz mi lm na nb mk lq nc nd mm ne bi translated">基础</h2><p id="0274" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">魔法方法是属于一个类的函数。它们可以是实例和类方法。你可以很容易地识别它们，因为它们都以双下划线开始和结束，也就是说，它们看起来都像<code class="fe nf ng nh ni b">__actual_name__</code>。这也是术语<em class="lv"> dunder </em>的来源，<strong class="lb iu">d</strong>double<strong class="lb iu">under</strong>scores。我花了一段时间才发现😃</p><p id="8512" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可能最重要的是<em class="lv">魔法方法不是让你直接调用</em>的！当然，你可以这样做，写一些类似于<code class="fe nf ng nh ni b">YourClass().__actual_name__()</code>的东西，但是请不要这样做😃！</p><p id="6f61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么魔法方法是如何被调用的呢？它们是从应用于您的类或类的实例的某些操作中调用的。先睹为快，例如，调用<code class="fe nf ng nh ni b">str(YourClass())</code>会调用神奇的方法<code class="fe nf ng nh ni b">__str__</code>，或者<code class="fe nf ng nh ni b">YourClass() + YourClass()</code>会调用<code class="fe nf ng nh ni b">__add__</code>，如果你已经实现了它的话。</p><p id="9fc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，魔法方法有什么好处呢？它们使您能够编写可以与python内置方法一起使用的类。如果你这样做，你的c̶a̶n̶将会写出可读性更强、更简洁的代码。我希望这已经变得显而易见，从前面一段的小偷窥。</p><p id="0c3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了强调魔法方法是多么有用，并了解在进行机器学习或数据科学时如何从使用它们中受益，让我们跳到一个具体的例子中。</p><h2 id="1ad3" class="mt lx it bd ly mu mv dn mc mw mx dp mg li my mz mi lm na nb mk lq nc nd mm ne bi translated">示例:自定义日期时间范围</h2><p id="0701" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">作为一个例子，我想向您展示如何使用神奇的方法编写类似于内置的<a class="ae ky" href="https://docs.python.org/3/library/functions.html#func-range" rel="noopener ugc nofollow" target="_blank"> <em class="lv">范围</em> </a> <em class="lv"> </em>函数的东西。与内置版本相比，这个例子将提供更多的功能，更重要的是创建日期时间范围而不是数字范围。当然，你可以只使用<a class="ae ky" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> Pandas </a>或者其他一些库来得到它，但是我认为这个例子的目的是促进我们对魔术方法背后的一般概念的理解。它还允许我向您展示一些最有用的神奇方法，尤其是在处理数据时。</p><p id="4527" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只是谈论或写代码而没有看到真实的和工作的代码是很无聊的，不是吗？因此，让我们停止这样做，看看真正的日期时间范围实现</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="52e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了，这是相当多的代码。如果你现在害怕，容忍我，我们将揭示它。总的来说，我已经实现了六种不同的魔术方法，我将在下面解释。</p><p id="8231" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个，也可能是最著名的一个是<code class="fe nf ng nh ni b">__init__</code>方法。您肯定知道，这个方法主要用于初始化您的类的实例属性。在这里，我们设置范围类的<em class="lv">开始</em>和<em class="lv">结束</em>以及<em class="lv">步长</em>大小。这类似于我们在创建内置范围函数时所做的。</p><p id="bfbe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一个是<code class="fe nf ng nh ni b">__iter__</code>法。这可能是最重要的一个，因为它生成了我们的日期时间范围内的所有元素。这个函数是所谓的<em class="lv">生成器函数</em>，它一次创建一个元素，将它交给调用者，并允许调用者处理它。它一直这样做，直到到达范围的末端。当看到<code class="fe nf ng nh ni b">yield</code>关键字时，你可以很容易地识别出一个发生器函数。该语句暂停函数，保存其所有状态，稍后在后续调用中继续。这允许您一次使用一个元素并使用它，而不需要将每个元素都存储在内存中。</p><p id="d231" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当每个项目都占用大量内存，或者当您有大量项目时，不将所有内容都放在内存中会非常方便。例如，尝试执行<code class="fe nf ng nh ni b"><strong class="lb iu">list</strong>(DateTimeRange(datetime(1900,1,1), datetime(2000,1,1))</code>或者不执行，因为这会创建一个包含3184617600个日期时间条目的列表。太大了，抱歉😃但是，使用生成器，您可以轻松地逐个处理这些元素。</p><p id="eb1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你已经看到它不是一个列表或元组。然而，为了处理这个DateTimeRange类，就好像它是一个列表或元组一样，我添加了另外三个神奇的方法，即<code class="fe nf ng nh ni b">__len__</code>、<code class="fe nf ng nh ni b">__contains__</code>和<code class="fe nf ng nh ni b">__getitem__</code>。</p><p id="2d33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe nf ng nh ni b">__len__</code>，您可以通过调用<code class="fe nf ng nh ni b"><strong class="lb iu">len</strong>(my_range)</code>来找出属于您的范围的元素的数量。这非常有帮助，例如当你迭代所有的元素，并且想知道你已经处理了多少个元素的时候。它可能还会告诉你，嘿，我要处理很多数据，请拿一杯☕️.咖啡</p><p id="71f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe nf ng nh ni b">__contains__</code>你可以使用内置语法<code class="fe nf ng nh ni b">element <strong class="lb iu">in</strong> my_range</code>检查一个元素是否是你的范围的一部分。给定实现的好处是，这是使用纯数学来完成的，而不必将给定元素与该范围内的所有元素进行比较。这意味着检查一个元素是否是范围的一部分是一个常量时间操作，不依赖于实际范围实例的大小。同样，这对于我们在处理数据时经常看到的大范围来说会很方便。</p><p id="8e9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe nf ng nh ni b">__getitem__</code>你可以使用索引语法从你的对象中检索条目。例如，你可以得到我们范围的最后一个元素<code class="fe nf ng nh ni b">my_range[-1]</code>。我必须承认，对于具体的例子来说，这可能是最没用的方法。然而，一般来说，使用<code class="fe nf ng nh ni b">__getitem__</code>可以让你写出非常干净易读的界面。</p><p id="67ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我添加的第六个也是最后一个魔法方法是<code class="fe nf ng nh ni b">__str__</code>。这个方法允许你将类的实例转换成字符串。这在调用<code class="fe nf ng nh ni b"><strong class="lb iu">print</strong>(my_range)</code>时变得非常方便，因为print必须将一个实例转换成一个字符串，因此使用了<code class="fe nf ng nh ni b">__str__</code>方法。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/5c7a4802b0553c5123cc88d0cf637511.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XiF5Jng1lN1EkvqV"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@dollargill?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">美元吉尔</a>拍摄的照片</p></figure><h1 id="1eb1" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">包裹</h1><p id="094c" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在本文中，我向您介绍了Python中魔术方法背后的基本概念。我已经向您展示了第一个示例，展示了如何使用这些方法，在我看来，这些方法在处理数据时非常方便。当然，还有很多，例如创建<a class="ae ky" rel="noopener" target="_blank" href="/context-managers-the-best-managers-for-python-developers-a5809fb7e428">上下文管理器</a>或者<a class="ae ky" href="https://betterprogramming.pub/how-to-create-custom-classes-in-python-without-going-meta-5e8bfa97be6e" rel="noopener ugc nofollow" target="_blank">增强你的类</a>。我可以推荐你继续探索这个领域，继续学习！</p><p id="4338" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你现在已经准备好在将来创建神奇的界面，也许还可以向你的朋友和同事炫耀一下💪。</p><p id="5871" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您关注这篇文章。一如既往，如有任何问题、意见或建议，请随时联系我或关注我，或者通过<a class="ae ky" href="https://www.linkedin.com/in/simon-hawe-75832057/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>。</p></div></div>    
</body>
</html>