<html>
<head>
<title>Imputing Missing Values using the SimpleImputer Class in sklearn</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用sklearn中的SimpleImputer类输入缺失值</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/imputing-missing-values-using-the-simpleimputer-class-in-sklearn-99706afaff46?source=collection_archive---------5-----------------------#2021-09-19">https://towardsdatascience.com/imputing-missing-values-using-the-simpleimputer-class-in-sklearn-99706afaff46?source=collection_archive---------5-----------------------#2021-09-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8715" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用SimpleImputer类来替换Pandas数据帧中的nan</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a2784994cd2cd3157ee27732f6c677d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*S0u0mjJ6SunIyb4a"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的sanga Rima Roman Selia拍摄</p></figure><p id="12bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在训练机器学习模型之前，您需要执行的任务之一是数据预处理。数据清理是数据预处理任务的一个关键部分，通常涉及删除具有空值的行，或者用一些估算值替换它们。</p><blockquote class="lv lw lx"><p id="4f84" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">“估算”一词指的是通过对其所贡献的产品或过程的价值进行推断而赋予某物的价值。在统计学中，插补是用替代值替换缺失数据的过程。</p></blockquote><p id="f86b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我将向你展示如何使用<strong class="lb iu"> sklearn </strong>中的<strong class="lb iu">简单估算器</strong>类来快速方便地替换你的熊猫数据帧中缺失的值。</p><h1 id="fd7b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">加载样本数据</h1><p id="0d12" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">对于本文，我有一个简单的CSV文件(<strong class="lb iu"> NaNDataset.csv </strong>)，如下所示:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="2646" class="ne md it na b gy nf ng l nh ni">A,B,C,D<br/>1,2,3,'Good'<br/>4,,6,'Good'<br/>7,,9,'Excellent'<br/>10,11,12,<br/>13,14,15,'Excellent'<br/>16,17,,'Fair'<br/>19,12,12,'Excellent'<br/>20,11,23,'Fair'</span></pre><p id="fa6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下代码片段将CSV文件加载到Pandas数据帧中:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="bade" class="ne md it na b gy nf ng l nh ni">import numpy as np<br/>import pandas as pd</span><span id="2be9" class="ne md it na b gy nj ng l nh ni">df = pd.read_csv('NaNDataset.csv')<br/>df</span></pre><p id="a344" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据帧看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/20a80d2ba1f5d88b23aa70668d4e79fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:398/format:webp/1*mstbkaLSNQQ8gf0g7ewiqg.png"/></div></figure><h1 id="42bb" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">替换丢失的值</h1><p id="1db3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">数据帧中所有缺失的值都用NaN表示。通常，您可以删除它们，或者用一些推断值替换它们。例如，要用平均值填充<strong class="lb iu"> B </strong>列中的NaN，您可以这样做:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="4375" class="ne md it na b gy nf ng l nh ni">df['B'] = df['B'].fillna(df['B'].mean())<br/>df</span></pre><p id="0879" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">B列中的空值现在用该列的平均值填充:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/2d5366044cd7f827bcfb5fb3d14ebb50.png" data-original-src="https://miro.medium.com/v2/resize:fit:464/format:webp/1*Ets2sqqbN7m97MLxhNxFmQ.png"/></div></figure><p id="1b3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这很简单，但有时你的填充策略可能会有所不同。您可能希望用最常出现的值来填充缺少的值，而不是用列的平均值来填充。一个很好的例子是D列，其中出现最多的值是“优秀”。</p><p id="4e12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要用最频繁出现的值填充D列中缺少的值，可以使用以下语句:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="d524" class="ne md it na b gy nf ng l nh ni">df['D'] = df['D'].fillna(df['D'].value_counts().index[0])<br/>df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/dc67b3c235c0f523f6885514f8231fe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:398/format:webp/1*Fa2DLmi1dbQ9uMkX6czocw.png"/></div></figure><h1 id="82fd" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用sklearn的SimpleImputer类</h1><p id="c3ff" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">使用<strong class="lb iu"> fillna() </strong>方法的替代方法是使用sklearn的<strong class="lb iu">simple imputr</strong>类。你可以从<strong class="lb iu"> sklearn.impute </strong>包中找到<strong class="lb iu"> SimpleImputer </strong>类。理解如何使用它的最简单的方法是通过一个例子:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="fa61" class="ne md it na b gy nf ng l nh ni">from sklearn.impute import SimpleImputer</span><span id="93a1" class="ne md it na b gy nj ng l nh ni">df = pd.read_csv('NaNDataset.csv')</span><span id="995b" class="ne md it na b gy nj ng l nh ni">imputer = SimpleImputer(strategy='mean', missing_values=np.nan)<br/>imputer = imputer.fit(df[['B']])<br/>df['B'] = imputer.transform(df[['B']])<br/>df</span></pre><p id="51de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，通过指示策略(<em class="ly"> mean </em>)以及指定想要定位的缺失值(<em class="ly"> np.nan </em>)，初始化<strong class="lb iu"> SimpleImputer </strong>类的一个实例:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="e9a9" class="ne md it na b gy nf ng l nh ni">imputer = SimpleImputer(strategy='mean', missing_values=np.nan)</span></pre><p id="0530" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦创建了实例，您就可以使用<strong class="lb iu"> fit() </strong>函数来拟合您想要处理的列的估算值:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="e42c" class="ne md it na b gy nf ng l nh ni">imputer = imputer.fit(df[['B']])</span></pre><p id="bacc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以使用<strong class="lb iu"> transform() </strong>函数根据您在<strong class="lb iu">simple import</strong>类的初始化器中指定的策略来填充缺失的值:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="3203" class="ne md it na b gy nf ng l nh ni">df['B'] = imputer.transform(df[['B']])</span></pre><blockquote class="lv lw lx"><p id="781e" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">注意，<strong class="lb iu"> fit() </strong>和<strong class="lb iu"> transform() </strong>函数都需要一个2D数组，所以一定要传入一个2D数组或dataframe。如果你传入一个1D数组或者熊猫系列，你会得到一个错误。</p></blockquote><p id="b8bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> transform() </strong>函数将结果作为2D数组返回。在我的例子中，我将值赋回给列B:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="ce26" class="ne md it na b gy nf ng l nh ni">df['B'] = imputer.transform(df[['B']])</span></pre><p id="2245" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更新后的数据帧如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/8eba2b41c01629f60421446fb43e9991.png" data-original-src="https://miro.medium.com/v2/resize:fit:462/format:webp/1*a5T3ZAfKnhXbKnlgoSjsSg.png"/></div></div></figure><h1 id="f61e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">替换多列</h1><p id="8362" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">要替换数据帧中多个列<em class="ly">的缺失值，只需传入包含相关列的数据帧:</em></p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="21f9" class="ne md it na b gy nf ng l nh ni">df = pd.read_csv('NaNDataset.csv')</span><span id="5c9f" class="ne md it na b gy nj ng l nh ni">imputer = SimpleImputer(strategy='mean', missing_values=np.nan)<br/>imputer = imputer.fit(<strong class="na iu">df[['B','C']]</strong>)<br/><strong class="na iu">df[['B','C']]</strong> = imputer.transform(<strong class="na iu">df[['B','C']]</strong>)<br/>df</span></pre><p id="0dd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以上示例使用“平均”策略替换了B列和C列中缺少的值:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/e94c3dc5af1e630db49ecb527c69b7f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:522/format:webp/1*4NMha9fgIFWTc_Zklsu5zg.png"/></div></figure><h1 id="34ea" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用中间值替换</h1><p id="506f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">除了使用每列的平均值来更新缺失值，还可以使用median:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="eac4" class="ne md it na b gy nf ng l nh ni">df = pd.read_csv('NaNDataset.csv')</span><span id="41bc" class="ne md it na b gy nj ng l nh ni">imputer = SimpleImputer(strategy='<strong class="na iu">median</strong>', missing_values=np.nan)<br/>imputer = imputer.fit(df[['B','C']])<br/>df[['B','C']] = imputer.transform(df[['B','C']])<br/>df</span></pre><p id="d3e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/c14ff016bbfd6180d1bffbf09da33020.png" data-original-src="https://miro.medium.com/v2/resize:fit:408/format:webp/1*Z0qbDZgXYpk3Ofmqvbg9OQ.png"/></div></div></figure><h1 id="1238" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">用最常用的值替换</h1><p id="57d3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果要用最频繁出现的值替换缺失值，请使用“<em class="ly">most _ frequency</em>”策略:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="d78e" class="ne md it na b gy nf ng l nh ni">df = pd.read_csv('NaNDataset.csv')</span><span id="5e34" class="ne md it na b gy nj ng l nh ni">imputer = SimpleImputer(strategy='<strong class="na iu">most_frequent</strong>', <br/>                        missing_values=np.nan)<br/>imputer = imputer.fit(df[['D']])<br/>df[['D']] = imputer.transform(df[['D']])<br/>df</span></pre><p id="0031" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种策略对于分类列很有用(尽管它也适用于数字列)。上述代码片段返回以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/66299944e65f97a1ae14d1fff337739d.png" data-original-src="https://miro.medium.com/v2/resize:fit:398/format:webp/1*c4AbisIPL9QiBgdlYyG8ww.png"/></div></figure><h1 id="e078" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">用固定值替换</h1><p id="ef6a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">您可以使用的另一个策略是用一个固定(常量)值替换缺失值。为此，为策略指定“<em class="ly">常量</em>，并使用<strong class="lb iu"> fill_value </strong>参数指定填充值:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="5440" class="ne md it na b gy nf ng l nh ni">df = pd.read_csv('NaNDataset.csv')</span><span id="699c" class="ne md it na b gy nj ng l nh ni">imputer = SimpleImputer(strategy='<strong class="na iu">constant</strong>',<br/>                        missing_values=np.nan, <strong class="na iu">fill_value=0</strong>)</span><span id="d8c7" class="ne md it na b gy nj ng l nh ni">imputer = imputer.fit(df[['B','C']])<br/>df[['B','C']] = imputer.transform(df[['B','C']])<br/>df</span></pre><p id="a132" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码片段用0替换了列<strong class="lb iu"> B </strong>和<strong class="lb iu"> C </strong>中所有缺失的值:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/7c4670fdccc1b38148170d0bb04f7750.png" data-original-src="https://miro.medium.com/v2/resize:fit:394/format:webp/1*_4X44cEYADqSqPUA8h_U5A.png"/></div></figure><h1 id="41e7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">将简单估算器应用于整个数据帧</h1><p id="a4e3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您想对整个数据帧应用相同的策略，您可以用数据帧调用<strong class="lb iu"> fit() </strong>和<strong class="lb iu"> transform() </strong>函数。当结果返回时，您可以使用<strong class="lb iu"> iloc[] </strong>索引器方法来更新数据帧:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="a650" class="ne md it na b gy nf ng l nh ni">df = pd.read_csv('NaNDataset.csv')</span><span id="edee" class="ne md it na b gy nj ng l nh ni">imputer = SimpleImputer(strategy='most_frequent', <br/>                        missing_values=np.nan)<br/>imputer = imputer.fit(<strong class="na iu">df</strong>)<br/><strong class="na iu">df.iloc[:,:]</strong> = imputer.transform(<strong class="na iu">df</strong>)<br/>df</span></pre><p id="2626" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一种技术是使用由<strong class="lb iu"> transform() </strong>函数返回的结果创建一个新的数据帧:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="37f5" class="ne md it na b gy nf ng l nh ni">df = pd.DataFrame(imputer.transform(df.loc[:,:]), <br/>                  columns = df.columns)<br/>df</span></pre><p id="eb48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在任何一种情况下，结果都将如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/2b1d8d35cb537239fe92c26c6a624ec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:388/format:webp/1*Pc2d0PdBEFfWTK6VY9wc6g.png"/></div></figure><blockquote class="lv lw lx"><p id="5d14" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">在上面的例子中,“最频繁”策略应用于整个数据帧。如果您使用中位数或均值策略，您将会得到一个错误，因为列D不是一个数字列。</p></blockquote><h1 id="1b0d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="a7da" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在本文中，我将讨论如何使用sklearn的<strong class="lb iu">simple imputr</strong>类替换数据帧中缺失的值。虽然您也可以使用<strong class="lb iu"> fillna() </strong>方法手动替换缺失值，但是<strong class="lb iu">simple imputr</strong>类使得处理缺失值变得相对容易。如果您正在使用<strong class="lb iu"> sklearn </strong>，那么将<strong class="lb iu">simple imputr</strong>与<strong class="lb iu"> Pipeline </strong>对象一起使用会更容易(在以后的文章中会有更多相关内容)。</p></div></div>    
</body>
</html>