<html>
<head>
<title>The Complete Guide to Docker Volumes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Docker卷完全指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-complete-guide-to-docker-volumes-1a06051d2cce?source=collection_archive---------0-----------------------#2021-07-17">https://towardsdatascience.com/the-complete-guide-to-docker-volumes-1a06051d2cce?source=collection_archive---------0-----------------------#2021-07-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="242c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解docker卷的基础知识</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/50fb9b80cfb891713bb6f4137fa8e0d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hTCwQYleClsafo2U"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@christinhumephoto?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克里斯汀·休姆</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="399b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated">在我们重启或移除容器后，容器生成和使用的数据不再持久。因此，我们可以使用<a class="ae ky" href="https://docs.docker.com/storage/volumes/" rel="noopener ugc nofollow" target="_blank"> Docker卷</a>和<a class="ae ky" href="https://docs.docker.com/storage/bind-mounts/" rel="noopener ugc nofollow" target="_blank">绑定挂载</a>来管理Docker容器中的数据，以解决这个问题。我们可以用它来持久化容器中的数据或者在容器之间共享数据。从这篇文章中，你将学习如何在你的项目中使用Docker卷和绑定挂载。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="c963" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">设置</h1><p id="91ee" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">Docker使用以下类型的卷和绑定挂载来保存数据。对于这个设置，我使用的是macOS。</p><ol class=""><li id="8cfc" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">匿名卷</li><li id="5adb" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">命名卷</li><li id="2f41" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">绑定安装</li></ol><p id="3b55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将运行一个MySQL服务器并执行一些命令。默认情况下，MySQL会将其数据文件存储在容器的<code class="fe nw nx ny nz b">/var/lib/mysql</code>目录中，Docker volumes会帮助我们持久存储这些数据。</p><p id="72ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有三个docker-compose.yml文件来演示卷和绑定挂载。要启动这些文件，您需要使用以下命令。</p><pre class="kj kk kl km gt oa nz ob bn oc od bi"><span id="2e41" class="oe mm it nz b be of og l oh oi">docker compose up</span></pre><p id="1c86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们的容器开始运行，我们可以使用下面的命令在容器中创建一个表用于测试。</p><pre class="kj kk kl km gt oa nz ob bn oc od bi"><span id="5b97" class="oe mm it nz b be of og l oh oi"># Access the container<br/>docker exec -it mysql_db_1 bash<br/># Connect to MySQL server<br/>mysql -uroot -proot<br/># Run MySQL commands<br/>USE test_db;<br/>SHOW TABLES;<br/>CREATE TABLE users (<br/>       user_id int NOT NULL AUTO_INCREMENT,<br/>       name VARCHAR(20),<br/>       PRIMARY KEY (user_id)<br/>);<br/>SHOW TABLES;</span></pre><h2 id="5271" class="oj mm it bd mn ok ol dn mr om on dp mv li oo op mx lm oq or mz lq os ot nb ou bi translated">1.匿名卷</h2><p id="6326" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">如果我们运行下面的docker-compose.yml文件，将会创建一个匿名卷。如果我们重启我们的容器，数据将是可见的，但不是在我们移除容器之后。此外，其他容器也无法访问它。如果我们想暂时保存数据，这是很有帮助的。这些卷是在<code class="fe nw nx ny nz b">/var/lib/docker/volume</code>本地主机目录中创建的。</p><pre class="kj kk kl km gt oa nz ob bn oc od bi"><span id="6c0d" class="oe mm it nz b be of og l oh oi">version: '3.8'<br/>services:<br/>  db:<br/>    image: mysql<br/>    restart: always<br/>    environment:<br/>      MYSQL_ROOT_PASSWORD: root<br/>      MYSQL_DATABASE: test_db<br/>    ports:<br/>      - "3306:3306"<br/>    volumes:<br/>      - /var/lib/mysql</span></pre><p id="da90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们所看到的，我们不必指定主机目录。我们只需要指定容器内的目录。</p><p id="7bce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们从docker-compose.yml文件中删除volume指令，容器将默认创建一个匿名卷，因为它是在MySQL <a class="ae ky" href="https://github.com/docker-library/mysql/blob/master/8.0/Dockerfile.debian" rel="noopener ugc nofollow" target="_blank"> Dockerfile </a>中指定的。因此，MySQL映像确保了我们在不提供任何卷信息的情况下仍然可以访问数据。</p><pre class="kj kk kl km gt oa nz ob bn oc od bi"><span id="83ae" class="oe mm it nz b be of og l oh oi">VOLUME /var/lib/mysql</span></pre><p id="44e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们有一个带有随机标识符的匿名卷。</p><pre class="kj kk kl km gt oa nz ob bn oc od bi"><span id="8b6d" class="oe mm it nz b be of og l oh oi">docker volume ls<br/>DRIVER    VOLUME NAME<br/>local  4e679725b7179e63e8658bc157a1980f320948ab819f271fd5a44fe94c16bf23</span></pre><p id="ec70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们检查一下我们的码头集装箱。</p><pre class="kj kk kl km gt oa nz ob bn oc od bi"><span id="09af" class="oe mm it nz b be of og l oh oi">docker inspect mysql_db_1<br/>.<br/>.<br/>.<br/>"Mounts": [<br/>            {<br/>                "Type": "volume",<br/>                "Name": "4e679725b7179e63e8658bc157a1980f320948ab819f271fd5a44fe94c16bf23",<br/>                "Source": "/var/lib/docker/volumes/4e679725b7179e63e8658bc157a1980f320948ab819f271fd5a44fe94c16bf23/_data",<br/>                "Destination": "/var/lib/mysql",<br/>                "Driver": "local",<br/>                "Mode": "",<br/>                "RW": true,<br/>                "Propagation": ""<br/>            }<br/>        ],<br/>.<br/>.<br/>.</span></pre><p id="1516" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用下面的<a class="ae ky" href="https://docs.docker.com/engine/reference/commandline/rm/" rel="noopener ugc nofollow" target="_blank">命令</a>删除容器及其相关的匿名卷。</p><pre class="kj kk kl km gt oa nz ob bn oc od bi"><span id="45c5" class="oe mm it nz b be of og l oh oi">docker rm -v mysql_db_1</span></pre><p id="2786" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们不将匿名卷和容器一起删除，它将成为悬挂卷。</p><pre class="kj kk kl km gt oa nz ob bn oc od bi"><span id="40e6" class="oe mm it nz b be of og l oh oi">docker rm mysql_db_1</span></pre><p id="3749" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用以下命令列出并删除所有悬挂卷。</p><pre class="kj kk kl km gt oa nz ob bn oc od bi"><span id="6fb1" class="oe mm it nz b be of og l oh oi">docker volume ls -qf dangling=true<br/>docker volume rm $(docker volume ls -qf dangling=true)</span></pre><h2 id="ccc9" class="oj mm it bd mn ok ol dn mr om on dp mv li oo op mx lm oq or mz lq os ot nb ou bi translated">2.命名卷</h2><p id="80a7" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">在我们重新启动或删除容器后，命名卷可以保存数据。此外，其他容器也可以访问它。这些卷创建在<code class="fe nw nx ny nz b">/var/lib/docker/volume</code>本地主机目录中。</p><pre class="kj kk kl km gt oa nz ob bn oc od bi"><span id="e313" class="oe mm it nz b be of og l oh oi">version: '3.8'<br/>services:<br/>  db:<br/>    image: mysql<br/>    restart: always<br/>    environment:<br/>      MYSQL_ROOT_PASSWORD: root<br/>      MYSQL_DATABASE: test_db<br/>    ports:<br/>      - "3306:3306"<br/>    volumes:<br/>      - db_data:/var/lib/mysql<br/>volumes:<br/>  db_data:</span></pre><p id="d04d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，第一个字段是主机上卷的唯一名称。第二部分是容器中的路径。</p><p id="fb7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，如果我们使用以下命令删除容器，我们将仍然拥有该卷，这与匿名卷不同。</p><pre class="kj kk kl km gt oa nz ob bn oc od bi"><span id="f292" class="oe mm it nz b be of og l oh oi">docker rm -v mysql_db_1</span></pre><h2 id="643d" class="oj mm it bd mn ok ol dn mr om on dp mv li oo op mx lm oq or mz lq os ot nb ou bi translated">3.绑定安装</h2><p id="ca15" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">在我们重启或移除容器后，绑定装载可以持久化数据。正如我们所看到的，命名卷和绑定装载是相同的，只是命名卷可以在特定的主机目录下找到，而绑定装载可以在任何主机目录下。</p><pre class="kj kk kl km gt oa nz ob bn oc od bi"><span id="8a29" class="oe mm it nz b be of og l oh oi">version: '3.8'<br/>services:<br/>  db:<br/>    image: mysql<br/>    restart: always<br/>    environment:<br/>      MYSQL_ROOT_PASSWORD: root<br/>      MYSQL_DATABASE: test_db<br/>    ports:<br/>      - "3306:3306"<br/>    volumes:<br/>      - $PWD/data:/var/lib/mysql</span></pre><p id="20c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们正在装载一个主机文件夹。第一部分是主机中的路径。第二部分是容器中的路径。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="ef92" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">命令</h1><p id="82e8" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">现在，让我们列出volume指令的所有可用命令。</p><pre class="kj kk kl km gt oa nz ob bn oc od bi"><span id="565e" class="oe mm it nz b be of og l oh oi">docker volume --help<br/><br/>Commands:<br/>  create      Create a volume<br/>  inspect     Display detailed information on one or more volumes<br/>  ls          List volumes<br/>  prune       Remove all unused local volumes<br/>  rm          Remove one or more volumes</span></pre><p id="2427" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用这些命令来管理匿名卷和命名卷。</p><pre class="kj kk kl km gt oa nz ob bn oc od bi"><span id="adc6" class="oe mm it nz b be of og l oh oi"># Creat a volume<br/>docker volume create test-vol<br/># test-vol<br/><br/># Inspect a volume<br/>docker inspect test-vol<br/># [<br/>#     {<br/>#         "CreatedAt": "2021-07-17T07:23:25Z",<br/>#         "Driver": "local",<br/>#         "Labels": {},<br/>#         "Mountpoint": "/var/lib/docker/volumes/test-vol/_data",<br/>#         "Name": "test-vol",<br/>#         "Options": {},<br/>#         "Scope": "local"<br/>#     }<br/># ]<br/><br/># List all volumes<br/>docker volume create test-vol-2<br/>docker volume ls<br/># DRIVER    VOLUME NAME<br/># local     test-vol<br/># local     test-vol-2<br/><br/># Remove all volumes<br/>docker volume prune<br/># WARNING! This will remove all local volumes not used by at least one container.<br/># Are you sure you want to continue? [y/N] y<br/># Deleted Volumes:<br/># test-vol<br/># test-vol-2<br/><br/># Remove volumes<br/>docker volume create test-vol-3<br/>docker volume rm test-vol-3<br/># test-vol-3<br/><br/>docker volume create test-vol-4<br/>docker volume create test-vol-5<br/>docker volume rm test-vol-4 test-vol-5<br/># test-vol-4<br/># test-vol-5</span></pre></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="5e89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你对Docker卷和装订线有一个清晰的了解。它将帮助您为Docker项目持久化数据。编码快乐！</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="0092" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">相关职位</h1><div class="ov ow gp gr ox oy"><a rel="noopener follow" target="_blank" href="/how-to-mount-a-directory-inside-a-docker-container-4cee379c298b"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd iu gy z fp pd fr fs pe fu fw is bi translated">如何在Docker容器中挂载目录</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">专注于编写代码，无需担心环境管理</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">towardsdatascience.com</p></div></div><div class="ph l"><div class="pi l pj pk pl ph pm ks oy"/></div></div></a></div><div class="ov ow gp gr ox oy"><a rel="noopener follow" target="_blank" href="/the-ultimate-markdown-cheat-sheet-3d3976b31a0"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd iu gy z fp pd fr fs pe fu fw is bi translated">终极降价备忘单</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">写一篇精彩的自述</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">towardsdatascience.com</p></div></div><div class="ph l"><div class="pn l pj pk pl ph pm ks oy"/></div></div></a></div></div></div>    
</body>
</html>