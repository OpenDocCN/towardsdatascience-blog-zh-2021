<html>
<head>
<title>Causal Inference in Data Science: Conditional Independence via Propensity Score Adjustment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据科学中的因果推理:通过倾向评分调整的条件独立性</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/causal-inference-in-data-science-conditional-independence-via-propensity-score-adjustment-bbe6d70e2a5?source=collection_archive---------19-----------------------#2021-10-08">https://towardsdatascience.com/causal-inference-in-data-science-conditional-independence-via-propensity-score-adjustment-bbe6d70e2a5?source=collection_archive---------19-----------------------#2021-10-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7371" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">倾向分数的说明和证明，并附有计算模拟</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d6d655a87b13862c4e4d2da933fb9f8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AdGzf1IvMC8U7HLf"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">穆罕默德·拉赫马尼在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="4087" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">1:背景和动机</h1><p id="477c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">因果推理是一个涉及几个领域的领域，并引起了广大从业者的兴趣。这些人包括统计学家、数据科学家、机器学习科学家和其他计算研究人员。</p><p id="2c02" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">到目前为止，我已经写了几篇关于因果推理空间的方法/主题的文章。其中包括:</p><ul class=""><li id="eac0" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/efficient-sampling-frameworks-in-causal-inference-data-science-52ad44e15f48">数据科学中的因果推理:高效的抽样框架&amp;设计</a></li><li id="47ee" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/doubly-robust-estimators-for-causal-inference-in-statistical-estimation-3c00847e9db">数据科学中的因果推断:G方法的双重稳健估计</a></li><li id="b916" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/causal-inference-in-data-science-g-estimation-of-structural-nested-models-d11b1e3c9360">数据科学中的因果推理:结构嵌套模型的G估计</a></li><li id="d53f" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/causal-inference-in-data-science-a-b-testing-and-the-need-for-marginal-structural-modeling-b9ab299681bb">数据科学中的因果推理:A/B测试和边际结构建模的需要</a></li><li id="0a48" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/causal-inference-in-data-science-structure-of-m-bias-with-confounding-adjustment-70e4a263ad08">数据科学中的因果推理:具有混杂调整的M偏差的结构</a></li><li id="6f2e" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/causal-inference-in-data-science-valid-inferential-coverage-with-multiple-comparisons-750e9e3f0259">数据科学中的因果推理:多重比较的有效推理覆盖</a></li><li id="2ae1" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><a class="ae ky" rel="noopener" target="_blank" href="/causal-inference-in-data-science-a-b-testing-randomized-trials-with-covariate-adjustment-f5a24bd023b3">数据科学中的因果推断:A/B检验&amp;带协变量调整的随机试验</a></li></ul><p id="19bc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这篇文章特别关注关于倾向得分的公式和证明。</p><p id="9cf8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">作为一个玩具示例，让我们假设我们有一个二元干预<em class="ng"> A </em>，连续结果<em class="ng"> Y </em>，以及协变量矢量<strong class="lt iu">T23】L</strong>，它们具有以下因果结构(在<em class="ng"> A </em>对<em class="ng"> Y </em>没有因果影响的零假设下):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/f5a8ba196c0e2df0e43e649ddd8d0f95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lvYsLLtr6Pz0NEIlhL4XNw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="401e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们假设我们对恢复对结果<em class="ng"> Y </em>的干预<em class="ng"> A </em>的平均因果差异的无偏估计感兴趣:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/a2a8e00987e78999bf6374f48c50988e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wHOw2xL92UXDd95aRKR-vA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a934" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">从上面的因果DAG可以清楚地看出，干预<em class="ng"> A </em>和结果<em class="ng"> Y </em>是以向量<strong class="lt iu"> <em class="ng"> L </em> </strong>为条件的d分隔。因此，通过因果马尔可夫假设，干预<em class="ng"> A </em>和结果<em class="ng"> Y </em>独立于向量<strong class="lt iu"> <em class="ng"> L </em> </strong>。</p><p id="3497" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这种情况下的倾向得分是以“原因”<strong class="lt iu"> <em class="ng"> L </em> </strong>为条件的干预概率<em class="ng"> A=1 </em>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/4da173640490803fe0db100a57243e24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_IOZNyS8LT5CRJB3SUOpRg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="8be7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在观察环境中，通过仅调节倾向得分来恢复干预<em class="ng"> A </em>对结果<em class="ng"> Y </em>的因果效应的无偏估计的能力在分析和数字上都明显有利。在有些情况下，给定研究中的干预<em class="ng"> A </em>和结果<em class="ng"> Y </em>，可以用比直接在结果模型中包括所有所需协变量<em class="ng"> L </em>更高的数值稳定性来估计倾向得分。通过标量倾向得分的条件独立性也提供了在倾向得分的分级层内匹配干预臂的机会，以实现条件独立性并恢复感兴趣的因果效应。在协变量<em class="ng"> L </em>的大向量的情况下，在由于稀疏性和小样本量而不可能在向量<em class="ng"> L </em>的单个层内匹配的情况下，在倾向得分的层内匹配干预臂可能是可行的。</p><p id="91f3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这篇文章中，我们将表明，在给出的玩具问题的因果结构下，干预<em class="ng"> A </em>和结果<em class="ng"> Y </em>不仅是条件独立的给定向量<strong class="lt iu"> <em class="ng"> L </em> </strong>，而且是条件独立的，仅给定倾向得分本身。</p><p id="8e04" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这篇文章的目录如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/83b9d14875f2d95878c3f329d0719aef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kDI8e5sc1UQ1dwUsrBV9Sg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4bb0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">说到这里，让我们开始吧。</p><h1 id="e4e5" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">2:通过倾向得分证明条件独立性</h1><h2 id="3a6c" class="nl la it bd lb nm nn dn lf no np dp lj ma nq nr ll me ns nt ln mi nu nv lp nw bi translated">2.1:玩具示例的说明和倾向得分</h2><p id="2f43" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们再次具体说明我们的玩具例子:</p><p id="83e4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">假设我们有二元干预<em class="ng"> A </em>，连续结果<em class="ng"> Y </em>，协变量的向量<strong class="lt iu"> <em class="ng"> L </em> </strong>具有如下因果结构(在<em class="ng"> A </em>对<em class="ng"> Y </em>没有因果影响的零假设下):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/f5a8ba196c0e2df0e43e649ddd8d0f95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lvYsLLtr6Pz0NEIlhL4XNw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="48c6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">同样，假设我们对恢复干预<em class="ng"> A </em>对结果<em class="ng"> Y </em>的平均因果差异的无偏估计感兴趣:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/a2a8e00987e78999bf6374f48c50988e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wHOw2xL92UXDd95aRKR-vA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/e92ebed89f7efe898957f87127b286e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2fotGEgQ4rr8bIV_eKpuSQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/30ae27f46b48202de4da6d2ccab45b19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3HPVpMZc1jcdDEf-YyQm8w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a140" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们的目标是证明:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/1634dca250648d2fc2f076e8fc876958.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nTUQK6ATvURsgFdRDfAJkg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="626f" class="nl la it bd lb nm nn dn lf no np dp lj ma nq nr ll me ns nt ln mi nu nv lp nw bi translated">2.2:倾向分数证明方法</h2><p id="1f65" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们来看看下面的可能性:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/cb97f06797f7a45ae1acc71d142e1bd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RZ7J5SRi2vQTWOiVTyfxYg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="f648" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">上面我们有概率<em class="ng"> A=1 </em>取决于倾向得分和结果<em class="ng"> Y </em>。如果事实上情况是<em class="ng"> A </em>和<em class="ng"> Y </em>独立于倾向得分，那么上面的概率因此决不是结果<em class="ng"> Y </em>的函数。</p><p id="2c43" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">因此，如果我们可以证明上述概率绝不是结果<em class="ng"> Y </em>的函数(即除了某个f( <em class="ng"> Y </em>)之外的任何函数)，那么我们已经有效地证明了干预<em class="ng"> A </em>和结果<em class="ng"> Y </em>在给定倾向分数的情况下必须是条件独立的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/e7a7bc3b595781618a74704adf15a279.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6EGNZttMXdPzFwmiNytoaA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="5ca6" class="nl la it bd lb nm nn dn lf no np dp lj ma nq nr ll me ns nt ln mi nu nv lp nw bi translated">2.3:复习迭代期望定律</h2><p id="bdaf" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我们给定倾向分数的条件独立性证明中，我们将在条件期望上利用期望的迭代法则。</p><p id="d076" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">作为复习，我们将证明以下等式:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/d1726aaddb3dc8a774412c90b7c65374.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cln9kdM8nAV9bwkoU780Kw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="8933" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">注意，在下面的证明中，我们假设<em class="ng"> X </em>、<em class="ng"> Y </em>、<em class="ng"> Z </em>和<em class="ng"> S </em>都是离散随机变量。在连续随机变量的情况下，证明将类似地遵循在所讨论的随机变量的支持上的积分，而不是和。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/f24b1f22d5203507feb87ed7494d75b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WeM6-opB6Dk5HV9--pES6Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="d211" class="nl la it bd lb nm nn dn lf no np dp lj ma nq nr ll me ns nt ln mi nu nv lp nw bi translated">2.4:正式证明</h2><p id="89f7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在让我们进行我们的正式证明，即干预<em class="ng"> A </em>和结果<em class="ng"> Y </em>确实是以倾向得分为独立条件的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/8ed081636872e062d3b67395e969c2cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uJQc2afYFuFTDnamOTT67Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="dc40" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">利用期望的迭代法则，我们将在向量<strong class="lt iu"> <em class="ng"> L </em> </strong>上指定附加条件的内部嵌套期望。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/20f005131866953109ecab57d7f34aa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TaDORD-TiuNzHgYE0nM1gw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6887" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们来审视一下内心的期待。我们有以倾向分数为条件的预期干预值<em class="ng"> A </em>，结果<em class="ng"> Y </em>，向量<strong class="lt iu">L</strong>。注意，倾向得分完全是向量<strong class="lt iu"><em class="ng"/></strong>的函数，并且在这个意义上是<strong class="lt iu"> <em class="ng"> L </em> </strong>的“更粗糙”版本。假设<strong class="lt iu"> <em class="ng"> L </em> </strong>已经存在于条件语句中，倾向得分没有添加额外的信息，因此可以从预期中删除:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/8f180a082c57a6f9b90e18e2076d76c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oy4CQI4GzFuCZQ_ZpUUkHg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="54de" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们现在有:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/937cea76a55a8c070d4b92be9d16a0c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cnYwvdwfSWyMtbs8NDzeTw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4506" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们再次审视内心的期待。我们有干预的期望值<em class="ng"> A </em>以结果<em class="ng"> Y </em>和向量<em class="ng"> L </em>为条件。回想一下空值下的因果DAG，根据定义，干预<em class="ng"> A </em>独立于结果<em class="ng"> Y </em>以向量<strong class="lt iu">LT13】为条件:</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/7bb75d38abb1f0bb226d0be5aa27eec0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Efb26-HdqRQQGTdpc8B_Uw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="ece0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">因此，根据定义，outcome <em class="ng"> Y </em>不会向内部条件期望添加额外的信息，并且可以被删除:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/47f3cb18c378e2ba4b189b180ca9a0b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d_meOXQTvG_iresTOj_xhQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="04ec" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">因此，我们有:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/e0e88a2119bf7545a388a2ef7ad0aea5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xXP0A0DpKSoYBCxR3P3BDQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="20e2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们再次审视内心的期待。我们有期望的干预值<em class="ng">一个</em>条件向量<strong class="lt iu"> <em class="ng"> L </em> </strong>。请注意，根据定义，这种预期是我们的倾向得分:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/fdaecaa8249a15de5dce5b1ceefd7729.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IcwN74pgg9QbIhMyl5dyAA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b852" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">因此，我们有:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/b470801b82b48985bd2d33f808c84bb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cTzrLiDov-yU674zlP5MsQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6651" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在证明的这一点上，我们有了以倾向得分和结果<em class="ng"> Y </em>为条件的倾向得分的期望值。以自身为条件的倾向得分的期望值实际上等同于恢复常数的期望值(根据定义，常数本身就是常数)。假设我们以一个常数为条件，在这种情况下，我们也以结果<em class="ng"> Y </em>为条件的事实是不相关的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/e4577e2e715159cb29c6bd34ceee9b02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FMp0-dMZ5sFSXQp80-RIPQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b192" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">因此，我们有:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/c5a84bd61726384a63937a7bed4f1a91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E9Xe_Nx05lXpqxWkMs-RXw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/faffdf8473de0d50b1fece35c05b0be7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n3mmfl8mWric-kDUjDfBCA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="a3f4" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">3:计算模拟</h1><p id="9189" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们现在将在Python中进行计算模拟，通过调节倾向得分来研究二元干预A对连续结果Y的因果效应差异的无偏估计的恢复</p><ol class=""><li id="7ec9" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm op my mz na bi translated">创建一个具有真实因果DAG的模拟数据集，如下图<em class="ng">图1 </em>所示，真实因果效应差<em class="ng"> A </em>对<em class="ng"> Y </em>为2.3</li><li id="58d7" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm op my mz na bi translated">通过对结果模型中的全向量<strong class="lt iu"> <em class="ng"> L </em> </strong>进行调节，恢复因果效应差异的无偏估计</li><li id="2f0e" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm op my mz na bi translated">估计倾向得分，并通过仅调节结果模型中的倾向得分来恢复因果效应差异的无偏估计</li></ol><p id="a32f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们从加载我们的库开始:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="2a1c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">，一个模拟数据集的函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="5e2d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">…以及单变量、多变量和倾向评分方法的函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="54f6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">指定了我们的函数后，我们就可以进行计算模拟了。</p><p id="b732" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们从恢复模拟数据集开始:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="a335" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们以干预<em class="ng">和</em>作为唯一输入，对结果模型进行单变量回归:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="7742" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如上述结果所示，A对Y的因果效应差异估计为-3.1027。这显然是一个有偏差的估计，因为我们知道真正的因果效应差是2.3。鉴于我们玩具问题的因果结构，这一发现也并不令人惊讶(如图<em class="ng">图1 </em>所示)。我们知道A和Y不是边际独立的。</p><p id="46cc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在让我们执行结果模型的多变量回归，以<em class="ng"> A </em>和矢量<strong class="lt iu">T3】LT5为条件:</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="1b17" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如以上结果所示，现在估计<em class="ng"> A </em>对<em class="ng"> Y </em>的因果效应差为2.3022。这似乎是真实因果效应差异的无偏估计。给定<em class="ng"> A </em>和<em class="ng"> Y </em>在向量<strong class="lt iu"> <em class="ng"> L </em> </strong>上是d分离的条件，这一发现同样不令人惊讶。</p><p id="d714" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在让我们看看我们是否可以复制相同的结果，但是通过仅将结果模型限制在倾向得分上，而不是全向量<strong class="lt iu"> <em class="ng"> L </em> </strong>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="067d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如上述结果所示，A<em class="ng">对Y </em>的因果效应差估计为2.3059。这也是真实因果效应差异的无偏估计。</p><p id="42ac" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">以上计算模拟的完整代码/笔记本，请看下面的<a class="ae ky" href="https://github.com/atrothman/Propensity-Score-Simulation-" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> github链接</strong> </a>。</p><h1 id="1307" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">4.总结和结论</h1><p id="249a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这总结了我们的推导和利用倾向评分模型的计算模拟。我鼓励读者使用我的代码(通过上面的github链接)作为起点，并创建自己的模拟来进行实验。</p><p id="2b3d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你想了解更多关于因果推理的方法和注意事项，我会推荐哈佛大学Miguel Hernan和Jamie Robins(我以前的两位教授)的教科书“<em class="ng">因果推理:如果</em>会怎样”，加州大学洛杉矶分校的Judea Pearl的教科书“<em class="ng">因果关系</em>，斯坦福大学的达芙妮·黑仔和耶路撒冷希伯来大学的Nir Friedman的教科书“<em class="ng">概率图形模型:原理和技术</em>，以及加州大学的Mark van der Laan的两本关于<em class="ng">目标最大似然估计</em>的教科书</p><p id="afec" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><a class="ae ky" href="https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/" rel="noopener ugc nofollow" target="_blank">因果推断:如果</a>会怎样</p><p id="9d22" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><a class="ae ky" href="http://bayes.cs.ucla.edu/BOOK-2K/" rel="noopener ugc nofollow" target="_blank">因果关系</a></p><p id="454a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><a class="ae ky" href="https://mitpress.mit.edu/books/probabilistic-graphical-models" rel="noopener ugc nofollow" target="_blank">概率图形模型:原理和技术</a></p><p id="7519" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><a class="ae ky" href="https://vanderlaan-lab.org/papers/" rel="noopener ugc nofollow" target="_blank">目标最大似然估计</a></p><p id="9048" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一如既往，以后还会继续写类似的小品。请<a class="ae ky" href="https://anr248.medium.com/" rel="noopener"> <strong class="lt iu">订阅并关注我在</strong> </a>和<a class="ae ky" href="http://www.linkedin.com/in/andrew-rothman-49739630" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> LinkedIn </strong> </a>上的更新！</p></div></div>    
</body>
</html>