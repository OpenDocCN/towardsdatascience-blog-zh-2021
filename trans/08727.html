<html>
<head>
<title>7 Tips to Level up Your Python Code for Data Science</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">提升数据科学Python代码的7个技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/7-tips-to-level-up-your-python-code-for-data-science-4a64dbccd86d?source=collection_archive---------6-----------------------#2021-08-12">https://towardsdatascience.com/7-tips-to-level-up-your-python-code-for-data-science-4a64dbccd86d?source=collection_archive---------6-----------------------#2021-08-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f1fa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让你的生活更轻松</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3ffc8a76b1681edf39ecfa3348c4c5c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2r0bM47v9Zx7y31LwBFyQQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://pixabay.com/users/rodrigomullercwb-6282127/" rel="noopener ugc nofollow" target="_blank"> rodrigomullercwb </a>在<a class="ae ky" href="https://pixabay.com/photos/super-mario-mario-mario-bros-2690254/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上拍摄</p></figure><p id="97de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">开始时编写Python代码很容易，但是随着您向工具箱中添加更多的库，您的脚本可能会包含不必要的代码行，变得很长，看起来很乱。尽管代码仍然可以完成工作，但从长远来看，它会给你带来一些麻烦。</p><p id="9d16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我是在多次用Python清洗、扯皮、做数据分析之后，才知道这一点的。幸运的是，这些年来我的Python代码一直在改进，在本文中，我将与您分享7个技巧来提高您的Python代码水平，并使您在使用Python进行数据科学时更加轻松。</p><p id="f235" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这涵盖了我们每天做的事情，比如修改熊猫数据帧中的值、连接字符串、读取文件等等！</p><h1 id="b327" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">1.使用Lambda修改熊猫数据帧中的值</h1><p id="34b2" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">假设我们有下面的<code class="fe ms mt mu mv b">df</code>数据帧。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="3dc2" class="na lw it mv b gy nb nc l nd ne">data = [[1,2,3], [4,5,6], [7,8,9]]<br/>df = pd.DataFrame(data, columns=[0,1,2])</span><span id="cb55" class="na lw it mv b gy nf nc l nd ne">IN[1]: print (df)</span><span id="6287" class="na lw it mv b gy nf nc l nd ne">OUT[1]:    <strong class="mv iu">0  1  2</strong><br/>        <strong class="mv iu">0</strong>  1  2  3<br/>        <strong class="mv iu">1</strong>  4  5  6<br/>        <strong class="mv iu">2</strong>  7  8  9</span></pre><p id="9a1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在出于某种原因，您需要将值<code class="fe ms mt mu mv b">‘01’</code>加到列<code class="fe ms mt mu mv b">0</code>中的数字上。一种常见的方法是定义一个执行此任务的函数，然后使用<code class="fe ms mt mu mv b">apply</code>函数来修改列的值。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="b9b8" class="na lw it mv b gy nb nc l nd ne"><strong class="mv iu">def</strong> add_numbers(x):<br/>    <strong class="mv iu">return</strong> <!-- -->f'{x}01'</span><span id="175d" class="na lw it mv b gy nf nc l nd ne">df[0] = df[0].apply(add_numbers)</span><span id="29c7" class="na lw it mv b gy nf nc l nd ne">IN[1]: print (df)</span><span id="2e2d" class="na lw it mv b gy nf nc l nd ne">OUT[1]:     <strong class="mv iu">0   1   2</strong><br/>        <strong class="mv iu">0</strong>  101  2   3<br/>        <strong class="mv iu">1</strong>  401  5   6<br/>        <strong class="mv iu">2</strong>  701  8   9</span></pre><p id="13e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这并不复杂，但是为您需要在数据帧中进行的每个更改创建一个函数是不实际的。这就是lambda派上用场的时候了。</p><p id="6cb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">lambda函数类似于常规的Python函数，但是它可以在没有名称的情况下定义，这使得它成为一个看起来很不错的一行程序。前面使用的代码可以用下面的代码来简化。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="63d8" class="na lw it mv b gy nb nc l nd ne">df[0] = df[0].apply(<strong class="mv iu">lambda</strong> x:f'{x}01')</span></pre><p id="e743" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您不知道是否有可能访问一个系列的属性来修改数据时，Lambda变得非常有用。</p><p id="08d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设列<code class="fe ms mt mu mv b">0</code>包含字母，我们想将它们大写。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="f2dd" class="na lw it mv b gy nb nc l nd ne"># if you know the existence of the .str, you can do it this way<br/>df[0] = df[0].str.title()</span><span id="0473" class="na lw it mv b gy nf nc l nd ne"># if you don't know about .str, you can still capitalize with lambda<br/>df[0] = df[0].apply(<strong class="mv iu">lambda</strong> x: x.title())</span></pre><h1 id="2a38" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">2.使用f字符串连接字符串</h1><p id="24f5" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">字符串连接是Python中非常常见的操作，可以用不同的方式完成。最常见的方法是使用<code class="fe ms mt mu mv b">+</code>运算符；然而，这个操作符的一个大问题是我们不能在字符串之间添加任何分隔符。</p><p id="8b42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，如果您想要连接“Hello”和“World”，一个典型的解决方法是添加一个空格分隔符(" ")。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="3bf1" class="na lw it mv b gy nb nc l nd ne">print("Hello" + " " + "World")</span></pre><p id="5743" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就完成了工作，但是为了编写更可读的代码，我们可以用f字符串来代替它。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="7c76" class="na lw it mv b gy nb nc l nd ne">IN[2]: print(f'Hello World')<br/>OUT[2]: "Hello World"</span></pre><p id="e40c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在一个基本的例子中，这似乎是不必要的，但是当涉及到连接多个值时(正如您将在技巧#3中看到的)，f字符串将使您免于编写<code class="fe ms mt mu mv b">+ “ “ +</code>很多次。我不知道过去我写了多少次<code class="fe ms mt mu mv b">+</code>操作符，但是现在没有了！</p><p id="8cff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">连接字符串的其他方法是使用<code class="fe ms mt mu mv b">join()</code>方法或<code class="fe ms mt mu mv b">format()</code>函数，但是f-string在字符串连接方面做得更好。</p><h1 id="ca29" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">3.用Zip()函数遍历多个列表</h1><p id="c939" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">你有没有想过在Python中遍历多个列表？当你有两个列表时，你可以用<code class="fe ms mt mu mv b">enumerate</code>来完成。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="b1c9" class="na lw it mv b gy nb nc l nd ne">teams = ['Barcelona', 'Bayern Munich', 'Chelsea']<br/>leagues = ['La Liga', 'Bundesliga', 'Premiere League']</span><span id="3f2e" class="na lw it mv b gy nf nc l nd ne"><strong class="mv iu">for</strong> i, team <strong class="mv iu">in</strong> enumerate(teams):<br/>    league = leagues[i]<br/>    print(f'{team} plays in {league}')</span></pre><p id="476e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，当你有两个或更多的列表时，这就变得不切实际了。更好的方法是使用<code class="fe ms mt mu mv b">zip()</code>功能。<code class="fe ms mt mu mv b">zip()</code>函数获取可重复项，将它们聚集在一个元组中，然后返回。</p><p id="0556" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">再加一个单子，看看<code class="fe ms mt mu mv b">zip()</code>的威力！</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="54e4" class="na lw it mv b gy nb nc l nd ne">teams = ['Barcelona', 'Bayern Munich', 'Chelsea']<br/>leagues = ['La Liga', 'Bundesliga', 'Premiere League']<br/>countries = ['Spain', 'Germany', 'UK']</span><span id="8df7" class="na lw it mv b gy nf nc l nd ne"><strong class="mv iu">for</strong> team, league, country <strong class="mv iu">in</strong> zip(teams, leagues, countries):<br/>    print(f'{team} plays in {league}. Country: {country}')</span></pre><p id="ecef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面代码的输出如下。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="2654" class="na lw it mv b gy nb nc l nd ne">Barcelona plays in La Liga. Country: Spain<br/>Bayern Munich plays in Bundesliga. Country: Germany<br/>Chelsea plays in Premiere League. Country: UK</span></pre><p id="44d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你注意到我们在这个例子中使用了f弦吗？代码变得可读性更强了，不是吗？</p><h1 id="9f77" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">4.使用列表理解</h1><p id="69b7" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">清理和争论数据的一个常见步骤是修改现有列表。假设我们有以下需要大写的列表。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="444b" class="na lw it mv b gy nb nc l nd ne">words = ['california', 'florida', 'texas']</span></pre><p id="3fbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大写<code class="fe ms mt mu mv b">words</code>列表中每个元素的典型方法是创建一个新的<code class="fe ms mt mu mv b">capitalized</code>列表，执行一个<code class="fe ms mt mu mv b">for</code>循环，使用<code class="fe ms mt mu mv b">.title()</code>，然后将每个修改后的值追加到新列表中。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="d225" class="na lw it mv b gy nb nc l nd ne">capitalized = []<br/><strong class="mv iu">for</strong> word <strong class="mv iu">in</strong> words:<br/>    capitalized.append(word.title())</span></pre><p id="c603" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，Pythonic式的方法是使用列表理解。列表理解有一个制作列表的优雅方法。</p><p id="0754" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以用一行代码重写上面的<code class="fe ms mt mu mv b">for</code>循环:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="40b4" class="na lw it mv b gy nb nc l nd ne">capitalized = [word.title() for word in words]</span></pre><p id="f943" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你所看到的，我们可以跳过第一个例子中的一些步骤，结果是一样的。</p><h1 id="1a18" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">5.对文件对象使用With语句</h1><p id="0f6d" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">当我们处理一个项目时，我们经常读写数据到文件中。最常见的方法是使用<code class="fe ms mt mu mv b">open()</code>函数打开一个文件，这将创建一个我们可以操作的文件对象，然后作为一个好的实践，我们应该使用<code class="fe ms mt mu mv b">close()</code>关闭文件对象</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="bc16" class="na lw it mv b gy nb nc l nd ne">f = open('dataset.txt', 'w')<br/>f.write('new_data')<br/>f.close()</span></pre><p id="2212" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这很容易记住，但有时在编写代码几个小时后，我们可能会忘记用<code class="fe ms mt mu mv b">f.close()</code>关闭<code class="fe ms mt mu mv b">f</code>文件。这时<code class="fe ms mt mu mv b">with</code>语句就派上用场了。<code class="fe ms mt mu mv b">with</code>语句将自动关闭文件对象<code class="fe ms mt mu mv b">f</code>，如下图所示。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="f9a6" class="na lw it mv b gy nb nc l nd ne">with open('dataset.txt', 'w') as f:<br/>    f.write('new_data')</span></pre><p id="ea91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，我们可以保持代码简短。</p><p id="92d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然你不需要这个来读取CSV文件，因为你可以很容易地用熊猫<code class="fe ms mt mu mv b">pd.read_csv()</code>来读取它们，但这在读取其他类型的文件时仍然很有用。例如，我经常在腌制物品时使用它。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="a408" class="na lw it mv b gy nb nc l nd ne">import pickle</span><span id="db6c" class="na lw it mv b gy nf nc l nd ne"># read dataset from pickle file<br/>with open(‘test’, ‘rb’) as input:<br/>    data = pickle.load(input)</span></pre><h1 id="312c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">6.停止使用方括号来获取词典条目。使用。请改为get()</h1><p id="9f24" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">假设你有下面的字典:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="13bd" class="na lw it mv b gy nb nc l nd ne">person = {'name': 'J<!-- -->ohn<!-- -->', 'age': 20}</span></pre><p id="851c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分别做<code class="fe ms mt mu mv b">person[name]</code>和<code class="fe ms mt mu mv b">person[age] </code>我们很容易得到姓名和年龄。然而，如果出于某种原因，我们想得到一个不存在的键，像<code class="fe ms mt mu mv b">'salary',</code>运行<code class="fe ms mt mu mv b">person[salary]</code>将提高一个<code class="fe ms mt mu mv b">KeyError</code>。</p><p id="80b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是<code class="fe ms mt mu mv b">get()</code>方法有用的时候。如果关键字在字典中，那么<code class="fe ms mt mu mv b">get()</code>方法返回指定关键字的值，但是如果没有找到关键字，Python将返回<code class="fe ms mt mu mv b">None</code>。多亏了这一点，你的代码不会中断。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="677f" class="na lw it mv b gy nb nc l nd ne">person = {'name': 'J<!-- -->ohn<!-- -->', 'age': 20}</span><span id="0bc8" class="na lw it mv b gy nf nc l nd ne">print('Name: ', person.get('name'))<br/>print('Age: ', person.get('age'))<br/>print('Salary: ', person.get('salary'))</span></pre><p id="29a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出如下所示。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="0646" class="na lw it mv b gy nb nc l nd ne">Name:  <!-- -->J<!-- -->ohn<br/>Age:  20<br/>Salary:  None</span></pre><h1 id="0f4d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">额外收获:多重任务</h1><p id="0546" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">您是否曾经想要减少用于创建多个变量、列表或字典的代码行？嗯，你可以很容易地用多重作业来完成。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="16be" class="na lw it mv b gy nb nc l nd ne"># instead of doing <br/>a = 1<br/>b = 2<br/>c = 3</span><span id="531d" class="na lw it mv b gy nf nc l nd ne"># you can do<br/>a, b, c = 1, 2, 3</span><span id="664f" class="na lw it mv b gy nf nc l nd ne"># instead of creating multiple lists in different lines<br/>data_1 = []<br/>data_2 = []<br/>data_3 = []<br/>data_3 = []</span><span id="493d" class="na lw it mv b gy nf nc l nd ne"># you can create them in one line with multiple assignments<br/>data_1, data_2, data_3, data_4 = [], [], [], []</span><span id="b397" class="na lw it mv b gy nf nc l nd ne"># or use list comprehension<br/>data_1, data_2, data_3, data_4 = [[] for i in range(4)]</span></pre></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><p id="60c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nn">就是这样！明智地使用这7个技巧来提升你的Python代码。</em></p><p id="f69b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://frankandrade.ck.page/bd063ff2d3" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">与3k以上的人一起加入我的电子邮件列表，获取我在所有教程中使用的Python for Data Science备忘单(免费PDF) </strong> </a></p><p id="c153" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢阅读这样的故事，并想支持我成为一名作家，可以考虑<a class="ae ky" href="https://frank-andrade.medium.com/membership" rel="noopener">注册成为一名媒体会员</a>。每月5美元，你可以无限制地阅读媒体上的故事。如果你用<a class="ae ky" href="https://frank-andrade.medium.com/membership" rel="noopener">我的链接</a>注册，我会赚一小笔佣金。</p><div class="no np gp gr nq nr"><a href="https://frank-andrade.medium.com/membership" rel="noopener follow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">阅读弗兰克·安德拉德(以及媒体上成千上万的其他作家)的每一个故事</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">frank-andrade.medium.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of ks nr"/></div></div></a></div></div></div>    
</body>
</html>