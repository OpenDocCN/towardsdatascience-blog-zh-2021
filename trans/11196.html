<html>
<head>
<title>Tutorial: Create a Python CLI Package via Traitlets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:通过Traitlets创建Python CLI包</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tutorial-create-a-python-cli-package-a2410b47af35?source=collection_archive---------13-----------------------#2021-11-02">https://towardsdatascience.com/tutorial-create-a-python-cli-package-a2410b47af35?source=collection_archive---------13-----------------------#2021-11-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bb98" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用<code class="fe kf kg kh ki b">traitlets</code>开发一个简单的、面向对象的命令行包</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/9d7245f13f0ce2baec6ee90953cd556d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oKJao7LUOqpO_0Jm"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://www.pexels.com/@sora-shimazaki?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">黑脸田鸡岛崎</a>从<a class="ae kz" href="https://www.pexels.com/photo/crop-cyber-spy-hacking-system-while-typing-on-laptop-5935794/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>拍摄</p></figure><p id="bd7d" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir">如果你像我一样… </strong></p><ul class=""><li id="cf0d" class="lw lx iq lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">您喜欢编写脚本来加快工作流程</li><li id="70ce" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">你的Python很流利，其他基本不会。</li></ul><p id="8325" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">令人恼火的是，python在终端中感觉有点笨拙。</p><p id="047e" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">如果您想从命令行运行python脚本，您需要…</p><ul class=""><li id="38bb" class="lw lx iq lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">给每个不可能记住的脚本<em class="mk">分配一个不同的命令(通常是bash别名</em></li><li id="4e53" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">使用<code class="fe kf kg kh ki b">sys</code> python包从头开始解析命令行参数<em class="mk"> gross </em></li><li id="a7ff" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">用<code class="fe kf kg kh ki b">argparse</code>解析命令行，用<code class="fe kf kg kh ki b">if/else</code>检查激活每个功能。<em class="mk">亦作gross </em></li></ul><p id="191a" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">好在这个问题有解决的办法！它叫做<code class="fe kf kg kh ki b">traitlets</code>。</p><h2 id="b7f5" class="ml mm iq bd mn mo mp dn mq mr ms dp mt lj mu mv mw ln mx my mz lr na nb nc nd bi translated">什么是traitlets？</h2><p id="1937" class="pw-post-body-paragraph la lb iq lc b ld ne jr lf lg nf ju li lj ng ll lm ln nh lp lq lr ni lt lu lv ij bi translated">Traitlets由IPython创建，用于验证数据类型、监控变量的变化、解析和实现配置文件中的应用程序设置，以及从命令行激活Python代码。对于IPython和Jupyter项目生产的许多软件来说，它充当了一种幕后引擎的角色。现在，我们将关注traitlets的两个元素。</p><ol class=""><li id="575d" class="lw lx iq lc b ld le lg lh lj ly ln lz lr ma lv nj mc md me bi translated">从命令行激活python代码</li><li id="c842" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">可配置变量</li></ol><h1 id="b58d" class="nk mm iq bd mn nl nm nn mq no np nq mt jw nr jx mw jz ns ka mz kc nt kd nc nu bi translated">目标</h1><p id="ccc2" class="pw-post-body-paragraph la lb iq lc b ld ne jr lf lg nf ju li lj ng ll lm ln nh lp lq lr ni lt lu lv ij bi translated">在本文中，我将逐步构建一个简单的<code class="fe kf kg kh ki b">traitlets</code>应用程序。有了这些知识，你将能够编写一个命令行程序</p><ul class=""><li id="7999" class="lw lx iq lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">完全是用python写的。</li><li id="61b9" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">为单个CLI命令分配多个工具。</li><li id="f293" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">可以通过命令行或系统配置文件轻松配置。(您不必编写代码来解析配置数据🤩)</li><li id="b8b3" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">具有直接面向对象的编程结构。</li></ul><p id="806f" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir"> <em class="mk">项目代码:</em> </strong></p><ul class=""><li id="e029" class="lw lx iq lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">如果你想自己编写项目代码，<a class="ae kz" href="https://github.com/joelsewhere/traitlets_cli_blog" rel="noopener ugc nofollow" target="_blank">这个github库</a>包含了所有的项目文件。每个文件中的代码已被替换为指导性注释。</li><li id="c3db" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">完成的项目代码可在处<a class="ae kz" href="https://github.com/joelsewhere/traitlets_cli_blog/tree/solution" rel="noopener ugc nofollow" target="_blank">找到。(代码存储在github库的<code class="fe kf kg kh ki b">solution</code>分支上。如果您已经克隆了存储库，那么您可以运行<code class="fe kf kg kh ki b">git checkout solution</code>来访问您计算机上的代码。)</a></li></ul><h1 id="89ef" class="nk mm iq bd mn nl nm nn mq no np nq mt jw nr jx mw jz ns ka mz kc nt kd nc nu bi translated">我们在建造什么？</h1><p id="5c0e" class="pw-post-body-paragraph la lb iq lc b ld ne jr lf lg nf ju li lj ng ll lm ln nh lp lq lr ni lt lu lv ij bi translated">首先让我们看看成品是什么样的…</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/86c7180b88ab9599e37d81a2fab41622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*bPWeGsZcgSRjgY1Jub2eLw.gif"/></div></figure><p id="acf5" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">这个应用程序有两个命令。</p><p id="b3cf" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><code class="fe kf kg kh ki b"><strong class="lc ir">greet</strong></code></p><p id="3dca" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">当这个命令运行时<strong class="lc ir"><em class="mk">“Hello，World！”被打印到</em>端子</strong>。</p><p id="a265" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">该命令有<strong class="lc ir">参数</strong> <code class="fe kf kg kh ki b">--greeting</code>、<code class="fe kf kg kh ki b">--name</code>和<code class="fe kf kg kh ki b">--punctuation</code>，允许您更改打印的信息。</p><p id="295a" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><code class="fe kf kg kh ki b"><strong class="lc ir">abs</strong></code></p><p id="00ab" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">当运行此命令<strong class="lc ir"> <em class="mk">时，提供的文件名的绝对路径被打印到终端。</em> </strong></p><p id="7213" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">该命令有<strong class="lc ir">标志</strong>T7。使用该标志时，<strong class="lc ir"> <em class="mk">除了绝对路径外，还打印文件大小(以字节为单位)。</em>T29】</strong></p><p id="7c66" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">该项目的<strong class="lc ir">目录结构</strong>如下所示:</p><pre class="kk kl km kn gt nw ki nx ny aw nz bi"><span id="7642" class="ml mm iq ki b gy oa ob l oc od">subapps/ &lt;------------- All "command" code-files are placed here<br/>     AbsApp.py  &lt;------ Code for the `abs` command<br/>     GreetingApp.py &lt;-- Code for the `greet` command<br/>     __init__.py &lt;----- Set up for easy importing<br/>CLIapp.py &lt;------------ Code for CLI activation</span></pre><p id="8f6b" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">好吧，我们来写点代码。</p><h1 id="4a1a" class="nk mm iq bd mn nl nm nn mq no np nq mt jw nr jx mw jz ns ka mz kc nt kd nc nu bi translated">GreetApp.py</h1><p id="69a9" class="pw-post-body-paragraph la lb iq lc b ld ne jr lf lg nf ju li lj ng ll lm ln nh lp lq lr ni lt lu lv ij bi translated">导航到项目文件夹的<code class="fe kf kg kh ki b">subapps/</code>目录，打开<code class="fe kf kg kh ki b">GreetApp.py</code>文件。</p><p id="b794" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我们将需要这个文件的两个导入。</p><ol class=""><li id="38f5" class="lw lx iq lc b ld le lg lh lj ly ln lz lr ma lv nj mc md me bi translated"><code class="fe kf kg kh ki b">from traitlets.config import Application</code></li><li id="997a" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated"><code class="fe kf kg kh ki b">from traitlets import Unicode</code></li></ol><p id="1ea1" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在继续之前，让我们快速分解一下这两个导入。</p><p id="a5c0" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir">导入#1 —应用</strong></p><p id="4f16" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">是我们将在这个项目中编写的每个类的“父类”。<code class="fe kf kg kh ki b">Application</code>对象提供了大量有用的工具，例如<a class="ae kz" href="https://github.com/ipython/traitlets/blob/f24879c16059b34b89c3fe5cb34cf72001fa9b18/traitlets/config/application.py#L670" rel="noopener ugc nofollow" target="_blank">解析命令行</a>、<a class="ae kz" href="https://github.com/ipython/traitlets/blob/f24879c16059b34b89c3fe5cb34cf72001fa9b18/traitlets/config/application.py#L772" rel="noopener ugc nofollow" target="_blank">加载配置文件</a>、<a class="ae kz" href="https://github.com/ipython/traitlets/blob/f24879c16059b34b89c3fe5cb34cf72001fa9b18/traitlets/config/application.py#L824" rel="noopener ugc nofollow" target="_blank">生成配置文件</a>、<a class="ae kz" href="https://github.com/ipython/traitlets/blob/f24879c16059b34b89c3fe5cb34cf72001fa9b18/traitlets/config/application.py#L544" rel="noopener ugc nofollow" target="_blank">自动生成代码文档</a>等等。在本教程中，我们将关注<code class="fe kf kg kh ki b">Application</code>对象解析命令行和激活应用程序代码的方法。</p><p id="2277" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir">导入#2 — Unicode </strong></p><p id="d4a6" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><code class="fe kf kg kh ki b">Unicode</code>是一款traitlets <strong class="lc ir">型。</strong></p><ul class=""><li id="8197" class="lw lx iq lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">C <a class="ae kz" href="https://traitlets.readthedocs.io/en/stable/using_traitlets.html" rel="noopener ugc nofollow" target="_blank"> ode类型的例子。</a></li><li id="4a4f" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">所有可用类型的列表。</li></ul><p id="327f" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">Traitlets类型是<a class="ae kz" href="https://www.tutorialsteacher.com/articles/class-attributes-vs-instance-attributes-in-python#:~:text=Class%20attributes%20are%20the%20variables,are%20defined%20in%20the%20constructor." rel="noopener ugc nofollow" target="_blank">类属性</a>，当被定义时，防止属性被分配给不正确的数据类型。当参数<code class="fe kf kg kh ki b">config=True</code>被添加到类型中时，变量变得可配置，这意味着属性的默认值可以通过命令行参数或通过在配置文件中设置所需的默认值来更改。</p><h1 id="7098" class="nk mm iq bd mn nl nm nn mq no np nq mt jw nr jx mw jz ns ka mz kc nt kd nc nu bi translated">定义可配置变量。</h1><p id="2510" class="pw-post-body-paragraph la lb iq lc b ld ne jr lf lg nf ju li lj ng ll lm ln nh lp lq lr ni lt lu lv ij bi translated">在下面的代码单元格中，我们…</p><ol class=""><li id="57e1" class="lw lx iq lc b ld le lg lh lj ly ln lz lr ma lv nj mc md me bi translated">导入<code class="fe kf kg kh ki b">Application</code>和<code class="fe kf kg kh ki b">Unicode</code>对象</li><li id="cf1d" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">定义<code class="fe kf kg kh ki b">GreetApp</code>类</li><li id="044a" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">从<code class="fe kf kg kh ki b">Application</code>父类继承</li><li id="c9d4" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">用默认设置定义类型变量。</li><li id="7b01" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">将变量标记为可配置的</li></ol><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="d9a0" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir">现在让我们创建</strong> <code class="fe kf kg kh ki b"><strong class="lc ir"><em class="mk">start</em></strong></code> <strong class="lc ir">方法</strong></p><p id="dda7" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><code class="fe kf kg kh ki b">start</code>方法是激活应用程序功能的地方。</p><p id="4dc4" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir">在下面的代码块中，我们……</strong></p><ol class=""><li id="8240" class="lw lx iq lc b ld le lg lh lj ly ln lz lr ma lv nj mc md me bi translated">定义一个<code class="fe kf kg kh ki b">start</code>方法</li><li id="65c6" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">激活应用程序功能</li></ol><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oe of l"/></div></figure><h1 id="8a3a" class="nk mm iq bd mn nl nm nn mq no np nq mt jw nr jx mw jz ns ka mz kc nt kd nc nu bi translated">命令行别名</h1><p id="600c" class="pw-post-body-paragraph la lb iq lc b ld ne jr lf lg nf ju li lj ng ll lm ln nh lp lq lr ni lt lu lv ij bi translated">从技术上来说，我们<em class="mk">可以</em>让应用程序像这样运行，但是改变可配置变量对用户来说有点烦人。</p><p id="d0bd" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">现在，用户不必运行<code class="fe kf kg kh ki b">--greeting='Hi'</code>来将问候配置变量更改为<code class="fe kf kg kh ki b">'Hi'</code>，而是必须运行:</p><pre class="kk kl km kn gt nw ki nx ny aw nz bi"><span id="d949" class="ml mm iq ki b gy oa ob l oc od">--GreetApp.greeting='Hi'</span></pre><p id="c0db" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">为了使这更容易，我们必须创建一个<code class="fe kf kg kh ki b">aliases</code>类属性。该属性由<code class="fe kf kg kh ki b">Application</code>父类在解析命令行时使用。</p><p id="74b2" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir">在下面的代码块中，我们……</strong></p><ol class=""><li id="d3ec" class="lw lx iq lc b ld le lg lh lj ly ln lz lr ma lv nj mc md me bi translated">定义包含我们别名的字典</li><li id="0c62" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">将字典键设置为我们想要使用的命令行参数</li><li id="b2c2" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">将值设置为我们想要配置的<code class="fe kf kg kh ki b">Application</code>孩子的名字</li><li id="76e6" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">阐明我们想要改变的可配置变量</li><li id="7e6f" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">将<code class="fe kf kg kh ki b">aliases</code>类特征设置为别名字典</li></ol><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="ecff" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir"/><code class="fe kf kg kh ki b"><strong class="lc ir">GreetApp</strong></code><strong class="lc ir">搞定了！</strong></p><blockquote class="og oh oi"><p id="2a79" class="la lb mk lc b ld le jr lf lg lh ju li oj lk ll lm ok lo lp lq ol ls lt lu lv ij bi translated">我们还可以向这个应用程序添加一些其他的东西，这些将在后续文章“如何自动生成文档”中介绍如果你正在处理自己编写的文件，现在跳过未填写的部分。对于本文，它们不是必需的。</p></blockquote><h1 id="65a0" class="nk mm iq bd mn nl nm nn mq no np nq mt jw nr jx mw jz ns ka mz kc nt kd nc nu bi translated">主要功能</h1><p id="d4dd" class="pw-post-body-paragraph la lb iq lc b ld ne jr lf lg nf ju li lj ng ll lm ln nh lp lq lr ni lt lu lv ij bi translated">现在我们已经完成了一个应用程序，我们需要设置激活代码的<code class="fe kf kg kh ki b">main</code>函数。这个过程将由<code class="fe kf kg kh ki b">CLIapp.py</code>文件处理。</p><p id="e8e3" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">导航到<code class="fe kf kg kh ki b">CLIapp.py</code>文件。</p><p id="e88d" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">对于这个文件，我们将需要以下导入。</p><ol class=""><li id="0447" class="lw lx iq lc b ld le lg lh lj ly ln lz lr ma lv nj mc md me bi translated"><code class="fe kf kg kh ki b">from traitlets.config import Application</code></li><li id="df3d" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated"><code class="fe kf kg kh ki b">from subapps import GreetApp</code> <em class="mk">(我们刚刚写的应用对象！)</em></li></ol><p id="4b1a" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><code class="fe kf kg kh ki b">Application</code>对象有一个名为<code class="fe kf kg kh ki b">subcommands</code>的属性，允许你附加激活特定应用程序的命令。在这个文件中，我们将定义一个名为<code class="fe kf kg kh ki b">CLIapp</code>的应用程序，它包含一个子命令字典，以及一个用于激活<em class="mk">子命令的</em> <code class="fe kf kg kh ki b">start</code>方法的启动方法。<strong class="lc ir"><em class="mk">TL；DR</em></strong><code class="fe kf kg kh ki b">CLIapp</code>是一个应用程序，其唯一目的是激活<em class="mk">其他</em>应用程序的代码。</p><p id="ca64" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">让我们把这个写出来</p><p id="a972" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir">在下面的代码块中，我们……</strong></p><ol class=""><li id="9e8e" class="lw lx iq lc b ld le lg lh lj ly ln lz lr ma lv nj mc md me bi translated">导入<code class="fe kf kg kh ki b">Application</code>和<code class="fe kf kg kh ki b">GreetApp</code>对象</li><li id="b4f2" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">定义<code class="fe kf kg kh ki b">CLIPapp</code>应用程序</li><li id="7ca5" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">用以下格式定义字典:</li></ol><pre class="kk kl km kn gt nw ki nx ny aw nz bi"><span id="4df8" class="ml mm iq ki b gy oa ob l oc od">{command : (application object, application description)}</span></pre><p id="c708" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">4.定义一个<code class="fe kf kg kh ki b">start</code>方法</p><p id="f134" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">5.检查以确保用户提供了子命令。如果他们没有打印出可用的子命令</p><p id="ee29" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">6.激活<code class="fe kf kg kh ki b">Application.start</code> <a class="ae kz" href="https://github.com/ipython/traitlets/blob/f24879c16059b34b89c3fe5cb34cf72001fa9b18/traitlets/config/application.py#L337" rel="noopener ugc nofollow" target="_blank">方法</a>，依次激活子应用的<code class="fe kf kg kh ki b">start</code>方法。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="0582" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">好吧！那就是<code class="fe kf kg kh ki b">CLIapp</code></p><p id="73f4" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">现在我们需要做的最后一件事是定义一个主函数来激活所有的代码。</p><p id="67ee" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir">在下面的代码块中，我们……</strong></p><ol class=""><li id="a6d8" class="lw lx iq lc b ld le lg lh lj ly ln lz lr ma lv nj mc md me bi translated">在之外定义一个<code class="fe kf kg kh ki b">main</code>函数<em class="mk"/></li><li id="15d6" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">通过<code class="fe kf kg kh ki b">launch_instance</code> <a class="ae kz" href="https://github.com/ipython/traitlets/blob/f24879c16059b34b89c3fe5cb34cf72001fa9b18/traitlets/config/application.py#L839" rel="noopener ugc nofollow" target="_blank">方法</a>激活代码。<em class="mk">这是命令行被解析的地方</em></li><li id="a7a9" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">添加<code class="fe kf kg kh ki b">if __name__ == "__main__"</code>检查，允许我们从命令行调用<code class="fe kf kg kh ki b">main</code>功能。</li></ol><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="808f" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我们现在有了一个可用的应用程序！ 🥳</p><p id="d814" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在您的终端中，导航到项目目录的顶层并运行</p><ul class=""><li id="4ac8" class="lw lx iq lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated"><code class="fe kf kg kh ki b">python CLIapp.py greet</code> <em class="mk">“世界你好！”将被打印</em></li><li id="fd33" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated"><code class="fe kf kg kh ki b">python CLIapp.py greet --greeting="Hi"</code> <em class="mk">“嗨，世界！”将被打印</em></li><li id="0ade" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated"><code class="fe kf kg kh ki b">python CLIapp.py greet --name="Joel"</code> <em class="mk">“你好，乔尔！”将被打印</em></li></ul><h1 id="558d" class="nk mm iq bd mn nl nm nn mq no np nq mt jw nr jx mw jz ns ka mz kc nt kd nc nu bi translated">AbsApp.py添加新命令</h1><p id="abb2" class="pw-post-body-paragraph la lb iq lc b ld ne jr lf lg nf ju li lj ng ll lm ln nh lp lq lr ni lt lu lv ij bi translated">现在让我们看看通过创建<code class="fe kf kg kh ki b">abs</code>命令向现有应用程序添加新工具的过程。</p><p id="070f" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在<code class="fe kf kg kh ki b">AbsApp.py</code>文件中，我们将运行以下导入</p><pre class="kk kl km kn gt nw ki nx ny aw nz bi"><span id="eca8" class="ml mm iq ki b gy oa ob l oc od">from traitlets.config import Application<br/>from traitlets import Bool<br/>import os</span></pre><p id="b387" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir">这两个新导入的是</strong> <code class="fe kf kg kh ki b"><strong class="lc ir">Bool</strong></code> <strong class="lc ir">和</strong> <code class="fe kf kg kh ki b"><strong class="lc ir">os</strong></code> <strong class="lc ir">。</strong></p><p id="155a" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir"> Bool </strong>是另一种<a class="ae kz" href="https://traitlets.readthedocs.io/en/stable/trait_types.html#traitlets.Bool" rel="noopener ugc nofollow" target="_blank">traitles类型</a>。在这种情况下，它确保变量被设置为<code class="fe kf kg kh ki b">True</code>或<code class="fe kf kg kh ki b">False</code></p><p id="f3d8" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir"> os </strong>是一个<a class="ae kz" href="https://docs.python.org/3/library/os.html" rel="noopener ugc nofollow" target="_blank">基础Python包</a>，代表“操作系统”。它是一个标准软件包，用于生成文件路径、列出文件夹中的文件以及与计算机操作系统交互。在我们的例子中，我们将使用<code class="fe kf kg kh ki b">os</code>来生成文件的绝对路径，并计算文件使用了多少字节。</p><p id="8891" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">好，接下来我们将构造我们的<code class="fe kf kg kh ki b">AbApp</code>类。</p><p id="f835" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在下面的牢房里，我们…</p><ol class=""><li id="1e8b" class="lw lx iq lc b ld le lg lh lj ly ln lz lr ma lv nj mc md me bi translated">定义<code class="fe kf kg kh ki b">AbsApp</code>应用程序</li><li id="2eb7" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">定义一个traitlets类型为<code class="fe kf kg kh ki b">Bool</code>的可配置<code class="fe kf kg kh ki b">size</code>变量</li><li id="4259" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">定义一个<code class="fe kf kg kh ki b">start</code>方法</li><li id="a437" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">通过<code class="fe kf kg kh ki b">extra_args</code> <a class="ae kz" href="https://github.com/ipython/traitlets/blob/34f596dd03b98434900a7d31c912fc168342bb80/traitlets/config/application.py#L280" rel="noopener ugc nofollow" target="_blank">属性</a>访问用户提供的文件名</li><li id="b93a" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">通过os <code class="fe kf kg kh ki b">isfile</code>功能确保用户提供的文件是有效文件。</li><li id="7f1c" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">打印所提供文件名的绝对路径</li><li id="e214" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">如果用户将<code class="fe kf kg kh ki b">size</code>可配置变量设置为<code class="fe kf kg kh ki b">True</code>，文件大小也会被打印。</li></ol><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="eb39" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">现在，我们将为AbsApp创建一个<strong class="lc ir">标志</strong>，允许用户简单地运行…</p><pre class="kk kl km kn gt nw ki nx ny aw nz bi"><span id="14b1" class="ml mm iq ki b gy oa ob l oc od">--size</span></pre><p id="7980" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">…而不必显式地将<code class="fe kf kg kh ki b">size</code>设置为真或假。为此，我们将定义一个由<code class="fe kf kg kh ki b">Application</code>父类在解析命令行时使用的<code class="fe kf kg kh ki b">flags</code>类变量。</p><p id="7ff4" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在下面的牢房里，我们…</p><ol class=""><li id="ef7c" class="lw lx iq lc b ld le lg lh lj ly ln lz lr ma lv nj mc md me bi translated">定义一个名为<code class="fe kf kg kh ki b">flags</code>的<code class="fe kf kg kh ki b">dict</code>变量</li><li id="299b" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">将顶层密钥设置为将在命令行中使用的标志</li><li id="6d50" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">将键的值设置为一个<code class="fe kf kg kh ki b">tuple</code></li><li id="2a05" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">向元组添加一个字典，其中键是应该由标志配置的应用程序的名称</li><li id="e44f" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">将键的值设置为另一个字典，其中键是可配置变量的名称，值是要分配给变量的数据。</li><li id="5ee2" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">将标志的描述添加为元组中的第二项。如果用户使用<code class="fe kf kg kh ki b">--help</code>参数，这将被打印出来！</li><li id="5b8e" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">通过<code class="fe kf kg kh ki b">Application.flags</code>属性将标志添加到应用程序中。</li></ol><p id="f28d" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><em class="mk">值得注意的是:在更新配置时，标志非常强大。二级字典可以包含多个应用程序，三级字典可以包含多个可配置变量！</em></p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="7444" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ir">ABS app完成了！</strong> ✅</p><p id="7932" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">现在最后一步是将app添加到<code class="fe kf kg kh ki b">CLIapp.py</code>文件中！</p><p id="0b43" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在下面的代码块中，我们…</p><ol class=""><li id="8354" class="lw lx iq lc b ld le lg lh lj ly ln lz lr ma lv nj mc md me bi translated">将<code class="fe kf kg kh ki b">AbsApp</code>对象导入到<code class="fe kf kg kh ki b">CLIapp.py</code>文件中</li><li id="3512" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv nj mc md me bi translated">向<code class="fe kf kg kh ki b">CLIapp</code>对象添加一个<code class="fe kf kg kh ki b">abs</code>子命令</li></ol><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="e403" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">就这样，一个新的命令被添加到您的应用程序中！</p><p id="fa3c" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在您的终端中，导航到项目目录的顶层并运行</p><ul class=""><li id="ad19" class="lw lx iq lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated"><code class="fe kf kg kh ki b">python CLIapp.py abs CLIapp.py</code> <em class="mk">将打印CLIapp.py文件的绝对路径</em></li><li id="45bc" class="lw lx iq lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated"><code class="fe kf kg kh ki b">python CLIapp.py abs CLIapp.py --size</code> <em class="mk">将打印CLIapp.py文件的绝对路径和文件大小</em></li></ul><p id="52e9" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">根据我自己用traitlets编写应用程序的经验，编写新应用程序和向现有工具添加新命令的便利性是最好的好处之一。因为这个过程根植于面向对象编程，所以有时编写一个全新的应用程序就像从现有的应用程序继承然后编辑一行代码一样简单！</p><p id="da12" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">好了，现在就这样。<strong class="lc ir">我的下一篇文章一定要点击follow按钮:</strong>trait lets配置文件和如何自动生成代码文档的演练！</p></div></div>    
</body>
</html>