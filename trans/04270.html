<html>
<head>
<title>Deploy a Node.js Application With the App Engine in 10 Minutes!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用App Engine在10分钟内部署一个Node.js应用！</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploy-a-node-js-application-with-app-engine-in-10-minutes-69b03e4d54f0?source=collection_archive---------10-----------------------#2021-04-11">https://towardsdatascience.com/deploy-a-node-js-application-with-app-engine-in-10-minutes-69b03e4d54f0?source=collection_archive---------10-----------------------#2021-04-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b7a3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在Google云平台的应用程序引擎上部署简单node.js应用程序的演练。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a196add09fc8bfd373031cf9060ecfed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*N3Rgvk0nOY-wkjaG.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">埃米尔·佩龙在<a class="ae kv" href="https://unsplash.com/s/photos/web?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="b84a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">谷歌云的<a class="ae kv" href="https://cloud.google.com/appengine" rel="noopener ugc nofollow" target="_blank">应用引擎</a>允许你在一个完全由谷歌管理的平台上部署可扩展的网络应用。这些应用的范围可以从后端服务和API层到运行在Angular和React框架上的前端应用。谷歌免费提供每天28小时的运行时间，这样你就可以免费托管了！</p><p id="594f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将带您在这个App Engine平台上部署一个简单的Node.js应用程序。</p><h1 id="1847" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">先决条件</h1><p id="662c" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">要跟进，您应该具备以下条件:</p><ol class=""><li id="b568" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated"><a class="ae kv" href="https://www.google.com/search?q=node.js+getting+started&amp;rlz=1C1CHBF_enCA882CA882&amp;oq=node.js+getting+started&amp;aqs=chrome.0.69i59j0i22i30l9.3739j0j4&amp;sourceid=chrome&amp;ie=UTF-8" rel="noopener ugc nofollow" target="_blank">对Node.js工作原理的基本理解</a></li><li id="6d5b" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><a class="ae kv" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">安装在本地机器上的节点</a></li><li id="106e" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">一个谷歌云平台<a class="ae kv" href="https://cloud.google.com/apigee/docs/hybrid/v1.1/precog-gcpaccount" rel="noopener ugc nofollow" target="_blank">账户</a>和一个<a class="ae kv" href="https://cloud.google.com/resource-manager/docs/creating-managing-projects" rel="noopener ugc nofollow" target="_blank">项目</a></li></ol><h1 id="14c4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">让我们构建并部署我们的应用程序吧！</h1><h2 id="6e56" class="nd lt iq bd lu ne nf dn ly ng nh dp mc lf ni nj me lj nk nl mg ln nm nn mi no bi translated">创建项目</h2><p id="c411" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在本地机器上初始化一个新的Node.js项目。</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="2e82" class="nd lt iq nq b gy nu nv l nw nx">mkdir helloworld<br/>cd helloworld<br/>npm init</span></pre><p id="e7da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe ny nz oa nq b">helloworld</code>文件夹中创建一个包含以下内容的简单执行文件<code class="fe ny nz oa nq b">index.js</code>:</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="ab80" class="nd lt iq nq b gy nu nv l nw nx"><em class="ob">const</em> express = require('express');<br/><em class="ob">const</em> app = express();</span><span id="6273" class="nd lt iq nq b gy oc nv l nw nx">app.get('/', (<em class="ob">req</em>, <em class="ob">res</em>) <em class="ob">=&gt;</em> {<br/>  <em class="ob">res</em>.send('GCP App Engine!');<br/>});</span><span id="f23a" class="nd lt iq nq b gy oc nv l nw nx"><em class="ob">const</em> PORT = process.env.PORT || 8080;</span><span id="d16c" class="nd lt iq nq b gy oc nv l nw nx">app.listen(PORT, () <em class="ob">=&gt;</em> {<br/>  console.log(`Server listening on port ${PORT}...`);<br/>});</span></pre><p id="f9ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的应用程序不会做太多事情，只是在被调用时返回一个<code class="fe ny nz oa nq b">'GCP App Engine!'</code>字符串。</p><p id="e6ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将以下启动脚本和express依赖关系添加到创建的<code class="fe ny nz oa nq b">package.json</code>文件中:</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="d857" class="nd lt iq nq b gy nu nv l nw nx">{<br/> ...<br/> <em class="ob">"scripts"</em>: {<br/>   <em class="ob">"start"</em>: "node index.js"<br/> },<br/> <em class="ob">"dependencies"</em>: {<br/>   <em class="ob">"express"</em>: "^4.16.3"<br/> }<br/>}</span></pre><p id="ef88" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Express不是必需的，我使用它来简化部署。应用程序引擎将使用启动脚本来启动您的应用程序。请注意，<code class="fe ny nz oa nq b">index.js</code>与我上面创建的主执行文件的名称相匹配。</p><p id="68e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安装依赖项(快速)并确保您的应用在本地运行:</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="8def" class="nd lt iq nq b gy nu nv l nw nx">npm install<br/>node index.js</span></pre><p id="12e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">导航到<a class="ae kv" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a>，您应该会看到:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/b6e0c2d30598d7554229d23694861807.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*3xeertPfrfSmqu3lYW93Lw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图表</p></figure><p id="d13c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">应用程序已经准备就绪，但我们需要向应用程序引擎提供一些信息，以便它知道如何部署我们的代码。我们使用一个<a class="ae kv" href="https://en.wikipedia.org/wiki/YAML#:~:text=YAML%20%28a%20recursive%20acronym%20for,is%20being%20stored%20or%20transmitted." rel="noopener ugc nofollow" target="_blank"> YAML </a>文件来完成这项工作。这个文件中的配置会变得非常复杂，有很多选项需要配置，但是在我们的例子中，我会保持简单。在<code class="fe ny nz oa nq b">helloworld</code>文件夹中创建一个名为<code class="fe ny nz oa nq b">app.yaml</code>的文件，并添加以下内容:</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="7243" class="nd lt iq nq b gy nu nv l nw nx">runtime: nodejs14<br/>env: standard<br/>instance_class: F1<br/>automatic_scaling:<br/>  min_idle_instances: automatic<br/>  max_idle_instances: automatic<br/>  min_pending_latency: automatic<br/>  max_pending_latency: automatic</span></pre><p id="f730" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我的Node.js运行时版本是14.16.0，如果您的版本不同，请随意更改运行时。我们将使用一个<a class="ae kv" href="https://cloud.google.com/appengine/docs/standard#instance_classes" rel="noopener ugc nofollow" target="_blank">标准环境和一个F1实例</a>，因为这些都包含在GCP的<a class="ae kv" href="https://cloud.google.com/free" rel="noopener ugc nofollow" target="_blank">免费配额</a>中。</p><p id="54dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这一点上，你应该有下面的文件结构，我们准备开始迁移我们的代码到GCP。</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="779e" class="nd lt iq nq b gy nu nv l nw nx">├── helloworld<br/>│ ├── index.js<br/>│ ├── package.json<br/>│ ├── app.yaml</span></pre><h2 id="82f5" class="nd lt iq bd lu ne nf dn ly ng nh dp mc lf ni nj me lj nk nl mg ln nm nn mi no bi translated">迁移您的代码</h2><p id="5b8a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在部署应用程序之前，您需要将代码提供给GCP。您可以通过在本地机器上利用<a class="ae kv" href="https://cloud.google.com/sdk" rel="noopener ugc nofollow" target="_blank"> Cloud SDK </a>或使用<a class="ae kv" href="https://cloud.google.com/shell" rel="noopener ugc nofollow" target="_blank"> Cloud Shell </a>来实现这一点，正如我将在本演练中所做的那样。</p><p id="9778" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在将代码推送到应用引擎之前，我将使用一个<a class="ae kv" href="https://cloud.google.com/storage" rel="noopener ugc nofollow" target="_blank">云存储</a>桶来存放我的代码。<a class="ae kv" href="https://console.cloud.google.com/storage/create-bucket" rel="noopener ugc nofollow" target="_blank">创建一个新的存储桶来存放您的源代码</a>(如果需要，您可以重用现有的存储桶)。对于区域，您应该设置Regional，其他设置可以保留默认值。在我的例子中，我正在创建一个名为<code class="fe ny nz oa nq b">sample-code-repo</code>的桶，并将整个helloworld文件夹上传到根目录。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/e2caabb8e1843cca83ea1c2b6e765426.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uxnP69fKARbP88JOKYPEug.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图表</p></figure><p id="d5a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们需要将代码上传到<a class="ae kv" href="https://cloud.google.com/shell" rel="noopener ugc nofollow" target="_blank">云壳虚拟机</a>，你可以通过从任何GCP控制台页面打开云壳终端或点击<a class="ae kv" href="https://shell.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">此处</a>来完成。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/f7feef374e5b4bd910a672e8993dd487.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SrF69jLGz1h6COFVyNfnWw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图表</p></figure><p id="128e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要在云Shell虚拟机上创建所需的文件夹结构，并同步bucket中的代码，请运行以下命令，将<code class="fe ny nz oa nq b">sample-code-repo/helloworld</code>替换为<code class="fe ny nz oa nq b">&lt;source-code-bucket-name&gt;/&lt;app-folder-name&gt;</code>:</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="ca9f" class="nd lt iq nq b gy nu nv l nw nx">mkdir helloworld<br/>cd helloworld<br/>gsutil rsync -r gs://sample-code-repo/helloworld .</span></pre><p id="3a9d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将被要求授权存储桶访问(弹出窗口),一旦完成，运行<code class="fe ny nz oa nq b">ls</code>命令将确认数据复制:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi og"><img src="../Images/32e1729d95e30fabff97f1c788fb5d02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*Lch3CUsxprH2sbjvMXM85Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图表</p></figure><p id="67b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您有其他将代码迁移到云Shell的首选方法(例如git)，请随意使用。至此，我们的项目已经可以部署了。</p><h2 id="7369" class="nd lt iq bd lu ne nf dn ly ng nh dp mc lf ni nj me lj nk nl mg ln nm nn mi no bi translated">部署应用程序</h2><p id="6718" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">要在App Engine上部署应用程序，我们需要返回到我们的<a class="ae kv" href="https://cloud.google.com/shell" rel="noopener ugc nofollow" target="_blank">云外壳虚拟机</a>并运行以下程序:</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="a2d4" class="nd lt iq nq b gy nu nv l nw nx">cd helloworld<br/>gcloud app deploy</span></pre><p id="f464" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于您的第一个应用引擎部署，您将需要指定一个区域——我使用了<code class="fe ny nz oa nq b">us-central</code>作为我的区域。代码将需要一分钟的时间来编译，一旦完成运行<code class="fe ny nz oa nq b">gcloud app browse</code>将输出一个链接，您可以使用它来访问您现在部署的应用程序！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/9786a39f2e7b818dc50389d99b186c2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*EpwHBf-ROP4_4yg2AAxkBA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图表</p></figure><h1 id="8029" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="f6c7" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">谷歌的应用引擎是一个免费快速在线部署应用程序的伟大平台。在本文中，我向您介绍了如何将这个平台用于Node.js应用程序，但是使用Java、Python、PHP和Go也可以获得相同的结果。我希望你能从这篇文章中学到一些东西。</p><p id="a289" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">祝好运，编码快乐！</strong></p></div><div class="ab cl oi oj hu ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ij ik il im in"><p id="5ae1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ob">原载于2021年4月11日https://theappliedarchitect.com</em><a class="ae kv" href="https://theappliedarchitect.com/deploy-a-node-js-application-with-app-engine-in-10-minutes/" rel="noopener ugc nofollow" target="_blank"><em class="ob"/></a><em class="ob">。</em></p></div></div>    
</body>
</html>