<html>
<head>
<title>How to Deal with NULL Values in Standard SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何处理标准SQL中的空值</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-deal-with-null-values-in-standard-sql-1bffce0c55cd?source=collection_archive---------6-----------------------#2021-09-14">https://towardsdatascience.com/how-to-deal-with-null-values-in-standard-sql-1bffce0c55cd?source=collection_archive---------6-----------------------#2021-09-14</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="c683" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">1.识别— 2。理解— 3。行动</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/196b73ba610e643cedf1d254720835a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZIVC5DhwYoAY8qg_y3QNyQ.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">凯利·西克玛在<a class="ae kz" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="3886" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">谁能声称每天都能处理质量和可靠性无可挑剔的数据库呢？我个人不能，老实说，这是我喜欢做数据分析师的部分原因。即使数据清理很少是数据科学中最好的部分，但能够操作数据并从中获得洞察力仍然是必不可少的。</p><p id="dca0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" rel="noopener" target="_blank" href="/how-to-deal-with-duplicate-entries-using-sql-4b017465d6dc">在上一篇关于数据科学的文章</a>中，我们仔细研究了如何使用SQL处理数据库中的重复数据。在这里，我们想要解决许多数据分析师每天都会遇到的另一个常见问题:处理数据库中的空值。<strong class="lc iv">什么是空值？如何识别他们？如何处置他们？下面是我将尝试回答的一些问题。</strong></p><p id="cfb6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，以下代码是用标准SQL编写的(例如，与SQL Server或Transact-SQL相反)，这是Google BigQuery中使用的SQL语言变体。根据您使用的数据库管理系统(RDBMS ),语法和使用的函数可能会有细微的变化。更多细节可以阅读<a class="ae kz" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/conditional_expressions" rel="noopener ugc nofollow" target="_blank"> Google BigQuery文档</a>。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="e6a7" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">简介:null还是空白？</h1><p id="a082" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">在深入探讨SQL中处理空值的技术细节之前，我们必须首先<strong class="lc iv">定义空值的含义</strong>。特别是，空值必须与空白值区分开来:</p><ul class=""><li id="7254" class="na nb iu lc b ld le lg lh lj nc ln nd lr ne lv nf ng nh ni bi translated"><strong class="lc iv">空</strong>数据库字段意味着对于给定记录没有<strong class="lc iv">值</strong>。它表示缺少值。</li><li id="e9c1" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">一个<strong class="lc iv">空白的</strong>数据库字段意味着对于一个给定的记录有一个<strong class="lc iv">值</strong>，这个值为空(对于一个字符串值)或0(对于一个数值)。</li></ul><p id="25f0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这两种情况不能混淆，否则会导致错误解释数据并将空值作为null值处理。在本文中，我将使用一个名为“website _ CRM”(具有随机值)的<strong class="lc iv">测试数据库，它包含10行7列:</strong></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj no"><img src="../Images/c3673d300cebcee16b610d8c77760a59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*w2bitHy3H7f-a62Xh49vww.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">测试数据库Marie Lefevre</p></figure><p id="5d48" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们假设这个数据库是一个电子商务网站的客户数据库。为了说明null值和空白值之间的区别，请仔细查看第9行。对于名为Iliana I的客户，字段“州”、“年龄”和“美国纳税人”为空值，而字段“电话”为空。这意味着他们没有填写前三个字段(空值)，而是填写了“电话”字段并输入了空值。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="f772" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">第一步:识别和想象</h1><p id="9438" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">首先，我们希望<strong class="lc iv">确定我们的数据集</strong>中是否有空值。有两种方法可以在数据集中查找空值，这取决于您对所操作数据的先验知识。</p><p id="8e60" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">如果您已经知道在哪个字段(或列)中可能有您想要的空值</strong>，您可以直接在感兴趣的字段上应用条件<code class="fe np nq nr ns b">WHERE IS NULL</code>。在我们的示例中，如果我们知道“国家/地区”不是必填字段，而我们希望按地理区域分析客户的划分，我们希望只调查这一列。这段代码可以实现这一点:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div></figure><p id="6ab3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">如果您对正在调查的字段没有一个精确的概念</strong> —或者如果您想要获得数据集中空值的完整概述，您必须首先清楚地了解每列中可能存在的空值以及空值的数量。为了获得这个概述，您可以使用下面的代码片段(从<a class="ae kz" href="https://stackoverflow.com/questions/58716640/bigquery-check-entire-table-for-null-values" rel="noopener ugc nofollow" target="_blank">堆栈溢出</a>中检索):</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div></figure><p id="b47f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在我们的例子中，输出如下:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nv"><img src="../Images/ddd687a584feb30a7374b60446c55e6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:374/format:webp/1*8MlY-q93VLceun7J7RlSqQ.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">玛丽·勒费夫尔</p></figure><h1 id="0812" class="md me iu bd mf mg nw mi mj mk nx mm mn ka ny kb mp kd nz ke mr kg oa kh mt mu bi translated">第二步:理解和决定</h1><p id="6715" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">既然您已经确定了数据库中存在空值的位置，那么您可以更进一步，调查是什么导致了这些空值。数据库包含空值有许多原因。让我们回答三个“背景调查”问题，以便更好地理解它们。</p><h2 id="ea55" class="ob me iu bd mf oc od dn mj oe of dp mn lj og oh mp ln oi oj mr lr ok ol mt om bi translated">1.某些字段的所有行都为空吗？</h2><p id="a16a" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">在我们的示例中,“年龄”字段始终为空。其中一个原因可能是<strong class="lc iv">字段对于网站的顾客来说不是强制性的</strong>:在网上订购时，除了特定的商品，你不需要告知你的年龄。由于年龄是个人数据，客户在网上购物时可能不愿意分享这些信息。</p><p id="97f0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这也可能表明网站上的<strong class="lc iv">潜在bug。在这两种情况下，对于任何企业来说，监控数据库中null值的出现次数以及它如何随着时间的推移而演变都是至关重要的，尤其是当所有条目都为null时。在这种情况下，这可能会导致产品团队更深刻的反思:如果没有人填写这些信息，继续向客户询问这些信息是否有意义？</strong></p><h2 id="5f42" class="ob me iu bd mf oc od dn mj oe of dp mn lj og oh mp ln oi oj mr lr ok ol mt om bi translated">2.几个字段的行数都是空的吗？</h2><p id="8777" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">有意或无意地，<strong class="lc iv">一些字段可以相互关联</strong>，其中一个字段填写的信息依赖于另一个字段。因此，更好地理解字段的相互依赖性可以帮助您解释为什么一些字段具有给定数量的空值。</p><p id="8a45" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在我们的例子中，这将对应于字段“state”和“us _纳税人”:这两列各有7个空值。当查看整个表时，我们在这里看到没有填写“州”字段的客户居住在美国以外的国家。如果“美国纳税人”字段不是必填的，这将解释这七个客户在网上订购“您是美国纳税人吗？”时不需要勾选最后一个框。</p><h2 id="9eab" class="ob me iu bd mf oc od dn mj oe of dp mn lj og oh mp ln oi oj mr lr ok ol mt om bi translated">3.剩下的案例有哪些？</h2><p id="e7ce" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">最终，你需要看看前面两步之后仍然无法解释的<strong class="lc iv">边缘情况</strong>。它们可以对应于数据输入中的<strong class="lc iv">错误或简单地对应于异常情况</strong>。在这两种情况下，调查是什么导致了这些剩余的空值对于改进您的产品或用户体验非常有指导意义。</p><p id="bacb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在我们的电子商务示例中，有趣的是一位在线客户(Carla C .)没有提供他们的电子邮件地址。虽然通过电子邮件接收订单确认和采购账单是必要的，但是这个字段怎么可能不是强制的呢？无论如何，这种数据输入在未来必须成为不可能。这就是为什么<strong class="lc iv">调查导致空值的原因对业务</strong>至关重要:这可能是由于人为错误(例如，客户忘记提供电子邮件地址)或技术错误(例如，网站在保存表单时遇到错误，因此无法保存填写的值)。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj on"><img src="../Images/de72e29513c97eb46b82c11efcc2f587.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VDpF4PKVGudZFQTElXUC9A.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@hadijasaidi?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Hadija Saidi </a>在<a class="ae kz" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="632d" class="md me iu bd mf mg nw mi mj mk nx mm mn ka ny kb mp kd nz ke mr kg oa kh mt mu bi translated">第三步:行动和修改</h1><p id="0f16" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">根据您从前面的步骤中得出的结论，现在是时候<strong class="lc iv">对这些空值</strong>产生影响了。他们应该保持现在的样子，还是应该不惜一切代价将他们移除？我确定了三种处理它们的方法:</p><ul class=""><li id="978e" class="na nb iu lc b ld le lg lh lj nc ln nd lr ne lv nf ng nh ni bi translated">用中性值替换空值，例如“不适用”或“-”</li><li id="24c7" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">用有意义的值替换空值</li><li id="390b" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">让空值为空</li></ul><p id="85c6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对于决定替换空值的情况，让我们应用最合适的SQL函数。</p><h2 id="a9af" class="ob me iu bd mf oc od dn mj oe of dp mn lj og oh mp ln oi oj mr lr ok ol mt om bi translated">IFNULL:简单的一个</h2><p id="ffc8" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">顾名思义，如果输入值为空，函数<code class="fe np nq nr ns b">IFNULL(expr, null_result)</code>将返回某个值。</p><p id="8fd8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在我们的例子中，我们希望使字段“state”中的空值更加明确，因此我们选择用中性词代替空值，如“data not available”。这同样适用于“年龄”字段。此外，我们希望从字段“us _ taobar”中删除所有空值。让我们假设所有没有回答“是”的顾客都没有在美国纳税。因此，<strong class="lc iv">如果这个字段为空，我们要返回“否”</strong>。结合前面的更改，将得到以下代码片段:</p><blockquote class="oo op oq"><p id="c662" class="la lb or lc b ld le jv lf lg lh jy li os lk ll lm ot lo lp lq ou ls lt lu lv in bi translated"><em class="iu"> IFNULL(状态，'数据不可用')<br/> IFNULL(年龄，'数据不可用')<br/> IFNULL(美国_纳税人，'否')</em></p></blockquote><h2 id="465e" class="ob me iu bd mf oc od dn mj oe of dp mn lj og oh mp ln oi oj mr lr ok ol mt om bi translated">COALESCE:清单1</h2><p id="4771" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">函数<code class="fe np nq nr ns b">COALESCE(expr[, ...])</code>返回第一个非空表达式的值。要使用它，您需要预先定义要用来替换空值的术语的优先级顺序。</p><p id="d323" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在我们的例子中，我们希望<strong class="lc iv">确保字段‘email’没有空值</strong>。原因可能是我们的支持团队将此字段用作客户的联系点。因此，我们希望该字段等于，优先级顺序如下:</p><ol class=""><li id="04b7" class="na nb iu lc b ld le lg lh lj nc ln nd lr ne lv ov ng nh ni bi translated">客户的电子邮件地址(如果有)</li><li id="9eb9" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv ov ng nh ni bi translated">否则，如果有的话，客户的电话号码</li><li id="38f3" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv ov ng nh ni bi translated">否则，客户的名称</li></ol><p id="530b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">为此，我们不能使用IFNULL函数，因为它只能显示空值的一个替代值。所以我们使用下面这段代码:</p><blockquote class="oo op oq"><p id="f368" class="la lb or lc b ld le jv lf lg lh jy li os lk ll lm ot lo lp lq ou ls lt lu lv in bi translated"><em class="iu">联合(电子邮件、电话、姓名)</em></p></blockquote><h2 id="06bb" class="ob me iu bd mf oc od dn mj oe of dp mn lj og oh mp ln oi oj mr lr ok ol mt om bi translated">案例:复杂的案例</h2><p id="60b1" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">最后，当需要处理几种情况时，可以使用<code class="fe np nq nr ns b">CASE expr WHEN expr_to_match THEN result [...] [ELSE else_result] END</code>函数，包括更复杂的情况，其中IFNULL或COALESCE不足以替换空值。</p><p id="37a3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在我们的示例中，如果字段“国家”为空，我们希望<strong class="lc iv">以特定顺序应用以下规则</strong>:</p><ol class=""><li id="4329" class="na nb iu lc b ld le lg lh lj nc ln nd lr ne lv ov ng nh ni bi translated">如果“国家”不为空，那么我们就取这个值</li><li id="63af" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv ov ng nh ni bi translated">否则，如果“state”不为空并且属于美国的一个州，我们希望在“country”字段中写入“United States”</li><li id="cace" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv ov ng nh ni bi translated">否则，如果“州”不为空，我们希望将这个“州”值复制到“国家”字段中</li><li id="9238" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv ov ng nh ni bi translated">否则，我们就写“没有国家”</li></ol><p id="3783" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在标准SQL中，这对应于下面这段代码:</p><blockquote class="oo op oq"><p id="94cb" class="la lb or lc b ld le jv lf lg lh jy li os lk ll lm ot lo lp lq ou ls lt lu lv in bi translated"><em class="iu">事例<br/>当国家不为空时，则国家<br/>当州在('阿拉巴马'，'阿拉斯加'，'亚利桑那'，'…'，'佛罗里达州'，'堪萨斯州'，'华盛顿州')时，则国家<br/>当州不为空时，则国家<br/>否则‘没有国家’<br/>结束</em></p></blockquote></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="f491" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">最终产出和结论</h1><p id="a655" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">总而言之，我们构建了下面这段代码:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div></figure><p id="76b2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在应用了上面所有的修改之后，我们最终得到了一个<strong class="lc iv">干净的表</strong>。不仅在视觉上更漂亮，而且<strong class="lc iv">用有意义的值替换空值使得读者更容易理解表格</strong>。作为一个数据分析师，这是弥足珍贵的。更重要的是，这将使非技术用户能够更好地利用您的数据库，同时降低误解某些不包含值的字段(相对于空值)的风险。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ow"><img src="../Images/d224e8ae046264d62539dad05e688c60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ezijRJ8d2yg4vXhrgsXM6w.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">测试数据库Marie Lefevre</p></figure><p id="ac9a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在它是你的了！<strong class="lc iv">你如何处理空值？</strong>识别空值真的比清除空值容易吗？请在下面分享您的技巧，并讨论您在SQL方面的最佳实践。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><p id="a984" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你喜欢阅读这篇文章吗？ <a class="ae kz" href="https://marie-lefevre.medium.com/membership" rel="noopener"> <em class="or">成为</em> </a> <em class="or">的一员，加入一个不断成长的充满好奇心的社区吧！</em></p></div></div>    
</body>
</html>