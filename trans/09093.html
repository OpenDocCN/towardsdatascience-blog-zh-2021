<html>
<head>
<title>Interactive flow-map with an OD-matrix of regular movements in Tartu, Estonia</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">爱沙尼亚塔尔图市常规运动OD矩阵互动流程图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/interactive-flow-map-with-an-od-matrix-of-regular-movements-in-tartu-estonia-3ac6b7738397?source=collection_archive---------23-----------------------#2021-08-22">https://towardsdatascience.com/interactive-flow-map-with-an-od-matrix-of-regular-movements-in-tartu-estonia-3ac6b7738397?source=collection_archive---------23-----------------------#2021-08-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="011b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从呼叫详细记录(CDR)获得传单中的家庭-工作通勤的交互式可视化</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/fa7f0c8bf39f9553fb9af1148cafd3c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*khF3aMr0mI5wEWjyrfZnig.gif"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片由作者提供。塔尔图县通勤地图动画</p></figure><p id="8941" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">城市发展与人口流动有着紧密的联系。城市规划者根据人口动态的功能做出决策。比方说，交通拥堵是一个明显的事实，即需要特定的道路来到达人们的重要位置(工作场所)，然后城市规划者可以决定释放道路压力的选项，如改善公共交通。正如我们所理解的，人口是塑造城市的关键因素，空间维度的指标，如<em class="le">人口密度、年龄组的空间分布或老年人集中程度</em>，有助于做出塑造宜居城市的决策。</p><p id="0b89" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于信息和通信技术(ICT)，追踪个人(匿名)成为可能。在世界范围内，手机在通信领域占据着强大的优势，根据<a class="ae lf" href="https://www.statista.com/statistics/330695/number-of-smartphone-users-worldwide/" rel="noopener ugc nofollow" target="_blank">统计数据</a>，2021年手机用户将超过6 0亿。移动电话呼叫会在天线网络中创建一个名为呼叫详细记录(CDR)的注册表，该注册表允许创建一个在空间覆盖和时间(纵向)上巨大的数据集。这些移动定位数据有助于研究人员、城市推广者、地方政府、私营公司或区域组织(EU)对城市进行建模。</p><blockquote class="lg"><p id="57ee" class="lh li it bd lj lk ll lm ln lo lp kn dk translated">最终地图动画<a class="ae lf" href="https://bryanvallejo16.github.io/movements-odmatrix-tartu/" rel="noopener ugc nofollow" target="_blank">在此！</a> <br/>储存库<a class="ae lf" href="https://github.com/bryanvallejo16/movements-odmatrix-tartu" rel="noopener ugc nofollow" target="_blank">在这里！</a></p></blockquote><blockquote class="lq lr ls"><p id="0ed6" class="jq jr le js b jt lt jv jw jx lu jz ka lv lw kd ke lx ly kh ki lz ma kl km kn im bi translated"><strong class="js iu">简介</strong></p></blockquote><p id="a7bc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">作为流动性研究的领先国家，<strong class="js iu">爱沙尼亚</strong>已经连续收集了12年时间序列的CDR数据。塔尔图大学<strong class="js iu">的<a class="ae lf" href="https://mobilitylab.ut.ee/publications/research-articles/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">移动实验室</strong> </a>从多个角度对数据集进行了分析，例如<em class="le">旅游统计、种族隔离、社交网络、跨境移动(跨国主义)或空间移动</em>等等。这些研究让人们理解了人的流动、有意义的地点和空间。移动定位数据揭示了人们的有意义的位置，例如<strong class="js iu">家或工作</strong>(定位点/活动位置)[1]，然后可以汇总位置之间的移动，并用于构建日常人流。这些研究在诸如<em class="le">长期活动空间、社会中的居住等级或交通</em>等应用中非常广泛，但对于这种可视化实践，我们将基于OD矩阵，该矩阵代表每天从家到工作单位的通勤。您可以在爱沙尼亚地理学家<a class="ae lf" href="https://www.etis.ee/CV/Anto_Aasa/est" rel="noopener ugc nofollow" target="_blank"> Anto Aasa </a>撰写的<a class="ae lf" href="https://mobilitylab.ut.ee/OD/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">移动实验室(OD矩阵)页面</strong> </a> <strong class="js iu"> </strong>上扩展阅读关于CDR应用和数据集生成的内容。</strong></p><blockquote class="lq lr ls"><p id="a19f" class="jq jr le js b jt ju jv jw jx jy jz ka lv kc kd ke lx kg kh ki lz kk kl km kn im bi translated"><strong class="js iu">数据</strong></p></blockquote><p id="f933" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">数据集[2]由电话运营商Telia、<a class="ae lf" href="https://mobilitylab.ut.ee/en/about/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">塔尔图大学地理系移动实验室</strong> </a>和一家分拆公司<a class="ae lf" href="https://positium.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> Positium LBS </strong> </a>收集和分析。每月约有420，000名受访者注意到<strong class="js iu"> <em class="le">锚点模型</em> </strong>应用于确定每月有意义的位置。数据集揭示了用户在社区之间的日常通勤(聚合的空间单位)。</p><p id="d7cf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个数据集的创建是非常特别和令人着迷的，在非常高水平的分析和移动实验室多年的研究中，现在有可能理解城市中人们的通勤，并提供可行的数据来根据人口动态做出决策。</p><p id="28b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我很高兴我得到了Anto Aasa的许可，可以使用这个数据集来制作这个教材。该数据集可以在适当参考的情况下免费使用，不得用于商业目的。</p><blockquote class="lq lr ls"><p id="fc34" class="jq jr le js b jt ju jv jw jx jy jz ka lv kc kd ke lx kg kh ki lz kk kl km kn im bi translated"><strong class="js iu">在这里找到数据集</strong> <a class="ae lf" href="https://mobilitylab.ut.ee/OD/#data_download" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">！</strong> </a></p></blockquote><p id="126e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于产生的线条(运动)的数量，OD矩阵的可视化可能是压倒性的。在这里，您可以在流程图中直观地看到塔尔图县社区之间的日常通勤活动。正如我们所见，当地图越靠近市中心(塔尔图市)时，它可以显示更多的通勤者。但是，这个练习的主要目的是使这个流动贴图是交互的(动画的),所以有一个更好的观察运动的颗粒。如果您想查看更多关于OD矩阵可视化的信息，您可以查看文章<strong class="js iu"> <em class="le"> </em> </strong> <a class="ae lf" rel="noopener" target="_blank" href="/visualization-of-bike-sharing-system-movements-in-helsinki-with-an-interactive-flow-map-451d897104fe"> <strong class="js iu"> <em class="le">“赫尔辛基的自行车共享系统运动:具有交互式流程图的聚合和可视化”</em> </strong> </a></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mb"><img src="../Images/32e09a6943dc8292fd3da885352d8b3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZDwA81FTidmjAUn6nhzMzw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片由作者提供。塔尔蒂县日常通勤家庭工作流程图</p></figure><blockquote class="lg"><p id="12b8" class="lh li it bd lj lk mc md me mf mg kn dk translated">目标</p><p id="0f5d" class="lh li it bd lj lk ll lm ln lo lp kn dk translated">这一可视化实践旨在创建一个互动的地图动画(网络地图),以传单的形式展示爱沙尼亚塔尔图的个人(OD-Matrix)在家和工作之间的移动。</p></blockquote><blockquote class="lq lr ls"><p id="5b5a" class="jq jr le js b jt lt jv jw jx lu jz ka lv lw kd ke lx ly kh ki lz ma kl km kn im bi translated"><strong class="js iu">练习</strong></p></blockquote><p id="e988" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">可视化练习分为两个部分:<em class="le"> 1)基于</em> <strong class="js iu"> <em class="le">塔尔图县起点-终点的动作子集，Python </em> </strong> <em class="le">和</em> <a class="ae lf" href="https://leafletjs.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> <em class="le">传单</em></strong></a><strong class="js iu"><em class="le">JavaScript</em></strong><em class="le">中OD-Matrix的交互地图动画。</em></p><p id="f5f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">存储库仅包含常规数据的子集。但是您可以在自己的分析中重用这些代码。为了明确起见，一般数据集包含作为起点的所有邻域和作为目的地的所有邻域。总共有847个社区/街区，它们可以在下一张地图上看到:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mh"><img src="../Images/471429cc2044b8057fb603c7ef59ed80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K31YYqqkcXYd-_THwR7G0A.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片由作者提供。爱沙尼亚的社区/街区</p></figure><blockquote class="lq lr ls"><p id="e72d" class="jq jr le js b jt ju jv jw jx jy jz ka lv kc kd ke lx kg kh ki lz kk kl km kn im bi translated"><strong class="js iu"> <em class="it"> 1)定义塔尔图县起点-终点数据集</em> </strong></p></blockquote><p id="baa7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们希望在国家级可视化所有以<strong class="js iu">塔尔图县为出发地</strong>的旅行和所有以<strong class="js iu">塔尔图为目的地</strong>的旅行。</p><p id="ff9f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="le"> 1.1创建塔尔图县社区列表</em></p><p id="22c1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将读取包含塔尔图县社区的图层，并获取包含所有社区的列表:</p><pre class="kp kq kr ks gt mi mj mk ml aw mm bi"><span id="d2cf" class="mn mo it mj b gy mp mq l mr ms">import geopandas as gpd<br/>import pandas as pd<br/>from pyproj import CRS<br/>from shapely.geometry import Point</span><span id="6cbe" class="mn mo it mj b gy mt mq l mr ms"># tartu communities<br/>fp = r'data/Communities_Tartu.shp'<br/>geodata_tartu = gpd.read_file(fp)</span><span id="8529" class="mn mo it mj b gy mt mq l mr ms"># list with tartu communities for subset <br/>tartu_communities = geodata_tartu['KANT_nk'].to_list()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/51396ece3458dbb81b06256b7ad6a692.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*8hVHtulWIYvihwwAU3Ty_w.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片作者。塔尔图县的街区/社区</p></figure><p id="2d08" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="le"> 1.2塔尔图县运动子集</em></p><p id="c6c5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，我们将使用列表<code class="fe mv mw mx mj b">tartu_communities</code>只对Tartu县的出发地和目的地进行子集划分。请记住，整个数据集包含国家一级的运动。</p><pre class="kp kq kr ks gt mi mj mk ml aw mm bi"><span id="987e" class="mn mo it mj b gy mp mq l mr ms"># reading movement OD data<br/>fp = r'data/OD_matrix_201708.csv'<br/>movements = gpd.read_file(fp, encoding='Latin')</span><span id="3554" class="mn mo it mj b gy mt mq l mr ms"># selecting all origins from Tartu County<br/>origins = movements[movements['KANT_start'].isin(tartu_communities)]</span><span id="17e8" class="mn mo it mj b gy mt mq l mr ms"># selecting all destination from Tartu County origins<br/>movements_tartu =  origins[origins['KANT_end'].isin(tartu_communities)]</span></pre><p id="9b68" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们在<em class="le"> geopandas </em>中读取它，因为我们需要在下一步中对列进行几何处理。</p><p id="5cfe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">1.3小叶向WGS84的坐标转换</p><p id="c0ff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在活页中，数据集必须以WGS84坐标显示。在这里，我使用了一个技巧。我将投影数据集两次。第一次是获取始发地WGS84中的经纬度，第二次是获取目的地的坐标。我投影两次，因为通过创建一个几何图形，它在爱沙尼亚投影中释放，然后我在WGS84中投影，然后我得到纬度和经度。像这样:</p><pre class="kp kq kr ks gt mi mj mk ml aw mm bi"><span id="f944" class="mn mo it mj b gy mp mq l mr ms"># create a geometry column of ORIGIN<br/>movements_tartu = movements_tartu.copy()</span><span id="0d0c" class="mn mo it mj b gy mt mq l mr ms">xorigins = movements_tartu['X_start'].to_list()<br/>yorigins = movements_tartu['Y_start'].to_list()</span><span id="7687" class="mn mo it mj b gy mt mq l mr ms">movements_tartu['geometry'] = [Point(float(xcoor), float(ycoor)) for xcoor, ycoor in zip(xorigins, yorigins)]</span><span id="9839" class="mn mo it mj b gy mt mq l mr ms"># defining data in Estonian coordinate system<br/>movements_tartu.crs = CRS.from_epsg(3301)</span><span id="1151" class="mn mo it mj b gy mt mq l mr ms"># reprojecting to wgs84<br/>movements_tartu = movements_tartu.to_crs(4326)</span><span id="516a" class="mn mo it mj b gy mt mq l mr ms"># add coordinates in wgs82 for ORIGIN<br/>movements_tartu['x_origin'] = [coordinate.x for coordinate in movements_tartu['geometry'].to_list()]<br/>movements_tartu['y_origin'] = [coordinate.y for coordinate in movements_tartu['geometry'].to_list()]</span><span id="3aab" class="mn mo it mj b gy mt mq l mr ms"># update geometry for DESTINATION</span><span id="a744" class="mn mo it mj b gy mt mq l mr ms"># adding geometry with ending point just to obtain coordinates<br/>xdest = movements_tartu['X_end'].to_list()<br/>ydest = movements_tartu['Y_end'].to_list()</span><span id="c6c0" class="mn mo it mj b gy mt mq l mr ms">movements_tartu['geometry'] = [Point(float(xcoor), float(ycoor)) for xcoor, ycoor in zip(xdest, ydest)]</span><span id="410d" class="mn mo it mj b gy mt mq l mr ms"># defining data in Estonian coordinate system<br/>movements_tartu.crs = CRS.from_epsg(3301)</span><span id="7faa" class="mn mo it mj b gy mt mq l mr ms"># reprojecting to wgs84<br/>movements_tartu = movements_tartu.to_crs(4326)</span><span id="5dff" class="mn mo it mj b gy mt mq l mr ms"># add coordinates in wgs82 DESTINATION<br/>movements_tartu['x_dest'] = [coordinate.x for coordinate in movements_tartu['geometry'].to_list()]<br/>movements_tartu['y_dest'] = [coordinate.y for coordinate in movements_tartu['geometry'].to_list()]</span><span id="4627" class="mn mo it mj b gy mt mq l mr ms"># update geometry for origin<br/>movements_tartu['geometry'] = [Point(float(xcoor), float(ycoor)) for xcoor, ycoor in zip(xorigins, yorigins)]</span><span id="b771" class="mn mo it mj b gy mt mq l mr ms"># defining data in Estonian coordinate system<br/>movements_tartu.crs = CRS.from_epsg(3301)</span><span id="4b0a" class="mn mo it mj b gy mt mq l mr ms"># reprojecting to wgs84<br/>movements_tartu = movements_tartu.to_crs(4326)</span></pre><p id="86b8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我为<strong class="js iu"> OD可视化</strong>更新代码，并用WGS84坐标子集化所需的列。</p><pre class="kp kq kr ks gt mi mj mk ml aw mm bi"><span id="68c3" class="mn mo it mj b gy mp mq l mr ms"># updating code of destinations<br/>movements_tartu['end_kant_id'] = list(range(len(movements_tartu)))</span><span id="e898" class="mn mo it mj b gy mt mq l mr ms">movements_tartu['start_kant_id'] = movements_tartu['start_kant_id'].astype(int)<br/>movements_tartu['end_kant_id'] = movements_tartu['end_kant_id'].astype(int)</span><span id="e3e1" class="mn mo it mj b gy mt mq l mr ms"># getting the needed columns<br/>movements_tartu = movements_tartu[['KANT_start', 'KANT_end', 'start_kant_id', 'end_kant_id', 'route_id', <br/>                                   'Population', 'RegularMovers', 'x_origin', 'y_origin', 'x_dest', 'y_dest', 'geometry' ]]</span><span id="085f" class="mn mo it mj b gy mt mq l mr ms">movements_tartu.to_file(r'data/movements_tartu.geojson', driver='GeoJSON')<br/>movements_tartu.head()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi my"><img src="../Images/a595a9919020a087aa4cea47676f4cf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7s5BGO9op43fMOO9qx6t0w.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片由作者提供。塔尔图县运动数据集的最终结构</p></figure><blockquote class="lq lr ls"><p id="bb4c" class="jq jr le js b jt ju jv jw jx jy jz ka lv kc kd ke lx kg kh ki lz kk kl km kn im bi translated"><strong class="js iu"> <em class="it"> 2)宣传单</em> </strong>中的日常通勤互动地图动画</p></blockquote><p id="b9e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们必须创建一个包含必要文件的存储库，以使地图动画工作。我们添加了一个名为<code class="fe mv mw mx mj b">css </code>的文件夹和另一个名为<code class="fe mv mw mx mj b">js.</code>的文件夹，我们还添加了一个名为<code class="fe mv mw mx mj b">index.html</code>的HTML文件，您可以通过在本地磁盘上克隆存储库来获得这些文件。因此，您的本地文件夹可能如下所示:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/b2ad6fda67557f76a26ba839053f2664.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*Vo2j1aB-0CAcXBf9jQpaBA.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片由作者提供。知识库结构。</p></figure><p id="154c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意在<em class="le">数据文件夹</em>中已经有一个<code class="fe mv mw mx mj b">movements_tartu.geojson</code>文件，它是步骤1)的结果</p><p id="ca0b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要使用文件进行web映射，我推荐使用<a class="ae lf" href="https://atom.io/" rel="noopener ugc nofollow" target="_blank"><strong class="js iu">Atom</strong></a><strong class="js iu"/>或者简单地使用<a class="ae lf" href="https://notepad-plus-plus.org/downloads/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">记事本++ </strong> </a> <strong class="js iu">。</strong></p><p id="fdda" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们将下载并复制文件夹<code class="fe mv mw mx mj b">js.</code>中用于web映射的<a class="ae lf" href="https://leafletjs.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">传单API </strong> </a>另外，我们添加一个空的JS文件，在本例中命名为<code class="fe mv mw mx mj b">main-movements-tartu.js</code>最后，我们包含了<code class="fe mv mw mx mj b"><strong class="js iu">CanvasFlowmapLayer.js</strong></code>文件，该文件包含在资源库中，但也可以在<a class="ae lf" href="https://github.com/jwasilgeo/Leaflet.Canvas-Flowmap-Layer" rel="noopener ugc nofollow" target="_blank"><strong class="js iu">jwalsilgeo Github</strong></a>中找到。该文件夹必须如下所示:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi na"><img src="../Images/1cfdae3f278af78f491a765bf4db0f9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*a8_shoZ7nEF55RljLFEQ9Q.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片由作者提供。js文件夹的结构</p></figure><p id="d60c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，在文件夹中，<code class="fe mv mw mx mj b">css </code>我们添加了来自传单的CSS文件和一个空文件，在本例中我们称之为<code class="fe mv mw mx mj b">map-style.css</code> CSS文件夹，如下所示:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/f603a26606746ab2cdc8ad7041737ebf.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*UYkJ_HDIi7HxcjwMfw5nwA.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片由作者提供。CSS文件夹的结构</p></figure><p id="f430" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="le"> 2.1)将文件加载到index.html</em></p><p id="5f07" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将使用Atom或Notepad++打开<em class="le">index.html</em>文件，并开始加载文件。它将包含一个<strong class="js iu">头部</strong>和一个<strong class="js iu">主体</strong>。在主体部分，我们包含了运行地图动画的主要文件，还有传单文件和数据文件。它包括ESRI的基本地图。</p><pre class="kp kq kr ks gt mi mj mk ml aw mm bi"><span id="4609" class="mn mo it mj b gy mp mq l mr ms">&lt;!DOCTYPE HTML&gt;</span><span id="2499" class="mn mo it mj b gy mt mq l mr ms">&lt;html&gt;<br/> &lt;head&gt;<br/>  &lt;meta charset="utf-8"&gt;<br/>  &lt;title&gt;Daily commuting movements home to work - Tartu&lt;/title&gt;</span><span id="9dff" class="mn mo it mj b gy mt mq l mr ms">&lt;!--link to stylesheet--&gt;<br/>  &lt;link rel="stylesheet" href="css/map-style.css"&gt;</span><span id="1e3f" class="mn mo it mj b gy mt mq l mr ms">&lt;!-- link to leaflet stylesheet--&gt;<br/>  &lt;link rel="stylesheet" href="css/leaflet.css"&gt;<br/> &lt;/head&gt;</span><span id="a340" class="mn mo it mj b gy mt mq l mr ms">&lt;body&gt;<br/>  &lt;!--the sequence of elements called matters!--&gt;<br/>  &lt;!-- title of your map--&gt;<br/>  &lt;h1&gt; Daily commuting movements home to work - Tartu &lt;/h1&gt;</span><span id="0c0e" class="mn mo it mj b gy mt mq l mr ms">&lt;!-- division div for the map --&gt;<br/>  &lt;div id="map"&gt;&lt;/div&gt;</span><span id="b5d5" class="mn mo it mj b gy mt mq l mr ms">&lt;!-- link to leaflet javascript library--&gt;<br/>  &lt;script src="js/leaflet-src.js"&gt;&lt;/script&gt;</span><span id="ab32" class="mn mo it mj b gy mt mq l mr ms">&lt;!-- load Esri Leaflet because we want to use an Esri basemap --&gt;<br/>  &lt;script src="<a class="ae lf" href="https://unpkg.com/esri-leaflet@2.3/dist/esri-leaflet.js" rel="noopener ugc nofollow" target="_blank">https://unpkg.com/esri-leaflet@2.3/dist/esri-leaflet.js</a>"&gt;&lt;/script&gt;</span><span id="664f" class="mn mo it mj b gy mt mq l mr ms">&lt;!-- Load animation tweening lib requirement for CanvasFlowMapLayer --&gt;<br/>  &lt;script src="<a class="ae lf" href="https://unpkg.com/@tweenjs/tween.js@18.5.0/dist/tween.umd.js" rel="noopener ugc nofollow" target="_blank">https://unpkg.com/@tweenjs/tween.js@18.5.0/dist/tween.umd.js</a>"&gt;&lt;/script&gt;</span><span id="1ce6" class="mn mo it mj b gy mt mq l mr ms">&lt;!-- then load CanvasFlowMapLayer --&gt;<br/>  &lt;script src="js/CanvasFlowmapLayer.js"&gt;&lt;/script&gt;</span><span id="dcf8" class="mn mo it mj b gy mt mq l mr ms">&lt;!--link to the files that contains geoJson data--&gt;<br/>  &lt;script src="data/movements_tartu.geojson" &gt; &lt;/script&gt;</span><span id="4a1c" class="mn mo it mj b gy mt mq l mr ms">&lt;!-- link to main javascript file --&gt;<br/>  &lt;script src="js/main-movements-tartu.js"&gt;&lt;/script&gt;</span><span id="4086" class="mn mo it mj b gy mt mq l mr ms">&lt;/body&gt;<br/>&lt;html&gt;</span></pre><p id="3856" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="le">2.2)map-style . CSS中的参数</em></p><p id="0780" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们必须样式化HTML文件，并简单地样式化对象:<em class="le">标题、正文、图例和地图</em>。打开<code class="fe mv mw mx mj b">map-style.css</code>，包含下一段代码:</p><pre class="kp kq kr ks gt mi mj mk ml aw mm bi"><span id="a32f" class="mn mo it mj b gy mp mq l mr ms">h1{<br/> position: fixed;<br/> font-family: "Times New Roman", Times, serif;<br/> font-size: 24px;<br/>  box-shadow: 2px 2px 3px 3px black;<br/> background: lightgray;<br/>    color: black;<br/>    margin-left:5%;<br/>    margin-top: 0.6%;<br/>    z-index: 2;<br/>}<br/>body{<br/> width: 100%;<br/> height: 100%;<br/> margin: 0px;<br/> font-family: "Times New Roman";<br/>}<br/>.info {<br/>    padding: 6px 8px;<br/>    font-family: "Times New Roman", Times, sans-serif;<br/>    font-size: 16px;<br/>    background: white;<br/>    background: rgba(255,255,255,0.8);<br/>    box-shadow: 0 0 15px rgba(0,0,0,0.2);<br/>    border-radius: 5px;<br/>}<br/>.info h3 {<br/>  font-size: 18px;<br/>  font-family:  "Times New Roman", Times, serif;<br/>  text-decoration: underline;<br/>  text-shadow: 2px 2px 5px gray;<br/>    margin: 0 0 5px;<br/>    color: #282825   ;<br/>}<br/>.legend {<br/>    line-height: 20px;<br/>    color: #555;<br/>}<br/>.legend i {<br/>    width: 25px;<br/>    height: 18px;<br/>    float: left;<br/>    margin-right: 8px;<br/>    opacity: 0.7;<br/>}<br/>#map {<br/> height:100%;<br/> width:100%;<br/> left:0%;<br/> overflow:hidden;<br/> position:fixed;<br/> border:1px #444 solid;<br/>}</span></pre><p id="cfa7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您在浏览器中打开index.html，您可能会看到如下所示的空白画布:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nc"><img src="../Images/cced9222b432794e7a4a9964462f6df2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*74o-KKLBHUItZF4GMJkrOA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片由作者提供。空画布</p></figure><p id="2ad2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="le"> 2.3)定义数据移动中的变量-tartu.js </em></p><p id="58e8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要在传单中包含运动数据集，您可能需要将其定义为一个变量。您需要打开数据文件，并包含<code class="fe mv mw mx mj b">var geoJsonFeatureCollection =</code>因此，数据文件必须如下所示:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nd"><img src="../Images/1747eb223009829f37eaede594513800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FjRAU7kTZ07fZXxDd4GeJA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片由作者提供。数据的变量定义</p></figure><p id="4cbc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="le"> 2.4)在main-movement-Tartu . js</em></strong>中创建地图动画</p><p id="b246" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里，我们将开始创建带有传单的地图，并制作塔尔图县附近的运动动画。我们一步一步来。你可以看一下<a class="ae lf" href="https://leafletjs.com/examples/choropleth/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> <em class="le">传单互动Choropleth Map </em> </strong> </a>的例子，我在建立Map变量和定义图例颜色时得到了一些帮助。</p><p id="e60d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们为地图添加一个变量，定义缩放级别和中心。然后，我们添加一个ESRI底图。</p><pre class="kp kq kr ks gt mi mj mk ml aw mm bi"><span id="4101" class="mn mo it mj b gy mp mq l mr ms">//--- PART 1: ADDING BASE MAPS AND SCALE BAR ---</span><span id="4465" class="mn mo it mj b gy mt mq l mr ms">// variable for the map<br/>var map = L.map('map', {<br/> center: [58.57, 25.5],<br/> zoom: 8<br/>});</span><span id="8a49" class="mn mo it mj b gy mt mq l mr ms">var esri = L.esri.basemapLayer('DarkGray');<br/> esri.addTo(map);</span><span id="6f74" class="mn mo it mj b gy mt mq l mr ms">L.control.scale({imperial:false, position:'bottomright'}).addTo(map);</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ne"><img src="../Images/ce45f0395855f60c91453e43d9988923.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0MuwxXyfbmbNwlfr1Dhdyw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片作者。从传单和ESRI底图添加的地图对象</p></figure><p id="07e7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们用动画功能添加运动数据。</p><pre class="kp kq kr ks gt mi mj mk ml aw mm bi"><span id="bfcc" class="mn mo it mj b gy mp mq l mr ms">// — — PART 2: ADDING ANIMATION OF OD MATRIX WITH VARIABLE geoJsonFeatureCollection — -</span><span id="8558" class="mn mo it mj b gy mt mq l mr ms">var oneToManyFlowmapLayer = L.canvasFlowmapLayer(geoJsonFeatureCollection, {<br/> originAndDestinationFieldIds: {<br/> originUniqueIdField: ‘start_kant_id’,<br/> originGeometry: {<br/> x: ‘x_origin’,<br/> y: ‘y_origin’<br/> },<br/> destinationUniqueIdField: ‘end_kant_id’,<br/> destinationGeometry: {<br/> x: ‘x_dest’,<br/> y: ‘y_dest’<br/> }<br/> },<br/> canvasBezierStyle: {<br/> type: ‘classBreaks’,<br/> field: ‘RegularMovers’,<br/> classBreakInfos: [{<br/> classMinValue: 0,<br/> classMaxValue: 24,<br/> symbol: {<br/> strokeStyle: ‘#fee8c8’,<br/> lineWidth: 0.5,<br/> lineCap: ‘round’,<br/> shadowColor: ‘#fee8c8’,<br/> shadowBlur: 2.0<br/> }<br/> }, {<br/> classMinValue: 25,<br/> classMaxValue: 100,<br/> symbol: {<br/> strokeStyle: ‘#fdbb84’,<br/> lineWidth: 1.5,<br/> lineCap: ‘round’,<br/> shadowColor: ‘#fdbb84’,<br/> shadowBlur: 2.0<br/> }<br/> }, {<br/> classMinValue: 101,<br/> classMaxValue: 10000000,<br/> symbol: {<br/> strokeStyle: ‘#e34a33’,<br/> lineWidth: 3,<br/> lineCap: ‘round’,<br/> shadowColor: ‘#e34a33’,<br/> shadowBlur: 2.0<br/> }<br/> }],<br/> defaultSymbol: {<br/> strokeStyle: ‘#e7e1ef’,<br/> lineWidth: 0.5,<br/> lineCap: ‘round’,<br/> shadowColor: ‘#e7e1ef’,<br/> shadowBlur: 1.5<br/> },<br/> },<br/> pathDisplayMode: ‘selection’,<br/> animationStarted: true<br/>}).addTo(map);</span><span id="d01a" class="mn mo it mj b gy mt mq l mr ms">// Selection for dispaly<br/>oneToManyFlowmapLayer.on('mouseover', function(e) {<br/> if (e.sharedOriginFeatures.length) {<br/> oneToManyFlowmapLayer.selectFeaturesForPathDisplay(e.sharedOriginFeatures, 'SELECTION_NEW');<br/> }<br/> if (e.sharedDestinationFeatures.length) {<br/> oneToManyFlowmapLayer.selectFeaturesForPathDisplay(e.sharedDestinationFeatures, 'SELECTION_NEW');<br/> }<br/>});</span><span id="8738" class="mn mo it mj b gy mt mq l mr ms">oneToManyFlowmapLayer.selectFeaturesForPathDisplayById('start_kant_id', 673, true, 'SELECTION_NEW');</span></pre><p id="e9d7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你更新<code class="fe mv mw mx mj b">index.html</code>，你已经可以看到动画了。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nf"><img src="../Images/4c258a024e56953048af2817fbcce5af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kueGZi1fyNmZwVQoX0Iufw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片由作者提供。塔尔蒂县每日通勤回家工作的交互式流程图</p></figure><p id="30dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们已经定义了运动将通过<code class="fe mv mw mx mj b">mouseover </code>动作可视化。因此，与地图动画的交互只需要将鼠标悬停在元素周围。此外，我们定义了3个类以及起点和终点的坐标。最后，我们添加带有颜色的图例，如果你需要支持选择颜色，你可以使用<a class="ae lf" href="https://colorbrewer2.org/#type=sequential&amp;scheme=BuGn&amp;n=3" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> ColorBrewer来绘制</strong> </a>:</p><pre class="kp kq kr ks gt mi mj mk ml aw mm bi"><span id="d19a" class="mn mo it mj b gy mp mq l mr ms">//PART 3. ADDING A LEGEND WITH COLORS</span><span id="6d05" class="mn mo it mj b gy mt mq l mr ms">function getColor(d) {<br/>return d &gt; 100  ? '#e34a33' :<br/>       d &gt; 24   ? '#fdbb84' :<br/>                '#fee8c8' ;<br/>}</span><span id="effa" class="mn mo it mj b gy mt mq l mr ms">var legendcolor = L.control({position: 'bottomright'});</span><span id="196c" class="mn mo it mj b gy mt mq l mr ms">legendcolor.onAdd = function (map) {<br/>  var div = L.DomUtil.create('div', 'info legend'),<br/>    grades = [0, 24, 100],<br/>    labels = [];<br/>    // loop through our density intervals and generate a label with a colored square for each interval<br/>        for (var i = 0; i &lt; grades.length; i++) {<br/>            div.innerHTML +=<br/>            '&lt;i class ="line" style="background:' + getColor(grades[i] + 1) + '"&gt;&lt;/i&gt; ' +<br/>            grades[i] + (grades[i + 1] ? '&amp;ndash;' + grades[i + 1] + '&lt;br&gt;' : '+');</span><span id="2e9e" class="mn mo it mj b gy mt mq l mr ms">}    return div;<br/>       };<br/>legendcolor.addTo(map);</span></pre><p id="8d9d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">与传说看起来是这样的。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ng"><img src="../Images/3e68a34c28f0a28f2558221ee6f45808.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i5ZKDsereG5drgcZD4Wh0A.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">图片由作者提供。带图例的最终地图</p></figure><blockquote class="lq lr ls"><p id="418d" class="jq jr le js b jt ju jv jw jx jy jz ka lv kc kd ke lx kg kh ki lz kk kl km kn im bi translated"><strong class="js iu">推荐</strong></p></blockquote><p id="e5d0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你对网页地图的活页JavaScript有经验。您可以添加社区作为背景，或者添加一个带有社区名称的信息框。我把这个自由留给用户。但是现在，你有了塔尔图县的起点-终点矩阵的基础。</p><blockquote class="lq lr ls"><p id="4bec" class="jq jr le js b jt ju jv jw jx jy jz ka lv kc kd ke lx kg kh ki lz kk kl km kn im bi translated"><strong class="js iu">结论</strong></p></blockquote><p id="84ce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">塔尔图县在家工作运动的地图动画有助于城市规划者了解人口动态(空间流动性)。有了这个，运输就可以改善，尤其是旅行时间。当然，人们更喜欢开快车去上班。此外，本地投资可以是一个长期的选择，投资于房地产的办公室。如果人们是为了工作而迁移，这肯定是一个潜在的经济增长的地方。</p><p id="ffa9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您需要OD矩阵可视化或Python编码地图方面的支持，您可以在我的<a class="ae lf" href="https://www.linkedin.com/in/bryanrvallejo/" rel="noopener ugc nofollow" target="_blank"> LinkedIn个人资料</a>中找到我，或者在本文中发表评论。</p><blockquote class="lq lr ls"><p id="6a99" class="jq jr le js b jt ju jv jw jx jy jz ka lv kc kd ke lx kg kh ki lz kk kl km kn im bi translated"><strong class="js iu">参考文献</strong></p></blockquote><p id="d6c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">[1]阿哈斯，r .，西尔姆，s .，约尔夫，o .，萨卢维尔，e .，蒂鲁，M. (2010年)。<em class="le"/><strong class="js iu"><em class="le">利用移动定位数据对手机用户有意义的位置进行建模。</em> </strong>卷十七。https://doi.org/10.1080/10630731003597306</p><p id="03bc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">[2] Aasa，A. (2019)。<strong class="js iu"> <em class="le">【数据集】</em> </strong>爱沙尼亚日常规律运动OD矩阵。塔尔图大学移动实验室。<a class="ae lf" href="https://doi.org/10.23659/UTMOBLAB-1" rel="noopener ugc nofollow" target="_blank">https://doi.org/10.23659/UTMOBLAB-1</a></p></div></div>    
</body>
</html>