<html>
<head>
<title>Multi-label Emotion Classification with PyTorch + HuggingFace’s Transformers and W&amp;B for Tracking</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PyTorch + HuggingFace的Transformers和W&amp;B进行跟踪的多标签情感分类</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/multi-label-emotion-classification-with-pytorch-huggingfaces-transformers-and-w-b-for-tracking-a060d817923?source=collection_archive---------6-----------------------#2021-08-17">https://towardsdatascience.com/multi-label-emotion-classification-with-pytorch-huggingfaces-transformers-and-w-b-for-tracking-a060d817923?source=collection_archive---------6-----------------------#2021-08-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="9475" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="c7a1" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">把拥抱脸和W&amp;B的力量加入到你的PyTorch代码中！</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/fafd55cfde6e908558ab10b284316b8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DJwImDciI9gYWvJgs_L5MA.jpeg"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated"><a class="ae le" href="https://unsplash.com/@tengyart" rel="noopener ugc nofollow" target="_blank">腾雅特</a>在<a class="ae le" href="https://unsplash.com" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="c5b6" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">介绍</h1><p id="5a2e" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">自然语言处理(NLP)正在以前所未有的速度在工业4.0中大步前进，并以一种闪烁的速度前进。它被广泛用于将非结构化文本处理成各种商业案例的有意义的知识。它已经被用于多种任务，如分类、主题建模、文本生成、问答、推荐等。一种很少被提及的特殊分类是多标签分类。</p><p id="5ecf" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">多标签文本分类涉及预测给定文本的多个可能标签，不像<em class="my">多类</em>分类，其仅具有来自“N”个可能类的单个输出，其中N &gt; 2。多标签文本分类是许多ML库中很少涉及的主题，对于某些任务，如日志度量等，您需要自己编写大部分代码。您还需要了解某些变通方法，以获得一些有意义的结果。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mz"><img src="../Images/9233e4846a9ed78374b5f6c723033448.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UP6N3_rxVXNy3PsIaLBgbQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">二元对多类对多标签分类。作者图片</p></figure><p id="053c" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">我想做这个项目的一个关键原因是让我自己熟悉<a class="ae le" href="https://wandb.ai" rel="noopener ugc nofollow" target="_blank">Weights and bias(W&amp;B)</a>库，这个库和<a class="ae le" href="https://huggingface.co" rel="noopener ugc nofollow" target="_blank"> HuggingFace </a>库一起在我的技术Twitter上引起了热议。在PyTorch中使用多标签分类及其与W &amp; B的集成方面，我没有找到很多好的参考资料。因此，我想整理一篇文章以方便参考。不要担心，我会在我们进行的过程中讨论什么是W &amp; B，你会很幸运地知道，有了这个令人敬畏的图书馆，我们的生活变得多么方便！在本文中，我们将讨论以下内容:</p><ol class=""><li id="774e" class="na nb iq lz b ma mt md mu mg nc mk nd mo ne ms nf ng nh ni bi translated">与…一起工作🤗用于加载数据集的数据集库</li><li id="4e6e" class="na nb iq lz b ma nj md nk mg nl mk nm mo nn ms nf ng nh ni bi translated">使用构建经典PyTorch训练器🤗变形金刚图书馆的SqueezeBERT模型</li><li id="5d52" class="na nb iq lz b ma nj md nk mg nl mk nm mo nn ms nf ng nh ni bi translated">用PyTorch集成W&amp;B库</li><li id="a7d2" class="na nb iq lz b ma nj md nk mg nl mk nm mo nn ms nf ng nh ni bi translated">用🧹w &amp; b扫描执行超参数扫描</li></ol><p id="1e54" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">所以，不要浪费任何时间，让我们开始吧！</p><h1 id="345f" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">数据集使用🤗数据集</h1><p id="c7f9" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">HuggingFace的网站有一个几乎所有类型的NLP任务的巨大数据集集合！它还允许用户通过使用<a class="ae le" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>制作的内置数据集可视化工具来可视化数据集的某些方面。在浏览数据集列表时，一个特殊的多标签分类引起了我的注意:<a class="ae le" href="https://huggingface.co/datasets/go_emotions" rel="noopener ugc nofollow" target="_blank"><strong class="lz ja"/></a>。其摘要指出:</p><blockquote class="no np nq"><p id="f992" class="lx ly my lz b ma mt ka mc md mu kd mf nr mv mi mj ns mw mm mn nt mx mq mr ms ij bi translated">GoEmotions数据集包含58k条精心策划的Reddit评论，标记为27种情感类别或中性。包括原始数据以及具有预定义训练/val/测试分割的数据集的较小简化版本。</p></blockquote><p id="0ad1" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">在他们的可视化工具上浏览了这个数据集中的几个例子后，我意识到这是一个极其重要的数据集，因为很难找到超过5-6种情绪的情绪分类器数据集。但是在这里，我们有27种情绪被分配，有非常罕见和接近的情绪，如失望、不赞成、悲伤、悔恨、悲伤等。在典型的数据集中，检测如此接近的情绪通常是困难的。这让我明白这是一个非常好的数据集，可以在许多涉及文本分析的应用程序中扩展使用。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nu"><img src="../Images/ebe32fa869370b4bfb420d888b52fed1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U_urbzMcF3XyrPQ40gYkVw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">数据集中的情感标签列表。作者图片</p></figure><h1 id="1b93" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">权重和偏差介绍(W&amp;B)</h1><p id="cd01" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">日志度量一直是许多数据科学家和AI/ML爱好者头疼的问题。编写计算指标、存储指标和绘制图表的代码是一项非常普通的任务。此外，当您在一个专业的环境中工作时，您不希望您的客户或团队领导浏览整个代码来找到那些图。因此，您必须截取屏幕截图，然后准备一份单独的报告或演示文稿来分享您的结果。想象一下你花在所有这些步骤上的时间。</p><p id="2734" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">值得庆幸的是，有人听到了我们的抱怨和咆哮，并决定建立一个库，使所有这些自动化，并在组织我们的代码、数据、指标和运行方面走得更远，比我们组织我们的卧室更好👀。欢迎，重量和偏见(W&amp;B)🙌。</p><p id="b8f1" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">W&amp;B允许我们使用几行代码实时监控我们的数据、代码、超参数、指标和培训。它提供了一个直观的仪表板，并与PyTorch、Tensorflow、fast.ai、Keras、JAX等流行的库集成。它允许我们以更有组织的方式找到最好的模型，而不是使用打印语句和手工记录。首先，你需要在他们的<a class="ae le" href="https://wandb.ai/login?signup=true" rel="noopener ugc nofollow" target="_blank">网站</a>上注册一个账户，然后你的项目跟踪就可以在你的账户上使用了！</p><h1 id="82d5" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">好了，理论讲够了，我们来编码吧！</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/d9f55ddb93e16f4f6c0d53d4f25e48c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/0*8oRuNzwzf3QI7cwE.gif"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">这是你对吗？来源:男高音</p></figure><p id="9876" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">现在，让我们用编码来弄脏我们的手。我使用PyTorch是因为它简单易懂，并且能够从头开始构建东西，这让我感觉更舒服。我已经在Google Colab上编码了整个东西，所以我只需要做一些额外的安装。但是，如果您在本地运行它，请注意下面的导入，您的系统中可能没有安装这些导入。然而，我强烈建议你使用Google Colab，因为它允许你在网络上进行深度学习实验，而无需在笔记本电脑上加载任何负载。</p><blockquote class="no np nq"><p id="7393" class="lx ly my lz b ma mt ka mc md mu kd mf nr mv mi mj ns mw mm mn nt mx mq mr ms ij bi translated">从这一点开始，这篇文章可能会有点长，因为我将同时讨论W &amp; B和多标签分类。所以，在我们踏上这个奇妙的旅程时，请耐心等待！🙈</p></blockquote><p id="4fd3" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated"><strong class="lz ja">全部代码在我的资源库</strong> <a class="ae le" href="https://github.com/arghyadeep99/Multi-label-Emotion-Classification" rel="noopener ugc nofollow" target="_blank"> <strong class="lz ja">这里</strong> </a> <strong class="lz ja">都有。</strong></p><h2 id="8719" class="nw lg iq bd lh nx ny dn ll nz oa dp lp mg ob oc lr mk od oe lt mo of og lv iw bi translated">1.安装依赖项⏬</h2><p id="f628" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">我们可以使用以下命令在Google Colab中进行必要的安装:</p><p id="e797" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated"><code class="fe oh oi oj ok b">!pip3 install datasets transformers -q</code></p><p id="3269" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated"><code class="fe oh oi oj ok b">!pip3 install wandb --upgrade</code></p><p id="937e" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">现在，我们可以使用以下方式登录我们的wandb帐户:</p><p id="3efb" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated"><code class="fe oh oi oj ok b">import wandb</code></p><p id="785a" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated"><code class="fe oh oi oj ok b">wandb.login()</code></p><p id="6083" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">系统会提示您单击一个链接，复制您的授权令牌并将其粘贴到文本框中，以将您的项目与您的WandB帐户连接起来。</p><h2 id="0063" class="nw lg iq bd lh nx ny dn ll nz oa dp lp mg ob oc lr mk od oe lt mo of og lv iw bi translated">2.必要的进口🚀</h2><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ol om l"/></div></figure><h2 id="d586" class="nw lg iq bd lh nx ny dn ll nz oa dp lp mg ob oc lr mk od oe lt mo of og lv iw bi translated">3.播种一切可复制性！🌱</h2><p id="a899" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">播种是一个非常重要的概念，我经常在许多中等代码教程中发现缺失。我发现帮助读者重现和匹配结果是一个重要的实践。所以，让我们播种一切吧！</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ol om l"/></div></figure><h2 id="b76d" class="nw lg iq bd lh nx ny dn ll nz oa dp lp mg ob oc lr mk od oe lt mo of og lv iw bi translated">4.定义超参数扫描🧹的扫描配置</h2><p id="e513" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">为了执行超参数调整，我们从定义的列表中尝试不同的配置，然后尝试在我们的主训练循环中运行它们，并手动记录每个组合的结果，以找到最佳的超参数集。告别这种中世纪(就AI进步而言)的做法，用超参数横扫🧹做同样的事情！我们将定义一组我们想要使用的超参数，并设置它们可能的值。我们还定义了我们想要最大化或最小化的指标。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="f26a" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">最后，我们定义了一个扫描ID，它将使用不同的超参数组合对训练函数进行扫描。</p><h2 id="82f6" class="nw lg iq bd lh nx ny dn ll nz oa dp lp mg ob oc lr mk od oe lt mo of og lv iw bi translated">5.从加载数据集🤗数据集和一次性编码</h2><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ol om l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi on"><img src="../Images/e64eb2bd16635702fcb268a2555c1cdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*oXbqTW_8-i_To3NAlLmfGQ.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">train.head()输出。作者图片</p></figure><p id="9057" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">我们可以看到数据集有与每个样本相关联的文本、id和标签。然而，为了将数据输入到我们的模型中，我们需要执行一次热编码，它有一个非常常见的代码:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ol om l"/></div></figure><h2 id="d485" class="nw lg iq bd lh nx ny dn ll nz oa dp lp mg ob oc lr mk od oe lt mo of og lv iw bi translated">6.定义PyTorch数据集</h2><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="8716" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">我们没有在类中定义记号赋予器，而是将其作为参数传递，以便于使用不同的记号赋予器进行实验。我们按照定义PyTorch数据集类的标准方式来定义GoEmotionsDataset类，以指示如何加载和处理数据集。</p><p id="0d58" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">在我们的例子中，我们获取输入文本，将其标记化，然后返回通过标记化获得的标记id和注意掩码。令牌id只是模型的输入序列的数字表示，而注意掩码用于指示模型应该注意哪些段。</p><h2 id="aa08" class="nw lg iq bd lh nx ny dn ll nz oa dp lp mg ob oc lr mk od oe lt mo of og lv iw bi translated">7.使用神经网络定义分类器模型。组件</h2><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="8f98" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">这里，我们将dropout probability (do_prob)作为一个超参数，将由W&amp;B处理。其余的代码非常标准:用所需的架构初始化模型，并定义向前传递。</p><h2 id="c9d0" class="nw lg iq bd lh nx ny dn ll nz oa dp lp mg ob oc lr mk od oe lt mo of og lv iw bi translated">8.定义返回数据集、数据加载器和模型的函数</h2><p id="1cc4" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">对于我们的超参数跟踪和W&amp;B的集成，重要的是我们大量使用函数编程来确保我们成功地跨函数传递所有对象，并且它们都可以从我们稍后将定义的主训练器函数中调用。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="b558" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">在这里，我们首先定义我们的<strong class="lz ja"> SqueezeBERT </strong>记号化器(与bert-uncased相比非常快，性能几乎相似),然后定义3个函数来返回数据集、数据加载器和我们的模型。所有这些都遵循标准PyTorch管道。同样，将它们定义为函数的主要动机是使我们能够方便地传递我们的超参数，而不是将它们硬编码在模型定义本身中。</p><h2 id="294d" class="nw lg iq bd lh nx ny dn ll nz oa dp lp mg ob oc lr mk od oe lt mo of og lv iw bi translated">9.定义要记录的优化程序、调度程序、损失函数和度量</h2><p id="5771" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">我从<a class="ae le" href="https://www.youtube.com/c/AbhishekThakurAbhi" rel="noopener ugc nofollow" target="_blank"> Abhishek Thakur的</a> <a class="ae le" href="https://github.com/abhishekkrthakur/tez/blob/main/examples/text_classification/binary.py" rel="noopener ugc nofollow" target="_blank">知识库</a>中获取了优化器和调度器代码，用于使用BERT进行情感分类。</p><p id="93b4" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated"><strong class="lz ja">优化器功能:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="1eb7" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated"><strong class="lz ja">调度程序功能:</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="8580" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated"><strong class="lz ja">损失函数或准则:</strong></p><p id="06d3" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">对于损失函数，我们选择了具有Logits损失的<strong class="lz ja">二元交叉熵(BCE)</strong>。BCE <strong class="lz ja">将每个预测概率与实际类输出进行比较，实际类输出可以是0或1 </strong>。然后，它根据与期望值的距离计算惩罚概率的分数。这意味着离实际值有多近或多远。当与Sigmoid层结合时，会在PyTorch中产生BCEWithLogitsLoss()。也可以使用MultiLabelSoftMarginLoss()来解决多标签问题。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ol om l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/64c1667681461652ab984667c0743f5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*L1r70vESUtivLKHAsnuyZQ.png"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">具有Logits损失函数的BCE</p></figure><p id="334a" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated"><strong class="lz ja">要记录的度量:</strong></p><p id="41c8" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated"><a class="ae le" href="https://www.scikit-yb.org/en/latest/api/classifier/rocauc.html#:~:text=A%20ROCAUC%20(Receiver%20Operating%20Characteristic,the%20classifier's%20sensitivity%20and%20specificity." rel="noopener ugc nofollow" target="_blank"> ROC-AUC </a>评分是衡量我们多类分类性能的好方法。但是，通过对每个目标分别应用它，可以将其推广到多标签场景。然而，这对于我们的大脑来说太多了，因此，我们可以简单地使用微AUC。PyTorch中用于这种多标签分类的一个巧妙技巧是使用ravel()函数展开目标和标签，然后我们应用micro AUC函数。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ol om l"/></div></figure><h2 id="4459" class="nw lg iq bd lh nx ny dn ll nz oa dp lp mg ob oc lr mk od oe lt mo of og lv iw bi translated">10.定义培训和验证步骤功能</h2><p id="d198" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">我再次从Abhishek Thakur的知识库中提取了这些代码片段，并根据我的问题陈述对它们进行了修改:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ol om l"/></div></figure><h2 id="166b" class="nw lg iq bd lh nx ny dn ll nz oa dp lp mg ob oc lr mk od oe lt mo of og lv iw bi translated">11.定义培训师职能⭐️</h2><p id="e47e" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">为了将所有内容整合在一起，我们现在将定义执行培训的培训师职能。在我们的分类器模型中，我们将使用SqueezeBERT作为BERT层。这个教练功能也是W&amp;B魔法发生的地方！</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="b7d3" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">你在这里观察到一些新的东西吗？是的，旺德贝线！您可以看到，我们在开始时使用了上下文管理器和with <strong class="lz ja"> wandb.init() </strong>语句来初始化运行。训练功能的每次执行是一次运行。我们将扫描配置传递给训练器函数，该函数用于设置不同的超参数，如batch_size、dropout、epochs等。另一个基于wandb的行是<strong class="lz ja"> wandb.watch() </strong>，它用于观察模型的梯度，以及它们如何随着训练而演变。这有助于尽可能提供更多的可解释性。</p><p id="156f" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">wandb的下一次出现在<strong class="lz ja"> wandb.log() </strong>中，它帮助我们记录相关参数，我们希望看到这些参数随着训练的进行而变化。在我们的案例中，我们记录了时期、训练和验证损失以及AUC分数。最后，为了开始不同超参数组合的扫描，我们将调用<code class="fe oh oi oj ok b">wandb.agent()</code>，在这里我们传递配置和训练器函数的sweep_id。我们还传递count=6，以限制我们想要执行的运行次数。这仅在进行随机搜索而非网格搜索时使用。一旦训练开始，你可以在W &amp; B宏伟的仪表盘中实时监控训练！🤌🏻</p><h1 id="8d45" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">跳上你的W&amp;B仪表板，看看神奇的展开！</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi op"><img src="../Images/4b1905bd53c285ca93aa271e7ea8cb8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X_ZLIZet-FooEObQEhnnJw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">W&amp;B仪表板的概述。作者图片</p></figure><p id="b6f2" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">在这里，您可以看到扫掠中的每个管路都有一个唯一的名称，您可以轻松地对其进行重命名或删除。您还会注意到参数对于我们正在监控的指标的重要性(此处为AUC得分)。这是一个极其重要的特征，因为它告诉我们哪些超参数对我们的分数影响最大。在我们的例子中，我们可以看到辍学对AUC分数有很大的影响。当我们想要设置最佳超参数设置时，这是一条需要注意的关键信息。当我们向下滚动时，我们看到了扫描图，它显示了每个超参数组合如何产生特定的AUC分数。这是W&amp;B在Sweeps中提供的我特别喜欢的图表类型！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oq"><img src="../Images/ed0889515e2cfeb3ac4362071e6d524f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y-51eWFw4AeOimE9y6tIqg.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">扫描图表。太酷了！作者图片</p></figure><p id="5c91" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">这里，图表清楚地向我显示了产生最佳AUC分数的组合(黄色图)。如果你渴望用老派的方式查看数据，你还可以得到一个不错的表格格式！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi or"><img src="../Images/4b7c68b631aadcfe4444fd5fe24c1012.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KZqmYwxfOu41Ga4CC4_4Zw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">扫地台。作者图片</p></figure><p id="23b4" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">除此之外，我们还获得了我们记录的度量的图表，并获得了所有不同运行的比较图。您甚至可以关闭某些运行的可视化，以比较其余的期望运行！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi os"><img src="../Images/8650f125ebbb075c106c0ecc7d8e1892.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FwOo9lDCmptAgJPXZ8fRlg.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">其他度量图。作者图片</p></figure><p id="0be1" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">如果您已经被4-5行wandb所能做的事情弄得不知所措，请耐心等待，因为我将向您展示更多内容！还记得<strong class="lz ja"> wandb.watch(型号)</strong>那条线吗？你认为我们为什么要观察这个模型？嗯，你可以去每次跑步，看看在训练中模型的梯度是什么样的！这对模型可解释性和可解释性研究人员来说极其重要！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ot"><img src="../Images/3459151b5c9fcc6bd5f9f42414469ef2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*reNl_v_20Jv4kvfoD7qMTQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">模型梯度演化。作者图片</p></figure><p id="aa83" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">但就这样了吗？再说一次，不！您甚至可以使用W&amp;B观察系统指标，它显示各种图表，如内存使用情况、CPU/GPU使用情况、温度、磁盘使用情况等。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ou"><img src="../Images/f23ed8fdeb7150db151c67c23c330470.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zVWX-vwssAtzuAQ0QJpaJw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">系统指标图。作者图片</p></figure><p id="2a11" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">如果你认为这些是你能绘制的唯一的库驱动图，你就错了。您可以混合匹配您记录的任何参数，然后轻松地绘制它们，以查看它们的比较。您可以根据需要灵活地制作图表，甚至使用W&amp;B生成报告！然而，与团队共享它需要团队的<em class="my"> W &amp; B。</em></p><p id="0214" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">它还记录它在训练脚本中看到的所有输出，以及通过版本控制记录代码和数据集。不仅如此，它还根据训练脚本自己生成一个requirements.txt文件。所以，现在你甚至不需要pip冻结，你可以直接下载这个文件，并与他人分享！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ov"><img src="../Images/f54dff2146254b07d15dbe98a0840191.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kw_Dwuu5HtBIkW-9b1ShLw.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者在黑白图像中自动生成的文件</p></figure><p id="0dda" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">wandb库不断增加越来越多的特性，如表格等。因为这篇文章已经太长了，所以我把它留到以后讨论。因此，长话短说，训练信息现在在W&amp;B的仪表板上有一个漂亮的庇护所，这将使我们能够随时复制实验。这样，我们现在可以使用最佳超参数组合来训练模型，然后使用派生的模型进行推理。从我的训练中，我能够得到一个非常好的模型，AUC分数为0.9459。使用该模型测试非常稳健的AUC分数，其中27/28个类别的标签式AUC分数大于0.8！对于如此复杂的数据集来说，这的确是一个非常令人印象深刻的分类器。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ow"><img src="../Images/66533161039233183957bc9de5f79643.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r6x-hITTOx_aOxFnJzzYbQ.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">标签式AUC-ROC评分。作者图片</p></figure><h1 id="b83e" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">结论</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/ed5c7460c56cfb48bd1d12cf162ff7d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/0*gKIvK0kxuvHnjvwG.gif"/></div><p class="la lb gj gh gi lc ld bd b be z dk translated">来源:男高音</p></figure><p id="63d4" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">唷，我们终于可以结束了！本教程展示了如何在多标签数据集上应用SqueezeBERT，该数据集包含超过50K条评论和28个类。使用PyTorch和变形金刚库。我们还能够通过wandb库实时监控我们的培训。在公开您的项目后，您还可以通过共享“公开”项目链接与他人共享您的整个仪表板！这是我的仪表盘<a class="ae le" href="https://wandb.ai/arghyadeep/bhaavnaye/sweeps/sjgmegk5" rel="noopener ugc nofollow" target="_blank">链接</a>。在未来，我们可以使用Streamlit部署这个多标签情感分类器，并在此基础上构建一个web服务！</p><p id="d5e6" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated"><strong class="lz ja">的全部代码可以在我的资源库</strong> <a class="ae le" href="https://github.com/arghyadeep99/Multi-label-Emotion-Classification" rel="noopener ugc nofollow" target="_blank"> <strong class="lz ja">这里</strong> </a> <strong class="lz ja">中找到。</strong></p><p id="d248" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">感谢您的耐心让我们走到这一步！如果你想了解更多关于wandb库和HuggingFace库的信息，我已经把它们链接到下面了，看看吧！</p><div class="oy oz gp gr pa pb"><a href="https://wandb.ai" rel="noopener  ugc nofollow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd ja gy z fp pg fr fs ph fu fw iz bi translated">权重和偏好-ML开发工具</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">一个中央仪表盘，用于跟踪您的超参数、系统指标和预测，以便您可以比较模型…</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">wandb.ai</p></div></div><div class="pk l"><div class="pl l pm pn po pk pp ky pb"/></div></div></a></div><div class="oy oz gp gr pa pb"><a href="https://docs.wandb.com" rel="noopener  ugc nofollow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd ja gy z fp pg fr fs ph fu fw iz bi translated">权重和偏差</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">Weights &amp; Biases是一个机器学习平台，可以帮助开发者更快地构建更好的模型。使用W&amp;B的轻量级…</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">docs.wandb.com</p></div></div><div class="pk l"><div class="pq l pm pn po pk pp ky pb"/></div></div></a></div><div class="oy oz gp gr pa pb"><a href="https://huggingface.co" rel="noopener  ugc nofollow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd ja gy z fp pg fr fs ph fu fw iz bi translated">拥抱脸-人工智能社区建设未来。</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">我们正在通过开源和开放科学来推进和民主化人工智能的旅程。</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">huggingface.co</p></div></div><div class="pk l"><div class="pr l pm pn po pk pp ky pb"/></div></div></a></div><div class="oy oz gp gr pa pb"><a href="https://www.youtube.com/c/AbhishekThakurAbhi" rel="noopener  ugc nofollow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd ja gy z fp pg fr fs ph fu fw iz bi translated">阿布舍克·塔库尔</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">我制作关于应用机器学习、深度学习和数据科学的视频。我是世界上第一个四大满贯…</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">www.youtube.com</p></div></div><div class="pk l"><div class="ps l pm pn po pk pp ky pb"/></div></div></a></div></div><div class="ab cl pt pu hu pv" role="separator"><span class="pw bw bk px py pz"/><span class="pw bw bk px py pz"/><span class="pw bw bk px py"/></div><div class="ij ik il im in"><p id="aac1" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">我看得出你是个有文化的人，能走到这一步！我很高兴你能走到这一步！别忘了关注我更多这样的ML相关文章！查看我的<a class="ae le" href="https://www.arghyadeepdas.me/" rel="noopener ugc nofollow" target="_blank">网站</a>，关注我的<a class="ae le" href="https://www.linkedin.com/in/arghyadeep-das/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>、<a class="ae le" href="https://github.com/arghyadeep99" rel="noopener ugc nofollow" target="_blank"> GitHub </a>和<a class="ae le" href="https://www.instagram.com/third_root_of_quadratic_eqn/" rel="noopener ugc nofollow" target="_blank"> Instagram </a>！✨</p></div></div>    
</body>
</html>