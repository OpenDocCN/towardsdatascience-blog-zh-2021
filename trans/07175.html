<html>
<head>
<title>Cloud Native Data Pipelines Using ArgoWorkflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用ArgoWorkflow的云原生数据管道</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/cloud-native-data-pipelines-using-argoworkflow-1e1fd8c03939?source=collection_archive---------20-----------------------#2021-06-29">https://towardsdatascience.com/cloud-native-data-pipelines-using-argoworkflow-1e1fd8c03939?source=collection_archive---------20-----------------------#2021-06-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0a71" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">利用容器和Kubernetes扩展您的数据工程管道</h2></div><h1 id="7da7" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">背景</h1><p id="2b7f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">无论您是数据工程师、平台工程师、数据科学家还是ML工程师，在处理数据时，我们都面临着创建管道的挑战。尽管我们的数据处理目标之间存在折衷的差异，但有一点是不变的“我们需要创建和扩展DAG的能力”。在现代计算解决方案中，DAG或有向无环图的概念是核心。简而言之，DAG描述了复杂的非递归计算中的一系列执行步骤，定义可以在<a class="ae lt" href="https://en.wikipedia.org/wiki/Directed_acyclic_graph" rel="noopener ugc nofollow" target="_blank">这里找到</a>。实际上，我们将DAG定义为一组线性任务，这些任务共同作为一个逐步的过程运行。我们的简单目标是使开发和部署管道的过程尽可能自动化和可伸缩。</p><p id="5df9" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">可以使用许多工具来构建管道。<a class="ae lt" href="https://www.datarevenue.com/en-blog/airflow-vs-luigi-vs-argo-vs-mlflow-vs-kubeflow" rel="noopener ugc nofollow" target="_blank">比较选项</a></p><p id="263c" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated"><a class="ae lt" href="https://airflow.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Airflow </a> —基于python的编排平台，专为运营团队和数据科学打造。这个领域最好的用户界面之一</p><p id="54dd" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated"><a class="ae lt" href="https://www.prefect.io/" rel="noopener ugc nofollow" target="_blank">perfect</a>—为开发人员使用而构建的程序编排平台。它是这一领域的新兴工具，正在获得越来越多的关注。</p><p id="8227" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated"><a class="ae lt" href="https://luigi.readthedocs.io/en/stable/index.html" rel="noopener ugc nofollow" target="_blank">Luigi</a>——另一个供开发者使用的开源解决方案</p><p id="372f" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated"><a class="ae lt" href="https://www.bmc.com/it-solutions/control-m.html" rel="noopener ugc nofollow" target="_blank">Ctrl-M</a>—BMC流行的企业工作流管理工具</p><h1 id="ec96" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">DAG已定义</h1><p id="b148" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为什么我们叫他们达戈？DAG是一个有向非循环图，是管道的数学抽象。进一步说，<em class="lz">图</em>是顶点(或点)和边(或线)的集合，表示顶点之间的连接。<em class="lz">有向图</em>是一种图，其中的边指向从一个顶点到另一个顶点的方向。在这种情况下，同一对顶点之间可能存在两条边，但在这种情况下，它们将指向相反的方向。有向图通常被称为有向图。如果一个图包含一个或多个圈，则该图是<em class="lz">循环的</em>，其中<em class="lz">循环</em>被定义为沿着边的顶点之间的路径，该路径允许你沿着唯一的一组边返回到顶点。当一个图不包含圈时，它是无圈的。因此，<em class="lz">有向无环图</em>或<em class="lz"> DAG </em>是没有圈的有向图。</p><h1 id="4c00" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">Argo工作流</h1><p id="c08a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><a class="ae lt" href="https://argoproj.github.io/projects/argo/" rel="noopener ugc nofollow" target="_blank"> Argo WorkFlows </a>是一个云原生计算基础项目，是一个开源的容器原生工作流引擎，用于编排Kubernetes中的作业，将工作流中的每个步骤作为一个容器来实现。Argo使开发人员能够使用类似于传统YAML的自定义DSL启动多步管道。该框架提供了复杂的循环、条件、依赖管理和DAG等。这有助于增加部署应用程序堆栈的灵活性以及配置和依赖性的灵活性。使用Argo，开发人员可以定义依赖关系，以编程方式构建复杂的工作流，将任何步骤的输出作为输入链接到后续步骤的工件管理，并在易于阅读的UI中监控计划的作业。Argo是作为Kubernetes CRD(自定义资源定义)实现的。因此，Argo工作流可以使用kubectl进行管理，并与其他Kubernetes服务(如卷、秘密和RBAC)进行本机集成，并提供完整的工作流功能，包括参数替换、工件、夹具、循环和递归工作流。</p><h1 id="c5f9" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">其他功能</h1><ul class=""><li id="4526" class="ma mb iq kz b la lb ld le lg mc lk md lo me ls mf mg mh mi bi translated">可视化和管理工作流的用户界面</li><li id="e2d7" class="ma mb iq kz b la mj ld mk lg ml lk mm lo mn ls mf mg mh mi bi translated">工作流模板用于存储集群中常用的工作流</li><li id="eb4a" class="ma mb iq kz b la mj ld mk lg ml lk mm lo mn ls mf mg mh mi bi translated">计划的工作流</li><li id="3959" class="ma mb iq kz b la mj ld mk lg ml lk mm lo mn ls mf mg mh mi bi translated">带有REST API的服务器接口</li><li id="f5f3" class="ma mb iq kz b la mj ld mk lg ml lk mm lo mn ls mf mg mh mi bi translated">基于DAG或步骤的工作流声明</li><li id="9d45" class="ma mb iq kz b la mj ld mk lg ml lk mm lo mn ls mf mg mh mi bi translated">步骤级输入和输出(工件/参数)</li><li id="cdc4" class="ma mb iq kz b la mj ld mk lg ml lk mm lo mn ls mf mg mh mi bi translated">参数化</li><li id="3631" class="ma mb iq kz b la mj ld mk lg ml lk mm lo mn ls mf mg mh mi bi translated">条件式</li><li id="b278" class="ma mb iq kz b la mj ld mk lg ml lk mm lo mn ls mf mg mh mi bi translated">重试(步骤和工作流级别)</li><li id="cca0" class="ma mb iq kz b la mj ld mk lg ml lk mm lo mn ls mf mg mh mi bi translated">K8s资源编排</li><li id="e034" class="ma mb iq kz b la mj ld mk lg ml lk mm lo mn ls mf mg mh mi bi translated">调度(亲和力/容忍度/节点选择器)</li><li id="7ab1" class="ma mb iq kz b la mj ld mk lg ml lk mm lo mn ls mf mg mh mi bi translated">卷(短期/现有)</li><li id="e2af" class="ma mb iq kz b la mj ld mk lg ml lk mm lo mn ls mf mg mh mi bi translated">平行度限制</li><li id="2019" class="ma mb iq kz b la mj ld mk lg ml lk mm lo mn ls mf mg mh mi bi translated">魔鬼化的步骤</li></ul><h1 id="3cc0" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">管道API</h1><p id="385a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了简化环境和简化实施，我们的目标是利用我们在Docker和Kubernetes上的投资，同时使开发人员能够自动化所有语言和框架的云原生部署管道。</p><p id="2ef1" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">既然我们已经有了所有必要的材料；a)用于代码的容器b)用于访问云资源的容器的编排c)以编程方式构建复杂工作流(DAG)的能力，让我们仔细看看为什么我们开发了管道API。</p><p id="5f0e" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">Argo中的工作流自动化是由YAML模板驱动的(易于采用，因为Kubernetes主要使用相同的DSL ),这些模板是使用ADSL (Argo领域特定语言)设计的。使用ADSL提供的每条指令都被视为一段代码，与github中的应用程序代码一起托管。Argo提供/支持六种不同的YAML构造:<br/> <strong class="kz ir">容器模板:</strong>根据需要创建单个容器和参数<br/> <strong class="kz ir">工作流模板:</strong>定义作业，换句话说就是短时间运行的应用程序，它运行到完成。工作流中的步骤可以是容器<br/> <strong class="kz ir">策略模板:</strong>用于触发/调用作业或通知的规则<br/> <strong class="kz ir">部署模板:</strong>创建长时间运行的应用程序<br/> <strong class="kz ir">固定模板:</strong>将Argo <br/> <strong class="kz ir">项目模板之外的第三方资源粘合起来:</strong>可以在Argo目录中访问的工作流定义。</p><p id="9a2f" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">这些模板提供了一组非常强大的特性，但也会给开发人员带来负担，特别是当它涉及到创建和维护复杂的yaml时。在多系列的这一部分中，我们将展示一个利用<a class="ae lt" href="https://github.com/GoogleCloudPlatform/spark-on-k8s-operator" rel="noopener ugc nofollow" target="_blank"> Spark </a>的管道，这也是一个非常有趣的K8运营商，敬请关注关于该主题的未来文章。</p><h1 id="1d6b" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">项目配置</h1><p id="a582" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">第一步是我们在您的项目中创建一个config.yaml文件，它包含所有关于图像/容器细节的底层细节。配置文件主要包含两个组件:</p><ul class=""><li id="0ec2" class="ma mb iq kz b la lu ld lv lg mo lk mp lo mq ls mf mg mh mi bi translated">容器:包含预构建的容器图像</li><li id="f6ca" class="ma mb iq kz b la mj ld mk lg ml lk mm lo mn ls mf mg mh mi bi translated">资源:可以包含任何需要实现的定制资源定义</li></ul><p id="697e" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">下面是示例yaml，它包含使用<a class="ae lt" href="https://github.com/awslabs/python-deequ/" rel="noopener ugc nofollow" target="_blank"> pydeequ </a>运行示例数据分析器的<code class="fe mr ms mt mu b">jobprofilerclient</code>和使用<a class="ae lt" href="https://github.com/GoogleCloudPlatform/spark-on-k8s-operator" rel="noopener ugc nofollow" target="_blank"> spark操作符</a>运行Spark作业的资源模板<code class="fe mr ms mt mu b">sparkk8sScala</code></p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="91fe" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">现在，您可以使用下面的代码创建一个复杂的DAG:</p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="0f02" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">添加任务后，可以编译DAG，我们还可以查看依赖关系，并将DAG提交到Argo工作流:</p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="5551" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">当提交到ArgoWorkflow时，此代码会生成如下所示的DAG:</p><figure class="mv mw mx my gt mz gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/e0a80ec092193b89de32bb093fc73668.png" data-original-src="https://miro.medium.com/v2/resize:fit:594/format:webp/1*S5vjw8gDN3lY58LPSsOZEA.png"/></div></figure><p id="fdac" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">要查看工作代码，请查看<a class="ae lt" href="https://github.com/IndustrialDataops/argoflow" rel="noopener ugc nofollow" target="_blank"> github </a> repo，在这里我们将继续添加更多的管道API特性。请继续关注更多的用例，包括ML管道。</p><h1 id="220b" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">请联系！</h1><p id="311a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果您有任何问题，请联系我们。在这里找到我【https://www.linkedin.com/in/roberthheise/ T2】</p><p id="33ef" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">你可以在https://www.linkedin.com/in/gopalkrishna9/的<a class="ae lt" href="https://www.linkedin.com/in/gopalkrishna9/" rel="noopener ugc nofollow" target="_blank">找到Gopal</a></p></div></div>    
</body>
</html>