<html>
<head>
<title>Introduction to Anomaly Detection in Python with PyCaret</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用PyCaret介绍Python中的异常检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introduction-to-anomaly-detection-in-python-with-pycaret-2fecd7144f87?source=collection_archive---------3-----------------------#2021-12-15">https://towardsdatascience.com/introduction-to-anomaly-detection-in-python-with-pycaret-2fecd7144f87?source=collection_archive---------3-----------------------#2021-12-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8970" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一步一步，初学者友好的教程，用于使用PyCaret的无监督异常检测任务</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9d208a38055ec93a864b82ee499c6800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HqnOhPiUsWveKOf5"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">卢卡·斯拉普尼卡在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="0415" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">1.介绍</h1><p id="5488" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><a class="ae kv" href="https://www.pycaret.org/" rel="noopener ugc nofollow" target="_blank"> PyCaret </a>是一个用Python编写的开源、低代码的机器学习库，可以自动化机器学习工作流。这是一个端到端的机器学习和模型管理工具，可以成倍地加快实验周期，提高您的工作效率。</p><p id="74b0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">与其他开源机器学习库相比，PyCaret是一个替代的低代码库，可以用来用几行代码替换数百行代码。这使得实验快速有效。PyCaret本质上是几个机器学习库和框架的Python包装器，比如scikit-learn、XGBoost、LightGBM、CatBoost、spaCy、Optuna、Hyperopt、Ray等等。</p><p id="3f69" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">PyCaret的设计和简单性受到了公民数据科学家这一新兴角色的启发，这是Gartner首先使用的术语。公民数据科学家是超级用户，他们可以执行简单和中等复杂的分析任务，这些任务在以前需要更多的技术专业知识。</p><p id="799d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">想了解更多关于PyCaret的信息，可以查看官方<a class="ae kv" href="https://www.pycaret.org/" rel="noopener ugc nofollow" target="_blank">网站</a>或者<a class="ae kv" href="https://www.github.com/pycaret/pycaret" rel="noopener ugc nofollow" target="_blank"> GitHub </a>。</p><h1 id="638c" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">2.辅导的目的</h1><p id="9013" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在本教程中，我们将学习:</p><ul class=""><li id="2dfc" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated"><strong class="lq ir">获取数据:</strong>如何从PyCaret资源库导入数据。</li><li id="1522" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">设置环境:</strong>如何在PyCaret中设置无监督的异常检测实验。</li><li id="d0f8" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">创建模型:</strong>如何创建模型并将异常标签分配给数据集进行分析。</li><li id="a09d" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">图模型:</strong>如何使用各种图分析模型性能。</li><li id="269d" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">预测模型:</strong>如何根据训练好的模型给新的/看不见的数据集分配异常标签？</li><li id="1434" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">保存/加载模型:</strong>如何保存/加载模型以备将来使用？</li></ul><h1 id="2764" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">3.正在安装PyCaret</h1><p id="8309" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">安装很容易，只需几分钟。PyCaret从pip的默认安装只安装在<a class="ae kv" href="https://github.com/pycaret/pycaret/blob/master/requirements.txt" rel="noopener ugc nofollow" target="_blank"> requirements.txt </a>文件中列出的硬依赖项。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="7834" class="ni kx iq ne b gy nj nk l nl nm">pip install pycaret</span></pre><p id="bd01" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">要安装完整版:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="c5f1" class="ni kx iq ne b gy nj nk l nl nm">pip install pycaret[full]</span></pre><h1 id="4ec7" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">4.什么是异常检测？</h1><p id="ed7c" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">异常检测是通过与大多数数据显著不同来识别引起怀疑的罕见项目、事件或观察结果的任务。通常，异常项目会转化为某种问题，如银行欺诈、结构缺陷、医疗问题或文本中的错误。存在三大类异常检测技术:</p><ul class=""><li id="f1a6" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated"><strong class="lq ir">无监督异常检测:</strong>无监督异常检测技术在假设数据集中的大多数实例是正常的情况下，通过寻找似乎最不适合数据集剩余部分的实例来检测未标记测试数据集中的异常。</li><li id="351b" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">监督异常检测:</strong>这种技术需要一个已经被标记为“正常”和“异常”的数据集，并且涉及训练一个分类器。</li><li id="5af1" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">半监督异常检测:</strong>这种技术从给定的正常训练数据集构建一个代表正常行为的模型，然后测试由学习的模型生成测试实例的可能性。</li></ul><h1 id="9249" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">5.PyCaret中异常检测模块概述</h1><p id="5847" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><a class="ae kv" href="https://pycaret.readthedocs.io/en/latest/api/anomaly.html" rel="noopener ugc nofollow" target="_blank"> PyCaret的异常检测模块</a> ( <code class="fe nn no np ne b">pycaret.anomaly</code>)是一个无监督的机器学习模块，它执行识别罕见项目、事件或观察结果的任务，这些项目、事件或观察结果通过与大多数数据显著不同而引起怀疑。</p><p id="d693" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">PyCaret异常检测模块提供了几个预处理功能，可以在初始化设置时通过<code class="fe nn no np ne b">setup</code>功能进行配置。它有超过12种算法和一些图表来分析异常检测的结果。PyCaret的异常检测模块还实现了一个独特的功能<code class="fe nn no np ne b">tune_model</code>，允许您调整异常检测模型的超参数，以优化监督学习目标，例如用于分类的<code class="fe nn no np ne b">AUC</code>或用于回归的<code class="fe nn no np ne b">R2</code>。</p><h1 id="7266" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">6.教程的数据集</h1><p id="4680" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在本教程中，我们将使用来自UCI的名为<a class="ae kv" href="https://archive-beta.ics.uci.edu/ml/datasets/mice+protein+expression" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir">小鼠蛋白质表达</strong> </a>的数据集。数据集由77种蛋白质的表达水平组成，这些蛋白质在皮质的细胞核部分产生可检测的信号。该数据集包含每种蛋白质总共1080次测量。每次测量可以被认为是一个独立的样本(鼠标)。</p><h2 id="55ce" class="ni kx iq bd ky nq nr dn lc ns nt dp lg lx nu nv li mb nw nx lk mf ny nz lm oa bi translated">数据集引用:</h2><p id="9bc3" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">Higuera C，Gardiner KJ，CIO KJ(2015)自组织特征图确定了唐氏综合征小鼠模型中对学习至关重要的蛋白质。PLoS ONE 10(6): e0129126。[网页链接] journal.pone.0129126</p><p id="9abf" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">您可以从这里找到的原始数据源<a class="ae kv" href="https://archive.ics.uci.edu/ml/datasets/Mice+Protein+Expression" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir"/></a>下载数据，并使用pandas <a class="ae kv" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir">(了解如何使用)</strong> </a>加载数据，或者您可以使用PyCaret的数据存储库使用<code class="fe nn no np ne b">get_data()</code>函数加载数据(这将需要互联网连接)。</p><h2 id="8928" class="ni kx iq bd ky nq nr dn lc ns nt dp lg lx nu nv li mb nw nx lk mf ny nz lm oa bi translated">许可证:</h2><p id="a0c1" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这个数据集是在<a class="ae kv" href="https://creativecommons.org/licenses/by/4.0/legalcode" rel="noopener ugc nofollow" target="_blank">知识共享署名4.0国际</a> (CC BY 4.0)许可下许可的。</p><p id="5e98" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这允许为任何目的共享和改编数据集，只要给予适当的信任。(<a class="ae kv" href="https://archive-beta.ics.uci.edu/ml/datasets/mice+protein+expression" rel="noopener ugc nofollow" target="_blank">来源</a>)</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="6073" class="ni kx iq ne b gy nj nk l nl nm">from pycaret.datasets import get_data<br/>dataset = get_data('mice')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/af382c548541ef715b29b6cd93646dd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*k0HIHLK2wg4QVK10.png"/></div></div></figure><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="7b6b" class="ni kx iq ne b gy nj nk l nl nm"><strong class="ne ir"># check the shape of data</strong><br/>dataset.shape<br/>&gt;&gt;&gt; (1080, 82)</span></pre><p id="d229" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为了演示对看不见的数据使用<code class="fe nn no np ne b">predict_model</code>函数，从原始数据集中保留了5% (54条记录)的样本，用于实验结束时的预测。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="4cd3" class="ni kx iq ne b gy nj nk l nl nm">data = dataset.sample(frac=0.95, random_state=786)<br/>data_unseen = dataset.drop(data.index)<br/><br/>data.reset_index(drop=True, inplace=True)<br/>data_unseen.reset_index(drop=True, inplace=True)<br/><br/>print('Data for Modeling: ' + str(data.shape))<br/>print('Unseen Data For Predictions: ' + str(data_unseen.shape))</span><span id="ef7a" class="ni kx iq ne b gy oc nk l nl nm"><strong class="ne ir">&gt;&gt;&gt; Data for Modeling: (1026, 82)<br/>&gt;&gt;&gt; Unseen Data For Predictions: (54, 82)</strong></span></pre><h1 id="6b3e" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">7.在PyCaret中设置环境</h1><p id="e831" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">PyCaret中的<code class="fe nn no np ne b">setup</code>函数初始化环境，并为建模和部署创建转换管道。在pycaret中执行任何其他函数之前，必须调用<code class="fe nn no np ne b">setup</code>。它只需要一个强制参数:熊猫数据帧。所有其他参数都是可选的，可用于定制预处理管道。</p><p id="b070" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">当执行<code class="fe nn no np ne b">setup</code>时，PyCaret的推理算法将根据某些属性自动推断出所有特征的数据类型。应该可以正确推断出数据类型，但情况并非总是如此。为了处理这个问题，一旦执行了<code class="fe nn no np ne b">setup</code>，PyCaret就会显示一个提示，要求确认数据类型。如果所有数据类型都正确，您可以按enter键或键入<code class="fe nn no np ne b">quit</code>退出设置。</p><p id="a990" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">确保数据类型正确在PyCaret中非常重要，因为它会自动执行多个特定于类型的预处理任务，这些任务对于机器学习模型来说是必不可少的。</p><p id="b32c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">或者，您也可以使用<code class="fe nn no np ne b">setup</code>中的<code class="fe nn no np ne b">numeric_features</code>和<code class="fe nn no np ne b">categorical_features</code>参数来预定义数据类型。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="e7c5" class="ni kx iq ne b gy nj nk l nl nm">from pycaret.anomaly import *<br/><br/>exp_ano101 = setup(data, normalize = True, <br/>                   ignore_features = ['MouseID'],<br/>                   session_id = 123)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/d6cb777e423dce8de91ffb3621ed427a.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*zrHkaUORgWSYv4nQ_WCEjg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">输出</p></figure><p id="ab60" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">成功执行设置后，它会显示信息网格，其中包含一些关于实验的重要信息。大部分信息与执行<code class="fe nn no np ne b">setup</code>时构建的预处理流水线有关。这些特性的大部分超出了本教程的范围，但是，有一些重要的事情需要注意:</p><ul class=""><li id="953d" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated"><strong class="lq ir"> session_id: </strong>一个伪随机数，作为种子分布在所有函数中，以便以后再现。如果没有通过<code class="fe nn no np ne b">session_id</code>，则自动生成一个随机数，并分配给所有函数。在这个实验中，session_id被设置为<code class="fe nn no np ne b">123</code>,以便以后再现。</li><li id="d963" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">缺失值:</strong>当原始数据中存在缺失值时，会显示为<code class="fe nn no np ne b">True</code>。请注意，上面信息网格中的<code class="fe nn no np ne b">Missing Values</code>是<code class="fe nn no np ne b">True</code>，因为数据包含缺失值，对于数字特征使用<code class="fe nn no np ne b">mean</code>自动估算，对于类别特征使用<code class="fe nn no np ne b">constant</code>自动估算。可以使用<code class="fe nn no np ne b">setup</code>中的<code class="fe nn no np ne b">numeric_imputation</code>和<code class="fe nn no np ne b">categorical_imputation</code>参数改变插补方法。</li><li id="66bc" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">原始数据:</strong>显示数据集的原始形状。在这个实验中,( 1026，82)意味着1026个样本和82个特征。</li><li id="5b95" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">转换数据:</strong>显示转换数据集的形状。请注意，原始数据集的形状(1026，82)被转换为(1026，91)。由于数据集中分类要素的编码，要素的数量有所增加。</li><li id="9739" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">数字特征:</strong>推断为数字的特征数量。在该数据集中，82个要素中有77个被推断为数值型。</li><li id="4b20" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated"><strong class="lq ir">分类特征:</strong>推断为分类的特征数量。在该数据集中，82个要素中有5个被推断为分类要素。另外，请注意，我们使用<code class="fe nn no np ne b">ignore_feature</code>参数忽略了一个分类特征，即<code class="fe nn no np ne b">MouseID</code>。</li></ul><p id="4f58" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">请注意执行建模所必需的一些任务是如何自动处理的，例如缺失值插补、分类编码等。<code class="fe nn no np ne b">setup</code>功能中的大多数参数是可选的，用于定制预处理流水线。这些参数超出了本教程的范围，但是我将在后面写更多关于它们的内容。</p><h1 id="e72b" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">8.创建模型</h1><p id="f794" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在PyCaret中创建异常检测模型很简单，与在PyCaret的监督模块中创建模型的方式类似。使用<code class="fe nn no np ne b">create_model</code>函数创建异常检测模型，该函数采用一个强制参数，即模型名称作为字符串。这个函数返回一个训练好的模型对象。请参见下面的示例:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="1018" class="ni kx iq ne b gy nj nk l nl nm">iforest = create_model('iforest')<br/>print(iforest)</span><span id="a4d7" class="ni kx iq ne b gy oc nk l nl nm"><strong class="ne ir">&gt;&gt;&gt; OUTPUT<br/></strong>IForest(behaviour='new', bootstrap=False, contamination=0.05, max_features=1.0, max_samples='auto', n_estimators=100, n_jobs=-1, random_state=123, verbose=0)</span></pre><p id="0dc0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们已经使用<code class="fe nn no np ne b">create_model</code>创建了一个隔离森林模型。请注意，<code class="fe nn no np ne b">contamination</code>参数被设置为<code class="fe nn no np ne b">0.05</code>，当您没有传递<code class="fe nn no np ne b">fraction</code>参数时，这是默认值。<code class="fe nn no np ne b">fraction</code>参数决定了数据集中离群值的比例。在下面的例子中，我们将用<code class="fe nn no np ne b">0.025</code>部分创建<code class="fe nn no np ne b">One Class Support Vector Machine</code>模型。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="5be4" class="ni kx iq ne b gy nj nk l nl nm">svm = create_model('svm', fraction = 0.025)<br/>print(svm)</span><span id="91cc" class="ni kx iq ne b gy oc nk l nl nm"><strong class="ne ir">&gt;&gt;&gt; OUTPUT<br/></strong>OCSVM(cache_size=200, coef0=0.0, contamination=0.025, degree=3, gamma='auto',kernel='rbf', max_iter=-1, nu=0.5, shrinking=True, tol=0.001, verbose=False)</span></pre><p id="e159" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">要查看模型库中可用模型的完整列表，请查阅文档或使用<code class="fe nn no np ne b">models</code>功能。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="5e97" class="ni kx iq ne b gy nj nk l nl nm">models()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/2862c16e18d3591df6ec03485bd59a12.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*0R-NMCAoeycMGEngON5RNw.png"/></div></figure><h1 id="8d04" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">9.指定模型</h1><p id="e486" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在我们已经创建了一个模型，我们希望将异常标签分配给我们的数据集(1080个样本)来分析结果。我们将通过使用<code class="fe nn no np ne b">assign_model</code>函数来实现这一点。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="6440" class="ni kx iq ne b gy nj nk l nl nm">iforest_results = assign_model(iforest)<br/>iforest_results.head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/b73739dd9d6696393da205d024936245.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9en0UQvq6AFNjECHYqqx8A.png"/></div></div></figure><p id="15e7" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">注意，两列<code class="fe nn no np ne b">Anomaly</code>和<code class="fe nn no np ne b">Score</code>被添加到末尾。0代表内部因素，1代表外部因素/异常情况。<code class="fe nn no np ne b">Anomaly_Score</code>是算法计算出的值。离群值被赋予较大的异常分值。请注意，<code class="fe nn no np ne b">iforest_results</code>还包括我们在<code class="fe nn no np ne b">setup</code>中删除的<code class="fe nn no np ne b">MouseID</code>。它不用于模型，仅在您使用<code class="fe nn no np ne b">assign_model</code>时附加到数据集。</p><h1 id="cad0" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">10.绘制模型</h1><p id="937f" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><code class="fe nn no np ne b">plot_model</code>函数可用于分析不同方面的异常检测模型。此函数接受一个经过训练的模型对象并返回一个绘图。</p><h2 id="19b3" class="ni kx iq bd ky nq nr dn lc ns nt dp lg lx nu nv li mb nw nx lk mf ny nz lm oa bi translated">10.1T-分布式随机邻居嵌入(t-SNE)</h2><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="d898" class="ni kx iq ne b gy nj nk l nl nm">plot_model(iforest, plot = 'tsne')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/3430ba8877e8985cd77454ff355ef9b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jsleK_VIl1Y3Ms_D"/></div></div></figure><h2 id="c397" class="ni kx iq bd ky nq nr dn lc ns nt dp lg lx nu nv li mb nw nx lk mf ny nz lm oa bi translated">10.2均匀流形近似和投影</h2><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="effc" class="ni kx iq ne b gy nj nk l nl nm">plot_model(iforest, plot = 'umap')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/8902bee59d7b20e3e041c0321f83f82c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LZ8j5gLhlBJfvOSH"/></div></div></figure><h1 id="e315" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">11.根据看不见的数据预测</h1><p id="8662" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><code class="fe nn no np ne b">predict_model</code>函数用于将异常标签分配给一个新的看不见的数据集。我们现在将使用我们训练好的<code class="fe nn no np ne b">iforest</code>模型来预测存储在<code class="fe nn no np ne b">data_unseen</code>中的数据。该变量是在本教程开始时创建的，包含来自原始数据集的54个样本，这些样本从未暴露给PyCaret。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="834b" class="ni kx iq ne b gy nj nk l nl nm">unseen_predictions = predict_model(iforest, data=data_unseen)<br/>unseen_predictions.head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/828eb2b3c4f6c43474db7e4b90831d97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mWnjkZAm47IkEFd5rv7z9w.png"/></div></div></figure><p id="d76f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><code class="fe nn no np ne b">Anomaly</code>列表示异常值(1 =异常值，0 =内部值)。<code class="fe nn no np ne b">Anomaly_Score</code>是算法计算出的值。离群值被赋予较大的异常分值。您也可以使用<code class="fe nn no np ne b">predict_model</code>功能来标记训练数据。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="4253" class="ni kx iq ne b gy nj nk l nl nm">data_predictions = predict_model(iforest, data = data)<br/>data_predictions.head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/ac3d3b102f5e36597ff838c2fedf1ca5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zrhpgSTI4m-3o_8J7QSaNg.png"/></div></div></figure><h1 id="2e65" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">12.保存模型</h1><p id="2033" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们现在已经完成了实验，使用我们的<code class="fe nn no np ne b">iforest</code>模型来预测看不见的数据上的标签。</p><p id="b0d4" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这使我们的实验接近尾声，但仍有一个问题要问:当你有更多的新数据要预测时，会发生什么？你必须再次经历整个实验吗？答案是否定的，PyCaret的内置函数<code class="fe nn no np ne b">save_model</code>允许您保存模型和整个转换管道以备后用。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="1114" class="ni kx iq ne b gy nj nk l nl nm">save_model(iforest,’Final IForest Model 25Nov2020')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/9d507e707843420e93f8f4ddf492eae8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E9W3yMUAP5OYwIyrtB1RmA.png"/></div></div></figure><p id="d1e5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为了将来在相同或不同的环境中加载已保存的模型，我们将使用PyCaret的<code class="fe nn no np ne b">load_model</code>函数，然后轻松地将已保存的模型应用于新的未知数据进行预测。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="3f88" class="ni kx iq ne b gy nj nk l nl nm">saved_iforest = load_model('Final IForest Model 25Nov2020')<br/>new_prediction = predict_model(saved_iforest, data=data_unseen)<br/>new_prediction.head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/4e5a742c286ac143ed3f94a2b07fa279.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gbqz8CE3fU7zglv6ALXQdw.png"/></div></div></figure><h1 id="f7ee" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">12.总结/后续步骤？</h1><p id="cd34" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们只讲述了PyCaret的异常检测模块的基础知识。在下面的教程中，我们将更深入地探讨高级预处理技术，这些技术允许您完全定制您的机器学习管道，并且是任何数据科学家的必备知识。</p><p id="f10f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">感谢您阅读<a class="ae kv" href="https://emojipedia.org/folded-hands/" rel="noopener ugc nofollow" target="_blank">🙏</a></p></div><div class="ab cl om on hu oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="ij ik il im in"><h1 id="27ba" class="kw kx iq bd ky kz ot lb lc ld ou lf lg jw ov jx li jz ow ka lk kc ox kd lm ln bi translated">重要链接</h1><p id="4e83" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">⭐ <a class="ae kv" href="https://github.com/pycaret/pycaret/tree/master/tutorials" rel="noopener ugc nofollow" target="_blank">教程</a>py caret新手？查看我们的官方笔记本！<br/>📋<a class="ae kv" href="https://github.com/pycaret/pycaret/tree/master/examples" rel="noopener ugc nofollow" target="_blank">社区创建的示例笔记本</a>。<br/>📙<a class="ae kv" href="https://github.com/pycaret/pycaret/tree/master/resources" rel="noopener ugc nofollow" target="_blank">博客</a>投稿人的教程和文章。<br/>📚<a class="ae kv" href="https://pycaret.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">文档</a>py caret的详细API文档<br/>📺<a class="ae kv" href="https://www.youtube.com/channel/UCxA1YTYJ9BEeo50lxyI_B3g" rel="noopener ugc nofollow" target="_blank">视频教程</a>我们的视频教程来自各种赛事。<br/>📢<a class="ae kv" href="https://github.com/pycaret/pycaret/discussions" rel="noopener ugc nofollow" target="_blank">讨论</a>有疑问？与社区和贡献者互动。<br/> 🛠️ <a class="ae kv" href="https://github.com/pycaret/pycaret/blob/master/CHANGELOG.md" rel="noopener ugc nofollow" target="_blank">变更日志</a>变更和版本历史。<br/>🌳<a class="ae kv" href="https://github.com/pycaret/pycaret/issues/1756" rel="noopener ugc nofollow" target="_blank">路线图</a> PyCaret的软件和社区开发计划。</p><h1 id="6240" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">作者:</h1><p id="455b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我写的是PyCaret及其在现实世界中的用例，如果你想自动得到通知，你可以在<a class="ae kv" href="https://medium.com/@moez-62905" rel="noopener">媒体</a>、<a class="ae kv" href="https://www.linkedin.com/in/profile-moez/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae kv" href="https://twitter.com/moezpycaretorg1" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我。</p></div></div>    
</body>
</html>