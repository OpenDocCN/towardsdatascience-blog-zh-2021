<html>
<head>
<title>10 Examples That Will Make You Use Pandas Query Function More Often</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让你更经常使用熊猫查询功能的10个例子</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/10-examples-that-will-make-you-use-pandas-query-function-more-often-a8fb3e9361cb?source=collection_archive---------4-----------------------#2021-07-11">https://towardsdatascience.com/10-examples-that-will-make-you-use-pandas-query-function-more-often-a8fb3e9361cb?source=collection_archive---------4-----------------------#2021-07-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2797" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">发现它的全部潜力</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d7d059284828eacd683f29e9c74dd947.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MWH0lHynbTRTmHkFpdyd5g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">法国人Daphné Be在<a class="ae ky" href="https://unsplash.com/s/photos/filtering?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="a795" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas是一个广泛使用的数据分析和操作库。它提供了许多功能和方法来简单有效地执行典型操作。</p><p id="ae73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据分析中的一个典型任务是过滤数据点(或观察值)。在使用表格数据的情况下，数据点由一行表示。我们有时需要根据一些特性(或列)值来过滤一行。</p><p id="b37b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有<a class="ae ky" rel="noopener" target="_blank" href="/8-ways-to-filter-pandas-dataframes-d34ba585c1b8">几种</a>熊猫方法来过滤数据点。在本文中，我们将重点介绍其中一种方法。就是查询功能。</p><p id="1dc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先导入库并创建一个样本数据框。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="53fa" class="ma mb it lw b gy mc md l me mf">import numpy as np<br/>import pandas as pd</span><span id="9642" class="ma mb it lw b gy mg md l me mf">df = pd.DataFrame(np.random.randint(10, size=(5,6)), columns=list("ABCDEF"))</span><span id="3295" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/4ce4a4519d3e029345f2243d3b5aa6a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8rRVzjUCsm0Frz9RIBqecw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="b5cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以开始使用查询函数来过滤该数据框。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="b73b" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">示例1</h2><p id="3ded" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">查询函数允许以字符串形式应用过滤条件。与许多其他技术相比，它提供了更多的灵活性。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2e45" class="ma mb it lw b gy mc md l me mf">df.query("A &gt; 4")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/5d797d0515f1f621b66a68e4c45ee2c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cP0zEpBShePF-Oflar69hg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="0545" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们选择了A列中的值大于4的行。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="9a9b" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">示例2</h2><p id="76ec" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我们可以很容易地组合多个条件。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4db8" class="ma mb it lw b gy mc md l me mf">df.query("A &gt; 4 and E == 5")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/3c54fca5758f97e68d29c6953d3f7751.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Row34qGmqBf-7rDxuNXWCg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="35c5" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">示例3</h2><p id="1cf0" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">也可以使用“或”逻辑来组合多个条件。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8cb9" class="ma mb it lw b gy mc md l me mf">df.query("A &gt; 2 or F &gt; 4")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/42963de0008e433f5e1731b530dd4e65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JrdtmCh1imQnJM_hrf70Ow.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="448e" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">实例4</h2><p id="1e5b" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">“not”操作符也可以作为查询函数中过滤器的一部分来实现。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="c30a" class="ma mb it lw b gy mc md l me mf">df.query("not (A &gt; 2 or F &gt; 4)")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/2a21424a67989a83b73405abc8507ddd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*40tv9MCIFyCcfSjFdjoPwA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="f984" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">实例5</h2><p id="a78a" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我们还可以在查询函数中使用简单的数学运算。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="040f" class="ma mb it lw b gy mc md l me mf">df.query("A*2 &lt; 5")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/1fece7319042f53e6c8d5d527751f377.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sFFWcwJbdHwiAUNnmVHS6Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="b4dd" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">实例6</h2><p id="a3be" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">查询功能允许使用一些内置函数，这为我们提供了更多的灵活性。</p><p id="8c3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，我们可以使用abs函数返回一个数字的绝对值。让我们首先将F列中的值转换为负整数，然后编写一个包含abs函数的查询。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ab9d" class="ma mb it lw b gy mc md l me mf">df.F = -1 * df.F</span><span id="3c34" class="ma mb it lw b gy mg md l me mf">df.query("abs(F) &gt; 6")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/aaea42a7c107e649ab08e1dbfc4dc1d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gj2uJysIQ_OLHzpde1aSgg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="7fb5" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">例7</h2><p id="0cc0" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">也可以使用排序(平方根)函数。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="15c5" class="ma mb it lw b gy mc md l me mf">df.query("sqrt(A) &gt; 2")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/6ac8109d117d7517442f413b7e671a6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mPwhdYh9oBs-2OMJPdowdQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="7b24" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">实施例8</h2><p id="7d07" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">逻辑运算符也可用于过滤字符串。让我们添加一个包含字符串的列。然后，我们可以根据新列过滤数据框。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="3a39" class="ma mb it lw b gy mc md l me mf">df["G"] = ["John", "Jane", "Ashley", "Luke", "Michael"]</span><span id="25a4" class="ma mb it lw b gy mg md l me mf">df.query("G &gt; 'Jo'")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/8c769f36600456cf22f6a259592daa55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V9WWQA2ScLxJibsLvbh0Sw.png"/></div></div></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="da70" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">示例9</h2><p id="c05e" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">在处理日期和时间时，查询功能也很方便。我们可以在dt访问器下实现一些函数。为了演示这个功能，我们需要一个包含日期或时间的列。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="9b3e" class="ma mb it lw b gy mc md l me mf">df["Date"] = pd.date_range(start="2021-04-05", periods=5, freq="M")</span><span id="88f6" class="ma mb it lw b gy mg md l me mf">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/456e8e8059d5a08e7c9bb9422c2636ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rE0TnIxu0VdGU4Cfgoy9Kg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="e79a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们需要选择月份值大于6的行。下面是我们如何完成这项任务。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="083d" class="ma mb it lw b gy mc md l me mf">df.query("Date.dt.month &gt; 6")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/d3727c7fabf7d3f7a1ee967f1e0c8327.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w82iPtJNKMlKfgAA7XPQFg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="8791" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">实例10</h2><p id="d882" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我们还可以创建一个比较两个或更多列的条件。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="e465" class="ma mb it lw b gy mc md l me mf">df.query("A + B &lt; C")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/c725ca433ec7ffe9dc4b7f5331c7aec5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7HMJcJrLwgVBvi6BhnRsJg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="62b0" class="ma mb it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">结论</h2><p id="1b9d" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">过滤值是数据分析和操作的重要部分。我们可能对符合特定条件的值感兴趣。类似地，我们可能想要基于一组过滤器来探索值。</p><p id="3981" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas为过滤数据帧提供了丰富的技术选择。查询功能就是其中之一，它在很多情况下都很方便。</p><p id="f291" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>