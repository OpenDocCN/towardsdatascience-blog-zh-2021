<html>
<head>
<title>A Great Python Library: Great Expectations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">伟大的 Python 库:伟大的期望</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-great-python-library-great-expectations-6ac6d6fe822e?source=collection_archive---------2-----------------------#2021-12-03">https://towardsdatascience.com/a-great-python-library-great-expectations-6ac6d6fe822e?source=collection_archive---------2-----------------------#2021-12-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bfa2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">总是知道从你的数据中可以期待什么</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e1661c850449585480438d3aa9c8cd7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I2zmkp7NIS6iCQ2lRqMOVQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@tholaal_mohamed?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">托拉尔·穆罕默德</a>在<a class="ae ky" href="https://unsplash.com/s/photos/check?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="ea79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们生活在大数据时代。万亿字节的数据不断在我们周围流动。在这个巨大的数据流中，不可避免地会出现一些问题。</p><p id="036c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与数据相关的问题是我们需要应对的现实。为了获得可靠和准确的产品，持续监控数据质量至关重要。</p><p id="0ed7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://greatexpectations.io/" rel="noopener ugc nofollow" target="_blank"> Great Expectations </a>是一个 Python 库，它帮助我们验证、记录和描述我们的数据，以便我们始终确保它是好的，就像我们期望的那样。</p><p id="b48a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Great Expectations 提供了几个函数来从许多不同的角度评估数据。下面是一个快速检查列中所有值是否唯一的示例:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/193c58aa1bc8629ea175190f1dcf8251.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TkW8ZTpJZph3N9gWa_jaMw.png"/></div></div></figure><p id="62cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lw lx ly lz b">expect_column_values_to_be_unique</code>函数不仅返回简单的真或假答案，还提供其他有用的信息，如所有值的数量、意外值的数量等等。</p><p id="4a89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将通过在一个样本数据集上实现一些很棒的函数来发现 Great Expectations 库。</p><p id="2b9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以轻松地用 pip 安装它。</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="0671" class="me mf it lz b gy mg mh l mi mj">pip install great_expectations</span><span id="dd35" class="me mf it lz b gy mk mh l mi mj"># in a jupyter notebook<br/>!pip install great_expectations</span></pre></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="68f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以导入它了。</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="1af4" class="me mf it lz b gy mg mh l mi mj">import great_expectations as ge</span></pre><p id="e828" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从创建用于示例的数据框开始。我之前已经创建了一个填充了模拟数据的<a class="ae ky" href="https://github.com/SonerYldrm/datasets" rel="noopener ugc nofollow" target="_blank">销售数据集</a>。</p><p id="0b69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要注意的是，我们需要一个兼容的数据框架，以便能够应用远大前程库中的功能。</p><p id="b972" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一种选择是使用<code class="fe lw lx ly lz b">from_pandas</code>函数转换熊猫数据帧。</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="61ab" class="me mf it lz b gy mg mh l mi mj">import pandas as pd</span><span id="e9af" class="me mf it lz b gy mk mh l mi mj">sales = pd.read_csv("Sales.csv")</span><span id="dd4c" class="me mf it lz b gy mk mh l mi mj">df = ge.from_pandas(sales)</span></pre><p id="3ba4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一种选择是直接使用《远大前程》的<code class="fe lw lx ly lz b">read_csv</code>功能。</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="fbb4" class="me mf it lz b gy mg mh l mi mj">df = ge.read_csv("Sales.csv")</span><span id="bf07" class="me mf it lz b gy mk mh l mi mj">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/37e07cd5a02205bd886f9fed3b9ccd4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RaoF30S2pYurAhlC-EHJ0g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="a8bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">id 列应该总是唯一的，重复的 id 值可能会产生严重的后果。我们可以很容易地检查该列中值的唯一性。</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="af89" class="me mf it lz b gy mg mh l mi mj">df.expect_column_values_to_be_unique(column="id")</span><span id="1b23" class="me mf it lz b gy mk mh l mi mj"># output<br/>{<br/>  "meta": {},<br/>  "result": {<br/>    "element_count": 1000,<br/>    "missing_count": 0,<br/>    "missing_percent": 0.0,<br/>    "unexpected_count": 0,<br/>    "unexpected_percent": 0.0,<br/>    "unexpected_percent_total": 0.0,<br/>    "unexpected_percent_nonmissing": 0.0,<br/>    "partial_unexpected_list": []<br/>  },<br/>  "success": true,<br/>  "exception_info": {<br/>    "raised_exception": false,<br/>    "exception_traceback": null,<br/>    "exception_message": null<br/>  }<br/>}</span></pre><p id="6244" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Great Expectations 库的函数返回一个包含多条信息的 json 文件。我们可以把它赋给一个变量，从中提取特定的信息。</p><p id="6f01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的例子中，我们实际上感兴趣的是成功值是否为真。</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="b9eb" class="me mf it lz b gy mg mh l mi mj">uniqueness = df.expect_column_values_to_be_unique(column="id")</span><span id="02ca" class="me mf it lz b gy mk mh l mi mj">uniqueness["success"]<br/>True</span></pre><p id="46e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果它是假的，那么我们应该寻找进一步的细节。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="4cd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们预期产品的价格在 1 到 10000 之间。让我们检查一下价格栏是否符合我们的预期。</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="f4b2" class="me mf it lz b gy mg mh l mi mj">sales_ge.expect_column_values_to_be_between(<br/>    column="price", min_value=1, max_value=10000<br/>)</span><span id="33ab" class="me mf it lz b gy mk mh l mi mj"># output<br/>{<br/>  "meta": {},<br/>  "result": {<br/>    "element_count": 1000,<br/>    "missing_count": 0,<br/>    "missing_percent": 0.0,<br/>    "unexpected_count": 2,<br/>    "unexpected_percent": 0.2,<br/>    "unexpected_percent_total": 0.2,<br/>    "unexpected_percent_nonmissing": 0.2,<br/>    "partial_unexpected_list": [<br/>      0.76,<br/>      0.66<br/>    ]<br/>  },<br/>  "success": false,<br/>  "exception_info": {<br/>    "raised_exception": false,<br/>    "exception_traceback": null,<br/>    "exception_message": null<br/>  }<br/>}</span></pre><p id="2510" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">成功是假的，有两个意外值。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="26cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以检查分类列中的值是否在给定的集合中。</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="322e" class="me mf it lz b gy mg mh l mi mj">df.expect_column_values_to_be_in_set(<br/>    column = "product_group", <br/>    value_set = ["PG1","PG2","PG3","PG4", "PG5"]<br/>)</span></pre><p id="4422" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我没有粘贴其余示例的输出，因为它有点冗长。不过你可以自己练习。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="3203" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">远大前程库还有其他几个有用的功能。这将需要写几页来做一个例子。请随意查看<a class="ae ky" href="https://legacy.docs.greatexpectations.io/en/latest/reference/glossary_of_expectations.html" rel="noopener ugc nofollow" target="_blank">期望词汇表</a>，查看所有可用的功能。</p><p id="eab9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一个我觉得很有用的功能是<code class="fe lw lx ly lz b">expect_column_values_to_be_increasing</code>。</p><p id="43b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑以下数据帧:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/e5c98d09a65dae9b1174435b1e7f78d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/1*H4qYtGvw2qE8EzuwAI2BSg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我的 _df</p></figure><p id="93f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们希望 quantity 列中的值总是增加，我们可以使用我刚才提到的函数。</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="ec5b" class="me mf it lz b gy mg mh l mi mj">my_df.expect_column_values_to_be_increasing(column="Quantity")</span></pre></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="dd0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以基于多个列检查唯一性。例如，我们可能希望每个产品都有唯一的产品组和 id 组合。</p><p id="8e75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我们如何使用 Great Expectations 库实现这个控件:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="139c" class="me mf it lz b gy mg mh l mi mj">df.expect_compound_columns_to_be_unique(<br/>    column_list=["product_group","id"]<br/>)</span></pre></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="fcfa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Great Expectations library 是用于数据质量检查的标准且易于维护的解决方案。我们只介绍了它的一小部分功能。我强烈建议查看<a class="ae ky" href="https://legacy.docs.greatexpectations.io/en/latest/reference/glossary_of_expectations.html" rel="noopener ugc nofollow" target="_blank">期望词汇表</a>。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="f475" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以成为一名<a class="ae ky" href="https://sonery.medium.com/membership" rel="noopener">媒介会员</a>来解锁我的作品，以及媒介的其他部分。如果您使用以下链接，我将收取您的一部分会员费，无需您支付额外费用。</p><div class="mu mv gp gr mw mx"><a href="https://sonery.medium.com/membership" rel="noopener follow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">通过我的推荐链接加入 Medium-Soner yl DRM</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">sonery.medium.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl ks mx"/></div></div></a></div></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="8302" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>