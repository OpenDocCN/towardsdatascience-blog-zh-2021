<html>
<head>
<title>Make the Most Value Out of Your Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让代码发挥最大价值</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/make-most-value-of-your-code-8db8073fc43b?source=collection_archive---------20-----------------------#2021-12-10">https://towardsdatascience.com/make-most-value-of-your-code-8db8073fc43b?source=collection_archive---------20-----------------------#2021-12-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="83af" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">包装，把它们都包装起来，做自己的巨人</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/884f512883b66c4e7d8ab49833fd73f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*HRRLf5ilr3lp3itj9Vrj7Q.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">钥匙——作者根据<a class="ae kr" href="https://stackoverflow.blog/2021/03/31/the-key-copy-paste/" rel="noopener ugc nofollow" target="_blank">钥匙</a></p></figure><p id="783c" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">一个最聪明的人曾经说过:“如果我看得更远，那是因为我站在巨人的肩膀上”。作为一名数据科学家、数据工程师、机器学习专家、数据分析师或任何每天与数据、python和朋友打交道的人，我们都知道自己是幸运的。我们站在StackOverflow的肩膀上，意思是一个巨大的社区。</p><p id="1870" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">做自己的巨人呢？利用你自己的见解，你的研究，以及你从成千上万的StackOverflow中提取的信息。我们都想做一些新奇的东西，研究最新的创新、技术和模型，但老实说，我们也经常做同样的模型、图表等。</p><p id="06b4" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">那么，为什么不利用我们的代码，我们在这么多不同的笔记本中复制粘贴并稍微修改了这么多次？我们可以把它打包，把它们打包，所有这些我们多年来自豪地编写的函数和类打包。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="3a6c" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">📦构建您的私有包</h1><p id="0a30" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">利用你的工作的一个极好的方法是构建你的私人包。私人的，因为目的是不公开发表在PyPi.org或任何其他服务器上。</p><p id="9f90" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">包装有许多优点:</p><ul class=""><li id="de6e" class="mt mu iq ku b kv kw ky kz lb mv lf mw lj mx ln my mz na nb bi translated">模块化:为了使代码最模块化，你需要大量的函数、类等</li><li id="d420" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">轻松访问您的代码和更干净的NB/脚本</li><li id="90a1" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">更多自动化</li><li id="9840" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">可再现性(“隐藏状态”与可再现性相反，结果可能取决于您运行单元格的顺序，您定义的函数可能由范围外的变量提供)</li><li id="9f0c" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">易于共享/协作</li><li id="5c38" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">您可以将模块设置为使用%load_ext autoreload、%autoreload 1和%aimport module_name自动重新加载</li><li id="eea5" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">测试(单元、集成)</li><li id="e514" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">版本控制(众所周知，NB很难版本控制)</li></ul><h1 id="db21" class="lw lx iq bd ly lz nh mb mc md ni mf mg jw nj jx mi jz nk ka mk kc nl kd mm mn bi translated">🤔什么是包，它的基本组件是什么？</h1><p id="10d2" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">首先，它说明了构成python包的基本组件。我将使用一个<a class="ae kr" href="https://github.com/ThomasBury/py-pkg-temp" rel="noopener ugc nofollow" target="_blank">基本模板</a>给出结构并解释它们各自的作用。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/7f3a92430e5383c549f716ead5f023b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:496/format:webp/1*y0rXJP4A4rVvFisKNI2Pug.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">一个基本的私有python包的结构，可以在<a class="ae kr" href="https://github.com/ThomasBury/py-pkg-temp" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到</p></figure><ul class=""><li id="a46e" class="mt mu iq ku b kv kw ky kz lb mv lf mw lj mx ln my mz na nb bi translated"><code class="fe nn no np nq b">pkgtemp</code>:一个基本python包的<a class="ae kr" href="https://github.com/ThomasBury/py-pkg-temp" rel="noopener ugc nofollow" target="_blank">模板，带有子包和模块</a></li><li id="1f38" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">在<code class="fe nn no np nq b">pkgtemp/sub_pkg1/modA.py</code>中:类和继承的例子，用于说明</li><li id="e144" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">在<code class="fe nn no np nq b">pkgtemp/sub_pkg2/modC.py</code>中:用特殊方法比较对象的类的例子，用于说明</li><li id="48ee" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">在<code class="fe nn no np nq b">pkgtemp/sub_pkg2/modD.py</code>中:使用特殊方法使对象实例可调用的类的例子</li><li id="f10d" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">在<code class="fe nn no np nq b">pkgtemp/__version__.py</code>中:关于版本、作者等的所有细节。</li><li id="8f28" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">在<code class="fe nn no np nq b">pkgtemp/__init__.py</code>中:默认为空，可以用来绑定上层包的子包和模块(更容易导入)</li><li id="ef54" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated"><code class="fe nn no np nq b">setup.py</code>构建包的主文件</li><li id="e6bb" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated"><code class="fe nn no np nq b">requirements.txt</code>安装<code class="fe nn no np nq b">pkgtemp</code>时被安装的依赖项</li><li id="7736" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">在<code class="fe nn no np nq b">envs</code>中，yaml文件用于创建conda python环境，见下图</li><li id="ffe7" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated"><code class="fe nn no np nq b">README.md</code>登陆解释文件(包是做什么的，如何安装等等。)</li></ul><p id="bc5b" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">可选文件和文件夹:</p><ul class=""><li id="347b" class="mt mu iq ku b kv kw ky kz lb mv lf mw lj mx ln my mz na nb bi translated">在<code class="fe nn no np nq b">tests</code>中:单元测试——这是可选的</li><li id="84b8" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">在<code class="fe nn no np nq b">docs</code>中:包文档(通常带有sphinx)</li><li id="fa69" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">在<code class="fe nn no np nq b">data</code>中:您希望<em class="lo">与您的包一起分发</em>的数据，您应该提到在setup.py中</li><li id="e7fb" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">在<code class="fe nn no np nq b">documentation</code>附加文档中，(不随代码一起分发)</li><li id="41f8" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">在<code class="fe nn no np nq b">notebooks</code>中，作为文档的替代，突出显示您的代码</li><li id="12d3" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">在<code class="fe nn no np nq b">scripts</code>中，作为文档的替代，突出显示您的代码</li><li id="d885" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">在<code class="fe nn no np nq b">egg-info</code>中，包构建过程的所有输出——不要关心这个，它们将通过运行setup.py生成</li></ul><h2 id="9344" class="nr lx iq bd ly ns nt dn mc nu nv dp mg lb nw nx mi lf ny nz mk lj oa ob mm oc bi translated">模块</h2><p id="01b4" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">模块是一个*。包含Python代码的py文件。为了模块化，将代码分解成模块。python模块只是一个包含代码的文件。模块化代码更容易使用。编码时(人类)记忆中保存的东西更少，滚动更少，当你必须找到一个特定的东西时知道确切的位置，把大问题分解成小问题，等等。</p><h2 id="b6b6" class="nr lx iq bd ly ns nt dn mc nu nv dp mg lb nw nx mi lf ny nz mk lj oa ob mm oc bi translated">包裹</h2><p id="b01f" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">包是包含其他文件夹(子包)或模块(的集合)的文件夹。py文件)，以及特定的文件。如果满足某些要求，可以安装它。</p><p id="bdc3" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">假设您开发了一个包含几个模块的应用程序。随着模块数量的增长，如果将它们放在一个位置，就很难跟踪所有的模块。如果它们具有相似的名称或功能，尤其如此。您可能希望有一种方法来对它们进行分组和组织。包允许使用点符号对模块名称空间进行分层结构。模块有助于避免全局变量名之间的冲突，同样，包也有助于避免模块名之间的冲突。</p><p id="e646" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">包可以包含任意深度的嵌套子包。Python中的每个包都是一个目录，其中必须包含一个名为<code class="fe nn no np nq b">__init__.py</code>的特殊文件。这个文件可以是空的，它表明它包含的目录是一个Python包，因此可以像导入模块一样导入它</p><h2 id="bcdf" class="nr lx iq bd ly ns nt dn mc nu nv dp mg lb nw nx mi lf ny nz mk lj oa ob mm oc bi translated">应用程序接口</h2><p id="3bdb" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">API:Application Programming Interface(应用编程接口)的缩写，指的是通过抽象底层实现和只暴露开发者需要的对象或动作来简化编程的函数和类的集合。API是多用途的，并不打算产生一个单一的输出(不是特别的)，而是一个可以在不同的项目和任务中重用的工具。</p><p id="84f1" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">例如，lightGBM是用C++编写的，但提供了几个API:python、R等。</p><h1 id="6be3" class="lw lx iq bd ly lz nh mb mc md ni mf mg jw nj jx mi jz nk ka mk kc nl kd mm mn bi translated">💡你必须做什么来写你的私人包裹？</h1><h2 id="41fa" class="nr lx iq bd ly ns nt dn mc nu nv dp mg lb nw nx mi lf ny nz mk lj oa ob mm oc bi translated">💻写一些代码</h2><p id="8ac4" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">为了扩大您的工具堆栈，您可以收集并重构您发现对几个(至少两个)项目有用的代码，因为如果它对一个以上的项目有用，它很可能对未来的项目也有用(例如，在您需要执行回归的任何时候，不要从头重写您的sklearn管道)</p><p id="0579" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">最好是在收集和重构你的代码时，尽量让它不那么具体，更模块化。很可能您为特定的项目编写了代码，带有一些硬编码的名称、参数和变量值。尝试移除任何硬编码的部分，取而代之的是将它们作为函数/类的参数。</p><p id="9aee" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">另外，尽量将函数和类整理到包含模块(*)的子包(子文件夹)中。py文件)。例如</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/5e65baaccf69a33cd325ef9206b0ccd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:298/format:webp/1*ny56535wMlGoJzZYsjvotA.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">包、子包和模块的基本结构，如<a class="ae kr" href="https://github.com/ThomasBury/py-pkg-temp" rel="noopener ugc nofollow" target="_blank">模板</a>所示</p></figure><p id="64bb" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">用于收集您喜欢的绘图函数、模型比较类、lightGBM包装器等。</p><h2 id="778f" class="nr lx iq bd ly ns nt dn mc nu nv dp mg lb nw nx mi lf ny nz mk lj oa ob mm oc bi translated">📃记录您的代码</h2><p id="95dd" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">最好的方法是在重构代码的同时，也记录你的代码。使用您最喜欢的约定(NumPy、Pandas、Google等)编写适当的文档字符串。).这将有助于你记住目的是什么，并使与同事的合作更加顺利。</p><h2 id="2998" class="nr lx iq bd ly ns nt dn mc nu nv dp mg lb nw nx mi lf ny nz mk lj oa ob mm oc bi translated">🗃️创建了一个专用的python环境</h2><p id="ae8e" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">创建专用的python环境。这将隔离您的项目；您不会破坏您的基础，如果您需要通过conda而不是pip安装一些包，这将允许您这样做(例如，conda-forge的一些预建包)</p><ul class=""><li id="9f25" class="mt mu iq ku b kv kw ky kz lb mv lf mw lj mx ln my mz na nb bi translated"><code class="fe nn no np nq b">conda create -n proj-env python dependency1 dependency2</code></li><li id="dff5" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated"><code class="fe nn no np nq b">conda activate proj-env</code></li><li id="68b0" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">当你安装了所有的conda依赖项，并且在转移到pip之前:<code class="fe nn no np nq b">conda env export &gt; proj-env.yml</code>如果你计划跨平台共享(Win-linux或其他),你可以使用“no-builds”标志</li><li id="c433" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">继续安装您的pip依赖项，并在<code class="fe nn no np nq b">requirements.txt</code>中收集所需的包或使用<code class="fe nn no np nq b">pip list --format=freeze &gt; requirements.txt</code></li></ul><h2 id="ff17" class="nr lx iq bd ly ns nt dn mc nu nv dp mg lb nw nx mi lf ny nz mk lj oa ob mm oc bi translated">🖊️编辑_版本__。巴拉圭</h2><p id="ebfb" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">编辑<code class="fe nn no np nq b">__version__.py</code>以满足你的需求(作者、标题、版本号等)。)</p><ul class=""><li id="d1e7" class="mt mu iq ku b kv kw ky kz lb mv lf mw lj mx ln my mz na nb bi translated">__title__ = 'pkgtemp '</li><li id="70cb" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">_ _ description _ _ = ' python-pkg-temp-包模板项目生成器'</li><li id="2472" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">__version__ = '0.0.1 '</li><li id="dfa8" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">__作者__ = '威尔·史密斯'</li><li id="6b54" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">_ _ author _ email _ _ = ' will . Smith @ Google . mars '</li><li id="58b4" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">__许可证__ = '麻省理工学院'</li><li id="9dc1" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated">_ _ URL _ _ = ' https://github/will Smith/bad boys 4 '</li></ul><h2 id="1ffb" class="nr lx iq bd ly ns nt dn mc nu nv dp mg lb nw nx mi lf ny nz mk lj oa ob mm oc bi translated">🖊️编辑setup.py</h2><p id="dab6" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">原则上，你可以让它保持原样。您可以编辑EXTRAS_REQUIRE和/或classifiers=…以适应您的包。其他输入可在__version__中编辑。py文件。</p><h2 id="d063" class="nr lx iq bd ly ns nt dn mc nu nv dp mg lb nw nx mi lf ny nz mk lj oa ob mm oc bi translated">⛭安装你的软件包并使用它</h2><p id="0cc2" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">非常简单，两步:</p><ul class=""><li id="b73c" class="mt mu iq ku b kv kw ky kz lb mv lf mw lj mx ln my mz na nb bi translated"><code class="fe nn no np nq b">conda activate [ENV_NAME]</code></li><li id="66a1" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated"><code class="fe nn no np nq b">cd C:/[USER_NAME]/[pkg_name]</code>的意思，setup.py在哪里</li><li id="6f03" class="mt mu iq ku b kv nc ky nd lb ne lf nf lj ng ln my mz na nb bi translated"><code class="fe nn no np nq b">pip install .</code>如果您还在<em class="lo">编辑</em>您的包，请不要忘记时间段或<code class="fe nn no np nq b">pip install -e .</code></li></ul><p id="9548" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">完成了！您可以导入您的包，并在不同的项目中重用您的函数和类。你可以在本笔记本中找到一个例子。</p><h1 id="67bf" class="lw lx iq bd ly lz nh mb mc md ni mf mg jw nj jx mi jz nk ka mk kc nl kd mm mn bi translated">结论</h1><p id="9398" class="pw-post-body-paragraph ks kt iq ku b kv mo jr kx ky mp ju la lb mq ld le lf mr lh li lj ms ll lm ln ij bi translated">打包是利用您的艰苦工作并构建一个令人惊叹的函数库和类库的一种极好的方式。这样你就可以重复使用你的代码，与你的同事分享，建立一个文件夹如果你是自由职业者，你可以对它进行版本控制和部署更新。</p><p id="8d9f" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我们看到了如何构建一个不在公开渠道上发布的包来实现这一点。利用GitHub，你也可以让它像<code class="fe nn no np nq b">pip install git+https://github.com/[GH_USER]/[REPO_NAME].git</code>一样容易安装</p><p id="88b4" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我用它来包装我经常使用的库。比如，包装lightGBM、CatBoost和Optuna，使它们具有一致的语法。而且还标准化了我的制图风格、基本EDA和我必须执行的所有重复任务。此外，我可以在工作中使用我在个人项目中所做的，反之亦然。我也可以很快地和其他人分享我找到的一些解决方法。</p><p id="8d5c" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">最后，当您对自己的软件包感到满意，并且认为社区可以从您的工作中受益时，您可以考虑以开源方式发布您的软件包。不知何故，偿还社区的债务💸</p></div></div>    
</body>
</html>