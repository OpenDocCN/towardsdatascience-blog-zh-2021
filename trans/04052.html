<html>
<head>
<title>Combining R {tidyverse, leaflet, DT, flexdashboard} and Python {pandas, GeoPy} to create a serverless psychotherapy dashboard</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">结合R {tidyverse，fleet，DT，flexdashboard}和Python {pandas，GeoPy}创建无服务器心理治疗仪表板</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/combining-r-tidyverse-leaflet-dt-flexdashboard-and-python-pandas-geopy-to-create-a-c25c5ef7d2d9?source=collection_archive---------32-----------------------#2021-04-05">https://towardsdatascience.com/combining-r-tidyverse-leaflet-dt-flexdashboard-and-python-pandas-geopy-to-create-a-c25c5ef7d2d9?source=collection_archive---------32-----------------------#2021-04-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/02eaadd5923051ccb200d96aecb2b2d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mY7xlY_JEPPCYa3ogcZoEQ.jpeg"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://www.data-must-flow.com/projects/photos/photos.html" rel="noopener ugc nofollow" target="_blank">维特·加布雷</a>拍摄</p></figure><h1 id="20f7" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">介绍</h1><p id="52fa" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在捷克共和国，只有一小部分精神治疗护理(T3)由健康保险公司(T6)承保(T5)。因此，当最大的此类公司之一VZP向其客户提供7 000 CZK(约合280欧元)的心理治疗津贴时，这是一个受欢迎的举措。</p><p id="b0b6" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">然而，给自己找一个心理治疗师的方法并不是最方便的，因为你必须滚动浏览一个. pdf <a class="ae kc" href="https://media.vzpstatic.cz/media/Default/dokumenty/seznam-terapeutu.pdf?ver=0303" rel="noopener ugc nofollow" target="_blank">文件</a>。幸运的是，<a class="ae kc" href="https://www.linkedin.com/in/dominika-%C4%8Dechov%C3%A1-m-a-b6b95724/" rel="noopener ugc nofollow" target="_blank">捷克心理治疗协会<a class="ae kc" href="https://czap.cz/eng" rel="noopener ugc nofollow" target="_blank"><em class="me"/></a>的董事会成员Dominika echová</a>，通过谈判从VZP获得了更多信息，比如哪些心理治疗师可以接受新客户。</p><p id="7417" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">我的任务是将这些信息整合成一种更加用户友好的方式，让你自己找到一个治疗师，从而使服务更加容易获得。重点是交付的速度和部署的简易性，所以我决定用<a class="ae kc" href="https://rmarkdown.rstudio.com/flexdashboard/" rel="noopener ugc nofollow" target="_blank"><strong class="ld ir">flex dashboard</strong></a>来完成<strong class="ld ir"> R </strong>，这个包允许创建<strong class="ld ir">交互式</strong>和<strong class="ld ir">无服务器</strong>仪表盘。</p><p id="9423" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">我有以前的<a class="ae kc" href="https://www.data-must-flow.com/post/" rel="noopener ugc nofollow" target="_blank">项目</a>中的大部分构建模块——R实现<a class="ae kc" href="https://rstudio.github.io/leaflet/" rel="noopener ugc nofollow" target="_blank"> <strong class="ld ir">传单</strong> </a>用于地图，以及<a class="ae kc" href="https://rstudio.github.io/DT/" rel="noopener ugc nofollow" target="_blank"> <strong class="ld ir">数据表</strong> </a>用于表格。<a class="ae kc" href="https://www.tidyverse.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ld ir"> Tidyverse </strong> </a>用于装载和角力数据。</p><p id="1205" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">然而，输入表不包含纬度和经度，这是在地图上显示治疗师位置所需的两个元素。之前我已经用<a class="ae kc" href="https://github.com/dkahle/ggmap" rel="noopener ugc nofollow" target="_blank"> <strong class="ld ir"> ggmap </strong> </a>调整过数据。然而，Google API需求的变化使得这变得有些不方便。</p><p id="654e" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">所以，我决定寻找一个替代方案。然后偶然看到了<a class="ae kc" href="https://shakasom.medium.com/" rel="noopener"> Abdishakur </a>的文章<a class="ae kc" rel="noopener" target="_blank" href="/geocode-with-python-161ec1e62b89"><em class="me">Geocode with Python</em></a>，很棒的介绍Python的包<a class="ae kc" href="https://geopy.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> <strong class="ld ir"> GeoPy </strong> </a>。</p><p id="2601" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">现在，虽然R是我的特殊数据朋友，但我也喜欢在我的工作流程中有利的地方集成其他语言和工具，如Python、熊猫、T21。</p><p id="6b3b" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">在这篇文章中，我想回顾一下我是如何创造理想结果的。</p><p id="0127" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">你可以在这里找到最终的<strong class="ld ir">仪表盘</strong><a class="ae kc" href="https://www.data-must-flow.com/posts/psychotherapy_vzp/" rel="noopener ugc nofollow" target="_blank"><strong class="ld ir"/></a>和带有交互元素的<strong class="ld ir">原创文章</strong><a class="ae kc" href="https://www.data-must-flow.com/posts/python_r_therapy/" rel="noopener ugc nofollow" target="_blank"><strong class="ld ir">这里</strong> </a>。</p><h1 id="3f3d" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">r包</h1><p id="93d2" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">让我们从加载所需的包开始:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="c376" class="mo ke iq mk b gy mp mq l mr ms"><em class="me"># Load required packages</em><br/>library(flexdashboard) <em class="me"># dashboard wrapping</em><br/>library(tidyverse) <em class="me"># data wrangling</em><br/>library(crosstalk) <em class="me"># interactivity</em><br/>library(broom) <em class="me"># output of built-in functions cleanup</em><br/>library(DT) <em class="me"># Table formatting</em><br/>library(htmltools) <em class="me"># widgets</em><br/>library(reshape2) <em class="me"># data taransformations</em><br/>library(leaflet) <em class="me"># interactive maps</em><br/>library(leaflet.extras) <em class="me"># interactive features</em></span></pre><h1 id="0968" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">输入数据</h1><p id="7365" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">您可以在<a class="ae kc" href="https://github.com/VGabrhel/datamustflow/blob/master/public/posts/python_r_therapy/vzp_data_geo.csv" rel="noopener ugc nofollow" target="_blank"> <strong class="ld ir"> GitHub </strong> </a>上找到输入数据集。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="3ffc" class="mo ke iq mk b gy mp mq l mr ms"><em class="me"># Initial dataset</em><br/>vzp_data = read.csv("vzp_data_geo.csv") %&gt;%<br/>    select(name, surname, alias, website, address,<br/>           city, region, psc, phone, email, Kapacita, remote_therapy)</span></pre><h1 id="dadc" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">计算机编程语言</h1><h2 id="fda1" class="mo ke iq bd kf mt mu dn kj mv mw dp kn lm mx my kr lq mz na kv lu nb nc kz nd bi translated">激活</h2><p id="6fa0" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">首先你需要打开r中的Python接口，我用的是<a class="ae kc" href="https://rstudio.github.io/reticulate/index.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ld ir"> reticulate </strong> </a>。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="f7f9" class="mo ke iq mk b gy mp mq l mr ms"><em class="me"># Python interoperability in R</em><br/>library(reticulate)</span><span id="5299" class="mo ke iq mk b gy ne mq l mr ms"><em class="me"># Specifying which version of python to use.</em><br/>use_python("/home/vg/anaconda3/bin/python3.7",<br/>           required=T)  <em class="me"># Locate and run Python</em></span></pre><h2 id="3986" class="mo ke iq bd kf mt mu dn kj mv mw dp kn lm mx my kr lq mz na kv lu nb nc kz nd bi translated">包和数据争论</h2><p id="1025" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">即使有可能一次运行下面所有的代码块，让我们遵循<a class="ae kc" href="https://blog.codinghorror.com/curlys-law-do-one-thing/" rel="noopener ugc nofollow" target="_blank">做一件事</a>的原则，根据它们的功能将它们分开。</p><p id="2f99" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">Python包优先:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="0cc2" class="mo ke iq mk b gy mp mq l mr ms">from geopy.geocoders import Nominatim<br/>from geopy.extra.rate_limiter import RateLimiter<br/>import pandas as pd</span></pre><p id="a893" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">激活地理编码器:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="a5b5" class="mo ke iq mk b gy mp mq l mr ms">locator = Nominatim(user_agent="myGeocoder")</span></pre><p id="02f4" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">将部分地址链接到一个变量-将用于地理编码:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="1223" class="mo ke iq mk b gy mp mq l mr ms">df = r['vzp_data']</span><span id="6661" class="mo ke iq mk b gy ne mq l mr ms">df['state'] = "CZ"</span><span id="fc95" class="mo ke iq mk b gy ne mq l mr ms">df["ADDRESS"] = df["address"] + "," + df["city"] + "," + df["state"]</span><span id="251c" class="mo ke iq mk b gy ne mq l mr ms">df["Adresa"] = df["address"] + ", " + df["city"]</span></pre><h2 id="f5c6" class="mo ke iq bd kf mt mu dn kj mv mw dp kn lm mx my kr lq mz na kv lu nb nc kz nd bi translated">使用GeoPy进行地理编码</h2><p id="4b67" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">为了减少<code class="fe nf ng nh mk b">Too Many Requests</code>误差，使用<code class="fe nf ng nh mk b">RateLimiter</code>。正如GeoPy的<a class="ae kc" href="https://geopy.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">文档</a>所说，在地理编码调用之间添加一个延迟<em class="me">，以减少地理编码服务</em>的负载。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="f586" class="mo ke iq mk b gy mp mq l mr ms"><em class="me"># 1 - conveneint function to delay between geocoding calls</em><br/>geocode = RateLimiter(locator.geocode, min_delay_seconds=1)</span><span id="0ff9" class="mo ke iq mk b gy ne mq l mr ms"><em class="me"># 2- create location column</em><br/>df['location'] = df['ADDRESS'].apply(geocode)</span><span id="6879" class="mo ke iq mk b gy ne mq l mr ms"><em class="me"># 3 - create longitude, laatitude and altitude from location column (returns tuple)</em><br/>df['point'] = df['location'].apply(<strong class="mk ir">lambda</strong> loc: tuple(loc.point) <strong class="mk ir">if</strong> loc <strong class="mk ir">else</strong> None)</span><span id="086d" class="mo ke iq mk b gy ne mq l mr ms"><em class="me"># 4 - split point column into latitude, longitude and altitude columns</em><br/>df[['latitude', 'longitude', 'altitude']] = pd.DataFrame(df['point'].tolist(), index=df.index)</span></pre><h2 id="c72e" class="mo ke iq bd kf mt mu dn kj mv mw dp kn lm mx my kr lq mz na kv lu nb nc kz nd bi translated">导出地理编码数据</h2><p id="56bf" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">现在，您可能会问——为什么我要导出这个表？我不打算把数据作为Python/R对象进一步处理吗？</p><p id="7788" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">不幸的是，当包含Python代码时，flexdashboard <a class="ae kc" href="https://community.rstudio.com/t/python-code-inside-flexdashboard-framework/44873/2" rel="noopener ugc nofollow" target="_blank">还不能被编织</a>。因此，在使用仪表板时，我必须创建两个独立的工作流—一个用于数据地理编码，另一个用于编译仪表板。然而，我想使仪表板编码更具可重复性，同时将所有重要的组件保持在一个工作流中。</p><p id="031b" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">幸运的是，其他R Markdown输出如R notebook很乐意包装Python代码。这就是您在代码中看到这一步的原因。当然，这不是最有效的工作流程，但是你知道他们说什么——完成(和工作)比完美更好。</p><p id="a4cd" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">当然，如果目标是包含一些Python块的R Markdown文档，您可以简单地在R块中添加<code class="fe nf ng nh mk b">vzp_data = py[df]</code>,将pandas数据帧转换成R数据帧，并顺利进行下一部分。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="16d5" class="mo ke iq mk b gy mp mq l mr ms"><em class="me"># Convert pandas DataFrame into R Data Frame (tibble)</em><br/>vzp_data_geocoded = py['df']</span><span id="f5ea" class="mo ke iq mk b gy ne mq l mr ms">vzp_data_geo &lt;- vzp_data_geocoded %&gt;%<br/>    select(name, surname, alias, website, address,<br/>           city, region, psc, phone, email, `Kapacita`, remote_therapy,<br/>           state, Adresa, latitude, longitude)</span><span id="dc02" class="mo ke iq mk b gy ne mq l mr ms">vzp_data_geo &lt;- apply(vzp_data_geo,2,as.character)<br/>write.csv(vzp_data_geo, file = "vzp_data_geo.csv")</span></pre><h1 id="d2e5" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">稀有</h1><h2 id="767a" class="mo ke iq bd kf mt mu dn kj mv mw dp kn lm mx my kr lq mz na kv lu nb nc kz nd bi translated">tidyverse中的数据争论</h2><p id="d407" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">仅选择将在输出中使用的列并格式化它们:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="8405" class="mo ke iq mk b gy mp mq l mr ms"><em class="me"># Data import and wrangling</em><br/>vzp_data = read.csv("vzp_data_geo.csv") %&gt;%<br/>  select(name,<br/>         surname,<br/>         alias,<br/>         website,<br/>         address,<br/>         city,<br/>         phone,<br/>         email,<br/>         Kapacita,<br/>         remote_therapy,<br/>         latitude,<br/>         longitude) %&gt;%<br/>  mutate_all(list(~str_trim(.,side = "both"))) %&gt;%<br/>  mutate(`Jméno a příjmení` = paste(name,surname),<br/>         latitude = as.numeric(latitude),<br/>         longitude = as.numeric(longitude)) %&gt;%<br/>  rename("Email" = email,<br/>         "Telefon" = phone,<br/>         "Web" = website,<br/>         "Online nebo telefonické konzultace?" = remote_therapy,<br/>         "Kapacita?" = Kapacita,<br/>         "Město" = city,<br/>         "Ulice" = address) %&gt;%<br/>  mutate(`Kapacita?` = case_when(`Kapacita?` == "volno" ~ "Volno",<br/>                              `Kapacita?` == "naplněno" ~ "Naplněno",<br/>                              `Kapacita?` == "Naplněno" ~ "Naplněno",<br/>                              TRUE ~ `Kapacita?`),<br/>         `Online nebo telefonické konzultace?` = case_when(`Online nebo telefonické konzultace?` == "Ano" ~ "Ano",<br/>                                                           `Online nebo telefonické konzultace?` == "Ano/ možnost konzultací v anglickém jazyce" ~ "Ano",<br/>                                                           `Online nebo telefonické konzultace?` == "Ne" ~ "Ne",<br/>                                                           `Online nebo telefonické konzultace?` == "ne" ~ "Ne",<br/>                                                           TRUE ~ `Online nebo telefonické konzultace?`)<br/>         )</span><span id="6bb1" class="mo ke iq mk b gy ne mq l mr ms"><em class="me"># Replace "NaN" with "Neuvedeno"</em><br/>vzp_data[vzp_data=="NaN"] &lt;- "Neuvedeno"</span></pre><h1 id="3d6d" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">输出</h1><h2 id="6839" class="mo ke iq bd kf mt mu dn kj mv mw dp kn lm mx my kr lq mz na kv lu nb nc kz nd bi translated">可用心理治疗师列表</h2><p id="08e7" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">下表是使用<code class="fe nf ng nh mk b">DataTable</code>包完成的最终<a class="ae kc" href="https://www.data-must-flow.com/posts/psychotherapy_vzp/" rel="noopener ugc nofollow" target="_blank">查找表</a>的快照。这个包意味着许多交互元素供您使用。您可以添加跨列搜索和过滤、排序、分页等等。此外，它可以很容易地与使用<code class="fe nf ng nh mk b">crosstalk</code>的过滤器连接。</p><p id="c6cd" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">由于输出是捷克语，我建议您的浏览器的<code class="fe nf ng nh mk b">Translate to English</code>功能获得更多价值。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="11c0" class="mo ke iq mk b gy mp mq l mr ms">vzp_data_table &lt;- vzp_data %&gt;%<br/>  select(`Kapacita?`, `Online nebo telefonické konzultace?`,<br/>        Město,<br/>        Ulice,<br/>         `Jméno a příjmení`, <br/>         Email, Telefon, Web, Ulice,<br/>         `Online nebo telefonické konzultace?`) </span><span id="9800" class="mo ke iq mk b gy ne mq l mr ms">test_shared &lt;- crosstalk::SharedData$new(vzp_data_table)</span><span id="f2a8" class="mo ke iq mk b gy ne mq l mr ms">DT::datatable(test_shared,<br/>    extensions = c(<br/>      "Responsive"<br/>    ),<br/>    rownames = FALSE,  <em class="me"># remove rownames</em><br/>    style = "bootstrap",<br/>    class = 'cell-border display',<br/>    options = list(<br/>      pageLength = 10,<br/>      dom = 't',<br/>      deferRender = TRUE,<br/>      scroller = TRUE,<br/>      columnDefs = list(list(className = 'dt-center', targets = "_all"))<br/>        )<br/>      ) %&gt;% formatStyle(<br/>  "Kapacita?",<br/>  target = 'row',<br/>  backgroundColor = styleEqual(c("Naplněno", "Volno"), c('#ffcccb', '#d2e9af')))</span></pre><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/aa3e37f1ad33dca768c878f834684b9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ud5cgdiayrlz8nuE13T3NA.png"/></div></div></figure><h2 id="f148" class="mo ke iq bd kf mt mu dn kj mv mw dp kn lm mx my kr lq mz na kv lu nb nc kz nd bi translated">心理治疗师分布图</h2><p id="890e" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">由于通过地图搜索可能更方便，我决定用传单添加一个。类似于数据表，传单允许多个交互式元素。包括基于字符串或不同地图图层的搜索。</p><p id="ec14" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">同样，由于输出是捷克语，我建议您的浏览器的<code class="fe nf ng nh mk b">Translate to English</code>功能获得更多价值。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="a26e" class="mo ke iq mk b gy mp mq l mr ms"><em class="me"># prepare a palette - manual colors according to branch column</em><br/>pal &lt;- leaflet::colorFactor(palette = c("Naplněno" = "#8b0000",<br/>                                        "Neuvedeno" = "#A9A9A9",<br/>                                        "Volno" = "#006400"<br/>                                        ), <br/>                               domain = vzp_data$`Kapacita?`)</span><span id="007e" class="mo ke iq mk b gy ne mq l mr ms">points_fin &lt;- SharedData$new(vzp_data)</span><span id="cd8e" class="mo ke iq mk b gy ne mq l mr ms">map1 &lt;- leaflet(data = points_fin, width = '100%', height = 800) %&gt;%<br/>          addProviderTiles("CartoDB.Positron", group = 'Základní') %&gt;%<br/>          addProviderTiles("Esri.WorldImagery", group = 'Letecká') %&gt;%<br/>          addProviderTiles("OpenStreetMap.Mapnik", group = 'Uliční') %&gt;%<br/>          addProviderTiles("OpenTopoMap", group = 'Zeměpisná') %&gt;%<br/>          addScaleBar('bottomright') %&gt;%<br/>          setView(15.4129318, 49.7559455, zoom = 8.2) %&gt;%<br/>          addCircleMarkers(<br/>                   group = 'Obor', <br/>                   stroke = FALSE, <br/>                   opacity = 0.9,<br/>                   fillOpacity = 0.9,<br/>                   fillColor = ~sapply(`Kapacita?`, <strong class="mk ir">switch</strong>, USE.NAMES = FALSE,<br/>                                        "Volno" = "#006400", <br/>                                        "Naplněno" = "#8b0000",<br/>                                        "Neuvedeno" = "#A9A9A9"<br/>                                     ),<br/>                   popup = ~paste0('&lt;h2&gt;Detail&lt;/h2&gt; &lt;br&gt;',<br/>                                   '&lt;b&gt;Město&lt;/b&gt;: ', Město, '&lt;br&gt;',<br/>                                   '&lt;b&gt;Ulice&lt;/b&gt;: ', Ulice, '&lt;br&gt;',<br/>                                   '&lt;b&gt;Jméno a příjmení&lt;/b&gt;: ', `Jméno a příjmení`, '&lt;br&gt;',<br/>                                   '&lt;b&gt;Online nebo telefonické konzultace&lt;/b&gt;: ', `Online nebo telefonické konzultace?`, '&lt;br&gt;',<br/>                                   '&lt;b&gt;Telefon&lt;/b&gt;: ',`Telefon`, "&lt;br&gt;",<br/>                                   '&lt;b&gt;Email&lt;/b&gt;: ', Email, '&lt;br&gt;',<br/>                                   '&lt;b&gt;Web&lt;/b&gt;: ', Web, '&lt;br&gt;',<br/>                                   '&lt;b&gt;Kapacita&lt;/b&gt;: ', `Kapacita?`, '&lt;br&gt;')<br/>                   ,<br/>                   clusterOptions = markerClusterOptions(showCoverageOnHover = FALSE,<br/>                    iconCreateFunction=JS("function (cluster) {    <br/>    var childCount = cluster.getChildCount(); <br/>    var c = ' marker-cluster-';  <br/>    if (childCount &lt; 100) {  <br/>      c += 'small';  <br/>    } else if (childCount &lt; 1000) {  <br/>      c += 'medium';  <br/>    } else { <br/>      c += 'large';  <br/>    }    <br/>    return new L.DivIcon({ html: '&lt;div&gt;&lt;span&gt;' + childCount + '&lt;/span&gt;&lt;/div&gt;', className: 'marker-cluster' + c, iconSize: new L.Point(40, 40) });</span><span id="c8c2" class="mo ke iq mk b gy ne mq l mr ms">  }"))) %&gt;%<br/>  addLegend(position = "topright",<br/>            values = ~`Kapacita?`,<br/>            opacity = .7,<br/>            pal = pal,<br/>            title = "Kapacita?") %&gt;%<br/>  leaflet.extras::addResetMapButton() %&gt;%<br/>   addLayersControl(<br/>                baseGroups = c("Základní", "Letecká", "Uliční", "Zeměpisná"),<br/>                options = layersControlOptions(collapsed = TRUE)<br/>              ) %&gt;%<br/>      addSearchOSM()</span><span id="b8fc" class="mo ke iq mk b gy ne mq l mr ms">map1</span></pre><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/ec175c353eb8c05982c342ddb053db3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*eMLMTWpp5BQuGZ5TqikDIQ.png"/></div></figure><h1 id="d6ef" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结束语</h1><p id="8c53" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">我相信当以上述方式集成R和Python时，有些人会皱起眉头。"<em class="me">为什么不选择一种工具并使用它呢？</em>“你可能会问自己。在我的例子中，我需要在模板中添加一部分。虽然它的部分是用R编写的，但我不想把自己局限在一种工具上。</p><p id="add1" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">同时，通过查看当前的限制，我们可以促进未来集成的便利性。在这里，我必须承认<a class="ae kc" href="https://www.rstudio.com/solutions/r-and-python/" rel="noopener ugc nofollow" target="_blank"> RStudio </a>，在我看来是处理数据的最好工具之一，已经在集成Python方面迈出了重要的几步。然而，在特定的用例中，这仍然是一段有点颠簸的旅程。</p><p id="94ed" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">最终，我想试验和测试极限。我相信Python和R在处理数据时各有利弊，所以为什么不探索一下如果将它们结合在一起可以达到什么目的呢？</p></div></div>    
</body>
</html>