<html>
<head>
<title>Debugging Python Code Visually</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可视化调试Python代码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/debugging-python-code-visually-912790f60b37?source=collection_archive---------26-----------------------#2021-06-12">https://towardsdatascience.com/debugging-python-code-visually-912790f60b37?source=collection_archive---------26-----------------------#2021-06-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7ce4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Birdseye调试Python代码</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/43f86cb0d8ad8b3ba2d56952489af8fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gUGWaZ4vMQF1zkmK"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@sigmund?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">西格蒙德</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="5de7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您是使用print()命令调试python代码或函数的程序员之一吗？如果答案是肯定的，那么你并不孤单，大多数使用Jupyter notebook的python程序员都是这样调试他们的代码的。这没有什么错，但是这不是我们调试代码的一种便捷方式。</p><p id="8458" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Birdseye是一个开源的python库，用于调试python代码。它在运行时记录特定函数中表达式的值，一旦函数被执行，您可以可视化这些值，并在出现问题时进行调试。</p><p id="c343" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将看到Birdseye如何用于python代码调试。</p><p id="3d14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们开始吧…</p><h1 id="7acc" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">安装所需的库</h1><p id="0f16" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">像任何其他python库一样，我们将使用pip安装来安装Birdseye。下面给出的命令将执行安装。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="5aab" class="mx lw it mt b gy my mz l na nb">pip install --user birdseye</span></pre><h1 id="1024" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">导入所需的库</h1><p id="8614" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">接下来，我们将导入将在本文中使用的所有必需的库。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="ea7a" class="mx lw it mt b gy my mz l na nb">from birdseye import eye</span></pre><p id="5d26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了看到Birdseye的运行，我们需要一些带函数的python代码，以便我们可以调试它。你可以使用任何包含函数的代码。我在用我自己的代码创建一个使用不同功能的神经网络。要激活鸟眼，你只需要在我们想要监控的每个人前面加上“@eye”就可以了。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="d880" class="mx lw it mt b gy my mz l na nb">from keras.datasets import mnist<br/>import matplotlib.pyplot as plt<br/>import numpy as np<br/>import keras<br/>from keras.layers import Dense, Dropout <br/>from keras.models import Sequential <br/>from birdseye import eye<br/>image_size = 28*28<br/>num_classes = 10</span><span id="08dd" class="mx lw it mt b gy nc mz l na nb">class DigitRecoginzer:<br/>    <a class="ae ky" href="http://twitter.com/eye" rel="noopener ugc nofollow" target="_blank">@eye</a><br/>    def __init__(self):<br/>        # Setup train and test splits<br/>        (self.x_train, self.y_train), (self.x_test, self.y_test) = mnist.load_data()<br/>        self.x_train, self.x_test = self.x_train/255, self.x_test/255<br/>        #print("Training label shape: ", self.y_train.shape) <br/>        #print("Training Data Shape", self.x_train.shape)<br/>    <a class="ae ky" href="http://twitter.com/eye" rel="noopener ugc nofollow" target="_blank">@eye</a><br/>    def get_data(self):<br/>        return self.x_train, self.y_train, self.x_test, self.y_test<br/>                <br/>    # Convert to "one-hot" vectors using the to_categorical function<br/>    <a class="ae ky" href="http://twitter.com/eye" rel="noopener ugc nofollow" target="_blank">@eye</a><br/>    def one_hot_encoding(self):<br/>        #print("Data before one-hot encoding", self.y_train[:5])<br/>        num_classes = 10<br/>        self.y_train = keras.utils.to_categorical(self.y_train, num_classes)<br/>        self.y_test = keras.utils.to_categorical(self.y_test, num_classes)<br/>        #print("Data after one-hot encoding\n", self.y_train[:5])</span><span id="501d" class="mx lw it mt b gy nc mz l na nb"># Flatten the images<br/>    <a class="ae ky" href="http://twitter.com/eye" rel="noopener ugc nofollow" target="_blank">@eye</a><br/>    def flatten_image(self):<br/>        image_vector_size = 28*28<br/>        self.x_train = self.x_train.reshape(self.x_train.shape[0], image_vector_size)<br/>        self.x_test = self.x_test.reshape(self.x_test.shape[0], image_vector_size)<br/>    <br/>    <a class="ae ky" href="http://twitter.com/eye" rel="noopener ugc nofollow" target="_blank">@eye</a><br/>    def GenericModel (self, image_size, num_classes, hyperP, dp=False):<br/>        try:<br/>            self.model = Sequential()<br/>            numHiddenLayers = hyperP["NumHiddenLayers"]<br/>            act = hyperP[1][1]<br/>            init = hyperP[1][2]<br/>            self.model.add(Dense(hyperP[1][0], activation=hyperP[1][1], input_shape=(image_size,),kernel_initializer= init))#kernel_regularizer=l22<br/>            for i in range(2, numHiddenLayers+1):<br/>                l = hyperP[i]<br/>                init = l[2]<br/>                self.model.add(Dense(l[0], activation=l[1], kernel_initializer=init))   <br/>                if(dp):<br/>                    self.model.add(Dropout(hyperP['dp_rate'][i-2]))<br/>            self.model.add(Dense(num_classes, activation='softmax'))</span><span id="42dd" class="mx lw it mt b gy nc mz l na nb">opt =hyperP["opt"](hyperP["lr"])<br/>            self.model.compile(optimizer="adam", loss='categorical_crossentropy', metrics=['accuracy'])<br/>            self.model.summary()<br/>        except Exception as ke:<br/>            print ("Key is not defined", ke)<br/>            self.model = None<br/>    <a class="ae ky" href="http://twitter.com/eye" rel="noopener ugc nofollow" target="_blank">@eye</a><br/>    def train_model(self, epoch, batch_size):<br/>        self.history = self.model.fit(self.x_train, self.y_train, batch_size=batch_size, epochs=epoch, verbose=2, validation_split=0.1)<br/>        self.model.save('model.h5')<br/>    <a class="ae ky" href="http://twitter.com/eye" rel="noopener ugc nofollow" target="_blank">@eye</a>    <br/>    def get_accuracy(self):<br/>        loss, accuracy  = self.model.evaluate(self.x_test, self.y_test, verbose=False)<br/>        loss_train, accuracy_train = self.model.evaluate(self.x_train, self.y_train, verbose=False)<br/>        print(f'Train loss: {loss_train:.3}', f'Train accuracy: {accuracy_train:.3}')<br/>        print(f'Test loss: {loss:.3}',f'Test accuracy: {accuracy:.3}')<br/>        return accuracy_train<br/>    <a class="ae ky" href="http://twitter.com/eye" rel="noopener ugc nofollow" target="_blank">@eye</a>            <br/>    def predict(self, img):<br/>        result = np.around(self.model.predict(img)[0])<br/>        max1 = max(result)<br/>        return np.where(result == max1)[0][0]</span><span id="2354" class="mx lw it mt b gy nc mz l na nb"><br/>lr =[0.1, 0.01, 1, 10, 0.5, 0.05]<br/>objs = []<br/>for i in range(len(lr)):<br/>    HyperParam1 = {<br/>        #Training Level Hyper Params<br/>        "epochs": 300,<br/>        "lr": lr[i],<br/>        "batchSize": 2048,<br/>        "dp_rate": [0.2, 0.1, 0.05],<br/>        "opt": keras.optimizers.Adam,<br/>        #Network Level HyperParam<br/>        "NumHiddenLayers": 2,<br/>        1:[64, "sigmoid", keras.initializers.glorot_normal(seed=20)],<br/>        2:[32, "relu", keras.initializers.glorot_normal(seed=20)],<br/>    }<br/>    objs.append(DigitRecoginzer())<br/>    objs[i].one_hot_encoding()<br/>    objs[i].flatten_image()<br/>    objs[i].GenericModel(image_size, num_classes, HyperParam1, dp=False)</span></pre><p id="ac97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们将使用下面给出的命令运行Birdseye Flask应用程序。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="ff68" class="mx lw it mt b gy my mz l na nb">python -m birdseye</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/084572c41cca47c9b88105aff732b946.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*ZM7QWwcH-2KdhOR60vNDTw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:作者</p></figure><p id="68ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是Birdseye应用程序的主页，在这里您可以看到所有需要监控的函数名。我们可以通过点击这些函数来仔细查看它们的内部。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/4469e61d8641b047d01c6dc39008e672.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VI726rPvnT9KvJXIxCya1Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:作者</p></figure><p id="815b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，您可以可视化开始时间、函数的参数以及结果(如果有的话)。这就是如何使用Birdseye进行代码调试。继续尝试不同的功能，让我知道你在回复部分的意见。</p><p id="3417" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文是与<a class="nf ng ep" href="https://medium.com/u/40808d551f5a?source=post_page-----912790f60b37--------------------------------" rel="noopener" target="_blank">皮尤什·英加尔</a>合作完成的。</p><h1 id="1dc2" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">在你走之前</h1><p id="75c1" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><strong class="lb iu"> <em class="nh">感谢</em> </strong> <em class="nh">的阅读！如果你想与我取得联系，请随时通过hmix13@gmail.com联系我或我的</em> <a class="ae ky" href="http://www.linkedin.com/in/himanshusharmads" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> <em class="nh"> LinkedIn个人资料</em> </strong> </a> <em class="nh">。可以查看我的</em><a class="ae ky" href="https://github.com/hmix13" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="nh">Github</em></strong><em class="nh"/></a><em class="nh">简介针对不同的数据科学项目和包教程。还有，随意探索</em> <a class="ae ky" href="https://medium.com/@hmix13" rel="noopener"> <strong class="lb iu"> <em class="nh">我的简介</em> </strong> </a> <em class="nh">，阅读我写过的与数据科学相关的不同文章。</em></p></div></div>    
</body>
</html>