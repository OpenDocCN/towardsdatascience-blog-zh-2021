<html>
<head>
<title>Train a custom Tesseract OCR model as an alternative to Google vision for reading children’s handwriting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">训练自定义的Tesseract OCR模型，作为阅读儿童笔迹的Google vision的替代方案</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/train-a-custom-tesseract-ocr-model-as-an-alternative-to-google-vision-ocr-for-reading-childrens-db8ba41571c8?source=collection_archive---------9-----------------------#2021-11-02">https://towardsdatascience.com/train-a-custom-tesseract-ocr-model-as-an-alternative-to-google-vision-ocr-for-reading-childrens-db8ba41571c8?source=collection_archive---------9-----------------------#2021-11-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d2be" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><em class="kf">一个故事小队项目</em></h2></div><p id="a9f2" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi lc translated"><span class="l ld le lf bm lg lh li lj lk di"> T </span>他是<a class="ae ll" href="https://www.storysquad.education/" rel="noopener ugc nofollow" target="_blank"> Story Squad </a>的联合创始人，Graig Peterson和Darwin Johnson开创了一个平台，让孩子们有机会发挥创造力，提高他们的阅读和写作能力，同时减少他们花在屏幕上的时间。故事班通过游戏化来保持这个过程的趣味性。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/5d2419a83390e4cb6d0e358d4ee8657a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*pNBJjH-xRn7athMp-SvlAg.jpeg"/></div><p class="lu lv gj gh gi lw lx bd b be z dk translated">图片由故事小队提供</p></figure><blockquote class="ly lz ma"><p id="90a2" class="kg kh mb ki b kj kk jr kl km kn ju ko mc kq kr ks md ku kv kw me ky kz la lb ij bi translated"><strong class="ki ir">那么，这个游戏是如何让孩子们参与进来，而不是在他们的屏幕上呢？</strong></p></blockquote><p id="f727" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">下面是一个解释故事班的视频:</p><figure class="ln lo lp lq gt lr"><div class="bz fp l di"><div class="mf mg l"/></div><p class="lu lv gj gh gi lw lx bd b be z dk translated">Graig Peterson(Story Squad的联合创始人)的视频</p></figure><p id="8409" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">什么是OCR？<br/> </strong>光学字符识别(OCR)是一种从扫描文档或图像文件的打印或手写文本中自动提取数据的解决方案。然后，文本被转换成可以通过数据处理进行操作的形式。OCR有许多应用，例如，支票、护照、银行结单和收据等商业文件的数据输入、自动车牌识别和交通标志识别。</p><p id="aa9c" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">为什么这个项目需要OCR？</strong></p><p id="c3c2" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我们需要转录孩子们上传的故事，并处理转录。在游戏中，每个孩子都需要与另一个写作水平相似的孩子配对，每个团队都应该与同一类别的另一个团队配对，这样游戏才会有竞争性和趣味性。这就是数据科学团队的用武之地。</p><ul class=""><li id="27b3" class="mh mi iq ki b kj kk km kn kp mj kt mk kx ml lb mm mn mo mp bi translated">使用NLP工具来找出写作的复杂程度，可以对参与者进行适当的分组。</li><li id="0768" class="mh mi iq ki b kj mq km mr kp ms kt mt kx mu lb mm mn mo mp bi translated">我们需要OCR在家长仪表板上创建一个单词云，让家长看到他们的孩子写了什么。</li><li id="b367" class="mh mi iq ki b kj mq km mr kp ms kt mt kx mu lb mm mn mo mp bi translated">我们需要监控孩子的进步(随着时间的推移，他们的复杂程度有所提高吗？他们平均写多少字？)</li><li id="7fdd" class="mh mi iq ki b kj mq km mr kp ms kt mt kx mu lb mm mn mo mp bi translated">我们还想标记不恰当的词语。尽管每个故事都会被人看到，但我们会采取一切预防措施，通过添加自定义的脏话过滤器，让平台成为孩子们的安全空间。</li></ul><p id="e1e6" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">tessera CT OCR Vs Google vision OCR<br/></strong>Google vision正在以大约80–95%的准确率记录手写图像。我们现在面临的问题是这项服务是有价格标签的。利益相关者希望降低这些成本。</p><p id="f0a4" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">DS团队的任务是训练一个宇宙魔方OCR模型，一个开源的OCR，作为Google vision的替代方案。</p><p id="4838" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">宇宙魔方OCR模型训练周期</strong></p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mv"><img src="../Images/774f3e26f94b10d28d55a51b58084fe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dbqX3zyeT3_jnb8S"/></div></div><p class="lu lv gj gh gi lw lx bd b be z dk translated">图片由作者提供</p></figure><ol class=""><li id="897a" class="mh mi iq ki b kj kk km kn kp mj kt mk kx ml lb na mn mo mp bi translated">数据准备:数据清理和标记</li></ol><p id="3d18" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">Tesseract OCR接收分段的手写图像及其相应的转录文本(基本事实)。这对需要有相同的名字<name>。图像的tif或转录文本文件的<name> .gt.txt。该模型也可以在png图像上训练。</name></name></p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nb"><img src="../Images/1987eebe8e5e9df82dcf0d289526634c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M1ZpB4gsKpRWJM9e18q4-Q.png"/></div></div><p class="lu lv gj gh gi lw lx bd b be z dk translated">图片由作者提供</p></figure><blockquote class="nc"><p id="92a3" class="nd ne iq bd nf ng nh ni nj nk nl lb dk translated">“塞利纳，”她会说，“当世界</p></blockquote><p id="cd22" class="pw-post-body-paragraph kg kh iq ki b kj nm jr kl km nn ju ko kp no kr ks kt np kv kw kx nq kz la lb ij bi translated">如果存在文件命名不匹配，训练将会中断。您必须通过删除或重命名受影响的文件来纠正不匹配。repo(utils/check _ ground truth _ files _ pair . py)中有一个脚本可以检查是否存在不匹配。那些进行数据清理的人可以在将数据推送到回购之前纠正这些错误。此外，由于<a class="ae ll" href="https://www.ftc.gov/enforcement/rules/rulemaking-regulatory-reform-proceedings/childrens-online-privacy-protection-rule" rel="noopener ugc nofollow" target="_blank"> COPPA </a>，GitHub上不允许儿童写作的完整图像。有一个脚本检查数据中的完整图像(utils/essay check _ w _ image _ height . py)。</p><p id="1c8f" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">过去，数据准备有两种不同的方式。文件夹32和52中的图像经过预处理，将图像二值化，然后使用命令行上的脚本将它们分段。文件夹31-和51-(只有最后5个故事)被清理，并使用画图软件和另一个手动python脚本(不包括在repo中)手工标记。文件夹31在剪辑前没有二进制化。你可以在ds repo/data/story-squad-ground-truth中找到经过清理和标记的数据。</p><p id="869e" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">开发了一个数据管道来实现数据准备过程的半自动化。您可以在data_management文件夹中找到它。</p><p id="00d6" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">2.宇宙魔方模型定型和调整</p><ul class=""><li id="7833" class="mh mi iq ki b kj kk km kn kp mj kt mk kx ml lb mm mn mo mp bi translated">GPU箱将由讲师设置</li><li id="21f1" class="mh mi iq ki b kj mq km mr kp ms kt mt kx mu lb mm mn mo mp bi translated">下载<em class="mb"> pem </em>键获得进入EE2机器的许可</li><li id="15d0" class="mh mi iq ki b kj mq km mr kp ms kt mt kx mu lb mm mn mo mp bi translated">在终端<em class="mb">中，使用pem键将cd </em>放入目录，并运行ssh命令以进入EE2机器</li><li id="c5ac" class="mh mi iq ki b kj mq km mr kp ms kt mt kx mu lb mm mn mo mp bi translated">git克隆ds repo(如果repo中有新数据，将其移动到<em class="mb">tes strain \ \ data \ \ story squad-ground-truth</em>dir)</li><li id="225c" class="mh mi iq ki b kj mq km mr kp ms kt mt kx mu lb mm mn mo mp bi translated">在根目录下运行<em class="mb">source training _ setup . sh</em>命令</li><li id="a96f" class="mh mi iq ki b kj mq km mr kp ms kt mt kx mu lb mm mn mo mp bi translated">cd进入<em class="mb">test strain</em>并通过运行命令<em class="mb">source ocr \ \ bin \ \ activate</em>激活虚拟环境。如果有效，您应该切换到(OCR)环境</li><li id="953c" class="mh mi iq ki b kj mq km mr kp ms kt mt kx mu lb mm mn mo mp bi translated">在<em class="mb"> tesstrain </em> dir中运行该命令来训练模型make training<em class="mb">MODEL _ NAME = story squad START _ MODEL = eng Tess data =/home/Ubuntu/tesserac t/Tess data</em></li><li id="4996" class="mh mi iq ki b kj mq km mr kp ms kt mt kx mu lb mm mn mo mp bi translated">上面的命令将使用默认的超参数来训练模型。要调整超参数，必须修改命令行以指示超参数，例如，如果您想将PSM设置为7 而不是使用默认值，则必须修改命令行。</li><li id="9881" class="mh mi iq ki b kj mq km mr kp ms kt mt kx mu lb mm mn mo mp bi translated">注意:这大约需要一个小时来运行。如果ground_truth和snippet之间有任何不匹配，将会出现一个错误。你需要进入<em class="mb"> story-squad-ground-truth </em>目录，通过删除或上传相应的文件来解决问题。当问题解决后，只需再次运行训练命令，模型将从出错的地方开始。</li><li id="555e" class="mh mi iq ki b kj mq km mr kp ms kt mt kx mu lb mm mn mo mp bi translated">一旦模型完成训练，新的模型将被存储在<em class="mb">测试应变\ \数据</em>中。现在默认的名字是<em class="mb"> storysquad.traineddata </em>。如果新模型没有被移动到另一个目录或重命名，它们将覆盖旧模型。</li></ul><p id="a3e1" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">由于EC2实例没有足够的空间让tesseract训练更多的数据，因此为将来的tesseract训练建立了一个docker文件<em class="mb">` ds repo \ docker file _ tessera CT _ training`</em>。</p><p id="8722" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir"> 3 &amp; 4数据预处理和转录</strong></p><p id="2390" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在使用新模型转录图像之前，进行数据预处理。每个图像需要不同的预处理方法。如果图像是打印文本，它几乎不需要预处理。有几个预处理方法是通用的，你总是想确保图像没有倾斜，并以一种或另一种形式二值化。印刷文本不需要太多的预处理。Tesseract OCR可以准确地读取印刷文本和整洁书写的文字，但可能难以转录独特的字体和低质量的图像。</p><div class="ln lo lp lq gt ab cb"><figure class="nr lr ns nt nu nv nw paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><img src="../Images/3f524f80dcdf9543f81dbe35fc9a0517.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*MHRFtDmef-qRL-6cajSxMg.png"/></div></figure><figure class="nr lr nx nt nu nv nw paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><img src="../Images/6b799d0dbbb0e15500caf3360976a0ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*C-_z7Mu64P6q6T7opXLjZg.png"/></div><p class="lu lv gj gh gi lw lx bd b be z dk ny di nz oa translated">图片由作者提供</p></figure></div><p id="2d23" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">使用十个故事和它们相应的基本事实(人类转录的)来测试模型性能。我们还使用了一个整洁的手写图像作为对照(这个图像几乎不需要预处理)。</p><p id="cbd3" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这个阶段包括使用NLP技术来提高转录文本的准确性。对于大多数OCR应用程序来说，这个阶段是必不可少的。然而，利益相关者希望保留儿童的话语。如果他们拼错了一个单词，自然语言处理技术可能会纠正它。<br/>我们专注于使用准确度分数评估模型。我们遇到了准确性分数的问题。该模型对一些它根本无法转录的图像给出了很高的精确度。未来的群组可能会考虑使用其他评估指标，如余弦相似度、CER(字符错误率)和WER(单词错误率)。</p><p id="5518" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">关键时刻</strong></p><p id="06fd" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我们在整洁的手写图像(full_sample2.png)上使用模型取得了一些进展。准确率分数提高了13%。不幸的是，该模型在儿童手写图像上表现不佳。我们的准确率在0-20%之间。预处理图像将一些分数提高了大约10%。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/139dd84f139058be15582fe513cd9d21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*Yvwl4qANBCMIzIvrfqUUaA.png"/></div><p class="lu lv gj gh gi lw lx bd b be z dk translated">图片由作者提供</p></figure><p id="d957" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">接下来是什么？</strong></p><p id="84c0" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我们还有很长的路要走。DS团队需要与经理和利益相关者讨论前进的方向。</p><p id="9436" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">以下是我们认为有助于继续我们工作的一些任务。</p><ul class=""><li id="8c2e" class="mh mi iq ki b kj kk km kn kp mj kt mk kx ml lb mm mn mo mp bi translated">清除更多数据</li><li id="ef49" class="mh mi iq ki b kj mq km mr kp ms kt mt kx mu lb mm mn mo mp bi translated">构建一个ML基础设施，用于自动化关于模型结构、超参数和性能指标的重要信息</li><li id="2a0f" class="mh mi iq ki b kj mq km mr kp ms kt mt kx mu lb mm mn mo mp bi translated">数据管道的优化</li><li id="d70d" class="mh mi iq ki b kj mq km mr kp ms kt mt kx mu lb mm mn mo mp bi translated">使用Docker容器进行OCR训练</li><li id="1e0b" class="mh mi iq ki b kj mq km mr kp ms kt mt kx mu lb mm mn mo mp bi translated">构建预处理管道</li></ul><p id="42a0" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">参考文献</strong></p><p id="6a18" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">兰姆达学校涂鸦体育场DS回购:【https://github.com/Lambda-School-Labs/scribble-stadium-ds T2】</p><p id="15e7" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">儿童在线隐私保护规则(“COPPA”):<a class="ae ll" href="https://www.ftc.gov/enforcement/rules/rulemaking-regulatory-reform-proceedings/childrens-online-privacy-protection-rule" rel="noopener ugc nofollow" target="_blank">https://www . FTC . gov/enforcement/rules/Rule making-regulatory-reform-proceedings/children-Online-Privacy-Protection-Rule</a></p><p id="af3c" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">故事小队(Scribble stadium):<a class="ae ll" href="https://www.storysquad.education/" rel="noopener ugc nofollow" target="_blank">https://www . story Squad . education/</a></p></div></div>    
</body>
</html>