<html>
<head>
<title>Introduction to ARIMA for Time Series Forecasting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列预测的ARIMA介绍</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introduction-to-arima-for-time-series-forecasting-ee0bc285807a?source=collection_archive---------6-----------------------#2021-05-28">https://towardsdatascience.com/introduction-to-arima-for-time-series-forecasting-ee0bc285807a?source=collection_archive---------6-----------------------#2021-05-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0e54" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解用于时间序列预测的一种比较流行的ML算法。</h2></div><p id="d2da" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">自回归综合移动平均(ARIMA)模型是时间序列预测中较为流行和广泛使用的统计方法之一。它是一类统计算法，捕捉时间序列数据特有的标准时间依赖性。在本帖中，我将向您介绍ARIMA的基本原理，并展示一个用Python开发用于时间序列预测的ARIMA的实践教程。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/640a63ce54801cd6ebff228b3afecf3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aCjniFrYrlKR9pFR"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">托马斯·博尔曼斯在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="ec3c" class="mh mi it md b gy mj mk l ml mm"><strong class="md iu">Table of Content:<br/></strong>1. What is ARIMA?<br/>2. Introduction to the Dataset<br/>3. Implementing ARIMA model in Python<br/>4. Forecasting using ARIMA</span><span id="605c" class="mh mi it md b gy mn mk l ml mm"><strong class="md iu">Notes before we begin</strong>:<br/>1. Download the <a class="ae lu" href="https://drive.google.com/file/d/1CL1l38xkg9NJTxUpq-i7CeMNjkp3BKIh/view" rel="noopener ugc nofollow" target="_blank">rainfall CSV dataset here</a><br/>2. Install dependencies: <br/>  - <em class="mo">pip install statsmodels</em> OR <em class="mo">conda install statsmodels<br/>  - pip install patsy OR conda install patsy</em></span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0482" class="mp mi it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated"><strong class="ak">什么是ARIMA？</strong></h1><h2 id="4a24" class="mh mi it bd mq ng nh dn mu ni nj dp my kr nk nl na kv nm nn nc kz no np ne nq bi translated"><strong class="ak">关键词:平稳性和自相关性</strong></h2><p id="20df" class="pw-post-body-paragraph ki kj it kk b kl nr ju kn ko ns jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated">在我们深入ARIMA的正式数学定义之前，让我向你介绍一下<strong class="kk iu">平稳性</strong>的概念。平稳性仅仅意味着不依赖于时间的观察。对于依赖于时间的数据(如季节性降雨)，平稳性条件可能不成立，因为不同的时间将产生不同的观测值。</p><p id="5425" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">理解ARIMA的另一个重要概念是自相关。它与典型的相关性有何不同？首先，相关性涉及两组不同的观察值(如房价和可用公共设施的数量)，而自相关涉及同一组观察值，但跨越不同的时间(如夏季<em class="mo">与秋季</em>的降雨量)。</p><p id="b97e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们来分解ARIMA的不同组成部分:自回归(AR)、综合(I)和移动平均线(MA)</p><h2 id="f082" class="mh mi it bd mq ng nh dn mu ni nj dp my kr nk nl na kv nm nn nc kz no np ne nq bi translated">IMA的自回归:自回归</h2><p id="2364" class="pw-post-body-paragraph ki kj it kk b kl nr ju kn ko ns jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated">正如您可能已经猜到的，自回归(AR)回归模型建立在自相关概念的基础上，其中因变量取决于其自身的过去值(例如，今天的降雨量可能取决于昨天的降雨量，等等)。一般等式是:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nw"><img src="../Images/65525a6a9a113dc31051975d3cab32d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*n_WILcsBKt-VkTjC.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">ARIMA的自回归模型</p></figure><p id="5580" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如图所示，在时间t<code class="fe nx ny nz md b">Yt</code>的观察<code class="fe nx ny nz md b">Y</code>取决于<code class="fe nx ny nz md b">Yt-1, Yt-2, ..., Yt-p</code>。为什么是<code class="fe nx ny nz md b">Yt-p</code>而不是<code class="fe nx ny nz md b">Y0</code>(即。初始值)？这里的<strong class="kk iu"> p </strong>称为滞后阶数，表示我们在模型中包括的先前滞后观测的数量(例如，我们可能排除了当前时间之前5天以上的观测，因为这些较早的降雨观测可能不相关)。</p><h2 id="8a73" class="mh mi it bd mq ng nh dn mu ni nj dp my kr nk nl na kv nm nn nc kz no np ne nq bi translated"><strong class="ak">AR[I]MA中的I:综合</strong></h2><p id="799d" class="pw-post-body-paragraph ki kj it kk b kl nr ju kn ko ns jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated">回想一下我们对平稳性的解释。ARIMA的积分部分试图将时间序列数据的非平稳性转换成稍微平稳一点的东西。我们如何做到这一点？通过对任意两对观测值之间的<strong class="kk iu">差</strong>进行预测，而不是直接对数据本身进行预测。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/f7ededcd6c270a649b14e1de9d5fc36c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/0*MXQzT6929QDPbhVz.png"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">ARIMA的差异</p></figure><p id="99b2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意，根据我们在训练ARIMA模型时设置的超参数<strong class="kk iu"> d </strong>，我们如何多次执行差分运算(<strong class="kk iu">Y→Z</strong>T5】和T7】Z→Q)。</p><h2 id="14bb" class="mh mi it bd mq ng nh dn mu ni nj dp my kr nk nl na kv nm nn nc kz no np ne nq bi translated">移动平均线</h2><p id="7277" class="pw-post-body-paragraph ki kj it kk b kl nr ju kn ko ns jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated">现在ARIMA的最后一块是移动平均线。它试图通过对你过去的观测值进行某种聚合操作，以残差ε(读作:ε)来减少我们的时间序列数据中的噪声。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nw"><img src="../Images/f254c81cf6dbbfc8920c0efbffe68eb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s_-d3cMREZK1XYIg.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">ARIMA移动平均线</p></figure><p id="1e15" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ε项表示来自聚合函数的残差，这里的<strong class="kk iu"> q </strong>是另一个超参数，与<strong class="kk iu">p</strong>相同，但不是识别时间序列数据本身的时间窗口(<strong class="kk iu">p</strong>),<strong class="kk iu">q</strong>指定移动平均值残差的时间窗口。</p><p id="f243" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们用Python来实现ARIMA。</p><h1 id="7b55" class="mp mi it bd mq mr ob mt mu mv oc mx my jz od ka na kc oe kd nc kf of kg ne nf bi translated">数据集简介</h1><blockquote class="og oh oi"><p id="efe1" class="ki kj mo kk b kl km ju kn ko kp jx kq oj ks kt ku ok kw kx ky ol la lb lc ld im bi translated">如果您尚未下载数据集，请在此处<a class="ae lu" href="https://drive.google.com/file/d/1CL1l38xkg9NJTxUpq-i7CeMNjkp3BKIh/view" rel="noopener ugc nofollow" target="_blank">下载。</a></p></blockquote><p id="6e82" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们对数据集进行一些基本的探索。</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="5bf7" class="mh mi it md b gy mj mk l ml mm">import pandas as pd</span><span id="eb4b" class="mh mi it md b gy mn mk l ml mm">df = pd.read_csv('rainfall.csv')<br/>df</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi om"><img src="../Images/592fb22390e6e50df0457f8b2c654cb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:392/format:webp/1*CXtTOAsjsI_g71_10yxqsg.png"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">降雨时间序列(图片由作者提供)</p></figure><p id="1909" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的数据集是从2010年1月1日到2020年5月1日的日降雨量时间序列数据(单位为毫米)。</p><p id="979b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们画出降雨量数据如何随时间变化的图(为了便于说明，我们以一个月为例)。</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="4ee2" class="mh mi it md b gy mj mk l ml mm">import matplotlib.pyplot as plt</span><span id="8841" class="mh mi it md b gy mn mk l ml mm"># First 30 days<br/>first_30 = df[:30]</span><span id="8dd4" class="mh mi it md b gy mn mk l ml mm">first_30.plot.line(x='date', y='rainfall')</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi on"><img src="../Images/6e64b2e30fb8f9dba79087ac1868d40d.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*7taMbn8WPNSnEdEHyNdinQ.png"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">第一个月的降雨量数据(图片由作者提供)</p></figure><p id="8d2a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以检查数据集中可能出现的任何自相关。</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="007f" class="mh mi it md b gy mj mk l ml mm">from pandas.plotting import autocorrelation_plot</span><span id="d228" class="mh mi it md b gy mn mk l ml mm">autocorrelation_plot(first_30['rainfall'])</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/e5707a8c8bab0907cd998b228c3b3827.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*2Ninr3FTXhsydZxWE7jAHg.png"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">自相关(图片由作者提供)</p></figure><p id="65b9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当滞后时间很短(0-5天)和足够长(20-25天)时，似乎有轻微的相关性，但不在中间值之间。</p><p id="9322" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们接下来可以从ARIMA的实施中获得有价值的信息！</p><h1 id="fd9e" class="mp mi it bd mq mr ob mt mu mv oc mx my jz od ka na kc oe kd nc kf of kg ne nf bi translated">用Python实现ARIMA模型</h1><p id="abc9" class="pw-post-body-paragraph ki kj it kk b kl nr ju kn ko ns jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated">首先，我们需要导入<code class="fe nx ny nz md b">statsmodels</code>库。</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="f148" class="mh mi it md b gy mj mk l ml mm">from statsmodels.tsa.arima_model import ARIMA</span></pre><p id="4386" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们用这些初始超参数为<strong class="kk iu"> p，d，q </strong>定义模型(如之前在<em class="mo">什么是ARIMA？</em>节)。</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="1406" class="mh mi it md b gy mj mk l ml mm"># fit model</span><span id="9237" class="mh mi it md b gy mn mk l ml mm">p,d,q = 5,1,0</span><span id="5fd3" class="mh mi it md b gy mn mk l ml mm">model = ARIMA(first_30['rainfall'], order=(p,d,q))<br/>model_fit = model.fit()</span></pre><p id="ac36" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看看结果摘要。</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="bb75" class="mh mi it md b gy mj mk l ml mm">print(model_fit.summary())</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi op"><img src="../Images/b3b38892dc003213bfa3f1511d021cca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ezLCiQWrNa2wXImCWAmSUQ.png"/></div></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">ARIMA模式总结(图片由作者提供)</p></figure><p id="38a7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意顶部的<strong class="kk iu"> AIC、BIC和HQIC指标</strong>？这些值越低，模型的拟合度越好。所以可以进行进一步的超参数调优或者数据预处理，以达到更好的效果！</p><p id="5324" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们有了第一个ARIMA的工作模型。最后一节将带您了解如何根据我们训练好的模型进行未来预测。</p><h1 id="28b7" class="mp mi it bd mq mr ob mt mu mv oc mx my jz od ka na kc oe kd nc kf of kg ne nf bi translated">使用ARIMA进行预测</h1><p id="52ed" class="pw-post-body-paragraph ki kj it kk b kl nr ju kn ko ns jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated">让我们首先扩展我们的数据集，以包括<code class="fe nx ny nz md b">365</code>天而不是<code class="fe nx ny nz md b">30</code>。</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="9781" class="mh mi it md b gy mj mk l ml mm">data = df[:365]['rainfall'].values</span></pre><ol class=""><li id="0dea" class="oq or it kk b kl km ko kp kr os kv ot kz ou ld ov ow ox oy bi translated">然后，我们将数据分为训练集(66%)和测试集(34%)。</li></ol><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="3343" class="mh mi it md b gy mj mk l ml mm">train_size = int(len(data) * 0.66)<br/>train, test = data[0:train_size], data[train_size:len(data)]</span></pre><p id="6be4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2.并初始化历史值和预测值用于比较目的</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="8133" class="mh mi it md b gy mj mk l ml mm">history = [x for x in train]<br/>predictions = list()</span></pre><p id="3f7c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">3.现在，我们训练模型，并根据存储在测试数据中的信息进行未来预测</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="db6f" class="mh mi it md b gy mj mk l ml mm">for t in range(len(test)):</span><span id="4722" class="mh mi it md b gy mn mk l ml mm">    model = ARIMA(history, order=(5,1,0))<br/>    model_fit = model.fit()<br/>    pred = model_fit.forecast()<br/>    yhat = pred[0]<br/>    predictions.append(yhat)</span><span id="8227" class="mh mi it md b gy mn mk l ml mm">    # Append test observation into overall record<br/>    obs = test[t]<br/>    history.append(obs)</span></pre><p id="079a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">4.让我们评估一下我们的表现</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="e648" class="mh mi it md b gy mj mk l ml mm">from sklearn.metrics import mean_squared_error<br/>from math import sqrt</span><span id="809b" class="mh mi it md b gy mn mk l ml mm">rmse = sqrt(mean_squared_error(test, predictions))</span><span id="e135" class="mh mi it md b gy mn mk l ml mm">print('Test RMSE: %.3f' % rmse)<br/>&gt;&gt;&gt; Test RMSE: 20.664</span></pre><p id="4ab6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">相当大的RMSE！毫无疑问，这里还有改进的空间。</p><p id="691f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以画出观察和预测之间的差异，并比较两者是如何相似的(或不同的！)</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/4a78a879becafba9015e6d250a0664eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*1feMjJXesmNrasUOGBsXpw.png"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">评价(图片由作者提供)</p></figure><p id="f00a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不算太差！我们的预测(红色)与某些天的观测(蓝色)非常相似(除了具有明显高峰的极端降雨情况)。</p><h1 id="75eb" class="mp mi it bd mq mr ob mt mu mv oc mx my jz od ka na kc oe kd nc kf of kg ne nf bi translated"><strong class="ak">离别的思念</strong></h1><p id="2f9f" class="pw-post-body-paragraph ki kj it kk b kl nr ju kn ko ns jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated">就是这样！到目前为止，我们已经讨论了ARIMA的基本原理以及如何用Python实现它。ARIMA的一个关键特征，就像任何其他ML模型一样，是它对超参数调整的依赖。因此，请务必执行这些步骤！除了微调之外，良好的工作领域知识也是产生高性能ARIMA模型的关键。你觉得ARIMA怎么样？</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="6966" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">【https://tinyurl.com/2npw2fnz】<em class="mo"/><a class="ae lu" href="https://tinyurl.com/2npw2fnz" rel="noopener ugc nofollow" target="_blank"><em class="mo">我会定期通过我的电子邮件简讯用通俗易懂的语言和漂亮的可视化方式总结人工智能研究论文。</em></a></p></div></div>    
</body>
</html>