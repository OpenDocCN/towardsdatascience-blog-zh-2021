<html>
<head>
<title>How to Automate Formatting and Linting in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中自动化格式化和林挺</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-automate-formatting-and-linting-in-python-ce99d2db9c37?source=collection_archive---------25-----------------------#2021-08-23">https://towardsdatascience.com/how-to-automate-formatting-and-linting-in-python-ce99d2db9c37?source=collection_archive---------25-----------------------#2021-08-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b881" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">永远不要再犯错误的代码</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/4b7d54cf2893cfd8e2b4a19726e28607.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*TjwHWc7wqNUdmCmaEvp1Vw.jpeg"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">照片由<a class="ae ku" href="https://unsplash.com/@ffstop?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Fotis Fotopoulos </a>在<a class="ae ku" href="https://unsplash.com/s/photos/script?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="70d7" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们将查看一些包来格式化、lint、测试我们的代码，然后创建一个预提交钩子来自动化这个过程。<a class="ae ku" rel="noopener" target="_blank" href="/an-overview-of-the-pep-8-style-guide-5672459c7682">这篇由<a class="lr ls ep" href="https://medium.com/u/9f5a1cb77de?source=post_page-----ce99d2db9c37--------------------------------" rel="noopener" target="_blank">丹·鲁特</a>撰写的文章</a>是对PEP 8风格指南的一个很好的概述。</p><p id="2de7" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在我们讨论将要使用的包之前，让我们先来看看将要使用的python文件</p><p id="00f4" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们有一个函数叫做helpers.py</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lt lu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">帮助者. py</p></figure><p id="ccf6" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">它有简单的算术功能。所有函数都接受两个参数，并对它们执行算术运算。</p><p id="511b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们有另一个名为tester_helpers.py的文件</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lt lu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">tester_helpers.py</p></figure><p id="aec6" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这个文件只是测试我们之前定义的函数。它使用assert进行简单的相等检查。</p><p id="6edf" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在让我们看看我们将使用的包。</p><h1 id="35cf" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">测试🧪</h1><h1 id="b759" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">7.7k+ ⭐️</h1><p id="f87b" class="pw-post-body-paragraph kv kw it kx b ky mn ju la lb mo jx ld le mp lg lh li mq lk ll lm mr lo lp lq im bi translated">这个包帮助我们运行单元测试。需要记住的一个要求是，包含单元测试的python文件应该以“test_”开头。</p><p id="864b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">仅支持assert语句。要安装软件包</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="8ad8" class="mx lw it mt b gy my mz l na nb">pip install pytest</span></pre><p id="a7cd" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">若要运行单元测试，请键入以下命令</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="c8f4" class="mx lw it mt b gy my mz l na nb">pytest test_helpers.py</span></pre><p id="4343" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果您的所有测试都通过了，您应该会看到类似的输出</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="b9bc" class="mx lw it mt b gy my mz l na nb">test_helpers.py ....             [100%]</span><span id="d2c8" class="mx lw it mt b gy nc mz l na nb">========= 4 passed in 0.01s ===========</span></pre><p id="54d0" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果您得到一个与多个相对导入相关的错误</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="6df0" class="mx lw it mt b gy my mz l na nb">astroid.exceptions.TooManyLevelsError:</span></pre><p id="8eac" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这可能是pytest的一个依赖项的问题。你必须卸载astroid，然后重新安装。这确保安装了最新的astroid版本。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="e28a" class="mx lw it mt b gy my mz l na nb">pip uninstall astroid<br/>pip install astroid</span></pre><p id="90d2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在这之后，我们必须卸载pytest并安装pytest</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="55f9" class="mx lw it mt b gy my mz l na nb">pip uninstall pytest<br/>pip install pytest</span></pre><h1 id="a2d0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">格式化✍️</h1><h1 id="18dc" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">YAPF  12k+ ⭐️</h1><p id="fd93" class="pw-post-body-paragraph kv kw it kx b ky mn ju la lb mo jx ld le mp lg lh li mq lk ll lm mr lo lp lq im bi translated">这是由google开发的，支持就地格式化。要安装软件包</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="11ed" class="mx lw it mt b gy my mz l na nb">pip install yapf</span></pre><p id="0ab4" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">要格式化文件，请键入以下内容</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="aff8" class="mx lw it mt b gy my mz l na nb">yapf --in-place *.py</span></pre><p id="7fd8" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这将格式化您所有的顶级python文件，如果您还想包含文件夹，您可以使用以下命令</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="5f9d" class="mx lw it mt b gy my mz l na nb">yapf --in-place **/*.py</span></pre><p id="6f64" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">但是，这也包括我们的虚拟环境文件夹。要忽略venv文件夹，只需创建一个文件。yapfignore然后加上venv。</p><p id="8b63" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">注意:此命令可能需要一些时间来运行。您可以使用文件夹的特定名称来代替' ** '。</p><h1 id="ae64" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><a class="ae ku" href="https://github.com/PyCQA/isort" rel="noopener ugc nofollow" target="_blank"> isort </a> 4.1k+ ⭐️</h1><p id="e6b6" class="pw-post-body-paragraph kv kw it kx b ky mn ju la lb mo jx ld le mp lg lh li mq lk ll lm mr lo lp lq im bi translated">这个包对您的import语句进行排序，以确保它们遵循pep8规则。</p><p id="3446" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">进口应按以下顺序分组:</p><ul class=""><li id="9561" class="nd ne it kx b ky kz lb lc le nf li ng lm nh lq ni nj nk nl bi translated">标准库导入。</li><li id="e727" class="nd ne it kx b ky nm lb nn le no li np lm nq lq ni nj nk nl bi translated">相关第三方进口。</li><li id="241b" class="nd ne it kx b ky nm lb nn le no li np lm nq lq ni nj nk nl bi translated">特定于本地应用程序/库的导入。</li></ul><p id="5c69" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">isort对import语句进行重新排序，以确保遵循上述规则。<br/>安装软件包</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="8db2" class="mx lw it mt b gy my mz l na nb">pip install isort</span></pre><p id="d3b9" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">运行isort</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="96dc" class="mx lw it mt b gy my mz l na nb">isort .</span></pre><h1 id="cd2e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><a class="ae ku" href="https://github.com/myint/autoflake" rel="noopener ugc nofollow" target="_blank">自动对焦</a> 400+⭐️</h1><p id="4883" class="pw-post-body-paragraph kv kw it kx b ky mn ju la lb mo jx ld le mp lg lh li mq lk ll lm mr lo lp lq im bi translated">它有助于消除未使用的导入、变量和对象键。</p><p id="d2c2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">要安装软件包</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="2b12" class="mx lw it mt b gy my mz l na nb">pip install autoflake</span></pre><p id="1029" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">运行自动折叠</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="ef15" class="mx lw it mt b gy my mz l na nb">autoflake --in-place --remove-unused-variables --remove-all-unused-imports *.py</span></pre><h1 id="5673" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">一些其他格式化程序</h1><ul class=""><li id="c966" class="nd ne it kx b ky mn lb mo le nr li ns lm nt lq ni nj nk nl bi translated"><a class="ae ku" href="https://github.com/hhatto/autopep8" rel="noopener ugc nofollow" target="_blank"> autopep8 </a> 3.9k+ ⭐️</li><li id="c21c" class="nd ne it kx b ky nm lb nn le no li np lm nq lq ni nj nk nl bi translated"><a class="ae ku" href="https://github.com/psf/black" rel="noopener ugc nofollow" target="_blank">黑色</a> 22.1k+ ⭐️</li></ul><h1 id="c1f3" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">林挺🔎</h1><h1 id="3836" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">皮林特 3.5k+ ⭐️</h1><p id="d024" class="pw-post-body-paragraph kv kw it kx b ky mn ju la lb mo jx ld le mp lg lh li mq lk ll lm mr lo lp lq im bi translated">pylint确保您的代码遵循pep8规则和标准。它给每个python文件打满分(也可以给你一个负分)</p><p id="41b9" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">要安装软件包</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="e791" class="mx lw it mt b gy my mz l na nb">pip install pylint</span></pre><p id="3798" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">运行棉绒机</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="3d47" class="mx lw it mt b gy my mz l na nb">pylint --fail-under=7 *.py</span></pre><p id="c7c2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">参数<code class="fe nu nv nw mt b">--fail-under</code>是下限，如果任何文件的分数低于下限，将返回一个错误。</p><h1 id="f7ae" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">提交前挂钩🪝</h1><h1 id="c52b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">什么是Git挂钩？</h1><p id="7efc" class="pw-post-body-paragraph kv kw it kx b ky mn ju la lb mo jx ld le mp lg lh li mq lk ll lm mr lo lp lq im bi translated">Git挂钩基本上是在重要操作发生之前触发的脚本，例如，在提交之前，在提交之后将代码推送到repo之前，等等。你可以在<a class="ae ku" href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks" rel="noopener ugc nofollow" target="_blank">这里</a>了解更多关于Git钩子和不同种类钩子的知识。</p><p id="b377" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><a class="ae ku" href="https://medium.com/google-developer-experts/using-git-hooks-to-improve-your-development-workflow-8f5a1fb81ec7" rel="noopener">Enrique lópez-Maas</a>的这篇文章也是了解更多关于git钩子的好文章。</p><p id="5365" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们将重点关注预提交挂钩。预提交挂钩是在提交之前运行的挂钩。</p><p id="0d4d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">首先，让我们安装软件包</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="f7b8" class="mx lw it mt b gy my mz l na nb">pip install pre-commit</span></pre><p id="cd51" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在，我们将生成一个示例预提交钩子YAML文件，稍后我们将编辑它。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="5764" class="mx lw it mt b gy my mz l na nb">pre-commit sample-config</span></pre><p id="61c6" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在让我们添加我们的钩子</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="44b1" class="mx lw it mt b gy my mz l na nb">pre-commit install</span></pre><p id="f722" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在，在每次提交之前，我们的YAML文件中定义的预提交钩子将被执行。</p><p id="d712" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在让我们更新我们的YAML文件。<br/>删除所有内容，仅保留以下内容</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="97ff" class="mx lw it mt b gy my mz l na nb">repos:<br/>    - repo: local<br/>      hooks:</span></pre><p id="6e33" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们将在YAML文件的<code class="fe nu nv nw mt b">hooks:</code>下添加我们的插件(包)。下面是插件的一般语法</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="a912" class="mx lw it mt b gy my mz l na nb">- id: (unique id of hook)<br/>     name: (name to be displayed in terminal)<br/>     entry: (command to excute)<br/>     language: system (for our case, always system) <br/>     always_run: true (if true, it will always run)<br/>     pass_filenames: true (if true, hook will have access to the file name)</span></pre><p id="ee84" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们为YAPF定义一个示例插件</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="10aa" class="mx lw it mt b gy my mz l na nb">- id: YAPF <br/>     name: YAPF 🧹<br/>     entry: zsh -c 'yapf --in-place *.py'<br/>     language: system<br/>     always_run: true<br/>     pass_filenames: true</span></pre><p id="daf9" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果您使用的是bash或windows，请用bash替换“entry”中的zsh。</p><p id="d1c7" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">所有其他插件都非常相似，下面是整个YAML文件和所有插件</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lt lu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">Git预提交钩子来自动化Python中的林挺和格式化</p></figure><blockquote class="nx ny nz"><p id="1897" class="kv kw oa kx b ky kz ju la lb lc jx ld ob lf lg lh oc lj lk ll od ln lo lp lq im bi translated"><em class="it">每当您更新您的YAML文件时，您必须使用git add将该文件添加到临时区域。或者git add。预提交配置. yaml </em></p></blockquote><p id="8ab1" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">下面是一个成功的提交</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="of og di oh bf oi"><div class="gh gi oe"><img src="../Images/9ccc4d52ce019a5d302c193f576e9385.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LPvM0wMrYB-rdaYQBrtvRw.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">行动中的预提交</p></figure><h1 id="7ff2" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="5396" class="pw-post-body-paragraph kv kw it kx b ky mn ju la lb mo jx ld le mp lg lh li mq lk ll lm mr lo lp lq im bi translated">设置预提交挂钩将确保您的代码遵循pep8标准并且格式正确。我希望这篇文章对你有用。在<a class="ae ku" href="https://www.linkedin.com/in/rahulbanerjee2699/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>，<a class="ae ku" href="https://twitter.com/rahulbanerjee99" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上加我</p><blockquote class="nx ny nz"><p id="081d" class="kv kw oa kx b ky kz ju la lb lc jx ld ob lf lg lh oc lj lk ll od ln lo lp lq im bi translated">最初发布于<a class="ae ku" href="https://www.realpythonproject.com/how-to-automate-formatting-and-linting-in-python/" rel="noopener ugc nofollow" target="_blank">realpythonproject.com</a></p></blockquote></div></div>    
</body>
</html>