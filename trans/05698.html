<html>
<head>
<title>Stream Analytics using OCI Streaming and Oracle Database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用OCI流和Oracle数据库进行流分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/stream-analytics-using-oci-streaming-and-oracle-database-ab10e91fa35d?source=collection_archive---------15-----------------------#2021-05-21">https://towardsdatascience.com/stream-analytics-using-oci-streaming-and-oracle-database-ab10e91fa35d?source=collection_archive---------15-----------------------#2021-05-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ce29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">高容量数据流无处不在，无论是服务器日志、web点击数据、消息、媒体等。Oracle Cloud infra structure Streaming service为实时接收和使用大容量数据流提供了一个全面管理、可扩展和持久的解决方案。</p><p id="3256" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">获取这些数据流后的下一步是将它们分析成有意义的结果，这些结果可用于做出关键的业务和设计决策。Oracle工具和服务可用于构建端到端的管道；从流到结果的可视化。</p><p id="886e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">OCI流媒体完全兼容阿帕奇卡夫卡。如果你熟悉卡夫卡式的建筑，它主要有生产者在生产信息。这些消息以数据流的形式(跨主题)存储在Kafka集群中。然后，消费者可以从集群中获取数据。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/651c8debdfaf39dddd6e612fe4c9291b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pxh0Ts2J1PZGj_tS0EqQrQ.png"/></div></div></figure><p id="0588" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Oracle帮助我们使用这种简化的方式。OCI流有流池，你可以考虑取代卡夫卡集群。每个流池都有流，按照上面的架构，这些流是主题。消费者将是Oracle SQL数据库。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kx"><img src="../Images/46e6c5571401ca984c14c705c5355690.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eG21n0K-Rhv7AOTL0tACQw.png"/></div></div></figure><p id="80d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对Kafka或OsaK的Oracle SQL访问是一个Oracle PL/SQL包。它是一个外部表预处理器。您可以通过以下两种方式读取和处理来自Kafka topic的实时事件和消息:</p><ul class=""><li id="f635" class="ky kz iq jp b jq jr ju jv jy la kc lb kg lc kk ld le lf lg bi translated">使用Oracle SQL访问Kafka启用的视图<br/>在这种情况下，数据不需要存储在数据库中。每次你调用它，它都会从Kafka topic中读取最新的数据</li><li id="26eb" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated">对Kafka powered表的Oracle SQL访问<br/>在这种情况下，数据实际上存储在数据库中</li></ul><p id="3de8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用OSaK有多种好处:</p><ul class=""><li id="68c7" class="ky kz iq jp b jq jr ju jv jy la kc lb kg lc kk ld le lf lg bi translated">运行实时流分析作业。直接从流服务读取，无需移动到外部数据源。</li><li id="191f" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated">如果需要，还可以使用它将数据从流服务移动到数据库。</li><li id="8147" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated">OSaK处理偏移管理，消除丢失或重新读取流记录。Oracle SQL只是消费者。</li><li id="7c4a" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated">来自测井/传感器等的实时数据。通常是加密的。您可以将它与传统的SQL表数据集成，以生成未加密的有意义的仪表板。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lm"><img src="../Images/f8b745d4ca89c371670c33d1aa20a372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qdmdcaoR63gM0ZOh2EcKhQ.png"/></div></div></figure><p id="e8f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇博客中，我将重点介绍启用OSaK的视图:</p><ul class=""><li id="106a" class="ky kz iq jp b jq jr ju jv jy la kc lb kg lc kk ld le lf lg bi translated">它是一个Oracle视图，是一个Kafka客户端应用程序</li><li id="ca1e" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated">它被绑定到Kafka集群、组、主题、分区</li><li id="f245" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated">它从Kafka主题中读取一组记录，并将它们转换成由Oracle视图定义抽象的一组SQL表行</li><li id="d3e2" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated">对OSaK视图的查询访问同一个主题分区，并从每个分区读取记录</li><li id="9d24" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated">在查询启动时，提取分区中现有的行，直到分区中的最新记录</li></ul><p id="3254" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们进入设置的实际部分，并开始接收流数据。</p><p id="1de5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一步:登录你的OCI帐户/租赁，并设置一个流服务流池。然后在流池中创建一个流。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ln"><img src="../Images/360b1a09e220d624e1261030826e5f6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HF4rassylUa67VznRSaTqA.png"/></div></div></figure><p id="3661" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从OSaK的角度来看，流实际上是3分区的卡夫卡主题。</p><p id="f493" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤2:在控制台上进入身份-&gt;用户，创建一个新用户。</p><p id="3367" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤3:用户需要通过流服务认证自己(使用Kafka APIs)。为此，单击您刚刚创建的用户并生成auth-token。OSaK需要用户名和认证令牌来使用Kafka消费者API访问流服务。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lo"><img src="../Images/c5f15ab1170291f9f4fcafa9cd69d55c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QICLlv7fvvVSasz339lo0A.png"/></div></div></figure><p id="6cd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦生成，这是您唯一可以查看或复制身份验证令牌的时间。请复制它，因为我们为OSaK配置Kafka集群时会用到它。</p><p id="fe63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤4:创建一个用户组。将您的用户添加到组中。在OCI，用户在分配给他们所属用户组的策略的帮助下获得特权。因此，为用户组创建一个策略，以便该组中的所有用户都获得访问流服务集群的权限。</p><p id="649f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，当您打开群组时，您可以看到其中的用户。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lp"><img src="../Images/5d0c7ccce80187b6aa1ea14b6c1c3308.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k936fQ8yrWkcneuGx35dyg.png"/></div></div></figure><p id="80f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加以下策略。您可以输入自己的组和隔离专区名称。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lq"><img src="../Images/ebb2c77f4a852dd500d2624cc94a23eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cuYq22BXadzg-luqvG3-LQ.png"/></div></div></figure><p id="582b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤5:现在我们开始在Oracle数据库主机上安装OSaK。</p><p id="00e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下载最新版本的Oracle SQL developer。OSaK套件随其提供。Oracle SQL对Kafka kit的访问位于orakafka.zip文件中。</p><p id="8962" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤6: SSH进入Oracle数据库节点，并将orakafka.zip移动到</p><pre class="km kn ko kp gt lr ls lt lu aw lv bi"><span id="4402" class="lw lx iq ls b gy ly lz l ma mb">/home/oracle</span></pre><p id="3f6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤7:切换到oracle数据库主机上的Oracle用户。</p><p id="f921" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">确保您当前的工作目录是/home/oracle。</p><p id="36e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">解压缩orakafka.zip文件</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mc"><img src="../Images/872d9d3ea0ef6fcb33115054c3683b99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5zmLgChDKKrjl264d_ck6g.png"/></div></div></figure><p id="3b13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第8步:在/home/oracle中创建新目录ora_kafka_home。我们将使用它作为OSaK的基本目录。安装将使用<em class="md">中的脚本<em class="md">orakafka _ distro _ install . sh</em>来完成。/orakafka-1.2.0 </em></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi me"><img src="../Images/b677af7e03376f4f9a0a9544fcf1b94b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LvmWNEzXJriw8qeSaRO4sA.png"/></div></div></figure><p id="9b82" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，您会收到一条消息，确认orakafka kit已成功安装。</p><p id="f7fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤9:为OSaK配置JAVA_HOME</p><p id="2f47" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要查找java路径，请运行命令:</p><pre class="km kn ko kp gt lr ls lt lu aw lv bi"><span id="1f8b" class="lw lx iq ls b gy ly lz l ma mb">java -XshowSettings:properties -version 2&gt;&amp;1 &gt; /dev/null | grep ‘java.home’</span></pre><p id="9785" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将给出您在下一个命令中输入的路径</p><pre class="km kn ko kp gt lr ls lt lu aw lv bi"><span id="aa6e" class="lw lx iq ls b gy ly lz l ma mb">export JAVA_HOME=&lt;Enter path here&gt;</span></pre><p id="706d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到目录:/home/Oracle/ora _ Kafka _ home/ora Kafka/bin</p><p id="5e04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后设置</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mf"><img src="../Images/a195005dd767c69efa866fa080c4f92f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eCFw2ZEm13VZ7dBdKWEDtg.png"/></div></div></figure><p id="ba3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，您会收到一条消息，确认JAVA_HOME已成功配置。</p><p id="0e0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以通过运行命令来验证安装:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mg"><img src="../Images/0be67bdffcdc50d52936b4eb571e6045.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*CIkavdjhxi7-mc8P1pEEtQ.png"/></div></div></figure><p id="8ca6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将产生:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mh"><img src="../Images/bee9fc49f0c4567c1d138db414e8c20d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m9tMTw2WW0ZJdQSlIZWJsA.png"/></div></div></figure><p id="cdf2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤10:将我们之前设置的流服务流池添加到OSaK。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mi"><img src="../Images/11ca1aba8bc6f4857554d9aea19a5eec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vmBFvj19UgZZSNCDkX88Xw.png"/></div></div></figure><p id="d18d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，kc1是集群的名称。您可以随意命名集群。</p><p id="98e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤11:将流服务流的安全属性添加到/home/Oracle/ora _ Kafka _ home/app _ data/clusters/KC1/conf/ora Kafka . properties</p><p id="9b2f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在之前设置的流池下的“Kafka连接设置”中获得这些属性。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mj"><img src="../Images/f25856296439f2ac7ca1044ad273fc77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hgFzshTSeAqW0mEtqofHmQ.png"/></div></div></figure><p id="81c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在配置文件中取消对这些特定字段的注释，并填写Kafka连接设置中的值:</p><pre class="km kn ko kp gt lr ls lt lu aw lv bi"><span id="97b1" class="lw lx iq ls b gy ly lz l ma mb">security.protocol=SASL_SSL</span><span id="8ef1" class="lw lx iq ls b gy mk lz l ma mb">sasl.mechanism=PLAIN</span><span id="a433" class="lw lx iq ls b gy mk lz l ma mb">sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username=”&lt;YOUR_TENANCY_NAME&gt;/&lt;YOUR_OCI_USERID_HERE&gt;/&lt;YOUR_OCI_STREAMPOOL_OCID&gt;” password=” YOUR_AUTH_TOKEN”;</span><span id="197d" class="lw lx iq ls b gy mk lz l ma mb">sasl.plain.username=”&lt;YOUR_TENANCY_NAME&gt;/&lt;YOUR_OCI_USERID_HERE&gt;/&lt;YOUR_OCI_STREAMPOOL_OCID&gt;”</span><span id="ef61" class="lw lx iq ls b gy mk lz l ma mb">sasl.plain.password =”YOUR_AUTH_TOKEN”;</span></pre><p id="9287" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第12步:以sysdba身份登录SQL，将容器设置为您的PDB并运行</p><pre class="km kn ko kp gt lr ls lt lu aw lv bi"><span id="be59" class="lw lx iq ls b gy ly lz l ma mb">@/home/oracle/ora_kafka_home/app_data/scratch/orakafka_create_KC1_CONF_DIR.sql</span></pre><p id="6da6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将创建目录KC1 _ CONF _目录。</p><p id="eec9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤13:验证您的Kafka集群正在工作。转到/home/Oracle/ora _ Kafka _ home/ora Kafka/bin并运行此命令。您使用-c参数传递集群名称，使用-b参数传递引导服务器。</p><pre class="km kn ko kp gt lr ls lt lu aw lv bi"><span id="0510" class="lw lx iq ls b gy ly lz l ma mb">./orakafka.sh test_cluster -c kc1 -b &lt;Enter bootstrap server here&gt;</span></pre><p id="3665" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该得到您的主题列表以及它们的分区作为输出。</p><p id="55d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤14:为Kafka集群配置一个Oracle数据库用户。</p><p id="4219" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您没有现有用户，则需要在PDB级别创建一个。然后在/home/Oracle/ora _ Kafka _ home/ora Kafka/bin中运行:</p><pre class="km kn ko kp gt lr ls lt lu aw lv bi"><span id="13db" class="lw lx iq ls b gy ly lz l ma mb">./orakafka.sh adduser_cluster -c kc1 -u &lt;Enter username here&gt;</span></pre><p id="b634" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以sysdba身份登录SQL，并将容器设置为您的PDB。然后运行:</p><pre class="km kn ko kp gt lr ls lt lu aw lv bi"><span id="0913" class="lw lx iq ls b gy ly lz l ma mb">@/home/oracle/ora_kafka_home/app_data/scratch/orakafka_adduser_cluster_KC1_user1.sql</span></pre><p id="5b86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将授予您的用户对KC1 _ CONF _目录的权限。</p><p id="8e0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤15:为这个用户的数据传递父目录，这些数据与他被添加到的Kafka集群上的OSaK活动相关。</p><p id="43b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在/home/Oracle/ora _ Kafka _ home/ora Kafka/bin中，运行:</p><pre class="km kn ko kp gt lr ls lt lu aw lv bi"><span id="c0e2" class="lw lx iq ls b gy ly lz l ma mb">./orakafka.sh install -u &lt;Enter username&gt; -r /home/oracle/ora_kafka_home/&lt;Username&gt;_user_data_dir</span></pre><p id="5869" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将生成2个包含SQL命令的todo任务，首先您需要以sysdba身份运行(在您的PDB中)</p><pre class="km kn ko kp gt lr ls lt lu aw lv bi"><span id="6348" class="lw lx iq ls b gy ly lz l ma mb">@/home/oracle/ora_kafka_home/app_data/scratch/setup_db_dirs_user1.sql</span></pre><p id="71ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将创建目录对象<username> _KAFKA_LOC_DIR和<username> _KAFKA_DEF_DIR。</username></username></p><p id="3981" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二个todo任务将作为您在PDB的用户运行。这将在您的用户模式中安装OSaK及其对象。</p><pre class="km kn ko kp gt lr ls lt lu aw lv bi"><span id="3e34" class="lw lx iq ls b gy ly lz l ma mb">@/home/oracle/ora_kafka_home/app_data/scratch/install_orakafka_user1.sql</span></pre><p id="1aff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该输出将确认一切设置成功:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ml"><img src="../Images/f0f532cb48f38a331c2927dfcd41cf05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*suRnQWb58Q3-WPgvt0KRJg.png"/></div></div></figure><p id="bf61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤16:在PDB中的用户下，用OSaK过程ORA_KAFKA注册集群。寄存器_集群</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mm"><img src="../Images/abcd09c98c107cdd06eaee495612c1bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yYivZA_Hil2PuHrLzl2qZQ.png"/></div></div></figure><p id="6072" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤17:创建oracle数据库表——它需要与我们Kafka主题中的消息具有相同的模式。如果您的邮件是CSV格式，则这一步是必需的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mn"><img src="../Images/ae5d9b88dc6e1a8ee4bc7b59c8b83a9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uToShxxxyg3lwqtcHuERKw.png"/></div></div></figure><p id="e55e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤18:为Kafka主题创建视图</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/265973a936f6c0f5a8b8225ee4f5d326.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*nJCgCkycZazadX3aQZ90WQ.png"/></div></figure><p id="cc3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于我设置了3个分区，我看到了以KV_ <cluster_name> _ <group_name> _TOPIC_ <num_of_partition>格式创建的三个视图:</num_of_partition></group_name></cluster_name></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/4d9cd4a4a67ebf468bd35cf6312d7f86.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/1*CQwVe1A_ZYfM568UYfhBfg.png"/></div></figure><p id="865f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤19:产生数据流</p><p id="0ac4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在web控制台上，转到您的流并单击生成测试消息</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mq"><img src="../Images/f8fad389598d061912d7c4bad5b2687b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RzECkibnEukEbEPDdMvETA.png"/></div></div></figure><p id="45d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以您设置的模式形式输入csv，然后单击“生成”</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mr"><img src="../Images/5cf57c8db6c45ea8d3065e0ef813bad0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*31KQnIZUpoTRLhW8cotGlA.png"/></div></div></figure><p id="e89b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单击load message，您将看到消息被加载到哪个分区</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ms"><img src="../Images/65819e4881b722f9a4825b5d44e6c8d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yXYcxUnZP9KDYS-Cx5CC6g.png"/></div></div></figure><p id="05fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以看到这是在分区0。转到SQL dev并打开分区0的视图。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mt"><img src="../Images/186ffa234b6fd331322034d5fc4dd032.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ElctxbWwmNfW1cDdX-XlhQ.png"/></div></div></figure><p id="2842" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还可以使用Java/Python或OCI SDK中的标准Kafka Producer API进行流服务，以向流服务流生成消息</p><p id="e369" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每条消息在视图中都有自己的一行，但数据不会持久化。</p><p id="9c6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">OSaK获取并存储元数据信息，如消息的偏移量、它的分区以及附加列中的时间戳。</p><p id="5980" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">OSaK也支持JSON格式。如果要输入JSON格式的数据，就不需要引用表了。在这种情况下，您可以使用这种格式为Kafka主题创建视图:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/34c9c3414f1afaa50e946252ab1af4f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*imZzFjbmraYq_Rkpr9wdJA.png"/></div></figure><p id="9795" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出将以键、值:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mv"><img src="../Images/aacb7afd8a0efbb70e044e9ffb62f397.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z4hgdtxKX_k920UzqF8OKA.png"/></div></div></figure><p id="ac9a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该值将只存储整个输入—在该输入的情况下是json blob。</p><p id="31ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇博客介绍了OSaK的设置和从数据流中读取数据。在下一篇文章中，我将探索更多关于使用Python生成OCI流和创建实时分析仪表板的内容。</p><p id="6b8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">快乐流媒体！</p></div></div>    
</body>
</html>