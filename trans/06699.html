<html>
<head>
<title>Kubeflow (is not) for Dummies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubeflow(不是)为假人设计的</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/kubeflow-is-not-for-dummies-414d8977158a?source=collection_archive---------15-----------------------#2021-06-16">https://towardsdatascience.com/kubeflow-is-not-for-dummies-414d8977158a?source=collection_archive---------15-----------------------#2021-06-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9cbb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在EKS部署和摧毁Kubeflow只需一个脚本，不费吹灰之力</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cb9426f772e7799bd367b1872d525c4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Oa3TMtVXPbUiLPAR.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图一。Kubeflow仪表板(来源:<a class="ae kv" href="https://www.kubeflow.org/docs/components/central-dash/overview/" rel="noopener ugc nofollow" target="_blank"> Kubeflow文档</a></p></figure><p id="20cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">工具、库、框架的创建是为了让我们的工作更容易。它们引入了新的功能，简化了代码，减少了样板文件，实现了自动化。</p><p id="c1f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">想象一下你的项目没有依赖关系，想象一下你需要用你自己的代码来替换一个函数调用(例如<em class="ls"> yaml.safe_load </em>)。所有这些工具都使应用程序更容易构建、维护、开发和部署。但是如果这些工具本身很难部署呢？哎哟。</p><h1 id="c585" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">Kubeflow简介</h1><p id="9983" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我不会说谎——在我写完工具很难部署之后，我马上介绍了Kubeflow，这不是巧合。女士们，先生们，来认识一下Kubeflow — <strong class="ky ir">这是我多年来使用过的最流行也是最烦人的工具之一</strong> (CMake，兄弟，我永远不会忘记你)。</p><p id="bdbc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://www.kubeflow.org/" rel="noopener ugc nofollow" target="_blank"> Kubeflow </a>是最近ML和MLOps领域最热门的东西之一，大约有<a class="ae kv" href="https://github.com/kubeflow/" rel="noopener ugc nofollow" target="_blank"> 30个积极开发的存储库</a>，拥有来自GitHub用户的近20，000颗星。<em class="ls">“Kubernetes的机器学习工具包”</em>是否让你认为这是可能的，并做了几乎所有的事情？好吧，那你说得很对。Kubeflow有几个关键组件:</p><ul class=""><li id="2ab9" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">使用YAML模板或SDK创建管道，使用GUI(图2)可视化管道执行及其结果，</li><li id="ab74" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">Jupyter笔记本服务器，</li><li id="a4ae" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">katib——超参数优化或神经结构搜索，</li><li id="8b27" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">藏物店，</li><li id="455d" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">Dashboard(图1) web应用程序管理所有这些以及更多内容。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/959d549cc8b4642a02ae201edc705c3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cXlJ1yC06lLhmQ_x.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图二。Kubeflow管道(来源:<a class="ae kv" href="https://www.kubeflow.org/docs/components/pipelines/pipelines-quickstart/" rel="noopener ugc nofollow" target="_blank">管道快速启动</a>)</p></figure><p id="23d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最重要的是，Kubeflow运行在Kubernetes之上。因此，如果我们谈到Kubeflow Jupyter笔记本电脑，这些笔记本电脑运行在可扩展的Kubernetes集群中。Pipelines和Katib也是。与目前可用和使用的其他工具相比，这提供了一个巨大的优势。如果你需要大规模训练和管理ML模型，当然可以。</p><p id="d28e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用例的官方列表可以在<a class="ae kv" href="https://www.kubeflow.org/docs/about/use-cases/" rel="noopener ugc nofollow" target="_blank"> Kubeflow文档</a>中找到。</p><h1 id="a172" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">Kubeflow(不是)为假人设计的</h1><p id="38f7" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">与其他ML工程工具不同，例如<a class="ae kv" href="https://mlflow.org/" rel="noopener ugc nofollow" target="_blank"> MLFlow </a>或<a class="ae kv" href="https://dvc.org/" rel="noopener ugc nofollow" target="_blank"> DVC </a>，安装Kubeflow并不容易，而且<em class="ls"> pip install </em>也不够。差远了。首先，您需要一个将部署KF的Kubernetes集群。这是你在项目中尝试Kubeflow的第一个障碍。</p><p id="2bdf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它既可以部署在本地集群中，也可以部署在云中。当然，在本地部署它有它的缺点(例如，资源有限)，但也可以便宜得多。在云中设置Kubeflow的成本会很高，尤其是如果有些事情不太对劲，并且您需要重复部署几次。</p><p id="b0f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">去过那里。我进行了几次尝试，最终在AWS云上设置了Kubeflow(将其部署在亚马逊EKS集群中)。<strong class="ky ir">试了几次，后来发现大约70美元。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/585d43026c9685141c187109aaa2a6a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/0*ukgzcXFXavEkug3V.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图3。图片由Ariel Biller ( <a class="ae kv" href="https://twitter.com/lstmeow" rel="noopener ugc nofollow" target="_blank"> @LSTMeow </a>)提供</p></figure><p id="7a38" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，在阅读了其他人像我一样努力部署Kubeflow后，我决定提出一个解决方案，让我在下次部署KF时能够最大限度地减少错误和工作量。我还希望清理环境像设置环境一样快速简单。</p><p id="07b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我做到了，现在让我来展示一下。</p><h1 id="a485" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">亚马逊EKS +地形</h1><p id="02e1" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">尽管亚马逊EKS集群可以使用AWS控制台在几分钟内完成<strong class="ky ir"> </strong>配置，但我决定选择另一种方式来完成，这样我就可以对自己创建(和删除)的资源有更多的控制。</p><p id="425c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">遵循<a class="ae kv" href="https://en.wikipedia.org/wiki/Infrastructure_as_code" rel="noopener ugc nofollow" target="_blank">基础设施即代码</a>的方法，我使用<a class="ae kv" href="https://www.terraform.io/" rel="noopener ugc nofollow" target="_blank"> Terraform </a>从零开始建立整个EKS集群，包括EC2实例、VPC和其他必要的资源。由于这一点，我写了一次Terraform脚本，我就能够<strong class="ky ir">建立基础设施，然后只用一个命令</strong>就可以拆除它，我非常确定所有的资源都会被很好地清理。这样我周末不自觉留下的EC2就不会被收费了。</p><p id="f5e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不仅如此，IaaC还让我有可能在我的<a class="ae kv" href="https://github.com/mtszkw/kubeflow-deploy" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>中存储版本控制下的构建指令。我可以跟踪和恢复对基础设施所做的任何更改，如果我只是不停地点击亚马逊控制台UI中的按钮，这几乎是不可能的。</p><h1 id="df13" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">在EKS集群中部署Kubeflow</h1><p id="224a" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">一旦配置了EKS集群，Kubeflow就可以最终部署到其中了。这可以使用shell从头到尾地完成，但是我需要做一些微小的改变来使它工作(例如，替换YAML文件中的区域或集群名，特别感谢<em class="ls"> sed </em>)。</p><p id="e4b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你只是想拥有你的小游乐场(并且你不在乎隐私和良好的基础设施设计)，没有太多的变化要介绍。所有调整都保存在回购协议中我的<a class="ae kv" href="https://github.com/mtszkw/kubeflow-deploy/blob/main/aws-terraform/deploy_kubeflow.sh" rel="noopener ugc nofollow" target="_blank"> delpoy_kubeflow </a>脚本中。</p><p id="ec7c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，可以使用脚本中的<a class="ae kv" href="https://github.com/kubeflow/kfctl" rel="noopener ugc nofollow" target="_blank"> kfctl </a> CLI工具部署Kubeflow。这需要几分钟时间，希望能顺利完成。当所有窗格和服务准备就绪时，您应该可以使用仪表板UI了。</p><p id="00c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">类型</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="09be" class="nk lu iq ng b gy nl nm l nn no">kubectl get service istio-ingressgateway -n istio-system</span></pre><p id="43df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">去看看哪里。当使用我的脚本进行部署时，Dashboard在本地主机(使用节点端口)上对我可用，并且不需要负载平衡器服务。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/3764ba177a4d21bb3630849ea9b60261.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/0*UxUWOD8PqChOwEmW.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图4。图片由Ariel Biller ( <a class="ae kv" href="https://twitter.com/lstmeow" rel="noopener ugc nofollow" target="_blank"> @LSTMeow </a>)提供</p></figure><h1 id="636b" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">一下子:deploy_kubeflow.sh</h1><p id="db6e" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">如果你想在EKS上享受Kubeflow组件的乐趣，并想跟随我的脚步，只需简单地<a class="ae kv" href="https://github.com/mtszkw/kubeflow-deploy/tree/main/aws-terraform" rel="noopener ugc nofollow" target="_blank">克隆这个repo </a>并查看README文件中的说明。</p><p id="ff56" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">先决条件:使用管理员权限配置AWS CLI和配置文件。</p><p id="0606" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所有需要的变量必须在<em class="ls"> set_env_variables </em>脚本中设置。然后就可以开始了，只需要执行deploy_kubeflow.sh。所需依赖项和操作的完整列表在README中。</p><h1 id="9767" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">笔记</h1><ul class=""><li id="f72e" class="mq mr iq ky b kz ml lc mm lf nq lj nr ln ns lr mv mw mx my bi translated">我想保持它的简单性，并且只在我的私人目的上使用Kubeflow，所以我不关心IAM或认证。我<strong class="ky ir">不会在任何真实的项目中使用这些代码</strong>但是我认为这可能是一个很好的基础，</li><li id="cfc3" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">创建EKS集群和在AWS上部署Kubeflow还有其他方法，根据您的需求，您可以使用<a class="ae kv" href="https://github.com/mtszkw/kubeflow-deploy/tree/main/aws-cloudshell" rel="noopener ugc nofollow" target="_blank"> CloudShell </a>、eksctl或其他工具。</li><li id="f110" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated"><strong class="ky ir">如果你预算有限，就在本地玩KF</strong>:这里是<a class="ae kv" href="https://github.com/mtszkw/kubeflow-deploy/tree/main/minikube" rel="noopener ugc nofollow" target="_blank">我对WSL </a>的说明，这里是我的同事<a class="ae kv" href="https://github.com/pyxelr" rel="noopener ugc nofollow" target="_blank">pawei</a>为Windows 写的类似的<a class="ae kv" href="https://github.com/pyxelr/kubeflow-deploy-on-windows" rel="noopener ugc nofollow" target="_blank">教程，</a></li><li id="8b2d" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">整个KF部署是<strong class="ky ir">相当大并且相当昂贵</strong>(我不得不使用两个m5.xlarge实例来处理它，我在更便宜的机器上没有成功)，</li><li id="c35e" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">如果你只需要Kubeflow管道，<a class="ae kv" href="https://www.kubeflow.org/docs/components/pipelines/installation/standalone-deployment/" rel="noopener ugc nofollow" target="_blank">你可以拥有它</a>。Pipelines只是整个KF系统的一小部分，因此如果使用独立部署，可以使用更便宜的实例，</li><li id="c513" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">我知道我在这篇文章中用了太多次Kubeflow这个词，抱歉。</li></ul></div></div>    
</body>
</html>