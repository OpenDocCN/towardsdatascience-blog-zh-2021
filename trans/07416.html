<html>
<head>
<title>Working with Times and Dates in BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在BigQuery中使用时间和日期</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/working-with-times-and-dates-in-bigquery-f131af140fc2?source=collection_archive---------17-----------------------#2021-07-06">https://towardsdatascience.com/working-with-times-and-dates-in-bigquery-f131af140fc2?source=collection_archive---------17-----------------------#2021-07-06</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="4dcd" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">你必须知道的</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/e30ff4306545ced73aa440dc1ce85773.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1kgsaeP-kq3KNnhi7_d4uw.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><a class="ae kz" href="https://unsplash.com/@voyas?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">团队voyas </a>在<a class="ae kz" href="https://unsplash.com/s/photos/time?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="8860" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">谁不熟悉这种情况？正确的时间戳格式是什么来着？只要谷歌一下，下次它就会再次结束。这里是一些我经常接触到的用例，我想把它们写下来，希望不用再去谷歌它们。</p><h2 id="f998" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">当前日期时间</h2><p id="4d48" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">让我们从一个非常简单但是有用的开始。获取当前时间—您可能需要它来进行比较，例如在分析或技术数据转换中:</p><pre class="kk kl km kn gu mu mv mw mx aw my bi"><span id="de90" class="lw lx iu mv b gz mz na l nb nc">SELECT CURRENT_DATETIME() as now;</span></pre><p id="413a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这个函数支持可选的timezone参数。关于如何设置时区[1]的说明，参见时区<a class="ae kz" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/datetime_functions?hl=de" rel="noopener ugc nofollow" target="_blank">定义</a>。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nd"><img src="../Images/33fc144ec11663974f7947d4bb91d55e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tBrfZE39UCMw8jQmVqp8tw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">当前日期示例—按作者分类的图像</p></figure><h2 id="9eef" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">提取</h2><p id="75a4" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">从提供的<em class="ne"> datetime_expression </em>中返回对应于指定部分的值。例如，这里我只提取了年份。我经常将这种逻辑用于分析中的约束或数据转换，在这种情况下，我转换日期格式并将它们以不同的格式存储在新表中。</p><pre class="kk kl km kn gu mu mv mw mx aw my bi"><span id="0151" class="lw lx iu mv b gz mz na l nb nc">SELECT EXTRACT(YEAR FROM DATETIME(2021, 07, 02, 15, 45, 00)) as year;</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nf"><img src="../Images/a6e0c38071fb46eacc89c6a1959b89d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zhB9yTC5xUCTkzdQ6KWxjw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">结果—作者提供的图像</p></figure><h2 id="4183" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">日期时间差异</h2><p id="9a5d" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">计算两个日期之间的差异。如果第一个<em class="ne">日期时间</em>在第二个日期时间之前，则输出为负[1]。</p><pre class="kk kl km kn gu mu mv mw mx aw my bi"><span id="e5f2" class="lw lx iu mv b gz mz na l nb nc">Select DATETIME_DIFF(DATETIME”2021–03–03", DATETIME”2021–04–04", Day)as difference;</span></pre><p id="5cc8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这导致-32。</p><h2 id="d6e7" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">格式化日期时间</h2><p id="1733" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">根据指定的<em class="ne"> format_string </em>格式化<em class="ne"> DATETIME </em>对象。与其他示例类似，人们喜欢在数据转换过程中使用这种格式化选项。</p><pre class="kk kl km kn gu mu mv mw mx aw my bi"><span id="94a6" class="lw lx iu mv b gz mz na l nb nc">SELECT<br/> FORMAT_DATETIME(“%c”, DATETIME “2008–12–25 15:30:00”)<br/> AS formatted;</span></pre><p id="3c74" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这里，以%c为例，输出完整的日期和时间表示[2]。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nf"><img src="../Images/eee438c3a4349aa9b73291ccb57a008f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8wdZZUvKVdj1FUkbMCCgtA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">格式化日期时间-按作者排序的图像</p></figure><h2 id="59fe" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">解析日期时间</h2><p id="6e54" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">使用<em class="ne"> PARSE_DATETIME </em>你可以做与上面提到的例子相反的事情。它将一个<em class="ne">日期时间</em>对象的字符串表示转换成一个<em class="ne">日期时间</em>对象。</p><pre class="kk kl km kn gu mu mv mw mx aw my bi"><span id="4426" class="lw lx iu mv b gz mz na l nb nc">SELECT PARSE_DATETIME(‘%Y-%m-%d %H:%M:%S’, ‘2021–03–03 13:55:55’) AS datetime;</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj ng"><img src="../Images/bd39ffdb8785074bf59a54afd88928b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*LONS-p0go62l-QrHrekW8Q.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">解析的日期时间-按作者排序的图像</p></figure><p id="3efd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">例如，当其他数据源将日期显示为字符串并且您希望在BigQuery中将它显示为标准化的<em class="ne">日期时间</em>时，这总是有用的。</p><h2 id="b048" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">最后审判日</h2><p id="5448" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">从包含日期的<em class="ne"> DATETIME </em>表达式中返回最后一天。这通常用于返回一个月的最后一天。您可以选择指定应该返回最后一天的日期部分。</p><pre class="kk kl km kn gu mu mv mw mx aw my bi"><span id="3f36" class="lw lx iu mv b gz mz na l nb nc">SELECT LAST_DAY(DATETIME ‘2008–11–25’, MONTH) AS last_day</span></pre><p id="d6c2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果不使用该参数，默认值为<em class="ne">月</em>。特别是在评估领域，例如有趣且经常使用的财务月报表。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nf"><img src="../Images/54f585810c4b65cb803db98a24e2204a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G6soNrd7JWdhgC59h9Gi3g.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">结果—作者提供的图像</p></figure><h2 id="4f62" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">摘要</h2><p id="cfee" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">由于我经常在BigQuery中搜索日期格式，因为我忘记了正确的SQL表达式是什么，所以我为您提供了关于这个主题的备忘单。在我看来，这些是最常见的用例——如果我忘记了什么，请随时告诉我。</p><h2 id="7303" class="lw lx iu bd ly lz ma dn mb mc md dp me lj mf mg mh ln mi mj mk lr ml mm mn mo bi translated">资料来源和进一步阅读</h2><p id="0745" class="pw-post-body-paragraph la lb iu lc b ld mp jv lf lg mq jy li lj mr ll lm ln ms lp lq lr mt lt lu lv in bi translated">[1]<a class="ae kz" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/datetime_functions?hl=de" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/big query/docs/reference/standard-SQL/datetime _ functions？hl=de </a></p><p id="d5c2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">[2]<a class="ae kz" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/datetime_functions?hl=de#supported_format_elements_for_datetime" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/big query/docs/reference/standard-SQL/datetime _ functions？HL = de # supported _ format _ elements _ for _ datetime</a></p></div></div>    
</body>
</html>