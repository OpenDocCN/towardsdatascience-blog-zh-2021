<html>
<head>
<title>Partial correlation-the idea and significance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">偏相关——概念和意义</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/partial-correlation-508353cd8b5?source=collection_archive---------3-----------------------#2021-08-14">https://towardsdatascience.com/partial-correlation-508353cd8b5?source=collection_archive---------3-----------------------#2021-08-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4f72" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">两个变量之间的相关性可靠吗？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f4e35b6e77c3ba4a0cacf1fc36529042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SP2UAUALquEi45iPBQPjxw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://www.pexels.com/cs-cz/foto/jidlo-kava-salek-zlomeny-7981894/" rel="noopener ugc nofollow" target="_blank">像素</a>的图像</p></figure><p id="a3f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，多元线性回归是关于量化一个因变量和几个自变量之间的线性关系。通过这个模型，我们可以发现一个变量如何受其他变量的影响，例如，收入如何受教育程度、地区、年龄、性别等的影响。然而，我们需要问，模型显示的关系是可靠的，还是<a class="ae ky" href="https://www.tylervigen.com/spurious-correlations" rel="noopener ugc nofollow" target="_blank">乱真的</a>？</p><p id="70f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一个介绍性的例子，为了说明检验<strong class="lb iu">偏相关</strong>的重要性，我们尝试建立一个收入的多元线性回归模型。数据集<a class="ae ky" href="https://www.rdocumentation.org/packages/modelr/versions/0.1.8/topics/heights" rel="noopener ugc nofollow" target="_blank">内置于R </a>中，来源于<a class="ae ky" href="https://www.nlsinfo.org/" rel="noopener ugc nofollow" target="_blank">国家纵向研究</a>。</p><p id="17c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在构建多元模型之前，首先检查相关性通常是一个好的做法，这将在下一节中简要概述。我们使用相关矩阵来可视化相关性</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/a502e14bb69c4f6ff4c5f3151f0a1e76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*j_c7taodLamZpWux53CLOg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图0.1相关矩阵。(图片由作者提供)</p></figure><p id="be93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从图0.1我们可以看出，收入与身高、体重、教育程度和afdp(武装部队资格测试百分位分数)正相关。<strong class="lb iu">负面</strong>受婚姻(婚姻状态用数字表示如下:单身:1，已婚:2，分居:3，离婚:4，丧偶:5)，性别(男性用1表示，女性用2。这种负相关意味着女性挣得少一点)。数据在某种程度上证实了我们已经知道的，有一件事很可疑，那就是高个子挣得更多。其实这个相关性是乱真的，后面我们会用偏相关来验证和解释为什么会这样。</p><h1 id="35bf" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">快速捕捉相关性</h1><p id="82fd" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">相关性描述了两个变量之间的关系，即其中一个变量的增长(减少)会导致另一个变量的增长(减少)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/9f2a25fcd43cf7416828d7a84fde5cb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*JWlS_3ddNuk_-L6QZz0Cpg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1.1相关性示意图。(图片由作者提供)</p></figure><p id="d11a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有几种方法可以衡量两个变量之间的相关性。在本文中，我们使用皮尔逊相关系数(<strong class="lb iu"> PCC </strong>)，也称为<strong class="lb iu"> Person's r </strong>，因为它也在稍后的偏相关公式中使用。另一个参数，Spearman的rho，经常在R中实现，事实上，也使用人的R，只是在等级系数之上<em class="lw">。人的休息公式由下式给出</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/f5da8faf8b5823629da8ae8458af70b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:538/format:webp/1*QolMqdZXLPkopwXaK5AcOA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">人的r</p></figure><p id="24ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中，σₓ是x的标准差，σᵧ是y的标准差，cov(X，y)表示协方差，其定义为<em class="lw">两个随机变量x和y与其均值</em>的偏差乘积的期望值，即</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/d6bba68b191ca88615b913a6e0872d2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*UIMCwAc8pHwZ-DCra1qL2A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">协方差</p></figure><p id="2275" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相关性<a class="ae ky" href="https://selipot.github.io/talks/lecture2.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">通过将协方差</strong> </a>除以两个变量的标准偏差来归一化协方差。与协方差不同，相关性的范围在-1和1之间。当它等于-1或1时，意味着两个变量之间的关系给定<strong class="lb iu">正好是分别具有正斜率或负斜率的线性函数</strong>。</p><h1 id="8d52" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">偏相关—去除混杂因素</h1><p id="0ac8" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">偏相关是与相关性密切相关的概念。它表明，当我们发现两个变量之间的相关性时，这并不一定意味着它们之间有因果关系。偏相关<em class="lw">以一个或几个其他变量</em>为条件，量化两个变量之间的相关性。这意味着，当两个变量之间存在相关性时，这种相关性可能部分地由第三个变量解释，即<a class="ae ky" href="https://en.wikipedia.org/wiki/Confounding" rel="noopener ugc nofollow" target="_blank">混杂变量</a>(或<em class="lw">控制变量</em>)，这是虚假相关性的常见原因。去掉这部分后，<em class="lw">剩下的</em>，就是这两个变量之间的<strong class="lb iu">偏相关</strong>。</p><p id="cbda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">几何是理解本中<a class="ae ky" href="http://www.hawaii.edu/powerkills/UC.HTM#C7" rel="noopener ugc nofollow" target="_blank">提到的偏相关的直观途径之一。将变量表示为向量，下图显示了混杂因素如何影响其他变量。在我们的例子中，混杂因素是性别，我们可以看到它与收入和身高都呈负相关。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/5b1b0eb7caca79b65aaab115cc7ec34a.png" data-original-src="https://miro.medium.com/v2/resize:fit:454/format:webp/1*YXK8W5jQfsP59Rq_JGNp0A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2.1混杂因素的影响。(图片由作者提供)</p></figure><p id="ccf7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在只有一个混杂因素的情况下(称为<em class="lw">一阶偏相关</em>)，剔除Z因素后，随机变量X和Y之间的偏相关公式为</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi my"><img src="../Images/b1d5bf02f09a41898d455345f6f3b36c.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*tJy_afYS8N41wGb6hmP86Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一阶偏相关公式</p></figure><p id="6fdb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果有多个控制变量，比如说一组n个控制变量<strong class="lb iu"> Z </strong> = {Z₁，Z₂，..，Zₙ}，那么等式2.1中的z应该替换为<strong class="lb iu"> Z </strong>，其中<strong class="lb iu"> </strong>表示一个集合。X和Y之间的偏相关的正式定义是</p><blockquote class="mz na nb"><p id="ba9e" class="kz la lw lb b lc ld ju le lf lg jx lh nc lj lk ll nd ln lo lp ne lr ls lt lu im bi translated">X与<strong class="lb iu"> Z </strong>和Y与<strong class="lb iu"> Z </strong>线性回归的残差之间的相关性。</p></blockquote><p id="5ec1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将坚持一阶偏相关。现在我们有了一个不同的工具，我们可以重温我们的介绍示例，并研究变量之间的部分相关性，如图2.3所示。这次我们可以看到身高，体重，婚姻状况被划掉了，对比图0.1中的相关矩阵。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/5d6b919c333e7bef99b987d32c199986.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*589n9i_DLDg457I5TCAT4w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2.3偏相关矩阵。(图片由作者提供)</p></figure><p id="5d07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如何计算偏相关？三种方法在<a class="ae ky" href="https://en.wikipedia.org/wiki/Partial_correlation#:~:text=edit%5D-,using%20linear%20regression,-%5Bedit" rel="noopener ugc nofollow" target="_blank">维基百科</a>上有描述:1。<strong class="lb iu">线性回归</strong>，2。<strong class="lb iu">递归公式</strong>，3。<strong class="lb iu">矩阵求逆</strong>。第一种方法，线性回归，是基于偏回归的定义，当我们计算偏相关时，它让我们了解我们在计算什么。假设我们要计算X和Y之间的偏相关，去掉Z的影响。思路是我们先计算X关于Z的线性回归，得到<strong class="lb iu">残差</strong>。为什么残？是因为这是<em class="lw">X中的部分，Z </em>没有解释。我们对Y做类似的事情。然后我们计算这两个残差之间的相关性。下图显示了“解释”的含义，它实际上是线性回归中定义的一个术语</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/13537aaf0d131f0ba5abcffb3ff1919d.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/1*hIYwNNsfCjcFO4q0VzitWw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2.2线性回归模型中的SSE、SST和SSR(图片由作者提供)</p></figure><p id="c4e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">形式推导。有一个很重要的事实值得强调:<strong class="lb iu">(偏)相关与线性回归</strong>密切相关。</p><p id="e6df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以用下面几行代码，尝试用回归来计算身高和收入的偏相关。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="a596" class="nm ly it ni b gy nn no l np nq">m.i &lt;- lm(income ~ sex, data = dataH)<br/>m.s&lt;- lm(height ~ sex, data = dataH)<br/>v.i &lt;- summary(m.i)<br/>v.s &lt;- summary(m.s)<br/>cor(v.i$residuals, v.s$residuals, method="pearson")</span></pre><p id="ee88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用线性回归的结果是0.094。但是<code class="fe nr ns nt ni b">pcor</code>的输出告诉我们，身高和收入的偏相关是0.017。为什么会这样呢？这是因为<code class="fe nr ns nt ni b">pcor</code>在<strong class="lb iu">的影响下计算了每对变量之间的偏相关，所有其他</strong>变量都被移除(<a class="ae ky" href="https://www.rdocumentation.org/packages/ppcor/versions/1.1/topics/pcor" rel="noopener ugc nofollow" target="_blank">使用摩尔-彭罗斯广义矩阵求逆</a>)。如果我们只取数据的子集(只有列<code class="fe nr ns nt ni b">income</code>、<code class="fe nr ns nt ni b">height</code>和<code class="fe nr ns nt ni b">sex</code>)，输出将是相同的0.094。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">分析介绍示例的完整代码</p></figure><p id="64be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了帮助我们识别多元线性回归中两个因素之间的真正相关性，偏相关在更复杂的模型中也非常有用。自回归-移动平均(AMRA)模型可以作为这样的例子，其中偏相关，更准确地说是偏自相关，在<a class="ae ky" href="https://en.wikipedia.org/wiki/Hyperparameter_(machine_learning)" rel="noopener ugc nofollow" target="_blank">超参数</a>选择中起着重要作用。</p><h1 id="d5e9" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">摘要</h1><p id="3fa6" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">题目以一个介绍性的例子开始，这个例子让我们看到，有时候相关性不一定要表示因果关系。然后我们介绍这种现象的一个常见原因——<strong class="lb iu">混杂因素</strong>，以及解决这一问题的方法——检验<strong class="lb iu">偏相关</strong>。还介绍了计算偏相关的方法，并给出了用线性回归计算R中偏相关的实现。</p></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><h2 id="772f" class="nm ly it bd lz od oe dn md of og dp mh li oh oi mj lm oj ok ml lq ol om mn on bi translated"><strong class="ak">资源</strong></h2><p id="63c5" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">[1]Everitt，B. S .，&amp; Skrondal，a .剑桥统计词典(2010年)。</p><p id="d73e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[2]Kenett，D. Y .，黄，x .，Vodenska，I .，Havlin，s .，&amp; Stanley，H. E. <a class="ae ky" href="https://www.tandfonline.com/doi/full/10.1080/14697688.2014.946660" rel="noopener ugc nofollow" target="_blank">偏相关分析:金融市场应用</a> (2015)。<em class="lw">量化金融</em>，<em class="lw"> 15 </em> (4)，569–578。</p></div></div>    
</body>
</html>