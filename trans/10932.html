<html>
<head>
<title>3 Examples For Using Python Pandas More Efficiently</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">更有效地使用Python熊猫的3个例子</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-examples-for-using-python-pandas-more-efficiently-8173873c0bc6?source=collection_archive---------13-----------------------#2021-10-24">https://towardsdatascience.com/3-examples-for-using-python-pandas-more-efficiently-8173873c0bc6?source=collection_archive---------13-----------------------#2021-10-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4bcc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">学习新工具的最好方法是通过实践。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d869b2db5cc7df4da45972e9e56e60cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SqYTrCCeV830G0_lcc7dDg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">布雷特·乔丹在<a class="ae ky" href="https://unsplash.com/s/photos/practice?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="dbe1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas是数据科学生态系统中使用最广泛的Python库之一。它有许多功能和方法来执行有效和快速的数据分析和操作。</p><p id="babb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将通过3个例子来展示如何用熊猫做一些特定的操作。</p><p id="e0d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">练习的首要要求是数据。我准备了一个销售数据集，你可以从我的GitHub页面上的这个<a class="ae ky" href="https://github.com/SonerYldrm/datasets" rel="noopener ugc nofollow" target="_blank">库</a>下载。请随意使用它并跟随它。</p><p id="8bc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从导入Pandas并把数据集读入数据框开始。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d03b" class="ma mb it lw b gy mc md l me mf">import pandas as pd</span><span id="7761" class="ma mb it lw b gy mg md l me mf">sales = pd.read_csv("sales.csv")</span><span id="4b82" class="ma mb it lw b gy mg md l me mf">sales.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/d524e4596a15c4d6a96df61b3557d6b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q4xr06sSJflpOSHnSGXinA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">销售数据框的前5行(图片由作者提供)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="53af" class="mp mb it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">示例1</h1><p id="1bd2" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">熊猫最常用的功能之一是<code class="fe nl nm nn lw b">groupby</code>。它基本上允许根据一列中的不同类别计算聚合值。</p><p id="8890" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，我们可以计算每个产品组的平均产品价格，如下所示:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="b5e6" class="ma mb it lw b gy mc md l me mf">sales.groupby("product_group", as_index=False)["price"].mean()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/44fddab44b004c20ad3694dedc4da041.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T_D17I0JLpzB9rUtIoCS1g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="4e6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有几个聚合函数可以和<code class="fe nl nm nn lw b">groupby</code>一起使用，比如<code class="fe nl nm nn lw b">min</code>、<code class="fe nl nm nn lw b">max</code>、<code class="fe nl nm nn lw b">mean</code>、<code class="fe nl nm nn lw b">count</code>等等。这里我想展示的是，我们可以用lambda函数扩展<code class="fe nl nm nn lw b">groupby</code>的功能。</p><p id="793a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据框包含每种产品的价格和成本。假设我们想找出每个产品组中产品的平均利润。一种方法是创建一个包含利润信息的列，然后对其应用<code class="fe nl nm nn lw b">mean</code>函数。如果您不喜欢创建新列，可以通过应用lambda函数来完成此操作，如下所示。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8c35" class="ma mb it lw b gy mc md l me mf">sales.groupby("product_group").apply(<br/>   lambda x: (x["price"] - x["cost"]).mean()<br/>)</span><span id="b898" class="ma mb it lw b gy mg md l me mf">product_group<br/>PG1    98.071795<br/>PG2    42.973467<br/>PG3    26.299231<br/>PG4    13.141605<br/>PG5    18.657765<br/>PG6    15.200864<br/>dtype: float64</span></pre></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="4e9c" class="mp mb it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">示例2</h1><p id="c5a1" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">数据框中的重复行可能会导致严重的问题。我们所做的分析是不正确的，因此我们需要确保数据框中没有重复的行。</p><p id="619b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们如何定义重复行取决于数据集。在我们的例子中，具有相同产品代码的两行被认为是重复的。在某些情况下，两行需要在所有列中具有相同的值才能成为重复行。</p><p id="c571" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在处理重复行时，<code class="fe nl nm nn lw b">duplicated</code>和<code class="fe nl nm nn lw b">drop_duplicates</code>函数非常方便。</p><p id="ec65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以在产品代码列中找到重复条目的数量，如下所示。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="cbbb" class="ma mb it lw b gy mc md l me mf">sales.duplicated(subset='product_code').sum()</span><span id="1cbf" class="ma mb it lw b gy mg md l me mf">47</span></pre><p id="8283" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果产品代码重复，函数<code class="fe nl nm nn lw b">duplicated</code>返回true。通过应用<code class="fe nl nm nn lw b">sum</code>函数，我们得到了重复产品代码的总数。</p><p id="9de3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们认为两行是重复的，如果它们具有相同的产品代码和产品组，那么我们将这些列作为列表传递给subset参数。</p><p id="8fde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nl nm nn lw b">drop_duplicated</code>函数从数据框中删除重复的行。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2f9f" class="ma mb it lw b gy mc md l me mf">sales_new = sales.drop_duplicates(subset="product_code", keep="first")</span><span id="849f" class="ma mb it lw b gy mg md l me mf">sales_new.duplicated(subset="product_code").sum()<br/>0</span></pre><p id="294f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nl nm nn lw b">keep</code>参数用于确定数据帧中保留哪一个重复行。</p><p id="eb3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于<code class="fe nl nm nn lw b">duplicated</code>和<code class="fe nl nm nn lw b">drop_duplicates</code>函数，如果我们想要基于所有列评估行，我们不应该使用<code class="fe nl nm nn lw b">subset</code>参数。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="5b87" class="mp mb it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">示例3</h1><p id="90f9" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我们并不总是有数字数据。它有不同的数据类型，如整数、浮点、字符串、对象、日期时间等等。为了执行高效准确的操作，使用适当的数据类型非常重要。</p><p id="eb3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有些函数和方法只适用于某些数据类型。因此，在执行任何分析之前，我们应该转换存储不正确的列的数据类型。</p><p id="434f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们有以下数据框。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/aadf0f71e4497e7e339031c736037793.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*fWmBYLpJ0vb2IFvVWlwfzg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">df(作者图片)</p></figure><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="5357" class="ma mb it lw b gy mc md l me mf">df.dtypes<br/>A      int64<br/>B    float64<br/>C    float64<br/>D     object<br/>E     object<br/>dtype: object</span></pre><p id="ae81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">列C似乎有整数，但由于NaN值，数据类型是float。类似地，列E以对象数据类型存储，但它应该是布尔型的。</p><p id="957b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用<code class="fe nl nm nn lw b">astype</code>函数分别改变每一列的数据类型。然而，还有一个更有效的选项，那就是<code class="fe nl nm nn lw b">convert_dtypes</code>功能。它将列转换为可能的最佳数据类型。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="66ff" class="ma mb it lw b gy mc md l me mf">df_new = df.convert_dtypes()</span><span id="c25d" class="ma mb it lw b gy mg md l me mf">df_new.dtypes<br/>A      Int64<br/>B    Float64<br/>C      Int64<br/>D     string<br/>E    boolean<br/>dtype: object</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/b353ff05e1e351411cb3414706c8d9ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*lDg8KicBXV6j5j1TfkCVWQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="41ce" class="mp mb it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">结论</h1><p id="eaaf" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">学习熊猫或任何其他软件工具的最好方法是通过练习。你的手越脏，你就越会利用熊猫。</p><p id="c851" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您开始处理需要更多清理和预处理的真实数据集时，您会更好地欣赏熊猫的功能和效率。</p><p id="66fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>