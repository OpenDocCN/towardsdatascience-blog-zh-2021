<html>
<head>
<title>Practical Python: How to write and deploy a monitoring and notification service within minutes. For free.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实用 Python:如何在几分钟内编写和部署监控和通知服务。免费的。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/practical-python-how-to-write-and-deploy-a-monitoring-notification-service-within-minutes-for-free-b682cffa66ef?source=collection_archive---------4-----------------------#2021-12-06">https://towardsdatascience.com/practical-python-how-to-write-and-deploy-a-monitoring-notification-service-within-minutes-for-free-b682cffa66ef?source=collection_archive---------4-----------------------#2021-12-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="961b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">你曾经希望有一种服务，一旦它观察到一个特定的事件，就反复地检查和 pings 你吗？—了解如何构建和部署它。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a3fad51a905238134a2b103152feadfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5TxCvc-Oee1A2VQZV-1Jcw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">小熊猫观察者— <a class="ae ky" href="https://pixabay.com/photos/nature-mammal-animal-wildlife-cute-3162233/" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="ad1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你有没有发现自己反复点击 f5 来查看某个网站上是否有某个商品或门票？你有没有几乎疯狂地检查 API 来查看某个速率是否超过了某个阈值？如果是的话，这篇文章可能适合你。</p><p id="4ac3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文将为您提供构建和部署全自动超轻通知服务的工具。本文旨在作为代码指南。我们将涵盖选定的相关监控用例(网站、加密、API)，回顾典型的通知渠道(电子邮件、SMS 和 Slack)，并解释如何使用<a class="ae ky" href="https://www.serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架部署服务。</a>你可以在这里找到最终回购<a class="ae ky" href="https://github.com/FBosler/notification-service" rel="noopener ugc nofollow" target="_blank">。相信我，这比你想象的要容易得多。</a></p><h2 id="c873" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">这篇文章的结构如下:</h2><ol class=""><li id="18fe" class="mo mp it lb b lc mq lf mr li ms lm mt lq mu lu mv mw mx my bi translated">设置</li><li id="e21c" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">监视</li><li id="6e0b" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">通知</li><li id="fcef" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">部署</li></ol><h2 id="96fc" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">先决条件:</h2><p id="9669" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">一些 Python 的经验是有帮助的，但是大多数组件都非常简单。对于我们手头的例子，我们将使用 AWS 的无服务器框架，所以理想情况下，您对 AWS 有一些经验。理想情况下，您也有一个 AWS 帐户，如果没有，您可以创建一个自由级帐户。</p><p id="97e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，我们可以快速重新配置服务，使用 GCP、Azure 或其他受支持的提供商之一。我们将把我们的服务部署为 lambda 函数。运行 lambda 函数的成本在免费层内(除非您每分钟运行多次检查)。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="0454" class="no lw it bd lx np nq nr ma ns nt nu md jz nv ka mg kc nw kd mj kf nx kg mm ny bi translated">①设置</h1><p id="cdbd" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">由于<code class="fe nz oa ob oc b">serverless</code>将在引擎盖下对我们的项目进行分类，我们将需要一个不仅仅是 Jupyter 笔记本的项目结构。我选择的编辑器是<a class="ae ky" href="https://www.jetbrains.com/pycharm/" rel="noopener ugc nofollow" target="_blank"> Pycharm </a>，但是可以随意使用。</p><p id="cf63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的项目结构将如下所示:</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="eedf" class="lv lw it oc b gy oh oi l oj ok">monitoring<br/>|-api.py<br/>|-crypto.py<br/>|-website.py<br/>notifier<br/>|-sms.py<br/>|-email.py<br/>|-slack.py<br/>|-telegram.py<br/>handler.py<br/>.env <em class="ol">(includes all relevant variables)<br/></em>serverless.yml <em class="ol">(serverless config file)<br/></em>requirements.txt <em class="ol">(specifies dependencies)<br/></em>package.json <em class="ol">(configures our node dependencies - think of it like a more powerful requirements.txt but for node)<br/></em>.gitignore</span></pre><p id="1b95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们开始之前，请继续安装<a class="ae ky" href="https://docs.npmjs.com/downloading-and-installing-node-js-and-npm" rel="noopener ugc nofollow" target="_blank"/><code class="fe nz oa ob oc b"><a class="ae ky" href="https://docs.npmjs.com/downloading-and-installing-node-js-and-npm" rel="noopener ugc nofollow" target="_blank">node, npm</a></code>和<code class="fe nz oa ob oc b"><a class="ae ky" href="https://www.serverless.com/framework/docs/getting-started" rel="noopener ugc nofollow" target="_blank">serverless</a></code>(您不需要设置仪表板帐户)。虽然不是绝对必要，但我强烈建议使用某种形式的 python 环境管理。我使用<a class="ae ky" href="https://docs.conda.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> conda </a>环境，但是<a class="ae ky" href="https://pypi.org/project/pipenv/" rel="noopener ugc nofollow" target="_blank"> pipenv </a>、<a class="ae ky" href="https://github.com/pypa/pipx" rel="noopener ugc nofollow" target="_blank"> pipex </a>或<a class="ae ky" href="https://github.com/pyenv/pyenv" rel="noopener ugc nofollow" target="_blank"> pyenv </a>也是不错的选择。这种选择主要取决于个人的熟悉程度和品味。一旦你这样做了，改变你的<code class="fe nz oa ob oc b">package.json</code>如下(或者创建它，如果你没有它)。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="0c8b" class="lv lw it oc b gy oh oi l oj ok">{<br/>  "devDependencies": {<br/>    "serverless-python-requirements": "5.2.2"<br/>  }<br/>}</span></pre><p id="5ab0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，这是最后的设置步骤，运行<code class="fe nz oa ob oc b">npm install</code>(这将安装<code class="fe nz oa ob oc b">serverless-python-requirements</code>——一个插件无服务器需要捆绑我们的 python 依赖)。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="f1a6" class="no lw it bd lx np nq nr ma ns nt nu md jz nv ka mg kc nw kd mj kf nx kg mm ny bi translated">②监测</h1><p id="e9f7" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">好吧，让我们开始吃肉，好吗？</p><h2 id="3491" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">从 API 中提取数据</h2><p id="8989" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">让我们从监测外汇汇率开始，以了解什么时候将是打包所有东西并自发飞往泰国的最佳时间。我们将查询 ECB(欧洲中央银行)提供的一个官方免费端点。不幸的是，我们得到的数据是 XML，所以我们必须解析它才能使用它。</p><p id="61c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们需要<code class="fe nz oa ob oc b">requests</code>来发送这些请求，所以运行<code class="fe nz oa ob oc b">pip install requests</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码可用<a class="ae ky" href="https://github.com/FBosler/notification-service/blob/main/monitoring/api.py" rel="noopener ugc nofollow" target="_blank">此处</a></p></figure><p id="e894" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果最近的汇率高于 35 泰铢，我们将打印一条消息通知我们。</p><h2 id="b41e" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">监控网页</h2><p id="41be" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">假设您想要监视网页，以确定某个产品何时再次可用。为了处理 HTML，我们需要一个解析器。幸运的是 Python 提供了<code class="fe nz oa ob oc b"><a class="ae ky" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/#quick-start" rel="noopener ugc nofollow" target="_blank">beautifulsoup</a></code>，一个 HTML 解析器。所以让我们继续运行<code class="fe nz oa ob oc b">pip install beautifulsoup4</code>。如果你想了解更多关于 beautifulsoup 的信息，可以看看下面这篇文章:</p><div class="oo op gp gr oq or"><a rel="noopener follow" target="_blank" href="/image-scraping-with-python-a96feda8af2d"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd iu gy z fp ow fr fs ox fu fw is bi translated">使用 Python 进行图像抓取</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">学习如何用 Python 从 Google 下载图片的代码指南！</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">towardsdatascience.com</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf ks or"/></div></div></a></div><p id="fc37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好的，现在让我们假设我们想买<a class="ae ky" href="https://www.everdrop.de/products/handburste-aus-fsc-zertifiziertem-buchenholz-und-pflanzlichen-borsten" rel="noopener ugc nofollow" target="_blank">这个漂亮的刷子</a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/34ada935bda16a3e2841667e4454c9fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jueZbJOIZv8K3txUgCyZRg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.everdrop.de/products/handburste-aus-fsc-zertifiziertem-buchenholz-und-pflanzlichen-borsten" rel="noopener ugc nofollow" target="_blank"> everdrop 笔刷</a>，可惜卖完了(写的时候)</p></figure><p id="e2eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，我们不想订阅时事通讯。因此，让我们抓取带有漂亮汤的 HTML 并搜索<code class="fe nz oa ob oc b">add-to-cart</code>按钮。如果我们能找到<code class="fe nz oa ob oc b">add-to-cart</code>按钮，这意味着产品可用。我们可以很容易地这样做:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码可用<a class="ae ky" href="https://github.com/FBosler/notification-service/blob/main/monitoring/webpage.py" rel="noopener ugc nofollow" target="_blank">此处</a></p></figure><h2 id="81da" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">做加密的东西</h2><p id="282b" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">所以最近我意识到了一个叫做<a class="ae ky" href="https://www.wonderland.money/" rel="noopener ugc nofollow" target="_blank">仙境</a>的疯狂的 crypto DAO(分散自治组织)。老实说，仙境是一个相当疯狂的金融结构，很可能会爆炸，但我发现它很有趣。它的工作方式是，一旦一个人下注他们的<code class="fe nz oa ob oc b">Time</code>代币，他们就会得到另一个代币(wMemos)，可以用作<a class="ae ky" href="https://abracadabra.money/" rel="noopener ugc nofollow" target="_blank"> Abracadabra </a>的抵押品来借用<code class="fe nz oa ob oc b">MIM</code>代币，然后可以再次变成<code class="fe nz oa ob oc b">Time</code>代币来建立高杠杆头寸。我的主要问题是，通常贷款池会没有代币，这些代币只能定期补充。所以我想让支票自动化。我只构建了监视服务，但是也完全有可能在特定条件下与区块链交互(例如 eth-brownie)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">此处代码<a class="ae ky" href="https://github.com/FBosler/notification-service/blob/main/monitoring/crypto.py" rel="noopener ugc nofollow" target="_blank">为</a></p></figure><p id="1e81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了，我们成功地编写了几个不同的监控函数。如果满足条件，这些函数返回一个字符串，否则不返回任何内容。此外，好的一面是每个文件都可以单独测试。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="2917" class="no lw it bd lx np nq nr ma ns nt nu md jz nv ka mg kc nw kd mj kf nx kg mm ny bi translated">③通知</h1><p id="e9e5" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们现在需要通知自己(或他人)我们之前监控的事件。让我们从最简单的开始。电子邮件。</p><h2 id="2fa0" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">电子邮件</h2><p id="c1a5" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在这个例子中，为了简单起见，我假设您使用的是 Gmail。此外，由于我们现在使用敏感的登录凭证，我将开始把它们放入<code class="fe nz oa ob oc b">.env</code>文件，并通过<code class="fe nz oa ob oc b">os.getenv</code>检索它们。如果你想复制这个，你需要把你自己的密码、电子邮件和 SMTP 服务器放到你的<code class="fe nz oa ob oc b">.env</code>文件中。请注意，如果你使用的是 Gmail，你很可能需要创建一个特定于应用程序的密码(这里的<a class="ae ky" href="https://support.google.com/accounts/answer/185833?p=InvalidSecondFactor" rel="noopener ugc nofollow" target="_blank">说明</a>)。你甚至可以运行你自己的 SMTP 服务器，但是我认为这会使 lambda 函数失去平衡。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">此处代码<a class="ae ky" href="https://github.com/FBosler/notification-service/blob/main/notifications/send_email.py" rel="noopener ugc nofollow" target="_blank">为</a></p></figure><h2 id="b83a" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">短信</h2><p id="dfe3" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">接下来，短信。随着 WhatsApp 的出现，SMS(短消息服务)有点过时了，但仍然非常好用。例如，设置通过<a class="ae ky" href="https://www.twilio.com/docs/sms/quickstart/python" rel="noopener ugc nofollow" target="_blank"> Twillio </a>发送短信非常简单。需要注意的是，每条短信都是要花钱发的。然而，Twilio 确实提供了一个免费的试用帐户，你可以先使用。理论上，你可以使用 Gmail 自动转发功能(或其他垃圾邮件服务)创建无限的试用账户。假设你的电子邮件地址是 example@gmail.com，那么 Gmail 会自动将所有发往 example+whatever@gmail.com 的邮件转发到你原来的账户。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/6da2c505e93adc699a75ce3cbbf1483c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a7qIhJFwfTqYIFbq1_G7fA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Twilio Dashboard —注册您的收件人号码也很重要(对于试用版)</p></figure><p id="7051" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">发送功能就变得愚蠢简单了。但是，不要忘记首先运行<code class="fe nz oa ob oc b">pip install twilio</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">此处代码<a class="ae ky" href="https://github.com/FBosler/notification-service/blob/main/notifications/send_sms.py" rel="noopener ugc nofollow" target="_blank">为</a></p></figure><h2 id="e87c" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">松弛的</h2><p id="b8c1" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">最后，懈怠。现在几乎每个公司都在使用 Slack，所以自动向 Slack 通道发送消息是有意义的。</p><p id="b896" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，你需要成为你的空闲工作区的管理员，然后去 slack.com/apps<a class="ae ky" href="https://api.slack.com/apps" rel="noopener ugc nofollow" target="_blank"/>。点击“创建应用程序”，选择“从头开始”，命名服务并选择正确的工作空间。一旦你创建了应用程序，点击“传入网页挂钩”，切换激活开关，并点击“添加新的网页挂钩到工作区”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/3c202b6c1b9c1001a9534296663f24e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zRUt_LKFZMP5lbC9TaxhTw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">现在选择一个频道</p></figure><p id="cab6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">酷，我们完成了。我们现在有了自己的 webhook URL，我们也把这个 URL 放在我们的<code class="fe nz oa ob oc b">.env</code>文件中，因为每个有这个 URL 的人都可以用它来发布消息。发送消息非常简单，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="3220" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太神奇了！我们现在已经成功地编写了一些监控函数和一些通知函数。让我们部署这个！</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="fb69" class="no lw it bd lx np nq nr ma ns nt nu md jz nv ka mg kc nw kd mj kf nx kg mm ny bi translated">④部署</h1><p id="ffe0" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">对于部署，我们将使用无服务器框架。假设您遵循了本指南，并做了步骤①中描述的所有事情，那么这应该意味着您可以开始了。但是，您需要设置您的本地 AWS 凭证。您可以通过运行<code class="fe nz oa ob oc b">cat ~/.aws/credentials</code>来验证您的凭证是否存在，您应该会看到类似这样的内容:</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="7956" class="lv lw it oc b gy oh oi l oj ok">[default]<br/>aws_access_key_id=YOUR_KEY<br/>aws_secret_access_key=YOUR_KEY<br/>...</span></pre><p id="cfdb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您没有看到这一点，请继续安装<a class="ae ky" href="https://aws.amazon.com/cli/" rel="noopener ugc nofollow" target="_blank"> AWS-CLI </a>和<a class="ae ky" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html" rel="noopener ugc nofollow" target="_blank">配置您的凭证</a>。如果您还没有凭据，请登录 AWS 控制台(web)并选择 IAM。现在有两个选择，一个比另一个稍微复杂一点。</p><h2 id="87e7" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">选项 1 —对根的权限:</h2><p id="825d" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">出于测试的目的，我推荐使用这种方法，因为它要快得多。登录 AWS 控制台<code class="fe nz oa ob oc b">-&gt;</code>搜索 IAM <code class="fe nz oa ob oc b">-&gt;</code>选择用户<code class="fe nz oa ob oc b">-&gt;</code>点击你的 root 用户<code class="fe nz oa ob oc b">-&gt;</code>“安全凭证”<code class="fe nz oa ob oc b">-&gt;</code>“创建访问密钥”就大功告成了。</p><h2 id="e63e" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">选项 2 —新用户:</h2><p id="9416" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">继续创建一个新用户，我们称该用户为<code class="fe nz oa ob oc b">notification-service-deployer</code>并勾选<code class="fe nz oa ob oc b">Access key — Programmatic access</code>框。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/bdad96770326573e923b252d0304fc99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I_x66uDaSjrCUlppJdL3BQ.png"/></div></div></figure><p id="69fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在是权限的时候了。出于开发目的，您可能倾向于授予该帐户 admin 权限，但我建议不要这样做，而是授予它以下权限:</p><ul class=""><li id="c33b" class="mo mp it lb b lc ld lf lg li pk lm pl lq pm lu pn mw mx my bi translated"><a class="ae ky" href="https://console.aws.amazon.com/iam/home#/policies/arn%3Aaws%3Aiam%3A%3Aaws%3Apolicy%2FAWSLambda_FullAccess" rel="noopener ugc nofollow" target="_blank"> AWSLambda_FullAccess </a>(原因很明显)</li><li id="65b4" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu pn mw mx my bi translated"><a class="ae ky" href="https://console.aws.amazon.com/iam/home#/policies/arn%3Aaws%3Aiam%3A%3Aaws%3Apolicy%2FAWSCloudFormationFullAccess" rel="noopener ugc nofollow" target="_blank">awscloudformationfullacess</a>(用于部署)</li><li id="2bb1" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu pn mw mx my bi translated"><a class="ae ky" href="https://console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AmazonS3FullAccess" rel="noopener ugc nofollow" target="_blank">亚马逊 3FullAccess </a>(如果你需要一些持久存储的话)</li></ul><h2 id="e84d" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">最终剧本</h2><p id="576e" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">让我们快速拼凑出我们的最终脚本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">这里的代码<a class="ae ky" href="https://github.com/FBosler/notification-service/blob/main/handler.py" rel="noopener ugc nofollow" target="_blank"/>—取消您想要使用的函数的注释</p></figure><p id="0855" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以随意取消注释您想要使用的任何内容。你必须根据你的需要修改剧本。</p><h2 id="e063" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">无服务器配置</h2><p id="3d42" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">现在，缺少的最后一件事是，我们需要像这样配置我们的<code class="fe nz oa ob oc b">serverless.yml</code>(注释解释了每个部分的作用):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="c59c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧啊。我们完成了，现在我们准备好部署我们的通知服务，只需运行:<code class="fe nz oa ob oc b">sls deploy</code>(它将构建一个 zip 文件并将其上传到 S3，从那里 zip 文件可以用来创建 lambda 函数)。</p><p id="e556" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太神奇了！您部署了自己的通知服务。相信我，当我告诉你这又打开了一个新的麻烦。你很快就可以开始编写自己的 API 和 bot 了。</p><p id="75b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哦，如果你喜欢阅读这样的故事，并想支持我成为一名作家，考虑注册成为一名灵媒成员。每月 5 美元，你可以无限制地阅读媒体上的故事。如果你用我的链接注册，我甚至会做一些🍩。</p><div class="oo op gp gr oq or"><a href="https://medium.com/@fabianbosler/membership" rel="noopener follow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd iu gy z fp ow fr fs ox fu fw is bi translated">通过我的推荐链接加入 Medium-Fabian Bosler</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">medium.com</p></div></div><div class="pa l"><div class="po l pc pd pe pa pf ks or"/></div></div></a></div></div></div>    
</body>
</html>