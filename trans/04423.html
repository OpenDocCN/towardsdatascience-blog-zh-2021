<html>
<head>
<title>Introducing notebookJS: seamless integration between Python and JavaScript in Computational Notebooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">介绍notebookJS:计算笔记本中Python和JavaScript的无缝集成</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introducing-notebookjs-seamless-integration-between-python-and-javascript-in-computational-e654ec3fbd18?source=collection_archive---------2-----------------------#2021-04-15">https://towardsdatascience.com/introducing-notebookjs-seamless-integration-between-python-and-javascript-in-computational-e654ec3fbd18?source=collection_archive---------2-----------------------#2021-04-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0d46ea614e679c951310e8cc73d882bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RVPRxqz2VUuY7NGXSXzmtw.jpeg"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">在<a class="ae kc" href="https://unsplash.com/s/photos/data-visualization?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kc" href="https://unsplash.com/@kmuza?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Carlos Muza </a>拍摄的照片</p></figure><p id="21ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你是否见过数据可视化，并认为在Jupyter笔记本中使用它会很棒？我知道我做过很多次。笔记本是试验数据可视化的最佳场所，因为它们可以在同一个地方包含所有的数据争论、预处理、图片和文档。然而，将JavaScript添加到Python笔记本中需要大量样板代码，这会变得繁琐和重复。更糟糕的是，不同的笔记本环境有不兼容的API用于Python和JavaScript之间的消息传递。例如，如果开发人员希望他们的库同时在Jupyter和Colab中运行，他们将不得不使用两种通信格式。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/76fd9ddc8ba201e203c1d17201d9b844.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_kc_tkqymk745ejR"/></div></div></figure><p id="1871" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了解决这些问题，我们创建了<a class="ae kc" href="https://github.com/jorgehpo/notebookJS" rel="noopener ugc nofollow" target="_blank"> <em class="lg"> notebookJS </em> </a>，这是一个Python库，可以用一行代码集成Python和JavaScript <strong class="kf ir">。</strong></p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lh"><img src="../Images/8d26750a839f2909bbaf8cd600bc8f95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ZFxrEfkKIkVvD8v-S7EBAw.gif"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">在Jupyter笔记本中重用D3散点图代码。代码改编自<a class="ae kc" href="https://www.d3-graph-gallery.com/graph/scatter_animation_start.html" rel="noopener ugc nofollow" target="_blank">https://www . D3-graph-gallery . com/graph/scatter _ animation _ start . html</a></p></figure><h1 id="1b4f" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">背景</h1><p id="d587" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">在您最喜欢的web堆栈(D3和React for me ❤)中编写可视化内容为开发人员提供了很大的灵活性。然而，在不同的数据集上测试代码可能会成为一个挑战。根据我的经验，我必须1)硬编码数据集，或者2)编写一个定制的服务器来管理数据。当试验数据集、预处理步骤或图表类型时，这些选项都不是很好。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="9633" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Python笔记本中进行实验很容易，因为所有的数据操作都可以内联完成，笔记本会自动跟踪计算步骤。在大多数情况下，像Matplotlib和Altair这样的Python库可以很容易地用来创建图表。然而，有时我们需要的可视化不能用现成的工具生成。例如，当我想探索Auto-Sklearn产生的ML管道时，我必须从头开始编写可视化<a class="ae kc" rel="noopener" target="_blank" href="/exploring-auto-sklearn-models-with-pipelineprofiler-5b2c54136044"/>。在笔记本中集成自定义可视化可能很麻烦，因为需要大量的样板代码来1)在笔记本中运行可视化，2)在Python和JavaScript之间发送数据(详见<a class="ae kc" href="https://ieeexplore.ieee.org/iel7/5992/9387473/09391750.pdf?casa_token=MUNl1uso0R8AAAAA:YnF1ekYRLVpRkeg7OSetZItt-H8yx4ABuwgUS0dPHk8rLv5H-EAp2rFOxqOXHpC2G2cDsx_gjBU" rel="noopener ugc nofollow" target="_blank">本文</a> [1】)。</p><p id="5583" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为我们发现笔记本中的可视化非常有用，所以我们决定为它创建一个库。特别是，<em class="lg">笔记本JS </em>:</p><ul class=""><li id="8bad" class="mn mo iq kf b kg kh kk kl ko mp ks mq kw mr la ms mt mu mv bi translated">负责笔记本中所有vis的样板代码；</li><li id="6976" class="mn mo iq kf b kg mw kk mx ko my ks mz kw na la ms mt mu mv bi translated">从网上自动加载JS库</li><li id="b858" class="mn mo iq kf b kg mw kk mx ko my ks mz kw na la ms mt mu mv bi translated">支持代码分割成多个JS和CSS文件。</li></ul><p id="4776" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它是这样工作的:</p><h1 id="3515" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">笔记本</h1><p id="93ce" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">首先你要安装<a class="ae kc" href="https://github.com/jorgehpo/notebookJS" rel="noopener ugc nofollow" target="_blank">库</a>:</p><pre class="lc ld le lf gt nb nc nd ne aw nf bi"><span id="7894" class="ng lj iq nc b gy nh ni l nj nk">pip install notebookjs</span></pre><p id="942c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">notebookJS的API非常简单。实际上，一个函数负责所有的事情:<em class="lg"> execute_js </em>方法执行一个JavaScript函数，并使用回调为Python和JavaScript之间的双向通信建立基础设施。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="77d4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些是参数:</p><ul class=""><li id="6326" class="mn mo iq kf b kg kh kk kl ko mp ks mq kw mr la ms mt mu mv bi translated"><em class="lg"> library_list </em>:字符串列表。字符串列表包含1)JavaScript库的URL，2) JavaScript代码，3) JavaScript <a class="ae kc" href="https://github.com/jorgehpo/notebookJS/tree/main/Examples/5_Webpack_BaseballAnnotator_Bidirectional" rel="noopener ugc nofollow" target="_blank">包</a></li><li id="cd7c" class="mn mo iq kf b kg mw kk mx ko my ks mz kw na la ms mt mu mv bi translated"><em class="lg"> main_function </em> : str。要调用的主函数的名称。该函数将使用两个参数调用:&lt; div_id &gt;，例如“#my_div”和&lt; data_dict &gt;。</li><li id="0a1e" class="mn mo iq kf b kg mw kk mx ko my ks mz kw na la ms mt mu mv bi translated"><em class="lg">数据_字典</em>:字典。包含要传递给&lt; main_function &gt;的数据的字典</li><li id="68c0" class="mn mo iq kf b kg mw kk mx ko my ks mz kw na la ms mt mu mv bi translated">试镜 : dict。{&lt;callback _ str _ id&gt;:&lt;python _ function&gt;}形式的字典。JavaScript库可以使用回调与python对话。</li><li id="a16f" class="mn mo iq kf b kg mw kk mx ko my ks mz kw na la ms mt mu mv bi translated"><em class="lg"> css_list </em>:字符串列表。包含1)CSS样式表的URL或2) CSS样式的字符串列表</li></ul><p id="93df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lg"> main_function </em>是调用execute_js时运行的JavaScript函数。它有以下签名:</p><pre class="lc ld le lf gt nb nc nd ne aw nf bi"><span id="020b" class="ng lj iq nc b gy nh ni l nj nk">function main_function(div_id, data_dict)</span></pre><p id="60a6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">举个简单的例子，我们可以使用D3向输出单元格添加一个圆:</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/805d36fb971b77f37771e7a3075b4c68.png" data-original-src="https://miro.medium.com/v2/resize:fit:132/format:webp/1*QYUgS500fnsXV4ZYFAxJsQ.png"/></div></figure><h1 id="d96a" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">加载本地库</h1><p id="9dac" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">正如我们所见，在Python笔记本中运行一个JavaScript函数只需要一行代码(不包括JS库定义)。我们注意到JS代码可以存储在一个单独的文件中，并从Python加载。数据也可以用Python加载，并使用字典结构传递给JavaScript(内部转换为JSON)。<br/>例如，如果我们想要重用这个<a class="ae kc" href="https://bl.ocks.org/AntonOrlov/6b42d8676943cc933f48a43a7c7e5b6c" rel="noopener ugc nofollow" target="_blank">径向条形图</a>，我们只需在JS文件中更改数据加载代码，然后使用<em class="lg"> notebookJS </em>:</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lh"><img src="../Images/2300dd73648847eeea637ce09e66189a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*g0cDNJZyAtDo18xJuxRwQw.gif"/></div></div></figure><h1 id="140b" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">Python回调</h1><p id="7b69" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我最喜欢的一个特性是设置Python回调的能力。在从事数据科学项目时，有些步骤在JavaScript中更容易完成(如前端和用户交互)，有些步骤在Python中更好(数字处理、机器学习等)。有了<em class="lg"> notebookJS </em>，我们可以两全其美。</p><p id="5ab6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们来看一个非常简单的例子:我们想制作一个动画，其中我们用一堆语言编写Hello World。短语存储在Python中，Javascript处理前端代码:</p><p id="7aee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Javascript绘图函数使用标识符“get_hello”每1秒向Python请求“Hello World”:</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="5c2d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Python等待<em class="lg"> get_hello </em>并做出相应的响应:</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="b0a7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">回调函数使用回调参数“连接”到可视化:</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/b497ded54bd41c08e6f198874c6cef13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*9Uo1dOtfXs3X1PWcGLjp3A.gif"/></div></div></figure><h1 id="2aa9" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">限制</h1><p id="9782" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated"><em class="lg"> notebookJS </em>目前不支持Javascript ES6模块。这就是我们在例子中使用D3 V3的原因。</p><p id="a684" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你需要ES6，我们建议使用一个构建工具，比如Webpack + Babel，把你的JS代码编译成一个文件，把ES6转换成老的JS。随着项目的增长，这是管理多个库和创建优化代码的最简单的方法。有关代码捆绑的示例，请参见本页上的<a class="ae kc" href="https://github.com/jorgehpo/notebookJS/tree/main/Examples/5_Webpack_BaseballAnnotator_Bidirectional" rel="noopener ugc nofollow" target="_blank">web pack库设置。</a></p><h1 id="961e" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">最后的想法</h1><p id="fa5b" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">notebookJS 是一个新工具，我们正在积极寻求关于我们应该支持哪些功能的反馈。如果您有任何问题或想要合作，请告诉我们！</p><p id="3001" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的知识库中有更多的例子。如需现场演示，请查看我们的<a class="ae kc" href="https://colab.research.google.com/drive/1g8WOn9oZ5G_3-Y8DYmpV1MIj59dnd81u?usp=sharing" rel="noopener ugc nofollow" target="_blank"> Colab笔记本</a>。</p><h1 id="2c93" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">参考</h1><p id="e9d4" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">[1] Jorge Piazentin Ono、Juliana Freire和Claudio T. Silva。"<a class="ae kc" href="https://ieeexplore.ieee.org/iel7/5992/9387473/09391750.pdf?casa_token=MUNl1uso0R8AAAAA:YnF1ekYRLVpRkeg7OSetZItt-H8yx4ABuwgUS0dPHk8rLv5H-EAp2rFOxqOXHpC2G2cDsx_gjBU" rel="noopener ugc nofollow" target="_blank">Jupyter笔记本中的交互式数据可视化</a>。"<em class="lg">科学计算&amp;工程</em>23.2(2021):99–106。</p></div></div>    
</body>
</html>