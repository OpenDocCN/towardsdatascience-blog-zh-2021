<html>
<head>
<title>Introducing a Dataflow Management System Backed Up by Prefect, AWS, and Github Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">引入由Prefect、AWS和Github Actions支持的数据流管理系统</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introducing-a-dataflow-management-system-backed-up-by-prefect-aws-and-github-actions-3f8c0eef2eb2?source=collection_archive---------42-----------------------#2021-04-26">https://towardsdatascience.com/introducing-a-dataflow-management-system-backed-up-by-prefect-aws-and-github-actions-3f8c0eef2eb2?source=collection_archive---------42-----------------------#2021-04-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4d41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该Github项目如何通过提供AWS和Prefect云基础设施将您的本地Prefect工作流提升到一个新的水平，以及作为其中一部分的重要角色<em class="kl"> Github Actions </em>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/fbbc3547566a5d2cc0fe9daf3b7a0188.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lghKe8hkLAL_JXwd"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">由<a class="ae lc" href="https://unsplash.com/@codestorm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">萨法尔萨法罗夫</a>在<a class="ae lc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="5fb0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">TL；DR: </strong> <a class="ae lc" href="https://github.com/maikelpenz/dataflow-automation-infra" rel="noopener ugc nofollow" target="_blank">该项目</a>建立了一个<em class="kl">数据流管理系统</em>，由<a class="ae lc" href="https://www.prefect.io/" rel="noopener ugc nofollow" target="_blank">总监</a>和<a class="ae lc" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS </a>提供动力。它的部署已经通过<a class="ae lc" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> Github Actions </a>完全自动化，此外<a class="ae lc" href="https://docs.github.com/en/actions/creating-actions" rel="noopener ugc nofollow" target="_blank">还公开了一个可重用的接口</a>以向<a class="ae lc" href="https://www.prefect.io/cloud/" rel="noopener ugc nofollow" target="_blank"> Prefect Cloud </a>注册工作流。</p><h1 id="837a" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">问题是</h1><p id="9c6a" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">perfect是一个开源工具，让团队能够用Python编排工作流。它的云解决方案- <a class="ae lc" href="https://www.prefect.io/cloud/" rel="noopener ugc nofollow" target="_blank"> Prefect Cloud </a> -在框架之上增加了一个管理层。这使得团队能够管理工作流，同时在保证执行层保持在用户一侧的混合模型下运行。</p><p id="8210" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这么说的话，用户有责任<em class="kl">启动</em>并将<em class="kl">执行层与Prefect Cloud</em>集成，这意味着需要一些工程工作来使解决方案端到端地启动和运行。</p><h1 id="5531" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">动机:当自动化需要自动化时</h1><p id="df26" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">几个月前，我与Prefect和Python一起做了一个个人项目。当我完成工作流开发并向Prefect Cloud注册时，我注意到<em class="kl">注册步骤</em>与工作流定义不太匹配，对我来说变成了一个手动和重复的过程。然后，我决定为未来的工作设计一些通用的和可重用的东西。</p><p id="280a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我最初的方法是创建一个私有的<em class="kl">助手项目</em>，唯一的目的是自动化本地工作流和完美云之间的这个<em class="kl">桥梁</em>。然而，随着这个想法的成熟和它的价值变得更加清晰，代码库也逐渐涵盖了在云中运行执行环境的自动化。该项目的目的从狭隘的关注交付<em class="kl">一个可重用的工作流注册工具</em>发展到更大的东西，为希望<em class="kl">在AWS上执行工作流并通过完美云</em>管理它们的团队提供一个起点或模板。</p><h1 id="1fcc" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">解决方案:数据流-自动化-基础设施</h1><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mg"><img src="../Images/fc3740f3911818f1b62fc046edf4a541.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NgNJhYugt6MOPPw8"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">作者图片</p></figure><p id="8ca0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将这个项目命名为<a class="ae lc" href="https://github.com/maikelpenz/dataflow-automation-infra" rel="noopener ugc nofollow" target="_blank"><em class="kl">data flow-automation-infra</em></a><em class="kl"/>it<em class="kl"/>现在已经达到了一个很好的状态，我自己或者任何遵循README文件的<a class="ae lc" href="https://github.com/maikelpenz/dataflow-automation-infra#deployment" rel="noopener ugc nofollow" target="_blank">部署部分</a>的人都可以毫无问题地将基础设施推到一个全新的环境中。</p><p id="58e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该项目有三个主要特性，部署和自动化测试都是通过自动触发的Github动作(T21)管道来完成的。</p><h2 id="9aa9" class="mh le iq bd lf mi mj dn lj mk ml dp ln jy mm mn lr kc mo mp lv kg mq mr lz ms bi translated">1 -在AWS上自动创建执行环境</h2><p id="06f3" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">这加快了AWS环境执行工作流的速度。目前，有一个可用的环境运行在<a class="ae lc" href="https://aws.amazon.com/ecs" rel="noopener ugc nofollow" target="_blank"> ECS </a>(弹性容器服务)和<a class="ae lc" href="https://aws.amazon.com/fargate" rel="noopener ugc nofollow" target="_blank"> Fargate </a>上。这种方法利用AWS <a class="ae lc" href="https://docs.aws.amazon.com/whitepapers/latest/aws-overview/compute-services.html" rel="noopener ugc nofollow" target="_blank">计算服务</a>，同时运行100% <a class="ae lc" href="https://aws.amazon.com/serverless/" rel="noopener ugc nofollow" target="_blank">无服务器</a>，不涉及任何管理。</p><p id="e54f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这组执行环境可以很容易地扩展以适应新的需求。一个很好的例子就是包含一个<a class="ae lc" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>执行环境。</p><h2 id="f294" class="mh le iq bd lf mi mj dn lj mk ml dp ln jy mm mn lr kc mo mp lv kg mq mr lz ms bi translated">2 -将执行环境与完美的云相集成</h2><p id="9dcd" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated"><a class="ae lc" href="https://docs.prefect.io/orchestration/agents/overview.html" rel="noopener ugc nofollow" target="_blank">提督代理</a>是一个长期运行的进程，它在云<em class="kl">执行环境</em>和<em class="kl">提督云</em>之间架起了一座沟通的桥梁。该流程监听工作流<em class="kl">运行</em>请求，将它们委托给云提供商的执行环境，并不断将<em class="kl">运行</em>状态反馈给Prefect Cloud。</p><p id="fd65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Prefect上有一些<a class="ae lc" href="https://docs.prefect.io/orchestration/agents/overview.html#agent-types" rel="noopener ugc nofollow" target="_blank">代理类型</a>可用，但是由于贯穿整个项目的单一执行环境是在ECS Fargate上运行的，所以它目前提供了具有<a class="ae lc" href="https://docs.prefect.io/orchestration/agents/ecs.html#requirements" rel="noopener ugc nofollow" target="_blank"> ECS代理类型</a>的代理。提督代理作为一个任务在ECS Fargate上运行，在一个专门用于代理的集群上运行。</p><h2 id="d77d" class="mh le iq bd lf mi mj dn lj mk ml dp ln jy mm mn lr kc mo mp lv kg mq mr lz ms bi translated">3 -提供注册工作流的界面</h2><p id="3b6d" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">到目前为止，您已经知道Github Actions运行项目管道来创建AWS和完美的云环境。然而，你可能知道也可能不知道的是，Github Actions也提供了一个<a class="ae lc" href="https://github.com/marketplace" rel="noopener ugc nofollow" target="_blank">市场</a>，人们<a class="ae lc" href="https://docs.github.com/en/actions/creating-actions" rel="noopener ugc nofollow" target="_blank">在那里发布他们自己的动作</a>，以便其他开发者/存储库可以使用它们。</p><p id="78be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我利用这个特性创建了一个集中的、可重用的方法来<em class="kl">向Prefect Cloud </em>注册工作流。通过这个<em class="kl">定制动作，</em>任何人都可以从单独的存储库中发布工作流，同时能够在由<em class="kl"> dataflow-automation-infra部署的基础设施之上运行它们。</em></p><h1 id="a3da" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">进一步开发和扩展</h1><p id="d06a" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">如上所述，该项目目前用它的完美代理建立了一个单一的执行环境。对于生产用例，这可以扩展到提供多种配置，既适合简单的用例，也适合更复杂的用例。例如:用于分析的简单数据摄取工作与训练资源密集型机器学习模型。</p><p id="840a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于任何想要尝试的人来说，自述文件包含了详细的部署步骤。如果您有任何反馈或希望为项目做出贡献，请联系我们。下次见！</p></div></div>    
</body>
</html>