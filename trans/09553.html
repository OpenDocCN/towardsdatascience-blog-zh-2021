<html>
<head>
<title>6 Best Practices for Managing Data Access to BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">管理BigQuery数据访问的6个最佳实践</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/6-best-practices-for-managing-data-access-to-bigquery-4396b0a3cfba?source=collection_archive---------9-----------------------#2021-09-05">https://towardsdatascience.com/6-best-practices-for-managing-data-access-to-bigquery-4396b0a3cfba?source=collection_archive---------9-----------------------#2021-09-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9197" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在BigQuery中设置数据环境时，在安全性方面需要了解什么。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8270e5940337f4a695ea70b31dd59099.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PP7AJcQwfTIfFebh"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">杰森·登特在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="9b29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们都看到了，也听说了数据泄露及其可能造成的财务和声誉损失。随着我们越来越依赖数据来做出更好的决策，数据正成为任何组织的重要资产。因此，与公司的任何其他资产一样，控制对数据的访问对于保护您的数据至关重要。</p><p id="d8a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，现代数据仓库具有强大的内置功能，可以精确控制谁可以访问什么。这通常被称为身份和访问管理或IAM。云提供商通常设计多个层来控制数据访问，这篇文章旨在揭示Google是如何使用BigQuery的。</p><p id="c844" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，要知道在许多控制层中控制访问的最佳实践可能是一个挑战。这篇文章试图列出我多年来遇到的一些推荐做法。</p><h1 id="23c6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">谷歌云中的资源是如何组织的</h1><p id="c8e7" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">BigQuery是Google选择的数据仓库技术。要了解如何控制对BigQuery的访问，首先必须了解资源在Google Cloud中是如何组织的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/0831c33a06665d9337867ec7b06fb8b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E6R2SWvEWvV6r-66"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自谷歌云的<a class="ae ky" href="https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy?hl=zh-tw" rel="noopener ugc nofollow" target="_blank">文档</a></p></figure><p id="576a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Google Cloud的构建方式是，我们可以在<strong class="lb iu">资源级别</strong>或任何<strong class="lb iu">层级</strong>授予访问权限，比如项目、文件夹和组织。</p><p id="ad6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果不需要资源级别的细粒度访问，可以在层次级别授予许可IAM。换句话说，如果允许所有人访问项目中的每个数据集和表，就没有必要在资源级别明确定义权限。</p><p id="94ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果您仍在阅读本文，您很可能希望控制谁可以访问项目中的内容。</p><h1 id="8bd4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">BigQuery的访问控制模式</h1><h2 id="9b03" class="mt lw it bd lx mu mv dn mb mw mx dp mf li my mz mh lm na nb mj lq nc nd ml ne bi translated">授予资源级别的细粒度访问权限</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/5470da6d4dd3f223bb267e95bfa85bf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gqU7truTlM-gofyK"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@luwe83?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Lutz Wernitz </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="c336" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要在BigQuery中查询一个表，需要两个权限:运行查询的权限<strong class="lb iu">和查看数据的权限</strong>和查看数据的权限。</p><p id="3719" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行查询的权限可以在任何层次级别上定义。您可以战略性地设置查询运行权限，以获得更好的可见性。例如，如果数据处理被划分到不同的项目中，您可以分别查看与数据转换和使用相关的所有查询开销、查询日志和数据访问日志。</p><p id="eed1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看数据的权限也可以在分层级别上设置。但是，强烈建议您在项目或资源级别(数据集和表)设置此权限。经验法则是，如果一个角色应该可以访问项目中的所有数据，那么就在项目级别授予它。如果需要限制对某个数据集或表的访问，请在资源级别授予权限。</p><p id="43b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">BigQuery还能够设置行级和列级安全性，从而允许更细粒度的访问控制。这将成为另一篇文章的好话题。</p><h2 id="8d05" class="mt lw it bd lx mu mv dn mb mw mx dp mf li my mz mh lm na nb mj lq nc nd ml ne bi translated">最小特权</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/16d52e984656cc7ff77bd70c4578dd8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*L3V0OTD3bjZuGqX8"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@flyd2069?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">飞:D </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="1174" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通俗地说，最小特权就是给予履行职责所需的最少权限。该原则有助于为实体(用户、组和服务帐户)和GCP资源创建职责分离。在许多系统上，最低特权是安全的推荐做法。</p><p id="e767" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，数据分析师的职责是查询和汇总转换后的数据。对于这个角色，她应该被授予对转换后的数据的只读访问权限，以执行她的工作。授予写访问权限可能意味着数据完整性面临风险。本例中的数据分析师可能会错误地删除或更改生产数据。同样，运营数据分析师只需要访问运营数据，而不需要访问完整的财务或客户数据。</p><p id="2bf8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将项目的完全访问权限(所有者或编辑权限)授予每个人通常是一个错误。默认情况下，Google Cloud创建一个具有编辑权限的计算服务帐户，以在项目中启用计算API。该帐户非常宽松，可能是一个潜在的安全威胁。最佳做法是禁用此帐户的自动创建，或者在以后删除它。</p><h2 id="81df" class="mt lw it bd lx mu mv dn mb mw mx dp mf li my mz mh lm na nb mj lq nc nd ml ne bi translated">服务的用户服务帐户。</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/96ec216ee8aaaf31d0cefac4f3f5e6c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qCZUyRhi00BuBrDo"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@ninjason?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">梁杰森</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="ba85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在Google Cloud中使用两种主要的认证方式:<strong class="lb iu">用户账户</strong>和<strong class="lb iu">服务账户</strong>。用户帐户是您用来登录控制台的Google帐户。另一方面，服务帐户是一个JSON密钥文件，您可以用它来认证服务。</p><p id="b892" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两种身份验证方法的区别在于谁在执行操作。对于用户帐户，用户使用其用户名/密码登录并执行操作。对于服务帐户，它是执行操作的服务(ETL作业、可视化工具、元数据目录工具)。</p><p id="83d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里一个常见的错误是使用一个用户帐户来认证服务。这样做会遇到配额问题，并使控制访问和审计日志变得更加困难。</p><p id="5263" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一个常见的错误是对每个服务使用一个服务帐户。这也不是推荐的做法，因为您不知道什么服务执行什么操作。此外，由于该帐户用于所有服务，它将是许可的，并增加了违规的机会。</p><h2 id="40f5" class="mt lw it bd lx mu mv dn mb mw mx dp mf li my mz mh lm na nb mj lq nc nd ml ne bi translated">授予组而不是个人帐户访问权限</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/f574391a878666d23f4f21462b28c7f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m5UllFY6THLvf44w"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae ky" href="https://unsplash.com/@marg_cs?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Margarida CSilva </a>拍摄的照片</p></figure><p id="6b07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样做的主要原因是为了更好地控制项目中的IAM权限。想象一下，如果你有十个人需要访问一个项目中的数据+五个不同的服务帐户，维护谁有权访问什么可以很快失控。</p><p id="7117" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，角色的数量将显著低于(或者，在最坏的情况下，等于)人员的数量。因此，更好的方法是基于角色创建一个不同的组，并相应地添加权限，以便更加清晰。</p><p id="1341" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以将一个群组添加为另一个群组的成员，以获得额外的控制层。例如，您可以有一个数据分析师小组。在这个组中，你可以有一个市场分析师组，一个运营分析师组，等等。</p><h2 id="3de3" class="mt lw it bd lx mu mv dn mb mw mx dp mf li my mz mh lm na nb mj lq nc nd ml ne bi translated">使用基础设施即代码(IaC)</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/648a01b9b36dc18e112f0507d455fa0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*we_mCHgThJW2j9J_"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">丹尼尔·科鲁奇在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="efa4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">IaC使您能够轻松地创建不同的环境，尤其是当您的项目很复杂并且有许多活动部分时。在大型项目中，您可以拥有具有复杂权限和策略的环境。只需为一个环境编写一次代码，并为试运行和开发环境提供同样的东西，就可以节省您的时间。</p><p id="810f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了IaC，您环境中的每一个更改都被版本化，因此您知道谁做了什么更改(假设您将管理权限限制为仅您的IaC服务)。您还可以定期扫描您的环境，查看配置和实际环境之间的差异。如果大多数IaC服务检测到任何变更，它们会将您的环境恢复到配置。</p><p id="95fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面看看我关于这个主题的其他一些文章。</p><div class="nk nl gp gr nm nn"><a rel="noopener follow" target="_blank" href="/data-lake-on-gcp-using-terraform-469062a205ad"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd iu gy z fp ns fr fs nt fu fw is bi translated">使用Terraform的GCP数据湖</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">使用Terraform为谷歌云平台上的数据湖建立基础设施代码。</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">towardsdatascience.com</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob ks nn"/></div></div></a></div><div class="nk nl gp gr nm nn"><a rel="noopener follow" target="_blank" href="/bootstrap-a-modern-data-stack-in-5-minutes-with-terraform-32342ee10e79"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd iu gy z fp ns fr fs nt fu fw is bi translated">使用Terraform在5分钟内引导一个现代数据堆栈</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">设置Airbyte、BigQuery、dbt、Metabase以及使用Terraform运行现代数据堆栈所需的一切。</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">towardsdatascience.com</p></div></div><div class="nw l"><div class="oc l ny nz oa nw ob ks nn"/></div></div></a></div><h2 id="39a7" class="mt lw it bd lx mu mv dn mb mw mx dp mf li my mz mh lm na nb mj lq nc nd ml ne bi translated">资源分离</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/15c53224b27286e9d9e934a02610b0f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0fBNOC6XmSOVRNGe"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Guillaume Bolduc 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="9bd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">加强安全性的最佳方式之一是分离资源。这意味着为您不想存储在一起的数据创建不同的项目。</p><p id="1698" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个好的起点是将接收、处理和访问之间的资源分开，以确保只在需要的时候访问数据。通过这种设计，您可以锁定原始数据的接收，并控制哪些数据在访问层可用。一个常见的用例是在将表暴露给数据仓库之前屏蔽或散列个人身份信息(PII)。</p><h1 id="eae2" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="9b4e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在现代云平台中，比如Google Cloud，有许多层来限制数据访问。我讨论了使用以下最佳实践来确保您有一个安全的数据环境:</p><ul class=""><li id="20f5" class="oe of it lb b lc ld lf lg li og lm oh lq oi lu oj ok ol om bi translated">授予资源级别的细粒度访问权限</li><li id="5c89" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated">最小特权</li><li id="130e" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated">服务的用户服务帐户。</li><li id="4886" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated">授予组而不是个人帐户访问权限</li><li id="0633" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated">使用基础设施即代码(IaC)</li><li id="d6ed" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated">资源分离</li></ul><p id="03ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在以后的文章中，我将分享如何使用行级安全性、列级安全性和VPC服务控制来获得更加安全的数据环境。</p><p id="5fc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">干杯✌️</p></div></div>    
</body>
</html>