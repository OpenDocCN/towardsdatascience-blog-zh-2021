<html>
<head>
<title>Experiment Tracking Template with Keras and Mlflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Keras和Mlflow的实验跟踪模板</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/experiment-tracking-template-with-keras-and-mlflow-36aa214896df?source=collection_archive---------16-----------------------#2021-11-22">https://towardsdatascience.com/experiment-tracking-template-with-keras-and-mlflow-36aa214896df?source=collection_archive---------16-----------------------#2021-11-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/4962c3a4542f3083243c205afe5703f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XQeXArYwEBd6qD71"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">由<a class="ae jg" href="https://unsplash.com/@trnavskauni?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">特尔纳瓦大学</a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><div class=""/><div class=""><h2 id="0d4b" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">使用Keras和Mlflow实现简单的实验跟踪工作流</h2></div><p id="d4ff" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当训练用于生产的机器学习模型时，我们都需要实现某种实验跟踪，以保证要部署的模型的质量和功效。</p><p id="d669" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我将向您展示如何使用mlflow和Keras实现一个简单的实验跟踪工作流。T11】</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="0524" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">【2021年12月更新】</strong></p><p id="1130" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你喜欢视频，可以看看我在Youtube上的视频:</p><figure class="mc md me mf gt iv"><div class="bz fp l di"><div class="mg mh l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="dc0b" class="mi mj jj bd mk ml mm mn mo mp mq mr ms kp mt kq mu ks mv kt mw kv mx kw my mz bi translated">台阶</h1><p id="06b8" class="pw-post-body-paragraph ky kz jj la b lb na kk ld le nb kn lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">为此，我们需要:</p><ol class=""><li id="0cdf" class="nf ng jj la b lb lc le lf lh nh ll ni lp nj lt nk nl nm nn bi translated"><strong class="la jk">导入依赖关系</strong></li><li id="484f" class="nf ng jj la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated"><strong class="la jk">用mlflow设置自动日志</strong></li><li id="b7e8" class="nf ng jj la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated"><strong class="la jk">设置要跟踪的超参数</strong></li><li id="0495" class="nf ng jj la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated"><strong class="la jk">设置数据</strong></li><li id="d71c" class="nf ng jj la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated"><strong class="la jk">建立模型</strong></li><li id="1295" class="nf ng jj la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated"><strong class="la jk">训练和测试</strong></li><li id="083f" class="nf ng jj la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated"><strong class="la jk">使用mlflow浏览器用户界面可视化实验</strong></li></ol></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="1f03" class="nt mj jj bd mk nu nv dn mo nw nx dp ms lh ny nz mu ll oa ob mw lp oc od my oe bi translated">导入依赖项</h2><pre class="mc md me mf gt of og oh oi aw oj bi"><span id="97bf" class="nt mj jj og b gy ok ol l om on">import numpy as np<br/>from tensorflow import keras<br/>from tensorflow.keras.datasets import reuters<br/>from tensorflow.keras.models import Sequential<br/>from tensorflow.keras.layers import Dense, Dropout, Activation<br/>from tensorflow.keras.preprocessing.text import Tokenizer<br/>import mlflow.tensorflow</span></pre><h2 id="83a6" class="nt mj jj bd mk nu nv dn mo nw nx dp ms lh ny nz mu ll oa ob mw lp oc od my oe bi translated">使用mlflow设置自动日志</h2><pre class="mc md me mf gt of og oh oi aw oj bi"><span id="e37f" class="nt mj jj og b gy ok ol l om on">mlflow.tensorflow.autolog()</span></pre><h2 id="7003" class="nt mj jj bd mk nu nv dn mo nw nx dp ms lh ny nz mu ll oa ob mw lp oc od my oe bi translated">设置超参数</h2><p id="562a" class="pw-post-body-paragraph ky kz jj la b lb na kk ld le nb kn lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">在本例中，我们进行了一个非常简单的实验，其中我们只改变了用于训练模型的时期数和批量大小。</p><pre class="mc md me mf gt of og oh oi aw oj bi"><span id="4577" class="nt mj jj og b gy ok ol l om on">epochs = 10<br/>batch_size = 16</span></pre><h2 id="95af" class="nt mj jj bd mk nu nv dn mo nw nx dp ms lh ny nz mu ll oa ob mw lp oc od my oe bi translated">设置数据</h2><p id="3588" class="pw-post-body-paragraph ky kz jj la b lb na kk ld le nb kn lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">对于我们的数据集，不使用MNIST或其他一些经典的人工智能数据集，让我们保持简单，只使用<code class="fe oo op oq og b">sklearn.datasets.make_blobs</code>函数创建一个假的二进制分类数据集。</p><pre class="mc md me mf gt of og oh oi aw oj bi"><span id="3f0b" class="nt mj jj og b gy ok ol l om on">from sklearn.datasets import make_blobs<br/>import matplotlib.pyplot as plt<br/><br/>X,y = make_blobs(n_samples=1000, n_features=2, centers=2, random_state=42)<br/><br/>plt.scatter(X[:,0], X[:, 1], c=y, marker="o")<br/>plt.show()</span></pre><figure class="mc md me mf gt iv gh gi paragraph-image"><div class="ab gu cl or"><img src="../Images/9d27ae16ce7d3876d00db0ae157905af.png" data-original-src="https://miro.medium.com/v2/format:webp/1*qb4iL441CQNjcEikqddFvQ.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</p></figure><p id="407d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，让我们将数据集分成训练组和测试组:</p><pre class="mc md me mf gt of og oh oi aw oj bi"><span id="c7c4" class="nt mj jj og b gy ok ol l om on">from sklearn.model_selection import train_test_split<br/>X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=42)</span></pre><h2 id="bb90" class="nt mj jj bd mk nu nv dn mo nw nx dp ms lh ny nz mu ll oa ob mw lp oc od my oe bi translated">建立模型</h2><p id="6481" class="pw-post-body-paragraph ky kz jj la b lb na kk ld le nb kn lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">对于模型，让我们创建一个简单的<code class="fe oo op oq og b">Sequential</code>模型，其中一层有128个单元，最后一层运行sigmoid函数。</p><pre class="mc md me mf gt of og oh oi aw oj bi"><span id="306a" class="nt mj jj og b gy ok ol l om on">model = Sequential()<br/>model.add(Dense(128, input_shape=(2,)))<br/>model.add(Activation("relu"))<br/>model.add(Dense(1))<br/>model.add(Activation("sigmoid"))<br/>model.compile(loss="binary_crossentropy" , optimizer="adam", metrics=["binary_accuracy"])</span></pre><h2 id="a73b" class="nt mj jj bd mk nu nv dn mo nw nx dp ms lh ny nz mu ll oa ob mw lp oc od my oe bi translated">培训和测试</h2><p id="ecc8" class="pw-post-body-paragraph ky kz jj la b lb na kk ld le nb kn lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">现在模型已经编译好了，让我们将它与训练数据集相匹配，为它提供最初定义的参数。</p><pre class="mc md me mf gt of og oh oi aw oj bi"><span id="4b3a" class="nt mj jj og b gy ok ol l om on">history = model.fit(X_train,y_train, batch_size=batch_size, epochs=epochs, verbose=1, validation_split=0.1)</span><span id="00b0" class="nt mj jj og b gy os ol l om on"># Output:<br/><br/><br/>Epoch 1/10<br/> 1/38 [..............................] - ETA: 0s - loss: 4.8758e-04 - binary_accuracy: 1.0000WARNING:tensorflow:Callback method `on_train_batch_end` is slow compared to the batch time (batch time: 0.0007s vs `on_train_batch_end` time: 0.0014s). Check your callbacks.<br/>38/38 [==============================] - 0s 2ms/step - loss: 4.3713e-04 - binary_accuracy: 1.0000 - val_loss: 1.9682e-04 - val_binary_accuracy: 1.0000<br/>Epoch 2/30<br/>38/38 [==============================] - 0s 1ms/step - loss: 3.7183e-04 - binary_accuracy: 1.0000 - val_loss: 1.6366e-04 - val_binary_accuracy: 1.0000<br/>Epoch 3/30<br/>38/38 [==============================] - 0s 1ms/step - loss: 3.2540e-04 - binary_accuracy: 1.0000 - val_loss: 1.4324e-04 - val_binary_accuracy: 1.0000<br/>.<br/>.</span></pre><p id="de1e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">完美！现在让我们在测试数据集上评估模型。</p><pre class="mc md me mf gt of og oh oi aw oj bi"><span id="2850" class="nt mj jj og b gy ok ol l om on">score = model.evaluate(X_test, y_test, batch_size=batch_size, verbose=1)</span><span id="70d2" class="nt mj jj og b gy os ol l om on">21/21 [==============================] - 0s 686us/step - loss: 1.2186e-05 - binary_accuracy: 1.0000</span><span id="dbaa" class="nt mj jj og b gy os ol l om on">print(f"Loss: {score[0]}")<br/>print(f"Accuracy: {score[1]}")</span><span id="595a" class="nt mj jj og b gy os ol l om on">Loss: 0.002690241439267993<br/>Accuracy: 1.0</span></pre><p id="aade" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于所使用的假数据集的简单性质，我们的模型具有不寻常的高准确性。</p><h2 id="dc89" class="nt mj jj bd mk nu nv dn mo nw nx dp ms lh ny nz mu ll oa ob mw lp oc od my oe bi translated">使用mlflow浏览器用户界面可视化实验</h2><p id="9002" class="pw-post-body-paragraph ky kz jj la b lb na kk ld le nb kn lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">现在我们可以对这个实验进行更多的变化。在这种情况下，我将使用不同的时期数和批次大小再做几个例子:</p><ul class=""><li id="1aa8" class="nf ng jj la b lb lc le lf lh nh ll ni lp nj lt ot nl nm nn bi translated">实验二:历元= 20；batch_size=32</li><li id="00f1" class="nf ng jj la b lb no le np lh nq ll nr lp ns lt ot nl nm nn bi translated">实验三:历元= 30；批处理大小=16</li></ul><p id="11f8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我可以在终端中运行这个命令，</p><p id="daf1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe oo op oq og b">mlflow ui</code></p><p id="785c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">并获得以下内容:</p><pre class="mc md me mf gt of og oh oi aw oj bi"><span id="922a" class="nt mj jj og b gy ok ol l om on">[2021-11-20 18:42:20 +0000] [105270] [INFO] Starting gunicorn 20.1.0<br/>[2021-11-20 18:42:20 +0000] [105270] [INFO] Listening at: http://127.0.0.1:5000 (105270)<br/>[2021-11-20 18:42:20 +0000] [105270] [INFO] Using worker: sync<br/>...</span></pre><p id="2f61" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，我们可以访问mlflow的用户界面来比较这些实验:</p><figure class="mc md me mf gt iv gh gi paragraph-image"><div class="ab gu cl or"><img src="../Images/ef15e65479a9789c13491ad7b7a9c06b.png" data-original-src="https://miro.medium.com/v2/format:webp/1*nlCQ-wxTe0nH1zdliHZPfg.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</p></figure><p id="1d69" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以选择我们的实验并点击<code class="fe oo op oq og b">Compare</code>按钮，这将显示:</p><figure class="mc md me mf gt iv gh gi paragraph-image"><div class="ab gu cl or"><img src="../Images/c91483eba0ef4e4bf20e40d20c87f75c.png" data-original-src="https://miro.medium.com/v2/format:webp/1*NKbqHiwDVTL8oOqz7-OkYA.png"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</p></figure><p id="5452" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如我们所见，mlflow存储了不同的参数组合，我们可以探索一些简洁的可视化方式:</p><figure class="mc md me mf gt iv gh gi paragraph-image"><div class="ab gu cl or"><img src="../Images/dfe4986562486b9953fed55c5bbaf290.png" data-original-src="https://miro.medium.com/v2/1*hy9ReoAIXGbJvVxbQmTyKA.gif"/></div><p class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</p></figure><p id="fb74" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我个人最喜欢的是平行坐标图，它显示了不同的参数组合如何产生给定的性能指标。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b395" class="mi mj jj bd mk ml mm mn mo mp mq mr ms kp mt kq mu ks mv kt mw kv mx kw my mz bi translated">关于实验跟踪的最后思考</h1><p id="2257" class="pw-post-body-paragraph ky kz jj la b lb na kk ld le nb kn lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">实验跟踪对于机器学习工程来说至关重要，以保证良好的监控和再训练实践，以及验证在给定手边计算能力的情况下，正在使用最佳可能的模型。</p><p id="decf" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用jupyter笔记本进行实验跟踪的另一个很好的参考可以在这篇博文中找到:</p><div class="is it gp gr iu ou"><a href="https://neptune.ai/blog/how-to-keep-track-of-deep-learning-experiments-in-notebooks" rel="noopener  ugc nofollow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd jk gy z fp oz fr fs pa fu fw ji bi translated">如何在笔记本上记录深度学习实验- neptune.ai</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">Jupyter笔记本很酷。它们独立于语言，非常适合协作，易于定制，您可以添加…</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">海王星. ai</p></div></div><div class="pd l"><div class="pe l pf pg ph pd pi ja ou"/></div></div></a></div><p id="b309" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我展示了如何使用开源的Mlflow框架实现一个简单的实验跟踪工作流，并使用<code class="fe oo op oq og b">keras</code>框架作为我们的玩具示例，将其嵌入到您的训练代码中。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="f55e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你喜欢这个帖子，<a class="ae jg" href="https://lucas-soares.medium.com/membership" rel="noopener">加入媒体</a>，<a class="ae jg" href="https://lucas-soares.medium.com/" rel="noopener">关注</a>，<a class="ae jg" href="https://lucas-soares.medium.com/subscribe" rel="noopener">订阅我的简讯</a>。还有，在<a class="ae jg" href="https://twitter.com/LucasEnkrateia" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae jg" href="https://www.linkedin.com/in/lucas-soares-969044167/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae jg" href="https://www.instagram.com/theaugmentedself/" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上和我联系！谢谢，下次再见！:)</p></div></div>    
</body>
</html>