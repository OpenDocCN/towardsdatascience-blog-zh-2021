<html>
<head>
<title>The Best Practice of Reading Text Files In Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python读取文本文件的最佳实践</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-best-practice-of-reading-text-files-in-python-509b1d4f5a4?source=collection_archive---------8-----------------------#2021-06-13">https://towardsdatascience.com/the-best-practice-of-reading-text-files-in-python-509b1d4f5a4?source=collection_archive---------8-----------------------#2021-06-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/2ea5f45ee20084ad1f2d1c1f06b73e8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XGrBiq4H1GGYcnPMc2C-ag.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://pixabay.com/users/kollinger-15617407/" rel="noopener ugc nofollow" target="_blank"> Kollinger </a>在<a class="ae jg" href="https://pixabay.com/photos/book-library-literature-bookshelf-5211309/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上拍摄</p></figure><div class=""/><div class=""><h2 id="9a7b" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">将多个文件合并成一个具有更丰富元数据的流</h2></div><p id="d8bb" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">与大多数其他编程语言相比，用Python读取文本文件相对容易。通常，我们只是在读或写模式下使用“open()”函数，然后开始逐行循环文本文件。</p><p id="2e0f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这已经是最佳实践了，没有比这更简单的方法了。但是，当我们想从多个文件中读取内容时，肯定有更好的方法。也就是使用Python内置的“文件输入”模块。它结合了来自多个文件的内容，允许我们在一个for循环中处理所有的内容，还有很多其他的好处。</p><p id="3ac9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我将用例子演示这个模块。</p><h1 id="5979" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">0.没有FileInput模块</h1><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/5fbb0e5afcb26bd3298815d4094ff00e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jcZ1kGoddIulNKAfQh5K_Q.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">由<a class="ae jg" href="https://pixabay.com/users/dglodowska-388133/" rel="noopener ugc nofollow" target="_blank"> DGlodowska </a>在<a class="ae jg" href="https://pixabay.com/photos/book-rose-book-mark-open-book-419589/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上拍摄的照片</p></figure><p id="403d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们看看使用<code class="fe mq mr ms mt b">open()</code>函数读取多个文本文件的“普通”方式。但是在此之前，我们需要创建两个示例文件用于演示。</p><pre class="mm mn mo mp gt mu mt mv mw aw mx bi"><span id="ef0a" class="my lv jj mt b gy mz na l nb nc">with open('my_file1.txt', mode='w') as f:<br/>    f.write('This is line 1-1\n')<br/>    f.write('This is line 1-2\n')</span><span id="1d8a" class="my lv jj mt b gy nd na l nb nc">with open('my_file2.txt', mode='w') as f:<br/>    f.write('This is line 2-1\n')<br/>    f.write('This is line 2-2\n')</span></pre><p id="07c6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上面的代码中，我们用模式<code class="fe mq mr ms mt b">w</code>打开一个文件，这意味着“写”。然后，我们在文件中写两行。请注意，我们需要添加新的生产线<code class="fe mq mr ms mt b">\n</code>。否则，这两个句子将被写成一行。</p><p id="c98f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">之后，我们应该在当前工作目录中有两个文本文件。</p><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/c8c9f50cea3f3b52453b132f1d335c9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*U_c4vwxozhu3JhnHvl3xjw.png"/></div></figure><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/ace052613eaec360834a2177cd8c5cf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/format:webp/1*7K24p8pXkKbvgB62fWW_vw.png"/></div></figure><p id="03c2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，假设我们想读取这两个文本文件并逐行打印内容。当然，我们仍然可以使用<code class="fe mq mr ms mt b">open()</code>函数来实现。</p><pre class="mm mn mo mp gt mu mt mv mw aw mx bi"><span id="e4a8" class="my lv jj mt b gy mz na l nb nc"># Iterate through all file<br/>for file in ['my_file1.txt', 'my_file2.txt']:<br/>    with open(file, 'r') as f:<br/>        for line in f:<br/>            print(line)</span></pre><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/3804d0b057f132e629233d42c8568c87.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*5gVJBgZpc-lZqLUh1KQHJw.png"/></div></figure><p id="3b96" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里我们必须使用两个嵌套的for循环。外部循环用于文件，而内部循环用于每个文件中的行。</p><h1 id="1733" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">1.使用文件输入模块</h1><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/0a0c8614edf4c0b40d8f9d29958cde79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uTuTX6FFKhrWg2lJeJznTQ.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">由<a class="ae jg" href="https://pixabay.com/users/free-photos-242387/" rel="noopener ugc nofollow" target="_blank">在<a class="ae jg" href="https://pixabay.com/photos/typewriter-book-notes-paper-801921/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上的</a>自由照片拍摄的照片</p></figure><p id="e1e3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">嗯，没有什么能阻止我们使用<code class="fe mq mr ms mt b">open()</code>功能。然而，<code class="fe mq mr ms mt b">fileinput</code>模块只是为我们提供了一种将多个文本文件读入单个流的更简洁的方式。</p><p id="25dc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我们需要导入模块。这是一个Python内置模块，所以我们不需要下载任何东西。</p><pre class="mm mn mo mp gt mu mt mv mw aw mx bi"><span id="e319" class="my lv jj mt b gy mz na l nb nc">import fileinput as fi</span></pre><p id="f20c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，我们可以用它来读取这两个文件。</p><pre class="mm mn mo mp gt mu mt mv mw aw mx bi"><span id="8ec0" class="my lv jj mt b gy mz na l nb nc">with fi.input(files=['my_file1.txt', 'my_file2.txt']) as f:<br/>    for line in f:<br/>        print(line)</span></pre><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/da3646ab637bb780c5445f236dd2799b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/1*9rqRYhQ93W2HGcmouM2bvA.png"/></div></figure><p id="35a9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为<code class="fe mq mr ms mt b">fileinput</code>模块是为读取多个文件而设计的，我们不再需要循环文件名。相反，<code class="fe mq mr ms mt b">input()</code>函数将一个可迭代的集合类型(比如列表)作为参数。此外，最棒的是两个文件中的所有行都可以在一个for循环中访问。</p><h1 id="2829" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">2.将FileInput模块与Glob一起使用</h1><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/e2542c7cab748ab9525b4069d14e2b39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EaHPxt7vnYYRtf2jxInxRQ.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">由<a class="ae jg" href="https://pixabay.com/users/jarmoluk-143740/" rel="noopener ugc nofollow" target="_blank"> jarmoluk </a>在<a class="ae jg" href="https://pixabay.com/photos/old-books-book-old-library-436498/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上拍摄的照片</p></figure><p id="60ff" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有时，拥有这样一个包含所有手动键入的名称的文件名列表可能并不实际。从一个目录中读取所有文件是很常见的。此外，我们可能只对某些类型的文件感兴趣。</p><p id="8bde" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这种情况下，我们可以将另一个Python内置模块<code class="fe mq mr ms mt b">glob</code>模块与<code class="fe mq mr ms mt b">fileinput</code>模块一起使用。</p><p id="6252" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在此之前我们可以做一个简单的实验。<code class="fe mq mr ms mt b">os</code>模块可以帮助我们列出当前工作目录下的所有文件。</p><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/261d0693fdc871180bd9fe39afb4c09f.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/format:webp/1*Rgaimi5O5Mm3XSR8U_THiQ.png"/></div></figure><p id="a6ad" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">可以看到，除了这两个文本文件之外，还有很多文件。因此，我们希望过滤文件名，因为我们只想读取文本文件。我们可以如下使用<code class="fe mq mr ms mt b">glob</code>模块。</p><pre class="mm mn mo mp gt mu mt mv mw aw mx bi"><span id="78dd" class="my lv jj mt b gy mz na l nb nc">from glob import glob</span><span id="cc6e" class="my lv jj mt b gy nd na l nb nc">glob('*.txt')</span></pre><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/6c998b627d0a3faffa67638c1049f0d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*ZzLclT5393nkTkn67QqUSA.png"/></div></figure><p id="0544" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，我们可以将<code class="fe mq mr ms mt b">glob()</code>函数作为参数放入<code class="fe mq mr ms mt b">fileinput.input()</code>函数中。所以，只有这两个文本文件将被读取。</p><pre class="mm mn mo mp gt mu mt mv mw aw mx bi"><span id="e7ac" class="my lv jj mt b gy mz na l nb nc">with fi.input(files=glob('*.txt')) as f:<br/>    for line in f:<br/>        print(line)</span></pre><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nj"><img src="../Images/43010c0afefa1ee80e339c3352e58526.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*AY89aw5J826I59DTyP1axQ.png"/></div></div></figure><h1 id="9c70" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">3.获取文件的元数据</h1><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/410a42937f24ae87703a5851adeb44f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aErAxMFMtG0QR8y2ILRcrA.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">由<a class="ae jg" href="https://pixabay.com/users/stocksnap-894430/" rel="noopener ugc nofollow" target="_blank"> StockSnap </a>在<a class="ae jg" href="https://pixabay.com/photos/reading-book-girl-woman-sunshine-925589/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上拍摄的照片</p></figure><p id="5141" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可能会问，当我们从实际上由多个文件组合而成的流中进行读取时，我们如何知道“行”到底来自哪个文件？</p><p id="adf1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">事实上，使用嵌套循环的<code class="fe mq mr ms mt b">open()</code>函数似乎很容易获得这样的信息，因为我们可以从外部循环访问当前文件名。然而，这实际上在<code class="fe mq mr ms mt b">fileinput</code>模块中要容易得多。</p><pre class="mm mn mo mp gt mu mt mv mw aw mx bi"><span id="47c3" class="my lv jj mt b gy mz na l nb nc">with fi.input(files=glob('*.txt')) as f:<br/>    for line in f:<br/>        print(f'File Name: {f.filename()} | Line No: {f.lineno()} | {line}')</span></pre><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/16a04a4dc4d0a92e39eae3e74effe7da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*-e86W350OZMDA91ZdHcp0w.png"/></div></figure><p id="b1a1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看，在上面的代码中，我们使用<code class="fe mq mr ms mt b">filename()</code>来访问<code class="fe mq mr ms mt b">line</code>来自的当前文件，使用<code class="fe mq mr ms mt b">lineno()</code>来访问我们正在获取的行的当前索引。</p><h1 id="15a6" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">4.当光标到达新文件时</h1><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/c6db5f04ebfa7993dbe6117a076c2299.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ciSIdG1OamH3Yfa4liHWyA.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">由<a class="ae jg" href="https://pixabay.com/users/dariuszsankowski-1441456/" rel="noopener ugc nofollow" target="_blank"> DariuszSankowski </a>在<a class="ae jg" href="https://pixabay.com/photos/glasses-book-education-eyeglasses-1052010/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上拍摄的照片</p></figure><p id="5f76" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">除此之外，我们还可以利用来自<code class="fe mq mr ms mt b">fileinput</code>模块的更多函数。例如，当我们到达一个新文件时，如果我们想做些什么呢？</p><p id="3e50" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">函数<code class="fe mq mr ms mt b">isfirstline()</code>帮助我们决定是否从一个新文件中读取第一行。</p><pre class="mm mn mo mp gt mu mt mv mw aw mx bi"><span id="892b" class="my lv jj mt b gy mz na l nb nc">with fi.input(files=glob('*.txt')) as f:<br/>    for line in f:<br/>        if f.isfirstline():<br/>            print(f'&gt; Start to read {f.filename()}...')<br/>        print(line)</span></pre><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/be79fc906ab2150dbedfe2b0f59373e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*yLbobhfkc4ng2J4e8FarCQ.png"/></div></figure><p id="5273" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这对于日志记录非常有用。所以，我们可以用当前的进度来表示。</p><h1 id="0f31" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">5.跳到下一个文件</h1><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/5cf8bcb67f11086550f587a450cdf5d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FSmvSbQPCpJiNa9fJA8D9w.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">由<a class="ae jg" href="https://pixabay.com/users/free-photos-242387/" rel="noopener ugc nofollow" target="_blank">在<a class="ae jg" href="https://pixabay.com/photos/running-man-glass-floor-reflection-1149787/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上的</a>自由照片拍摄的照片</p></figure><p id="2e93" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们也可以很容易地停止读取当前文件，跳到下一个文件。功能<code class="fe mq mr ms mt b">nextfile()</code>允许我们这样做。</p><p id="d072" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我们演示这个特性之前，请让我重写两个示例文件。</p><pre class="mm mn mo mp gt mu mt mv mw aw mx bi"><span id="0733" class="my lv jj mt b gy mz na l nb nc">with open('my_file1.txt', mode='w') as f:<br/>    f.write('This is line 1-1\n')<br/>    f.write('stop reading\n')<br/>    f.write('This is line 1-2\n')</span><span id="6b81" class="my lv jj mt b gy nd na l nb nc">with open('my_file2.txt', mode='w') as f:<br/>    f.write('This is line 2-1\n')<br/>    f.write('This is line 2-2\n')</span></pre><p id="77d2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">与原始文件唯一不同的是，我在第一个文本文件中添加了一行文本<code class="fe mq mr ms mt b">stop reading</code>。假设我们希望<code class="fe mq mr ms mt b">fileinput</code>模块在看到这样的内容时停止读取第一个文件并跳转到第二个文件。</p><pre class="mm mn mo mp gt mu mt mv mw aw mx bi"><span id="7f08" class="my lv jj mt b gy mz na l nb nc">with fi.input(files=glob('*.txt')) as f:<br/>    for line in f:<br/>        if f.isfirstline():<br/>            print(f'&gt; Start to read {f.filename()}...')<br/>        if line == 'stop reading\n':<br/>            f.nextfile()<br/>        else:<br/>            print(line)</span></pre><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/fcfe1a31b136d0427131b35770778b00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*MYloKog9doLWEK-sQJYcWQ.png"/></div></figure><p id="cb95" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上面的代码中，添加了另一个if条件。当行文本为<code class="fe mq mr ms mt b">stop reading</code>时，它将跳转到下一个文件。因此，我们可以看到行“1–2”没有被读取和输出。</p><h1 id="e14a" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">6.读取压缩文件而不解压缩</h1><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/e0f560a6bfcdf3fe8bc7a8866e1fb62a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U_LUpytruJnfVhk-ayCLrA.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">由<a class="ae jg" href="https://pixabay.com/photos/technology-tablet-digital-tablet-792180/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上的<a class="ae jg" href="https://pixabay.com/users/kaboompics-1013994/" rel="noopener ugc nofollow" target="_blank"> kaboompics </a>拍摄的照片</p></figure><p id="22b5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有时我们可能需要阅读压缩文件。通常，我们必须先解压缩它们，然后才能读取内容。然而，使用<code class="fe mq mr ms mt b">fileinput</code>模块，我们可能不需要在读取压缩文件之前提取其中的内容。</p><p id="8683" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们用Gzip创建一个压缩文本文件。该文件稍后将用于演示目的。</p><pre class="mm mn mo mp gt mu mt mv mw aw mx bi"><span id="0ebf" class="my lv jj mt b gy mz na l nb nc">import gzip<br/>import shutil</span><span id="aca3" class="my lv jj mt b gy nd na l nb nc">with open('my_file1.txt', 'rb') as f_in:<br/>    with gzip.open('my_file.gz', 'wb') as f_out:<br/>        shutil.copyfileobj(f_in, f_out)</span></pre><p id="e787" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上面的代码中，我们使用gzip将文件<code class="fe mq mr ms mt b">my_file1.txt</code>添加到一个压缩文件中。现在，让我们看看<code class="fe mq mr ms mt b">fileinput</code>如何在没有额外解压缩步骤的情况下读取它。</p><pre class="mm mn mo mp gt mu mt mv mw aw mx bi"><span id="5716" class="my lv jj mt b gy mz na l nb nc">with fi.input(files='my_file.gz', openhook=fi.hook_compressed) as f:<br/>    for line in f:<br/>        print(line)</span></pre><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/ae15ef5d611a253cea3d7267ce90517d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*gIhs8HtQIZVaj4wyBsSh4w.png"/></div></figure><p id="cc2b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过使用参数<code class="fe mq mr ms mt b">openhook</code>和标志<code class="fe mq mr ms mt b">fi.hook_compressed</code>，gzip文件将被动态解压缩。</p><p id="ea65" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe mq mr ms mt b">fileinput</code>模块目前支持gzip和bzip2。不幸的是，不是另一种格式。</p><h1 id="e413" class="lu lv jj bd lw lx ly lz ma mb mc md me kp mf kq mg ks mh kt mi kv mj kw mk ml bi translated">摘要</h1><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/8938ece0339527603e9acbd977cf9f34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XFV7ucKQBiOHgSaN7afvZg.jpeg"/></div></div><p class="jc jd gj gh gi je jf bd b be z dk translated">由<a class="ae jg" href="https://pixabay.com/users/free-photos-242387/" rel="noopener ugc nofollow" target="_blank">免费拍摄的照片</a>在<a class="ae jg" href="https://pixabay.com/photos/office-meeting-business-partners-336368/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上</p></figure><p id="fcbf" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我介绍了Python内置模块<code class="fe mq mr ms mt b">fileinput</code>以及如何使用它读取多个文本文件。当然，它永远不会取代<code class="fe mq mr ms mt b">open()</code>函数，但就将多个文件读入单个流而言，我相信它是最佳实践。</p><div class="is it gp gr iu no"><a href="https://medium.com/@qiuyujx/membership" rel="noopener follow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd jk gy z fp nt fr fs nu fu fw ji bi translated">通过我的推荐链接加入Medium克里斯托弗·陶</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">medium.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc ja no"/></div></div></a></div><p id="b6e0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你觉得我的文章有帮助，请考虑加入Medium会员来支持我和数以千计的其他作者！(点击上面的链接)</p></div></div>    
</body>
</html>