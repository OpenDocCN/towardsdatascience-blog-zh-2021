<html>
<head>
<title>Data Analyst’s Primer to Slowly Changing Dimensions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据分析师的渐变维度入门</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-analysts-primer-to-slowly-changing-dimensions-d087c8327e08?source=collection_archive---------8-----------------------#2021-04-25">https://towardsdatascience.com/data-analysts-primer-to-slowly-changing-dimensions-d087c8327e08?source=collection_archive---------8-----------------------#2021-04-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="17f0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">数据分析师访谈通常包括技术和行为两部分</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9ee10d34aec537faf5a52cc8a4455ca5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NyT2xZPFl98ymTOZjLQE9A.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:托比亚斯·菲舍尔在<a class="ae kv" href="https://unsplash.com/s/photos/databases?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="1554" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我遇到了一个相对直接的SQL挑战，但是包括一个注释，即挑战的假设表中的列是缓慢变化的维度类型2。我不知道这些是什么，但幸运的是，这是一个带回家的挑战，所以我有机会研究它，并在挑战和面试过程中取得成功。除了知道对我的编码挑战的影响，我还好奇为什么这对数据分析师的角色很重要。</p><p id="be90" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我通过参加数据科学训练营实现职业转型时，导师和同事们都说谷歌会是你最好的朋友，这表明解决你面临的问题需要研究——并非所有问题都有简单或直接的答案。</p><p id="ce4e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但在这种情况下，谷歌并没有很大的帮助。截至2021年，当搜索“缓慢变化的维度”时，第一个结果现在是一篇<a class="ae kv" href="https://en.wikipedia.org/wiki/Slowly_changing_dimension" rel="noopener ugc nofollow" target="_blank">维基百科文章</a>，当我提出我的编码挑战时，它并不存在。相反，我找到的最佳结果是一个描述不同类型的渐变维度的Oracle primer ,但是其余的结果并不太有帮助。我把注意力转向搜索YouTube，发现了一个<a class="ae kv" href="https://youtu.be/XqdZF0DJpUs" rel="noopener ugc nofollow" target="_blank">有用的结果，是由一位名叫Tech蔻驰</a>的用户提供的，他解释了缓慢变化的维度，这种方式有助于应对面试挑战，以及在我作为数据分析师的日常工作中适用的重要知识。</p><p id="5343" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面我总结了我的研究结果，并指出数据分析师的应用。</p><p id="1840" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我提供这些细节的目的是:</p><ul class=""><li id="aad2" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">综合我自己的研究发现，帮助他人增强知识或准备面试</li><li id="7281" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">确定缓慢变化的维度可能会对查询产生影响的情况</li><li id="3c53" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">提供背景知识，说明为什么缓慢变化的维度与数据分析师的日常工作相关。</li></ul></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="0b84" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">那么什么是缓变维度(SCD)？</h1><p id="d543" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">SCDs指的是数据仓库概念，其中维度包含当前和历史数据。这是在数据仓库中维护历史细节的常用方法，但是它们的使用将取决于业务需求和数据仓库的目的。</p><p id="ac06" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基本上，维度会随着时间而缓慢变化，而不是按照预定的时间间隔变化，维度变化的频率没有固定的模式。</p><p id="150d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就产生了一个问题，即数据仓库是存储当前数据还是历史数据，或者两者都存储。该决策可能由业务需求决定，并将由数据架构师或工程师实施和管理，但是理解所使用的维度类型和基本原理对于数据分析师响应业务问题和有效履行其职责的能力至关重要。</p><p id="e0b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用渐变维度的一个业务案例可能是，我们可能需要考虑我们知道哪些属性会随着时间的推移而变化，但我们不一定期望在规定的时间间隔内发生变化。例如，考虑一个销售部门，随着客户数量的变化，负责特定客户的个人客户经理也会发生变化。这些变化将随着公司获得新客户而发生，但我们不知道具体什么时候会发生变化，因为销售部门的员工每年6月都会有预定的晋升和工资变动。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><p id="b661" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那么缓变维度的不同类型有哪些呢？</p><h1 id="923c" class="mn mo iq bd mp mq nk ms mt mu nl mw mx jw nm jx mz jz nn ka nb kc no kd nd ne bi translated">SCD类型0</h1><p id="f050" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">第一种类型被称为类型0。这指的是在数据仓库中从不改变也不会更新的属性。SCD类型0的一个示例是我们不希望更改的记录，如出生日期或员工在公司的开始日期。因此，我们不希望这个维度在我们的数据仓库中发生变化。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="8598" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">SCD类型1</h1><p id="a58a" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">渐变维度类型1是指在数据仓库中维护记录的最新快照，而没有任何历史记录的实例。</p><p id="3774" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">SCD类型1通常用于更正维度中的错误，更新错误或不相关的值。不保留历史记录—如果记录包含错误和所需的更新，我们是否希望保留现在已被否决的不准确的历史记录？</p><p id="ed5c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个真实世界的例子来自你的作者。我的名字是<code class="fe np nq nr ns b">Nicolas</code>,但是人为错误或自动更正等工具通常认为我名字的正确拼法是更常见的<code class="fe np nq nr ns b">Nicholas</code>,名字中有一个<code class="fe np nq nr ns b">h</code>。</p><p id="45fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设这个错误是人力资源团队在我加入一家新公司时犯的。当然，我希望记录能准确反映我的名字，这样HR就可以在源系统中更改我的名字。从源系统构建的数据仓库中的任何表，如雇员姓名和角色表，都将被更新以反映这种变化。</p><p id="d850" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">SCD类型1将更新记录以准确反映我的姓名，从而纠正姓名拼写中的错误。不正确的记录将被更新，而不会向数据仓库添加任何新的行或列。</p><p id="c050" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，假设该记录不是不正确的姓名，而是诸如雇佣历史表之类的东西—例如，雇员在公司中的角色和薪水。</p><p id="9800" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当一个雇员得到晋升时，SCD类型1记录将反映他们的新职位—先前的记录被覆盖。因此，如果我们确定我们不需要先前的历史(例如，纠正一个错误)，SCD类型1可能满足我们的目的。</p><p id="c2c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是考虑下面的例子:Paulie是地区销售经理，被提升为区域销售经理。由于他的提升，数据仓库中的employee表将被更新。先前的记录和雇佣历史将被覆盖，以反映新的职位、工资、主管等。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/5414e468d3bc05d715744547b9e453c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*SIS6dBbLRurkGwgfVVWOuA.png"/></div></figure><p id="89eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在SCD类型1中，雇佣历史将被覆盖。所以在上面的例子中，我们的表将保留第二行——Paulie目前的职位是<code class="fe np nq nr ns b">Regional Sales Manager</code>,但他以前的职位是<code class="fe np nq nr ns b">District Sales Manager</code>,这不会保留在我们的表中。</p><p id="1738" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，我们想要保留历史可能有正当的理由。例如，人力资源部门可能希望方便地访问某人的主管或工资历史记录，或者确定员工更换角色的频率。在后一种情况下，SCD类型1将是不合适的，因为我们将丢失历史，这将引导我们进入下一种类型的缓慢变化的维度。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="8353" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">SCD类型2</h1><p id="eb18" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">那么当我们想维护历史的时候用什么呢？引入渐变维度类型2。</p><p id="bd7b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于SCD Type 2，每当源系统中有变化时，都会向数据仓库表中添加一个新行。在生成的表中，将会有更多的记录，但是先前的历史记录将被保留并可查询。</p><p id="20dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在SCD类型2中，有两种方法来区分当前记录和历史记录:</p><ul class=""><li id="ad05" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">表示当前记录的列</li><li id="a637" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><code class="fe np nq nr ns b">to_date</code>和<code class="fe np nq nr ns b">from_date</code>栏目</li></ul><p id="f56e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">继续上面的例子，考虑保利现在已经被提升为东海岸销售主管。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/5d47274bb9d20ed2bc5c64bbcef2ab36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hKlM5ntIQVliK6nhPQipBQ.png"/></div></div></figure><p id="3c28" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为我们现在正在查看SCD类型2，所以来自Paulie之前角色的所有记录都将保留在我们的<code class="fe np nq nr ns b">employee_history</code>表中。</p><p id="6be0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">表格中的当前记录将通过一个标志(<code class="fe np nq nr ns b">current_record_indicator </code>)或当前记录将具有标准化替代高日期的日期范围(例如<code class="fe np nq nr ns b">position_end_date = '12-31-9999'</code>)来表示。</p><p id="005a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">查询该表时，为了确保返回当前记录，我们将添加一个过滤条件，例如:</p><p id="f5f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe np nq nr ns b">WHERE current_record = 'Y'</code>或<code class="fe np nq nr ns b">WHERE position_end_date = '12-31-9999'</code></p><p id="a2ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">根据表的结构、数据仓库和业务需求，可能只有一个或两个列/方法可用。</p><p id="e0dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">概括一下SCD类型2，其主要好处是记录的历史将被维护，但是，如果数据的结构有可能改变(例如，向表中添加新列)或者向表中添加新行增加了表的大小，使得表变得不可管理，则不太可能使用这种类型。</p><p id="13a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">根据我的经验，SCD类型2很常见，了解如何获得感兴趣的当前记录很重要。一个重要的考虑因素是在构建SQL查询时是否对连接条件有影响。当连接到SCD类型为2的表时，在连接条件中包含当前记录标志是很重要的，否则可能会影响结果。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="5baa" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">SCD类型3</h1><p id="1c86" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">下一种缓慢变化的维度是类型3，在我的职业生涯中，我还没有遇到过这种情况，我对这个主题的研究表明，这种类型很少使用。</p><p id="b82f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不是向表中添加新行来反映每个记录的更改，而是添加一个额外的列。</p><p id="979b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">考虑前面的例子，Paulie从地区销售经理晋升为区域销售经理。为了获取Paulie的新工资，我们在表中添加了一个新行，保留了以前的历史记录。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/5414e468d3bc05d715744547b9e453c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*SIS6dBbLRurkGwgfVVWOuA.png"/></div></figure><p id="a596" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">相反，对于SCD类型3，我们将有一行，但有一个额外的列来表示以前和当前的薪金，以及记录的更新日期:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/44d8ad7b4b7ebb354955de4df4250d1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*tON-p5XZyhhgpUSOBZh7tw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">SCD类型3</p></figure><p id="2eb0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将从原始状态和当前状态比较保利的工资，但如果工资再次发生变化，跟踪历史将更加困难。这种方法的优点是，它提供了在发生更改之前和之后比较记录的能力，但是保留了有限的历史。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="7223" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">SCD类型4</h1><p id="9468" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">下一个缓慢变化的维度是类型4。这里引入了历史表的概念。历史数据将像在SCD类型2中一样被维护，但是这里的区别在于历史将被维护在数据仓库中的单独的表上。当前记录将包含在主表中。</p><p id="5381" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于SCD类型4，对于源系统中的每一个变更，一个记录将被添加到历史表中。</p><p id="9ee4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">继续我们在销售部门的Paulie和他的晋升的例子:我们在数据仓库中的<code class="fe np nq nr ns b">employee</code>表将反映Paulie目前作为东海岸销售主管的角色；</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/783e27c26af194a0f5dab7d5bb280505.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*z2bmQ2J1aeDsuQzK2OKMKQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">员工表(当前记录)</p></figure><p id="f0b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">而另一个<code class="fe np nq nr ns b">employee_history</code>表将包含有关Paulie在同一家公司的先前职位的历史数据:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/7fefc7a10a8211a65de159c4ea6d35b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sP1k5cu7xGbnlye5Jze_Uw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">SCD类型4历史表</p></figure><p id="7d97" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对Paulie的工资或职位历史感兴趣的人力资源经理可以通过加入<code class="fe np nq nr ns b">employee_id</code>在<code class="fe np nq nr ns b">employee_history</code>表中查找以前的记录。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="fe8b" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">包扎</h1><p id="75ec" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">以上反映了我自己的研究和经验，同时介绍了这个数据架构概念对数据分析师角色的适用性。这绝不是详尽的，对于那些真正对构建数据仓库感兴趣的人，我鼓励进一步的研究或寻求数据架构师的帮助。</p></div></div>    
</body>
</html>