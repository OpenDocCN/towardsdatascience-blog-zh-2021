<html>
<head>
<title>Analyze Causal Effect Using Diff-in-Diff Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用差异中差异模型分析因果关系</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/analyze-causal-effect-using-diff-in-diff-model-85e07b17e7b7?source=collection_archive---------17-----------------------#2021-06-01">https://towardsdatascience.com/analyze-causal-effect-using-diff-in-diff-model-85e07b17e7b7?source=collection_archive---------17-----------------------#2021-06-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ad34" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">对于真实世界的应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b704ecc909f70890e15b04710682eebe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K3HQiBc60VQQitj6_bFPTg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0227" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">进行随机AB实验并不总是可行的，但如果我们有一个随时间产生观察数据(即面板数据)的近似实验，我们仍然可以恢复治疗的因果效应。我们可以使用的一个模型是差异中的差异(Diff-in-Diff，或DiD)来估计观察数据的因果关系。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="c982" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">差异中的差异模型</h1><p id="b187" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">当我们有两个现有的组(例如，两个区域A和B)而不是像在随机AB试验中那样由我们随机分配，并且治疗发生在其中一个组时(例如，只有区域A发起促销)，我们可以在治疗和控制之前对组间的差异建模，用于预先存在的差异，并且当我们假设治疗后的差异不是由于仅打击其中一个组的任何其他外部冲击而是由于治疗本身。</p><p id="e617" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们用潜在结果模型的框架来研究一下数学。如果你需要快速回顾一下那是什么，你可以阅读我以前的<a class="ae my" href="https://medium.com/geekculture/an-introduction-of-randomized-experiment-aka-a-b-testing-and-potential-outcome-model-f2c93f73d426" rel="noopener">文章</a>。补充的是，现在我们使用具有时间维度的数据，因此将下标<em class="mz"> t </em>添加到等式中。</p><p id="2722" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">设<em class="mz"> yᵢₜ </em>为个体受试者在时间<em class="mz">t<em class="mz">I</em>的潜在结果；y₀ᵢₜ </em>和<em class="mz"> y₁ᵢₜ </em>为观察结果(我们只能观察其中一个，不能同时观察两个)；<em class="mz"> Dᵢₜ </em>为治疗状态变量。DiD的一个关键假设是，潜在结果<em class="mz"> y₀ᵢₜ </em>可以建模为个体单位和时间固定效应的线性加法方程:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/d24fd9b64936d4f90ed4d40d119c283a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vcjDAygvxOBYN4OndmxZUQ.png"/></div></div></figure><p id="3a64" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面的第二个等式表明<em class="mz"> Dᵢₜ </em>与协变量上的随机分配一样好。我们还假设因果效应是可加的和恒定的，我们推导出<em class="mz"> y₁ᵢₜ为:</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/f251784ca5b54ce4f1bf182703596686.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*xovrr7FFKWdGu4F49hTeMQ.png"/></div></figure><p id="60ce" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">鉴于<em class="mz"> yᵢₜ = (1-Dᵢₜ)y₀ᵢₜ + y₁ᵢₜ </em>，我们有:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/5d673312a6fb62a0d931f0daf8f34635.png" data-original-src="https://miro.medium.com/v2/resize:fit:550/format:webp/1*m10ESPEYX7An0DxwSW6iQA.png"/></div></figure><p id="a6bc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个等式表明，潜在的结果是由时间不变的个体固定效应和时间固定效应的总和决定的，时间固定效应在个体之间是常见的，并且是因果效应。</p><p id="4e16" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">假设我们有面板数据，允许我们对治疗前后的组间差异进行建模。让我们将<em class="mz"> t </em> =0表示为预处理周期，将<em class="mz"> t </em> =1表示为后处理周期。只有当<em class="mz"> D </em> ᵢ=1(治疗组)和<em class="mz"> t </em> =1时，<em class="mz"> Dᵢₜ </em> =1。我们推导出<strong class="la iu">差分中的差分</strong>如下:</p><p id="f450" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">对照组治疗前后的差异</strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/c14a4df079d319da0324b2117d4e90af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*EBrKBYfj7chq8ZjjO--eQQ.png"/></div></figure><p id="fdb3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">治疗组治疗前后的差异</strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/5ce0a0642bbf5298096c5d4104d4388c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*qsGrsx1JgeDJvYqPqCyHOA.png"/></div></figure><p id="51de" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，<strong class="la iu">治疗组和对照组之间的差异中的差异是平均治疗效果:</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/bc7e7498e008f03baea4c46ecbffb063.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*988qQUuU9EFDYzAL9WUpHw.png"/></div></figure><p id="af76" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">我们用回归的形式来写吧:</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/417142696ac23df5add514b6a7471b9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/format:webp/1*lbAF_yR9Er0ErDorspoE5A.png"/></div></div></figure><p id="a795" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从回归中，我们得到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/2acc5c7b0514aa4d1d89a82e60c7dc58.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*i2YH-ahltcJnyBbSWcHILg.png"/></div></figure></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="c0c7" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">一份申请</h1><p id="c0e3" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">Card和Krueger (1994年)估计了国家最低工资增加对就业的因果影响。1992年4月1日，新泽西州将州最低工资从4.25美元提高到5.05美元，而宾夕法尼亚州的最低工资保持在4.25美元。卡德和克鲁格分别于1992年2月和1992年11月调查了新泽西州的快餐店。他们还从邻近的东宾夕法尼亚的快餐店收集了数据。</p><p id="3977" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我从麻省理工学院经济学<a class="ae my" href="https://economics.mit.edu/faculty/angrist/data1/mhe/card" rel="noopener ugc nofollow" target="_blank">网站</a>下载了Card和Krueger (1994)使用的数据文件public.dat。我用Python计算了新泽西州最低工资增长影响的简单DiD估计。本质上，我比较了从2月到11月期间新泽西州的就业变化和宾夕法尼亚州的就业变化。以下是代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="efb0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是回归结果的摘要:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/a9242186034bdc20086d9da0ee2b657b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*kYM6ehORT3okvTshqnfMyA.png"/></div></figure><p id="4622" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它说就业变化的差异是2.76个FTE雇员。似乎更高的最低工资并没有减少就业。然而，我的结果显示这种差异在统计学上并不显著。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="43d9" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">提醒</h1><p id="1b57" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">Diff-in-Diff估计有效的关键假设是共同趋势，这意味着，在上面的例子中，处理前两个州的就业趋势应该相同。治疗使治疗组的趋势偏离共同趋势。治疗组和对照组可以不同，因为这种差异意味着被未观察到的个体固定效应所捕获，但是它们需要共享一个共同的趋势。</p><p id="da1f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了检验这一共同趋势，我从BLS下载了1991年至1993年费城、宾夕法尼亚大都会区和新泽西“食品服务和饮料场所”行业的月度就业时间序列数据。我将1992年4月和1992年11月作为垂直虚线绘制在下面。就业价值指数是1991年1月确定的。下载的系列没有季节性调整。我看到很多波动。即使我们放大到1992年1月至1992年4月期间(治疗前)，我也不确定PA是否与NJ相当。因此，在没有最低工资变化的情况下，PA就业可能不是NJ就业的一个好的反事实测量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/96c8edfc527253bc30c5af20a0e6e79a.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*RZvwCWCI7iSPTsJY2uB_SQ.png"/></div></figure></div></div>    
</body>
</html>