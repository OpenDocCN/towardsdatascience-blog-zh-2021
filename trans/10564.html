<html>
<head>
<title>Deploying A Deep Learning Model on Mobile Using TensorFlow and React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用TensorFlow和React在移动设备上部署深度学习模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploying-a-deep-learning-model-on-mobile-using-tensorflow-and-react-4b594fe04ab?source=collection_archive---------1-----------------------#2021-10-09">https://towardsdatascience.com/deploying-a-deep-learning-model-on-mobile-using-tensorflow-and-react-4b594fe04ab?source=collection_archive---------1-----------------------#2021-10-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b4eb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我们将介绍如何使用React Native和TensorFlowJS React Native adaptor构建一个跨平台的移动应用程序(适用于iOS和Android)</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a965c685089c68de629d6ac975a248af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DybBVNqDc59WnEViHylNNQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">安娜·佩尔泽在<a class="ae kv" href="https://unsplash.com/s/photos/food-salad?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="1cef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该项目由<a class="ae kv" href="https://medium.com/@npatta01" rel="noopener">尼丁·帕坦尼伊尔</a>和<a class="ae kv" href="https://medium.com/@reshamas" rel="noopener">热沙玛·谢赫</a>共同完成。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="63e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随着移动电话变得越来越普及，移动电话的使用也在增加。用户越来越频繁地在桌面上使用移动设备，移动应用需求旺盛。这些连接互联网的设备提供了一个让推理模型更接近用户的机会。</p><h1 id="5d9d" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">概述</h1><ul class=""><li id="7e71" class="mr ms iq ky b kz mt lc mu lf mv lj mw ln mx lr my mz na nb bi translated">关于数据:食物-101</li><li id="d9ef" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">第1部分:使用TensorFlow训练图像分类器</li><li id="9ac2" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">第2部分:转换模型</li><li id="a5ac" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">第3部分:推理的考虑事项:在服务器上运行还是在客户机上运行</li><li id="ca99" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">第4部分:部署Web应用程序</li><li id="0880" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">第5部分:部署移动应用程序</li></ul></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="ce90" class="lz ma iq bd mb mc nh me mf mg ni mi mj jw nj jx ml jz nk ka mn kc nl kd mp mq bi translated">关于数据:食物-101</h1><p id="3fdd" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">本项目使用<a class="ae kv" href="https://www.tensorflow.org/datasets/catalog/food101" rel="noopener ugc nofollow" target="_blank"> Food-101 </a>数据，包括101个食品类别，共101，000张图像。因此，每个类有1000幅图像，其中250幅是人工检查的测试图像，750幅是训练图像。ETHZ Food-101的分类是来自食物图片分享网站foodspotting.com的101个最受欢迎的分类。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/310820a6dc3b0240278e73781f6f37f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*4at66wIRCP0MMiupkIT7-g.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://www.tensorflow.org/datasets/catalog/food101" rel="noopener ugc nofollow" target="_blank">食品-101数据集</a></p></figure><p id="bd4c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">数据引用</strong></p><p id="376e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Bossard，Lukas和Guillaumin，Matthieu和Van Gool，Luc，用随机森林挖掘101种食品歧视成分，欧洲计算机视觉会议，2014年。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="f4d4" class="lz ma iq bd mb mc nh me mf mg ni mi mj jw nj jx ml jz nk ka mn kc nl kd mp mq bi translated">第1部分:使用TensorFlow训练图像分类器</h1><p id="7360" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">使用TensorFlow 2.3.4训练图像分类器。代码可在GitHub上的<a class="ae kv" href="https://github.com/reshamas/deploying-web-app/blob/main/notebooks/2021_09_20_1_run_dl_model_101_classes.ipynb" rel="noopener ugc nofollow" target="_blank">本笔记本</a>中查阅。TensorFlow 2 / Keras中有许多预训练的<a class="ae kv" href="https://keras.io/api/applications/" rel="noopener ugc nofollow" target="_blank">模型</a>。我们使用了ResNet50和MobileNetV2架构。MobileNet模型系列是移动友好的，它将用于移动应用程序。</p><h2 id="956e" class="nq ma iq bd mb nr ns dn mf nt nu dp mj lf nv nw ml lj nx ny mn ln nz oa mp ob bi translated">表1:比较模型架构</h2><p id="846e" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">我们在下面的表格中比较了模型的准确性、参数数量和模型大小。</p><p id="0c24" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">MobileNetV2是一个移动友好的架构，具有较少的参数。移动应用程序部署中使用的最终模型是MobileNetV2微调模型，精确度约为66%。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/8d31d9d852fa6749ed0308fe85463887.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6LM_SPua1WEV85vr_C9iVw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="38a4" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">第2部分:转换模型(量化和优化)</h1><p id="9473" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">我们将<code class="fe od oe of og b">model.h5</code>和<code class="fe od oe of og b">classes.json</code>(这是食品类别名称的列表)文件下载到本地计算机上一个名为<code class="fe od oe of og b">model_tf</code>的文件夹中，并在虚拟环境中进行模型转换。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="f2f8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们创建的模型<code class="fe od oe of og b">model.h5</code>，格式为“TensorFlow Keras”。我们需要将其转换为“TensorFlow.js”格式，因为客户端推理需要这种格式。我们转换默认tensorflow.js模型有几个原因:</p><ul class=""><li id="0e81" class="mr ms iq ky b kz la lc ld lf oj lj ok ln ol lr my mz na nb bi translated"><strong class="ky ir">模型碎片</strong>:我们的模型文件很大，默认的tensorflow.js将模型分解成5 MB的碎片。为了部署移动应用程序，我们需要一个文件，所以我们指定50，000，000字节的<code class="fe od oe of og b">weight_shard_size_bytes</code>来获取该文件。</li><li id="bb70" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated"><strong class="ky ir">推理-速度优化使用</strong> <code class="fe od oe of og b"><a class="ae kv" href="https://livebook.manning.com/book/deep-learning-with-javascript/chapter-12/1#search" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir">GraphModel</strong></a></code> <a class="ae kv" href="https://livebook.manning.com/book/deep-learning-with-javascript/chapter-12/1#search" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">转换</strong> </a></li></ul><blockquote class="om on oo"><p id="e27d" class="kw kx op ky b kz la jr lb lc ld ju le oq lg lh li or lk ll lm os lo lp lq lr ij bi translated"><code class="fe od oe of og b">GraphModel</code>转换如何提升TensorFlow.js模型的推理速度？这是通过利用TensorFlow (Python)对模型的计算图进行精细粒度的提前分析来实现的。计算图分析之后是对图的修改，这些修改减少了计算量，同时保持了图的输出结果的数字正确性。</p></blockquote><ul class=""><li id="af54" class="mr ms iq ky b kz la lc ld lf oj lj ok ln ol lr my mz na nb bi translated"><strong class="ky ir">使用量化的推理速度优化:</strong>量化是一种减少模型大小的后训练技术。这里，我们使用量化将默认的32位精度降低到16位精度，这将使模型文件大小减半。</li></ul><p id="2885" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将所有3个转换步骤合并为:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="d11a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们保存了转换后的模型文件，并将其上传到移动repo的GitHub releases区域:<a class="ae kv" href="https://github.com/reshamas/deploying-mobile-app/release" rel="noopener ugc nofollow" target="_blank">deploying-mobile-app/release</a></p><p id="2e15" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些模型和类文件将在创建web应用程序时用作输入。</p><h2 id="faf0" class="nq ma iq bd mb nr ns dn mf nt nu dp mj lf nv nw ml lj nx ny mn ln nz oa mp ob bi translated">表MobileNetV2的型号大小</h2><p id="fbe3" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">请注意，量化的模型大小减少了50%，从14MB减少到6.9MB。两种模型大小的推断时间相似。在大多数情况下，<a class="ae kv" href="https://livebook.manning.com/book/deep-learning-with-javascript/chapter-12/1" rel="noopener ugc nofollow" target="_blank">文献</a>表明16位量化不会显著影响精度。</p><pre class="kg kh ki kj gt ot og ou ov aw ow bi"><span id="29e5" class="nq ma iq og b gy ox oy l oz pa">Web App:  Compare Model Size Before &amp; After Optimization and Quantization</span><span id="404d" class="nq ma iq og b gy pb oy l oz pa">╔═════════════╦════════════════════╗<br/>║ Model       ║ Model Size         ║ <br/>║             ║                    ║        <br/>╠═════════════╬════════════════════╣<br/>║ MobileNetV2 ║ 14MB               ║<br/>║             ║                    ║                   <br/>╠═════════════╬════════════════════╣<br/>║ MobileNetV2 ║  6.9MB             ║             <br/>║  (16-bit    ║                    ║                   <br/>║   quantized)║                    ║                   <br/>╚═════════════╩════════════════════╝</span></pre><h1 id="3331" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">第3部分:推理的考虑事项:在服务器上运行还是在客户机上运行</h1><h2 id="5874" class="nq ma iq bd mb nr ns dn mf nt nu dp mj lf nv nw ml lj nx ny mn ln nz oa mp ob bi translated">用户的延迟/网络连接</h2><p id="9082" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">在服务器端推理中，一旦接收到图片/文本，推理时间是一致的。但是，总时间是由用户的网络上传速度决定的。在<em class="op">客户端</em>推理中，推理时间取决于用户运行的<em class="op">硬件</em>。</p><h2 id="5413" class="nq ma iq bd mb nr ns dn mf nt nu dp mj lf nv nw ml lj nx ny mn ln nz oa mp ob bi translated">隐私</h2><p id="4df8" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">对于敏感数据，用户可能不愿意将数据发送到服务器。客户端推理允许用户安全地运行他们的工作负载。</p><h2 id="4b87" class="nq ma iq bd mb nr ns dn mf nt nu dp mj lf nv nw ml lj nx ny mn ln nz oa mp ob bi translated">模型的未来更新</h2><p id="3fcb" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">服务器端推理的一个好处是能够部署新的、最先进的模型并持续更新它们。在客户端推理中，新模型的部署受到用户表示的更新频率的限制。</p><h2 id="6957" class="nq ma iq bd mb nr ns dn mf nt nu dp mj lf nv nw ml lj nx ny mn ln nz oa mp ob bi translated">最先进的模型与移动优化</h2><p id="2f07" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">由于客户端硬件和存储的限制，小型且针对推理优化的模型是理想的。web上的大多数网站都是不到2 MB的JavaScript代码和CSS。我们创建的最简单的模型大约为20 MB，这对于在web上提供服务来说仍然不理想。因此，目前大多数模型都是在服务器上提供的。</p><h1 id="ad94" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">第4部分:部署Web应用程序</h1><p id="8fb9" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">我们使用这个模板库来部署web。模板库是一个web应用程序，它同时执行服务器端和基于浏览器的推理:<br/> <a class="ae kv" href="https://github.com/reshamas/deploying-web-app.git" rel="noopener ugc nofollow" target="_blank"> deploying-web-app </a></p><p id="5d20" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将模型复制到我们的分叉回购中。</p><p id="15af" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是来自Colab的原始文件:<code class="fe od oe of og b">model.h5</code> <br/>这是转换后的TensorFlow.js文件:<code class="fe od oe of og b">model_tfjs</code></p><p id="0409" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">包含模型文件的存储库的结构如下。我们将原始的和转换后的模型放在目录<code class="fe od oe of og b">backend/assets</code>中。</p><pre class="kg kh ki kj gt ot og ou ov aw ow bi"><span id="50e9" class="nq ma iq og b gy ox oy l oz pa">├── backend<br/>│   ├── app.py<br/>│   ├── assets<br/>│   │   ├── classes.json<br/>│   │   ├── model_tf<br/>|   |   |──├──model.h5<br/>│   │   └── model_tfjs<br/>│   │       ├── group1-shard1of1.bin<br/>│   │       └── model.json</span></pre><h2 id="17f8" class="nq ma iq bd mb nr ns dn mf nt nu dp mj lf nv nw ml lj nx ny mn ln nz oa mp ob bi translated">在本地提供Web应用</h2><p id="821b" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">在Python中提供web应用程序有多种选择，包括Flask、Django和FastAPI。</p><p id="2dfc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们使用FastAPI提供浏览器应用程序，并使用React作为前端框架。</p><p id="e364" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们使用Docker在本地运行该应用程序。</p><p id="fa30" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">repo提供了一个<a class="ae kv" href="https://github.com/reshamas/deploying-web-app/blob/main/Dockerfile" rel="noopener ugc nofollow" target="_blank"> Docker文件</a>来运行应用程序。运行这些命令来启动应用程序。第一次使用Docker运行时，可能需要10分钟。这个命令需要在您的repo的基础层运行，这里有<code class="fe od oe of og b">Dockerfile</code>文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="de74" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行以上两个命令会启动一个在本地机器上运行的web服务器。</p><p id="1725" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可以在<a class="ae kv" href="http://localhost:8000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8000 </a>本地访问服务器。</p><p id="7132" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">瞧啊。我们有一个本地运行的web应用程序！它看起来像下面的演示。</p><h2 id="3f70" class="nq ma iq bd mb nr ns dn mf nt nu dp mj lf nv nw ml lj nx ny mn ln nz oa mp ob bi translated">Web应用程序演示</h2><p id="d6e1" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">这款应用在<a class="ae kv" href="https://manning-deploy-imagenet.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">manning-deploy-imagenet.herokuapp.com</a>生产</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pc"><img src="../Images/92c317a83fa36cc8053a4b8a55841a40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*guBzW49UCm8kwtvI5Zaqjw.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h2 id="e211" class="nq ma iq bd mb nr ns dn mf nt nu dp mj lf nv nw ml lj nx ny mn ln nz oa mp ob bi translated">向云平台提供Web应用(Heroku)</h2><p id="ab1a" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">Heroku 是一个很好的免费应用部署选项。</p><p id="6bba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦安装了Heroku命令行工具，就可以使用下面的命令运行它。</p><p id="774d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用独特的东西代替<code class="fe od oe of og b">APP_NAME</code>。根据您的互联网上传速度，以下步骤可能需要一些时间(5到10分钟)。对于我们的项目，我们设置<code class="fe od oe of og b">APP_NAME="manning-deploy-imagenet"</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="afec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这款应用可以在这里试用:<a class="ae kv" href="https://manning-deploy-imagenet.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">manning-deploy-imagenet.herokuapp.com</a></p><h1 id="5c9b" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">推理次数</h1><p id="cc5e" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">我们测量了几个样本图像的延迟。我们实验了不同大小的图片，并在桌面和手机上访问了该网站。</p><h2 id="2079" class="nq ma iq bd mb nr ns dn mf nt nu dp mj lf nv nw ml lj nx ny mn ln nz oa mp ob bi translated">表Web应用程序的推理时间</h2><pre class="kg kh ki kj gt ot og ou ov aw ow bi"><span id="a520" class="nq ma iq og b gy ox oy l oz pa">Web App:  Compare Inference Times</span><span id="b32f" class="nq ma iq og b gy pb oy l oz pa">╔═════════════╦════════════════════╦═══════════════════╦════════╗<br/>║ Inference   ║ Desktop Browser    ║ Mobile Browser    ║ Model  ║<br/>║ Source      ║ duration           ║ duration          ║ Size   ║<br/>║             ║ (Inference in ms)  ║ (Inference in ms) ║        ║        <br/>╠═════════════╬════════════════════╬═══════════════════╣════════╣<br/>║ Server      ║ 559                ║ 594               ║ 29MB   ║<br/>║ (Heroku)    ║ (202)              ║ (180)             ║        ║ <br/>╠═════════════╬════════════════════╬═══════════════════╣════════╣<br/>║ Browser     ║ 50                 ║ 177               ║ 6.9MB  ║<br/>║             ║                    ║                   ║        ║ <br/>╚═════════════╩════════════════════╩═══════════════════╩════════╝</span><span id="b25c" class="nq ma iq og b gy pb oy l oz pa"><strong class="og ir">NOTES<br/></strong>The above results show the latency cost associated with sending an image to the server for inference.</span><span id="9f43" class="nq ma iq og b gy pb oy l oz pa">* For the Server (Heroku) model, it is the h5 file, the keras model.<br/>* For the Browser model, it is the post-training quantized and optimized model. (converted using TensorFlow.js)</span></pre><h1 id="2465" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">第5部分:部署移动应用程序</h1><p id="f7cd" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">让推理在移动应用上本地运行的好处是，它可以在没有互联网连接的情况下运行。因为模型运行在用户的设备上，所以延迟较低。在设备上本地运行的推理也保护了用户的隐私。</p><p id="3f4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们使用React Native和TensorFlowJS React Native adaptor，因为它允许我们构建跨平台的移动应用程序。</p><p id="3c43" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们使用这个模板库来部署移动网络；它适用于iOS和Android: <a class="ae kv" href="https://github.com/reshamas/deploying-mobile-app" rel="noopener ugc nofollow" target="_blank">部署移动应用</a></p><p id="0782" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将<code class="fe od oe of og b">tfjs</code>转换后的模型文件上传到<a class="ae kv" href="https://github.com/reshamas/deploying-mobile-app/releases" rel="noopener ugc nofollow" target="_blank">发布</a>部分。</p><p id="0bbd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">推理发生在文件<code class="fe od oe of og b"><a class="ae kv" href="https://github.com/reshamas/deploying-mobile-app/blob/main/components/ModelService.tsx#L110" rel="noopener ugc nofollow" target="_blank">ModelService.tsx</a></code>中。为了初始化TensorFlow.js模型，<code class="fe od oe of og b">ModelService.tsx</code>在<code class="fe od oe of og b">create</code>方法中调用下面的代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="4710" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是用于从<code class="fe od oe of og b">classifyImage</code>中使用的图像获得预测的核心代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="d5f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://expo.io/" rel="noopener ugc nofollow" target="_blank"> Expo </a>是一个围绕React Native构建的免费开源工具链，帮助使用JavaScript和React构建跨平台的原生iOS和Android项目。通常用于构建应用程序的JavaScript环境是<a class="ae kv" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">节点</a>。为了运行这个应用，我们使用了<a class="ae kv" href="https://classic.yarnpkg.com/en/docs/install" rel="noopener ugc nofollow" target="_blank"> yarn </a>，用于安装Expo之类的JavaScript包。安装<code class="fe od oe of og b">yarn</code>后，我们做了:</p><p id="e0a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe od oe of og b">yarn run start</code></p><p id="f083" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一步是打开Expo应用程序，登录后，您应该会看到应用程序列表。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pd"><img src="../Images/c99d8127664327a32c36a31d41c03ac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*th1xFW_U3bP8txOBi4-zJg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h2 id="8d03" class="nq ma iq bd mb nr ns dn mf nt nu dp mj lf nv nw ml lj nx ny mn ln nz oa mp ob bi translated">移动应用程序演示</h2><p id="e664" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">此移动应用程序在以下位置生产:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/8298072ea91ebb43ff474a0471a4d004.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*15yM2CfNQjOP-IcAmAGRbA.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h2 id="2935" class="nq ma iq bd mb nr ns dn mf nt nu dp mj lf nv nw ml lj nx ny mn ln nz oa mp ob bi translated">表4:比较移动应用程序的推理时间</h2><p id="cf39" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">注意:我们预计移动应用程序的推理时间会更快。这里有点慢。这可能是由于React本地适配器不成熟。</p><pre class="kg kh ki kj gt ot og ou ov aw ow bi"><span id="c39f" class="nq ma iq og b gy ox oy l oz pa">Mobile App:  Compare Inference Times<br/>╔═════════════╦════════════════════╦═══════════════════╗<br/>║ Inference   ║ Mobile Browser     ║ Mobile App        ║ <br/>║ Source      ║ duration           ║ duration          ║ <br/>║             ║ (Inference in ms)  ║ (Inference in ms) ║        <br/>╠═════════════╬════════════════════╬═══════════════════╣ <br/>║ Pixel 1     ║ 310                ║ 411               ║ <br/>║ (2016)      ║                    ║                   ║ <br/>╠═════════════╬════════════════════╬═══════════════════╣ <br/>║ iPhone XS   ║ 220                ║ 327               ║       <br/>║ (2019       ║                    ║                   ║        <br/>╚═════════════╩════════════════════╩═══════════════════╝</span><span id="dbc5" class="nq ma iq og b gy pb oy l oz pa"><strong class="og ir">NOTES<br/></strong>Both the mobile browser and app allow you to run inference in less than 1 second. This performance is acceptable for a mobile app.</span></pre><h1 id="bf67" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">摘要</h1><p id="d6f8" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">本文概述了如何使用TensorFlow运行深度学习分类器，以及如何在web和移动设备上服务该模型。如需更多分步说明，请查看我们的Manning liveProject: <a class="ae kv" href="https://www.manning.com/liveproject/deploying-a-deep-learning-model-on-web-and-mobile-applications?utm_source=dataumbrella&amp;utm_medium=affiliate&amp;utm_campaign=liveproject_pattaniyil_02_03_21&amp;utm_content=published&amp;a_aid=dataumbrella&amp;a_bid=187b748d" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">在Web和移动应用上部署深度学习模型</strong> </a>(使用TensorFlow和React)。这个项目的第一个里程碑，主要是训练模型，是公开的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/dda64c51b28c3b315869a5ca04aa37a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:432/format:webp/1*UXXVc0CQcrsgo3rCgoVCUg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">liveProject: <a class="ae kv" href="https://www.manning.com/liveproject/deploying-a-deep-learning-model-on-web-and-mobile-applications?utm_source=dataumbrella&amp;utm_medium=affiliate&amp;utm_campaign=liveproject_pattaniyil_02_03_21&amp;utm_content=published&amp;a_aid=dataumbrella&amp;a_bid=187b748d" rel="noopener ugc nofollow" target="_blank">部署深度学习模型</a></p></figure><p id="2d6f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将重点放在使用TensorFlow-serving的演示上，因为用于部署移动应用程序的TensorFlow生态系统比PyTorch更加成熟。PyTorch Mobile大约在2019年10月发布，TensorFlow Lite在2017年5月发布。</p><h1 id="f748" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">录像</h1><p id="1111" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">我们在PyData Global 2021上介绍了这个主题。有一个30分钟的视频，结尾有问答讨论。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pg oi l"/></div></figure><h1 id="7489" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">参考</h1><ul class=""><li id="f855" class="mr ms iq ky b kz mt lc mu lf mv lj mw ln mx lr my mz na nb bi translated"><a class="ae kv" href="https://www.manning.com/liveproject/deploying-a-deep-learning-model-on-web-and-mobile-applications" rel="noopener ugc nofollow" target="_blank">在网络和移动应用上部署深度学习模型</a> (TensorFlow，React)【Manning live project】</li><li id="489f" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">GitHub repo:<a class="ae kv" href="https://github.com/reshamas/deploying-web-app" rel="noopener ugc nofollow" target="_blank">deploying-we b-app</a>(tensor flow，React)</li><li id="9054" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">GitHub repo: <a class="ae kv" href="https://github.com/reshamas/deploying-mobile-app" rel="noopener ugc nofollow" target="_blank">部署-手机-app </a> (TensorFlow，React Native)</li><li id="7e97" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated"><a class="ae kv" href="https://reshamas.github.io/deploying-deep-learning-models-on-web-and-mobile/" rel="noopener ugc nofollow" target="_blank">在Web和移动上部署深度学习模型</a> (fastai，PyTorch，React)</li><li id="26ac" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated"><a class="ae kv" href="https://livebook.manning.com/book/deep-learning-with-javascript/chapter-12" rel="noopener ugc nofollow" target="_blank">深度学习与JavaScript:tensor flow . js中的神经网络</a>作者蔡、Stanley Bileschi、Eric D. Nielsenn和Francois Chollet第十二章。测试、优化和部署模型</li></ul></div></div>    
</body>
</html>