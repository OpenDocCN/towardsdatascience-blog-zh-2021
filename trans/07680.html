<html>
<head>
<title>How To Dockerize an Existing Ruby on Rails Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何对接现有的Ruby on Rails应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-dockerize-an-existing-ruby-on-rails-application-3eb6d16ec392?source=collection_archive---------4-----------------------#2021-07-14">https://towardsdatascience.com/how-to-dockerize-an-existing-ruby-on-rails-application-3eb6d16ec392?source=collection_archive---------4-----------------------#2021-07-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6211" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">轻松运行rails应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b7d1b908ca98c9196658ababe2a8056d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*q7rogtXQUH8xZ9LT"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@sincerelymedia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">真诚媒体</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="1066" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di"> R </span> uby on Rails是一个基于Ruby的开源web应用开发框架。许多大公司使用Rails来构建他们的产品，如GitHub、Shopify、Airbnb和Twitch。</p><p id="ca59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过这篇文章，您将了解如何将现有的Ruby on Rails应用程序进行dockerize，从而使开发更快更容易。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="d81c" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">设置</h1><p id="e9a4" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">首先，我们需要安装<a class="ae ky" href="https://docs.docker.com/engine/install/" rel="noopener ugc nofollow" target="_blank"> Docker </a>并从<a class="ae ky" href="https://github.com/lifeparticle/Rails-Docker/tree/main" rel="noopener ugc nofollow" target="_blank"> GitHub </a>下载一个git库。对于这个设置，我使用的是macOS。</p><p id="96dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将创建一个包含Ruby on Rails的Docker映像。让我们分解一下<a class="ae ky" href="https://github.com/lifeparticle/Rails-Docker/blob/main/Dockerfile" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> Dockerfile </strong> </a>文件的各个成分。</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="36d7" class="nn mm it nj b be no np l nq nr">FROM ruby:3.0.0<br/><br/>RUN apt-get update -qq \<br/>&amp;&amp; apt-get install -y nodejs postgresql-client<br/><br/>ADD . /Rails-Docker<br/>WORKDIR /Rails-Docker<br/>RUN bundle install<br/><br/>EXPOSE 3000<br/><br/>CMD ["bash"]</span></pre><p id="6eec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们使用<code class="fe ns nt nu nj b">From</code>指令来定义父图像。我们使用来自Docker Hub的预建的官方图像。之后，我们使用<code class="fe ns nt nu nj b">RUN</code>指令安装所有的依赖项。现在我们需要使用<code class="fe ns nt nu nj b">ADD</code>指令将当前文件夹中的所有内容添加到镜像中名为<strong class="lb iu"> Rails-Docker </strong>的目录中。<code class="fe ns nt nu nj b">WORKDIR</code>指令将工作目录设置为<strong class="lb iu"> Rails-Docker </strong>。我们再次使用<code class="fe ns nt nu nj b">RUN</code>指令来安装我们的ruby gems。之后，我们使用expose指令公开容器的端口3000。默认情况下，Rails运行在端口3000上。最后，<code class="fe ns nt nu nj b">CMD</code>指令用于在容器启动时运行命令。在本例中，它用于打开bash shell。</p><p id="65b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们需要运行<strong class="lb iu"> db </strong>和<strong class="lb iu"> web </strong>容器。为此，我们将创建一个Docker合成文件。我们来分解一下<a class="ae ky" href="https://github.com/lifeparticle/Rails-Docker/blob/main/docker-compose.yml" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">docker-compose . yml</strong></a>文件的各个成分。</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="e1a9" class="nn mm it nj b be no np l nq nr">version: '3.8'<br/>services:<br/>  db:<br/>    image: postgres<br/>    environment:<br/>      POSTGRES_USER: postgres<br/>      POSTGRES_PASSWORD: password<br/>    volumes:<br/>      - postgres:/var/lib/postgresql/data<br/>  web:<br/>    build: .<br/>    command: bash -c "rm -f tmp/pids/server.pid &amp;&amp; bundle exec rails s -p 3000 -b '0.0.0.0'"<br/>    volumes:<br/>      - .:/Rails-Docker<br/>    ports:<br/>      - "3000:3000"<br/>    depends_on:<br/>      - db<br/>volumes:<br/>  postgres:</span></pre><p id="86bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">版本</strong>标签用于定义合成文件格式。<strong class="lb iu">服务</strong>标签用于定义我们的应用程序想要使用的服务。这里，我们有两个服务叫做<strong class="lb iu"> db </strong>和<strong class="lb iu"> web </strong>。</p><p id="46d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<strong class="lb iu"> db </strong>服务下，我们使用预先构建的postgres映像来构建映像。然后我们有环境变量。最后，我们有一个名为<strong class="lb iu"> postgres </strong>的命名卷来保存数据。</p><p id="3a48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<strong class="lb iu"> web </strong>服务下，我们使用之前创建的docker文件来构建图像。<strong class="lb iu">命令</strong>标签用于运行我们的应用程序。我们使用“0.0.0.0 ”,因此服务器将监听所有可用的IP地址。<strong class="lb iu">端口</strong>标签用于定义主机和容器端口。它将主机上的端口3000映射到容器上的端口3000。最后，<strong class="lb iu"> volumes </strong>标签用于将文件夹从主机挂载到容器。</p><p id="0984" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在从<strong class="lb iu"> docker-compose.yml </strong>文件所在的目录运行以下命令。此命令将启动并运行整个应用程序。</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="3396" class="nn mm it nj b be no np l nq nr">docker compose up</span></pre><p id="ab83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果遇到错误“active record::nodatabaserror ”,请运行以下命令创建数据库。</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="7299" class="nn mm it nj b be no np l nq nr">docker-compose run web rake db:create</span></pre><p id="750b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">恭喜你！现在，您可以通过访问URL<a class="ae ky" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/</a>来访问Rails应用程序。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="6cc4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这能帮助你开始使用Rails和Docker。现在使用Rails创建你的下一个大东西。编码快乐！</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="c53a" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">相关职位</h1><div class="nv nw gp gr nx ny"><a rel="noopener follow" target="_blank" href="/how-to-dockerize-an-existing-sinatra-application-3a6943d7a428"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">如何对现有的Sinatra应用程序进行Dockerize</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">轻松运行Sinatra应用程序</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">towardsdatascience.com</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om ks ny"/></div></div></a></div><div class="nv nw gp gr nx ny"><a rel="noopener follow" target="_blank" href="/how-to-dockerize-an-existing-flask-application-115408463e1c"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">如何对接现有的Flask应用程序</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">轻松运行烧瓶应用程序</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">towardsdatascience.com</p></div></div><div class="oh l"><div class="on l oj ok ol oh om ks ny"/></div></div></a></div></div></div>    
</body>
</html>