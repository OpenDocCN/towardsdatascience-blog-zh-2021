<html>
<head>
<title>The hidden world of GPU inefficiency</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GPU低效的隐藏世界</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-hidden-world-of-gpu-inefficiency-776ae1c9cf5?source=collection_archive---------36-----------------------#2021-05-05">https://towardsdatascience.com/the-hidden-world-of-gpu-inefficiency-776ae1c9cf5?source=collection_archive---------36-----------------------#2021-05-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="cfcb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一种重要、强大、珍贵的资源大多处于闲置状态。为什么？</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/5990849699426a341d22e07d9d235fab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IwOKnzstt7N7Qgm0DnxbdA.jpeg"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">在<a class="ae kw" href="/s/photos/sleeping-lion?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae kw" href="https://unsplash.com/@veverkolog?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Duan veverkolog</a>拍摄的照片</p></figure><p id="64ac" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><em class="lt">就像一头沉睡的狮子，我们已经使用的图形处理器比看起来要强大得多</em></p><p id="118f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">本文是三篇系列文章中的第二篇。这里有 <a class="ae kw" href="https://medium.com/swlh/the-crisis-in-computing-how-a-looming-processing-pinch-could-make-or-break-the-global-economy-856956756df4" rel="noopener"> <em class="lt"> 1 </em> </a> <em class="lt">和</em> <a class="ae kw" href="https://medium.com/geekculture/gpu-should-be-as-effortless-as-electricity-a7613df102d7" rel="noopener"> <em class="lt"> 3 </em> </a> <em class="lt">。</em></p><p id="d6bb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi lu translated"><span class="l lv lw lx bm ly lz ma mb mc di">在</span> <a class="ae kw" href="https://medium.com/swlh/the-crisis-in-computing-how-a-looming-processing-pinch-could-make-or-break-the-global-economy-856956756df4" rel="noopener">的上一篇文章</a>中，我们探讨了近期的业务转型如何受到GPU供应紧张的威胁。我们知道GPU是新兴技术的关键资源，费用已经成为许多组织的瓶颈，GPU(和相关新兴芯片设计)的需求和供应方面的宏观趋势都指向严重短缺。</p><p id="b0e6" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">然而<em class="lt"> </em> <a class="ae kw" href="https://www.nextplatform.com/2020/11/17/counting-the-cost-of-under-utilized-gpus-and-doing-something-about-it/" rel="noopener ugc nofollow" target="_blank"> <em class="lt">超过85%的GPU总容量闲置</em> </a> <em class="lt">。</em>对于使用GPU的公司来说，这不仅在财务上非常低效，而且从环境角度来看也非常令人震惊— <a class="ae kw" href="https://www.sciencedaily.com/releases/2021/03/210302185414.htm" rel="noopener ugc nofollow" target="_blank">全球计算的大部分排放、有毒化学物质和水消耗都是由制造过程造成的</a>，如果我们能够以更少的资源做更多的事情，所有这些都会大幅减少。我们当然不会容忍我们生产的85%的汽油被浪费掉。那么为什么我们会容忍GPU被如此低效的使用呢？</p><p id="2ea3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">简短的回答是:因为(目前)我们几乎没有选择，由于我们如何将软件应用程序连接到他们需要的GPU的现状约束。</p><h2 id="8e16" class="md me iq bd mf mg mh dn mi mj mk dp ml lg mm mn mo lk mp mq mr lo ms mt mu mv bi translated">GPU已经被排除在分解和虚拟化趋势之外</h2><p id="19bd" class="pw-post-body-paragraph kx ky iq kz b la mw jr lc ld mx ju lf lg my li lj lk mz lm ln lo na lq lr ls ij bi translated">几十年来，计算的趋势已经从集中式系统转向分散式服务。虚拟机、网络连接存储、软件定义的网络、容器—所有这些都促使当今的计算环境比以往任何时候都更加灵活和高效。</p><p id="494d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">但是，尽管加速器在现代数据中心的重要性不断上升，GPU却像一个疼痛的拇指一样突出，在其配置中保持顽固的静态。</p><h2 id="0edd" class="md me iq bd mf mg mh dn mi mj mk dp ml lg mm mn mo lk mp mq mr lo ms mt mu mv bi translated">PCIe皮带的物理束缚</h2><p id="3cd7" class="pw-post-body-paragraph kx ky iq kz b la mw jr lc ld mx ju lf lg my li lj lk mz lm ln lo na lq lr ls ij bi translated">当然，有一些复杂的因素在起作用，但有一个主要的限制迫使我们进入这种不灵活的模型:运行GPU密集型应用程序的操作系统通过一种称为外围组件互连快速(Peripheral Component Interconnect Express，简称PCIe)的高吞吐量连接与GPU紧密相连。</p><p id="616c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">简单来说，应用程序向其GPU发送大量数据。发送的数据类型在很大程度上取决于用例(纹理、网格、图形的命令缓冲区、机器学习的训练数据集等)。)，但一般来说，用网络术语来说，GPU必须非常“接近”运行应用程序的操作系统(通常在同一台物理机器内)，从而使操作系统环境与GPU保持物理联系，通常是一对一的联系。</p><h2 id="0a86" class="md me iq bd mf mg mh dn mi mj mk dp ml lg mm mn mo lk mp mq mr lo ms mt mu mv bi translated">峰值工作负载和自私的利用率</h2><p id="1732" class="pw-post-body-paragraph kx ky iq kz b la mw jr lc ld mx ju lf lg my li lj lk mz lm ln lo na lq lr ls ij bi translated">当一个组织问“我们的GPU性能如何？”，他们可能会运行GPU基准测试。但基准测试旨在将GPU推向最大利用率——它们能告诉你的只是最佳情况下的性能场景。这就像你的汽车在下坡滑行时测量每加仑汽油的英里数一样——有趣，但不代表现实。你真正需要知道的是你在真实环境下行驶了多少英里。</p><p id="f001" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">正如我们在上一篇文章的<a class="ae kw" href="https://medium.com/swlh/the-crisis-in-computing-how-a-looming-processing-pinch-could-make-or-break-the-global-economy-856956756df4" rel="noopener">中提到的，在GPU上运行的大多数计算工作负载的真实环境非常“尖锐”——它们使用大量GPU，然后做一段时间其他事情，然后回来要求GPU再次努力工作，然后再做一段时间其他事情。</a></p><p id="2215" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">一分钟内真实的GPU利用率模式可能如下所示:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nb"><img src="../Images/67957a9b52624f15b5a6d1c0ff2df16d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Wk6EBJPWvFErD1_9"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">大量空白=低利用率</p></figure><p id="4f6c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">因此，一个组织可能知道其GPU的<em class="lt">最高</em>性能，并且可能知道100%的<em class="lt">数量</em>的GPU都在使用中。不太明显的是，每个单独的GPU(平均而言)的运行效率低于15%，因为它被一个物理上受限制的操作系统实例“自私地”使用，该实例呈现出一种峰值利用率模式。</p><p id="b558" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">这就是GPU低效的隐藏世界。</strong></p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><p id="00ba" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">停下来思考一下这其中的含义:</p><p id="e213" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">出于某种目的，您的企业决定通过GPU在高性能计算方面进行重大(几乎肯定会不断增长)投资，无论是图形(可能是视频游戏开发或动画)还是纯计算(可能是深度学习)，并且已经购买或租赁了内部部署的GPU硬件，正在从云提供商处租赁，或者两者兼而有之。</p><p id="9467" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">但是，理所当然的现状自私的操作模式，通过物理束缚的一个操作系统实例到一个GPU模型服务的尖峰工作负载，<em class="lt">导致85%的投资被浪费。</em></p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h2 id="74dd" class="md me iq bd mf mg mh dn mi mj mk dp ml lg mm mn mo lk mp mq mr lo ms mt mu mv bi translated">今天，提高利用率的尝试非常有限</h2><p id="af40" class="pw-post-body-paragraph kx ky iq kz b la mw jr lc ld mx ju lf lg my li lj lk mz lm ln lo na lq lr ls ij bi translated">当然，有一些现有的提高GPU效率的策略，如果我没有提到它们，那将是我的失职。这里有助于对<em class="lt">分割</em>和<em class="lt">共享</em>进行关键区分:</p><p id="caf7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">分割:</strong>将GPU容量分割成更小的独立块(如<a class="ae kw" href="https://www.nvidia.com/en-us/technologies/multi-instance-gpu/" rel="noopener ugc nofollow" target="_blank"> MIG </a>)和/或预定时间块(使用类似<a class="ae kw" href="https://slurm.schedmd.com/overview.html" rel="noopener ugc nofollow" target="_blank"> Slurm </a>的编排系统)，每个块仍然一次只能由一个消费客户端使用。</p><p id="1498" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">分割根本不能解决自私的问题——任何给定的块仍然会经历峰值利用率。</p><p id="a36a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">共享:</strong>共享GPU容量，以便多个消费客户端同时使用，客户端的工作负载在同一个共享GPU区块内重叠。</p><p id="ee68" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">Nvidia的<a class="ae kw" href="https://www.nvidia.com/en-us/data-center/virtual-solutions/" rel="noopener ugc nofollow" target="_blank"> vGPU </a> <strong class="kz ir"> </strong>可以做到这一点，但所有消费客户端都必须是与GPU位于同一物理机上的虚拟机，这也是物理共享问题，它严重限制了池的大小，从而影响了GPU的利用率。</p><h2 id="b870" class="md me iq bd mf mg mh dn mi mj mk dp ml lg mm mn mo lk mp mq mr lo ms mt mu mv bi translated">“真正的”GPU共享填补了峰值，并提高了利用率</h2><p id="8f53" class="pw-post-body-paragraph kx ky iq kz b la mw jr lc ld mx ju lf lg my li lj lk mz lm ln lo na lq lr ls ij bi translated">想象一下“真正的共享”——允许许多客户端系统远程和同时访问许多GPU块，当它们的工作负载达到峰值时，块的利用率高达100%，但在需要时，将全部GPU容量留给其他客户端的峰值。像这样:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nb"><img src="../Images/f7234f6a9b7ca1cbc1f00fa2b8ef1a36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9iVGRXIsjDlI3kJl"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">空白少=高利用率</p></figure><p id="1925" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">就像我们的电网通过在一个广阔的区域汇集提供商和消费者来平衡容量，而不是在每个街区都建立一个发电站，极大地扩展客户端(GPU的消费者)和服务器(GPU的提供商)的池使给定的工作单元更有可能由合适大小的硬件单元来服务，让我们有效地匹配供应和需求。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nj"><img src="../Images/aeb03f206c1d2b54c4aea8a4eae4c183.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cLFTK1zGtBR7SXHetM5rmQ.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">由虚拟或物理GPU服务器(绿色)动态服务的大量虚拟或物理客户端(蓝色)</p></figure><p id="f8d2" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在这个世界中，GPU加速看起来更像是一项简单的服务，甚至是一个实用程序，最重要的是，它的利用率接近100%。</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><p id="bc1d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">实现这一愿景需要两大飞跃。</p><p id="8c4f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">首先，我们必须挣脱PCIe的束缚。尽管出现了增加PCIe范围以扩展池的解决方案，但池仍然是有限的，而且这些解决方案需要额外的专用昂贵硬件，并且不适合许多环境。</p><p id="9fb0" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">因此，第二，我们需要我们的解决方案是纯软件的。通过这种方式，我们可以针对任何加速器用例，在任何操作系统、任何设备和任何环境中无处不在地部署它，而不必担心太多的细节。与通过提高利用率创造的巨大价值相比，纯软件方法还可以轻松测试、轻松交付，并以较低的成本出售，因此各方都是赢家。</p><p id="b615" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们正在实现这两个飞跃。在我的下一篇文章中，我将解释这是如何做到的。</p><p id="00f8" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><em class="lt">史蒂夫·戈利克是</em> <a class="ae kw" href="https://www.juicelabs.co/" rel="noopener ugc nofollow" target="_blank"> <em class="lt">果汁实验室</em> </a> <em class="lt">的联合创始人，这是一家初创公司，其愿景是让计算能力像电力一样容易流动。</em></p></div></div>    
</body>
</html>