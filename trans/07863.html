<html>
<head>
<title>Developing a Timeseries Heatmap in Python Using Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Plotly在Python中开发时间序列热图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/developing-a-timeseries-heatmap-in-python-using-plotly-fcf1d69575a3?source=collection_archive---------8-----------------------#2021-07-19">https://towardsdatascience.com/developing-a-timeseries-heatmap-in-python-using-plotly-fcf1d69575a3?source=collection_archive---------8-----------------------#2021-07-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0fdb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Plotly创建每月和每小时数据的可视化热图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1f7e82ae6c7a98d864dc4ffd2cbcf1f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*X-WqQqMDKhlWtMrrx1VXPA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者视觉。</p></figure><h2 id="4fe3" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">介绍</h2><p id="e907" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">任何接触过数据的人都知道，时间序列数据可以说是我们日常处理的最丰富的数据类型。用日期、时间和/或两者索引的数据因此被分类为时间序列数据集。通常，将我们的时间序列呈现为每月和每小时的热图是有帮助的。这种强大的可视化非常有助于消化以其他方式呈现的数据，这些数据可能不会被我们高度可视化的自我吸收。这些渲染图通常水平描绘小时，垂直描绘月，并利用颜色来传达底层单元格所代表的值的强度。在这里，我们将把一个随机生成的时间序列数据集转换成一个交互式热图，这是Python最强大的绑定之一。</p><h2 id="12e5" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">编程堆栈</h2><p id="6df6" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">除了Python，我们还将利用Plotly、Pandas和Streamlit——数据科学社区中一些最强大的工具。我想很多人会对熊猫更加熟悉；另一方面，Plotly和Streamlit可能没有敲响多少钟。以下是对每一项的快速回顾:</p><p id="4a92" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated"><strong class="lw iu"> 1。熊猫</strong></p><p id="4de8" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">在处理数据时，Pandas无疑是Python中最有效的绑定之一。Pandas允许你在你的设备上执行一系列的变换，所有这些都是通过调用几个简短的命令来完成的。在我们的应用程序中，我们将使用Pandas从/向CSV文件中读取/写入我们的数据，并将我们的时间戳重组为一天中的月份和小时。</p><p id="3788" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated"><strong class="lw iu"> 2。阴谋地</strong></p><p id="08de" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">Plotly是一个健壮、敏捷的数据可视化库，专门为机器学习和数据科学工具定制。虽然它基于plotly.js，而plotly . js本身是一个本地Javascript绑定，但它已经扩展到支持Python、R和其他流行的脚本语言。通过在Python脚本中使用几行JSON，您可以轻松地调用交互式可视化，包括但不限于折线图、直方图、雷达图、热图等等。在这种情况下，我们将使用Plotly来呈现我们的月与小时热图。</p><p id="fe83" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated"><strong class="lw iu"> 3。流线型</strong></p><p id="bf23" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">Streamlit是Python库的无名英雄。它是一个纯粹的Python web框架，允许你开发和部署你的应用程序作为web应用程序，而不需要编写一行HTML或CSS，别开玩笑了。对我个人来说，我在2020年夏天开始使用Streamlit，从那以后我不记得在我写的脚本中没有使用过它。Streamlit允许您使用优雅且高度互动的用户界面即时呈现您的应用程序。对于此应用程序，我们将使用Streamlit在本地浏览器上描绘我们的热图和数据框。</p><h2 id="37ac" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">安装软件包</h2><p id="e965" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">首先，在您选择的Anaconda环境中安装下面的包。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="6e19" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">每个包都可以通过在Anaconda提示符下键入以下相应的命令来安装。</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="1e32" class="ky kz it mv b gy mz na l nb nc">pip install plotly</span></pre><h2 id="2af1" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">资料组</h2><p id="0617" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">我们将使用<a class="ae nd" href="https://raw.githubusercontent.com/mkhorasani/timeseries_heatmap/main/data.csv" rel="noopener ugc nofollow" target="_blank">这个</a>随机生成的数据集，它有一个日期、小时和值的列，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/87bf76b6477600d37cf290430a386667.png" data-original-src="https://miro.medium.com/v2/resize:fit:556/format:webp/1*Yns1Cme7ZpCnHrKjx5xyTQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><p id="e038" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">日期格式如下:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="e016" class="ky kz it mv b gy mz na l nb nc">YYYYMMDD</span></pre><p id="ec7e" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">而小时的格式为:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="cf52" class="ky kz it mv b gy mz na l nb nc">HHMM</span></pre><p id="5040" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">您可以使用任何其他适合您需要的格式来设置日期和/或小时的格式，但是您必须确保在您的脚本中声明它，如下一节所述。</p><h2 id="cd2d" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">数据预处理</h2><p id="ae56" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">在我们继续之前，我们需要预处理数据集，以确保日期和时间的格式可以进一步处理。</p><p id="eb19" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">最初，我们需要删除hour列中值的所有尾随小数位，并添加前导零以防时间少于一个整小时，即12:00AM引用为0。随后，我们需要将日期添加到小时中，并使用Python中的<strong class="lw iu"> datetime.strptime </strong>绑定，以可理解的格式解析它们。最后，我们可以通过使用<strong class="lw iu"> strftime </strong>函数将日期转换为月份，将小时转换为12小时制:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="9f89" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">为了使用其他日期时间格式，请参考<a class="ae nd" href="https://docs.python.org/3/library/datetime.html" rel="noopener ugc nofollow" target="_blank">这篇</a>文章。</p><p id="005f" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">一旦我们的数据经过预处理，我们就可以使用Pandas中强大的<strong class="lw iu">group by</strong>类将我们的数据集重新分组为月和小时的时间平均值，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="7616" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">请注意，可以使用其他方法代替平均值，即求和、最大值或最小值，方法是改变:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="4c7a" class="ky kz it mv b gy mz na l nb nc">df.groupby(['Month','Hour'],sort=False,as_index=False).mean()</span></pre><p id="66e2" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">到</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="c1bf" class="ky kz it mv b gy mz na l nb nc">df.groupby(['Month','Hour'],sort=False,as_index=False).sum()</span></pre><h2 id="257e" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">热图功能</h2><p id="44a4" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">现在，我们已经将数据重新分组为月和小时，我们首先需要将Pandas数据框转换为一个字典，然后转换为一个数组，可以输入到Plotly中来创建热图。</p><p id="558b" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">声明一个字典，请确保添加一年中的所有月份，不要截断，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="abee" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">随后，我们将把Pandas数据框中的值插入到字典中，并使用它创建一个数组，分别对应于每月和每小时的平均值，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="fba5" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">最后，我们将使用之前创建的数组来渲染我们的Plotly热图:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><h2 id="76dc" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">下载CSV</h2><p id="246a" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">您可能会发现将重新分组的月与小时数据框下载为CSV文件非常方便。如果是这样，请使用以下功能在您的Streamlit应用程序中创建一个可下载的文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="e4d8" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">该函数的参数— <em class="nf"> name </em>和<em class="nf"> df </em>分别对应需要转换为CSV文件的可下载文件和数据帧的名称。</p><h2 id="2deb" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">简化应用程序</h2><p id="a406" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">最后，我们可以将所有内容以Streamlit应用程序的形式组合在一起，该应用程序将呈现热图、数据框和一个链接，以便将我们重新分组的数据下载为CSV文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="1173" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">您可以通过在Anaconda提示符下键入以下命令来运行您的最终应用程序。首先，将根目录更改为保存源代码的位置:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="3225" class="ky kz it mv b gy mz na l nb nc">cd C:/Users/...</span></pre><p id="4b1b" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">然后键入以下内容运行您的应用程序:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="077a" class="ky kz it mv b gy mz na l nb nc">streamlit run file_name.py</span></pre><h2 id="04cc" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">结果</h2><p id="1c32" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">这就是交互式渲染，使您能够将时间序列数据集可视化为月与小时的热图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/9695e75b43b5699eba207c0df01f9c27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PqXIqMP2BcEh44CH9ucj2Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</p></figure><p id="9456" class="pw-post-body-paragraph lu lv it lw b lx mn ju lz ma mo jx mc lh mp me mf ll mq mh mi lp mr mk ml mm im bi translated">如果您想了解更多关于数据可视化和Python的知识，请随时查看以下(附属链接)课程:</p><h2 id="06b8" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">使用Streamlit开发Web应用程序:</h2><div class="nh ni gp gr nj nk"><a href="https://www.amazon.com/Web-Application-Development-Streamlit-Applications/dp/1484281101?&amp;linkCode=ll1&amp;tag=mkhorasani09-20&amp;linkId=a0cb2bc17df598006fd9029c58792a6b&amp;language=en_US&amp;ref_=as_li_ss_tl" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">使用Streamlit开发Web应用程序:开发和部署安全且可伸缩的Web应用程序…</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">使用Streamlit开发Web应用程序:使用……开发安全且可扩展的Web应用程序并将其部署到云中</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">www.amazon.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny ks nk"/></div></div></a></div><h2 id="7177" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">使用Python实现数据可视化:</h2><div class="nh ni gp gr nj nk"><a href="https://www.coursera.org/learn/python-for-data-visualization?irclickid=xgMQ4KWb%3AxyIWO7Uo7Vva0OcUkGQgW2aEwvr1c0&amp;irgwc=1&amp;utm_medium=partners&amp;utm_source=impact&amp;utm_campaign=3308031&amp;utm_content=b2c" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">用Python实现数据可视化</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">“一图胜千言”。我们都熟悉这个表达。它尤其适用于试图…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">www.coursera.org</p></div></div><div class="nt l"><div class="nz l nv nw nx nt ny ks nk"/></div></div></a></div><h2 id="ac9e" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">面向所有人的Python专业化:</h2><div class="nh ni gp gr nj nk"><a href="https://www.coursera.org/specializations/python?irclickid=xgMQ4KWb%3AxyIWO7Uo7Vva0OcUkGQgW16Ewvr1c0&amp;irgwc=1&amp;utm_medium=partners&amp;utm_source=impact&amp;utm_campaign=3308031&amp;utm_content=b2c" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">面向所有人的Python</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">学习用Python编程和分析数据。开发收集、清理、分析和可视化数据的程序…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">www.coursera.org</p></div></div><div class="nt l"><div class="oa l nv nw nx nt ny ks nk"/></div></div></a></div><h2 id="a899" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">GitHub资源库:</h2><div class="nh ni gp gr nj nk"><a href="https://github.com/mkhorasani/timeseries_heatmap" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">mkhorasani/timeseries_heatmap</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">使用Plotly创建每月和每小时数据的可视化热图</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">github.com</p></div></div><div class="nt l"><div class="ob l nv nw nx nt ny ks nk"/></div></div></a></div></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h1 id="0a01" class="oj kz it bd la ok ol om ld on oo op lg jz oq ka lk kc or kd lo kf os kg ls ot bi translated">新到中？您可以在此订阅和解锁无限文章<a class="ae nd" href="https://khorasani.medium.com/membership" rel="noopener">。</a></h1></div></div>    
</body>
</html>