<html>
<head>
<title>Take My Drift Away</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带走我的漂移</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/take-my-drift-away-650d0cd92168?source=collection_archive---------19-----------------------#2021-06-22">https://towardsdatascience.com/take-my-drift-away-650d0cd92168?source=collection_archive---------19-----------------------#2021-06-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ec7e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在你的机器学习模型中定义、测量和修正漂移</h2></div><p id="391a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">这篇博客是与达美航空公司数据科学经理</em> <a class="ae lc" href="https://www.linkedin.com/in/hua-ai-baaa335/" rel="noopener ugc nofollow" target="_blank"> <em class="lb">艾华</em> </a> <em class="lb">合作撰写的。在这一块，华和</em><a class="ae lc" href="https://www.linkedin.com/in/aparnadhinakaran/" rel="noopener ugc nofollow" target="_blank"><em class="lb">Aparna Dhinakaran</em></a><em class="lb">、CPO和</em><a class="ae lc" href="https://www.arize.com" rel="noopener ugc nofollow" target="_blank"><em class="lb">Arize AI</em></a><em class="lb">的联合创始人，共同探讨如何监控和排除模型漂移。</em></p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ld"><img src="../Images/df0172de7a6de698f399b9cd163ea670.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Im8wY0E93CMTwVb-DuIWAQ.png"/></div></div><p class="lp lq gj gh gi lr ls bd b be z dk translated">作者图片</p></figure><p id="5eca" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">作为一个ML从业者，你可能听说过漂移。在这篇文章中，我们将深入探讨什么是漂移，为什么跟踪漂移很重要，以及当漂移发生时如何排查和解决根本问题。</p><h1 id="1632" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">什么是漂移</h1><p id="a42e" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">首先，什么是漂移？漂移是分布随时间的变化。可以对模型输入、输出和实际值进行测量。漂移可能是因为您的模型变得陈旧，坏数据流入您的模型，甚至是因为敌对的输入。</p><p id="0320" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们知道了什么是漂移，我们如何跟踪它呢？从本质上来说，跟踪模型中的漂移相当于跟踪参考分布和当前分布(生产)之间发生了什么变化。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi mq"><img src="../Images/5fc6308e713b28d01e8a871421932c18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LLkIJceXeHSAFaWO"/></div></div><p class="lp lq gj gh gi lr ls bd b be z dk translated">作者图片</p></figure><p id="8dbe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">模型不是一成不变的。他们高度依赖接受训练的数据。特别是在数据不断发展的高速增长企业中，考虑漂移对于确保您的模型保持相关性非常重要。</strong></p><p id="c349" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">模型输入的变化几乎是不可避免的，您的模型不能总是优雅地处理这种变化。一些模型对输入分布的微小变化具有弹性；然而，由于这些分布与模型在训练中看到的相差甚远，手头任务的性能将受到影响。这种漂移称为<strong class="kh ir">特征漂移</strong>或<strong class="kh ir">数据漂移</strong>。</p><p id="8c87" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果唯一能改变的是你的模型的输入，那就太好了，但不幸的是，事实并非如此。假设您的模型是确定性的，并且您的特征管线中没有发生任何变化，如果它看到相同的输入，它应该会给出相同的结果。</p><p id="4bb9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">虽然这令人放心，但如果正确答案的分布(实际值)发生变化，会发生什么呢？即使你的模型做了和昨天一样的预测，它今天也会出错！这种实际偏差会导致模型性能的下降，通常被称为<strong class="kh ir">概念偏差</strong>或<strong class="kh ir">模型偏差</strong>。</p><h1 id="5a48" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">我如何测量漂移？</h1><p id="c316" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">如前所述，我们通过比较培训和生产之间的输入、输出和实际值的分布来测量漂移。</p><p id="6f98" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是你如何量化这些分布之间的距离呢？为此，我们有分布距离测量。举几个例子，我们有</p><ol class=""><li id="f67c" class="mr ms iq kh b ki kj kl km ko mt ks mu kw mv la mw mx my mz bi translated"><a class="ae lc" href="https://arize.com/blog-course/population-stability-index-psi/" rel="noopener ugc nofollow" target="_blank">人口稳定指数</a></li><li id="013b" class="mr ms iq kh b ki na kl nb ko nc ks nd kw ne la mw mx my mz bi translated">Kullback — Leibler散度(<a class="ae lc" href="https://arize.com/blog-course/kl-divergence/" rel="noopener ugc nofollow" target="_blank"> KL散度</a></li><li id="dad0" class="mr ms iq kh b ki na kl nb ko nc ks nd kw ne la mw mx my mz bi translated">瓦瑟斯坦距离</li><li id="d9fa" class="mr ms iq kh b ki na kl nb ko nc ks nd kw ne la mw mx my mz bi translated"><a class="ae lc" href="https://arize.com/blog-course/kolmogorov-smirnov-test/" rel="noopener ugc nofollow" target="_blank"> Kolmogorov Smirnov测试</a></li></ol><p id="4529" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">虽然这些分布距离度量在计算距离的方式上有所不同，但它们从根本上提供了一种量化两个统计分布差异的方法。</p><p id="5c40" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这很有用，因为你不能通过观察图表上的曲线来建立漂移监测系统。如果你有一个客观的、可量化的方法来衡量你的投入、产出和实际的分布是如何随时间变化的，那将是最好的。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi nf"><img src="../Images/5ac43b9bcbb7855ad406ee95f1fb1ff3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qz6NhHDCS3FYbONl"/></div></div><p class="lp lq gj gh gi lr ls bd b be z dk translated">作者图片</p></figure><p id="15ee" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，在上面的图中，我们看到了我去年和前一年的支出分布的比较。Y轴代表我在每一个类别中花费的钱的百分比，如x轴所示。为了查看我的资金分配在过去一年中是否有显著变化，我们可以计算这两种分布之间的总体稳定性指数(<a class="ae lc" href="https://arize.com/learn/course/drift/population-stability-index-psi/" rel="noopener ugc nofollow" target="_blank"> PSI </a>)。</p><p id="68bf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于预算中的每个类别，我们计算参考分布A(我去年的预算)和实际分布B(我今年的预算)之间的百分比差异，并将其乘以自然对数(A %/ B%)。对于这些类别中的每一个，取这个值的总和，这就是我们的PSI。</p><p id="29a3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">PSI越大，您的分布越不相似，这允许您设置分布漂移的阈值警报。</p><p id="f350" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不管您使用的分布距离度量是什么，重要的是不仅要测量分布中的漂移，还要测量这些距离度量与重要业务KPI和度量的关系。通过这样做，您可以开始了解漂移实际上会如何影响您的客户，并帮助您了解什么样的漂移阈值会触发对您团队的警报。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ng"><img src="../Images/738b19e709900a8ec9e05a08b71a4d62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2YbWXxTBd4_I1000"/></div></div><p class="lp lq gj gh gi lr ls bd b be z dk translated">作者图片</p></figure><h1 id="cc00" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">我可以重新培训我的模型吗？</h1><p id="c207" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">当我们发现一个训练好的模型漂移了，我们该怎么办？第一个想法可能是，“让我们重新训练它”！虽然再培训通常是必要的，但如何再培训需要更多的思考。简单地将最新的数据添加到您的训练集中并重新部署相同的模型架构可能无法解决问题。</p><p id="916a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，您必须小心如何对这些新数据进行采样并在模型中表示它们。如果您添加了太多的新数据，导致训练集中的数据过多，那么您就有可能过度适应这些新数据。这样做的话，您的模型将来可能无法很好地泛化，并且可能会影响它在以前没有问题的输入上的性能。</p><p id="0946" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一方面，如果你只添加了几个例子，你的模型很可能根本不会有太大的变化，而且你的模型可能仍然会犯你想要解决的错误。</p><p id="17e5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以通过对损失函数中的示例进行加权来调整这种权衡，以在这两种竞争力量之间取得适当的平衡。衡量如何平衡这种权衡的一种方法是，在一个全局采样的排除集上测量您的性能以近似您的泛化性能，并在另一个仅从较新的数据群体中采样的排除集上测量您的性能。如果你在全局保持开始时表现很好，但不是新的数据，你可以尝试在你的训练集中增加新数据的权重，反之亦然。</p><p id="6b91" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">虽然，在许多情况下，重新培训你的模型是正确的解决方案，但是一些变化是如此的根本，以至于简单的重新培训不能解决任何问题。如果您不能在重新训练的模型上获得可接受的验证性能，可能是时候重新开始了。如果你的业务发生了根本性的变化，你的模型可能也需要改变。</p><h1 id="ef39" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">如何排除漂移故障</h1><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi nh"><img src="../Images/9636c3e3442472ceff7d48a68a1e24b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ocb-Xpti24_TiEJW"/></div></div><p class="lp lq gj gh gi lr ls bd b be z dk translated">作者图片</p></figure><p id="bb70" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这一切都始于一个警报——一封电子邮件或一个通知，告诉我们有什么不对劲。通常，跟踪性能变化和输入数据的变化是一种很好的做法，因为这些变化可能会提供性能变化的答案。了解特定数据片或特定日期的漂移发生在哪里也很重要。这将有助于诊断模型并提出解决方案。</p><p id="abf2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当重大漂移警报触发一段时间后，需要进行系统评估。决定一个漂移变得有多重要通常是一种艺术而不是科学，因为它取决于预测如何被使用以及预测的商业价值。但是这里有一些步骤让你开始解决漂移。</p><p id="ca9e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">1.重新提取训练数据</p><p id="1202" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">确定哪些输入特征或结果变量发生了漂移，并了解它们的分布是如何变化的。仔细考虑再培训应该包括什么时间段。可以使用重采样或加权观察来重建更平衡的训练数据集。</p><p id="16c0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2.特征工程</p><p id="30ae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时，我们会注意到一些特性发生了显著变化，但并没有导致模型性能问题。这是不容忽视的，因为这表明了这些特征和结果变量之间的关系。重新构建和选择特征以适应该数据集中的新动态。</p><p id="c54d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这也是与模型的最终用户联系的好时机，以了解他们的业务流程是否发生了变化。通常需要新的特性来捕捉变化。</p><p id="1e14" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.模型结构</p><p id="b9cd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时，模型结构也应该被重新考虑。例如，如果只有一部分预测受到影响，分层模型有助于在不改变整个模型的情况下解决这一问题。</p><h1 id="0907" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">如何走在这个前面？</h1><p id="461e" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">如果你在消防演习中做这些事情，那将是最糟糕的。您接到业务合作伙伴的电话，要求您解释为什么模型在一天内表现不佳，因为他们需要向利益相关者解释不良的业务结果。用一组特定的数据点来解释一个模型的表现从来都不容易，尤其是在有压力的情况下。它还会导致人们做出短视的决定，过度调整模型以捕捉最新趋势。</p><p id="b731" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一个好的做法是设置一个节奏来定期检查模型性能，而不是完全依赖警报来指示何时出现了问题。定期审查有助于跟踪不断变化的业务动态和主动思考模型调整。此外，建立一个与最终用户沟通的常规渠道，听取他们对模型的反馈，或者了解即将到来的过程变化也是很重要的。在一天结束时，模型在那里支持最终用户。因此，用户感知与模型性能指标同等重要。</p><h1 id="370e" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">把漂移带走！</h1><p id="7c7f" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">正如我们所讨论的，漂移是ML可观测性的一个方面，测量是不够的。拥有解决漂移问题的工具有助于改善模型的寿命。</p><h2 id="d9de" class="ni lu iq bd lv nj nk dn lz nl nm dp md ko nn no mf ks np nq mh kw nr ns mj nt bi translated">联系我们</h2><p id="1c1a" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">如果这个博客引起了你的注意，并且你渴望了解更多关于机器学习的可观察性和<a class="ae lc" href="https://arize.com/model-monitoring/" rel="noopener ugc nofollow" target="_blank">模型监控</a>，请查看我们其他的<a class="ae lc" href="https://arize.com/blog/" rel="noopener ugc nofollow" target="_blank">博客</a>和资源！如果您有兴趣加入一个有趣的rockstar工程团队，帮助模型在生产中取得成功，请随时联系我们，并找到我们的空缺职位！</p></div></div>    
</body>
</html>