<html>
<head>
<title>Refactoring Machine Learning Projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">重构机器学习项目</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/refactoring-machine-learning-projects-f566607a7b6f?source=collection_archive---------34-----------------------#2021-06-25">https://towardsdatascience.com/refactoring-machine-learning-projects-f566607a7b6f?source=collection_archive---------34-----------------------#2021-06-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4cd6e298189d6ba8baf49eadc2f2f47e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NCjLkoVD6wGtnhJ_5phUhA.jpeg"/></div></div><p class="jy jz gj gh gi ka kb bd b be z dk translated">托德·夸肯布什在<a class="ae kc" href="https://unsplash.com/s/photos/tools?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="5c5f" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">从好(或坏)到好</h1><p id="4b93" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">作为数据科学家，我们花费大量的精力从头开始构建新的工具、管道和工作流。然而，随着我们的工作越来越成熟，我们最终都会发现自己面临这样的情况:我们需要对已经构建好的东西进行调整，而不是从头开始。拥有重构技能变得至关重要。</p><blockquote class="lz ma mb"><p id="926a" class="lb lc mc ld b le md lg lh li me lk ll mf mg lo lp mh mi ls lt mj mk lw lx ly ij bi translated">想象一下:你的公司有一个机器学习管道正在生产，它的预测正逐渐失去准确性。商业利益相关者在抱怨。他们指望你去“解决它”。现在怎么办？是时候进行重构了！</p></blockquote><h2 id="a5c1" class="ml ke iq bd kf mm mn dn kj mo mp dp kn lm mq mr kr lq ms mt kv lu mu mv kz mw bi translated"><strong class="ak">我们从什么开始？</strong></h2><p id="cebc" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">有些代码，功能性的(ish)，不知何故不能满足用户的所有需求。出于我们的目的，我们正在谈论机器学习模型或管道。</p><h2 id="f2c6" class="ml ke iq bd kf mm mn dn kj mo mp dp kn lm mq mr kr lq ms mt kv lu mu mv kz mw bi translated">谁写的？</h2><p id="fc8f" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">你或者其他人。这可能重要，也可能无关紧要——不久前的你对你现在的想法来说，可能和一个完全不同的人没什么不同。很难记住我们过去做了什么以及为什么，除非我们总是写完美的文档，但没人会这样做。</p><h2 id="267a" class="ml ke iq bd kf mm mn dn kj mo mp dp kn lm mq mr kr lq ms mt kv lu mu mv kz mw bi translated"><strong class="ak">为什么要重构？</strong></h2><p id="ddc9" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">要么它总是需要一些工作(当我们开发最小可行的产品时，这是常见和正常的)，要么它很棒，但是需求和环境已经改变了，所以你需要让它再次起作用。</p><p id="29e3" class="pw-post-body-paragraph lb lc iq ld b le md lg lh li me lk ll lm mg lo lp lq mi ls lt lu mk lw lx ly ij bi translated">你可能认为从头开始会更容易——这是可能的，但很可能会导致更多的工作。一个好的重构应该会节省时间，因为你可以在原作品的基础上构建。如果原作根本无法出售，那就是另一个问题了。</p><p id="04bf" class="pw-post-body-paragraph lb lc iq ld b le md lg lh li me lk ll lm mg lo lp lq mi ls lt lu mk lw lx ly ij bi translated">因此，让我们来讨论一些可能出现这种情况的特定ML示例。</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="8df5" class="kd ke iq bd kf kg ne ki kj kk nf km kn ko ng kq kr ks nh ku kv kw ni ky kz la bi translated">情节</h1><h2 id="34b2" class="ml ke iq bd kf mm mn dn kj mo mp dp kn lm mq mr kr lq ms mt kv lu mu mv kz mw bi translated"><strong class="ak">新维护者</strong></h2><p id="81e2" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">这可能意味着你正在接手别人做的项目，或者别人正在接手你的项目。这并不一定意味着重构是必要的，但是如果重构有价值的话，这是评估和实施重构的好机会。信息将被传递给一个新的人，而这个新的人可能有如何改进现有工具的想法！</p><h2 id="c162" class="ml ke iq bd kf mm mn dn kj mo mp dp kn lm mq mr kr lq ms mt kv lu mu mv kz mw bi translated"><strong class="ak">缩放</strong></h2><p id="a7fd" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">模型通常从对性能的最低期望开始。您的管道可能每小时服务一两个用户，或者每周接收新数据，但是现在它需要每分钟服务二十个用户，或者每小时接收数据。这种期望尺度的转变表明重构正在有序进行。</p><h2 id="2e72" class="ml ke iq bd kf mm mn dn kj mo mp dp kn lm mq mr kr lq ms mt kv lu mu mv kz mw bi translated"><strong class="ak">从研发阶段&amp;转向生产阶段</strong></h2><p id="14a9" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">如果您构建了一个模型来演示什么是可能的，那么将它转移到生产实现肯定需要一些更改。你必须确保该模型与它所依赖的或馈入的管道的其他元素相集成，并且你还需要确保它在规模上的性能。</p><h2 id="14b7" class="ml ke iq bd kf mm mn dn kj mo mp dp kn lm mq mr kr lq ms mt kv lu mu mv kz mw bi translated"><strong class="ak">模型漂移</strong></h2><p id="84e6" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">当模型数据环境中的某些因素发生变化，并且模型对数据中关系的预期不再正确时，就会发生模型漂移。这可能意味着你的模型认为变量A和结果B是线性相关的，但是现在结果B发生了变化，所以关系也发生了变化。你的模型不知道为什么，但是突然它对结果B的预测就错了。这意味着是时候回顾这个模型了，检查这些关系，也许重新训练或者重构这个模型来更好地反映它周围的世界。</p><h2 id="a2ff" class="ml ke iq bd kf mm mn dn kj mo mp dp kn lm mq mr kr lq ms mt kv lu mu mv kz mw bi translated"><strong class="ak">源数据变化</strong></h2><p id="1cab" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">这在业务中经常发生——模型上游的数据收集系统或数据工程管道发生变化，现在数据可能以不同的方式测量，或者以不同的量出现，或者添加或删除了一些功能。这些都会影响模型的性能，并且可能需要重构。即使在只有新特性可用的情况下，如果您的模型没有使用它们，但是可以通过添加它们来提高性能，那么您应该考虑重构来合并这些新信息。</p><h2 id="4edd" class="ml ke iq bd kf mm mn dn kj mo mp dp kn lm mq mr kr lq ms mt kv lu mu mv kz mw bi translated"><strong class="ak">？？？</strong></h2><p id="bd64" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">最后，还有一种情况是“它不起作用”，没有人知道为什么。这种情况比你想象的要多，尤其是当项目的原作者已经不在的时候。所有这些情况都说明了文档在机器学习中的关键重要性，因为理解代码和模型的情况比这要好得多。</p><p id="257c" class="pw-post-body-paragraph lb lc iq ld b le md lg lh li me lk ll lm mg lo lp lq mi ls lt lu mk lw lx ly ij bi translated">因此，你正面临一个机器学习项目，其中一种情况适用于你。现在怎么办？</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="381c" class="kd ke iq bd kf kg ne ki kj kk nf km kn ko ng kq kr ks nh ku kv kw ni ky kz la bi translated">时间</h1><p id="80eb" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">你需要意识到你周围的业务和实际限制。理想情况下，您将有时间和资源来深思熟虑地进行这种重构，并产生一个有弹性的结果，并将在相当长的时间内继续工作。</p><p id="2189" class="pw-post-body-paragraph lb lc iq ld b le md lg lh li me lk ll lm mg lo lp lq mi ls lt lu mk lw lx ly ij bi translated">当然，我们都知道情况并非总是如此。你可能时间紧迫，需要这个项目尽快重新开始。如果这是你的情况，那么你最好对项目做一个小小的修补，让事情正常运行。</p><p id="6bd3" class="pw-post-body-paragraph lb lc iq ld b le md lg lh li me lk ll lm mg lo lp lq mi ls lt lu mk lw lx ly ij bi translated">例如，如果提供给模型的数据流发生了变化，也许要找出您需要做的最小调整，这样模型才能产生合理的结果。完整的重构将涉及检查新的数据流，将其与原始数据流进行比较，可能使用新的数据选项重新训练模型，并设计新的管道。但权宜之计可能意味着找到最接近原始特征的新数据通道，格式化/重命名它们以适应模型预期，然后将它们粘合在一起。这并不理想，但短期内可能行得通。</p><p id="341c" class="pw-post-body-paragraph lb lc iq ld b le md lg lh li me lk ll lm mg lo lp lq mi ls lt lu mk lw lx ly ij bi translated">不过，从这里开始，让我们假设您有时间认真地进行重构。如何进行？</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="838c" class="kd ke iq bd kf kg ne ki kj kk nf km kn ko ng kq kr ks nh ku kv kw ni ky kz la bi translated">规划</h1><p id="16f6" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">有一件事你不应该做，那就是一头扎进代码编写中。相反，想想这个重构是关于什么的，你想要达到什么目的。</p><h2 id="1628" class="ml ke iq bd kf mm mn dn kj mo mp dp kn lm mq mr kr lq ms mt kv lu mu mv kz mw bi translated"><strong class="ak">设定目标来规划任务，避免任务进展</strong>。</h2><p id="dfd4" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">为什么要重构这个？这种重构成功的衡量标准是什么？你怎么知道什么时候完成了？</p><p id="ec5c" class="pw-post-body-paragraph lb lc iq ld b le md lg lh li me lk ll lm mg lo lp lq mi ls lt lu mk lw lx ly ij bi translated">一个模型可以有很多种改进:更短的代码，更干净的代码，更多的pythonic代码，更快的预测，更容易使用，更可读，更可解释，降维，更快的训练…你明白了。选择一两个，但是不要期望你会写出完美的管道或者模型。认真思考你能做什么，而不仅仅是在理想世界中什么会很酷或者你想做什么。事情会出现，优先事项会转移，你需要考虑什么是现实的。</p><h2 id="08a5" class="ml ke iq bd kf mm mn dn kj mo mp dp kn lm mq mr kr lq ms mt kv lu mu mv kz mw bi translated"><strong class="ak">看大局。</strong></h2><p id="e45f" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">有时发现小问题、小麻烦更容易，但是如果你要重构一段代码或一个项目，那么这个小问题可能预示着一个你可以修复的系统问题。在公共卫生领域，我们可以称之为根本原因分析——不要只治疗症状，而要着眼于造成这种情况的决定因素。</p><p id="ec4d" class="pw-post-body-paragraph lb lc iq ld b le md lg lh li me lk ll lm mg lo lp lq mi ls lt lu mk lw lx ly ij bi translated">例如，如果您的数据流中的一个通道发生了变化并出了问题，请不要认为您的所有其他数据通道仍然正常！他们可能是，或者他们可能已经悄悄地改变了，需要不同的处理。</p><h2 id="2ec5" class="ml ke iq bd kf mm mn dn kj mo mp dp kn lm mq mr kr lq ms mt kv lu mu mv kz mw bi translated"><strong class="ak">了解功能</strong>。</h2><p id="b633" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">即使当前的项目由于某种原因不够充分，它仍然有历史。不像从零开始一个项目，在重构中，对于项目应该如何运行有预先存在的期望。输出可能需要特定的格式，并且可能已经做出决定以适应原始代码的行为。当然，这并不意味着那些原始的行为是好的——但是你必须与用户的期望和组织的现实以及任何技术挑战作斗争。发展不是生活在真空中，它必须为周围的人服务。</p><p id="7ffa" class="pw-post-body-paragraph lb lc iq ld b le md lg lh li me lk ll lm mg lo lp lq mi ls lt lu mk lw lx ly ij bi translated">所有这些都引出了突破性变革的问题。如果你真的确定原来的行为是不好的，或者如果你需要的改进将要发生，它是不可持续的，那么你就在谈论做出突破性的改变。用户期望的行为将不再是这样，他们的旧代码很可能需要更改。你基本上是在为更多的重构创造级联需求。这可能是正确的做法！但你需要非常、非常确定和现实地认识到这对除你之外的人意味着什么。</p><h2 id="f305" class="ml ke iq bd kf mm mn dn kj mo mp dp kn lm mq mr kr lq ms mt kv lu mu mv kz mw bi translated">记录下来！</h2><p id="8d52" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">了解我的人都知道我非常喜欢文档。我只是认为让我们的工作真正有用非常重要。这在重构中有两种方式。</p><p id="e9d1" class="pw-post-body-paragraph lb lc iq ld b le md lg lh li me lk ll lm mg lo lp lq mi ls lt lu mk lw lx ly ij bi translated">首先，原始项目是否有文档记录？是否清楚所有元素做了什么，为什么？如果没有，你重构的第一步将是深入理解原始代码。阅读它，就像你计划记录它(或做它！)，你就会真正理解代码了。这是重构成功的关键。</p><p id="a5ce" class="pw-post-body-paragraph lb lc iq ld b le md lg lh li me lk ll lm mg lo lp lq mi ls lt lu mk lw lx ly ij bi translated">第二，你的重构需要被很好地记录，以便人们可以使用它，并且它将具有持久的力量。一般来说，这对于代码项目来说是正确的，但是在这种情况下，你的代码至少要替换掉某些以前被<em class="mc">某人</em>理解的东西，所以新的替换物需要易于插入和适应。另外，你的重构可能需要证明它足够好或者增加了价值，文档是一个很好的方法。</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="3ae9" class="kd ke iq bd kf kg ne ki kj kk nf km kn ko ng kq kr ks nh ku kv kw ni ky kz la bi translated">做工作</h1><p id="0c3b" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">此时，你知道你想要实现什么，你知道最初的项目做了什么，你知道哪里出了问题。您已经准备好编写代码了！因为你参与的计划，这应该容易得多。当你工作的时候，要记住更多的注意事项。</p><ul class=""><li id="7050" class="nj nk iq ld b le md li me lm nl lq nm lu nn ly no np nq nr bi translated"><strong class="ld ir">尽可能保留原项目</strong>。如果有人已经写了一些你可以使用的东西，不要重新发明轮子。同时，砍掉没用的。不要做代码包鼠。</li><li id="df67" class="nj nk iq ld b le ns li nt lm nu lq nv lu nw ly no np nq nr bi translated">尝试创造风格上的一致性。如果原始代码使用特定的代码风格约定，要么保留它，要么使整个项目适应您的新偏好。理想情况下，重构的结果不是不同代码约定的弗兰肯斯坦怪物，而是其他人可以容易理解的内聚整体。</li><li id="5479" class="nj nk iq ld b le ns li nt lm nu lq nv lu nw ly no np nq nr bi translated"><strong class="ld ir">在没有替代品</strong>或给用户一个好的理由/解释的情况下，不要取消功能。不要在主分支上砍去，在平行分支上开发，直到你的工作为用户准备好并且已经被评审。如果你决定需要一个突破性的改变，就像我们之前讨论的那样，那么就把它说清楚，并适当地设定人们的期望。</li><li id="d70f" class="nj nk iq ld b le ns li nt lm nu lq nv lu nw ly no np nq nr bi translated">如果可以的话，<strong class="ld ir">将测试或质量控制元素</strong>添加到你的重构中，这样将来的中断或问题更容易被识别。您现在是代码应该做什么的专家，所以您最有资格编写该功能的测试。这为你未来的成功和更轻松的工作打下了基础。</li></ul></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="8e8a" class="kd ke iq bd kf kg ne ki kj kk nf km kn ko ng kq kr ks nh ku kv kw ni ky kz la bi translated">完成任务</h1><p id="12fb" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">数据科学家常常会因为追求完美而陷入项目中。我从商业数据科学中学到的最大教训之一是，获得一个最低限度的可行产品并不可耻，尤其是当你能够快速产生商业价值的时候。你不必因为完成了基本要素就放弃改进工作，但是你也不能永远拖着这个项目。</p><p id="1f5f" class="pw-post-body-paragraph lb lc iq ld b le md lg lh li me lk ll lm mg lo lp lq mi ls lt lu mk lw lx ly ij bi translated">重构也是如此。正如我们在规划部分所讨论的，你不可能在一次重构中使这个项目完美——完美的代码是不存在的。代码总是一项进行中的工作，模型也是如此。无论你的重构做得多好，你的模型周围的环境总是有可能发生变化，需要一个新的重构。不要让这个阻碍你完成好工作。</p><p id="be86" class="pw-post-body-paragraph lb lc iq ld b le md lg lh li me lk ll lm mg lo lp lq mi ls lt lu mk lw lx ly ij bi translated">相反，要确保尽可能地向重构中添加更多的通用性和文档，以便将来的重构(几乎肯定会发生)更容易、更快——给未来的自己一份礼物。</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="d6a6" class="kd ke iq bd kf kg ne ki kj kk nf km kn ko ng kq kr ks nh ku kv kw ni ky kz la bi translated">结论</h1><p id="9333" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">我希望这能帮助你满怀信心地设想和实施你的下一次机器学习重构！深思熟虑地提前计划会让你和你的用户现在和将来的整个努力变得更容易。</p><p id="1659" class="pw-post-body-paragraph lb lc iq ld b le md lg lh li me lk ll lm mg lo lp lq mi ls lt lu mk lw lx ly ij bi translated"><em class="mc">免责声明:我是Saturn Cloud的高级数据科学家，Saturn Cloud是一个使用Dask实现Python易于使用的并行化和扩展的平台。如果你想了解更多关于土星云的信息，请访问我们的</em><a class="ae kc" href="https://www.saturncloud.io/" rel="noopener ugc nofollow" target="_blank"><em class="mc">www . Saturn Cloud . io</em></a><em class="mc">。</em></p><p id="857f" class="pw-post-body-paragraph lb lc iq ld b le md lg lh li me lk ll lm mg lo lp lq mi ls lt lu mk lw lx ly ij bi translated"><em class="mc"> Quick plug:如果您有关于生产化和/或扩展ML工作流的需求，Saturn Cloud可以提供帮助。我们提供了一个平台，可以消除扩展模型的苦差事，让您轻松访问多GPU集群和Dask，并让您做自己最擅长的事情——机器学习。我们还为企业客户提供重构和扩展模型支持。</em> <a class="ae kc" href="https://saturncloud.io/" rel="noopener ugc nofollow" target="_blank"> <em class="mc">今天就联系我们了解更多！</em>T15】</a></p></div></div>    
</body>
</html>