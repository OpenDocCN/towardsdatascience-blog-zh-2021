<html>
<head>
<title>Intro to Webhooks and How to Receive them with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">介绍 Webhooks 以及如何用 Python 接收它们</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/intro-to-webhooks-and-how-to-receive-them-with-python-d5f6dd634476?source=collection_archive---------3-----------------------#2021-10-27">https://towardsdatascience.com/intro-to-webhooks-and-how-to-receive-them-with-python-d5f6dd634476?source=collection_archive---------3-----------------------#2021-10-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f64f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">本教程将介绍 webhooks 的概念。我们还将构建一个简单的 Flask 服务器，它可以接收 GitHub webhooks。我们还将看到如何公开我们的本地主机。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a3838b9846afdf22952155e35cd3cfd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ictHo7zR8xb08pjetvvimQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@gigalilac?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Grace 到</a>在<a class="ae ky" href="https://unsplash.com/s/photos/hook?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><h1 id="e9e5" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">什么是 webhook？</h1><p id="a3a2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在说 webhooks 之前，先说一下 API。下面是一个 API 的数据流。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/d369c30fbd2d5e38230f96ce9163335e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fmNddmIMvyUts3Fw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者创建的图像</p></figure><p id="125d" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">您向 API 发出一个 GET/POST 请求，然后得到一个响应。如果你想学习更多关于使用 API 的知识，可以看看我关于使用 Python 使用<a class="ae ky" href="https://medium.com/p/94fddec609cc" rel="noopener">API 的文章，或者我关于使用 JavaScript </a>使用<a class="ae ky" href="https://medium.com/p/8360ce624d3a" rel="noopener">API 的文章。</a></p><p id="7d3a" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">考虑一下 Github API，如果我们想构建一个 API，每当回购中出现新问题时，它都会发送一封电子邮件。一种方法是构建一个 API，每隔 1-2 分钟发出一个请求，检查是否有新的问题出现并通知我们。这个过程被称为<a class="ae ky" href="https://tyk.io/blog/moving-beyond-polling-to-async-apis/#:~:text=APIs%20commonly%20require%20a%20client,requests%20data%20from%20the%20server.&amp;text=This%20pattern%20is%20known%20as,or%20notified%20of%20backend%20events." rel="noopener ugc nofollow" target="_blank">轮询</a>。基本上，我们必须定期请求检查新的问题。然而，这似乎是低效的。如果每当一个新问题产生时，GitHub 向我们的 API 发出请求，那该怎么办？这就是所谓的 webhook。我们不定期发出请求，我们只是给 Github 我们的 API 的端点，每当一个新的问题产生时，就会向我们给 GitHub 的端点发出请求。Webhooks 也被称为反向 API。下面是轮询和 webhooks 的比较。这张图片的灵感来自于<a class="ae ky" href="https://www.mailjet.com/blog/news/what-is-webhook/" rel="noopener ugc nofollow" target="_blank">这篇文章</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/fd47a14e864272ab9a2fb6cab6a1efdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xtlzLqJVtf6d9JyZ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由 Autho 创建的图像</p></figure><p id="329a" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">正如你可能已经注意到的，很多请求被发出，根据我们发出请求的频率，在新问题被创建和我们的 API 得到通知之间可能会有一点延迟。</p><p id="fa89" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">让我们创建一个 API，以便在 Github repo 中创建新问题时接收请求。</p><h1 id="f328" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">创建一个简单的 Flask 服务器</h1><p id="4b73" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">首先，让我们创建一个 hello world 端点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="dfc7" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">现在我们需要创建一个端点来接收来自 GitHub API 的请求。这将是一个接受 POST 请求的标准端点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="3a68" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">我阅读了文档，知道 JSON 对象的关键。您可以使用不同的键来访问更多数据，如问题标签等。</p><p id="49d4" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">现在你可以运行你的 flask 服务器了</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="11a6" class="nb la it mx b gy nc nd l ne nf">python3 __init__.py</span></pre><h1 id="6685" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">公开暴露我们的本地主机 URL</h1><p id="fa39" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Webhooks 需要一个公共 API 端点，因为它们不能向端点发出请求，例如“<a class="ae ky" href="http://127.0.0.1:5000/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:5000/ </a>”。一种方法是部署 API 并使用已部署 API 的 URL。另一种方法是将您的本地主机公开为一个公开可用的 URL。这是暂时的，只有在 Flask 服务器运行时才有效。对公共 URL 的任何请求也将被发送到您的本地主机 URL。</p><p id="5cd8" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">我们将使用<a class="ae ky" href="https://ngrok.com/" rel="noopener ugc nofollow" target="_blank"> ngrok </a>来公开我们的本地主机 URL。你必须创建一个帐户。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/bf6a4f2708cebee85d13896b8a9eb684.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QtKrF8Jrw35TzIx4.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ngrok 截图</p></figure><p id="b207" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">为您的操作系统下载 ngrok 并解压缩。现在打开一个终端，cd 到解压后的 ngrok 文件所在的目录。在终端中键入以下命令</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="10e0" class="nb la it mx b gy nc nd l ne nf">ngrok  http &lt;PORT NUMBER&gt;</span></pre><p id="5538" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">例如:如果您的 flask 服务器运行在端口 5000 上，您必须键入以下内容</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="2bcc" class="nb la it mx b gy nc nd l ne nf">ngrok http 5000</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/b1ec8e4d7d4bc5b906e0532d022d38cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*P9ZfbqiUcSHl-6-Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">终端截图</p></figure><p id="a44e" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">您应该在终端中看到类似的输出。公共 URL 是“转发”旁边的 URL。我的情况是<a class="ae ky" href="http://35cc-69-58-102-156.ngrok.io/" rel="noopener ugc nofollow" target="_blank">http://35cc-69-58-102-156 . ngrok . io</a>。如果您访问您的公共 URL，您应该看到与您访问您的本地主机 URL 时看到的一样的东西。</p><h1 id="9a62" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">创建问题网络挂钩</h1><p id="8118" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">选择任何你喜欢的 Github Repo。进入设置&gt;网页挂钩&gt;添加网页挂钩</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/39935f0dc49ff5e9a64b89117773ba05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*q3_LPY9czzyuE4WY.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">回购截图</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/356c484e45fe082e4a2d95b2bb6831a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1NyQLubx-LOkcRie.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Webhook 创建的屏幕截图</p></figure><p id="5fae" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">输入您的端点，在我的例子中是<a class="ae ky" href="http://35cc-69-58-102-156.ngrok.io/githubIssue" rel="noopener ugc nofollow" target="_blank">http://35cc-69-58-102-156.ngrok.io/githubIssue</a></p><p id="8d21" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">由于我们只希望在回购中创建问题时提出请求，因此选择“让我选择单个事件”向下滚动选择“问题”。一旦你下来，向下滚动并创建网页挂钩。</p><h1 id="134c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">测试 Webhook</h1><p id="886a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在回购中制造问题</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/0fd8831330c70481c0e8624ec55cb7b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XorBhlblQ0-llEA1.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">问题截图</p></figure><p id="b108" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">现在检查运行 flask 服务器的终端。我还添加了一个标签，并在创建问题后关闭了问题。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/cfbb583c4a17c40059c9d338015a20d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*B3pUiCknS9n-e9w_.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">终端截图</p></figure><h1 id="590c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="6fcb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在 Flask 服务器做不了什么。但是，您可以在它的基础上进行构建。除了打印收到的数据，您还可以使用这些数据发送推送通知或电子邮件。我希望这篇文章对你有所帮助。在<a class="ae ky" href="https://www.linkedin.com/in/rahulbanerjee2699/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>、<a class="ae ky" href="https://twitter.com/rahulbanerjee99" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上与联系。</p><p id="ff8f" class="pw-post-body-paragraph lr ls it lt b lu mo ju lw lx mp jx lz ma mq mc md me mr mg mh mi ms mk ml mm im bi translated">如果你喜欢我的文章并愿意支持我，请考虑使用我的<a class="ae ky" href="https://rahul1999.medium.com/membership" rel="noopener">推荐链接</a>注册一个中级会员。您将能够访问付费墙后面的所有文章。如果你使用我的推荐，我将免费获得你每月订阅的一部分。</p></div></div>    
</body>
</html>