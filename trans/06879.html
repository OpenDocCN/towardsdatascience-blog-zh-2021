<html>
<head>
<title>Bayesian A/B Testing in 5 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">贝叶斯A/B测试在5分钟内完成</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/bayesian-a-b-testing-and-its-benefits-a7bbe5cb5103?source=collection_archive---------2-----------------------#2021-06-22">https://towardsdatascience.com/bayesian-a-b-testing-and-its-benefits-a7bbe5cb5103?source=collection_archive---------2-----------------------#2021-06-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9d0a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">什么是贝叶斯A/B测试，什么时候应该使用它？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/7be33c3761eef49c2466576ccf512319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eOo9fJ8wAn_TLVslYfV5Sw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">A/B测试的困境。图片作者。</p></figure><p id="387a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最近，<a class="ae lr" href="https://medium.com/r?url=https%3A%2F%2Farxiv.org%2Fpdf%2F2003.02769.pdf" rel="noopener">贝叶斯A/B测试</a>得到了大量的宣传，因为它的方法易于理解，并允许有用的计算，如治疗优于控制的概率。贝叶斯推理在小样本上也表现得更好；根据<a class="ae lr" rel="noopener" target="_blank" href="/exploring-bayesian-a-b-testing-with-simulations-7500b4fc55bc"> 2019中期帖子</a>，贝叶斯A/B测试可以减少75%的所需样本量。</p><p id="fc71" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">虽然这些方法在计算上比传统的frequentist方法更昂贵，但是它们是离线计算的，这降低了性能要求。主要的挑战是选择有效的分布来支持推理。</p><p id="452b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">任何拥有实验管道和计算机的人都可以利用贝叶斯A/B测试技术。以下是如何…</p><h1 id="8b95" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">贝叶斯A/B测试的步骤</h1><ol class=""><li id="fcbe" class="mk ml iq kx b ky mm lb mn le mo li mp lm mq lq mr ms mt mu bi translated"><strong class="kx ir">根据您的兴趣选择您的发行版。</strong>这里，我们讨论二项式、多项式和指数分布。它们涵盖了大多数业务用例。</li><li id="c195" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi translated"><strong class="kx ir">计算你的先验。</strong>基于上面选择的分布，我们接下来选择一个<a class="ae lr" href="https://en.wikipedia.org/wiki/Conjugate_prior" rel="noopener ugc nofollow" target="_blank">共轭先验</a>，并选择最能反映我们预实验数据的分布参数。分布参数可手动选择或使用<a class="ae lr" rel="noopener" target="_blank" href="/finding-the-best-distribution-that-fits-your-data-using-pythons-fitter-library-319a5a0972e9">库</a>选择。</li><li id="786d" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi translated"><strong class="kx ir">运行实验。</strong></li><li id="ef57" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi translated"><strong class="kx ir">使用蒙特卡罗模拟计算三个关键指标。</strong>这些指标是提升百分比、最佳概率和预期损失。</li></ol><h1 id="b451" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">但是，到底是怎么回事呢？</h1><p id="e692" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">好了，让我们慢下来，了解一下到底发生了什么。</p><h2 id="acc9" class="nd lt iq bd lu ne nf dn ly ng nh dp mc le ni nj me li nk nl mg lm nm nn mi no bi translated">贝叶斯统计</h2><p id="fec8" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">从第一格开始，我们来说说<a class="ae lr" rel="noopener" target="_blank" href="/a-gentle-introduction-to-bayesian-inference-6a7552e313cb">贝叶斯推断</a>是什么。一句话，贝叶斯推理利用条件概率来帮助我们理解数据如何影响我们的信念。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/a8a8c3741d24ef49f6b55fd975419fb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N7HgfQDnxCJo6c7tEGwA9A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">贝叶斯方法。图片作者。</p></figure><p id="ad49" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">假设我们从天空是红色的先验信念开始。看了一些数据后，我们很快就会意识到这种先前的想法是错误的。因此，我们执行<em class="nq">贝叶斯更新</em>来改进我们关于天空颜色的不正确模型，最终得到一个更准确的后验信念。</p><h2 id="e7f0" class="nd lt iq bd lu ne nf dn ly ng nh dp mc le ni nj me li nk nl mg lm nm nn mi no bi translated">似然分布和共轭先验</h2><p id="50bc" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">我们信念的一个关键组成部分是我们数据的结构。我们经常通过分布来描述这种结构。例如，在我们的天空例子中，假设有各种颜色(红色、白色、蓝色等。)，我们的分布将是<a class="ae lr" href="https://en.wikipedia.org/wiki/Multinomial_distribution#:~:text=In%20probability%20theory%2C%20the%20multinomial,sided%20die%20rolled%20n%20times.&amp;text=When%20k%20is%202%20and%20n%20is%20bigger%20than,it%20is%20the%20binomial%20distribution." rel="noopener ugc nofollow" target="_blank">多项式</a>。如果我们看一组数字，我们的分布可能是<a class="ae lr" href="https://en.wikipedia.org/wiki/Normal_distribution" rel="noopener ugc nofollow" target="_blank">正态</a>。如果数据是真/假值，它将是<a class="ae lr" href="https://en.wikipedia.org/wiki/Binomial_distribution" rel="noopener ugc nofollow" target="_blank">二项式</a>，等等。</p><p id="9a98" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这些分布被称为似然分布，因为它们显示了我们的数据呈现某个值的可能性。</p><p id="9dbd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于我们的天空例子，我们正在处理一个多项式分布，但是还有一个分布我们需要考虑。当执行贝叶斯更新时，我们必须考虑概率分布的<em class="nq">共轭先验</em>分布。共轭是来自同一个家族的分布。对于我们的情况，多项式分布的共轭先验是<a class="ae lr" href="https://en.wikipedia.org/wiki/Dirichlet_distribution" rel="noopener ugc nofollow" target="_blank">狄利克雷</a>分布。</p><p id="b6b2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">共轭先验是我们数据的可能性分布的来源。</strong>例如，<strong class="kx ir"> </strong>如果我们正在抛硬币，那么<a class="ae lr" href="https://en.wikipedia.org/wiki/Binomial_distribution" rel="noopener ugc nofollow" target="_blank">二项式</a>分布显示了抛硬币的次数<em class="nq"> n </em>看起来像是正面的概率<em class="nq"> p </em>。但是，往往<em class="nq"> p </em>本身就有分布。<em class="nq"> p </em>的分布是共轭先验分布。</p><p id="c563" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">好吧，那是很多，但是如果你想继续学习共轭先验，这里有一个来自麻省理工学院的很好的资源。</p><p id="8503" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们继续将这些发行版用于不同的业务应用程序。</p><h2 id="c1f1" class="nd lt iq bd lu ne nf dn ly ng nh dp mc le ni nj me li nk nl mg lm nm nn mi no bi translated">商业中常见的分配</h2><p id="6e44" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">通常，我们可以在业务环境中观察到三种主要类型的数据(尽管其他分布也是有用的):</p><ol class=""><li id="14f0" class="mk ml iq kx b ky kz lb lc le nr li ns lm nt lq mr ms mt mu bi translated"><strong class="kx ir">二进制</strong>:用户有一个选项可以选择的数据。</li><li id="1cec" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi translated"><strong class="kx ir">分类</strong>:用户有一组选项可供选择的数据。</li><li id="8c4b" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi translated"><strong class="kx ir">连续</strong>:用户有一组选项可以选择的数据，但是我们只观察这些选项的集合。</li></ol><p id="3f08" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于二进制数据，让我们举一个在线ML教科书商店转换的具体例子。<em class="nq"> Conversion=1 </em>表示用户购买了一本书，而<em class="nq"> conversion=0 </em>表示他们没有购买。</p><p id="5c29" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这个场景中，<a class="ae lr" href="https://en.wikipedia.org/wiki/Binomial_distribution" rel="noopener ugc nofollow" target="_blank">二项式</a>分布描述了我们的数据。二项式的共轭先验是<a class="ae lr" href="https://en.wikipedia.org/wiki/Beta_distribution" rel="noopener ugc nofollow" target="_blank"> beta </a>分布，下面可以看到这两个分布。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/cc65c3533e9fe51d3c5c4eae3ef2119b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0fF4xPO72YuSARA21nYxyQ.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">具有不同超参数值的贝塔(上)和二项式(下)。图片作者。</p></figure><p id="3c42" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">转到我们的第二类数据，分类数据的似然分布是<a class="ae lr" href="https://en.wikipedia.org/wiki/Multinomial_distribution#:~:text=In%20probability%20theory%2C%20the%20multinomial,sided%20die%20rolled%20n%20times.&amp;text=When%20k%20is%202%20and%20n%20is%20bigger%20than,it%20is%20the%20binomial%20distribution." rel="noopener ugc nofollow" target="_blank">多项式</a>，它的共轭先验是<a class="ae lr" href="https://en.wikipedia.org/wiki/Dirichlet_distribution" rel="noopener ugc nofollow" target="_blank">狄利克雷</a>。因为这些图通常是高维的，所以我们不打算展示可视化。</p><p id="b1b9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，对于连续数据，我们使用带有<a class="ae lr" href="https://en.wikipedia.org/wiki/Gamma_distribution" rel="noopener ugc nofollow" target="_blank">伽玛</a>共轭先验的<a class="ae lr" href="https://en.wikipedia.org/wiki/Exponential_distribution" rel="noopener ugc nofollow" target="_blank">指数</a>分布。如果你想知道它们长什么样，可以看看这些链接。</p><p id="f85c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">很简单，对吧？根据数据类型，只需应用这些分布就可以了。</p><h1 id="3e10" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">贝叶斯统计计算</h1><p id="ed96" class="pw-post-body-paragraph kv kw iq kx b ky mm jr la lb mn ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">现在我们已经了解了如何为我们的实验选择一个分布，让我们学习如何确定实验影响。我们通过计算三个统计数据来做到这一点:</p><ol class=""><li id="5115" class="mk ml iq kx b ky kz lb lc le nr li ns lm nt lq mr ms mt mu bi translated">治疗电梯</li><li id="ebb0" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi translated">成为最佳的可能性</li><li id="9898" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq mr ms mt mu bi translated">预期损失</li></ol><p id="6902" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于我们的第一个计算，治疗提升仅仅是我们的治疗和控制之间的百分比变化。这是我们的治疗效果，可以用下面的公式计算。为了简单起见，让我们假设只有一种治疗和一种对照。</p><pre class="kg kh ki kj gt nv nw nx ny aw nz bi"><span id="45fd" class="nd lt iq nw b gy oa ob l oc od">treatment_lift = (treatment - control) / control</span></pre><p id="197d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于我们的第二次和第三次计算，我们需要开发一个蒙特卡罗模拟。为什么你会问？因为我们只有一个数据样本，所以我们无法计算任何概率——我们不知道数据在其他样本中会是什么样子。因此，为了生成更多的数据，我们利用了关于我们的数据生成机制(后验分布)的知识和来自该机制的样本。10，000个样本是一个很好的经验法则。</p><p id="d05b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于我们的第二个统计数据，即最佳概率，我们只需查看所有模拟样本，并计算我们的处理优于我们的控制的时间百分比。这个比例成为我们的最佳治疗的<em class="nq">概率</em>。查看下面的pythonic伪代码。</p><pre class="kg kh ki kj gt nv nw nx ny aw nz bi"><span id="7305" class="nd lt iq nw b gy oa ob l oc od"># probability best of treatment<br/>samp_treatment = sample_from_distribution(treatment_dist, n=10000)<br/>samp_control = sample_from_distribution(control_dist, n=10000)</span><span id="6c1a" class="nd lt iq nw b gy oe ob l oc od">probability_best = mean(int(samp_treatment &gt; samp_control))</span></pre><p id="58de" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，对于我们的第三个统计，我们希望计算<em class="nq">预期损失</em>，即我们为实施不正确的治疗所付出的代价。为了计算预期损失，我们迭代样本并计算<em class="nq"> max(treat - control，0) </em>。然后，我们取这些零界值的平均值来确定我们的<em class="nq">预期损失</em>。</p><pre class="kg kh ki kj gt nv nw nx ny aw nz bi"><span id="2810" class="nd lt iq nw b gy oa ob l oc od"># pythonic pseudo code - expected loss</span><span id="0303" class="nd lt iq nw b gy oe ob l oc od">loss = mean(max(samp_control - samp_treatment, 0))</span></pre><p id="efcc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="nq">预期损失</em>和<em class="nq">最佳概率</em>是贝叶斯实验的两个主要卖点。Frequentist方法不提供任何值。</p><p id="6273" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有关这些计算的详细信息，请查看这篇<a class="ae lr" rel="noopener" target="_blank" href="/bayesian-ab-testing-part-i-conversions-ac2635f878ec">帖子</a>。</p><p id="90bb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在你知道了！</p><h1 id="3d7b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">实施说明</h1><ul class=""><li id="c66b" class="mk ml iq kx b ky mm lb mn le mo li mp lm mq lq of ms mt mu bi translated">如果你选择一个有效的先验，贝叶斯A/B测试需要一个较小的样本量，这样你可以更快地得到结果。</li><li id="3de8" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq of ms mt mu bi translated">贝叶斯方法比频率主义方法计算量更大。</li><li id="aaeb" class="mk ml iq kx b ky mv lb mw le mx li my lm mz lq of ms mt mu bi translated">当选择先验时，偏向弱先验，即较小的超参数值。</li></ul></div><div class="ab cl og oh hu oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="ij ik il im in"><p id="bd84" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="nq">感谢阅读！我将再写46篇文章，将“学术”研究引入DS行业。查看我对贝叶斯A/B测试的链接/想法的评论。</em></p></div></div>    
</body>
</html>