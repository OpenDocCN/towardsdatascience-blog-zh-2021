<html>
<head>
<title>Colour Image Quantization using K-means</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于K-均值的彩色图像量化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/colour-image-quantization-using-k-means-636d93887061?source=collection_archive---------19-----------------------#2021-09-27">https://towardsdatascience.com/colour-image-quantization-using-k-means-636d93887061?source=collection_archive---------19-----------------------#2021-09-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6c89" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一个关于如何使用Python和OpenCV减少图像中不同颜色数量的简单教程</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a050f59b21b6886192856420406b0063.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UW0VxK_T146zi-VX"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Joyce McCown 在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="f7dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">颜色量化</strong>是一种减少图像颜色数量的过程，同时试图保持图像质量和重要的全局信息。图像由像素组成，在RGB颜色空间的情况下，每个像素可以与<strong class="ky ir"> 16，777，216 </strong>种不同的颜色相关联，这可能是最常用的颜色空间。每种颜色都可以表示为一个3d矢量，每个矢量元素都有一个8位的动态范围，这意味着2⁸=256不同的值(即256x256x256 =16，777，216)。这种表示通常被称为RGB三元组。成功的颜色量化的关键因素是适当选择能够充分概括初始图像信息的<strong class="ky ir">调色板</strong>。</p><p id="57e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">动机</strong> : <em class="ls">什么时候应该使用彩色图像量化？</em></p><p id="b3eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们想要在仅支持有限数量颜色(有限调色板)的设备中渲染图像，彩色图像量化可能是至关重要的，这通常是由于内存限制而发生的。</p><h2 id="ea43" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">作为聚类问题的颜色量化</h2><p id="6af7" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">解决图像色度压缩的最常见方法之一是使用聚类，其中特征是图像的颜色。K-means是一种非常流行的矢量量化聚类方法，多亏了scikit-learn库，它真的很容易使用(只要你知道它是如何工作的)。当然，其他聚类方法如奇异值分解、高斯混合模型等。把工作做好。</p><h2 id="5783" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">色彩空间</h2><p id="bf67" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">颜色空间是描述颜色表现方式的数学模型。最简单的方法是想象一个盒子，里面装着所有可能的颜色，这些颜色可以由光的三原色混合而成:<em class="ls">红色</em>、<em class="ls">绿色</em>和<em class="ls">蓝色</em>、<a class="ae kv" href="https://www.photoreview.com.au/tips/outputting/colour-spaces-explained/" rel="noopener ugc nofollow" target="_blank">光源</a>。在图1中，您可以看到数学家为了将三个轴(红色、绿色和蓝色)拟合为二维格式而绘制的图表:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/e6561978a44300196a1eac69c0cc6bf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*EjoOmcYsuS-l3nlsvHeodQ.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图1: CIE色度图[ <a class="ae kv" href="https://www.photo.net/learn/using-lab-color-adjustments/" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="5837" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Adobe RGB、sRGB和CMYK都是色域(范围)，是1976年由<a class="ae kv" href="https://en.wikipedia.org/wiki/International_Commission_on_Illumination" rel="noopener ugc nofollow" target="_blank">国际照明委员会</a>(简称CIE)定义的<strong class="ky ir"> L*a*b* </strong>色域的子集，旨在作为<strong class="ky ir">感知均匀空间</strong>，其中给定的数值变化对应于相似的感知颜色变化。我这样说是因为对于K-means，我们需要一个距离度量来衡量特征之间的相似性。<strong class="ky ir">感知上不一致的RGB颜色空间</strong>意味着具有相同欧几里德距离的两对颜色可能被感知为不相等的不同(由于每种颜色的不同波长以及人眼对如何感知每一种颜色的敏感性)。</p><p id="e2b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">键取</strong>:应用K-means之前，将图像转换为<strong class="ky ir"> L*a*b* </strong>颜色空间。</p><h2 id="51f7" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">守则</h2><p id="8946" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">下面是使用<strong class="ky ir"> scikit-learn </strong>库(实现K-means方法)和<strong class="ky ir"> OpenCV </strong>库进行图像处理的颜色量化代码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/e01d711d2e9b0aa6b4154f90c3748cf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Z0Avm25FYkrMOYiBW52VQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">您可以在我的<a class="ae kv" href="https://github.com/skanelo/Image-Quantization-KMeans" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到代码(作者图片)</p></figure><ul class=""><li id="b762" class="mt mu iq ky b kz la lc ld lf mv lj mw ln mx lr my mz na nb bi translated">最初，我们期望用户给出两个命令行参数:(1)输入图像的路径，以及(2)集群的数量。</li><li id="b3aa" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">我们加载图像，并将其转换为L*a*b*色域。</li><li id="6e9e" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">我们将原始图像重新整形为(<em class="ls">宽*高，3 </em>),因为k-means将二维数组而不是三维数组作为输入。</li><li id="d055" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">我们用用户决定的K个聚类初始化我们的分类器。</li></ul><p id="4902" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong>我之所以选择使用<strong class="ky ir">minibatch kman s</strong>是因为它<strong class="ky ir"> </strong>比普通kman快得多，尽管与对整个人群进行操作的kman相比，它对小批量的kman进行操作，质心可能不那么稳定。从迷你批次开始是一个很好的做法，如果结果不太令人满意，您可以尝试使用迷你批次。</p><ul class=""><li id="2965" class="mt mu iq ky b kz la lc ld lf mv lj mw ln mx lr my mz na nb bi translated"><em class="ls">clf . fit _ preview(image)</em>返回每个像素的预测值，即该像素属于哪个聚类。</li><li id="3503" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated"><em class="ls">量化= clf.cluster_centers_。a type(“uint 8”)[labels]</em>通过将原始图像中的每个像素值重新分配到其对应的最近中心来创建量化图像。</li><li id="6ca9" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">我们将初始和量化的特征向量重新整形为图像，并将其转换为RGB色域。</li><li id="8d97" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">最后，我们将(原始图像和量化图像的)拼接保存到磁盘上。</li></ul><h2 id="1534" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">结果</h2><p id="4198" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">在这一段中，我将把上述程序的结果应用在一张海报上，这张海报是我从<a class="ae kv" href="https://myheroacademia.fandom.com/wiki/My_Hero_Academia_Season_5" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">我的英雄学院维基</strong> </a>借来的我最喜欢的动漫《博库无英雄学院》🎆。</p><p id="3a14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> K = 2 </strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/0e07481d9ebadd7025d23bf2f777106f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YbdJOzUoY97lu7nLVlxl2Q.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图2:我们的调色板包括两种颜色，黑色和米色(图片由作者提供)</p></figure><p id="e0aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong>该算法最初从给定数据中随机选择K个质心，并在每一步将每个数据点分配给最近的质心。当所有数据点(特征)都被分配给一个质心时，重新计算K个聚类的每个平均值，这两个平均值就是新的两个质心。重复该过程，直到没有质心更新(或者至少小于阈值)发生。因此，这两种颜色<strong class="ky ir">并不是</strong>在初始图像中最频繁出现的颜色(可能会产生误解)，但是您可以将它们想象为这两种颜色，这两种颜色是两个聚类的平均值(即中心),并且意味着<strong class="ky ir">其他颜色分别与这两个中心的距离总和的最小化</strong>。</p><h2 id="a731" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">K = 8</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/160460e8ef88646373c04ce59964e37a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FwEZoGCX23YfcPL4ygfO9w.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图3:我们的调色板由8种颜色组成——可以观察到不同深浅的灰色、红色和黄色(图片由作者提供)</p></figure><h2 id="723b" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">K = 32</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/5aad02372f3df1e729130ac9f203655b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CZgtr5rq249MdvXa4J2Nxg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图4:我们的调色板由32种颜色和绿色组成(图片由作者提供)</p></figure><h2 id="bedc" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">K = 40</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/4bb2ec24717cd6f7e725aa1aa681b2f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0VjeZfeJ-O-bogri0J0MTw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图5:我们的调色板由40种颜色组成，我们可以看到它非常接近原始图像(作者的图像)</p></figure><h1 id="47d5" class="ni lu iq bd lv nj nk nl ly nm nn no mb jw np jx me jz nq ka mh kc nr kd mk ns bi translated">结论</h1><p id="b279" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">总之，在这篇文章中，我们看到了几行代码如何对图像进行颜色量化。图5显示，由于内存限制，设备仅支持有限数量的颜色(比如40种颜色),这种方法可以转换初始图像，但质量不会明显下降，并且重要信息得以保留。</p></div></div>    
</body>
</html>