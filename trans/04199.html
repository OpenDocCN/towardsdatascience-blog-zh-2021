<html>
<head>
<title>A journey of building an Advanced Object Detection Pipeline — Doubling YoloV5’s performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建高级对象检测管道之旅——将YoloV5的性能提升一倍</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-journey-of-building-an-advanced-object-detection-pipeline-doubling-yolov5s-performance-b3f1559463bf?source=collection_archive---------12-----------------------#2021-04-09">https://towardsdatascience.com/a-journey-of-building-an-advanced-object-detection-pipeline-doubling-yolov5s-performance-b3f1559463bf?source=collection_archive---------12-----------------------#2021-04-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7833" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我在一次Kaggle物体探测比赛中使用的几个技巧在比赛的大部分时间里将我的分数提高到大约前10%</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8553ec2ea01757fa7632b2a6bedb1c95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OJtIBlCBByBh13Zf"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">迭戈·PH在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="b4e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我花了三个月深入研究物体探测。我已经尝试了大量的东西，从实现YoloV5，VFNets，DETR等最先进的模型到融合对象检测模型和图像分类模型以提高性能。在比赛的早期阶段，我努力提高基线模型的分数，但我找不到有用的在线资源，这就是我写这篇文章的原因。我想带你踏上一段旅程，从起点到终点，简要地向你展示我几乎将分数翻倍的每一步。</p><p id="25b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">官方的竞争指标是(平均)平均精度，这是最常用的对象检测指标之一。为了向您展示每一步相对于其他步骤的改进，我将在旁边添加它的分数。</p><ol class=""><li id="0bd4" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">第一步是建立一个简单的基线——0.126地图</strong></li></ol><p id="c9be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我很确定这是一个陷阱，很多数据科学家早就掉进去了。我们总是兴奋地用我们能想到的每一种技术从最复杂的模型开始。这是一个巨大的错误，你最终会变得沮丧并离开你的ML项目，即使你不这样做，你也很可能会超负荷！</p><p id="be89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我得到了惨痛的教训，但最终我用这些规范构建了一个初始模型:</p><ul class=""><li id="483d" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu me mb mc md bi translated">YoloV5-XL</li><li id="6b29" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu me mb mc md bi translated">图像从3K分辨率调整到512</li></ul><p id="707a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我知道这听起来很简单，最初，我也是这么想的。但是，实际上，建立基线可能是最烦人的步骤之一。因为有多个步骤，比如将输出后处理成竞争对手的格式等等(我不想深究)。</p><p id="11a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我的实际初始YoloV5-XL模型只得到0.064(上面的一半)，我花了2周时间调试它，结果发现我没有正确地规范化输入数据！</p><p id="de9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 2。删除其中一个输入类！— 0.143地图(+13%) </strong></p><p id="b5aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这一招当时对我来说没多大意义。有14个输入类、13种不同的疾病和1个“无发现”类。大约70%的数据集属于“无发现”类，只有30%属于其他类。一个竞争对手发现你可以丢弃这个类，并使用“2类过滤器”技巧来预测它(见下文)。这使得数据集不那么倾斜。此外，它允许训练明显更快(因为你将在更少的图像上训练)。</p><p id="b396" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 3。增加训练和推理图像分辨率— 0.169 mAP (+18%) </strong></p><p id="b505" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二步是将图像分辨率从512提高到1024。这是一个微不足道的进步，但我想在这里表达的观点是，如果我从这个决心开始，我可能不会进一步提高我的分数。仅仅是因为在这个更高分辨率上的训练导致批量大小从16减少到4(以不耗尽GPU内存)，这大大减慢了训练过程。这意味着更慢的实验，你不想用慢实验开始一场竞赛…</p><p id="d4ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 4。定影效率Net和yolov 5–0.196 mAP(+16%)</strong></p><p id="20f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这不是我的主意，我从一个公共内核得到的。但是，这是我在Kaggle比赛中遇到的最好的想法之一。我想强调的是，在Kaggle上进行比赛的主要好处之一是你可以从社区中学到东西。</p><p id="9937" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的主要想法是在这里训练一个图像分类模型(EfficientNet ),它可以实现非常高的AUC(大约0.99)并找出一种将其与对象检测模型融合的方法。这被称为“2级过滤器”，实际上比赛中的每个人都采用了这个想法，因为它大大提高了分数。</p><p id="5d90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您感兴趣，您可以在此找到更多信息:</p><div class="mk ml gp gr mm mn"><a rel="noopener follow" target="_blank" href="/fusing-efficientnet-yolov5-advanced-object-detection-2-stage-pipeline-tutorial-da3a77b118d1"><div class="mo ab fo"><div class="mp ab mq cl cj mr"><h2 class="bd iu gy z fp ms fr fs mt fu fw is bi translated">Fusing EfficientNet &amp; YoloV5 —高级目标检测2阶段流水线教程</h2><div class="mu l"><h3 class="bd b gy z fp ms fr fs mt fu fw dk translated">通过将YoloV5与EfficientNet集成，将对象检测性能提高约20%</h3></div><div class="mv l"><p class="bd b dl z fp ms fr fs mt fu fw dk translated">towardsdatascience.com</p></div></div><div class="mw l"><div class="mx l my mz na mw nb ks mn"/></div></div></a></div><p id="dc23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 5。加权框融合(WBF)后处理— 0.226 mAP (+15%) </strong></p><p id="3833" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这对我来说也是一个很新的想法，不是你能在网上轻易找到的。加权盒子融合是一种过滤掉物体检测模型产生的盒子数量的技术，使得结果更准确和更正确。它的性能超过了现有的类似方法，如非最大抑制(NMS)和软NMS。</p><p id="d98c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应用WBF的结果如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/ae411e42ba6ffc18d5561b0237c45bfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/0*A25R-7NY7n77MNUg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者转载。</p></figure><p id="10ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有兴趣了解更多，你可以在这里查看我的文章:</p><div class="mk ml gp gr mm mn"><a rel="noopener follow" target="_blank" href="/wbf-optimizing-object-detection-fusing-filtering-predicted-boxes-7dc5c02ca6d3"><div class="mo ab fo"><div class="mp ab mq cl cj mr"><h2 class="bd iu gy z fp ms fr fs mt fu fw is bi translated">WBF:优化目标检测——融合和过滤预测框</h2><div class="mu l"><h3 class="bd b gy z fp ms fr fs mt fu fw dk translated">加权盒融合已经成为优化目标检测模型的新SOTA</h3></div><div class="mv l"><p class="bd b dl z fp ms fr fs mt fu fw dk translated">towardsdatascience.com</p></div></div><div class="mw l"><div class="nd l my mz na mw nb ks mn"/></div></div></a></div><ul class=""><li id="1005" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu me mb mc md bi translated"><strong class="lb iu">与WBF融合的5重交叉验证— 0.256 mAP (+13%) </strong></li></ul><p id="7c9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我犯的一个最大的错误是我忘记了做交叉验证，这就是为什么这是一个要点而不是一个编号点。这也是我想写这篇文章的主要原因之一，强调ML基础的重要性。我太专注于应用新技术和提高性能，以至于忘记了应用这个基本的ML技术。</p><p id="0921" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想知道我是如何将0.256附加到它上面的，那是因为我阅读了一些在比赛结束后发布的解决方案，这是他们大多数人在与我相似的模型上交叉验证后得到的结果。</p><p id="f4b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终的管道可以在这里看到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/44a74926c93c1e5222abefddfcee34f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JWyP1JguWqulsqG60YtDHA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><ul class=""><li id="337d" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu me mb mc md bi translated"><strong class="lb iu">我尝试过，但无法解决的事情</strong></li></ul><ol class=""><li id="9198" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">训练DETR。DETR是一个神奇的物体检测转换器，我在之前写了一篇<a class="ae ky" rel="noopener" target="_blank" href="/facebook-detr-transformers-dive-into-the-object-detection-world-39d8422b53fa">的文章。我认为这是将我所写的一切付诸实践并真诚测试它的时刻。然而，我没有发现他们随代码提供的文档有什么帮助，我也找不到很多有用的资源。此外，我花了大约3个星期(大约是比赛时间的四分之一)试图让它工作。我这样说的原因是，虽然离开你一直在努力的解决方案可能很难，但在实验性的ML世界中，有时必须这样做，老实说，我希望我早点离开它。但是，从好的方面来看，我发现另一个名为</a><a class="ae ky" rel="noopener" target="_blank" href="/mmdetection-tutorial-an-end2end-state-of-the-art-object-detection-library-59064deeada3"> MMDetection </a>的库提供了DETR，并且使用起来更加容易。</li><li id="1ebc" class="lv lw it lb b lc mf lf mg li mh lm mi lq mj lu ma mb mc md bi translated">WBF预处理。虽然很多竞争者说这提高了他们的分数，但并没有提高我的分数。这就是关于ML的事情，不是所有的技术都必然以同样的方式使不同的模型受益。</li></ol><p id="5a1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，如果您感兴趣，可以在这里找到我的代码:</p><p id="53b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/mostafaibrahim17/VinBigData-Chest-Xrays-Object-detection-" rel="noopener ugc nofollow" target="_blank">https://github . com/mostafaibrahim 17/VinBigData-Chest-x ray-Object-detection-</a></p><p id="01b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">最终想法</strong></p><p id="6d71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你喜欢这篇文章，并从我的错误中吸取教训。我希望看到更多的人分享他们的比赛经验，因为我发现这很有帮助。网上有很多关于构建基线的教程，但是关于下一步该做什么的很少。</p></div></div>    
</body>
</html>