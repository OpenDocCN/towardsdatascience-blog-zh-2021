<html>
<head>
<title>Predicting bankruptcy: The Contingent Claim Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测破产:或有索赔模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-bankruptcy-the-contingent-claim-model-3701636b3ae9?source=collection_archive---------24-----------------------#2021-08-05">https://towardsdatascience.com/predicting-bankruptcy-the-contingent-claim-model-3701636b3ae9?source=collection_archive---------24-----------------------#2021-08-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2b47" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">穆迪对公司进行评级时使用的另一种方法</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b73a88524ec536c01050171ddca240a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SqYRQptT400Hv-Q5"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">迪伦·吉利斯在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="4ee4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi ls translated">多年来，崩溃预测一直是一个非常活跃的研究领域。重要的论文包括爱德华·奥特曼1968年的<a class="ae kv" href="https://www.jstor.org/stable/2978933" rel="noopener ugc nofollow" target="_blank">财务比率、判别分析和企业破产预测</a>，这催生了他著名的<em class="mb"> Z分数</em>，至今仍在使用，以及詹姆斯·奥尔森1980年的<a class="ae kv" href="https://math.ryerson.ca/ramlab/projects/crd/ohlson1980.pdf" rel="noopener ugc nofollow" target="_blank">财务比率和破产概率预测</a>及其<em class="mb"> O分数</em>，至今仍在使用。这些论文以及之后的许多论文都是基于会计数据和财务比率。他们使用不同的分类和优化技术:逻辑回归、判别分析、神经网络、蚁群算法等，并主要根据来自损益表、资产负债表和现金流量表的财务数据对它们进行训练。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/bafb52a55a367dca49f26891c693c876.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*ZfDzvy7d2iwaxDCdmQMFVw.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">罗伯特·默顿(<a class="ae kv" href="https://commons.wikimedia.org/wiki/File:Robert_Merton_November_2010_03(1).jpg" rel="noopener ugc nofollow" target="_blank">麻省理工学院，CC BY-SA 4.0 </a></p></figure><p id="6ed3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其他方法使用<strong class="ky ir">市场数据</strong>得出破产风险。一种基于市场的方法特别使用了Black和Scholes在1973年和Merton在1974年提出的思想，使用可能是金融数学中最具代表性的结果:Black-Scholes方程和Black-Scholes公式来为期权和公司债务定价。这种公司债务定价方法是信用分析师Kealhofer、McQuown和Vasicek (KMV)使用的方法，2002年被评级机构Moody's收购。</p><p id="c26a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们转到方法之前，让我们快速定义一下什么是选项。期权是一种金融衍生工具，允许其所有者在未来某一特定日期以特定价格买入(买入期权)或卖出(卖出期权)基础资产(通常是股票)(对于欧式期权，是指在该日期之前的任何时间)。默顿提出了这样一个观点:一旦债务得到偿还，一家公司的股权可以被视为该公司资产的欧式看涨期权。由于股权所有者的有限责任，如果资产不足以支付债务，股权价值就等于零。债务清偿后剩余的任何资产都可以由股权所有人主张。</p><p id="439a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们如何给期权定价，或者说，股权定价？这就是布莱克-斯科尔斯模型的用武之地。它的基本思想是公司的资产遵循几何布朗运动:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi md"><img src="../Images/8a390649ea9ae3d2e455be38dca2313c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t5g7IbmJv2zZ-BBN-izaMA.png"/></div></div></figure><p id="9dbe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上式中，W是一个标准的<a class="ae kv" href="https://en.wikipedia.org/wiki/Wiener_process" rel="noopener ugc nofollow" target="_blank">维纳过程</a>。我们看到<strong class="ky ir">引入了波动性</strong>使得这种方法不同于更传统的基于会计的方法。</p><p id="afe8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">权益的市场价值可以通过Black和Scholes公式获得，用于欧式看涨期权，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi me"><img src="../Images/69e23e60cd47bc1140ca4a3dcfabe984.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JU5MQkbKsFOkYNmM2sdSHg.png"/></div></div></figure><p id="84b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随着</p><p id="3203" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Ve:权益价值的市场<br/> T:债务的到期时间<br/> X:债务的账面价值，相当于看涨期权的履约价格的履约价值<br/> r:无风险利率<br/> sigma_a:资产收益的波动率<br/> N:标准正态分布的累积密度函数；</p><p id="7f0e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，破产概率是指资产的市场价值小于在时间T到期的负债的面值的概率，计算方法如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mf"><img src="../Images/fef3f76e7460cb076a0bff805b07667e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k1IycqMXCHvMGO9jMgtshQ.png"/></div></div></figure><p id="b95d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，我们不知道Va和sigma_a的值，因此为了计算它们，我们同时求解上面给出的等式(1)和下面给出的“最佳对冲”等式(2 ):</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mg"><img src="../Images/a128116053e07c4cec4a7305fe24c9f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tjksON4nnAf39w7ouYY4-Q.png"/></div></div></figure><p id="e7f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在可以计算漂移量μ。它表明了资产价值波动的总趋势。取无风险利率和资产收益之间的最大值:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mh"><img src="../Images/0249cf4bb71823e85e43756b2bded6b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KnT57ybTe39d6so0fk01xw.png"/></div></div></figure><p id="8b3c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后是故障概率，它服从正态分布:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mi"><img src="../Images/63a3349efb6ed782c9f934f21db4f7d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NM-wnpcTR1zzI0L7FUrMNg.png"/></div></div></figure><p id="e989" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们对模型输出的概率使用0.5的阈值来将公司分为破产和非破产。</p><p id="7763" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">值得一提的是，我们在该模型上使用了一个非常简单的实现，具有以下假设/限制:</p><ul class=""><li id="6569" class="mj mk iq ky b kz la lc ld lf ml lj mm ln mn lr mo mp mq mr bi translated">我们不考虑支付股息</li><li id="70f0" class="mj mk iq ky b kz ms lc mt lf mu lj mv ln mw lr mo mp mq mr bi translated">没有交易成本</li><li id="f8e1" class="mj mk iq ky b kz ms lc mt lf mu lj mv ln mw lr mo mp mq mr bi translated">借贷利率相同</li><li id="c96e" class="mj mk iq ky b kz ms lc mt lf mu lj mv ln mw lr mo mp mq mr bi translated">无风险利率没有变化</li></ul><h1 id="02af" class="mx my iq bd mz na nb nc nd ne nf ng nh jw ni jx nj jz nk ka nl kc nm kd nn no bi translated">用Python实现</h1><p id="c5cf" class="pw-post-body-paragraph kw kx iq ky b kz np jr lb lc nq ju le lf nr lh li lj ns ll lm ln nt lp lq lr ij bi translated">我们现在将看到一个使用上述思想的Python实现。</p><p id="1b66" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将定义一个名为<em class="mb"> prob_default() </em>的函数，该函数将一个ticker作为参数，并对2018年纽约证券交易所、纳斯达克和场外交易市场的所有ticker的数据运行该函数。</p><p id="a513" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该函数选择与作为参数传递的股票价格相对应的每日股票价格数据，用于我们正在考虑的时间范围，我们称之为dataframe <em class="mb"> daily_ </em></p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="826d" class="nz my iq nv b gy oa ob l oc od">"""DATA SELECTION"""    <br/>start_date='2018-01-01'    <br/>end_date='2018-12-31' <br/>   <br/># get data for that ticker    <br/>daily_=daily[(daily.ticker==ticker)&amp;(daily.date&gt;=start_date)&amp;(daily.date&lt;=end_date)]    </span><span id="49c0" class="nz my iq nv b gy oe ob l oc od"># if get an empty dataframe, we skip that ticker    <br/>if daily_.shape[0]==0:        <br/>    print(ticker+" is empty")        <br/>    return False<br/>daily_=daily_.reset_index()<br/># we show the marketcap in the right unit   <br/>daily_.marketcap=daily_.marketcap*1e6</span></pre><p id="394d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们使用相隔1天的权益价值之间比率的对数来计算该期间的每日权益回报:</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="f7c5" class="nz my iq nv b gy oa ob l oc od">"""CALCULATING EQUITY RETURNS"""    <br/>for j in range(1,daily_.shape[0]):        <br/>    daily_.loc[j-1, 'returns'] = np.log(daily_.loc[j-1, 'marketcap'] /daily_.loc[j, 'marketcap'])</span></pre><p id="cdce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们可以使用这些数据来计算股票的年波动率。为了计算年波动率，我们将日收益率的标准差乘以252的平方根(一年中的交易日数)</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="861f" class="nz my iq nv b gy oa ob l oc od">"""CALCULATING THE VOLATILITY OF EQUITY: SIGE"""  sige=np.std(daily_.returns)*np.sqrt(252)</span></pre><p id="b74d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在可以求解上面描述的联立方程(1)和(2)来找到Va和sigma_a。我们分别使用2018年和2017年无风险利率的值1.7%和1.5%。对于债务的价值，X，我们用流动债务的价值+非流动债务价值的50%。</p><p id="faa5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们可以使用SciPy上的<a class="ae kv" href="https://docs.scipy.org/doc/scipy/reference/optimize.html" rel="noopener ugc nofollow" target="_blank">优化库的根函数来求解资产的市场价值及其波动性。</a>我们需要找到2018年和2017年的数值。为什么是2017年？因为我们还想知道资产的平均年回报率。所以我们从2018年开始。</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="e87b" class="nz my iq nv b gy oa ob l oc od">"""SOLVE SIMULTANEOUS EQUATIONS for 2018"""    <br/>#2018    <br/># Initialising values    <br/>T=1    <br/>r=0.017    <br/>ve=daily_.loc[0,'marketcap']   <br/>X=df[df.ticker==ticker]['debtc'].values[0]+.5*df[df.ticker==ticker]['debtnc'].values[0]    </span><span id="d63b" class="nz my iq nv b gy oe ob l oc od">sol = optimize.root(fun, [X+ve, sige*ve/(ve+X)])    <br/>va=sol.x[0]    <br/>siga=sol.x[1]</span></pre><p id="4ff4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接着是2017年。</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="928c" class="nz my iq nv b gy oa ob l oc od">#2017    <br/>T=1    <br/>r=0.015    <br/>ve=daily_.loc[daily_.shape[0]-1,'marketcap']    X=df[df.ticker==ticker]['debtc'].values[0]+.5*df[df.ticker==ticker]['debtnc'].values[0]    </span><span id="b3ec" class="nz my iq nv b gy oe ob l oc od">sol = optimize.root(fun, [X+ve, sige*ve/(ve+X)])    <br/>va_1=sol.x[0]    <br/>siga=sol.x[1]</span></pre><p id="6911" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来是我们的最后一步，我们通过使用2018年和2017年的va和va_1变量来计算资产的年回报率。当由此产生的回报率低于无风险利率时，我们使用无风险利率。</p><p id="3bec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在可以使用正常的cdf计算“违约距离”DDt和违约概率。</p><pre class="kg kh ki kj gt nu nv nw nx aw ny bi"><span id="c790" class="nz my iq nv b gy oa ob l oc od">#this gives the annual return    <br/>mu=max((va-va_1)/va_1,r)    <br/>DDt=(np.log(va/X)+(mu-0.5*siga**2)*T)/siga*np.sqrt(T)    </span><span id="4bae" class="nz my iq nv b gy oe ob l oc od">return norm.cdf(-DDt)</span></pre><p id="21a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以在苹果公司(“AAPL”)和琼斯能源公司(“JONEQ”)上测试我们的函数，我们得到苹果的概率为1e-19%，琼斯能源的概率为60%。我们将在下一节看到该方法如何对整个数据集执行。</p><p id="0e94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完整的代码可以在下面找到</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><h1 id="2ba1" class="mx my iq bd mz na nb nc nd ne nf ng nh jw ni jx nj jz nk ka nl kc nm kd nn no bi translated">2018年数据的结果</h1><p id="30a9" class="pw-post-body-paragraph kw kx iq ky b kz np jr lb lc nq ju le lf nr lh li lj ns ll lm ln nt lp lq lr ij bi translated">我们现在可以在2017年和2018年的整个数据集上运行该模型，看看它对2019年发生的破产的预测有多好。这是一个高度不平衡的数据集，因为我们有3237家公司，其中只有30家在2019年宣布破产，即0.9%。在这些情况下，最好使用<a class="ae kv" href="https://en.wikipedia.org/wiki/F-score" rel="noopener ugc nofollow" target="_blank"> F1分数</a>来判断我们模型的性能，因为在这种情况下，精确度和召回率比准确性更有意义。</p><p id="8f26" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们使用0.5的阈值将公司分为破产和非破产，但看起来更低的阈值会提高我们的F1分数。</p><p id="9c42" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从下面的数据来看，我们获得了8%的准确率、30%的召回率和12%的F1值(以及96%的准确率)。AUC为87%。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/1eddf8cede7e69de88555c02788894bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cLg0cF7tVjcDURpqJwrYoA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">或有索赔预测模型的结果:混淆矩阵、ROC曲线、指标与阈值和准确率。</p></figure><p id="3331" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然这些结果可能看起来很糟糕，但值得注意的是，我们实现了一个非常基础的模型版本。我们可以通过以下方式显著改善它:</p><ul class=""><li id="586e" class="mj mk iq ky b kz la lc ld lf ml lj mm ln mn lr mo mp mq mr bi translated">更好地校准概率的截止点。较低的阈值提高了召回率(但也产生了许多误报)。</li><li id="d94e" class="mj mk iq ky b kz ms lc mt lf mu lj mv ln mw lr mo mp mq mr bi translated">将股息支付纳入模型</li><li id="56a6" class="mj mk iq ky b kz ms lc mt lf mu lj mv ln mw lr mo mp mq mr bi translated">使用正态分布以外的其他分布(这是穆迪/KMV使用的方法)</li><li id="7694" class="mj mk iq ky b kz ms lc mt lf mu lj mv ln mw lr mo mp mq mr bi translated">不包括场外交易市场，因为报告要求没有纽约证券交易所或纳斯达克严格</li></ul><p id="033b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="mb">注来自《走向数据科学》的编辑:</em> </strong> <em class="mb">虽然我们允许独立作者根据我们的</em> <a class="ae kv" rel="noopener" target="_blank" href="/questions-96667b06af5"> <em class="mb">规则和指导方针</em> </a> <em class="mb">发表文章，但我们不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的</em> <a class="ae kv" rel="noopener" target="_blank" href="/readers-terms-b5d780a700a4"> <em class="mb">读者术语</em> </a> <em class="mb">。</em></p><h2 id="83ea" class="nz my iq bd mz oi oj dn nd ok ol dp nh lf om on nj lj oo op nl ln oq or nn os bi translated">参考</h2><p id="1920" class="pw-post-body-paragraph kw kx iq ky b kz np jr lb lc nq ju le lf nr lh li lj ns ll lm ln nt lp lq lr ij bi translated">Hillegeist，S. A .，Keating，K. E .，Cram，D. P .，&amp; Lundstedt，K. G. (2004年)。<a class="ae kv" href="https://link.springer.com/article/10.1023/B:RAST.0000013627.90884.b7" rel="noopener ugc nofollow" target="_blank">评估破产概率</a>。会计研究回顾，9(1)，5–34</p><p id="d07e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">默顿，R. C. (1974)。<a class="ae kv" href="https://www.jstor.org/stable/2978814" rel="noopener ugc nofollow" target="_blank">论公司债务的定价:利率的风险结构</a>，金融杂志，29(2)，449–470。</p><p id="9aeb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">瓦萨苏，m .，&amp;邢，Y. (2004)。<a class="ae kv" href="https://onlinelibrary.wiley.com/doi/full/10.1111/j.1540-6261.2004.00650.x" rel="noopener ugc nofollow" target="_blank">股权收益违约风险</a>。金融杂志，59(2)，831–868</p></div></div>    
</body>
</html>