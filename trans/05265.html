<html>
<head>
<title>How To Test Your Software With Julia</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Julia测试你的软件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-test-your-software-with-julia-4050379a9f3?source=collection_archive---------14-----------------------#2021-05-09">https://towardsdatascience.com/how-to-test-your-software-with-julia-4050379a9f3?source=collection_archive---------14-----------------------#2021-05-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e6b1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">确保你的Julia软件实际上与测试包一起工作！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e786b81ace58cc5e870598600acfb3ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yip9QAxgsH00qvbg4lD4yg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(src =<a class="ae ky" href="https://pixabay.com/images/id-731198/" rel="noopener ugc nofollow" target="_blank">https://pixabay.com/images/id-731198/</a></p></figure><h1 id="4493" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="78fc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">测试是迭代软件开发最重要的方面之一。这是因为测试可以自动揭示软件的问题，而不需要实际使用软件。不用说，将甚至不工作的软件推送到存储库可能是个坏主意，测试可以避免碰到这个问题。在Julia编程语言中实现测试，我认为这是一个非常棒和独特的实现。我认为它很棒，因为它提供了一种使用条件和宏测试软件的非常结构化和简单的方法。今天我想为Julia介绍一下Testing.jl包的基础知识，这样你就可以在犯下大错之前确保你的软件正常工作。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="5cb3" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">设置包</h1><p id="4db7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了演示Julia的测试包，我们首先需要建立一个新项目。为了建立一个新的项目，我们可以使用Pkg.generate()，或者Pkg REPL中的generate命令。一旦进入朱莉娅press，我将按下]并生成我们命名为“Sample”的新项目</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="7c32" class="ne la it na b gy nf ng l nh ni">julia&gt; ]<br/>(<a class="ae ky" href="http://twitter.com/v1" rel="noopener ugc nofollow" target="_blank">@v1</a>.6) pkg&gt; generate sample</span></pre><p id="ded3" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated">接下来，我将退格退出REPL，然后按；参加REPL的狂欢。然后，我们将cd放入新的项目文件夹。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="ccd4" class="ne la it na b gy nf ng l nh ni">julia&gt; ;<br/>shell&gt; cd sample</span></pre><p id="cd66" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated">现在，我将cd放入source文件夹，并对sample.jl文件进行nano，添加一个我们可以测试的新函数。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="ceea" class="ne la it na b gy nf ng l nh ni">shell&gt; cd src<br/>/home/emmett/dev/julia/sample/src</span><span id="685c" class="ne la it na b gy no ng l nh ni">shell&gt; nano sample.jl</span></pre><p id="af45" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated">在这个文件中，我放了一些用于模型验证的函数，以及用于支持它们的函数:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="84cc" class="ne la it na b gy nf ng l nh ni">mean(x) = sum(x) / length(x)<br/>function mae(actual,pred)<br/>    l = length(actual)<br/>    lp = length(pred)<br/>    if l != lp<br/>        throw(ArgumentError("The array shape does not match!"))<br/>    end<br/>    result = actual-pred<br/>    maeunf = mean(result)<br/>    if maeunf &lt; 0<br/>        maeunf = (maeunf - maeunf) - maeunf<br/>    end<br/>    return(maeunf)<br/>end</span><span id="9cb7" class="ne la it na b gy no ng l nh ni">function mse(y,ŷ)<br/>    diff = y .- ŷ<br/>    diff = diff .^ 2<br/>    Σdiff = sum(diff)<br/>    return(Σdiff)<br/>end<br/>function correlationcoeff(x,y)<br/>    n = length(x)<br/>    yl = length(y)<br/>    <a class="ae ky" href="http://twitter.com/assert" rel="noopener ugc nofollow" target="_blank">@assert</a> n == yl DimensionMismatch("These Arrays are not the same size.")<br/>    xy = x .* y<br/>    sx = sum(x)<br/>    sy = sum(y)<br/>    sxy = sum(xy)<br/>    x2 = x .^ 2<br/>    y2 = y .^ 2<br/>    sx2 = sum(x2)<br/>    sy2 = sum(y2)<br/>    ((n*sxy) - (sx * sy)) / (sqrt((((n*sx2)-(sx^2)) * ((n*sy2)-(sy^2)))))<br/>end</span><span id="5e0e" class="ne la it na b gy no ng l nh ni">function r2(actual,pred)<br/>    l = length(actual)<br/>    lp = length(pred)<br/>    if l != lp<br/>        throw(ArgumentError("The array shape does not match!"))<br/>    end<br/>    r = correlationcoeff(actual,pred)<br/>    rsq = r^2<br/>    rsq = rsq * 100<br/>    return(rsq)<br/>end<br/>export r2, mae, mse</span></pre><p id="7fc2" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated">然后我使用ctrl+O来删除新的缓冲区，现在我们可以开始实际测试这些函数了！</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="d52d" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">测试</h1><p id="9795" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在我们实际上已经有了一个要测试的包，我们可以着手设置我们的测试环境了。对于Julia包，测试和文档都被认为是独立于原始包的包。记住，我们将再次使用generate命令来创建这两个项目目录。我们将激活这个新的测试环境，然后将测试依赖项添加到它的虚拟环境中。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="92aa" class="ne la it na b gy nf ng l nh ni">shell&gt; cd ..<br/>/home/emmett/dev/julia/sample</span><span id="6931" class="ne la it na b gy no ng l nh ni">(<a class="ae ky" href="http://twitter.com/v1" rel="noopener ugc nofollow" target="_blank">@v1</a>.6) pkg&gt; activate test<br/>  Activating new environment at `~/dev/julia/sample/test/Project.toml`</span><span id="fb04" class="ne la it na b gy no ng l nh ni">(test) pkg&gt; add Test<br/>    Updating registry at `~/.julia/registries/General`<br/>   Resolving package versions...<br/>    Updating `~/dev/julia/sample/test/Project.toml`<br/>  [8dfed614] + Test<br/>    Updating `~/dev/julia/sample/test/Manifest.toml`<br/>  [2a0f44e3] + Base64<br/>  [b77e0a4c] + InteractiveUtils<br/>  [56ddb016] + Logging<br/>  [d6f4376e] + Markdown<br/>  [9a3f8284] + Random<br/>  [9e88b42a] + Serialization<br/>  [8dfed614] + Test</span><span id="15e2" class="ne la it na b gy no ng l nh ni">(test) pkg&gt;</span></pre><p id="e99b" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated">现在我们可以编写测试算法了。包内的第一个函数是MAE。为了执行测试，我们需要启动一个测试集。这是通过测试集宏完成的。在宏之后，我们提供一个字符串作为第一个参数，然后我们提供一个表达式作为第二个参数。字符串是测试集的标题，表达式是执行测试的代码。我们可以使用begin和end块创建这样的表达式。所有这些看起来就像这样:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="45fa" class="ne la it na b gy nf ng l nh ni">using Test</span><span id="c3f3" class="ne la it na b gy no ng l nh ni">include("../src/sample.jl")</span><span id="9c78" class="ne la it na b gy no ng l nh ni">using Main.sample</span><span id="e7e3" class="ne la it na b gy no ng l nh ni"><a class="ae ky" href="http://twitter.com/testset" rel="noopener ugc nofollow" target="_blank">@testset</a> "MAE tests" begin</span><span id="28e1" class="ne la it na b gy no ng l nh ni">end</span></pre><p id="fb85" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated">我们将从两者相等的测试开始这些测试，对于这个场景，MAE应该是1。测试宏接受一个参数，这个参数是一个布尔值。让我们在两个相等数组的MAE上使用一个bool类型的按位运算符，它应该等于零。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="a7b7" class="ne la it na b gy nf ng l nh ni">x = [5, 10, 15]<br/>y = [5, 10, 15]<br/><a class="ae ky" href="http://twitter.com/test" rel="noopener ugc nofollow" target="_blank">@test</a> mae(x, y) == 0</span></pre><p id="5848" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated">我们的下一个测试将会是，我们是否真的得到了dims差异的平均值。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="c992" class="ne la it na b gy nf ng l nh ni">x, y = [4, 10, 15], [5, 10, 15]<br/>    <a class="ae ky" href="http://twitter.com/test" rel="noopener ugc nofollow" target="_blank">@test</a> mae(x, y) == mean([1, 0, 0])</span></pre><p id="e51e" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated">对于最终的测试集，如下所示:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8b39" class="ne la it na b gy nf ng l nh ni">using Main.sample: r2, mae, mse, mean<br/><a class="ae ky" href="http://twitter.com/testset" rel="noopener ugc nofollow" target="_blank">@testset</a> "MAE Tests" begin<br/>    x = [5, 10, 15]<br/>    y = [5, 10, 15]<br/>    <a class="ae ky" href="http://twitter.com/test" rel="noopener ugc nofollow" target="_blank">@test</a> mae(x, y) == 0<br/>    x, y = [4, 10, 15], [5, 10, 15]<br/>    <a class="ae ky" href="http://twitter.com/test" rel="noopener ugc nofollow" target="_blank">@test</a> mae(x, y) == mean([1, 0, 0])<br/>end</span></pre><p id="3352" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated">接下来，我们将为MSE函数开始一个新的测试集。我们将做一个断言测试，和一个零测试，就像我们之前做的一样。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="1e8c" class="ne la it na b gy nf ng l nh ni"><a class="ae ky" href="http://twitter.com/testset" rel="noopener ugc nofollow" target="_blank">@testset</a> "MSE Tests" begin<br/>x = [5, 10, 15]<br/>y = [5, 10, 15]<br/><a class="ae ky" href="http://twitter.com/test" rel="noopener ugc nofollow" target="_blank">@test</a> mse(x, y) == 0<br/>y = [4, 10, 15]<br/>y2 = [6, 10, 15]<br/><a class="ae ky" href="http://twitter.com/test" rel="noopener ugc nofollow" target="_blank">@test</a> mse(x, y) == mse(x, y2)<br/>end</span></pre><p id="b035" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated">接下来，我们将测试我们的r函数。因为我们的r函数要返回一个百分比，我们将检查返回的类型是否为Float64，然后检查它是否小于1。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="e70f" class="ne la it na b gy nf ng l nh ni"><a class="ae ky" href="http://twitter.com/testset" rel="noopener ugc nofollow" target="_blank">@testset</a> "R2 Tests" begin<br/>x = randn(50)<br/>y = randn(50)<br/><a class="ae ky" href="http://twitter.com/test" rel="noopener ugc nofollow" target="_blank">@test</a> r2(x, y) &lt;= 1<br/><a class="ae ky" href="http://twitter.com/test" rel="noopener ugc nofollow" target="_blank">@test</a> typeof(r2(x, y)) == Float64</span></pre><p id="e99e" class="pw-post-body-paragraph lr ls it lt b lu nj ju lw lx nk jx lz ma nl mc md me nm mg mh mi nn mk ml mm im bi translated">现在，我们可以通过返回到REPL并包含这些代码来运行我们的测试。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="448a" class="ne la it na b gy nf ng l nh ni">include("test/test.jl")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/0504a5f2699c16267210f1ab07aba5e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N1743Rep_b__b-4A8ieU_w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="8a0a" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">结论</h1><p id="56ac" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">无论你创建什么样的软件，测试它总是很重要的。Julia有一个非常酷的测试软件的方法，它利用宏并使测试非常有条理。与许多其他测试风格相比，我更喜欢这种方法，我认为Julia使用这种方法使测试变得轻而易举。非常感谢您阅读我的文章，我希望所提供的信息对使您的软件更好地工作是有价值的！感谢您的阅读！</p></div></div>    
</body>
</html>