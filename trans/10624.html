<html>
<head>
<title>Using SimpleElastix to compare pre- and post-expansion microscopy images</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SimpleElastix比较膨胀前后的显微镜图像</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-simpleelastix-to-compare-pre-and-post-expansion-microscopy-images-660eaf992482?source=collection_archive---------31-----------------------#2021-10-11">https://towardsdatascience.com/using-simpleelastix-to-compare-pre-and-post-expansion-microscopy-images-660eaf992482?source=collection_archive---------31-----------------------#2021-10-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="6217" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/thoughts-and-theory" rel="noopener" target="_blank">思想和理论</a></h2><div class=""/><figure class="gl gn jx jy jz ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi jw"><img src="../Images/0f5c3b1cfcddd4746d58f9534c498ef5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oy6hQoCkKRBNHgKnwooSyA.jpeg"/></div></div><p class="kh ki gj gh gi kj kk bd b be z dk translated"><strong class="bd kl">图1:NK细胞扩增前(青色)和扩增后(橙色)</strong> <strong class="bd kl"> ( <em class="km">图片由作者提供)</em> </strong>的荧光信号。</p></figure><p id="a63c" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">根据所用光的波长，传统光学显微镜的分辨率限制在大约200纳米。较小的结构可以通过使用像X射线这样的高能光子来成像。然而，在广泛的生物应用领域中，有必要使用光学显微镜和荧光染料。尽管几种成像技术的发展超过了分辨率极限，如<a class="ae ll" href="https://onlinelibrary.wiley.com/doi/abs/10.1002/anie.200802376" rel="noopener ugc nofollow" target="_blank"> <em class="lm"> d </em> STORM </a>，但这种极限仍然对理解生物的基本过程构成了障碍。随着膨胀显微镜技术的发展，一种新的有前途的方法被开发出来，从不同的角度观察事物。不是增加空间分辨率，而是将样本扩展到合适的大小，<a class="ae ll" href="https://pubmed.ncbi.nlm.nih.gov/33478695/" rel="noopener ugc nofollow" target="_blank">揭示进一步的结构细节和生物相互作用</a>。然而，新方法往往会带来新问题:</p><h1 id="9730" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">扩展后成像的结构是否与原始结构相同？</h1><p id="464b" class="pw-post-body-paragraph kn ko iq kp b kq ml ks kt ku mm kw kx ky mn la lb lc mo le lf lg mp li lj lk ij bi translated"><strong class="kp ja">如果出现扭曲，扭曲的程度有多大？</strong></p><p id="9d79" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">为了理解扩张过程中哪些调整是“自然”的，哪些必须算作扭曲，我们必须看一下自由度(自由度)。</p><figure class="mr ms mt mu gt ka gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/e758b9cf7c3ad09f0f5699b45414f75b.png" data-original-src="https://miro.medium.com/v2/resize:fit:506/format:webp/1*o-9OcTmeR8oYdmN5_1uZnQ.png"/></div><p class="kh ki gj gh gi kj kk bd b be z dk translated"><strong class="bd kl">图2:相似度变换(<em class="km">图片作者)。</em>T25】</strong></p></figure><p id="3487" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">由于样本被扩展，可以假设在x和y方向上的线性放大<em class="lm"> s </em>被包括在该过程中。由于样品在显微镜下的定位，x和y方向的偏移<em class="lm"> t </em>以及角度<em class="lm"> θ </em>的旋转也包括在内。这些参数共同构建了所谓的相似性变换<em class="lm"> T </em>，捕捉完美线性扩展中出现的自由度(图2)。</p><figure class="mr ms mt mu gt ka gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/cbaa6842e0aa1544988e404afafc553a.png" data-original-src="https://miro.medium.com/v2/resize:fit:380/1*TETBts1xcY5IxE0gIeyShA.gif"/></div><p class="kh ki gj gh gi kj kk bd b be z dk translated">等式1:相似变换。该等式描述了源点x的缩放s、移动t和旋转R，详细说明参见。</p></figure><p id="c2de" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">使用elastix(一个用于图像配准的C++库)优化这种转换，如果出现的失真是刚性的，则产生高相关指数。</p><figure class="mr ms mt mu gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi mw"><img src="../Images/ba46403c5ab1fe1fed334c426e7035c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:456/format:webp/1*AfSjil-Rg5GNagBAEWL4kA.png"/></div></div><p class="kh ki gj gh gi kj kk bd b be z dk translated"><strong class="bd kl">图3: B样条变换</strong> <strong class="bd kl"> ( <em class="km">图片作者)</em> </strong>。</p></figure><p id="1e71" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">为了检测剩余的各向异性，我们尝试尽可能好地对齐我们的相似性变换的结果，并应用弹性B样条变换。B样条变换引入了具有<em class="lm"> N_x </em>控制点和每个控制点的2个自由度的规则网格。这为精确对准提供了高度的灵活性(图3)。</p><figure class="mr ms mt mu gt ka gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/0c12b10c1cd2af7bc33c2c65eec2b75f.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/1*XskH3PQTdRZK5SLJIgaxEA.gif"/></div><p class="kh ki gj gh gi kj kk bd b be z dk translated">等式2: B样条变换:该等式描述了当前位置x向立方插值B样条控制点x_k的移动。有关详细说明，请参见。</p></figure><p id="3de6" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">用优化的B样条变换来变换网格X，Y产生了局部矢量偏移，其指示了在与相似性变换对齐之后剩余的各向异性(图4)。</p><figure class="mr ms mt mu gt ka gh gi paragraph-image"><div class="gh gi my"><img src="../Images/54ab6efa916ebc25d6fbe414a83a2744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*fGmj_ulPEhkwUejC1B73dA.jpeg"/></div><p class="kh ki gj gh gi kj kk bd b be z dk translated"><strong class="bd kl">图4:</strong><strong class="bd kl">NK细胞上的排列过程。 </strong></p></figure></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h1 id="24e5" class="ln lo iq bd lp lq ng ls lt lu nh lw lx ly ni ma mb mc nj me mf mg nk mi mj mk bi translated">分步指南，用于对齐扩展前和扩展后的映像</h1><p id="97bf" class="pw-post-body-paragraph kn ko iq kp b kq ml ks kt ku mm kw kx ky mn la lb lc mo le lf lg mp li lj lk ij bi translated">对于以下步骤，必须对膨胀前后的相同结构进行成像。一个困难但(在复习过程中)通常是有益的过程。对齐扩展前和扩展后的图像并创建扭曲贴图只需点击几下鼠标并使用python环境。</p><p id="26d3" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">首先，您需要获得一个与您的python发行版相匹配的simpleelastix⁴(elastix的python绑定)版本。一些预建版本可以在<a class="ae ll" href="https://github.com/acecross/automated_elastix/tree/master/wheels" rel="noopener ugc nofollow" target="_blank">这里</a>找到。如果您的版本不是预构建的，而您使用的是Anaconda，那么最简单的步骤就是用合适的python版本创建一个新环境。例如:</p><pre class="mr ms mt mu gt nl nm nn no aw np bi"><span id="f9af" class="nq lo iq nm b gy nr ns l nt nu">conda create -n "myenv" python=3.6.0</span></pre><p id="b350" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">将SimpleElastix安装到您的虚拟环境中，方法是切换到您刚刚下载并运行的文件夹:</p><pre class="mr ms mt mu gt nl nm nn no aw np bi"><span id="dc5c" class="nq lo iq nm b gy nr ns l nt nu">python setup.py install<!-- --> </span></pre><p id="9cea" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">如果一切顺利，你可以得到一个带有预设变量的工作脚本，并在这里实现绘图<a class="ae ll" href="https://github.com/acecross/automated_elastix" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="fec3" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">对于这个脚本(除了SimpleElastix)，你只需要matplotlib(绘图)，numpy(数组操作)(可能都是预装的)和skimage(图像加载和调整大小)。</p><pre class="mr ms mt mu gt nl nm nn no aw np bi"><span id="4d76" class="nq lo iq nm b gy nr ns l nt nu">conda install scikit-image</span></pre></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><p id="8e6f" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">剩下唯一要做的就是在main.py中定义文件的路径</p><pre class="mr ms mt mu gt nl nm nn no aw np bi"><span id="25c3" class="nq lo iq nm b gy nr ns l nt nu">EXPECTED_EXPANSION = 3.5#replace with your expected expansion factor                      <br/>root = r"PATH TO YOUR DATA"+"\\"#replace with your root directory                       <br/>path1 = r"POST EXPANSION.tif"#replace with your post-expansion image       <br/>path2 = r"PRE EXPANSION.tif" #replace with your pre-expansion image                    <br/>save_dir = root + r"\results"+"\\"                       <br/>save_name = path2.split(".")[0]</span></pre><h1 id="0482" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">关键概念</h1><p id="d10b" class="pw-post-body-paragraph kn ko iq kp b kq ml ks kt ku mm kw kx ky mn la lb lc mo le lf lg mp li lj lk ij bi translated">现在一切都应该启动并运行(如果不是随时与我联系)。在下一节中，我将描述脚本中使用的一些代码概念，以便用python创建和绘制扭曲贴图:</p><h2 id="0b7a" class="nq lo iq bd lp nv nw dn lt nx ny dp lx ky nz oa mb lc ob oc mf lg od oe mj iw bi translated">为扭曲贴图创建B样条变换:</h2><figure class="mr ms mt mu gt ka"><div class="bz fp l di"><div class="of og l"/></div></figure><h2 id="4837" class="nq lo iq bd lp nv nw dn lt nx ny dp lx ky nz oa mb lc ob oc mf lg od oe mj iw bi translated">创建扭曲贴图:</h2><figure class="mr ms mt mu gt ka"><div class="bz fp l di"><div class="of og l"/></div></figure><h2 id="7b93" class="nq lo iq bd lp nv nw dn lt nx ny dp lx ky nz oa mb lc ob oc mf lg od oe mj iw bi translated">结论</h2><p id="27c1" class="pw-post-body-paragraph kn ko iq kp b kq ml ks kt ku mm kw kx ky mn la lb lc mo le lf lg mp li lj lk ij bi translated">本文展示了如何在python中使用SimpleElastix对齐扩展前和扩展后的图像。</p><p id="76b4" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">如果你在安装软件时还有问题或困难，请在评论中告诉我。</p><p id="20a0" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja"> <em class="lm">参考文献:<br/> 1。</em> </strong></p><p id="ac23" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja">②<em class="lm">。</em> </strong> <a class="ae ll" href="https://elastix.lumc.nl/" rel="noopener ugc nofollow" target="_blank"> S. Klein，M. Staring，K. Murphy，M.A. Viergever，J.P.W .普鲁伊姆“elastix:基于强度的医学图像配准工具箱”IEEE医学成像汇刊，第29卷，第1期，第196 - 205页，2010年1月</a></p><p id="169a" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja"> <em class="lm"> 3。</em> </strong> <a class="ae ll" href="https://pubmed.ncbi.nlm.nih.gov/24474917/" rel="noopener ugc nofollow" target="_blank"> D.P. Shamonin，E.E. Bron，B.P.F. Lelieveldt，M. Smits，S. Klein和M. Staring《用于阿尔茨海默病诊断分类的CPU和GPU上的快速并行图像配准》，神经信息学前沿，第7卷，第50期，第1-15页，2014年1月</a></p><p id="bab9" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja"> <em class="lm"> 4。</em> </strong> <a class="ae ll" href="https://ieeexplore.ieee.org/document/7789568" rel="noopener ugc nofollow" target="_blank"> Marstal，k .、Berendsen，f .、Staring，M. &amp; Klein，s .【simple elastix:一个用于医学图像配准的用户友好的多语言库】<em class="lm"> 2016年IEEE计算机视觉和模式识别研讨会会议(CVPRW) </em>，第574–582页，2016年</a></p></div></div>    
</body>
</html>