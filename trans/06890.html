<html>
<head>
<title>Collaborative Filtering Using fast.ai</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用fast.ai的协同过滤</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/collaborative-filtering-using-fast-ai-f33cfea62812?source=collection_archive---------13-----------------------#2021-06-22">https://towardsdatascience.com/collaborative-filtering-using-fast-ai-f33cfea62812?source=collection_archive---------13-----------------------#2021-06-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3110" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解推荐系统</h2></div><p id="7901" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">想知道网飞是如何为用户推荐合适的内容的吗？这一深度探讨集中在推荐系统和嵌入[潜在因素]上，以从用户-项目交互中获得意义。如果你以前没有使用过推荐系统，这个博客对你来说是一个完美的开始。本文描述的模型使用fast.ai库，并假设您对python编程语言以及PyTorch有基本的了解。让我们开始吧。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/bac21eca80a5bb7950dbf3aceb24eb29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-YqEfTQzp6Gv3LWX"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">在<a class="ae lr" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae lr" href="https://unsplash.com/@7th_verse?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Sayan Ghosh </a>拍摄的照片</p></figure><h2 id="5b3b" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">数据分析</h2><p id="9b99" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">首先，让我们熟悉一下“电影镜头”数据集。要将数据输入jupyter笔记本，只需运行下面的单元格。fast.ai函数会帮你完成剩下的工作。</p><p id="d879" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意:该数据集使用100，000个电影排名的子集。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/3065b3bc8d0bc1dd78448da1c8eff794.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*1rlOMcUoMrsalrzjvr0Uuw.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated"><strong class="bd mt">样本收视率数据</strong></p></figure><p id="b5d2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">收视率数据正是我们所需要的。用户栏、电影id、相应的评级和时间戳。为什么要建立模型？因为评价是不完整的，并且推荐者试图为用户以前没有看过的电影填充缺失的评价。</p><h2 id="dcab" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">了解潜在因素</h2><p id="90d6" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">对于那些不熟悉推荐系统的人来说，这是重要的一步。潜在因素基本上是为数据集中的每个用户和电影随机初始化的参数。如果您在这一点上没有得到它，也不要太担心，但请尝试并了解这些潜在因素在协同过滤中的作用(下面的解释)。</p><p id="f758" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设我们知道用户喜欢一部电影所属类别(流派)的程度。现在假设我们也知道关于每部电影的相同信息[即电影与这一类别的紧密程度]。现在，为了填补缺失的评级，只需将这两个潜在因素相乘。答案是你对那部电影的预测评分。信息太多？让我们看一个小例子来理解这个概念。</p><p id="43c9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">尝试运行下面这段代码的代码块:</p><p id="9826" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里假设潜在因子的范围在-1和1之间，正数表示强匹配，负数表示弱匹配。这个例子中的类别是“科幻小说”、“动作片”和“老电影”。也就是说，电影《原力觉醒》有它的潜在因素:1为0.98，表示它“有多科幻”，潜在因素:2为0.9，表示它“有多动作”，潜在因素:3为-0.9，表示它“有多老”。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/a44b608df91ac76e4b90d55be629748b.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*T_M4fAL5paECSjU5hH4OWQ.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated"><strong class="bd mt">科幻电影预测</strong></p></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/f59bee1f295700e91787954a122a424e.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*VNTlnWsrtbNjCXom4psr4A.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated"><strong class="bd mt">言情电影预测</strong></p></figure><p id="4cd1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在这里做了什么？我们基本上是将两个潜在向量/因子相乘，然后将它们的结果相加。如果你想用数据科学术语，你可以称之为“点积”。很简单，对吧？对于数据集中的每个用户和电影都会发生这种情况，这就是该模型的基本原理。从上面的例子中，你可以清楚地看到我对科幻/动作电影感兴趣，所以《原力觉醒》[2015]的评分高于《一个明星诞生》[1937]。</p><blockquote class="mw mx my"><p id="44b3" class="kf kg mz kh b ki kj jr kk kl km ju kn na kp kq kr nb kt ku kv nc kx ky kz la ij bi translated">重要提示:正如这里提到的，评级预测基本上是潜在因素的点积。一旦计算了点积，该模型就试图通过调整潜在因子来最小化损失(使用随机梯度下降，本文将不讨论其细节，但模型实现将简要解释其功能)。</p></blockquote><p id="c907" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就这样—让我们从实际的代码开始:)</p><h2 id="dfc1" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">创建数据加载器</h2><p id="8917" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">为了使这成为一个有趣的练习，让我们将电影片名引入到我们的数据集中，并将它们与收视率数据合并。表“u.item”由映射到标题的电影ID组成，所以让我们把它们拖进来。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/c53580879a401bdf4849c69f5c0540fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*Fyfqvl9aronYQBYP9lf5pQ.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated"><strong class="bd mt">为了更好的直觉，标题被合并</strong></p></figure><p id="9f47" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Dataloaders对象通常将第一列作为用户，第二列作为项目，评级作为第三列。由于我们的项目是电影，我们将其重命名为“标题”，批量大小为64。</p><h2 id="3be2" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">协同过滤的PyTorch表示</h2><p id="eedc" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">潜在因素需要以某种方式表示出来，以便我们对模型有所了解。pyTorch表示它们的方式是使用矩阵。这是使用“torch.randn”函数完成的。工作原理是——py torch根据用户和电影的总数随机创建用户和电影潜在因素。然后用点积来得出评级。我们已经确立了这一点。但是要做这个点积，就要在我们的电影潜在因子矩阵中查找电影的索引，在用户矩阵中查找用户索引。这不是深度学习模型知道的。这就需要嵌入【一个很简单的话题】。</p><p id="e041" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们继续之前，请随意查看pyTorch如何在没有嵌入的情况下创建以下潜在因素:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mq mr l"/></div></figure><h2 id="744f" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">嵌入</h2><p id="bcb6" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">尽管“嵌入”这个术语听起来很奇怪，但其基本概念却很简单。这也是直接索引条目的行话。为了定义嵌入，让我们创建一个类和一个函数来定义潜在因素(嵌入)以及这些因素的点积，以达到预测的评级。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="a945" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很简单，对吧？第一块使用嵌入创建用户和电影潜在因素，而第二块将两者相乘(点积)。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="002f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里要理解的关键是模型接受一个形状张量(batch_size x 2)作为输入。这里第一列代表用户id，第二列代表电影id。嵌入层用于表示用户和电影潜在因素的矩阵。再次，自己探索一下数据。例如，分别看一下x和y。</p><h2 id="abd1" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">模范学习者</h2><p id="8886" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">嵌入完成后，我们只剩下运行模型了。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/ab41e70424a7b6328087facd38a44efe.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*GDK-dcPADkXLGXMI9EBYsA.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated"><strong class="bd mt">历元&amp;损失— I </strong></p></figure><p id="139a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结果相当不错。我们可以通过使用sigmoid_range来进一步改进它，以确保我们的预测评级在0到5之间。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="ce7e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在让我们尝试运行模型</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/2f693830ec10d25aceaf92872a59b224.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*qBQ1ksA5JLujuaYxRQYQJA.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated"><strong class="bd mt">时期&amp;损失-II(具有乙状结肠范围)</strong></p></figure><p id="3685" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">差别不大。我们肯定能做得比这更好。我们可以尝试的一件重要或显而易见的事情是考虑偏见。如果我们可以为每个用户添加一个数字，并对每部电影都这样做，我们将考虑用户和电影的偏见。所以让我们来试试这个。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/435b74202d1c38d44f9e3b7c81d14cda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*WZt57eIm1VtOP1pRs2NMsg.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated"><strong class="bd mt">时代&amp;损失— III(有偏差)</strong></p></figure><p id="17a9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不太好。我们的结果变得更糟了。我们可以尝试的最后一件事肯定会改善我们的模型结果。让我们介绍一下我们数据科学家称之为加权衰减或L2正则化。该参数将基本上控制我们添加到损耗中的平方和，并减少过拟合。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nh"><img src="../Images/b0a66c5af1e28d29f7a7d840f805c247.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*3ZHM0KXSIgdSQG5lXD8KhA.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated"><strong class="bd mt">纪元&amp;损失—四(与L2) </strong></p></figure><p id="e3d5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好多了。我们的成绩终于提高了。现在，让我们从这些建议中获得一些视觉效果和见解。</p><h2 id="ed87" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">解释嵌入和偏见</h2><p id="86a6" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">该模型为我们提供了建议，但看到它识别出了哪些因素是非常有趣的。让我们试着看看偏见。下面的代码给了我们偏差最小的电影。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/f2c11fd26899eaac5d56249246dff054.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*CAwOYXar2SI3eu0SGCuGWA.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated"><strong class="bd mt">偏见最低的电影</strong></p></figure><p id="d7b5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是什么意思？这基本上是在告诉我们，这些电影可能与某些用户的潜在因素非常匹配，但最终仍然不被用户喜欢。我们可以只按平均评级对电影进行分类，但这种使用偏见的观点更有趣，因为它不仅告诉我们一部电影是否是人们不太喜欢的那种，而且告诉我们这样一个事实，即它完全属于他们喜欢的类别，但他们并不总是喜欢它。</p><p id="94fe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我很赞同这个模式。这些是一些糟糕的电影(其中一些是闻所未闻的，至少对我来说是这样——比如《歌舞女郎》, Bio-Dome的互联网评分低于5分)</p><p id="82bf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从这个意义上说，这是获得最具偏见的电影的代码。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/cf133b136bdc1b3c3acb434e4869e312.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*ZfyOmkgHInR0NlsM22DaDA.png"/></div><p class="ln lo gj gh gi lp lq bd b be z dk translated"><strong class="bd mt">偏见最高的电影</strong></p></figure><p id="728a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这也是我不得不同意的一点。这是一个疯狂的电影列表。我个人已经看了全部10部电影，所以电影中的偏见已经被很好地考虑进去了。</p><h2 id="718e" class="ls lt iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">用于可视化电影的PCA</h2><p id="739f" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">解释嵌入并不那么直接，因为维数通常很高。但是我们可以使用主成分分析来提取最重要的信息，并观察电影是如何分散在较低的维度中的。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nk"><img src="../Images/f0f44e5dcd8535129dbbee0b40bb6320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z7l-LNg2auZBd_fqV6hJcg.png"/></div></div><p class="ln lo gj gh gi lp lq bd b be z dk translated">潜在空间中的电影PCA情节</p></figure><p id="d4ec" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个情节挺有意义的。如果你注意到，我们有一些科幻电影，如《帝国反击战》、《绝地归来》、《星际迷航》、《印第安纳琼斯》等。左边是一些新黑色电影，如《教父》和《法戈》。这是几个例子，说明相似的电影在潜在空间中表现得有多相似。</p><p id="c749" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇博客到此结束。要查看完整代码和其他机器学习算法的笔记本，请关注我的<a class="ae lr" href="https://github.com/the-mean-square" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir"><em class="mz">【github</em></strong></a>。</p></div></div>    
</body>
</html>