<html>
<head>
<title>Charting with Plotly Dash</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用虚线绘制图表</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/charting-with-plotly-dash-ee9334441c11?source=collection_archive---------20-----------------------#2021-12-15">https://towardsdatascience.com/charting-with-plotly-dash-ee9334441c11?source=collection_archive---------20-----------------------#2021-12-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c478" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><strong class="ak"> 2:用于转换的单选项目</strong></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ae68fc072c964fafc6ab3520e006ce42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nnQc6pvQiBYKwWI4"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@mvdheuvel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马腾·范登赫维尔</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="dabc" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">生物燃料</strong></h1><p id="29f9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">生物燃料无疑是取代目前用于车辆推进的化石燃料的最有吸引力和最实用的选择。<strong class="lt iu">生物乙醇</strong>和<strong class="lt iu">生物柴油</strong>从富含糖类和淀粉的农作物中提取，具有减少二氧化碳排放和缓解<strong class="lt iu">气候变化不利影响的潜力。</strong></p><p id="2fa4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">阿根廷的生物燃料部门在过去十年中发展迅速，成为国民经济中一项非常活跃的活动，也是生产发展的一个有趣案例。</p><p id="115f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在阿根廷，生物柴油完全是以大豆为原料生产的，大豆油是制造这种生物燃料的主要原料。生物柴油的生产吸引了大量国内外投资，在阿根廷生产链中加入了一个新的环节，将生产分为国内市场和出口市场。</p><p id="ab0c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">阿根廷的生物乙醇生产以糖蜜为基础，糖蜜是<strong class="lt iu">制糖</strong>的副产品，直接来自<strong class="lt iu">甘蔗</strong>(<em class="ms">Sacharum officinarum L</em>)和谷物，主要是<strong class="lt iu">玉米</strong> ( <em class="ms">玉蜀黍</em>)。液体生物燃料的产生对甘蔗转化链是一个有价值的补充。</p><h1 id="cbd0" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">仪表盘应用</strong></h1><p id="9887" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在<a class="ae ky" rel="noopener" target="_blank" href="/charting-with-plotly-dash-fa96c171409b">之前的一篇文章</a>中，我们讨论了 Dash 的基本特性:一个开源的免费库，麻省理工学院许可的 python 框架，广泛用于创建基于 web 的、可定制的、交互式的、响应性强的仪表盘和 dataviz 应用程序。</p><p id="6504" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Dash 主要基于 ReactJS，Flask，和 Plotly。Dash 建立在 ReactJS 的顶部作为前端；它使用 Flask 作为后端，Plotly 作为数据可视化工具。</p><p id="9857" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如<a class="ae ky" rel="noopener" target="_blank" href="/charting-with-plotly-dash-fa96c171409b">上一篇文章</a>所述，Dash 包括三个主要的库:(1) <em class="ms"> dash_html_components </em>，它提供了多种 html 标签的 python 版本，可以在标题、段落、图形等应用中使用。；(2) <em class="ms"> dash_core_components </em>，提供下拉菜单、单选按钮、图表、滑块、按钮等多种元素；(3)<em class="ms">dash _ bootstrap _ components，</em>用于样式化用户界面。</p><p id="3ed5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">本质上，Dash 应用程序(<strong class="lt iu"> Dash Apps </strong>)由两部分组成:(1)描述应用程序外观的应用程序的“<em class="ms">布局</em>”和(2)允许应用程序交互的“<em class="ms">回调</em>”。</p><p id="a132" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们的仪表板外观(我们的布局)由以下内容组成:在左上角，一个条形图显示了阿根廷的生物乙醇总产量，另一个图表(转换)显示了甘蔗产量和玉米产量之间的比例。在右上角，一个条形图显示了阿根廷的生物柴油总产量，另一个图表(转换)显示了出口和国内市场产量之间的关系。在左下方，我们包括了一个堆积面积图，显示了 2015 年至 2020 年期间主要生物乙醇生产国的发展情况。最后，在我们布局的右下方，我们包括了一个面积图，显示了 2010 年至 2019 年期间世界生物柴油生产的发展。</p><p id="e59c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们的仪表板的转换是通过使用由<em class="ms"> dash_core_components </em>库提供的组件<em class="ms"> RadioItems </em>来实现的。功能<em class="ms"> dcc。来自 Dash 库<em class="ms"> dash_core_components </em>的 RadioItems() </em>允许我们<strong class="lt iu">呈现一组复选框。我们必须编写类似 dcc 的代码。放射性项目(选项=[{}..]，value=) ，其中<em class="ms">选项</em>是带有<em class="ms">键</em>的<em class="ms">字典</em>列表，<em class="ms">值</em>是当前选择的值。</strong></p><p id="6c28" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Dash App 的交互性是通过使用<strong class="lt iu">回调函数</strong>来实现的。在我们的仪表板中，我们必须创建一个回调函数来指示哪些图表显示在布局的顶部。如前一篇文章所述，回调函数有两个主要部分:(1)装饰器，使用<em class="ms"> @app.callback() </em>初始化；(2)用<em class="ms"> def </em>关键字初始化的函数。</p><h1 id="6664" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">带破折号的图表</strong></h1><p id="eb5c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们与四个<strong class="lt iu">公共领域数据集</strong> : (1)阿根廷，系列 Históricas，Indicadores del Sector energyético，Biocombustibles，Cuadro 3.1: <a class="ae ky" href="https://www.indec.gob.ar/indec/web/Nivel4-Tema-3-36-145" rel="noopener ugc nofollow" target="_blank">生物柴油；</a> (2)阿根廷，Históricas 系列，能源部门指数，生物燃料，Cuadro 3.2: <a class="ae ky" href="https://www.indec.gob.ar/indec/web/Nivel4-Tema-3-36-145" rel="noopener ugc nofollow" target="_blank">生物乙醇</a>；(3) <a class="ae ky" href="https://ethanolrfa.org/markets-and-statistics/annual-ethanol-production" rel="noopener ugc nofollow" target="_blank">世界燃料乙醇年产量；</a> (4) EIA，美国能源信息署，国际，<a class="ae ky" href="https://www.eia.gov/international/data/world/biofuels/more-biofuels-data" rel="noopener ugc nofollow" target="_blank">生物燃料</a>。</p><p id="96d4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">首先，我们将 Pandas 库导入为 pd，将 Plotly Express 导入为 px，将 plotly.graph_objects 导入为 go，并将我们的第一个 csv 文件转换为 dataframe:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="8533" class="my la it mu b gy mz na l nb nc">import pandas as pd<br/>import plotly.express as px<br/>import plotly.graph_objects as go</span><span id="ccb4" class="my la it mu b gy nd na l nb nc"># Step 1: Argentine bioethanol production (units in m3)<br/>df_bioet = pd.read_csv(path + 'produccion_de_bioetanol.csv', <br/>                       index_col = False,  sep = ';',<br/>                       engine = 'python',<br/>                       header = 1, skiprows = 2, skipfooter = 3)</span></pre><p id="fc70" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面这张截图(<em class="ms"> df_bioet </em>)展示了一个<strong class="lt iu">数据科学家最糟糕的噩梦</strong>:一个数据帧，有缺失数据、冗余数据、重复数据、缺失列名、列名不一致、奇怪字符等。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/c7d7ac4faf059d68c8ff3f357012a176.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*NArb8Aadq7ursr_g3Zi3EA.png"/></div></figure><p id="a2cc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">因此，我们必须努力将其转换为适合制图的数据框架:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="49a9" class="my la it mu b gy mz na l nb nc">df_bioet = df_bioet.drop(0)</span><span id="3d8f" class="my la it mu b gy nd na l nb nc">df_bioet.columns = ['Year','Period', 'Tot_Prod', 'Perc_Tot', 'Cane_Prod','Perc_SCT', 'Corn_Prod', 'Perc_Corn', 'Market', 'Perc_Mkt']</span><span id="4709" class="my la it mu b gy nd na l nb nc">cols_to_drop = ['Perc_Tot', 'Perc_SCT', 'Perc_Corn', 'Perc_Mkt']</span><span id="1425" class="my la it mu b gy nd na l nb nc">df_bioet = df_bioet.drop(cols_to_drop, axis = 1)<br/>df_bioet['Year'] = df_bioet['Year'].str.replace('*', ' ')</span><span id="fcbe" class="my la it mu b gy nd na l nb nc">df_bioet['Tot_Prod']   = df_bioet['Tot_Prod'].str.replace(',', '')<br/>df_bioet['Cane_Prod']  = df_bioet['Cane_Prod'].str.replace(',', ''<br/>df_bioet['Corn_Prod']  = df_bioet['Corn_Prod'].str.replace(',', '')<br/>df_bioet['Corn_Prod']  = df_bioet['Corn_Prod'].str.replace('-', '0')<br/>df_bioet['Market']     = df_bioet['Market'].str.replace(',', '')<br/>df_bioet['Market']     = df_bioet['Market'].str.replace('-', '0'<br/>df_bioet.reset_index()</span><span id="07f2" class="my la it mu b gy nd na l nb nc">f = df_bioet['Year'].notnull()<br/>serie = df_bioet.loc[f, "Year"] = df_bioet['Year'].ffill()<br/>df_bioet['Year'] = serie</span><span id="df18" class="my la it mu b gy nd na l nb nc">df_bioet['Year']      = df_bioet['Year'].astype(int)<br/>df_bioet['Tot_Prod']  = df_bioet['Tot_Prod'].astype(int)<br/>df_bioet['Cane_Prod'] = df_bioet['Cane_Prod'].astype(int)<br/>df_bioet['Corn_Prod'] = df_bioet['Corn_Prod'].astype(int)<br/>df_bioet['Market']    = df_bioet['Market'].astype(int)<br/>df_bioet['Period']    = df_bioet['Period'].apply(str)</span><span id="ddb5" class="my la it mu b gy nd na l nb nc">tipo1 = df_bioet.dtypes</span><span id="acea" class="my la it mu b gy nd na l nb nc">pvt1 = pd.pivot_table(df_bioet, index = ['Year'],<br/>                values = ['Tot_Prod','Cane_Prod','Corn_Prod' ],<br/>                aggfunc = 'sum')</span></pre><p id="2e0f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">以下截图对应于名为<em class="ms"> pvt1 </em>的数据帧:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/211bdced02e2f4e39335942f45df79de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*xH02cQzP2QmJkD3JaKXLHA.png"/></div></figure><p id="1ac7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">数据框架中仍有一些干预措施:将生产值减半(它们在原始文件中是重复的)并删除 2009 年和 2021 年的记录，因为这两个记录都不完整:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="d8de" class="my la it mu b gy mz na l nb nc">pvt2 = pvt1/2<br/>pvt2 = pvt2[1:]<br/>pvt2 = pvt2[:-1]</span><span id="30d2" class="my la it mu b gy nd na l nb nc">pvt2.reset_index(level = 0, inplace = True)</span></pre><p id="c570" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在我们为图表做好了准备。一个<a class="ae ky" href="https://medium.com/nightingale/bar-graphs-why-how-8c031c224c9f" rel="noopener">标准条形图</a>是我们讲故事最符合逻辑的选择。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="6411" class="my la it mu b gy mz na l nb nc"># First Figure: Total Argentine Bioethanol Production </span><span id="e21f" class="my la it mu b gy nd na l nb nc">fig1 = go.Figure(data=[go.Bar(x=pvt2['Year'], y= pvt2['Tot_Prod'],<br/>                       marker_color = 'DarkSlateGrey')])</span><span id="d835" class="my la it mu b gy nd na l nb nc">fig1.update_layout(title= {'text':"Argentine BioethanolProduction",<br/>                           'font': {'size': 15}},<br/>                   title_x = 0.5,<br/>                   xaxis_title= 'Year', <br/>                   yaxis_title = 'Production (m3)',<br/>                   width =  700, height = 500)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/761681e90b81fd6000c45c2b7e2b7089.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*4ZY-znYQz23NoQOY21FksA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 1:阿根廷生物乙醇的生产。作者用 Plotly 制作的图表。</p></figure><p id="763c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">绘制阿根廷生物柴油生产图表的 ETL 过程与之前的过程完全相似，在初始数据库中存在相同的问题，并且增加了单位转换(从吨到立方米)。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="d609" class="my la it mu b gy mz na l nb nc"># Step 2: Argentine biodiesel production (values in tons)</span><span id="6331" class="my la it mu b gy nd na l nb nc">df_biodsl = pd.read_csv(path + 'produccion_de_biodiesel.csv',<br/>                        index_col = False,  sep = ';', <br/>                        engine = 'python',header = 1, <br/>                        skiprows = 1, skipfooter = 4)</span><span id="7925" class="my la it mu b gy nd na l nb nc">df_biodsl = df_biodsl.drop(0)<br/>df_biodsl.columns = ['Year','Period', 'Tot_Prod',<br/>                     'Perc_Tot', 'Market',<br/>                     'Perc_Mkt', 'Export', 'Perc_Exp']</span><span id="aa42" class="my la it mu b gy nd na l nb nc">cols_to_drop = ['Perc_Tot', 'Perc_Mkt', 'Perc_Exp']</span><span id="6e72" class="my la it mu b gy nd na l nb nc">df_biodsl = df_biodsl.drop(cols_to_drop, axis = 1)</span><span id="6c9d" class="my la it mu b gy nd na l nb nc">df_biodsl['Year']    = df_biodsl['Year'].str.replace('*', ' ')<br/>df_biodsl['Tot_Prod']= df_biodsl['Tot_Prod'].str.replace(',', '')<br/>df_biodsl['Export']  = df_biodsl['Export'].str.replace(',', '')<br/>df_biodsl['Export']  = df_biodsl['Export'].str.replace('-', '0')<br/>df_biodsl['Export']  = df_biodsl['Export'].str.replace('s', '0')<br/>df_biodsl['Market']  = df_biodsl['Market'].str.replace(',', '')<br/>df_biodsl['Market']  = df_biodsl['Market'].str.replace('-', '0')<br/>df_biodsl.reset_index()</span><span id="f433" class="my la it mu b gy nd na l nb nc">f = df_biodsl['Year'].notnull()<br/>serie = df_biodsl.loc[f, 'Year'] = df_biodsl['Year'].ffill()<br/>df_biodsl['Year'] = serie</span><span id="ce72" class="my la it mu b gy nd na l nb nc">df_biodsl['Year']      = df_biodsl['Year'].astype(int)<br/>df_biodsl['Tot_Prod']  = df_biodsl['Tot_Prod'].astype(int)<br/>df_biodsl['Export']    = df_biodsl['Export'].astype(int)<br/>df_biodsl['Market']    = df_biodsl['Market'].astype(int)<br/>df_biodsl['Period']    = df_biodsl['Period'].apply(str)<br/>tipo2 = df_biodsl.dtypes</span><span id="ad82" class="my la it mu b gy nd na l nb nc">pvt3 = pd.pivot_table(df_biodsl, index = ['Year'],<br/>                      values = ['Tot_Prod','Export','Market' ],<br/>                      aggfunc = 'sum')</span><span id="6b7b" class="my la it mu b gy nd na l nb nc">pvt4 = pvt3/2<br/>pvt4 = pvt4[:-1]</span><span id="0387" class="my la it mu b gy nd na l nb nc"># From tons to cubic meters<br/>pvt4[['Tot_Prod','Export','Market']]=<br/>               pvt4[['Tot_Prod','Export','Market']]* 1.1325<br/>pvt4.reset_index(level = 0, inplace = True)</span></pre><p id="b5df" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">同样，标准条形图<a class="ae ky" href="https://medium.com/nightingale/bar-graphs-why-how-8c031c224c9f" rel="noopener">是我们讲故事的最合理选择:</a></p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="ea1b" class="my la it mu b gy mz na l nb nc"># Third Figure: Total Argentine Biodiesel Production</span><span id="82e8" class="my la it mu b gy nd na l nb nc">fig3 = go.Figure(data=[go.Bar(x= pvt4['Year'], y= pvt4['Tot_Prod'],<br/>                              marker_color = 'DarkSlateBlue')])</span><span id="b547" class="my la it mu b gy nd na l nb nc">fig3.update_layout(title={'text': "Argentine Biodiesel Production ",<br/>                          'font': {'size': 15}},<br/>                   title_x = 0.5,<br/>                   xaxis_title = 'Year',<br/>                   yaxis_title = 'Production (m3)',<br/>                   width =  700, height = 500)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/d3d78f5fbb88c273637d6a15e0331bc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*ufPWkf_WQuS93WrwHxpUaQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 2:阿根廷生物柴油的生产。作者用 Plotly 制作的图表。</p></figure><p id="0fba" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下图与世界乙醇产量有关。我们决定用<a class="ae ky" rel="noopener" target="_blank" href="/area-charts-standard-stacked-overlapping-d9b77df5dec8">堆积面积图</a>来表示两个是主要生产国，占全球产量的 85%以上。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="5e8d" class="my la it mu b gy mz na l nb nc">## Step 3: World Bioethanol production (values in Mgal)</span><span id="de90" class="my la it mu b gy nd na l nb nc">df_wrld_et = pd.read_csv(path + 'world_ethanol.csv',<br/>                         index_col = False,  sep = ';',<br/>                         engine = 'python',<br/>                         header = 0, skipfooter = 3)</span><span id="6a90" class="my la it mu b gy nd na l nb nc">df_wrld_et_T = df_wrld_et.transpose()<br/>df_wrld_et_T.columns = df_wrld_et_T.iloc[0]<br/>df_wrld_et_T = df_wrld_et_T[1:]<br/>df_wrld_et_T.index.names = ['Year']<br/>df_wrld_et_T.reset_index(level = 0, inplace = True)</span><span id="b3cc" class="my la it mu b gy nd na l nb nc"># Sixth figure: stacked area chart for world bioethanol production<br/># 3785.4411 is the factor of conversion from Mgal to cubic meter</span><span id="3d16" class="my la it mu b gy nd na l nb nc">fig6 = go.Figure()<br/>fig6.add_trace(go.Scatter(x = df_wrld_et_T['Year'],<br/>                          y = df_wrld_et_T['USA']*3785.4411,<br/>                          name = 'USA',<br/>                          mode = 'lines', <br/>                          line=dict(width=0.5, color='orange'),<br/>                          stackgroup = 'one'))</span><span id="ba7f" class="my la it mu b gy nd na l nb nc">fig6.add_trace(go.Scatter(x= df_wrld_et_T['Year'],<br/>                          y= df_wrld_et_T['BRAZIL']*3785.4411,<br/>                          name = 'BRAZIL',<br/>                          mode = 'lines', <br/>                          line=dict(width=0.5,color='darkgreen'),<br/>                          stackgroup = 'one'))</span><span id="52f1" class="my la it mu b gy nd na l nb nc">fig6.add_trace(go.Scatter(x=df_wrld_et_T['Year'],<br/>                         y=df_wrld_et_T['EUROPEAN UNION']*3785.4411,<br/>                         name = 'EUROPEAN UNION',<br/>                         mode = 'lines', <br/>                         line=dict(width=0.5, color='blue'),<br/>                         stackgroup = 'one')</span><span id="1848" class="my la it mu b gy nd na l nb nc">fig6.add_trace(go.Scatter(x= df_wrld_et_T['Year'], <br/>                          y=df_wrld_et_T['CANADA']*3785.4411,<br/>                          name = 'CANADA',<br/>                          mode = 'lines',  <br/>                          line=dict(width=0.5,color='crimson'),<br/>                          stackgroup = 'one'))</span><span id="2cab" class="my la it mu b gy nd na l nb nc">fig6.add_trace(go.Scatter(x=df_wrld_et_T['Year'],<br/>                          y=df_wrld_et_T['THAILAND']*3785.4411,<br/>                          name = 'THAILAND',<br/>                          mode = 'lines',<br/>                          line=dict(width=0.5,color='lightblue'),<br/>                          stackgroup = 'one'))</span><span id="270b" class="my la it mu b gy nd na l nb nc">fig6.add_trace(go.Scatter(x = df_wrld_et_T['Year'],<br/>                          y=df_wrld_et_T['CHINA']*3785.4411,<br/>                          name = 'CHINA',<br/>                          mode = 'lines', <br/>                          line=dict(width=0.5, color='red'),<br/>                          stackgroup = 'one'))</span><span id="99a9" class="my la it mu b gy nd na l nb nc">fig6.add_trace(go.Scatter(x=df_wrld_et_T['Year'],        <br/>                          y=df_wrld_et_T['ARGENTINA']*3785.4411,<br/>                          name = 'ARGENTINA',<br/>                          mode = 'lines', <br/>                          line=dict(width=0.5, color='yellow'),<br/>                          stackgroup = 'one'))</span><span id="83b3" class="my la it mu b gy nd na l nb nc">fig6.add_trace(go.Scatter(x = df_wrld_et_T['Year'], <br/>                          y=df_wrld_et_T['INDIA']*3785.4411 ,<br/>                          name = 'INDIA',<br/>                          mode = 'lines', <br/>                          line=dict(width=0.5, color='darkgrey'),<br/>                          stackgroup = 'one'))</span><span id="28b2" class="my la it mu b gy nd na l nb nc">fig6.add_trace(go.Scatter(x=df_wrld_et_T['Year'],<br/>                         y=df_wrld_et_T['REST OF WORLD']*3785.4411,<br/>                         name = 'REST OF WORLD',<br/>                         mode = 'lines',<br/>                         line=dict(width=0.5, color='darkred'), <br/>                        stackgroup = 'one'))</span><span id="3bee" class="my la it mu b gy nd na l nb nc">fig6.update_layout(template = 'plotly_dark',<br/>              title = dict(text = "World Bioethanol Production ",<br/>              x = 0.5, y = 0.95),<br/>              title_font= dict(family = 'Arial', size = 25),<br/>              font = dict(size = 10, family = 'Verdana'),<br/>              hovermode = False,<br/>              width  = 700, height = 400)</span><span id="de79" class="my la it mu b gy nd na l nb nc">fig6.update_xaxes(title_text = 'Year',<br/>        title_font=dict(size =15, family='Verdana', color='white'),<br/>        tickfont=dict(family='Calibri', color='white', size=15))</span><span id="04ca" class="my la it mu b gy nd na l nb nc">fig6.update_yaxes(title_text = "Production (m3)",<br/>        title_font=dict(size=15, family='Verdana', color='white'),<br/>         tickfont=dict(family='Calibri', color='white', size=15))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/5cc7c26209edf2e9474ef14518b77ea1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*yaaMsP1xtjjz9-6wAqBSZQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 3:世界生物乙醇产量。作者用 Plotly 制作的图表。</p></figure><p id="9efb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，我们使用<a class="ae ky" rel="noopener" target="_blank" href="/area-charts-with-plotly-express-510a1f12ac11">面积图</a>展示了生物柴油的世界产量。同样，我们有 ETL 任务，包括列转置、列重命名和行删除。我们还必须将每天数百万桶原油转换成立方米。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="f388" class="my la it mu b gy mz na l nb nc">## Step 4: World Biodiesel production</span><span id="6f33" class="my la it mu b gy nd na l nb nc">df_wrld_di = pd.read_csv(path + 'world_biodiesel.csv',<br/>                         index_col = False,  sep = ';', <br/>                         engine = 'python', header = 1)</span><span id="4cfb" class="my la it mu b gy nd na l nb nc">df_wrld_di = df_wrld_di.iloc[0:2]<br/>df_wrld_di = (df_wrld_di.iloc[1: , : ]).set_index("API")<br/>lista = df_wrld_di.columns.values.tolist()<br/>df_wrld_di_T = df_wrld_di.transpose()<br/>df_wrld_di_T['Year'] = lista<br/>df_wrld_di_T = df_wrld_di_T.iloc[11:22]<br/>df_wrld_di_T.rename(columns={'INTL.81-1-WORL-TBPD.A': 'DieselProd'}, inplace=True)</span><span id="41a4" class="my la it mu b gy nd na l nb nc"># conversion from Mb/d to cubic meter</span><span id="04b2" class="my la it mu b gy nd na l nb nc">df_wrld_di_T['DieselProd']= df_wrld_di_T['DieselProd'].astype(float)</span><span id="e758" class="my la it mu b gy nd na l nb nc">df_wrld_di_T[['DieselProd']] = df_wrld_di_T[['DieselProd']]*365 * 0.158990</span><span id="5c44" class="my la it mu b gy nd na l nb nc">df_wrld_di_T['DieselProd'] = df_wrld_di_T['DieselProd'].round(2)</span><span id="a247" class="my la it mu b gy nd na l nb nc">df_wrld_di_T.reset_index(drop = True, inplace = True)</span><span id="2153" class="my la it mu b gy nd na l nb nc"># Seventh figure: area chart for world biodiesel production</span><span id="3e66" class="my la it mu b gy nd na l nb nc">fig7 = px.area(df_wrld_di_T, x = 'Year', y = 'DieselProd')</span><span id="e491" class="my la it mu b gy nd na l nb nc">fig7.update_layout(template = 'plotly_dark',<br/>             title = dict(text = "World Biodiesel Production",<br/>             x = 0.5, y = 0.95),<br/>             title_font= dict(family = 'Arial', size = 25),<br/>             width = 700, height = 400)</span><span id="9425" class="my la it mu b gy nd na l nb nc">fig7.update_xaxes(title_text = 'Year',<br/>      title_font=dict(size=15, family='Verdana', color='white'),<br/>      tickfont=dict(family='Calibri', color='white', size=15))</span><span id="387c" class="my la it mu b gy nd na l nb nc">fig7.update_yaxes(title_text = "Production (Mm3)", <br/>                  range = (0, 50000),<br/>      title_font=dict(size=15, family='Verdana', color='white'),<br/>      tickfont=dict(family='Calibri', color='white', size=15))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/266fae57d1d9d3b87e988afb39d3e601.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*cAbq9x4XtOkT2IraP224Kw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 4:世界生物柴油产量。作者用 Plotly 制作的图表。</p></figure><p id="b1a1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，是时候对仪表板进行编码了。</p><p id="5690" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们假设您安装了 Dash 如果没有，遵循这些<a class="ae ky" href="https://dash.plotly.com/installation" rel="noopener ugc nofollow" target="_blank">指令</a>。</p><p id="e19d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">首先需要导入一些库:dash，主库；<em class="ms"/>dash _ html _ components(<em class="ms">html)</em>用于构建布局；dash _ core _ components(<em class="ms">DCC</em>)来呈现一组复选框和 plotly 图形；<em class="ms">输出，输入</em>函数来自模块 dash.dependencies 进行回调。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="4b9f" class="my la it mu b gy mz na l nb nc">import dash<br/>from dash import html<br/>from dash import dcc<br/>from dash.dependencies import Output, Input</span></pre><p id="0be5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><em class="ms"> dcc.graph </em>组件有三个参数:(1) <em class="ms"> id </em>，每个图的唯一标识符；(2) <em class="ms">图</em>，每一个 plotly 图的具体名称；(3) <em class="ms"> style </em>，字典定义了图的某些方面如宽度和高度。</p><p id="2c14" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">以下代码描述了该应用程序的外观。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="c59b" class="my la it mu b gy mz na l nb nc">external_stylesheets= ['https://codepen.io/chriddyp/pen/bWLwgP.css']</span><span id="ce4c" class="my la it mu b gy nd na l nb nc">app = dash.Dash(__name__, external_stylesheets=external_stylesheets)</span><span id="6dec" class="my la it mu b gy nd na l nb nc">app.layout = html.Div(children =[<br/>                html.Div([<br/>                   html.H1(children = 'Biofuels',<br/>                           style = {'textAlign':'center',  <br/>                                    'color':'darkblue',<br/>                                    'fontSize'  : '30px',<br/>                                    'fontWeight': 'bold'}<br/>                           ),</span><span id="2b06" class="my la it mu b gy nd na l nb nc">               html.Div([<br/>                dcc.RadioItems(id ='radio1',<br/>                               options =<br/>                   [{'label': 'Total Prod.  ', 'value': 'figT'},<br/>                   {'label': 'Composition',   'value': 'figC'},],<br/>                               value ='figT',<br/>                             labelStyle ={'display': 'inline-flex'}                                     </span><span id="d707" class="my la it mu b gy nd na l nb nc">                              ),</span><span id="791c" class="my la it mu b gy nd na l nb nc">               html.Div([<br/>                 dcc.Graph(id = 'A-ethanol-graph', figure = fig1,<br/>                         style={'width': '80vh', 'height': '40vh',<br/>                                'display': 'inline-block'}),<br/>                          ], className = 'five columns'),</span><span id="0881" class="my la it mu b gy nd na l nb nc">               html.Div([<br/>                 dcc.Graph(id = 'A-biodiesel-graph', figure = fig3,<br/>                        style={'width': '80vh',<br/>                               'display': 'inline-block'}),<br/>                          ], className = 'six columns'),</span><span id="4c15" class="my la it mu b gy nd na l nb nc">                         ],className='row'),</span><span id="ca45" class="my la it mu b gy nd na l nb nc">              html.Div([<br/>                html.Div([<br/>                  dcc.Graph(id = 'W-ethanol-graph', figure = fig6,<br/>                         style={'width': '80vh', 'height': '10vh',<br/>                                'display': 'inline-block'}),<br/>                          ], className = 'six columns'),</span><span id="f636" class="my la it mu b gy nd na l nb nc">               html.Div([<br/>                  dcc.Graph(id = 'W-biodiesel-graph', figure = fig7,<br/>                            style={'width': '80vh',<br/>                                   'display': 'inline-block'}),<br/>                         ], className = 'six columns'),</span><span id="b50d" class="my la it mu b gy nd na l nb nc">                         ]),<br/>               ]),<br/>        ])</span></pre><p id="8c5b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，是回调的时候了。我们有一个输入:组件的值<em class="ms"> dcc。放射性同位素</em>；和两个输出:(1)生物乙醇和生物柴油总产量的标准柱状图(<em class="ms">图 1 </em> &amp; <em class="ms">图 3 </em>)。(2)一个<a class="ae ky" rel="noopener" target="_blank" href="/clustered-overlapped-bar-charts-with-plotly-express-c752d2925cf1">分组柱状图</a> ( <em class="ms">图 2 </em>)显示甘蔗和玉米的生物乙醇产量，另一个分组柱状图(<em class="ms">图 4 </em>)显示出口和国内市场的生物柴油产量。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="54c6" class="my la it mu b gy mz na l nb nc">@app.callback(Output('A-ethanol-graph',  'figure'),<br/>              Output('A-biodiesel-graph','figure'),<br/>          [Input(component_id='radio1', component_property='value')]<br/>              )</span><span id="b210" class="my la it mu b gy nd na l nb nc">def build_graph(value):<br/>    if value == 'figT':<br/>       fig1 = go.Figure(data=[<br/>                 go.Bar(x=pvt2['Year'], y= pvt2['Tot_Prod'],<br/>                        marker_color = 'DarkSlateGrey')])</span><span id="3f65" class="my la it mu b gy nd na l nb nc">       fig1.update_layout(title=<br/>                        {'text': "Argentine Bioethanol Production",                               <br/>                                'font': {'size': 15}},<br/>                   title_x = 0.5,<br/>                   xaxis_title = 'Year', <br/>                   yaxis_title = ' Production (m3)',<br/>                   width =  700, height = 350)</span><span id="db98" class="my la it mu b gy nd na l nb nc">       fig3 = go.Figure(data=[<br/>          go.Bar(x= pvt4['Year'], y= pvt4['Tot_Prod'],<br/>                 marker_color = 'DarkSlateBlue')])</span><span id="b7ff" class="my la it mu b gy nd na l nb nc">       fig3.update_layout(title =<br/>                      {'text' : "Argentine Biodiesel Production ",  <br/>                                'font': {'size': 15}},<br/>                    title_x = 0.5,<br/>                    xaxis_title = 'Year', <br/>                    yaxis_title = 'Production (m3)',<br/>                    width =  700, height = 350)</span><span id="bcad" class="my la it mu b gy nd na l nb nc">       return fig1, fig3,</span><span id="6d57" class="my la it mu b gy nd na l nb nc">else:<br/>       fig2 = go.Figure(data=[<br/>                go.Bar(name='Cane',<br/>                       x=pvt2['Year'],y = pvt2['Cane_Prod'],<br/>                       marker_color = 'goldenrod'),<br/>                go.Bar(name='Corn',<br/>                       x=pvt2['Year'], y= pvt2['Corn_Prod'],  <br/>                       marker_color = 'lightslategray')])</span><span id="2451" class="my la it mu b gy nd na l nb nc">       fig2.update_layout(barmode='group')</span><span id="5705" class="my la it mu b gy nd na l nb nc">       fig2.update_layout(title = <br/>                    {'text' : "Argentine Bioethanol Production ",   <br/>                              'font': {'size': 15}},<br/>                          title_x = 0.5,<br/>                          xaxis_title = 'Year',<br/>                          yaxis_title = 'Production (m3)',  <br/>                          legend=dict(orientation="h"),<br/>                          width = 700, height = 350)</span><span id="2186" class="my la it mu b gy nd na l nb nc">## Fourth Figure: Biodiesel Production for Export or Internal Market</span><span id="c48a" class="my la it mu b gy nd na l nb nc">       fig4 = go.Figure(data=[<br/>                 go.Bar(name='Market', <br/>                        x=pvt4['Year'], y= pvt4['Market'],<br/>                        marker_color = 'darkblue'),<br/>                 go.Bar(name='Exports',<br/>                        x=pvt4['Year'], y= pvt4['Export'],<br/>                        marker_color = 'crimson')])</span><span id="c416" class="my la it mu b gy nd na l nb nc">       fig4.update_layout(barmode='group')</span><span id="2f37" class="my la it mu b gy nd na l nb nc">       fig4.update_layout(title = <br/>                     {'text' : "Argentine Biodiesell Production ",   <br/>                              'font': {'size': 15}},<br/>                          title_x = 0.5,<br/>                          xaxis_title = 'Year',<br/>                          yaxis_title = 'Production (m3)',  <br/>                          legend=dict(orientation="h"),<br/>                          width = 700, height = 350)</span><span id="5ba8" class="my la it mu b gy nd na l nb nc">       return fig2, fig4,   </span></pre><p id="5755" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">运行服务器需要下面两行代码:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="724e" class="my la it mu b gy mz na l nb nc">if __name__ == '__main__':<br/>     app.run_server(debug = False, port = 8080)</span></pre><p id="7389" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">你的屏幕上会出现下面一行:<em class="ms"> Dash 正在</em><a class="ae ky" href="http://127.0.0.1:8080/" rel="noopener ugc nofollow" target="_blank">http:<em class="ms">//127 . 0 . 0 . 1:8080/</em></a>。将其复制到您的浏览器中，您将看到生物燃料仪表板。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/2b9af72dee5cdda66f053d6c45e61c60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*Bqt2MpsmyDTsA7xwzkf-KQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 5:生物燃料总产量。作者用 Dash 做的仪表盘。</p></figure><p id="3861" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">点击单选按钮后，会出现“更改”屏幕:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/702aed769f07d7620b39e885543ef368.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*ar_0r5QGbA6cntezBWTs0Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图 6:转换屏幕。作者用 Dash 做的仪表盘。</p></figure><p id="1b92" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">总结一下</strong>:仪表板的概念是在一个屏幕上显示与研究目标最相关的信息。</p><p id="6a9b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在我们的仪表板上，我们在第一个屏幕上显示了阿根廷生物乙醇和生物柴油的总产量，以及这两种生物燃料的全球产量。可以看出，这两种生物燃料的本地产量都有惊人的增长，尤其是在 2016 年至 2019 年期间。我们也可以估计一下阿根廷在世界市场上的产量。</p><p id="2b5e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在转换屏幕中，我们区分了从甘蔗生产的生物乙醇和从玉米生产的生物乙醇。由于生物柴油是在阿根廷由单一原料(大豆)生产的，因此我们区分了国内市场生产和出口生产。由此可见，2012 年之前以零玉米为主的产量，是如何在短短两年内成为主要原料的。截至 2018 年，生物柴油出口和国内市场之间的趋势也发生了重大变化。</p><p id="697c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">platform Dash 允许我们轻松地创建一个交互式 web 应用程序来显示这些重要的信息。</p><p id="abec" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你对这篇文章感兴趣，请阅读<a class="ae ky" href="https://medium.com/@dar.wtz" rel="noopener">我以前的</a>(https://medium.com/@dar.wtz)</p></div></div>    
</body>
</html>