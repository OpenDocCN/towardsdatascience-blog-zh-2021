<html>
<head>
<title>Using Entity Embeddings to improve the performance of Machine Learning Models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用实体嵌入提高机器学习模型的性能</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-entity-embeddings-to-improve-the-performance-of-machine-learning-models-7bf35e9a7822?source=collection_archive---------27-----------------------#2021-05-16">https://towardsdatascience.com/using-entity-embeddings-to-improve-the-performance-of-machine-learning-models-7bf35e9a7822?source=collection_archive---------27-----------------------#2021-05-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="77f6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在ML模型中实现由神经网络学习的嵌入的教程</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c54b8ff05ecf1896e6dd0aa2dfd3a5d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xOTD7yVVk24ByH8h"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">米卡·鲍梅斯特在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="33ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文的目的是提供关于如何在ML模型中实现由神经网络学习的嵌入的信息。因此，我们不会详细讨论嵌入理论。</p><p id="e835" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:假设你了解深度学习和机器学习的基础知识</p><h1 id="8297" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">什么是实体嵌入，为什么使用实体嵌入？</strong></h1><p id="e361" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">不严格地说，实体嵌入是分类变量以连续方式的向量表示。在神经网络的上下文中，嵌入将每个实例的特征从其原始空间转换到低维向量空间表示，同时保留来自其特征的信息，并且还在嵌入空间中有意义地表示每个类别。因此，使用嵌入可以让模型了解每个变量之间的相互关系，从而提高性能。</p><h1 id="7693" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">实现</strong></h1><p id="3626" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">使用由神经网络学习的嵌入来训练ML模型的一般步骤是:</p><ol class=""><li id="ad56" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">用嵌入层训练神经网络。</li><li id="4e32" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">从训练好的神经网络中提取嵌入。</li><li id="97ba" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">用来自训练好的神经网络的分类变量的嵌入替换分类变量。</li><li id="8269" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">使用嵌入来训练你的ML模型。</li></ol><p id="485b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本教程中，我们将使用sklearn、fastai、PyTorch和著名的泰坦尼克号数据集进行演示。您可以使用自己选择的框架来复制这一点。在本教程之前，已经完成了数据清理和特征工程。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="2b30" class="ni lt iq ne b gy nj nk l nl nm">#required libraries<br/>from sklearn.metrics import classification_report<br/>import pandas as pd<br/>from sklearn.preprocessing import OneHotEncoder<br/>from sklearn import preprocessing<br/>from sklearn.ensemble import RandomForestClassifier<br/>from fastai.tabular.all import *</span></pre><p id="dc1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在使用FastAI将数据输入神经网络之前，对数据进行预处理</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="e4af" class="ni lt iq ne b gy nj nk l nl nm">dls = TabularPandas(df_train, y_names="Survived", y_block=CategoryBlock, <br/>    cat_names = ['Cabin', 'Title', 'Sex'],<br/>    cont_names = ['Age', 'Pclass', 'Fam_size'],<br/>    procs = [Categorify, FillMissing, Normalize], splits = RandomSplitter(valid_pct=0.2)(range_of(df_train)))<br/>to_nn = dls.dataloaders()</span></pre><p id="c8a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建一个TabularLearner，用lr_find()找到一个合适的学习速率。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="bc8d" class="ni lt iq ne b gy nj nk l nl nm">learn = tabular_learner(to_nn, metrics=accuracy)</span><span id="dae1" class="ni lt iq ne b gy nn nk l nl nm">learn.lr_find()</span></pre><p id="15a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">训练神经网络。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="eb3b" class="ni lt iq ne b gy nj nk l nl nm">learn.fit_one_cycle(8, 2e-2)</span></pre><p id="edd1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从训练的神经网络中提取嵌入，并用来自训练的神经网络的分类变量的嵌入来替换分类变量。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="9376" class="ni lt iq ne b gy nj nk l nl nm">#function to embed features ,obtained from fastai forums<br/>def embed_features(learner, xs):<br/>    xs = xs.copy()<br/>    for i, feature in enumerate(learner.dls.cat_names):<br/>        emb = learner.model.embeds[i]<br/>        new_feat = pd.DataFrame(emb(tensor(xs[feature], dtype=torch.int64)), index=xs.index, columns=[f'{feature}_{j}' for j in range(emb.embedding_dim)])<br/>        xs.drop(columns=feature, inplace=True)<br/>        xs = xs.join(new_feat)<br/>    return xs</span><span id="7864" class="ni lt iq ne b gy nn nk l nl nm">emb_xs = embed_features(learn, to_nn.train.xs)<br/>emb_valid_xs = embed_features(learn, to_nn.valid.xs)</span></pre><p id="29fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用嵌入来训练你的ML模型。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="ca18" class="ni lt iq ne b gy nj nk l nl nm">rf = RandomForestClassifier(n_estimators=400, min_samples_leaf=10,      <br/>                          max_features=1/2, max_samples = 50)<br/>rf = rf.fit(emb_xs,to_nn.train.y)<br/>valid_preds = rf.predict(emb_valid_xs)<br/>print(classification_report( to_nn.valid.y,valid_preds))</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/c26c3177f1ad2ea803b715dd7f9a1aa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*XTIN-mvxcBMz2jNxitQ3wg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来自作者。</p></figure><p id="69ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与在原始数据集上训练的随机森林相比，在嵌入数据上训练的随机森林上，我们获得了3%的准确性提高，这是一个相当大的提高！</p><h1 id="eccf" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">结论</strong></h1><p id="18aa" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">使用实体嵌入不仅可以帮助我们更好地理解和可视化我们的数据，而且还可以提高ML模型的性能。嵌入是处理分类变量的有用工具，也是对传统编码方法(如一键编码)的升级。</p></div></div>    
</body>
</html>