<html>
<head>
<title>Introduction to Pyspark ML Lib: Build your first linear regression model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pyspark ML Lib简介:构建您的第一个线性回归模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introduction-to-pyspark-ml-lib-build-your-first-linear-regression-model-68631cdcf08a?source=collection_archive---------45-----------------------#2021-07-26">https://towardsdatascience.com/introduction-to-pyspark-ml-lib-build-your-first-linear-regression-model-68631cdcf08a?source=collection_archive---------45-----------------------#2021-07-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="112b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">按比例创建您的第一个ML模型</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c753bbee3b813343b0aafd9508f86da1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uN3G3dR-_2Brm4OzxfF8Uw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="ky">照片由</em> <a class="ae kz" href="https://unsplash.com/@genessapana?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> <em class="ky">吉纳萨</em> </a> <em class="ky">上</em> <a class="ae kz" href="https://unsplash.com/s/photos/spark?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> <em class="ky">下</em> </a></p></figure><p id="97eb" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">随着公司产生越来越多样化和以用户为中心的数字商品和解决方案，应用于构建个性化、建议和未来分析的机器学习变得越来越重要。Apache Spark机器学习库(MLlib)使数据工程师能够专注于特定的数据挑战和算法，而不是处理不同数据集的复杂性。</p><p id="64cb" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">对一个相关因素和一个或多个随机因素之间的关系进行建模的线性技术称为线性回归。它是最基本和最广泛使用的预测建模之一。</p><h1 id="9c0b" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">什么是Spark MLlib？</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/af59f45c99bc3f0238e8c9d21f186839.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aDu0Gbh8oJDzaMYW"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="ky">照片由</em> <a class="ae kz" href="https://unsplash.com/@marius?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> <em class="ky">马里乌斯·马萨拉尔</em> </a> <em class="ky">上</em> <a class="ae kz" href="https://unsplash.com/s/photos/machine-learning?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> <em class="ky">下</em> </a></p></figure><p id="6594" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Spark MLlib是Spark最吸引人的功能之一，因为它具有大规模处理的能力，这正是机器学习模型所需要的。但是，有一些机器学习模型无法正确实现，这是一个缺点。</p><p id="269a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">MLlib是一个全面的机器学习包，包括分类、回归、聚类、合作过滤和基本的优化原语，以及其他流行的学习方法和工具。</p><h1 id="d4ec" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">什么是线性回归模型？</h1><p id="4ec0" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">通过将一条线与给定的信息相匹配，回归方法说明了变量之间的联系。在这个系统中使用直线，而在非线性系统中使用曲线路径。</p><p id="be9b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">还可以开始使用回归来预测依赖于自变量特征的因变量的特征。使用简单的线性回归估计两个定性参数之间的联系。</p><h1 id="90d0" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">为什么对ml使用spark Mllib</h1><p id="4d7d" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">由于速度快，Spark对于数据科学家来说是一个强大的集中式平台。这也是一个简单易用的工具，可以帮助他们快速获得想要的结果。这使得数据科学家能够在更大的规模上修复深度学习的复杂性以及模式计算、广播和交互式请求处理。</p><p id="022a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">r、Python和Java只是Spark中可用的几种语言。2015年<a class="ae kz" href="https://databricks.com/blog/2015/09/24/spark-survey-results-2015-are-now-available.html" rel="noopener ugc nofollow" target="_blank"> Spark研究</a>，采访了Spark社区，揭示了Python和R的主要快速增长。特别是，58%的参与者说他们使用Python，18%的参与者说他们目前正在使用R API。</p><h1 id="8ca5" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">对更全面的教程感兴趣:</h1><p id="f082" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">看看这段youtube视频:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Pyspark ML Lib简介:通过<a class="ae kz" href="https://www.youtube.com/channel/UCO8XsgcjqArk_mAd1VGBMfg?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank"> Anuj Syal </a>构建您的第一个线性回归模型</p></figure><h1 id="ffb9" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">使用Spark Mllib创建您的第一个线性回归模型</h1><ul class=""><li id="f9fc" class="mw mx it lc b ld mp lg mq lj my ln mz lr na lv nb nc nd ne bi translated">第一步:Pyspark环境设置对于本地机器上的pyspark环境，我的首选是使用docker运行<code class="fe nf ng nh ni b">jupyter/pyspark-notebook image</code>。然而，如果你对广泛的安装指南感兴趣，看看我的<a class="ae kz" href="https://anujsyal.com/pyspark-installation-guide" rel="noopener ugc nofollow" target="_blank">博客文章</a>或<a class="ae kz" href="https://www.youtube.com/watch?v=Ql_jfk3UnHE" rel="noopener ugc nofollow" target="_blank"> youtube视频</a></li><li id="9669" class="mw mx it lc b ld nj lg nk lj nl ln nm lr nn lv nb nc nd ne bi translated">步骤2:创建spark会话</li></ul><pre class="kj kk kl km gt no ni np nq aw nr bi"><span id="1fc1" class="ns lx it ni b gy nt nu l nv nw">from pyspark.sql import SparkSession </span><span id="de7e" class="ns lx it ni b gy nx nu l nv nw">spark = SparkSession.builder.master("local")<br/>.appName("linear_regression_model").getOrCreate()</span></pre><p id="2a90" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">对于数据集，我使用来自Kaggle 的一个简单的<a class="ae kz" href="https://www.kaggle.com/quantbruce/real-estate-price-prediction" rel="noopener ugc nofollow" target="_blank">房地产数据集，它包含具有连续特征的房地产的简单数据，如<code class="fe nf ng nh ni b">distance from mrt station</code>、<code class="fe nf ng nh ni b">coordinates</code>、<code class="fe nf ng nh ni b">size</code>等</a></p><p id="3e40" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">下载后，将数据集读入spark数据框</p><pre class="kj kk kl km gt no ni np nq aw nr bi"><span id="2ddb" class="ns lx it ni b gy nt nu l nv nw">real_estate = spark.read.option("inferSchema","true").csv("real_estate.csv",header=True)</span></pre><p id="4350" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们可以使用spark中的一些内置函数来探索数据的不同属性/列。</p><p id="ebaa" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">PrintSchema()查看具有数据类型的列</p><pre class="kj kk kl km gt no ni np nq aw nr bi"><span id="15cb" class="ns lx it ni b gy nt nu l nv nw">real_estate.printSchema()<br/>Out:<br/>root<br/> |-- No: integer (nullable = true)<br/> |-- X1 transaction date: double (nullable = true)<br/> |-- X2 house age: double (nullable = true)<br/> |-- X3 distance to the nearest MRT station: double (nullable = true)<br/> |-- X4 number of convenience stores: integer (nullable = true)<br/> |-- X5 latitude: double (nullable = true)<br/> |-- X6 longitude: double (nullable = true)<br/> |-- Y house price of unit area: double (nullable = true)</span></pre><p id="7a4a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Show()检查几行并理解数据</p><pre class="kj kk kl km gt no ni np nq aw nr bi"><span id="9a60" class="ns lx it ni b gy nt nu l nv nw">real_estate.show(2)<br/>Out:<br/>+---+-------------------+------------+--------------------------------------+-------------------------------+-----------+------------+--------------------------+<br/>| No|X1 transaction date|X2 house age|X3 distance to the nearest MRT station|X4 number of convenience stores|X5 latitude|X6 longitude|Y house price of unit area|<br/>+---+-------------------+------------+--------------------------------------+-------------------------------+-----------+------------+--------------------------+<br/>|  1|           2012.917|        32.0|                              84.87882|                             10|   24.98298|   121.54024|                      37.9|<br/>|  2|           2012.917|        19.5|                              306.5947|                              9|   24.98034|   121.53951|                      42.2|<br/>+---+-------------------+------------+--------------------------------------+-------------------------------+-----------+------------+--------------------------+<br/>only showing top 2 rows</span></pre><p id="27b2" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">describe()查看列的统计信息</p><pre class="kj kk kl km gt no ni np nq aw nr bi"><span id="6b47" class="ns lx it ni b gy nt nu l nv nw">real_estate.describe().show()<br/>Out:<br/>+-------+-----------------+-------------------+------------------+--------------------------------------+-------------------------------+--------------------+--------------------+--------------------------+<br/>|summary|               No|X1 transaction date|      X2 house age|X3 distance to the nearest MRT station|X4 number of convenience stores|         X5 latitude|        X6 longitude|Y house price of unit area|<br/>+-------+-----------------+-------------------+------------------+--------------------------------------+-------------------------------+--------------------+--------------------+--------------------------+<br/>|  count|              414|                414|               414|                                   414|                            414|                 414|                 414|                       414|<br/>|   mean|            207.5| 2013.1489710144933| 17.71256038647343|                    1083.8856889130436|              4.094202898550725|  24.969030072463745|  121.53336108695667|         37.98019323671498|<br/>| stddev|119.6557562342907| 0.2819672402629999|11.392484533242524|                     1262.109595407851|             2.9455618056636177|0.012410196590450208|0.015347183004592374|        13.606487697735316|<br/>|    min|                1|           2012.667|               0.0|                              23.38284|                              0|            24.93207|           121.47353|                       7.6|<br/>|    max|              414|           2013.583|              43.8|                              6488.021|                             10|            25.01459|           121.56627|                     117.5|<br/>+-------+-----------------+-------------------+------------------+--------------------------------------+-------------------------------+--------------------+--------------------+--------------------------+</span></pre><p id="13d9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Kaggle还提供了这些属性的详细信息，如计数、平均值、标准差。这将允许您决定将哪些参数用作模型的特征</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/799553ed6e9b340b94b9fb8bb8096961.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fNL6lS4B6mCm_qpk"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者数据属性的屏幕截图</p></figure><ul class=""><li id="adf5" class="mw mx it lc b ld le lg lh lj nz ln oa lr ob lv nb nc nd ne bi translated">步骤4: VectorAssembler将数据转换为特征列</li></ul><p id="a9fc" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">决定使用VectorAssembler格式化数据框的列后</p><pre class="kj kk kl km gt no ni np nq aw nr bi"><span id="5541" class="ns lx it ni b gy nt nu l nv nw">from pyspark.ml.feature import VectorAssembler</span><span id="2665" class="ns lx it ni b gy nx nu l nv nw">assembler = VectorAssembler(inputCols=[ <br/> 'X1 transaction date',<br/> 'X2 house age',<br/> 'X3 distance to the nearest MRT station',<br/> 'X4 number of convenience stores',<br/> 'X5 latitude',<br/> 'X6 longitude'],<br/> outputCol='features')</span><span id="d162" class="ns lx it ni b gy nx nu l nv nw">data_set = assembler.transform(real_estate)<br/>data_set.select(['features','Y house price of unit area']).show(2)</span><span id="84bb" class="ns lx it ni b gy nx nu l nv nw">Out:<br/>+--------------------+--------------------------+<br/>|            features|Y house price of unit area|<br/>+--------------------+--------------------------+<br/>|[2012.917,32.0,84...|                      37.9|<br/>|[2012.917,19.5,30...|                      42.2|<br/>+--------------------+--------------------------+<br/>only showing top 2 rows</span></pre><ul class=""><li id="f74d" class="mw mx it lc b ld le lg lh lj nz ln oa lr ob lv nb nc nd ne bi translated">步骤5:分成训练集和测试集</li></ul><pre class="kj kk kl km gt no ni np nq aw nr bi"><span id="2841" class="ns lx it ni b gy nt nu l nv nw">train_data,test_data = final_data.randomSplit([0.7,0.3])</span></pre><ul class=""><li id="67d4" class="mw mx it lc b ld le lg lh lj nz ln oa lr ob lv nb nc nd ne bi translated">步骤6:训练你的模型(用训练数据拟合你的模型)</li></ul><pre class="kj kk kl km gt no ni np nq aw nr bi"><span id="cdab" class="ns lx it ni b gy nt nu l nv nw">from pyspark.ml.regression import LinearRegression</span><span id="28cb" class="ns lx it ni b gy nx nu l nv nw">lr = LinearRegression(labelCol='Y house price of unit area')<br/>lrModel = lr.fit(train_data)</span></pre><ul class=""><li id="7f22" class="mw mx it lc b ld le lg lh lj nz ln oa lr ob lv nb nc nd ne bi translated">第六步:用相关性进行描述性分析</li></ul><p id="4dee" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">用测试集验证后检查系数:</p><pre class="kj kk kl km gt no ni np nq aw nr bi"><span id="16c3" class="ns lx it ni b gy nt nu l nv nw">test_stats = lrModel.evaluate(test_data)<br/>print(f"RMSE: {test_stats.rootMeanSquaredError}")<br/>print(f"R2: {test_stats.r2}")<br/>print(f"R2: {test_stats.meanSquaredError}")<br/><br/>Out:<br/>RMSE: 7.553238336636628<br/>R2: 0.6493363975473592<br/>R2: 57.051409370037256</span></pre><p id="3319" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">测试数据的均方根误差(RMSE )= 7 . 54860 . 68686868661</p><h1 id="cfea" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">结论</h1><p id="0280" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">Spark不仅是理解我们信息的更好方法；也快了很多。Spark使我们能够以首选语言处理各种各样的数据挑战，从而改变了数据分析和研究。Spark MLlib使新数据科学家能够轻松地使用他们的模型，专家可以根据需要进行微调。</p><p id="d1fd" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">分布式网络可能是数据工程师的主题，而机器学习方法和算法可能是数据科学家的主题。Spark通过允许数据科学家专注于对他们至关重要的数据挑战，同时公开利用Spark单一系统的性能、便利性和集成性，极大地改进和革新了机器学习。</p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><p id="72c8" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><em class="oj">最初发表于</em><a class="ae kz" href="https://anujsyal.com/introduction-to-pyspark-ml-lib-build-your-first-linear-regression-model" rel="noopener ugc nofollow" target="_blank"><em class="oj">【https://anujsyal.com】</em></a><em class="oj">。</em></p></div></div>    
</body>
</html>