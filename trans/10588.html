<html>
<head>
<title>Write Ultra-Concise Code with Python collections</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python集合编写超简洁的代码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/write-ultra-concise-code-with-python-collections-ab79f03bb54?source=collection_archive---------7-----------------------#2021-10-10">https://towardsdatascience.com/write-ultra-concise-code-with-python-collections-ab79f03bb54?source=collection_archive---------7-----------------------#2021-10-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/b5605460a58ea7e9e44d03a5c00d5bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*umnC3la6RCgzP3kmHK429Q.png"/></div></div></figure><p id="bb55" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">内置的Python <code class="fe kz la lb lc b">collections</code>库是有用工具的宝库。我将把重点放在我认为最有用的两个结构上:<code class="fe kz la lb lc b">Counter</code>和<code class="fe kz la lb lc b">defaultdict</code>。理解这些数据结构将有助于你使你的代码更加简洁、易读和易于调试。</p><h2 id="bbe9" class="ld le it bd lf lg lh dn li lj lk dp ll km lm ln lo kq lp lq lr ku ls lt lu lv bi translated">计数器</h2><p id="061e" class="pw-post-body-paragraph kb kc it kd b ke lw kg kh ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky im bi translated"><code class="fe kz la lb lc b">Counter</code>对象接受一个iterable并将项目聚合成iterable中唯一值的计数。结果存储在一个类似字典的结构中，其中唯一项是键，计数是值。例如，以下代码获取单词列表并返回每个单词的计数:</p><pre class="mb mc md me gt mf lc mg mh aw mi bi"><span id="2df2" class="ld le it lc b gy mj mk l ml mm">from collections import Counter</span><span id="494d" class="ld le it lc b gy mn mk l ml mm">text = "apple banana orange apple apple orange"<br/>counts = Counter(text.split())</span><span id="bc3f" class="ld le it lc b gy mn mk l ml mm">print(counts.most_common())<br/># [('apple', 3), ('orange', 2), ('banana', 1)]</span><span id="3678" class="ld le it lc b gy mn mk l ml mm">print(counts['apple'])<br/># 3</span><span id="1fd0" class="ld le it lc b gy mn mk l ml mm">print(counts['pear'])<br/># 0</span></pre><p id="be19" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您可以像使用普通Python字典一样从<code class="fe kz la lb lc b">Counter</code>中检索值。注意，<code class="fe kz la lb lc b">Counter</code>有一个非常好的特性，如果你查询一个不存在的键(比如上面的‘pear’)，它会返回0而不是给你一个<code class="fe kz la lb lc b">KeyError</code>。</p><p id="0070" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe kz la lb lc b">Counter</code>对象的另一个非常有用的特性是它们可以用一个简单的<code class="fe kz la lb lc b">+</code>操作符合并。这使得合并来自不同位置/文件的项目计数变得轻而易举:</p><figure class="mb mc md me gt ju"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="43c1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这节省了大量时间和代码行。我在文本处理/NLP任务中经常使用<code class="fe kz la lb lc b">Counter</code>，这无疑让我的生活变得更加轻松。以下是使用<code class="fe kz la lb lc b">Counter</code>的一些最终提示和技巧:</p><ul class=""><li id="002f" class="mq mr it kd b ke kf ki kj km ms kq mt ku mu ky mv mw mx my bi translated">使用<code class="fe kz la lb lc b">dict()</code>将计数器转换成普通的Python字典。</li><li id="ddb3" class="mq mr it kd b ke mz ki na km nb kq nc ku nd ky mv mw mx my bi translated">使用不带参数的<code class="fe kz la lb lc b">most_common()</code>函数返回(item，count)元组列表，按计数降序排序。</li><li id="9178" class="mq mr it kd b ke mz ki na km nb kq nc ku nd ky mv mw mx my bi translated">使用<code class="fe kz la lb lc b">Counter</code>计算字符串中的字符数——这很有效，因为字符串在Python中是可迭代的。</li></ul><h2 id="1f92" class="ld le it bd lf lg lh dn li lj lk dp ll km lm ln lo kq lp lq lr ku ls lt lu lv bi translated">默认字典</h2><p id="6cfb" class="pw-post-body-paragraph kb kc it kd b ke lw kg kh ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky im bi translated">当你不想担心<code class="fe kz la lb lc b">KeyErrors</code>和特殊情况时，这是基本字典数据结构的一个很好的替代。您只需用您选择的默认值创建一个<code class="fe kz la lb lc b">defaultdict</code>,数据结构会自动将默认值分配给任何以前看不见的键。需要理解的重要一点是，<code class="fe kz la lb lc b">defaultdict</code>构造函数的参数应该是<code class="fe kz la lb lc b">callable</code>。这包括以下内容:</p><ul class=""><li id="b8d7" class="mq mr it kd b ke kf ki kj km ms kq mt ku mu ky mv mw mx my bi translated"><code class="fe kz la lb lc b">list</code>:默认为空列表</li><li id="592e" class="mq mr it kd b ke mz ki na km nb kq nc ku nd ky mv mw mx my bi translated"><code class="fe kz la lb lc b">int</code>:默认为0</li><li id="77ee" class="mq mr it kd b ke mz ki na km nb kq nc ku nd ky mv mw mx my bi translated"><code class="fe kz la lb lc b">lambda</code>表情:非常灵活，可以让任何东西随时调用</li><li id="e125" class="mq mr it kd b ke mz ki na km nb kq nc ku nd ky mv mw mx my bi translated"><code class="fe kz la lb lc b">set</code>:默认为空集</li></ul><p id="2851" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是一个非常有用的数据结构，因为它消除了在增加/修改一个条目的值之前检查它是否存在于字典中的需要。</p><figure class="mb mc md me gt ju"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="2dee" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们看一个实际的例子，看看什么时候我们可以使用defaultdict来编写真正优雅、简洁的代码。下面的代码使用<code class="fe kz la lb lc b">defaultdict</code>在<strong class="kd iu"> 5行代码</strong>中从头开始实现了一个二元语法语言模型<strong class="kd iu">的训练循环</strong>！关于n-gram语言模型的更多内容，你可以查看我以前写的一篇文章<a class="ae ne" rel="noopener" target="_blank" href="/generate-fake-donald-trump-tweets-using-python-8d83885fd5c6">这里</a>，在这篇文章中我没有使用<code class="fe kz la lb lc b">defaultdict</code>。注意我们通过使用<code class="fe kz la lb lc b">defaultdict</code>节省的代码量！</p><figure class="mb mc md me gt ju"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="3f4c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">诀窍是在上面的第6行嵌套使用<code class="fe kz la lb lc b">defaultdict</code>。语言模型被训练来学习单词在上下文中的概率。我们希望有一个嵌套的数据结构，其中外层键指定上下文(即在二元模型的情况下是前一个单词)，内层键指定当前单词。我们希望能够提出这样的问题:“在训练数据中，单词<em class="nf">后面跟着单词<em class="nf"> cat </em>出现了多少次？</em></p><p id="dafa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，内部的<code class="fe kz la lb lc b">defaultdict</code>实际上只是在做与<code class="fe kz la lb lc b">Counter</code>完全相同的事情，所以我们可以用下面的代码行替换上面的代码行，得到相同的结果:</p><pre class="mb mc md me gt mf lc mg mh aw mi bi"><span id="6652" class="ld le it lc b gy mj mk l ml mm">self.d = defaultdict(Counter)</span></pre><h2 id="1927" class="ld le it bd lf lg lh dn li lj lk dp ll km lm ln lo kq lp lq lr ku ls lt lu lv bi translated">结论</h2><p id="d6f1" class="pw-post-body-paragraph kb kc it kd b ke lw kg kh ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky im bi translated">谢谢你读到这里！我希望你在下一个Python项目中尝试使用<code class="fe kz la lb lc b">Counter</code>和<code class="fe kz la lb lc b">defaultdict</code>结构。如果你有其他好的用例，请在评论中告诉我！如果您对此感兴趣，请查看我的其他Python相关文章:</p><div class="ng nh gp gr ni nj"><a rel="noopener follow" target="_blank" href="/python-sets-are-underrated-55fc27db2ada"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">Python集被低估了</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">内置Python集的优雅而有用的用法指南</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">towardsdatascience.com</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx jz nj"/></div></div></a></div><div class="ng nh gp gr ni nj"><a rel="noopener follow" target="_blank" href="/7-essential-python-skills-for-research-496e1888e7c2"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">用于研究的7个基本Python技能</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">来自博士生的提示和技巧</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">towardsdatascience.com</p></div></div><div class="ns l"><div class="ny l nu nv nw ns nx jz nj"/></div></div></a></div></div></div>    
</body>
</html>