<html>
<head>
<title>Spatial Transformer Networks Tutorial, Part 2 — Bilinear Interpolation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">空间变压器网络教程，第2部分—双线性插值</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/spatial-transformer-networks-tutorial-part-2-bilinear-interpolation-371e1d5f164f?source=collection_archive---------12-----------------------#2021-09-13">https://towardsdatascience.com/spatial-transformer-networks-tutorial-part-2-bilinear-interpolation-371e1d5f164f?source=collection_archive---------12-----------------------#2021-09-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="945f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">独立的介绍</h2></div><p id="ce45" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">空间转换器</em>模块是一种流行的方式，用于增加模型的空间不变性，以抵抗空间转换，如平移、缩放、旋转、裁剪以及非刚性变形。它们可以被插入到现有的卷积架构中:要么紧跟在输入之后，要么在更深的层中。它们通过自适应地将其输入变换为规范的、预期的姿态来实现空间不变性，从而导致更好的分类性能。单词adaptive表示根据输入本身的条件，为每个样本产生适当的变换。可以使用标准的反向传播来端到端地训练空间转换器网络。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/84ef8ee3b9f6444cb3d7ff6984ca25c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ww0NpsBXpdcfOys4_NRLdA.gif"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">空间转换器模块将输入转换为标准姿态，从而简化后续图层中的识别(图片由作者提供)</p></figure><p id="4dd1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本教程中，我们将涵盖深入理解空间转换器所需的所有先决条件。在<a class="ae ls" rel="noopener" target="_blank" href="/spatial-transformer-tutorial-part-1-forward-and-reverse-mapping-8d3f66375bf5">的上一篇文章</a>中，我们已经介绍了正向映射和反向映射的概念。在这篇文章中，我们将深入探讨双线性插值的细节。<a class="ae ls" rel="noopener" target="_blank" href="/spatial-transformer-networks-b743c0d112be">在下一篇文章</a>中，我们将介绍构成空间转换器模块的所有构件。最后，<a class="ae ls" rel="noopener" target="_blank" href="/spatial-transformer-networks-backpropagation-15023fe41c88">在第四篇也是最后一篇</a>中，我们将从头推导所有的反向传播方程。</p><h1 id="a030" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">线性内插法</h1><p id="2e44" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">作为热身，我们将从简单的一维情况开始。这里我们处理的是位于等距网格上的一系列数据点:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/47fd9b8ab64251329a5ee4ea04f9491f.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/format:webp/1*NeEQuf97x5LB1O8GLqvN9g.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">数据点序列(图片由作者提供)</p></figure><p id="727c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于在本教程中，我们将主要处理图像数据，我们可以安全地假设两个连续数据点之间的空间是一个而不失一般性。</p><p id="c92d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，上图中的离散序列仅针对整数位置定义，其他位置未定义。然而，我们经常需要非整数位置的值，比如上面例子中的2.7。这是通过插值技术实现的，插值技术从已知数据值中估计未知数据值。在下文中，我们将未定义的点称为样本点，我们希望使用插值技术来估计这些点，并用字母𝑥.来表示它们</p><p id="2e73" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在线性插值中，我们只是简单地将一条直线拟合到。)𝑥的两个相邻点，然后查找所需的值:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/d09e26c3590a438cc14a952f8a301331.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/format:webp/1*9Ljwv5Yox60nEZmPMNQp3Q.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">线性插值(图片由作者提供)</p></figure><p id="4942" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过地板和天花板操作找到𝑥的邻近点。请记住:floor()将𝑥舍入到低于其值的最接近的整数，而ceil()将它舍入到高于其值的最接近的整数。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/df9588e976492f6dd86a7f0aff30caa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*WUR-M4VEbVAZkNXd_x_hpA.png"/></div></figure><p id="832a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于两个相邻的点都位于网格上，我们知道它们的𝑈值(如上图箭头右侧所示)。此外，对于网格上的两个连续点，我们有:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/11c106be1ba81df2aaa450b62035611f.png" data-original-src="https://miro.medium.com/v2/resize:fit:636/format:webp/1*fUHQwpUIxMDi5ZFzHkRxFg.png"/></div></figure><p id="9f3b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们必须将以下直线拟合到两个相邻的点上:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/a34b7ca3d01f079b7da5d04dfd8a3dab.png" data-original-src="https://miro.medium.com/v2/resize:fit:486/format:webp/1*VwcT7O5NtGL6CdvnDqLm2Q.png"/></div></figure><p id="1929" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其中𝑚是斜坡，𝑏是交叉点。我们通过将左邻点插入方程来获得𝑏:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/0776ec11d1d18154b6c1ad0a39a0c731.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*qH9Nldlwc8purT-p8oLmZA.png"/></div></figure><p id="5502" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">斜率𝑚是通过将右边的邻近点插入方程中获得的:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/766c51d9bb82b13d8c14f51a941b8602.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*P5KwoTFen8Awbn14uueFRw.png"/></div></figure><p id="68d1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们的初步公式是:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/42465c21cd8301b7470c2efed840d33d.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*XTVfOshT46LHTSdwVQUd9g.png"/></div></figure><p id="14ba" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了获得更多的直觉，让我们扩展上述乘积并重新排列:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi my"><img src="../Images/965e16f5c9509fcca47f48b191df7a1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*3CdSoBcSgg-rUAvV4HNqCA.png"/></div></figure><p id="bd85" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们将从采样点𝑥到其右侧相邻点的距离表示为:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/da2beb71487c1c81cfd78fd1967019fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:264/format:webp/1*_OqNClmj3AfgeNJbOWpAvQ.png"/></div></figure><p id="d257" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以改写为:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi na"><img src="../Images/d4c42e115f4d79390d4dbd2093fb9f8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*MrH-4_eOZXZZld5lqL5uYw.png"/></div></figure><p id="e13d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们得出了最终的公式:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/b8be7bd8786c5b63f2bda4475a65f6c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*65fWn8_b6tMVqsclPFzMew.png"/></div></figure><p id="9ad5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">了解如何根据按相反距离加权的相邻点的值来解释线性插值:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/7acdcb598cc7713395345897668b2b96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*YjVZyNs1g3lPeWLCyN8igQ.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">线性插值直觉(作者图像)</p></figure><h1 id="1075" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">双线性插值</h1><p id="0564" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">接下来，我们将把我们的尝试扩展到二维情况。这里我们处理的是一组位于等间距二维网格上的数据点:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/19552def81af5c9bbe40f22b77bfcb81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*TxE-CioUYaE2Dw-1vt_0cQ.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">等距二维网格上的数据点(作者图像)</p></figure><p id="2d87" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">与一维情况一样，非整数位置的值未定义，必须使用插值技术进行估计。</p><p id="3f27" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在双线性插值中，我们将平面拟合到最接近的四个(！)采样点周围的相邻点(𝑦、𝑥)，然后查找所需值:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/b1c1c1b377d78930d6548a76a40474f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*3UZMbBv8Xya66w7O_Hx_mA.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">双线性插值(作者图像)</p></figure><p id="2ca6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">幸运的是，要得到平面方程，我们不需要像上一节那样求解复杂的线性方程组。取而代之的是，我们将对每个点重复应用线性插值(1-D)。我们从上面两点开始，在水平方向应用线性插值。接下来，我们对下面两点做同样的操作。最后，为了获得所需的值，我们对刚刚获得的中间点应用垂直方向的线性插值，参见下面的动画:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/fc7a8fbefd96be4a51117955d082a0f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/1*OilE_C3-8LlNMB_m3IH0IA.gif"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">将线性插值扩展为双线性插值(作者图像)</p></figure><p id="f51b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">𝑥-dimension:线性插值</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/630cd64f54309235117f5ce7fd00d546.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*qpvDIkizCKYPfqkrpcED-g.png"/></div></figure><p id="3040" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">𝑦-dimension:线性插值</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/3fc771c00364349e9d6fe4032d61cf68.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*r9LPNHG72BRpQG6wKOWfpQ.png"/></div></figure><p id="368e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">综合起来，我们得到:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/3871ef3d7da69acbfacf23709d3dc0e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*aIAuWmEyT1T62n6yJbGbVQ.png"/></div></figure><p id="b41a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于对称性，上述两个步骤的顺序是不相关的，即首先在垂直方向上执行线性插值，然后在水平方向上执行，得到完全相同的公式。</p><p id="0be4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">双线性插值还有一个很好的几何可视化:要获得所需点的值(蓝色)，我们必须对每个角上的值和对角相对的部分区域的乘积求和:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/02ee2bfc9db82f5888599b18b85d2a0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/1*igUDINsw52bIf1wI6P-FqQ.gif"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">双线性插值直觉(作者图像)</p></figure><p id="7790" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有另外两种重要的插值技术:最近邻插值和双三次插值。最近邻插值法只是将距离采样点最近的像素复制到输出位置。双三次插值考虑样本点的16个邻居，并拟合高阶多项式来获得估计值。</p><p id="9fdd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae ls" rel="noopener" target="_blank" href="/spatial-transformer-networks-b743c0d112be">在教程的下一部分</a>中，我们将解释使用双线性插值的空间变换网络的所有概念。这些概念可以很容易地扩展到更先进的插值技术。</p><h1 id="5b0c" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">参考</h1><p id="1aa2" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated"><a class="ae ls" href="https://arxiv.org/pdf/1506.02025.pdf" rel="noopener ugc nofollow" target="_blank">原创论文</a> <br/> <a class="ae ls" href="https://en.wikipedia.org/wiki/Linear_interpolation" rel="noopener ugc nofollow" target="_blank">线性插值</a> <br/> <a class="ae ls" href="https://en.wikipedia.org/wiki/Bilinear_interpolation" rel="noopener ugc nofollow" target="_blank">双线性插值</a></p></div></div>    
</body>
</html>