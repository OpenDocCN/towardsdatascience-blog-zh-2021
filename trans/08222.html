<html>
<head>
<title>Train Neural Network on Cloud with One Line of Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用一行代码在云上训练神经网络</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/train-neural-network-on-cloud-with-one-line-of-code-8ae2e378bc98?source=collection_archive---------19-----------------------#2021-07-28">https://towardsdatascience.com/train-neural-network-on-cloud-with-one-line-of-code-8ae2e378bc98?source=collection_archive---------19-----------------------#2021-07-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9615" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">你可能见过的最简单的无服务器模型训练工具</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f6677bdaee7b181bc7e04d577df0e621.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ck18yMgqECGQ-FmfeCX7PA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在自动气象站上训练张量流模型</p></figure><p id="c7d7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi lr translated"><span class="l ls lt lu bm lv lw lx ly lz di">大家好</span>大家好，</p><p id="f8a4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我是Aipaca公司的Yuki，是滑铁卢大学计算机工程专业的四年级学生。当我作为一名数据科学家实习时，我发现在云上设置基础设施和训练模型非常耗时。因此，我与Cody、Xin、Lounan和Sam合作开发了一个无服务器模型培训工具——<strong class="kx ir">ai bro。</strong>从上面的代码片段中可以观察到，Aibro让云模型训练像一行python代码一样简单。这篇文章将带你一步一步地使用这个工具。</p><p id="0abe" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae ma" href="https://colab.research.google.com/drive/19sXZ4kbic681zqEsrl_CZfB5cegUwuIB" rel="noopener ugc nofollow" target="_blank"> Colab演示链接</a> &amp; <a class="ae ma" href="https://aipaca.ai" rel="noopener ugc nofollow" target="_blank">我们的网站</a></p><p id="ce65" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">注:目前Aibro版本仅支持基于Tensorflow的模型训练。我们将在不久的将来添加更多像Pytorch和Sklearn这样的框架。</strong></p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="32a7" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">关于Aibro</h1><p id="3907" class="pw-post-body-paragraph kv kw iq kx b ky na jr la lb nb ju ld le nc lg lh li nd lk ll lm ne lo lp lq ij bi translated">Aibro是一个将机器学习模型连接到任何云服务器的MLOps API。它帮助数据科学家和机器学习研究人员轻松地在云平台上训练和部署模型，而无需担心基础设施的设置。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="c45f" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">工作流程</h1><h2 id="c701" class="nf mj iq bd mk ng nh dn mo ni nj dp ms le nk nl mu li nm nn mw lm no np my nq bi translated">步骤1:准备模型和数据</h2><p id="2820" class="pw-post-body-paragraph kv kw iq kx b ky na jr la lb nb ju ld le nc lg lh li nd lk ll lm ne lo lp lq ij bi translated">例如，我们使用MNIST作为训练数据，然后将其处理成适合以下CNN的形状。</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="eeb9" class="nf mj iq ns b gy nw nx l ny nz">from tensorflow.keras.datasets import mnist<br/>import tensorflow as tf</span><span id="2f5f" class="nf mj iq ns b gy oa nx l ny nz">#load data<br/>TRAINING_SIZE = 10000<br/>(train_X, train_Y), (test_X, test_Y) = mnist.load_data()</span><span id="b025" class="nf mj iq ns b gy oa nx l ny nz">validation_X = train_X[TRAINING_SIZE:(TRAINING_SIZE + 40)].reshape((40, 28, 28, 1))<br/>validation_Y = train_Y[TRAINING_SIZE:(TRAINING_SIZE + 40)]</span><span id="a036" class="nf mj iq ns b gy oa nx l ny nz">#process data<br/>train_X = train_X[:TRAINING_SIZE].reshape((TRAINING_SIZE, 28, 28, 1))<br/>train_Y = train_Y[:TRAINING_SIZE]<br/>train_Y = tf.keras.utils.to_categorical(train_Y, 10)</span><span id="fc0b" class="nf mj iq ns b gy oa nx l ny nz">validation_Y = tf.keras.utils.to_categorical(validation_Y, 10)</span></pre><p id="41a2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">CNN模型:</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="8928" class="nf mj iq ns b gy nw nx l ny nz">from tensorflow.keras import layers, models</span><span id="c67a" class="nf mj iq ns b gy oa nx l ny nz">model = models.Sequential()<br/>model.add(layers.Conv2D(32, (3, 3), activation="relu", input_shape=(28, 28, 1)))<br/>model.add(layers.MaxPooling2D((2, 2)))<br/>model.add(layers.Conv2D(64, (3, 3), activation="relu"))<br/>model.add(layers.MaxPooling2D((2, 2)))<br/>model.add(layers.Conv2D(64, (3, 3), activation="relu"))<br/>model.add(layers.Flatten())<br/>model.add(layers.Dense(64, activation="relu"))<br/>model.add(layers.Dense(10, activation="softmax"))<br/>model.compile(<br/>    optimizer="adam",<br/>    loss=tf.keras.losses.CategoricalCrossentropy(from_logits=False),<br/>    metrics=[tf.keras.metrics.CategoricalAccuracy()],<br/>)</span></pre><p id="8490" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可以尝试在Colab演示中即插即用任何基于Tensorflow的模型和数据。请记住，如果您的模型使用`<em class="ob">度量=[" accuracy "]【T11 ]'进行编译，那么由于Tensorflow 的模型<a class="ae ma" href="https://github.com/keras-team/keras/issues/4875" rel="noopener ugc nofollow" target="_blank">保存和重新加载问题，度量可能会被错误地传输。为了避免这个问题，请在编译模型时指定您的指标，如演示中所示。</a></em></p><h2 id="59c6" class="nf mj iq bd mk ng nh dn mo ni nj dp ms le nk nl mu li nm nn mw lm no np my nq bi translated">步骤2:安装Aibro库</h2><p id="1783" class="pw-post-body-paragraph kv kw iq kx b ky na jr la lb nb ju ld le nc lg lh li nd lk ll lm ne lo lp lq ij bi translated">公共Aibro的版本是1.1.0。您可以使用以下命令安装它。在调用它的方法时，我们可能需要您的电子邮件地址，这有助于我们回溯作业日志并改进未来的开发。</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="aa7a" class="nf mj iq ns b gy nw nx l ny nz">!pip install aibro<br/>https://test.pypi.org/simple</span></pre><h2 id="aa56" class="nf mj iq bd mk ng nh dn mo ni nj dp ms le nk nl mu li nm nn mw lm no np my nq bi translated">第三步:选择一个云机器</h2><p id="0810" class="pw-post-body-paragraph kv kw iq kx b ky na jr la lb nb ju ld le nc lg lh li nd lk ll lm ne lo lp lq ij bi translated">在启动训练机之前，你需要选择一个云机来训练模型。目前，Aibro仅支持AWS上的<a class="ae ma" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-spot-instances.html" rel="noopener ugc nofollow" target="_blank"> spot实例</a>，因为它们比按需深度学习实例(如Sagemaker)便宜4倍。</p><p id="3787" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">顺便说一下，不要担心spot实例的中断问题，Aibro有一个专门的系统来自动重新连接中断的培训工作。</p><p id="f177" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，让我们回到演示。通过调用available_machines()，可以查看每台机器的租赁限额及其<strong class="kx ir">可用性</strong>。可用性被定义为成功启动指定的spot实例类型的概率(因为spot实例请求不能保证被AWS满足)。一般来说，更强大的实例不太可能可用。</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="1932" class="nf mj iq ns b gy nw nx l ny nz">from aibro.train import available_machines</span><span id="ff40" class="nf mj iq ns b gy oa nx l ny nz">available_machines()</span></pre><p id="d1ce" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">样本输出:</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="3a5e" class="nf mj iq ns b gy nw nx l ny nz">Available Resources: <br/>Machine Id: g4dn.4xlarge   GPU Type: 1xT4     num_vCPU: 16    cost: $0.36/hr  limit: 4   availability: 96.0% <br/>Machine Id: g4dn.8xlarge   GPU Type: 1xT4     num_vCPU: 32    cost: $0.67/hr  limit: 2   availability: 84.0% <br/>Machine Id: p2.8xlarge     GPU Type: 8xK80    num_vCPU: 32    cost: $2.16/hr  limit: 2   availability: 49.0% <br/>Machine Id: p2.xlarge      GPU Type: 1xK80    num_vCPU: 4     cost: $0.27/hr  limit: 23  availability: 61.0% <br/>Machine Id: p3.2xlarge     GPU Type: 1xV100   num_vCPU: 8     cost: $0.92/hr  limit: 11  availability: 24.0% <br/>Machine Id: p3.8xlarge     GPU Type: 4xV100   num_vCPU: 32    cost: $3.67/hr  limit: 2   availability: 12.0%</span></pre><p id="2a01" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">好消息</strong>:由于我们想在更多的边缘情况下测试该工具，您产生的任何机器租赁费用将由我们支付。但是，请不要循环使用它！学生的口袋很脆弱😳。</p><h2 id="b7ce" class="nf mj iq bd mk ng nh dn mo ni nj dp ms le nk nl mu li nm nn mw lm no np my nq bi translated">步骤4:启动培训工作</h2><p id="fd82" class="pw-post-body-paragraph kv kw iq kx b ky na jr la lb nb ju ld le nc lg lh li nd lk ll lm ne lo lp lq ij bi translated">最上面的代码片段显示了培训作业是如何启动的。在设计方法时，我们试图保持通常适合张量流模型的相同风格。在extra中，你只需要通过<em class="ob"> model </em>，cloud <em class="ob"> machine_id </em>来填充函数args并添加一个<em class="ob">描述</em>来帮助你识别工作。</p><pre class="kg kh ki kj gt nr ns nt nu aw nv bi"><span id="da9d" class="nf mj iq ns b gy nw nx l ny nz">from aibro import Training</span><span id="e0e8" class="nf mj iq ns b gy oa nx l ny nz">job_id, trained_model, history = Training.online_fit(<br/>    model=model,<br/>    train_X=train_X,<br/>    train_Y=train_Y,<br/>    validation_data=(validation_X, validation_Y),<br/>    machine_id=machine_id,<br/>    description='Demo Run 0.0.41',<br/>    epochs=10<br/>)</span></pre><p id="6e02" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">培训工作开始后有7个有序阶段:</p><ol class=""><li id="9149" class="oc od iq kx b ky kz lb lc le oe li of lm og lq oh oi oj ok bi translated"><strong class="kx ir">【启动】:</strong>向云平台发送打开实例的请求</li><li id="4de1" class="oc od iq kx b ky ol lb om le on li oo lm op lq oh oi oj ok bi translated"><strong class="kx ir">【发送】:</strong>向实例发送模型和数据</li><li id="8621" class="oc od iq kx b ky ol lb om le on li oo lm op lq oh oi oj ok bi translated"><strong class="kx ir">【镜像】:</strong>将你本地的深度学习环境克隆到云端</li><li id="e722" class="oc od iq kx b ky ol lb om le on li oo lm op lq oh oi oj ok bi translated"><strong class="kx ir">【训练】:</strong>模型开始训练</li><li id="8321" class="oc od iq kx b ky ol lb om le on li oo lm op lq oh oi oj ok bi translated">【<strong class="kx ir">总结】:</strong>返回培训工作的简要总结</li><li id="489b" class="oc od iq kx b ky ol lb om le on li oo lm op lq oh oi oj ok bi translated"><strong class="kx ir">【接收】:</strong>将训练好的模型和其他结果返回给用户</li><li id="d4c7" class="oc od iq kx b ky ol lb om le on li oo lm op lq oh oi oj ok bi translated">[ <strong class="kx ir">关闭]: </strong>销毁用户培训数据，终止实例</li></ol><p id="e304" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<strong class="kx ir">【训练】</strong>阶段，会显示一个tensorboard地址供你实时跟踪进度。</p><p id="5e7f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">培训作业完成后，将返回<em class="ob"> job_id </em>、<em class="ob"> trained_model </em>和<em class="ob"> history </em>对象。</p><p id="3be6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您还可以通过<em class="ob"> list_trial() </em>查看您的历史作业，并通过使用<em class="ob">get _ Tensorboard _ logs(job _ id)下载tensor board日志来检查相应的详细信息。</em></p><h1 id="f66d" class="mi mj iq bd mk ml oq mn mo mp or mr ms jw os jx mu jz ot ka mw kc ou kd my mz bi translated">设计原则——通过打开和关闭来实现节能</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/98fe26dfd0d20a804b61e1866e1d1e86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c_nBKd9RFFGIFaAv"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由来自Pexels的Luis Quintero提供</p></figure><p id="ceb2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">云机器就像一个水龙头，当“水”运行时，你按秒计费，这是一种能源和金钱的浪费。Aibro的设计不仅可以帮助数据科学家在云上训练模型，还可以最大限度地减少浪费。所以，每推出一个新的培训工作，Aibro都会打开一个新的云服务器。一旦作业完成或取消，服务器将自动终止。代价是您可能需要2-3分钟的耐心来等待实例启动。</p><p id="3f94" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">注意:我们正在添加多个功能以缩短发布时间；例如，在下一个版本中，我们将允许服务器在作业完成后保留一段时间，以便快速调试和修改模型。这样，如果在等待期间提交了新作业，该作业将直接跳过[启动]阶段。</strong></p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="cef7" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">什么即将到来</h1><p id="d80e" class="pw-post-body-paragraph kv kw iq kx b ky na jr la lb nb ju ld le nc lg lh li nd lk ll lm ne lo lp lq ij bi translated">演示之后，我们正在为Aibro开发一个alpha版本，将于10月初推出。在下一版本中，您将看到以下更新:</p><ul class=""><li id="cfea" class="oc od iq kx b ky kz lb lc le oe li of lm og lq ow oi oj ok bi translated">用户注册:开放给用户注册和管理账户。</li><li id="cb87" class="oc od iq kx b ky ol lb om le on li oo lm op lq ow oi oj ok bi translated">文档:解释更多关于库的细节。</li><li id="6743" class="oc od iq kx b ky ol lb om le on li oo lm op lq ow oi oj ok bi translated">保持期:在培训作业开始之前预打开服务器(预热期)，在培训作业之后保持保持服务器(冷却期)。</li><li id="81c0" class="oc od iq kx b ky ol lb om le on li oo lm op lq ow oi oj ok bi translated">离线fit:启动一个培训任务，稍后通过job_id获取。</li><li id="b89c" class="oc od iq kx b ky ol lb om le on li oo lm op lq ow oi oj ok bi translated">重新培训:从检查点恢复暂停的培训作业。</li><li id="cbfb" class="oc od iq kx b ky ol lb om le on li oo lm op lq ow oi oj ok bi translated">大数据:支持大数据传输和训练。</li></ul></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="6f08" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">联系我们</h1><p id="43dd" class="pw-post-body-paragraph kv kw iq kx b ky na jr la lb nb ju ld le nc lg lh li nd lk ll lm ne lo lp lq ij bi translated">如果你发现Aibro是有用的，请加入我们来自<a class="ae ma" href="https://aipaca.ai" rel="noopener ugc nofollow" target="_blank"> aipaca.ai </a>的等候名单。我们将分享Aibro的最新更新。同时，我们欢迎您的任何反馈。您可以通过从<a class="ae ma" href="https://aipaca.ai" rel="noopener ugc nofollow" target="_blank"> aipaca.ai </a>加入AIpaca社区、发送电子邮件至<a class="ae ma" href="http://hello@aipaca.ai" rel="noopener ugc nofollow" target="_blank"> hello@aipaca.ai </a>或使用<em class="ob">ai bro . comm . send _ message()</em>向我们发送直接消息来联系我们！</p></div></div>    
</body>
</html>