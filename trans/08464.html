<html>
<head>
<title>The 5-minute learn: Create pretty and geographically accurate transport maps in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">5分钟学习:用R语言创建漂亮的、地理上精确的交通地图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-5-minute-learn-create-pretty-and-geographically-accurate-transport-maps-in-r-63f2cb77c227?source=collection_archive---------24-----------------------#2021-08-04">https://towardsdatascience.com/the-5-minute-learn-create-pretty-and-geographically-accurate-transport-maps-in-r-63f2cb77c227?source=collection_archive---------24-----------------------#2021-08-04</a></blockquote><div><div class="fc ij ik il im in"/><div class="io ip iq ir is"><div class=""/><div class=""><h2 id="0b0a" class="pw-subtitle-paragraph js iu iv bd b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj dk translated">学会准确绘制伦敦地铁网络</h2></div><p id="93e8" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">我正在尝试一篇名为“5分钟学习”的临时文章，我试图在5分钟或更短的阅读时间内教授一种有用的技巧。在第一次尝试中，我们将看看如何创建一个地理上准确的伦敦地铁网络图(不像我们经常看到的那样)。如果你有正确的数据，你应该能够很容易地将这项技术应用到其他交通网络。</p><p id="a9bd" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">要做到这一点，我们需要一个数据集，我们可以用它来构建一个以站点为顶点的图。我在Github上找到了一个JSON数据集，我把它转换成顶点和边的<code class="fe lg lh li lj b">csv</code>并把它放在Github上。我添加了来自OpenStreetMap的每个车站的坐标，以及来自伦敦交通时尚指南的地铁线路和每条线路的官方颜色。让我们下载这些套件:</p><pre class="lk ll lm ln gt lo lj lp lq aw lr bi"><span id="81de" class="ls lt iv lj b gy lu lv l lw lx">londontube_vertices &lt;- <a class="ae ly" href="https://rdrr.io/r/utils/read.table.html" rel="noopener ugc nofollow" target="_blank">read.csv</a>("<a class="ae ly" href="https://raw.githubusercontent.com/keithmcnulty/ona_book/main/docs/data/londontube_edgelist.csv" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/keithmcnulty/ona_book/main/docs/data/londontube_vertices.csv</a>")</span><span id="6cb8" class="ls lt iv lj b gy lz lv l lw lx">head(londontube_vertices)</span><span id="e98d" class="ls lt iv lj b gy lz lv l lw lx">##   id         name latitude longitude<br/>## 1  1   Acton Town  51.5028   -0.2801<br/>## 2  2      Aldgate  51.5143   -0.0755<br/>## 3  3 Aldgate East  51.5154   -0.0726<br/>## 4  4   All Saints  51.5107   -0.0130<br/>## 5  5     Alperton  51.5407   -0.2997<br/>## 6  7        Angel  51.5322   -0.1058</span><span id="cba5" class="ls lt iv lj b gy lz lv l lw lx">londontube_edgelist &lt;- <a class="ae ly" href="https://rdrr.io/r/utils/read.table.html" rel="noopener ugc nofollow" target="_blank">read.csv</a>("<a class="ae ly" href="https://raw.githubusercontent.com/keithmcnulty/ona_book/main/docs/data/londontube_edgelist.csv" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/keithmcnulty/ona_book/main/docs/data/londontube_edgelist.csv</a>")</span><span id="cc8a" class="ls lt iv lj b gy lz lv l lw lx">head(londontube_edgelist)</span><span id="f73b" class="ls lt iv lj b gy lz lv l lw lx">##   from  to          line linecolor<br/>## 1   11 163 Bakerloo Line   #AE6017<br/>## 2   11 212 Bakerloo Line   #AE6017<br/>## 3   49  87 Bakerloo Line   #AE6017<br/>## 4   49 197 Bakerloo Line   #AE6017<br/>## 5   82 163 Bakerloo Line   #AE6017<br/>## 6   82 193 Bakerloo Line   #AE6017</span></pre><p id="3aae" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">现在我们将使用R中的<code class="fe lg lh li lj b">igraph</code>包从这两个数据帧中创建一个graph对象:</p><pre class="lk ll lm ln gt lo lj lp lq aw lr bi"><span id="7152" class="ls lt iv lj b gy lu lv l lw lx">library(igraph)</span><span id="07e2" class="ls lt iv lj b gy lz lv l lw lx"># create graph object<br/>(tubegraph &lt;- igraph::<a class="ae ly" href="https://rdrr.io/pkg/igraph/man/graph_from_data_frame.html" rel="noopener ugc nofollow" target="_blank">graph_from_data_frame</a>(<br/>  d = londontube_edgelist,<br/>  vertices = londontube_vertices,<br/>  directed = FALSE<br/>))</span></pre><figure class="lk ll lm ln gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ma"><img src="../Images/f547906cee6912000bddf3d4f1d80856.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oM2JCaZzdZHGhJ75S48nWg.png"/></div></div></figure><p id="45cf" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">看起来不错。我们还可以使用我们的edgelist来创建不同管线和管线颜色的参考，以便在任何可视化中使用:</p><pre class="lk ll lm ln gt lo lj lp lq aw lr bi"><span id="37b2" class="ls lt iv lj b gy lu lv l lw lx"># create a set of distinct line names and linecolors<br/>lines &lt;- londontube_edgelist |&gt; <br/>  dplyr::<a class="ae ly" href="https://dplyr.tidyverse.org/reference/distinct.html" rel="noopener ugc nofollow" target="_blank">distinct</a>(line, linecolor)</span><span id="b777" class="ls lt iv lj b gy lz lv l lw lx">head(lines)</span><span id="abeb" class="ls lt iv lj b gy lz lv l lw lx">##                      line linecolor<br/>## 1           Bakerloo Line   #AE6017<br/>## 2            Central Line   #F15B2E<br/>## 3             Circle Line   #FFE02B<br/>## 4           District Line   #00A166<br/>## 5 Docklands Light Railway   #00A77E<br/>## 6        East London Line   #FBAE34</span></pre><p id="7753" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">现在，让我们暂时忽略地理定位，让我们用<code class="fe lg lh li lj b">ggraph()</code>绘制这个网络的图，使用它的默认布局。</p><pre class="lk ll lm ln gt lo lj lp lq aw lr bi"><span id="1c84" class="ls lt iv lj b gy lu lv l lw lx">library(ggraph)</span><span id="4fb3" class="ls lt iv lj b gy lz lv l lw lx"># visualize tube graph using linecolors for edge color<br/><a class="ae ly" href="https://rdrr.io/r/base/Random.html" rel="noopener ugc nofollow" target="_blank">set.seed</a>(123)<br/><a class="ae ly" href="https://ggraph.data-imaginist.com/reference/ggraph.html" rel="noopener ugc nofollow" target="_blank">ggraph</a>(tubegraph) +<br/>  <a class="ae ly" href="https://ggraph.data-imaginist.com/reference/geom_node_point.html" rel="noopener ugc nofollow" target="_blank">geom_node_point</a>(color = "black", size = 1) +<br/>  <a class="ae ly" href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html" rel="noopener ugc nofollow" target="_blank">geom_edge_link</a>(<a class="ae ly" href="https://ggplot2.tidyverse.org/reference/aes.html" rel="noopener ugc nofollow" target="_blank">aes</a>(color = line), width = 1) +<br/>  <a class="ae ly" href="https://ggraph.data-imaginist.com/reference/scale_edge_colour.html" rel="noopener ugc nofollow" target="_blank">scale_edge_color_manual</a>(name = "Line",<br/>                          values = lines$linecolor) +<br/>  <a class="ae ly" href="https://ggplot2.tidyverse.org/reference/ggtheme.html" rel="noopener ugc nofollow" target="_blank">theme_void</a>()</span></pre><figure class="lk ll lm ln gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mi"><img src="../Images/ef21392ef2cf02938b86588816a7f245.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n7Bpmf1Uue_MfVPAbC24Iw.png"/></div></div><p class="mj mk gj gh gi ml mm bd b be z dk translated">随机布局的伦敦地铁网络(作者生成)</p></figure><p id="14bf" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">现在，我们能如此容易地制作这个很好，但是对于任何了解伦敦的人来说，这没有任何地理意义。因此，我们需要改变布局和比例，以便我们可以根据地理坐标绘制顶点。</p><p id="3ad2" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">要做到这一点，我们需要通过连接到顶点数据帧来转换我们的边列表，使其具有“从”和“到”地理坐标:</p><pre class="lk ll lm ln gt lo lj lp lq aw lr bi"><span id="0d61" class="ls lt iv lj b gy lu lv l lw lx"># reorganize the edgelist <br/>new_edgelist &lt;- londontube_edgelist |&gt; <br/>  dplyr::<a class="ae ly" href="https://dplyr.tidyverse.org/reference/mutate-joins.html" rel="noopener ugc nofollow" target="_blank">inner_join</a>(londontube_vertices |&gt; <br/>                      dplyr::<a class="ae ly" href="https://dplyr.tidyverse.org/reference/select.html" rel="noopener ugc nofollow" target="_blank">select</a>(id, latitude, longitude), <br/>                    by = <a class="ae ly" href="https://rdrr.io/r/base/c.html" rel="noopener ugc nofollow" target="_blank">c</a>("from" = "id")) |&gt; <br/>  dplyr::<a class="ae ly" href="https://dplyr.tidyverse.org/reference/rename.html" rel="noopener ugc nofollow" target="_blank">rename</a>(lat_from = latitude, lon_from = longitude) |&gt; <br/>  dplyr::<a class="ae ly" href="https://dplyr.tidyverse.org/reference/mutate-joins.html" rel="noopener ugc nofollow" target="_blank">inner_join</a>(londontube_vertices |&gt; <br/>                      dplyr::<a class="ae ly" href="https://dplyr.tidyverse.org/reference/select.html" rel="noopener ugc nofollow" target="_blank">select</a>(id, latitude, longitude), <br/>                    by = <a class="ae ly" href="https://rdrr.io/r/base/c.html" rel="noopener ugc nofollow" target="_blank">c</a>("to" = "id")) |&gt; <br/>  dplyr::<a class="ae ly" href="https://dplyr.tidyverse.org/reference/rename.html" rel="noopener ugc nofollow" target="_blank">rename</a>(lat_to = latitude, lon_to = longitude)<br/><br/># view<br/><a class="ae ly" href="https://rdrr.io/r/utils/head.html" rel="noopener ugc nofollow" target="_blank">head</a>(new_edgelist)</span></pre><figure class="lk ll lm ln gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mn"><img src="../Images/b5a631dc0d261035f4750f067c5c7fc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3hGlLvB1sUOSgKVU8Hy_FA.png"/></div></div></figure><p id="9105" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">这看起来不错。现在，我们将重新创建图形对象，以确保存储新的边数据:</p><pre class="lk ll lm ln gt lo lj lp lq aw lr bi"><span id="60e7" class="ls lt iv lj b gy lu lv l lw lx"># recreate graph object to capture additional edge data<br/>tubegraph &lt;- igraph::<a class="ae ly" href="https://rdrr.io/pkg/igraph/man/graph_from_data_frame.html" rel="noopener ugc nofollow" target="_blank">graph_from_data_frame</a>(<br/>d = new_edgelist, <br/>vertices = londontube_vertices,<br/>directed = FALSE<br/>)</span></pre><p id="d822" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">现在，我们可以使用<code class="fe lg lh li lj b">ggmap</code>在我们的网络上铺设一张谷歌地图，并使用我们刚刚创建的“起点”和“终点”坐标来绘制车站。请注意，如果你从未使用过<code class="fe lg lh li lj b">ggmap</code>，你需要先用谷歌地图API设置它——参见这里的<a class="ae ly" href="https://cran.r-project.org/web/packages/ggmap/readme/README.html" rel="noopener ugc nofollow" target="_blank">获取说明。</a></p><pre class="lk ll lm ln gt lo lj lp lq aw lr bi"><span id="35d7" class="ls lt iv lj b gy lu lv l lw lx"><a class="ae ly" href="https://rdrr.io/r/base/library.html" rel="noopener ugc nofollow" target="_blank">library</a>(<a class="ae ly" href="https://github.com/dkahle/ggmap" rel="noopener ugc nofollow" target="_blank">ggmap</a>)<br/>londonmap &lt;- <a class="ae ly" href="https://rdrr.io/pkg/ggmap/man/get_map.html" rel="noopener ugc nofollow" target="_blank">get_map</a>(location = "London, UK", source = "google")</span><span id="e51a" class="ls lt iv lj b gy lz lv l lw lx"># layer a London map<br/><a class="ae ly" href="https://rdrr.io/pkg/ggmap/man/ggmap.html" rel="noopener ugc nofollow" target="_blank">ggmap</a>(londonmap, base_layer = <a class="ae ly" href="https://ggraph.data-imaginist.com/reference/ggraph.html" rel="noopener ugc nofollow" target="_blank">ggraph</a>(tubegraph)) +<br/>  <a class="ae ly" href="https://ggraph.data-imaginist.com/reference/geom_node_point.html" rel="noopener ugc nofollow" target="_blank">geom_node_point</a>(<a class="ae ly" href="https://ggplot2.tidyverse.org/reference/aes.html" rel="noopener ugc nofollow" target="_blank">aes</a>(x = longitude, y = latitude), color = "black", size = 1) +<br/>  <a class="ae ly" href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html" rel="noopener ugc nofollow" target="_blank">geom_edge_link</a>(<a class="ae ly" href="https://ggplot2.tidyverse.org/reference/aes.html" rel="noopener ugc nofollow" target="_blank">aes</a>(x = lon_from, y = lat_from,<br/>                     xend = lon_to, yend = lat_to,<br/>                     color = line), width = 1) +<br/>  <a class="ae ly" href="https://ggraph.data-imaginist.com/reference/scale_edge_colour.html" rel="noopener ugc nofollow" target="_blank">scale_edge_color_manual</a>(name = "Line",<br/>                          values = lines$linecolor)</span></pre><figure class="lk ll lm ln gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mi"><img src="../Images/05d8a0ea330f43ed2176da8b9ea7392b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*blVc_BA3gJ7fDcMkPLVfNQ.png"/></div></div><p class="mj mk gj gh gi ml mm bd b be z dk translated">地理精确的伦敦地铁地图(作者生成)</p></figure><p id="4bca" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">很可爱。如果你能得到正确的数据，我很想看看你能否为其他城市或交通网络重现这一点。</p></div><div class="ab cl mo mp hz mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="io ip iq ir is"><p id="42a8" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">最初我是一名纯粹的数学家，后来我成为了一名心理计量学家和数据科学家。我热衷于将所有这些学科的严谨性应用到复杂的人的问题上。我也是一个编码极客和日本RPG的超级粉丝。在 <a class="ae ly" href="https://www.linkedin.com/in/keith-mcnulty/" rel="noopener ugc nofollow" target="_blank"> <em class="mv"> LinkedIn </em> </a> <em class="mv">或</em><a class="ae ly" href="https://twitter.com/dr_keithmcnulty" rel="noopener ugc nofollow" target="_blank"><em class="mv">Twitter</em></a><em class="mv">上找我。也可以看看我在</em><a class="ae ly" href="http://drkeithmcnulty.com/" rel="noopener ugc nofollow" target="_blank"><em class="mv">drkeithmcnulty.com</em></a><em class="mv">上的博客或者我即将发布的</em> <a class="ae ly" href="https://www.routledge.com/Handbook-of-Regression-Modeling-in-People-Analytics-With-Examples-in-R/McNulty/p/book/9781032041742" rel="noopener ugc nofollow" target="_blank"> <em class="mv">关于人物分析的教科书</em> </a> <em class="mv">。</em></p></div></div>    
</body>
</html>