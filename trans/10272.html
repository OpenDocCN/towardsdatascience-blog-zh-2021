<html>
<head>
<title>Why you should NOT replace blanks with 0 in Power BI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么不应该在幂BI中用0替换空白</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/why-you-should-not-replace-blanks-with-0-in-power-bi-f05a89456533?source=collection_archive---------26-----------------------#2021-09-29">https://towardsdatascience.com/why-you-should-not-replace-blanks-with-0-in-power-bi-f05a89456533?source=collection_archive---------26-----------------------#2021-09-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ba73" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">有人要求您在报表中用0替换空白值吗？也许你应该三思而后行</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/eb301745b6e7d75ff1a8b71f74973192.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9h6tgzhWHaXm3VxrJnq29g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/photos/cixohzDpNIo" rel="noopener ugc nofollow" target="_blank">照片由Siora Photography在Unsplash上拍摄</a></p></figure><p id="a800" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就在最近，我作为Reid Havens 的直播嘉宾观看了<a class="ae ky" href="https://www.youtube.com/watch?v=KI2eYBI0lF0&amp;list=WL&amp;index=3" rel="noopener ugc nofollow" target="_blank"> Jeffrey Wang，Jeffrey与观众分享的十几个精彩内容之一是DAX引擎在为我们的措施创建最佳查询计划时执行的优化列表。</a></p><p id="22a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">引起我注意的一个问题是关于所谓的“稀疏措施”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/c3d7141fdc4f3096be77c36356c02df0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1RhFRaJVlLfhD2KJyDEWug.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><p id="815d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简单地说，一旦定义了度量，VertiPaq 中的<a class="ae ky" rel="noopener" target="_blank" href="/how-to-reduce-your-power-bi-model-size-by-90-76d7c4377f2d">公式引擎将向查询中添加一个隐式的非空过滤器，这将使优化器能够避免维度表的完全交叉连接，并且只扫描那些维度属性组合的记录确实存在的行。对于来自MDX世界的人来说，非空函数可能看起来很熟悉，但是让我们看看它在DAX中是如何工作的。</a></p><p id="8340" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最让我产生共鸣的事情是，当Jeffrey建议在幂BI计算中不要用零(或任何显式值)替换空白。我已经写了<a class="ae ky" rel="noopener" target="_blank" href="/handling-blank-in-power-bi-90eed948d042">如何处理空白并用零替换它们</a>，但是在这篇文章中，我想把重点放在这个决定可能的性能影响上。</p><h2 id="7b2e" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">搭建舞台</h2><p id="4335" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">在我们开始之前，一个重要的免责声明:不要用0替换空白的建议只是建议。如果业务请求是显示0而不是空白，并不一定意味着你应该拒绝去做。在大多数情况下，您可能甚至不会注意到性能下降，但这取决于多种不同的因素…</p><p id="a920" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从编写简单的DAX度量开始:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="e761" class="lw lx it mv b gy mz na l nb nc">Sales Amt 364 Products =<br/>CALCULATE (<br/>    [Sales Amt],<br/>    FILTER ( ALL ( 'Product'[ProductKey] ), 'Product'[ProductKey] = 364 )<br/>)</span></pre><p id="f443" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这个度量，我想计算ProductKey = 364的产品的总销售额。而且，如果我将这个度量的值放入Card visual中，并打开Performance Analyzer来检查处理这个查询的时间，我会得到以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/aa0f1c0e6b5373fb0cae3d699f4b9e87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*thfUiu6F2mabgTY6bXH5Aw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="93f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行DAX查询只花了11毫秒，一旦切换到DAX Studio，公式引擎生成的xmSQL非常简单:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/3659f51f76305c4c0dbb89334b3190f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*75MWkPPZ0i-1ikNB2y1AOw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="943a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">而且，如果我看一下查询计划(物理的)，我可以看到存储引擎只找到1个现有的值组合来返回我们的数据:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/5a9b9a20c41352e414530f1f74d416d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t6CjDhY0NQoOig1dADE-Sw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="faff" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">添加更多配料…</h2><p id="8a27" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">然而，假设业务请求是在日常级别上分析产品关键字364的数据。让我们为我们的报告添加日期:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/06de20ce7ea114484bbb7487f3ab1aa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*el5LAK78DmiY4lLxndWJMg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6636" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这又一次非常快！我现在将检查DAX Studio中的指标:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/03144fc14e06e95cada0ced83319ac7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fmqA_io9iWRfrNGjljwI4Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="f993" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这一次，查询扩展到包括日期表，这影响了存储引擎需要做的工作，因为这一次不是只找到一行，而是找到了不同的数字:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/e704f23c9e19ad7e59bcb1501bea9b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nMo-KIV8QVSGiiY_VKpVRA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0722" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，您不会注意到这两种场景之间的任何性能差异，因为差异只有几毫秒。</p><p id="b441" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，这仅仅是一个开始，我们只是在预热我们的DAX引擎:)…在这两种情况下，正如您可能看到的，我们只看到“填充的”值—我们的两个要求都得到满足的行的组合—产品关键字是364，并且只有我们销售该产品的那些日期—如果您仔细查看上面的插图，日期是不连续的，有些日期是缺失的，例如1月12日、1月14日到1月21日，等等。</p><p id="ea6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是因为Formula Engine足够智能，可以使用非空过滤器消除产品364没有销售的日期，这就是为什么记录数为58:我们有58个不同的日期，其中产品364的销售不为空:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/866b86b2f5cb35be08d54d259e81677f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A1__XG-8MqI_0hqvschSlg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="2778" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们假设商业用户也希望看到中间的那些日期，其中产品364没有取得任何销售。所以，我们的想法是显示所有这些日期的金额。正如在上一篇文章中已经描述的，有多种不同的方法来用零替换空格，我将使用<em class="nd"> COALESCE() </em>函数:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="752c" class="lw lx it mv b gy mz na l nb nc">Sales Amt 364 Products with 0 = COALESCE([Sales Amt 364 Products],0)</span></pre><p id="3dc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基本上，COALESCE函数要做的是检查所有提供的参数(在我的例子中只有一个参数)，并用您指定的值替换第一个空白值。简单来说，它会检查销售金额364产品的值是否为空—如果不是，它会显示计算出的值—否则，它会用0替换空。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/bfe28a6611e87e3bde9a4cf576f41474.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yDY2BDdBWoY67Yj9RS1k6g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="915e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">等等，什么？！当我过滤掉除产品364之外的所有产品时，为什么我会看到所有产品？更不用说，我的表现在花了2秒多的时间来渲染！我们来看看后台发生了什么。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/64bda8fecf80878f7ea8b58a00e912d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XqTYEY2mviIKzxIbdHOEJg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7955" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有3个查询，而不是生成一个。第一个与前一个案例完全相同(58行)。但是，其余的查询以Product和Dates表为目标，从这两个表中提取所有的行(Product表包含2517行，而Dates表包含1826行)。不仅如此，请看一下查询计划:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/5cbae155c30db5a3eff34721975eec50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dp_v48iAM3xK-jVlu4DGgQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3756" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">460万张唱片？！究竟为什么会这样？！让我给你算一下:<strong class="lb iu">2.517 * 1.826 = 4 . 596 . 042</strong>…所以，这里我们在产品和日期表之间有一个完整的交叉连接，强制检查每个元组(日期-产品的组合)！发生这种情况是因为我们强迫引擎为每个元组返回0，否则将返回空白(并因此被排除在扫描之外)！</p><p id="be49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是对所发生事情的简单概述:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/69afe2ce77f3549c0c17402028ddd0e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*liUFJ557w2n2LJWilTL4Ag.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者插图</p></figure><p id="2975" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">信不信由你，有一个优雅的解决方案可以开箱即用地显示空白值(但是，不是用0代替空白)。您只需点击日期字段，并选择<em class="nd">显示没有数据的项目</em>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/5fb38f1dabd21dc37b6c2d5101486bd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FVAj-jj-JRCGNCdxiL_i_Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="edd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这也将显示空白单元格，但不会在Product和Dates表之间执行完全交叉联接:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/f6d564a3a9f5242f877118add01edcae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RlchqFA6kcJQ9ZY1FkTeNg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6792" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以看到所有的单元格(甚至是空白的),这个查询花费了前一个查询一半的时间！让我们检查由公式引擎生成的查询计划:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/ac62997d38f0d1f681dfd2f906fa6813.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZANiSBixEn1F8TlgzK-xgw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="290e" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">并非所有场景都是灾难性的！</h2><p id="0470" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">说实话，我们可以重写我们的方法来排除一些不需要的记录，但是这仍然不是引擎消除空记录的最佳方式。</p><p id="029f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，在某些情况下，即使用零替换空白也不会导致性能显著下降。</p><p id="1ef0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看下面的情况:我们显示每个品牌的总销售额数据。我将添加产品364的销售额度量:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/9a031cae951afd5cd786a026d37abe40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VTUbzxMhTMLhvDSs6IKrXw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="ad1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你所料，这相当快。但是，当我添加用0替换空白的度量时会发生什么呢，这在前面的场景中造成了混乱:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/115ae5eef4342808f52870b057fe6d5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X5SwHGH75EE2hzEzlD7nuQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="2cde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嗯，看起来我们不用为性能付出任何代价。让我们检查一下这个DAX查询的查询计划:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/33666e0de19787e581ddbc94d4bdfb30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3EhRBeFSjO7uEaka_S3sxQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="d72f" class="lw lx it bd ly lz ma dn mb mc md dp me li mf mg mh lm mi mj mk lq ml mm mn mo bi translated">结论</h2><p id="44e0" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">正如Jeffrey Wang所建议的，您应该避免用零(或任何其他显式值)替换空格，因为这将极大地影响查询优化器消除不必要的数据扫描的能力。但是，如果出于某种原因，您需要用一些有意义的值替换空白，请注意何时以及如何进行。</p><p id="2379" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，这取决于许多不同的方面——对于基数较低的列，或者当您不显示来自多个不同表的数据时(就像在我们的示例中，当我们需要组合来自Product和Dates表的数据时),或者不需要显示大量不同值的可视化类型(即卡片可视化)——您可以在不付出性能代价的情况下获得成功。另一方面，如果您使用显示大量不同值的表格/矩阵/条形图，请确保在将该报告部署到生产环境之前检查指标和查询计划。</p><p id="d17d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p><p id="36e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://datamozart.medium.com/membership" rel="noopener">成为会员，阅读媒体上的每一个故事！</a></p></div></div>    
</body>
</html>