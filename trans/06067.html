<html>
<head>
<title>4 Tricks for Making Python Pandas More Efficient</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让Python熊猫更有效率的4个诀窍</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/4-tricks-for-making-python-pandas-more-efficient-20237a045f09?source=collection_archive---------19-----------------------#2021-05-31">https://towardsdatascience.com/4-tricks-for-making-python-pandas-more-efficient-20237a045f09?source=collection_archive---------19-----------------------#2021-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="11ac" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">充分利用熊猫</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/884c04b62714392a5622dba08d9fa1d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zbVQOwVrAccbWrxeePF7yg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Pawel Czerwinski 在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="0813" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas可以说是数据科学生态系统中最受欢迎的数据分析和操作库。用户友好和直观的Python语法是Pandas受欢迎的一个重要因素。然而，这并不是熊猫被绝大多数数据科学家改编的唯一原因。</p><p id="3a27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas提供了许多功能和方法来加速数据分析和操作。在这篇文章中，我们将学习4个技巧来更有效地使用这些函数。</p><p id="2f41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从创建数据框开始。我们将使用Kaggle上提供的墨尔本住房数据集<a class="ae ky" href="https://www.kaggle.com/anthonypino/melbourne-housing-market" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f7e9" class="ma mb it lw b gy mc md l me mf">import pandas as pd</span><span id="e8b5" class="ma mb it lw b gy mg md l me mf">df = pd.read_csv("/content/melb_housing.csv")</span><span id="0fe2" class="ma mb it lw b gy mg md l me mf">df.columns<br/>Index(['Suburb', 'Address', 'Rooms', 'Type', 'Price', 'Method', 'SellerG', 'Date', 'Postcode', 'Regionname', 'Propertycount', 'Distance', 'CouncilArea'], dtype='object')</span></pre><p id="e3f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据集包含关于墨尔本房屋的13个特征(即柱子)。</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h2 id="3072" class="ma mb it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">第一招</h2><p id="1d7e" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">第一个窍门是关于<code class="fe nk nl nm lw b">read_csv</code>函数。这可能是最常用的函数，但我们几乎总是不带任何参数地使用它。<code class="fe nk nl nm lw b">read_csv</code>函数有许多参数，使它更加方便。</p><p id="679d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas在dt访问器下提供了几个方法来操作日期。为了使用它们，日期必须具有datetime数据类型。我们总是可以转换数据类型，但是有一个更实际的方法。<code class="fe nk nl nm lw b">parse_dates</code>参数可以处理这项任务。</p><p id="7188" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一个有用的参数是<code class="fe nk nl nm lw b">usecols</code>。如果只需要处理数据集中的一些列，可以将列名传递给<code class="fe nk nl nm lw b">usecols</code>参数。它节省了内存和计算能力，尤其是在处理大型数据集时。</p><p id="e2fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用这些参数重新读取数据集。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="41f3" class="ma mb it lw b gy mc md l me mf">df = pd.read_csv(<br/>  "/content/melb_housing.csv", <br/>  parse_dates=["Date"],<br/>  usecols=["Address", "Rooms", "Date","Type", "Price",   <br/>           "Regionname"]<br/>)</span><span id="a632" class="ma mb it lw b gy mg md l me mf">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/93abf06512051eb51609bccd8ca0ed1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*dlvfBU8WAwf3FRWK6Jz3EQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h2 id="e93c" class="ma mb it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">第二招</h2><p id="6268" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">熊猫的另一个常用功能是<code class="fe nk nl nm lw b">value_counts</code>。它计算一列中不同值的出现次数。因此，我们得到了一个特征(即列)分布的概况。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="7118" class="ma mb it lw b gy mc md l me mf">df.Regionname.value_counts()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/511f24bc0a91f6bdcaa26c5bdfca3342.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/1*GMcf-_uxQuZdZWw-EX9pBg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="2e05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到每个地区的房屋数量。在某些情况下，对这些值进行规范化会提供更多的信息，以便我们对类别的分布有更好的了解。</p><p id="d63c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一种方法是将出现的次数除以值的总数。<code class="fe nk nl nm lw b">value_counts</code>功能的<code class="fe nk nl nm lw b">normalize</code>参数很容易完成这项任务。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="5910" class="ma mb it lw b gy mc md l me mf">df.Regionname.value_counts(normalize=True)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/02afc5fcd35802a1306b545d0745a9f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/1*jBIQhLFIGLBo1jARmaCRlQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="e64a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">近28%的房屋位于南部大都市地区。</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h2 id="bd90" class="ma mb it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">第三招</h2><p id="df6e" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">第三招也是关于<code class="fe nk nl nm lw b">value_counts</code>函数的。它通常与分类变量一起使用。然而，我们也可以在价格等连续变量上使用它。</p><p id="ca12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看每个价格出现的次数不是一种首选的方法。但是，我们可以创建容器并检查每个容器中值的数量。<code class="fe nk nl nm lw b">value_counts</code>功能的<code class="fe nk nl nm lw b">bin</code>参数将整个范围划分为指定数量的箱。然后，我们可以看到这些箱中的值的分布。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="37cc" class="ma mb it lw b gy mc md l me mf">df.Price.value_counts(normalize=True, bins=10)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/9b632199872a2e3088e4efc9e337cb8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/1*bcgtV2Dcm39_tC-0z18QYA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="7918" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">56%的房屋位于第一个区间，该区间的跨度在73k和120万之间。</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h2 id="48f9" class="ma mb it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">第四招</h2><p id="4ea0" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">第四个是关于过滤数据帧。在典型的探索性数据分析过程中，我们会进行大量过滤。或者，我们可能只是对符合一组条件的观察结果(即行)感兴趣。</p><p id="738e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑这样一种情况，我们需要过滤超过3个房间并且花费超过50万的房子。我们可以根据这些条件过滤数据帧，如下所示:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="31fe" class="ma mb it lw b gy mc md l me mf">df_filtered = df[(df.Price &gt; 500000) &amp; (df.Rooms &gt; 3)]</span><span id="f2e8" class="ma mb it lw b gy mg md l me mf">df_filtered.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/bfa3f44b46aefcb649e41f35daba5af3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*qkvJl9VMAuWCnh1c9codbQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="90cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要写下数据框和列的名称。在多个过滤器的情况下，我们需要将每个过滤器放在括号中，并用“&amp;”号分开。</p><p id="e096" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nk nl nm lw b">query</code>函数提供了更简单的语法。如果您熟悉SQL，它肯定会对您更有吸引力。我们可以将条件作为字符串传递，如下所示:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="54ed" class="ma mb it lw b gy mc md l me mf">df_filtered = df.query("Price &gt; 500000 and Rooms &gt; 3")</span><span id="b279" class="ma mb it lw b gy mg md l me mf">df_filtered.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/bfa3f44b46aefcb649e41f35daba5af3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*qkvJl9VMAuWCnh1c9codbQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</p></figure><p id="161b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们仍然需要编写条件，但是语法更容易键入。</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h2 id="de9f" class="ma mb it bd mo mp mq dn mr ms mt dp mu li mv mw mx lm my mz na lq nb nc nd ne bi translated">结论</h2><p id="1140" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">我们已经介绍了4个简单的技巧。它们不是什么神奇的把戏，但会帮助你更多地利用熊猫。一般来说，我们往往会忽略函数的参数。我绝对建议尽量多使用。他们在那里是有原因的。</p><p id="ea43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>