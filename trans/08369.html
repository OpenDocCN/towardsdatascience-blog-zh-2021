<html>
<head>
<title>Visualizing Local Electric Grid Pollution with a $7 Smart Lightbulb.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用7美元的智能灯泡观察当地电网污染。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualizing-local-electric-grid-pollution-with-a-7-smart-lightbulb-2cf16abe5f4e?source=collection_archive---------32-----------------------#2021-08-01">https://towardsdatascience.com/visualizing-local-electric-grid-pollution-with-a-7-smart-lightbulb-2cf16abe5f4e?source=collection_archive---------32-----------------------#2021-08-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3976" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">气候爱好者的物理数据可视化。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/adac598dcc43dab879366a6cab6a1ee2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wltomyMjO5Li9JQc_spa_w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="e8cf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">结合来自<a class="ae lu" href="https://www.watttime.org/" rel="noopener ugc nofollow" target="_blank"> WattTime </a> API的电网清洁度评分和<a class="ae lu" href="https://www.amazon.com/gp/product/B087D22ZVT/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=B087D22ZVT&amp;linkCode=as2&amp;tag=benbogart09-20&amp;linkId=2ca835c418d8fcc8986acde5b82e3871" rel="noopener ugc nofollow" target="_blank">的廉价智能灯泡</a>，我将演示“电网灯泡”的创建过程，它可以可视化当地电网在任何时刻有多脏。知识就是力量，知道我们当地的能源生产何时更清洁，使我们能够通过决定何时消耗一些电力来选择减少污染和碳排放。在WattTime与Geoff Hancock的一次谈话激发了这个项目。</p><p id="2fc0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我们开始之前，你应该知道，我通过本帖中的代销商链接购买任何物品都会获得佣金。该委员会有助于支持今后设立像这样的职位。</p><p id="44c1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">每当你打开插在墙上的电气设备，你就增加了对电网的少量需求。发电厂通过增加产量向电网提供必要的能量来满足这一需求。如果发电厂燃烧煤炭，插入你的设备会比发电厂甚至天然气发电厂产生更多的碳排放。你的设备消耗的能量越多，差别就越大。因此，通过了解什么时候你的电网是最干净的，你可以通过选择什么时候给你的电动汽车充电来减少你的排放量。</p><p id="ea69" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是我们怎么知道什么时候我们的网格是最干净的呢？我使用了由<a class="ae lu" href="https://www.watttime.org/" rel="noopener ugc nofollow" target="_blank"> WattTime </a>提供的创新API。WattTime是一个非盈利组织，旨在回答“我现在用的电有多干净？”他们已经为美国、加拿大和其他强制要求发电厂报告排放的国家回答了这个问题。他们目前正致力于通过与ClimateTrace的合作将这种能力扩展到世界其他地方。</p><p id="c104" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">WattTime API对每个网格进行评分，分值范围为0-100，其中0表示最干净，100表示最脏。这是为我们的“电网灯泡”供电的实时数据</p><p id="60db" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我正在使用这个<a class="ae lu" href="https://www.amazon.com/gp/product/B087D22ZVT/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=B087D22ZVT&amp;linkCode=as2&amp;tag=benbogart09-20&amp;linkId=2ca835c418d8fcc8986acde5b82e3871" rel="noopener ugc nofollow" target="_blank"> $7灯泡</a>，它像大多数廉价智能设备一样，连接到图雅平台。这些灯泡暴露了一个本地API，可以从我们局域网上的任何计算机直接与它们通信，这意味着我们不需要智能集线器或任何其他智能设备来工作。如果您通过本文中的链接购买灯泡，我可能会收到</p><p id="56f2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">结合这两个API和一点Python，我们将创建一个显示当前网格清洁度的灯，绿色表示最干净，红色表示最脏。</p><h1 id="aae8" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">WattTime API</h1><p id="7c6e" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">WattTime API使用起来很简单，文档<a class="ae lu" href="https://www.watttime.org/api-documentation/#introduction" rel="noopener ugc nofollow" target="_blank">提供了很好的例子。虽然数据计划页面有点混乱，但我发现免费计划允许访问当前的本地电网条件。</a></p><p id="4df5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将通过以下方式获得排放分数:</p><ul class=""><li id="adec" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">注册WattTime API。</li><li id="1c23" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">认证。</li><li id="1cc3" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">用谷歌地图确定我们的纬度和经度。</li><li id="dbde" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">获得实时排放量。</li></ul><h2 id="485a" class="ng lw it bd lx nh ni dn mb nj nk dp mf lh nl nm mh ll nn no mj lp np nq ml nr bi translated">注册WattTime API</h2><p id="2776" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">你通过API本身注册API，效率非常高。记得用你的信息替换<code class="fe ns nt nu nv b">USER_NAME</code>、<code class="fe ns nt nu nv b">PASSWORD</code>、<code class="fe ns nt nu nv b">EMAIL</code>和<code class="fe ns nt nu nv b">ORG</code>。</p><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="c152" class="ng lw it nv b gy oa ob l oc od">import requests</span><span id="db61" class="ng lw it nv b gy oe ob l oc od">params = {'username': 'THE USER_NAME YOU WANT',<br/>         'password': 'THE PASSWORD YOU WANT',<br/>         'email': 'YOU EMAIL',<br/>         'org': 'ORG NAME'}</span><span id="3a1b" class="ng lw it nv b gy oe ob l oc od">register_url = '<a class="ae lu" href="https://api2.watttime.org/v2/register'" rel="noopener ugc nofollow" target="_blank">https://api2.watttime.org/v2/register'</a><br/>rsp = requests.post(register_url, json=params)<br/>print(rsp.text)</span></pre><p id="e4f2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果一切顺利，您将获得一条成功消息，显示您已经成功注册了该API。</p><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="09fd" class="ng lw it nv b gy oa ob l oc od">{"user":"benbogart","ok":"User created"}</span></pre><p id="5913" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果出现错误，请相应地调整参数。在下面的情况下，我们将不得不选择一个不同的用户名，然后再试一次。</p><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="735a" class="ng lw it nv b gy oa ob l oc od">{"error":"That username is taken. Please choose another."}</span></pre><h2 id="d6b8" class="ng lw it bd lx nh ni dn mb nj nk dp mf lh nl nm mh ll nn no mj lp np nq ml nr bi translated">鉴定</h2><p id="4304" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">WattTime API使用HTTP基本认证将您的用户名和密码交换为访问令牌。这也很简单，使用<code class="fe ns nt nu nv b">requests.auth</code>中的<code class="fe ns nt nu nv b">HTTPBasicAuth</code>。</p><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="f7b5" class="ng lw it nv b gy oa ob l oc od">from requests.auth import HTTPBasicAuth</span><span id="a0bc" class="ng lw it nv b gy oe ob l oc od">login_url = 'https://api2.watttime.org/v2/login'<br/>auth = HTTPBasicAuth(params['username'], params['password']))</span><span id="9a56" class="ng lw it nv b gy oe ob l oc od">rsp = requests.get(login_url, auth=auth)<br/>token = rsp.json()['token']</span><span id="6d8e" class="ng lw it nv b gy oe ob l oc od">print(rsp.json())</span></pre><p id="ab92" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">检查响应以确保您收到了令牌。如果是这样，我们可以继续前进。</p><h2 id="7aa1" class="ng lw it bd lx nh ni dn mb nj nk dp mf lh nl nm mh ll nn no mj lp np nq ml nr bi translated">用谷歌地图确定我们的纬度和经度</h2><p id="e530" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">在这个例子中，我将使用位于市政厅的布鲁明顿。你应该用你的地址。</p><p id="3f41" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">搜索您的地址，然后右键单击、双指单击或ctrl+单击地图上的红色大头针。这将弹出一个对话框，显示大头针的纬度和经度。单击纬度和经度，这会将它们复制到您的剪贴板。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/60eaf2476854bfbc189dc67f9a00297c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aBliYPdT1JnxGeQ4Y1-Ykw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a1c5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们现在将这些值分配给<code class="fe ns nt nu nv b">latitude</code>和<code class="fe ns nt nu nv b">longitude</code>。</p><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="928f" class="ng lw it nv b gy oa ob l oc od">lat = 39.17100708872063<br/>long = -86.53651334662412</span></pre><h2 id="c5c2" class="ng lw it bd lx nh ni dn mb nj nk dp mf lh nl nm mh ll nn no mj lp np nq ml nr bi translated">获取实时排放</h2><p id="78a6" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">现在，我们拥有了获取本地区实时排放量所需的一切。</p><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="c9cf" class="ng lw it nv b gy oa ob l oc od">index_url = '<a class="ae lu" href="https://api2.watttime.org/index'" rel="noopener ugc nofollow" target="_blank">https://api2.watttime.org/index'</a></span><span id="87ad" class="ng lw it nv b gy oe ob l oc od">params = {'latitude': lat, 'longitude': long}</span><span id="23ad" class="ng lw it nv b gy oe ob l oc od">rsp=requests.get(index_url, headers=headers, params=params)</span><span id="991b" class="ng lw it nv b gy oe ob l oc od">print(rsp.text)</span></pre><p id="0e6b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它会返回类似这样的内容:</p><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="6f7e" class="ng lw it nv b gy oa ob l oc od">{<br/>    "freq": "300", <br/>    "ba": "MISO_INDIANAPOLIS",<br/>    "percent": "57",<br/>    "point_time": "2021-07-31T17:00:00Z"<br/>}</span></pre><ul class=""><li id="29d7" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated"><code class="fe ns nt nu nv b">freq</code>显示数据更新的频率。</li><li id="1f2f" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated"><code class="fe ns nt nu nv b">ba</code>是地区。</li><li id="460e" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated"><code class="fe ns nt nu nv b">percent</code>是我们地区当前的污染值。</li><li id="fdd7" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated"><code class="fe ns nt nu nv b">point_time</code>是最后一次更新分数的时间。</li></ul><p id="0260" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将使用<code class="fe ns nt nu nv b">percent</code>来更新智能灯泡的颜色。</p><h1 id="1060" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">连接到智能灯泡</h1><p id="c0f0" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">这里的指示是连接到专为图雅平台设计的wifi智能灯泡。绝大多数低成本智能设备都使用这个平台，包括任何使用智能生活app的灯泡。</p><p id="1e77" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些灯泡暴露了一个API，允许我们通过本地网络直接控制它们。不幸的是，我们需要经历一些困难才能获得灯泡的API密钥。此外，这些灯泡通常只能在2.4Ghz网络上工作。</p><p id="8e77" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">图雅使用智能手机应用程序将智能设备连接到当地的wifi网络，并在图雅网络上注册。在图雅平台上注册设备可以让我们检索灯泡的API密钥，因此虽然我们不会使用图雅平台或智能生活应用程序来控制灯泡，但我们仍然必须注册灯泡以获得API密钥来访问灯泡的API。</p><p id="b3d5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是我们连接灯泡的步骤。</p><ul class=""><li id="8f73" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">下载并设置智能生活应用程序。</li><li id="8866" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">将灯泡连接到我们的wifi，并在智能生活应用程序中注册。</li><li id="ebb3" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">通过图雅开发者平台获取灯泡的API密钥。</li><li id="0d88" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">连接灯泡。</li></ul><h2 id="8daf" class="ng lw it bd lx nh ni dn mb nj nk dp mf lh nl nm mh ll nn no mj lp np nq ml nr bi translated">下载并设置智能生活应用程序</h2><ul class=""><li id="5308" class="ms mt it la b lb mn le mo lh og ll oh lp oi lt mx my mz na bi translated">下载并安装智能生活app。[ <a class="ae lu" href="https://apps.apple.com/us/app/smart-life-smart-living/id1115101477" rel="noopener ugc nofollow" target="_blank">苹果</a> ] [ <a class="ae lu" href="https://play.google.com/store/apps/details?id=com.tuya.smartlife" rel="noopener ugc nofollow" target="_blank">安卓</a> ]</li><li id="aa12" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">登录或创建一个用户帐户。</li></ul><h2 id="9cde" class="ng lw it bd lx nh ni dn mb nj nk dp mf lh nl nm mh ll nn no mj lp np nq ml nr bi translated">将灯泡连接到我们的wifi，并在智能生活应用程序中注册</h2><p id="966d" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">大多数现代wifi网络在一个网络id上同时使用2.4Ghz和5Ghz频道。我们的廉价灯泡只能使用2.4Ghz网络，当使用智能生活应用程序的默认EZ配对方法时，它会变得混乱。我们将它与“AP模式”配对，这似乎可以解决这个问题。这个方法比“EZ”方法长一点，但这是我们为便宜付出的代价。</p><ul class=""><li id="c536" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">在智能生活应用程序中，点击“添加设备”或屏幕左上角的+图标。</li><li id="8d71" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">在“手动添加”标签中，选择照明和您购买的灯泡种类。我选了“光源(Wi-Fi)。”</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/d53e16faa38a98b162ce6583df96bbf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h02t4jjNLS5t_VsLqMILLA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><ul class=""><li id="2174" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated"><strong class="la iu">更改配对模式。</strong>以下屏幕将要求我们重置设备。在此之前，请点击右上角的“EZ模式”然后，从出现的菜单中选择“AP模式”</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/1577b829c2a4b27c682145d2355e483e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eP4DNCSg6-n64jOZhwH0og.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><ul class=""><li id="3a95" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">接下来，连续两次复位灯泡:先关再开3次，等灯泡开始快速闪烁，再关再开，等开始缓慢闪烁<strong class="la iu"><em class="ok"/></strong>。</li><li id="d211" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">当缓慢闪烁时，灯泡会创建一个wifi热点。智能生活应用程序会引导你进入wifi设置并连接灯泡。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/62a8ffe4923113d7fdd41e095a05c5d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cMbJmdM6IdpySiDWUj71-w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><ul class=""><li id="99e7" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">返回应用程序并完成配对。现在你应该可以在智能生活应用中看到你的灯泡了。这是一个玩应用程序的好时机，看看你的灯泡能做什么。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/cfcf4ddf55203302c0136247a37689ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D--G1L9AiQ8sYrfS2G9b9Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="8b67" class="ng lw it bd lx nh ni dn mb nj nk dp mf lh nl nm mh ll nn no mj lp np nq ml nr bi translated">通过图雅开发者平台获取灯泡的API密钥</h2><p id="5137" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">现在灯泡连接到我们的本地网络，我们可以从我们的手机控制它，下一步是获得设备id，并从图雅开发者平台提取API密钥。</p><p id="b539" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">第一部分:图雅设置</strong></p><ul class=""><li id="e3f5" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">在iot.tuya.com<a class="ae lu" href="https://iot.tuya.com/" rel="noopener ugc nofollow" target="_blank">创建一个免费的图雅开发者账户</a>。(选择登录框下方的“注册”)。</li><li id="3e13" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">您可以跳过“组织类型”对话框。</li><li id="4a51" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">登录后，选择左侧导航栏中的“云”。第一次这样做时，图雅会让你选择一个计划。选择免费的“试用版”并查看。您必须像购买该计划一样结账，但您不会被收取任何费用，也不必提供任何付款信息。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/970e3bcce839fdb1d6fe20e9e206c339.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YVVrB5bQ1rAMcSHVgSP4kg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><ul class=""><li id="73d2" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">回到物联网平台，再次选择云。这次选择“创建云项目”</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/5877da724378d485e1b1062a769b30e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MWl2LEeWhimP8iUtCZZY2g.png"/></div></div></figure><ul class=""><li id="896c" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">填写“创建云项目”对话框，确保选择“智能家居”作为开发方法。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/e6d1c781e002d8d84475746c35b93d45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HRGb5CFmygFpN6sMHhze-A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><ul class=""><li id="6d73" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">在下一个屏幕上，验证“<em class="ok">智能家居设备管理</em>”、“<em class="ok">授权</em>”和“<em class="ok">智能家居家庭管理”</em>是否列在选定的API产品下，然后单击授权。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/fc56a8a97d42588081779cbb432c4d01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pcX1WusO08_nVT4XeQb6Iw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><ul class=""><li id="3416" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">在这一步之后，图雅将带你去你的新项目。前往“设备”选项卡，选择“链接图雅应用程序帐户”</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/93be850889bebd84487a3fbc6cc9e49b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3gYav91T-ezyUvMDzP9bKQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="c474" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">图雅将展示一个二维码，我们需要用我们的智能生活应用程序扫描。在手机的智能生活应用程序中，进入“我”和屏幕右上角的扫描图标。这将调出一个二维码阅读器。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/fba4477a73c1db7caccf1603817c8891.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zrotwkec1N0JFxN76zEWYQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><ul class=""><li id="ad57" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">扫描二维码后，点击“确认登录”，您的设备将出现在物联网平台的图雅物联网平台设备选项卡中。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/be5ba4aadd0e9f0e1558cc1057c6b6ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fSJW_4qWv-zNjB1D7iti-Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3e03" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">先不要关闭这一页。我们还需要两条信息，但是我们已经完成了帐户设置。</p><p id="9ccd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">第2部分:获取API密钥</strong></p><p id="ed19" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在一切就绪，我们可以提取灯泡的API密钥了。我发现<code class="fe ns nt nu nv b">tinytuya</code>包既有提取API密钥的最简单的方法，也有连接灯泡的最简单的方法。</p><ul class=""><li id="a8c4" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">安装<code class="fe ns nt nu nv b">tinytuya</code></li></ul><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="b504" class="ng lw it nv b gy oa ob l oc od">pip install tinytuya</span></pre><ul class=""><li id="ec08" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">获取设备id:要登录API，我们需要与帐户相关联的任何智能设备的Id。因为我们只有一个灯泡，所以我们需要获取它的设备id。我们可以从命令行使用<code class="fe ns nt nu nv b">tinytuya</code>来完成这项工作。</li></ul><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="c1a6" class="ng lw it nv b gy oa ob l oc od">$ python -m tinytuya scan</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/3543fc28a81866f608a8986a3002e77c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*52F-HMDVMObN9XQyS6ZAlA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="580b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将轮询本地网络上设备的端口6666和6667，并返回任何图雅设备。我们可以从上面的扫描中看到，设备ID以蓝色列出。</p><ul class=""><li id="b20c" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">导航至将在其中创建python脚本的目录。下面的向导生成一个JSON文件，该文件必须保存在与脚本相同的目录中。</li><li id="bd5c" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">在命令行上运行以下命令，然后继续阅读在哪里检索每个请求的项目。</li></ul><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="c7bd" class="ng lw it nv b gy oa ob l oc od">python -m tinytuya wizard</span></pre><ul class=""><li id="2921" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">从图雅项目页面输入您的API密钥(又名客户端ID)和API秘密(又名客户端秘密)。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/d113ac72da3d6847e7eefa25f68d4298.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pSy12dpLyvTILNegdTWMzA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><ul class=""><li id="d02e" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">输入您在上一步中通过微型tuya扫描获得的设备ID</li><li id="6453" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">从列表选项中输入最近的区域。</li></ul><p id="3b8a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">结果看起来会像这样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/4fa096c2ec8c8774fe317c145725dc67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ANoUBJHA2OtrBYqUfipT9g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="1661" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好了，所有的难题都解决了！我们不需要图雅API来做任何其他事情，但如果你从你的智能生活应用程序中移除灯泡，你将需要重复上述步骤。</p><p id="b7bd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在来看看魔术。</p><h2 id="5242" class="ng lw it bd lx nh ni dn mb nj nk dp mf lh nl nm mh ll nn no mj lp np nq ml nr bi translated">连接灯泡</h2><p id="07c7" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">我们有直接连接灯泡所需的一切。在一个地方看到这一切的最简单的方法是重复设备扫描，现在我们已经连接到图雅API。</p><ul class=""><li id="8209" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">在命令提示符下重复设备扫描…</li></ul><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="3ad7" class="ng lw it nv b gy oa ob l oc od">$ python -m tinytuya scan</span></pre><p id="a41d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">…或者在Jypyter笔记本中。</p><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="234f" class="ng lw it nv b gy oa ob l oc od">import tinytuya<br/>intytuya.scan()</span></pre><p id="34a5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这次扫描给了我们连接灯泡所需的一切，包括本地API密钥。</p><blockquote class="ov ow ox"><p id="b07c" class="ky kz ok la b lb lc ju ld le lf jx lg oy li lj lk oz lm ln lo pa lq lr ls lt im bi translated">注意:这需要访问由<code class="fe ns nt nu nv b">tinytuya wizard</code>生成的devices.json文件。确保从同一目录运行该命令，或者将devices.json复制到您的工作目录。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/71cdb734c5f294df29cc3e1434e2b764.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iOSjnq7hzpVTNc5TTTB3KQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><ul class=""><li id="21d4" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">在您的笔记本或代码编辑器中，通过替换下面代码中灯泡的详细信息来连接灯泡。</li></ul><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="b197" class="ng lw it nv b gy oa ob l oc od">bulb = tinytuya.BulbDevice(dev_id='DEVICE ID',<br/>                           address='ADDRESS',<br/>                           local_ley='LOCAL KEY')<br/>bulb.set_version(VERSION)<br/>print(f'set status result {bulb.status()}')</span></pre><p id="1eb1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果连接成功，您将得到类似如下的响应:</p><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="4ee8" class="ng lw it nv b gy oa ob l oc od">set status result {'devId': '42313382e09806b2e707', 'dps': {'20': True, '21': 'white', '22': 1000, '23': 1000, '24': '000003e803e8', '25': '000e0d0000000000000000c80000', '26': 0}}</span></pre><ul class=""><li id="4c63" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">摆弄一下灯泡。当这个成功的时候，你可以尽情地大笑。</li></ul><p id="c0ab" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">试着打开灯泡:</p><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="656f" class="ng lw it nv b gy oa ob l oc od">bulb.turn_on()</span></pre><p id="0ba0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">关闭灯泡:</p><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="905d" class="ng lw it nv b gy oa ob l oc od">bulb.turn_off()</span></pre><p id="e970" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在0-100的范围内设置亮度:</p><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="c21e" class="ng lw it nv b gy oa ob l oc od">bulb.set_brightness_percentage(25)</span></pre><p id="d432" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">设置灯泡的颜色:</p><pre class="kj kk kl km gt nw nv nx ny aw nz bi"><span id="a70b" class="ng lw it nv b gy oa ob l oc od">bulb.set_colour(0,255,255)</span></pre><p id="21a8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以在<code class="fe ns nt nu nv b"><a class="ae lu" href="https://pypi.org/project/tinytuya/" rel="noopener ugc nofollow" target="_blank">tinytuya</a></code> <a class="ae lu" href="https://pypi.org/project/tinytuya/" rel="noopener ugc nofollow" target="_blank">文档中找到<code class="fe ns nt nu nv b">tinytuya</code>支持命令的完整列表。</a></p><h1 id="99be" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">可视化智能灯泡上的瓦特时间分数</h1><p id="1428" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">剩下的就是使用智能灯泡来显示灯泡上的watt time grid dirty得分。我选择红色代表最脏的，绿色代表最干净的，因为我觉得这很直观，也因为数学很简单。</p><p id="d57a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以在下面或者在<a class="ae lu" href="https://github.com/benbogart/emissions-bulb" rel="noopener ugc nofollow" target="_blank"> Github库</a>中找到代码。将文件另存为<code class="fe ns nt nu nv b">gridbulb.py</code>并用<code class="fe ns nt nu nv b">python gridbulb.py</code>运行。脚本会一直运行，直到你用<code class="fe ns nt nu nv b">ctrl</code> + <code class="fe ns nt nu nv b">c</code>停止它。不要忘记用您的信息替换方括号中的字段。</p><blockquote class="ov ow ox"><p id="0ceb" class="ky kz ok la b lb lc ju ld le lf jx lg oy li lj lk oz lm ln lo pa lq lr ls lt im bi translated">注意:你可以通过添加<code class="fe ns nt nu nv b">&amp;</code>在后台运行脚本。这将派生脚本，给它自己的进程id。如果你以前没有这样做过，我在这里推荐一些关于这个主题的轻松读物。</p></blockquote><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pc pd l"/></div></figure><h1 id="ae2f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="3916" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">虽然这篇文章是关于在一个智能灯泡上可视化您的本地能源网格有多干净，但是每个组件都可以应用于其他任务。你可以将一个智能开关连接到你的电动汽车充电器上，这样你的汽车只能用最清洁的能源充电。你可以在你的智能灯泡上想象比特币的波动分数。可能性只受到你想象力的限制。</p><p id="e080" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">连接一个便宜的智能灯泡需要大量的努力，但我们只需经历一次磨难。不过，如果我不得不再次这样做，我可能会考虑多花几美元买一个可以直接连接到我的三星智能集线器的灯泡。不过，希望使用7美元的灯泡能让更多人接触到它。</p><p id="fbf8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在去用你的智能灯泡做点好事吧。</p><h1 id="4829" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">资源</h1><ul class=""><li id="bcfa" class="ms mt it la b lb mn le mo lh og ll oh lp oi lt mx my mz na bi translated"><a class="ae lu" href="https://github.com/benbogart/emissions-bulb" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>为本帖</li><li id="6fc2" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated"><a class="ae lu" href="https://www.watttime.org/api-documentation/" rel="noopener ugc nofollow" target="_blank"> WattTime API文档</a></li><li id="1432" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated"><code class="fe ns nt nu nv b"><a class="ae lu" href="https://pypi.org/project/tinytuya/" rel="noopener ugc nofollow" target="_blank">tinytuya</a></code> <a class="ae lu" href="https://pypi.org/project/tinytuya/" rel="noopener ugc nofollow" target="_blank">文档</a></li><li id="5afd" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">亚马逊上售价7美元的智能灯泡</li></ul></div></div>    
</body>
</html>