<html>
<head>
<title>Orthographic projection with pyproj for penguin tracking in Antarctica</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于pyproj的南极企鹅追踪正射投影</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/orthographic-projection-with-pyproj-for-penguin-tracking-in-antarctica-18cd2bf2d570?source=collection_archive---------34-----------------------#2021-07-08">https://towardsdatascience.com/orthographic-projection-with-pyproj-for-penguin-tracking-in-antarctica-18cd2bf2d570?source=collection_archive---------34-----------------------#2021-07-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="02f0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在正投影中创建地图以及使用企鹅追踪数据创建地图动画— Pyproj和KeplerGL</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7a14f45d8b60ff2d16cc1f8b77988281.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*mSpm7-26WDo9OsSb7etcRw.gif"/></div></div></figure><p id="fc7b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">阿德利企鹅的行为研究是针对<strong class="kw iu">中心位置觅食理论</strong>的，该理论解释了繁殖海鸟应该积极优化猎物的获取，因此，觅食应该位于猎物最容易获得的地方，在物种能量学定义的范围内【1】。尽管南极的条件如海面温度、叶绿素浓度或海冰覆盖，企鹅必须根据海洋学特征在不同的地点找到觅食的成功。</p><p id="5ae5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这次地图审查中，我将使用一个子集，其中包含2018年在南极洲记录的16只企鹅的运动轨迹。整个数据集包含2010年12月21日至2018年1月11日期间记录的129只企鹅的跟踪信息，可以在Movebank中直接找到<a class="ae lq" href="https://www.movebank.org/cms/webapp?gwt_fragment=page=studies,path=study1375204238" rel="noopener ugc nofollow" target="_blank">T5这里 </a> <strong class="kw iu">。</strong></p><blockquote class="lr ls lt"><p id="9f0d" class="ku kv lu kw b kx ky ju kz la lb jx lc lv le lf lg lw li lj lk lx lm ln lo lp im bi translated"><strong class="kw iu">最终地图动画:</strong> <a class="ae lq" href="https://bryanvallejo16.github.io/penguin-tracking-antarctica/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">这里！</strong> </a> <strong class="kw iu"> <br/>资源库:</strong> <a class="ae lq" href="https://github.com/bryanvallejo16/penguin-tracking-antarctica" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">这里！</strong> </a></p></blockquote><p id="0e5e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">目标<em class="lu">目标</em>目标</strong></p><p id="e666" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个练习的主要目的是用pyproj在正投影中可视化企鹅的足迹。此外，使用KeplerGL创建地图动画，显示企鹅在海岸线上觅食活动期间的行为运动。因此，我们将获得两个产品:1)具有正交视图的地图，以及2)企鹅足迹的地图动画。</p><p id="b8b9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> <em class="lu"> 1)用正投影创建地图</em> </strong></p><p id="318b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正交投影的思想是在三维地球中以方位角透视(垂直)来可视化对象。为此，我们将使用python库pyproj和geopandas。第一个主要步骤是可视化数据集。</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="3c1a" class="md me it lz b gy mf mg l mh mi">import geopandas as gpd<br/>import pandas as pd<br/>from pyproj import CRS<br/>from keplergl import KeplerGl<br/>import matplotlib.pyplot as plt</span><span id="a057" class="md me it lz b gy mj mg l mh mi"># reading data<br/>fp = r'data/penguin-tracks.gjson'<br/>geodata = gpd.read_file(fp, driver='GeoJSON')</span><span id="5a51" class="md me it lz b gy mj mg l mh mi"># defining timestamp columns<br/>geodata['timestamp'] = pd.to_datetime(geodata['timestamp'])<br/>geodata['year'] = pd.DatetimeIndex(geodata['timestamp']).year<br/>geodata['t'] = geodata['timestamp'].astype(str)</span></pre><p id="287e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的代码只是读取数据并创建两个额外的列。<code class="fe mk ml mm lz b">year</code>包含曲目的年份，对于本例，所有记录都是2018年，而<code class="fe mk ml mm lz b">t</code>包含字符串类型的时间戳。地图动画的字符串类型中需要最后一列。然后，作为WGS84中的快速可视化，我们运行下一行来可视化数据。</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="be68" class="md me it lz b gy mf mg l mh mi">geodata.plot(column='ind_ident', figsize=(12,6), markersize=0.2)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/ff23f8c45987ce60a818dac08e74f575.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*VHb5efzqWa6kKQx-YiReDQ.png"/></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">图片由作者提供。wgs84中16只企鹅的足迹</p></figure><p id="86fb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我将直接从geopandas加载全球国家的<a class="ae lq" href="https://www.naturalearthdata.com/" rel="noopener ugc nofollow" target="_blank">自然地球</a>图层，并将其投影到<a class="ae lq" href="https://epsg.io/3031" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">正投影</strong> </a>。因此，按照我们观察圆形球体的方式，我将正投影的中心放在南极，这意味着<code class="fe mk ml mm lz b">latitude -90°</code>和<code class="fe mk ml mm lz b">longitude 0°</code>。正投影的CRS通过转换获得:从proj4(参数)到CRS。代码是这样的:</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="170b" class="md me it lz b gy mf mg l mh mi"># create world layer<br/>world = gpd.read_file(gpd.datasets.get_path(‘naturalearth_lowres’))</span><span id="b8d9" class="md me it lz b gy mj mg l mh mi"># define center of Orthographic Projection<br/>lat = -90<br/>lon = 0</span><span id="a143" class="md me it lz b gy mj mg l mh mi">ortho = CRS.from_proj4("+proj=ortho +lat_0={} +lon_0={} +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs".format(lat, lon))</span><span id="b3c1" class="md me it lz b gy mj mg l mh mi"># Re-project and plot<br/>geodataor = geodata.to_crs(ortho)<br/>world = world.to_crs(ortho)<br/>world.plot(figsize=(12,6))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/c521b8b0c15a459fed9ce793178ea404.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*gdf4BrfZNirjQpf8Tl1Ahw.png"/></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">图片由作者提供。正交投影以南极洲为中心的世界图层</p></figure><p id="882a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我们创建一个独特的<code class="fe mk ml mm lz b">figure, ax</code>，在那里<strong class="kw iu">世界层</strong>和<strong class="kw iu">企鹅轨迹</strong>将被添加。在这个独特的<code class="fe mk ml mm lz b">figure, ax</code>中，我们设定<strong class="kw iu"> x </strong>和<strong class="kw iu"> y </strong>限制了南极洲大陆的边界框。首先，我们得到南极洲的边界框，然后我们绘制它。代码如下所示:</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="4526" class="md me it lz b gy mf mg l mh mi">antarctic = list(world.loc[world['continent']=='Antarctica'].geometry)[0]<br/>antarctic</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/d12fb2d014b78b669197397866acfde0.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*EvPPkxIuJf3CqNb2hFTNvw.png"/></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">图片由作者提供。南极的几何对象</p></figure><p id="46a3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们设置包围盒的<strong class="kw iu"> x最小，x最大，y最小，y最大</strong>:</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="3ab9" class="md me it lz b gy mf mg l mh mi">bounds = antarctic.bounds<br/> <br/>xmin = bounds[0]<br/>xmax = bounds[2]</span><span id="6cf8" class="md me it lz b gy mj mg l mh mi">ymin = bounds[1]<br/>ymax = bounds[3]</span></pre><p id="9373" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，独特的<code class="fe mk ml mm lz b">figure, ax</code>:</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="7845" class="md me it lz b gy mf mg l mh mi"># create unique fig, ax<br/>fig, ax = plt.subplots(figsize=(12, 8))</span><span id="9f51" class="md me it lz b gy mj mg l mh mi"># adding layers<br/>world.plot(ax=ax)<br/>geodataor.plot(ax=ax, markersize=10, color=’red’)</span><span id="4186" class="md me it lz b gy mj mg l mh mi"># limits<br/>ax.set(xlim=(xmin, xmax), ylim=(ymin, ymax))</span><span id="2f3f" class="md me it lz b gy mj mg l mh mi">plt.axis(‘off’)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/a65d08dc876fc1084e32d2c6149c050a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VhgkUcJug_QRXHuglXnwLQ.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">图片由作者提供。正投影中企鹅足迹的定位</p></figure><p id="9ce3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">既然我们知道了企鹅足迹的位置，我们就可以绘制最终的地图了。</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="b387" class="md me it lz b gy mf mg l mh mi">plt.style.use(‘seaborn’)</span><span id="100a" class="md me it lz b gy mj mg l mh mi"># create unique fig, ax<br/>fig, ax = plt.subplots(figsize=(10, 7))</span><span id="d9ab" class="md me it lz b gy mj mg l mh mi"># adding layers<br/>world.plot(ax=ax, color=’#CED7E0', edgecolor=’black’)<br/>geodataor.plot(ax=ax, column = ‘ind_ident’, markersize=7, alpha=0.8, cmap=’tab10', legend=True)</span><span id="6839" class="md me it lz b gy mj mg l mh mi"># limits<br/>ax.set(xlim=(1500000, 1800000), ylim=(-2050000, -1800000))</span><span id="c1f5" class="md me it lz b gy mj mg l mh mi"># plt.axis(‘off’)<br/>plt.grid(False)<br/>ax.set_facecolor(‘#0F4983’)</span><span id="255f" class="md me it lz b gy mj mg l mh mi">plt.title(‘Adélie Penguins tracks in Antarctic’)</span><span id="f487" class="md me it lz b gy mj mg l mh mi">ax.get_legend().set_bbox_to_anchor((1.2,1))<br/>ax.get_legend().set_title(“Penguin ID”)</span><span id="6db9" class="md me it lz b gy mj mg l mh mi">plt.savefig(r’png/penguin-tracks.png’)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/357c931fbd67918178dec3f6a4984418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VSsoW7owLl-t5vep5t0IGg.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">图片由作者提供。南极的企鹅足迹。</p></figure><p id="b342" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> <em class="lu"> 2)用KeplerGL </em> </strong>创建地图动画</p><p id="dd76" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我们想要可视化企鹅足迹的运动模式。我们在<code class="fe mk ml mm lz b">geodata </code>层中只选择地图动画所需的列。那么，可视化运动模式的一个很棒的工具就是KeplerGL库。创建KeplerGL映射的步骤是从一个空实例开始，然后添加数据，最后保存映射。如下:</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="3e45" class="md me it lz b gy mf mg l mh mi"># selecting the needed columns<br/>geodata = geodata[[‘t’, ‘ind_ident’, ‘geometry’]]</span><span id="b4f6" class="md me it lz b gy mj mg l mh mi"># Create KeplerGl instance<br/>m = KeplerGl(height=600)</span><span id="b913" class="md me it lz b gy mj mg l mh mi"># Add stop durations<br/>m.add_data(geodata, ‘Penguins’)</span><span id="8602" class="md me it lz b gy mj mg l mh mi">m</span></pre><p id="2caa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这里，我们使用KeplerGL根据需要配置地图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/9cbb2cac31fb6b59b68100b1572722e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2cbV_JE21hTuWCFV-JLwEQ.png"/></div></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">图片由作者提供。带有企鹅跟踪数据的KeplerGL实例</p></figure><p id="2b60" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，配置完成后保存地图即可。</p><pre class="kj kk kl km gt ly lz ma mb aw mc bi"><span id="d345" class="md me it lz b gy mf mg l mh mi"># Save map as html<br/>m.save_to_html(file_name=’index.html’)</span></pre><p id="807e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">结论</strong></p><p id="b858" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以根据需要使用正投影，不仅可以使用这些数据，而且您可能会注意到，您总是需要在同一个地图中包含所有具有相同投影的内容。这个病例是正高的。对于KeplerGL，数据必须在地理CRS (EPSG 4326)中。</p><p id="172d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">企鹅追踪记录包含了空间空白。像往常一样，这种情况发生在运动数据上，并且与GPS信号有关。有重建轨迹(路径)的选项。如果你有兴趣了解更多动物追踪和运动数据，请在<a class="ae lq" href="https://www.linkedin.com/in/bryanrvallejo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">上ping我的LinkedIn个人资料</strong> </a> <strong class="kw iu">。</strong></p><p id="7699" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">参考文献</strong></p><p id="8fa3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">[1] Ballard，g .，Schmidt，a .，Toniolo，v .，Veloz，s .，Jongsomjit，d .，Arrigo，k .，Ainley，D. (2019)。<em class="lu">“表征阿德利企鹅在西南罗斯海成功觅食的精细尺度海洋学特征”</em>。第608卷:263–277页。https://doi.org/10.3354/meps12801</p></div></div>    
</body>
</html>