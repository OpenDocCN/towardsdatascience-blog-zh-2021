<html>
<head>
<title>Analysing Posterior Predictive Distributions with PyMC3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用PyMC3分析后验预测分布</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/analysing-posterior-predictive-distributions-with-pymc3-5b6544398181?source=collection_archive---------20-----------------------#2021-03-30">https://towardsdatascience.com/analysing-posterior-predictive-distributions-with-pymc3-5b6544398181?source=collection_archive---------20-----------------------#2021-03-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="bcb7" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="22af" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用PyMC3模拟后验分布</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/06426247a8082d272662c9242cc14e13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-a1B1pyWtrpjOsAnvge2xA.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">来源:图片来自<a class="ae lh" href="https://pixabay.com/photos/cube-shaker-luck-gambling-5214498/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure><p id="d381" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">贝叶斯分析的主要目的是在给定不确定性的情况下对数据进行建模。</p><p id="88a1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">由于人们无法获得关于一个群体的所有数据来确定其精确的分布，因此经常会做出相同的假设。</p><p id="ddcf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，我可能会对某个国家人口的平均身高做一个假设。这是一个<strong class="lk jd">先验分布</strong>，或者是一个建立在先验信念基础上的分布，在此之前，我们先来看看可以证明或否定这个信念的数据。</p><p id="06d7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在分析一组新数据(似然函数)时，可以将先验信念和似然函数结合起来形成<strong class="lk jd">后验分布。</strong></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi me"><img src="../Images/a307db3ae54b86128fd850d7961ecfe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u0Z8h0l1MJpaH_L021caeA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">来源:图片由作者创建</p></figure><p id="1f6c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们看看如何使用PyMC3来模拟这样的分布。</p><h1 id="6ef9" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">用PyMC3分析身体质量指数数据</h1><p id="57bf" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">在本例中，<a class="ae lh" href="https://www.kaggle.com/uciml/pima-indians-diabetes-database" rel="noopener ugc nofollow" target="_blank"> Pima Indians糖尿病数据集</a>用于模拟大量患者(其中一些是糖尿病患者，一些不是)的体重指数数据。</p><p id="0be5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在查看数据之前，需要建立一个关于该数据的均值和标准差的先验信念。鉴于数据集中相当多的患者是糖尿病患者，那么人们可以形成一种先验信念，即平均身体质量指数高于平均水平。</p><h2 id="52fc" class="nc mg it bd mh nd ne dn ml nf ng dp mp lr nh ni mr lv nj nk mt lz nl nm mv iz bi translated">螺母(不掉头取样器)</h2><p id="c4d9" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">在这方面，我们先假设平均身体质量指数为<strong class="lk jd"> 30 </strong>，相对较小的标准偏差为2，表明我们不希望在个别情况下偏离平均值太多。</p><pre class="ks kt ku kv gt nn no np nq aw nr bi"><span id="3a58" class="nc mg it no b gy ns nt l nu nv">mu_prior=30<br/>sigma_prior=2</span><span id="4a71" class="nc mg it no b gy nw nt l nu nv">with pm.Model() as model:<br/>    mu = pm.Normal("mu", mu=mu_prior, sigma=sigma_prior)<br/>    sd = pm.HalfNormal("sd", sigma=sigma_prior)<br/>    obs = pm.Normal("obs", mu=mu, sigma=sd, observed=data)<br/>    idata = pm.sample(1000, tune=1500, return_inferencedata=True)</span></pre><p id="b8dc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用3.1版本。采样模板来自<a class="ae lh" href="https://docs.pymc.io/notebooks/api_quickstart.html" rel="noopener ugc nofollow" target="_blank"> PyMC3通用API快速入门</a>手册，NUTS(不掉头)采样器用于从每个链的后部抽取1000个样本，然后允许在额外的1500次迭代中进行重新调整。注意，在生成后验分布时，除了先验均值和标准差之外，模型还考虑了观察数据<em class="nx">(观察=数据)</em>。</p><p id="31d3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">NUTS是蒙特卡罗马尔可夫链(MCMC) <a class="ae lh" href="https://arxiv.org/abs/1111.4246" rel="noopener ugc nofollow" target="_blank">算法</a>的一种形式，它绕过随机游走行为，允许更快地收敛到目标分布。这不仅具有速度优势，而且允许拟合复杂的模型，而不必使用关于这些拟合方法的理论的专业知识。</p><h2 id="4723" class="nc mg it bd mh nd ne dn ml nf ng dp mp lr nh ni mr lv nj nk mt lz nl nm mv iz bi translated">解释</h2><p id="a6cc" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">使用<strong class="lk jd"> arviz，</strong>下面是生成的后验图:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ny"><img src="../Images/732f208d4d6aac4044e6d36fbff0a238.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rtFOPLqpbgAZX7Lnd45twg.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">来源:Jupyter笔记本输出</p></figure><p id="3f81" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">还提供了分布的统计摘要:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nz"><img src="../Images/a02cf45166fe5e7589a7244095a5783d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Luf1crQCLOaGh4Uc6H6wuQ.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">来源:Jupyter笔记本输出</p></figure><p id="595c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请注意，<strong class="lk jd"> 31.949 </strong>的平均值略高于之前的估计，而标准偏差在<strong class="lk jd"> 7.823 </strong>处明显更高。</p><p id="8f50" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">考虑到这些数据，事后看来，标准差高于最初的预期是有道理的。</p><p id="d8a9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">毕竟，数据集中的许多患者都不是糖尿病患者。此外，尽管人们可能认为身体质量指数和糖尿病之间存在正相关，但这是基于先前的信念——如果不查看数据，我们没有确凿的证据证明这一点。</p><p id="d91f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">考虑到更新的平均值和标准偏差，下面是更新的后验分布:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/fc3c7be9b7b22e23f711aeea182ed7bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*k2blwMrhKZkH0_tixUeVGg.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">来源:Jupyter笔记本输出</p></figure><p id="71b1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以看到，离差高于最初的预期。也就是说，如果数据本身并不总是十分准确呢？例如，没有人的身体质量指数可以为0，但由于某种未知的原因，数据中存在许多0身体质量指数值。</p><p id="294b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，先验值的说明——以及数据中的大多数其他值——表明这种观察是极不可能的。在这方面，后验预测分布显著下降到20以下(数据中观察到的最低身体质量指数值为18.2)。</p><h2 id="2252" class="nc mg it bd mh nd ne dn ml nf ng dp mp lr nh ni mr lv nj nk mt lz nl nm mv iz bi translated">重温先前的信念</h2><p id="5d92" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">当我们第一次形成对身体质量指数的先验信念时，估计的平均值与实际值相差不远。</p><p id="85d6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，如果我们先前的信念完全偏离了目标呢？假设我们估计平均身体质量指数为50，标准差为2？</p><p id="a125" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">生成的后验分布如下:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/d577a52e2ae92e9d3ebff4a472ee1d9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*XQUYnDbP87vYYFvU47MyxQ.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">来源:Jupyter笔记本输出</p></figure><p id="2491" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">即使存在不准确的先验信念，采样器也可以认识到这完全偏离了相对于实际观察到的数据的标记，并且相应地更新分布。</p><p id="c028" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在新数据采用不同于先前模式的分布的情况下，这也非常有用。例如，一个公司的经理可能会根据经验假设某一年的产品销售倾向于显示某一平均值和标准偏差，但随后的数据与前几年的数据不同。在这方面，后验分布允许更新管理者的先前信念，以反映正在观察的新数据。</p><h1 id="7fe9" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">结论</h1><p id="d13e" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">后验分布允许在生成这种分布时通过考虑新的证据(或数据)来更新先前的信念。</p><p id="92a4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本例中，您已经学习了:</p><ul class=""><li id="7f46" class="ob oc it lk b ll lm lo lp lr od lv oe lz of md og oh oi oj bi translated">先验分布和后验分布之间的差异</li><li id="76d5" class="ob oc it lk b ll ok lo ol lr om lv on lz oo md og oh oi oj bi translated">如何用PyMC3模拟后验分布</li><li id="bac7" class="ob oc it lk b ll ok lo ol lr om lv on lz oo md og oh oi oj bi translated">如何用阿尔维兹解读后验情节</li><li id="38cb" class="ob oc it lk b ll ok lo ol lr om lv on lz oo md og oh oi oj bi translated">先验信念和似然函数在生成后验分布中的作用</li></ul><p id="7d08" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">非常感谢您的时间，任何问题或反馈都非常欢迎。你也可以在michael-grogan.com找到更多我的数据科学内容。</p><p id="d435" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="nx">免责声明:本文是在“原样”的基础上编写的，没有担保。它旨在提供数据科学概念的概述，不应被解释为专业建议。本文中的发现和解释是作者的发现和解释，不被本文中提到的任何第三方认可或隶属于任何第三方。</em></p><h1 id="cbc0" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">参考</h1><ul class=""><li id="160d" class="ob oc it lk b ll mx lo my lr op lv oq lz or md og oh oi oj bi translated"><a class="ae lh" href="https://arxiv.org/abs/1111.4246" rel="noopener ugc nofollow" target="_blank">盖尔曼和霍夫曼(2011)。不掉头采样器:在哈密尔顿蒙特卡罗中自适应地设置路径长度</a></li><li id="d464" class="ob oc it lk b ll ok lo ol lr om lv on lz oo md og oh oi oj bi translated"><a class="ae lh" href="https://www.kaggle.com/uciml/pima-indians-diabetes-database" rel="noopener ugc nofollow" target="_blank"> Kaggle:皮马印第安人糖尿病数据库</a></li><li id="9c71" class="ob oc it lk b ll ok lo ol lr om lv on lz oo md og oh oi oj bi translated"><a class="ae lh" href="https://docs.pymc.io/notebooks/api_quickstart.html" rel="noopener ugc nofollow" target="_blank"> PyMC3:通用API快速入门</a></li></ul></div></div>    
</body>
</html>