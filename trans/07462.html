<html>
<head>
<title>Model Overload — Which NLP Model Should I Choose?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模型过载—我应该选择哪个NLP模型？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/model-overload-which-nlp-model-should-i-choose-a8bfe05e77e1?source=collection_archive---------29-----------------------#2021-07-07">https://towardsdatascience.com/model-overload-which-nlp-model-should-i-choose-a8bfe05e77e1?source=collection_archive---------29-----------------------#2021-07-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6697" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何用Sagemaker实验评估和比较Huggingface NLP模型</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/33cd104fb90d737c0a34ec0e0f698bb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*57Q73enpe8abi-ZN"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">杰森·登特在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="4031" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">这是怎么回事？</h1><p id="029f" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">当我写这篇文章时，Huggingface 上的<a class="ae kv" href="https://huggingface.co/models" rel="noopener ugc nofollow" target="_blank">模型库由11256个模型组成，当你读到这篇文章时，这个数字只会增加。有这么多模型可供选择，难怪许多人不知所措，不知道该选择哪个模型来完成NLP任务。</a></p><p id="606b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果有一种便捷的方式来尝试相同任务的不同模型，并在各种指标上相互比较这些模型，那就太好了。Sagemaker Experiments 正是这么做的:它让你非常容易地组织、跟踪、比较和评估NLP模型。在本文中，我们将两个NLP模型进行对比，并比较它们的性能。</p><p id="820c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">所有代码都可以在这个<a class="ae kv" href="https://github.com/marshmellow77/sm-hf-experiments" rel="noopener ugc nofollow" target="_blank"> Github库</a>中找到。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="5d66" class="kw kx iq bd ky kz mw lb lc ld mx lf lg jw my jx li jz mz ka lk kc na kd lm ln bi translated">数据准备</h1><p id="8b88" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这个项目文章的数据准备可以在这个<a class="ae kv" href="https://github.com/marshmellow77/sm-hf-experiments/blob/main/1_data_prep.py" rel="noopener ugc nofollow" target="_blank"> Python脚本</a>中找到。我们将使用来自Huggingface 的<a class="ae kv" href="https://huggingface.co/datasets/imdb" rel="noopener ugc nofollow" target="_blank"> IMDB数据集，这是一个用于二元情感分类的数据集。数据准备是相当标准的，唯一需要注意的是，我们需要分别对每个模型的数据进行标记。然后，我们将数据存储在S3文件夹中，每个模型一个。</a></p><p id="4622" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们在本文中比较的型号将是<a class="ae kv" href="https://huggingface.co/distilbert-base-uncased" rel="noopener ugc nofollow" target="_blank"><em class="nb">distilbert-base-uncase</em></a>和<a class="ae kv" href="https://huggingface.co/distilroberta-base" rel="noopener ugc nofollow" target="_blank"><em class="nb">distilbert-base</em></a>。显然，Sagemaker实验并不局限于两个模型，实际上允许跟踪和比较几个NLP模型。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="abd3" class="kw kx iq bd ky kz mw lb lc ld mx lf lg jw my jx li jz mz ka lk kc na kd lm ln bi translated">度量定义</h1><p id="d64d" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">首先，重要的是要理解Sagemaker实验将如何度量我们随后用来比较模型的指标。这些指标的值是从模型训练期间生成的日志中收集的。这通常意味着训练脚本必须明确写出这些指标。</p><p id="47c8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在我们的例子中，我们将使用Huggingface的Trainer对象，它将负责为我们将指标写入日志。我们所要做的就是在<a class="ae kv" href="https://github.com/marshmellow77/sm-hf-experiments/blob/main/scripts/train.py" rel="noopener ugc nofollow" target="_blank">培训脚本</a>中定义指标。然后，培训师对象会自动将它们写到培训日志中(注意，损失指标是默认写出的，所有指标都带有前缀<em class="nb">“eval _”</em>):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">定义评估指标</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/de6234a59210a38cce6b7a5c73e87c9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bdK1U90T6GC2ppZb0s5S2w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">培训日志中的评估指标</p></figure><p id="497a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这意味着我们可以在培训工作期间通过正则表达式捕获这些指标，我们可以定义如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="9d47" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们将把它们传递给我们将在下面进一步创建的估算器，以捕获这些指标，这将允许我们比较不同的NLP模型。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="7111" class="kw kx iq bd ky kz mw lb lc ld mx lf lg jw my jx li jz mz ka lk kc na kd lm ln bi translated">运行Sagemaker实验</h1><p id="2f70" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">为了组织和跟踪模型，我们需要创建一个Sagemaker实验对象:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="3039" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">一旦完成，我们就可以开始训练了。我们使用<em class="nb"> ml.p3.2xlarge </em>进行Sagemaker培训工作，它将在大约30分钟内完成微调。注意，我们为每个培训作业创建了一个<a class="ae kv" href="https://sagemaker-experiments.readthedocs.io/en/latest/trial.html" rel="noopener ugc nofollow" target="_blank"> <em class="nb">试用</em> </a>对象。这些试验与我们上面创建的实验相关联，这将允许我们跟踪和比较模型:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="e417" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">上面的代码并行启动了两个培训任务(每个模型一个)。但是，如果您的帐户不允许这样做(可能您的AWS帐户限制了培训作业实例的数量)，您也可以按顺序运行这些培训作业。只要它们通过<em class="nb">试验</em>对象与同一个实验相关联，您就能够评估和比较这些模型。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="c638" class="kw kx iq bd ky kz mw lb lc ld mx lf lg jw my jx li jz mz ka lk kc na kd lm ln bi translated">比较模型</h1><p id="d311" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">大约30分钟后，两个模型都已训练完毕，现在是检索结果的时候了:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="e4aa" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">得到的数据帧包含了比较两个模型所需的所有信息。例如，我们可以检索我们定义的所有指标的平均值，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/fbcb6de26410e4c52033d7901b4f8319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EyWuyGYGndE5-g7MLi-MJA.png"/></div></div></figure><p id="2f16" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们可以看到，<em class="nb"> distilroberta-base </em>在<em class="nb">召回</em>方面表现稍好，而<em class="nb">distilbert-base-uncased</em>在<em class="nb"> F1得分</em>、<em class="nb">精度</em>和<em class="nb">准确度</em>方面表现更好。数据框架中还有更多列，我将留给读者进一步探索。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="d231" class="kw kx iq bd ky kz mw lb lc ld mx lf lg jw my jx li jz mz ka lk kc na kd lm ln bi translated">结论</h1><p id="ddb7" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在本文中，我们创建了一个Sagemaker实验来跟踪和比较NLP模型。我们为每个模型创建了试验，并收集了各种评估指标。在对模型进行微调之后，我们能够通过Pandas数据框架访问这些指标，并以一种方便的方式对模型进行比较。</p></div></div>    
</body>
</html>