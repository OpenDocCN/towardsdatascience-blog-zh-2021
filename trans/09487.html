<html>
<head>
<title>Running Airflow with Docker on EC2 + CI/CD with GitLab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Docker在EC2 + CI/CD上运行气流，使用GitLab</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/running-airflow-with-docker-on-ec2-ci-cd-with-gitlab-72326d4baeb4?source=collection_archive---------2-----------------------#2021-09-03">https://towardsdatascience.com/running-airflow-with-docker-on-ec2-ci-cd-with-gitlab-72326d4baeb4?source=collection_archive---------2-----------------------#2021-09-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9ec0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用基本命令创建简单的数据管道，并运行您自己的基于云的管道！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/7db376d7231093d0347cfdda51cb8944.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ev08pVDdUiqH38QR"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">约书亚·阿拉贡在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="33c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我已经学习数据科学一年了，但直到几周前，我仍然发现自己对工程方面完全一无所知。数据分析和人工智能是金字塔顶端的东西，需要强大的数据管道基础。在这篇文章中，我将分享我在尝试使用开源编排工具Airflow构建简单数据管道时学到的经验。这个orchestrator部署在Amazon EC2之上，利用GitLab的CI/CD来简化开发过程。好的，一个接一个，我们来谈谈每个术语的定义。</p><h2 id="d449" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">气流</h2><p id="f2f9" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">基于其网站，Airflow是一个由社区创建的“<em class="mq">平台，用于以编程方式创作、安排和监控工作流</em>数据工程师通常使用气流来协调工作流程和管道。假设一名数据工程师每天需要将数据从一个源移动到另一个目的地四次(例如，为了保持数据的新鲜)。他们可以使用Airflow自动运行脚本，按照特定的时间表运行，而不是手动完成该任务。Airflow还可以用于管理依赖关系、监控工作流执行和可视化工作流。</p><p id="6bb3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">气流需要安装在机器上。与其使用本地电脑，不如安装在基于云的主机上，提高可靠性。</p><h2 id="41db" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated"><strong class="ak">亚马逊EC2 </strong></h2><p id="9a43" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">Amazon EC2(代表弹性计算云)是由Amazon Web Services提供的基于云的租用计算机。EC2将充当主机，气流将在其上部署。EC2只是一台计算机，就像我们本地的笔记本电脑一样，但是这台计算机99%的时间都是运行的，由AWS团队管理。我们可以通过使用SSH在EC2机器的命令行界面中“挖隧道”。稍后，我们将学习如何使用SSH和git将代码从远程存储库部署到EC2。</p><h2 id="c143" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">码头工人</h2><p id="08af" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">Airflow不会直接安装在EC2本地机器上，而是安装在Docker容器内部。Docker是一组创建虚拟操作系统(称为容器)的平台。我们使用Docker来减少设置，因为所有设置都将由Docker映像的维护者(在本例中是气流贡献者)来管理。Docker映像包含<strong class="ky ir">应用程序代码、库、工具、依赖项和其他运行应用程序所需的文件</strong>。我们将从Docker image registry中提取一个图像，构建它，启动容器，并在里面运行Airflow。</p><h2 id="20ea" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">GitLab</h2><p id="61b1" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">GitLab将被用作我们的存储库和DevOps生命周期工具。实际上，在GitLab中有无数种方法可以利用CI/CD，但为了简单起见，我们将只使用“CD”部分。每次用户将任何分支合并到主分支时，都会触发部署脚本。部署管道由进入我们的EC2的SSH隧道组成，将主分支从GitLab存储库拉入EC2，将几个变量写入一个文件，并重建+重启Docker容器。</p><p id="fe9c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在深入细节之前，请查看<a class="ae kv" href="https://github.com/ammarchalifah/airflow-pipeline" rel="noopener ugc nofollow" target="_blank">这个库</a>，它包含了完整的代码库和我们将成功创建一个持续的气流部署管道的步骤摘要。好了，我们开始吧！</p></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h1 id="f6bc" class="my lt iq bd lu mz na nb lx nc nd ne ma jw nf jx md jz ng ka mg kc nh kd mj ni bi translated">安装</h1><h2 id="f10d" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">EC2</h2><p id="bcf9" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">访问AWS控制台，然后准备一个EC2实例。我推荐在ubuntu OS上使用instance，性能中等偏下。下载EC2实例的SSH密钥(通常以<code class="fe nj nk nl nm b">.pem</code>后缀结尾)，并记下实例的IP地址。然后，将您的实例配置为打开所有端口(至少打开端口8080以访问Airflow服务器)。最后，通过使用SSH键从命令行界面安装Docker和docker-compose来访问EC2。</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="a1f4" class="ls lt iq nm b gy nr ns l nt nu">ssh -i ssh-key.pem ubuntu@EC2_ADDRESS</span></pre><p id="803f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">【https://www.youtube.com/watch?v=YB_qanudIzA】EC2条款指南:<a class="ae kv" href="https://www.youtube.com/watch?v=YB_qanudIzA" rel="noopener ugc nofollow" target="_blank"/></p><h2 id="0cee" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">GitLab</h2><p id="8316" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在git lab(<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/gitlab.com">https://gitlab.com</a>)上注册并创建一个新项目。将内容从<a class="ae kv" href="https://github.com/ammarchalifah/airflow-pipeline" rel="noopener ugc nofollow" target="_blank"> github仓库</a>克隆到我们新的GitLab仓库。在用代码填充存储库之后，我们需要配置GitLab runner并设置存储库变量。GitLab runner用于执行我们在<code class="fe nj nk nl nm b">gitlab-ci.yml</code>中定义的CI/CD脚本。存储库变量用于存储敏感信息(如用户名、密码、EC2的IP地址和EC2的SSH密钥)。存储库变量作为环境变量加载到CI/CD管道中，在那里它可以作为变量/文件部署到服务器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/1ee2b031a8036307edffa8863ac5e451.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1MqFtfwnPVKhajonSkfDzQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">GitLab知识库的接口。图片作者。</p></figure><p id="4acd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">按照<a class="ae kv" href="https://docs.gitlab.com/runner/install/" rel="noopener ugc nofollow" target="_blank"> GitLab转轮配置指南</a>中的说明配置我们的转轮。对于我来说，我使用EC2实例和ubuntu OS来安装我的runner。如果您通过提供您的信用卡信息激活GitLab的免费试用，您就不必配置自己的跑步者，因为GitLab会为您提供一个共享的跑步者。</p><p id="a0f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> GitLab储存库变量</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/09060a015fbeca89b231a79d92faa878.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T8qTNOl0DL8L97Z_AOVIBg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">存储库变量—按作者分类的图像。</p></figure><p id="a3cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要设置六个存储库变量。进入<strong class="ky ir">设置&gt; CI/CD &gt;变量</strong>，点击<strong class="ky ir">展开</strong>，开始添加变量。</p><p id="0690" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">前两个是_AIRFLOW_WWW_USER_PASSWORD和_AIRFLOW_WWW_USER_USERNAME，它们将用于在部署AIRFLOW服务器后登录到该服务器。为这两个变量选择任意值。</p><p id="9289" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第二对是EC2_ADDRESS(您的EC2实例的IP地址)和SSH_KEY_EC2(您的EC2实例的SSH key，通常以<code class="fe nj nk nl nm b">.pem</code>后缀结尾)。这些值将用于访问您的EC2机器。将SSH_KEY_EC2设置为文件而不是变量。</p><p id="a8cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后一对是GITLAB_PASSWORD和GITLAB_USERNAME，用于从GITLAB存储库中提取提交的凭证。</p></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h1 id="3443" class="my lt iq bd lu mz na nb lx nc nd ne ma jw nf jx md jz ng ka mg kc nh kd mj ni bi translated">代码解释</h1><p id="824b" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">从下面的目录结构开始。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/e6e4f5b319ee7a20af25b20ba73f8cae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*Pdhnhk0eUQaDmSq8Z655hQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">这个项目的目录结构-作者图片。</p></figure><p id="c6ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">三个目录(Dag、日志和插件)是基本的气流目录。我们让日志和插件(几乎)为空，因为这些文件夹将在部署后被填满。我们希望自动化的脚本写在Dag内部，我们将在后面介绍。</p><p id="a983" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在对GitLab的回购进行任何推送的过程中，都会触发<code class="fe nj nk nl nm b">.gitlab-ci.yml</code>(定义CI/CD管道)中的脚本。该脚本执行一系列命令来将存储库部署到EC2。在EC2内部，我们将通过在<code class="fe nj nk nl nm b">docker-compose.yaml</code>上使用<code class="fe nj nk nl nm b">docker-compose up</code>来构建包含气流的Docker容器。</p><h2 id="2f6f" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">CI/CD管道</h2><p id="6e7b" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在变得更复杂之前，请先参考<a class="ae kv" href="https://docs.gitlab.com/ee/ci/quick_start/" rel="noopener ugc nofollow" target="_blank">本指南</a>了解什么是GitLab的CI/CD。</p><p id="a03a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">CI/CD管道在<code class="fe nj nk nl nm b">.gitlab-ci.yml</code>中定义。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="4495" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为我使用的GitLab runner使用Docker执行管道，所以默认图像在顶部指定。我使用<code class="fe nj nk nl nm b">ubuntu:latest</code>作为我的默认Docker图像。</p><p id="41a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如前所述，我们不会利用CI/CD的持续集成方面。我们只使用仅在主分支中触发的部署。这意味着所有推送到main之外的其他分支不会导致部署。</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="7e9b" class="ls lt iq nm b gy nr ns l nt nu">deploy-prod:<br/>  only:<br/>   - main<br/>  stage: deploy<br/>  before_script: ...<br/>  script: ...</span></pre><p id="0829" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nj nk nl nm b">deploy-prod</code>是我们管道的名称，它将只在主分支中运行。这个管道的阶段是部署阶段(与测试或构建等其他阶段不同)。命令在<code class="fe nj nk nl nm b">before_script</code>和<code class="fe nj nk nl nm b">script</code>中指定。</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="a666" class="ls lt iq nm b gy nr ns l nt nu">before_script:<br/>- ls -la<br/>- pwd<br/>- 'which ssh-agent || ( apt-get update -y &amp;&amp; apt-get install openssh-client -y )'<br/>- eval $(ssh-agent -s)<br/>- mkdir -p ~/.ssh<br/>- chmod 700 ~/.ssh<br/>- cat $SSH_KEY_EC2<br/>- echo "$(cat $SSH_KEY_EC2)" &gt;&gt; ~/.ssh/ssh-key.pem<br/>- chmod 400 ~/.ssh/ssh-key.pem<br/>- cat ~/.ssh/ssh-key.pem<br/>- echo -e "Host *\n\tStrictHostKeyChecking no\n\n" &gt; ~/.ssh/config<br/>- apt-get update -y<br/>- apt-get -y install rsync</span></pre><p id="43e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nj nk nl nm b">before_script</code>由几个命令组成，这些命令让我们的跑步者为部署做好准备。这些命令用于安装open-ssh、评估ssh-agent、将ssh密钥从存储库变量转储到文件、更改ssh密钥的权限、设置SSH配置以及安装rsync。</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="59e5" class="ls lt iq nm b gy nr ns l nt nu">ssh -i ~/.ssh/ssh-key.pem ubuntu@$EC2_ADDRESS \<br/>'git config --global --replace-all user.name "Full Name"<br/>&amp;&amp; git config --global --replace-all user.email "email@email.com"<br/>'</span></pre><p id="9413" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nj nk nl nm b">script</code>部分分为三个部分。每个部分都是从进入EC2的ssh隧道开始的。第一部分用于设置git config，使用您的全名和电子邮件作为全局配置。</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="3ab2" class="ls lt iq nm b gy nr ns l nt nu">ssh -i ~/.ssh/ssh-key.pem ubuntu@$EC2_ADDRESS \<br/>'<br/>if [ -d airflow-pipeline ];<br/>then cd airflow-pipeline<br/>&amp;&amp; git status<br/>&amp;&amp; git restore .env<br/>&amp;&amp; git pull --rebase<br/>&amp;&amp; git status<br/>&amp;&amp; sed -i s:%AIRFLOW_UID%:'"$(id -u)"':g .env<br/>&amp;&amp; sed -i s:%AIRFLOW_GID%:0:g .env<br/>&amp;&amp; sed -i s:%_AIRFLOW_WWW_USER_USERNAME%:'"$_AIRFLOW_WWW_USER_USERNAME"':g .env<br/>&amp;&amp; sed -i s:%_AIRFLOW_WWW_USER_PASSWORD%:'"$_AIRFLOW_WWW_USER_PASSWORD"':g .env<br/>else git clone https://'"$GITLAB_USERNAME"':'"$GITLAB_PASSWORD"'@gitlab.com/gitlab-group/gitlab-project.git<br/>&amp;&amp; cd airflow-pipeline<br/>&amp;&amp; ls -la<br/>&amp;&amp; chmod 777 logs<br/>&amp;&amp; sed -i s:%AIRFLOW_UID%:'"$(id -u)"':g .env<br/>&amp;&amp; sed -i s:%AIRFLOW_GID%:0:g .env<br/>&amp;&amp; sed -i s:%_AIRFLOW_WWW_USER_USERNAME%:'"$_AIRFLOW_WWW_USER_USERNAME"':g .env<br/>&amp;&amp; sed -i s:%_AIRFLOW_WWW_USER_PASSWORD%:'"$_AIRFLOW_WWW_USER_PASSWORD"':g .env<br/>&amp;&amp; docker-compose up airflow-init;<br/>fi'</span></pre><p id="4546" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第二部分用于从GitLab存储库中的主分支提取变更，并将环境变量写入<code class="fe nj nk nl nm b">.env</code>文件。这里我们使用基于EC2主目录上目录存在的条件。如果我们之前已经克隆了GitLab存储库，我们只执行了:从<code class="fe nj nk nl nm b">.env</code>文件中恢复所有更改，从远程GitLab存储库中提取更改，并将环境变量写入<code class="fe nj nk nl nm b">.env</code>。如果还没有，我们首先克隆存储库，然后将环境变量写入<code class="fe nj nk nl nm b">.env</code>文件，并启动Docker容器。</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="515b" class="ls lt iq nm b gy nr ns l nt nu">ssh -i ~/.ssh/ssh-key.pem ubuntu@$EC2_ADDRESS \<br/>'cd airflow-pipeline &amp;&amp;<br/>if [ docker ps | grep -q keyword ];<br/>then docker-compose down &amp;&amp; docker-compose up -d --build;<br/>else docker-compose up -d --build;<br/>fi;'</span></pre><p id="b306" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最新的部分用于重新启动Docker以合并新的更改。</p><p id="891c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可以在GitLab的<strong class="ky ir"> CI/CD &gt;管道</strong>上监控CI/CD管道。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/2af43360bd2f4306a976e43cc78e89b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oKMZDswnPO7tIwOMbxhCOw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">GitLab CI/CD管道—图片由作者提供。</p></figure><p id="df9a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果一切顺利，你的气流网络服务器将准备就绪。在浏览器上点击<code class="fe nj nk nl nm b">https://{EC2_ADDRESS}:8080</code>进入用户界面。使用之前在存储库变量上设置的Airflow用户名和密码登录。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/1c59d3efdafbbcf44b15f1a4597fefca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YDZDU8K7sUbl-TWpJj5qNw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Airflow webserver登录页面—作者图片。</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/bc8dfa7fe40d23c3d38f5b15101a69c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cm-F-m1KR6P2h5z-HFMo4w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Airflow webserver的界面—图片由作者提供。</p></figure><p id="8721" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">稍后，您希望自动化的任何脚本都可以写在DAG(或<em class="mq">有向无环图，</em>没有有向循环的有向图)中。DAG内的任务被框定为图的节点，其中可以定义依赖性。<strong class="ky ir">存储库中的任何更改都可以通过将更改推送到GitLab存储库、合并到主分支(或直接推送到主分支)并等待CI/CD管道成功来部署。</strong></p><p id="129d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以在DAG中定义许多东西，例如数据接收任务、数据查询任务、发送自动电子邮件、抓取数据、进行API调用等。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/200cd78a9fe47a27f85b3ca162cec8b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sqThaggrenKF9VARd69CIQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">DAG中的依赖关系可视化—按作者排序的图像</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/a939e6bd296ed74d1b8e2c09a73cff17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0PdyKBudnfOhF0iCL8erjg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">DAG中的任务监控—按作者排列的图像</p></figure><h2 id="90ad" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">为什么指定。gitignore？</h2><p id="cdd4" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">不建议在本地记录气流活动。然而，由于时间和成本的限制，我在本地记录所有的活动，尤其是在<code class="fe nj nk nl nm b">/logs</code>目录下。除了日志，DAG执行还会在<code class="fe nj nk nl nm b">/dags/__pycache__/</code>中创建缓存。因此，我通过使用<code class="fe nj nk nl nm b">.gitignore</code>忽略了那些文件，以安全地提取更改，而不会导致冲突。</p><h2 id="53a4" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">EC2检验</h2><p id="b51c" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">如果出现任何问题，您总是可以通过使用SSH键来检查EC2内部发生了什么。</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="f5e3" class="ls lt iq nm b gy nr ns l nt nu">ssh -i ssh-key.pem ubuntu@EC2_ADDRESS</span></pre><p id="3a1b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">删除未使用的文件，未使用的Docker图像，或从内部进行任何调整！</p></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h2 id="6f19" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated"><strong class="ak">参考文献</strong></h2><p id="f482" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">[1]<a class="ae kv" href="https://airflow.apache.org/" rel="noopener ugc nofollow" target="_blank">https://airflow.apache.org/</a><br/>【2】<a class="ae kv" href="https://aws.amazon.com/ec2/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/ec2/</a><br/>【3】<a class="ae kv" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank">https://www.docker.com/</a><br/>【4】<a class="ae kv" href="https://about.gitlab.com/" rel="noopener ugc nofollow" target="_blank">https://about.gitlab.com/</a><br/>【5】<a class="ae kv" href="https://airflow.apache.org/docs/apache-airflow/stable/start/docker.html" rel="noopener ugc nofollow" target="_blank">https://air flow . Apache . org/docs/Apache-air flow/stable/start/docker . html</a><br/>【6】Bunga Amalia K关于设置GitLab runner的代码参考</p></div></div>    
</body>
</html>