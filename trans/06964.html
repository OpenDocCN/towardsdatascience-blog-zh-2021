<html>
<head>
<title>Drugs NER using spaCy in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">药物NER使用Python中的空间</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/drugs-ner-using-spacy-in-python-f1f3091f8f4e?source=collection_archive---------13-----------------------#2021-06-24">https://towardsdatascience.com/drugs-ner-using-spacy-in-python-f1f3091f8f4e?source=collection_archive---------13-----------------------#2021-06-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f73f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">训练您自己的自定义NER组件来检测药品名称</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4c9628ed738bab4839309897f8513d2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v9ZTNjrwLM3Ea01YxOE9qw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com/s/photos/drug?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae ky" href="https://unsplash.com/@myriamzilles?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Myriam Zilles </a>拍摄的照片</p></figure><p id="e8fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以前，我写过一篇关于使用Python 中的spaCy进行<a class="ae ky" rel="noopener" target="_blank" href="/sarcasm-text-classification-using-spacy-in-python-7cd39074f32e">讽刺文本分类的文章。在本文中，您将了解更多关于命名实体识别(NER)组件的内容。</a></p><p id="dcd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">供您参考，NER是NLP任务的一部分，用于定位非结构化文本中的实体并将其分类到不同的类别中。例如，给定以下句子:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="e2d2" class="ma mb it lw b gy mc md l me mf">John Doe bought 100 shares of Apple in 2020.</span></pre><p id="f72b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">NER模型预计将确定以下实体及其相应的类别:</p><ul class=""><li id="6e58" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated">无名氏</li><li id="f0aa" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">苹果公司(组织)</li><li id="f376" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">2020年(时间)</li></ul><p id="67e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程着重于训练一个自定义NER组件来识别药品名称。您可以很容易地修改它，使之适应您自己的用例。设置和训练过程是相同的，唯一的例外是数据集。</p><p id="25ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们继续下一节，开始安装必要的软件包。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="5cb0" class="nb mb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">设置</h1><p id="0c16" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">在继续之前，强烈建议您设置一个虚拟环境。</p><h2 id="8a75" class="ma mb it bd nc nx ny dn ng nz oa dp nk li ob oc nm lm od oe no lq of og nq oh bi translated">宽大的</h2><p id="0f1e" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">您可以通过多种方式安装空间<a class="ae ky" href="https://spacy.io/usage" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="217a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过<code class="fe oi oj ok lw b">pip install</code>轻松安装，如下所示:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1147" class="ma mb it lw b gy mc md l me mf">pip install -U spacy</span></pre><p id="625e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，您可以通过<code class="fe oi oj ok lw b">conda</code>安装:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a728" class="ma mb it lw b gy mc md l me mf">conda install -c conda-forge spacy</span></pre><h2 id="2d82" class="ma mb it bd nc nx ny dn ng nz oa dp nk li ob oc nm lm od oe no lq of og nq oh bi translated">资料组</h2><p id="ba34" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">该数据集基于<a class="ae ky" href="https://files.pushshift.io/reddit/comments/" rel="noopener ugc nofollow" target="_blank"> Reddit评论</a>中的药物名称，由spaCy开发者创建，作为示例项目的一部分。</p><p id="b014" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个名为<code class="fe oi oj ok lw b">assets</code>的新文件夹，并从下面的存储库中下载相关的数据集:</p><ul class=""><li id="1f02" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated"><a class="ae ky" href="https://github.com/explosion/projects/blob/v3/tutorials/ner_drugs/assets/drugs_eval.jsonl" rel="noopener ugc nofollow" target="_blank">药物评价数据集</a></li><li id="42a3" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated"><a class="ae ky" href="https://github.com/explosion/projects/blob/v3/tutorials/ner_drugs/assets/drugs_training.jsonl" rel="noopener ugc nofollow" target="_blank">药物训练数据集</a></li></ul><p id="5b7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将两个数据集放置在资产文件夹中，如下所示:</p><ul class=""><li id="7e53" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated">drugs_eval.jsonl</li><li id="9c14" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">drugs_train.jsonl</li></ul><p id="910a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两个文件都基于JSONL格式，每个数据点都包含以下重要字段:</p><ul class=""><li id="595c" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">text</code> —原弦。</li><li id="b1ce" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">tokens</code> —表示标记化单词的词典列表。</li><li id="02d0" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">spans</code> —标记实体的字典列表。每个条目包含开始索引、结束索引、开始令牌的id、结束令牌的id和标签注释。</li></ul><p id="723b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是单个数据点的示例:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6d8b" class="ma mb it lw b gy mc md l me mf">{<br/>  "text": "Idk if that Xanax or ur just an ass hole",<br/>  "tokens": [<br/>    { "text": "Idk", "start": 0, "end": 3, "id": 0 },<br/>    { "text": "if", "start": 4, "end": 6, "id": 1 },<br/>    { "text": "that", "start": 7, "end": 11, "id": 2 },<br/>    { "text": "Xanax", "start": 12, "end": 17, "id": 3 },<br/>    { "text": "or", "start": 18, "end": 20, "id": 4 },<br/>    { "text": "ur", "start": 21, "end": 23, "id": 5 },<br/>    { "text": "just", "start": 24, "end": 28, "id": 6 },<br/>    { "text": "an", "start": 29, "end": 31, "id": 7 },<br/>    { "text": "ass", "start": 32, "end": 35, "id": 8 },<br/>    { "text": "hole", "start": 36, "end": 40, "id": 9 }<br/>  ],<br/>  "spans": [<br/>    {<br/>      "start": 12,<br/>      "end": 17,<br/>      "token_start": 3,<br/>      "token_end": 3,<br/>      "label": "DRUG"<br/>    }<br/>  ],<br/>  "_input_hash": -2128862848,<br/>  "_task_hash": -334208479,<br/>  "answer": "accept"<br/>}</span></pre><p id="1e3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在构建自己的数据集时，您可以放心地忽略其他字段。相比之下，与文本分类相比，为NER构建数据集要繁琐得多。</p><h2 id="1694" class="ma mb it bd nc nx ny dn ng nz oa dp nk li ob oc nm lm od oe no lq of og nq oh bi translated">预处理脚本</h2><p id="5edb" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">此外，您将需要一个预处理脚本来将JSONL数据集转换为spaCy二进制格式以进行训练。在工作目录中创建一个名为<code class="fe oi oj ok lw b">scripts</code>的新文件夹。</p><p id="c9ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，创建一个名为<code class="fe oi oj ok lw b">preprocess.py</code>的新Python文件，并在其中添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><h2 id="f56d" class="ma mb it bd nc nx ny dn ng nz oa dp nk li ob oc nm lm od oe no lq of og nq oh bi translated">配置文件</h2><p id="7356" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">之后，在您的工作目录中创建另一个新文件夹，并将其命名为<code class="fe oi oj ok lw b">configs</code>。在其中，创建一个名为<code class="fe oi oj ok lw b">config.conf</code>的新配置文件，并在文件中添加以下代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="8766" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它包含项目的所有相关配置。您可以修改的几个关键区域在<code class="fe oi oj ok lw b">training</code>部分:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4475" class="ma mb it lw b gy mc md l me mf">[training]<br/>...<br/>patience = 1600<br/>max_epochs = 0<br/>max_steps = 20000<br/>eval_frequency = 200<br/>...</span></pre><ul class=""><li id="8996" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">patience</code> —早期停止机制无改善的步数。在这种情况下，如果1600步后分数没有提高，它将停止训练。</li><li id="cd60" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">max_epochs</code> —训练时期的最大数量。</li><li id="5e94" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">max_steps</code> —最大训练步数。</li><li id="e195" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">eval_frequency</code> —每次评估的步骤数。在这种情况下，它将每200步评估一次模型。</li></ul><p id="7afe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，您可以在<code class="fe oi oj ok lw b">training.score_weights</code>部分更改首选评分标准。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="be45" class="ma mb it lw b gy mc md l me mf">[training.score_weights]<br/>ents_per_type = null<br/>ents_f = 1.0<br/>ents_p = 0.0<br/>ents_r = 0.0</span></pre><p id="5e24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当前设置基于最佳<code class="fe oi oj ok lw b">f-score</code>。如果您更喜欢拥有一辆性能良好的<code class="fe oi oj ok lw b">precision</code>NER车型，而不考虑召回，您可以对其进行如下调整:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="fcef" class="ma mb it lw b gy mc md l me mf">[training.score_weights]<br/>ents_per_type = null<br/>ents_f = 0.0<br/>ents_p = 1.0<br/>ents_r = 0.0</span></pre><h2 id="049b" class="ma mb it bd nc nx ny dn ng nz oa dp nk li ob oc nm lm od oe no lq of og nq oh bi translated">项目文件</h2><p id="67b6" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">拼图的最后一块是项目文件。在同一个工作目录中，创建一个名为<code class="fe oi oj ok lw b">project.yml</code>的新文件，并用以下代码填充它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="7761" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">项目文件包含以下详细信息:</p><ul class=""><li id="ba80" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated">与项目相关的元数据</li><li id="66e6" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">命令</li><li id="8103" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">工作流程</li></ul><p id="e242" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只需根据自己的需求对它们进行修改。例如，在训练模型时，您可以指定不同的<code class="fe oi oj ok lw b">version</code>。因此，spaCy将使用给定的<code class="fe oi oj ok lw b">version</code>对输出进行后缀。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f01f" class="ma mb it lw b gy mc md l me mf">vars:<br/>  config: "config.conf"<br/>  name: "ner_drugs"<br/>  version: "0.0.0"<br/>  train: "drugs_train.jsonl"<br/>  dev: "drugs_eval.jsonl"</span></pre><p id="1a4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您打算为配置文件和数据集使用不同的名称，请在<code class="fe oi oj ok lw b">vars.train</code>和<code class="fe oi oj ok lw b">vars.dev</code>对其进行相应的修改。</p><p id="5229" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，命令是预定义的动作，可以通过以下方式触发:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="80c2" class="ma mb it lw b gy mc md l me mf">spacy project run [command]</span></pre><p id="8072" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，项目包含以下命令:</p><ul class=""><li id="27d4" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">preprocess</code> —将数据转换为spaCy的二进制格式。</li><li id="67fd" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">training</code> —训练NER模型。</li><li id="a1da" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">evaluate</code> —评估模型并导出相关指标。</li><li id="42f8" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">package</code> —将训练好的模型打包成Python包。</li></ul><p id="04e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要单独运行<code class="fe oi oj ok lw b">preprocess</code>，只需使用以下命令:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="76d8" class="ma mb it lw b gy mc md l me mf">spacy project run preprocess</span></pre><p id="6398" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除此之外，您还可以使用workflow将一些命令分组为一个包，如下所示:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="e12d" class="ma mb it lw b gy mc md l me mf">workflows:<br/>  all:<br/>    - preprocess<br/>    - train<br/>    - evaluate<br/>    - package</span></pre><p id="9803" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过以下命令运行上面的工作流:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2af3" class="ma mb it lw b gy mc md l me mf">spacy project run all</span></pre><p id="778c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它将按顺序运行所有指定的命令。在这种情况下，它将首先运行<code class="fe oi oj ok lw b">preprocess</code>命令，并以<code class="fe oi oj ok lw b">package</code>命令结束。</p><p id="d5e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你完成了它，就可以进入下一部分进行实现了。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="8449" class="nb mb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">履行</h1><p id="6926" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">让我们利用您之前创建的命令来训练这个模型。</p><h2 id="4520" class="ma mb it bd nc nx ny dn ng nz oa dp nk li ob oc nm lm od oe no lq of og nq oh bi translated">使用工作流</h2><p id="339b" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">让我们使用工作流来为您完成这些技巧，而不是一个一个地运行所有的命令。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="2107" class="ma mb it lw b gy mc md l me mf">spacy project run all</span></pre><p id="6c80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它将执行以下操作:</p><ul class=""><li id="e6d5" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated">将数据转换为空间二进制格式</li><li id="810a" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">训练模型</li><li id="2481" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">评估训练最好的模型</li><li id="41b1" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">将训练好的模型打包成Python模块</li></ul><h2 id="8252" class="ma mb it bd nc nx ny dn ng nz oa dp nk li ob oc nm lm od oe no lq of og nq oh bi translated">检查文件夹</h2><p id="3a9e" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">在实际训练过程之前，它将检查并创建以下文件夹(如果不存在):</p><ul class=""><li id="f720" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated">资产</li><li id="d2cb" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">文集</li><li id="8b5f" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">配置</li><li id="c029" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">培养</li><li id="ab42" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">剧本</li><li id="60bf" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">包装</li></ul><h2 id="b62e" class="ma mb it bd nc nx ny dn ng nz oa dp nk li ob oc nm lm od oe no lq of og nq oh bi translated">预处理数据集</h2><p id="5b6a" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated"><code class="fe oi oj ok lw b">preprocess</code>命令将加载您的JSONL数据集，并将其转换为<code class="fe oi oj ok lw b">corpus</code>文件夹中空间所需的二进制格式。您应该得到以下文件:</p><ul class=""><li id="a916" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated">drug_eval.jsonl.spacy</li><li id="8b74" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">drug_train.jsonl.spacy</li></ul><h2 id="00a1" class="ma mb it bd nc nx ny dn ng nz oa dp nk li ob oc nm lm od oe no lq of og nq oh bi translated">训练模型</h2><p id="4e09" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">一旦预处理步骤完成，它将初始化所需的管道组件<code class="fe oi oj ok lw b">tok2vec </code>和<code class="fe oi oj ok lw b">ner</code>:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="7c0a" class="ma mb it lw b gy mc md l me mf">=========================== Initializing pipeline ===========================←[0m<br/>[2021-06-24 16:36:47,013] [INFO] Set up nlp object from config<br/>[2021-06-24 16:36:47,024] [INFO] Pipeline: ['tok2vec', 'ner']<br/>[2021-06-24 16:36:47,029] [INFO] Created vocabulary<br/>[2021-06-24 16:36:47,029] [INFO] Finished initializing nlp object<br/>[2021-06-24 16:36:47,545] [INFO] Initialized pipeline components: ['tok2vec', 'ner']<br/>✔ Initialized pipeline</span></pre><p id="f31e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，spaCy会在定型模型之前将整个数据集加载到内存中。如果您有一个大型数据集，该过程可能需要一段时间。随着训练的进行，您应该会在控制台中看到以下输出:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="c2f7" class="ma mb it lw b gy mc md l me mf">============================= Training pipeline =============================←[0m<br/>ℹ Pipeline: ['tok2vec', 'ner']<br/>ℹ Initial learn rate: 0.0<br/>E    #       LOSS TOK2VEC  LOSS NER  ENTS_F  ENTS_P  ENTS_R  SCORE<br/>---  ------  ------------  --------  ------  ------  ------  ------<br/>  0       0          0.00     45.83    0.23    0.20    0.28    0.00<br/>  0     200          9.60  15156.42    0.00    0.00    0.00    0.00<br/>  0     400         21.03   1491.74    0.00    0.00    0.00    0.00<br/>  1     600         13.16    836.43    0.00    0.00    0.00    0.00<br/>  1     800         22.12   1227.63    0.00    0.00    0.00    0.00<br/>  2    1000         26.70   1117.34   20.34   82.35   11.60    0.20<br/>  3    1200         43.24   1095.54   46.64   81.94   32.60    0.47<br/>  4    1400         67.99   1048.39   59.73   78.12   48.34    0.60<br/>  5    1600         94.88   1039.05   65.81   78.03   56.91    0.66</span></pre><ul class=""><li id="9a60" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">LOSS TOK2VEC </code>—<code class="fe oi oj ok lw b">tok2vec</code>组件的损耗值。</li><li id="51b1" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">LOSS NER</code>—<code class="fe oi oj ok lw b">ner</code>组件的损耗值。</li><li id="be12" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">ENTS_F</code> — f值从0到100。</li><li id="9dd6" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">ENTS_P</code> —精度分数从0到100。</li><li id="454b" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">ENTS_R</code> —回忆分数从0到100。</li><li id="6b1a" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">SCORE</code>—0.0-1.0分，小数点后两位(四舍五入)。它基于您在<code class="fe oi oj ok lw b">config.conf</code>中定义的<code class="fe oi oj ok lw b">training.score_weights</code>。</li></ul><p id="5dad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">训练将继续进行，直到满足以下任一条件:</p><ul class=""><li id="b542" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated">达到了定义的<code class="fe oi oj ok lw b">max_epochs</code></li><li id="85c8" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">达到了定义的<code class="fe oi oj ok lw b">max_steps</code></li><li id="b6ed" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">达到规定的<code class="fe oi oj ok lw b">patience</code>(分数没有任何提高的步数)</li></ul><p id="85ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，将最佳模型和最后模型保存在<code class="fe oi oj ok lw b">training</code>文件夹中。</p><h2 id="d90b" class="ma mb it bd nc nx ny dn ng nz oa dp nk li ob oc nm lm od oe no lq of og nq oh bi translated">模型评估</h2><p id="12fa" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">工作流中的下一个命令是<code class="fe oi oj ok lw b">evaluate</code>命令，它使用最佳模型计算指标。结果将作为<code class="fe oi oj ok lw b">metrics.json</code>导出到<code class="fe oi oj ok lw b">training</code>文件夹中。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="20b9" class="ma mb it lw b gy mc md l me mf">{<br/>  "token_acc":0.9999332072,<br/>  "ents_p":0.7820895522,<br/>  "ents_r":0.7237569061,<br/>  "ents_f":0.7517934003,<br/>  "speed":22459.7479096054,<br/>  "ents_per_type":{<br/>    "DRUG":{<br/>      "p":0.7820895522,<br/>      "r":0.7237569061,<br/>      "f":0.7517934003<br/>    }<br/>  }<br/>}</span></pre><ul class=""><li id="c992" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">p</code> —表示精度值</li><li id="d0da" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">r</code> —代表召回值</li><li id="3919" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated"><code class="fe oi oj ok lw b">f</code>—f1值</li></ul><h2 id="8d55" class="ma mb it bd nc nx ny dn ng nz oa dp nk li ob oc nm lm od oe no lq of og nq oh bi translated">打包模型</h2><p id="bd8a" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">最后一步是把最好的模型打包成Python包。它会将打包的模型保存在<code class="fe oi oj ok lw b">packages</code>文件夹中，如下所示:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f2b5" class="ma mb it lw b gy mc md l me mf">en_ner_drugs-0.0.0</span></pre><p id="b2d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您打开它时，您会找到以下文件和文件夹:</p><ul class=""><li id="4cee" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated">距离</li><li id="cb6a" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">能量药物</li><li id="9143" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">en_ner_drugs.egg-info</li><li id="86e4" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">清单. in</li><li id="3ae8" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">meta.json</li><li id="78cd" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">setup.py</li></ul><h2 id="7e2e" class="ma mb it bd nc nx ny dn ng nz oa dp nk li ob oc nm lm od oe no lq of og nq oh bi translated">将模型部署为Python包</h2><p id="07d2" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">通过在<code class="fe oi oj ok lw b">setup.py</code>所在的目录中运行以下命令，您可以很容易地将它作为Python包安装在您的虚拟环境中。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6224" class="ma mb it lw b gy mc md l me mf">python setup.py</span></pre><p id="3a5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不仅如此，你还可以复制出<code class="fe oi oj ok lw b">en_ner_drugs</code>文件夹，把它当作一个普通的Python模块。只需将它放在Python应用程序的同一个目录中，并按如下方式正常调用它:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="5948" class="ma mb it lw b gy mc md l me mf">import <!-- -->en_ner_drugs</span><span id="362d" class="ma mb it lw b gy on md l me mf">nlp = <!-- -->en_ner_drugs<!-- -->.load()</span></pre><p id="1b04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，您可以通过传入以下文件路径来使用spacy进行加载:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ac78" class="ma mb it lw b gy mc md l me mf">import <!-- -->spacy</span><span id="4901" class="ma mb it lw b gy on md l me mf">nlp = spacy.load('en_ner_drugs/en_ner_drugs-0.0.0')</span></pre><p id="6852" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">模型加载后，您可以在任何文本上运行它，如下所示:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8673" class="ma mb it lw b gy mc md l me mf">doc = nlp("This is a text")</span></pre><p id="e12c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出是一个空间的Doc对象，它包含代表实体的<code class="fe oi oj ok lw b">ents</code>属性。您可以用下面的代码调用它:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="4d72" class="ma mb it lw b gy mc md l me mf">doc.ents</span></pre><p id="7a81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当处理大量文本时，您应该使用<code class="fe oi oj ok lw b">pipe</code>批量运行它:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8c83" class="ma mb it lw b gy mc md l me mf">texts = ["This is a text", "These are lots of texts", "..."]</span><span id="b556" class="ma mb it lw b gy on md l me mf"># bad<br/>docs = [nlp(text) for text in texts]</span><span id="85d9" class="ma mb it lw b gy on md l me mf"># good<br/>docs = list(nlp.pipe(texts))</span></pre><p id="5782" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请看下面的代码片段，它说明了如何在Python应用程序中使用该模型来获得药品名称的相关NER。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="a6d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行该脚本时，您应该会在控制台上看到以下输出。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="527c" class="ma mb it lw b gy mc md l me mf">promethazine DRUG<br/>weed DRUG<br/>heroin DRUG</span></pre></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="13df" class="nb mb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">结论</h1><p id="dde9" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">让我们回顾一下你今天所学的内容。</p><p id="d202" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章首先简要介绍了命名实体识别(NER)。</p><p id="4e67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，通过<code class="fe oi oj ok lw b">pip</code>或<code class="fe oi oj ok lw b">conda</code>安装空间。此外，还提供了训练和评估数据集作为链接。</p><p id="7e79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，对整个实现过程进行了说明，包括将JSONL格式的数据集预处理为spaCy的二进制格式、训练模型、模型评估以及将最佳模型打包为Python包。</p><p id="e4c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，它提供了一个关于Python部署以及如何获取相关实体及其相应标签的示例。</p><p id="7992" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读这篇文章。希望在下一个教程中再见到你！</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="19b7" class="nb mb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">参考</h1><h1 id="34f9" class="nb mb it bd nc nd oo nf ng nh op nj nk jz oq ka nm kc or kd no kf os kg nq nr bi translated">参考</h1><ol class=""><li id="1d83" class="mg mh it lb b lc ns lf nt li ot lm ou lq ov lu ow mm mn mo bi translated"><a class="ae ky" href="https://spacy.io/usage/linguistic-features#named-entities" rel="noopener ugc nofollow" target="_blank">空间——命名实体</a></li><li id="832e" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ow mm mn mo bi translated"><a class="ae ky" href="https://spacy.io/api/architectures#parser" rel="noopener ugc nofollow" target="_blank"> spaCy —解析器和NER </a></li><li id="6f2b" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ow mm mn mo bi translated"><a class="ae ky" href="https://github.com/explosion/projects/tree/v3/tutorials/ner_drugs" rel="noopener ugc nofollow" target="_blank"> spaCy Github — NER药品</a></li></ol></div></div>    
</body>
</html>