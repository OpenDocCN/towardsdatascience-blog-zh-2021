<html>
<head>
<title>The Reusable Python Logging Template For All Your Data Science Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">适用于所有数据科学应用的可重复使用的Python日志模板</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-reusable-python-logging-template-for-all-your-data-science-apps-551697c8540?source=collection_archive---------4-----------------------#2021-05-09">https://towardsdatascience.com/the-reusable-python-logging-template-for-all-your-data-science-apps-551697c8540?source=collection_archive---------4-----------------------#2021-05-09</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="29e7" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">不要使用print()或默认的root logger，像专业人士一样设置项目级日志记录。</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/b3007840f6fa0d9d0dd55f438bf5716a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bdlmRnA57cCJeNp1"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">汤姆·莫比在Unsplash<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">上的照片</a></p></figure><p id="df5d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">调试和跟踪应用程序执行的最佳方式是通过定义明确、信息丰富且结构方便的日志。 </p><p id="f34e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">它们是任何编程语言中的任何小型、中型或大型项目的基本组件，而不仅仅是Python。</p><p id="c685" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">几年前我开始使用Python日志库，从那以后，我一直在网上查阅无数教程和文章，学习如何有效地使用它，并为我的项目提供最佳设置。</p><p id="06c4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">他们都擅长解释如何为单个Python脚本设置日志系统。然而，几乎不可能找到一个解释如何设置Python日志库以便在应用程序范围内使用，以及如何在所有项目模块中恰当地集成和共享日志信息的工具。</p><p id="f669" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这篇文章中，我将分享我的个人日志模板，你可以很容易地用于任何项目的多个模块。</p><blockquote class="lx ly lz"><p id="eb79" class="la lb lw lc b ld le jv lf lg lh jy li ma lk ll lm mb lo lp lq mc ls lt lu lv in bi translated">我假设你已经了解了日志的基本知识。就像我说的，有很多好文章可以借鉴。</p></blockquote><p id="d9b9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">好吧，我们言归正传！👇</p><h1 id="eee2" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">制作一个简单的Python项目</h1><p id="2616" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">解释一个新概念时，首先应该用简单的术语，不要把注意力转移到背景信息上。记住这一点，现在让我们继续初始化一个简单的项目，好吗？</p><p id="1cfd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">创建一个名为“<strong class="lc iv"> MyAwesomeProject </strong>的文件夹。在其中，创建一个名为<code class="fe na nb nc nd b">app.py</code>的新Python文件。这将是我们应用的起点。我将使用这个项目来构建一个简单的工作示例的模板，我正在谈论。</p><p id="f818" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">继续在<strong class="lc iv"> VSCode </strong>(或者任何你喜欢的编辑器)中打开你的项目。</p><p id="bbba" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，让我们为应用程序级日志设置创建一个新模块。我们称它为<strong class="lc iv">记录器</strong>。</p><p id="f3e5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们已经完成了这一部分。</p><h1 id="b846" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">创建应用程序级记录器</h1><p id="ddc6" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">这是我们模板的主要部分。我们创建一个名为<strong class="lc iv"> logger.py </strong>的新文件。</p><p id="8529" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们定义一个根日志记录器，并用它来初始化我们的应用程序级日志记录器。是写代码的时候了！</p><p id="31c2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">一些导入和我们的应用程序名称:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="c8a0" class="ni me iu nd b gz nj nk l nl nm"><em class="lw">import</em> logging</span><span id="80aa" class="ni me iu nd b gz nn nk l nl nm"><em class="lw">import</em> sys</span><span id="6ddf" class="ni me iu nd b gz nn nk l nl nm">APP_LOGGER_NAME = 'MyAwesomeApp'</span></pre><p id="7a23" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们将在我们的<strong class="lc iv"> app.py </strong>中调用的函数:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="d777" class="ni me iu nd b gz nj nk l nl nm">def setup_applevel_logger(<em class="lw">logger_name</em> = APP_LOGGER_NAME, <em class="lw">file_name</em>=None): </span><span id="c9ea" class="ni me iu nd b gz nn nk l nl nm">    logger = logging.getLogger(logger_name)</span><span id="a765" class="ni me iu nd b gz nn nk l nl nm">    logger.setLevel(logging.DEBUG)</span><span id="a818" class="ni me iu nd b gz nn nk l nl nm">    formatter = logging.Formatter("%(asctime)s - %(name)s - %(levelname)s - %(message)s")</span><span id="52c9" class="ni me iu nd b gz nn nk l nl nm">    sh = logging.StreamHandler(sys.stdout)<br/>    sh.setFormatter(formatter)</span><span id="b66f" class="ni me iu nd b gz nn nk l nl nm">    logger.handlers.clear()<br/>    logger.addHandler(sh)</span><span id="3dac" class="ni me iu nd b gz nn nk l nl nm"><em class="lw">    if</em> file_name:</span><span id="f869" class="ni me iu nd b gz nn nk l nl nm">        fh = logging.FileHandler(file_name)</span><span id="259f" class="ni me iu nd b gz nn nk l nl nm">        fh.setFormatter(formatter)</span><span id="dd28" class="ni me iu nd b gz nn nk l nl nm">        logger.addHandler(fh)</span><span id="2d95" class="ni me iu nd b gz nn nk l nl nm"><em class="lw">    return</em> logger</span></pre><p id="c26f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们将使用预定义的<strong class="lc iv">调试</strong>级别来定义我们的日志记录器，并使用<strong class="lc iv">格式化程序</strong>来构造我们的日志消息。然后，我们将它分配给我们的流处理程序，以便将消息写入控制台。</p><p id="da34" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">接下来，我们还要确保包含一个文件，我们可以在其中额外存储我们所有的日志消息。这是通过日志<strong class="lc iv">文件处理器</strong>完成的。</p><p id="d6dd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最后，我们返回记录器。</p><p id="adf2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">需要另一个函数来确保我们的模块可以在需要时调用记录器。定义一个<strong class="lc iv"> get_logger </strong>函数。</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="0437" class="ni me iu nd b gz nj nk l nl nm">def get_logger(<em class="lw">module_name</em>):<em class="lw">    <br/>   return </em>logging.getLogger(APP_LOGGER_NAME).getChild(module_name)</span></pre><p id="1485" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">此外，为了将这个模块作为一个包使用，我们可以选择创建一个名为<strong class="lc iv"> logger </strong>的文件夹，并将这个文件放入其中。如果我们这样做，我们还需要包含一个<strong class="lc iv"> ___init__。文件夹中的py </strong>文件并做</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="044d" class="ni me iu nd b gz nj nk l nl nm">from .logger import *</span></pre><p id="59c9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">以确保我们可以从包中导入我们的模块。</p><p id="e817" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">太好了！主设置完成！</p><h1 id="83c8" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">设置我们的模块级日志记录</h1><p id="75a7" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">为了更好地理解模板，可以做一个简单的模块来测试我们的日志记录器。让我们将它定义为一个简单的<strong class="lc iv"> module.py. </strong></p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="292e" class="ni me iu nd b gz nj nk l nl nm"><em class="lw">import</em> logger</span><span id="9ab4" class="ni me iu nd b gz nn nk l nl nm">log = logger.get_logger(__name__)</span><span id="908b" class="ni me iu nd b gz nn nk l nl nm">def multiply(<em class="lw">num1</em>, <em class="lw">num2</em>): # just multiply two numbers</span><span id="07cf" class="ni me iu nd b gz nn nk l nl nm">    log.debug("Executing multiply function.")</span><span id="08a2" class="ni me iu nd b gz nn nk l nl nm"><em class="lw">    return</em> num1 * num2</span></pre><p id="6d18" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">厉害！该模块现在可以访问记录器，并且应该显示带有适当模块名称的消息。</p><p id="fc3e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在就来测试一下吧！</p><h1 id="ea1e" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">运行我们的脚本并测试记录器</h1><p id="55c7" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">现在，我们构造<strong class="lc iv"> app.py. </strong></p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="bc50" class="ni me iu nd b gz nj nk l nl nm"><em class="lw">import</em> logger</span><span id="7075" class="ni me iu nd b gz nn nk l nl nm">log = logger.setup_applevel_logger(<em class="lw">file_name</em> = 'app_debug.log')</span><span id="b8e4" class="ni me iu nd b gz nn nk l nl nm"><em class="lw">import</em> mymodule</span><span id="867a" class="ni me iu nd b gz nn nk l nl nm">log.debug('Calling module function.')</span><span id="24e9" class="ni me iu nd b gz nn nk l nl nm">mymodule.multiply(5, 2)</span><span id="422f" class="ni me iu nd b gz nn nk l nl nm">log.debug('Finished.')</span></pre><p id="f4f1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">注意我们如何在初始化记录器后导入模块<em class="lw">？是的，这是必要的。</em></strong></p><p id="1a29" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，验证您的目录包含这些文件:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj no"><img src="../Images/4354ddbfbd822c2464f28e6e52991228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*aqzksvOiKiRcwkkQJ18HwQ.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">项目的文件夹</p></figure><p id="3fa9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最后，只需通过以下方式运行脚本:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="ab0d" class="ni me iu nd b gz nj nk l nl nm">python3 app.py</span></pre><p id="9076" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您应该得到如下输出:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj np"><img src="../Images/6189975eca2473a345023ff522d6f644.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E8QhglbdcEXCN3KPYB4Vug.png"/></div></div></figure><p id="0bf2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您的目录结构也应该改变，以包含新的<em class="lw">日志</em>文件。继续检查它的内容！</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nq"><img src="../Images/5bb2fb6d90869890e8d4462d853d9b67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*OuUxOXrQkF5Lmm3Ams2bnw.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">日志文件出现！</p></figure><h1 id="518b" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">最后的话</h1><p id="95ee" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">这就是如何在项目中轻松集成工作日志设置的方法。😄。</p><p id="5318" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这很简单，你可以很容易地扩展它，以包括不同模块之间的许多层次结构，用日志记录器捕获和格式化异常，用dictConfig以更高级的方式配置它，等等。可能性是无限的！</p><p id="8a01" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">代码库是<a class="ae kz" href="https://github.com/yashprakash13/data-another-day#python-cool-concepts-because-knowing-them-is-cool" rel="noopener ugc nofollow" target="_blank">，位于这里</a>。它也包含了我所有其他文章的资源。你可以继续⭐️和书签！</p><p id="e601" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果你喜欢这篇文章，每周我都会发布一个故事，分享一些来自数据科学和编程领域的小知识。<a class="ae kz" href="https://medium.com/@ipom" rel="noopener">跟着我永远不要错过他们</a>！</p></div><div class="ab cl nr ns hy nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="in io ip iq ir"><p id="31a7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我的另外几篇文章你可能会觉得有用:</p><div class="ny nz gq gs oa ob"><a href="https://pub.towardsai.net/7-awesome-jupyter-utilities-that-you-should-be-aware-of-f3afdb75c2b" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fp"><div class="od ab oe cl cj of"><h2 class="bd iv gz z fq og fs ft oh fv fx it bi translated">你应该知道的7个很棒的Jupyter工具</h2><div class="oi l"><h3 class="bd b gz z fq og fs ft oh fv fx dk translated">一些有用的技巧和窍门，我用在了几乎所有涉及Jupyter笔记本的数据科学项目中</h3></div><div class="oj l"><p class="bd b dl z fq og fs ft oh fv fx dk translated">pub.towardsai.net</p></div></div><div class="ok l"><div class="ol l om on oo ok op kt ob"/></div></div></a></div><div class="ny nz gq gs oa ob"><a rel="noopener follow" target="_blank" href="/how-to-use-bash-to-automate-the-boring-stuff-for-data-science-d447cd23fffe"><div class="oc ab fp"><div class="od ab oe cl cj of"><h2 class="bd iv gz z fq og fs ft oh fv fx it bi translated">如何使用Bash来自动化数据科学的枯燥工作</h2><div class="oi l"><h3 class="bd b gz z fq og fs ft oh fv fx dk translated">使用命令行为您的数据科学项目编写一些可重用代码的指南</h3></div><div class="oj l"><p class="bd b dl z fq og fs ft oh fv fx dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="oq l om on oo ok op kt ob"/></div></div></a></div></div></div>    
</body>
</html>