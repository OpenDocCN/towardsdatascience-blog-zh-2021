<html>
<head>
<title>Taming the Python Import System</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">驯服Python导入系统</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/taming-the-python-import-system-fbee2bf0a1e4?source=collection_archive---------26-----------------------#2021-04-25">https://towardsdatascience.com/taming-the-python-import-system-fbee2bf0a1e4?source=collection_archive---------26-----------------------#2021-04-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="79f2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">把它做错，这样你就能把它做对</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fe3d4c85f5dc3000bec6fbb4f59ef6c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UdnK_8h-lrZchSlG"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@glencarrie?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">格伦·凯莉</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="6dd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些年来，我遇到了相当多的导入问题，只是在反复试验的基础上让它们工作。导入是困难的，因为有太多的因素相互作用，使事情在不应该的时候工作，并使事情在不应该的时候失败/得到警告。我终于厌倦了这一点，这篇文章(主要是织机视频)旨在通过一系列实验向您展示影响导入成功和失败的因素，这些实验演示了您可能会遇到的许多情况。</p><p id="59b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它可能没有涵盖所有情况，但是列出了一些可能的交互，希望让您有足够的知识来知道要注意什么，以便您可以在不可预见的情况下进行调试。这篇文章是对视频的总结，也是为了帮助你决定是否观看视频，新手从视频开始会做得更好。</p><h2 id="b898" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">视频</h2><p id="4da7" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated"><a class="ae ky" href="https://www.loom.com/share/efea0a982d1d4f73a4d8cd5837b484c7" rel="noopener ugc nofollow" target="_blank">https://www.loom.com/share/efea0a982d1d4f73a4d8cd5837b484c7</a></p><h2 id="688a" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">你将学到什么</h2><ol class=""><li id="27df" class="mt mu it lb b lc mo lf mp li mv lm mw lq mx lu my mz na nb bi translated">运行python文件的2种模式<br/> a .作为模块<code class="fe nc nd ne nf b">python -m main</code> <br/> b .作为脚本<code class="fe nc nd ne nf b">python main.py</code></li><li id="a8e9" class="mt mu it lb b lc ng lf nh li ni lm nj lq nk lu my mz na nb bi translated">绝对进口与相对进口</li><li id="72e2" class="mt mu it lb b lc ng lf nh li ni lm nj lq nk lu my mz na nb bi translated">如何编写导入语句决定了代码的成败</li><li id="e892" class="mt mu it lb b lc ng lf nh li ni lm nj lq nk lu my mz na nb bi translated">运行终端的当前目录，以及打开VSCode的文件夹，决定了代码的成功/失败</li><li id="d079" class="mt mu it lb b lc ng lf nh li ni lm nj lq nk lu my mz na nb bi translated">什么是__init__。py代表什么？</li></ol><h2 id="19ff" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">2种运行模式</h2><p id="4fba" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">用-m作为模块运行将当前目录放在<code class="fe nc nd ne nf b">sys.path</code>的第一个索引中，作为脚本运行将脚本的直接父目录放在<code class="fe nc nd ne nf b">sys.path</code>的第一个索引中。<br/>当项目层次结构简单且没有嵌套时，或者当您从模块(python文件)正上方的目录运行程序时，这两个路径可能是相同的，所以这里没有什么可担心的。然而，当这两个路径开始不同时，你可以打印<code class="fe nc nd ne nf b">sys.path</code>来调试。</p><h2 id="f7ba" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">绝对进口与相对进口</h2><p id="52fa" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">绝对导入使用项目根中模块的完整路径，相对导入使用点符号。Absolute更明确地说明了模块在项目层次结构中的位置，如果您不想键入长时间的导入，并且不需要知道模块相对于它正在导入的模块的位置，可以使用relative。</p><p id="85b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当进行相对导入时，作为脚本运行将导致<code class="fe nc nd ne nf b">__package__</code>为None，因此没有相对性概念的参考点，所以它将失败。如果模块位于顶层，作为模块运行可能仍然会失败，这会导致<code class="fe nc nd ne nf b">__package__</code>为<code class="fe nc nd ne nf b">''</code>空字符串。对于<code class="fe nc nd ne nf b">__package__</code>正确包含包名(例如文件夹)的其他情况，相对导入工作正常。</p><p id="fac1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">绝对导入失败可以通过像<code class="fe nc nd ne nf b">sys.path.insert(0,path_to_package)</code>这样的快速破解(通常在将模块导入jupyter笔记本时)来修复，但这无助于依赖于<code class="fe nc nd ne nf b">__package__</code>具有正确值的相对导入失败。</p><p id="b010" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">熊猫用绝对，Sklearn用相对。<br/> <strong class="lb iu">熊猫</strong>:<a class="ae ky" href="https://github.com/pandas-dev/pandas/blob/master/pandas/core/groupby/groupby.py" rel="noopener ugc nofollow" target="_blank">https://github . com/Pandas-dev/Pandas/blob/master/Pandas/core/group by/group by . py</a><br/><strong class="lb iu">sk learn</strong>:<a class="ae ky" href="https://github.com/scikit-learn/scikit-learn/blob/main/sklearn/metrics/pairwise.py" rel="noopener ugc nofollow" target="_blank">https://github . com/scikit-learn/scikit-learn/blob/main/sk learn/metrics/pairwise . py</a></p><h2 id="6a63" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">如何编写导入决定了成功/失败</h2><p id="d242" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated"><code class="fe nc nd ne nf b">from folder.utils import add</code> vs <code class="fe nc nd ne nf b">from utils import add</code>是两种不同的编写导入的方式。前者搜索<code class="fe nc nd ne nf b">folder</code>进行导入，而后者搜索<code class="fe nc nd ne nf b">utils</code>。当出现问题时，查看<code class="fe nc nd ne nf b">sys.path</code>,看看您导入的内容是否能在任何路径中找到。</p><h2 id="1020" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">运行终端的当前目录以及打开VSCode的文件夹决定了成功/失败</h2><p id="0d01" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">作为模块或脚本运行的terminal中的当前目录会影响哪个路径被添加到<code class="fe nc nd ne nf b">sys.path</code>的前面，从而影响代码中的导入(也取决于您如何编写它们)是否能被找到。</p><p id="c8fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您打开VSCode所在的文件夹会影响红色下划线警告“xxx无法解析”。它们很碍眼，可以通过在正确的目录中打开VSCode来修复。(假设您处于正确的环境中，并且安装了导入的软件包)</p><h2 id="0077" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">什么是__init__。巴拉圭</h2><p id="ad51" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">帮助有用的模块/功能从项目层次结构的深处上升到顶层，因此用户或其他模块可以用更简单的<code class="fe nc nd ne nf b">from folder import add</code>而不是更深的<code class="fe nc nd ne nf b">from folder.utils import add</code>来调用它们。<br/>从我的另一篇文章中可以看到类似的概念(<a class="ae ky" rel="noopener" target="_blank" href="/whats-the-difference-between-pd-merge-and-df-merge-ab387bc20a2e">https://towards data science . com/whats-the-difference-between-PD-merge-and-df-merge-ab 387 BC 20 a2e</a>)，其中<code class="fe nc nd ne nf b">merge</code>函数通过该文件中的导入从<code class="fe nc nd ne nf b">pandas.core.reshape.merge</code>模块冒泡到<code class="fe nc nd ne nf b">pandas.core.reshape.api</code>名称空间，然后通过位于<a class="ae ky" href="https://github.com/pandas-dev/pandas/blob/v0.25.1/pandas/__init__.py#L129-L143" rel="noopener ugc nofollow" target="_blank"> https://github的pandas包中的顶层<code class="fe nc nd ne nf b">__init__.py</code>进一步冒泡到顶层<code class="fe nc nd ne nf b">pandas.merge</code>py#L129-L143 </a>。</p><p id="1708" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我欢迎在评论中对更正或不清楚的解释的任何反馈，我将用它们来更新这篇文章。</p><p id="03a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">参考文献:<br/> 1。<a class="ae ky" href="https://stackoverflow.com/questions/16981921/relative-imports-in-python-3" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/16981921/relative-imports-in-python-3</a><br/>2 .<a class="ae ky" href="https://stackoverflow.com/questions/14132789/relative-imports-for-the-billionth-time" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/14132789/relative-imports-for-the-billion-time</a><br/>3 .<a class="ae ky" href="https://stackoverflow.com/questions/22241420/execution-of-python-code-with-m-option-or-not" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/22241420/execution-of-python-code-with-m-option-or-not</a><br/>4 .<a class="ae ky" href="https://stackoverflow.com/questions/21233229/whats-the-purpose-of-the-package-attribute-in-python/" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/21233229/what-the-purpose-of-package-attribute-in-python/</a><br/>5 .<a class="ae ky" href="https://stackoverflow.com/questions/448271/what-is-init-py-for" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/448271/what-is-init-py-for</a></p></div></div>    
</body>
</html>