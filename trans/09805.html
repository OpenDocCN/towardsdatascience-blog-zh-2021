<html>
<head>
<title>How to: Machine Learning Pipeline (Beginner)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何:机器学习管道(初学者)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-machine-leaning-pipeline-beginner-2a736595cbfd?source=collection_archive---------9-----------------------#2021-09-14">https://towardsdatascience.com/how-to-machine-leaning-pipeline-beginner-2a736595cbfd?source=collection_archive---------9-----------------------#2021-09-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/eef2711c5b10eaac2798398f120902aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5iTATGqZxxW1e4pi"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@jjying?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> JJ英</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="54d7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我第一次开始我的机器学习之旅时，我只知道如何在Jupyter笔记本/google colab中编码并运行它们。然而，当我试图在谷歌云和AWS中部署模型时，我发现越来越难以仅仅为了调整某些参数而检查代码行。如果有人只想用一个命令行运行全部代码，这就特别麻烦了。虽然网上有大量的资源，但我认为最好还是列出一个最佳实践的列表，并详细解释每个最佳实践的作用。</p><p id="a266" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我将介绍一个简单的回归和分类问题所需的各种组件和模块。整行代码将被分成多个模块，用一行代码编译。</p><p id="84f2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所有文件都可以在这个<a class="ae kf" href="https://github.com/kmt112/ML_Pipeline_Example" rel="noopener ugc nofollow" target="_blank"> github </a>资源库中找到。</p><p id="3473" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意，在这个练习中，我将使用Windows操作系统。</p><p id="cfbb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">先决条件:</strong></p><ol class=""><li id="c84f" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">安装Ubuntu LTS。记得安装长期支持版本。</li><li id="3a1d" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">Spyder(蟒蛇3)。我发现spyder界面更好运行。py文件，也就是说。这完全是我自己的喜好，请随意使用你自己的编辑器。</li><li id="bdb9" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">Python 3。确保python3安装在您的计算机或指定的文件夹/驱动器中。</li><li id="b3e7" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">熟悉书写功能。在这篇文章中，我们会用到很多。</li></ol><p id="ee62" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">文件和文件夹概述</strong></p><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/d71fa742f8c981c5d6063f81c56218b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*juh0CR2VKdKPwZzZJcNoVw.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">机器学习管道的树形图</p></figure><p id="5209" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">数据文件夹</strong></p><p id="8694" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是您存储数据的地方，以便您的机器学习管道从中提取数据。在本例中，我拥有的数据库位于。db格式。</p><p id="fff9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> Requirements.txt </strong></p><p id="503e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该文本文件夹包含所有必要的软件包，你应该安装，以使您的回购工作。一种快速提取所有相应库的方法</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="63c4" class="mc md it ly b gy me mf l mg mh">pip3 freeze &gt; requirements.txt  # Python3<br/>pip freeze &gt; requirements.txt  # Python2</span></pre><p id="30bf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> Bash文件(Run.sh) </strong></p><p id="0502" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">run.sh文件初始化run.py文件，后者依次运行所有其他模块，如数据提取、数据处理和ML模型。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="76f2" class="mc md it ly b gy me mf l mg mh">#!/usr/bin/env bash<br/>python ./src/run.py</span></pre><p id="2a6e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第一行也称为shebang。想了解更多可以参考链接。Run.sh运行位于src文件夹中的python文件。</p><p id="cf46" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> SRC(源)</strong></p><p id="8db2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如前所述，run.py模块提取在其他python文件中创建的函数。所创建的函数将在本文的第3步和第4步中解释，但现在只需知道它激活了在其他。py文件。</p><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/473321400ef3254f30453d8a09eea172.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*CCMC59MlPLAgRyaLdWVvIA.png"/></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">运行. py文件</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="a6f9" class="mq md it bd mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm bi translated">第一步。将ubuntu LTS挂载到虚拟环境中</h1><p id="2dbe" class="pw-post-body-paragraph kg kh it ki b kj nn kl km kn no kp kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">在开始任何项目之前，你会想把ubuntu挂载到一个驱动器上，这样它就可以访问你的文件。当你第一次打开你的ubuntu时，输入ls /mnt/看看你能挂载到哪个驱动器上，假设你希望挂载到c盘上，命令是cd /mnt/C/ <folder>。之后，您可以导航到存储数据的驱动器。更多信息，请点击这个<a class="ae kf" href="https://www.youtube.com/watch?v=xzgwDbe7foQ" rel="noopener ugc nofollow" target="_blank"> YouTube </a>视频。</folder></p><p id="fbe1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在你的Ubuntu已经挂载到了某个驱动器或文件夹中，你可以继续安装你的虚拟环境了。如果你没有使用python3，你可以pip安装它。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="2615" class="mc md it ly b gy me mf l mg mh">mkdir test-venv ## this creates a drive called test-venv<br/>virutalenv test-venv ## install new virtual environment inside the directory<br/>source ./test-venv/bin/activate ## activate your new environment.</span></pre><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ns"><img src="../Images/d125ec765f9e9dbce6320a71e8bfce35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rej6ljeDSwkL1Pq9NCiSEw.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">Ubuntu平台</p></figure><p id="3706" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您看到类似这样的内容，请不要关闭它，我们将在第7步中讨论它。</p><h1 id="d73c" class="mq md it bd mr ms nt mu mv mw nu my mz na nv nc nd ne nw ng nh ni nx nk nl nm bi translated">第二步。规划你的机器学习管道。</h1><p id="448f" class="pw-post-body-paragraph kg kh it ki b kj nn kl km kn no kp kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">想想你希望你的数据如何在你的项目中流动，并最终形成见解。一个简单的、典型的机器学习管道将如下图所示。</p><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ny"><img src="../Images/a1bb9b586b4bd444aef0f54880f57d49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E29Paja6uhWH3_CF-f0vwA.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">典型的基本机器学习管道</p></figure><p id="dff3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这个例子中，我将坚持流水线化机器学习模型的标准过程。</p><h1 id="e141" class="mq md it bd mr ms nt mu mv mw nu my mz na nv nc nd ne nw ng nh ni nx nk nl nm bi translated">第三步。数据提取/数据准备/</h1><p id="691c" class="pw-post-body-paragraph kg kh it ki b kj nn kl km kn no kp kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated"><strong class="ki iu">数据提取</strong></p><p id="663e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">大多数数据库都是关系数据库，存储在。db文件格式，因此您可以使用SQL提取它。我包含了一个<a class="ae kf" rel="noopener" target="_blank" href="/what-is-data-extraction-python-review-of-json-xml-apis-sql-and-csv-formats-a5470afc27b6">链接</a>来展示我们如何提取不同类型的数据集。该函数输出提取的数据帧，该数据帧将被输入到数据准备python文件中。</p><p id="1df0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">数据准备</strong></p><p id="333a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个python文件包含了各种可以对测试分割进行特征工程、编码和训练的方法。</p><p id="4550" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本文件定义的函数输出4个数据帧<em class="nz"> x_train </em>、<em class="nz"> x_test </em>、<em class="nz"> y_train </em>、<em class="nz"> y_test </em>。这4个数据帧将被输入到模型训练中。</p><figure class="lt lu lv lw gt ju"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="3a60" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这个例子中，我对顺序特征使用了目标编码器，并通过get_dummies将分类特征转换为数字特征。然而，我建议你尝试不同的编码器，看看哪种帮助最大。</p><h1 id="784d" class="mq md it bd mr ms nt mu mv mw nu my mz na nv nc nd ne nw ng nh ni nx nk nl nm bi translated">第四步。模特培训</h1><p id="8d1e" class="pw-post-body-paragraph kg kh it ki b kj nn kl km kn no kp kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">这是建模发生的地方。我在这一部分添加了一个超级参数调整。但是，您可以选择将hyper parameter tuning分成不同的部分。</p><figure class="lt lu lv lw gt ju"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="2c70" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该函数输出XGBoost、普通线性回归和LGBM的平均绝对误差。</p><h1 id="99b7" class="mq md it bd mr ms nt mu mv mw nu my mz na nv nc nd ne nw ng nh ni nx nk nl nm bi translated"><strong class="ak">第五步。模型评估和验证</strong></h1><p id="bcac" class="pw-post-body-paragraph kg kh it ki b kj nn kl km kn no kp kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">建模的结果输出到主run.py脚本中。然后，run.py脚本将结果连接起来，并输出到一个CSV文件中，以便于比较。此后，由您决定使用哪种模型。</p><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/c3aa9ccf552164826b50467e47965534.png" data-original-src="https://miro.medium.com/v2/resize:fit:456/format:webp/1*0N0Z8Dpy5LWhvGzAZLoMPw.png"/></div></figure><p id="5b3a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">虽然LGBM能产生最好的结果，但考虑利益相关者的其他重要要求也很重要。一些例子是模型的可解释性或模型所需的训练时间，这些因素会影响最终的决策。</p><h1 id="84d4" class="mq md it bd mr ms nt mu mv mw nu my mz na nv nc nd ne nw ng nh ni nx nk nl nm bi translated"><strong class="ak">第六步。Run.py </strong></h1><p id="4619" class="pw-post-body-paragraph kg kh it ki b kj nn kl km kn no kp kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">现在我们已经编写了ML管道的所有构件。现在是时候创建一个主python文件了，它结合了所有模块的所有输入和输出。</p><figure class="lt lu lv lw gt ju"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="abcd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我之前解释过模型如何从各种函数中获取数据并输出它们。检查您是否将各种文件以正确的名称放在了正确的文件夹中，这一点很重要。如果需要帮助，请参考文件夹概述。</p><h1 id="6353" class="mq md it bd mr ms nt mu mv mw nu my mz na nv nc nd ne nw ng nh ni nx nk nl nm bi translated">第七步。Run.sh</h1><p id="243f" class="pw-post-body-paragraph kg kh it ki b kj nn kl km kn no kp kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">您所要做的就是创建一个bash脚本来运行。py文件。回到ubuntu IDE。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="727b" class="mc md it ly b gy me mf l mg mh">#!/usr/bin/env bash <br/>python ./src/run.py</span></pre><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi od"><img src="../Images/ff52e8d3c39e1e6d7b809173ab15c511.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2NIFfW6VS2uEQcnqnlXWXg.png"/></div></div></figure><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="ceda" class="mc md it ly b gy me mf l mg mh">chmod +x run.sh<br/>./run.sh</span></pre><p id="cf2c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，当您尝试运行bash脚本时，您可能会看到numpy或其他一些包没有安装。出现这种情况的原因是因为你在虚拟环境中。因此，你能做的就是pip安装你需要的各种包。</p><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oe"><img src="../Images/81773222f1e76c2d06632d0b6eb2cd93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L5T1FUvrO1YwSQ2-qbK7Vw.png"/></div></div></figure><p id="bb8c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在你所要做的，就是一个接一个地慢慢安装你需要的软件包。安装完所有必需的软件包后:</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="b90d" class="mc md it ly b gy me mf l mg mh">pip3 freeze &gt; requirements.txt</span></pre><p id="186f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从这里，您将获得保存在您的文件夹中的requirements.txt。当您想要共享代码时，需求列表尤其重要。然后，用户可以看到需要哪些软件包，并可以快速安装它们。</p><h1 id="8d42" class="mq md it bd mr ms nt mu mv mw nu my mz na nv nc nd ne nw ng nh ni nx nk nl nm bi translated">结论</h1><p id="843c" class="pw-post-body-paragraph kg kh it ki b kj nn kl km kn no kp kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">在这个练习中，我们学习了所需的各种ML模块，以及如何通过ubuntu使用bash运行它们。您还可以做其他一些改进，比如创建一个配置文件来存储您希望优化的所有变量。此后，您只需要更改配置文件来测试模型的不同变量。我希望你从这里学到一些东西，并一如既往地快乐编码！</p><p id="193e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="nz">如果有任何错误请联系我，我会做出必要的修改。</em></p></div></div>    
</body>
</html>