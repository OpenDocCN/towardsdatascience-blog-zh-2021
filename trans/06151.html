<html>
<head>
<title>Containerize Your Application With Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Docker容器化你的应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/containerize-your-application-with-docker-b0608557441f?source=collection_archive---------6-----------------------#2021-06-02">https://towardsdatascience.com/containerize-your-application-with-docker-b0608557441f?source=collection_archive---------6-----------------------#2021-06-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9776" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在虚拟化操作系统上运行您的应用。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/48cc5f8f4d435649b76bcdd672d44968.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mp9rZEbFtJls_WuWIcnPvQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">托德·克雷文在<a class="ae ky" href="https://unsplash.com/s/photos/whale?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="dfdb" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">动机</h1><p id="ffd7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">假设您想将一个应用程序部署到服务器上。在您的本地系统中，应用程序运行良好，没有任何问题。但是一旦你将应用程序部署到服务器上，嘣！你的应用程序不工作。</p><p id="5041" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">许多因素都会导致这种情况。这可能是操作系统兼容性或不同的库版本。因此，您的应用程序永远不会被部署，您会因此而感到头疼。</p><p id="2fd8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">怎么才能去除仅仅因为不兼容问题而头疼的问题？码头工人来救你了！</p><p id="124a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">本文将向您展示如何使用Docker来封装您的应用程序，以便您可以在任何服务器上运行它们，而不管它们内部的操作系统是什么。没有进一步，让我们开始吧！</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="d973" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">Docker是什么？</h1><p id="e5dc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我们进入实现之前，让我向您解释一下Docker。Docker是一个部署应用程序的平台。它的工作原理是将应用程序隔离到一个映像中。该映像将由一个容器运行，其中包含操作系统和支持软件。</p><p id="6505" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">由于这种隔离，我们不必担心软件安装及其版本。您可以通过容器运行应用程序，而不管计算机中的操作系统和软件如何。因此，您可以专注于开发您的应用程序并直接部署它们。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="08b1" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">履行</h1><p id="aa01" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在你理解了Docker的概念之后，现在让我们进入实现。我们将执行几个步骤:</p><ol class=""><li id="fff1" class="ne nf it lt b lu mn lx mo ma ng me nh mi ni mm nj nk nl nm bi translated">安装Docker</li><li id="29cc" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">创建名为Dockerfile的文件</li><li id="e574" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">建立形象</li><li id="c5b1" class="ne nf it lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">运行图像</li></ol><h2 id="e09e" class="ns la it bd lb nt nu dn lf nv nw dp lj ma nx ny ll me nz oa ln mi ob oc lp od bi translated">安装Docker</h2><p id="10fc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们可以做的第一步是安装docker应用程序。你可以在这里下载Docker<a class="ae ky" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank">T5T7】并确保根据你的操作系统选择正确的。</a></p><p id="3c23" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">安装Docker后，现在让我们测试Docker是否已经安装在您的计算机上。您可以运行命令“docker ”,如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/af17fb74b8d98bcd32ba35b5c2a45d0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*bByv4BILF4A1Euh541mDCw.gif"/></div></div></figure><p id="d753" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你的电脑显示如上提示，我们可以向你保证Docker已经安装在你的电脑上。现在让我们进入下一步。</p><h2 id="d7d7" class="ns la it bd lb nt nu dn lf nv nw dp lj ma nx ny ll me nz oa ln mi ob oc lp od bi translated">创建Dockerfile文件</h2><p id="3f30" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">安装Docker后，下一步是创建一个名为Dockerfile的文件。Dockerfile是一个用于构建docker映像的脚本。它包含了从安装库到运行我们的项目的设置映像的指令。</p><p id="9550" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在本例中，我创建了一个基于Flask库的API。这个API将被用作用户和机器学习模型之间的连接器，以返回预测结果。下面是API的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="372d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要创建docker文件，请确保该文件与您的应用程序和机器学习模型文件夹位于同一位置。在我的例子中，文件夹位置如下所示:</p><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="7e86" class="ns la it oi b gy om on l oo op"><strong class="oi iu">|   app.py<br/>|   Dockerfile<br/>|   requirements.txt<br/>|<br/>+---resnet50_food_model<br/>|   |   saved_model.pb<br/>|   |<br/>|   +---assets<br/>|   +---variables<br/>|           variables.data-00000-of-00001<br/>|           variables.index</strong></span></pre><p id="a052" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在该文件夹中，我们有用于运行我的应用程序的<a class="ae ky" href="http://app.py" rel="noopener ugc nofollow" target="_blank"> app.py </a>，包含我们将使用的包列表的requirements.txt，包含预训练模型的模型文件夹，以及用于构建docker映像的docker文件。</p><p id="3f21" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">请记住，在创建docker文件时，请确保不要在文件名后添加任何扩展名。您只能写“Dockerfile”。</p><p id="9c82" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在让我们编写Dockerfile脚本。以下是Dockerfile文件中的脚本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="f59e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我解释一下脚本的每一行:</p><p id="8e5f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">“FROM”指令将从docker注册表中获取docker映像。该映像将包含操作系统和Python。</p><p id="7b0d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">“WORKDIR”指令将设置我们将用来运行应用程序的默认工作目录。</p><p id="4a33" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">“复制”指令会将当前目录中的每个文件复制到新的工作目录中。</p><p id="71d3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">“运行”指令将运行一个命令。在这种情况下，是“pip install”命令。</p><p id="af27" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">“EXPOSE”指令会将端口5000作为连接器暴露给docker映像。</p><p id="ac84" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，“CMD”指令将运行一个命令。在这种情况下，“烧瓶运行”命令。</p><blockquote class="oq or os"><p id="b806" class="lr ls ot lt b lu mn ju lw lx mo jx lz ou mp mc md ov mq mg mh ow mr mk ml mm im bi translated">旁注:<br/>‘CMD’指令和‘RUN’指令有相同的功能，但是它们的用途不同。</p><p id="e8df" class="lr ls ot lt b lu mn ju lw lx mo jx lz ou mp mc md ov mq mg mh ow mr mk ml mm im bi translated">“CMD”指令用于在开始运行docker映像时运行命令。</p><p id="aede" class="lr ls ot lt b lu mn ju lw lx mo jx lz ou mp mc md ov mq mg mh ow mr mk ml mm im bi translated">同时,“RUN”指令用于在构建docker映像时运行命令。</p></blockquote><h2 id="9fe0" class="ns la it bd lb nt nu dn lf nv nw dp lj ma nx ny ll me nz oa ln mi ob oc lp od bi translated">建立docker形象</h2><p id="8367" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">创建docker映像后，下一步是构建映像。要建立形象，真的很简单。你需要做的就是像这样运行“docker build”命令:</p><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="b4e2" class="ns la it oi b gy om on l oo op"><strong class="oi iu">docker build -t my-image .</strong></span></pre><p id="1213" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">正如你在上面看到的，我在“docker build”命令旁边加上了“-t”标记。'-t '标记有两个参数。它们是图像名称和点字符，代表文件夹中的所有文件。</p><p id="b57d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是我们在构建docker映像时的预览(这将需要很长时间，所以请耐心等待) :</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/2581d463e99b47a02833090a0861171d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hUZlHBvpsQsyFmfy"/></div></div></figure><p id="5501" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们运行“docker images”命令来显示已经构建的现有图像。以下是结果预览:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/53df24a66297cf67382bd6a7f4e7608a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/0*APPEdriG24WRlBT3"/></div></figure><h2 id="f2ab" class="ns la it bd lb nt nu dn lf nv nw dp lj ma nx ny ll me nz oa ln mi ob oc lp od bi translated">运行docker映像</h2><p id="733e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">从上面可以看到，图像已经存在。现在下一步是在我们的计算机上运行docker映像。要运行映像，您可以像这样使用命令“docker run ”,</p><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="a873" class="ns la it oi b gy om on l oo op"><strong class="oi iu">docker run -dp 5000:5000 my-image</strong></span></pre><p id="9737" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们等一会儿，等3到5分钟。要知道我们的映像是否已经在运行，我们可以使用' docker ps -a '命令来检查所有正在运行的映像。以下是预览:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/060896bd2e82b388ed467ac21f7ab4e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UYQnieLrYrNDVvpq"/></div></div></figure><p id="9f15" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">正如你从上面看到的，图像已经上升了大约一分钟。这意味着映像已经在端口5000上运行。现在让我们使用<a class="ae ky" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank"> localhost:5000 </a>或127.0.0.1:5000来访问映像。以下是预览:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/14eba9767c814f41cbaeeb5185c78554.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/0*t2jMNUiJrqJuBtr2"/></div></figure><p id="4ae7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">正如您从上面看到的，我们的容器已经在我们的计算机上成功运行了。因为设置了'-d '参数，所以不能显示容器的日志。</p><p id="601d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要检查容器上的活动，可以使用“docker日志”来完成。另外，请在旁边设置容器id。您可以从“docker ps -a”命令中看到容器id。该命令如下所示:</p><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="77eb" class="ns la it oi b gy om on l oo op"><strong class="oi iu">docker logs bff6d3c8e2da</strong></span></pre><p id="529d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面是日志预览的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/4f8daede6bdbbadc8e45252b4f0ca89d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HoRbhlxpLEwtzyF0"/></div></div></figure><p id="8adc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你想停止容器，你可以使用' docker kill '命令，并在旁边设置容器id。以下是停止docker命令的命令:</p><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="5759" class="ns la it oi b gy om on l oo op"><strong class="oi iu">docker kill bff6d3c8e2da</strong></span></pre><p id="4b6c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">停止容器后，它看起来像这样，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/9ffba55b2953a0b930e5ad0871b5bb4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zWdJSryCTB6IP4oR"/></div></div></figure><p id="ab80" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">是的，我们的集装箱已经终止了。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="cbae" class="kz la it bd lb lc mz le lf lg na li lj jz nb ka ll kc nc kd ln kf nd kg lp lq bi translated">结束语</h1><p id="9b2f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">干得好！您已经学习了如何将您的应用程序容器化为docker映像。我希望这篇文章能帮助你在你的项目中建立自己的docker形象。</p><p id="9973" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你对这篇文章感兴趣，你可以关注我在<strong class="lt iu">媒体</strong>上的文章。如果你有任何问题或者想和我打招呼，你可以在<a class="ae ky" href="https://www.linkedin.com/in/alghaniirfan/" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> LinkedIn </strong> </a>上和我联系。</p><p id="92c6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">谢谢你看我的文章！</p><h2 id="694f" class="ns la it bd lb nt nu dn lf nv nw dp lj ma nx ny ll me nz oa ln mi ob oc lp od bi translated">参考</h2><p id="c5f5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">[1]<a class="ae ky" href="https://docs.docker.com/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/</a><br/>【2】<a class="ae ky" href="https://nickjanetakis.com/blog/docker-tip-7-the-difference-between-run-and-cmd" rel="noopener ugc nofollow" target="_blank">https://nickjanetakis . com/blog/docker-tip-7-the-difference-between-run-and-cmd</a></p></div></div>    
</body>
</html>