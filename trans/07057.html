<html>
<head>
<title>Visualizing Cohort Retention Rates with pycohort Package</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用pycohort软件包可视化群组保持率</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/visualizing-cohort-retention-rates-with-pycohort-package-95e7f29052b3?source=collection_archive---------19-----------------------#2021-06-26">https://towardsdatascience.com/visualizing-cohort-retention-rates-with-pycohort-package-95e7f29052b3?source=collection_archive---------19-----------------------#2021-06-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/458b5df08f5ec30387a13bbd840eb5c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sy8nZbVHBBixWIBZWHNuCg.jpeg"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">罗伯特·卡茨基在<a class="ae jd" href="https://unsplash.com/s/photos/rainbow?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><div class=""/><div class=""><h2 id="55c4" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">关于如何在PyPi上创建Python包的教程</h2></div><p id="7091" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">订阅业务的主要收入来源是定期支付。可能会有额外的一次性服务，但选择额外收费的用户数量有限，这个数字将更难预测。这就是为什么订阅业务的财务健康状况最好用留存率来衡量。如果用户对产品或服务满意，他们可能会一直呆到他们的需求改变。这就是为什么应用程序中有什么样的保留功能以及如何呈现给用户非常重要，特别是那些正在进入取消漏斗以结束重复支付周期的用户。</p><p id="eeb6" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了以更详细的格式快速可视化保留率，企业利用<em class="lr">基于时间的群组分析</em>。群组由在特定时间范围内注册的用户组成，该时间范围可能具有从每周到每季度的粒度。对于每个群组，在每个时间段计算保留客户的百分比，直到最近一次。</p><h1 id="28c4" class="ls lt jg bd lu lv lw lx ly lz ma mb mc km md kn me kp mf kq mg ks mh kt mi mj bi translated">如何阅读基于时间的队列分析图表？</h1><p id="39b8" class="pw-post-body-paragraph kv kw jg kx b ky mk kh la lb ml kk ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">以下是基于时间的群组分析图表示例。用户根据他们的订阅开始月份被分组。每一行代表一群用户。对于每个群体，第一栏中有一个初始保留率。这是在订阅开始日期后一个月仍未离开的用户的百分比。每行的比率代表订阅旅程中给定月份的保留率。这些比率是基于某个月之后剩余的用户数量除以开始时给定群组中的所有用户数量来计算的。让我们以2020年1月注册的用户群体为例。订阅开始两个月后，75%的订阅者仍然在那里。也就是说，前两个月的流失率是25%。由于数据拉动将于2021年4月结束，这一群体还有16个月的时间。16个月后，仍有44%的用户订阅。(<em class="lr">由于这是一个人工数据集，数字可能会高于真实案例的预期。</em>)</p><figure class="mq mr ms mt gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mp"><img src="../Images/f80b61d99ec0a0f9f5088edc13d3109a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CV2CXjvahYqgASSMybnjew.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">基于时间的队列分析</p></figure><h1 id="b673" class="ls lt jg bd lu lv lw lx ly lz ma mb mc km md kn me kp mf kq mg ks mh kt mi mj bi translated">这个观点能概括关于保留的一切吗？</h1><p id="4e90" class="pw-post-body-paragraph kv kw jg kx b ky mk kh la lb ml kk ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">不要！该图表总结了每个群组在订阅过程中特定时期的保留率。但重要的是要记住，这些只是利率。在没有看到分子和分母的情况下，我们不应该对一家公司的未来是否处于危险之中妄下结论。可能会有新的服务增加门户网站的流量，从而增加订阅数量并增加收入，因此这是非常可取的，但费率可能会显示不同的趋势。尽管数量有所增加，但用户流失的速度可能会更快。这就是为什么这种可视化只能呈现业务的局部视图，如果单独使用可能会产生误导！</p><h1 id="3d98" class="ls lt jg bd lu lv lw lx ly lz ma mb mc km md kn me kp mf kq mg ks mh kt mi mj bi translated">如何为我的公司创建类似的图表？</h1><p id="93d0" class="pw-post-body-paragraph kv kw jg kx b ky mk kh la lb ml kk ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">为了回答这个问题，我构建了一个名为<a class="ae jd" href="https://pypi.org/project/pycohort/" rel="noopener ugc nofollow" target="_blank"> pycohort </a>的python包。要使用这个包，数据需要有特定的格式。否则，无法使用这些功能。首先，由用户创建的每个订阅需要有一个惟一的标识符，这个标识符需要被称为<code class="fe mu mv mw mx b">id</code>。然后需要在<code class="fe mu mv mw mx b">creation_date</code>字段中输入每个订阅的开始日期。<code class="fe mu mv mw mx b">metric_month</code>为订阅活动的每个月添加一列。这就是为什么每活跃一个月，就会有一个新的数据点。订阅最后激活的日期需要在<code class="fe mu mv mw mx b">last_active_month</code>字段中。这不一定等于取消月。如果订阅仍然有效，那么<code class="fe mu mv mw mx b">last_active_month</code>将等于最近的月份。所需的最后一列是<code class="fe mu mv mw mx b">active_duration</code>，它是在<code class="fe mu mv mw mx b">creation_date</code>和<code class="fe mu mv mw mx b">last_active_month</code>之间花费的时间。</p><figure class="mq mr ms mt gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi my"><img src="../Images/14974fb6c8a310243c812ffd8c81ea3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*yW1h86BtrtD1E1b2MbSoQg.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">数据帧的格式需要加载到pycohort函数中</p></figure><p id="6f35" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这样的数据格式中，可能会有重复。例如，对于在2020年3月创建并在2020年5月取消的订阅，将有三行:第一行的<code class="fe mu mv mw mx b">metric_month</code>等于2020年3月，第二行的<code class="fe mu mv mw mx b">metric_month</code>等于2020年4月，第三行的<code class="fe mu mv mw mx b">metric_month</code>等于2020年5月。</p><p id="6fab" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在确保数据格式正确后，有5个函数可用来了解保留情况。前三个是计算平均值，中位数和标准差。这三个主要用于<code class="fe mu mv mw mx b">active_duration</code>字段。下一个函数叫做<code class="fe mu mv mw mx b">cohort_preprocess</code>。在这个函数中，上面解释的数据帧格式被转换成一个矩阵，在这个矩阵中计算每个周期中不同群组的保持率。最后一个函数<code class="fe mu mv mw mx b">cohort_viz</code>将<code class="fe mu mv mw mx b">cohort_preprocess</code>的输出作为输入，并打印群组分析可视化。</p><pre class="mq mr ms mt gt mz mx na nb aw nc bi"><span id="927a" class="nd lt jg mx b gy ne nf l ng nh"># to download the package:<br/>!pip install pycohort</span><span id="a2b2" class="nd lt jg mx b gy ni nf l ng nh"># importing necessary functions from the package<br/>from pycohort import calculate_stdev<br/>from pycohort import calculate_mean<br/>from pycohort import calculate_median<br/>from pycohort import calculate_stdev<br/>from pycohort import calculate_stdev</span><span id="14c7" class="nd lt jg mx b gy ni nf l ng nh"># calculating mean<br/>calculate_mean(df.active_duration)<br/>&gt;&gt;&gt; 13.315</span><span id="70df" class="nd lt jg mx b gy ni nf l ng nh"># calculating median<br/>calculate_median(df.active_duration)<br/>&gt;&gt;&gt; 12</span><span id="f9da" class="nd lt jg mx b gy ni nf l ng nh"># calculating standard deviation<br/>calculate_stddev(df.active_duration)<br/>&gt;&gt;&gt; 7.256</span><span id="58e4" class="nd lt jg mx b gy ni nf l ng nh"># printing the visualization<br/>cohort_viz(cohort_preprocess(df))</span></pre><figure class="mq mr ms mt gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nj"><img src="../Images/04ef24e8875aa4d063e818d1bd6903e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j3olya-g48TVdNOznjH0nA.png"/></div></div><p class="iz ja gj gh gi jb jc bd b be z dk translated">群组预处理函数的输出</p></figure><h1 id="fae8" class="ls lt jg bd lu lv lw lx ly lz ma mb mc km md kn me kp mf kq mg ks mh kt mi mj bi translated"><strong class="ak">如何将所有功能捆绑在一个python包中？</strong></h1><p id="b5ca" class="pw-post-body-paragraph kv kw jg kx b ky mk kh la lb ml kk ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">在发布这段代码之前，我创建了一个名为pycohort的工作目录。在那个文件夹下，有一个readme.md，setup.py，license.txt，还有一个叫pycohort的文件夹。在setup.py下，作者需要输入与包相关的具体信息，如下所示。请注意这个包的名字不能被其他开发者使用。同样，如果你想上传一个新的版本，你需要迭代这个版本。正如你所看到的，我花了几个版本来调整代码，添加注释和提高包的效率。</p><pre class="mq mr ms mt gt mz mx na nb aw nc bi"><span id="f0a8" class="nd lt jg mx b gy ne nf l ng nh"># content of setup.py for pycohort<br/>from setuptools import setup</span><span id="db79" class="nd lt jg mx b gy ni nf l ng nh">setup(name='pycohort',<br/>      version='2.6',<br/>      description='pycohort package',<br/>      url='<a class="ae jd" href="https://github.com/demirkeseny'" rel="noopener ugc nofollow" target="_blank">https://github.com/demirkeseny'</a>,<br/>      author='Yalim Demirkesen',<br/>      <a class="ae jd" href="mailto:author_email='yalimdemirkesen@gmail.com" rel="noopener ugc nofollow" target="_blank">author_email='yalimdemirkesen@gmail.com</a>',<br/>      license='MIT',<br/>      packages=['pycohort'],<br/>      zip_safe=False)</span></pre><p id="25a5" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在工作目录的pycohort文件夹下有两个文件。__init__。py，它通知用户如何导入包，还有pycohort.py，上面提到的所有函数都存储在这里。</p><pre class="mq mr ms mt gt mz mx na nb aw nc bi"><span id="79f2" class="nd lt jg mx b gy ne nf l ng nh"># content of  __init__.py for pycohort<br/>from .pycohort import calculate_mean<br/>from .pycohort import calculate_stdev<br/>from .pycohort import calculate_median<br/>from .pycohort import cohort_preprocess<br/>from .pycohort import cohort_viz</span></pre><p id="192d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最终的文件布局如下所示:</p><figure class="mq mr ms mt gt is gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/c50aedb45a4f8de51282a5737914fcd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:352/format:webp/1*I8HYgijI7Rrj0YKXu01Y6g.png"/></div></figure><h1 id="1f25" class="ls lt jg bd lu lv lw lx ly lz ma mb mc km md kn me kp mf kq mg ks mh kt mi mj bi translated">这些文件需要上传到哪里以及如何上传？</h1><p id="5275" class="pw-post-body-paragraph kv kw jg kx b ky mk kh la lb ml kk ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">下一步是上传我们的文件，以便其他人可以安装它们。我们将上传我们的包的站点叫做<a class="ae jd" href="https://pypi.org/manage/projects/" rel="noopener ugc nofollow" target="_blank"> PyPi </a>。当你通常使用<code class="fe mu mv mw mx b">pip install</code>下载任何python包时，你从PyPi中拉出文件夹。最佳实践是首先尝试将您的包上传到<a class="ae jd" href="https://test.pypi.org/" rel="noopener ugc nofollow" target="_blank"> test PyPi </a>中，这是PyPi的一个测试库。如果顺利的话，我们可以把所有东西上传到PyPi。为了上传我们的文件，我们需要在test PyPi和PyPi上创建一个帐户。</p><p id="ee0e" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦每个文件都准备好了，帐户也创建好了，我们需要使用<code class="fe mu mv mw mx b">cd</code>命令导航到pycohort所在的工作目录。然后我们需要运行<code class="fe mu mv mw mx b">python setup.py sdist</code>。这个命令将向我们的存储库添加两个额外的文件，这样我们的包就可以上传到PyPi，也可以从PyPi下载。接下来，我们需要下载<code class="fe mu mv mw mx b">twine</code>包，将我们的文件推送到PyPi存储库。然后我们可以上传我们的包来测试PyPi，并尝试从测试存储库中下载它。如果上传到测试PyPi时没有问题，我们可以转移到常规的PyPi。您可以在下面找到所有必要的代码:</p><pre class="mq mr ms mt gt mz mx na nb aw nc bi"><span id="47bf" class="nd lt jg mx b gy ne nf l ng nh"># navigate to pycohort working directory:<br/>cd pycohort</span><span id="d0eb" class="nd lt jg mx b gy ni nf l ng nh"># download the necessary files to upload your package:<br/>python setup.py sdist</span><span id="1334" class="nd lt jg mx b gy ni nf l ng nh"># install twine package:<br/>pip install twine</span><span id="2805" class="nd lt jg mx b gy ni nf l ng nh"># upload package to test PyPi:<br/>twine upload --repository-url https://test.pypi.org/legacy/ dist/*</span><span id="627f" class="nd lt jg mx b gy ni nf l ng nh"># install from test PyPi:<br/>pip install --index-url https://test.pypi.org/simple/ pycohort</span><span id="cabd" class="nd lt jg mx b gy ni nf l ng nh"># upload package to PyPi:<br/>twine upload dist/*</span><span id="bd61" class="nd lt jg mx b gy ni nf l ng nh"># install from test PyPi:<br/>pip install pycohort</span></pre><h1 id="c98b" class="ls lt jg bd lu lv lw lx ly lz ma mb mc km md kn me kp mf kq mg ks mh kt mi mj bi translated">结论</h1><p id="af06" class="pw-post-body-paragraph kv kw jg kx b ky mk kh la lb ml kk ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">如果您想要直观显示不同群组的保留趋势，这种基于时间的群组分析是一个完美的选择。一旦你的数据是上面解释的格式，那么使用pycohort包就更容易了。</p><p id="3df2" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在对这张图表做出任何决定之前，请记住，这种可视化是基于没有反映分子或分母突然变化的比率。</p><p id="e973" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">请点击这里找到Github repo <a class="ae jd" href="https://github.com/demirkeseny/pycohort" rel="noopener ugc nofollow" target="_blank">，点击这里</a>找到PyPi链接<a class="ae jd" href="https://pypi.org/project/pycohort/" rel="noopener ugc nofollow" target="_blank">，获得关于软件包和功能的更详细的视图。</a></p></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><p id="bb8a" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">特别感谢Gunsu阿尔丁达格所有的灵感！</p></div></div>    
</body>
</html>