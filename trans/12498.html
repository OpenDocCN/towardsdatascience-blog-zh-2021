<html>
<head>
<title>5 Common SQL Problems For You To Crush</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">5 个常见的 SQL 问题让你崩溃</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/5-common-sql-problems-for-you-to-crush-10a796258643?source=collection_archive---------27-----------------------#2021-12-21">https://towardsdatascience.com/5-common-sql-problems-for-you-to-crush-10a796258643?source=collection_archive---------27-----------------------#2021-12-21</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="d90a" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">详细了解这些问题，并了解解决这些问题的方法</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/cd76656e599ab23b5179906bfdd84864.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mEB55qSGEOHH9-E7"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Diana Polekhina 在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="8b4f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对于任何数据科学家来说，拥有出色的 SQL 技能都是一项资产。学习新概念和彻底修改它们都可以通过挑选和解决该领域中的一些常见问题来完成。</p><p id="f8d3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这篇文章中，我将转述 5 个这样的问题，它们是我从 LeetCode 中精选出来的，我将描述他们想要什么，并列出解决它们的方法。带着这些问题，我还希望涵盖一些你应该知道(并修改)的基本概念，以及一些高级的查询方法，这些方法在准备面试时有助于记忆，或者只是增加你的 SQL 知识。</p><p id="48f7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们开始吧👇</p><h1 id="d9b3" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">1.合并两张桌子</h1><p id="dc3d" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated"><strong class="lc iv">问:</strong>您得到了两个表——<code class="fe mt mu mv mw b">Person</code>和<code class="fe mt mu mv mw b">Address</code>，并被要求编写 SQL 查询来报告<code class="fe mt mu mv mw b">Person</code>表中每个人的名字、姓氏、城市和州。</p><p id="2829" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">(如果<code class="fe mt mu mv mw b">personId</code>的地址不在<code class="fe mt mu mv mw b">Address</code>表中，则报告<code class="fe mt mu mv mw b">null</code>。)</p><p id="3992" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://leetcode.com/problems/combine-two-tables/" rel="noopener ugc nofollow" target="_blank">链接到问题。</a></p><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="0ca0" class="nb lx iu mw b gz nc nd l ne nf"><strong class="mw iv">Your Output:</strong> <br/>+-----------+----------+---------------+----------+<br/>| firstName | lastName | city          | state    |<br/>+-----------+----------+---------------+----------+<br/>| Allen     | Wang     | Null          | Null     |<br/>| Bob       | Alice    | New York City | New York |<br/>+-----------+----------+---------------+----------+</span></pre><h2 id="a4e2" class="nb lx iu bd ly ng nh dn mc ni nj dp mg lj nk nl mi ln nm nn mk lr no np mm nq bi translated"><strong class="ak">方法:</strong></h2><p id="addf" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">最简单的解决方法是使用连接的概念。但是，您可能需要决定在这里应该使用哪个连接。</p><p id="e197" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请记住——由于我们需要将城市和州列的值报告为 null，而对于没有该值的行，我们应该直觉地认为这里需要的是左连接。</p><p id="da10" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因此，执行一个简单的左连接，我们可以在 MySQL 中编写以下查询:</p><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="06fd" class="nb lx iu mw b gz nc nd l ne nf">select a.firstName, a.lastName, b.city, b.state <br/>from Person a<br/>left join Address b <br/>on a.personId = b.personId;</span></pre><p id="c24c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，我们需要将 Address 表中的外键与 Person 表进行匹配，以便获得每个人所在的城市和州列。</p><h1 id="eb2e" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">2.从不点餐的顾客</h1><p id="90f7" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated"><strong class="lc iv">问:</strong>问题中有两个表——<code class="fe mt mu mv mw b">Customers</code>和<code class="fe mt mu mv mw b">Orders</code>。您的任务是编写一个 SQL 查询来报告所有从不订购任何东西的客户。</p><p id="e967" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://leetcode.com/problems/customers-who-never-order/" rel="noopener ugc nofollow" target="_blank">链接到问题。</a></p><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="2722" class="nb lx iu mw b gz nc nd l ne nf"><strong class="mw iv">Your output:<br/></strong>+-----------+<br/>| Customers |<br/>+-----------+<br/>| Henry     |<br/>| Max       |<br/>+-----------+</span></pre><h2 id="2f4e" class="nb lx iu bd ly ng nh dn mc ni nj dp mg lj nk nl mi ln nm nn mk lr no np mm nq bi translated">方法:</h2><p id="547a" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated"><strong class="lc iv">1 号</strong>:使用<code class="fe mt mu mv mw b">WHERE NOT EXISTS</code>条款:</p><p id="c6f5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">首先，作为一个子查询，我们希望从 Orders 表中选择 Customers 表中的客户 id 与 Orders 表中的客户 id 相匹配的所有行。这意味着—我们将选择至少下过一次订单的所有客户。</p><p id="3f59" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，在主查询中，我们可以简单地<strong class="lc iv">不选择</strong>那些客户(行)来产生输出。这是借助于 NOT EXISTS 子句完成的。</p><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="6650" class="nb lx iu mw b gz nc nd l ne nf">select c.name as 'Customers' <br/>from Customers c<br/>where not exists<br/>(<br/>    select null <br/>    from Orders o<br/>    where c.id = o.customerId<br/>);</span></pre><p id="574e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv"> No 2: </strong>使用<code class="fe mt mu mv mw b">NOT IN </code>关键字:</p><p id="b006" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">有一种更慢的方法可以做到这一点，我们可以轻松地从 Order 表中选择所有客户 id，并从 Customers 表中选择子查询结果中没有的所有客户。</p><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="0067" class="nb lx iu mw b gz nc nd l ne nf">select c.name as 'Customers'<br/>from Customers c<br/>where c.id not in<br/>(<br/>    select customerId from Orders<br/>);</span></pre><h1 id="d9b4" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">3.第二高的薪水</h1><p id="51fc" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated"><strong class="lc iv">问:</strong>我们的任务是找出给定的<code class="fe mt mu mv mw b">Employee</code>表中第二高的薪水。如果没有第二高的薪水，查询应该输出<code class="fe mt mu mv mw b">null</code>。</p><p id="d288" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://leetcode.com/problems/second-highest-salary/" rel="noopener ugc nofollow" target="_blank">链接到问题。</a></p><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="dfee" class="nb lx iu mw b gz nc nd l ne nf"><strong class="mw iv">Your output:</strong></span><span id="3a95" class="nb lx iu mw b gz nr nd l ne nf">+----+--------+<br/>| Id | Salary |<br/>+----+--------+<br/>| 1  | 100    |<br/>| 2  | 200    |<br/>| 3  | 300    |<br/>+----+--------+</span></pre><h2 id="3021" class="nb lx iu bd ly ng nh dn mc ni nj dp mg lj nk nl mi ln nm nn mk lr no np mm nq bi translated">方法:</h2><p id="2055" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated"><strong class="lc iv"> No 1: </strong>解决这个问题最简单的方法就是借助<code class="fe mt mu mv mw b"><strong class="lc iv">limit</strong></code>和<code class="fe mt mu mv mw b"><strong class="lc iv">offset</strong></code>关键词。</p><p id="bdef" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们将从表中选择所有不同的薪金，按降序对它们进行排序，并将输出限制为 1，因此我们只获得 1 份薪金，最后，我们将降序偏移 1，这意味着我们选择的不是最高的薪金，而是第二高的薪金。大概是这样的:</p><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="6e1a" class="nb lx iu mw b gz nc nd l ne nf">select distinct e.salary as SecondHighestSalary <br/>from Employee e<br/>order by e.salary desc<br/>limit 1 offset 1</span></pre><p id="dbc7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv"> No 2: </strong>另一种解决方法是使用 SQL 中的<code class="fe mt mu mv mw b"><strong class="lc iv">Max()</strong></code> <strong class="lc iv"> </strong>函数。</p><p id="bdf9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在子查询中，我们从雇员表中选择最高工资。最后，我们从这个子查询的输出中选择最大的薪水，并将其作为最终的输出——现在是第二高的薪水。</p><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="0073" class="nb lx iu mw b gz nc nd l ne nf">select max(e.salary) as SecondHighestSalary<br/>from Employee e<br/>where e.salary &lt; (select max(salary) from Employee );</span></pre><h1 id="5932" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">4.重复电子邮件</h1><p id="b44c" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated"><strong class="lc iv">问:</strong>我们被要求根据<code class="fe mt mu mv mw b">Person</code>表找出所有重复的电子邮件。</p><p id="8e69" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">L <a class="ae kz" href="https://leetcode.com/problems/duplicate-emails/" rel="noopener ugc nofollow" target="_blank">墨迹到问题。</a></p><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="f437" class="nb lx iu mw b gz nc nd l ne nf"><strong class="mw iv">Your output:</strong></span><span id="6fe9" class="nb lx iu mw b gz nr nd l ne nf">+---------+<br/>| Email   |<br/>+---------+<br/>| a@b.com |<br/>+---------+</span></pre><h2 id="90bb" class="nb lx iu bd ly ng nh dn mc ni nj dp mg lj nk nl mi ln nm nn mk lr no np mm nq bi translated">方法:</h2><p id="ad4b" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">我们可以通过确保我们理解的第一件事来解决这个问题，即对于选择副本，我们对任何一种电子邮件的计数都应该大于 1。话虽如此，我们只想将电子邮件作为输出，最好的方法是使用“<code class="fe mt mu mv mw b"><strong class="lc iv">Group by</strong></code>”和“<code class="fe mt mu mv mw b"><strong class="lc iv">Having</strong></code>”关键字。</p><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="f3d1" class="nb lx iu mw b gz nc nd l ne nf">select p.email<br/>from Person p<br/>group by email<br/>having count(p.email)  &gt; 1;</span></pre><h1 id="5f7c" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">5.温度上升</h1><p id="c368" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated"><strong class="lc iv">问:</strong>给定<code class="fe mt mu mv mw b">Weather</code>表，我们想要编写一个 SQL 查询来查找与之前的日期相比温度更高的所有日期。</p><p id="cd1b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://leetcode.com/problems/rising-temperature/" rel="noopener ugc nofollow" target="_blank">链接到问题</a>。</p><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="334a" class="nb lx iu mw b gz nc nd l ne nf"><strong class="mw iv">Your output:</strong></span><span id="0979" class="nb lx iu mw b gz nr nd l ne nf">+----+<br/>| id |<br/>+----+<br/>| 2  |<br/>| 4  |<br/>+----+</span></pre><h2 id="4a9b" class="nb lx iu bd ly ng nh dn mc ni nj dp mg lj nk nl mi ln nm nn mk lr no np mm nq bi translated">方法:</h2><p id="09fc" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">问题的核心在于确保相邻的日期不是温度升高的日期。所以，为了解决这个问题，我们可以使用<code class="fe mt mu mv mw b"><strong class="lc iv">Datediff(date1, date2)</strong></code>函数。</p><p id="7210" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，我们只需要在输出表中显示较高的 dateId。因此，在我们的查询中，我们将确保只选择温度较高的日期，例如 w2，如下所示:</p><pre class="kk kl km kn gu mx mw my mz aw na bi"><span id="6fc7" class="nb lx iu mw b gz nc nd l ne nf">select w2.id <br/>from Weather w1, Weather w2<br/>where w2.temperature &gt; w1.temperature<br/>and datediff(w2.recordDate, w1.recordDate) = 1;</span></pre><p id="ea49" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">接下来，我们希望将 w2 温度与之前的实例进行比较，因此我们采用另一个变量 w1。然后，我们应用两个<code class="fe mt mu mv mw b">Where</code>条件:首先，我们确保 w2 的温度高于 w1 的温度。其次，我们确保日期差异只有 1 天。因此，我们已经成功地构建了我们的查询！</p><h1 id="a644" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">几句临别赠言…</h1><p id="a36d" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">这就是 5 个非常值得了解的问题的列表，我希望它有助于您理解或修改编写更好的查询来解决问题的一些核心概念。</p><p id="d6d7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">将来，我会回来撰写更多基于 SQL 的文章。所以<a class="ae kz" href="https://ipom.medium.com/" rel="noopener">跟着我</a>留在圈子里！</p><h2 id="7d86" class="nb lx iu bd ly ng nh dn mc ni nj dp mg lj nk nl mi ln nm nn mk lr no np mm nq bi translated"><a class="ae kz" href="https://ipom.medium.com/membership/" rel="noopener">我还建议成为一名中等会员，不要错过我每周发表的任何一篇数据科学文章。</a>在此加入👇</h2><div class="ns nt gq gs nu nv"><a href="https://ipom.medium.com/membership/" rel="noopener follow" target="_blank"><div class="nw ab fp"><div class="nx ab ny cl cj nz"><h2 class="bd iv gz z fq oa fs ft ob fv fx it bi translated">通过我的推荐链接加入 Medium</h2><div class="oc l"><h3 class="bd b gz z fq oa fs ft ob fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="od l"><p class="bd b dl z fq oa fs ft ob fv fx dk translated">ipom.medium.com</p></div></div><div class="oe l"><div class="of l og oh oi oe oj kt nv"/></div></div></a></div></div><div class="ab cl ok ol hy om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="in io ip iq ir"><h1 id="1edc" class="lw lx iu bd ly lz or mb mc md os mf mg ka ot kb mi kd ou ke mk kg ov kh mm mn bi translated">接通电话！</h1><blockquote class="ow ox oy"><p id="4de3" class="la lb oz lc b ld le jv lf lg lh jy li pa lk ll lm pb lo lp lq pc ls lt lu lv in bi translated"><em class="iu">关注我</em> <a class="ae kz" href="https://twitter.com/csandyash" rel="noopener ugc nofollow" target="_blank"> <em class="iu">推特</em> </a> <em class="iu">。<br/> </em> <a class="ae kz" href="https://github.com/yashprakash13/data-another-day" rel="noopener ugc nofollow" target="_blank"> <em class="iu">查看我所有数据科学帖子的完整代码库！</em> </a></p></blockquote><p id="220f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我的另外几篇文章你可能会感兴趣:</p><div class="ns nt gq gs nu nv"><a rel="noopener follow" target="_blank" href="/the-nice-way-to-deploy-an-ml-model-using-docker-91995f072fe8"><div class="nw ab fp"><div class="nx ab ny cl cj nz"><h2 class="bd iv gz z fq oa fs ft ob fv fx it bi translated">使用 Docker 部署 ML 模型的好方法</h2><div class="oc l"><h3 class="bd b gz z fq oa fs ft ob fv fx dk translated">使用 FastAPI 部署 ML 模型并在 VSCode 中轻松封装它的快速指南。</h3></div><div class="od l"><p class="bd b dl z fq oa fs ft ob fv fx dk translated">towardsdatascience.com</p></div></div><div class="oe l"><div class="pd l og oh oi oe oj kt nv"/></div></div></a></div><div class="ns nt gq gs nu nv"><a href="https://medium.datadriveninvestor.com/5-interesting-data-science-projects-to-level-up-your-portfolio-f4d88c181061" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fp"><div class="nx ab ny cl cj nz"><h2 class="bd iv gz z fq oa fs ft ob fv fx it bi translated">5 个有趣的数据科学项目来提升您的投资组合</h2><div class="oc l"><h3 class="bd b gz z fq oa fs ft ob fv fx dk translated">执行以实际应用为重点的项目来强化你的形象</h3></div><div class="od l"><p class="bd b dl z fq oa fs ft ob fv fx dk translated">medium.datadriveninvestor.com</p></div></div><div class="oe l"><div class="pe l og oh oi oe oj kt nv"/></div></div></a></div></div></div>    
</body>
</html>