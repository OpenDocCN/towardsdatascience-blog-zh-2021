<html>
<head>
<title>How To Add A New Column To An Existing Pandas DataFrame</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何向现有的Pandas数据框架添加新列</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-add-a-new-column-to-an-existing-pandas-dataframe-310a8e7baf8f?source=collection_archive---------1-----------------------#2021-08-18">https://towardsdatascience.com/how-to-add-a-new-column-to-an-existing-pandas-dataframe-310a8e7baf8f?source=collection_archive---------1-----------------------#2021-08-18</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="ec70" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">讨论在熊猫数据框中插入新列的4种方法</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/0fce96fbc03457ffbc869f348f15ff40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7zpK3coHcKguXYNKb00HLQ.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><a class="ae kz" href="https://unsplash.com/@suetxxuan?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">猪八戒</a>在<a class="ae kz" href="https://unsplash.com/s/photos/insert?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><h2 id="f1a5" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">介绍</h2><p id="045a" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">在今天的简短指南中，我们将讨论向数据帧中添加新列的四种不同方法。具体来说，我们将探索如何</p><ul class=""><li id="d4f0" class="mp mq iu ly b lz mr mc ms lj mt ln mu lr mv mo mw mx my mz bi translated">一次插入一列或多列</li><li id="19b8" class="mp mq iu ly b lz na mc nb lj nc ln nd lr ne mo mw mx my mz bi translated">覆盖现有列</li><li id="cdbc" class="mp mq iu ly b lz na mc nb lj nc ln nd lr ne mo mw mx my mz bi translated">通过考虑索引来添加列</li><li id="58d8" class="mp mq iu ly b lz na mc nb lj nc ln nd lr ne mo mw mx my mz bi translated">通过忽略索引来插入列</li><li id="e05d" class="mp mq iu ly b lz na mc nb lj nc ln nd lr ne mo mw mx my mz bi translated">添加具有重复名称的列</li><li id="8ab8" class="mp mq iu ly b lz na mc nb lj nc ln nd lr ne mo mw mx my mz bi translated">在指定位置插入列</li></ul><p id="0315" class="pw-post-body-paragraph lw lx iu ly b lz mr jv mb mc ms jy me lj nf mg mh ln ng mj mk lr nh mm mn mo in bi translated">采用简单赋值、<code class="fe ni nj nk nl b">insert()</code>、<code class="fe ni nj nk nl b">assign()</code>和<code class="fe ni nj nk nl b">concat()</code>的方法。</p></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><p id="30d5" class="pw-post-body-paragraph lw lx iu ly b lz mr jv mb mc ms jy me lj nf mg mh ln ng mj mk lr nh mm mn mo in bi translated">首先，让我们创建一个示例DataFrame，我们将在本指南中引用它来演示一些与向pandas框架添加列相关的概念。</p><pre class="kk kl km kn gu nt nl nu nv aw nw bi"><span id="b33a" class="la lb iu nl b gz nx ny l nz oa">import pandas as pd</span><span id="f27a" class="la lb iu nl b gz ob ny l nz oa"><br/>df = pd.DataFrame({<br/>    'colA':[True, False, False], <br/>    'colB': [1, 2, 3],<br/>})</span><span id="bacf" class="la lb iu nl b gz ob ny l nz oa">print(df)</span><span id="37b9" class="la lb iu nl b gz ob ny l nz oa"><em class="oc">    colA  colB<br/>0   True     1<br/>1  False     2<br/>2  False     3</em></span></pre><p id="31c5" class="pw-post-body-paragraph lw lx iu ly b lz mr jv mb mc ms jy me lj nf mg mh ln ng mj mk lr nh mm mn mo in bi translated">最后，假设我们需要插入一个名为<code class="fe ni nj nk nl b">colC</code>的新列，该列应该包含值<code class="fe ni nj nk nl b">'a'</code>、<code class="fe ni nj nk nl b">'b'</code>和<code class="fe ni nj nk nl b">'c'</code>，分别表示索引<code class="fe ni nj nk nl b">0</code>、<code class="fe ni nj nk nl b">1</code>和<code class="fe ni nj nk nl b">3</code>。</p><pre class="kk kl km kn gu nt nl nu nv aw nw bi"><span id="792c" class="la lb iu nl b gz nx ny l nz oa">s = pd.Series(['a', 'b', 'c'], index=[0, 1, 2])<br/>print(s)</span><span id="7a50" class="la lb iu nl b gz ob ny l nz oa"><em class="oc">0    a<br/>1    b<br/>2    c<br/>dtype: object</em></span></pre></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><h2 id="a823" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用简单赋值</h2><p id="e3ac" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">插入新列的最简单方法是简单地将<code class="fe ni nj nk nl b">Series</code>的值分配到现有帧中:</p><pre class="kk kl km kn gu nt nl nu nv aw nw bi"><span id="9b4a" class="la lb iu nl b gz nx ny l nz oa"><strong class="nl iv">df['colC'] = s.values</strong></span><span id="8368" class="la lb iu nl b gz ob ny l nz oa">print(df)</span><span id="ca34" class="la lb iu nl b gz ob ny l nz oa"><em class="oc">    colA  colB colC<br/>0   True     1    a<br/>1  False     2    b<br/>2  False     3    c</em></span></pre><p id="d348" class="pw-post-body-paragraph lw lx iu ly b lz mr jv mb mc ms jy me lj nf mg mh ln ng mj mk lr nh mm mn mo in bi translated">请注意，假设新列的索引与数据帧的索引相匹配，上述方法适用于大多数情况，否则<code class="fe ni nj nk nl b">NaN</code>值将被分配给缺失的索引。举个例子，</p><pre class="kk kl km kn gu nt nl nu nv aw nw bi"><span id="2580" class="la lb iu nl b gz nx ny l nz oa">df['colC'] = pd.Series(['a', 'b', 'c'], index=[1, 2, 3])<br/>print(df)</span><span id="5861" class="la lb iu nl b gz ob ny l nz oa"><em class="oc">     colA  colB colC<br/>0   True     1  NaN<br/>1  False     2    a<br/>2  False     3    b</em></span></pre></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><h2 id="404a" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用assign()</h2><p id="23d1" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">当您需要在一个数据帧中<strong class="ly iv">插入多个新列</strong>时，可以使用<code class="fe ni nj nk nl b"><a class="ae kz" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.assign.html" rel="noopener ugc nofollow" target="_blank">pandas.DataFrame.assign()</a></code>方法；当您需要忽略要添加的列的索引时，可以使用<strong class="ly iv">方法；当您需要覆盖现有列的值时，可以使用</strong>或<strong class="ly iv">方法。</strong></p><p id="2cdc" class="pw-post-body-paragraph lw lx iu ly b lz mr jv mb mc ms jy me lj nf mg mh ln ng mj mk lr nh mm mn mo in bi translated">该方法将返回一个新的DataFrame对象(副本),其中包含所有原始列和新列:</p><pre class="kk kl km kn gu nt nl nu nv aw nw bi"><span id="961e" class="la lb iu nl b gz nx ny l nz oa">e = pd.Series([1.0, 3.0, 2.0], index=[0, 2, 1])<br/>s = pd.Series(['a', 'b', 'c'], index=[0, 1, 2])</span><span id="937c" class="la lb iu nl b gz ob ny l nz oa"><strong class="nl iv">df.assign(colC=s.values, colB=e.values)</strong></span><span id="ee23" class="la lb iu nl b gz ob ny l nz oa">     colA  colB colC<br/>0   True   1.0    a<br/>1  False   3.0    b<br/>2  False   2.0    c</span></pre><p id="6d80" class="pw-post-body-paragraph lw lx iu ly b lz mr jv mb mc ms jy me lj nf mg mh ln ng mj mk lr nh mm mn mo in bi translated">永远记住用<em class="oc">分配</em>:</p><ul class=""><li id="5e4f" class="mp mq iu ly b lz mr mc ms lj mt ln mu lr mv mo mw mx my mz bi translated">忽略要添加的列的索引</li><li id="4955" class="mp mq iu ly b lz na mc nb lj nc ln nd lr ne mo mw mx my mz bi translated">所有重新分配的现有列都将被覆盖</li></ul></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><h2 id="63e4" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用insert()</h2><p id="7ff9" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">或者，也可以使用<code class="fe ni nj nk nl b"><a class="ae kz" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.insert.html" rel="noopener ugc nofollow" target="_blank">pandas.DataFrame.insert()</a></code>。这种方法通常在需要<strong class="ly iv">在特定位置或索引</strong>插入新列时有用。</p><p id="a09d" class="pw-post-body-paragraph lw lx iu ly b lz mr jv mb mc ms jy me lj nf mg mh ln ng mj mk lr nh mm mn mo in bi translated">例如，要将<code class="fe ni nj nk nl b">colC</code>添加到数据帧的末尾:</p><pre class="kk kl km kn gu nt nl nu nv aw nw bi"><span id="b085" class="la lb iu nl b gz nx ny l nz oa"><strong class="nl iv">df.insert(len(df.columns), 'colC', s.values)</strong></span><span id="51f3" class="la lb iu nl b gz ob ny l nz oa">print(df)<br/><em class="oc">    colA  colB colC<br/>0   True     1    a<br/>1  False     2    b<br/>2  False     3    c</em></span></pre><p id="19a9" class="pw-post-body-paragraph lw lx iu ly b lz mr jv mb mc ms jy me lj nf mg mh ln ng mj mk lr nh mm mn mo in bi translated">在<code class="fe ni nj nk nl b">colA</code>和<code class="fe ni nj nk nl b">colB</code>之间插入<code class="fe ni nj nk nl b">colC</code>:</p><pre class="kk kl km kn gu nt nl nu nv aw nw bi"><span id="726c" class="la lb iu nl b gz nx ny l nz oa">df.insert(1, 'colC', s.values)</span><span id="c0f7" class="la lb iu nl b gz ob ny l nz oa">print(df)</span><span id="d895" class="la lb iu nl b gz ob ny l nz oa"><em class="oc">    colA colC  colB<br/>0   True    a     1<br/>1  False    b     2<br/>2  False    c     3</em></span></pre><p id="b018" class="pw-post-body-paragraph lw lx iu ly b lz mr jv mb mc ms jy me lj nf mg mh ln ng mj mk lr nh mm mn mo in bi translated">另外，<code class="fe ni nj nk nl b">insert()</code>甚至可以用来添加一个重复的列名。默认情况下，当DataFrame中已经存在一列时，会引发一个<code class="fe ni nj nk nl b">ValueError</code>:</p><pre class="kk kl km kn gu nt nl nu nv aw nw bi"><span id="8465" class="la lb iu nl b gz nx ny l nz oa">df.insert(1, 'colC', s.values)<br/>df.insert(1, 'colC', s.values)</span><span id="863a" class="la lb iu nl b gz ob ny l nz oa"><strong class="nl iv">ValueError: cannot insert colC, already exists</strong></span></pre><p id="e672" class="pw-post-body-paragraph lw lx iu ly b lz mr jv mb mc ms jy me lj nf mg mh ln ng mj mk lr nh mm mn mo in bi translated">但是，如果将<code class="fe ni nj nk nl b">allow_duplicates=True</code>传递给<code class="fe ni nj nk nl b">insert()</code>方法，DataFrame将有两列同名:</p><pre class="kk kl km kn gu nt nl nu nv aw nw bi"><span id="3966" class="la lb iu nl b gz nx ny l nz oa">df.insert(1, 'colC', s.values)<br/>df.insert(1, 'colC', s.values, allow_duplicates=True)</span><span id="79f3" class="la lb iu nl b gz ob ny l nz oa">print(df)<br/><em class="oc">    colA colC colC  colB<br/>0   True    a    a     1<br/>1  False    b    b     2<br/>2  False    c    c     3</em></span></pre></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><h2 id="719b" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用concat()</h2><p id="4f7d" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">最后，<code class="fe ni nj nk nl b"><a class="ae kz" href="https://pandas.pydata.org/docs/reference/api/pandas.concat.html" rel="noopener ugc nofollow" target="_blank">pandas.concat()</a></code>方法还可以用于通过传递<code class="fe ni nj nk nl b">axis=1</code>将新列连接到DataFrame。这个方法返回一个新的数据帧，它是连接的结果。</p><pre class="kk kl km kn gu nt nl nu nv aw nw bi"><span id="39d7" class="la lb iu nl b gz nx ny l nz oa"><strong class="nl iv">df = pd.concat([df, s.rename('colC')], axis=1)</strong></span><span id="1cc1" class="la lb iu nl b gz ob ny l nz oa">print(df)<br/><em class="oc">    colA  colB colC<br/>0   True     1    a<br/>1  False     2    b<br/>2  False     3    c</em></span></pre><p id="f75d" class="pw-post-body-paragraph lw lx iu ly b lz mr jv mb mc ms jy me lj nf mg mh ln ng mj mk lr nh mm mn mo in bi translated">上述操作将使用索引将序列与原始数据帧连接起来。在大多数情况下，如果要连接的对象的索引彼此匹配，您应该使用<code class="fe ni nj nk nl b">concat()</code>。如果索引不匹配，则每个对象的所有索引都将出现在结果中:</p><pre class="kk kl km kn gu nt nl nu nv aw nw bi"><span id="4fea" class="la lb iu nl b gz nx ny l nz oa">s = pd.Series(['a', 'b', 'c'], index=[10, 20, 30])<br/>df = pd.concat([df, s.rename('colC')], axis=1)</span><span id="bf50" class="la lb iu nl b gz ob ny l nz oa">print(df)<br/><em class="oc">     colA  colB colC<br/>0    True   1.0  NaN<br/>1   False   2.0  NaN<br/>2   False   3.0  NaN<br/>10    NaN   NaN    a<br/>20    NaN   NaN    b<br/>30    NaN   NaN    c</em></span></pre></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><h2 id="8438" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">更改要添加的列的索引</h2><p id="ea0f" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">向数据帧添加新列时，最棘手的部分之一是索引。您应该小心，因为我们在本指南中讨论的每种方法都可能以不同的方式处理索引。</p><p id="1669" class="pw-post-body-paragraph lw lx iu ly b lz mr jv mb mc ms jy me lj nf mg mh ln ng mj mk lr nh mm mn mo in bi translated">如果由于任何原因，要添加的新列的索引没有任何特殊意义，并且您不希望在插入时考虑它，您甚至可以指定<code class="fe ni nj nk nl b">Series</code>的索引与数据帧的索引相同。</p><pre class="kk kl km kn gu nt nl nu nv aw nw bi"><span id="4063" class="la lb iu nl b gz nx ny l nz oa">s = pd.Series(['a', 'b', 'c'], <strong class="nl iv">index=df.index)</strong></span></pre></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><h2 id="ded5" class="la lb iu bd lc ld le dn lf lg lh dp li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">最后的想法</h2><p id="913a" class="pw-post-body-paragraph lw lx iu ly b lz ma jv mb mc md jy me lj mf mg mh ln mi mj mk lr ml mm mn mo in bi translated">在今天的简短指南中，我们讨论了在pandas数据框架中插入新列或覆盖现有列的4种方法。我们已经看到了如何使用简单赋值、<code class="fe ni nj nk nl b">assign()</code>、<code class="fe ni nj nk nl b">insert()</code>和<code class="fe ni nj nk nl b">concat()</code>方法来插入或覆盖新列。</p><p id="bfd0" class="pw-post-body-paragraph lw lx iu ly b lz mr jv mb mc ms jy me lj nf mg mh ln ng mj mk lr nh mm mn mo in bi translated">此外，我们讨论了基于您想要实现的最终目标，您应该何时使用每种方法(例如，如果您想要忽略或考虑要添加的新列的索引)。</p><p id="f88d" class="pw-post-body-paragraph lw lx iu ly b lz mr jv mb mc ms jy me lj nf mg mh ln ng mj mk lr nh mm mn mo in bi translated">插入新列时，您必须选择最合适的方法，因为当新列和现有框架的索引不匹配时，每个列可能会有不同的行为。</p></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><p id="a1e6" class="pw-post-body-paragraph lw lx iu ly b lz mr jv mb mc ms jy me lj nf mg mh ln ng mj mk lr nh mm mn mo in bi translated"><a class="ae kz" href="https://gmyrianthous.medium.com/membership" rel="noopener"> <strong class="ly iv">成为会员</strong> </a> <strong class="ly iv">阅读介质上的每一个故事。你的会员费直接支持我和你看的其他作家。</strong></p></div><div class="ab cl nm nn hy no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="in io ip iq ir"><p id="676e" class="pw-post-body-paragraph lw lx iu ly b lz mr jv mb mc ms jy me lj nf mg mh ln ng mj mk lr nh mm mn mo in bi translated"><strong class="ly iv">你可能也会喜欢</strong></p><div class="od oe gq gs of og"><a rel="noopener follow" target="_blank" href="/whats-the-difference-between-static-and-class-methods-in-python-1ef581de4351"><div class="oh ab fp"><div class="oi ab oj cl cj ok"><h2 class="bd iv gz z fq ol fs ft om fv fx it bi translated">Python中静态方法和类方法有什么区别？</h2><div class="on l"><h3 class="bd b gz z fq ol fs ft om fv fx dk translated">关于classmethod和staticmethod，您只需要知道</h3></div><div class="oo l"><p class="bd b dl z fq ol fs ft om fv fx dk translated">towardsdatascience.com</p></div></div><div class="op l"><div class="oq l or os ot op ou kt og"/></div></div></a></div><div class="od oe gq gs of og"><a rel="noopener follow" target="_blank" href="/whats-the-difference-between-shallow-and-deep-copies-in-python-ceee1e061926"><div class="oh ab fp"><div class="oi ab oj cl cj ok"><h2 class="bd iv gz z fq ol fs ft om fv fx it bi translated">Python中浅拷贝和深拷贝有什么区别？</h2><div class="on l"><h3 class="bd b gz z fq ol fs ft om fv fx dk translated">Python中的copy()与deepcopy()</h3></div><div class="oo l"><p class="bd b dl z fq ol fs ft om fv fx dk translated">towardsdatascience.com</p></div></div><div class="op l"><div class="ov l or os ot op ou kt og"/></div></div></a></div><div class="od oe gq gs of og"><a rel="noopener follow" target="_blank" href="/6-tips-to-help-you-stand-out-as-a-python-developer-2294d15672e9"><div class="oh ab fp"><div class="oi ab oj cl cj ok"><h2 class="bd iv gz z fq ol fs ft om fv fx it bi translated">帮助你脱颖而出成为Python开发者的6个技巧</h2><div class="on l"><h3 class="bd b gz z fq ol fs ft om fv fx dk translated">Python开发人员和数据科学家的实用技巧</h3></div><div class="oo l"><p class="bd b dl z fq ol fs ft om fv fx dk translated">towardsdatascience.com</p></div></div><div class="op l"><div class="ow l or os ot op ou kt og"/></div></div></a></div></div></div>    
</body>
</html>