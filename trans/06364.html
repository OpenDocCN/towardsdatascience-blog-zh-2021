<html>
<head>
<title>Python Tricks: “is” or “==”</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python招数:“是”还是“==”</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-tricks-is-or-1033eddafa4?source=collection_archive---------45-----------------------#2021-06-07">https://towardsdatascience.com/python-tricks-is-or-1033eddafa4?source=collection_archive---------45-----------------------#2021-06-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6682" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个存在性问题背后的答案，用python写的！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b90b4f8bd3d3ecd5ae613557ae314a16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iDJfZMrtaWxjttS_9nhLRA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="557f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你有没有收到过Pycharm的警告说:</p><blockquote class="lu lv lw"><p id="017c" class="ky kz lx la b lb lc ju ld le lf jx lg ly li lj lk lz lm ln lo ma lq lr ls lt im bi translated">使用相等运算符执行与None的比较</p></blockquote><p id="25e8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">想知道为什么？</p><p id="fe6c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好了，今天我们要彻底揭开这个秘密！</p><p id="5c67" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">做好准备，这实际上是一个相当深刻的问题，可能会让你质疑生命的意义。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h2 id="2f51" class="mi mj it bd mk ml mm dn mn mo mp dp mq lh mr ms mt ll mu mv mw lp mx my mz na bi translated">是Python吗？</h2><blockquote class="lu lv lw"><p id="c4da" class="ky kz lx la b lb lc ju ld le lf jx lg ly li lj lk lz lm ln lo ma lq lr ls lt im bi translated">是的是的是的。</p></blockquote><p id="0826" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">众所周知，Python有两个操作符:“is”和“==”，在许多常规情况下，它们会产生相同的结果。但是，如果不了解它们之间的区别，您可能会遇到一些令人费解的错误，这些错误会让您绞尽脑汁几个小时。</p><p id="9cb3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里有一个例子:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="2fc0" class="mi mj it nc b gy ng nh l ni nj">from copy import copy<br/><br/><br/>def compare(a, b):<br/><br/>    print("--- compare a and b")<br/>    print(f"id(a): {id(a)}")<br/>    print(f"id(b): {id(b)}")<br/><br/>    print(f"a == a: {a == a}")<br/>    print(f"a == b: {a == b}")<br/>    print(f"a is a: {a is a}")<br/>    print(f"a is b: {a is b}")<br/><br/><br/>class Python:<br/>    def __init__(self, size):<br/>        self.size = size<br/><br/>    def __eq__(self, other):<br/>        return self.size == other.size<br/><br/><br/>print('test 1')<br/>a = Python(5)<br/>b = Python(6)<br/>compare(a, b)<br/><br/>print('test 2')<br/>a = Python(5)<br/>b = Python(5)<br/>compare(a, b)<br/><br/>print('test 3')<br/>a = Python(5)<br/>b = copy(a)<br/>compare(a, b)<br/><br/>print('test 4')<br/>a = Python(5)<br/>b = a<br/>compare(a, b)</span></pre><p id="552c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们有一个非常简单的类，叫做Python，它有一个“__eq__”操作符，如果要比较的另一个对象有相同的大小，它返回True。</p><p id="8456" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">测试1:实例化两条大小分别为5、6的Pythons。</p><p id="ca16" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">测试2:实例化两条大小为5的蟒蛇。</p><p id="f18f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">测试3:为a实例化一个Python，为b制作一个副本。</p><p id="73ab" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">测试4，为a实例化一个Python，然后赋给b。</p><p id="f938" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是结果:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="962b" class="mi mj it nc b gy ng nh l ni nj">test 1<br/>--- compare a and b<br/>id(a): 2810649485760<br/>id(b): 2810649485664<br/>a == a: True<br/><strong class="nc iu">a == b: False</strong> # different sizes<br/>a is a: True<br/>a is b: False<br/>test 2<br/>--- compare a and b<br/>id(a): 2810648609840<br/>id(b): 2810648608832<br/>a == a: True<br/><strong class="nc iu">a == b: True</strong><br/>a is a: True<br/>a is b: False<br/>test 3<br/>--- compare a and b<br/><strong class="nc iu">id(a): 2810649485760<br/>id(b): 2810649485808 # different ids</strong><br/>a == a: True<br/>a == b: True<br/>a is a: True<br/><strong class="nc iu">a is b: False</strong><br/>test 4<br/>--- compare a and b<br/><strong class="nc iu">id(a): 2810648609840<br/>id(b): 2810648609840</strong> # same ids<br/>a == a: True<br/>a == b: True<br/>a is a: True<br/><strong class="nc iu">a is b: True</strong></span></pre><p id="31a9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">查看测试1和测试2的结果，我们注意到“a == b”对于测试1为假，而对于测试2为真。这是可以理解的，因为python a和b对于test 1有不同的大小。</p><p id="9e27" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">查看测试3和测试4的结果，我们看到“a是b”对于测试3为假，但是对于测试4为真。这很奇怪，因为在测试3和测试4中，a和b的大小都是5。但是看一下a和b的id，在测试3中，id是不同的，而在测试4中它们是相同的。</p><p id="874f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从这些测试中，我们可以得出结论:</p><p id="032a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">“= =”运算符调用“__eq__”函数确定相等，而“is”运算符比较对象id确定相等。</strong></p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h2 id="fb25" class="mi mj it bd mk ml mm dn mn mo mp dp mq lh mr ms mt ll mu mv mw lp mx my mz na bi translated">Python是龙吗？</h2><blockquote class="lu lv lw"><p id="c13f" class="ky kz lx la b lb lc ju ld le lf jx lg ly li lj lk lz lm ln lo ma lq lr ls lt im bi translated">依赖</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/d94182bc355745fcdee9dcd0d2f2174d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CNujN9EsJivCBwOb8DMUhw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">蟒蛇是龙吗？(图片由作者提供)</p></figure><p id="a508" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们定义另一个类Dragon，并与python进行比较:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="1bf8" class="mi mj it nc b gy ng nh l ni nj">class Dragon:<br/>    def __init__(self, size):<br/>        self.size = size<br/><br/><br/>print('test 5')<br/>a = Python(5)<br/>b = Dragon(5)<br/>compare(a, b)<br/><br/>print('test 6')<br/>a = Dragon(5)<br/>b = Python(5)<br/>compare(a, b)<br/><br/>print('test 7')<br/>a = Dragon(5)<br/>b = Dragon(5)<br/>compare(a, b)</span></pre><p id="13ce" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">结果:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="62ce" class="mi mj it nc b gy ng nh l ni nj">test 5<br/>--- compare a and b<br/>id(a): 2810649489264<br/>id(b): 2810649488544<br/>a == a: True<br/><strong class="nc iu">a == b: True</strong><br/>a is a: True<br/>a is b: False<br/>test 6<br/>--- compare a and b<br/>id(a): 2810648806784<br/>id(b): 2810648806112<br/>a == a: True<br/><strong class="nc iu">a == b: True</strong><br/>a is a: True<br/>a is b: False<br/>test 7<br/>--- compare a and b<br/>id(a): 2810649489264<br/>id(b): 2810649488544<br/>a == a: True<br/><strong class="nc iu">a == b: False</strong><br/>a is a: True<br/>a is b: False</span></pre><p id="f534" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">“is”的结果和预期的一样，它对三种情况都是假的，因为每种情况下的id都不同。</p><p id="d631" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">“==”的结果有点奇怪，在所有三种情况下，dragon和python的大小都是5，但是当我们使用“python == dragon”和“dragon == python”时，结果是真的，而“dragon == dragon”是假的。</p><p id="df5a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这实际上是由于Python和Dragon类是如何定义的。仔细看，我们看到Dragon没有定义“__eq__”操作符。这意味着当我们测试“python == dragon”和“dragon == python”时，调用了python的“__eq__”运算符，但是当我们测试“dragon == dragon”时，由于两边都没有“__eq__”运算符，所以比较默认为“is”，它比较两条龙的id，结果为false。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/0635d220004baef95f2bcb84dcf107bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vrer5BhO-31ZoaOxITEsKw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">龙，双倍大(图片由作者提供)</p></figure><p id="fc69" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们为Dragon定义一个“__eq__”操作符，情况会变得更加有趣:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="5948" class="mi mj it nc b gy ng nh l ni nj">class Dragon2:<br/>    def __init__(self, size):<br/>        self.size = size<br/><br/>    def __eq__(self, other):<br/>        return self.size * 2 == other.size<br/><br/><br/>print('test 8')<br/>a = Python(5)<br/>b = Dragon2(5)<br/>compare(a, b)<br/><br/>print('test 9')<br/>a = Dragon2(5)<br/>b = Python(5)<br/>compare(a, b)</span></pre><p id="ebba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">龙是一个自负的物种，当他们和别人比较时，他们想象自己是两倍大:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="bdc5" class="mi mj it nc b gy ng nh l ni nj">test 8<br/>--- compare a and b<br/>id(a): 2810649486096<br/>id(b): 2810649487920<br/>a == a: True<br/><strong class="nc iu">a == b: True</strong><br/>a is a: True<br/>a is b: False<br/>test 9<br/>--- compare a and b<br/>id(a): 2810628730688<br/>id(b): 2810649488544<br/>a == a: False<br/><strong class="nc iu">a == b: False</strong><br/>a is a: True<br/>a is b: False</span></pre><p id="d5d4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">所以在这种情况下“Python(5) == Dragon2(5)”产生true，而“Dragon2(5) == Python(5)”产生false！</strong></p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h2 id="ecb5" class="mi mj it bd mk ml mm dn mn mo mp dp mq lh mr ms mt ll mu mv mw lp mx my mz na bi translated">0等于0吗？</h2><blockquote class="lu lv lw"><p id="2fb1" class="ky kz lx la b lb lc ju ld le lf jx lg ly li lj lk lz lm ln lo ma lq lr ls lt im bi translated">总是</p></blockquote><p id="6404" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">既然我们已经了解了“是”和“==”是如何工作的，那么让我们来测试一个重要的默认类型，整数:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="1f97" class="mi mj it nc b gy ng nh l ni nj">print('test 10')<br/>a = int(0)<br/>b = int(0)<br/>compare(a, b)</span><span id="a905" class="mi mj it nc b gy nm nh l ni nj">print('test 11')<br/>a = int(0)<br/>b = a<br/>compare(a, b)</span><span id="bbdd" class="mi mj it nc b gy nm nh l ni nj">print('test 12')<br/>a = int(0)<br/>b = copy(a)<br/>compare(a, b)</span></pre><p id="dd57" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">结果:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="29af" class="mi mj it nc b gy ng nh l ni nj">test 10<br/>--- compare a and b<br/>id(a): 2810573515184<br/>id(b): 2810573515184<br/>a == a: True<br/>a == b: True<br/>a is a: True<br/>a is b: True<br/>test 11<br/>--- compare a and b<br/>id(a): 2810573515184<br/>id(b): 2810573515184<br/>a == a: True<br/>a == b: True<br/>a is a: True<br/>a is b: True<br/>test 12<br/>--- compare a and b<br/>id(a): 2810573515184<br/>id(b): 2810573515184<br/>a == a: True<br/>a == b: True<br/>a is a: True<br/>a is b: True</span></pre><p id="6c6a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你看，python的创造者们一直在努力向你隐藏“是”和“==”之间的区别。F <strong class="la iu">或整数，只要值相同，使用“is”和“==”结果没有区别。</strong></p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h2 id="0488" class="mi mj it bd mk ml mm dn mn mo mp dp mq lh mr ms mt ll mu mv mw lp mx my mz na bi translated">是没有还是等于没有？</h2><blockquote class="lu lv lw"><p id="ad22" class="ky kz lx la b lb lc ju ld le lf jx lg ly li lj lk lz lm ln lo ma lq lr ls lt im bi translated">让我们不要迷惑自己</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/f7b4916bc96a1649f5fe90a1242470d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mdAux0oRGEericfxepi4Lg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Pycharm警告无比较(图片由作者提供)</p></figure><p id="bcce" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">让我们来看看None，那么为什么Pycharm警告你在与None比较时不要使用“== ”?</strong></p><p id="cbda" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">真的是为了保护你不犯粗心的错误。</strong>因为None是一个常量，它总是只有一个实例，所以没有理由使用“==”操作符，它试图调用“__eq__”操作符，除非你真的想做一些奇怪的事情，如下所示:</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="4832" class="mi mj it nc b gy ng nh l ni nj">class EndOfWorld:<br/>    def __eq__(self, other):<br/>        return other is None<br/><br/>a = EndOfWorld()<br/>a == None<br/># Out[58]: True</span></pre></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h2 id="b129" class="mi mj it bd mk ml mm dn mn mo mp dp mq lh mr ms mt ll mu mv mw lp mx my mz na bi translated">忒修斯之船</h2><blockquote class="lu lv lw"><p id="e091" class="ky kz lx la b lb lc ju ld le lf jx lg ly li lj lk lz lm ln lo ma lq lr ls lt im bi translated">让我们谈谈哲学</p></blockquote><p id="23ae" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以，python的创造者们似乎做出了一个决定，每个对象都有一个id，如果id相同，那么两个对象就是彼此。这与“忒修斯之船”的思想实验有着有趣的相似之处，在这个实验中，身份的问题是通过询问一艘所有组件都被替换的船是否仍然是同一艘船而提出的。</p><p id="e606" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">参见维基上的<a class="ae no" href="https://en.wikipedia.org/wiki/Ship_of_Theseus" rel="noopener ugc nofollow" target="_blank">忒修斯的船</a>。</p><p id="20da" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">事实证明，你只需要一张身份证！</p><p id="4388" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">(我的id是什么？)</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h2 id="fcd2" class="mi mj it bd mk ml mm dn mn mo mp dp mq lh mr ms mt ll mu mv mw lp mx my mz na bi translated">结论</h2><p id="6d4e" class="pw-post-body-paragraph ky kz it la b lb np ju ld le nq jx lg lh nr lj lk ll ns ln lo lp nt lr ls lt im bi translated">我希望我的读者在学习python对象标识比较的细微差别时度过了一段美好的时光。这些概念不是python独有的，它们以引用和指针的形式存在于C和C++中，类似地，在许多其他语言中也存在，所以值得花时间去理解细节以避免错误。</p><p id="6894" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">尽管在编程语言的抽象世界中给每样东西分配一个id是相当容易的，但是在现实生活中给对象分配一个id却不那么容易，你认为呢？</p></div></div>    
</body>
</html>