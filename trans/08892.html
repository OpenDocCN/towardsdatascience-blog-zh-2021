<html>
<head>
<title>Transcribing Twilio recordings using the Twilio API and AssemblyAI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Twilio API和AssemblyAI转录Twilio录音</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/transcribing-twilio-recordings-using-the-twilio-api-and-assemblyai-4daf25fa32f0?source=collection_archive---------36-----------------------#2021-08-16">https://towardsdatascience.com/transcribing-twilio-recordings-using-the-twilio-api-and-assemblyai-4daf25fa32f0?source=collection_archive---------36-----------------------#2021-08-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4ad7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我们将使用Twilio API和AssemblyAI API</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6cfa0a8c1700d768949c8724c0ae4619.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zh8js6npVT1g58yz-o1_1w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@quinoal?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">奎诺·阿尔</a>在<a class="ae ky" href="https://unsplash.com/s/photos/phone?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="e8aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我们将使用<a class="ae ky" href="https://docs.assemblyai.com/overview/getting-started" rel="noopener ugc nofollow" target="_blank"> AssemblyAI的API </a>用Twilio转录一段通话记录。我们将使用Python来编写脚本。我们将讨论以下内容</p><ul class=""><li id="bb2a" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">我们将使用的库/API</li><li id="f2f4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">设置环境和文件结构</li><li id="57d5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">使用twilio API</li><li id="206b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">使用AssemblyAI API</li><li id="fe9b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">转录录音</li></ul><h1 id="0c2c" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">要求</h1><ul class=""><li id="cfc9" class="lv lw it lb b lc nb lf nc li nd lm ne lq nf lu ma mb mc md bi translated">Python的基础知识</li><li id="0d32" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">虽然不是必需的，但是熟悉请求库将会有所帮助</li></ul><h1 id="df4f" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">GitHub回购链接</h1><p id="0bfb" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">你可以在这里找到完整的<a class="ae ky" href="https://github.com/rahulbanerjee26/twilio_assemblyai" rel="noopener ugc nofollow" target="_blank">源代码</a></p><h1 id="39ea" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">我们将使用的库/API</h1><h1 id="9df7" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">特维利奥</h1><p id="d572" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">Twilio 是一项让你使用API拨打/接听电话和短信的服务。Twilio还为他们的API提供了一个官方的<a class="ae ky" href="https://pypi.org/project/twilio/" rel="noopener ugc nofollow" target="_blank">包装器</a>。包装器使得与他们的API通信更加容易。在本教程中，我们将使用它们的包装器。<a class="ae ky" href="https://medium.com/hackernoon/using-twilio-to-send-sms-texts-via-python-flask-and-ngrok-9874b54a0d3" rel="noopener">Jovan Hernandez</a><a class="nj nk ep" href="https://medium.com/u/3cd0a0ff5636?source=post_page-----4daf25fa32f0--------------------------------" rel="noopener" target="_blank">撰写的这篇文章</a>讲述了如何使用Twilio和Python。</p><h1 id="1600" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">AssemblyAI</h1><p id="c988" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated"><a class="ae ky" href="https://docs.assemblyai.com/overview/getting-started" rel="noopener ugc nofollow" target="_blank"> AssemblyAI </a>可以将音频转换成文本。它提供了一个任何现代编程语言都可以使用的REST API。例如:Python，JavaScript，PHP等。</p><h1 id="bcae" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">要求</h1><p id="7001" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">我们将使用<a class="ae ky" href="https://requests.readthedocs.io/" rel="noopener ugc nofollow" target="_blank">请求库</a>向AssemblyAI的REST API发出请求。阅读亚当·斯奈德<a class="nj nk ep" href="https://medium.com/u/4f07b5458966?source=post_page-----4daf25fa32f0--------------------------------" rel="noopener" target="_blank">的文章</a>来学习更多关于在Python中使用请求的知识。</p><h1 id="7f05" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">Python-dotenv</h1><p id="7ce1" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">为了遵循最佳实践，我们将在一个. env文件中存储我们的凭据和电话号码。Python-dotenv库帮助我们从。环境文件</p><h1 id="f8de" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">设置环境和文件结构</h1><h1 id="086e" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">创建必要的文件</h1><p id="67b8" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">使用命令行创建新的文件夹/目录</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="1b98" class="nq mk it nm b gy nr ns l nt nu">mkdir twilio_assemblyai</span></pre><p id="ff70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将目录更改为新创建的文件夹</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="d4d7" class="nq mk it nm b gy nr ns l nt nu">cd twilio_assemblyai</span></pre><p id="08a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了保证机密凭证的安全，最好将凭证存储在. env文件中。然后我们可以使用<a class="ae ky" href="https://pypi.org/project/python-dotenv/" rel="noopener ugc nofollow" target="_blank"> Python-dotenv </a>库从。环境文件。让我们继续创建。env文件，以及我们将一起构建的3个python文件。</p><p id="269f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nv">如果使用Windows: </em></p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="83b4" class="nq mk it nm b gy nr ns l nt nu">New-Item main.py, transcribe.py, call.py ,.env</span></pre><p id="4524" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nv">如果使用macOS或Linux: </em></p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="b300" class="nq mk it nm b gy nr ns l nt nu">touch main.py; touch transcribe.py; touch call.py ;touch .env</span></pre><p id="e578" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是我们刚刚创建的文件的概述:</p><ul class=""><li id="a831" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="https://github.com/rahulbanerjee26/twilio_assemblyai/blob/main/call.py" rel="noopener ugc nofollow" target="_blank"> call.py </a> —该文件包含使用twilio发出呼叫并创建该呼叫记录的脚本</li><li id="a4a9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://github.com/rahulbanerjee26/twilio_assemblyai/blob/main/transcribe.py" rel="noopener ugc nofollow" target="_blank">transcripte . py</a>—该文件包含与AssemblyAI的API交互所需的函数</li><li id="e06d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://github.com/rahulbanerjee26/twilio_assemblyai/blob/main/main.py" rel="noopener ugc nofollow" target="_blank"> main.py </a> —这个文件集合了我们在transcribe.py和call.py中的函数，所以我们有一个打电话的脚本，然后用AssemblyAI转录那个电话的录音</li><li id="9f9c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">。env —这个文件将包含我们的秘密凭证，比如我们的API凭证、电话号码和我们发出的呼叫的ID</li></ul><h1 id="279d" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">创建和激活虚拟环境</h1><p id="42d2" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">如果这是您第一次使用虚拟环境，您必须使用以下命令安装<a class="ae ky" href="https://pypi.org/project/virtualenv/" rel="noopener ugc nofollow" target="_blank"> virtualenv </a>:</p><p id="7ed4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nv">如果使用Windows: </em></p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="8a96" class="nq mk it nm b gy nr ns l nt nu">python -m pip install --user virtualenv</span></pre><p id="0d6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nv">如果使用macOS或Linux: </em></p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="f882" class="nq mk it nm b gy nr ns l nt nu">python3 -m pip install --user virtualenv</span></pre><p id="d7e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保你在我们在教程开始时创建的目录中。如果不是，只需使用cd命令来更改目录。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="604f" class="nq mk it nm b gy nr ns l nt nu">cd twilio_assemblyai</span></pre><p id="7bb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要通过在命令行上输入以下代码来创建一个虚拟环境:</p><p id="7118" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nv">如果使用Windows: </em></p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="339d" class="nq mk it nm b gy nr ns l nt nu">python -m venv venv</span></pre><p id="339b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nv">如果使用macOS或Linux: </em></p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="93fd" class="nq mk it nm b gy nr ns l nt nu">python3 -m venv venv</span></pre><p id="ca3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们需要使用以下命令激活本地虚拟环境:</p><p id="1d4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nv">如果使用Windows: </em></p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="5565" class="nq mk it nm b gy nr ns l nt nu">venv/Scripts/activate</span></pre><p id="7c74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nv">如果使用macOS或Linux: </em></p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="54d2" class="nq mk it nm b gy nr ns l nt nu">source venv/bin/activate</span></pre><p id="e504" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于如何建立虚拟环境以及它们如何工作的更多细节，你可以参考官方Python文档..</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/f278e5c68a27f674e59b855e06f4b1b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JaUxfyNBQtwQ48t-"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">文件结构截图</p></figure><h1 id="85cb" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">安装所需的库</h1><p id="fbd6" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">我们需要安装我们在“我们将使用的库/API”一节中讨论过的以下库</p><ul class=""><li id="34dd" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">python-dotenv</li><li id="c9f9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">要求</li><li id="55cc" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">特维利奥</li></ul><p id="38d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nv">如果使用Windows: </em></p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="28a7" class="nq mk it nm b gy nr ns l nt nu">pip install twilio, requests, python-dotenv</span></pre><p id="46a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nv">如果使用macOS或Linux: </em></p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="5d57" class="nq mk it nm b gy nr ns l nt nu">pip3 install twilio, requests, python-dotenv</span></pre><h1 id="a5eb" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">使用twilio API</h1><h1 id="e7e2" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">获取API凭据</h1><ul class=""><li id="feb1" class="lv lw it lb b lc nb lf nc li nd lm ne lq nf lu ma mb mc md bi translated">在这里创建一个twilio账户<a class="ae ky" href="https://www.twilio.com/try-twilio" rel="noopener ugc nofollow" target="_blank">。你会得到一个免费的twilio电话号码。</a></li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/9f1a1435d6823da764f1ae86b5c9bc9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ojpacE0mjzSqDD8v"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Twilio网站</p></figure><ul class=""><li id="bda4" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">使用提供的免费电话号码，您只能向经过验证的号码拨打电话。在注册过程中，添加您的个人号码并进行验证。我们将拨打经过验证的号码。您可以在此添加多个验证号码<a class="ae ky" href="https://www.twilio.com/console/phone-numbers/verified" rel="noopener ugc nofollow" target="_blank"/></li><li id="d6f2" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">转到您的<a class="ae ky" href="https://www.twilio.com/console?" rel="noopener ugc nofollow" target="_blank">账户仪表板</a></li><li id="838d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在项目信息部分，您应该看到您的<strong class="lb iu">账户SID </strong>和<strong class="lb iu">认证令牌</strong>。这些是您使用twilio API的凭证。我们将它们存储在。我们之前创建的env文件。</li><li id="7e6b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在项目信息部分，你还应该看到你的twilio电话号码。我们会将此电话号码与经过验证的电话号码一起保存在。环境文件。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/2f84c23d1f0298f47d0607d8f2ba444f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MNSpXoaNa-Rk8oES"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Twilio仪表板</p></figure><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="1865" class="nq mk it nm b gy nr ns l nt nu">account_sid = "YOUR TWILIO ACCOUNT SID"<br/>auth_token = "YOUR TWILIO AUTH TOKEN"from_phone_number = "YOUR TWILIO PHONE NUMBER"<br/>to_phone_number = "YOUR VERIFIED NUMBER"</span></pre><h1 id="25b0" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">用于拨打和记录呼出电话的功能</h1><p id="1b2a" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">我们将使用twilio库来打电话。本节中的所有代码都应该在<a class="ae ky" href="https://github.com/rahulbanerjee26/twilio_assemblyai/blob/main/call.py" rel="noopener ugc nofollow" target="_blank"> call.py </a>文件中。首先，让我们导入所需的库</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="5808" class="nq mk it nm b gy nr ns l nt nu">import os<br/>from dotenv import load_dotenv<br/>from twilio.rest import Client<br/>import requests<br/>from requests.auth import HTTPBasicAuth</span></pre><p id="896c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">客户端</strong>让我们创建一个twilio包装器的实例。我们将使用这个实例的方法进行调用。在创建实例之前，让我们定义一个函数。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="50e2" class="nq mk it nm b gy nr ns l nt nu">def make_phone_call(client,from_phone_number,to_phone_number):<br/>    return None</span></pre><p id="9b13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述函数将接受一个<strong class="lb iu"> twilio客户端</strong>实例、我们的twilio电话号码和我们验证过的电话号码作为参数。现在，让它保持空白。我们稍后将回到这个问题。</p><p id="3a7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们从. env加载我们的凭证和电话号码。创建一个<strong class="lb iu"> twilio client </strong>实例将需要这些凭证。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="44da" class="nq mk it nm b gy nr ns l nt nu">if __name__ == '__main__':<br/>    load_dotenv()<br/>    account_sid = os.environ.get('account_sid')<br/>    auth_token = os.environ.get('auth_token')<br/>    from_phone_number = os.environ.get('from_phone_number')<br/>    to_phone_number = os.environ.get('to_phone_number')</span><span id="f81c" class="nq mk it nm b gy ny ns l nt nu">    client = Client(account_sid, auth_token)<br/>    call_sid = make_phone_call(client, from_phone_number, to_phone_number)</span><span id="399a" class="nq mk it nm b gy ny ns l nt nu">    print(f'Call sid is {call_sid}')</span></pre><p id="7780" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码片段创建了一个<strong class="lb iu"> twilio客户端</strong>实例。调用<strong class="lb iu"> make_phone_call </strong>，并将<strong class="lb iu"> twilio client </strong>实例和电话号码作为参数传递。</p><p id="a9f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们编写<strong class="lb iu"> make_phone_call </strong>函数，该函数将向我们验证过的电话号码发出呼叫并进行录音。该函数将返回呼出呼叫的ID。这个ID需要存储在。env文件，我们之前创建的。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="e401" class="nq mk it nm b gy nr ns l nt nu">def make_phone_call(client_,from_phone_number_,to_phone_number_):<br/>    '''<br/>    Parameter:<br/>        client: A twillio client instance<br/>    Return:<br/>        call.sid: The sid of the outgoing call<br/>    '''<br/>    phone_call = '''&lt;Response&gt;<br/>    &lt;Say&gt;What are you working on?&lt;/Say&gt;<br/>    &lt;Pause length="5"/&gt;<br/>    &lt;/Response&gt;'''</span><span id="0b6b" class="nq mk it nm b gy ny ns l nt nu">    call = client_.calls.create(<br/>                            record = True,<br/>                            twiml=phone_call,<br/>                            from_=from_phone_number_,<br/>                            to = to_phone_number_<br/>                        )   <br/>    return call.sid</span></pre><p id="d8e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">变量<strong class="lb iu"> phone_call </strong>是我们拨出电话时将被读取/播放的脚本。它必须用类似于HTML/XML的<a class="ae ky" href="https://www.twilio.com/docs/voice/twiml" rel="noopener ugc nofollow" target="_blank"> TwiML </a>来编写。出于本教程的目的，我们只需要关注以下TwiML元素:</p><ul class=""><li id="64ed" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="https://www.twilio.com/docs/voice/twiml/say" rel="noopener ugc nofollow" target="_blank"> Say </a> —这个标签之间的内容只是在传出时朗读</li><li id="02f8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://www.twilio.com/docs/voice/twiml/pause" rel="noopener ugc nofollow" target="_blank">暂停</a> —暂停并让被呼叫者讲话。它有一个属性<strong class="lb iu"> length </strong>，表示呼叫暂停的持续时间。</li><li id="35b0" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">响应——它类似于<strong class="lb iu"> html </strong>标签。基本上，整个脚本必须在响应标记之间</li></ul><p id="0fce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以把这些片段放在一起，这就是变量<strong class="lb iu"> phone_call </strong>中的脚本所做的</p><ul class=""><li id="afba" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">询问被叫者他们正在做什么</li><li id="f037" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">等待5秒钟，等待被呼叫者说话</li></ul><p id="3721" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">客户端</strong>实例的<strong class="lb iu"> calls.create </strong>方法发出一个电话呼叫。它接受以下参数</p><ul class=""><li id="2752" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">记录</strong> —一个布尔值，告诉twilio记录电话</li><li id="5c28" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu"> twiml </strong> —通话过程中要播放的脚本</li><li id="d71d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu"> from_ </strong> —拨打电话的号码。在我们的例子中，它是twilio数</li><li id="4412" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">到</strong> —我们要呼叫的号码。如前所述，如果你使用的是免费帐户，它必须是一个经过验证的号码。</li></ul><p id="a490" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你运行一个脚本，你应该会收到一个电话对你的验证号码。键入以下命令运行脚本</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/11fe19435f8760c488baef2348009850.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wJK6JUGvuTiBtUbW"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Twilio电话号码呼叫</p></figure><p id="db9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nv">如果使用Windows: </em></p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="a67d" class="nq mk it nm b gy nr ns l nt nu">python call.py</span></pre><p id="4560" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nv">如果使用macOS或Linux: </em></p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="4e00" class="nq mk it nm b gy nr ns l nt nu">python3 call.py</span></pre><p id="9d7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是<strong class="lb iu"> make_phone_call </strong>函数的输出</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/b98831e1daab42e5be2c2ff5b25da08f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1Qw2pQRCSiHwq0sN"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">终端输出</p></figure><p id="ebd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记下<strong class="lb iu"> make_phone_call </strong>函数返回的调用sid。接下来，将您的呼叫sid存储在。环境文件。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="9325" class="nq mk it nm b gy nr ns l nt nu">call_sid = ‘YOUR CALL SID’</span></pre><p id="24b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您遇到任何错误，您可以检查<a class="ae ky" href="https://www.twilio.com/console/voice/dashboard" rel="noopener ugc nofollow" target="_blank">可编程语音仪表板</a>。</p><p id="153c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Twilio为调试错误信息提供了有用的消息。一个常见的错误是脚本的格式。确保脚本中没有多余的空格或新行。下面是仪表板中的一个错误示例</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/3a1119e712a75f00c5ad7bf2b2cc73c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*njLGfMv6mzFlDLrv"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Twilio错误日志</p></figure><h1 id="ebdb" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">函数来获取录制ID</h1><p id="4db3" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">Twilio提供了以下API端点来获取特定调用的记录id。需要注意的是，一个呼叫可以有多个相关的录音，但是在我们的例子中，整个呼叫只有一个录音。例如:特定时间范围的记录。我们的通话有一段录音，是整个通话的录音。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="c22a" class="nq mk it nm b gy nr ns l nt nu">https://api.twilio.com/2010-04-01/Accounts/{account_sid}<br/>/Calls/{call_sid_}/Recordings.json</span></pre><p id="ea13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Twilio使用<a class="ae ky" href="https://docs.python-requests.org/en/master/user/authentication/" rel="noopener ugc nofollow" target="_blank"> HTTPBasicAuth </a>来认证对其API端点的请求。下面，我们将编写一个函数来获取我们的呼叫记录的ID，我们需要它来下载该记录。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="2224" class="nq mk it nm b gy nr ns l nt nu">def get_recording_sid(account_sid_,auth_token_,call_sid_):<br/>    '''<br/>    Parameter:<br/>        account_sid: Twilio Account SID,<br/>        auth_token: Twilio API Key/Auth Token<br/>        call_sid_: Call Sid<br/>    Return:<br/>        recording.sid: The sid of the recording<br/>    '''<br/>    url = f"https://api.twilio.com/2010-04-01/Accounts/{account_sid_}"\<br/>        + f'/Calls/{call_sid_}/Recordings.json'<br/>    result = requests.get(url , auth = HTTPBasicAuth(account_sid_,     auth_token_))<br/>    recordings  = result.json()<br/>    # Since our call has a single recording, we just need to access the first               <br/>    # element in the list of recordings. If a call has multiple recordings     <br/>    #  associated with it, this list will contain the SIDs of all the      <br/>    #  recordings.<br/>    recording_sid = recordings['recordings'][0]['sid']<br/>    return recording_sid</span></pre><p id="4c30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦有了twilio调用id，就可以调用<strong class="lb iu"> get_recording_sid </strong>函数来获得一个录音ID。下面是调用该函数的方式</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="69b2" class="nq mk it nm b gy nr ns l nt nu">recording_sid = get_recording_sid(account_sid, auth_token, call_sid)<br/>print(f"Recording Sid: {recording_sid}")</span></pre><p id="4de6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">参数account_sid和auth_token是您的twilio API凭证。</p><p id="d2e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个输出示例</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="5c52" class="nq mk it nm b gy nr ns l nt nu">Recording Sid: REe5c2f483b17755f76492f516e7c7df5a</span></pre><p id="87ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将调用main.py中的<strong class="lb iu">get _ recording _ sid</strong></p><h1 id="8ea3" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">您的录音的URL</h1><p id="62f8" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">我们可以通过以下网址访问我们录音的mp3文件</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="1a43" class="nq mk it nm b gy nr ns l nt nu"><a class="ae ky" href="https://api.twilio.com/2010-04-01/Accounts/{account_sid}/Recordings/{recording_sid}.mp3'" rel="noopener ugc nofollow" target="_blank">https://api.twilio.com/2010-04-01/Accounts/{account_sid}/Recordings/{recording_sid}.mp3'</a></span></pre><p id="0c37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您只需将{account_sid}替换为您的twilio帐户id，将{recording_sid}替换为我们从上述函数中检索到的您的录音ID。</p><h1 id="ec2d" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">使用AssemblyAI API</h1><p id="4d3a" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">本节中的函数将在<a class="ae ky" href="https://github.com/rahulbanerjee26/twilio_assemblyai/blob/main/transcribe.py" rel="noopener ugc nofollow" target="_blank">transcripte . py</a>中编写</p><h1 id="cb93" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">获取API凭据</h1><ul class=""><li id="cfff" class="lv lw it lb b lc nb lf nc li nd lm ne lq nf lu ma mb mc md bi translated">转到<a class="ae ky" href="https://www.assemblyai.com/" rel="noopener ugc nofollow" target="_blank">https://www.assemblyai.com/</a></li><li id="9389" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">注册一个账户</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/054ddbf55d4cd4e076f2dc11fb708fe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sLNtBjactSl5KtbD"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">AssemblyAI网站</p></figure><ul class=""><li id="e492" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">转到<a class="ae ky" href="https://app.assemblyai.com/dashboard/" rel="noopener ugc nofollow" target="_blank">https://app.assemblyai.com/dashboard/</a></li><li id="b4af" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">复制API键下的字符串</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/10b8c12d4a2e539b5592c5b7f9e76be3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OHzWYh1FVVZxr0gA"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">AssemblyAI网站</p></figure><ul class=""><li id="13d7" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">将令牌存储在。环境文件</li></ul><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="7e10" class="nq mk it nm b gy nr ns l nt nu">assemblyai_token = “Your AssemblyAI API Key”</span></pre><p id="2e07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在编写函数之前，我们需要导入请求库</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="f8fd" class="nq mk it nm b gy nr ns l nt nu">import requests</span></pre><h1 id="996f" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">将文件排队并获取转录ID的函数</h1><p id="070a" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">我们将使用记录URL并向端点发出请求，这将启动转录状态。</p><p id="f625" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最初，当我们请求音频文件的转录时，它具有“排队”的状态。我们将在后面的章节中更多地讨论文件如何从“排队”到“完成”。现在，我们只需要向转录端点以及文件的URL发出请求。我们需要向以下AssemblyAI API端点发出请求:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="d647" class="nq mk it nm b gy nr ns l nt nu"><a class="ae ky" href="https://api.assemblyai.com/v2/transcript" rel="noopener ugc nofollow" target="_blank">https://api.assemblyai.com/v2/transcript</a></span></pre><p id="f445" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该端点接受新的转录作业。下面是一个接受AssemblyAI API令牌和音频文件URL作为参数的函数。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="2678" class="nq mk it nm b gy nr ns l nt nu">def get_transcribe_id(token,url):<br/>    '''<br/>        Parameter:<br/>        token: The AssemblyAI API key<br/>        url  : Url to uploaded file<br/>        Return Value:<br/>        id   : The transcribe id of the file<br/>    '''<br/>    endpoint = "https://api.assemblyai.com/v2/transcript"<br/>    json = {<br/>      "audio_url": url<br/>    }<br/>    headers = {<br/>      "authorization": token,<br/>      "content-type": "application/json"<br/>    }<br/>    response = requests.post(endpoint, json=json, headers=headers)<br/>    id_ = response.json()['id']<br/>    print("Made request and file is currently queued")<br/>    return id_</span></pre><p id="ff3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该函数接受两个参数:AssemblyAI API令牌和一个音频文件URL。</p><p id="7073" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用<strong class="lb iu"> get_recording_sid </strong>函数来获取记录id，并创建包含twilio呼叫记录的端点。下面的代码应该写在<a class="ae ky" href="http://main.py/" rel="noopener ugc nofollow" target="_blank"> main.py </a>中。但是，为了测试我们的上述函数，我们可以将它包含在regulate . py中。环境文件。请参阅“拨打和记录呼出电话的函数”一节，从。环境文件。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="c180" class="nq mk it nm b gy nr ns l nt nu">recording_sid = get_recording_sid(account_sid, auth_token, call_sid)<br/>print(f"Recording Sid: {recording_sid}")<br/>recording_endpoint = 'https://api.twilio.com/2010-04-01/Accounts/' \<br/>+ f'{account_sid}/Recordings/{recording_sid}.mp3'</span></pre><p id="883c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用<strong class="lb iu">get _ transcripte _ id</strong>函数，并将这个记录端点作为参数传递。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="27f0" class="nq mk it nm b gy nr ns l nt nu">transcribe_id = get_transcribe_id(assemblyai_token,recording_endpoint)<br/>print(f”Transcription ID is {transcribe_id}”)</span></pre><p id="6cfd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是get _ transcribe _ id函数的示例输出</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="3968" class="nq mk it nm b gy nr ns l nt nu">Transcription ID is uyzt6qhog-15d8–4af4-a87f-bdc66a2a56f2</span></pre><p id="2deb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转录ID有助于我们检查转录的状态。我们需要将这个ID作为参数传递给一个单独的端点(将在下面讨论),并继续请求获得转录的状态。我们将继续请求，直到转录完成。</p><h1 id="2e37" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">检查转录状态的功能</h1><p id="b41d" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">一旦我们有了音频文件的转录ID，我们就可以向下面的AssemblyAI API端点发出GET请求来检查转录的状态</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="7df9" class="nq mk it nm b gy nr ns l nt nu"><a class="ae ky" href="https://api.assemblyai.com/v2/transcript/{transcribe_id}" rel="noopener ugc nofollow" target="_blank">https://api.assemblyai.com/v2/transcript/{transcribe_id}</a></span></pre><p id="3be2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只要没有遇到错误，转录的状态就从“排队”变为“处理中”再变为“完成”，如果遇到错误，则变为“错误”。如果当前没有进行音频文件转录，则立即处理新文件。如果有正在进行的转录，则新的音频文件将排队，直到前一个作业完成。如果您希望能够同时运行多个作业，您将需要<a class="ae ky" href="https://www.assemblyai.com/pricing" rel="noopener ugc nofollow" target="_blank">升级到高级计划</a></p><p id="d9df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将需要轮询这个端点，直到我们得到一个状态为“completed”或“error”的响应对象。基本上，继续向这个端点发出请求并检查状态。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="df44" class="nq mk it nm b gy nr ns l nt nu">def get_text(token,transcribe_id):<br/>    '''<br/>      Parameter:<br/>        token: The AssemblyAI API key<br/>        transcribe_id: The ID of the file which is being<br/>      Return Value:<br/>        result : The response object<br/>    '''<br/>    endpoint = f"https://api.assemblyai.com/v2/transcript/{transcribe_id}"<br/>    headers = {<br/>      "authorization": token<br/>    }<br/>    result = requests.get(endpoint, headers=headers).json()<br/>    return result</span></pre><p id="6aa6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的函数只是接受AssemblyAI API令牌和转录ID作为参数，并返回包含转录状态的结果。下面是一个while循环，它不断向端点发出请求。</p><p id="bffc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以利用一个<a class="ae ky" href="https://www.w3schools.com/python/python_while_loops.asp" rel="noopener ugc nofollow" target="_blank"> while循环</a>来连续调用上述函数并向端点发出请求。在循环的每次迭代中，我们将检查转录的状态。循环将继续运行，直到状态为“完成”。发出请求并等待状态完成的过程称为轮询。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="9abe" class="nq mk it nm b gy nr ns l nt nu">result = {}<br/>print("AssemblyAI is processing the file")<br/>while result.get("status") != 'completed' and result.get("status") != 'error':<br/>    time.sleep(2)<br/>    result = get_text(assemblyai_token,transcribe_id)</span><span id="73d3" class="nq mk it nm b gy ny ns l nt nu">print("Transcription Complete - The result is below")<br/>print(result['text'])</span></pre><p id="ab55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了限制请求的数量，我们将在请求之间添加一个睡眠功能。下面是输出的样子</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/91b4f2e39d51ddc90eb2354b26e2c8cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X61NIg6rMzQcGzQN"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">终端输出</p></figure><p id="6ecd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用while循环的轮询应该在main.py文件中完成。我们将在下面讨论main.py文件。</p><h1 id="0a1d" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">转录录音</h1><p id="f6af" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">我们将使用来自<a class="ae ky" href="http://transcription.py/" rel="noopener ugc nofollow" target="_blank"> transcription.py </a>和Twilio recording ID的函数来转录呼出呼叫。这段代码要用<a class="ae ky" href="http://main.py/" rel="noopener ugc nofollow" target="_blank"> main.py </a>写。</p><p id="0de0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们导入必要的库和方法</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="738a" class="nq mk it nm b gy nr ns l nt nu">import os<br/>from dotenv import load_dotenv<br/>from transcribe import get_transcribe_id, get_text<br/>from call import get_recording_sid</span></pre><p id="7267" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将从。环境文件</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="744e" class="nq mk it nm b gy nr ns l nt nu"># Reading Data from .env file<br/>load_dotenv()<br/>account_sid = os.environ.get('account_sid')<br/>call_sid = os.environ.get('call_sid')<br/>auth_token = os.environ.get('auth_token')<br/>assemblyai_token = os.environ.get('assemblyai_token')</span></pre><p id="2efa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用<strong class="lb iu"> get_recording_sid </strong>函数来获取录制id</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="f667" class="nq mk it nm b gy nr ns l nt nu">recording_sid = get_recording_sid(account_sid, auth_token, call_sid)<br/>print(f”Recording Sid: {recording_sid}”)</span></pre><p id="d170" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将使用录音ID并创建录音的URL</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="d40a" class="nq mk it nm b gy nr ns l nt nu">recording_endpoint = ‘https://api.twilio.com/2010-04-01/Accounts/' \<br/>+ f’{account_sid}/Recordings/{recording_sid}.mp3'</span></pre><p id="f1d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用<strong class="lb iu">get _ transcripte _ id</strong>函数，并将这个记录端点作为参数传递。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="46fd" class="nq mk it nm b gy nr ns l nt nu">transcribe_id = get_transcribe_id(assemblyai_token,recording_endpoint)<br/>print(f”Transcription ID is {transcribe_id}”)</span></pre><p id="0769" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们获得转录ID，我们将轮询转录端点以获得转录的状态。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="23b9" class="nq mk it nm b gy nr ns l nt nu">result = {}<br/>print("AssemblyAI is processing the file")<br/>while result.get("status") != 'completed':<br/>result = get_text(assemblyai_token,transcribe_id)<br/>print("Transcription Complete - The result is below")<br/>print(result['text'])</span></pre><p id="388d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要运行main.py文件:</p><p id="ffa3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nv">如果使用Windows: </em></p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="f8f7" class="nq mk it nm b gy nr ns l nt nu">python main.py</span></pre><p id="42b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nv">如果使用macOS或Linux: </em></p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="754a" class="nq mk it nm b gy nr ns l nt nu">python3 main.py</span></pre><p id="f194" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是输出</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/bd73620443f69060904a8c45e7db8b63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pSFKrt3u46o3zNpx"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">终端输出</p></figure><h1 id="ca70" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">结论</h1><p id="4f95" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">恭喜你！👏你已经成功地写了一个可以转录音频的脚本。如果您想在此基础上进行构建，您可以尝试在电话记录中添加转录作为注释。</p></div></div>    
</body>
</html>