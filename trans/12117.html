<html>
<head>
<title>Four Functions to Level up Your Pandas Skills</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">提升熊猫技能的四个功能</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/four-functions-to-level-up-your-pandas-skills-c89f95a1773a?source=collection_archive---------6-----------------------#2021-12-07">https://towardsdatascience.com/four-functions-to-level-up-your-pandas-skills-c89f95a1773a?source=collection_archive---------6-----------------------#2021-12-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3703" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">分配、映射、查询和分解。城里最热门的方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/91f1695d56b3d134840b8198d6e400d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YrTnZVdtHcL-jOD2"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@sklepacki?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">斯蒂芬妮·克莱帕奇</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="82cf" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="13ea" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">无论你是数据科学家、数据工程师、数据分析师还是机器学习专家，你都必须处理表格数据。如果您是 Python 用户，那么在处理表格数据时，最常用的库是<a class="ae ky" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> Pandas </a>🐼。由于表格数据无处不在，Pandas 可能是所有美国数据人员中使用最多的库之一。</p><p id="d44e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Pandas 提供了一个功能丰富的 API，用于转换数据和提取有价值的见解。不幸的是，许多人，包括过去的我自己，没有充分利用它提供的所有功能。这经常导致庞大、过度复杂和低性能的熊猫代码😔。</p><p id="c787" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我想为改变这种情况做出贡献，并帮助你提升你的熊猫知识，这样你未来的代码将更好读，也更有性能💪！为此，在这篇文章中，我向你介绍四种不同的熊猫功能，即<code class="fe ms mt mu mv b">assign, map, query,</code>和<code class="fe ms mt mu mv b">exlpode</code>。当掌握了这些，我们就在考虑清晰度和性能的正确方向上迈出了一步！</p><p id="3dfc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">你准备好了吗？我们开始吧！</p><h1 id="e240" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">神奇四侠</h1><p id="0032" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我们研究具体的 Pandas 功能之前，我们首先需要一些数据来处理。在下面的例子中，我使用了著名的<a class="ae ky" href="https://archive.ics.uci.edu/ml/datasets/iris" rel="noopener ugc nofollow" target="_blank">虹膜数据集</a>。如果你不想为了获取数据而安装一个专用的库，只需输入<code class="fe ms mt mu mv b">data = pd.read_csv('https://raw.githubusercontent.com/mwaskom/seaborn-data/master/iris.csv')</code>就可以了。</p><p id="ce59" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在我们开始之前的最后一句话，下面的大多数例子在内容上可能没有太多意义，但是阐明了每个函数的细节。</p><p id="1664" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">都准备好了吗？让我们开始吧！</p><h2 id="c555" class="mw la it bd lb mx my dn lf mz na dp lj ma nb nc ll me nd ne ln mi nf ng lp nh bi translated">分配</h2><p id="040f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们要看的第一种方法是<code class="fe ms mt mu mv b"><a class="ae ky" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.assign.html" rel="noopener ugc nofollow" target="_blank">assign</a></code>方法。此方法允许您向数据帧添加列。代码最好用代码来解释，所以这里来一个例子</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="340f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们在这里做了什么？这相当容易！我们使用<code class="fe ms mt mu mv b">assign</code>创建了两个新列，将这些列的名称作为关键字参数传递给函数，并使用<em class="nk">为它们分配结果列应该包含的值。如您所见，要分配实际值，您有三种不同的选择。</em></p><ol class=""><li id="e83a" class="nl nm it lt b lu mn lx mo ma nn me no mi np mm nq nr ns nt bi translated">您可以使用一个<em class="nk">标量值</em>，它将新列的所有条目设置为该值。</li><li id="85b4" class="nl nm it lt b lu nu lx nv ma nw me nx mi ny mm nq nr ns nt bi translated">您可以使用一个<em class="nk">数组或系列</em>，这将导致该数组被用作列的值。该数组的长度必须与调用 assign-method 的数据帧的长度相同。</li><li id="7c12" class="nl nm it lt b lu nu lx nv ma nw me nx mi ny mm nq nr ns nt bi translated">您可以使用一个<em class="nk">函数</em>，或者更一般的一个<em class="nk">可调用函数</em>，它将一个数据帧作为其唯一的输入，并返回一个标量或序列。当返回一个序列时，它的长度必须与输入数据帧的长度相同。<br/>这个选项的巧妙之处在于，可调用函数的输入数据帧就是调用 assign-method 的数据帧。这意味着什么，为什么它是整洁的？例如，如果您首先对聚合执行<code class="fe ms mt mu mv b"><a class="ae ky" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.assign.html" rel="noopener ugc nofollow" target="_blank">g</a>roupby</code>，然后调用<code class="fe ms mt mu mv b">assign</code>，那么您可以在函数中使用聚合来计算新列的值。这也是您在示例代码中看到的。对我来说，这真的很紧凑，同时还很有表现力。</li></ol><p id="78be" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如示例所示，可以用一个分配调用来<em class="nk">创建多个列。因此，你只需要传递多个关键字参数；每个要创建的列一个。这很酷，因为以后的赋值可以利用以前创建或修改的列。举个简单的例子，您可以运行<code class="fe ms mt mu mv b">df.assign(x_axis=np.random.rand(len(df)), y_axis=<strong class="lt iu">lambda</strong> in_: in_.x_axis ** 2)</code>，其中第二个赋值使用了第一个赋值中创建的列。</em></p><p id="4b57" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，我想提到一个小技巧，它允许您<em class="nk">创建没有正确 Python 变量名的列</em>。为此，您必须创建一个字典，将列名作为键，将赋值操作作为值，并将这个字典解包后传递给赋值方法😵。这听起来比实际要难。为了更清楚，让我们用一个例子来结束这一段，在这个例子中，我们用无效的 Python 变量名<code class="fe ms mt mu mv b">df.assign(**{'X-Axis': np.random.rand(len(df)), 'Y-Axis': <strong class="lt iu">lambda</strong> in_: in_['X-Axis'] ** 2})</code>创建了两个新列。</p><h2 id="5109" class="mw la it bd lb mx my dn lf mz na dp lj ma nb nc ll me nd ne ln mi nf ng lp nh bi translated">地图</h2><p id="19f1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">可以在 Pandas 系列对象上调用的另一个方便的函数是<code class="fe ms mt mu mv b"><a class="ae ky" href="https://pandas.pydata.org/docs/reference/api/pandas.Series.map.html" rel="noopener ugc nofollow" target="_blank">map</a></code>函数。使用<code class="fe ms mt mu mv b">map</code>,您可以用另一个值替换<em class="nk">系列</em>中的每个值。这是一个简单的例子，我用赋值函数调用做了一些 dogfooding😃</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="7633" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这段代码中，我们使用<code class="fe ms mt mu mv b">map</code>有条件地将<code class="fe ms mt mu mv b">to_big_to_small</code>列的条目设置为两个不同的字符串。此外，我们使用<code class="fe ms mt mu mv b">map</code>来添加一个新列<code class="fe ms mt mu mv b">inverted_name</code>，它保存每个物种的颠倒名称。当然，这个例子在内容方面不是很有用，尽管它举例说明了如何调用<code class="fe ms mt mu mv b">map</code>的两个选项。</p><ol class=""><li id="4d06" class="nl nm it lt b lu mn lx mo ma nn me no mi np mm nq nr ns nt bi translated">您向 map 函数传递一个集合类型，比如字典或序列。将要发生的是，你的序列的<em class="nk">值将被用作<em class="nk">键，从给定的集合中查找相应的值</em>。任何不属于集合的值都将被映射到<code class="fe ms mt mu mv b">NaN</code>或<code class="fe ms mt mu mv b">None</code>。为了不那么枯燥，我给你另一个玩具例子<code class="fe ms mt mu mv b">pd.Series(range(3)).map({1:'medium', 2:'high'})</code>。当您执行该操作时，会产生一系列条目<code class="fe ms mt mu mv b">[NaN, 'medium', 'high']</code>。</em></li><li id="4122" class="nl nm it lt b lu nu lx nv ma nw me nx mi ny mm nq nr ns nt bi translated">您向<code class="fe ms mt mu mv b">map</code>传递一个函数或 callable，它将一个标量作为输入并返回一个标量值。这样做时，该函数将使用每个值作为输入参数，按元素方式应用于序列的每个条目。这就是你在第 6 行看到的，我们颠倒了花卉物种的名称。<br/>作为建议，<em class="nk">不要用那种方法做任何数学运算</em>。当直接应用于一个系列时，这可以更有效地完成，因为它在后面利用了 NumPy 矢量化。</li></ol><p id="bdec" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，如果您想对整个数据帧而不是一个序列进行元素操作，您可以使用<code class="fe ms mt mu mv b"><a class="ae ky" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.applymap.html" rel="noopener ugc nofollow" target="_blank">applymap</a></code>函数，它的行为与<code class="fe ms mt mu mv b">map</code>相同。</p><h2 id="3ac2" class="mw la it bd lb mx my dn lf mz na dp lj ma nb nc ll me nd ne ln mi nf ng lp nh bi translated">询问</h2><p id="3a7e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我们研究了操作数据容器的函数之后，让我们看看如何从数据帧中提取数据。<em class="nk">提取行</em>的一个有用的函数是<code class="fe ms mt mu mv b">query</code>函数。当然，我们从一些代码开始</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="2db4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们在这里做了什么？我们使用传递给<code class="fe ms mt mu mv b">query</code>的逻辑过滤表达式选择了所有行的子集。过滤器表达式是一个字符串，可以包含各种逻辑比较，如<code class="fe ms mt mu mv b">&gt;,&lt;,&gt;=,&lt;=,!=,==,</code>等，以比较数据帧的列。然后，<code class="fe ms mt mu mv b">query</code>函数对该表达式求值，并将表达式求值的所有行返回给<code class="fe ms mt mu mv b"><strong class="lt iu">True</strong></code>。</p><p id="2172" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在表达式中，通过使用列的名称来引用列。要引用不是有效 Python 变量名的列名，必须用反斜线将它们括起来，如第 6 行所示。</p><p id="fb6b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您想从外部作用域引用任何变量，您可以通过在它们的名称前加上@字符来实现，正如您看到的<code class="fe ms mt mu mv b">length_th</code>变量。</p><p id="5737" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">值得注意的是，您可以使用索引操作来执行相同的操作。然而，当您使用<code class="fe ms mt mu mv b">query</code>时，产生的代码不那么冗长，更好阅读。</p><h2 id="7783" class="mw la it bd lb mx my dn lf mz na dp lj ma nb nc ll me nd ne ln mi nf ng lp nh bi translated">激增</h2><p id="3ee0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们在这篇文章中讨论的最后一个函数是<code class="fe ms mt mu mv b"><a class="ae ky" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.explode.html" rel="noopener ugc nofollow" target="_blank">explode</a></code>，显然是名字最引人注目的一个💣。这个功能有什么用？当一列的条目类似于列表时,<code class="fe ms mt mu mv b">explode</code>函数很有用。具体地说，它使您能够为这些列表的每个条目创建一个新行。进行此操作时，<em class="nk">一行的所有其他条目都将被复制，索引</em>也是如此。您可以通过传递包含类似列表的对象的列的名称来调用它。和往常一样，让我们用一个例子来说明这一点</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="8c9d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在给定的示例中，我们首先创建一个包含 3 行的数据帧。列<code class="fe ms mt mu mv b">a</code>的条目最初分别是长度为 1、2 和 4 的列表。分解列<code class="fe ms mt mu mv b">a</code>上的数据帧后，得到的数据帧大小为 1+2+4 = 7。我可以推荐复制这个例子，并对它进行试验。</p><p id="2c8b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在你可能明白为什么这个函数叫做 explode 了；当使用它时，你的数据帧的尺寸会爆炸。抛开小玩具的例子，假设您有一个 500_000 行的数据帧，有一列包含 100 个条目的列表。当您对该列调用 explode 时，最终会得到 50_000_000 行。这可能是一个问题。所以我的建议是:<em class="nk">慎用！</em></p><p id="e531" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">需要知道的一件重要事情是，explode 不会改变它所应用的列的数据类型。由于 Pandas 用 object 类型存储类似列表的值，这意味着在展开一列后，它仍然是 object 类型。如果您想改变这一点，您必须使用<code class="fe ms mt mu mv b">astype</code>方法显式地这样做。这也是您在示例代码中看到的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/681617bc8e57036f07a92f150aa7d00c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zJcyMc_PuwxBpAeb"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@edenconstantin0?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">伊登·康斯坦丁诺</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="4a19" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">包裹</h1><p id="5da0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这篇文章中，我们看了四个不同的熊猫函数来处理数据帧和序列。当您开始使用这些函数时，您未来的代码将更加优雅、易读和高效。相信我。如果你真的想的话，你也可以利用这些函数来给你的同事留下深刻的印象😎。</p><p id="e6ba" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">感谢您关注这篇文章。一如既往，如果有任何问题、意见或建议，请随时联系我或关注我，无论是在 medium 还是通过<a class="ae ky" href="https://www.linkedin.com/in/simon-hawe-75832057" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>。</p></div></div>    
</body>
</html>