<html>
<head>
<title>3 Tools to Track and Visualize the Execution of your Python Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">3个跟踪和可视化Python代码执行的工具</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/3-tools-to-track-and-visualize-the-execution-of-your-python-code-666a153e435e?source=collection_archive---------0-----------------------#2021-04-29">https://towardsdatascience.com/3-tools-to-track-and-visualize-the-execution-of-your-python-code-666a153e435e?source=collection_archive---------0-----------------------#2021-04-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0d62" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">避免在一行代码中调试时的麻烦</h2></div><h1 id="0eea" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">动机</h1><p id="238c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">您是否见过如下所示的错误输出:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="0eff" class="mf kj it mb b gy mg mh l mi mj">2 divided by 1 is equal to 2.0.<br/>Traceback (most recent call last):<br/>  File "loguru_example.py", line 17, in &lt;module&gt;<br/>    divide_numbers(num_list)<br/>  File "loguru_example.py", line 11, in divide_numbers<br/>    res = division(num1, num2)<br/>  File "loguru_example.py", line 5, in division<br/>    return num1/num2<br/>ZeroDivisionError: division by zero</span></pre><p id="63e0" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">并希望输出能更容易理解，如这里所示？</p><figure class="lw lx ly lz gt mq gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/0f8b45cfb2e7587180800fbd33f40cc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*Wa4aTPXFq5Zv5bAKRVt3AA.png"/></div><p class="mt mu gj gh gi mv mw bd b be z dk translated">作者图片</p></figure><p id="3697" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">您可能还想实时可视化哪些代码行正在执行以及它们执行了多少次:</p><figure class="lw lx ly lz gt mq gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/d037ad087ee5f337bb230281d214445f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/1*nJnWUrIzF_FZY379uISyhg.gif"/></div><p class="mt mu gj gh gi mv mw bd b be z dk translated">作者GIF</p></figure><p id="a51d" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">如果是这样的话，这篇文章将为你提供实现上述目标的工具。这三个工具是:</p><ul class=""><li id="165d" class="my mz it lc b ld mk lg ml lj na ln nb lr nc lv nd ne nf ng bi translated">Loguru —打印更好的异常</li><li id="5589" class="my mz it lc b ld nh lg ni lj nj ln nk lr nl lv nd ne nf ng bi translated">snoop —打印函数中正在执行的代码行</li><li id="c0b8" class="my mz it lc b ld nh lg ni lj nj ln nk lr nl lv nd ne nf ng bi translated">心率-实时可视化Python程序的执行</li></ul><p id="5898" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">使用这些工具只需要一行代码！</p><h1 id="0c01" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">Loguru —打印更好的异常</h1><p id="4331" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Loguru是一个旨在让用Python登录变得有趣的库。Loguru提供了许多有趣的功能，但我发现最有用的一个功能是能够<strong class="lc iu">捕捉意外错误</strong>和<strong class="lc iu">显示哪个变量值导致代码失败</strong>。</p><p id="0cf7" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">要安装Loguru，请键入</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="8e24" class="mf kj it mb b gy mg mh l mi mj">pip install loguru</span></pre><p id="292d" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">为了理解Loguru是如何有用的，想象你有两个函数<code class="fe nn no np mb b">division</code>和<code class="fe nn no np mb b">divide_numbers</code>，函数<code class="fe nn no np mb b">divide_numbers</code>被执行。</p><figure class="lw lx ly lz gt mq"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="9c24" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">注意<code class="fe nn no np mb b">combinations([2,1,0], 2)</code>返回<code class="fe nn no np mb b">[(2, 1), (2, 0), (1, 0)]</code>。运行上面的代码后，我们得到了这个错误:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="c933" class="mf kj it mb b gy mg mh l mi mj">2 divided by 1 is equal to 2.0.<br/>Traceback (most recent call last):<br/>  File "loguru_example.py", line 17, in &lt;module&gt;<br/>    divide_numbers(num_list)<br/>  File "loguru_example.py", line 11, in divide_numbers<br/>    res = division(num1, num2)<br/>  File "loguru_example.py", line 5, in division<br/>    return num1/num2<br/>ZeroDivisionError: division by zero</span></pre><p id="75c9" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">从输出中，我们知道行<code class="fe nn no np mb b">return num1/num2</code>是错误发生的地方，但是我们不知道<code class="fe nn no np mb b">num1</code>和<code class="fe nn no np mb b">num2</code>的哪个值导致了错误。幸运的是，这可以通过添加Loguru的<code class="fe nn no np mb b">logger.catch</code>装饰器来轻松跟踪:</p><figure class="lw lx ly lz gt mq"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="901b" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">输出:</p><figure class="lw lx ly lz gt mq gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/0f8b45cfb2e7587180800fbd33f40cc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*Wa4aTPXFq5Zv5bAKRVt3AA.png"/></div><p class="mt mu gj gh gi mv mw bd b be z dk translated">作者图片</p></figure><p id="b1bb" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">加上<code class="fe nn no np mb b">logger.catch</code>，异常就好理解多了！原来误差发生在用<code class="fe nn no np mb b">2</code>除以<code class="fe nn no np mb b">0</code>的时候。</p><h1 id="cb5b" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">snoop —打印函数中正在执行的代码行</h1><p id="c311" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果代码中没有错误，但我们想弄清楚代码中发生了什么，该怎么办？这时snoop就派上了用场。</p><p id="1e93" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated"><a class="ae nm" href="https://github.com/alexmojaki/snoop" rel="noopener ugc nofollow" target="_blank"> snoop </a>是一个Python包，它通过只添加一个装饰器来打印正在执行的代码行以及每个变量的值。</p><p id="5ce2" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">要安装snoop，请键入:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="41d7" class="mf kj it mb b gy mg mh l mi mj">pip install snoop</span></pre><p id="e6cb" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">让我们假设我们有一个名为<code class="fe nn no np mb b">factorial</code>的函数，其中<a class="ae nm" href="https://www.programiz.com/python-programming/recursion" rel="noopener ugc nofollow" target="_blank">寻找一个整数</a>的阶乘。</p><figure class="lw lx ly lz gt mq"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="c5f8" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">输出:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="7e5f" class="mf kj it mb b gy mg mh l mi mj">The factorial of 5 is 120</span></pre><p id="ce37" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">为了理解为什么<code class="fe nn no np mb b">factorial(5)</code>的输出是<code class="fe nn no np mb b">20</code>，我们可以在函数<code class="fe nn no np mb b">factorial</code>中添加<code class="fe nn no np mb b">snoop</code> decorator。</p><figure class="lw lx ly lz gt mq"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="909f" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">输出:</p><figure class="lw lx ly lz gt mq gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/9acc8452a3790ca17ed4cda1f0445061.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*SREOQFmPpfZQ6IGB-ozVAQ.png"/></div><p class="mt mu gj gh gi mv mw bd b be z dk translated">作者图片</p></figure><p id="ec15" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">在上面的输出中，我们可以查看变量的值以及执行了哪一行代码。现在我们可以更好地理解递归是如何工作的了！</p><h1 id="a9f0" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">心率-实时可视化Python程序的执行</h1><p id="04b0" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果你想直观的看到哪些行被执行了，执行了多少次，试试heartrate。</p><p id="c472" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated"><a class="ae nm" href="https://github.com/alexmojaki/heartrate" rel="noopener ugc nofollow" target="_blank">心率</a>也是snoop的创作者创作的。要安装心率，请键入:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="1714" class="mf kj it mb b gy mg mh l mi mj">pip install heartrate</span></pre><p id="21cf" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">现在让我们在之前的代码中添加<code class="fe nn no np mb b">heartrate.trace(browser=True)</code>。这将打开一个浏览器窗口，显示调用过<code class="fe nn no np mb b">trace()</code>的文件的可视化。</p><figure class="lw lx ly lz gt mq"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="debe" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">当您运行上面的代码时，应该会弹出一个新的浏览器。如果没有，去<a class="ae nm" href="http://localhost:9999/file/?filename=heartrate_example.py" rel="noopener ugc nofollow" target="_blank"> http://localhost:9999 </a>。您应该会看到如下所示的输出:</p><figure class="lw lx ly lz gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="nu nv di nw bf nx"><div class="gh gi nt"><img src="../Images/2ee9e20a3d60d1bfe41543f37eb64af0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iRPyzFsJ_kz7dcZ9Y7QVuQ.png"/></div></div><p class="mt mu gj gh gi mv mw bd b be z dk translated">作者图片</p></figure><p id="650e" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">酷！条形图显示被点击的线路。越长的条形意味着点击次数越多，越浅的颜色意味着越新。</p><p id="d41f" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">从上面的输出中，我们可以看到程序执行了:</p><ul class=""><li id="82a8" class="my mz it lc b ld mk lg ml lj na ln nb lr nc lv nd ne nf ng bi translated"><code class="fe nn no np mb b">if x==1</code> 5次</li><li id="ecfa" class="my mz it lc b ld nh lg ni lj nj ln nk lr nl lv nd ne nf ng bi translated"><code class="fe nn no np mb b">return 1</code>曾经</li><li id="ddcb" class="my mz it lc b ld nh lg ni lj nj ln nk lr nl lv nd ne nf ng bi translated"><code class="fe nn no np mb b">return (x * factorial(x-1))</code> 4次</li></ul><p id="aef5" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">输出是有意义的，因为<code class="fe nn no np mb b">x</code>的初始值是5，并且该函数被重复调用，直到<code class="fe nn no np mb b">x</code>等于<code class="fe nn no np mb b">1</code>。</p><p id="10e6" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">现在让我们看看使用心率实时可视化Python程序的执行是什么样子的。让我们添加<code class="fe nn no np mb b">sleep(0.5)</code>以便程序运行得慢一点，并将<code class="fe nn no np mb b">num</code>增加到<code class="fe nn no np mb b">20</code>。</p><figure class="lw lx ly lz gt mq"><div class="bz fp l di"><div class="nq nr l"/></div></figure><figure class="lw lx ly lz gt mq gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/d037ad087ee5f337bb230281d214445f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/1*nJnWUrIzF_FZY379uISyhg.gif"/></div><p class="mt mu gj gh gi mv mw bd b be z dk translated">作者GIF</p></figure><p id="2cf8" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">厉害！我们可以实时看到哪些代码行正在执行，以及每一行执行了多少次。</p><h1 id="72b5" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">结论</h1><p id="cb94" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">恭喜你！您刚刚学习了3种工具来跟踪和可视化Python代码的执行。我希望在使用这三个工具时，调试对你来说不会那么痛苦。既然这些工具只需要一行代码，为什么不试试看它们有多大帮助呢？</p><p id="8c5b" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">随意发挥，并在这里叉这篇文章的源代码:</p><div class="ny nz gp gr oa ob"><a href="https://github.com/khuyentran1401/Data-science/tree/master/python/debug_tools" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">khuyentran 1401/数据科学</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">有用的数据科学主题以及代码和文章的集合- khuyentran1401/Data-science</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">github.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op mr ob"/></div></div></a></div><p id="fe5a" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">我喜欢写一些基本的数据科学概念，并尝试不同的算法和数据科学工具。你可以在LinkedIn和T2 Twitter上与我联系。</p><p id="5c32" class="pw-post-body-paragraph la lb it lc b ld mk ju lf lg ml jx li lj mm ll lm ln mn lp lq lr mo lt lu lv im bi translated">星<a class="ae nm" href="https://github.com/khuyentran1401/Data-science" rel="noopener ugc nofollow" target="_blank">这个回购</a>如果你想检查我写的所有文章的代码。在Medium上关注我，了解我的最新数据科学文章，例如:</p><div class="ny nz gp gr oa ob"><a rel="noopener follow" target="_blank" href="/3-tools-to-monitor-and-optimize-your-linux-system-c8a46c18d692"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">监控和优化您的Linux系统的3个工具</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">用这三个工具控制你的机器</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="oq l om on oo ok op mr ob"/></div></div></a></div><div class="ny nz gp gr oa ob"><a rel="noopener follow" target="_blank" href="/3-advance-techniques-to-effortlessly-import-and-execute-your-python-modules-ccdcba017b0c"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">轻松导入和执行Python模块的3种技巧</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">如何让你的Python模块对用户友好</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="or l om on oo ok op mr ob"/></div></div></a></div><div class="ny nz gp gr oa ob"><a rel="noopener follow" target="_blank" href="/3-python-tricks-to-read-create-and-run-multiple-files-automatically-5221ebaad2ba"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">自动读取、创建和运行多个文件的3个Python技巧</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">用Python和Bash For Loop自动化枯燥的东西</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="os l om on oo ok op mr ob"/></div></div></a></div><div class="ny nz gp gr oa ob"><a rel="noopener follow" target="_blank" href="/python-clean-code-6-best-practices-to-make-your-python-functions-more-readable-7ea4c6171d60"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">Python干净代码:让Python函数更具可读性的6个最佳实践</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">停止编写需要3分钟以上才能理解的Python函数</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">towardsdatascience.com</p></div></div><div class="ok l"><div class="ot l om on oo ok op mr ob"/></div></div></a></div></div></div>    
</body>
</html>