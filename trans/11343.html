<html>
<head>
<title>Geographic heatmaps in Google Data Studio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google Data Studio中的地理热图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/geographic-heatmaps-in-google-data-studio-a603c09a3d02?source=collection_archive---------10-----------------------#2021-11-07">https://towardsdatascience.com/geographic-heatmaps-in-google-data-studio-a603c09a3d02?source=collection_archive---------10-----------------------#2021-11-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="cb8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的<a class="ae kl" rel="noopener" target="_blank" href="/spatial-binning-with-google-bigquery-d118afba6273">上一篇文章</a>中，展示了如何将地理坐标绑定到可以在地图上有效可视化的方块中。下一步自然是用颜色填充这个网格，以显示与坐标相关的任何度量的空间变化，即地理热图。在这里，我们将展示如何使用Google BigQuery和Google Data Studio来实现这一点。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/24ffe8274db0a0bdf7e21b5195599155.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0YWlTRwfGNJWbaZT"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">丹尼斯·库默在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h2 id="cf25" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">数据集:纽约出租车出行</h2><p id="a22c" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">首先，我们需要地理参考数据，幸运的是BigQuery提供了几个公共数据集来帮助我们。这里我们将使用一个<a class="ae kl" href="https://console.cloud.google.com/marketplace/product/city-of-new-york/nyc-tlc-trips" rel="noopener ugc nofollow" target="_blank">数据集</a>，它包含纽约的出租车行程，上面有上下车的准确位置。这个想法是在地图上显示在给定的时间范围内，从一个给定的接送区，覆盖纽约的每个区块的下车数量。我们可以在同一数据集中的专用表中找到这些区域的边界。</p><h2 id="5316" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">从经度和纬度到瓦片坐标</h2><p id="15be" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">第一步是将每个拾取和放下事件映射到所需大小的相应图块。我们严格遵循此处描述的<a class="ae kl" rel="noopener" target="_blank" href="/spatial-binning-with-google-bigquery-d118afba6273">程序:</a></p><pre class="kn ko kp kq gt ma mb mc md aw me bi"><span id="4b31" class="lc ld iq mb b gy mf mg l mh mi">DECLARE<br/>  START_DATE DATE;<br/>DECLARE<br/>  END_DATE DATE;<br/>DECLARE<br/>  ZOOM INT64;<br/>SET<br/>  START_DATE='2015-01-01';<br/>SET<br/>  END_DATE='2015-01-01';<br/>SET<br/>  ZOOM=17;<br/>SELECT<br/>  ZOOM || TRUNC((pickup_longitude*ACOS(-1)/180+ACOS(-1))/(2*ACOS(-1))*POW(2,ZOOM))|| -- <em class="mj">pick-up x coordinate</em><br/>  TRUNC((POW(2,ZOOM)/(2*ACOS(-1))*(ACOS(-1)-SAFE.LN(TAN(ACOS(-1)/4+(pickup_latitude/180*ACOS(-1))/2)))))-- <em class="mj">pick-up y coordinate</em><br/>  AS pickup_tile_id,<br/>  ZOOM || TRUNC((dropoff_longitude*ACOS(-1)/180+ACOS(-1))/(2*ACOS(-1))*POW(2,ZOOM)) || <em class="mj">-- drop-off x coordinate</em><br/>  TRUNC((POW(2,ZOOM)/(2*ACOS(-1))*(ACOS(-1)-SAFE.LN(TAN(ACOS(-1)/4+(dropoff_latitude/180*ACOS(-1))/2))))) -- <em class="mj">drop-off y coordinate</em><br/>  AS dropoff_tile_id,<br/>FROM<br/>  `bigquery-public-data.new_york_taxi_trips.tlc_yellow_trips_2015`<br/>WHERE<br/>  DATETIME_TRUNC(pickup_datetime,<br/>    DAY) BETWEEN START_DATE<br/>  AND END_DATE</span></pre><p id="f38a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们引入了一些参数，如<code class="fe mk ml mm mb b">START_DATE</code> <em class="mj">、</em> <code class="fe mk ml mm mb b">END_DATE</code> <em class="mj">、</em>和<code class="fe mk ml mm mb b">ZOOM</code>，以提供动态改变时间范围和瓦片大小的灵活性。使用这里使用的默认值，我们只需要5.3秒就可以得到输出，但是“繁重”的工作仍然要做，所以如果您想在几秒钟内得到输出而不保存部分结果，就要避免使用更大的时间范围😃。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/3f376f3d06c37dbf7fee181e8820ca86.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*Rw6N2cdJ0LhjxoauSSdgQA.png"/></div><p class="ky kz gj gh gi la lb bd b be z dk translated">上面代码的输出</p></figure><p id="13ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，上面的代码为我们提供了包含每次旅行的接送点的瓦片的唯一id。</p><h2 id="44e9" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">用瓷砖覆盖纽约的出租车区域</h2><p id="533a" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">接下来，我们需要知道刚刚找到的每个图块属于哪个区域，因此我们如下进行:</p><ol class=""><li id="c7a9" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated">使用表<code class="fe mk ml mm mb b">bigquery-public-data.new_york_taxi_trips.taxi_zone_geom</code> <em class="mj"> </em>访问每个滑行区域的边界和名称。</li><li id="ef7e" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">找到包围每个区域的<a class="ae kl" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/geography_functions#st_boundingbox" rel="noopener ugc nofollow" target="_blank">包围框</a>，由两对坐标定义，即<code class="fe mk ml mm mb b">(xmin,ymin)</code>(左下角)和<code class="fe mk ml mm mb b">(xmax,ymax)</code> <em class="mj"> </em>(右上角)。</li><li id="8cc6" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">确定包含瓷砖坐标<code class="fe mk ml mm mb b">(tile_x_xmin_ymin,tile_y_xmin_y_min)</code>和<code class="fe mk ml mm mb b">(tile_x_xmax_ymax,tile_y_xmax_y_max)</code>的<code class="fe mk ml mm mb b">(xmin,ymin)</code>和<code class="fe mk ml mm mb b">(xmax,ymax)</code>的瓷砖。</li><li id="e4a7" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">生成从左下角到右上角的剩余图块。</li></ol><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nc"><img src="../Images/98e5022b55c259fe2c843546e9983c18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*KgUcKm0vIIcXHPBTWjnFyA.gif"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">用方形瓷砖覆盖世贸中心。</p></figure><p id="1baf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，我们可能有一个图块与两个或更多不同的区域重叠:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/2bfa8e895ea188baec874e1038314a9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*ZRkd96QuKoS4l2zAcsTjKg.png"/></div><p class="ky kz gj gh gi la lb bd b be z dk translated">一个单幅图块覆盖四个不同的区域。</p></figure><p id="a6c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这引入了一定程度的不确定性，必须加以解决:每个区块必须属于且仅属于一个区域。例如，我们可以将其与包含其中心的区域相关联，但我们将遵循不同的方法，即评估瓷砖与每个区域之间的相交区域，并仅保留最大的区域。这可能需要大约一分钟的时间来完成，所以最好将结果保存在一个表中，并在需要时使用该输出。下面是完成刚才描述的过程的代码:</p><pre class="kn ko kp kq gt ma mb mc md aw me bi"><span id="ddb4" class="lc ld iq mb b gy mf mg l mh mi">DECLARE<br/>  ZOOM INT64;<br/>SET<br/>  ZOOM=17;<br/>WITH<br/>  bounding_box AS(<br/>  SELECT<br/>    zone_name,<br/>    zone_geom,<br/>    ST_BOUNDINGBOX(zone_geom) BB<br/>  FROM<br/>    `bigquery-public-data.new_york_taxi_trips.taxi_zone_geom` ),<br/>  tiles_at_corners AS(<br/>  SELECT<br/>    zone_name,<br/>    zone_geom,<br/>    TRUNC((BB.xmin*ACOS(-1)/180+ACOS(-1))/(2*ACOS(-1))*POW(2,zoom)) tile_x_xmin_ymin,<br/>    TRUNC((POW(2,ZOOM)/(2*ACOS(-1))*(ACOS(-1)-SAFE.LN(TAN(ACOS(-1)/4+(BB.ymin/180*ACOS(-1))/2))))) tile_y_xmin_ymin,<br/>    TRUNC((BB.xmax*ACOS(-1)/180+ACOS(-1))/(2*ACOS(-1))*POW(2,zoom)) tile_x_xmax_ymax,<br/>    TRUNC((POW(2,ZOOM)/(2*ACOS(-1))*(ACOS(-1)-SAFE.LN(TAN(ACOS(-1)/4+(BB.ymax/180*ACOS(-1))/2))))) tile_y_xmax_ymax,<br/>  FROM<br/>    bounding_box)<br/>SELECT<br/>  zone_name,<br/>  tile_id,<br/>  ST_MAKEPOLYGON( ST_MAKELINE([ ST_GEOGPOINT(NW_LONG,<br/>        NW_LAT),<br/>      ST_GEOGPOINT(NE_LONG,<br/>        NE_LAT),<br/>      ST_GEOGPOINT(SE_LONG,<br/>        SE_LAT),<br/>      ST_GEOGPOINT(SW_LONG,<br/>        SW_LAT),<br/>      ST_GEOGPOINT(NW_LONG,<br/>        NW_LAT) ])) polygon<br/>FROM (<br/>  SELECT<br/>    zone_name,<br/>    zone_geom,<br/>    ZOOM || tile_x || tile_y tile_id,<br/>    180/ACOS(-1)*(2*ACOS(-1)*tile_x/POW(2,ZOOM)-ACOS(-1)) AS NW_LONG,<br/>    360/ACOS(-1)*(ATAN(EXP(ACOS(-1)-2*ACOS(-1)/POW(2,ZOOM)*tile_y))-ACOS(-1)/4) AS NW_LAT,<br/>    180/ACOS(-1)*(2*ACOS(-1)*(tile_x+1)/POW(2,ZOOM)-ACOS(-1)) AS NE_LONG,<br/>    360/ACOS(-1)*(ATAN(EXP(ACOS(-1)-2*ACOS(-1)/POW(2,ZOOM)*tile_y))-ACOS(-1)/4) AS NE_LAT,<br/>    180/ACOS(-1)*(2*ACOS(-1)*(tile_x+1)/POW(2,ZOOM)-ACOS(-1)) AS SE_LONG,<br/>    360/ACOS(-1)*(ATAN(EXP(ACOS(-1)-2*ACOS(-1)/POW(2,ZOOM)*(tile_y+1)))-ACOS(-1)/4) AS SE_LAT,<br/>    180/ACOS(-1)*(2*ACOS(-1)*(tile_x)/POW(2,ZOOM)-ACOS(-1)) AS SW_LONG,<br/>    360/ACOS(-1)*(ATAN(EXP(ACOS(-1)-2*ACOS(-1)/POW(2,ZOOM)*(tile_y+1)))-ACOS(-1)/4) SW_LAT<br/>  FROM (<br/>    SELECT<br/>      zone_name,<br/>      zone_geom,<br/>      (tile_x_xmin_ymin + x) tile_x,<br/>      (tile_y_xmin_ymin + y) tile_y<br/>    FROM<br/>      tiles_at_corners,<br/>      UNNEST(GENERATE_ARRAY(0,tile_x_xmax_ymax-tile_x_xmin_ymin,1)) x,<br/>      UNNEST(GENERATE_ARRAY(tile_y_xmax_ymax-tile_y_xmin_ymin,0,1)) y) )<br/>WHERE<br/>  TRUE QUALIFY ROW_NUMBER() OVER (PARTITION BY tile_id ORDER BY st_area(st_intersection(polygon, zone_geom)) DESC)=1</span></pre><p id="39c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">确保对您认为以后需要的每个<code class="fe mk ml mm mb b">ZOOM</code>值重复此过程。</p><h2 id="eaff" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">准备最终查询</h2><p id="3ca7" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">对于给定的<code class="fe mk ml mm mb b">ZOOM</code>值，我们现在知道每个图块属于哪个滑行区域，因此我们可以从我们离开的地方继续:</p><pre class="kn ko kp kq gt ma mb mc md aw me bi"><span id="1b3c" class="lc ld iq mb b gy mf mg l mh mi">DECLARE<br/>  START_DATE DATE;<br/>DECLARE<br/>  END_DATE DATE;<br/>DECLARE<br/>  ZOOM INT64;<br/>SET<br/>  START_DATE='2015-01-01';<br/>SET<br/>  END_DATE='2015-01-01';<br/>SET<br/>  ZOOM=17;<br/>SELECT<br/>  trips.*,<br/>  t.polygon<br/>FROM (<br/>  SELECT<br/>    t1.zone_name pickup_zone_name,<br/>    t2.zone_name dropoff_zone_name,<br/>    dropoff_tile_id,<br/>    COUNT(*) trips<br/>  FROM (<br/>    SELECT<br/>      ZOOM || TRUNC((pickup_longitude*ACOS(-1)/180+ACOS(-1))/(2*ACOS(-1))*POW(2,ZOOM)) || TRUNC((POW(2,ZOOM)/(2*ACOS(-1))*(ACOS(-1)-SAFE.LN(TAN(ACOS(-1)/4+(pickup_latitude/180*ACOS(-1))/2))))) AS pickup_tile_id,<br/>      ZOOM || TRUNC((dropoff_longitude*ACOS(-1)/180+ACOS(-1))/(2*ACOS(-1))*POW(2,ZOOM)) || TRUNC((POW(2,ZOOM)/(2*ACOS(-1))*(ACOS(-1)-SAFE.LN(TAN(ACOS(-1)/4+(dropoff_latitude/180*ACOS(-1))/2))))) AS dropoff_tile_id,<br/>    FROM<br/>      `bigquery-public-data.new_york_taxi_trips.tlc_yellow_trips_2015`<br/>    WHERE<br/>      DATETIME_TRUNC(pickup_datetime,<br/>        DAY) BETWEEN START_DATE<br/>      AND END_DATE ) trips<br/>  INNER JOIN<br/>    NY_Taxi_Trips.Tiles t1<br/>  ON<br/>    pickup_tile_id=t1.tile_id<br/>  INNER JOIN<br/>    NY_Taxi_Trips.Tiles t2<br/>  ON<br/>    dropoff_tile_id=t2.tile_id<br/>  GROUP BY<br/>    pickup_zone_name,<br/>    dropoff_zone_name,<br/>    dropoff_tile_id) trips<br/>INNER JOIN<br/>  NY_Taxi_Trips.Tiles t<br/>ON<br/>  dropoff_tile_id=t.tile_id</span></pre><p id="be21" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们使用了几次表<code class="fe mk ml mm mb b">NY_Taxi_Trips.Tiles</code>,它是我们在具有相应区域名称的瓷砖多边形之前保存的地方。因此，该查询的输出给出了在<code class="fe mk ml mm mb b">START_DATE</code>和<code class="fe mk ml mm mb b">END_DATE</code>之间的<code class="fe mk ml mm mb b">dropoff_zone_name</code>中从<code class="fe mk ml mm mb b">pickup_zone_name</code>到<code class="fe mk ml mm mb b">dropoff_tile_id</code>记录的旅行次数。请注意，我们在最后一个<code class="fe mk ml mm mb b">SELECT</code>语句中引入了<code class="fe mk ml mm mb b">GEOGRAPHY</code>字段，即<code class="fe mk ml mm mb b">polygon</code>，以避免加重前面步骤的负担。</p><p id="e2e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦我们在BigQuery上测试了这个查询，我们就准备将它用于Data Studio。我们只需要改变代码中引用声明参数的方式:</p><pre class="kn ko kp kq gt ma mb mc md aw me bi"><span id="6296" class="lc ld iq mb b gy mf mg l mh mi">SELECT<br/>  trips.*,<br/>  t.polygon<br/>FROM (<br/>  SELECT<br/>    t1.zone_name pickup_zone_name,<br/>    t2.zone_name dropoff_zone_name,<br/>    dropoff_tile_id,<br/>    COUNT(*) trips<br/>  FROM (<br/>    SELECT<br/>      <a class="ae kl" href="http://twitter.com/ZOOM" rel="noopener ugc nofollow" target="_blank">@ZOOM</a> || TRUNC((pickup_longitude*ACOS(-1)/180+ACOS(-1))/(2*ACOS(-1))*POW(2,<a class="ae kl" href="http://twitter.com/ZOOM" rel="noopener ugc nofollow" target="_blank">@ZOOM</a>)) || TRUNC((POW(2,<a class="ae kl" href="http://twitter.com/ZOOM" rel="noopener ugc nofollow" target="_blank">@ZOOM</a>)/(2*ACOS(-1))*(ACOS(-1)-SAFE.LN(TAN(ACOS(-1)/4+(pickup_latitude/180*ACOS(-1))/2))))) AS pickup_tile_id,<br/>      <a class="ae kl" href="http://twitter.com/ZOOM" rel="noopener ugc nofollow" target="_blank">@ZOOM</a> || TRUNC((dropoff_longitude*ACOS(-1)/180+ACOS(-1))/(2*ACOS(-1))*POW(2,<a class="ae kl" href="http://twitter.com/ZOOM" rel="noopener ugc nofollow" target="_blank">@ZOOM</a>)) || TRUNC((POW(2,<a class="ae kl" href="http://twitter.com/ZOOM" rel="noopener ugc nofollow" target="_blank">@ZOOM</a>)/(2*ACOS(-1))*(ACOS(-1)-SAFE.LN(TAN(ACOS(-1)/4+(dropoff_latitude/180*ACOS(-1))/2))))) AS dropoff_tile_id,<br/>    FROM<br/>      `bigquery-public-data.new_york_taxi_trips.tlc_yellow_trips_2015`<br/>    WHERE<br/>      DATETIME_TRUNC(pickup_datetime,<br/>        DAY) BETWEEN PARSE_DATE('%Y%m%d',<br/>        <a class="ae kl" href="http://twitter.com/DS_START_DATE" rel="noopener ugc nofollow" target="_blank">@DS_START_DATE</a>)<br/>      AND PARSE_DATE('%Y%m%d',<br/>        <a class="ae kl" href="http://twitter.com/DS_END_DATE" rel="noopener ugc nofollow" target="_blank">@DS_END_DATE</a>)) trips<br/>  INNER JOIN<br/>    NY_Taxi_Trips.Tiles t1<br/>  ON<br/>    pickup_tile_id=t1.tile_id<br/>  INNER JOIN<br/>    NY_Taxi_Trips.Tiles t2<br/>  ON<br/>    dropoff_tile_id=t2.tile_id<br/>  GROUP BY<br/>    pickup_zone_name,<br/>    dropoff_zone_name,<br/>    dropoff_tile_id) trips<br/>INNER JOIN<br/>  NY_Taxi_Trips.Tiles t<br/>ON<br/>  dropoff_tile_id=t.tile_id</span></pre><ol class=""><li id="83aa" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated"><code class="fe mk ml mm mb b">ZOOM</code> → <code class="fe mk ml mm mb b">@ZOOM</code></li><li id="795a" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><code class="fe mk ml mm mb b">START_DATE</code> → <code class="fe mk ml mm mb b">@DS_START_DATE</code></li><li id="da2e" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><code class="fe mk ml mm mb b">END_DATE</code> → <code class="fe mk ml mm mb b">@DS_END_DATE</code></li></ol><h2 id="7cc3" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">在Data Studio中可视化热图</h2><p id="42ba" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">让我们在Data Studio中创建我们的报告，我们将保持它的简单:</p><ol class=""><li id="8854" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated">去https://datastudio.google.com/的<a class="ae kl" href="https://datastudio.google.com/" rel="noopener ugc nofollow" target="_blank"/>。</li><li id="90a4" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><strong class="jp ir">创建</strong> &gt; <strong class="jp ir">报表。</strong></li><li id="2c0c" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">选择<strong class="jp ir"> BigQuery连接器。</strong></li><li id="72a9" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">选择<strong class="jp ir">自定义查询</strong>并复制我们的查询。</li><li id="40ff" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">勾选<strong class="jp ir">启用日期范围参数。</strong></li><li id="7869" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">点击<strong class="jp ir">添加一个参数</strong>并定义最后一个参数，即<code class="fe mk ml mm mb b">ZOOM</code>，使用以下配置:</li></ol><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/22c2b796410aba96c18d9f42e31ac1a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*WKB2-vwWlLihjWdSTSH3Hw.png"/></div><p class="ky kz gj gh gi la lb bd b be z dk translated">缩放参数的定义</p></figure><p id="6a69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，点击<strong class="jp ir">添加</strong>，让我们创建我们的可视化！</p><p id="d532" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们希望能够在查看模式下随时更改我们的参数值，因此我们转到<strong class="jp ir">添加一个控件</strong>，并选择插入一个<strong class="jp ir">输入框</strong>来控制缩放级别:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/5b2a97444e1bbe46efc5a1c800d7b98a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*LRmPbKlkH7ASlvD7XbH8Wg.png"/></div><p class="ky kz gj gh gi la lb bd b be z dk translated">添加一个输入框来控制缩放参数。</p></figure><p id="d8f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们重复此程序，插入<strong class="jp ir">日期范围控件</strong>和<strong class="jp ir">下拉列表</strong>，分别控制日期范围和起始提货区。我们也为两者选择默认值，即第一个为2015年的前6个月，第二个为“<em class="mj"> JFK机场</em>”:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/121a3274e9385fe8fe4a2c5859958c91.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*zev7oFmFdV0IA5cSOnSQWQ.png"/></div><p class="ky kz gj gh gi la lb bd b be z dk translated">默认日期范围值。</p></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/d0f3019036fe4f144d696d036fb5027f.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*_eR8Pg-5l8gpN_6Sfgp_LQ.png"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">我们为提货区选择一个默认值。</p></figure><p id="ebb4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在准备添加地图:</p><ol class=""><li id="7f74" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated">转到<strong class="jp ir">添加图表</strong> &gt; <strong class="jp ir">谷歌地图&gt;填充地图。</strong></li><li id="8ea3" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">将地图插入报告中的任意位置。</li><li id="40a6" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">使用以下<strong class="jp ir">字段</strong>配置让其正常工作:</li></ol><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/27786074760337b88983db6ed41660f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*MinLNdIgHFYjxku7foD2cw.png"/></div><p class="ky kz gj gh gi la lb bd b be z dk translated">填充地图的字段配置。</p></figure><p id="ff85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们也可以自定义地图样式，如下所示:</p><ol class=""><li id="a714" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated">使用<strong class="jp ir">深色</strong>款式</li><li id="3765" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">不使用<strong class="jp ir">边框重量</strong></li><li id="a585" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">选择最大、中间和最小颜色的调色板:<strong class="jp ir"> #ffffff </strong>、<strong class="jp ir"> #ffd54f </strong>和<strong class="jp ir"> #212121 </strong></li></ol><p id="3b6b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，作者是色盲，这可能是最糟糕的颜色选择，你可以随意改变😃。</p><p id="eb53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这一点上，我们应该得到这样的东西:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nj"><img src="../Images/bdf57e659022d9731f4eb342805cf91f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FMMPs4kUOwrU11bEpXxyuw.png"/></div></div><p class="ky kz gj gh gi la lb bd b be z dk translated">我们的首次热图可视化！</p></figure><p id="6079" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们注意到只有一小块突出显示的区域，这里显然聚集了来自JFK机场的大部分旅行。如果我们希望我们的热图看起来不那么平坦，我们可以通过更改图表配置中的<strong class="jp ir">颜色度量</strong>将比例从线性更改为不同的比例:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/99854f0a29eb10b41771568827e77610.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*NP1y5UG3gwht8lnUvCSb6g.png"/></div><p class="ky kz gj gh gi la lb bd b be z dk translated">修改公制以更改比例</p></figure><p id="e0c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，使用<code class="fe mk ml mm mb b">SQRT(SUM(trips))</code>,我们得到一个稍微不同的可视化:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nl"><img src="../Images/8892daf4eb1b9513241a464873bff90e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v1uwxPejCE7GfFpnd2qlfQ.png"/></div></div></figure><p id="e135" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在可以尝试不同的提货区:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nm"><img src="../Images/93e097d7ee16fa94b11a5a2462740368.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wc9-rp7tr_F3wwiGlyQRNw.png"/></div></div></figure><p id="4d29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者不同瓷砖尺寸:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nn"><img src="../Images/c6f3b2a36b6b416762da44aeb3adca52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vZSR_PbMOVUF8nbDe06S9A.png"/></div></div></figure><p id="64ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该是你进一步实验的时候了！</p><p id="418f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">享受😃！</p></div></div>    
</body>
</html>