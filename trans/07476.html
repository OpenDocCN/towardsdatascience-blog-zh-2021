<html>
<head>
<title>Python and Apache Cassandra™ for Beginners</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向初学者的Python和Apache Cassandra</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-and-apache-cassandra-for-beginners-d9682f2f43c1?source=collection_archive---------10-----------------------#2021-07-08">https://towardsdatascience.com/python-and-apache-cassandra-for-beginners-d9682f2f43c1?source=collection_archive---------10-----------------------#2021-07-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="f2c6" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">实践教程</a></h2><div class=""/><div class=""><h2 id="8f48" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">了解如何将Python连接到Cassandra，并使用Datastax ODBC驱动程序插入数据，以及使用Astra web控制台查询数据。</h2></div><p id="9573" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">Python是使用最广泛的编程语言之一，拥有庞大的支持社区，而Cassandra是最受欢迎的NoSQL数据库之一，传统上用于web应用程序存储或依赖于快速数据检索的以数据为中心的应用程序。总之，它们在各行各业和学术界的许多应用中都能找到。</p><p id="1227" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">本Cassandra Python教程面向Python和Cassandra初学者。你可以在整篇文章中看到的代码样本可以在这个<a class="ae lk" href="https://github.com/andyadamides/python-cassandra-intro" rel="noopener ugc nofollow" target="_blank"> Github库</a>中公开获得。我们将指导您设置Python和DataStax Astra，这是一个托管的Cassandra as-a-Service应用程序，可以在任何云上免费运行。我们将向您展示如何将Python连接到Cassandra，如何使用Datastax ODBC驱动程序插入数据，以及如何使用Astra web控制台通过CQL控制台查询存储在Cassandra中的数据。即将发布的Python SDK for Astra将支持针对给定Astra数据库实例的REST、GraphQL和无模式JSON文档API的API访问，这将在下一篇文章中讨论。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ll"><img src="../Images/f8f8355a58a490ad1339a64f391fee7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HYAd1aal5Et1A-Qzs6VAtQ.jpeg"/></div></div></figure><h1 id="67a7" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">Python入门</h1><p id="a55a" class="pw-post-body-paragraph ko kp iq kq b kr mp ka kt ku mq kd kw kx mr kz la lb ms ld le lf mt lh li lj ij bi translated">Python在过去十年中广受欢迎，这是有充分理由的。简单地说，它是一种可读性很强、简单易用的编程语言。它也很容易上手，但同时它可以用于各种不同的应用程序和不同的领域。存在多个Python库，允许解决诸如字符串操作、实现机器学习算法、<a class="ae lk" href="https://en.wikipedia.org/wiki/Object-oriented_programming" rel="noopener ugc nofollow" target="_blank">、面向对象</a>编程和数据工程目的等问题，我们将在本教程中重点介绍这些问题。</p><h1 id="a679" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">安装Python</h1><p id="bccf" class="pw-post-body-paragraph ko kp iq kq b kr mp ka kt ku mq kd kw kx mr kz la lb ms ld le lf mt lh li lj ij bi translated">Python有两个主要版本，Python 2和Python 3。前者不再接收更新，也不再受支持，而后者是最新版本，也是我们将使用的版本。无论您使用什么操作系统，安装Python都很容易。</p><p id="df19" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在你的电脑上安装Python的最好方法是通过官方的Python页面。根据你使用的操作系统，从官方<a class="ae lk" href="https://www.python.org/downloads/release/python-394/" rel="noopener ugc nofollow" target="_blank">页面</a>选择合适的安装程序。</p><p id="6c79" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">要验证Python是否已正确安装在您的计算机上，请打开命令行窗口并执行以下操作:</p><pre class="lm ln lo lp gt mu mv mw mx aw my bi"><span id="12ce" class="mz ly iq mv b gy na nb l nc nd">python --<em class="ne">version</em></span></pre><p id="7110" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这将返回您刚刚安装的版本:</p><pre class="lm ln lo lp gt mu mv mw mx aw my bi"><span id="8f50" class="mz ly iq mv b gy na nb l nc nd">Python 3.8.2</span></pre><p id="985a" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">如果你正确地安装了Python并且得到了一个<strong class="kq ja">命令没有找到</strong>或者类似的错误信息，这很可能意味着Python没有被正确地添加到你的操作系统的PATH变量中；所以一定要仔细检查Python的安装路径是否是该路径的一部分。</p><h1 id="9512" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">安装Python依赖项</h1><p id="b5ea" class="pw-post-body-paragraph ko kp iq kq b kr mp ka kt ku mq kd kw kx mr kz la lb ms ld le lf mt lh li lj ij bi translated">像任何其他编程语言一样，Python也使用单独的实用程序来安装包。Python内置的包管理器叫做<strong class="kq ja"> pip。</strong>除了来自pip，其他流行的Python包管理器包括<a class="ae lk" href="https://pypi.org/project/virtualenv/" rel="noopener ugc nofollow" target="_blank"><strong class="kq ja">virtualenv</strong></a><strong class="kq ja"/>和<a class="ae lk" href="https://www.anaconda.com/products/individual" rel="noopener ugc nofollow" target="_blank"> <strong class="kq ja"> conda </strong> </a> <strong class="kq ja">，</strong>但是为了这个Cassandra Python教程的目的，我们将使用<strong class="kq ja"> pip。</strong></p><p id="9c06" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">每一个使用<strong class="kq ja"> pip，</strong>的Python项目通常会在资源库的根目录下有一个名为<strong class="kq ja"> requirements.txt </strong>的文件，就像我们在<a class="ae lk" href="https://github.com/andyadamides/python-cassandra-intro/blob/main/requirements.txt" rel="noopener ugc nofollow" target="_blank"> Github项目中有requirements.txt一样。这个文件的内容非常简单；每一行都由包的名称组成，可选地后跟该包的特定版本:</a></p><pre class="lm ln lo lp gt mu mv mw mx aw my bi"><span id="759f" class="mz ly iq mv b gy na nb l nc nd">cassandra-driver==3.25.0<br/>numpy==1.19.3<br/>astrapy==0.0.2<br/>simplejson==3.17.2</span></pre><p id="33b1" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">要安装所需的包，包括Cassandra Python库<strong class="kq ja"> cassandra-driver </strong>和<strong class="kq ja"> astrapy </strong>，只需在命令行中导航到根目录并执行:</p><pre class="lm ln lo lp gt mu mv mw mx aw my bi"><span id="951e" class="mz ly iq mv b gy na nb l nc nd">pip install -r requirements.txt</span></pre><p id="2306" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">后台发生的事情是<strong class="kq ja"> pip </strong>将从默认和公共Python包索引<a class="ae lk" href="https://pypi.org/" rel="noopener ugc nofollow" target="_blank"> PyPi </a>中获取这些包。您可以查看每个包的PyPi主页，包括可用版本、进一步的文档、每个包的Github库的链接以及如何使用每个包的示例。例如，这是<a class="ae lk" href="https://pypi.org/project/numpy/" rel="noopener ugc nofollow" target="_blank">数字</a>的页面，这是<a class="ae lk" href="https://pypi.org/project/cassandra-driver/" rel="noopener ugc nofollow" target="_blank">卡珊德拉驱动</a>的页面。</p><p id="880b" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这就完成了我们Python项目的依赖项的安装。</p><h1 id="f913" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">卡珊德拉是什么？</h1><p id="0109" class="pw-post-body-paragraph ko kp iq kq b kr mp ka kt ku mq kd kw kx mr kz la lb ms ld le lf mt lh li lj ij bi translated">Cassandra是领先的开源NoSQL分布式数据库管理系统(DBMS)。与Oracle或SQL Server等传统SQL DBMS不同，NoSQL数据库遵循不同的存储模型。在SQL系统中，数据组织在由固定模式驱动的表和列中，而在Cassandra中，固定模式并不强制实施，允许同一表(或Cassandra中通常称为表的列族)中有动态数量的列，并且能够处理和存储非结构化数据。除此之外，用于与Cassandra交互的语言是传统SQL的变体(和子集)，称为Cassandra查询语言(CQL)。</p><p id="ee38" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">90%的财富100强公司都在使用Cassandra。快速增长的事实可以用其丰富的功能集来解释，这些功能对大量数据特别有益。其分布式体系结构可确保超快的写入性能和数据查询的快速检索，无单点故障，从而实现100%的高可用性，并显著缩短上市时间，因为Cassandra集群的部署、管理和维护非常简单。</p><h1 id="106d" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">建立卡珊德拉数据库</h1><p id="5034" class="pw-post-body-paragraph ko kp iq kq b kr mp ka kt ku mq kd kw kx mr kz la lb ms ld le lf mt lh li lj ij bi translated">Cassandra是开源的，这意味着它可以免费使用。根据您使用的操作系统，您可以在本地下载Cassandra及其依赖项，并进行配置和安装。Kubernetes用户也可以使用Docker图像，但所有这些过程可能会令人厌倦，尤其是对于第一次使用的用户。</p><p id="7bce" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">开始使用Cassandra的最佳方式是通过一个可从网上获得的托管Cassandra数据库。Datastax Astra是一个由Apache Cassandra支持的无服务器数据库即服务，只需几次点击即可启动，有一个慷慨的免费层，可在主要的云提供商(亚马逊网络服务，Azure或谷歌云)中使用。</p><p id="a163" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">官方Astra指南提供了创建Astra服务所需的所有信息；你需要注册一个账户，然后选择更多的细节，比如选择一个云提供商和命名你的数据库。</p><h1 id="d2dd" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">使用astrapy生成JSON并插入到Astra中</h1><p id="44c2" class="pw-post-body-paragraph ko kp iq kq b kr mp ka kt ku mq kd kw kx mr kz la lb ms ld le lf mt lh li lj ij bi translated">使用React、Angular或Vue作为前端？<a class="ae lk" href="https://pypi.org/project/astrapy/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq ja"> astrapy </strong> </a>是一个方便的Cassandra Python库，它在Datastax Astra的REST API上创建了一个无模式的、面向JSON文档的API。在这个例子中，我们将使用一个令牌(而不是客户端密码)向Astra认证，生成一个伪JSON文档，并发出一个PUT REST调用，将JSON插入到Astra集合中。</p><p id="0cde" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在浏览代码之前，确保你已经安装了<strong class="kq ja"> astrapy </strong>和<a class="ae lk" href="https://pypi.org/project/simplejson/" rel="noopener ugc nofollow" target="_blank"> simplejson </a>库。你可以通过执行<strong class="kq ja"> pip冻结来检查。</strong>如果你没有它们，用<strong class="kq ja">pip install-r requirements.txt .</strong>从项目根目录下的requirements . txt文件中安装它们</p><p id="19ba" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">首先在代码中，我们将得到一个Astra HTTP客户端。在此之前，我们需要生成一个应用程序令牌，并总共导出五个环境变量。导航至Datastax Astra主页，点击数据库名称:</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/9ba60c2e89fbad9e34ed2aa3052390ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*1d5UcmS0pem5R3W5"/></div></figure><p id="9152" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">然后，在数据库名称下方，点击<strong class="kq ja">连接</strong>:</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ng"><img src="../Images/d3844a4138164e46086818ee8cdf4d51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qJdDrtnTRGZU5kv7"/></div></div></figure><p id="1297" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这一次，使用API 选项保持在<strong class="kq ja">连接上:</strong></p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi nh"><img src="../Images/28b464b188f1c0b9975465d0b74a4157.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VEi_iUlTN9_y-bhy"/></div></div></figure><p id="e5d4" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">注意您需要在页面右侧导出的5个环境变量中的3个:</p><ul class=""><li id="9d7c" class="ni nj iq kq b kr ks ku kv kx nk lb nl lf nm lj nn no np nq bi translated"><strong class="kq ja"> ASTRA_DB_ID </strong></li><li id="5653" class="ni nj iq kq b kr nr ku ns kx nt lb nu lf nv lj nn no np nq bi translated"><strong class="kq ja"> ASTRA_DB_REGION </strong></li><li id="531b" class="ni nj iq kq b kr nr ku ns kx nt lb nu lf nv lj nn no np nq bi translated"><strong class="kq ja"> ASTRA_DB_KEYSPACE </strong></li></ul><p id="f418" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">对于<strong class="kq ja">ASTRA _ DB _ APPLICATION _ TOKEN</strong>环境变量，让我们生成<strong class="kq ja">连接凭证</strong>。点击显示“<strong class="kq ja">此处”</strong>的地方:</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi nh"><img src="../Images/fc1f1064a70dd6602c55930c52248ecb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OxiQUCZ8pqNt90B2"/></div></div></figure><p id="47c7" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">将弹出一个新页面，选择角色(选择<strong class="kq ja">读/写用户</strong>)并点击<strong class="kq ja">生成令牌</strong>:</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi nh"><img src="../Images/18f783a23ff416a482910a083f4b1e45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ms5xIM5trqc_YB08"/></div></div></figure><p id="7051" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">一旦你这样做，你会得到一个窗口，所有的细节:</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi nh"><img src="../Images/836f72ed5ba80fde01956195897d5640.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XB2LnsIsUf76p50l"/></div></div></figure><p id="36c6" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">确保将其他(客户Id、客户机密)信息保存在您可以参考的地方，因为我们稍后会用到它们。导出<strong class="kq ja">ASTRA _ DB _ APPLICATION _ TOKEN</strong>环境变量，该变量等于在此步骤中生成的令牌..</p><p id="5423" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">为第五个也是最后一个环境变量<strong class="kq ja"> ASTRA_DB_COLLECTION填入您喜欢的任何名称。</strong>在我这里这个变量等于<strong class="kq ja"> demo_book。</strong></p><p id="3a85" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">一旦根据所使用的操作系统导出了五个环境变量，就可以开始执行Python脚本了。第一部分将使用令牌身份验证来验证Datastax Astra:</p><figure class="lm ln lo lp gt lq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="44af" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">一旦我们有了HTTP客户机对象，它就被传递给下一个方法，在这个方法中，我们创建一个JSON文档并将其插入到Astra集合中:</p><figure class="lm ln lo lp gt lq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="c966" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">要执行Python脚本，请键入<strong class="kq ja">Python JSON _ document _ API . py</strong>并按回车键。</p><p id="eba6" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">最后，我们可以通过发出一个<strong class="kq ja"> curl </strong>命令来确认文档已经成功插入，并通过如下命令行检索它:</p><figure class="lm ln lo lp gt lq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="d769" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这个命令将返回所有插入的文档，在我们的例子中:</p><figure class="lm ln lo lp gt lq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><h1 id="9334" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">使用驱动程序建立从Python到Astra的连接</h1><p id="8e11" class="pw-post-body-paragraph ko kp iq kq b kr mp ka kt ku mq kd kw kx mr kz la lb ms ld le lf mt lh li lj ij bi translated">Cassandra Python<a class="ae lk" href="https://pypi.org/project/cassandra-driver/" rel="noopener ugc nofollow" target="_blank"><strong class="kq ja">Cassandra-driver</strong></a>使得在Datastax Astra中认证和插入表格数据变得容易。到目前为止，我们已经确保安装了Python，并且有了一个Astra无服务器实例，我们可以使用一个无模式的、面向JSON文档的API来处理它。让我们继续使用cassandra-driver作为Astra Python SDK中文档API的模式驱动替代，与我们的Astra数据库进行实际交互。</p><p id="45bf" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在开始编码之前，我们需要了解配置从Python到Astra的连接的先决条件。在Astra仪表板页面上，点击页面左侧的数据库名称:</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/9573a0b8c5e1ded0ee063fe4dd1dd2be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*KnCoCoZXZoy9MbUL"/></div></figure><p id="7bd3" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">然后，在数据库名称的正下方，点击<strong class="kq ja">连接</strong>:</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ng"><img src="../Images/58d7964b08b58ea7ea4d0c467d26fb38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GnN6pCs3fjXpTSvs"/></div></div></figure><p id="84ca" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">从驱动列表中选择<strong class="kq ja"> Python </strong>:</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ny"><img src="../Images/0b389e230ae24df11564b4dc6ec36beb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qutFQ2UrKCKnIUL6"/></div></div></figure><p id="5af2" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在，您会看到页面右侧弹出了一个详细的步骤指南。首先，我们将确保下载<strong class="kq ja">包</strong>，并将其存储在我们的本地存储中。我们将在后面的代码中引用这一点。在页面右侧，点击<strong class="kq ja">下载捆绑包</strong>按钮，然后点击<strong class="kq ja">安全连接捆绑包</strong>弹出按钮</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi nz"><img src="../Images/f2209913d5ffbb87360a4f165920b5f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Euurrn9eJgEeb7UH"/></div></div></figure><p id="d5c1" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这将下载从浏览器配置的默认下载目录中的包。这通常位于您的主目录中，包的名称遵循特定的命名格式<strong class="kq ja">secure-connect-&lt;database-name&gt;。例如，在我们的例子中，它被命名为<strong class="kq ja">secure-connect-Cassandra-pythondemo . zip。</strong></strong></p><h1 id="0702" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">如何在Astra中创建Cassandra表</h1><p id="49c1" class="pw-post-body-paragraph ko kp iq kq b kr mp ka kt ku mq kd kw kx mr kz la lb ms ld le lf mt lh li lj ij bi translated">在本节中，我们将使用Python生成一个虚构的<a class="ae lk" href="https://en.wikipedia.org/wiki/Time_series" rel="noopener ugc nofollow" target="_blank">时间序列</a>数据集，并使用Datastax Python ODBC/JDBC驱动程序将数据插入到我们的Astra数据库中。</p><p id="3e6d" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">首先，我们将创建Astra表来保存我们的数据。导航至Astra仪表板页面，点击页面左侧的数据库名称:</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/1e57b7a1afaae6e92fbb72cc97f45316.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*Bh4nFkOs1Ua6Ozx5"/></div></figure><p id="2023" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">点击Cassandra查询语言(CQL)控制台:</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi oa"><img src="../Images/390f8ab5447ba830cfd5bbd748903740.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gTEWFcNaaVJz4d01"/></div></div></figure><p id="53a9" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">从<a class="ae lk" href="https://github.com/andyadamides/python-cassandra-intro" rel="noopener ugc nofollow" target="_blank"> Github repo </a>中复制<strong class="kq ja">intro/demo _ readings . SQL</strong>并粘贴到CQL控制台上，然后点击回车:</p><figure class="lm ln lo lp gt lq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="4224" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这就完成了Astra表的创建。正如您在上面的<a class="ae lk" href="https://en.wikipedia.org/wiki/Data_definition_language" rel="noopener ugc nofollow" target="_blank"> DDL </a>脚本中所看到的，这个timeseries数据集由浮点值度量(<em class="ne">值</em>)组成，它是在连续的时间间隔(<em class="ne">值_ts </em>)中为一个虚构的硬件对(<em class="ne">设备_id </em>和<em class="ne">时间序列_id </em>)捕获的，同时还包括记录被捕获时的时间戳(<em class="ne">发布_ts </em>)。</p><h1 id="3586" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">用Python在Cassandra中插入数据</h1><p id="ebf0" class="pw-post-body-paragraph ko kp iq kq b kr mp ka kt ku mq kd kw kx mr kz la lb ms ld le lf mt lh li lj ij bi translated">创建Cassandra表之后，让我们导航到<strong class="kq ja"> Python </strong>。首先，确保<strong class="kq ja"> git在您的本地文件系统中克隆</strong>项目:</p><pre class="lm ln lo lp gt mu mv mw mx aw my bi"><span id="28c1" class="mz ly iq mv b gy na nb l nc nd">git clone git@github.com:andyadamides/python-cassandra-intro.git</span></pre><p id="32f3" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><em class="ne">注意</em>:如果您没有安装git，请按照本<a class="ae lk" href="https://github.com/git-guides/install-git" rel="noopener ugc nofollow" target="_blank"> Github指南</a>进行安装。</p><p id="12e9" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">该程序由一个名为<strong class="kq ja"> main.py </strong>的Python脚本组成。入口点位于脚本的最后两行。Python解释器通过设计知道从脚本的这一部分开始执行:</p><pre class="lm ln lo lp gt mu mv mw mx aw my bi"><span id="cfb5" class="mz ly iq mv b gy na nb l nc nd">if __name__ == “__main__”:<br/>    main()</span></pre><p id="1ff9" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="kq ja"> main() </strong>方法执行两个高级任务，它建立与Astra数据库的连接，然后插入已经生成的数据:</p><pre class="lm ln lo lp gt mu mv mw mx aw my bi"><span id="7b0f" class="mz ly iq mv b gy na nb l nc nd"><strong class="mv ja">def</strong> main():<br/>“””The main routine.”””<br/>    session = getDBSession()<br/>    generateDataEntrypoint(session)</span></pre><p id="31d1" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">建立与Astra数据库的连接发生在<strong class="kq ja"> getDBSession() </strong>方法中:</p><figure class="lm ln lo lp gt lq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="cee4" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在这一步，确保填写正确的连接Astra的详细信息。特别要确保<strong class="kq ja">导出</strong>Python代码期望的三个环境变量，以便安全成功地建立到Astra的连接:</p><ul class=""><li id="10ae" class="ni nj iq kq b kr ks ku kv kx nk lb nl lf nm lj nn no np nq bi translated">ASTRA_PATH_TO_SECURE_BUNDLE</li><li id="46ea" class="ni nj iq kq b kr nr ku ns kx nt lb nu lf nv lj nn no np nq bi translated">ASTRA_CLIENT_ID</li><li id="86e7" class="ni nj iq kq b kr nr ku ns kx nt lb nu lf nv lj nn no np nq bi translated">阿斯特拉_客户_秘密</li></ul><p id="565b" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="kq ja">注:</strong> ASTRA_CLIENT_ID和ASTRA_CLIENT_SECRET是在上面的部分生成的。</p><p id="90bf" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">找到上一步中下载的包zip，并将其复制到一个目录中，该目录可以配置为ASTRA_PATH_TO_SECURE_BUNDLE环境变量的一部分:</p><blockquote class="ob oc od"><p id="8c97" class="ko kp ne kq b kr ks ka kt ku kv kd kw oe ky kz la of lc ld le og lg lh li lj ij bi translated">cloud_config= {</p><p id="370d" class="ko kp ne kq b kr ks ka kt ku kv kd kw oe ky kz la of lc ld le og lg lh li lj ij bi translated">' SECURE _ connect _ BUNDLE ':OS . environ . get(' ASTRA _ PATH _ TO _ SECURE _ BUNDLE ')</p><p id="1add" class="ko kp ne kq b kr ks ka kt ku kv kd kw oe ky kz la of lc ld le og lg lh li lj ij bi">}</p></blockquote><p id="ccfc" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">例如，如果将安全包zip放在Python项目的根目录中，ASTRA_PATH_TO_SECURE_BUNDLE环境变量的值需要等于'<strong class="kq ja">../secure-connect-Cassandra-pythondemo . zip</strong>，项目的根目录将包括以下文件和文件夹:</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi oh"><img src="../Images/dd8aac2eea201b69505ba167beb17967.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Uax2yv9FIMp2V2qE"/></div></div></figure><p id="fc09" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">同样，用上一步中的值设置ASTRA_CLIENT_ID和ASTRA_CLIENT_SECRET环境变量。</p><p id="2772" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">一旦建立了连接，我们就通过传递在上一步的<strong class="kq ja"> getDBSession() </strong>方法中生成的Astra <strong class="kq ja"> session </strong>对象，在<strong class="kq ja">generateDataEntrypoint(session)</strong>方法中生成和插入数据。</p><p id="a649" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="kq ja">注意:</strong>拥有<a class="ae lk" href="https://en.wikipedia.org/wiki/Hard_coding" rel="noopener ugc nofollow" target="_blank">硬编码的</a>秘密是<strong class="kq ja">而不是</strong>推荐的最佳实践；请确保不要在生产中使用它，并以安全第一的心态设计您的应用程序。在本文中，我们不会讨论安全获取机密的最佳实践。</p><p id="610d" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">当我们生成虚构的数据时，我们利用<a class="ae lk" href="https://numpy.org/" rel="noopener ugc nofollow" target="_blank"><strong class="kq ja">numpy</strong></a><strong class="kq ja"/>和<a class="ae lk" href="https://docs.python.org/3/library/random.html" rel="noopener ugc nofollow" target="_blank"><strong class="kq ja">random</strong></a><strong class="kq ja"/>Python库来帮助创建一个基于任意范围的id列表，然后随机选取一个id:</p><figure class="lm ln lo lp gt lq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="f3db" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们还用两个循环包围了我们的生成脚本，并且我们根据两个静态变量配置了运行次数。例如，以下脚本将生成2个时间序列，每个序列有10行(基于<strong class="kq ja"> timeseries_to_generate </strong>和<strong class="kq ja"> number_of_rows </strong>变量):</p><figure class="lm ln lo lp gt lq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="f493" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">将数据插入Astra发生在<strong class="kq ja"> generateInsertData(t_id，number_of_rows，session) </strong>方法中:</p><figure class="lm ln lo lp gt lq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="e944" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">首先，我们用<strong class="kq ja">读数</strong>和<strong class="kq ja">设备标识</strong>变量准备虚拟数据。对于这些变量，我们正在创建另外两个<strong class="kq ja"> numpy </strong>任意列表，方法与我们之前创建<strong class="kq ja">时间序列id</strong>的方法相同。我们还引入了一个名为<a class="ae lk" href="https://docs.python.org/3/library/datetime.html" rel="noopener ugc nofollow" target="_blank"><strong class="kq ja">datetime</strong></a><strong class="kq ja"/>的新Python模块，在其中我们用来创建<strong class="kq ja"> value_ts </strong>和<strong class="kq ja"> t_pub_ts </strong>变量。</p><p id="93fd" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在上述变量初始化之后，我们正在用<strong class="kq ja"> insert_query </strong>变量为Astra准备insert语句。一个<a class="ae lk" href="https://docs.datastax.com/en/developer/python-driver/3.9/api/cassandra/query/#cassandra.query.PreparedStatement" rel="noopener ugc nofollow" target="_blank"> PreparedStatement </a>对于在一个应用程序中多次执行的查询特别有用，这符合我们的用例。如您所见，我们将在下面的for循环中调用<strong class="kq ja"> insert_query </strong>与<strong class="kq ja"> number_of_rows </strong>变量一样多的次数，将数据插入到我们在上一步中创建的表中:</p><pre class="lm ln lo lp gt mu mv mw mx aw my bi"><span id="9b1c" class="mz ly iq mv b gy na nb l nc nd">session.execute(insert_query, [device_id, t_id, value_ts, t_pub_ts, round(random.choice(readings),2)])</span></pre><p id="8278" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="kq ja">session . execute(insert _ query，data) </strong>函数调用有效地使用了我们在上一步中创建的Astra数据库会话。它的第一个参数是<strong class="kq ja"> insert_query </strong>预准备语句，第二个参数是一个类似于<strong class="kq ja">数组的对象</strong>，它包含要插入数据库表的实际数据。</p><p id="92ec" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在Astra中执行Python脚本并检查结果</p><p id="6fd8" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">让我们继续执行Python脚本。</p><p id="ce19" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="kq ja">注意:</strong>在尝试执行这个脚本之前，确保<a class="ae lk" href="https://github.com/git-guides/git-clone" rel="noopener ugc nofollow" target="_blank"> <strong class="kq ja"> git克隆</strong> </a> <strong class="kq ja"> </strong>回购以及遵循本文开头列出的所有先决条件(安装Python、设置Astra、在Python中设置Astra捆绑包和客户端id/secret)。</p><p id="a069" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">打开命令提示符，导航至Python脚本文件的位置。确保配置要生成的数据数量(<strong class="kq ja"> timeseries_to_generate </strong>和<strong class="kq ja"> number_of_rows </strong>变量)。然后，执行:</p><pre class="lm ln lo lp gt mu mv mw mx aw my bi"><span id="89c6" class="mz ly iq mv b gy na nb l nc nd">python main.py</span></pre><p id="6761" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">根据您汇总的配置，您将获得类似于以下内容的输出:</p><pre class="lm ln lo lp gt mu mv mw mx aw my bi"><span id="bf7d" class="mz ly iq mv b gy na nb l nc nd">Processing:130483</span><span id="f827" class="mz ly iq mv b gy oi nb l nc nd">Success</span><span id="23ba" class="mz ly iq mv b gy oi nb l nc nd">Success</span><span id="f6ef" class="mz ly iq mv b gy oi nb l nc nd">Success</span><span id="64c2" class="mz ly iq mv b gy oi nb l nc nd">Success</span><span id="f65f" class="mz ly iq mv b gy oi nb l nc nd">Success</span><span id="9879" class="mz ly iq mv b gy oi nb l nc nd">Success</span><span id="25ab" class="mz ly iq mv b gy oi nb l nc nd">Success</span><span id="bdca" class="mz ly iq mv b gy oi nb l nc nd">Success</span><span id="884a" class="mz ly iq mv b gy oi nb l nc nd">Success</span><span id="363f" class="mz ly iq mv b gy oi nb l nc nd">Success</span><span id="8833" class="mz ly iq mv b gy oi nb l nc nd">Processing:176990</span><span id="b4d7" class="mz ly iq mv b gy oi nb l nc nd">Success</span><span id="1cb0" class="mz ly iq mv b gy oi nb l nc nd">Success</span><span id="9b91" class="mz ly iq mv b gy oi nb l nc nd">Success</span><span id="bfd0" class="mz ly iq mv b gy oi nb l nc nd">Success</span><span id="994e" class="mz ly iq mv b gy oi nb l nc nd">Success</span><span id="d3cd" class="mz ly iq mv b gy oi nb l nc nd">Success</span><span id="c8e3" class="mz ly iq mv b gy oi nb l nc nd">Success</span><span id="014a" class="mz ly iq mv b gy oi nb l nc nd">Success</span><span id="ac48" class="mz ly iq mv b gy oi nb l nc nd">Success</span><span id="2e3c" class="mz ly iq mv b gy oi nb l nc nd">Success</span></pre><p id="75e2" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">以上表明Python程序的执行是成功的。为了检查数据是否已经被插入到Astra中，让我们转到Astra控制台并执行一个<strong class="kq ja"> CQL </strong>脚本。</p><p id="136e" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在Astra控制台中，导航至CQL控制台选项卡:</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi nh"><img src="../Images/443d13a9969332444496027b5436f441.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7RGLjaDPahYeA3BB"/></div></div></figure><p id="ae88" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">键入以下CQL查询并点击<strong class="kq ja">回车</strong>:</p><pre class="lm ln lo lp gt mu mv mw mx aw my bi"><span id="1251" class="mz ly iq mv b gy na nb l nc nd">select * from cassandra_pythondemo.demo_readings;</span></pre><p id="cf27" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这将产生以下结果集:</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi nh"><img src="../Images/7fbfd446978fcb55444a56f5e8cffdab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uDxSV-cJCZPfoqHg"/></div></div></figure><p id="aa31" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">Python中的插入脚本非常有效，我们已经成功地在Astra Cassandra数据库中插入了数据。</p><h1 id="57c5" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">结论</h1><p id="0c88" class="pw-post-body-paragraph ko kp iq kq b kr mp ka kt ku mq kd kw kx mr kz la lb ms ld le lf mt lh li lj ij bi translated">我们现在已经成功构建了一个连接到Astra的Python脚本，Astra是一个由Apache Cassandra支持的无服务器数据库即服务。我们展示了如何浏览Astra网站以创建新的Cassandra表，如何通过CQL控制台执行查询，如何使用多个Python库(如numpy和datetime)在Python中生成数据，以及如何使用Python cassandra-driver配置与Astra的连接，并使用准备好的语句插入数据。我们还使用astrapy Cassandra Python库与Astra Document API进行交互，以插入和检索JSON数据。</p><p id="0547" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">了解更多信息:</p><ul class=""><li id="f63a" class="ni nj iq kq b kr ks ku kv kx nk lb nl lf nm lj nn no np nq bi translated"><a class="ae lk" href="https://pypi.org/project/astra-python/" rel="noopener ugc nofollow" target="_blank">一张照片</a></li><li id="c712" class="ni nj iq kq b kr nr ku ns kx nt lb nu lf nv lj nn no np nq bi translated">【Astra的Python驱动</li></ul><p id="636c" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这个Cassandra Python教程的代码可以在这里找到:【https://github.com/andyadamides/python-cassandra-intro】T5<br/></p></div></div>    
</body>
</html>