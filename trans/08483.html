<html>
<head>
<title>Time Series From Scratch — Moving Averages (MA) Theory and Implementation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从零开始的时间序列——移动平均线(MA)理论与实现</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-from-scratch-moving-averages-ma-theory-and-implementation-a01b97b60a18?source=collection_archive---------3-----------------------#2021-08-05">https://towardsdatascience.com/time-series-from-scratch-moving-averages-ma-theory-and-implementation-a01b97b60a18?source=collection_archive---------3-----------------------#2021-08-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="0e45" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/time-series-from-scratch" rel="noopener" target="_blank">时间序列从无到有</a></h2><div class=""/><div class=""><h2 id="ec27" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">时间序列从零开始系列的第8部分—了解理论并使用MA模型预测未来</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/b92e10e0dbe7bae1ed829735e1e50dcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_EuaEUZ_NJLDKTOs84bB2g.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@frostroomhead?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Rodion Kutsaev </a>在<a class="ae lh" href="https://unsplash.com/s/photos/dark-abstract?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="ff3a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最终探索最基本的时间序列预测模型——简单移动平均线(MA)的时候到了。</p><p id="2588" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将在实现之前讨论基础理论，包括直觉和一些数学知识。一般来说，您应该熟悉<a class="ae lh" rel="noopener" target="_blank" href="/time-series-analysis-from-scratch-seeing-the-big-picture-2d0f9d837329">时间序列</a>，因此如果您对该主题不熟悉，请从头开始阅读该序列。前几篇文章的链接在这篇文章的末尾。</p><p id="9ac1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这篇文章的结构如下:</p><ul class=""><li id="d19d" class="me mf it lk b ll lm lo lp lr mg lv mh lz mi md mj mk ml mm bi translated">移动平均线——理论和数学</li><li id="fca8" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">移动平均线——在熊猫中的实施</li><li id="e919" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">移动平均线—预测</li><li id="89d8" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">结论</li></ul></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="421c" class="mz na it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">移动平均线——理论和数学</h1><p id="dbc7" class="pw-post-body-paragraph li lj it lk b ll nr kd ln lo ns kg lq lr nt lt lu lv nu lx ly lz nv mb mc md im bi translated">单单移动平均线对预测没那么有用。相反，它们主要用于分析。例如，移动平均线通过平滑不断变化的价格的波动来帮助股票投资者进行技术分析。这种方式减少了短期波动，投资者可以得到一个更一般化的画面。</p><p id="5178" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">从数学角度来说，简单的移动平均线非常容易实现:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/51d6d725d66b67242f25ba2b31bf2b22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*swwgajGfXIEqSNdiRQKigg.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片1-简单移动平均公式(图片由作者提供)</p></figure><p id="a202" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">其中<code class="fe nx ny nz oa b">t</code>表示时间段，<code class="fe nx ny nz oa b">s</code>表示滑动窗口的大小。</p><p id="c9a9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们看一个例子。<code class="fe nx ny nz oa b">x</code>将表示一个没有时间信息的样本时间序列，我们将计算滑动窗口大小2和3的移动平均值。</p><p id="2710" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面是马②的计算:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ob"><img src="../Images/5a215d394d650ea70d21e1bd4a997e28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0kASKdPALmZdUip-en998Q.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片2 — MA(2)计算(图片由作者提供)</p></figure><p id="6439" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如您所见，第一个数据点被复制，因为在它之前没有数据点来计算平均值。Pandas默认不会复制值，而是返回<code class="fe nx ny nz oa b">NaN</code>。您可以在<code class="fe nx ny nz oa b">rolling()</code>函数中指定<code class="fe nx ny nz oa b">min_periods=1</code>来避免这种行为。</p><p id="299b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面是马③的计算:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oc"><img src="../Images/5f028d528672e149d4c6bdb8dfb5aa23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ed1GsiAWCeIz6djA3AzNfw.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片3 — MA(3)计算(图片由作者提供)</p></figure><p id="4bad" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">计算再一次非常简单。第一个值被复制，但第二个值被计算为马立克(2)，因为没有足够的数据进行完整的计算。</p><p id="6f0f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">太好了！您现在知道了移动平均线背后的基本思想，所以让我们看看如何用Python实现它们。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="01d1" class="mz na it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">移动平均线——在熊猫中的实施</h1><p id="ae37" class="pw-post-body-paragraph li lj it lk b ll nr kd ln lo ns kg lq lr nt lt lu lv nu lx ly lz nv mb mc md im bi translated">您将使用<a class="ae lh" href="https://raw.githubusercontent.com/jbrownlee/Datasets/master/airline-passengers.csv" rel="noopener ugc nofollow" target="_blank">航空公司的乘客</a>数据集。以下是如何将其加载到Python中并可视化的方法:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="aeff" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">以下是数据集的外观:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi of"><img src="../Images/4d03d18fa7d58d9946fe62efff7d7fb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cgor5YdoLjmwquP_sIuyJQ.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片4-航空乘客数据集(图片由作者提供)</p></figure><p id="7a33" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">可以用熊猫里的<code class="fe nx ny nz oa b">rolling()</code>函数计算简单移动平均线。您现在应该关心的唯一参数是<code class="fe nx ny nz oa b">window</code>，因为它指定了滑动窗口的大小。如果你不知道前面的部分代表什么，请再读一遍。</p><p id="03fe" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">打电话给<code class="fe nx ny nz oa b">rolling()</code>本身不会有任何作用。您仍然需要一个聚合函数。由于这些是移动的<em class="og">平均值</em>，所以将<code class="fe nx ny nz oa b">.mean()</code>坚持到通话结束就可以了。</p><p id="295c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面的代码片段计算滑动窗口大小为3、6和12的移动平均值，并直观地显示它们:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="f102" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">以下是所有时间序列的样子:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi of"><img src="../Images/39e121a56475584293306d1fac68a97b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZUyPTD1WDeYHWQduXQ3vtg.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图5——熊猫的移动平均线(图片由作者提供)</p></figure><p id="081e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">观察上面的图像，可以发现简单移动平均线的几个问题:</p><ul class=""><li id="b25a" class="me mf it lk b ll lm lo lp lr mg lv mh lz mi md mj mk ml mm bi translated"><strong class="lk jd">滞后</strong> —移动平均时间序列总是滞后于原始时间序列。看看峰值来验证这一说法。</li><li id="40b0" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated"><strong class="lk jd">噪音</strong> —太小的滑动窗口大小无法从原始数据中移除所有噪音。</li><li id="6362" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated"><strong class="lk jd">平均问题</strong> —由于平均，平均数据永远不会捕捉到原始序列的低点和高点。</li><li id="0670" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated"><strong class="lk jd">加权</strong> —所有数据点的权重相同。这可能是一个问题，因为最近的值通常对未来有更大的影响。</li></ul><p id="cc8b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">雪上加霜的是，你不能用熊猫来预测未来。相反，您需要使用Statsmodels来完成这项任务。接下来看看如何。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="ca02" class="mz na it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">移动平均线—预测</h1><p id="3704" class="pw-post-body-paragraph li lj it lk b ll nr kd ln lo ns kg lq lr nt lt lu lv nu lx ly lz nv mb mc md im bi translated">我再重复一遍——你不能用熊猫来做预测！即使是statsmodels实现也很可能不值得，因为您不会对结果满意。尽管如此，它还是来了。</p><p id="f709" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你必须训练一个ARMA模型。它由自回归和移动平均成分构成。完全忽略自回归成分意味着我们正在建立一个移动平均模型。</p><p id="1539" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将<a class="ae lh" rel="noopener" target="_blank" href="/time-series-from-scratch-train-test-splits-and-evaluation-metrics-4fd654de1b37">把数据集</a>分成训练和测试子集。最后两年(24行)用于测试。训练后的结果是可视化的:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="782c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是视觉效果:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi of"><img src="../Images/49eae3563f29f51b81d59e413217b400.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*slqSQD5ifkTnbGNz-WFMJg.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图6 —使用移动平均模型进行预测(图片由作者提供)</p></figure><p id="44fb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">那么，这是怎么回事呢？简单的移动平均线不是最好的预测模型。至少对于既显示趋势性又显示季节性的数据来说不是这样。</p><p id="118e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">那么，让我们试着对序列进行差分，这样做会移除趋势成分，使序列(在某种程度上)保持平稳:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="eb77" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是视觉效果:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oh"><img src="../Images/cc1cf3af9e286900597bd83325083f9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j4G-7GgT35XuTKFjXxll_Q.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图7 —使用移动平均模型对差异数据进行预测(图片由作者提供)</p></figure><p id="8121" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">结果仍然没有用，但它们看起来不像来自不同的数据集。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="0114" class="mz na it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">最后的话</h1><p id="ff46" class="pw-post-body-paragraph li lj it lk b ll nr kd ln lo ns kg lq lr nt lt lu lv nu lx ly lz nv mb mc md im bi translated">这就是你要的——一个简单移动平均线模型的来龙去脉。大多数情况下，您可以将它用作基线，但仅此而已。指数加权移动平均线效果更好，因为它们给最近的观察值增加了更多的权重。</p><p id="1e89" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">尽管如此，在使用高阶指数平滑法(例如霍尔特-温特斯)之前，你不会得到令人满意的预测结果。</p><p id="1889" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将在下一篇文章中讨论EWMA和指数平滑，敬请关注。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><p id="04da" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="og">喜欢这篇文章吗？成为</em> <a class="ae lh" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="og">中等会员</em> </a> <em class="og">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="oi oj gp gr ok ol"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd jd gy z fp oq fr fs or fu fw jc bi translated">通过我的推荐链接加入Medium-Dario rade ci</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">medium.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz lb ol"/></div></div></a></div></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="0698" class="mz na it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">阅读整个系列</h1><ol class=""><li id="d6ee" class="me mf it lk b ll nr lo ns lr pa lv pb lz pc md pd mk ml mm bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/time-series-analysis-from-scratch-seeing-the-big-picture-2d0f9d837329">看清大局</a></li><li id="ba21" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md pd mk ml mm bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/time-series-from-scratch-introduction-to-time-series-with-pandas-347ac9c6b451">熊猫时间序列介绍</a></li><li id="0133" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md pd mk ml mm bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/time-series-from-scratch-white-noise-and-random-walk-5c96270514d3">白噪声和随机游走</a></li><li id="91eb" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md pd mk ml mm bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/time-series-from-scratch-decomposing-time-series-data-7b7ad0c30fe7">分解时间序列数据</a></li><li id="0d59" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md pd mk ml mm bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/time-series-from-scratch-autocorrelation-and-partial-autocorrelation-explained-1dd641e3076f">自相关和偏自相关</a></li><li id="2ea8" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md pd mk ml mm bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/time-series-from-scratch-stationarity-tests-and-automation-14b02fa5ca4d">稳定性测试和自动化</a></li><li id="973e" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md pd mk ml mm bi translated"><a class="ae lh" rel="noopener" target="_blank" href="/time-series-from-scratch-train-test-splits-and-evaluation-metrics-4fd654de1b37">培训/测试分割和评估指标</a></li></ol></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="bd9e" class="mz na it bd nb nc nd ne nf ng nh ni nj ki nk kj nl kl nm km nn ko no kp np nq bi translated">保持联系</h1><ul class=""><li id="ccf1" class="me mf it lk b ll nr lo ns lr pa lv pb lz pc md mj mk ml mm bi translated">关注我的媒体，了解更多类似的故事</li><li id="ea20" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">注册我的<a class="ae lh" href="https://mailchi.mp/46a3d2989d9b/bdssubscribe" rel="noopener ugc nofollow" target="_blank">简讯</a></li><li id="3b8e" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">在<a class="ae lh" href="https://www.linkedin.com/in/darioradecic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上连接</li></ul></div></div>    
</body>
</html>