<html>
<head>
<title>CSV Files for Storage? No Thanks. There’s a Better Option</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于存储的CSV文件？不用了，谢谢。有更好的选择</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/csv-files-for-storage-no-thanks-theres-a-better-option-72c78a414d1d?source=collection_archive---------0-----------------------#2021-08-18">https://towardsdatascience.com/csv-files-for-storage-no-thanks-theres-a-better-option-72c78a414d1d?source=collection_archive---------0-----------------------#2021-08-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="01e9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将数据保存到CSV文件中既浪费金钱又浪费磁盘空间。是时候结束了。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/774071d7fa8fe8c581651c1f0f622eec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MSYcG4nTRUpxz3Lb6wrnEQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">大卫·艾姆里奇在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="0f0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个人和他们的祖母都知道CSV文件是什么。拼花地板，没那么多。<em class="lv">它是一种地板吗？</em>是的，但不是——这是一种高效的数据存储格式，今天你将会了解到这一切。</p><p id="2ed8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CSV无处不在——从公司报告到机器学习数据集。这是一种简单直观的数据格式，只需打开一个文件，就可以直接访问数据。它并不像听起来那么好，原因你会读到一点。</p><p id="a67a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CSV有许多替代方案，如Excel、SQLite数据库和HDFs，但有一个方案尤其具有竞争力。那是镶木地板。</p><p id="a0a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天的文章回答了以下问题:</p><ul class=""><li id="d56b" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">CSV有什么问题？</li><li id="c2c4" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">什么是拼花地板数据格式？</li><li id="720e" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">CSV还是拼花？你应该用哪一个？</li></ul></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="dfcb" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">CSV有什么问题？</h1><p id="a518" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">我喜欢CSV，你可能也是。几乎任何软件都可以生成CSV文件，甚至是纯文本编辑器。如果你对数据科学和机器学习感兴趣，就去Kaggle.com吧——几乎所有的表格数据集都是这种格式。</p><p id="b0eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CSV是面向行的，这意味着它们的查询速度很慢，并且难以高效存储。拼花地板则不是这样，它是一种柱状储物选择。对于相同的数据集，这两者之间的大小差异是巨大的，您很快就会看到这一点。</p><p id="8bfa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">雪上加霜的是，任何人都可以打开和修改CSV文件。这就是为什么你不应该使用这种格式作为数据库。有更安全的选择。</p><p id="f286" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是让我们来看看对公司来说真正重要的是什么——时间和金钱。你可能会将数据存储在云中，作为web应用程序或机器学习模型的基础。云服务提供商将根据扫描的数据量或存储的数据量向您收费。这对CSV来说都不太好。</p><p id="70c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们先来看看亚马逊S3的存储定价。这些数字取自这里的<a class="ae ky" href="https://blog.openbridge.com/how-to-be-a-hero-with-powerful-parquet-google-and-amazon-f2ae0f35ee04" rel="noopener ugc nofollow" target="_blank"/>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/392ef6521772e7b5724ffa763b87f31b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vdasMxTjInhBXIRA8K1XYQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1 —不同数据格式的亚马逊S3存储定价(图片由作者提供)</p></figure><p id="0b30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">呀。拼花文件比CSV占用更少的磁盘空间(亚马逊S3 上的列<em class="lv">大小)，并且扫描速度更快(列<em class="lv">数据扫描</em>)。因此，相同的数据集以拼花格式存储要便宜16倍！</em></p><p id="8eb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们看看Apache Parquet的速度提升:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/748031c9badf3b2e2fe22c7034478472.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LrcAf739ofWqGOnrm_f_uA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2 —不同数据格式的亚马逊S3存储和查询价格比较(图片由作者提供)</p></figure><p id="1b69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">又一次——呀！如果您的原始CSV文件大小为1TB，那么Parquet会便宜99.7%。</p><p id="e7e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，不，当您的数据很大时，CSV绝对不是一个好的选择——无论是时间还是成本。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="dbf0" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">但是到底什么是拼花数据格式呢？</h1><p id="bd24" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">这是存储数据的另一种格式。它是开源的，并在Apache的许可下使用。</p><p id="cfda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CSV和Parquet格式都是用来存储数据的，但是它们内部不会有更多的不同。CSV就是您所说的<em class="lv">行存储</em>，而Parquet文件则是按列组织数据。</p><p id="06b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是它的意思。假设您有以下数据:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/f2fd26745c5f16744bfa781c46cd7381.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1FgkoAUXKPf7etG3_5mp3w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3 —虚拟表数据(作者提供的图片)</p></figure><p id="e73f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是前一个表在行和列存储中的组织方式:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/520600abd2b3e0f6cbafc5bb66c7d630.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gZMYerPN9M8nlki3aloCaA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4 —行存储与列存储(作者提供的图片)</p></figure><p id="cb76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简而言之，列存储文件更加轻量级，因为可以对每一列进行充分的压缩。行存储则不是这样，因为一行通常包含多种数据类型。</p><p id="3748" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">阿帕奇拼花地板是为效率而设计的。原因就在于列存储架构，因为它允许您快速跳过不相关的数据。这样查询和聚合都更快，从而节省了硬件(理解为:更便宜)。</p><p id="fd2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简而言之，对于较大的文件，Parquet是一种更有效的数据格式。使用拼花地板比使用CSV更节省时间和金钱。</p><p id="a3c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你是一个Python爱好者，在Pandas中处理CSV文件应该听起来很熟悉。接下来让我们看看库是如何处理Parquet文件的。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="8c3d" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">实践CSV和拼花地板比较</h1><p id="3158" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">您将使用<a class="ae ky" href="https://www.kaggle.com/dgawlik/nyse?select=prices.csv" rel="noopener ugc nofollow" target="_blank">纽约证券交易所股票价格数据集</a>进行这一动手操作部分。CSV文件的大小约为50MB没什么大的——但是您会看到Parquet将节省多少磁盘空间。</p><p id="fadd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，加载包含Python熊猫的CSV文件:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="c55b" class="nx ms it nt b gy ny nz l oa ob">import pandas as pd</span><span id="9460" class="nx ms it nt b gy oc nz l oa ob">df = pd.read_csv('data/prices.csv')<br/>df.head()</span></pre><p id="c3e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它看起来是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/655c42d4bf3db80475cc623ecaf3a774.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nbAkr0jEOJywHkZxqQF8aw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片5 —纽约证券交易所股票价格数据集的头部— CSV(图片由作者提供)</p></figure><p id="5ed9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您必须使用<code class="fe oe of og nt b">to_parquet()</code>函数来保存数据集。它的工作原理在很大程度上与<code class="fe oe of og nt b">to_csv()</code>相同，所以使用它不会有什么不同:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="46b3" class="nx ms it nt b gy ny nz l oa ob">df.to_parquet('data/prices.parquet')</span></pre><p id="7f35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据集现已保存。在比较文件大小之前，让我们看看如何加载它。熊猫有<code class="fe oe of og nt b">read_parquet()</code>功能，用于读取拼花数据文件；</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="738a" class="nx ms it nt b gy ny nz l oa ob">df_parquet = pd.read_parquet('data/prices.parquet')<br/>df_parquet.head()</span></pre><p id="f0df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是数据集的外观:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/655c42d4bf3db80475cc623ecaf3a774.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nbAkr0jEOJywHkZxqQF8aw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片6 —纽约证券交易所股票价格数据集的头部—拼花地板(图片由作者提供)</p></figure><p id="2062" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">两个数据集完全相同。命令<code class="fe oe of og nt b">df.equals(df_parquet)</code>会将<code class="fe oe of og nt b">True</code>打印到控制台，所以可以随意使用它进行验证。</p><p id="364b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，文件大小有没有减少呢？嗯，是的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/852ea6244080a1ac4197a54771e7462a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gV6BhP8KeRntrloPD5zISw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图7 —纽约证券交易所股票价格数据集上CSV与拼花文件大小的对比(图片由作者提供)</p></figure><p id="2fa2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这大约减少了四分之一的磁盘空间使用。</p><p id="1077" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">这对50MB的数据集重要吗？</em>可能不会，但在更大的数据集上，节省也会增加。如果您在云上存储数据并为整体大小付费，这一点尤其重要。</p><p id="1212" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是值得思考的问题。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="c10a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">喜欢这篇文章吗？成为</em> <a class="ae ky" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="lv">中等会员</em> </a> <em class="lv">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="oi oj gp gr ok ol"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd iu gy z fp oq fr fs or fu fw is bi translated">通过我的推荐链接加入Medium-Dario rade ci</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">medium.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz ks ol"/></div></div></a></div></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="4eb8" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">保持联系</h1><ul class=""><li id="b334" class="lw lx it lb b lc nj lf nk li pa lm pb lq pc lu mb mc md me bi translated">在<a class="ae ky" href="https://medium.com/@radecicdario" rel="noopener">媒体</a>上关注我，了解更多类似的故事</li><li id="9df6" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">注册我的<a class="ae ky" href="https://mailchi.mp/46a3d2989d9b/bdssubscribe" rel="noopener ugc nofollow" target="_blank">简讯</a></li><li id="56a8" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">在<a class="ae ky" href="https://www.linkedin.com/in/darioradecic/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上连接</li></ul></div></div>    
</body>
</html>