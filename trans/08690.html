<html>
<head>
<title>Stop Using Pandas get_dummies() for Feature Encoding</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">停止使用Pandas get_dummies()进行特征编码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/stop-using-pandas-get-dummies-for-feature-encoding-5d2cd07cb4fc?source=collection_archive---------5-----------------------#2021-08-11">https://towardsdatascience.com/stop-using-pandas-get-dummies-for-feature-encoding-5d2cd07cb4fc?source=collection_archive---------5-----------------------#2021-08-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8ce2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">熊猫get_dummies()和Sklearn One-hot编码器基本指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7d5204dd7bc4102d357167cb90707199.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V8d6CvdyU6-Ju3WbTwDTNw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://pixabay.com/users/mediamodifier-1567646/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=2108024" rel="noopener ugc nofollow" target="_blank"> Mediamodifier </a>来自<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=2108024" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure><p id="1c41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">机器学习算法需要特定格式的数字向量的输入数据源。特征工程是数据科学模型开发生命周期的重要组成部分，指的是将原始数据转换为适合训练稳健模型的数字格式。</p><p id="1e05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个数据科学家大约80%的时间花在数据准备和特性工程上。模型的性能取决于特征工程策略。原始数据集包含各种数据类型的要素，包括数字、分类、日期时间等。有各种各样的特征工程技术将不同数据类型的数据特征转换成数字向量。</p><p id="51b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虚拟编码是指将分类特征转换成数字向量格式的编码策略。有各种其他技术来编码分类特征，包括计数编码器、单热编码器、Tf-Idf编码器等。</p><p id="2645" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b"><strong class="lb iu">pd.get_dummies()</strong></code>是Pandas的一个函数，它在一行代码中执行虚拟编码。数据科学家大多将此用于特征编码，但不建议在生产或Kaggle比赛中使用。在本文中，我们将讨论其背后的原因以及对于<code class="fe lv lw lx ly b">get_dummies()</code>函数的最佳选择。</p><p id="26cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">熊猫库中的<code class="fe lv lw lx ly b"><strong class="lb iu">get_dummies()</strong></code>函数可用于将分类变量转换成虚拟/指示变量。在某种程度上，它是一种静态的行为编码技术。</p><blockquote class="lz ma mb"><p id="b189" class="kz la mc lb b lc ld ju le lf lg jx lh md lj lk ll me ln lo lp mf lr ls lt lu im bi translated">我们将采用一个随机数据集，其中包含2个数值特征和1个分类特征(“颜色”)，用于进一步演示。“颜色”分类变量有3个独特的类别:绿色、红色、蓝色。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mg"><img src="../Images/78746672f3f0ce00ca05bfa478349e5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1J3iP8HyHZ8NW-0NydnlVA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)，训练数据的get_dummies()使用结果</p></figure><p id="5f73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以观察到<code class="fe lv lw lx ly b">pd.get_dummies()</code>的编码结果。不建议在生产或Kaggle上使用此函数，因为它的行为本质上是静态的。它不能从训练数据中学习特征，因此不能将其发现传播到测试数据集中。</p><p id="c881" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分类特征颜色有3个特征值:绿色、红色、蓝色。这使得将颜色特征编码成3个特征类别。但是测试数据可能有也可能没有所有的特征值，这可能会在建模时导致数据不匹配的问题。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/e222ff457881ed8e079f4b3214a2c231.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ltcDz1ddsVudKKuOqueGCw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)，测试数据的get_dummies()使用结果</p></figure><p id="c462" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">颜色特征中缺少蓝色特征值，这导致编码数据中缺少蓝色特征列。这是因为<code class="fe lv lw lx ly b">pd.get_dummies</code>没有学习训练数据的特征，在预测时会进一步造成特征不匹配。</p><h2 id="c1b2" class="mi mj it bd mk ml mm dn mn mo mp dp mq li mr ms mt lm mu mv mw lq mx my mz na bi translated">实施:</h2><pre class="kj kk kl km gt nb ly nc nd aw ne bi"><span id="2e89" class="mi mj it ly b gy nf ng l nh ni">#to print the encoded features for train data<strong class="ly iu"><br/>pd.get_dummies(X_train)</strong></span><span id="2405" class="mi mj it ly b gy nj ng l nh ni">#to print the encoded features for test data<strong class="ly iu"><br/>pd.get_dummies(X_test)</strong></span></pre><p id="f226" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">pd.get_dummies()</code>的唯一优势是它的易解释性，以及它返回一个列名清晰的pandas数据框的事实。</p><h1 id="3e57" class="nk mj it bd mk nl nm nn mn no np nq mq jz nr ka mt kc ns kd mw kf nt kg mz nu bi translated">一个热编码器:</h1><p id="72e8" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">一键编码器是一种流行的特征编码策略，其性能类似于<code class="fe lv lw lx ly b">pd.get_dummies()</code>,但具有额外的优势。它通过为每个类别的每个分类特征分配一个二进制列来编码一个名义或分类特征。Scikit-learn附带了一键编码器的实现。</p><div class="kj kk kl km gt ab cb"><figure class="oa kn ob oc od oe of paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/2f74682f268f3fe49c81d2ab14dc58e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*yyZkpZ8huqeexZpcdhfy0A.png"/></div></figure><figure class="oa kn og oc od oe of paragraph-image"><img src="../Images/d4e148178bb65f99eb1fd4a153ee6d09.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*dtPSlN6fJwc6xEsN7F-yDQ.png"/><p class="ku kv gj gh gi kw kx bd b be z dk oh di oi oj translated">(图片由作者提供)，一个热编码器结果，<strong class="bd ok">左:</strong>训练，<strong class="bd ok">右:</strong>测试</p></figure></div><p id="20f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从一个用于训练和测试数据的hot编码器的上述结果中，可以观察到，在对训练数据的分类变量进行编码时，编码的特征被保存，并且在对测试数据进行编码时，其发现或特征值被传播。</p><p id="f137" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然蓝色特征值没有出现在测试数据中，但是一个hot编码器为蓝色类别创建了一个特征列，因为它出现在训练管道中。</p><h2 id="f432" class="mi mj it bd mk ml mm dn mn mo mp dp mq li mr ms mt lm mu mv mw lq mx my mz na bi translated">实施:</h2><pre class="kj kk kl km gt nb ly nc nd aw ne bi"><span id="091c" class="mi mj it ly b gy nf ng l nh ni"><strong class="ly iu">from sklearn.preprocessing import OneHotEncoder</strong></span><span id="aeaf" class="mi mj it ly b gy nj ng l nh ni"># one hot encoding<strong class="ly iu"><br/>enc = OneHotEncoder(sparse=False)<br/>color_onehot = enc.fit_transform(X_train[['color']])</strong></span><span id="c938" class="mi mj it ly b gy nj ng l nh ni">#to print the encoded features for train data<strong class="ly iu"><br/>pd.DataFrame(color_onehot, columns=list(enc.categories_[0]))</strong></span><span id="af0f" class="mi mj it ly b gy nj ng l nh ni"><strong class="ly iu"># tranform encoding for test data</strong><br/>test_onehot = enc.transform(X_test[['color']])</span><span id="51d7" class="mi mj it ly b gy nj ng l nh ni"><strong class="ly iu">#to print the encoded features for train data<br/></strong>pd.DataFrame(test_onehot, columns=list(enc.categories_[0]))</span></pre></div><div class="ab cl ol om hx on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="im in io ip iq"><h1 id="0072" class="nk mj it bd mk nl os nn mn no ot nq mq jz ou ka mt kc ov kd mw kf ow kg mz nu bi translated">结论:</h1><p id="16b3" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated"><code class="fe lv lw lx ly b"><strong class="lb iu">pd.get_dummies()</strong></code>在要素编码后返回具有干净列名的pandas数据框，但仍不建议将其用于生产或Kaggle竞赛。应该首选一键编码或计数矢量器策略，因为它具有每个分类特征的特征值特征。</p><p id="b22f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">新的特征类别也可以使用一个热编码器的<code class="fe lv lw lx ly b"><strong class="lb iu"><em class="mc">handle_unknown=’ignore’</em></strong></code> <strong class="lb iu"> <em class="mc"> </em> </strong>参数进行处理，这可能进一步导致<code class="fe lv lw lx ly b"><strong class="lb iu">pd.get_dummies()</strong></code>中的数据不匹配问题</p><h1 id="80c5" class="nk mj it bd mk nl nm nn mn no np nq mq jz nr ka mt kc ns kd mw kf nt kg mz nu bi translated">参考资料:</h1><p id="13d4" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">[1] Scikit-learn文档:<a class="ae ky" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OneHotEncoder.html" rel="noopener ugc nofollow" target="_blank">https://sci kit-learn . org/stable/modules/generated/sk learn . preprocessing . onehotencoder . html</a></p><blockquote class="ox"><p id="853f" class="oy oz it bd pa pb pc pd pe pf pg lu dk translated">感谢您的阅读</p></blockquote></div></div>    
</body>
</html>