<html>
<head>
<title>How to Connect a Local or Remote Machine to a Databricks Cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将本地或远程机器连接到Databricks集群</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-connect-a-local-or-remote-machine-to-a-databricks-cluster-18e03afb53c6?source=collection_archive---------11-----------------------#2021-04-11">https://towardsdatascience.com/how-to-connect-a-local-or-remote-machine-to-a-databricks-cluster-18e03afb53c6?source=collection_archive---------11-----------------------#2021-04-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="d95d" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://pedram-ataee.medium.com/list/notes-from-industry-265207a5d024" rel="noopener">业内笔记</a></h2><div class=""/><div class=""><h2 id="52c6" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">Databricks、Python和Docker的交集</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/17f2d98e588e4ec89377a2dda8d178c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IVurQxk9mrzza6tA"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://unsplash.com/@claybanks?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">粘土银行</a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="1f88" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当您开始使用Databricks时，您将会决定在Databricks之外进行编码，并远程连接到它的计算能力，也就是Databricks集群。为什么？主要是因为Databricks的主要特性之一是它的Spark作业管理,这可以让您的生活变得轻松。使用该服务，您可以向大规模数据集提交一系列Spark作业，并在几秒钟内返回您的结果；多亏了它的火花引擎。在本文中，我想描述如何配置您的本地或远程机器连接到Databricks集群，作为这个过程的第一步。</p><div class="me mf gp gr mg mh"><a href="https://www.amazon.com/gp/product/B08D2M2KV1/ref=dbs_a_def_rwt_hsch_vapi_tkin_p1_i0" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd jd gy z fp mm fr fs mn fu fw jc bi translated">人工智能:非正统的教训:如何获得洞察力和建立创新的解决方案</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">亚马逊网站:人工智能:非正统课程:如何获得洞察力和建立创新的解决方案电子书…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">www.amazon.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv lb mh"/></div></div></a></div></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="a80f" class="nd ne it bd nf ng nh ni nj nk nl nm nn ki no kj np kl nq km nr ko ns kp nt nu bi translated">—什么是数据块？</h1><p id="dbf8" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">Databricks是一个抽象层，位于AWS和Azure等冷云基础设施上，使您可以轻松管理计算能力、数据存储、作业调度和模型管理。它为您提供了一个开发环境，以获得您的数据科学或人工智能项目的初步结果。Databricks由Spark提供支持，Spark是一个开源数据处理引擎，专门为大规模数据设计。</p><p id="9584" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Databricks提供的简单性有一些限制。例如，Databricks使您作为数据科学新手能够快速生成结果，因为您不需要大量处理云配置或可视化工具。然而，如果您想要控制开发的每个方面，Databricks肯定会限制您。</p><h1 id="2d01" class="nd ne it bd nf ng oa ni nj nk ob nm nn ki oc kj np kl od km nr ko oe kp nt nu bi translated">—要求是什么？</h1><h2 id="71be" class="of ne it bd nf og oh dn nj oi oj dp nn lr ok ol np lv om on nr lz oo op nt iz bi translated">1-使用受支持的数据块运行时创建数据块集群</h2><p id="e8f2" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">每个Databricks集群都必须运行一个称为Databricks运行时的专用操作系统。在配置集群时，您会发现许多版本的Databricks运行时。如果您想要远程连接到Databricks集群，<strong class="lk jd">您必须谨慎选择Databricks运行时版本</strong>。为什么？因为<code class="fe oq or os ot b">databricks-connect</code>客户端支持有限数量的数据块运行时版本，所以Spark客户端库支持这种远程连接。</p><blockquote class="ou ov ow"><p id="08db" class="li lj ox lk b ll lm kd ln lo lp kg lq oy ls lt lu oz lw lx ly pa ma mb mc md im bi translated">数据块运行时版本必须与数据块连接库兼容。</p></blockquote><p id="24ab" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">换句话说，您不能远程连接到其数据块运行时不受<code class="fe oq or os ot b">databricks-connect</code>支持的集群。您可以在Databricks Connect的原始文档中找到Databricks运行时版本的更新列表。</p><div class="me mf gp gr mg mh"><a href="https://docs.databricks.com/dev-tools/databricks-connect.html#requirements" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd jd gy z fp mm fr fs mn fu fw jc bi translated">数据块连接</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">Databricks Connect允许您连接您喜爱的IDE (IntelliJ、Eclipse、PyCharm、RStudio、Visual Studio)…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">docs.databricks.com</p></div></div><div class="mq l"><div class="pb l ms mt mu mq mv lb mh"/></div></div></a></div><h2 id="4e0b" class="of ne it bd nf og oh dn nj oi oj dp nn lr ok ol np lv om on nr lz oo op nt iz bi translated">2-安装所需的Python和Java版本</h2><p id="43ab" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">选择与<code class="fe oq or os ot b">databricks-connect</code>兼容的Databricks运行时版本后，您必须确保在您的机器上使用兼容的Python版本。如原始文档中所述:<strong class="lk jd">“客户机Python安装的次要版本必须与Databricks集群的次要Python版本相同。”</strong></p><blockquote class="ou ov ow"><p id="f1d4" class="li lj ox lk b ll lm kd ln lo lp kg lq oy ls lt lu oz lw lx ly pa ma mb mc md im bi translated">开发环境的Python版本必须与在Databricks集群上工作的Databricks运行时版本兼容。</p></blockquote><p id="9383" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">假设您为Databricks运行时版本选择了<strong class="lk jd"> 7.3 LTS </strong>。在这种情况下，您必须在本地或远程机器上安装<strong class="lk jd"> Python 3.7 </strong>才能与之兼容。您还必须在您的机器上安装Java运行时环境(JRE) 8。这些都是由Databricks网站指导的。</p><div class="me mf gp gr mg mh"><a href="https://www.oracle.com/java/technologies/java8.html" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd jd gy z fp mm fr fs mn fu fw jc bi translated">Java 8</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">未找到结果您的搜索没有匹配任何结果。我们建议您尝试以下方法来帮助找到您想要的…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">www.oracle.com</p></div></div></div></a></div><h2 id="1e7f" class="of ne it bd nf og oh dn nj oi oj dp nn lr ok ol np lv om on nr lz oo op nt iz bi translated">3-安装所需的Databricks Connect版本</h2><p id="eed2" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">正如Python开发所建议的，最好创建一个隔离的虚拟环境，以确保没有冲突。你可以用你选择的库，如<code class="fe oq or os ot b">venv</code>、<code class="fe oq or os ot b">pipenv</code>或<code class="fe oq or os ot b">conda</code>，轻松构建一个虚拟环境。我在这里选了最新的。</p><p id="0d37" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果不想创建新的虚拟环境，确保不要在现有环境上安装(或卸载)<code class="fe oq or os ot b">pyspark</code>。您应该卸载现有版本的<code class="fe oq or os ot b">pyspark</code>，因为它与<code class="fe oq or os ot b">databricks-connect</code>客户端冲突。<code class="fe oq or os ot b">databricks-connect</code>有自己的方法，相当于<code class="fe oq or os ot b">pyspark</code>的方法，这使得它可以独立运行。通过下面的代码，您用Python 3.7和一个版本的<code class="fe oq or os ot b">databricks-connect</code>创建了一个虚拟环境。</p><pre class="ks kt ku kv gt pc ot pd pe aw pf bi"><span id="bfa2" class="of ne it ot b gy pg ph l pi pj">conda create --name ENVNAME python=3.7<br/>conda activate ENVNAME<br/>pip3 uninstall pyspark<br/>pip3 install -U databricks-connect==7.3.*</span></pre><p id="c9a8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你可能不需要上面的<code class="fe oq or os ot b">pip3 uninstall pyspark</code>，因为虚拟环境是干净的。我把它放在那里只是为了完整。</p><h1 id="8c2b" class="nd ne it bd nf ng oa ni nj nk ob nm nn ki oc kj np kl od km nr ko oe kp nt nu bi translated">—如何根据需求创建Docker映像</h1><p id="3ab2" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">如果您想用Python 3.7和Java 8以及一个版本的<code class="fe oq or os ot b">databricks-connect</code>构建docker映像，您可以使用下面的docker文件。</p><pre class="ks kt ku kv gt pc ot pd pe aw pf bi"><span id="9c98" class="of ne it ot b gy pg ph l pi pj">FROM ubuntu:20.04</span><span id="24df" class="of ne it ot b gy pk ph l pi pj">RUN apt-get update &amp;&amp; apt-get -y install sudo<br/>RUN sudo apt-get -y install software-properties-common</span><span id="9526" class="of ne it ot b gy pk ph l pi pj">### INSTALL PYTHON<br/>RUN sudo apt-get -y install libssl-dev openssl<br/>RUN sudo apt-get -y install libreadline-gplv2-dev libffi-dev<br/>RUN sudo apt-get -y install libncursesw5-dev libsqlite3-dev<br/>RUN sudo apt-get -y install tk-dev libgdbm-dev libc6-dev libbz2-dev <br/>RUN sudo apt-get -y install  wget<br/>RUN apt-get update &amp;&amp; apt-get install make<br/>RUN sudo apt-get -y install zlib1g-dev<br/>RUN apt-get -y install gcc mono-mcs &amp;&amp; \<br/>    rm -rf /var/lib/apt/lists/*<br/>RUN wget <a class="ae lh" href="https://www.python.org/ftp/python/3.7.10/Python-3.7.10.tgz" rel="noopener ugc nofollow" target="_blank">https://www.python.org/ftp/python/3.7.10/Python-3.7.10.tgz</a><br/>RUN tar xzvf Python-3.7.10.tgz<br/>RUN ./Python-3.7.10/configure<br/>RUN sudo make install<br/>RUN alias python=python3</span><span id="8587" class="of ne it ot b gy pk ph l pi pj">### INSTALL JAVA<br/>RUN sudo add-apt-repository ppa:openjdk-r/ppa<br/>RUN sudo apt-get install -y openjdk-8-jre</span><span id="66bc" class="of ne it ot b gy pk ph l pi pj">### INSTALL DATABRICKS-CONNECT<br/>RUN pip3 install --upgrade pip<br/>RUN pip3 uninstall pyspark<br/>RUN pip3 install -U databricks-connect==7.3.*</span></pre><h1 id="5eca" class="nd ne it bd nf ng oa ni nj nk ob nm nn ki oc kj np kl od km nr ko oe kp nt nu bi translated">—如何配置连接属性？</h1><p id="19d7" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">使用<code class="fe oq or os ot b">databricks-connect configure</code>，很容易配置<code class="fe oq or os ot b">databricks-connect</code>库以连接到Databricks集群。运行此命令后，它会以交互方式询问您有关主机、令牌、组织ID、端口和集群Id的问题。要了解更多信息，您可以查看下面的官方文档。</p><div class="me mf gp gr mg mh"><a href="https://docs.databricks.com/dev-tools/databricks-connect.html#step-2-configure-connection-properties" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd jd gy z fp mm fr fs mn fu fw jc bi translated">数据块连接</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">Databricks Connect允许您连接您喜爱的IDE (IntelliJ、Eclipse、PyCharm、RStudio、Visual Studio)…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">docs.databricks.com</p></div></div><div class="mq l"><div class="pl l ms mt mu mq mv lb mh"/></div></div></a></div><p id="3d06" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，<strong class="lk jd">如果您想自动配置Docker映像</strong>中的连接属性，您可以将以下代码添加到上述Docker文件的末尾。</p><pre class="ks kt ku kv gt pc ot pd pe aw pf bi"><span id="bc88" class="of ne it ot b gy pg ph l pi pj">RUN export DATABRICKS_HOST=XXXXX &amp;&amp; \<br/>    export DATABRICKS_API_TOKEN=XXXXX &amp;&amp; \<br/>    export DATABRICKS_ORG_ID=XXXXX &amp;&amp; \<br/>    export DATABRICKS_PORT=XXXXX &amp;&amp; \<br/>    export DATABRICKS_CLUSTER_ID=XXXXX &amp;&amp; \<br/>    echo "{\"host\": \"${<em class="ox">DATABRICKS_HOST</em>}\",\"token\": \"${<em class="ox">DATABRICKS_API_TOKEN</em>}\",\"cluster_id\":\"${<em class="ox">DATABRICKS_CLUSTER_ID</em>}\",\"org_id\": \"${<em class="ox">DATABRICKS_ORG_ID</em>}\", \"port\": \"${<em class="ox">DATABRICKS_PORT</em>}\" }" &gt;&gt; /root/.databricks-connect</span><span id="9bce" class="of ne it ot b gy pk ph l pi pj">ENV <em class="ox">SPARK_HOME</em>=/usr/local/lib/python3.7/site-packages/pyspark</span></pre><p id="56c3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">上面的代码人工创建了配置文件，并将其保存在适当的地址。此外，它将<code class="fe oq or os ot b">SPARK_HOME</code>地址设置为正确的值。当您运行<code class="fe oq or os ot b">databricks-connect configure</code>时，这些步骤在没有您参与的情况下被执行。当您想要自动配置连接属性时，您应该这样做。</p><p id="587a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，但同样重要的是，您可以通过运行<code class="fe oq or os ot b">databricks-connect test</code>来检查连接的健康状况。</p><h1 id="8a5f" class="nd ne it bd nf ng oa ni nj nk ob nm nn ki oc kj np kl od km nr ko oe kp nt nu bi translated">感谢阅读！</h1><p id="5340" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">如果你喜欢这个帖子，想支持我…</p><ul class=""><li id="72b2" class="pm pn it lk b ll lm lo lp lr po lv pp lz pq md pr ps pt pu bi translated"><em class="ox">跟我上</em> <a class="ae lh" href="https://medium.com/@pedram-ataee" rel="noopener"> <em class="ox">中</em> </a> <em class="ox">！</em></li><li id="2ca5" class="pm pn it lk b ll pv lo pw lr px lv py lz pz md pr ps pt pu bi translated"><em class="ox">在</em> <a class="ae lh" href="https://www.amazon.com/Pedram-Ataee/e/B08D6J3WNW" rel="noopener ugc nofollow" target="_blank"> <em class="ox">亚马逊</em> </a> <em class="ox">上查看我的书！</em></li><li id="6029" class="pm pn it lk b ll pv lo pw lr px lv py lz pz md pr ps pt pu bi translated"><em class="ox">成为</em> <a class="ae lh" href="https://pedram-ataee.medium.com/membership" rel="noopener"> <em class="ox">中的一员</em> </a> <em class="ox">！</em></li><li id="9a4e" class="pm pn it lk b ll pv lo pw lr px lv py lz pz md pr ps pt pu bi translated"><em class="ox">连接上</em><a class="ae lh" href="https://www.linkedin.com/in/pedrama/" rel="noopener ugc nofollow" target="_blank"><em class="ox">Linkedin</em></a><em class="ox">！</em></li><li id="6b66" class="pm pn it lk b ll pv lo pw lr px lv py lz pz md pr ps pt pu bi translated"><em class="ox">关注我</em> <a class="ae lh" href="https://twitter.com/pedram_ataee" rel="noopener ugc nofollow" target="_blank"> <em class="ox">推特</em> </a> <em class="ox">！</em></li></ul><div class="me mf gp gr mg mh"><a href="https://pedram-ataee.medium.com/membership" rel="noopener follow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd jd gy z fp mm fr fs mn fu fw jc bi translated">通过我的推荐链接加入Medium—Pedram Ataee博士</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">pedram-ataee.medium.com</p></div></div><div class="mq l"><div class="qa l ms mt mu mq mv lb mh"/></div></div></a></div></div></div>    
</body>
</html>