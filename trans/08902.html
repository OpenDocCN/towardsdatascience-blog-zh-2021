<html>
<head>
<title>List Comprehensions vs. For Loops: It Is Not What You Think</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">列表理解vs. For循环:这不是你想的那样</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/list-comprehensions-vs-for-loops-it-is-not-what-you-think-34071d4d8207?source=collection_archive---------1-----------------------#2021-08-17">https://towardsdatascience.com/list-comprehensions-vs-for-loops-it-is-not-what-you-think-34071d4d8207?source=collection_archive---------1-----------------------#2021-08-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7627" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">许多关于堆栈溢出的文章、帖子或问题都强调列表理解比Python中的循环更快。它比这更复杂。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5bda92b81963d8ef47fbf31682bad611.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oin1i_TFhdQP1Ji5b79LhA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.piqsels.com/en/public-domain-photo-oegux" rel="noopener ugc nofollow" target="_blank">信用</a></p></figure><h1 id="7428" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">列表理解与For循环</h1><p id="6a7f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">通常的文章将执行以下情况:使用for循环创建列表，而不是列表理解。所以我们开始吧，计时。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="36da" class="ms la it mo b gy mt mu l mv mw">import time<br/>iterations = 100000000</span><span id="8e0a" class="ms la it mo b gy mx mu l mv mw">start = time.time()<br/>mylist = []<br/>for i in range(iterations):<br/>    mylist.append(i+1)<br/>end = time.time()<br/>print(end - start)<br/><strong class="mo iu">&gt;&gt; 9.90 seconds</strong></span><span id="7f5b" class="ms la it mo b gy mx mu l mv mw">start = time.time()<br/>mylist = [i+1 for i in range(iterations)]<br/>end = time.time()<br/>print(end - start)<br/><strong class="mo iu">&gt;&gt; 8.20 seconds</strong></span></pre><p id="cf0f" class="pw-post-body-paragraph lr ls it lt b lu my ju lw lx mz jx lz ma na mc md me nb mg mh mi nc mk ml mm im bi translated">我们可以看到，for循环比list理解慢(9.9秒对8.2秒)。</p><blockquote class="nd"><p id="d50b" class="ne nf it bd ng nh ni nj nk nl nm mm dk translated">列表理解比循环创建列表更快。</p></blockquote><p id="1685" class="pw-post-body-paragraph lr ls it lt b lu nn ju lw lx no jx lz ma np mc md me nq mg mh mi nr mk ml mm im bi translated">但是，这是因为我们在每次迭代中通过<strong class="lt iu">添加</strong>新元素来创建一个列表。这太慢了。</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><p id="52a7" class="pw-post-body-paragraph lr ls it lt b lu my ju lw lx mz jx lz ma na mc md me nb mg mh mi nc mk ml mm im bi translated">旁注:如果它是一个Numpy数组而不是一个列表，那就更糟了。for循环需要几分钟才能运行。但是你不应该为此责怪for循环:我们只是没有使用正确的工具。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="af41" class="ms la it mo b gy mt mu l mv mw">myarray = np.array([])<br/>for i in range(iterations):<br/>    myarray = np.append(myarray, i+1)</span></pre><blockquote class="nd"><p id="636f" class="ne nf it bd ng nh nz oa ob oc od mm dk translated">不要通过在循环中追加值来创建numpy数组。</p></blockquote><h1 id="f2b7" class="kz la it bd lb lc ld le lf lg lh li lj jz oe ka ll kc of kd ln kf og kg lp lq bi translated">For循环比列表理解更快</h1><p id="bbdc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">假设我们只想执行一些计算(或者多次调用一个独立的函数)，而不想创建一个列表。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="4ee0" class="ms la it mo b gy mt mu l mv mw">start = time.time()<br/>for i in range(iterations):<br/>    i+1<br/>end = time.time()<br/>print(end - start)<br/><strong class="mo iu">&gt;&gt; 6.16 seconds</strong></span><span id="7d50" class="ms la it mo b gy mx mu l mv mw">start = time.time()<br/>[i+1 for i in range(iterations)]<br/>end = time.time()<br/>print(end - start)<br/><strong class="mo iu">&gt;&gt; 7.80 seconds</strong></span></pre><p id="e9c3" class="pw-post-body-paragraph lr ls it lt b lu my ju lw lx mz jx lz ma na mc md me nb mg mh mi nc mk ml mm im bi translated">在这种情况下，我们看到列表理解比for循环慢25%。</p><blockquote class="nd"><p id="e24b" class="ne nf it bd ng nh ni nj nk nl nm mm dk translated">For循环比list comprehensions运行函数更快。</p></blockquote><h1 id="619a" class="kz la it bd lb lc ld le lf lg lh li lj jz oe ka ll kc of kd ln kf og kg lp lq bi translated">数组计算比循环快</h1><p id="b090" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这里缺少一个元素:什么比for循环或列表理解更快？数组计算！实际上，在Python中使用for循环、列表理解或。<strong class="lt iu"> </strong>适用于熊猫。相反，你应该总是喜欢数组计算。</p><p id="d8b7" class="pw-post-body-paragraph lr ls it lt b lu my ju lw lx mz jx lz ma na mc md me nb mg mh mi nc mk ml mm im bi translated">如您所见，我们可以使用<strong class="lt iu"> list(range()) </strong>更快地创建我们的列表</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="c27f" class="ms la it mo b gy mt mu l mv mw">start = time.time()<br/>mylist = list(range(iterations))<br/>end = time.time()<br/>print(end - start)<br/><strong class="mo iu">&gt;&gt; 4.84 seconds</strong></span></pre><p id="d183" class="pw-post-body-paragraph lr ls it lt b lu my ju lw lx mz jx lz ma na mc md me nb mg mh mi nc mk ml mm im bi translated">只用了4.84秒！这比我们之前的列表理解(8.2秒)节省了40%的时间。此外，使用list(range(iterations))创建一个列表比执行简单的计算(使用for循环需要6.16秒)还要快。</p><p id="9a04" class="pw-post-body-paragraph lr ls it lt b lu my ju lw lx mz jx lz ma na mc md me nb mg mh mi nc mk ml mm im bi translated">如果你想在一个数字列表上执行一些计算，最佳实践是<strong class="lt iu">而不是</strong>使用列表理解或for循环<strong class="lt iu">来执行数组计算。</strong></p><blockquote class="nd"><p id="6363" class="ne nf it bd ng nh ni nj nk nl nm mm dk translated">数组计算比循环快。</p></blockquote><h1 id="02ad" class="kz la it bd lb lc ld le lf lg lh li lj jz oe ka ll kc of kd ln kf og kg lp lq bi translated">结论</h1><h2 id="7746" class="ms la it bd lb oh oi dn lf oj ok dp lj ma ol om ll me on oo ln mi op oq lp or bi translated">列表理解比循环理解快吗？</h2><p id="999d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">列表理解是创建列表的正确工具——然而使用<em class="os"> list(range()) </em>更好。For循环是执行计算或运行函数的合适工具。在任何情况下，都要避免使用for循环和list comprehensions，而是使用数组计算。</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="7b8b" class="kz la it bd lb lc ot le lf lg ou li lj jz ov ka ll kc ow kd ln kf ox kg lp lq bi translated">奖金:Numpy Arange</h1><p id="83d6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">用<strong class="lt iu"> np.arange() </strong> (6.32秒)创建列表比用<strong class="lt iu"> list(range()) </strong> (4.84秒)慢48%。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="1593" class="ms la it mo b gy mt mu l mv mw">import numpy as np<br/>start = time.time()<br/>mylist = np.arange(0, iterations).tolist()<br/>end = time.time()<br/>print(end - start)<br/><strong class="mo iu">&gt;&gt; 6.32 seconds</strong></span></pre><p id="c565" class="pw-post-body-paragraph lr ls it lt b lu my ju lw lx mz jx lz ma na mc md me nb mg mh mi nc mk ml mm im bi translated">但是，使用np.arange()创建一个numpy数组比<strong class="lt iu">先</strong>创建一个列表并<strong class="lt iu">然后</strong>将其保存为numpy数组快一倍。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="cbde" class="ms la it mo b gy mt mu l mv mw">start = time.time()<br/>mylist = np.array(list(range(iterations)))<br/>end = time.time()<br/>print(end - start)<br/><strong class="mo iu">&gt;&gt; 10.14 seconds</strong></span></pre><p id="5177" class="pw-post-body-paragraph lr ls it lt b lu my ju lw lx mz jx lz ma na mc md me nb mg mh mi nc mk ml mm im bi translated">一旦你有了numpy数组，你就能进行闪电般的数组计算。</p></div></div>    
</body>
</html>