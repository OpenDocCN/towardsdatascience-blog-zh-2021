<html>
<head>
<title>An Efficient Way to Read Data from the Web Directly into Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将数据从Web直接读入Python的有效方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/an-efficient-way-to-read-data-from-the-web-directly-into-python-a526a0b4f4cb?source=collection_archive---------7-----------------------#2021-04-26">https://towardsdatascience.com/an-efficient-way-to-read-data-from-the-web-directly-into-python-a526a0b4f4cb?source=collection_archive---------7-----------------------#2021-04-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="eb53" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">而不必下载到你的硬盘上</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b1606c550d0aa211b56b8b04bd992ee4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*d5xfN7WC5Iza_XMr"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@sevenshooterimage?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">七射手</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="65de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我硬盘上的存储空间非常宝贵，我不想下载一大堆数据，因为我只想把它们整理成易于管理的东西。</p><p id="6c3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有时我们可以将一个URL粘贴到<code class="fe lv lw lx ly b">pd.read_csv()</code>或<code class="fe lv lw lx ly b">xr.read_dataset()</code>中，它会很高兴地读取数据。例如，xarray支持<a class="ae ky" href="https://xarray.pydata.org/en/stable/io.html#opendap" rel="noopener ugc nofollow" target="_blank"> OPeNDAP </a>通过HTTP访问一些数据集，但不是全部。</p><p id="8a5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章将描述一个解决方案，当事情不顺利，直接将URL粘贴到xarray失败时，你可以使用它。我将概述如何从web服务器直接读取数据到Python中，甚至是从zip文件中读取，所有这些都不需要写入磁盘。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="a6ae" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">基本思想</h1><p id="1a63" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">目标是通过HTTP或FTP访问数据，这使用了请求和响应结构。例如，我们可以<em class="nd">请求</em>一个URL的内容，服务器将(希望)把数据作为<em class="nd">响应</em>发送给我们。下面是这个结构在<code class="fe lv lw lx ly b">urllib.request</code> Python包中的工作原理:</p><ol class=""><li id="0b99" class="ne nf it lb b lc ld lf lg li ng lm nh lq ni lu nj nk nl nm bi translated"><code class="fe lv lw lx ly b"><strong class="lb iu">url='https://google.com'</strong></code> <strong class="lb iu"> : </strong>这是我们要访问的URL。</li><li id="0f92" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated"><code class="fe lv lw lx ly b"><strong class="lb iu">req=urllib.request.Request(url)</strong></code> <strong class="lb iu"> : </strong>创建一个请求对象，指定我们想要的URL。</li><li id="a20d" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated"><code class="fe lv lw lx ly b"><strong class="lb iu">resp=urllib.request.urlopen(resp)</strong></code> <strong class="lb iu"> : </strong>从服务器返回请求URL的响应对象。</li><li id="55ae" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated"><code class="fe lv lw lx ly b"><strong class="lb iu">data=resp.read()</strong></code> <strong class="lb iu"> : </strong>响应对象(<code class="fe lv lw lx ly b">resp</code>)是类文件的，表示我们可以读取。</li></ol><p id="6aa5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们将这个基本思想应用到一些真实的数据中。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="c93e" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">从URL读取数据</h1><p id="822f" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">下面的代码从<a class="ae ky" href="https://psl.noaa.gov/data/gridded/data.ncep.reanalysis2.pressure.html" rel="noopener ugc nofollow" target="_blank"> NCEP再分析</a>中获取特定年份的气温。我总是喜欢在打开URL时使用上下文管理器，这样我就不会忘记关闭它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="e16e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码的最后一行用我们的数据返回一个xarray数据集。然而，那条线路有点忙，让我们打开它:</p><ul class=""><li id="078c" class="ne nf it lb b lc ld lf lg li ng lm nh lq ni lu nu nk nl nm bi translated"><code class="fe lv lw lx ly b">resp.read()</code>:是我们要求的数据。但是，它是以字节为单位的。</li><li id="c6cc" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nu nk nl nm bi translated"><code class="fe lv lw lx ly b">io.BytesIO()</code>:将我们请求的数据以字节的形式保存在内存缓冲区中。</li><li id="3e15" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nu nk nl nm bi translated"><code class="fe lv lw lx ly b">xr.open_dataset()</code>:打开字节文件作为xarray数据集。我可以这样做，因为我请求的URL是NetCDF文件。</li></ul><p id="f98f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这太棒了！不费吹灰之力，我们就可以将数据读入内存，而无需下载。</p><h2 id="dda5" class="nv mh it bd mi nw nx dn mm ny nz dp mq li oa ob ms lm oc od mu lq oe of mw og bi translated">注意</h2><p id="d578" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">如果您得到一个错误消息说“不能以字节形式打开NetCDF”，那么您需要安装h5netcdf。</p><pre class="kj kk kl km gt oh ly oi oj aw ok bi"><span id="b474" class="nv mh it ly b gy ol om l on oo">conda install -c conda-forge h5netcdf</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="841c" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">如果数据被压缩了呢？</h1><p id="66b4" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">没问题，Python <code class="fe lv lw lx ly b">zipfile</code>包可以搞定。在下面的代码中，我向服务器请求一个zip文件。然后我使用<code class="fe lv lw lx ly b">zipfile</code>包列出里面的文件。具体来说，我使用的是<code class="fe lv lw lx ly b">namelist()</code>方法。最后，我使用xarray将其中一个NetCDF文件的内容读入一个数据集。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><h2 id="02da" class="nv mh it bd mi nw nx dn mm ny nz dp mq li oa ob ms lm oc od mu lq oe of mw og bi translated">HTTP错误403:禁止</h2><p id="7c91" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">如果你请求访问并得到这个错误信息，这意味着服务器知道你正试图从一个程序访问它。然而，我们比计算机更聪明，可以欺骗它认为我们是一个网络浏览器。这可以通过在我们的请求中附加一个用户代理来实现，这样看起来就像是来自一个web浏览器。打个比方，这就像敲敲门，宣布我们是谁。附加一个不同的用户代理类似于冒充我们不认识的人。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="a207" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">你从哪里得到数据URL？</h1><p id="e3bd" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">当你在网上找到一个数据集时，通常会有一个下载该数据集的按钮。我们想知道链接到该数据的URL。在大多数浏览器中，你可以右击下载链接和“复制链接地址”这里有一个使用<a class="ae ky" href="https://brave.com/" rel="noopener ugc nofollow" target="_blank"> Brave </a>浏览器获取海洋<a class="ae ky" href="https://www.socat.info/index.php/data-access/" rel="noopener ugc nofollow" target="_blank">数据集</a>链接的例子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/dfcbf607c4a9ce3bef8f779076591acb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*fg1E-UaqGsaMYgJhuuGQGQ.gif"/></div></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="727f" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">最后的想法</h1><p id="9691" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">这种方法可以简化数据管道，并使您的代码易于被他人复制。然而，也有一些缺点。例如，如果服务器关闭，您将无法访问数据。这种方法可能并不适用于所有情况，例如数据集太大而无法放入内存。我还没有遇到任何问题，但是我不确定这种方法对于仍然可以放入内存的大型数据集是否有效。</p><p id="f2e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总而言之，我发现这是一种让我的代码可以被其他研究人员复制的干净方式。好处是我不依赖他们先下载数据。至少这是另一个添加到你工具箱的技巧。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="1869" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我很乐意帮助您解决从服务器读取数据到Python时遇到的任何问题。</p><p id="f36e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nd">感谢阅读和支持媒体作者</em></p><div class="oq or gp gr os ot"><a href="https://lukegloege.medium.com/membership" rel="noopener follow" target="_blank"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd iu gy z fp oy fr fs oz fu fw is bi translated">通过我的推荐链接加入Medium—Luke Gloege博士</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">lukegloege.medium.com</p></div></div><div class="pc l"><div class="pd l pe pf pg pc ph ks ot"/></div></div></a></div></div></div>    
</body>
</html>