<html>
<head>
<title>A Guide to Analyzing Experimental Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实验数据分析指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-guide-to-analyzing-experimental-data-7b05eea7e70c?source=collection_archive---------17-----------------------#2021-07-26">https://towardsdatascience.com/a-guide-to-analyzing-experimental-data-7b05eea7e70c?source=collection_archive---------17-----------------------#2021-07-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="14d1" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/hands-on-tutorials" rel="noopener" target="_blank">动手教程</a>，<a class="ae ep" href="https://towardsdatascience.com/tagged/thoughts-and-theory" rel="noopener" target="_blank">思想和理论</a></h2><div class=""/><div class=""><h2 id="b8d9" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">如何克服创业恐慌，并从你的实验中获得有见地的结果</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/32db1441ca60ff989faf65cdbe4d55ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9F7GuMeygip10ppssatrNQ.jpeg"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">由<a class="ae le" href="https://unsplash.com/@goumbik?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">卢卡斯·布拉塞克</a>在<a class="ae le" href="https://unsplash.com/s/photos/experiment-survey?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="d8c2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">你曾经运行过实验研究，或者执行过一些A/B测试吗？如果有，你应该熟悉<strong class="lh ja">分析前的恐慌</strong>:如何让数据揭示你的实验是否起作用？在经济学、公共政策、市场营销和商业分析领域，我们每天都面临着来自<strong class="lh ja">进行实验</strong>和<strong class="lh ja">分析</strong>实验结果的挑战。</p><p id="aa4c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">作为研究人员——我们自己也在为干净高效的实验工作流程而奋斗——我们决定与您分享一份<strong class="lh ja">实用指南</strong>，其中包含<strong class="lh ja">您想要分析实验数据时需要</strong>遵循的所有步骤。我们不能保证旅程会很短，但我们保证会很有趣！</p><p id="b135" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">像往常一样，你可以在其<a class="ae le" href="https://github.com/elisewinn/ExperimentalAnalysis" rel="noopener ugc nofollow" target="_blank"> Github库</a>中找到本指南中使用的所有代码。</p><h2 id="8f62" class="mb mc iq bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms iw bi translated">谁能从本指南中受益？</h2><p id="ad7b" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">本指南专门开发了一个<strong class="lh ja">协议</strong>用于实验数据的分析，如果你经常发现自己在笔记本电脑前一片空白，它会特别有帮助。</p><p id="cd57" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们将简要描述什么是实验，以及为什么——如果设计得好——它能克服观察性研究的常见问题。之后，我们将使用Qualtrics上的简单实验流程生成模拟数据(使用哪种软件生成数据并不重要)。</p><p id="2767" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">最后，我们将编写一个<strong class="lh ja">即用且相当灵活的R代码</strong>来应用于您的实验数据。特别是，我们将强调您心目中的标准实验分析与为实现您最想要的输出而编写的代码之间的映射。</p><p id="61be" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">理想情况下，任何进行或计划进行实验的人都可以看看我们的指南！</p><h1 id="8ab6" class="my mc iq bd md mz na nb mg nc nd ne mj kf nf kg mm ki ng kj mp kl nh km ms ni bi translated">实验流程</h1><p id="6cbc" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">与观察数据相比，使用实验的主要优势在于，精心设计的实验可以让你<strong class="lh ja">测量</strong> <strong class="lh ja">因果关系</strong>。</p><p id="3360" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">确保因果效应估计的实验的主要特征是人们被随机分配到一个实验条件下。这种特征称为“<strong class="lh ja">随机化</strong>，它防止具有某些特征的人<em class="nj">自行选择</em>进入治疗组和对照组。</p><p id="2560" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">治疗组和对照组遵循相同的实验流程，但与对照组相比，治疗组的参与者面临<strong class="lh ja">不同的步骤</strong>:对<strong class="lh ja">自变量</strong>的<strong class="lh ja">操纵</strong>。</p><p id="240a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">通过比较治疗组和对照组的结果变量如何变化，我们将评估自变量<strong class="lh ja">的<strong class="lh ja">操作</strong>是否会对<strong class="lh ja">结果变量</strong>产生因果关系</strong>。</p><h1 id="14bd" class="my mc iq bd md mz na nb mg nc nd ne mj kf nf kg mm ki ng kj mp kl nh km ms ni bi translated">现在，让我们编码吧！</h1><p id="cb05" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">对于这个分析，我们将使用几个R包来导入、整形、可视化和分析我们的(模拟)实验数据。<em class="nj">记住:如果你还没有安装软件包，使用代码“install.packages()”来安装，如下面注释行所示。</em></p><pre class="kp kq kr ks gt nk nl nm nn aw no bi"><span id="83ee" class="mb mc iq nl b gy np nq l nr ns"># install.packages('packagename')</span><span id="2e65" class="mb mc iq nl b gy nt nq l nr ns">library(tidyverse);library(data.table) # data wrangling and reshaping<br/>library(ggplot2) # plotting<br/>library(QuantPsyc) # To generate results<br/>library(grf)<br/>library(viridis) # For esthetics<br/>library(stargazer) # optional, for reporting</span></pre><h1 id="181e" class="my mc iq bd md mz na nb mg nc nd ne mj kf nf kg mm ki ng kj mp kl nh km ms ni bi translated"><strong class="ak">第0步:导入并检查数据</strong></h1><p id="e19c" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">我们将在本教程中使用的数据是由<a class="ae le" href="https://www.qualtrics.com/nl/lp/brand-lp/experience-management/?utm_source=google&amp;utm_medium=ppc&amp;utm_campaign=Brand+Search+EN+NL&amp;campaignid=11015383115&amp;utm_content=&amp;adgroupid=106859202454&amp;utm_keyword=qualtrics&amp;utm_term=qualtrics&amp;matchtype=b&amp;device=c&amp;placement=&amp;network=g&amp;creative=461138976401&amp;gclid=Cj0KCQjwl_SHBhCQARIsAFIFRVXGm5tllR9CdsDZ5-FRlJobYwf2wKuwyW2hZwB9JTX-CxMJrN_2UoUaAg3QEALw_wcB" rel="noopener ugc nofollow" target="_blank"> Qualtrics </a>生成的，这是一个用于设计问卷和实验调查的流行网站。</p><p id="dc35" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们基于前面描述的流程开发了一个实验调查。然后，为了我们的分析目的，我们生成了<strong class="lh ja"> 500个自动(“测试”)响应</strong>。</p><p id="fcc2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们下载了<strong class="lh ja"> CSV格式的</strong>测试响应，现在<strong class="lh ja">将它们导入到r中。我们还<strong class="lh ja">重命名</strong>最重要的变量，并将数字变量转换成——嗯，数字量:</strong></p><pre class="kp kq kr ks gt nk nl nm nn aw no bi"><span id="a7dd" class="mb mc iq nl b gy np nq l nr ns">dt &lt;- fread('ExperimentalAnalysis_TestData.csv', stringsAsFactors = F, header = T) %&gt;% as_tibble()</span><span id="80c6" class="mb mc iq nl b gy nt nq l nr ns">dt &lt;- dt %&gt;% <br/>  rename(Treatment = FL_8_DO, <br/>         Outcome_T = Q3_1, <br/>         Outcome_C = Q7_1,<br/>         Initial_Beliefs = Q15_1,<br/>         AttnCheck = Q16,<br/>         Age = Q8, <br/>         Nationality = Q9, <br/>         Internet_use = Q10,<br/>         Last_election = Q11, <br/>         Which_politician = Q12)</span><span id="d810" class="mb mc iq nl b gy nt nq l nr ns">dt &lt;- dt %&gt;% <br/>  mutate_at(.vars = vars(Outcome_T,Outcome_C,Initial_Beliefs), .funs = as.numeric)</span></pre><p id="eb02" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们将使用<strong class="lh ja">"</strong><a class="ae le" href="https://www.tidyverse.org/" rel="noopener ugc nofollow" target="_blank"><strong class="lh ja">tible</strong></a><strong class="lh ja">"数据结构</strong>，因为我们的数据集相当小，tible允许我们直接在控制台中很好地预览数据。对于较大的数据集(即超过几百万行的数据集)，您可能希望切换到“<a class="ae le" href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html" rel="noopener ugc nofollow" target="_blank"> data.table </a>”结构。</p><p id="faac" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">实际上，你可能不仅要处理<strong class="lh ja">不同的</strong>数据大小，还要处理不同的软件，或者<strong class="lh ja">成百上千的响应</strong>——这没多大关系，只要你能导入R中的数据矩阵，并从数据中恢复治疗控制结果变量。</p><h2 id="3262" class="mb mc iq bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms iw bi translated"><strong class="ak">初始检查</strong></h2><p id="3d28" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">在第一次检查时，我们需要删除对我们的分析没有用的前两行(slice函数)。但是，我们将保存第一行(slice(1))，因为它包含了变量的描述。</p><pre class="kp kq kr ks gt nk nl nm nn aw no bi"><span id="9f74" class="mb mc iq nl b gy np nq l nr ns">dt<br/>colnames(dt)</span><span id="574c" class="mb mc iq nl b gy nt nq l nr ns">dt_question_labels &lt;- dt %&gt;% slice(1)</span><span id="0de0" class="mb mc iq nl b gy nt nq l nr ns">dt_question_labels &lt;- dt_question_labels %&gt;% <br/>  t() %&gt;%<br/>   as.data.frame() %&gt;% <br/>   mutate(Label = rownames(.))</span><span id="5720" class="mb mc iq nl b gy nt nq l nr ns">(dt &lt;- dt %&gt;% <br/>  slice(-c(1,2)))</span></pre><h2 id="0b9b" class="mb mc iq bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms iw bi translated"><strong class="ak">未完成病例</strong></h2><p id="5bb4" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">我们需要确保我们只分析来自完成调查的回答者的数据。如果您注意到样本中的许多受访者没有完成调查(通常，约5%的遗漏情况是可以接受的)，这可能是您的调查、您的导入程序或两者都有问题的迹象。</p><p id="b480" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">检查分配到治疗组或对照组的参与者是否有相同的完成率是一个好的做法。如果不是这样，你的实验的内在有效性可能会有危险。</p><pre class="kp kq kr ks gt nk nl nm nn aw no bi"><span id="fc45" class="mb mc iq nl b gy np nq l nr ns">dt %&gt;% <br/>  group_by(Finished) %&gt;%<br/>  summarise(n = n())</span><span id="dbcb" class="mb mc iq nl b gy nt nq l nr ns"># If you have 'False' in the result, kick out those people</span><span id="9dba" class="mb mc iq nl b gy nt nq l nr ns">dt &lt;- dt %&gt;% <br/>  filter(Finished == 'True')</span></pre><h2 id="7c57" class="mb mc iq bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms iw bi translated"><strong class="ak">测试响应</strong></h2><p id="abb1" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">我们还需要删除在任何“<strong class="lh ja">预览</strong>模式或“测试”模式中给出的答案，因为这些答案不是从您的实验样本中生成的。(注意:在我们的例子中，所有答案都是在“测试”模式下生成的)。</p><pre class="kp kq kr ks gt nk nl nm nn aw no bi"><span id="ab6f" class="mb mc iq nl b gy np nq l nr ns">dt &lt;- dt %&gt;% <br/>  # filter(!(Status %in% c('Survey Preview', 'Survey Test')))<br/>  filter(!(Status %in% c('Survey Preview')))</span></pre><h2 id="4f6b" class="mb mc iq bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms iw bi translated"><strong class="ak">遗漏答案</strong></h2><p id="8aa1" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">我们需要检查治疗或结果变量中是否有<strong class="lh ja">缺失数据</strong>。在这里，您可以找到治疗或结果中有缺失数据的应答，并识别应答者ID。由于没有治疗方法，这些反应是无效的。</p><p id="9610" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">如果发现数据缺失，需要尽快了解数据缺失的原因</strong>。这可能是一个技术错误，或者是您的调查存在系统问题。</p><pre class="kp kq kr ks gt nk nl nm nn aw no bi"><span id="62da" class="mb mc iq nl b gy np nq l nr ns">(test_NA &lt;- dt %&gt;% <br/>   # select respondent ID's, outcome variables, and treatment indicator<br/>  select(ResponseId, Treatment, Outcome_C, Outcome_T) %&gt;% <br/>   # mutate everything into numeric<br/>   mutate_at(., vars(Outcome_C, Outcome_T), as.numeric) %&gt;% <br/>   mutate(Treatment_numeric = as.numeric(as.factor(Treatment))) %&gt;% <br/>   # if a cell is empty/missing, flag with NA<br/>   mutate_all(., function(x) ifelse(x == '', NA, x)) %&gt;% <br/>  bind_rows(tibble(Outcome_C = NA, Outcome_T = NA, Treatment_numeric = NA)) %&gt;% <br/>  rowwise() %&gt;% <br/>  mutate(sum = sum(Outcome_C, Outcome_T, Treatment_numeric, na.rm = T)) %&gt;%<br/>  filter(sum == 0))</span><span id="ae80" class="mb mc iq nl b gy nt nq l nr ns"># If ResponseID is equal to NA, then you're fine and you can skip this part.</span><span id="567b" class="mb mc iq nl b gy nt nq l nr ns"># if you have missing data, you can collect the ID's here:</span><span id="7a1c" class="mb mc iq nl b gy nt nq l nr ns">if (sum(test_NA$sum != 0)) {<br/>  <br/>  message("Your data has missing values! Find the cause ASAP.")<br/>  <br/>  Missing_ids &lt;- dt %&gt;% <br/>  select(ResponseId, Treatment1, Treatment2, ControlGroup) %&gt;% <br/>  bind_rows(tibble(Treatment1 = NA, Treatment2 = NA, ControlGroup = NA)) %&gt;% <br/>  rowwise() %&gt;% <br/>  mutate(sum = sum(Treatment1,Treatment2,ControlGroup, na.rm = T)) %&gt;%<br/>  filter(sum == 0)<br/>  <br/>  Missing_ids &lt;- Missing_ids$ResponseId<br/>  <br/>  # and remove them from the sample<br/>  <br/>  dt &lt;- dt %&gt;% <br/>    filter(!(ResponseId %in% Missing_ids))<br/>  <br/>}</span></pre><h2 id="8e37" class="mb mc iq bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms iw bi translated"><strong class="ak">注意力检查失败</strong></h2><p id="c8fa" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">我们还需要排除<strong class="lh ja">未通过注意力检查</strong>的回答者(在我们的数据集中标记为AttnCheck)。在我们的模拟样本中，339个机器人没有通过注意力检查。我们剩下161个可用的响应。</p><p id="06b5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">同样，为了保持研究的内部有效性，检查特定类别的人是否没有通过注意力检查是一种好的做法。</p><pre class="kp kq kr ks gt nk nl nm nn aw no bi"><span id="bb9f" class="mb mc iq nl b gy np nq l nr ns"># How many people failed the attention check?<br/>dt %&gt;% <br/>  filter(AttnCheck != 'A') %&gt;% <br/>  tally()</span><span id="7dcb" class="mb mc iq nl b gy nt nq l nr ns">dt &lt;- dt %&gt;% <br/>  filter(AttnCheck == 'A')</span></pre><h2 id="6c6e" class="mb mc iq bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms iw bi translated"><strong class="ak">离群值</strong></h2><p id="205f" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">作为对我们数据的最后一次健康检查，我们将检查一些回答者是否花费了<strong class="lh ja">异常长的时间来完成我们的调查</strong>。我们采用一个任意但常见的阈值:我们将标记并排除完成时间大于或小于平均值的<strong class="lh ja"> 3标准差</strong>的回答者。</p><p id="fcdf" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在我们的测试数据中，6个机器人的完成时间大于或小于平均值的3个标准差。</p><pre class="kp kq kr ks gt nk nl nm nn aw no bi"><span id="79f4" class="mb mc iq nl b gy np nq l nr ns"># How many outliers are there?<br/>dt %&gt;% <br/>  filter(`Duration (in seconds)` &lt; sd(`Duration (in seconds)`)*3 &amp; `Duration (in seconds)` &gt; -(sd(`Duration (in seconds)`)*3)) %&gt;% <br/>  tally()</span><span id="4060" class="mb mc iq nl b gy nt nq l nr ns">dt &lt;- dt %&gt;% <br/>  filter(`Duration (in seconds)` &lt; sd(`Duration (in seconds)`)*3 &amp; `Duration (in seconds)` &gt; -(sd(`Duration (in seconds)`)*3))</span></pre><h2 id="3e66" class="mb mc iq bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms iw bi translated">结果变量</h2><p id="1ef1" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">如果在对Qualtrics调查进行编码时，您分别测量了治疗组和对照组受试者的结果变量，那么我们还需要添加一个单独的列，其中包含两个结果的值。</p><pre class="kp kq kr ks gt nk nl nm nn aw no bi"><span id="3c1a" class="mb mc iq nl b gy np nq l nr ns">dt &lt;- dt %&gt;% <br/>  rowwise() %&gt;% <br/>  mutate(Outcome = sum(Outcome_T, Outcome_C, na.rm = T))</span></pre><h2 id="bea9" class="mb mc iq bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms iw bi translated">控制变量</h2><p id="e42d" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">在我们最后的数据准备步骤中，我们将<strong class="lh ja">分类变量转换成因子</strong>。这一步并不是绝对必要的，但它将有助于数据的可视化和分析。</p><pre class="kp kq kr ks gt nk nl nm nn aw no bi"><span id="b90a" class="mb mc iq nl b gy np nq l nr ns">dt &lt;- dt %&gt;% <br/>  mutate_at(c('Age', 'Nationality', 'Internet_use', 'Last_election'), as.factor)</span></pre><h2 id="2760" class="mb mc iq bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms iw bi translated">随机化的完整性</h2><p id="1f1e" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">我们需要确保两组(治疗组和对照组)的参与者平均拥有相似的特征——换句话说，参与者被<strong class="lh ja">随机分配</strong>到实验条件。</p><p id="5fd1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们可以运行双样本独立t检验来评估二元变量<strong class="lh ja">和连续变量</strong> <strong class="lh ja">在不同条件下</strong>是否不同。</p><p id="fd75" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">当变量为<strong class="lh ja">分类</strong>时，我们将使用<strong class="lh ja">卡方检验</strong>来比较这些变量在不同组之间的差异。例如:</p><pre class="kp kq kr ks gt nk nl nm nn aw no bi"><span id="3094" class="mb mc iq nl b gy np nq l nr ns">chisq.test(dt$Treatment, dt$Age, correct=FALSE)</span></pre><p id="6985" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果这些检验的p值高于0.05，那么我们可以假设随机化起作用了。</p><h1 id="5967" class="my mc iq bd md mz na nb mg nc nd ne mj kf nf kg mm ki ng kj mp kl nh km ms ni bi translated">步骤1:数据可视化</h1><p id="1752" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">在正式分析实验数据之前，重要的是我们<strong class="lh ja">将它可视化</strong>。视觉化是一个强大的工具,可以发现任何不可信的情况——比如失败的随机化，失败的操纵，或者天花板和地板效应——并且对<strong class="lh ja">效应</strong>的方向有一个初步的感觉。</p><p id="c8c0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">首先，我们将可视化结果变量在整个实验条件下的<strong class="lh ja">分布。我们对分布的一些特定时刻特别感兴趣，比如平均值和中位数。</strong></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nu"><img src="../Images/ac13bdd8b1ca23beb05a32d96294de91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*304OKPITCVK-qnDDYLNA_g.png"/></div></div></figure><pre class="kp kq kr ks gt nk nl nm nn aw no bi"><span id="7bf1" class="mb mc iq nl b gy np nq l nr ns">dt %&gt;% <br/>  group_by(Treatment) %&gt;% <br/>  summarise(mean_T = mean(Outcome),<br/>         median_T = median(Outcome))</span><span id="8bb7" class="mb mc iq nl b gy nt nq l nr ns">dt %&gt;% <br/>  group_by(Treatment) %&gt;% <br/>  mutate(mean_T = mean(Outcome),<br/>         median_T = median(Outcome)) %&gt;% <br/>  ggplot(aes(x = Outcome)) +<br/>  geom_histogram() +<br/>  geom_vline(aes(xintercept = mean_T), color = 'red', linetype= 2) +<br/>  geom_vline(aes(xintercept = median_T), color = 'blue', linetype= 2) +<br/>  facet_wrap(.~Treatment) +<br/>  theme_bw() +<br/>  labs(caption = 'Red line: mean; Blue line: median')</span></pre><p id="4bc9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">从分布中我们可以看到，在这个模拟数据集<strong class="lh ja">中，结果变量</strong>的<strong class="lh ja">平均值在治疗组</strong>中(51.53)略高于对照组(47.95)。</p><p id="2565" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">或者，我们可以按组直接绘制<strong class="lh ja">平均值，以及平均值的<strong class="lh ja">自举标准误差</strong>:</strong></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nv"><img src="../Images/bdbd5e916245b1869cda7ba0e18436b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h59XZXCL_Yyqb1mrE0PyiA.png"/></div></div></figure><pre class="kp kq kr ks gt nk nl nm nn aw no bi"><span id="0a7b" class="mb mc iq nl b gy np nq l nr ns">dt %&gt;% <br/>  group_by(Treatment) %&gt;% <br/>  mutate(mean_T = mean(Outcome),<br/>         median_T = median(Outcome)) %&gt;%<br/>  ungroup %&gt;% <br/>  ggplot(aes(x = Treatment, y = Outcome)) +<br/>  stat_summary(fun.data = mean_cl_boot) +<br/>  theme_bw()</span></pre><p id="3af1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们还可以检查具有不同背景特征的人之间的结果如何变化。例如，让我们看看年龄:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nw"><img src="../Images/c7e82e78caad5292e3d8bab48a564834.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f_psNjImxC1Fnos4gAszQA.png"/></div></div></figure><pre class="kp kq kr ks gt nk nl nm nn aw no bi"><span id="9f5d" class="mb mc iq nl b gy np nq l nr ns">dt &lt;- dt %&gt;%<br/>  mutate(Age = factor(Age, levels = c('18 or younger', '19-24', '25-35',<br/>                              '36-45', '46-55', '56 or older')))<br/>dt %&gt;%<br/>  ggplot(aes(x = Age, y = Outcome, color= Treatment)) +<br/>  stat_summary(fun.data = mean_cl_boot, position = position_dodge(width = .5)) +<br/>  theme_bw() +<br/>  scale_color_viridis(discrete = T) +<br/>  coord_flip()</span></pre><h1 id="f974" class="my mc iq bd md mz na nb mg nc nd ne mj kf nf kg mm ki ng kj mp kl nh km ms ni bi translated">第二步:分析</h1><p id="57fe" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">如果到目前为止所有的检查都给了我们关于随机化的<strong class="lh ja">信心，那么<strong class="lh ja">比较</strong>在<strong class="lh ja">治疗和对照</strong>之间<strong class="lh ja">结果</strong>变量的变化将会给我们一个<strong class="lh ja">因果效应。</strong></strong></p><h2 id="2bc3" class="mb mc iq bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms iw bi translated">非参数分析</h2><p id="f0f4" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">如果我们<strong class="lh ja">不能安全地假设</strong>我们正在分析的数据遵循<strong class="lh ja">正态分布</strong>，我们需要使用<strong class="lh ja">非参数检验</strong>来研究治疗组和对照组之间的平均结果变量如何变化。服务于此目的的测试是<strong class="lh ja"> </strong> <a class="ae le" href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/wilcox.test" rel="noopener ugc nofollow" target="_blank"> <strong class="lh ja">威尔克森测试</strong> </a> <strong class="lh ja">。</strong></p><h2 id="9f61" class="mb mc iq bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms iw bi translated">参量分析</h2><p id="4f98" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">如果数据具有<strong class="lh ja">正态结构</strong>(参见<a class="ae le" href="https://www.rdocumentation.org/packages/tsoutliers/versions/0.3/topics/jarque.bera.test" rel="noopener ugc nofollow" target="_blank"> Jarque-Bera检验</a>)，我们可以使用独立的<strong class="lh ja">双样本t检验</strong>来比较治疗组和对照组的结果变量。</p><pre class="kp kq kr ks gt nk nl nm nn aw no bi"><span id="0c49" class="mb mc iq nl b gy np nq l nr ns">t.test(dt$Outcome[dt$Treatment == 'Control'],dt$Outcome[dt$Treatment == 'Treatment1'] , alternative = "two.sided", paired = F)</span></pre><p id="ad44" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">除了t检验之外，我们还将对一个<strong class="lh ja">常数</strong>、<strong class="lh ja">自变量</strong>(治疗)——我们将把它转换为一个二元变量，如果参与者属于治疗组，则值为1——以及所有其他<strong class="lh ja">控制变量</strong>——执行一个<strong class="lh ja">线性回归</strong>的<strong class="lh ja">结果</strong>变量。</p><p id="4917" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">推荐使用<strong class="lh ja">回归分析</strong>有两个原因:</p><ol class=""><li id="86e9" class="nx ny iq lh b li lj ll lm lo nz ls oa lw ob ma oc od oe of bi translated">评估<strong class="lh ja">治疗是否对结果变量有任何影响</strong>，保持<strong class="lh ja">其他一切不变</strong>；</li><li id="4b03" class="nx ny iq lh b li og ll oh lo oi ls oj lw ok ma oc od oe of bi translated">如果随机化没有正常进行，评估<strong class="lh ja">治疗</strong>对<strong class="lh ja">结果</strong>变量的影响。</li></ol><pre class="kp kq kr ks gt nk nl nm nn aw no bi"><span id="d7a2" class="mb mc iq nl b gy np nq l nr ns">fit &lt;- lm(Outcome ~ 1 + Treatment + Age + Internet_use, data = dt)<br/>summary(fit)</span></pre><h1 id="3798" class="my mc iq bd md mz na nb mg nc nd ne mj kf nf kg mm ki ng kj mp kl nh km ms ni bi translated">步骤3:替代(非参数)分析</h1><p id="afe5" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">我们还建议您尝试使用<a class="ae le" href="https://grf-labs.github.io/grf/articles/grf.html" rel="noopener ugc nofollow" target="_blank">广义随机森林</a>来估计<em class="nj">异质性</em>治疗效果。当你的数据的不同阶层之间的<strong class="lh ja">不同时，治疗效果是不同的——换句话说，当<strong class="lh ja">的治疗效果在<strong class="lh ja">不同的回答者子群</strong>之间有很大差异时。</strong></strong></p><p id="21b1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">为了使用GRF估计异质性治疗效果，我们需要将治疗(W)、结果(Y)和异质性变量(X)分别编码为三个独立的矩阵。</p><pre class="kp kq kr ks gt nk nl nm nn aw no bi"><span id="22fb" class="mb mc iq nl b gy np nq l nr ns">W &lt;- dt[, 'Treatment'] %&gt;%<br/>  mutate(Treatment = ifelse(Treatment == 'Treatment1', 1, 0)) %&gt;% <br/>  as.matrix()</span><span id="aca7" class="mb mc iq nl b gy nt nq l nr ns">X &lt;- model.matrix(~ 0 + ., dt[c('Age','Nationality', 'Internet_use')])</span><span id="d23c" class="mb mc iq nl b gy nt nq l nr ns">Y &lt;- dt %&gt;%<br/>  select(Outcome) %&gt;%<br/>  as.matrix()</span><span id="6d9d" class="mb mc iq nl b gy nt nq l nr ns">cf &lt;- causal_forest(X, Y, W)</span></pre><p id="7808" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">最后，我们可以估计全样本的条件平均处理效果(CATE)，以及处理样本的条件平均处理效果(CATT)。</p><pre class="kp kq kr ks gt nk nl nm nn aw no bi"><span id="7ba9" class="mb mc iq nl b gy np nq l nr ns">average_treatment_effect(cf, target.sample = “all”)<br/>average_treatment_effect(cf, target.sample = “treated”</span></pre><h1 id="6f44" class="my mc iq bd md mz na nb mg nc nd ne mj kf nf kg mm ki ng kj mp kl nh km ms ni bi translated">结论</h1><p id="81e7" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">如果你做到了这一步:祝贺你完成了对实验数据的分析！</p><p id="68a0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">你会有什么不同的做法？你会在工作流程中增加哪些重要的步骤？请在评论中告诉我们。</p><h2 id="5065" class="mb mc iq bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms iw bi translated">关于作者</h2><p id="b99c" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">弗朗切斯科·卡波扎是伊拉斯谟经济学院的博士生。他利用在线和实地实验来理解人类对政治和劳动的选择。</p><p id="b2f9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><a class="ae le" href="https://sites.google.com/view/martinapocchiari" rel="noopener ugc nofollow" target="_blank"> Martina Pocchiari </a>是伊拉斯谟大学鹿特丹管理学院的博士生。Martina进行实验室和实地实验，研究人们在网络社区中的行为。</p></div></div>    
</body>
</html>