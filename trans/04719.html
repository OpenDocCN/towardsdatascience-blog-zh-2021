<html>
<head>
<title>Optimize AWS Lambda Memory</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">优化AWS Lambda内存</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/optimize-aws-lambda-memory-more-memory-doesnt-mean-more-costs-51ba566fecc7?source=collection_archive---------7-----------------------#2021-04-24">https://towardsdatascience.com/optimize-aws-lambda-memory-more-memory-doesnt-mean-more-costs-51ba566fecc7?source=collection_archive---------7-----------------------#2021-04-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="22b2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">关于如何决定lambda函数的内存需求的见解</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/255191b698060dd657ad5fc87a7e542c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rVi7QHJcatMHbS6p"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">埃里克·麦克林在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="5280" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于任何开始无服务器之旅的人来说，AWS lambda太棒了。你写代码，调用函数，它会为你做工作。打住，真的做到预期了吗？我是说执行时间呢？如何确保我的lambda函数以最低的成本实现最佳性能？这是每个人开始生产lambda函数时都会思考的问题。相信我，我得到的关于lambda函数的问题都很疯狂:</p><ol class=""><li id="acef" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">当函数是CPU密集型的时，为什么要分配更多的内存？</li><li id="2290" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">lambda函数的CPU利用率是多少？</li><li id="ff5b" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">增加内存会增加成本。检查一下你分配了多少内存。</li></ol><p id="7c88" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我第一次开始使用lambda时，我感到困惑的是，AWS可以选择为lambda函数分配内存。没有分配CPU的选项。CPU会随着内存的增加而扩展。为了理解它是如何工作的，让我们举一个简单的例子，在不同的内存限制下运行它。</p><p id="3790" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我写了一个简单的函数，打印出介于“下”和“上”值之间的质数。代码如下:</p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="443e" class="ml mm iq mh b gy mn mo l mp mq">import json</span><span id="f68b" class="ml mm iq mh b gy mr mo l mp mq">print('Loading function')</span><span id="cbb1" class="ml mm iq mh b gy mr mo l mp mq">def lambda_handler(event, context):<br/>    lower = 2<br/>    upper = 50000<br/>    print("Prime numbers between", lower, "and", upper)<br/>    <br/>    for num in range(lower, upper + 1):<br/>        if(num &gt; 1):<br/>            for i in range(2, num):<br/>                if (num % i) == 0:<br/>                    break<br/>            else:<br/>                print(num)</span><span id="0d62" class="ml mm iq mh b gy mr mo l mp mq">return {<br/>        'statusCode': 200,<br/>        'body': json.dumps("Function executed successfully")<br/>    }</span></pre><p id="5959" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我用4个内存限制(128 MB、256 MB、512 MB和1024 MB)运行了上面的函数。以下是结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/716c4b0801cf56ae07c1c30667d8b712.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hq-rZ8HiOiR68tBU4pY1cA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="912f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如你所见，<em class="mt">【使用的最大内存】</em>总是在48 MB左右。不过，有趣的是看到的<em class="mt">“执行时间”。随着我增加内存，执行时间下降了(从128 MB的135秒到1024 MB的17秒)。这证明随着内存的增加，分配的CPU越来越多。但是成本呢？内存增加会导致更高的成本吗？为了理解成本的含义，我使用了<a class="ae kv" href="https://calculator.aws/#/" rel="noopener ugc nofollow" target="_blank"> AWS计算器</a>。我选择找出每月10000次执行的无自由层成本，这是我得到的结果:</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mu"><img src="../Images/6f735e6b36069b70d6601bd5f9d0d202.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dbgEm-g55_BmCS7-H8uXbA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="5e95" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看着这些数字，我很惊讶。对于128 MB的内存，我的执行时间大约是135秒，成本是2.82美元。将内存增加到1024 MB，在不增加太多成本的情况下，极大地提高了执行时间。因此，增加内存会增加成本并不总是正确的。</p><p id="e8d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">问题是如何为lambda函数分配最优内存？我的意思是，我不能对我写的每个函数都做这样的计算。所以我开始在网上搜索，看看是否有工具可以做到这一点，并给我提供内存、执行时间和成本的最佳组合。你猜怎么着，谷歌一如既往地帮我找到了答案。GitHub上有一个由Alex Casalboni编写的独立项目可以完成这项工作。(<a class="ae kv" href="https://github.com/alexcasalboni/aws-lambda-power-tuning" rel="noopener ugc nofollow" target="_blank">https://github.com/alexcasalboni/aws-lambda-power-tuning</a></p><h1 id="3587" class="mv mm iq bd mw mx my mz na nb nc nd ne jw nf jx ng jz nh ka ni kc nj kd nk nl bi translated"><strong class="ak">使用AWS Lambda功率调谐</strong></h1><p id="e938" class="pw-post-body-paragraph kw kx iq ky b kz nm jr lb lc nn ju le lf no lh li lj np ll lm ln nq lp lq lr ij bi translated">你可以在GitHub文章<a class="ae kv" href="https://github.com/alexcasalboni/aws-lambda-power-tuning/blob/master/README-DEPLOY.md" rel="noopener ugc nofollow" target="_blank">https://GitHub . com/alexcasalboni/AWS-lambda-power-tuning/blob/master/README-deploy . MD</a>中了解如何安装power tuner。</p><p id="1e43" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我继续使用选项1，无服务器应用程序存储库进行部署。部署完成后，是时候为我的lambda函数执行它了。同样，在文章<a class="ae kv" href="https://github.com/alexcasalboni/aws-lambda-power-tuning/blob/master/README-EXECUTE.md" rel="noopener ugc nofollow" target="_blank">https://github . com/alexcasalboni/AWS-lambda-power-tuning/blob/master/README-execute . MD</a>中给出了多个执行选项</p><p id="00da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我使用<em class="mt">选项3执行:使用以下输入手动执行状态机(web控制台)</em>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/fec71581f2c865e4f55935ebeaa1f0b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*WEoJrDqfOFYUnk83tSm53w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><ol class=""><li id="207c" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">被测λ函数的λarn→arn。</li><li id="6f13" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">powerValues →要测试的内存值列表</li><li id="72a1" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">num →每个配置的调用次数</li><li id="8f39" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">策略→可以是我在测试中使用的平衡的<code class="fe ns nt nu mh b">"cost"</code>或<code class="fe ns nt nu mh b">"speed"</code>或<code class="fe ns nt nu mh b">"balanced".</code>。</li></ol><p id="a772" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以在此链接中阅读更多关于其他输入值的信息:<a class="ae kv" href="https://github.com/alexcasalboni/aws-lambda-power-tuning/blob/master/README-INPUT-OUTPUT.md" rel="noopener ugc nofollow" target="_blank">https://github . com/alexcasalboni/AWS-lambda-power-tuning/blob/master/README-INPUT-output . MD</a></p><p id="37ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦我执行了状态机，我得到了下面的结果(<em class="mt">注意:对于这个测试</em>，我将‘upper’值减少到了10000)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/358a670809629902fa2ca4c44c45c284.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lbH9adJFiw9vhqI2ht6qtg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="dc47" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从上面的描述可以看出，最好的性价比是512 MB内存。但当我们看到1024 MB的内存时，我们的成本会稍微高一些，但执行时间会大幅减少。我发现这个工具非常适合测量lambda函数的内存需求。您可以根据自己的需求在输入中尝试不同的值组合，然后做出决定，而不是进行一些特别的内存分配并期望事情正常工作。</p></div></div>    
</body>
</html>