<html>
<head>
<title>E2E Deep Learning: Serverless Image Classification</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">E2E深度学习:无服务器图像分类</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/e2e-deep-learning-serverless-image-classification-d4351372c83e?source=collection_archive---------30-----------------------#2021-07-04">https://towardsdatascience.com/e2e-deep-learning-serverless-image-classification-d4351372c83e?source=collection_archive---------30-----------------------#2021-07-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d3c1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用TensorFlow、Docker、AWS Lambda和API Gateway构建端到端深度学习模型，对真实世界的图像进行分类</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2cb9da8e8856d891a8f3b8d13f020925.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GsVOzLOi0Z0p5fZBXWRG4g.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">本杰明·拉斯科在<a class="ae kv" href="https://unsplash.com/@dapperprofessional?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="ff1b" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">A.介绍</h1><h2 id="1252" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">A.1 .背景和动机</h2><p id="76f6" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi mw translated"><span class="l mx my mz bm na nb nc nd ne di">在</span>数据科学生命周期中，<strong class="mf ir">部署</strong>是我们最终<strong class="mf ir">将我们的人工智能模型付诸实践</strong>的阶段。因此，在我们构建和评估模型之后，我们需要将它作为一个解决方案来部署，以帮助企业解决现实世界中的问题。只有这样做，我们才能从用户或利益相关者那里获得反馈，以改进模型并评估其性能和影响。换句话说，管理<strong class="mf ir">端到端数据科学项目</strong>的技能是任何数据科学家都必须具备的。</p><h2 id="dfe1" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">A.2目标</h2><p id="ef25" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">现在，假设我们需要处理大量真实世界的服装图像，而你的职责是为一家电子商务公司创建一个自动图像分类器。因此，挑战不仅在于建立一个强大的深度学习模型，还在于将其部署为一个<strong class="mf ir">无服务器应用</strong>。<strong class="mf ir"> </strong>这种无服务器方法有助于我们只关注业务解决方案，而不是承载应用的繁重基础设施。幸运的是，<strong class="mf ir"> AWS Lambda </strong>和<strong class="mf ir"> API Gateway </strong>的组合可以用于托管无服务器API。</p><p id="a500" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated">在这个项目中，我们将一起学习如何:</p><ul class=""><li id="a073" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated"><strong class="mf ir">建立深度学习模型</strong>使用TensorFlow对图像进行分类。</li><li id="0464" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated"><strong class="mf ir">使用TensorFlow Lite将模型</strong>转换成尺寸效率更高的格式。</li><li id="38bb" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">使用Docker在我们的机器上本地部署模型。</li><li id="95c9" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated"><strong class="mf ir">使用AWS Lambda和API Gateway将模型部署为REST API </strong>。</li></ul><h2 id="bc56" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">A.3 .目录</h2><ul class=""><li id="5d2b" class="nk nl iq mf b mg mh mj mk lt ny lw nz lz oa mv np nq nr ns bi translated"><strong class="mf ir">简介</strong> &gt; <em class="ob">背景与动机</em> &gt; <em class="ob">目标&gt;目录</em></li><li id="3f51" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated"><strong class="mf ir">模型训练</strong> &gt; <em class="ob">图像数据集&gt;建立模型&gt;训练模型&gt;评估模型</em></li><li id="dee6" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated"><strong class="mf ir">型号转换</strong> <em class="ob"> &gt;转换型号&gt;使用转换后的型号</em></li><li id="17d0" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated"><strong class="mf ir">模型部署</strong> <em class="ob"> &gt; Lambda功能&gt;本地部署，Docker &gt;在AWS上部署</em></li></ul><blockquote class="oc"><p id="47e5" class="od oe iq bd of og oh oi oj ok ol mv dk translated">由于这篇教程文章将会非常<strong class="ak">广泛</strong>，请随意跳转到适合您需求的特定部分。</p></blockquote><blockquote class="om on oo"><p id="33ad" class="md me ob mf b mg op jr mi mj oq ju ml or os mn mo ot ou mq mr ov ow mt mu mv ij bi translated"><strong class="mf ir">注意:<br/> </strong>为了跟进这个项目，我们希望你对如何使用TensorFlow、Docker [1]、AWS术语建立深度学习模型有一个基本的了解，并拥有一个AWS帐户来访问其服务。</p><p id="7b59" class="md me ob mf b mg nf jr mi mj ng ju ml or nh mn mo ot ni mq mr ov nj mt mu mv ij bi translated">这个项目在<a class="ae kv" href="https://github.com/diardanoraihan/E2E_Deep_Learning" rel="noopener ugc nofollow" target="_blank"> <strong class="mf ir">我的GitHub库</strong>中有很好的记录。对于那些对完整代码感到好奇的人，请一定要去看看👍。</a></p></blockquote><h1 id="d66d" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">B.模特培训</h1><h2 id="f34e" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">B.1 .图像数据集</h2><p id="6da5" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">该数据集包含3781幅服装图像，具有前10个最流行的类别，分为训练集、测试集和验证集。<strong class="mf ir">表1 </strong>显示了数据集摘要，以便更好地理解。我们可以在这里访问数据[2]。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/efd6439a89082a61a12cab9c8f65c085.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*5O0nmXCv5R4Vvo14gSad7w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd oy">表1 </strong>。用于训练深度学习模型的服装图像数据集综述。</p></figure><p id="07ca" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated">要使用Python查看图像，我们可以使用<code class="fe oz pa pb pc b">matplotlib.pyplot.gcf()</code>类来获取当前图形，并将其设置为特定的行数和列数。因此，在每一行和每一列，我们可以把一个图像作为一个支线剧情。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pd pe l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="ak">图一</strong>。10个类别中每个类别的图像数据集样本。</p></figure><h2 id="bb34" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">B.2 .建立模型</h2><p id="3771" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">我们将使用<strong class="mf ir">迁移学习</strong>方法和<strong class="mf ir">图像增强</strong>来构建深度学习模型，以实现良好的性能并防止过拟合。我们使用的预训练模型是<strong class="mf ir"> InceptionV3 </strong>，但是也可以随意尝试另一个模型。TensorFlow Keras为<code class="fe oz pa pb pc b">InceptionV3</code>内置了一个<strong class="mf ir">模型定义</strong>。我们将使用(150，150，3)作为所需的输入形状图像，不包括顶部的全连通层，并使用我们可以在此下载<a class="ae kv" href="https://storage.googleapis.com/mledu-datasets/inception_v3_weights_tf_dim_ordering_tf_kernels_notop.h5" rel="noopener ugc nofollow" target="_blank"><strong class="mf ir"/></a><strong class="mf ir">【3】</strong>的局部权重。导入该类，并通过指定上述配置实例化它，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pd pe l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="ak">图二。</strong>定义预训练的InceptionV3模型。</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pd pe l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="ak">图三。</strong>预训练模型的总结。</p></figure><p id="95a5" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated">正如我们所看到的，每一层都有自己的名称，其中最后一层的名称是<strong class="mf ir"> mixed10 </strong>，它已经被卷积为3乘3。有趣的是，我们可以决定向上移动最后一层，以使用更多一点的信息。例如，<strong class="mf ir">混合7 </strong>，输出7乘7。因此，可以根据我们的需要选择最后一层进行实验。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pd pe l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="ak">图四。</strong>根据我们的需求选择预训练模型的最后一层。</p></figure><p id="9d6a" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated">我们将定义一个新的模型，该模型考虑了InceptionV3的<strong class="mf ir"> pre_trained_model </strong>来对服装图像进行10个不同类别的分类。在这里，我们可以为新模型构建最后几层，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pd pe l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="ak">图五。</strong>使用迁移学习为我们的目标重新构建预训练模型。</p></figure><h2 id="e914" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">B.3 .训练模型</h2><p id="ca6a" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">现在，我们准备训练模型。请注意，我们通过将图像像素值除以255来标准化它们，在<em class="ob"> ImageDataGenerator </em>中设置几个参数来增加用于训练的输入图像以防止过度拟合，将batch_size设置为32，并将目标图像大小设置为(150，150)以适应模型输入形状。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pd pe l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="ak">图6 </strong>。使用100个时期的图像增强来训练模型</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pd pe l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="ak">图7。</strong>在训练过程中想象模特的表现。</p></figure><p id="97d3" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated">恭喜你。我们只是利用迁移学习和图像增强建立了一个强大的深度学习模型。我们实现了90.59%的测试准确率和0.273%的测试损失，并设法避免过度拟合。其实我们的测试准确率比训练准确率高~5%，很棒！</p><h2 id="4e5f" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">B.4 .评估模型</h2><p id="6d9d" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">让我们通过对看不见的图像进行新的预测来验证这个模型。正如我们所料，该模型在对每张测试图像做出正确预测方面表现得非常好。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pd pe l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="ak">图8。</strong>使用训练好的模型预测新图像</p></figure><h1 id="880c" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">C.模型转换</h1><p id="844e" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">在我们使用TensorFlow构建模型后，我们很快就会注意到文件大小太大，并且没有针对部署进行优化，尤其是在移动或边缘设备上。这就是tensor flow Lite(TF Lite)发挥作用的地方。TFLite将帮助我们将模型转换成更有效的格式。<strong class="mf ir"> tflite。</strong>这将生成<strong class="mf ir"> </strong>一个小的二进制大小的模型，它是轻量级的，低延迟的，对准确性影响很小。</p><h2 id="ca75" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">C.1 .转换模型</h2><p id="691d" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">下面是我们需要做的步骤，以便将我们的最佳训练模型转换为tflite文件:</p><ul class=""><li id="d999" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated">在h5文件中加载模型，</li><li id="eb5e" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">从加载的训练模型中实例化TFLiteConverter对象，</li><li id="e77a" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">转换并以tflite文件格式保存转换后的模型。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pd pe l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="ak">图九。</strong>使用TensorFlow Lite转换模型</p></figure><h2 id="76d0" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">C.2 .使用转换的模型</h2><p id="8cb0" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">一旦我们将模型转换为tflite文件格式，我们就可以使用TFLite解释器来查看模型在移动或边缘设备上部署之前如何进行预测。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pd pe l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pd pe l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="ak">图10。</strong>使用TFLite解释器进行预测</p></figure><h1 id="1d27" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">D.模型部署</h1><p id="4f0b" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">在最后一步，我们将使用Docker、AWS Lambda和AWS API Gateway部署模型。首先，我们需要创建一个<code class="fe oz pa pb pc b">lambda_function.py</code>来在AWS Lambda或Docker上部署模型，因为这两个选项都需要这个文件来运行深度学习模型。</p><h2 id="d45a" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">D.1函数</h2><p id="8e76" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated"><code class="fe oz pa pb pc b">lambda_function.py</code>存储运行应用程序所需的所有函数，从定义解释器开始，接收输入图像，预处理图像，并使用保存的模型进行预测。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pd pe l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="ak">图11。</strong>λ_ function . py</p></figure><h2 id="e30c" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">D.2 .使用Docker在本地部署</h2><p id="5978" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">我们刚刚创造了<code class="fe oz pa pb pc b">lambda_fucntion.py</code>。接下来，我们希望使用AWS Lambda来获取和部署它。为此，我们将使用Docker。AWS Lambda支持docker，所以我们可以使用容器映像来部署我们的功能。</p><p id="1e1b" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated">在本节中，您将学习如何在您的机器中使用Docker来本地运行模型。</p><h2 id="f292" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated"><strong class="ak"> D.2.1 .文档文件</strong></h2><p id="058a" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">下一步是创建Dockerfile文件。<strong class="mf ir"> Dockerfile </strong>是一种将运行代码所需的所有依赖项放入包含所有内容的单一映像中的方法。<strong class="mf ir">Docker镜像</strong>是一个专用于你的容器的私有文件系统。它提供了容器需要的所有文件和代码，例如:</p><ul class=""><li id="39a9" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated">安装python包管理系统。</li><li id="9616" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">安装枕头库处理图像文件。</li><li id="4d6d" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">安装TensorFlow Lite tflite_runtime解释器。</li><li id="8ae6" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">在tflite文件中获取我们的模型，并将其复制到docker图像中。</li><li id="d538" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">获取lambda_function.py并将其复制到docker映像中。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pd pe l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="ak">图12。</strong> Dockerfile</p></figure><p id="6e87" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated">我们现在需要做的是运行并构建这个docker映像，并在本地运行它。</p><h2 id="bec5" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">D.2.2 .建立Docker形象</h2><p id="b961" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">以下是我们在本地运行应用程序的步骤:</p><p id="e33d" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated"><strong class="mf ir">运行docker守护进程</strong>。有两种方法可以做到这一点:</p><ul class=""><li id="bde7" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated">第一种选择是以<strong class="mf ir">管理员</strong>的身份打开<strong class="mf ir"> cmd </strong>，然后启动以下命令:<code class="fe oz pa pb pc b">"C:\Program Files\Docker\Docker\DockerCli.exe" -SwitchDaemon</code></li><li id="0257" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">第二个选项是从开始菜单运行<strong class="mf ir"> Docker桌面</strong>并验证Docker是否处于<strong class="mf ir">运行</strong>状态。</li></ul><p id="fb05" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated">从Dockerfile文件构建一个图像。</p><ul class=""><li id="2c6f" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated">下面的命令将从您当前所在的文件夹的内容构建图像，标记名为<code class="fe oz pa pb pc b">tf-lite-lambda</code>。</li></ul><pre class="kg kh ki kj gt pf pc pg ph aw pi bi"><span id="588b" class="lo kx iq pc b gy pj pk l pl pm">$ docker build -t tf-lite-lambda .</span></pre><h2 id="2bd3" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">运行容器映像</h2><p id="c59b" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated"><strong class="mf ir">根据您在上一步</strong>中构建的映像启动一个容器。运行容器会使用私有资源启动应用程序，并与机器的其他部分安全隔离。</p><pre class="kg kh ki kj gt pf pc pg ph aw pi bi"><span id="43ca" class="lo kx iq pc b gy pj pk l pl pm">$ docker run --rm -p 8080:8080 --name clothes-classifier tf-lite-lambda</span></pre><ul class=""><li id="a4f1" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated"><code class="fe oz pa pb pc b">-p</code>(代表<em class="ob">发布</em>)表示我们想要将容器端口80映射到主机端口80。容器在端口80上打开一个web服务器，我们可以将计算机上的端口映射到容器公开的端口。</li><li id="644d" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated"><code class="fe oz pa pb pc b">--rm</code>(代表<em class="ob">移除</em>)表示当容器存在时，我们希望自动移除容器。</li><li id="fca6" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated"><code class="fe oz pa pb pc b">--name</code>给一个新容器命名，<code class="fe oz pa pb pc b">tf-lite-lambda</code>是我们用来创建容器的图像名。</li></ul><p id="1810" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated">以下是之前命令的结果截图:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pn"><img src="../Images/3e628a8d1b56cc56c1a49f2c4ff1b942.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dlmjJ6Un4-VpeBqy.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd oy">图13。</strong>构建并运行Docker容器映像</p></figure><h2 id="7346" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">D.2.3 .测试容器图像</h2><p id="37eb" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">在我们运行模型之后，我们想要测试它。我们需要创建一个特殊的文件，我们可以调用它来查看模型预测的结果。</p><p id="9bee" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated">该文件包含:</p><ul class=""><li id="06fa" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated">来自预期输入图像的完整类别。</li><li id="ebd9" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">从此链接获得的一张裤子(测试)图片:<a class="ae kv" href="http://bit.ly/mlbookcamp-pants" rel="noopener ugc nofollow" target="_blank">http://bit.ly/mlbookcamp-pants</a>。我们将发送一个请求，其中有一个键<code class="fe oz pa pb pc b">url</code>和图像的URL。</li><li id="8f76" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">一个URL地址，表明我们部署在docker内部的本地主机上。</li><li id="c37b" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">向目标URL地址发送POST请求以获得预测结果的过程。</li><li id="70c1" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">解析预测结果并显示给用户。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pd pe l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="ak">图14。</strong> test.py</p></figure><p id="338a" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated">在您的CLI上运行<code class="fe oz pa pb pc b">test.py</code>，亲自查看结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi po"><img src="../Images/e304b5c1dd5684d60c1b3d4315d20a29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mvX-CojE7UuElkg-.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd oy">图15。</strong>运行test.py，通过Docker容器进行预测</p></figure><h2 id="85de" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">D.3 .在AWS上部署</h2><p id="563d" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">我们刚刚用Docker在本地部署了模型。现在，我们可以使用相同的容器并将其部署在AWS上。AWS拥有您在线部署深度学习模型所需的一切。对于这种情况，我们将使用AWS CLI、AWS ECR、AWS Lambda和AWS API Gateway。</p><h2 id="73d3" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">D.3.1 .安装AWS CLI</h2><p id="16db" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">我们用AWS做的一切都是API调用。因此，我们必须有一个工具，允许我们对这些API调用进行编程或编写脚本。其中一个工具是AWS命令行界面(CLI)。在我们继续之前，请确保您已经在本地机器上安装了AWS CLI[4]。</p><h2 id="01d7" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">D.3.2 .配置您的AWS帐户</h2><p id="48ee" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">如果我们想在AWS上部署应用程序，显然我们需要在那里设置一个帐户。创建AWS IAM用户帐户后，设置访问密钥ID、秘密访问密钥、默认区域和默认输出格式(通常是JSON)。一旦我们完成了这些，我们就可以从AWS CLI对AWS进行编程调用。</p><pre class="kg kh ki kj gt pf pc pg ph aw pi bi"><span id="54c4" class="lo kx iq pc b gy pj pk l pl pm">$ aws configure</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pp"><img src="../Images/6ab1386c9ea6b34df11c5d068c7ae1f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pu6HW3hsshLJo9lE.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd oy">图16。</strong>通过AWS CLI配置AWS帐户</p></figure><h2 id="3d91" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">D.3.3 .在AWS ECR(弹性容器注册)中创建回购</h2><p id="a195" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">AWS ECR是我们放Docker图片的地方。通过运行以下命令，我们将创建一个私有存储库来存储我们之前构建的Docker映像。</p><pre class="kg kh ki kj gt pf pc pg ph aw pi bi"><span id="df98" class="lo kx iq pc b gy pj pk l pl pm"><strong class="pc ir">$</strong> aws ecr create-repository --repository-name lambda-images</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pq"><img src="../Images/d11631507ea29d9840ffcd94a63d27e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5-wkA0ZavswOjd0lnLM2YA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd oy">图17。通过AWS CLI在AWS ECR中创建新的存储库</strong></p></figure><h2 id="d2ab" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">D.3.4 .向回购发布图像</h2><p id="57d8" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">现在，我们想发布我们在本地构建的图像。以下是直接引用自AWS的步骤(AWS ECR &gt;存储库&gt; lambda-images &gt;查看推送命令):</p><ul class=""><li id="9c83" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated">检索一个认证令牌，并向您的注册表认证您的Docker客户端。</li></ul><pre class="kg kh ki kj gt pf pc pg ph aw pi bi"><span id="734d" class="lo kx iq pc b gy pj pk l pl pm">$ aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin XXXXXXXXX474.dkr.ecr.us-east-1.amazonaws.com</span></pre><ul class=""><li id="3702" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated">使用以下命令构建Docker映像。</li></ul><pre class="kg kh ki kj gt pf pc pg ph aw pi bi"><span id="edef" class="lo kx iq pc b gy pj pk l pl pm">$ docker build -t lambda-images .</span></pre><ul class=""><li id="f483" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated">标记您的图像，以便您可以将图像推送到此存储库。</li></ul><pre class="kg kh ki kj gt pf pc pg ph aw pi bi"><span id="c59d" class="lo kx iq pc b gy pj pk l pl pm">$ docker tag tf-lite-lambda XXXXXXXXX474.dkr.ecr.us-east-1.amazonaws.com/lambda-images:tf-lite-lambda</span></pre><ul class=""><li id="8be3" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated">运行以下命令，将这个映像推送到您新创建的AWS存储库。</li></ul><pre class="kg kh ki kj gt pf pc pg ph aw pi bi"><span id="6e24" class="lo kx iq pc b gy pj pk l pl pm">$ docker push XXXXXXXXX474.dkr.ecr.us-east-1.amazonaws.com/lambda-images:tf-lite-lambda</span></pre><p id="7ab5" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated">检查AWS ECR网页上的推送图像。确保复制URI，因为我们需要它来创建一个Lambda函数。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pr"><img src="../Images/c62aa7d2616761655213fdee2a4074d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*d0OndygMTuo0Aa3b.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd oy">图18。</strong>复制推送图像的URI，创建lambda函数</p></figure><h2 id="20bf" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">D.3.5 .创建λ函数</h2><p id="4617" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">现在，我们准备创建一个Lambda函数。进入AWS <code class="fe oz pa pb pc b">Lambda</code>并点击<code class="fe oz pa pb pc b">Create function</code>。选择<code class="fe oz pa pb pc b">Container Image</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ps"><img src="../Images/9490d7ecd50ce7f47a0e95324cb553ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9gWaIZ95d8zMPsqo.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd oy">图19。</strong>通过AWS Lambda创建Lambda函数</p></figure><p id="9c46" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated">为您的函数取一个惟一的名称，并用您之前复制的图像URL填充容器图像URL。通过将一切保留为默认，点击<code class="fe oz pa pb pc b">Create function</code></p><p id="7cad" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated">您刚刚为预测任务创建了一个lambda函数。然而，目前的配置并没有给我们足够的内存和超时。我们有一个大模型，该功能将需要一些时间来运行，并首次将所有内容加载到内存中。因此，我们需要重新配置它。进入<code class="fe oz pa pb pc b">Configuration</code> &gt; <code class="fe oz pa pb pc b">General Configuration</code> &gt;点击<code class="fe oz pa pb pc b">Edit</code>，将RAM和超时分别设置为<strong class="mf ir"> 512/1024 </strong>和<strong class="mf ir"> 30 </strong>秒。省省吧。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pt"><img src="../Images/3c1ba35b1756e9ef57e1846b5f83571b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*z81uCnH8chK-kC-p.jpg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd oy">图20。</strong>重新配置lambda功能的内存和超时</p></figure><h2 id="2d50" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">D.3.6 .测试λ功能</h2><p id="8afc" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">接下来，使用以下JSON文件格式创建一个测试:</p><pre class="kg kh ki kj gt pf pc pg ph aw pi bi"><span id="590d" class="lo kx iq pc b gy pj pk l pl pm">{<br/>    "url": "https://tinyurl.com/clothes-t-shirt"<br/>}</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pu"><img src="../Images/fe0e711fbbeb34ef63534050bd4176a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TaPEP2djAh3GaVyX.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd oy">图21。</strong>测试我们刚刚创建的Lambda函数</p></figure><p id="6b35" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated">为新事件命名，保存后点击<code class="fe oz pa pb pc b">Test</code>。然后，您将看到以下结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pv"><img src="../Images/e28336f4abd07ae78b338d98de1782c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tVkigdRb1ncRVSoj.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd oy">图22。</strong>进行预测时lambda函数的执行结果</p></figure><p id="9279" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated">你需要知道的一件事是，使用AWS Lambda，你将根据请求的数量和持续时间，也就是执行我们的代码所花费的时间来收费。请参考此<a class="ae kv" href="https://jovian.ai/outlink?url=https%3A%2F%2Faws.amazon.com%2Flambda%2Fpricing%2F" rel="noopener ugc nofollow" target="_blank">链接</a>了解更多定价信息。</p><h2 id="b13b" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">D.3.7. API网关集成</h2><p id="3dd4" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">您刚刚测试了该函数，它在进行预测时似乎工作得很好。剩下的就是从外面(网上)用了。为此，我们需要通过AWS API Gateway创建一个API。</p><p id="3786" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated"><strong class="mf ir"> 1。创建新的API </strong></p><ul class=""><li id="7b40" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated">访问AWS API网关，然后点击<code class="fe oz pa pb pc b">Build</code>按钮选择REST API。</li><li id="c83d" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">选择协议:<code class="fe oz pa pb pc b">REST</code>。为<strong class="mf ir">选择新API，创建新API </strong>。然后，填写API名称并添加一些描述。</li></ul><div class="kg kh ki kj gt ab cb"><figure class="pw kk px py pz qa qb paragraph-image"><img src="../Images/6704fc575b4f861fadaa473564290609.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/0*NAZEdBkw6EE9sZMB.jpg"/></figure><figure class="pw kk qc py pz qa qb paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/b825cdc27aa794b4366a79aa93d738d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/0*a2MoqT7uxylj2cY6.jpg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk qd di qe qf translated"><strong class="bd oy">图23。</strong>通过AWS API网关为我们的应用程序构建新的API</p></figure></div><p id="67cc" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated"><strong class="mf ir"> 2。创建资源:预测和方法帖子</strong></p><ul class=""><li id="c807" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated">从<code class="fe oz pa pb pc b">Actions</code>中选择制作资源&gt;填写“预测”。</li><li id="6076" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">从<code class="fe oz pa pb pc b">Actions</code>中选择制作方法&gt;选择<code class="fe oz pa pb pc b">POST</code></li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi qg"><img src="../Images/716f1aafa5769c20735178f2cf22cde8.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/0*_JQuJaobUDxCOU8-.jpg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd oy">图24。</strong>为新的API创建新的资源和方法</p></figure><p id="395e" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated"><strong class="mf ir"> 3。选择Lambda函数，添加一些细节</strong>。</p><ul class=""><li id="d2bd" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated">点击<code class="fe oz pa pb pc b">POST</code>，然后确保为<strong class="mf ir"> Lambda函数</strong>写下正确的名称，并保留默认设置。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi qh"><img src="../Images/58e562633352fd052fd943267006940b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/0*hFQCs51Cp6cuss2V.jpg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd oy">图25。</strong>将Lambda函数集成到作为触发器的API中</p></figure><p id="a3ad" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated"><strong class="mf ir"> 4。测试API </strong>。</p><ul class=""><li id="6538" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated">从流程图执行中，点击<code class="fe oz pa pb pc b">Test</code>。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi qi"><img src="../Images/e4f432a2aa450d6e354cbe3d1803ed1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*I-qSR-zSM0rIIbLT.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd oy">图26。</strong>客户端请求和lambda函数通过API的执行流程图</p></figure><ul class=""><li id="0cbc" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated">要测试它，在<strong class="mf ir">请求体中输入代码。</strong>点击<strong class="mf ir">测试。</strong>然后，我们应该在<strong class="mf ir">响应体中看到结果。</strong></li></ul><div class="kg kh ki kj gt ab cb"><figure class="pw kk qj py pz qa qb paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/7b043257cf596fdace1da68cd59c5b90.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/0*cGBjO0aPjpa3xDqU.jpg"/></div></figure><figure class="pw kk qk py pz qa qb paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/9779168ef59a463c8c5fa07b834086d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/0*9E0yEYNxQhJudkDn.jpg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk ql di qm qf translated"><strong class="bd oy">图27。</strong>测试模拟客户端和lambda函数之间做出的预测</p></figure></div><p id="8ac7" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated"><strong class="mf ir"> 5。部署API </strong></p><ul class=""><li id="f345" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated">最后，我们需要部署API以在外部使用它。从<code class="fe oz pa pb pc b">Actions</code>点击<code class="fe oz pa pb pc b">DEPLOY API</code>。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi qn"><img src="../Images/2d3150952a867b4a2cffdad1a07d8961.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/0*xCQVkOP4P2PXdLX_.jpg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd oy">图28。</strong>部署API</p></figure><ul class=""><li id="5e6c" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated">从“调用URL”部分获取URL。在这种情况下，我们有:<a class="ae kv" href="https://xw2bv0y8mb.execute-api.us-east-1.amazonaws.com/test" rel="noopener ugc nofollow" target="_blank"><strong class="mf ir"/></a></li><li id="fa7a" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">打开<strong class="mf ir">邮差App </strong>或者去<a class="ae kv" href="https://reqbin.com" rel="noopener ugc nofollow" target="_blank"> <strong class="mf ir"> reqbin </strong> </a>测试我们刚刚创建的REST API。注意，因为我们指定<code class="fe oz pa pb pc b">predict</code>作为<code class="fe oz pa pb pc b">POST</code>的方法，我们需要在URL的末尾添加<code class="fe oz pa pb pc b">/predict</code>。因此，进行API调用以进行预测的完整URL是:<a class="ae kv" href="https://xw2bv0y8mb.execute-api.us-east-1.amazonaws.com/test/predict" rel="noopener ugc nofollow" target="_blank"><strong class="mf ir">https://xw 2 bv 0 y8 MB . execute-API . us-east-1 . amazonaws . com/test/predict</strong></a></li><li id="9e36" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">将链接复制并粘贴到应用程序的URL部分。</li><li id="6f29" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">复制JSON中的以下对象作为主体来发出这个POST请求。点击<code class="fe oz pa pb pc b">Send</code>。</li></ul><pre class="kg kh ki kj gt pf pc pg ph aw pi bi"><span id="f5b9" class="lo kx iq pc b gy pj pk l pl pm">{<br/>    "url": "https://tinyurl.com/clothes-t-shirt"<br/>}</span></pre><ul class=""><li id="3e83" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated">在发出API call POST请求后，您可以看到预测结果作为接收到的内容。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi qo"><img src="../Images/03cc7f1beef90265a5cbb65b6c60665d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dNHqm0x3MlUBicI7.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd oy">图29。</strong>通过<strong class="bd oy"> reqbin </strong>调用API进行预测</p></figure><ul class=""><li id="820f" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated">或者，我们可以使用<code class="fe oz pa pb pc b">cURL</code>(代表客户端URL)通过终端(即Git Bash)将POST请求中的数据(在本例中是t恤图像)发送到我们的服务(在本例中是衣服图像分类器)。</li></ul><pre class="kg kh ki kj gt pf pc pg ph aw pi bi"><span id="db76" class="lo kx iq pc b gy pj pk l pl pm">$ curl -d '{"url": "https://tinyurl.com/clothes-t-shirt"}' -H "Content-Type: application/json" -X POST <a class="ae kv" href="https://xw2bv0y8mb.execute-api.us-east-1.amazonaws.com/test/predict" rel="noopener ugc nofollow" target="_blank">https://xw2bv0y8mb.execute-api.us-east-1.amazonaws.com/test/predict</a></span></pre><ul class=""><li id="3bda" class="nk nl iq mf b mg nf mj ng lt nm lw nn lz no mv np nq nr ns bi translated">运行上面的命令将生成这个预测结果:</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi qp"><img src="../Images/50553de9ee9d1cd1d86c0822a77e0c80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/0*Xfx9ZetLnXWQmV5C.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd oy">图30。</strong>通过<strong class="bd oy"> Git Bash </strong>通过API调用进行预测</p></figure><blockquote class="oc"><p id="9a31" class="od oe iq bd of og oh oi oj ok ol mv dk translated">恭喜你。现在，您的深度学习模型完全在线，并准备好帮助世界变得更美好！</p></blockquote><h1 id="449f" class="kw kx iq bd ky kz la lb lc ld le lf lg jw qq jx li jz qr ka lk kc qs kd lm ln bi translated">E.结论</h1><p id="cb55" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">由于要遵循许多程序，进行端到端深度学习项目可能具有挑战性。然而，由于TensorFlow的丰富特性，我们可以轻松地构建和部署模型。Docker和AWS等服务的存在有助于数据科学家快速离线或在线交付应用程序，以解决业务问题。</p><p id="db88" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated">以无服务器的衣服图像分类器为例，我希望这个项目给你一个基本的想法，如何在未来处理类似的情况。继续激励！</p><p id="f543" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated">谢谢你，</p><p id="d38f" class="pw-post-body-paragraph md me iq mf b mg nf jr mi mj ng ju ml lt nh mn mo lw ni mq mr lz nj mt mu mv ij bi translated">diardano Raihan<br/><a class="ae kv" href="https://www.linkedin.com/in/diardanoraihan/" rel="noopener ugc nofollow" target="_blank">LinkedIn简介</a></p><blockquote class="om on oo"><p id="ac82" class="md me ob mf b mg nf jr mi mj ng ju ml or nh mn mo ot ni mq mr ov nj mt mu mv ij bi translated"><strong class="mf ir"> <em class="iq">注</em> </strong> <em class="iq">:你看到的一切都记载在</em> <a class="ae kv" href="https://github.com/diardanoraihan/E2E_Deep_Learning" rel="noopener ugc nofollow" target="_blank"> <strong class="mf ir"> <em class="iq">我的GitHub资源库</em> </strong> <em class="iq">里。</em> </a> <em class="iq"> <br/>对于对完整代码感到好奇的人，请务必访问👍。</em></p></blockquote></div><div class="ab cl qt qu hu qv" role="separator"><span class="qw bw bk qx qy qz"/><span class="qw bw bk qx qy qz"/><span class="qw bw bk qx qy"/></div><div class="ij ik il im in"><h1 id="87e2" class="kw kx iq bd ky kz ra lb lc ld rb lf lg jw rc jx li jz rd ka lk kc re kd lm ln bi translated">参考</h1><ul class=""><li id="32a3" class="nk nl iq mf b mg mh mj mk lt ny lw nz lz oa mv np nq nr ns bi translated">[1] T. Soam，《在窗口10上安装Docker》，<em class="ob"> Medium </em>，<a class="ae kv" href="https://medium.com/@tushar0618/installing-docker-desktop-on-window-10-501e594fc5eb" rel="noopener">https://Medium . com/@ tushar 0618/Installing-Docker-desktop-on-Window-10-501 e 594 fc 5 EB</a>，2021年6月。</li><li id="4d0e" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">[2] A .格里戈里耶夫，《服装数据集(子集)》，<em class="ob"> GitHub </em>，<a class="ae kv" href="https://github.com/alexeygrigorev/clothing-dataset-small" rel="noopener ugc nofollow" target="_blank">https://github.com/alexeygrigorev/clothing-dataset-small</a>，2021年6月。</li><li id="e2ba" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">[3] <em class="ob">机器学习Edu </em>，<a class="ae kv" href="https://storage.googleapis.com/mledu-datasets/inception_v3_weights_tf_dim_ordering_tf_kernels_notop.h5" rel="noopener ugc nofollow" target="_blank">https://storage . Google APIs . com/mledu-datasets/inception _ v3 _ weights _ TF _ dim _ ordering _ TF _ kernels _ notop . H5</a>，2021年6月。</li><li id="4289" class="nk nl iq mf b mg nt mj nu lt nv lw nw lz nx mv np nq nr ns bi translated">[4]“在Windows上安装、更新和卸载AWS CLI版本2”，<em class="ob">亚马逊Web服务(AWS) </em>，<a class="ae kv" href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-windows.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/CLI/latest/user guide/install-CLI v2-Windows . html</a>，2021年6月。</li></ul></div></div>    
</body>
</html>