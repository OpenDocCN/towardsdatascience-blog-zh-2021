<html>
<head>
<title>Logging TensorFlow(Keras) metrics to Azure ML Studio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将张量流(Keras)度量记录到Azure ML Studio</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/logging-tensorflow-keras-metrics-to-azure-ml-studio-in-realtime-14504a01cad8?source=collection_archive---------17-----------------------#2021-06-26">https://towardsdatascience.com/logging-tensorflow-keras-metrics-to-azure-ml-studio-in-realtime-14504a01cad8?source=collection_archive---------17-----------------------#2021-06-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="79f4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用自定义Keras回调的实时方法。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7c71b5b6ffac422ebefbca869843017f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xeA3dNh0sgbKtiFfT28vkA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="27a7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在Azure的机器学习工作室上训练一个TensorFlow/Keras模型可以节省很多时间，尤其是在你没有自己的GPU或者数据集很大的情况下。似乎应该有一种简单的方法可以在Azure ML Studio的仪表盘中跟踪你的训练指标。嗯，有！它只需要一个简短的自定义Keras回调。</p><p id="4325" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你是在Azure上训练TensorFlow模型的新手，可以看看我的文章“<a class="ae lu" rel="noopener" target="_blank" href="/train-on-cloud-gpus-with-azure-machine-learning-sdk-for-python-967c99418df1?source=your_stories_page-------------------------------------">使用Azure Machine Learning SDK for Python在云GPU上训练</a>”它从头开始，从头实施整个培训工作流程。然而，这篇文章假设你了解基础知识，并将只关注将你的指标记录到Azure的必要工具。</p><p id="3efb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在该项目的GitHub资源库的<code class="fe lv lw lx ly b">examples</code>文件夹中有一个工作代码示例，演示了本文中的工具。回调本身在<code class="fe lv lw lx ly b">log_to_azure.py</code>文件中。</p><div class="lz ma gp gr mb mc"><a href="https://github.com/benbogart/azure-tensorflow-callback" rel="noopener  ugc nofollow" target="_blank"><div class="md ab fo"><div class="me ab mf cl cj mg"><h2 class="bd iu gy z fp mh fr fs mi fu fw is bi translated">本博加特/azure-tensor flow-回调</h2><div class="mj l"><h3 class="bd b gy z fp mh fr fs mi fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mk l"><p class="bd b dl z fp mh fr fs mi fu fw dk translated">github.com</p></div></div><div class="ml l"><div class="mm l mn mo mp ml mq ks mc"/></div></div></a></div><h1 id="5b93" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">azureml.core.Run对象</h1><p id="3b5e" class="pw-post-body-paragraph ky kz it la b lb nj ju ld le nk jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">在查看回调之前，您需要一个<code class="fe lv lw lx ly b">azureml.core.Run</code>对象来告诉您的回调在哪里记录指标。从azure训练脚本中获取Run对象非常简单。下面的代码完成了这个任务。</p><pre class="kj kk kl km gt no ly np nq aw nr bi"><span id="2581" class="ns ms it ly b gy nt nu l nv nw">from azureml.core import Run<br/>run = Run.get_context()</span></pre><p id="4329" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这只有在模型运行在azure上时才有效。如果你在本地运行你的脚本，你会得到一个错误。</p><h1 id="aa1b" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">回电</h1><p id="cbc8" class="pw-post-body-paragraph ky kz it la b lb nj ju ld le nk jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">剩下的就是实现一个简单的Keras回调，在每个训练期结束时将我们的指标记录到Azure ML Studio。这种方法几乎等同于使用TensorBoard回调来存储TensorBoard的日志文件，只有一个例外:您需要传入一个<code class="fe lv lw lx ly b">azureml.core.Run</code>对象，该对象告诉我们的类将日志发送到哪里。幸运的是，你已经从上面的部分！</p><p id="db1c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我帮你写了回电😁。在这里。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><h1 id="dbc2" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">履行</h1><p id="360b" class="pw-post-body-paragraph ky kz it la b lb nj ju ld le nk jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">像任何其他Keras回调一样实现回调。</p><ol class=""><li id="3381" class="nz oa it la b lb lc le lf lh ob ll oc lp od lt oe of og oh bi translated">首先下载log_to_azure.py文件到你的<code class="fe lv lw lx ly b">training_script</code>目录。</li><li id="00d4" class="nz oa it la b lb oi le oj lh ok ll ol lp om lt oe of og oh bi translated">导入<code class="fe lv lw lx ly b">LogToAzure</code>回调类。</li><li id="33f5" class="nz oa it la b lb oi le oj lh ok ll ol lp om lt oe of og oh bi translated">将LogToAzure回调添加到您的培训脚本中。</li></ol><pre class="kj kk kl km gt no ly np nq aw nr bi"><span id="3f39" class="ns ms it ly b gy nt nu l nv nw">from log_to_azure import LogToAzure</span><span id="6844" class="ns ms it ly b gy on nu l nv nw">...</span><span id="e615" class="ns ms it ly b gy on nu l nv nw"># add LogToAure custom Callback<br/>callbacks = [LogToAzure(run)]</span><span id="6a5c" class="ns ms it ly b gy on nu l nv nw"># fit model and store history<br/>model.fit(train_generator, <br/>          validation_data=val_generator,<br/>          callbacks=callbacks,<br/>          epochs=10)</span></pre><h1 id="0044" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">在Azure ML Studio中查看指标</h1><p id="bab5" class="pw-post-body-paragraph ky kz it la b lb nj ju ld le nk jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">现在，当您运行您的模型时，您的指标将被记录到Azure ML Studio中。最后一步是在<em class="oo">实验仪表板</em>中设置您的“图表”,以便您可以可视化指标。</p><p id="4ca9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您发送到Azure的指标在至少记录一次后才能在图表中使用，因此您<strong class="la iu">必须等到第一个纪元完成</strong>后才能执行以下操作。</p><ul class=""><li id="f3c5" class="nz oa it la b lb lc le lf lh ob ll oc lp od lt op of og oh bi translated">转到您的实验页面。我们称我们的实验为<code class="fe lv lw lx ly b">recycling</code>。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/18654f2d4191bd939cc27b0062627cc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pVx6BZFMLLxdkhSeC1_Jyg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><ul class=""><li id="5948" class="nz oa it la b lb lc le lf lh ob ll oc lp od lt op of og oh bi translated">您可以从编辑实验仪表板上已经存在的图表开始。单击图表右上角的铅笔图标。</li><li id="92d5" class="nz oa it la b lb oi le oj lh ok ll ol lp om lt op of og oh bi translated">当然，你可以以任何对你有用的方式修改图表。但是我想在同一张图表上看到培训和验证的准确性，所以我将选择y轴上的那些指标，如下所示。可以把<code class="fe lv lw lx ly b">iterations</code>留在X轴上。如果您愿意，可以给图表取一个聪明的名字。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/caee94ca900505066d3f5e2fdd163a03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uGcwNOzpfcKhnfqCX9TeMg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><ul class=""><li id="5247" class="nz oa it la b lb lc le lf lh ob ll oc lp od lt op of og oh bi translated">编辑完现有图表后，您可以在页面顶部添加一个带有<code class="fe lv lw lx ly b">Add chart</code>图标的新图表。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/497f3956b149d2427390c9d228f3b71f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yYPZ8dtgKPMSYPxA7VLcPQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="056b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，<strong class="la iu">不要忘记保存视图。</strong>如果不保存视图，下次查看页面时，您必须重新设置图表。点击<code class="fe lv lw lx ly b">Save view.</code>保存到默认视图</p><h1 id="3911" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">结论</h1><p id="c875" class="pw-post-body-paragraph ky kz it la b lb nj ju ld le nk jx lg lh nl lj lk ll nm ln lo lp nn lr ls lt im bi translated">就是这样。现在你可以在azure上实时跟踪和比较你的模型的训练进度。它看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7c71b5b6ffac422ebefbca869843017f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xeA3dNh0sgbKtiFfT28vkA.png"/></div></div></figure><p id="d362" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你需要帮助来开始在Azure上训练你的模型，可以看看我的另一篇文章:“<a class="ae lu" rel="noopener" target="_blank" href="/train-on-cloud-gpus-with-azure-machine-learning-sdk-for-python-967c99418df1?source=your_stories_page-------------------------------------">使用Azure Machine Learning SDK for Python</a>在云GPU上训练。”</p><p id="42a6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在去做点好事吧。</p></div></div>    
</body>
</html>