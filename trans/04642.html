<html>
<head>
<title>When and how to use power transform in machine learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">机器学习中何时以及如何使用幂变换</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/when-and-how-to-use-power-transform-in-machine-learning-2c6ad75fb72e?source=collection_archive---------24-----------------------#2021-04-21">https://towardsdatascience.com/when-and-how-to-use-power-transform-in-machine-learning-2c6ad75fb72e?source=collection_archive---------24-----------------------#2021-04-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bec7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们看看这个强大的数据预处理工具</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/abd40b1d4c725228c348a5da9629b1de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/0*eD7Z19pUDcHV9SaI.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="27de" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">专业数据科学家知道，在向任何模型提供数据之前，必须准备好数据。数据预处理可能是机器学习管道中最重要的部分，其重要性有时被低估了。</p><p id="04ce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">幂变换是一组在某些情况下非常有用的变换。让我们看看什么时候。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="b98e" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">什么是电力转换？</h1><p id="8ced" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">Power transfom是一系列使用幂定律转换数据的函数。我们的想法是对数据集的每个要素应用变换。</p><p id="9b02" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">电源转换的目的是什么？想法是增加特征分布的对称性。如果特征不对称，应用幂变换将使其更加对称。</p><p id="e9e4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们看一个使用scikit-learn中的<em class="mu">乳腺癌数据集</em>的例子。如果我们绘制前6个特征的直方图，我们会发现它们非常不对称。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/2dcc6c887d774db8c59eb17996ac02c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/0*c0_3q3Okq3bJRdL0.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="86c9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果特征不对称，某些模型可能无法正常工作。例如，如果分布是偏斜的，基于距离的模型如KNN或K-means可能会失败。为了使这些模型起作用，幂变换将使特征对称化，而不会过多地影响它们的预测能力。</p><h1 id="a801" class="lx ly it bd lz ma mw mc md me mx mg mh jz my ka mj kc mz kd ml kf na kg mn mo bi translated">一些能量转换</h1><p id="e776" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">最常见的幂变换是Box-Cox和Yeo-Johnson变换。</p><p id="e120" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Box-Cox变换有这样的公式:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/ed05742ee62858680b255a0a57bcba4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*vOE-1a-yqqCeD80cMAfSgg.png"/></div></figure><p id="0671" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如您所见，我们有一个λ参数，可以使用最大似然法进行估计。例如，我们可以尝试最小化偏度，尽可能保持方差稳定。</p><p id="a63c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个公式必须独立地应用于每个特性。每个特征可能具有不同的λ值。</p><p id="0e50" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于独立变量出现在对数中，这种变换只能应用于严格正的特征。</p><p id="0e89" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我们对之前的数据集应用Box-Cox变换，我们会得到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/bab69d158d9b14609fdf749d39a298ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/0*AswSwi6FIEoOZCPK.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="3996" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如您所见，新特性比原来的特性更加对称。</p><p id="87df" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Yeo-Johnson变换有这样的公式:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/548e303557cb606685e5d1a84f051829.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nlE5FUCCH3_CyzoP95Ds1Q.png"/></div></div></figure><p id="9b2d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们仍然有一个λ参数要估计，但现在这种变换甚至可以应用于负面特征。</p><p id="1b28" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们数据集的结果是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/cd121e8262be06f58ce96050093e730b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/0*Y_uIR_xgWAL8bVDI.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="0ebc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">同样，我们有一组可以被我们的模型使用的对称特征。</p><h1 id="fd57" class="lx ly it bd lz ma mw mc md me mx mg mh jz my ka mj kc mz kd ml kf na kg mn mo bi translated">何时使用电源转换</h1><p id="5daf" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">根据我的经验，当我们使用像KNN、K-means、DBSCAN这样基于距离的模型时，使用幂变换是值得的。有人说它们对线性模型和高斯朴素贝叶斯有用，但我对前者比对后者更有把握。基于树和神经网络的模型不受特征对称性的影响，而如果我们只需要使用线性核，SVM有时可能需要提前进行幂变换。</p><h1 id="27bf" class="lx ly it bd lz ma mw mc md me mx mg mh jz my ka mj kc mz kd ml kf na kg mn mo bi translated">python中的一个例子</h1><p id="cd27" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">让我们看看如何在Python中使用幂变换。我们将在乳腺癌数据集上使用KNN分类器，并看到使用幂变换将提高模型的性能，这是使用AUROC测量的。</p><p id="0b27" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这段代码可以在我的GitHub库<a class="ae ni" href="https://github.com/gianlucamalato/machinelearning/blob/master/Power_Transformation_example.ipynb" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="1492" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们先导入一些库。</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="35e3" class="no ly it nk b gy np nq l nr ns">from sklearn.datasets import load_breast_cancer <br/>import pandas as pd <br/>from sklearn.preprocessing import StandardScaler <br/>from sklearn.neighbors import KNeighborsClassifier <br/>from sklearn.pipeline import Pipeline <br/>from sklearn.metrics import roc_auc_score,balanced_accuracy_score<br/>from sklearn.model_selection import GridSearchCV, train_test_split from sklearn.preprocessing import PowerTransformer <br/>import matplotlib.pyplot as plt</span></pre><p id="cb95" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了简单起见，让我们导入数据集的前6个特征，并将它们存储到pandas数据框架中。</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="415d" class="no ly it nk b gy np nq l nr ns">d = load_breast_cancer() <br/>df = pd.DataFrame(d['data'],columns=d['feature_names']).iloc[:,0:6]</span></pre><p id="faf8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们现在可以将这个数据集分为训练和测试。</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="f9f4" class="no ly it nk b gy np nq l nr ns">X_train, X_test, y_train, y_test = train_test_split(df, d['target'], test_size=0.33, random_state=42)</span></pre><p id="8b6d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我们可以在训练集上训练我们的模型，并在测试集上测试它。我们将使用scikit-learn中的pipeline对象来应用必要的特征缩放。对于第一个例子，我们将避免使用电源转换</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="1109" class="no ly it nk b gy np nq l nr ns">model = Pipeline([ ('scaler',StandardScaler()),('model',KNeighborsClassifier()) ]) </span><span id="1602" class="no ly it nk b gy nt nq l nr ns">model.fit(X_train,y_train) </span><span id="06e2" class="no ly it nk b gy nt nq l nr ns">roc_auc_score(y_test,model.predict_proba(X_test)[:,1])</span></pre><p id="f7d8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果不进行功率变换，我们得到的AUROC值等于0.976</p><p id="abd4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，让我们试着使用能量转换。在Python中，我们有PowerTransformer对象，它默认执行Yeo-Johnson变换，并自动搜索lambda的最佳值。如果我们愿意，我们可以使用Box-Cox-transform，但是对于这个例子，我们将使用默认设置。缩放是可以避免的，因为PowerTransformer自动标准化了特性，但是显式地使用它总是一个好习惯。</p><p id="c758" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我们对流水线应用功率变换(在缩放器之前)，代码是:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="fe5e" class="no ly it nk b gy np nq l nr ns">model = Pipeline([ ('power',PowerTransformer()), ('scaler',StandardScaler()), ('model',KNeighborsClassifier()) ]) </span><span id="5b76" class="no ly it nk b gy nt nq l nr ns">model.fit(X_train,y_train) </span><span id="2793" class="no ly it nk b gy nt nq l nr ns">roc_auc_score(y_test,model.predict_proba(X_test)[:,1])</span></pre><p id="bbe0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用幂变换，AUROC值增加到0.986。因此，该模型比没有幂变换特征的模型执行得更好。</p><h1 id="bb52" class="lx ly it bd lz ma mw mc md me mx mg mh jz my ka mj kc mz kd ml kf na kg mn mo bi translated">结论</h1><p id="2f71" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">当我们必须处理倾斜的特征并且我们的模型对分布的对称性敏感时，幂变换是非常有用的。重要的是要记住在任何缩放之前使用它们。</p><p id="53c0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你想了解更多关于电力转换的知识，请加入我的Python 在线课程中的<a class="ae ni" href="https://yourdatateacher.teachable.com/p/data-pre-processing-for-machine-learning-in-python" rel="noopener ugc nofollow" target="_blank">机器学习数据预处理。</a></p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="8fd6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="mu">原载于2021年4月21日https://www.yourdatateacher.com</em><a class="ae ni" href="https://www.yourdatateacher.com/2021/04/21/when-and-how-to-use-power-transform-in-machine-learning/" rel="noopener ugc nofollow" target="_blank"><em class="mu"/></a><em class="mu">。</em></p></div></div>    
</body>
</html>