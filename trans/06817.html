<html>
<head>
<title>Stockstats — a handy, stocks-oriented pandas DataFrame wrapper</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">stock stats——一个方便的面向股票的熊猫数据框架包装器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/stockstats-a-handy-stocks-oriented-pandas-dataframe-wrapper-a879a06d9c3f?source=collection_archive---------8-----------------------#2021-06-20">https://towardsdatascience.com/stockstats-a-handy-stocks-oriented-pandas-dataframe-wrapper-a879a06d9c3f?source=collection_archive---------8-----------------------#2021-06-20</a></blockquote><div><div class="fc ij ik il im in"/><div class="io ip iq ir is"><figure class="iu iv gp gr iw ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi it"><img src="../Images/39f7b780a7995438325078bb7cda26be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QvO-ImVtt0Otqarmor6QfA.jpeg"/></div></div><p class="je jf gj gh gi jg jh bd b be z dk translated">丹尼尔·劳埃德·布兰克-费尔南德斯在<a class="ae ji" href="https://unsplash.com/s/photos/wall-street?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><div class=""/><div class=""><h2 id="0d45" class="pw-subtitle-paragraph ki jk jl bd b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dk translated">只需调用列名即可访问各种技术指标！</h2></div><p id="001c" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">在这篇文章中，我想简单描述一下我最近遇到的另一个有趣的库— <code class="fe lw lx ly lz b"> stockstats</code>。它是一个位于<code class="fe lw lx ly lz b">pandas</code>数据框架之上的包装库，其主要目标是提供对与股票价格相关的各种度量和技术指标的即时访问。让我们直接开始吧！</p><h1 id="3b8c" class="ma mb jl bd mc md me mf mg mh mi mj mk kr ml ks mm ku mn kv mo kx mp ky mq mr bi translated">准备</h1><p id="6d80" class="pw-post-body-paragraph la lb jl lc b ld ms km lf lg mt kp li lj mu ll lm ln mv lp lq lr mw lt lu lv io bi translated">在能够看到<code class="fe lw lx ly lz b">stockstats</code>能提供什么之前，我们需要导入库并下载数据。</p><figure class="mx my mz na gt ix"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="ee5d" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">使用<code class="fe lw lx ly lz b">yfinance</code>，我们从2020年开始下载苹果的OHLC价格(+成交量)。关于库的更多细节，请参考我的<a class="ae ji" rel="noopener" target="_blank" href="/a-comprehensive-guide-to-downloading-stock-prices-in-python-2cd93ff821d4">其他文章</a>。</p><figure class="mx my mz na gt ix"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="2420" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">这些数据足以展示<code class="fe lw lx ly lz b">stockstats</code>的特色。该库的主类是<code class="fe lw lx ly lz b">StockDataFrame</code>，它是位于<code class="fe lw lx ly lz b">pandas</code>数据框架之上的一个包装器。使用下面的代码片段，我们可以很容易地将后者转换成前者。</p><pre class="mx my mz na gt nd lz ne nf aw ng bi"><span id="3d41" class="nh mb jl lz b gy ni nj l nk nl">stock_df = StockDataFrame.retype(df)</span><span id="3274" class="nh mb jl lz b gy nm nj l nk nl">stock_df</span></pre><figure class="mx my mz na gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi nn"><img src="../Images/45fb552baeb81cd6a1c8e84f05bf4cc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hfcuYe2EsaJRjVTxjWZQQw.png"/></div></div><p class="je jf gj gh gi jg jh bd b be z dk translated">作者图片</p></figure><p id="b9a5" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">到目前为止，没有什么真正的变化，新的DataFrame包含了与以前完全相同的列，只是现在名称是小写的。</p><p id="7b55" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated"><code class="fe lw lx ly lz b">stockstats</code>提供了一种非常有趣的方法来计算不同的度量——我们只需要选择我们想要看到的列，库将使用底层方法来计算请求的值。</p><p id="fbeb" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">让我们从一些可以用于分析的基本信息开始——股票回报。</p><pre class="mx my mz na gt nd lz ne nf aw ng bi"><span id="1aa7" class="nh mb jl lz b gy ni nj l nk nl">stock_df[["change", "rate", "close_-1_d", "log-ret"]]</span></pre><figure class="mx my mz na gt ix gh gi paragraph-image"><div class="gh gi no"><img src="../Images/e810e51c33b1806468258621d350acb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*jsGE7F2tjNax-23Gy4D1IA.png"/></div><p class="je jf gj gh gi jg jh bd b be z dk translated">作者图片</p></figure><p id="5664" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">使用正常的<code class="fe lw lx ly lz b">pandas</code>选择列的方式，我们获得了请求的值，这非常方便。简单地说，对色谱柱的简短描述如下:</p><ul class=""><li id="28a9" class="np nq jl lc b ld le lg lh lj nr ln ns lr nt lv nu nv nw nx bi translated"><code class="fe lw lx ly lz b">change</code>/<code class="fe lw lx ly lz b">rate </code>——这些是简单回报，即股票价格之间的每日百分比变化。数值以百分比表示。</li><li id="263b" class="np nq jl lc b ld ny lg nz lj oa ln ob lr oc lv nu nv nw nx bi translated"><code class="fe lw lx ly lz b">close_-1_d</code> —这是时间<em class="od"> t </em>和<em class="od"> t-1 </em>的差价。我们稍后将回到这个请求值的特殊方式是<code class="fe lw lx ly lz b">stockstats</code>。</li><li id="978d" class="np nq jl lc b ld ny lg nz lj oa ln ob lr oc lv nu nv nw nx bi translated"><code class="fe lw lx ly lz b">log-ret </code> —日志返回。</li></ul><p id="3f89" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">值得一提的是，当我们像上面那样请求这些列时，我们只获得请求的输出。然而，完全相同的列被附加到源对象<code class="fe lw lx ly lz b">stock_df</code>。</p><p id="db95" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">在小标题里我承诺了技术指标，那么我们来创建一个非常简单的——10日简单移动平均线(SMA)。</p><pre class="mx my mz na gt nd lz ne nf aw ng bi"><span id="f194" class="nh mb jl lz b gy ni nj l nk nl">stock_df[["close_10_sma"]]</span></pre><figure class="mx my mz na gt ix gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/eae52b479c1e5e10a09c629e266e2251.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/format:webp/1*Pl6Y1n2hEhgGydNWCbjofw.png"/></div><p class="je jf gj gh gi jg jh bd b be z dk translated">作者图片</p></figure><p id="909b" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">我们再次使用了请求定制指标的特殊方式。为了充分理解它，我们可以使用下面的模式<code class="fe lw lx ly lz b">{columnName_window_statistics}</code>来查看所请求的列名，其中:</p><ul class=""><li id="c6bf" class="np nq jl lc b ld le lg lh lj nr ln ns lr nt lv nu nv nw nx bi translated"><code class="fe lw lx ly lz b">columnName </code> —我们要计算指标的列的名称。在上面的例子中，我们使用了收盘价。</li><li id="7c60" class="np nq jl lc b ld ny lg nz lj oa ln ob lr oc lv nu nv nw nx bi translated"><code class="fe lw lx ly lz b">window </code> —需要考虑多少观察结果。我们在上面使用了10天的窗口。</li><li id="725c" class="np nq jl lc b ld ny lg nz lj oa ln ob lr oc lv nu nv nw nx bi translated"><code class="fe lw lx ly lz b">statistics </code> —我们要计算的度量。在上面的例子中，我们使用了简单移动平均线(<code class="fe lw lx ly lz b">sma</code>)。要获得所有可用指标及其对应列名的列表，您需要检查<code class="fe lw lx ly lz b">stockstats</code>的<a class="ae ji" href="https://github.com/jealous/stockstats" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>。</li></ul><p id="2db5" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">我们现在将结合一些我们已经看到的元素来创建一个收盘价和两条移动平均线的简单图。</p><figure class="mx my mz na gt ix"><div class="bz fp l di"><div class="nb nc l"/></div></figure><figure class="mx my mz na gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi of"><img src="../Images/279a6944726b3d7eac4b6d4cd92a010d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8VJGiGoO2l1orWUl6IBTOQ.png"/></div></div><p class="je jf gj gh gi jg jh bd b be z dk translated">作者图片</p></figure><p id="83d8" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">另外，<code class="fe lw lx ly lz b">StockDataFrame</code>仍然保留了<code class="fe lw lx ly lz b">pandas</code>数据帧的功能。所以使用一个方括号来请求一个列会产生一个<code class="fe lw lx ly lz b">pandas</code>系列。我们可以使用pandas索引来分割数据帧，例如:</p><figure class="mx my mz na gt ix"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="55cc" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">这个图与第一个图非常相似，但是它只包含从<code class="fe lw lx ly lz b">2020–06–01</code>开始的数据。</p><p id="5234" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">另一个我们很容易计算和绘制的TI是布林线<a class="ae ji" href="https://www.investopedia.com/terms/b/bollingerbands.asp" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="mx my mz na gt ix"><div class="bz fp l di"><div class="nb nc l"/></div></figure><figure class="mx my mz na gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi og"><img src="../Images/5366897b45930f806bd94ac10477d208.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EE1JYoiiesKBFUa8Bxia_w.png"/></div></div><p class="je jf gj gh gi jg jh bd b be z dk translated">作者图片</p></figure><p id="25cb" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">还有很多技术指标可用，如相对强弱指数(RSI)，移动平均线收敛发散(MACD)，随机振荡器，威廉超买/超卖指数，平均真实范围(ATR)，等等。</p><p id="c298" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">所有这些指示器都使用一些基于行业标准的硬编码窗口值。例如，使用20天移动平均线(<code class="fe lw lx ly lz b">BOLL_PERIOD</code>)计算布林线，布林线位于2个标准差处(<code class="fe lw lx ly lz b">BOLL_STD_TIMES</code>)。我们可以通过访问<code class="fe lw lx ly lz b">StockDataFrame</code>的相应元素来覆盖它们。</p><p id="9200" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">最后，当我们玩弄技术指标时，我们经常想要创造信号——这是一个买入/卖出的信号。一些简单而流行的策略包括检查一个值是否在另一个值的上方/下方交叉。<code class="fe lw lx ly lz b">stockstats</code>也提供这样的功能。</p><pre class="mx my mz na gt nd lz ne nf aw ng bi"><span id="721c" class="nh mb jl lz b gy ni nj l nk nl">stock_df["close_xu_close_20_sma"]</span></pre><figure class="mx my mz na gt ix gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/e22cb0639dfb4605e628d30a416711cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:358/format:webp/1*gYfzbBPpsNA_w4Wsr8CXFQ.png"/></div><p class="je jf gj gh gi jg jh bd b be z dk translated">作者图片</p></figure><p id="d915" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">我们得到一个布尔序列，表明收盘价是否越过了相同收盘价的20天SMA。我们还可以请求更复杂的交叉，例如两个SMA的交叉。</p><pre class="mx my mz na gt nd lz ne nf aw ng bi"><span id="3e5d" class="nh mb jl lz b gy ni nj l nk nl">stock_df["close_10_sma_xd_close_50_sma"]</span></pre><p id="eec9" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">在这种情况下，当10日均线穿过50日均线时，我们得到一个信号，两者都是用收盘价计算的。</p><h1 id="e89f" class="ma mb jl bd mc md me mf mg mh mi mj mk kr ml ks mm ku mn kv mo kx mp ky mq mr bi translated">意见</h1><p id="072c" class="pw-post-body-paragraph la lb jl lc b ld ms km lf lg mt kp li lj mu ll lm ln mv lp lq lr mw lt lu lv io bi translated"><code class="fe lw lx ly lz b">stockstats</code>绝对是一个有趣的库，在做一些股票价格的快速分析时可以派上用场。它还提供了一种独特的方法，通过选择适当的列名来计算所请求的指标。熟悉用于访问组合指标的模式可能需要一段时间。</p><p id="a9a3" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">然而，该库的文档记录很少。大部分信息可以从<a class="ae ji" href="https://github.com/jealous/stockstats" rel="noopener ugc nofollow" target="_blank">回购</a>中的<code class="fe lw lx ly lz b">README</code>文件中获得，或者直接通过检查<a class="ae ji" href="https://github.com/jealous/stockstats/blob/dd823d3a1c4c2c0de12c99a1140476e5362f3fac/stockstats.py#L77" rel="noopener ugc nofollow" target="_blank">代码</a>获得。但这也提供了一个窥视技术指标是如何计算的可能性，这是一个很好的学习经历。</p><h1 id="a88f" class="ma mb jl bd mc md me mf mg mh mi mj mk kr ml ks mm ku mn kv mo kx mp ky mq mr bi translated">外卖食品</h1><ul class=""><li id="b920" class="np nq jl lc b ld ms lg mt lj oi ln oj lr ok lv nu nv nw nx bi translated"><code class="fe lw lx ly lz b">stockstats</code>是一个位于<code class="fe lw lx ly lz b">pandas</code>数据框架之上的包装器，提供对各种股票相关指标的便捷访问。</li><li id="23c8" class="np nq jl lc b ld ny lg nz lj oa ln ob lr oc lv nu nv nw nx bi translated">该库提供了广泛的流行技术指标，如SMA、EMA、RSI、MACD等。</li><li id="b3c5" class="np nq jl lc b ld ny lg nz lj oa ln ob lr oc lv nu nv nw nx bi translated">您可以通过调用所需的列名来计算指标，所有这些都将在幕后处理。</li></ul><p id="0f8d" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">您可以在我的<a class="ae ji" href="https://github.com/erykml/medium_articles/blob/master/Quantitative%20Finance/stockstats.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到本文使用的代码。此外，欢迎任何建设性的反馈。你可以在推特上或者评论里联系我。</p><p id="453d" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">如果你对学习如何使用Python进行量化金融感兴趣，你可能想看看<a class="ae ji" href="https://www.quantra.quantinsti.com/?ref=eryklewinson" rel="noopener ugc nofollow" target="_blank"> Quantra </a> ( <em class="od">免责声明:附属链接</em>)，它提供了关于这个主题的各种不同的课程。</p><p id="e128" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated"><strong class="lc jm"> <em class="od">注来自《走向数据科学》的编辑:</em> </strong> <em class="od">虽然我们允许独立作者根据我们的</em> <a class="ae ji" rel="noopener" target="_blank" href="/questions-96667b06af5"> <em class="od">规则和指导方针</em> </a> <em class="od">发表文章，但我们不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的</em> <a class="ae ji" rel="noopener" target="_blank" href="/readers-terms-b5d780a700a4"> <em class="od">读者术语</em> </a> <em class="od">。</em></p><p id="11c3" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">如果您喜欢这篇文章，您可能还会对以下内容感兴趣:</p><div class="iu iv gp gr iw ol"><a rel="noopener follow" target="_blank" href="/quantra-a-python-coding-platform-to-learn-quantitative-finance-8e5e88c89120"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd jm gy z fp oq fr fs or fu fw jk bi translated">quantra——学习量化金融的Python编码平台</h2><div class="os l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">towardsdatascience.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy jc ol"/></div></div></a></div><div class="iu iv gp gr iw ol"><a rel="noopener follow" target="_blank" href="/introduction-to-the-hurst-exponent-with-code-in-python-4da0414ca52e"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd jm gy z fp oq fr fs or fu fw jk bi translated">赫斯特指数简介Python代码</h2><div class="os l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">towardsdatascience.com</p></div></div><div class="ot l"><div class="oz l ov ow ox ot oy jc ol"/></div></div></a></div><div class="iu iv gp gr iw ol"><a rel="noopener follow" target="_blank" href="/5-free-tools-that-increase-my-productivity-c0fafbbbdd42"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd jm gy z fp oq fr fs or fu fw jk bi translated">5个提高我工作效率的免费工具</h2><div class="pa l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">这不是一个好的IDE，尽管它很有帮助！</h3></div><div class="os l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">towardsdatascience.com</p></div></div><div class="ot l"><div class="pb l ov ow ox ot oy jc ol"/></div></div></a></div></div></div>    
</body>
</html>