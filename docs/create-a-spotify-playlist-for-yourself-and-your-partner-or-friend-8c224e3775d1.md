# 为你自己和你的伴侣或朋友创建一个 Spotify 播放列表

> 原文：<https://towardsdatascience.com/create-a-spotify-playlist-for-yourself-and-your-partner-or-friend-8c224e3775d1?source=collection_archive---------29----------------------->

## [实践教程](https://towardsdatascience.com/tagged/hands-on-tutorials)

## 使用 spotify 库创建一个版本的 Spotify Duo Mix

![](img/da57f78237e6fd47c9f6edbcf4cd882b.png)

照片由[海蒂·芬](https://unsplash.com/@heidifin?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

Spotify 提供阿朵订阅，附带一个名为 Duo Mix 的独特播放列表。这个播放列表是为两个用户准备的，结合了他们的音乐品味。

我女朋友和我都很想看看这个播放列表是关于什么的。我们开始听，但不知何故感觉有点不对劲。艺术家是“正确的”,但歌曲不是，播放列表几乎没有我们两人实际听过的歌曲。它也很难在不同风格之间转换，从一首冰冷的爵士歌曲变成了电子乐、说唱或金属核心(好吧，这可能对我来说也有点……)。我们不满意，也不再听播放列表中的每周更新。然而，我喜欢这个想法，并认为一定有一种方法来创建我们都希望的播放列表。

所以我决定自己创建一个播放列表，但不是手动的，因为我想每周更新。我首先想到使用机器学习和其他更复杂的方法，但后来我提醒自己，我有一个需要工作解决方案的问题。如果问题不需要，我们的目标不是尝试新的机器学习算法。

我的目标是:

*   包括一些我们最喜欢的歌曲以及我们最近都喜欢的歌曲
*   包括基于这些收藏夹的新歌
*   限制一位艺术家的歌曲数量
*   基于共同喜欢的音乐创造整体的聆听体验，而不仅仅是提供个人品味的混合

我最终得到了一个可行的解决方案，但没有使用机器学习**和**，它实际上只是一点数据争论，通过相似性度量对 Spotify 的推荐进行一些提炼，还有一点随机性。但它很有效，我们对目前的播放列表很满意，并将继续改进它，可能通过机器学习。如果有我们喜欢和不喜欢的歌曲的数据，一个训练有素的模型可以改善一切。

# 准备创建播放列表

## 获取数据

我开始使用我已经创建的 Spotify 应用程序，并通过该应用程序验证我们的帐户。如果你不确定如何做这些事情，看看我之前的文章[带你完成这个过程。](/using-python-to-refine-your-spotify-recommendations-6dc08bcf408e)

我首先为我们两个查询以下数据:

*   长期、中期和短期顶级艺术家
*   长期、中期和短期的顶部跟踪
*   和一些保存的用户曲目(最近 50 首)

我使用了下面的函数，它实际上只是组合了一堆查询并产生了三个数据帧。

请注意，我在这里调用我编写的函数，是为了将 Spotify API 查询结果转换成可用的数据框架。我不会在这里一一细说。一些在我关于 Spotify 的另一篇文章中(见上文)。你可以在 [Github](https://github.com/MerlinSchaefer/spotify_app) 上找到完整的代码(查看所有功能，请参阅 spotifuncs.py)。

第一个重要的数据是用户的所有热门曲目，我把它们合并成一个完整的热门曲目列表，涵盖了从短期到长期的所有热门曲目。请注意，我只从长期顶级曲目中抽取了 15 首歌曲，这样做**而没有**为**设置随机种子，而不是**在每次运行代码时得到相同的结果。在这个过程中，总是使用长期收藏的完整列表会导致在几周的时间里重复太多，从而导致播放列表的重复。

第二个重要的部分是顶级艺术家的数据，就像所有时间帧的曲目一样。艺术家对以后的过滤过程很重要。

最后，我还检索了用户保存的最新 50 首曲目。这里 50 是上限，这很不幸，因为这实际上限制了数据的使用。

## 上周播放列表

为了避免连续两周遇到相同的歌曲(这很可能是因为短期和中期的热门歌曲不会有太大变化)，上周的播放列表是从“Playlist.csv”中读取的。这个文件只是一个空的。我第一次运行代码的时候。但是在播放列表创建过程结束时，新创建的播放列表会保存在其中。csv 文件，所以它包含上周的播放列表。我用了其中的数据。csv 文件，用于在该过程的各个阶段为新的播放列表过滤歌曲。

# **建立播放列表**

创建播放列表需要几个步骤来“组装”组成它的所有构件。这些是:

1.  上周播放列表中没有的常见热门曲目
2.  每个用户与其他用户的顶级曲目最相似的顶级曲目的示例
3.  每个用户都喜欢的艺术家(他们的顶级艺术家之一)的顶级曲目样本
4.  用户保存的歌曲示例
5.  步骤 1 中添加到播放列表的每首曲目的推荐曲目(通过 Spotify API 和附加过滤)。-4.

## 公共顶部轨道

播放列表是由常见的热门曲目启动的，上周的播放列表中还没有出现这些曲目。因为这些歌曲都是用户的最爱，理论上他们应该喜欢。

我创建了一个数据框架，通过查找出现在两个用户的顶级曲目数据框架中的曲目来查找常见的顶级曲目。这可以通过多种方式来实现，我使用了以下函数进行所有**数据帧的比较:**

只有在上周的播放列表中没有出现的常用热门曲目才会被添加到播放列表中。

## 用户最喜欢彼此相似的曲目

下一个构建块由来自两个用户的顶级曲目的歌曲组成，这些歌曲在音频特征的水平上彼此最相似。

对于这个任务，提取每个用户唯一的顶部轨迹，并计算相似性矩阵。相似度基于音频特征(不包括“调”和“模式”)，并通过余弦相似度进行计算(请参见 spotifuncs.py 中的 create_similarity_score())。从该矩阵中，提取 30 个最高相似性得分和相应的指数。对应于这些索引的歌曲被放入数据帧中，任何重复的被丢弃，并且为新的播放列表抽取 10 首歌曲的样本。

## 普通顶级艺术家

下一步根据普通艺术家过滤热门曲目。我试图找到共同的艺术家(在 2 个用户中)，然后通过这些艺术家过滤他们的热门歌曲。这背后的逻辑如下:
一首曲目可能仅在一个用户的“热门曲目”中，然而，它可能是由两个用户都喜欢的艺术家创作的。在这种情况下，该曲目是双人播放列表的良好候选，因为两个用户都可能会喜欢它，但它可能是其中一个用户的新发现。如果双方都已经知道并喜欢它:仍然是一个很好的播放列表适合！

## 潜在问题

对我来说，这种过滤方法经常导致歌曲列表只包含很少的艺术家，而是该艺术家的几首歌曲(这也是因为 Spotify 真的注意到了你何时无法停止听一张专辑..).为了在新的播放列表中没有太多同一艺术家的歌曲，我从数据帧中取样。为此，我根据艺术家出现的频率为行分配权重，然后从两个数据帧中取样。
这种方法工作得相当好，但是仍然有一些缺陷(这可能部分是由我的倾听行为造成的)。

## 从存储的轨道采样

在创建播放列表时，我的目标是大约 25 首已知曲目(以及 25 首推荐的新歌)。为了实现这一点，并以某种方式考虑到前面步骤的随机性质，我在最后一步用采样保存的曲目填充播放列表。对于这一步，我还要确保没有一首抽样歌曲已经出现在上周的播放列表中。

## 从 Spotify 推荐中添加新曲目

在这最后一步，我添加了新的曲目来填充播放列表的另一半。

我**不想**简单地添加 Spotify 根据歌曲推荐的歌曲，这些歌曲已经在播放列表中了。因此，获得 Spotify 推荐只是第一步。我正在检索每首歌曲的多首歌曲推荐，然后根据相似性评分再次过滤。

不幸的是，**Spotify API 不接受 25 首种子曲目用于推荐查询**，因此，我最终将该过程分成 5 首种子曲目的“包”，每个“包”检索 25 首曲目。这 125 个推荐通过它们与播放列表中已知曲目的相似性被进一步过滤。

# 播放列表完成了！

现在剩下唯一要做的就是将曲目添加到播放列表中(在播放列表描述中添加一张漂亮的图片并感谢你的伴侣的耐心**不是可选的**)。

我希望你能以此为灵感，为自己和他人建立一个播放列表。我也希望你发挥创造力，找到解决这个问题的其他方法。让我知道你造了什么！

附注:我故意跳过了一些代码，以保持文章的合理长度，如果你想看，都在 [Github](https://github.com/MerlinSchaefer/spotify_app) 上。

-梅林

<https://ms101196.medium.com/membership> 