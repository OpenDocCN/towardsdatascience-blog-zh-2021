# Python ä¸­å‡çº§çš„è¥é”€ç»„åˆå»ºæ¨¡

> åŸæ–‡ï¼š<https://towardsdatascience.com/an-upgraded-marketing-mix-modeling-in-python-5ebb3bddc1b6?source=collection_archive---------1----------------------->

## [è¥é”€åˆ†æ](https://medium.com/tag/marketing-analytics)

## è®©æˆ‘å¹³åº¸çš„è¥é”€ç»„åˆæ¨¡å¼æ›´åŠ å¼ºå¤§

![](img/a8e132a6fcc2a5c832cdcd8b818faed4.png)

ç…§ç‰‡ç”±[å½¼å¾—Â·é˜®](https://unsplash.com/@peterng1618?utm_source=medium&utm_medium=referral)åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„

# é—ªå›

åœ¨æˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å‘æ‚¨ä»‹ç»äº†è¥é”€ç»„åˆå»ºæ¨¡çš„ä¸–ç•Œã€‚å¦‚æœæ‚¨å°šæœªé˜…è¯»ï¼Œè¯·åœ¨ç»§ç»­ä¹‹å‰é˜…è¯»ã€‚

[](/introduction-to-marketing-mix-modeling-in-python-d0dd81f4e794) [## Python å¸‚åœºè¥é”€ç»„åˆå»ºæ¨¡ç®€ä»‹

### å“ªäº›å¹¿å‘Šæ”¯å‡ºçœŸæ­£æ¨åŠ¨äº†ä½ çš„é”€å”®ï¼Ÿ

towardsdatascience.com](/introduction-to-marketing-mix-modeling-in-python-d0dd81f4e794) 

åœ¨é‚£é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª**çº¿æ€§** **å›å½’**æ¨¡å‹ï¼Œè¯¥æ¨¡å‹èƒ½å¤Ÿæ ¹æ®å‡ ä¸ªå¹¿å‘Šæ¸ é“(å¦‚ç”µè§†ã€å¹¿æ’­å’Œç½‘ç»œæ¨ªå¹…å¹¿å‘Š)çš„åŸå§‹å¹¿å‘Šæ”¯å‡ºæ¥é¢„æµ‹é”€å”®é¢ã€‚å¯¹äºä½œä¸ºæœºå™¨å­¦ä¹ å®è·µè€…çš„æˆ‘æ¥è¯´ï¼Œè¿™æ ·çš„æ¨¡å‹æœ¬èº«å°±å·²ç»å¾ˆå¥½äº†ã€‚æ›´å¥½çš„æ˜¯ï¼Œå®ƒè¿˜è®©å•†ç•Œäººå£«æ„Ÿåˆ°é«˜å…´ï¼Œå› ä¸ºè¯¥æ¨¡å‹è®©æˆ‘ä»¬èƒ½å¤Ÿè®¡ç®—æŠ•èµ„å›æŠ¥ç‡ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿåˆ¤æ–­æ¯ä¸ªæ¸ é“çš„è¡¨ç°å¦‚ä½•ã€‚

ç„¶è€Œï¼Œæˆ‘ä»¬ä¸Šæ¬¡çš„ç®€å•çº¿æ€§å›å½’æ¨¡å‹æœ‰ä¸€äº›é—®é¢˜ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬æ–‡ä¸­è§£å†³ã€‚è®©æˆ‘ç»™ä½ è§£é‡Šä¸€ä¸‹:

1.  æˆ‘ä»¬ç¬¬ä¸€æ¬¾äº§å“çš„æ€§èƒ½å¯èƒ½ä¼šæ›´å¥½ã€‚
2.  æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæ¨¡å‹è¡¨ç°å¾—ä¸çœŸå®ã€‚å°†æ”¯å‡ºå¢åŠ åˆ°æ— ç©·å¤§ä¹Ÿä¼šå°†é”€å”®é¢å¢åŠ åˆ°æ— ç©·å¤§ï¼Œè¿™æ¯«æ— æ„ä¹‰ï¼Œå› ä¸ºäººä»¬åªèƒ½åœ¨æˆ‘ä»¬çš„äº§å“ä¸ŠèŠ±æœ‰é™çš„é’±ã€‚
3.  ä¼˜åŒ–å˜å¾—çç¢ã€æ— ç”¨ã€ä¸åˆ‡å®é™…ã€‚ä¸ºäº†åœ¨ç»™å®šå›ºå®šé¢„ç®—çš„æƒ…å†µä¸‹æœ€å¤§åŒ–é”€å”®é¢ï¼Œæˆ‘ä»¬ç°åœ¨å°†æŠŠæ‰€æœ‰èµ„é‡‘æŠ•å…¥åˆ°çº¿æ€§å›å½’ç³»æ•°æœ€é«˜çš„æ¸ é“ä¸­ã€‚

# å¹¿å‘ŠğŸ˜‰

æˆ‘åˆ›å»ºäº†ä¸€ä¸ªå°åº“ï¼Œåœ¨è¿™é‡Œæˆ‘å®ç°äº†æœ¬æ–‡å…¶ä½™éƒ¨åˆ†çš„æ€æƒ³ï¼Œç”šè‡³æ›´å¤šã€‚é€šè¿‡`pip install mamimo`å®‰è£…ï¼Œå¹¶åœ¨æ­¤æŸ¥çœ‹å¦‚ä½•ä½¿ç”¨:

[](/a-small-python-library-for-marketing-mix-modeling-mamimo-100f31666e18) [## ä¸€ä¸ªç”¨äºè¥é”€ç»„åˆå»ºæ¨¡çš„å°å‹ Python åº“:MaMiMo

### ä»¥ scikit-learn æ–¹å¼åˆ›å»ºè¥é”€ç»„åˆæ¨¡å‹

towardsdatascience.com](/a-small-python-library-for-marketing-mix-modeling-mamimo-100f31666e18) 

# è§£å†³é—®é¢˜

ä¸ºäº†è§„é¿è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€äº›èªæ˜çš„**ç‰¹å¾å·¥ç¨‹**ï¼Œå…è®¸æˆ‘ä»¬å°†ä¸€äº›è¥é”€é¢†åŸŸçš„çŸ¥è¯†æ•´åˆåˆ°æ¨¡å‹ä¸­ã€‚ä¸è¦æ‹…å¿ƒï¼Œç†è§£è¿™äº›æ¦‚å¿µä¸éœ€è¦è¥é”€ç»éªŒï¼Œå› ä¸ºå®ƒä»¬å¾ˆè‡ªç„¶ï¼Œå› æ­¤å¾ˆå®¹æ˜“ç†è§£ã€‚ä»¥ä¸‹æŠ€æœ¯å°†æé«˜æ€§èƒ½ï¼Œå¹¶ä½¿æ¨¡å‹æ›´åŠ çœŸå®ã€‚

## å¹¿å‘Šè‚¡ç¥¨

æˆ‘ä»¬è¦åšçš„è¿™ä¸ªç‰¹è‰²å·¥ç¨‹æ˜¯ä¸€ä¸ªè‡³å…³é‡è¦çš„ç»„ä»¶ï¼Œå«åš[](https://en.wikipedia.org/wiki/Advertising_adstock)***ï¼Œ*è¿™æ˜¯è¥¿è’™Â·å¸ƒç½—å¾·æœ¬ç‰¹å‘æ˜çš„ä¸€ä¸ªæœ¯è¯­[1]ã€‚è¿™æ˜¯ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªç®€å•æ¦‚å¿µçš„å¥‡ç‰¹è¯æ±‡:**

1.  **æˆ‘ä»¬å‡è®¾ä½ èŠ±åœ¨å¹¿å‘Šä¸Šçš„é’±è¶Šå¤šï¼Œä½ çš„é”€å”®é¢å°±è¶Šé«˜ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬èŠ±å¾—è¶Šå¤šï¼Œå¢é•¿å°±è¶Šå¼±ã€‚ä¾‹å¦‚ï¼Œå°†ç”µè§†æ”¯å‡ºä» 0 â‚¬å¢åŠ åˆ° 100ï¼Œ000 â‚¬ä¼šå¤§å¤§å¢åŠ æˆ‘ä»¬çš„é”€å”®é¢ï¼Œä½†å°†å®ƒä» 100ï¼Œ000ï¼Œ000 â‚¬å¢åŠ åˆ° 100ï¼Œ100ï¼Œ000 â‚¬å°±æ²¡æœ‰é‚£ä¹ˆå¤šäº†ã€‚è¿™å«åš**é¥±å’Œæ•ˆåº”**æˆ–**æ”¶ç›Šé€’å‡æ•ˆåº”** *ã€‚***
2.  **å¦‚æœä½ åœ¨å¹¿å‘Šå‘¨èŠ±é’±ï¼Œäººä»¬é€šå¸¸ä¸ä¼šç«‹å³è´­ä¹°ä½ çš„äº§å“ï¼Œè€Œæ˜¯åœ¨å‡ å‘¨ä¹‹åã€‚è¿™æ˜¯å› ä¸ºè¯¥äº§å“å¯èƒ½å¾ˆè´µï¼Œäººä»¬å¸Œæœ›ä»”ç»†è€ƒè™‘å®ƒï¼Œæˆ–è€…å°†å…¶ä¸å…¶ä»–å…¬å¸çš„ç±»ä¼¼äº§å“è¿›è¡Œæ¯”è¾ƒã€‚ä¸ç®¡æ˜¯ä»€ä¹ˆåŸå› ï¼Œåœ¨ç¬¬ *T + x* å‘¨çš„é”€å”®éƒ¨åˆ†æ˜¯ç”±ä½ åœ¨ç¬¬ *Tã€*å‘¨æ’­æ”¾çš„å¹¿å‘Šå¼•èµ·çš„ï¼Œæ‰€ä»¥å®ƒä¹Ÿåº”è¯¥å¾—åˆ°ä¸€äº›ç§¯åˆ†ã€‚è¿™è¢«ç§°ä¸º**é—ç•™**æˆ–**æ»åæ•ˆåº”**ã€‚**

**æˆ‘è®¤ä¸ºè¿™ä¸¤ä¸ªäº‹å®éƒ½å¾ˆå®¹æ˜“ç†è§£ï¼Œå•†ç•Œäººå£«ä¹Ÿå¾ˆå–œæ¬¢ã€‚**

> **æˆ‘ä»¬çš„æ–°æ¨¡å‹ä»ç„¶æ˜¯çº¿æ€§çš„ï¼Œä½†æ˜¯ç”¨ adstock ç‰¹æ€§ä»£æ›¿åŸå§‹æ”¯å‡ºä½œä¸ºè¾“å…¥ã€‚è¿™ä½¿å¾—æ¨¡å‹æ›´åŠ å¼ºå¤§ï¼ŒåŒæ—¶ä¿æŒå…¶å¯è§£é‡Šæ€§ã€‚**

## **åœ¨ scikit-learn ä¸­æ„å»ºé¥±å’Œåº¦å’Œç»“è½¬æ•ˆåº”**

**å¯¹æˆ‘ä»¬æ¥è¯´ä¸å¹¸çš„æ˜¯ï¼Œscikit-learn ä¸åŒ…å«è¿™äº›è½¬æ¢ï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯è·¨è¡Œä¸šçš„å…´è¶£ã€‚ä½†æ˜¯ç”±äºè¿™ä¸¤ç§è½¬æ¢éƒ½æ²¡æœ‰é‚£ä¹ˆå¤æ‚ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªç»ƒä¹ ç¼–å†™ scikit-learn å…¼å®¹ä¼°è®¡å™¨çš„å¥½æœºä¼šã€‚**

**å¦‚æœä½ ä»¥å‰ä»æœªè¿™æ ·åšè¿‡ï¼Œä½ å¯ä»¥çœ‹çœ‹æˆ‘çš„å¦ä¸€ç¯‡å…³äºè¿™ä¸ªè¯é¢˜çš„æ–‡ç« ã€‚è¿™ç¯‡æ–‡ç« æ˜¯å…³äºå›å½’å˜é‡è€Œä¸æ˜¯å˜å‹å™¨çš„ï¼Œä½†æ˜¯æ–¹æ³•å¹¶æ²¡æœ‰å¤ªå¤§çš„ä¸åŒã€‚**

**[](/build-your-own-custom-scikit-learn-regression-5d0d718f289) [## æ„å»ºæ‚¨è‡ªå·±çš„å®šåˆ¶ scikit-å­¦ä¹ å›å½’

### ç¼–å†™ä¸€ä¸ªå›å½’å˜é‡ï¼Œå¹¶ä» scikit-learn ç”Ÿæ€ç³»ç»Ÿçš„æ‰€æœ‰å¼ºå¤§å·¥å…·ä¸­å—ç›Šï¼Œå¦‚ç®¡é“ã€ç½‘æ ¼æœç´¢â€¦

towardsdatascience.com](/build-your-own-custom-scikit-learn-regression-5d0d718f289) 

æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬ä»æ›´ç®€å•çš„å¼€å§‹:é¥±å’Œæ•ˆåº”ã€‚

## äº§ç”Ÿé¥±å’Œæ•ˆæœ

æˆ‘ä»¬å¸Œæœ›åˆ›å»ºä¸€ä¸ªå…·æœ‰ä»¥ä¸‹å±æ€§çš„å˜æ¢(=æ•°å­¦å‡½æ•°):

1.  å¦‚æœæ”¯å‡ºä¸º 0ï¼Œåˆ™*é¥±å’Œæ”¯å‡º*ä¹Ÿä¸º 0ã€‚
2.  è¯¥è½¬æ¢æ˜¯å•è°ƒé€’å¢çš„ï¼Œå³è¾“å…¥æ”¯å‡ºè¶Šé«˜ï¼Œé¥±å’Œè¾“å‡ºæ”¯å‡ºè¶Šé«˜ã€‚
3.  é¥±å’Œå€¼ä¸ä¼šå¢é•¿åˆ°æ— ç©·å¤§ã€‚ç›¸åï¼Œå®ƒä»¬çš„ä¸Šé™æ˜¯æŸä¸ªæ•°ï¼Œæ¯”å¦‚è¯´ 1ã€‚

**ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬æƒ³è¦è¿™æ ·çš„ä¸œè¥¿:**

![](img/78a8734ac92e7cf79ac100ac8da39159.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥å¾—åˆ°è¿™æ ·çš„å‡½æ•°ï¼Œä¾‹å¦‚ï¼Œåœ¨å›¾ç‰‡ä¸­ä½ å¯ä»¥çœ‹åˆ°å‡½æ•° 1-exp(-0.7 *x* )ã€‚æ‰€ä»¥è®©æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¨¡æ¿ï¼Œå¹¶å°†å…¶æ¨å¹¿åˆ° 1-exp(-*ax*)for some*a*>0ã€‚ *a* æ˜¯ä¸€ä¸ªè¶…å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥éšåè¿›è¡Œè°ƒæ•´ï¼Œå› ä¸ºé€šå¸¸æˆ‘ä»¬ä¸çŸ¥é“é¥±å’Œå‡½æ•°çš„å½¢çŠ¶ã€‚

> N ***ote:*** *è¿˜æœ‰è®¸å¤šæ›´æ ‡å‡†çš„é¥±å’Œåº¦å‡½æ•°ï¼Œå¦‚****Adbudg****å’Œ****Hill****å‡½æ•°ï¼Œä½†è®©æˆ‘ä»¬åšæŒç”¨* ***æŒ‡æ•°å‡½æ•°*** *å‡½æ•°* *ä¸º*

ä¸€ä¸ªå¾ˆå¥½çš„å‰¯ä½œç”¨:æˆ‘ä»¬æœ€ç»ˆèƒ½å¤Ÿè¾“å‡ºé¥±å’Œæ›²çº¿ï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“èŠ±æ›´å¤šçš„é’±æ˜¯å¦æœ‰æ„ä¹‰ï¼Œæˆ–è€…æ¸ é“æ˜¯å¦å·²ç»é¥±å’Œã€‚æ¯”å¦‚ä»ä¸Šå›¾æ¥çœ‹ï¼ŒæŠ•èµ„ 8 ä»¥ä¸Šå¥½åƒå°±æ²¡ç”¨äº†ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬æ¥ç¼–ç ä¸€ä¸‹ã€‚äº‹å®ä¸Šï¼Œå°±æ˜¯è¿™ä¸ªç®€å•çš„å°ç±»:

```
class ExponentialSaturation:
    def __init__(self, a=1.):
        self.a = a

    def transform(self, X):
        return 1 - np.exp(-self.a*X)
```

ç„¶è€Œï¼Œæˆ‘ä»¬å°†ä¸ºè¾“å…¥æ·»åŠ ä¸€äº›å¥å…¨æ€§æ£€æŸ¥ï¼Œä»¥ä½¿å…¶ç¬¦åˆ scikit-learnã€‚è¿™å¢åŠ äº†ä¸€ç‚¹ä»£ç ï¼Œä½†è¿™æ˜¯æˆ‘ä»¬å¿…é¡»ä»˜å‡ºçš„ç›¸å¯¹è¾ƒå°çš„ä»£ä»·ã€‚

```
from sklearn.base import BaseEstimator, TransformerMixin
from sklearn.utils.validation import check_is_fitted, check_array

class ExponentialSaturation(BaseEstimator, TransformerMixin):
    def __init__(self, a=1.):
        self.a = a

    def fit(self, X, y=None):
        X = check_array(X)
        self._check_n_features(X, reset=True) # from BaseEstimator
        return self

    def transform(self, X):
        check_is_fitted(self)
        X = check_array(X)
        self._check_n_features(X, reset=False) # from BaseEstimator
        return 1 - np.exp(-self.a*X)
```

å®ƒä»ç„¶ä¸å®Œç¾ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜åº”è¯¥å®ç°å¯¹å¤§äºé›¶çš„ *a* çš„æ£€æŸ¥ï¼Œä½†è¿™æ˜¯ä½ å¯ä»¥è‡ªå·±è½»æ¾å®Œæˆçš„äº‹æƒ…ã€‚ä½¿ç”¨`ExponentialSaturation`å˜å‹å™¨ï¼Œæˆ‘ä»¬å¯ä»¥åšåˆ°ä»¥ä¸‹å‡ ç‚¹:

![](img/093f6ec77731be13f0ea5d04d36fdd04.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

è¿™ä¸ªä¸ç®—å¤ªç³Ÿï¼Œå¯¹å§ï¼Ÿç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹ä¸‹ä¸€ä¸ªæ•ˆåº”ã€‚

## äº§ç”Ÿé—ç•™æ•ˆåº”

è¿™ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹ã€‚è®©æˆ‘ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜æˆ‘ä»¬æƒ³è¦è¾¾åˆ°çš„ç›®æ ‡ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸€ç³»åˆ—çš„æ”¯å‡ºï¼Œä¾‹å¦‚

> (16, 0, 0, 0, 0, 4, 8, 0, 0, 0),

è¿™æ„å‘³ç€æˆ‘ä»¬åœ¨ç¬¬ä¸€å‘¨èŠ±äº† 16 è‹±é•‘ï¼Œç„¶åä»ç¬¬ 2 å‘¨åˆ°ç¬¬ 5 å‘¨æˆ‘ä»¬ä»€ä¹ˆä¹Ÿæ²¡èŠ±ï¼Œç„¶ååœ¨ç¬¬ 6 å‘¨æˆ‘ä»¬èŠ±äº† 4 è‹±é•‘ï¼Œç­‰ç­‰ã€‚

æˆ‘ä»¬ç°åœ¨å¸Œæœ›ä¸€å‘¨çš„èŠ±è´¹èƒ½ä»¥æŒ‡æ•°å½¢å¼éƒ¨åˆ†ç»“è½¬åˆ°ä¸‹ä¸€å‘¨ã€‚è¿™æ„å‘³ç€:åœ¨ç¬¬ä¸€å‘¨æœ‰ 16 è‹±é•‘çš„æ”¯å‡ºã€‚é‚£ä¹ˆæˆ‘ä»¬æºå¸¦è¶…è¿‡ 50%,æ„æ€æ˜¯

*   0.5 * 16 = 8 åˆ°ç¬¬ 2 å‘¨ï¼Œ
*   0.5 * 16 = 4 åˆ°ç¬¬ 3 å‘¨ï¼Œ
*   0.5 * 16 = 2 åˆ°ç¬¬ 4 å‘¨ï¼Œ
*   â€¦

è¿™å¼•å…¥äº†ä¸¤ä¸ªè¶…å‚æ•°:**å¼ºåº¦**(æœ‰å¤šå°‘è¢«ç»“è½¬ï¼Ÿ)å’Œ**é•¿åº¦**(å¤šé•¿æ—¶é—´ç»“è½¬ï¼Ÿ)çš„ç»“è½¬æ•ˆåº”ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ 50%çš„**å¼ºåº¦**å’Œ 2 çš„**é•¿åº¦ï¼Œåˆ™ä¸Šé¢çš„æ”¯å‡ºé¡ºåºå˜ä¸º**

> (16, 8, 4, 0, 0, 4, 10, 5, 2, 0).

æˆ‘ç›¸ä¿¡ä½ å¯ä»¥å†™ä¸€äº›å¾ªç¯æ¥å®ç°è¿™ä¸ªè¡Œä¸ºï¼Œä¸€ä¸ªå¥½çš„å¿«é€Ÿçš„æ–¹æ³•æ˜¯ä½¿ç”¨å·ç§¯ã€‚æˆ‘å°±ä¸è¯¦ç»†è§£é‡Šäº†ï¼Œå°±æ‹¿ä»£ç å½“ç¤¼ç‰©å§ã€‚æˆ‘å†æ¬¡å¼ºè°ƒäº†çœŸæ­£é‡è¦çš„çº¿ã€‚

```
from scipy.signal import convolve2d
import numpy as np

class ExponentialCarryover(BaseEstimator, TransformerMixin):
    def __init__(self, strength=0.5, length=1):
        self.strength = strength
        self.length = length

    def fit(self, X, y=None):
        X = check_array(X)
        self._check_n_features(X, reset=True)
        self.sliding_window_ = (
            self.strength ** np.arange(self.length + 1)
        ).reshape(-1, 1)
        return self

    def transform(self, X: np.ndarray):
        check_is_fitted(self)
        X = check_array(X)
        self._check_n_features(X, reset=False)
        convolution = convolve2d(X, self.sliding_window_)
        if self.length > 0:
            convolution = convolution[: -self.length]
        return convolution
```

å¯ä»¥çœ‹åˆ°ï¼Œä¸Šè¯¾æ˜¯èµ°å¼ºåº¦å’Œé•¿åº¦çš„ã€‚åœ¨æ‹Ÿåˆè¿‡ç¨‹ä¸­ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ»‘åŠ¨çª—å£ï¼Œç”± convolve2d å‡½æ•°ä½¿ç”¨ï¼Œç¥å¥‡åœ°å®Œæˆæˆ‘ä»¬æƒ³è¦çš„å·¥ä½œã€‚å¦‚æœä½ çŸ¥é“ CNN çš„å·ç§¯å±‚ï¼Œè¿™å°±æ˜¯è¿™é‡Œå‘ç”Ÿçš„äº‹æƒ…ã€‚ä»å›¾å½¢ä¸Šçœ‹ï¼Œå®ƒæ‰§è¡Œä»¥ä¸‹æ“ä½œ:

![](img/67cc635f9ef678390addbd49a5facf8c.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

> N ***æ³¨:*** *è¿˜æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥åˆ›å»ºé—ç•™é—®é¢˜ã€‚è¡°å˜ä¸ä¸€å®šæ˜¯æŒ‡æ•°çš„ã€‚ä¹Ÿè®¸å¹¿å‘Šæ•ˆæœçš„é¡¶å³°ä¸æ˜¯åœ¨èŠ±é’±çš„é‚£å¤©ï¼Œè€Œæ˜¯åœ¨ä¸‹ä¸€å‘¨ã€‚æ‚¨å¯ä»¥é€šè¿‡ç›¸åº”åœ°æ›´æ”¹æ»‘åŠ¨çª—å£æ¥è¡¨è¾¾æ‰€æœ‰è¿™äº›å˜åŒ–ã€‚*

è®©æˆ‘ä»¬ç»“åˆé¥±å’Œæ•ˆåº”å’Œç»“è½¬æ•ˆåº”æ¥åˆ›å»ºä¸€ä¸ªæ›´ç°å®çš„è¥é”€ç»„åˆæ¨¡å‹ã€‚

# æœ€ç»ˆæ¨¡å‹

æˆ‘ä»¬å°†å¯¹æ¯ä¸ªæ¸ é“ä½¿ç”¨ä¸åŒçš„é¥±å’Œåº¦å’Œç»“è½¬ã€‚è¿™æ˜¯æœ‰é“ç†çš„ï¼Œå› ä¸ºé€šå¸¸æƒ…å†µä¸‹ï¼Œç”µè§†å¹¿å‘Šæ¯”ä½ åœ¨ç½‘ä¸Šçœ‹åˆ°çš„æ¨ªå¹…å¹¿å‘Šåœ¨ä½ è„‘æµ·ä¸­åœç•™çš„æ—¶é—´æ›´é•¿ã€‚ä»é«˜å±‚æ¬¡çš„è§’åº¦æ¥çœ‹ï¼Œè¯¥æ¨¡å‹å°†å¦‚ä¸‹æ‰€ç¤º:

![](img/b24c2eeae0d2cb2d8ac4b52c59c8f057.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

è¯·æ³¨æ„ï¼Œè“è‰²ç®¡é“åªæ˜¯ç”µè§†æ”¯å‡ºçš„å‡½æ•°ï¼Œæ©™è‰²ç®¡é“æ˜¯å¹¿æ’­æ”¯å‡ºçš„å‡½æ•°ï¼Œç´«è‰²ç®¡é“æ˜¯æ¨ªå¹…å¹¿å‘Šæ”¯å‡ºçš„å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`ColumnTransformer`å’Œ`Pipeline`ç±»åœ¨ scikit-learn ä¸­æœ‰æ•ˆåœ°å®ç°è¿™ä¸€ç‚¹ã€‚`ColumnTransformer`å…è®¸æˆ‘ä»¬å¯¹æ¯ä¸ªå¹¿å‘Šæ¸ é“ä½¿ç”¨ä¸åŒçš„è½¬æ¢ï¼Œè€Œ`Pipeline`å…è®¸æˆ‘ä»¬å¯¹å•ä¸ªæ¸ é“è¿›è¡Œè¿é”æ“ä½œã€‚èŠ±ç‚¹æ—¶é—´ç†è§£ä¸‹é¢çš„ç‰‡æ®µ:

```
from sklearn.compose import ColumnTransformer
from sklearn.pipeline import Pipeline
from sklearn.linear_model import LinearRegression

adstock = ColumnTransformer(
    [
     ('tv_pipe', Pipeline([
                           ('carryover', ExponentialCarryover()),
                           ('saturation', ExponentialSaturation())
     ]), ['TV']),
     ('radio_pipe', Pipeline([
                           ('carryover', ExponentialCarryover()),
                           ('saturation', ExponentialSaturation())
     ]), ['Radio']),
     ('banners_pipe', Pipeline([
                           ('carryover', ExponentialCarryover()),
                           ('saturation', ExponentialSaturation())
     ]), ['Banners']),
    ],
    remainder='passthrough'
)

model = Pipeline([
                  ('adstock', adstock),
                  ('regression', LinearRegression())
])
```

æœ€éš¾çš„éƒ¨åˆ†æ˜¯`ColumnTransformer`ï¼Œæ‰€ä»¥è®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹å¦‚ä½•é˜…è¯»ç”¨ç²—ä½“æ ‡è®°çš„**ç”µè§†å—**ã€‚å®ƒåªæ˜¯è¯´:

> å°†ç®¡é“åº”ç”¨äºâ€œTVâ€åˆ—ï¼Œå¹¶å°†æ­¤éƒ¨åˆ†å‘½åä¸ºâ€œtv_pipeâ€ã€‚ç®¡é“åªæ˜¯ adstock è½¬æ¢ã€‚

é‚£é‡Œæ²¡æœ‰æ›´å¤šçš„äº‹æƒ…å‘ç”Ÿã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªå¤§çš„é¢„å¤„ç†æ­¥éª¤ï¼Œå¹¶åœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ªç®€å•çš„`LinearRegression`æ¥å¾—åˆ°ä¸€ä¸ªå®é™…çš„å›å½’å˜é‡ã€‚é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬ [**å†æ¬¡åŠ è½½æ•°æ®**](https://github.com/Garve/datasets/blob/4576d323bf2b66c906d5130d686245ad205505cf/mmm.csv) å¹¶åšä¸€äº›è®­ç»ƒã€‚

```
import pandas as pd
from sklearn.model_selection import cross_val_score, TimeSeriesSplit

data = pd.read_csv(
    'https://raw.githubusercontent.com/Garve/datasets/4576d323bf2b66c906d5130d686245ad205505cf/mmm.csv',
    parse_dates=['Date'],
    index_col='Date'
)

X = data.drop(columns=['Sales'])
y = data['Sales']

model.fit(X, y)

print(cross_val_score(model, X, y, cv=TimeSeriesSplit()).mean())

# Output: ~0.55
```

> ***æ³¨:*** *æˆ‘ä»¬è¿™é‡Œä¸ä½¿ç”¨æ ‡å‡†çš„* k *-fold äº¤å‰éªŒè¯ï¼Œå› ä¸ºæˆ‘ä»¬å¤„ç†çš„æ˜¯æ—¶é—´åºåˆ—æ•°æ®ã€‚* `*TimeSeriesSplit*` *æ˜¯æ¯”è¾ƒåˆç†çš„åšæ³•ï¼Œè¿™é‡Œ* *å¯ä»¥å¤šäº†è§£ä¸€ä¸‹* [*ã€‚*](https://scikit-learn.org/stable/modules/cross_validation.html#time-series-split)

æœ‰ç”¨ï¼ç„¶è€Œï¼Œè¯¥æ¨¡å‹ä»ç„¶ç›¸å½“ç³Ÿç³•ï¼Œäº¤å‰éªŒè¯çš„ *r* çº¦ä¸º **0.55ï¼Œ**è€Œæ—§çš„ã€æ›´ç®€å•çš„æ¨¡å‹ä¸º 0.72ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¸ºæ¯ä¸ªé€šé“ä½¿ç”¨äº†é»˜è®¤çš„éæœ€ä½³å‚æ•°ï¼Œå³é¥±å’Œåº¦çš„ *a* = 1ï¼Œæ®‹ç•™å¼ºåº¦ä¸º 0.5ï¼Œé•¿åº¦ä¸º 2ã€‚

å› æ­¤ï¼Œè®©æˆ‘ä»¬è°ƒæ•´æ‰€æœ‰çš„ adstock å‚æ•°ï¼

## è¶…å‚æ•°è°ƒè°

æˆ‘å°†ä½¿ç”¨ [Optuna](https://optuna.readthedocs.io/en/stable/) ï¼Œä¸€ä¸ªç”¨äºä¼˜åŒ–ä»»åŠ¡çš„é«˜çº§åº“ã€‚åœ¨è®¸å¤šå…¶ä»–çš„äº‹æƒ…ä¸­ï¼Œå®ƒæä¾›äº†ä¸€ä¸ª scikit-learn å…¼å®¹çš„`OptunaSearchCV`ç±»ï¼Œä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯ scikit-learn çš„`[GridSearchCV](https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV.html)`å’Œ`[RandomizedSearchCV](https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.RandomizedSearchCV.html)`çš„æ›¿ä»£ç‰©ã€‚

ç®€è€Œè¨€ä¹‹ï¼Œ`OptunaSearchCV`æ˜¯`RandomizedSearchCV`çš„æ›´æ™ºèƒ½ç‰ˆæœ¬ã€‚è™½ç„¶`RandomizedSearchCV`åªæ˜¯éšæœºèµ°åŠ¨ï¼Œä½†æ˜¯`OptunaSearchCV`é¦–å…ˆéšæœºèµ°åŠ¨ï¼Œç„¶åæ£€æŸ¥çœ‹èµ·æ¥æœ€æœ‰å¸Œæœ›çš„è¶…å‚æ•°ç»„åˆã€‚

æŸ¥çœ‹ä¸æ‚¨ä¹ æƒ¯ç”¨ scikit ç¼–å†™çš„ä»£ç éå¸¸æ¥è¿‘çš„ä»£ç â€”â€”äº†è§£:

```
from optuna.integration import OptunaSearchCV
from optuna.distributions import UniformDistribution, IntUniformDistribution

tuned_model = OptunaSearchCV(
    estimator=model,
    param_distributions={
        'adstock__tv_pipe__carryover__strength': UniformDistribution(0, 1),
        'adstock__tv_pipe__carryover__length': IntUniformDistribution(0, 6),
        'adstock__tv_pipe__saturation__a': UniformDistribution(0, 0.01),
        'adstock__radio_pipe__carryover__strength': UniformDistribution(0, 1),
        'adstock__radio_pipe__carryover__length': IntUniformDistribution(0, 6),
        'adstock__radio_pipe__saturation__a': UniformDistribution(0, 0.01),
        'adstock__banners_pipe__carryover__strength': UniformDistribution(0, 1),
        'adstock__banners_pipe__carryover__length': IntUniformDistribution(0, 6),
        'adstock__banners_pipe__saturation__a': UniformDistribution(0, 0.01),
    },
    n_trials=1000,
    cv=TimeSeriesSplit(),
    random_state=0
)
```

ä½ å‘Šè¯‰ Optuna ä¼˜åŒ–`model`ã€‚å®ƒé€šè¿‡ä½¿ç”¨æ‚¨åœ¨`param_distributions`ä¸­æŒ‡å®šçš„æ‰€æœ‰å‚æ•°æ¥å®ç°ã€‚å› ä¸ºæˆ‘ä»¬çš„æ¨¡å‹æ˜¯å®Œå…¨åµŒå¥—çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ—è½¬æ¢å™¨ä¸­æœ‰ç®¡é“ï¼Œè€Œåˆ—è½¬æ¢å™¨æœ¬èº«åˆåœ¨ç®¡é“ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å‡†ç¡®åœ°æŒ‡å®šæˆ‘ä»¬æƒ³è¦ä¼˜åŒ–çš„è¶…å‚æ•°ã€‚è¿™æ˜¯é€šè¿‡è¯¸å¦‚`adstock__tv_pipe__carryover__strength`è¿™æ ·çš„å­—ç¬¦ä¸²æ¥å®Œæˆçš„ï¼Œå…¶ä¸­**ä¸¤ä¸ªä¸‹åˆ’çº¿**åˆ†éš”äº†å®Œæ•´æ¨¡å‹çš„ä¸åŒå±‚æ¬¡ã€‚ä½ å‘ç°`adstock`ã€`tv_pipe`ã€`carryover`è¿™å‡ ä¸ªå­—éƒ½åœ¨å‹å·è¯´æ˜ä¹¦é‡Œï¼Œè€Œ`strength`æ˜¯`ExponentialCarryover`å˜å‹å™¨çš„ä¸€ä¸ªå‚æ•°ã€‚

ç„¶åï¼Œä½ æ‰¾åˆ°ä¸€äº›åˆ†å¸ƒã€‚`UniformDistribution(0, 1)`è¡¨ç¤ºåº”è¯¥åœ¨ 0 å’Œ 1 ä¹‹é—´å¯»æ‰¾**æµ®ç‚¹**å‚æ•°ã€‚æŒ‰ç…§åŒæ ·çš„é€»è¾‘ï¼Œ`IntUniformDistribution(0, 6)`æœç´¢ 0 åˆ° 6 ä¹‹é—´çš„**æ•´æ•°**å€¼(ä¸æ˜¯ 5ï¼)ï¼Œå› æ­¤æˆ‘ä»¬å‘Šè¯‰æ¨¡å‹åªè€ƒè™‘ç»“è½¬é•¿åº¦å°äºæˆ–ç­‰äºå…­å‘¨ï¼Œè¿™åªæ˜¯æˆ‘ä»¬çš„ä¸€ä¸ªé€‰æ‹©ã€‚

æˆ‘ä»¬å°è¯•`n_trials=1000`ä¸åŒçš„å‚æ•°ç»„åˆï¼Œå¹¶å†æ¬¡ä½¿ç”¨`TimeSeriesSplit`è¿›è¡Œè¯„ä¼°ã€‚é€šè¿‡è®¾ç½®`random_state=0`ä¿æŒç»“æœçš„å¯å†ç°æ€§ã€‚*æå®šï¼*è¿™åº”è¯¥è¶³å¤Ÿç†è§£ä»£ç äº†ã€‚

## æ€§èƒ½æ£€æŸ¥

è®©æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªåä¸º`tuned_model`çš„ä¼˜åŒ–æ¨¡å‹æ¥æ£€æŸ¥æ€§èƒ½ã€‚å°å¿ƒï¼Œè¿™éœ€è¦å¾ˆé•¿æ—¶é—´ã€‚ä½ å¯ä»¥å°†`n_trials`å‡å°‘åˆ° 100ï¼Œä»¥æ›´å¿«åœ°å¾—åˆ°ä¸€ä¸ªæ›´å·®çš„è§£ã€‚

```
print(cross_val_score(tuned_model, X, y, cv=TimeSeriesSplit()))

# Output: array([0.847353, 0.920507, 0.708728, 0.943805, 0.908159])
```

å¹³å‡äº¤å‰éªŒè¯çš„ *r* ä¸º **0.87ï¼Œ**ä¸æœªä¼˜åŒ–çš„æ¨¡å‹(0.55)å’Œæˆ‘ä»¬ä¸Šä¸€ç¯‡æ–‡ç« ä¸­çš„æ—§å¹³é¢çº¿æ€§æ¨¡å‹(0.72)ç›¸æ¯”ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ”¹è¿›ã€‚è®©æˆ‘ä»¬ç°åœ¨æ”¹è£…æ¨¡å‹ï¼Œçœ‹çœ‹å®ƒå­¦åˆ°äº†ä»€ä¹ˆã€‚

```
tuned_model.fit(X, y)
```

æœ€ä½³è¶…å‚æ•°å¦‚ä¸‹:

```
print(tuned_model.best_params_)
print(tuned_model.best_estimator_.named_steps['regression'].coef_)
print(tuned_model.best_estimator_.named_steps['regression'].intercept_)

# Output:
# Hyperparameters = {
# 'adstock__tv_pipe__carryover__strength': 0.5248878517291329
# 'adstock__tv_pipe__carryover__length': 4
# 'adstock__tv_pipe__saturation__a': 1.4649722346562529e-05
# 'adstock__radio_pipe__carryover__strength': 0.45523455448406197
# 'adstock__radio_pipe__carryover__length': 0
# 'adstock__radio_pipe__saturation__a': 0.0001974038926379962
# 'adstock__banners_pipe__carryover__strength': 0.3340342963936898
# 'adstock__banners_pipe__carryover__length': 0
# 'adstock__banners_pipe__saturation__a': 0.007256873558015173
# }
#
# Coefficients = [27926.6810003   4114.46117033  2537.18883927]
# Intercept = 5348.966158957056
```

## å¯¹æ–°æ•°æ®ä½¿ç”¨æ¨¡å‹

å¦‚æœæ‚¨æƒ³ä¸ºæ–°çš„æ”¯å‡ºè¡¨åˆ›å»ºé¢„æµ‹ï¼Œå¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼è¿›è¡Œ:

```
X_new = pd.DataFrame({
    'TV': [10000, 0, 0],
    'Radio': [0, 3000, 0],
    'Banners': [1000, 1000, 1000]
})

tuned_model.predict(X_new)
```

è¯·æ³¨æ„ï¼Œ**é¢„æµ‹æ€»æ˜¯ä»¥é›¶åº“å­˜**å¼€å§‹ï¼Œå³æ¨¡å‹ä¸çŸ¥é“è¿‡å»çš„ä»»ä½•ç»“è½¬ï¼Œé™¤éæ‚¨å°†å®ƒæ”¾å…¥é¢„æµ‹æ•°æ®æ¡†æ¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³çŸ¥é“ç¬¬*å‘¨åˆ°ç¬¬*å‘¨çš„é”€å”®é¢ï¼Œå¹¶ä¸”æ‚¨åªè¾“å…¥ç¬¬*å‘¨åˆ°ç¬¬*å‘¨çš„æ”¯å‡ºï¼Œé‚£ä¹ˆå®ƒä¸ä¼šè€ƒè™‘ä¹‹å‰ç¬¬*å‘¨åˆ°ç¬¬* -1 å‘¨ã€*å‘¨åˆ°ç¬¬* -2 å‘¨çš„ç»“è½¬ã€‚å¦‚æœä½ æƒ³è®©æ¨¡å‹å»ºç«‹ä¸€ä¸ªåº“å­˜ï¼Œä½ ä¹Ÿå¿…é¡»åŒ…æ‹¬ä¹‹å‰çš„å‡ å‘¨ï¼Œå³ä½¿ä½ åªå¯¹æœ€åä¸€æ¬¡è§‚å¯Ÿçš„é¢„æµ‹æ„Ÿå…´è¶£ã€‚

ä½ ç”šè‡³å¯ä»¥ç”¨æ›´å¤šä¸èŠ±è´¹çš„ç‰¹æ€§æ¥æ‰©å±•è®­ç»ƒæ•°æ®ï¼Œæ‰€è°“çš„*æ§åˆ¶å˜é‡*ã€‚å¦‚æœæ‚¨æ²¡æœ‰åœ¨`ColumnTransformer`å¯¹è±¡ä¸­æŒ‡å®šä»»ä½•é¢„å¤„ç†ï¼ŒåŸå§‹å€¼å°†ç›´æ¥ä¼ é€’ç»™`LinearRegression`å¹¶è¢«è€ƒè™‘ç”¨äºè®­ç»ƒå’Œé¢„æµ‹ã€‚

# è§£é‡Šæ¨¡å‹

ä½¿ç”¨ä¸Šé¢çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€äº›æ¼‚äº®çš„å›¾ç‰‡ï¼Œå¸®åŠ©æˆ‘ä»¬ä»æ¨¡å‹ä¸­è·å¾—æ´å¯ŸåŠ›ã€‚

## é¥±å’Œæ•ˆåº”

å¦‚æœæˆ‘ä»¬æ’å…¥é¥±å’Œå˜å‹å™¨çš„å€¼ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä»¥ä¸‹ç»“æœ:

![](img/2d085b91f559c1ee781fb3b2f5771744.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

*   æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¯¥æ¨¡å‹è®¤ä¸ºç”µè§†é¢‘é“ä»ç„¶éå¸¸*ä¸é¥±å’Œâ€”â€”*åœ¨è¿™é‡ŒèŠ±è´¹æ›´å¤šå¯èƒ½æœ‰åˆ©äºé”€å”®ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬æœ€å¤§çš„ç”µè§†æ”¯å‡ºå¤§çº¦æ˜¯ 15000 è‹±é•‘ã€‚
*   å¹¿æ’­çœ‹èµ·æ¥æœ‰ç‚¹é¥±å’Œï¼Œä½†å¢åŠ è¿™æ–¹é¢çš„æ”¯å‡ºä¼¼ä¹è¿˜æ˜¯åˆç†çš„ã€‚è¯¥æ¸ é“æœ€é«˜æ¶ˆè´¹çº¦ 7700ã€‚
*   æ¨ªå¹…çœ‹èµ·æ¥*è¿‡é¥±å’Œ*ã€‚è¿™é‡Œæœ€é«˜æ¶ˆè´¹ 2500 å·¦å³ï¼Œå‡½æ•°å€¼å·²ç»æ¥è¿‘ 1 äº†ã€‚æ›´é«˜çš„æ”¯å‡ºä¼¼ä¹ä¸ä¼šæœ‰å¤ªå¤§çš„æˆæ•ˆã€‚

## é—ç•™æ•ˆåº”

å¦‚æœæˆ‘ä»¬æ’å…¥å»¶ç»­å˜å‹å™¨çš„å€¼ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä»¥ä¸‹ç»“æœ:

![](img/51b6d9a07e5b5a8c89feca991cafc813.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

ä¼¼ä¹ç”µè§†å¹¿å‘Šåœ¨æœ€åˆæ¶ˆè´¹ 4 å‘¨åä»ç„¶å¯¹é”€å”®æœ‰å½±å“ã€‚è¿™æ¯”å¹¿æ’­å’Œç½‘ç»œæ¨ªå¹…å¹¿å‘Šåœ¨åŒä¸€å‘¨å†…è¿…é€Ÿæ¶ˆå¤±çš„æ•ˆæœè¦é•¿å¾—å¤šã€‚

## æ¸ é“è´¡çŒ®

å’Œä¸Šä¸€ç¯‡æ–‡ç« ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—æ¯ä¸ªæ¸ é“å¯¹æ¯å¤©é”€å”®é¢çš„è´¡çŒ®ã€‚ä»£ç æ¯”ä»¥å‰ç¨å¾®å¤æ‚ä¸€äº›ï¼Œå› ä¸ºæ¨¡å‹ä¹Ÿå˜å¾—æ›´å¤æ‚äº†ã€‚æ— è®ºå¦‚ä½•ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå·¥ä½œç‰ˆæœ¬:

```
adstock_data = pd.DataFrame(
    tuned_model.best_estimator_.named_steps['adstock'].transform(X),
    columns=X.columns,
    index=X.index
)

weights = pd.Series(
    tuned_model.best_estimator_.named_steps['regression'].coef_,
    index=X.columns
)

base = tuned_model.best_estimator_.named_steps['regression'].intercept_

unadj_contributions = adstock_data.mul(weights).assign(Base=base)
adj_contributions = (unadj_contributions
                     .div(unadj_contributions.sum(axis=1), axis=0)
                     .mul(y, axis=0)
                    )

ax = (adj_contributions[['Base', 'Banners', 'Radio', 'TV']]
      .plot.area(
          figsize=(16, 10),
          linewidth=1,
          title='Predicted Sales and Breakdown',
          ylabel='Sales',
          xlabel='Date'
      )
     )

handles, labels = ax.get_legend_handles_labels()
ax.legend(
    handles[::-1], labels[::-1],
    title='Channels', loc="center left",
    bbox_to_anchor=(1.01, 0.5)
)
```

è¾“å‡º:

![](img/ca5e3ee934b12617bc81d4033d43b098.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

ä¸æ—§å›¾ç›¸æ¯”ï¼ŒåŸºçº¿ä¸å†æ‘‡æ‘†ä¸å®šï¼Œå› ä¸ºè¯¥æ¨¡å‹å¯ä»¥æ›´å¥½åœ°è§£é‡Šç»™å®šæ¸ é“æ”¯å‡ºçš„é”€å”®æƒ…å†µã€‚ä¸‹é¢æ˜¯**è€æ¬¾**çš„ä¸€æ¬¾:

![](img/9516074807646298d7d975e48d955778.png)

**è€**å‹å·ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

# **æ€»ç»“ä¸å±•æœ›**

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†æ—§çš„ç®€å•çº¿æ€§æ¨¡å‹ï¼Œå¹¶é€šè¿‡ä¸ä¾èµ–åŸå§‹æ¸ é“æ”¯å‡ºï¼Œè€Œæ˜¯ä¾èµ–å¹¿å‘Šåº“å­˜æ¥æ”¹è¿›å®ƒã€‚å¹¿å‘Šåº“å­˜æ˜¯é€šè¿‡å¼•å…¥é¥±å’Œæ•ˆåº”å’Œç»“è½¬æ•ˆåº”æ¥æ›´çœŸå®åœ°åæ˜ ç°å®ä¸–ç•Œçš„è½¬æ¢æ”¯å‡ºã€‚

æˆ‘ä»¬ç”šè‡³å¯¹è¿™ä¸¤ä¸ªæ¦‚å¿µåšäº†ç®€æ˜çš„å®ç°ï¼Œå¯ä»¥åœ¨ scikit-learn ç”Ÿæ€ç³»ç»Ÿä¸­ä»¥å³æ’å³ç”¨çš„æ–¹å¼ä½¿ç”¨ã€‚

æˆ‘ä»¬åšçš„æœ€åä¸€ä»¶äº‹æ˜¯è°ƒæ•´æ¨¡å‹ï¼Œç„¶åçœ‹çœ‹å®ƒå·²ç»äº†è§£äº†ä»€ä¹ˆã€‚æˆ‘ä»¬ä»¥äººä»¬å®¹æ˜“ç†è§£çš„å›¾ç‰‡å½¢å¼è·å¾—äº†ä¸€äº›æœ‰è¶£çš„è§è§£ï¼Œä½¿è¿™ä¸ªæ¨¡å‹æ—¢å‡†ç¡®åˆå¯è§£é‡Šã€‚

**ç„¶è€Œï¼Œä»æœ‰ä¸€äº›æœªè§£å†³çš„é—®é¢˜:**

1.  æˆ‘ä»¬å·²ç»è®¨è®ºäº†ä¼˜åŒ–æ”¯å‡ºï¼Œä»¥åŠæ—§æ¨¡å¼ä¸ºä½•æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚å—¯ï¼Œæœ‰äº†æ–°çš„ï¼Œä½†æˆ‘ä¸ä¼šåœ¨è¿™é‡Œè¯¦ç»†ä»‹ç»ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå¯¹å¾…æˆ‘ä»¬çš„`tuned_model`å‡½æ•°ï¼Œç”¨ä½ é€‰æ‹©çš„ç¨‹åºä¼˜åŒ–å®ƒï¼Œä¾‹å¦‚ **Optuna** æˆ–**scipy . optimize . minimize**ã€‚ä¸ºä¼˜åŒ–æ·»åŠ ä¸€äº›é¢„ç®—çº¦æŸï¼Œä¾‹å¦‚æ€»æ”¯å‡ºåº”å°‘äº 1ï¼Œ000ï¼Œ000ã€‚
2.  å°†**éæ”¯å‡º**æ•°æ®è¾“å…¥æ¨¡å‹å¯èƒ½ä¼šè¿›ä¸€æ­¥æ”¹å–„å®ƒã€‚ä¾‹å¦‚ï¼Œä»¥ä¸€å‘¨ä¸­çš„**æ—¥**ã€**æœˆ**ï¼Œæˆ–è€…ç”šè‡³æ˜¯æˆ‘ä»¬æƒ³è¦é”€å”®çš„äº§å“çš„**ä»·æ ¼ä¸ºä¾‹ã€‚å°¤å…¶æ˜¯ä»·æ ¼æ˜¯é”€å”®çš„ä¸€ä¸ªé‡è¦é©±åŠ¨åŠ›:ä¸€éƒ¨å”®ä»· 10000 â‚¬çš„æ™®é€š iPhone ä¸ä¼šäº§ç”Ÿå¤šå°‘é”€é‡ï¼Œè€Œä¸€éƒ¨å”®ä»· 100 â‚¬çš„ iPhone ä¼šåœ¨ä¸€çœ¨çœ¼çš„åŠŸå¤«å°±è„±é”€ã€‚å¯¹äºå­£èŠ‚æ€§äº§å“(å¦‚ç²‰ä¸æˆ–çƒ­å·§å…‹åŠ›)æ¥è¯´ï¼Œæœˆä»½ç­‰åŠæ—¶åŠŸèƒ½å¯èƒ½å¾ˆæœ‰æ„æ€ã€‚æˆ–è€…åƒåœ£è¯èŠ‚è¿™æ ·çš„ç‰¹æ®Šæ—¥å­ã€‚æ”¶é›†ä½ çš„æƒ³æ³•ï¼Œå¹¶ç¡®ä¿æ·»åŠ æ‰€æœ‰èƒ½å¤Ÿå½±å“é”€å”®çš„å†…å®¹ï¼**

# å‚è€ƒ

[1] S .å¸ƒç½—å¾·æœ¬ç‰¹ï¼Œã€Šç”µè§†å¹¿å‘Šçš„å•å‘ä½œç”¨ã€‹(1979 å¹´)ã€‚*ã€Šå¸‚åœºç ”ç©¶å­¦ä¼šæ‚å¿—*ï¼Œ *21* (3)ï¼Œç¬¬ 139â€“166 é¡µã€‚** 

**æˆ‘å¸Œæœ›ä½ ä»Šå¤©å­¦åˆ°äº†æ–°çš„ã€æœ‰è¶£çš„ã€æœ‰ç”¨çš„ä¸œè¥¿ã€‚æ„Ÿè°¢é˜…è¯»ï¼**

****ä½œä¸ºæœ€åä¸€ç‚¹ï¼Œå¦‚æœä½ ****

1.  ****æƒ³æ”¯æŒæˆ‘å¤šå†™ç‚¹æœºå™¨å­¦ä¹ å’Œ****
2.  ****æ— è®ºå¦‚ä½•éƒ½è¦è®¡åˆ’è·å¾—ä¸­ç­‰è®¢é˜…é‡ï¼Œ****

****ä¸ºä»€ä¹ˆä¸åš** [**é€šè¿‡è¿™ä¸ªç¯èŠ‚**](https://dr-robert-kuebler.medium.com/membership) **ï¼Ÿè¿™å°†å¯¹æˆ‘å¸®åŠ©å¾ˆå¤§ï¼ğŸ˜Š****

**é€æ˜åœ°è¯´ï¼Œç»™ä½ çš„ä»·æ ¼ä¸å˜ï¼Œä½†å¤§çº¦ä¸€åŠçš„è®¢é˜…è´¹ç›´æ¥å½’æˆ‘ã€‚**

**éå¸¸æ„Ÿè°¢ï¼Œå¦‚æœä½ è€ƒè™‘æ”¯æŒæˆ‘çš„è¯ï¼**

> ***æœ‰é—®é¢˜å°±åœ¨*[*LinkedIn*](https://www.linkedin.com/in/dr-robert-k%C3%BCbler-983859150/)*ä¸Šå†™æˆ‘ï¼***