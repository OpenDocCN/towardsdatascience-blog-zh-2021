# å˜å½¢é‡‘åˆšï¼Œä½ èƒ½è¯„ä»·é˜…è¯»æ®µè½çš„å¤æ‚ç¨‹åº¦å—ï¼Ÿ

> åŸæ–‡ï¼š<https://towardsdatascience.com/transformers-can-you-rate-the-complexity-of-reading-passages-17c76da3403?source=collection_archive---------15----------------------->

## [å®è·µæ•™ç¨‹](https://towardsdatascience.com/tagged/hands-on-tutorials)

## ç”¨ PyTorch å¾®è°ƒ RoBERTa ä»¥é¢„æµ‹æ–‡æœ¬æ‘˜å½•çš„é˜…è¯»éš¾æ˜“ç¨‹åº¦

![](img/11d761b6c8940d31152ab10b3bc544f1.png)

ç…§ç‰‡ç”± [Jeffery Ho](https://unsplash.com/@jefferyho?utm_source=medium&utm_medium=referral) åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„

å˜å‹å™¨ï¼Œå®ƒä»¬åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿå®ƒä»¬ä¸æ˜¯ç”¨äºç”µèƒ½åŠ¨åŠ›ä¼ è¾“çš„è£…ç½®ï¼Œä¹Ÿä¸æ˜¯è™šæ„çš„æ´»ç”Ÿç”Ÿçš„è‡ªä¸»æœºå™¨äºº*æ“å¤©æŸ±*æˆ–*å¤§é»„èœ‚*å¯ä»¥å˜å½¢ä¸ºè½¦è¾†ç­‰å…¶ä»–ç‰©ä½“ã€‚åœ¨æˆ‘ä»¬çš„ä¸Šä¸‹æ–‡ä¸­ï¼ŒTransformers æŒ‡çš„æ˜¯ BERTã€ALBERTã€RoBERTa ç­‰ï¼Œå®ƒä»¬åœ¨æ•°æ®ç§‘å­¦é¢†åŸŸä¸­ç”¨äºè§£å†³å„ç§è‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ï¼Œå¦‚æœºå™¨ç¿»è¯‘ã€æ–‡æœ¬æ‘˜è¦ã€è¯­éŸ³è¯†åˆ«ã€æƒ…æ„Ÿåˆ†æç­‰ã€‚å®ƒä»¬æ˜¯ç”¨äºè‡ªç„¶è¯­è¨€å¤„ç†çš„æœ€å…ˆè¿›çš„è¯­è¨€æ¨¡å‹ï¼Œå¹¶ä¸”åœ¨è¿‡å»çš„å‡ å¹´ä¸­è·å¾—äº†æå¤§çš„æ¬¢è¿ã€‚

è¿™ç¯‡æ–‡ç« å°†å±•ç¤º Transformer æ¨¡å‹çš„å¾®è°ƒï¼Œç‰¹åˆ«æ˜¯ RoBERTa åœ¨æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ•°æ®é›†ä¸Šçš„å¾®è°ƒã€‚å¯¹ä¸‹æ¸¸ä»»åŠ¡è¿›è¡Œå¾®è°ƒï¼Œä»¥é¢„æµ‹ 3-12 å¹´çº§è¯¾å ‚ä½¿ç”¨çš„æ–‡å­¦ä½œå“æ‘˜å½•çš„é˜…è¯»éš¾æ˜“ç¨‹åº¦ã€‚

è¿™é¡¹å·¥ä½œæ˜¯ç”±éè¥åˆ©æ•™è‚²æŠ€æœ¯ç»„ç»‡ CommonLit å‘èµ·çš„ã€‚å®ƒèµåŠ©äº†åœ¨ Kaggle ä¸Šä¸¾åŠçš„ä¸€åœºæ¯”èµ›(ä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šä¿¡æ¯)ï¼Œæ—¨åœ¨ä½¿ç”¨æœºå™¨å­¦ä¹ æ¥å¯»æ±‚å¯¹ç°æœ‰å¯è¯»æ€§è¯„çº§æ–¹æ³•çš„æ”¹è¿›ã€‚è¿™å°†æœ‰åŠ©äºè¯»å†™è¯¾ç¨‹çš„å¼€å‘è€…ä»¥åŠæ•™è‚²è€…ä¸ºå­¦ç”Ÿé€‰æ‹©åˆé€‚çš„é˜…è¯»æ–‡ç« ã€‚å‘ˆç°å…·æœ‰é€‚å½“å¤æ‚ç¨‹åº¦å’Œé˜…è¯»æŒ‘æˆ˜çš„å¼•äººå…¥èƒœçš„æ®µè½å°†æå¤§åœ°æœ‰åˆ©äºå­¦ç”Ÿå‘å±•åŸºæœ¬çš„é˜…è¯»æŠ€èƒ½ã€‚

# **ç›®å½•**

**1ã€‚** [**å…³äºæ•°æ®é›†**](#9ec0)
**2ã€‚** [**æ‹†åˆ†æ•°æ®**](#cee1)
**3ã€‚** [**åˆ›å»ºæ•°æ®é›†ç±»**](#a815)
**4ã€‚** [**ç½—ä¼¯å¡”-åŸºä¸ºæˆ‘ä»¬çš„å‹å·**](#fd6f)
**5ã€‚** [**å˜å‹å™¨æœ‰å“ªäº›å…¸å‹çš„åŸå§‹è¾“å‡ºï¼Ÿ**](#e811)
**6ã€‚** [**å®šä¹‰æ¨¡å‹ç±»**](#2a6b)
âˆ˜ [ä½¿ç”¨ pooler_output](#1e02)
âˆ˜ [æ„å»ºè‡ªå·±çš„å˜å‹å™¨è‡ªå®šä¹‰å¤´](#1439)
âˆ˜ [(A)æ³¨æ„å¤´](#1fbb)
âˆ˜ [(B)ä¸²æ¥éšè—å±‚](#9f4a)
**7ã€‚** [**æ¨¡å‹è®­ç»ƒ**](#6eaa)
âˆ˜ [è¯„ä»·åº¦é‡å’ŒæŸå¤±å‡½æ•°](#fb94)
âˆ˜ [è®­ç»ƒå‡½æ•°](#9d11)
âˆ˜ [éªŒè¯å‡½æ•°](#7df2)
âˆ˜ [è¿è¡Œè®­ç»ƒ](#77df)
[**æ€»ç»“**](#7680)
[**å‚è€ƒæ–‡çŒ®**](#ffa8)

# 1.å…³äºæ•°æ®é›†

æˆ‘ä»¬å°†è¦ä½¿ç”¨çš„æ•°æ®é›†å¯ä»¥åœ¨[è¿™ä¸ª](https://www.kaggle.com/c/commonlitreadabilityprize/data?select=train.csv) Kaggle é¡µé¢ä¸Šæ‰¾åˆ°ã€‚è¿™ä¸ªæ•°æ®é›†åŒ…å«å¤§çº¦ 2800 æ¡è®°å½•ã€‚æˆ‘ä»¬å°†ä½¿ç”¨çš„ä¸¤ä¸ªé‡è¦å­—æ®µæ˜¯`excerpt`å’Œ`target`ã€‚

æŸ¥çœ‹æ•°æ®ï¼Œ`excerpt`æ˜¯é¢„æµ‹é˜…è¯»éš¾æ˜“ç¨‹åº¦çš„æ–‡æœ¬ï¼Œ`target`æ˜¯å¯ä»¥åŒ…å«æ­£å€¼æˆ–è´Ÿå€¼çš„æ•°å€¼å­—æ®µã€‚å¦‚è¯¥æ•°æ®é›†ä¸­æ‰€ç¤ºï¼Œå®ƒæ˜¯ä¸€ä¸ªè¿ç»­å˜é‡ï¼Œæœ€å°å€¼ä¸º-3.676268ï¼Œæœ€å¤§å€¼ä¸º 1.711390ã€‚å› æ­¤ï¼Œç»™å®šä¸€ä¸ªç‰¹å®šçš„`excerpt`ï¼Œæˆ‘ä»¬éœ€è¦é¢„æµ‹`target`çš„å€¼ã€‚

ç»™å¤§å®¶ä¸€ç‚¹èƒŒæ™¯çŸ¥è¯†ï¼Œç«èµ›ä¸»æŒäºº Scott Crossley æ›¾åœ¨[è¿™ä¸ª](https://www.kaggle.com/c/commonlitreadabilityprize/discussion/240423)è®¨è®ºä¸­æåˆ°â€œ*ç›®æ ‡å€¼æ˜¯ä¸€ä¸ª*[*Bradley-Terry*](https://en.wikipedia.org/wiki/Bradley%E2%80%93Terry_model)*åˆ†æè¶…è¿‡ 111ï¼Œ000 ä¸ªä¸¤ä¸¤æ¯”è¾ƒæ‘˜å½•çš„ç»“æœã€‚è·¨è¶Š 3-12 å¹´çº§çš„æ•™å¸ˆï¼Œå¤§å¤šæ•°åœ¨ 6-10 å¹´çº§æ•™å­¦ï¼Œæ‹…ä»»è¿™äº›æ¯”è¾ƒçš„è¯„åˆ†è€…*ã€‚

è¾ƒé«˜çš„`target`å€¼å¯¹åº”äºâ€œ*æ›´æ˜“é˜…è¯»â€*ï¼Œè¾ƒä½çš„å€¼å¯¹åº”äºâ€œ*æ›´éš¾é˜…è¯»â€*ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸‰ä¸ªæ‘˜å½• Aã€B å’Œ Cï¼Œå®ƒä»¬å¯¹åº”çš„`target`å€¼æ˜¯ 1.599999ã€-1.333333 å’Œ-2.888888ã€‚è¿™å°†æ„å‘³ç€ A æ¯” B æ›´å®¹æ˜“é˜…è¯»ï¼ŒB æ¯” c æ›´å®¹æ˜“é˜…è¯»ã€‚

ä¸ºäº†è¯´æ˜ï¼Œä¸‹é¢æ˜¯ä¸¤ä¸ªæ ·æœ¬æ‘˜å½•ã€‚

```
**Excerpt with target value of 1.541672:**More people came to the bus stop just before 9am. Half an hour later they are all still waiting. Sam is worried. "Maybe the bus broke down," he thinks. "Maybe we won't go to town today. Maybe I won't get my new school uniform." At 9:45am some people give up and go home. Sam starts to cry. "We will wait a bit longer," says his mother. Suddenly, they hear a noise. The bus is coming! The bus arrives at the stop at 10 o'clock. "Get in! Get in!" calls the driver. "We are very late today!" People get on the bus and sit down. The bus leaves the stop at 10:10am. "What time is the return bus this afternoon?" asks Sam's mother. "The blue bus leaves town at 2:30pm," replies the driver. Sam thinks, "We will get to town at 11 o'clock." "How much time will we have in town before the return bus?" wonders Sam.**Excerpt with target value of -3.642892:**The iron cylinder weighs 23 kilogrammes; but, when the current has an intensity of 43 amperes and traverses 15 sections, the stress developed may reach 70 kilogrammes; that is to say, three times the weight of the hammer. So this latter obeys with absolute docility the motions of the operator's hands, as those who were present at the lecture were enabled to see. I will incidentally add that this power hammer was placed on a circuit derived from one that served likewise to supply three Hefner-Alteneck machines (Siemens D5 model) and a Gramme machine (Breguet model P.L.). Each of these machines was making 1,500 revolutions per minute and developing 25 kilogrammeters per second, measured by means of a Carpentier brake. All these apparatuses were operating with absolute independence, and had for generators the double excitation machine that figured at the Exhibition of Electricity. In an experiment made since then, I have succeeded in developing in each of these four machines 50 kilogrammeters per second, whatever was the number of those that were running; and I found it possible to add the hammer on a derived circuit without notably affecting the operation of the receivers.
```

æ˜¾ç„¶ï¼Œåœ¨è¿™ä¸¤ç¯‡æ‘˜å½•ä¸­ï¼Œå‰è€…æ¯”åè€…æ›´å®¹æ˜“é˜…è¯»ã€‚

# 2.æ‹†åˆ†æ•°æ®

ç”±äºæˆ‘ä»¬çš„æ•°æ®é›†ç›¸å½“å°ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨[äº¤å‰éªŒè¯](https://machinelearningmastery.com/k-fold-cross-validation/)æ¥æ›´å‡†ç¡®åœ°è¡¡é‡æˆ‘ä»¬æ¨¡å‹çš„æ€§èƒ½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åˆ†å±‚ k-fold å°†æ•°æ®åˆ†ä¸ºè®­ç»ƒé›†å’ŒéªŒè¯é›†ã€‚ä½¿ç”¨åˆ†å±‚ k-foldï¼Œé€šè¿‡ä¿ç•™æ¯ä¸ªç±»åˆ«çš„æ ·æœ¬ç™¾åˆ†æ¯”æ¥è¿›è¡ŒæŠ˜å ã€‚å½“æˆ‘ä»¬æœ‰ä¸€ä¸ªå€¾æ–œçš„æ•°æ®é›†æ—¶ï¼Œæˆ–è€…å½“`target`çš„åˆ†å¸ƒä¸å¹³è¡¡æ—¶ï¼Œè¿™ç§æ–¹æ³•æ˜¯æœ‰ç”¨çš„ã€‚ç„¶è€Œï¼Œå› ä¸ºæˆ‘ä»¬çš„`target`æ˜¯ä¸€ä¸ªè¿ç»­å˜é‡è€Œä¸æ˜¯ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŸç§å˜é€šæ–¹æ³•ã€‚è¿™å°±æ˜¯å®æ»¨`target`å‰æ¥æ•‘æ´çš„åœ°æ–¹ã€‚bin ç±»ä¼¼äºç±»ï¼Œè¿™å¯¹äº scikit-learn çš„`[StratifiedKFold](https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.StratifiedKFold.html)`æ¥è¯´å†å¥½ä¸è¿‡äº†ã€‚

ä»£ç ç›¸å½“ç®€å•ã€‚åœ¨è®¡ç®—å¯¹`target`è¿›è¡Œåˆ†ç±»æ‰€éœ€çš„åˆ†ç±»æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬éšæœºåŒ–æ•°æ®è¡Œå¹¶é‡ç½®è¡Œç´¢å¼•ã€‚ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨[æ–¯ç‰¹å¥‡æ³•åˆ™](https://www.vosesoftware.com/riskwiki/Sturgesrule.php)æ¥ç¡®å®šè¦ä½¿ç”¨çš„ç®±æ•°ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ scikit-learn çš„`StratifiedKFold`ç±»ï¼Œæ ¹æ®æˆ‘ä»¬æ‹¥æœ‰çš„ bin å°†æ•°æ®åˆ†æˆ 5 ä»½ã€‚æœ€åï¼Œç”Ÿæˆçš„æŠ˜å ç¼–å·(èŒƒå›´ä» 0 åˆ° 4)å°†è¢«åˆ†é…ç»™ä¸€ä¸ªåä¸º`skfold`çš„æ–°åˆ—ã€‚è¿‡ç¨‹ç»“æŸæ—¶ï¼Œä¸å†éœ€è¦åƒåœ¾ç®±ï¼Œå¦‚æœæ‚¨æ„¿æ„ï¼Œå¯ä»¥å°†å…¶ä¸¢å¼ƒã€‚

ç”¨`StratifiedKFold`åˆ›ä½œè¤¶çš±ï¼Œæ”¹ç¼–è‡ª Abhishek Thakur çš„ç¬”è®°æœ¬[è¿™é‡Œ](https://www.kaggle.com/abhishek/step-1-create-folds)ã€‚

ä¾›æ‚¨å‚è€ƒï¼Œå®Œæ•´æ•°æ®é›†çš„å¹³å‡å€¼`target`ä¸º-0.96(å››èˆäº”å…¥åˆ°å°æ•°ç‚¹åä¸¤ä½)ã€‚æ‹†åˆ†æˆ 5 ä¸ªè¤¶çš±åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°`target`åœ¨æ¯ä¸ªè¤¶çš±ä¸Šçš„åˆ†å¸ƒå½¢çŠ¶éƒ½è¢«ä¿ç•™äº†ä¸‹æ¥ã€‚çœ‹ä¸‹é¢çš„å›¾ï¼Œæ¯ä¸ªæŠ˜å çš„å¹³å‡å€¼`target`å‡ ä¹æ˜¯ä¸€è‡´çš„ï¼Œå®ƒä»¬ç¡®å®éå¸¸æ¥è¿‘-0.96ã€‚

![](img/406398a85ae4e4a8a4fae80db132a611.png)

å›¾ 1:æ¯ä¸ªæŠ˜å çš„ç›®æ ‡å˜é‡çš„åˆ†å¸ƒå½¢çŠ¶ã€‚ä½œè€…å›¾ç‰‡

# 3.åˆ›å»ºæ•°æ®é›†ç±»

æˆ‘ä»¬ç°åœ¨å°†åˆ›å»º`MyDataset`çš„å­ç±»`torch.utils.data.Dataset`ã€‚æ‘˜å½•å°†ä½œä¸º`texts`ä¼ å…¥ï¼ŒåŒæ—¶ä¼ å…¥çš„è¿˜æœ‰ç”¨äºæ ‡è®°`texts`çš„`tokenizer`ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè®°å·èµ‹äºˆå™¨äº§ç”Ÿè®°å·çš„ id(ç§°ä¸ºè¾“å…¥ id)ä»¥åŠè¾“å…¥åˆ°æˆ‘ä»¬çš„æ¨¡å‹ä¸­æ‰€å¿…éœ€çš„æ³¨æ„å±è”½ã€‚å›¾ 2 æ˜¾ç¤ºäº†ä¸€ä¸ªè¾“å…¥æ–‡æœ¬ä¸ºâ€œ*ä½ å¥½å—ï¼Ÿ*â€ã€‚å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œå¯ä»¥åœ¨[è¿™é‡Œ](https://huggingface.co/transformers/preprocessing.html)æ‰¾åˆ°å…³äºè®°å·èµ‹äºˆå™¨ã€æ³¨æ„åŠ›å±è”½ã€å¡«å……å’Œæˆªæ–­çš„æ›´å¤šç»†èŠ‚ã€‚

# 4.`roberta-base`ä½œä¸ºæˆ‘ä»¬çš„æ¨¡å‹

RoBERTa ä»£è¡¨[**R**obustubly**O**optimized**BERT**Pre-training**A**approach](https://arxiv.org/abs/1907.11692)ï¼Œç”±åç››é¡¿å¤§å­¦å’Œè„¸ä¹¦å¤§å­¦çš„ç ”ç©¶äººå‘˜äº 2019 å¹´æå‡ºã€‚å®ƒæ˜¯åœ¨ 2018 å¹´å‘å¸ƒçš„ [BERT:é¢å‘è¯­è¨€ç†è§£çš„æ·±åº¦åŒå‘å˜æ¢å™¨é¢„è®­ç»ƒ](https://arxiv.org/abs/1810.04805)çš„åŸºç¡€ä¸Šæ”¹è¿›çš„é¢„è®­ç»ƒç¨‹åºã€‚åœ¨æ•´ä¸ªæ¼”ç¤ºè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ RoBERTa å’Œ PyTorchï¼Œä½†æ˜¯å¦‚æœæ‚¨æ„¿æ„ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä¿®æ”¹å’Œä½¿ç”¨å…¶ä»–çš„ Transformer æ¨¡å‹ã€‚è¯·åŠ¡å¿…æŸ¥çœ‹æ‚¨æ‰€ä½¿ç”¨çš„å˜å‹å™¨æ¨¡å‹çš„ç›¸å…³æ–‡æ¡£ï¼Œä»¥ç¡®è®¤å®ƒä»¬æ”¯æŒä»£ç æ‰€ä½¿ç”¨çš„è¾“å…¥å’Œè¾“å‡ºã€‚

ä¸Šæœ‰ä¸€äº› RoBERTa ç±»çš„å˜ä½“ğŸ¤—æ‹¥æŠ±è„¸ã€‚å…¶ä¸­ä¸€ä¸ªæ˜¯`RobertaModel`ï¼Œè¿™é‡Œçš„[å¼•ç”¨](https://huggingface.co/transformers/master/model_doc/roberta.html#robertamodel)ä¸º*â€œè£¸éœ²çš„ç½—ä¼¯å¡”æ¨¡å‹å˜å‹å™¨è¾“å‡ºåŸå§‹çš„éšè—çŠ¶æ€ï¼Œé¡¶éƒ¨æ²¡æœ‰ä»»ä½•ç‰¹å®šçš„å¤´ã€‚â€*æ¢å¥è¯è¯´ï¼Œbare `RobertaModel`çš„åŸå§‹è¾“å‡ºæ˜¯è¾“å…¥åºåˆ—ä¸­æ¯ä¸ª token å¯¹åº”çš„é¢„å®šä¹‰éšè—å¤§å°çš„éšè—çŠ¶æ€å‘é‡ã€‚ä½¿ç”¨è£¸éœ²çš„`RobertaModel`ç±»ï¼Œæˆ‘ä»¬å°†æ·»åŠ æˆ‘ä»¬è‡ªå·±çš„å®šåˆ¶å›å½’å¤´æ¥é¢„æµ‹`target`ã€‚

å¯¹äºæˆ‘ä»¬çš„å˜å‹å™¨å¾®è°ƒä»»åŠ¡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ¥è‡ªğŸ¤—æ‹¥æŠ±è„¸ä½œä¸ºæˆ‘ä»¬çš„æ¨¡ç‰¹ã€‚æ­£å¦‚é‚£é‡Œæ‰€æè¿°çš„ï¼Œâ€œRoBERTa æ˜¯ä¸€ä¸ªä»¥è‡ªæˆ‘ç›‘ç£çš„æ–¹å¼åœ¨ä¸€ä¸ªå¤§çš„è‹±è¯­è¯­æ–™åº“ä¸Šé¢„å…ˆè®­ç»ƒçš„å˜å½¢é‡‘åˆšæ¨¡å‹â€ã€‚ `roberta-base`éšè—å°ºå¯¸ä¸º 768ï¼Œç”±ä¸€ä¸ªåµŒå…¥å±‚åè·Ÿ 12 ä¸ªéšè—å±‚ç»„æˆã€‚

![](img/e69b356818d987ae3ea84793e9070e88.png)

å›¾ 2:ç”¨`max_length=10`å’Œ`padding=â€œmax_lengthâ€`è®¾ç½® tokenizer å‚æ•°çš„ä¾‹å­ã€‚æ·»åŠ ç‰¹æ®Šæ ‡è®°åï¼Œä»»ä½•çŸ­äº 10 çš„è¾“å…¥åºåˆ—éƒ½å°†è¢«å¡«å……`<pad>`æ ‡è®°ã€‚ä½œè€…å›¾ç‰‡

# 5.å˜å‹å™¨çš„å…¸å‹åŸå§‹è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ

åœ¨æˆ‘ä»¬å¼€å§‹åˆ›å»ºå’Œå®šä¹‰æ¨¡å‹ç±»ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ Transformer çš„åŸå§‹è¾“å‡ºæ˜¯ä»€ä¹ˆã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å°†ä½¿ç”¨åŸå§‹è¾“å‡ºæ¥å¡«å……è‡ªå®šä¹‰å›å½’å¤´ã€‚

ä»¥ä¸‹æ˜¯ BERTã€ALBERT å’Œ RoBERTa ç­‰å˜å‹å™¨æ¨¡å‹é€šå¸¸è¿”å›çš„å¸¸è§åŸå§‹è¾“å‡ºã€‚å®ƒä»¬å–è‡ªæ–‡æ¡£[è¿™é‡Œ](https://huggingface.co/transformers/master/model_doc/bert.html#bertmodel)ï¼Œè¿™é‡Œ[è¿™é‡Œ](https://huggingface.co/transformers/master/model_doc/albert.html#albertmodel)ï¼Œè¿™é‡Œ[è¿™é‡Œ](https://huggingface.co/transformers/master/model_doc/roberta.html#robertamodel)ã€‚

*   **last_hidden_state** :è¿™æ˜¯æ¨¡å‹æœ€åä¸€å±‚è¾“å‡ºçš„éšè—çŠ¶æ€åºåˆ—ã€‚å®ƒæ˜¯ä¸€ä¸ªå½¢çŠ¶å¼ é‡`(batch_size, sequence_length, hidden_size)`
*   **pooler_output** :è¿™æ˜¯ç”±çº¿æ€§å±‚å’Œ Tanh æ¿€æ´»å‡½æ•°è¿›ä¸€æ­¥å¤„ç†çš„åºåˆ—çš„ç¬¬ä¸€ä¸ªä»¤ç‰Œ(åˆ†ç±»ä»¤ç‰Œ)çš„æœ€åä¸€å±‚éšè—çŠ¶æ€ã€‚å®ƒæ˜¯ä¸€ä¸ªå½¢çŠ¶ä¸º`(batch_size, hidden_size)`çš„å¼ é‡ã€‚è¯·æ³¨æ„ï¼Œ`pooler_output`å¯èƒ½ä¸é€‚ç”¨äºæŸäº›å‹å·çš„å˜å‹å™¨ã€‚
*   **éšè—çŠ¶æ€**:å¯é€‰ï¼Œå½“`output_hidden_states = True`é€šè¿‡æ—¶è¿”å›ã€‚å®ƒæ˜¯å½¢çŠ¶`(batch_size, sequence_length, hidden_size)`çš„å¼ é‡å…ƒç»„(ä¸€ä¸ªç”¨äºåµŒå…¥çš„è¾“å‡º+ä¸€ä¸ªç”¨äºæ¯å±‚çš„è¾“å‡º)ã€‚

é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯`batch_size`ã€`sequence_length`ã€`hidden_size`ï¼Ÿ

é€šå¸¸ï¼Œæ¨¡å‹æŒ‰æ‰¹æ¬¡å¤„ç†è®°å½•ã€‚å› æ­¤`batch_size`æ˜¯æ¨¡å‹åœ¨ä¸€æ¬¡å‘å‰/å‘åä¼ é€’ä¸­æ›´æ–°å…¶å†…éƒ¨å‚æ•°ä¹‹å‰å¤„ç†çš„è®°å½•æ•°ã€‚`sequence_length`æ˜¯æˆ‘ä»¬ä¸ºæ ‡è®°å™¨çš„`max_length`å‚æ•°è®¾ç½®çš„å€¼ï¼Œè€Œ`hidden_size`æ˜¯å¤„äºéšè—çŠ¶æ€çš„ç‰¹å¾(æˆ–å…ƒç´ )çš„æ•°é‡ã€‚è‡³äº*å¼ é‡*ï¼Œä½ å¯ä»¥æŠŠå®ƒå½¢è±¡åŒ–ä¸ºä¸€ä¸ª n ç»´æ•°ç»„ï¼Œå¯ä»¥ç”¨äºä»»æ„æ•°å€¼è®¡ç®—ã€‚

![](img/5da0f1688f5e1df35528ad31479061bc.png)

å›¾ 3: `last_hidden_state`ï¼Œå³æœ€åä¸€å±‚çš„æ¨¡å‹è¾“å‡ºã€‚å®ƒæ˜¯ä¸€ä¸ªå½¢çŠ¶å¼ é‡`(batch_size, sequence_length, hidden_size)`ã€‚ä½œè€…å›¾ç‰‡

# 6.å®šä¹‰æ¨¡å‹ç±»

è¿™é‡Œæˆ‘ä»¬å°†åˆ›å»º`MyModel`å’Œå­ç±»`[nn.Module](https://pytorch.org/docs/stable/generated/torch.nn.Module.html)`ã€‚

An `nn.Module`æ˜¯æ‰€æœ‰ç¥ç»ç½‘ç»œæ¨¡å—çš„åŸºç±»ï¼Œå®ƒåŒ…å«å¤šä¸ªå±‚å’Œä¸€ä¸ªæ–¹æ³•`forward`ï¼Œè¯¥æ–¹æ³•æ¥å—è¾“å…¥å¹¶è¿”å›è¾“å‡ºã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜åŒ…å«çŠ¶æ€å’Œå‚æ•°ï¼Œå¹¶å¯ä»¥é€šè¿‡å®ƒä»¬è¿›è¡Œæƒé‡æ›´æ–°æˆ–å°†å…¶æ¢¯åº¦å½’é›¶ã€‚ä»`nn.Module`çš„`__call__`å‡½æ•°ä¸­è°ƒç”¨`forward`æ–¹æ³•ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬è¿è¡Œ`MyModel(inputs)`æ—¶ï¼Œå°±ä¼šè°ƒç”¨`forward`æ–¹æ³•ã€‚

## ä½¿ç”¨`pooler_output`

å¯¹äºä»»ä½•å›å½’æˆ–åˆ†ç±»ä»»åŠ¡ï¼Œæœ€ç®€å•çš„å®ç°æ˜¯ç›´æ¥é‡‡ç”¨`pooler_output`å¹¶é™„åŠ ä¸€ä¸ªé¢å¤–çš„å›å½’å™¨æˆ–åˆ†ç±»å™¨è¾“å‡ºå±‚ã€‚

ç‰¹åˆ«æ˜¯åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨`__init__`æ–¹æ³•ä¸­å®šä¹‰ä¸€ä¸ªå¸¦æœ‰ä¸€ä¸ª`[nn.Linear](https://pytorch.org/docs/stable/generated/torch.nn.Linear.html)`å±‚çš„`regressor`ä½œä¸ºæˆ‘ä»¬ç½‘ç»œçš„ä¸€éƒ¨åˆ†ã€‚ç„¶ååœ¨`forward`æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†æŠŠ`pooler_output`è¾“å…¥åˆ°`regressor`ä¸­ï¼Œä¸º`target`äº§ç”Ÿé¢„æµ‹å€¼ã€‚

## æ„å»ºæ‚¨è‡ªå·±çš„å˜å‹å™¨å®šåˆ¶å¤´

é™¤äº†ç®€å•åœ°ä½¿ç”¨`pooler_output`ä¹‹å¤–ï¼Œè¿˜æœ‰è®¸å¤šä¸åŒçš„æ–¹æ³•å¯ä»¥å®šä¹‰å’Œç»„æˆä½ è‡ªå·±çš„å±‚å’Œè‡ªå®šä¹‰å¤´ã€‚æˆ‘ä»¬å°†æ¼”ç¤ºçš„ä¸€ä¸ªä¾‹å­æ˜¯*æ³¨æ„åŠ›å¤´*ï¼Œå®ƒæ˜¯ä»[è¿™é‡Œçš„](https://www.kaggle.com/maunish/clrp-pytorch-roberta-finetune-fixed-minor-issues?scriptVersionId=68364625&cellId=8)æ”¹ç¼–è€Œæ¥çš„ã€‚

## ğŸ…°ï¸ **æ³¨æ„å¤´åƒ**

åœ¨`forward`æ–¹æ³•ä¸­ï¼Œæ¥è‡ª`last_hidden_state`çš„åŸå§‹è¾“å‡ºè¢«è¾“å…¥åˆ°å¦ä¸€ä¸ªç±»`AttentionHead`çš„å®ä¾‹ä¸­(æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€æ®µä¸­è®¨è®º`AttentionHead`)ã€‚æ¥è‡ª`AttentionHead`çš„è¾“å‡ºç„¶åè¢«ä¼ é€’åˆ°æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„`regressor`ä¸­ã€‚

é‚£ä¹ˆï¼Œ`AttentionHead`é‡Œé¢æ˜¯ä»€ä¹ˆï¼Ÿ`AttentionHead`ä¸­æœ‰ä¸¤ä¸ªçº¿æ€§å±‚ã€‚`AttentionHead`å°†`last_hidden_state`å¸¦å…¥ç¬¬ä¸€ä¸ªçº¿æ€§å›¾å±‚ï¼Œåœ¨è¿›å…¥ç¬¬äºŒä¸ªçº¿æ€§å›¾å±‚ä¹‹å‰ï¼Œç»è¿‡ä¸€ä¸ª[tanh](https://medium.com/@cmukesh8688/activation-functions-sigmoid-tanh-relu-leaky-relu-softmax-50d3778dcea5)(åŒæ›²çº¿æ­£åˆ‡)æ¿€æ´»å‡½æ•°ã€‚è¿™å°±å¯¼å‡ºäº†æ³¨æ„åŠ›å¾—åˆ†ã€‚ç„¶åå°† softmax å‡½æ•°åº”ç”¨äºè¿™äº›æ³¨æ„åŠ›åˆ†æ•°ï¼Œé‡æ–°ç¼©æ”¾å®ƒä»¬ï¼Œä»¥ä½¿å¼ é‡çš„å…ƒç´ ä½äºèŒƒå›´[0ï¼Œ1]å†…ï¼Œæ€»å’Œä¸º 1(å—¯ï¼Œè¯•ç€å°†å…¶è§†ä¸ºæ¦‚ç‡åˆ†å¸ƒ)ã€‚ç„¶åå°†è¿™äº›æƒé‡ä¸`last_hidden_state`ç›¸ä¹˜ï¼Œå¹¶å¯¹è·¨è¶Š`sequence_length` ç»´åº¦çš„å¼ é‡æ±‚å’Œï¼Œæœ€ç»ˆäº§ç”Ÿå½¢çŠ¶`(batch_size, hidden_size)` **çš„ç»“æœã€‚**

## ğŸ…±ï¸ **è¿æ¥éšè—å±‚**

æˆ‘ä»¬æƒ³åˆ†äº«çš„å¦ä¸€ä¸ªæŠ€æœ¯æ˜¯éšè—å±‚çš„è¿æ¥ã€‚è¿™ä¸ªæƒ³æ³•æ¥è‡ªäº [*BERT:ç”¨äºè¯­è¨€ç†è§£çš„æ·±åº¦åŒå‘è½¬æ¢å™¨çš„é¢„è®­ç»ƒ*](https://arxiv.org/abs/1810.04805) ï¼Œå…¶ä¸­ä½œè€…æåˆ°ï¼Œä½¿ç”¨åŸºäºç‰¹å¾çš„æ–¹æ³•ï¼Œè¿æ¥æœ€åå››ä¸ªéšè—å±‚åœ¨ä»–ä»¬çš„æ¡ˆä¾‹ç ”ç©¶ä¸­ç»™å‡ºäº†æœ€ä½³æ€§èƒ½ã€‚

> â€œæœ€ä½³æ‰§è¡Œæ–¹æ³•æ˜¯è¿æ¥é¢„è®­ç»ƒè½¬æ¢å™¨çš„å‰å››ä¸ªéšè—å±‚çš„æ ‡è®°è¡¨ç¤ºâ€

æ‚¨å¯ä»¥åœ¨ä¸‹é¢çš„ä»£ç ä¸­è§‚å¯Ÿåˆ°ï¼Œåœ¨è°ƒç”¨æˆ‘ä»¬çš„æ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¦‚ä½•æŒ‡å®š`output_hidden_states = True`ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ç°åœ¨æƒ³è¦æ¥æ”¶å’Œä½¿ç”¨æ¥è‡ªå…¶ä»–éšè—å±‚çš„è¾“å‡ºï¼Œè€Œä¸ä»…ä»…æ˜¯`last_hidden_state`ã€‚

åœ¨`forward`æ–¹æ³•ä¸­ï¼Œæ¥è‡ª`hidden_states`çš„åŸå§‹è¾“å‡ºè¢«å åŠ ï¼Œç»™æˆ‘ä»¬ä¸€ä¸ª`(layers, batch_size, sequence_length, hidden_size)`çš„å¼ é‡å½¢çŠ¶ã€‚ç”±äº`roberta-base`æ€»å…±æœ‰ 13 å±‚ï¼Œè¿™ç®€å•åœ°è½¬åŒ–ä¸º`(13, batch_size, sequence_length, 768)`çš„å¼ é‡å½¢çŠ¶ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨`hidden_size`ç»´åº¦ä¸Šè¿æ¥æœ€åå››å±‚ï¼Œè¿™ç»™æˆ‘ä»¬ç•™ä¸‹äº†ä¸€ä¸ªå¼ é‡å½¢çŠ¶`(batch_size, sequence_length, 768*4)`ã€‚è¿æ¥ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨åºåˆ—ä¸­ç¬¬ä¸€ä¸ªæ ‡è®°çš„è¡¨ç¤ºã€‚æˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªå¼ é‡å½¢çŠ¶`(batch_size, 768*4)`ï¼Œè¿™æœ€ç»ˆè¢«è¾“å…¥åˆ°`regressor`ã€‚

![](img/8c32ffc0efa077a05b96234f1d6dc5c2.png)

å›¾ 4:4 ä¸ªéšè—å±‚çš„è¿æ¥ã€‚ä½œè€…å›¾ç‰‡

å¦‚æœä½ æœ‰å…´è¶£ç»§ç»­é˜…è¯»æ›´å¤šçš„ä¾‹å­ï¼Œè¯·çœ‹ä¸€ä¸‹[è¿™ä¸ª](https://www.kaggle.com/rhtsingh/utilizing-transformer-representations-efficiently/notebook)ç¬”è®°æœ¬ã€‚

# 7.æ¨¡ç‰¹åŸ¹è®­

å¥½äº†ï¼Œè®©æˆ‘ä»¬ç»§ç»­ä¸ºä¸€ä¸ªåŸºæœ¬çš„æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ç¼–å†™è®­ç»ƒä»£ç ã€‚

å› ä¸ºåœ¨è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬ä¸ä¼šæ¶‰åŠè®­ç»ƒå˜å½¢é‡‘åˆšçš„é«˜çº§æŠ€æœ¯ï¼Œæˆ‘ä»¬å°†åªåˆ›å»ºç®€å•çš„å‡½æ•°ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæŸå¤±å‡½æ•°ï¼Œä¸€ä¸ªè®­ç»ƒå‡½æ•°ï¼Œä¸€ä¸ªéªŒè¯å‡½æ•°ï¼Œæœ€åæ˜¯è¿è¡Œè®­ç»ƒçš„ä¸»å‡½æ•°ã€‚

> ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯é¢„è®­ç»ƒæ¨¡å‹(è€Œä¸æ˜¯ä»å¤´å¼€å§‹è®­ç»ƒ)ï¼Œè¿™é‡Œçš„æ¨¡å‹è®­ç»ƒä¹Ÿé€šå¸¸è¢«ç§°ä¸ºå˜å‹å™¨å¾®è°ƒè¿‡ç¨‹ã€‚

## â–¶ï¸è¯„ä»·åº¦é‡å’ŒæŸå¤±å‡½æ•°ğŸ“‰

ä¸ºäº†è¡¡é‡æˆ‘ä»¬æ¨¡å‹çš„æ€§èƒ½ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [RMSE](/what-does-rmse-really-mean-806b65f2e48e) (å‡æ–¹æ ¹è¯¯å·®)ä½œä¸ºè¯„ä¼°æŒ‡æ ‡ã€‚

ç­‰ç­‰ï¼ŒæŸå¤±å‡½æ•°æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼ŸæŸå¤±å‡½æ•°æ˜¯ç”¨æ¥æµ‹é‡é¢„æµ‹è¾“å‡ºå’Œæä¾›çš„`target`å€¼ä¹‹é—´çš„è¯¯å·®ï¼Œä»¥ä¼˜åŒ–æˆ‘ä»¬çš„æ¨¡å‹ã€‚äº‹å®ä¸Šï¼Œè¿™æ˜¯ä¼˜åŒ–å™¨è¯•å›¾æœ€å°åŒ–çš„å‡½æ•°ã€‚

æœ‰æ—¶è¯„ä¼°åº¦é‡å’ŒæŸå¤±å‡½æ•°å¯ä»¥ä¸åŒï¼Œç‰¹åˆ«æ˜¯å¯¹äºåˆ†ç±»ä»»åŠ¡ã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œç”±äºè¿™æ˜¯ä¸€ä¸ªå›å½’ä»»åŠ¡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ RMSE æ¥å®Œæˆè¿™ä¸¤ä¸ªä»»åŠ¡ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å°†æŸå¤±å‡½æ•°å®šä¹‰å¦‚ä¸‹:

```
def loss_fn(predictions, targets):       
    return torch.sqrt(nn.MSELoss()(predictions, targets))
```

## â–¶ï¸è®­ç»ƒå‡½æ•°

æˆ‘ä»¬æ­£åœ¨åˆ›å»ºçš„`train_fn`å°†ä½¿ç”¨è®­ç»ƒæ•°æ®é›†æ¥è®­ç»ƒæˆ‘ä»¬çš„æ¨¡å‹ã€‚åœ¨æˆ‘ä»¬è¿è¡Œè®­ç»ƒæ—¶çš„ä¸»è®­ç»ƒå¾ªç¯ä¸­ï¼Œæ¯ä¸ªå†å…ƒéƒ½ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚

è¯¥åŠŸèƒ½å°†é¦–å…ˆåœ¨è®­ç»ƒæ¨¡å¼ä¸‹è®¾ç½®æ¨¡å‹ã€‚æœ¬è´¨ä¸Šï¼Œå®ƒå°†åœ¨æ•°æ®åŠ è½½å™¨ä¸­å¾ªç¯æ‰€æœ‰æ‰¹æ¬¡çš„è®­ç»ƒæ•°æ®ï¼Œè·å¾—æ‰¹æ¬¡çš„é¢„æµ‹ï¼Œåå‘ä¼ æ’­è¯¯å·®ï¼ŒåŸºäºå½“å‰æ¢¯åº¦æ›´æ–°å‚æ•°ï¼Œå¹¶åŸºäºè°ƒåº¦å™¨æ›´æ–°å­¦ä¹ ç‡ã€‚

éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨å¼€å§‹åå‘ä¼ æ’­ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å°†æ¢¯åº¦è®¾ç½®ä¸ºé›¶ã€‚è¿™æ˜¯å› ä¸º PyTorch ä¼šåœ¨åç»­åå‘è¿‡ç¨‹ä¸­ç´¯ç§¯æ¢¯åº¦ã€‚

æœ€åï¼Œè¯¥å‡½æ•°å°†è¿”å›å®ƒåœ¨æ‰¹æ¬¡ä¸­æ”¶é›†çš„åŸ¹è®­æŸå¤±å’Œå­¦ä¹ ç‡ã€‚

## â–¶ï¸éªŒè¯å‡½æ•°

`validate_fn`ç”¨äºå¯¹æˆ‘ä»¬çš„éªŒè¯æ•°æ®é›†è¿›è¡Œè¯„ä¼°ã€‚å®ƒåŸºæœ¬ä¸Šä¼šè¯„ä¼°æˆ‘ä»¬çš„æ¨¡å‹åœ¨æ¯ä¸ªæ—¶æœŸçš„è®­ç»ƒè¿‡ç¨‹ä¸­è¡¨ç°å¦‚ä½•ã€‚å®ƒä¸æˆ‘ä»¬ä¸Šé¢å†™çš„`train_fn`éå¸¸ç›¸ä¼¼ï¼Œé™¤äº†æ¢¯åº¦è®¡ç®—è¢«ç¦ç”¨ã€‚å› æ­¤æ²¡æœ‰è¯¯å·®çš„åå‘ä¼ æ’­ï¼Œä¹Ÿæ²¡æœ‰å‚æ•°å’Œå­¦ä¹ ç‡çš„æ›´æ–°ã€‚

è¯¥åŠŸèƒ½é¦–å…ˆå°†æ¨¡å‹è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼ã€‚å®ƒå°†åœ¨æ•°æ®åŠ è½½å™¨ä¸­å¾ªç¯æ‰€æœ‰æ‰¹æ¬¡çš„è®¤è¯æ•°æ®ï¼Œå¯¹è®¤è¯æ•°æ®(å³è®­ç»ƒæœŸé—´æœªçœ‹åˆ°çš„æ•°æ®)çš„æ‰¹æ¬¡è¿è¡Œé¢„æµ‹ï¼Œå¹¶æ”¶é›†å°†åœ¨æœ€åè¿”å›çš„è®¤è¯æŸå¤±ã€‚

> **ç¬”è®°æ‘˜è‡ª PyTorch æ–‡æ¡£** [**æ­¤å¤„**](https://pytorch.org/docs/stable/notes/autograd.html) **å’Œ** [**æ­¤å¤„**](https://pytorch.org/docs/stable/generated/torch.no_grad.html) **:**
> 
> å»ºè®®æˆ‘ä»¬åœ¨è®­ç»ƒæ—¶æ€»æ˜¯ä½¿ç”¨`model.train()`ï¼Œåœ¨è¯„ä¼°æˆ‘ä»¬çš„æ¨¡å‹(éªŒè¯/æµ‹è¯•)æ—¶æ€»æ˜¯ä½¿ç”¨`model.eval()`ï¼Œå› ä¸ºæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„æ¨¡å—å¯èƒ½ä¼šè¢«æ›´æ–°ä»¥åœ¨è®­ç»ƒå’Œè¯„ä¼°æ¨¡å¼ä¸‹è¡¨ç°ä¸åŒã€‚
> 
> å½“æˆ‘ä»¬ç¡®å®šä¸ä¼šè°ƒç”¨`[.backward()](https://pytorch.org/docs/stable/generated/torch.Tensor.backward.html#torch.Tensor.backward)`è¿›è¡Œåå‘ä¼ æ’­æ—¶ï¼Œç¦ç”¨æ¢¯åº¦è®¡ç®—å¯¹æ¨æ–­(æˆ–éªŒè¯/æµ‹è¯•)å¾ˆæœ‰ç”¨ã€‚è¿™å°†å‡å°‘åŸæœ¬éœ€è¦æ¢¯åº¦è®¡ç®—çš„è®¡ç®—çš„å†…å­˜æ¶ˆè€—ã€‚

## â–¶ï¸è·‘æ­¥è®­ç»ƒ

ç°åœ¨æˆ‘ä»¬å·²ç»åˆ›å»ºäº†`train_fn`å’Œ`validate_fn`ï¼Œè®©æˆ‘ä»¬ç»§ç»­åˆ›å»ºè¿è¡ŒåŸ¹è®­çš„ä¸»å‡½æ•°ã€‚

è¯¥åŠŸèƒ½çš„é¡¶éƒ¨å°†ä¸ºæ¨¡å‹è®­ç»ƒåšå¿…è¦çš„å‡†å¤‡ã€‚å¯¹äºæ¯ä¸ªæŠ˜å ï¼Œå®ƒå°†åˆå§‹åŒ–æ ‡è®°åŒ–å™¨ï¼Œè·å–å¹¶åˆ›å»ºè®­ç»ƒå’ŒéªŒè¯æ•°æ®é›†å’Œæ•°æ®åŠ è½½å™¨ï¼ŒåŠ è½½æ¨¡å‹å¹¶å°†å…¶å‘é€åˆ°è®¾å¤‡ï¼Œå¹¶è·å–ä¼˜åŒ–å™¨å’Œå­¦ä¹ ç‡è°ƒåº¦å™¨ã€‚

ä¸€æ—¦è¿™äº›éƒ½å®Œæˆäº†ï¼Œå®ƒå°±å‡†å¤‡å¥½è¿›å…¥è®­ç»ƒå¾ªç¯äº†ã€‚è®­ç»ƒå¾ªç¯å°†è°ƒç”¨`train_fn`è¿›è¡Œè®­ç»ƒï¼Œç„¶åå†è°ƒç”¨`validate_fn`å¯¹æ¯ä¸ªæ—¶æœŸè¿›è¡Œæ¨¡å‹è¯„ä¼°ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè®­ç»ƒæŸå¤±å’ŒéªŒè¯æŸå¤±åº”è¯¥éšç€æ—¶é—´é€æ¸å‡å°‘ã€‚æ¯å½“éªŒè¯æŸå¤±æœ‰æ‰€æ”¹å–„æ—¶(è®°ä½ï¼Œå®ƒè¶Šä½è¶Šå¥½)ï¼Œæ¨¡å‹æ£€æŸ¥ç‚¹å°±ä¼šè¢«ä¿å­˜ã€‚å¦åˆ™ï¼Œå¾ªç¯å°†ç»§ç»­ï¼Œç›´åˆ°æœ€åä¸€ä¸ªæ—¶æœŸï¼Œæˆ–è€…å½“è¾¾åˆ°æ—©æœŸåœæ­¢é˜ˆå€¼æ—¶ã€‚åŸºæœ¬ä¸Šï¼Œå½“ç»è¿‡ *n* æ¬¡è¿­ä»£åç¡®è®¤æŸå¤±ä»æ— æ”¹å–„æ—¶ï¼Œè§¦å‘æå‰åœæ­¢ï¼Œå…¶ä¸­ *n* ä¸ºé¢„è®¾é˜ˆå€¼ã€‚

è¯¥å‡½æ•°è¿˜å°†ç»˜åˆ¶è®­ç»ƒå’ŒéªŒè¯æŸå¤±ï¼Œä»¥åŠæ¯ä¸ªæŠ˜å ç»“æŸæ—¶çš„å­¦ä¹ ç‡æ—¶é—´è¡¨ã€‚

![](img/1890b56a0facf2885b61de136b787153.png)

å›¾ 5:æ¯ä¸ªæŠ˜å çš„è®­ç»ƒå’ŒéªŒè¯æŸå¤±çš„æ ·æœ¬å›¾ã€‚ä½œè€…å›¾ç‰‡

# æ‘˜è¦

æœ€åï¼Œæˆ‘ä»¬å³å°†ç»“æŸè¿™ç¯‡å†—é•¿çš„æ–‡ç« ã€‚æ€»ç»“ä¸€ä¸‹:

â˜‘ï¸:æˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ scikit-learn çš„`StratifiedKFold`æ‰§è¡Œåˆ†å±‚ k-foldï¼Œå°†æ•°æ®åˆ†æˆè®­ç»ƒé›†å’ŒéªŒè¯é›†ã€‚ç‰¹åˆ«æ˜¯åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†åƒåœ¾ç®±ã€‚

â˜‘ï¸:æˆ‘ä»¬ä»å˜å‹å™¨ä¸­å¾—åˆ°å…¸å‹çš„åŸå§‹è¾“å‡ºçš„è¦ç‚¹ã€‚

â˜‘ï¸:æˆ‘ä»¬åˆ›å»ºå¹¶å®šä¹‰äº†æ•°æ®é›†å’Œæ¨¡å‹ç±»ã€‚

â˜‘ï¸æˆ‘ä»¬æ¢ç´¢äº†ä¸€äº›è‡ªå®šä¹‰å›å½’å¤´çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹æˆ‘ä»¬çš„æ¨¡å‹ã€‚

â˜‘ï¸:æˆ‘ä»¬ç»å†äº†æ¨¡å‹è®­ç»ƒè¿‡ç¨‹çš„åŸºç¡€ï¼Œå¹¶ä¸ºå®ƒåˆ›å»ºäº†å¿…è¦çš„åŠŸèƒ½ã€‚

è¿™è¿˜ä¸æ˜¯å…¨éƒ¨ã€‚è¯·å…³æ³¨æˆ‘çš„ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œå…³äºå¦‚ä½•åº”ç”¨é«˜çº§åŸ¹è®­æŠ€æœ¯æ¥å¾®è°ƒå˜å‹å™¨æ¨¡å‹ã€‚

</advanced-techniques-for-fine-tuning-transformers-82e4e61e16e>  

*å¦‚æœä½ å–œæ¬¢æˆ‘çš„å¸–å­ï¼Œåˆ«å¿˜äº†ç‚¹å‡»* [***å…³æ³¨***](https://peggy1502.medium.com/) *å’Œ* [***è®¢é˜…***](https://peggy1502.medium.com/subscribe) *ä»¥è·å¾—é‚®ä»¶é€šçŸ¥ã€‚*

*å¯é€‰åœ°ï¼Œä½ ä¹Ÿå¯ä»¥* [*æ³¨å†Œ*](https://peggy1502.medium.com/membership) *æˆä¸ºåª’ä½“ä¼šå‘˜ï¼Œä»¥è·å¾—åª’ä½“ä¸Šæ¯ä¸ªæ•…äº‹çš„å…¨éƒ¨è®¿é—®æƒé™ã€‚*

ğŸ“‘*è®¿é—®è¿™ä¸ª*[*GitHub repo*](https://github.com/peggy1502/Data-Science-Articles/blob/main/README.md)*è·å–æˆ‘åœ¨å¸–å­ä¸­åˆ†äº«çš„æ‰€æœ‰ä»£ç å’Œç¬”è®°æœ¬ã€‚*

2021 ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚

# å‚è€ƒ

[1] A. Thakurï¼Œ[(å‡ ä¹)æ¥è¿‘ä»»ä½•æœºå™¨å­¦ä¹ é—®é¢˜](https://www.amazon.com/dp/8269211508) (2020)

[2] C .å­™ï¼Œx .é‚±ï¼Œy .å¾ï¼Œx .é»„ï¼Œ[å¦‚ä½•å¾®è°ƒç”¨äºæ–‡æœ¬åˆ†ç±»çš„ BERTï¼Ÿ](https://arxiv.org/abs/1905.05583) (2020)

[3] Y. Liuï¼ŒM. Ottï¼ŒN. Goyalï¼ŒJ. Duï¼ŒM. Joshiï¼ŒD. Chenï¼ŒO. Levyï¼ŒM. Lewisï¼ŒL. Zettlemoyer å’Œ V. Stoyanovï¼Œ [RoBERTa:ç¨³å¥ä¼˜åŒ–çš„ BERT é¢„è®­ç»ƒæ–¹æ³•](https://arxiv.org/abs/1907.11692) (2019)

[4] J. Devlinï¼ŒM. Changï¼ŒK. Lee å’Œ K. Toutanovaï¼Œ [BERT:ç”¨äºè¯­è¨€ç†è§£çš„æ·±åº¦åŒå‘è½¬æ¢å™¨çš„é¢„è®­ç»ƒ](https://arxiv.org/abs/1810.04805) (2018)

[5] A .ç“¦æ–¯ç“¦å°¼ã€n .æ²™æ³½å°”ã€n .å¸•å°”é©¬ã€j .ä¹Œå…¹ç§‘é›·ç‰¹ã€l .ç¼æ–¯ã€A .æˆˆéº¦æ–¯ã€l .å‡¯æ³½å’Œ I .æ³¢æ´›è‹æ¬£ï¼Œ[æ³¨æ„åŠ›æ˜¯ä½ æ‰€éœ€è¦çš„å…¨éƒ¨](https://arxiv.org/abs/1706.03762) (2017)