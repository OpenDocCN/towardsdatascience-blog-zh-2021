# 质量多样性算法:地图极坐标

> 原文：<https://towardsdatascience.com/quality-diversity-algorithms-a-new-approach-based-on-map-elites-applied-to-robot-navigation-f51380deec5d?source=collection_archive---------24----------------------->

## [思想和理论](https://towardsdatascience.com/tagged/thoughts-and-theory)

## 一种基于地图精英的机器人导航新方法

进化算法在包括机器人在内的许多应用领域都占有重要地位。在本文中，我们将首先介绍机器人学中的导航问题。之后，我们将展示为什么寻找多样性比寻找质量更好，并尝试一些众所周知的方法来做这种事情。最后，我们将提出一种新的直觉，将质量与多样性联系起来，以胜过面向质量和多样性的算法。

# 导航任务

在机器人学中，通常将代理粗略地表示为几个收集关于环境的传感信息的传感器和几个可以在离散或连续范围内取值的参与者。

![](img/6adc24a8279153673581652063832d9d.png)

代理人与其环境之间关系的代表图(由我绘制)

在这篇博文中，我们对导航任务感兴趣。这个任务由一个带有接近传感器的智能体组成，它在环境中移动以达到目标。
我们的实验传感器是布置在智能体周围的测距仪和雷达，如取自【3】的插图所示。

演员是一个马达，它可以向前或向后产生一个脉冲，向左或向右产生一个脉冲，这两个脉冲都用速度来表示，在实数区间[-2，2]内取值。

![](img/29e4848c3dcbfe7cb50a71b6847ef1e2.png)

代理传感器(测距仪和雷达)由我。

环境是一个迷宫，只有一个目标，代理必须通过最小化移动距离和碰撞来达到。

在他们的文章中，Lehman 和 Staley[3]使用了两个迷宫，一个他们称之为“中等”，但它更像是一个“标准”迷宫。他们认为第二个是“困难的”,因为跟踪目标的距离会导致欺骗行为。

![](img/ef19ef91f6c64443a9337618e7468aac.png)

我在模拟中使用的迷宫拓扑

Lehman 和 Staley[3]在他们的文章中声称，在第二种配置中，如果不仅仅依赖于每个解决方案的质量(在这种情况下是到目标的距离),而且还依赖于群体的多样性，那么探索会更有效。

因为在下文中，我们将探索不同的最先进的方法，以一种进化的方式将质量和多样性结合起来，所以在硬地图上评估它们的性能更方便。

# 技术要点

在下文中，我们将解释用于构建神经网络控制器的框架，之后，我们将解释进化算法的模拟过程，以评估每个神经网络的行为。

# **神经网络设计**

根据传感器的数量和机器人演员的数量，我们可以想到的处理这种导航任务的每个神经网络都具有相同的输入数量和固定输出数量。

![](img/d4dfa6ea2827865cf21f0d729027700e.png)

我将要使用的神经网络的架构(由我使用)

在进化算法的上下文中，我们必须区分两个概念:个体的基因型和表现型(在这种情况下是神经网络)

*   **基因型:**在这种情况下，基因型是权重的向量，其定义了神经网络将从其从传感器获得的输入生成输出的方式；更一般地，基因型指的是制剂的隐藏构型。
*   **表现型**:这一术语指的是与编码隐藏特征的基因型相反的药剂的实际可观察行为。在我们的例子中，表型是当使用以基因型权重为参数的神经网络时，代理在迷宫中采取的轨迹。

我们的设计框架必须考虑并允许访问神经网络基因型的紧凑表示。为此，我们将使用 PyTorch 框架，并为我们所有的神经网络创建一个基类；之后我们将设计的每一个神经网络都将扩展这个类来继承基因型操作方法。

![](img/6ad21fac7a9a149f2368c995ea295b7a.png)

例如，我们能想到的最简单的架构是一个多层神经网络，它有一个双曲正切激活函数，该函数被缩放 2 倍以适应我们的动作域；我们扩展基类来继承所有操纵神经网络基因型的功能。

![](img/bc5605bd196c7ee5a5944d7dbb06ab38.png)

# 体验的模拟

既然我们有了一种从其基因型构建神经网络的方法，我们就必须模拟神经网络在迷宫中的行为，以评估这种行为(在这种情况下也称为表型)。

为了管理模拟，我们将使用 fastsim，可以在这里找到:【https://github.com/jbmouret/libfastsimT4[https://github.com/alexendy/fastsim_gym](https://github.com/alexendy/fastsim_gym)一个健身房绑定。

![](img/64bfc0ea0547a6da502ae3ab7486e362.png)

在返回的观测值中，我们可以得到碰撞的次数和位置。两者都可以是每个个体表型的有效描述符。

# 最新算法综述

现在我们将回顾并试验一些最先进的算法来完成这项任务，

**查新:**

新奇搜索是最著名的基于多样性的算法之一。Lehman 和 Stahley 在[3]中介绍了它，它使用对每个个体的新鲜感的估计作为适应度函数。

新颖性独立于任务的上下文定义如下:

![](img/e773873a632bb188e88efc8c9c8eb062.png)

粗略地说，它是个体表现型到 k 个最近表现型的距离的平均值。它将促进导致新职位行为的基因型。

正如 Lehman 和 Stahly 所解释的，在困难的迷宫中使用这个目标函数会导致研究的分歧。

该图代表了 200 代生成的个体的最后位置。

![](img/b3aa1fb1ad388b1a938598999663764d.png)

**地图-精英搜索:**

在 JB Mouret 和 Jeff Clune[2]介绍的这种算法中，在我们对它的改编中，我们将迷宫分成网格单元，并将每个个体映射到与其在迷宫中的最终位置相对应的单元。

之后，我们将为每个单元保留“最佳”个体，在我们的情况下，这意味着可以以最少的冲突次数到达该单元的个体，在选择阶段，我们将从网格档案中选择个体，以确保我们选择的个体可以到达网格的不同单元。

我们现在可以像在前面的部分中一样，比较适合导向和地图精英方法中的个体。

![](img/2f4752b394858ede3088f8b242b337b7.png)

正如我们所见，地图精英的选择在某种程度上是客观导向的。尽管如此，依赖于每个网格单元选择一个个体的选择过程，允许算法走出僵局，并增加多样性的选择压力。

**空间、层次、照明神经进化(SHINE) :**

这种方法是由 Davy Smith、Laurissa Tokarchuk 和 gerint Wiggins[1]提出的，

它通过绘制这些个体在迷宫中的最终位置来保存它们的档案。它不使用网格，而是使用基于树结构的分层映射；超参数“alpha”限制了树的高度。

每一片树叶都用一个基于新颖性的标准进行筛选，以保留最好的“beta”个体。

这种方法远远胜过新奇搜索和地图精英，正如我们在这个可视化中看到的。

![](img/17c929139b1ee16aa425c3d545b6d20b.png)

这种可视化缺乏要点，因为该算法比其他算法在最小数量的代中到达出口，但是我们稍后将回到这一点。

# **超参数影响**

正如你可能已经注意到的，所有的先例算法都依赖超参数来调节它们从一代到另一代保存和/或选择个体的方式。

**查新**

新颖性搜索是更“超参数自由”的方法；它只取决于 k，即计算新颖性分数时要考虑的邻居数量，除了极端值，这个超参数并不真正影响性能。

**地图精英**

MAP-Elites 算法由于使用基于适应度的方法来过滤每个网格单元中的最佳个体，所以受到单元数量或等效地受到每个单元大小的影响。

取极值时可以观察到细胞数的影响。例如，假设我们想要选择 10 个个体，如果我们有 1000 个单元，该算法将选择 10 个最好的单元，由于单元的尺寸很小，它们可以彼此非常接近，相反，如果我们在整个地图上只选择 20 个单元，选择将必须覆盖迷宫总面积的至少 50%，因此它将更加分散。

因此，当采用小网格尺寸时，算法可能无法走出僵局。

**闪耀**

最后，SHINE 算法依赖于两个超参数:每片叶子的最大个体数量和树的最大高度。尽管它使调整过程变得复杂，因为这会引起组合问题，但这两个参数对算法的影响更模糊，因此更难调整它们。

存档构建从 MAP-Elits 算法开始，但只有四个单元。每次产生一个新的个体，它被映射到一个单元，如果一个单元有多于一个的 alpha 元素，它被分裂成 4 个单元，并且在树中创建一个新的级别，如果算法因为树达到它的最大高度而不能创建一个新的级别，我们根据新颖性搜索标准从叶子中移除最差的个体。

我们可以看到，一片叶子的深度表明个体的网格有多小；这旨在允许非常频繁区域被更精细地切割。

# 质量-多样性权衡

在我们的研究中，我们将使用两个指标来跟踪进化算法的进展。

*   我们可以测量群体的平均适应度，因为算法旨在优化适应度。这通常是一个很好的跟踪指标。
*   由于算法旨在创建一个控制器，我们可以对迄今为止找到的最佳适应度感兴趣，以了解找到到达迷宫出口的控制器需要多长时间。

关于这两个指标，让我们分析优先算法的性能。

![](img/b583c39fcb8dca8eaf57bd19129c8937.png)

正如我们所看到的，SHINE 算法和新颖性搜索都优于 MAP-Elites，因为 MAP-Elites 单元中使用的适应度目标具有欺骗性。我们还注意到，SHINE 收敛得更快，因为它更精确地切割了迷宫中访问量最大的区域。

然而，作为地图精英中使用的适应度目标的副作用，我们注意到个体的平均质量不断增加。相比之下，其他算法的质量停滞不前，因为新奇的目标。

# 我的方法:地图-极坐标

这最后一部分将解释我在设计我的方法时所考虑的直觉和我所获得的结果。

**从上面已经介绍的内容中综合出可以保留的内容**

正如我之前所说的，所有先例方法的主要缺点是它们对超参数的依赖。然而，这些参数允许它们校准它们的质量-多样性权衡。

此外，我们看到 SHINE 算法优于其他算法的原因有很多；一个主要原因是它构造了**定制大小的网格单元。**

**我的方法的一般原则**

在我的方法中，我试图将我的档案从任何超参数中解放出来，同时维护定制大小的网格单元档案。

为了做到这一点，我首先注意到，当我们离目标很远的时候，求新是有用的。当我们开始靠近时，它变得越来越没用，所以与 MAP-Elites 相比，我做的第一个修改是，我使用极坐标来描述最终位置，而不是笛卡尔位置。我以目标为原点。

在那之后，为了适应 SHINE 的想法，我将网格大小缩放到指数级，当远离目标时有大的单元，当接近目标时有小的单元。

**实验结果**

让我们来看看这个新版的 MAP-Elits 与新奇搜索和 SHINE 相比表现如何。

![](img/dbbad6d34cf4abf585900de7ab141838.png)

如我们所见，我们以相当的速度到达目标。尽管如此，我们保留了地图精英算法的副作用，导致人口质量的整体改善。

还有一点，我们没有任何超参数调整。

# 参考书目

[1]d .史密斯，l .托卡尔丘克和 g .威金斯，2016 年。通过层次空间划分进行快速表型景观探索。

[2]让·巴普蒂斯特·穆雷和杰夫·克伦。(2015).映射精英照亮搜索空间。

[3]j .雷曼和 k .斯坦利，2011 年。放弃目标:仅通过寻求新奇的进化。进化计算，19 ，第 189–223 页。

特别感谢 Cassy Deplace 在这个项目中对我的帮助。

项目监督人:公关。斯特凡·东舍