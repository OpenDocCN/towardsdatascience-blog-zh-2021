# GSoC 2021 与 ML4SCI |核磁共振项目

> 原文：<https://towardsdatascience.com/gsoc-2021-with-ml4sci-the-nmr-project-1a5e8995af9?source=collection_archive---------29----------------------->

## 对我的谷歌 2021 代码之夏项目、体验、重要收获和对即将到来的年轻开发者的建议的简短总结。

这篇博客是我在 [ML4SCI](https://ml4sci.org/) 组织下[谷歌代码之夏](https://summerofcode.withgoogle.com/) (GSoC) 2021 项目的简短总结。GSoC 是一个为期 10 周的全球项目，旨在让更多的学生开发人员参与开源软件开发。今年是谷歌代码之夏 17 周年，来自全球 103 个国家的 4，795 名学生提交了 6，991 份提案，其中 1，286 名学生获得了与 199 个开源组织合作的机会。[1]

![](img/25d07f832f5734481c5f88fe2d38278d.png)

GSoC 致力于开源软件|图片来自 [Unsplash](https://unsplash.com/photos/5Ntkpxqt54Y)

## 项目描述和动机

> 本部分面向普通观众。更详细的物理治疗可在以下章节。

在低温下，许多材料转变成电子相，这不能被归类为简单的金属或绝缘体。超导体和自旋液体等物质的新量子相由于其脆弱的性质而更难研究，这使得非侵入性和间接测量变得重要。科学家因此使用核磁共振(NMR)，一种非侵入性的方法从外部探测这些物质。核磁共振是一种实验技术，主要用于质量控制和科学研究，以确定任何样品的分子结构、纯度和含量。GSoC 项目的想法是通过核磁共振的模拟来探索这些材料中电子相与原子核之间的联系。我们分析了由于外部磁脉冲引起的核自旋的时间演化，并使用合适的机器学习模型对它们进行分类。[2]

![](img/790c6e27c1c9cfad61b2dc38738d578d.png)

**项目**的工作流程:我们使用不同的材料参数模拟 NMR 自旋回波实验，以获得材料的平均核磁磁化强度作为时间的函数(如 NMR 实验期间所见)。然后，我们在数据集上使用机器学习来依次预测和分类材料的参数和类型

# ML4SCI 和核磁共振项目

![](img/bdbae3b6a82f6a21d2bbda0938975512.png)

图像演职员表:[GSoC](https://developers.google.com/open-source/gsoc/resources/marketing)&[ML4SCI](https://ml4sci.org/)

## 组织描述

与参加 Google 代码之夏的大多数其他组织不同，我觉得 ML4SCI 在方法和目标上都是独一无二的。虽然大多数组织都在寻找开发人员来建立他们的代码库，解决 bug 和更新新功能，但 ML4SCI 的主要目标是通过使用机器学习开发/使用免费和开源软件来解决基础科学中的开放式研究问题。今年的项目类型从重力物理学的深度学习、天文学、量子机器学习、机器学习到流体湍流、新型量子材料等。

## 项目代码库

我已经将我的工作编译成一个单独的开源库。标题为“[用 NMR](https://github.com/Anantha-Rao12/Decoding-Quantum-States-with-NMR/) 解码量子态”，我们有一套从 NMR 模拟数据中读取、预处理和提取特征的教程。我们还描述了如何训练随机森林分类/回归模型，然后分析特征的重要性，以解释时间序列中的潜在特征。

## 为什么是 ML4SCI？

作为一名物理学专业的学生，我相信我在凝聚态物理、量子力学和人工智能领域的背景和兴趣与 ML4SCI 小组的理念和兴趣，特别是 NMR-GSoC 研究项目非常契合。我以前从事过深度学习在基础科学领域的应用，并且相信 *Python 是科学、工程领域开源软件的巨头*。最后，作为自由和开源软件的倡导者，为开放的科学和社会构建工具总是一种绝对的荣誉。

## 核磁共振中的自旋回波(某些物理学)

> 这一节是给深奥的人看的，初读时可以忽略。

当磁偶极子暴露在两个外部磁场中时，量子系统中会发生磁共振:(1)静态磁场和(2)振荡电磁场。然后，振荡场可以使偶极子以一定的概率在其能量状态之间跃迁，并且当振荡场的*频率导致任意两个能量状态之间最大可能的跃迁*概率时，就可以说已经实现了磁共振。在核磁共振中，我们利用这一基本现象来测量所需材料的各种特性。[3]

一种用于探测核磁共振中分子特性的常用技术被称为“**自旋回波**”。核自旋被排列、释放，然后重新聚焦，形成原始排列的尖锐峰，或“回声”。当自旋通过自旋-自旋耦合相互作用时，磁化中重新聚焦的回波会变得高度失真。科学家和研究人员经常使用这种研究磁化曲线以确定电子相位的技术。我们使用这些模拟的核磁曲线来训练机器学习模型，以预测模型参数和底层材料的种类。

![](img/d86b172345d39103f7e45470ac2b9787.png)

虽然核磁共振“自旋回波”技术听起来可能很复杂，但下面由加文·W·莫利(【https://en.wikipedia.org/wiki/Spin_echo】)创作的动画让它变得清晰多了！

## 模拟电子和核自旋

大多数材料可以根据它们的电子性质分为三类:金属、绝缘体和半导体。这些电子通过[超精细相互作用](https://en.wikipedia.org/wiki/Hyperfine_structure)与材料的核自旋(非常非经典的东西)相互作用，如果电子-核耦合变得足够强，一个不可忽略的两步过程可以使整个材料中的原子核相互耦合。这个两步过程是当一个核自旋耦合到一个电子并改变它的运动时，然后这个电子在材料的其他地方“散射”出另一个核自旋。我们通过位置 r_j 和 r_i 处的原子核之间的有效自旋-自旋耦合来表示这种两步散射过程，由下式给出:

![](img/6dcb11e485fd3b2b0e9bde0f5ed8f2ec.png)

材料中两个核自旋之间的有效耦合|作者图片

其中，α为耦合强度，ξ为耦合长度。一般来说，α和ξ取决于核-电子耦合的细节和电子的量子状态，但在我们的工作中，我们将使用它们来查看自旋回波实验是否可以提供足够的信息，以从单个 M(t)曲线精确地“逆向工程”这些值。我们的模拟还包括核自旋的耗散:由于与环境的耦合，自旋信息可能会“丢失”。这发生在时间尺度 t(decay)≃√γ.我们的目标是开发一个 ML 模型，它可以从一条 M(t)曲线中精确地确定上述三个变量(α、ξ和γ)。

## 数据集(一些数据科学和一些物理学)

今年夏天，我们努力将核磁共振扩展到感测强电子自旋-自旋关联和原子核之间的非耗散自旋-自旋相互作用。为了研究广泛的物理现象，我们在具有不同种类的核间相互作用和耦合强度的 2D 自旋的**晶格上模拟了典型的 [NMR 自旋回波实验](https://en.wikipedia.org/wiki/Spin_echo)的行为。我们采用径向高斯、RKKY 和幂律型核来模拟长程(来自有隙自旋激发)和短程(来自无隙自旋激发)相互作用。由于在自旋回波期间测量的平均磁化强度是局部相互作用类型和底层材料的电子磁化率的函数，我们旨在理解材料类型，并仅基于回波曲线的形状从机器学习分类和回归模型预测耦合强度。我们使用的数据集是在多次自旋回波模拟期间测量的作为时间函数的平均核磁化强度的大小。**

```
from NMR_ML import Dataset# Create the dataset object
gaussian_data=Dataset(data_directory_path="data//2021-08-14_gauss/")# Load rawdata and get the desired time-window
rawdata = gaussian_data.load_data()
rscl_df, echo_pulse = gaussian_data.get_window(rawdata, center_ratio=2/3, width=150)# Repeat the process for the Power-Law and RKKY datasets
```

![](img/bed90d979b7aa91534dbef1492360ce3.png)

我们用于机器学习实验的数据集。顶部面板显示了整个时间序列数据集。中间部分显示了三种径向内核类型和在 interst 区域中的相应自旋回波曲线。在下图中，我们看到了 NMR 实验旋转坐标系中时间序列的频率分布。|作者图片

## 方法

为了实现更高水平的可解释性，我们使用不同的特征空间，即逐点时间序列、逐点频率分布和多项式特征。我们通过一种叫做**多尺度多项式特征化**的技术从时间序列中提取特定特征。这里，我们将时间序列划分为等长的仓，并在每个仓中拟合一个三次多项式。我们使用这些系数作为曲线的新特征。最后，我们对新特征执行回归和分类等任务。[4]

![](img/3dac247c0e90586e1ebf67c482dcbf6e.png)

所用方法的总体流程。我们同时使用逐点和多项式特征以获得更高的可解释性|作者图片

![](img/6e1db4940267de48325fcc3e53083879.png)

**多尺度多项式特征化:** (a)我们将时间序列分成相等的 4、5 或 10 个部分的仓，称为“多项式域”，以及(b)在每个仓中拟合三次多项式。我们使用每个这样的拟合多项式的系数作为新提取的特征数据集| **图像由作者** | **从 Torrisi** 等人的“用于可解释的 X 射线吸收近边缘结构光谱-性质关系的随机森林机器学习模型”得到启发 *npj 计算资料*6.1(2020):1–11。

```
from NMR_ML import Dataset, PolynomialFeatures# Create the dataset object
gaussian_data = Dataset(data_directory_path="2021-08-14_gauss/")# Load rawdata and get the desired time-window
rawdata = gaussian_data.load_data()
rscl_df, echo_pulse = gaussian_data.get_window(rawdata, center_ratio=2/3, width=150)# Obtain the polynomial features dataset
polynomial_features = PolynomialFeatures(n_splits=[4,5,10], order_fits=[3,3,3])
```

# 结果

我们建立了两个分类模型来将磁化时间序列分类为三种相互作用类型，并建立了回归模型来预测相互作用参数(αx，αz，ξ)或整个自旋集的总核积分(W =σK(r(I，j))。我们使用集成学习并结合许多弱决策树学习器来构建随机森林分类器/回归器。此外，我们从时间序列和频域数据中提取基本特征，以理解回波脉冲期间对理解材料最有用的子部分。关于特征提取方法和 ML 技术的更多细节可在“ [/Tutorial-nbs](https://github.com/Anantha-Rao12/Decoding-Quantum-States-with-NMR/tree/main/Tutorial-nbs) ”部分获得。

*   有了相互作用类型的知识，我们就能够预测 R 约为 0.8 的核积分(W)的值。我们观察到，回归的最重要特征是回波前区域的平均值(x⁰)和正好在回波脉冲(x，x)处的磁化的斜率和曲率

![](img/dc1c92cbbe1854d97a6ba00c139f1ce3.png)

**回归结果**:这里，我们使用数据集的四个版本。我们使用来自作者的时域和频域|图像的逐点和多项式特征

*   使用随机森林分类器，我们能够在对幂律与非幂律类型的回波曲线进行分类时获得~0.9 的良好 F1 分数。本质上，我们能够在核磁共振实验中仅通过观察样品的平均磁化强度来对材料原子核之间的相互作用类型进行分类。

![](img/045a2989faa4c601e415d464e63f9a62.png)

**分类结果**:使用混淆矩阵，我们看到在较高的核积分(W)上，分类器在区分幂律和非幂律类型方面工作得更好

# **未来工作**

尽管我们能够实现[项目建议书](https://github.com/Anantha-Rao12/Decoding-Quantum-States-with-NMR#mentors)中提到的大部分目标，但我们认为仍有改进的空间，并将更多地关注以下方面:

*   基于结果部分描述的结果，我们希望进一步探索深度学习是否可以在分类/回归方面提供更好的性能，而不会损害模型的可解释性。尽管这将需要更大的数据集和计算能力，但获得的新见解将非常有助于识别新的物理学，并进一步有助于利用数据革命来构建和探索新的量子材料。
*   我们还想探索在计算机上优化和调整所施加的磁脉冲，以设计一个能够以更高精度预测耦合强度的实验。

我希望这个项目和 [NMR_ML 脚本](https://github.com/Anantha-Rao12/Decoding-Quantum-States-with-NMR/blob/main/NMR_ML.py)有益于试图解决类似问题的人。虽然不是完美的解决方案，但我希望这些脚本可以让您了解如何处理这个问题。如果你发现了一些有用的东西，请考虑主演[库](https://github.com/Anantha-Rao12/Decoding-Quantum-States-with-NMR/)，创造一个问题，或者只是下降一个消息！

## 最后的想法和信息

我要感谢我的项目导师[斯蒂芬·卡尔](https://scholar.google.com/citations?user=wp4CJKUAAAAJ&hl=en)博士、查尔斯·斯奈德[维斯纳·米特洛维奇](https://scholar.google.com/citations?hl=en&user=gQIcPSoAAAAJ)教授、[钱德拉舍卡·拉马纳森](https://scholar.google.com/citations?hl=en&user=EBSaHLkAAAAJ)教授和[布拉德·马斯顿](https://scholar.google.com/citations?hl=en&user=eFlwPJYAAAAJ)教授、整个 NMR 研究小组和整个 ML4SCI 社区，感谢他们不断的支持、激励和指导。我在这个超级令人兴奋的项目上度过了一个美好的夏天，我期待着在追求知识和重新兴奋的过程中继续合作！

最后，对未来的程序员和希望参加 GSoC 的学生的一些建议，请将 GSoC 视为一个你本来就想从事的项目，而不是为了一个证书或一个荣誉的象征而做的事情。如果与你的长期目标和职业抱负保持一致，这将是一个更有回报的过程。它是关于学习、创造和回馈一个由优秀开源开发者组成的社区，并成为原创科学研究的一部分(就我而言)。如果你有合适的技术技能和背景，找到符合你兴趣的利基项目并不像听起来那么难。一个人在夏天需要掌握的最重要的非技术技能是交流、交流和沟通！

来自我的导师斯蒂芬·卡尔博士的信息:

> SOC 为学生提供了有价值的结构和目标。这对于相对短暂的夏季研究经历至关重要，因为大多数传统的研究项目会持续数月或数年。申请过程提供了大量有不同背景和兴趣的热情学生的选择，帮助确保每个学生找到一个很适合他们的项目(反之亦然！).

感谢 ML4SCI，感谢布朗大学，感谢谷歌，给了我这么美好的学习机会。

# 参考资料:

[1][https://open source . Google blog . com/2021/05/Google-summer-of-code-2021-students-are . html](https://opensource.googleblog.com/2021/05/google-summer-of-code-2021-students-are.html)

[2]https://ml4sci.org/gsoc/2021/proposal_NMR.html

[3]c .科恩-坦努吉、b .迪乌和 f .拉罗(1986 年)。量子力学，第二卷。*量子力学*， *2* ，626。

[4] Torrisi，Steven B .等人，“可解释的 X 射线吸收近边缘结构光谱-性质关系的随机森林机器学习模型。” *npj 计算材料*6.1(2020):1–11。