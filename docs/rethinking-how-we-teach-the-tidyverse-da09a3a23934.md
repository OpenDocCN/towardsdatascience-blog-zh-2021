# 重新思考我们如何教 tidyverse

> 原文：<https://towardsdatascience.com/rethinking-how-we-teach-the-tidyverse-da09a3a23934?source=collection_archive---------29----------------------->

## 从一个 tidyverse 粉丝的角度尝试“不偏不倚”的观点

![](img/b954cdbe507e29be2e0701ba95b4e5de.png)

由 [Kelly Sikkema](https://unsplash.com/@kellysikkema?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

我最近参加了一个相对流行的[堆栈溢出“竞赛”](https://stackoverflow.com/questions/65603511/fitting-several-regression-models-by-changing-only-one-independent-variable-with/65644784#65644784)(“流行”在堆栈溢出上到底意味着什么？？)，其中的提示是为所呈现的解决方案编写一个更“优雅”的`dplyr`或`tidyverse`解决方案。

问题陈述要执行两个回归:1) `dep ~ cov_a + cont_a + cont_b`和 2) `dep ~ cov_b + cont_a + cont_b`。

这是最初发布的代码:

```
map(.x = names(df)[grepl("cov_", names(df))],
    ~ df %>%
     nest() %>%
     mutate(res = map(data, function(y) tidy(lm(dep ~ cont_a + cont_b + !!sym(.x), data = y)))) %>%
     unnest(res))
```

这是提供的样本数据集:

```
set.seed(123)
df <- data.frame(cov_a = rbinom(100, 1, prob = 0.5),
                 cov_b = rbinom(100, 1, prob = 0.5),
                 cont_a  = runif(100),
                 cont_b = runif(100),
                 dep = runif(100))
```

如果你愿意，可以在这里暂停一下，试着想出一个有趣的解决方案！

如果你对`tidyverse`一点都不熟悉，那么我建议你跳到下一节，在那里我会对它做一个更全面的概述。但是请原谅我，因为我想用这个例子来说明我从`tidyverse`中意识到的一个基本问题。

我发布了一个初步的解决方案。然后有人贴了 3 个解决方案。然后又提出了 4 个独特的`tidyverse`解决方案。那就是一共有 9 种不同的方法来解决函数化生成两个回归模型的问题(包括最初发布的解决方案)。

这是什么意思？8 个方案是不是太多了？有这么多方法来解决一件事是好现象吗？让我们深入研究一下。

**什么是潮汐？**

看待`tidyverse`的一种方式是将其视为[哈德利·威克姆](http://hadley.nz)的创意。`tidyverse`是一组不断进化的 R 包(如`dplyr`、`purrr`等)。)旨在提供一个统一界面，允许“整洁”的工作流。这个“整洁”的概念建立在[整洁数据](https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html)原则的基础上，我已经包含了一个链接。简而言之，整齐的数据有三个特征:

1.  每个变量形成一列
2.  每个观察值形成一行
3.  每种类型的观测单位形成一张表

“整洁”的工作流程背后的渴望更难定义。哈德利目前将其概念化为四个主要原则:

1.  重用现有的数据结构
2.  用`%>%`又称“管道”来组合函数
3.  使用函数式编程
4.  为了使代码更易于阅读

要阅读更多关于他对每个原则的想法，请查看他的宣言。

**那么，有争论吗？**

是的，外面有持不同政见者。我个人不是其中之一，但我想我明白他们来自哪里。一个受欢迎的异议者是诺姆·马特罗夫，他写了一篇马丁·路德式的 95 篇论文，阐述为什么推广 T2 是倒退。他引用的最大原因是可教性——T3 让 R 变得更难学，并且阻碍了基本的 R 知识。

我不认为我完全同意这一点。

Matloff 列举了教授`tidyverse`困难的两个主要原因。

1.  它的认知超载了
2.  它掩盖了传统的编程技巧，并且是反直觉的(**后来我有机会与 Norm 交谈，他澄清了第二点，意思是 tidyverse 哲学强调“函数式编程”**)

以下是我对他第一点的看法。

以我前面提到的堆栈溢出为例。有九种不同的基于 T5 的方法来做某事。因为`tidyverse`是由*系列*包组成的，解决一个数据争论问题更像是建造一个乐高房子，而不是修理一个堵塞的水槽。在后者中，可能有一个标准的最佳方式，而在前者中，有一些更深层次的东西——有一种创造力、艺术的感觉。你不仅仅是在建造一所房子，你还想让它尽可能的稳定，尽可能的漂亮。也许你想尽快建立它。你可以实现很多不同的目标，而`tidyverse`试图给用户提供这些构建模块。

但是我明白，如果你有大量各种各样的积木，很难建造一个乐高房子——你需要说明书。不幸的是，因为`tidyverse`在不断发展，所以很难编写说明书。例如，`*_at()`和`*_if()`功能被`across()`取代。代替`gather`或`reshape`包，我们现在打算使用`pivot_*()`函数。可能很难跟上。你的代码可能会在几个月内迅速过时——它仍然可以工作，但会过时。

以下是我对他第二点的看法。

有趣的是，几乎我所有在大学学习计算机科学的朋友，学习 C 或 Java 之类的语言，都抱怨 r。它绝对是一种奇怪的编程语言。但是，R 仍然保持了许多与其他编程语言相同的逻辑和语法。

然而，在`tidyverse`中我们有类似`%>%`的东西。对于门外汉，这是一个 WTF 时刻。

突然，像这样的事情:

```
c(1,2,3) %>% mean()
```

工作，尽管它完全不同于任何其他类型的“传统”编程。但是，Matloff 的观点是，这对于完全的编码初学者来说很难理解。(**编辑:Norm Matloff 已经阐明了他对管道的观点，即“对于一个变量的函数来说，管道很好(尽管不是有益的)，如果有多个变量，就非常混乱了”，并强调函数式编程很难掌握(我同意这一点)，因此对于初学者来说，将此作为“他们学习的关键”是不合理的，这一点我理解)。有大量的证据围绕着所谓的歧义容忍度和语言学习。基本上，适度的歧义容忍度与提高学习第二语言的能力相关。我认为我们应该更加相信学生对歧义的容忍度，并且相信一个完全的新手不会被`tidyverse`语法完全弄糊涂。当然，我并不是说学生根本不应该学习基本的 R 语法。我认为`$`操作符，索引一个向量，写循环，等等。是非常有用的技能，我全心全意地支持它作为学生 R 教育的核心部分。但是，我想说的是，我认为我们应该容忍`tidyverse`带来的看似陌生的东西。**

**那么我们该怎么教呢？**

我认为堆栈溢出问题让我意识到没有一种通用的编码方法。人类可读是什么意思？我们在乎速度吗？我们应该只使用最常用的功能吗？然而，这些可能是以后在学习 r 的层次中要问的问题。记住，初学者的基本需求通常是从输入到输出。我认为教`tidyverse`的一种支持方式是:

1.  设置标准课程，教授基本的核心 R 概念，并在此基础上构建`tidyverse`词汇来处理数据(毕竟，R 是一种统计编程语言)。比如，使用这本[网络教材](https://r4ds.had.co.nz)。
2.  强调一些功能可能已经过时，但是学生需要一个基础词汇来开始做事情
3.  强调很少有完美的解决方案。使用`tidyverse`就像说一种语言，它不仅有功能，而且是一种交流方式。学生应该可以很好地学习交流，非常基础，但流利，并建立他们的技能，更漂亮，更流利地表达代码

**编辑:最终由学生个人决定他们的教育旅程。我在这篇文章中公开表明了自己的立场，我和 Norm Matloff 以及其他人就不同的观点进行了精彩的富有启发性的对话。我鼓励学生以对他们有意义的方式塑造他们的学习方法(无论是否通过 tidyverse！)**