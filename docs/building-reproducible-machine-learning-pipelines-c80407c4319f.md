# 构建可复制的机器学习管道

> 原文：<https://towardsdatascience.com/building-reproducible-machine-learning-pipelines-c80407c4319f?source=collection_archive---------23----------------------->

## 如何安全地部署机器学习模型

![](img/f49d05f966e4a98a3e187909b2f33d33.png)

照片由 [JJ 英](https://unsplash.com/@jjying?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

可重复性是企业进一步理解和信任机器学习在我们日常生活中的应用所需的责任。

随着机器学习变得更加生产化，许多企业和研究人员可能会感到不得不匆忙采取行动，这不利于充分理解实现某些方法所涉及的复杂性，或者在没有正确程序的情况下匆忙完成过程会牺牲什么，所有这些都是为了更快地获得结果。

随着信息唾手可得，机器学习失败成为头条新闻，就像[微软的 Twitter 聊天机器人](https://www.theverge.com/2016/3/23/11290200/tay-ai-chatbot-released-microsoft)的情况一样，公众的怀疑态度增加了，因此强调了任何方法中可重复性的必要性和重要性。

> **注**:本文中的内容摘自我在 Udemy 上的机器学习模型部署课程的笔记。

## 什么是再现性？

在机器学习环境中，再现性是指精确复制模型的能力，使得当模型被传递相同的输入数据时，复制的模型将返回相同的输出。

未能事先考虑再现性可能会在开发过程中产生一些后果。一个典型的例子是从金融的角度。如果一个人在研究环境中对模型开发投入了大量资源，但在生产中却无法重现模型，那么模型及其预测基本上是无用的。这浪费了时间、精力和资金，全都付诸东流。

此外，再现性在允许我们对照以前的解决方案检查我们的机器学习模型方面起着关键作用。如果不能再现以前的结果，我们就无法准确区分新模型是否超过了以前模型的性能。

## 再现性的挑战

在创建和构建机器学习模型时，从业者将在整个过程中在多个环境中工作——一个环境描述了软件(或其他产品)被开发或投入运行的计算机的状态。开发机器学习模型通常涉及三种环境:

1.  **研究环境** —在研究环境中，数据科学家将执行数据分析以了解数据，构建模型，并对其进行评估，以更好地了解模型正在做出什么决策，以及它是否符合项目预期结果的标准。
2.  **开发环境** —在开发环境中，机器学习工程师寻求重现在研究环境中开发的机器学习流水线。该环境还结合了软件工程最佳实践，以确保管道可以作为一个适当的软件系统运行。
3.  **生产环境—** 在生产环境中，模型能够服务于其他软件系统和/或客户。

研究环境之外的每个环境都试图复制管道开发的研究。但是，每个环境达到所需状态的步骤是不同的。从数据采集到从模型获得预测，这几乎在流水线的每一个单独步骤中都给再现性带来了许多潜在的障碍和挑战。

## 数据收集的再现性

[*永远记住数据先于科学*](/always-remember-data-comes-before-the-science-681389992082)；没有数据，机器学习模型是没有意义的。数据采集是再现性主题中最重要也是最难解决的问题之一。

> “一个模型永远不会完全一样，除非用完全相同的数据和过程来训练它。”——索勒达德·加利博士。机器学习模型部署(Udemy)讲师

当在研究环境中工作时，数据科学家可能可以访问一个版本的训练数据，然而，当机器学习工程师必须在生产中再现流水线时，数据可能已经改变。这取决于一些数据库的工作方式。他们可能会不断地用更新的版本覆盖旧版本的数据，从而随着时间的推移改变训练数据。此外，如果数据科学家使用 SQL 查询数据，则会引入随机性，因为 SQL 会随机地将数据加载到内存中。

虽然没有一种方法在所有情况下都是绝对可靠的，但是有很多方法可以解决这些问题。例如，一个解决方案可能是确保数据科学家保存用于建立模型的训练数据的快照。当数据非常大时，如果它妨碍团队遵守数据法规，这种方法就会失败。

另一种方法，也可能是更理想的方法，是向数据源添加准确的时间戳，这可以在以后用于识别哪些数据用于训练模型。但是，请务必注意，如果在进行更新时数据不断被替换，这种方法不能解决问题。进一步补充一下，如果数据库不是为跟踪时间戳而设计的，那么可能需要很大的努力来集成这一功能。

## 特征工程中的再现性

如果我们在数据采集阶段的再现性方面出错，那么在试图再现管道的特征工程阶段时，可能会出现问题。

> “如果两种环境中的数据不相同，从数据中得出的参数将会改变”——Solledad Galli 博士。机器学习模型部署(Udemy)讲师

假设数据中有缺失值，而数据科学家选择通过输入要素的平均值来填充这些值。如果研究和生产环境中的训练数据之间存在差异，那么特定功能的平均值也可能存在差异。当然，如果来自研究环境的训练数据可以被复制，那么这个问题就消失了。

在特征工程阶段，可能阻碍再现性的其他因素包括:

*   复杂的提取方法(问题与研究环境中数据缺乏可重复性有关)
*   不保持超参数不变(它们必须在不同环境之间保持不变)
*   依赖于随机采样的特征生成方法(设置种子参数可确保生成相同的样本)

利用版本控制的力量来跟踪所有的差异可以解决与再现特征工程阶段相关的问题——如果它们不是源于不能再现数据获取阶段的话。

## 建模中的再现性

一些机器学习模型在训练过程中引入了随机性，这给再现性带来了挑战。这种现象的一个主要例子是树集合(随机森林，梯度增强等。)和神经网络。

例如，[随机森林](/algorithms-from-scratch-decision-tree-1898d37b02e0)模型在构建每一棵树时使用装袋和特征随机性来创建不相关的森林。并且，神经网络在权重初始化期间引入了随机性。这种随机性会导致模型之间的不一致，无论它们是否基于相同的训练数据。

与特征工程类似，应对这种再现性威胁的简单解决方案是在需要时设置种子和跟踪超参数。

## 部署中的再现性

在机器学习工作流的部署阶段，再现性的挑战围绕着将模型集成到其他系统的失败。

部署中再现性失败的一个主要例子是，用于训练模型的群体不能代表真实环境中的群体。这可能是由于在实际或研究环境中使用了在建模时未被检测到的过滤器，或者构建模型的数据科学家没有完全理解模型在生产中的使用方式。

另一种情况发生在编程语言在不同环境之间变化的时候。机器学习通常用 Python 或 R 来完成，而应用程序通常使用 C++或 Java。这可能会激励团队用另一种语言再现研究环境，从而显著增加 1)人为错误和 2)部署错误的可能性。使用一种编程语言是克服这一挑战的最佳方式。

最后，软件版本的改变可能妨碍在部署中再现机器学习流水线的能力，因为每个改变可能导致流水线内的差异。这个问题不太常见，然而，它可能是最难解决的，因此确保所有软件环境在整个过程中是相同的是至关重要的。

## 包裹

数据科学家和机器学习工程师在试图确保机器学习工作流的可重复性时，往往会面临几个挑战。虽然有些问题需要重大变革才能克服，但其他问题可能相当简单(例如，埋下种子)。要点是，必须解决所有潜在的再现性障碍，以获得真正的再现性。

感谢您的阅读！

如果你喜欢这篇文章，请通过订阅我的**[每周简讯](https://mailchi.mp/ef1f7700a873/sign-up)与我联系。不要错过我写的关于人工智能、数据科学和自由职业的帖子。**

## **相关文章**

**<https://medium.datadriveninvestor.com/machine-learning-model-deployment-b1eaf7ca96cd>  </data-scientist-should-know-software-engineering-best-practices-f964ec44cada>  </the-machine-learning-workflow-1d168cf93dea> [## 机器学习工作流程

towardsdatascience.com](/the-machine-learning-workflow-1d168cf93dea) <https://medium.datadriveninvestor.com/machine-learning-engineers-must-read-these-5-books-583e81922b84> **