# 什么是“Python 环境”？(适用于初学者)

> 原文：<https://towardsdatascience.com/what-is-a-python-environment-for-beginners-7f06911cf01a?source=collection_archive---------13----------------------->

## [入门](https://towardsdatascience.com/tagged/getting-started)

## 清晰地分离出关键概念，以揭开环境创建过程的神秘面纱

![](img/beba3b584c9d7bd04020cce884fc15e8.png)

照片由 [Artturi Jalli](https://unsplash.com/@artturijalli?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

由于没有计算机科学背景，并且是“在职”学习编程，建立并运行一个稳定的 python 环境的整个过程令人望而生畏。出现了大量的步骤、新的术语(`sys.path`、“虚拟环境”/“venv”、过时的`$PYTHONPATH`等等。)以及许多工具(pip、pyenv、venv、conda、poems ),这些工具本应使事情变得更简单，但也许在这个过程中:

*   隐藏更简单的设置工作(尤其是对初学者而言)，这样你永远也不会真正明白发生了什么
*   具有不同的范围，因此一些工具做一件事(依赖管理或虚拟环境设置)，其他工具做几件事(如 conda 和 poems ),所以很难知道什么应该用于什么

这是我在 2021 年深入研究 python 环境的笔记集，目的是:

*   我自己明白
*   减少我点击紫色堆栈溢出链接的次数，因为 4 年前这些信息“左耳进右耳出”
*   考虑改变我以前学到的东西(conda+setuptools ),不要仅仅因为“如果它没坏就不要修理它”而质疑

## 一个稳定运行的环境有哪些组成部分？

在某种程度上——目标是什么？大多数人倾向于同意，当编写您希望重用或共享的 python 代码时，忘记了实际的代码本身，您需要以下内容:

*   易于操作，并且知道它以前是否工作过，它将继续工作(环境管理)
*   易于与可能使用不同版本的 python 和其他包(python 版本和依赖性管理)的其他东西一起工作
*   易于与其他人共享(包构建和分发)
*   当其他人得到它时，他们可以毫无问题地运行它(环境管理)
*   如果他们也依赖于其他人的代码，他们可以运行它(依赖管理)
*   如果上述事情变得有问题，要么很容易解决，要么如何解决就很清楚了(环境管理)

在创建考虑这些因素的 python 设置时，可以将问题分成几个子问题。

**环境管理(venv、康达、诗)**

这涉及到能否在计算机中设置一个容器，确保运行代码所需的一切保持不变。这通常采取目录结构的形式，其中包含您需要的内容，但也可能做一些事情，例如为目录外的您需要的内容设置稳定的方向。保持事情稳定是非常好的，因为它确保了某一天编写的未更改的代码在第二天也能工作。如果环境也是公式化创造的，那么它也可以公式化描述。这很好，因为您用来运行代码的环境可以公式化地表达出来，这样，如果其他人想要运行该代码，他们只需要遵循确切的方法，就可以有一个确切的匹配环境，并确保它不会“随机”对他们无效。

**Python 版本控制(pyenv)**

Python 是一种语言，就像它开发的所有语言一样。为了避免不断变化的语言完全混乱，变化/更新是离散的，每个新版本都有一个版本号来标识它。如上所述，为了确保未更改的代码继续工作，您需要确保您继续使用相同版本的 python——或者至少直到您已经测试出相同的代码可以在不同(希望是更新的)版本的 python 上工作。如果您有多个项目，每个项目都使用不同版本的 python(要么通过选择，要么因为依赖关系而不得不这样做——稍后将详细介绍),这可能会带来问题，因此理想情况下，当我们处理不同的项目时，我们可以运行不同版本的 python。这就是 Python 版本管理。

**包安装(pip、康达、诗)**

很可能你写的所有代码都不是你的，因此你会想利用一些已经写好的代码。Python 预装了一大堆组成 [Python 标准库](https://docs.python.org/3/library/)的东西，但是还有很多其他的包，你宁愿利用它们也不愿自己编写(NumPy、pandas、SciPy 等)。我们需要一种方法将这些东西放到我们的电脑上——或者更具体地说，放到我们已经在电脑中创建了*的环境中。幸运的是，正如[这段视频](https://www.youtube.com/watch?v=AQsZsgJ30AE)所解释的，有人致力于标准化这一点，并创建了一个名为 [PyPI](https://pypi.org/) 的所有这些包的数据库。一旦代码被一致地记录在那里，我们就需要一种方法去那里获取它并将其安装到我们良好控制的环境中。我们还希望有一种方法来确保，如果我们有多个如上所述的使用不同版本 python 的项目，那么我们可以将可能相同的包的正确对应版本安装到它们各自的环境中。这是包安装。*

**依赖管理(康达，诗)**

上面的软件包安装听起来很简单:

*   给它一个需求清单
*   它进入互联网上的一个数据库并收集它们
*   它使用它们都符合的标准化指令来安装它们

但是就像 python 语言本身一样，这些其他的包也在不断变化。事实上，*因为* python 在不断更新，所以这些其他的“第三方包”也在更新——因为它们需要被测试和更新以使用底层 python 标准库的更新版本。并且有可能利用新的特性来扩展或改进现有的功能。由于大量的包在随机的日子里更新，并且对它们所依赖的东西有不同的需求，所以最终两个包依赖于另一个共享依赖的冲突版本并不困难。解决这些冲突，使得我们需要的所有依赖关系，给定我们可能已经指定的约束，都可以被获取和安装，这就是依赖关系管理。

**包构建和分发(setuptools，诗歌)**

到目前为止，我们只讨论了如何在假设我们需要获取他人编写的代码的情况下构建一个稳定的环境。但是，如果有一天，我们编写的代码，在这个稳定的环境下，可能对其他人有用，并且我们愿意分享它，那该怎么办呢？我们要通过电子邮件发给他们吗？我们最好将它提交给前面提到的 python 代码 PyPI 数据库，这样，就像我们所依赖的一切一样，其他人也可以以一种易于安装和准确理解的方式依赖我们的代码:

*   如何安装我们写的东西(标准化格式的代码)。文件)
*   您的代码可以使用什么代码(我们的代码具有的依赖约束集——如果有的话)

要做到这一点，我们需要一种方法来将我们的代码构建到一个“包”中，其中包含所需的所有相应元数据。标准化是这里的关键，以一种相对轻松的方式确保这种标准化是包装的构建。

## 仅仅写几行 python 代码似乎太多了

上面的许多步骤可能会给人这样的印象:仅仅是编写一点 python 代码，这是一项极其困难的任务。显然，在本地编写一点 python 代码就像打开命令行并输入`python`一样简单(MAC 电脑已经预装了它)。但是要写一些更实质性的东西，这似乎是一种努力和复杂的负担，特别是对于一个刚刚开始并且不知道许多“最基本”单词是什么意思的人来说。让事情变得复杂的是，上面提到的工具掩盖了实际发生的事情，甚至会让理解手头的基本问题变得更加混乱:

*“当您在命令行中键入单词* `*python*` *时，我们如何准确地控制会发生什么，以便我们可以访问我们需要的一切(模块、包)并且这种访问保持‘确定性’？”*

解决这个问题意味着工作代码将一直工作，并最终节省调试棘手版本问题的时间。为了理解一些非常聪明的人是如何开发工具来帮助我们做到这一点的，我们可以看看下面两件事:

*   系统路径(`$PATH`)
*   python 的`sys.path`变量和“模块搜索路径”

让我们在下一篇文章中看看系统变量`$PATH`是如何工作的，并深入探究流行的 python 工具(pyenv、conda、poems)是如何操纵它来简化 python 版本管理的。

<https://markjamison03.medium.com/python-the-system-path-and-how-conda-and-pyenv-manipulate-it-234f8e8bbc3e> 