# 数据融合:谷歌云数据仓库的无代码管道

> 原文：<https://towardsdatascience.com/data-fusion-a-code-free-pipeline-for-your-google-cloud-data-warehouse-5b31dd4be91e?source=collection_archive---------15----------------------->

## 无需专业技能，只需几天而不是几个月就能建立企业级端到端数据平台

尽管过去五到十年发布了大量基于云的大数据平台和应用程序，但创建数据仓库通常仍是一项艰巨的任务，需要独特的技术技能来设计、设置和日常操作。在将数据融合添加到其 SaaS 解决方案组合后，谷歌云旨在提供一种解决方案来克服这些挑战，并让每个用户都有能力创建和管理企业级数据平台。

这是及时的，因为对于许多公司来说，新冠肺炎不仅严重破坏了现有的数据源和商业智能操作和仪表板，还造成了快速使用数据的额外压力。与此同时，经济的不确定性削减了预算和资源。如今，几乎每个人都比以往任何时候更需要更简单的解决方案，由于其直观的拖放式用户界面，数据融合可以为许多组织提供极大的帮助。

![](img/5cfed313a012313d9e80395e23b4b417.png)

照片由[西格蒙德](https://unsplash.com/@sigmund?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 拍摄

# 用例

关于数据融合的公开或社区内容仍然很少，即使它已经在谷歌云平台上普遍[提供了一年多](https://cloud.google.com/blog/products/data-analytics/introducing-the-code-free-bridge-to-data-analytics-on-google-cloud)。即使数据融合仍然处于初级阶段，我也想分享我的印象，并解释它是如何信守承诺的。也就是说，

> 数据融合如何允许在几天而不是几个月内建立一个端到端的数据仓库，

同时满足以下要求:

![](img/d4760313635bf0a0e44e4a02afd08ceb.png)

维克多·加西亚在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

1.每天接收由单租户服务器集群产生的数百千兆字节的压缩数据；

2.定期为每个实体制作 PDF 报告；

3.为一些团队成员提供商业智能工具，他们可以修改现有的仪表板，创建新的仪表板，并通过简单的用户界面查询和可视化最新数据；

4.为未来的机器学习敞开大门。

它还满足了这种性质项目的严格限制，包括

5.零资本支出和低运营支出的基于消费的成本模式；

6.尽可能多的 SaaS 和自助服务；和

7.最少量的编码或高度技术性的操作；

# 示例架构

> 数据融合本质上是协调所有的管道步骤，从第三方数据的**摄取**，到转换数据到分析数据库的**加载**。 [Data Studio](https://datastudio.google.com/overview) 然后根据转换后的数据创建商业智能报告。

![](img/4f1020d5cafdacac710ecc8074ae4b14.png)

利用数据融合、云存储、大查询和 Data Studio 的数据平台的架构图。作者图解。

请注意，数据融合与谷歌的大部分产品组合无缝集成，因此这里提到的几个解决方案可以被其他谷歌云产品取代。例如，这个用例使用[云存储](https://cloud.google.com/storage)作为数据湖，使用[大查询](https://cloud.google.com/bigquery)作为数据仓库，但是存在许多替代方案。在本例中，管道经过以下步骤:

## 1.摄入谷歌云存储

Blob 存储是构建存储原始和非结构化数据的数据湖的明显候选，这是摄取步骤将首先存储数据的地方。数据融合为大多数数据源提供了连接器，包括存储帐户、其他公共云、FTP、Oracle 等数据库等。还有许多方法可以将原始文件发送到谷歌云存储，从高度自动化的解决方案和传输实用程序到依赖虚拟机的更多手动解决方案。

## **2。数据融合工作流程**

数据融合提供了一个易于使用的拖放用户界面来创建数据管道，称为集成。集成允许用户创建具有三种类型元素的管道:

1.  数据源——比如谷歌云存储
2.  转换，位于输入和输出之间
3.  汇，即输出——比如 Big Query，这是谷歌著名的 SaaS 数据仓库解决方案，专门用于分析工作负载

![](img/21732e8f865f4208552aee9cf31d54eb.png)

数据融合的基本工作流程:数据输入(源)-转换-数据输出(汇)。作者截图。

每个管道必须至少包含一个源和一个接收器(数据融合不允许“空”箭头)。

**示例**

在从 Google Gloud 存储中读取所有匹配的文件名后，我们的第一个 ETL 管道分为两个路径:

第一个用处理 CSV 文件的内容

*   用 Javascript 编写的第一个逐行转换，
*   一个解析 CSV 文件的“牧马人”，
*   大型查询的接收负载

第二个示例使用

*   Group By 和 Count 计算文件中的记录数，
*   添加时间戳的 Javascript 转换，
*   一个大型查询接收负载，
*   最后是文件移动，在成功加载后将文件归档到不同的 Google 云存储目录中。

![](img/97b0853e3fd5d4decf7163a6e69c3e94.png)

数据融合示例工作流从云存储接收数据，并将转换后的数据插入到大查询中。作者截图。

数据融合始终依赖于强类型模式，因此每次转换都会接收到可预测的输入并产生可预测的输出。例如，Google Cloud Storage reader 会将每个逐行读取的属性传递给下一个转换:一个字符串“body”表示行的内容，一个字符串“path”表示文件路径。当需要逐记录而不是逐行读取输入文件时，也可以使用 XML 阅读器。

**转换**

数据融合提供的最强大的工具是数据转换，其中包括[牧马人](https://en.wikipedia.org/wiki/Data_wrangling)。

> wrangler 允许用户使用直观的图形用户界面解析平面文件。从逐行加载的样本原始数据文件开始，用户可以解析、重命名和改变变量类型、添加或删除列、提取和分解数据等。所有的操作都在一个被称为“配方”的转换列表上被同时跟踪。

![](img/49d3150575a68cf81a754c9ae15600fa.png)

Data Fusion wrangler 用于在平面文件上定义由 14 个转换步骤组成的配方。作者截图。

一旦定义了争论的步骤，配方中的指令列表就应用于管道中的转换。执行时，转换会将其输入模式中的输入行转换为输出模式。数据融合并不总是直接更新 wrangler 转换中的输出模式，但是配方和模式都可以导出为 JSON 文件，并通过数据融合导入。该食谱还与谷歌数据准备共享相同的语言，谷歌数据准备是一个稍微更强大的工具，但需要单独的许可证。

数据融合提供了许多其他对于更复杂的管道不可或缺的转换:规范化/反规范化、XML 解析等。虽然不总是像气流等效物那样通用，但是数据融合转换提供了全面的功能覆盖。JavaScript 是一种必然有用的转换。由于数据融合仍然是一个相对较新的解决方案，在某一点上，它将缺乏一个功能。这就是 JavaScript 转换变得方便的地方。需要添加时间戳，但没有管理时间戳或文件名的转换？没问题，一个三行脚本就能搞定。

## **3。大查询**

转换的输出可以发送到各种数据存储和数据库，其中大查询将成为数据仓库的基础。数据融合 BigQuery 接收器将转换产生的数据转换为附加在 BigQuery 表中的行。请注意，在创建表时，BigQuery 不需要显式定义的模式，在这种情况下，当第一行插入表中时，将记录模式。虽然很方便，但是管理数据融合和大型查询之间的模式更改可能很困难，尤其是在数据仓库创建的早期阶段。

![](img/4961e9b64e2804dd3dbb67f6fe5bd6cb.png)

存储转换数据的大型查询数据仓库。作者截图。

数据融合可以反过来从大查询中读取数据，以便转换数据和创建更复杂的管道。相对简单的数据转换的另一种替代方法是使用大查询计划查询:这些查询将在计划的时间运行，从给定的表中选择数据，并将输出写入新的表中。

## **4。数据工作室**

Data studio 是谷歌的 SaaS 数据可视化工具。它是免费的，并与 Big Query 紧密集成，因此

*   使用 SQL 语言，可以使用从大型查询表中检索到的数据即时创建和更新可视化效果
*   反之亦然，来自大查询 GUI 的查询输出可以立即导出并在 Data Studio 中可视化

Data Studio 希望输入相对结构化的数据，并且与 PowerBI 等竞争工具相比，它提供的过滤或聚合功能较少，因此拥有正确的 SQL 脚本和一些预处理表非常重要。一旦理解了这一点，Data Studio 提供了一个极其高效的框架，几乎可以立即检索、编辑、发布和导出报告为 PDF。此外，可以在 SQL 查询中直接考虑报告中的参数，从而可以轻松地为各种配置或每个实体生成报告。

![](img/e8281b8bb06714dc7cd7a3604e767dcf.png)

Data Studio 查询大查询数据仓库，为用户构建商业智能报表。作者截图。

# **结论**

> 无代码数据管道:数据融合信守承诺

通过提供图形用户界面，允许非技术用户在几天内创建数据管道，Data Fusion 优雅地处理了一个业务问题，否则需要更复杂的技术堆栈*。本文中提到的所有 Google 云解决方案几乎总是彼此无缝集成，使得任何用户都可以轻松使用所有不同的组件，而无需任何技术配置或代码行。

> 数据融合是一个相对较新的解决方案，还有待改进

不过，一个例外是数据融合的最初几天，不幸的是，这带来了一系列神秘的错误和可用性故障。它甚至在第一次执行后就开始了:数据融合的默认资源需求超过了 Google Cloud 试用帐户配额，这只有在深入研究日志文件后才能理解。也许更重要的是，大多数用户输入不会在 GUI 中得到验证，而只会在管道预览期间得到验证。基本错误(如打字错误)通常会导致模糊错误，仅在精细日志中报告。谷歌必须迅速改善这一点，以确保新用户不会感到沮丧，尤其是 Azure 和 AWS 上的竞争解决方案往往能更好地处理这一问题。最后，维护独立的环境和版本也很困难。如果没有数据融合的专用功能，这些任务中的大多数必须使用导出和导入来手动处理。治理和访问控制也是如此:用户可以按照自己的意愿自由地改变事情，但这可能会以稳定性和复杂性为代价。

> 数据融合对许多公司来说看起来很有前途

Data Fusion Enterprise edition 的标价约为 3000 美元/月，此外还有每个管道执行所收取的 [Dataproc](https://cloud.google.com/dataproc) (Hadoop)成本。目前还不清楚有多少客户在使用数据融合，但数据融合解决了许多公司面临的一个真正的业务问题，因此应该有一个光明的未来。

*[ [气流](https://en.wikipedia.org/wiki/Apache_Airflow)(云作曲) [Hadoop](https://en.wikipedia.org/wiki/Apache_Hadoop) (Dataproc)等]