# 如何成功运行 A/B 测试

> 原文：<https://towardsdatascience.com/how-to-successfully-run-a-b-tests-f3ca363dec98?source=collection_archive---------24----------------------->

## 积极尝试各种事物的大型科技公司的最佳实践

![](img/1713660f94cf550ba3a781b99e71c729.png)

在 [Unsplash](https://unsplash.com/photos/gKUC4TMhOiY) 上由 [Ousa Chea](https://unsplash.com/@cheaousa) 拍摄的照片

所有最成功的科技公司都在不断试验和改进他们提供给用户的产品。A/B 测试是一种广泛使用的技术，用于确定操作特性的影响。

> “随机 A/B 或 A/B/N 测试被认为是许多定量科学领域评估治疗效果的黄金标准。”优步的 Anirban Deb 等人

虽然 A/B 测试在许多数据驱动的决策中发挥着重要作用，但它们很难成功运行，也更难大规模运行。

在这篇文章中，我们将看看一些最成功的科技公司是如何设计系统来正确运行数千次 A/B 测试的。我们不需要重新发明轮子来成功地运行这些测试。我们可以将大型科技公司在他们的实验平台上所做的事情视为运行可扩展的 A/B 测试的最佳实践。

如果您有兴趣了解特定公司运行 A/B 测试的方法，请查看以下链接:

*   [网飞](https://netflixtechblog.com/its-all-a-bout-testing-the-netflix-experimentation-platform-4e1ca458c15)
*   [优步](https://eng.uber.com/xp/)
*   [Spotify(第一部分)](https://engineering.atspotify.com/2020/10/29/spotifys-new-experimentation-platform-part-1/) [(第二部分)](https://engineering.atspotify.com/2020/11/02/spotifys-new-experimentation-platform-part-2/)
*   [Pinterest](https://medium.com/pinterest-engineering/building-pinterests-a-b-testing-platform-ab4934ace9f4)
*   [推特(第一部分)](https://blog.twitter.com/engineering/en_us/a/2015/the-what-and-why-of-product-experimentation-at-twitter-0.html) [(第二部分)](https://blog.twitter.com/engineering/en_us/a/2015/twitter-experimentation-technical-overview.html)

# 什么是 A/B 测试？

在进入细节之前，我们对什么是 A/B 测试有相同的理解是很重要的。

它们是有一个对照组和一个或多个治疗组(或实验组)的实验。控制组体验的服务和往常一样。治疗组体验具有改变的特征的服务(例如主页上按钮的改变的颜色)。

实验的目的是确定治疗组经历的变化相对于对照组的影响。影响需要是一个可衡量的指标，如在一个页面上花费的时间，查看次数，或与按钮的交互次数。

分配到治疗组和对照组时，应最大限度地提高各组之间的相似性，以降低观察到的治疗效果中混杂因素的风险。这通常通过随机分配来完成。

# 为什么 A/B 测试很重要

我们可以通过 A/B 测试的受欢迎程度和结果来理解它的重要性。

我们首先来看看我们研究的五家公司对 A/B 测试在其决策过程中的重要性有什么看法:

> “事实上，网飞考虑的每一个产品变化在成为默认用户体验之前都要经过严格的 A/B 测试过程。”—网飞科技博客
> 
> “在任何给定的时间，我们的平台上都有超过 1000 个实验在运行。”优步的 Anirban Deb 等人
> 
> "今天，几乎所有的产品决策都是根据一个或多个 A/B 测试的一些输入做出的."—约翰·里德伯格，Spotify
> 
> “作为一家数据驱动的公司，我们非常依赖实验来指导产品和功能。在任何给定的时间，我们都有大约 1000 个实验在运行，并且每天都在增加。”—硕翔，Pinterest
> 
> “实验是 Twitter 产品开发周期的核心。这种实验文化是可能的，因为 Twitter 在工具、研究和培训方面投入了大量资金，以确保功能团队能够无缝、严格地测试和验证他们的想法。”推特上的德米特里·里亚博伊

你明白了。成功的公司总是通过实验来改进他们的平台。他们是决定这些公司几乎每一项决策的重要因素。

A/B 测试是一个非常有用的工具。它们允许大规模的公司测试增量变化，而不用将它们暴露给所有的客户。然后，这些结果可以相对概括到客户群体中。

> “但是，如果不进行广泛的 A/B 测试，推出[变更]的风险太大，这样我们就能证明新体验优于旧体验。”—网飞科技博客

网飞[声称](https://variety.com/2016/digital/news/netflix-ab-tests-image-optimization-trick-1201674325/?sub_action=logged_in)已经对他们与标题相关的图片进行了 A/B 测试，结果该标题的浏览量增加了 20%到 30%。

有了这些类型的影响，就很清楚为什么公司要进行如此多的实验了。它不仅有用，而且有必要为客户提供最佳体验。

# 构建可扩展的实验平台

我们现在明白，所有成功的企业在做出每一项改变之前都会积极地进行试验。他们是如何在数千个并发测试的规模上成功运行所有这些测试的？

## 这些平台的基本特性

所有实验平台的设计都类似，至少包含以下三个**组件**(来自 Spotify 系统的名称):

1.  **远程配置** —允许用户选择要测试的前端或后端服务的特性
2.  **Metrics catalog**——一个管理、存储实验数据并以最小延迟将数据提供给用户界面或笔记本的系统(Spotify 的目标是不到一秒)。
3.  **实验规划器** —允许员工通过易于使用的用户界面进行实验

这些平台的目标在五家公司中也大致相同(Pinterest 的目标名称):

1.  **实时配置更改:**实时关闭和启动实验，无需为每个更改部署代码
2.  **轻量级流程:**应该防止可预测的错误，但是要像普通的特性启动一样简单
3.  **客户端无关:**用户不需要学习一种新的方法来为每个平台运行实验。
4.  **分析:**易于使用的分析仪表板
5.  **可伸缩性:**需要能够伸缩在线服务和离线实验数据处理。

我们分析的所有这些企业都有多样化的产品和部门组合。因此，考虑到平台的通用性以满足不同的业务需求是很重要的。优步在其大多数数据平台中都非常重视这一点。

> “我们团队的主要目标之一是提供一种适用于整个公司用例的假设检验方法。”优步的 Anirban Deb 等人

## 如何正确地将用户分配到治疗组和对照组

这些实验最重要的部分之一是将用户正确地分配到治疗组和对照组。如果分组不够相似，结果就没有意义。无法判断观察到的治疗效果是由实验操作还是组间差异(称为混杂因素)引起的。

优步确定了两个关键问题来限制这些问题的风险:

1.  **样本量失衡:**如果对照组与治疗组的样本量比例与预期比例显著不同，实验人员应检查其随机化机制是否成功建立。
2.  **闪烁**:如果用户在实验期间在控制组和治疗组之间转换(例如，用户购买了一部新的 Android 手机，并曾经拥有一部 iPhone)，他们应该从分析中移除。

优步的平台会自动识别这些问题。

Spotify 描述了他们执行的一些测试前有效性检查，以确保结果能够被解释:

1.  **样本不匹配:**确保治疗组和对照组的比例与实际观察到的一致。
2.  **预曝光活动:**查看用户与应用程序的交互方式是否有任何预实验差异。
3.  **崩溃增加:**确保应用程序在实验过程中仍能正常工作
4.  **属性冲突:**确保分析师知道类似的实验何时进行，以降低无法获得预期的风险。

## 如何将用户分配给实验

随着这些公司测试数量的增加，跟踪哪些用户被分配到了哪些实验变得非常重要。不应将用户分配到与其当前参与的实验相冲突的实验(在同一页面上操作多个功能)。

> “如果有人最终使用了错误的(分配)，一系列实验都会受到影响”——约翰·里德伯格，Spotify

Spotify 采取了一种有趣的方法，他们称之为“盐机”。Spotify 的团队按照最适合他们的节奏自主工作。这导致实验用户分配的复杂性(同时保持分配的关键随机性)。“盐机器”通过使用“盐”树散列到桶中，随机地将桶中的用户重新洗牌(不停止正在进行的实验)这里有详细的解释和可视化[这里有](https://engineering.atspotify.com/2020/11/02/spotifys-new-experimentation-platform-part-2/)。

网飞将更多的责任交给运行实验的用户，有两个分配选项:**批量**分配和**实时**分配。

批量分配允许分析师使用自定义查询将用户分配给测试。这是他们更灵活的方法，帮助分析师找到他们感兴趣的确切客户。一些缺点包括不能保证所有用户都体验到测试，新用户不能被添加到实验中。

实时分配允许分析师配置关于用户如何实时与应用程序交互的不太灵活的规则，以将他们分配给实验。这保证了用户体验预期的治疗，因为他们正在与应用程序实时交互。也很难知道在这种制度下何时会处理或分配所需数量的成员。最后，潜在增加的应用延迟可能是这种方法的一个问题(在应用等待其他服务时，网飞通过并行计算解决了这个问题)。

## 要跟踪的指标

随着公司产品数量的增加，跟踪哪些指标的问题会很快变得复杂。这些实验平台中的许多都具有灵活的度量能力，允许分析师测试他们感兴趣的内容。

Twitter 允许分析师使用三种不同类型的指标(增加分析师的灵活性):

1.  **内置指标**:由实验团队定义和拥有
2.  **实验者定义的**:使用轻量级 DSL 创建的配置度量，指定应该计数什么“事件”。
3.  **导入的指标:**实验者创建他们自己的指标，并将它们添加到系统中。

优步定义了三种类型的指标，允许分析师创建:

1.  **连续指标**:数值
2.  **比例度量**:二进制指示变量，表示用户是否执行某个事件
3.  **Ratio metrics** :允许分析师计算比率的两列(分子表示已完成行动的数量，分母表示可能完成行动的总人数)。

## 预处理和有效性检查

在解释结果之前，优步做了三个预处理步骤来提高他们分析的稳健性:

1.  **异常值检测**:去除数据中的异常。他们通过基于聚类的算法来检测异常值。
2.  **方差减少:**增加假设检验的统计功效(有助于少量用户的实验)。为此，他们使用了 [CUPED 方法](https://www.exp-platform.com/Documents/2013-02-CUPED-ImprovingSensitivityOfControlledExperiments.pdf)。
3.  **实验前偏差:**有时随机化并不能产生很好的组分配。为了纠正这一点，他们使用[差异](https://en.wikipedia.org/wiki/Difference_in_differences#:~:text=Difference%20in%20differences%20(DID%20or,'%20versus%20a%20'control%20group')来纠正这些作业中的偏差。

## 如何有效地解释结果

获得精确的 p 值计算至关重要。如果结果不容易解释，这个实验就不值得进行。优步描述了他们用来计算统计结果的四种不同的测试:

1.  [**【韦尔奇 t 检验】**](https://en.wikipedia.org/wiki/Welch%27s_t-test) —用于连续指标
2.  [**曼-惠特尼 U 检验**](https://en.wikipedia.org/wiki/Mann%E2%80%93Whitney_U_test) —在有偏差的数据中表现良好
3.  [**卡方检验**](https://en.wikipedia.org/wiki/Chi-squared_test) —用于比例指标
4.  [](https://alexdeng.github.io/public/files/jsm2011-deng.pdf)****—用于小样本量(这是一种 bootstrap 方法)****

****当在一个公司运行数千个测试时，有可能产生被称为类型 1 和类型 2 错误的统计错误。为了降低统计发现不真实的风险，降低错误发现率(FDR)非常重要。优步使用了 [Benjamin-Hochberg 程序。](https://en.wikipedia.org/wiki/False_discovery_rate#Benjamini%E2%80%93Hochberg_procedure)****

## ****扩展这些平台的挑战****

****Spotify 确定了它在扩展其实验平台时面临的四个问题，这些问题需要在 2017 年解决:****

1.  ****缩短用实验调整问题的时间****
2.  ****产生更少的事件:A/B 测试产生总事件量的 25%,导致处理成本增加****
3.  ****改进的分析:需要更多的度量标准，需要更多可以分析的东西。****
4.  ****复杂的协调:不允许同一个用户被分配到多个相互冲突的实验中****

****所有这些优化对于允许 Spotify 扩展其运行的实验数量非常重要，在构建实验平台时应该加以考虑。****

# ****结论****

****在今天的商业环境中进行实验是必要的。A/B 测试是一种工具，它使我们能够对客户进行因果推断，而无需对所有客户进行测试。****

> ****“感谢工程师和数据科学家团队，他们不断对我们的自适应流媒体和内容交付网络算法进行 A/B 测试。更明显的变化呢，比如我们 UI 布局的完全重新设计或者我们新的个性化主页？是的，全部经过彻底的 A/B 测试。”—网飞科技博客****

****正在尝试的企业正在为他们的客户提供更好的体验，而不是盲目地做出可能对客户体验产生巨大影响的改变。****

****Twitter 将这一重要过程视为包含 6 个步骤的创新周期:****

*   ****建立一个假设****
*   ****定义成功指标****
*   ****测试假设****
*   ****学习****
*   ****船****
*   ****建立另一个假设****

****我们了解了顶尖的科技公司如何大规模地成功解决这些步骤中的问题。****

****感谢您阅读这篇文章。****