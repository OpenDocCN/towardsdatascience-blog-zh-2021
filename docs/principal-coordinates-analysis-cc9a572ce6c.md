# 主坐标分析

> 原文：<https://towardsdatascience.com/principal-coordinates-analysis-cc9a572ce6c?source=collection_archive---------4----------------------->

## [实践教程](https://towardsdatascience.com/tagged/hands-on-tutorials)

## 通过 R 和 Python 示例深入探讨感知映射和产品品牌的主坐标分析

![](img/2fc23cef0fe298488f0e645cdd2c33c0.png)

主坐标分析——照片由[卡尔文·汉森](https://unsplash.com/@calvinhanson?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)在 [Unsplash](https://unsplash.com/s/photos/color-map?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄

# 主坐标分析

在本文中，您将发现主坐标分析(PCoA)，也称为**度量多维标度(度量 MDS)** 。您将了解什么是主坐标分析，何时使用它，以及如何使用 Python 和/或 r 在一个真实的示例中实现它。

# 什么是主坐标分析？

主坐标分析是一种统计方法，它将关于项目之间距离的**数据转换成这些项目的**基于地图的可视化**。**

生成的映射可用于更好地**理解哪些项目彼此接近**，哪些项目不同。它还可以让您识别组或集群。

# 主坐标分析与其他方法

在我们进入细节之前，让我们首先讨论主坐标分析与其他几个密切相关的统计方法的关系。

## 主坐标分析与多维标度

多维标度是一系列统计方法，侧重于根据距离创建项目映射。在多维标度中，不同类型的数据有不同的方法。主坐标分析是多维缩放的一个子类型，用于处理数值距离，其中没有测量误差(每对项目只有一个距离测量值)

## 主坐标分析与聚类

聚类也与主坐标分析密切相关。在聚类中，你试图在你的数据集中，基于**相似性**创建**观察值的聚类**。相似之处基于您测量的变量。

这与主坐标分析相对相似，因为它也基于**(不)相似性**来表示数据。然而，一个很大的区别是主坐标分析试图提取两个维度来制作 2D 地图，而聚类只是试图将数据点分组。

在聚类分析结束时，通常还会将聚类和数据点绘制到 2D 地图上。然而，您将需要额外的分析(例如 PCA)来计算这些维度。

使用主坐标分析，主要目标是创建最佳可能的映射，在图表中可以看到组/簇。对于聚类，主要目标是识别聚类，而您可以对这些聚类做的一件事是尝试在地图上绘制它们。

## 主坐标分析与主成分分析

主坐标分析也容易与[主成分分析(PCA)](/what-is-the-difference-between-pca-and-factor-analysis-5362ef6fa6f9) 混淆。首先，他们有相同的首字母，这使得他们很容易混淆。其次，两者都使用了降维。

不同的是，主成分分析侧重于共享方差:它试图用最少的分量概括多个变量，以便每个分量解释最多的方差。另一方面，PCoA 关注的是距离，它试图提取说明最大距离的维度。

# 主坐标分析一例

在文章的下一部分，我们将使用两个例子来使事情更清楚。这两个示例是主坐标分析的两个标准用例。在继续之前，让我们先介绍一下示例。

## 感知映射

我们将看到的第一个主坐标分析示例是感知映射用例。感知制图意味着你制作了一张地理地图，但是你使用了一种不寻常的距离度量。

当然，你可以在地图上使用各种[类型的距离度量](/3-distances-that-every-data-scientist-should-know-59d864e5030a)。然而，感知映射的想法是创建一个可视化，让你对距离以外的其他维度有更好的洞察力。

对于这个例子，我创建了一个小型的**数据集，其中包含法国城市的火车旅行时间**。自从我住在法国以来，我一直很惊讶为什么有些距离很近的城市坐火车要花这么长时间，而有些距离很远的地方旅行却非常快。这可能是由于两个城市之间的火车类型或地理障碍(如山脉等)等条件造成的。

为了获得数据，我计算了法国 10 个最大城市之间的火车路线。分析的目标是重新绘制一幅法国城市的地图，它不是基于地理上的接近度，而是基于旅行时间的接近度。

## 产品映射

我们要看的第二个例子是产品品牌的例子。我们将使用产品之间距离的模拟数据集。假设你是一家公司，你想推出一种新产品。您可以使用这种技术在现有产品中映射产品，以发现它是否足够不同，可以引入。

产品映射可以使用度量数据来完成，但也经常使用非度量数据来完成。如果您有公制比例的数据，则只能使用主坐标分析。对于序数型数据，需要使用一种叫做非公制多维标度的方法。

# 主坐标分析的托格森方法

在深入研究该示例的代码之前，让我们放大一下主坐标分析背后的数学原理。

当开始使用这种方法时，您需要归结为具有所谓的**相异矩阵的数据。**这意味着数据集中的每一对项目都有一个距离或相异度度量。

请注意，这种方法只能用于实际的距离测量。例如，如果你的值是两倍高，你的距离必须是两倍大。因此，您不能将它用于序数数据，如消费者填写从 1 到 5 的测量范围。为此，您需要使用非公制多维标度。

一旦有了度量距离矩阵，就可以使用 Torgerson 方法(当距离是欧几里得距离时)或迭代法来计算您的解。

## 托格森方法

托格森方法有两个步骤。你从距离矩阵(我们称之为 **D** )开始，对其应用双重居中。你会得到一个双中心矩阵，我们称之为 **B** 。这样做是为了让新生成的贴图的中心位于图形的中间。

双定心的 Torgerson 公式从计算距离的平方开始:

![](img/2cf007328a78f925657b64a7adc26de4.png)

主坐标分析—托格森法第一部分

然后你计算双中心矩阵 B 如下

![](img/3fde5869965439eb0581b641edc0b673.png)

主坐标分析——托格森法第二部分

矩阵 C 是由单位矩阵(I)和全 1 矩阵(J)计算的定心矩阵。 *n* 是观察次数:

![](img/90765a53e83c9a8b9ea46cb34f30f9dc.png)

主坐标分析——托格森法第三部分

然后，对矩阵 b 进行奇异值分解。一旦完成，就可以将 SVD 的前两个维度作为轴来绘制映射。前两个维度上的项目分数将用作地图的坐标。

## 迭代方法

迭代方法更通用，并且可以在距离(相异)不是欧几里得距离时应用。迭代方法包括最小化成本函数，其定义如下:

![](img/240fc68745533bcb3a7dad74928ec4f1.png)

主坐标分析——迭代法的成本函数

# R 中的主坐标分析

现在让我们转到实现。我们将从法国城市的火车旅行时间数据开始，然后转向品牌研究。

## R 中的主坐标分析—示例 1 —感知映射

对于不熟悉的人，让我们从法国 10 大城市的概况开始:

![](img/876a9c1ce4d03edc641c743a539431a4.png)

主坐标分析-法国十大城市的位置

为了进行这个分析，我使用了一个行程规划器来获得从一个城市到另一个城市乘火车的**旅行时间。我已经把这些旅行时间(以分钟为单位)放在一个距离矩阵中。您可以使用以下代码行直接从 S3 存储桶获取数据:**

主坐标分析-获取距离矩阵

距离数据将如下所示:

![](img/e52853b9ba15e2e1ed6059b92fc75a1a.png)

主坐标分析-获取距离矩阵

注意，这个数据集已经是一个距离矩阵。只是，它是数据框格式。我们需要将它转换成距离矩阵格式，如下所示:

主坐标分析-将数据转换为真实距离矩阵对象

距离矩阵格式如下所示:

![](img/92dccceb7398a122d05adb9806690bea.png)

主坐标分析—距离矩阵对象

然后，我们可以应用`stats`包中的主坐标分析函数`cmdscale`，它将为我们完成 Torgerson 方法的所有数学运算，我们将获得映射的坐标。

主坐标分析-使用 cmdscale 拟合模型

您将获得每个城市的新坐标，如下所示:

![](img/58a1dccadd2bdb5e8acef5504e413b12.png)

主坐标分析-输出坐标

这个坐标矩阵是模型的输出。当然，合乎逻辑的下一步是绘制这些坐标，以获得映射的可视化版本。然后，我们可以按如下方式创建映射:

主坐标分析-绘制新坐标

在下图中，您可以看到您获得的映射。这些城市现在是根据坐火车的旅行时间而不是公里数重新定位的:

![](img/d94fe42c40a3fbcbcfdc50914ccb9ae5.png)

主坐标分析—法国十大城市根据火车旅行时间进行重组

那些看过法国原始地图的人会注意到一些奇怪的事情正在发生:东部的城市都显示在西部，反之亦然。因为主坐标分析是基于距离的，所以它不保留原始方向的概念。我们可以很容易地将地图翻转到 x 轴上，以将东部和西部放回原位。您可以使用以下代码来实现这一点:

翻转绘图的 x 轴

现在，您将获得法国十大城市的最终地图，该地图根据乘火车旅行的时间进行了重新组织:

![](img/5ed5d789ac6631349b04e426eb5a803a.png)

主坐标分析—法国十大城市根据火车旅行时间进行重组

**感知映射研究的结论**

这张地图让我们看到了一些有趣的事情。首先，我们看到许多城市被投影得彼此更近，除了三个异常值:尼斯、图卢兹和波尔多被彼此拉开，以表示法国南部城市更长的旅行时间。

马赛和蒙彼利埃也在法国南部，但它们离巴黎更近，离其他南部城市更远。这可以用巴黎到马赛的**快速列车线**来解释。

在法国北部，我们看到从东到西的距离越来越小。从南特到斯特拉斯堡的距离很小，尽管它们在这个国家的两边。

现在，如果你真的想继续进行地图绘制，你可以使用地图或 GIS 包，如`cartography`包，使这张地图看起来令人惊叹。请注意，当前贴图基于以 0 为中心的贴图。然而，当您想要投影到该国的地图上时，您将需要做出一些额外的决定，包括如何缩放地图以及在哪里放置中心。

## R 中的主坐标分析—示例 2 —品牌研究

现在让我们看看产品映射示例。假设你是一家公司，你有一个新产品的想法。你想做一个初步的分析，看看你的产品是否与你现有的产品有足够的不同。

我用 10 种糖果产品创建了一个模拟数据集

主坐标分析-导入数据

该数据包含 10 种糖果，测量了甜味、酸味、咸味和苦味。数据如下所示:

![](img/1acc90d2d9ce958a8a6cf62cc342237d.png)

主坐标分析——糖果数据

与前面的例子不同，我们还没有距离矩阵。由于主成分分析的输入是距离矩阵，我们需要首先根据数据计算距离矩阵。R 中的`dist`函数计算观测值之间的欧几里德距离，如下所示:

主坐标分析-计算距离矩阵

距离矩阵如下所示:

![](img/cff0404c9a59b146d4d6ab2d71cc9508.png)

主坐标分析-计算的距离矩阵

现在我们需要使用`cmdscale`来拟合主坐标分析。代码如下所示:

主坐标分析—拟合模型

您将获得矩阵中 10 颗糖果的坐标:

![](img/bdc1a087d2b512d46205cd5507487692.png)

主坐标分析-每颗糖果的新坐标

您可以在主坐标分析的两个维度上生成 10 颗糖果的图，如下所示:

主坐标分析—绘制糖果分析图

你应该得到如下的情节:

![](img/384d7340418187c4a716258ffddd0b22.png)

主坐标分析——绘制糖果图

你可以从这个图表中获得一些有趣的见解。大多数糖果都聚集在图表的底部。有一种非常不同的糖果:糖果 5。然后，对于其他糖果，我们可以区分两组:一组在右下角(糖果 2、3、4 和 1)，一组在左下角(糖果 10、9、6、7 和 8)。

为了进一步了解维度的实际含义，分析原始变量和两个维度之间的相关性可能会很有意思。这可以通过以下方式完成:

主坐标分析—分析尺寸

这为我们提供了以下相关矩阵:

![](img/fddcd1808bb719384a1742ad91140dc7.png)

主坐标分析——相关矩阵

这告诉我们，第一个维度与甜味和酸味有很强的相关性。第二维度主要是代表咸度。

**糖果研究的结论**

对于我们糖果公司的问题，我们可以得出两点结论:

*   首先，该公司在图表的右上角还没有糖果。对他们来说，研究这是否会有任何附加价值可能是有趣的。这将是一种在两个维度上都得分很高的糖果。这种糖果例如可以是甜/咸的组合。
*   其次，我们可以得出结论，苦并没有真正在现有的维度中表现出来。这意味着苦味在糖果中不会有很大的变化:如果有，它可能会在一个维度中有更强的存在。对公司来说，研究苦味糖果以扩大产品范围可能很有趣。

# Python 中的主坐标分析

现在，让我们看看用 Python 实现的两个简短的例子，我们刚刚用 r。

## Python 中的主坐标分析-感知制图示例

第一步是导入数据。您可以使用以下代码直接从我的 S3 桶中获取城市距离:

主坐标分析-导入数据

数据是一个距离矩阵，其中包含从一个城市到另一个城市的旅行时间(以分钟为单位)。它看起来如下:

![](img/88b1dd0ec9b9b309dd517710d305e11b.png)

主坐标分析——距离矩阵

我们将用于主坐标分析的 Python 函数只能采用对称距离矩阵。这意味着我们必须在 NAs 中填入相应的值。这很容易做到，用 0 代替 NAs，并对原始矩阵和转置矩阵求和:

主坐标分析-将半距离矩阵转换为对称距离矩阵

结果如下所示:

![](img/fbcada0f79b1dcaaf6ed0cae636fe6b6.png)

主坐标分析——对称距离矩阵

现在我们开始建模。您可以使用`scikit-bio`包进行主坐标分析。您可以使用下面的代码来安装和导入包，并将其导入到模型中。最后，使用`.samples`属性打印前两个维度中的坐标:

主坐标分析—使用 scikit-bio 拟合模型

这 10 个城市的新坐标如下所示:

![](img/3ac7fce3ba618f3f3e4583eb037d2059.png)

主坐标分析-显示 10 个城市的坐标

最后，我们要创建一个由这 10 个坐标组成的图。您可以使用以下代码来绘制带有`matplotlib`的城市:

主坐标分析-绘制结果

生成的地图如下所示。它与 R 获得的输出相同，只是它是镜像的。我不会重复这些结论，因为它们和我们在上面的 R 分析中看到的结论完全一样。

![](img/8f3b245cf0816e135790e9f6207aa8a4.png)

主坐标分析-根据火车行驶时间绘制城市地图

## Python 中的主坐标分析——品牌研究示例

现在，为了完整起见，让我们也为糖果品牌研究做一个 Python 实现。和前面一样，您需要从导入数据开始。您可以使用以下代码获得它们:

主坐标分析-导入糖果数据

数据将如下所示:

![](img/bd729bb2580bd0cc3d36d7af9b38115c.png)

主坐标分析 Python 中的糖果数据

这里需要的额外步骤是距离矩阵的计算。在 Python 中，可以使用`pdist`计算成对距离(每对行之间的距离)。但是，该函数不会生成对称的距离矩阵。你必须添加函数`squareform`将其转换成对称矩阵:

主坐标分析-在 Python 中计算对称距离矩阵

您将获得以下 NumPy 数组:

![](img/be593d45829b4611e5716faf160ad404.png)

主坐标分析-计算对称距离矩阵

现在您已经有了这个矩阵，您可以继续拟合模型了。我们将再次使用`skbio`包，并用`matplotlib`绘制结果:

主坐标分析——用 skbio 拟合模型

您将获得与等效 R 代码输出的图形相同的图形。Python 图表如下所示:

![](img/0227387fcfc38abae76b0f7bcd746529.png)

主坐标分析——10 颗糖果的映射结果

结论与上面 R 分析中列出的相同。

# 结论

使用主坐标分析，我们已经可视化了法国 10 个最大的城市，并根据火车旅行时间创建了另一幅法国地图。

我们还使用主坐标分析来分析市场上有 10 种糖果产品的公司的产品品牌。我们绘制了他们现有产品的地图，这让我们能够**确定新产品**投放市场的潜在利基。

简而言之，主坐标分析是一种探索数据的伟大方法，它允许您将数据可视化，并与特定问题紧密相关。**如果你知道如何以及何时使用主坐标分析，它会是一个非常有用的工具**。我希望看完这篇文章就是这样！

*我希望这篇文章对你有用。不要犹豫，继续关注更多的数学、统计和数据内容！*