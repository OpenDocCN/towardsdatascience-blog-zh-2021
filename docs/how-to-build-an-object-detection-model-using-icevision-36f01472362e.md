# 如何使用 IceVision 建立对象检测模型

> 原文：<https://towardsdatascience.com/how-to-build-an-object-detection-model-using-icevision-36f01472362e?source=collection_archive---------21----------------------->

## 用几行代码构建您的对象检测模型

![](img/aeca54fda1432e50db78d70ca998544a.png)

在 [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上由 [Derek Oyen](https://unsplash.com/@goosegrease?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 拍照

# 介绍

计算机视觉多年来一直在进步。有了它，我们可以自动完成任务，看到我们眼睛看不到的东西。

对象检测是现有的计算机视觉应用之一。在这个任务中，我们不仅要对图像进行分类，还要检测目标的位置。之后，模型会创建一个包围它的边界框。

听起来很酷，对吧？但不幸的是，实现对象检测是具有挑战性的，并且需要时间。对于一个新人，我可以保证他们会变得不知所措。然后，IceVision 来到了互联网。

IceVision 是一个计算机视觉库，用于直接实现对象检测模型。您不必担心数据准备和模型实现，因为 IceVision 会处理这些问题。因此，您可以通过使用对象检测来专注于解决问题。

在本文中，我将向您展示如何使用 IceVision 实现一个对象检测模型。事不宜迟，我们开始吧！

# 履行

## 下载库

我们需要做的第一步是下载库。为了下载这个库，我们到 GitHub 上的 IceVision 存储库，下载名为 icevision_install.sh 的 shell 脚本。

请记住，IceVision 库只能在 Linux 和 Mac OS 上运行。对于 Windows 用户，您可以使用 Google Colab 来继续学习本教程。你可以在这里 访问 GitHub 库[T5。](https://github.com/airctic/icevision)

现在，您可以通过下面的链接下载 shell 脚本:

下载脚本后，您可以使用 bash 运行脚本，如下所示:

安装完库后，您可以使用下面的代码重新启动笔记本:

现在您可以加载库了。下面是实现这一点的代码:

## 获取并准备数据

在我们下载并加载库之后，下一步是获取数据。在本教程中，我们将使用牛津大学 IIIT 分校的 Pets 数据集中的一个例子。

该数据集包含大约 7400 幅图像，它们被分为 37 类。对于这个数量的类，每个类包含大约 200 个图像。在 这里可以看到关于数据集 [**的详细信息。**](https://www.robots.ox.ac.uk/~vgg/data/pets/)

> 免责声明:
> 数据集是在知识共享署名-共享 4.0 国际(CC BY-SA 4.0)许可下许可的。这个许可意味着每个人都可以出于任何目的访问和使用数据，包括本文的教程。你可以在这里 了解更多关于 [**牌照的信息。**](https://creativecommons.org/licenses/by-sa/4.0/)

让我们回到主题。现在让我们加载数据。幸运的是，Icedata 库提供了数据集。您可以运行以下代码来加载数据:

加载数据后，下一步是创建用于定型和测试模型的数据拆分器。在这种情况下，我们将对训练数据使用 80%的比例，对测试数据使用 20%的比例。下面是实现这一点的代码:

这样做之后，下一步是解析数据集。这样做的原因是为了准备数据。因此，它更容易被模型读取。之后，我们根据之前我们的比例将数据拆分成训练集和测试集。下面是实现这一点的代码:

如果您想查看类名及其标签，可以运行以下代码:

如果您想查看数据集的预览，可以运行这行代码:

获得数据后，下一步是初始化 Dataset 对象。但在此之前，我们需要实现图像增强。这样做的原因是通过给图像一些修改来提高模型的性能。

我们将应用的增强技术是归一化图像值，并将它们裁剪成所需的图像大小。下面是实现这一点的代码:

现在我们可以初始化数据集对象。下面是实现这一点的代码:

要确保对象正常工作，请运行这行代码:

## 建立模型

我们的数据已经加载完毕。现在让我们建立模型。对于本教程，我们将使用 RetinaNet 作为架构。对于主干，我们使用 ResNet-50 作为模型的特征提取器。下面是实现这一点的代码:

在您加载模型之后，现在让我们初始化模型。下面是实现这一点的代码:

初始化模型后，下一步是为数据集创建一个加载器。之所以这么做，是因为模型要批量训练。在每次迭代中，模型将获得一批数据集，并在模型上对其进行训练。

对于测试数据集，我们不会打乱批次，因为我们没有训练数据。我们测试它只是为了看看它的性能。下面是实现这一点的代码:

要验证数据加载器是否已初始化，您可以运行这行代码:

## 训练模型

现在你有了数据和模型。下一步是训练模型。让我们为我们的模型初始化度量。

在这种情况下，我们将使用 COCO 指标以及损失或错误的数量。编写以下代码行来初始化指标:

IceVision 库有两种训练模型的方法。有 Fast.ai 法和 PyTorch 闪电法。对于本教程，我只给大家展示 Fast.ai 方法。

其原因是因为这种方法已经准备了一些可视化，以便更容易地理解我们的模型的进展。让我们使用这行代码初始化 Fast.ai 学习器:

在我们训练模型之前，分析使用哪个学习率是一个更好的步骤。为此，您可以运行以下代码行:

从上面可以看出，学习率为 0.001 的模型损失最低。因此，我们将使用该值作为训练模型的参数。现在让我们微调模型。下面是实现这一点的代码:

因为我们使用了 [Fast.ai](http://fast.ai/) 函数，所以可以看到一个表格。它由亏损次数和可可指标组成。从上面可以看出，该模型的 COCO 指标约为 0.708。损失值对预测真的很好。

## 保存模型

现在我们有了最好的模型。让我们通过使用 save_icevision_checkpoint 函数来保存模型。下面是实现这一点的代码:

## 测试模型

最后，让我们在测试数据上测试模型。在这种情况下，我们使用之前分割的验证数据。

为了测试我们前面的函数，让我们尝试使用 model_from_checkpoint 函数加载模型。下面是实现这一点的代码:

似乎没有出现错误。让我们通过运行以下几行代码来验证它:

不错！似乎没有发生任何错误。让我们通过使用这行代码来加载模型:

现在我们来试试这个模型。请运行以下几行代码:

最后一步，让我们看看结果如何。请运行这行代码:

# 结束语

干得好！现在，您已经学习了如何使用 IceVision 实现对象检测模型。我希望你能在这里学到新的东西。还有，希望这篇文章可以帮助你针对自己的问题建立一个对象检测模型。

如果你对我的文章感兴趣，你可以在 Medium 上关注我。对于那些还不是 Medium 成员的人，您可以使用下面的链接订阅 Medium:

[](https://medium.com/@irfanalghani11/membership) [## 通过我的推荐链接加入 Medium-Irfan Alghani Khalid

### 作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…

medium.com](https://medium.com/@irfanalghani11/membership) 

如果您有任何问题，可以通过 [**LinkedIn**](https://www.linkedin.com/in/alghaniirfan/) 联系我。

谢谢你看我的文章！