# 数据科学将基础设施视为代码

> 原文：<https://towardsdatascience.com/data-science-meets-infrastructure-as-code-d2f62328646c?source=collection_archive---------48----------------------->

![](img/54d73a8c47bf4f9fc81a65afd01aed46.png)

奥斯卡·伊尔迪兹在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

使用软件工程的最佳实践，数据科学功能集成的最新发展为许多数据科学家带来了 Docker、Jenkins、REST APIs 等工具的知识，尽管这些知识使他们中的大多数能够部署他们的数据科学项目，为他们所插入的业务增加价值，但当项目在本地构建，然后被重新考虑部署到云中时，会有一些警告和妥协。

意识到这些警告，我撰写本文的主要目的是将数据科学知识(及其工具)与基础设施(如 Packer 和 Terraform 等代码工具)相结合，以确保创建一个数据科学环境，帮助同时使用 R 和 Python 的用户在云中调配基础设施，并利用许多大数据工具(如 AWS EMR)来分析和处理大量数据。

尽管本文是使用 AWS 堆栈创建的(由于整个基础设施超出了 AWS 免费层，因此可能会产生成本)，但它也可以用于其他云提供商，只需对打包映像创建和部署机器的 Terraform 进行适当的修改。这项工作的进一步更新应该会为项目带来对更多云的支持。

# TL；速度三角形定位法(dead reckoning)

这个项目([在 Github](https://github.com/paeselhz/iac_ds_stack) 中可用)的主要目标是创建一套工具，允许使用 Packer 和 Terraform 部署数据科学堆栈。它包括以下基础设施:

*   创建一个 packer 映像，其中 JupyterHub 托管在端口 **8000** 中，RStudio 服务器托管在端口 **8787** 中，这个 Packer 映像的结果将是一个 Amazon 机器映像，可以在将来多次使用。
*   创建 VPC 和必要的子网，以确保堆栈所需的所有基础架构都可用。
*   最后，当所有这些都创建好后，目标将是在 EC2 实例中部署这两个服务(JupyterHub 和 RStudio Server)。

# 构建要使用的自定义图像

通过使用 Packer 和创建要在任何云中部署的定制机器映像来利用映像的定制，我们还使用 Ansible 来创建行动手册，以允许定制应该在机器中安装什么。通过使用单个源创建这个映像，并指定添加到机器映像中的许多特性，我们可以确保一旦构建了映像，它将在其整个生命周期中保持不变，这意味着安装在机器上的任何包和依赖项都不应在其日常使用中进行更新。

这使得用户，无论是数据科学家还是数据分析师，都可以确信一旦一个项目建立在一个定制的 AMI 之上，任何依赖关系都不会随着时间而改变。当用户自己使用依赖项管理器，比如 R 的 [Renv](https://rstudio.github.io/renv/articles/renv.html) ，或者使用 Python 的环境中的 requirements.txt 时，这种再现性特性也可以得到增强。

可以定制映像的创建来添加或删除特性，比如安装或不安装 RStudio Server，或者部署安装或不安装 Anaconda 的映像，在 Packer 和 Ansible 最终构建 AMI 之后，它将可以多次使用。

这个项目正在构建的 AMI 主要关注 RStudio 服务器的安装和配置，以及带有 conda 的 Jupyterhub。

# 使用自定义图像

许多用户在开始使用云提供商部署强大的机器来训练模型或分析大量数据时，并不使用允许以可再生和可扩展的方式提供这种基础架构的工具(很多时候，这些资源最终会在月底形成一大笔云账单)。这就是 Terraform 出现的原因，因为它帮助用户使用代码部署定制的基础架构，并在工作完成后销毁相同的基础架构。

这个项目的 terraform 模块包含一个简化版本的基础设施，但与 Packer 一样，如果需要，用户可以添加更多的模块。安全模块控制将使用自定义 AMI 部署的机器使用的入口和出口端口，而网络模块控制机器将使用的网络和网关，IAM 设置该机器在云提供商中可以拥有的权限，EC2 模块实际部署机器。

Terraform 带来的许多优势，以及它对基础设施作为代码的定位，允许使用 Git 跟踪基础设施随时间的变化。在 Terraform 部署结束时，用户将拥有机器的 IP 地址，因此它可以连接并使用其资源(以及 Packer 先前安装的应用程序)、托管在端口 8787 中的 RStudio 服务器和端口 8000 中的 Jupyterhub(这些端口先前在安全组模块中是允许的)。

# 进一步发展

尽管这个项目本身可以作为一个可以轻松部署到云的数据科学堆栈，但我们也可以将这个自定义 AMI 用于 EMR 集群，从而加快其配置，因为我们可以取消一些通常在集群配置的引导步骤中执行的安装。

此外，这并不取代任何允许数据探索和模型创建以及部署的数据科学堆栈的正式和官方版本，如 Sagemaker、Google AI Platform 或 Azure Data Studio，而是这些解决方案的替代方案，因为它允许用户完全定制他们需要的东西，并将其部署在他们想要的任何云中。