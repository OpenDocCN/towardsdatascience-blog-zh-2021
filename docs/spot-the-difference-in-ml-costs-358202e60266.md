# “发现”ML 成本的差异

> 原文：<https://towardsdatascience.com/spot-the-difference-in-ml-costs-358202e60266?source=collection_archive---------39----------------------->

## 使用 spot 实例优化云上的 ML 培训成本

![](img/88b5dd2251a69447d2c42d537e5dc909.png)

使用云上的 spot 实例节省 70%以上的成本。【*来源:*[*Unsplash*](https://unsplash.com/photos/sD1VpeflHBY)*】*

任何规模的每个组织都明白，利用公共云是便利性和成本之间的权衡。虽然谷歌、亚马逊和微软等云提供商极大地降低了机器学习的门槛，但 GPU 成本仍然很高。

在机器学习社区中有一种越来越强烈的恐惧，即机器学习的真正力量仍然掌握在少数人手中。这方面的旗舰例子是 OpenAI 的大型 GPT-3 模型，包含 1750 亿个参数，350GB 的内存，据报道至少花费了 460 万美元进行训练。这种趋势看起来还将继续:关于下一代 GPT-4 大小的谣言不断流传，一些估计的参数范围在 [**万亿**左右](https://www.metaculus.com/questions/4852/how-many-parameters-will-gpt-4-have-if-it-is-released-in-billions-of-parameters/)。即使有更有效的训练技术，这些模型仍然需要花费数百万美元来训练。

对于 ML 社区的其他人来说，现在越来越依赖他们的秘密武器:迁移学习。就在最近，优秀的 [HuggingFace](https://huggingface.co/) 库[公布了一个简单的方法](https://twitter.com/huggingface/status/1351560093658198022)在单个云 GPU 上微调大规模参数模型。这给 ML 从业者带来了希望，即使他们无法从头开始训练模型，利用现代机器学习模型的巨大能力仍然是可以实现的。

# 对云的需求

无论是从零开始的培训还是微调，公共云提供商为大多数 ML 从业者提供了最便捷的配置和利用计算资源的途径，这一点仍然很清楚。然而，即使对于微调任务或较小的模型，这些成本也可能会快速增长并变得难以控制。例如，以下是在适用于许多机器学习任务的相对中间层配置上训练机器学习模型的大量成本的简单分类:

*美国地区的所有成本，截至 1 月 28 日 14:00 CET 的 AWS 实例定价。*

请记住，上述费用只是一次训练的费用。大多数机器学习项目都经历了更多的实验阶段，这些数字很快就会增加。因此，大多数手头没有巨额预算的 ML 团队通常会对他们的数据集进行采样，并在确定的时候进行大规模训练。这可能既缓慢又乏味，更不用说难以协调了。这也可能导致团队在错误的结果上趋同。如果较小的采样数据集不能代表较大的数据集，那么随着模型的发展，可能会导致令人沮丧和不同的结果。

# Spot 实例:ML 实验的完美契合

如果 ML 从业者可以奢侈地开展实验，而不必如此担心成本随着时间的推移而激增，这难道不容易吗？可能会有一个解决方案，由所有主要的云提供商提供，但被机器学习社区严重利用不足:**preemptable/Spot 实例。**

preemptible instance 这个词很大程度上是 Google 云平台术语，而 spot instance 是 AWS/Azure 使用的。无论您如何称呼它，概念都是一样的:这些实例的成本只是普通实例的一小部分，唯一的问题是不能保证实例一直保持运行。通常，这意味着在 24 小时内实例将被提供者关闭。

这类实例是云提供商在任何给定时间最大化其所有资源利用率的一种机制。它们适用于批处理的非关键工作负载。大多数用例的大多数培训工作需要不到 24 小时来完成。即使作业在此之前被中断，它们也几乎总是可以从检查点重新启动。

# 成本比较:成本降低 80%

因此，机器学习训练完全符合 spot 实例的预期用途。通过使用这些实例，从业者可以大幅降低成本。我们对三大云提供商进行了粗略的分析，以展示成本优势。原始数据可以在[这里](https://docs.google.com/spreadsheets/d/1wErQviA3sI22fh3BscO4CMJyg6w1Qqi468O1bCxUFhc/edit?usp=sharing)找到。如果你发现有什么要补充的，请随意分享这个文档并发表评论。这是一个快照，配置与之前相同:

*美国地区的所有成本，AWS 实例定价截止到 1 月 28 日 14:00 CET。*

可以看出，根据配置的不同，通过使用 spot 实例，成本最多可降低 **82%** ，跨多个云和配置的平均成本节约约为 **74%** 。这相当于节省了数百美元。特别是对于爱好者、小公司或小部门尝试机器学习来说，这可能意味着部署模型与起飞前崩溃和烧毁之间的差异。

使用这种技术并不新鲜:早在 2018 年，FastAI 团队[用 16 个 AWS spot 实例](https://www.fast.ai/2018/08/10/fastai-diu-imagenet/)在 18 分钟内训练了 ImageNet。这在当时花费了 40 美元，并且是在社区中最公开地展示了 spot 实例的疯狂成本效益。

然而，考虑到越来越大的模型的趋势，以及人工智能在世界范围内越来越多的采用，我只能看到随着时间的推移，现场实例培训的需求会增加。鉴于成本的巨大差异，使用现场实例培训作为培训的主要机制几乎是显而易见的，至少在实验阶段是如此。

# ZenML:编排 spot 实例训练的简单工具

如果你正在寻找 spot 实例训练的开端，请查看 [ZenML](https://github.com/maiot-io/zenml) ，这是一个用于可重复机器学习的开源 MLOps 框架。在 ZenML 中运行 spot pipeline 非常简单:

ZenML 不仅将你的代码压缩到实例中，还确保正确的 CUDA 驱动程序能够利用你选择的加速器。它提供实例，并在管道完成时关闭实例。更不用说框架提供的实验跟踪、版本控制和元数据管理的其他好处了。自己尝试一下:完整的代码示例可以在[这里](https://github.com/maiot-io/zenml/tree/main/examples)找到。

AWS 和 Azure 支持即将推出，我们希望您能对当前的设置提供反馈。如果你喜欢你所看到的，在 GitHub repo 给我们留下一颗[星吧！](https://github.com/maiot-io/zenml)