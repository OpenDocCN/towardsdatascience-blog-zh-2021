# å¦‚ä½•ä½¿ç”¨æ— æœåŠ¡å™¨æ‘„å–ç®¡ç†å™¨å’Œ Node.js å¤„ç† BigQuery ä¸­çš„æ•°æ®åŠ è½½

> åŸæ–‡ï¼š<https://towardsdatascience.com/how-to-handle-data-loading-in-bigquery-with-serverless-ingest-manager-and-node-js-4f99fba92436?source=collection_archive---------24----------------------->

## [å®è·µæ•™ç¨‹](https://towardsdatascience.com/tagged/hands-on-tutorials)

## æ–‡ä»¶æ ¼å¼ã€yaml ç®¡é“å®šä¹‰ã€è½¬æ¢å’Œäº‹ä»¶è§¦å‘å™¨ï¼Œä¸ºæ‚¨æä¾›ç®€å•å¯é çš„æ•°æ®æ¥æ”¶ç®¡ç†å™¨

![](img/98fc74c71249e8a3965e1001bf064c84.png)

æ ·æœ¬ç®¡é“å®šä¹‰ã€‚ä½œè€…å›¾ç‰‡[ğŸ’¡è¿ˆå…‹Â·æ²™å…‹éœç±³ç½—å¤«](https://medium.com/u/e06a48b3dd48?source=post_page-----4f99fba92436--------------------------------)

> -â€œç°åœ¨ï¼Œæ‚¨åªéœ€ä½¿ç”¨ä¸€ä¸ª' **$ npm run test'** 'å‘½ä»¤ï¼Œå°±å¯ä»¥ä»äº‘å­˜å‚¨ä¸­åŠ è½½ä¸æ‚¨çš„ç®¡é“å®šä¹‰åŒ¹é…çš„æ‰€æœ‰æ–‡ä»¶ï¼Œæˆ–è€…åœ¨é‚£é‡Œåˆ›å»ºæ–‡ä»¶æ—¶è°ƒç”¨æ•°æ®åŠ è½½ã€‚

[ä»£ç ä¸º](https://github.com/mshakhomirov/BigQuery-ingest-manager)çš„ Github åº“

![](img/9e6ed2cc7ba874492c45bdc87b0a198d.png)

ä½œè€…å›¾ç‰‡[ğŸ’¡è¿ˆå…‹Â·æ²™å…‹éœç±³ç½—å¤«](https://medium.com/u/e06a48b3dd48?source=post_page-----4f99fba92436--------------------------------)

**æ‚¨å°†äº†è§£å¦‚ä½•:**

1.  å°†æ•°æ®è‡ªåŠ¨åŠ è½½åˆ°æ‚¨çš„æ•°æ®ä»“åº“ä¸­ï¼Œå¹¶ä½¿ç”¨*æ— æœåŠ¡å™¨* (AWS Lambda)æ„å»ºä¸€ä¸ª ***æ•°æ®åŠ è½½æœåŠ¡***
2.  æ·»åŠ å„ç§æ–‡ä»¶æ ¼å¼æ”¯æŒå’ŒåŠ è½½ä¸åŒçš„æ–‡ä»¶ï¼Œå³ JSONï¼ŒCSVï¼ŒAVROï¼Œæ‹¼èŠ±ã€‚
3.  æ·»åŠ  DynamoDB è¡¨æ¥å­˜å‚¨æ‘„å–æ—¥å¿—ï¼Œå¹¶æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²ç»è¢«æ‘„å–
4.  æ·»åŠ æ•°æ®è½¬æ¢åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼Œä¸‡ä¸€æ‚¨æƒ³è¦å±è”½ä¸€äº›æ•æ„Ÿæ•°æ®æˆ–åŠ¨æ€æ›´æ”¹æ ¼å¼ã€‚
5.  ä¸€æ¬¡åŠ è½½å¤šä¸ªæ–‡ä»¶
6.  ä½¿ç”¨**åŸºç¡€è®¾æ–½ä½œä¸ºä»£ç **éƒ¨ç½²æ‚¨çš„æ•°æ®åŠ è½½æœåŠ¡ï¼Œå³ **AWS Cloudformation**
7.  å¦‚ä½•å°†å‹ç¼©æ–‡ä»¶åŠ è½½åˆ° BigQuery
8.  å¦‚ä½•ç›‘æ§æ•°æ®åŠ è½½é”™è¯¯

## å…³äºè¿™ä¸ªæƒ³æ³•

## æ„å»ºæ•°æ®ä»“åº“:åŠ è½½æ•°æ®

é€šå¸¸ï¼Œæ‚¨ä¼šå¸Œæœ›å°†æ‚¨çš„æ•°æ®ä»“åº“è§£å†³æ–¹æ¡ˆ(BigQueryã€Snowflake æˆ–ä»»ä½•å…¶ä»–è§£å†³æ–¹æ¡ˆ)æ”¾åœ¨å›¾è¡¨çš„**ä¸­å¿ƒ**ã€‚

*   **è½»æ¾è¿æ¥**ä»»ä½•å¤–éƒ¨æ•°æ®æºï¼Œå³è®¾ç½®ä¸€ä¸ªç®¡é“ä»æŸä¸ªä»»æ„ API è·å–æ•°æ®ï¼Œå³åƒæˆ‘ä¹‹å‰å†™çš„å…³äº[PayPal](/extract-data-from-paypal-api-c25c76748746)ã€15ã€‘å¹¶ä¿å­˜åˆ°äº‘ä¸­ã€‚
*   **åŠ è½½**æ•°æ®åˆ° **BigQuery**
*   **è½¬æ¢**æ•°æ®ï¼Œå¹¶ä½¿ç”¨ Gitã€CI/CD åˆ›å»ºæ–‡æ¡£åŒ–çš„æ•°æ®ç®¡é“ã€‚ä¾‹å¦‚ï¼Œç”¨**æ•°æ®è¡¨å•**æˆ– **dbt** ã€‚
*   **ä½¿ç”¨**äº‘å½¢æˆ**æˆ–**åœ°å½¢** ( **åŸºç¡€è®¾æ–½ä½œä¸ºä»£ç **)ç®€åŒ–å’Œè‡ªåŠ¨åŒ–éƒ¨ç½²**
*   **ç”¨ **Google Data Studio** åˆ›å»º BI æŠ¥å‘Š**(ä¾‹å¦‚ï¼Œæ”¶å…¥å¯¹è´¦ç­‰ã€‚)æˆ–ä»»ä½•å…¶ä»–å•†ä¸šæ™ºèƒ½è§£å†³æ–¹æ¡ˆã€‚æŸ¥çœ‹ä¸‹å›¾ï¼Œäº†è§£å…¶ä»–é€‰é¡¹ã€‚

![](img/22f45b2568ff019d0ab47b5961dbbc82.png)

ä½œè€…å›¾ç‰‡[ğŸ’¡è¿ˆå…‹Â·æ²™å…‹éœç±³ç½—å¤«](https://medium.com/u/e06a48b3dd48?source=post_page-----4f99fba92436--------------------------------)

# ç°ä»£æ•°æ®å †æ ˆå·¥å…·(å½“ç„¶ä¸æ˜¯å®Œæ•´çš„åˆ—è¡¨):

*   æ‘„å…¥:äº”å·ï¼Œç¼åˆ
*   ä»“å‚¨:é›ªèŠ±ï¼Œå¤§æŸ¥è¯¢ï¼Œçº¢ç§»
*   è½¬æ¢:dbtã€æ•°æ®è¡¨å•ã€APIã€‚
*   BI: Lookerï¼ŒModeï¼ŒPeriscopeï¼ŒChartioï¼ŒMetabaseï¼ŒRedash

![](img/4085ad070e65547d8000686f1083459c.png)

ä½œè€…å›¾ç‰‡[ğŸ’¡è¿ˆå…‹Â·æ²™å…‹éœç±³ç½—å¤«](https://medium.com/u/e06a48b3dd48?source=post_page-----4f99fba92436--------------------------------)

è°ˆåˆ°**æ•°æ®æå–å’Œæ¥æ”¶**æ‚¨å¯èƒ½å¸Œæœ›ä½¿ç”¨ä»˜è´¹å’Œæ‰˜ç®¡å·¥å…·ï¼Œå¦‚ **Fivetran** æˆ– **Stitch** ä»ä»»æ„æ•°æ®æº(å³æ”¯ä»˜å•†æˆ·æä¾›å•†ã€æ±‡ç‡ã€åœ°ç†ç¼–ç æ•°æ®åº“ç­‰)æå–æ•°æ®ã€‚)ä½†æ˜¯å¦‚æœä½ éµå¾ªè¿™ä¸ªæŒ‡å—ï¼Œä½ å°†å®Œå…¨æœ‰èƒ½åŠ›è‡ªå·±åšè¿™ä»¶äº‹ã€‚

# æ–¹æ¡ˆ

å‡è®¾ä½ æ˜¯ä¸€åæ•°æ®å·¥ç¨‹å¸ˆï¼Œä½ æ­£åœ¨åšä¸€ä¸ªé¡¹ç›®ï¼Œå°†ä¸åŒçš„æ•°æ®æºè¿æ¥åˆ°ä½ çš„æ•°æ®ä»“åº“ä¸­ã€‚æ‚¨çš„å…¬å¸æ˜¯ä¸€å®¶æ‰‹æœºæ¸¸æˆå¼€å‘å·¥ä½œå®¤ï¼Œåœ¨ IOS å’Œ ANDROID ä¸¤ä¸ªå¹³å°ä¸Šé”€å”®å„ç§äº§å“ã€‚

**ä½ çš„ç­¹ç **

> *ä½ çš„å¼€å‘æ ˆæ˜¯æ··åˆçš„ï¼ŒåŒ…æ‹¬****AWS****å’Œ****GCP****ã€‚*
> 
> ä½ çš„å›¢é˜Ÿç»å¸¸ä½¿ç”¨ Node.jsã€‚æ•°æ®ç§‘å­¦å›¢é˜Ÿä½¿ç”¨ Pythonï¼Œä½†æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ•°æ®ç®¡é“æ˜¯ä½¿ç”¨ Node åˆ›å»ºçš„ã€‚
> 
> *æ‚¨çš„æ•°æ®å †æ ˆæ˜¯ç°ä»£çš„ã€äº‹ä»¶é©±åŠ¨çš„å’Œæ•°æ®å¯†é›†å‹çš„ã€‚*
> 
> *æ•°æ®ä»“åº“è§£å†³æ–¹æ¡ˆå¿…é¡»å…·æœ‰è¶³å¤Ÿçš„æˆæœ¬æ•ˆç›Šå’Œçµæ´»æ€§ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥æ·»åŠ ä»»ä½•æ‰€éœ€çš„æ•°æ®æºã€‚å®ƒå¿…é¡»èƒ½å¤Ÿè½»æ¾æ‰©å±•ï¼Œä»¥æ»¡è¶³æ‚¨ä¸æ–­å¢é•¿çš„æ•°æ®ã€‚*

**ä»»åŠ¡**

æ‰€æœ‰æ•°æ®æ¥è‡ªå„ç§æ•°æ®è¡¨é¢çš„æ–‡ä»¶ï¼Œå³æ•°æ®åº“ã€kinesis æ¶ˆé˜²æ°´å¸¦æµå’Œå„ç§é€šçŸ¥æœåŠ¡ã€‚å®ƒä»¥ä¸åŒçš„æ ¼å¼(CSVã€JSONã€PARQUET ç­‰)å­˜å‚¨åˆ°æ‚¨çš„äº‘æ•°æ®æ¹–ä¸­ã€‚).

ä½œä¸ºä¸€å**æ•°æ®å·¥ç¨‹å¸ˆ**ï¼Œä½ çš„ä»»åŠ¡æ˜¯å°†**æ•°æ®åŠ è½½**è¿‡ç¨‹è‡ªåŠ¨åŒ–åˆ°ä½ çš„ **BigQuery** æ•°æ®ä»“åº“ä¸­ã€‚ä½ æœ‰è®¸å¤šä»»æ„çš„æ•°æ®æºå’Œç®¡é“å°†æ–‡ä»¶é€å…¥ä½ çš„ AWS S3 æ•°æ®æ¹–ã€‚

*ç°åœ¨ä½ éœ€è¦*

> *â€¦â€¦â€œä¸€ä¸ªå¯é çš„*æœåŠ¡*æ¥ç®¡ç†æ–‡ä»¶æ ¼å¼ï¼Œå†³å®šä¸Šä¼ åˆ°å“ªä¸ªè¡¨å¹¶ç›‘æ§æ•´ä¸ªè¿‡ç¨‹ã€‚â€*

*ä½ å†³å®šä½¿ç”¨****AWS Lambda****å‡½æ•°å’Œ****node . js****æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚*

# ä½ çš„å¾®æœåŠ¡åº”ç”¨é€»è¾‘:

1.  æ‚¨çš„æ•°æ®è¿æ¥å™¨ä»ä¸€äº›æ•°æ®æºæå–æ•°æ®(å¯ä»¥æ˜¯ä»»æ„çš„ï¼Œå¦‚ PayPal)
2.  æ–‡ä»¶æ­£åœ¨è¢«ä¿å­˜åˆ° S3 T21 çš„æ•°æ®åº“ä¸­ã€‚
3.  å½“æ–°æ–‡ä»¶è¿›å…¥æ‚¨çš„ *S3 æ•°æ®æ¡¶*æ—¶ï¼Œå°†è§¦å‘æ•°æ®æ¥æ”¶ã€‚
4.  è¯¥æœåŠ¡å°†å¤„ç†è¿™äº›æ–‡ä»¶ï¼Œå¹¶ä¸º *BigQuery* åšå¥½å‡†å¤‡ï¼Œä»¥ä¾¿å°†å…¶æ’å…¥åˆ°è¡¨ä¸­ã€‚è¯¥æœåŠ¡å°†å†³å®šæ’å…¥å“ªä¸ªè¡¨ã€‚
5.  è¯¥æœåŠ¡å°†æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²ç»è¢«æ‘„å–ï¼Œä»¥é˜²æ­¢é‡å¤ã€‚æ‚¨å°†ä½¿ç”¨ *AWS DynamDB* æ¥ä¿å­˜æ•°æ®åŠ è½½è®°å½•ã€‚
6.  æ•æ‰æ•°æ®æ‘„å–é”™è¯¯ï¼Œå¹¶åœ¨éœ€è¦æ—¶ä¿å­˜æ–‡ä»¶ä»¥ä¾›è¿›ä¸€æ­¥è°ƒæŸ¥ã€‚
7.  ç°åœ¨ï¼Œæ‚¨å¯ä»¥åœ¨æ•°æ®ä»“åº“ä¸­è½¬æ¢æ•°æ®ã€‚
8.  é€šè¿‡é€šçŸ¥ç›‘æ§æ‚¨çš„æ•°æ®åŠ è½½è¿‡ç¨‹ã€‚å¦‚æœæœ‰ä»»ä½•é”™è¯¯ï¼Œæ‚¨å°†æ”¶åˆ°ä¸€å°ç”µå­é‚®ä»¶ã€‚

![](img/8be0d1e8dfbfdb3c9de01b5142f79a21.png)

ä½œè€…å›¾ç‰‡[ğŸ’¡è¿ˆå…‹Â·æ²™å…‹éœç±³ç½—å¤«](https://medium.com/u/e06a48b3dd48?source=post_page-----4f99fba92436--------------------------------)

# å…ˆå†³æ¡ä»¶ã€åº“å’Œè®¾ç½®

**å·¥å…·**

*   å·²å®‰è£… Node.js å’ŒèŠ‚ç‚¹åŒ…ç®¡ç†å™¨
*   å¯¹äº‘è®¡ç®—(Amazon Web Services å¸æˆ·)ã€AWS CLI å’Œ AWS SDK æœ‰åŸºæœ¬çš„äº†è§£
*   Google BigQuery å’Œä¸€ä¸ªæœåŠ¡å¸æˆ·æ¥éªŒè¯æ‚¨çš„æœåŠ¡ã€‚
*   Shell(å‘½ä»¤è¡Œç•Œé¢)å‘½ä»¤å’Œè„šæœ¬(é«˜çº§)ã€‚

**æŠ€æ³•**

*   å¯¹ REST APIs çš„ç†è§£ã€‚
*   è‰¯å¥½çš„èŠ‚ç‚¹çŸ¥è¯†ã€‚JS(ä¸­çº§)ã€‚æ‚¨å°†åˆ›å»ºä¸€ä¸ª Lambda å‡½æ•°ã€‚
*   **ä½ å¿…é¡»äº†è§£èŠ‚ç‚¹ã€‚JS åŸºæœ¬æ¦‚å¿µï¼Œå³å¼‚æ­¥å‡½æ•°ã€èŠ‚ç‚¹åŒ…å’Œä»£ç å¦‚ä½•å·¥ä½œã€‚**
*   **åŸºæœ¬è°ƒè¯•(æ§åˆ¶å°ï¼Œæ‰“å°æŠ¥è¡¨)**
*   **å¾ªç¯:å³ç”¨äº**
*   **åˆ†æ”¯:ifï¼Œif/elseï¼Œå¼€å…³**
*   Shell å‘½ä»¤å’Œè„šæœ¬ï¼Œå°±åƒæ‚¨å¸Œæœ›ä»å‘½ä»¤è¡Œä½¿ç”¨ AWS CLI éƒ¨ç½² Lambda å¹¶èƒ½å¤Ÿåœ¨æœ¬åœ°æµ‹è¯•å®ƒä¸€æ ·ã€‚

# æˆ‘ä»¬å¼€å§‹å§

# ç¬¬ä¸€æ­¥ã€‚å¦‚ä½•ä½¿ç”¨æ— æœåŠ¡å™¨(AWS Lambda)æ„å»ºæ•°æ®åŠ è½½æœåŠ¡ï¼Œå¹¶è‡ªåŠ¨å°†æ•°æ®åŠ è½½åˆ°æ•°æ®ä»“åº“ä¸­

# ä¸ºæ‚¨çš„æ•°æ®æ¹–åˆ›å»ºæ–°çš„ S3 å­˜å‚¨æ¡¶

ç”¨æ‚¨çš„ bucket åç§°æ›¿æ¢`your-bigquery-project-name.test.aws`,å¹¶ä»å‘½ä»¤è¡Œè¿è¡Œï¼Œä¾‹å¦‚ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ AWS CLI:

`aws s3 mb s3://bq-shakhomirov.bigquery.aws`

æ‚¨å°†çœ‹åˆ°å¦‚ä¸‹å†…å®¹:

`$ make_bucket: bq-shakhomirov.bigquery.aws`ç¡®è®¤å­˜å‚¨æ¡¶å·²åˆ›å»ºã€‚[é˜…è¯» AWS S3 æ–‡æ¡£](https://docs.aws.amazon.com/cli/latest/userguide/cli-services-s3-commands.html#using-s3-commands-managing-buckets-creating)

å°†æ•°æ®é›†ä»ä¸Šä¼ åˆ°æ‚¨æ–°åˆ›å»ºçš„ S3 å­˜å‚¨æ¡¶:

`$ aws s3 cp ./data/payment_transaction s3://bq-shakhomirov.bigquery.aws/payment_transaction`

`$ aws s3 cp ./data/paypal_transaction s3://bq-shakhomirov.bigquery.aws/paypal_transaction`

# åˆ›å»ºä¸€ä¸ªç©ºçš„ AWS Lambda å‡½æ•°(Node.js)ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ *AWS web æ§åˆ¶å°*æˆ– *AWS CLI* æ¥å®Œæˆã€‚è¿™å–å†³äºæ‚¨ï¼Œå¹¶åœ¨æœ¬åœ°åˆå§‹åŒ–æ‚¨çš„`Node.js`åº”ç”¨ç¨‹åºã€‚æ‚¨çš„å¾®æœåŠ¡æ–‡ä»¶å¤¹ç»“æ„å¿…é¡»å¦‚ä¸‹æ‰€ç¤º:

å…¶ä¸­`bq-shakhomirov-service-account-credentials.json`æ˜¯æ‚¨çš„ BigQuery æœåŠ¡å¸æˆ·å‡­è¯ã€‚

# æˆäºˆæ‚¨çš„æœåŠ¡ä»æ•°æ®æ¹–æ¡¶ä¸­è¯»å–æ•°æ®çš„æƒé™

æ‚¨å¯èƒ½å¸Œæœ›ä»æ‚¨çš„ **S3 æ•°æ®æ¡¶**ä¸­è¯»å–æ‚¨çš„æ•°æ®é›†æ–‡ä»¶ï¼Œç„¶åå°†è¯¥æ•°æ®åŠ è½½åˆ°æ‚¨çš„ **BigQuery** æ•°æ®ä»“åº“ä¸­ã€‚å› æ­¤ï¼Œæ‚¨éœ€è¦é€šè¿‡å‘ Lambda å‡½æ•°çš„è§’è‰²æ·»åŠ ä¸€ä¸ªç­–ç•¥ï¼Œå°† Lambda å‡½æ•°çš„ S3 è®¿é—®æƒé™æˆäºˆæ‚¨çš„ bucketï¼Œå¦‚ä¸‹æ‰€ç¤º:

ä½ å¯ä»¥åœ¨ AWS æ–‡æ¡£[ä¸­æ‰¾åˆ°æ›´å¤šå…³äºå¦‚ä½•åˆ›å»º**è§’è‰²**çš„ä¿¡æ¯ã€‚åé¢æˆ‘ä¼šä¸¾ä¾‹è¯´æ˜å¦‚ä½•ç”¨](https://aws.amazon.com/blogs/security/how-to-create-an-aws-iam-policy-to-grant-aws-lambda-access-to-an-amazon-dynamodb-table/)[**AWS cloud formation**](https://aws.amazon.com/cloudformation/)æ ˆæ¥åšã€‚

# å®‰è£…æ‰€éœ€çš„ä¾èµ–é¡¹

å®‰è£…æ‰€éœ€çš„`node`æ¨¡å—å’Œåº“ï¼Œå¦‚`./package.json`æ‰€ç¤ºã€‚æ‚¨å°†éœ€è¦:

*   â€œAWS-SDKâ€:â€œ2 . 804 . 0â€ç”¨äºè®¿é—®å¸¦æœ‰æ•°æ®çš„ S3 æ¡¶
*   " run-local-lambda": "1.1.1 "æ¥æµ‹è¯• nad å¹¶åœ¨æœ¬åœ°è¿è¡Œæ‚¨çš„ Lamdba
*   â€œ@google-cloud/bigqueryâ€:æ‘„å–æ•°æ®çš„â€œâµ.7.0â€
*   â€œæ—¶åˆ»â€:" . 24.0 "å¤„ç†æ—¥æœŸå¹¶åˆ›å»ºç›¸å…³çš„`file names` / `BigQuery jobIds`

ç¡®ä¿æ‚¨å¯ä»¥åœ¨æœ¬åœ°è¿è¡Œå®ƒã€‚è¿™ä¸ªæƒ³æ³•æ˜¯é€šè¿‡ä»å‘½ä»¤è¡Œè¿è¡Œ`npm run local`å‘½ä»¤æ¥æ¨¡æ‹Ÿä¸€ä¸ªäº‹ä»¶( *S3 å¯¹è±¡åˆ›å»ºäº‹ä»¶*)ã€‚å®‰è£…â€œrun-local-lambdaâ€:â€œ1 . 1 . 1â€æ¥æµ‹è¯•å¹¶åœ¨æœ¬åœ°è¿è¡Œæ‚¨çš„ Lamdbaã€‚

ä½ çš„`./package.json`ä¸€å®šæ˜¯è¿™æ ·çš„:

åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ`npm i`ï¼Œå®ƒå°†å®‰è£…ä¾èµ–é¡¹ã€‚

# app.js

åœ¨æ‚¨çš„`./app.js`ä¸­æ·»åŠ ***async process event()***å‡½æ•°æ¥å¤„ç†äº‹ä»¶ã€‚

æ‚¨çš„`./app.js`çœ‹èµ·æ¥ä¼šåƒ:

å“ªé‡Œ`./config.json`æ˜¯ä½ çš„æœåŠ¡**é…ç½®æ–‡ä»¶**ã€‚

> *æˆ‘æ›´å–œæ¬¢ç”¨****YAML****æ¥ä»£æ›¿ï¼Œä¸è¿‡æ˜¯å£å‘³é—®é¢˜ã€‚æœ€ç»ˆä½ ä¼šæ‰¾åˆ°ä½¿ç”¨* `*npm config*` *å’Œ* ***yaml çš„è§£å†³æ–¹æ¡ˆã€‚*** *å¯¹ä½ çš„***æ¥è¯´ä¼¼ä¹æ˜¯æ­£ç¡®çš„äº‹æƒ…ã€‚**

*ä½ çš„`./config.json`çš„ä¾‹å­å¯ä»¥æœ‰**ç°åœº**å’Œ**ç™»å°**ç¯å¢ƒè®¾ç½®ï¼Œçœ‹èµ·æ¥åƒè¿™æ ·:*

> **ä½¿ç”¨é…ç½®æ–‡ä»¶å®šä¹‰é€»è¾‘ã€è¡¨åä»¥åŠå¦‚ä½•ä¸ºè¿™äº›è¡¨é€‰æ‹©ç›¸å…³æ–‡ä»¶ã€‚**

***ä½¿ç”¨ä¸Šé¢çš„è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ‚¨çš„æ•°æ®åŠ è½½æœåŠ¡å°†å°è¯•å°†** `name` **é”®ä¸ç›¸å…³æ–‡ä»¶å** `fileKey` **åŒ¹é…ã€‚å¦‚æœå®ƒåœ¨ S3 äº‹ä»¶ä¸­æ‰¾åˆ°åŒ¹é…ï¼Œé‚£ä¹ˆå®ƒå°†å¼€å§‹åŠ è½½æ•°æ®ã€‚***

# *BigQuery å‡­æ®æ–‡ä»¶*

*`./bq-shakhomirov-b86071c11c27.json`æ˜¯ **BigQuery** å‡­è¯æ–‡ä»¶çš„ä¸€ä¸ªä¾‹å­ã€‚ä½ å°†éœ€è¦è¿™ä¸ª ***æœåŠ¡å¸æˆ·å‡­è¯*** æ–‡ä»¶æ¥é€šè¿‡è°·æ­Œè®¤è¯ä½ çš„å¾®æœåŠ¡ï¼Œè¿™æ ·å®ƒå®é™…ä¸Šå¯ä»¥åšä¸€äº›äº‹æƒ…ã€‚ç‚¹å‡»é˜…è¯»æ›´å¤šå…³äº[æœåŠ¡è´¦æˆ·è®¤è¯çš„ä¿¡æ¯ã€‚åªéœ€ä»ä½ çš„*è°·æ­Œäº‘å¹³å°*è´¦å·ä¸‹è½½ï¼Œæ·»åŠ åˆ°ä½ çš„åº”ç”¨æ–‡ä»¶å¤¹ã€‚](https://cloud.google.com/docs/authentication/production)*

*çœ‹èµ·æ¥åº”è¯¥æ˜¯è¿™æ ·çš„:*

# *å¦‚ä½•æ£€æŸ¥ BigQuery ä¸­æ˜¯å¦å­˜åœ¨è¡¨*

*æ‚¨å¯èƒ½å¸Œæœ›åœ¨åŠ è½½æ•°æ®ä¹‹å‰æ‰§è¡Œæ­¤æ“ä½œã€‚å°†è¿™ä¸ªå‡½æ•°æ·»åŠ åˆ°æ‚¨çš„`./app.js`æ–‡ä»¶çš„`processEvent()`ä¸­ã€‚å¦‚æœè¡¨ä¸å­˜åœ¨ï¼Œå®ƒå°†ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„æ¨¡å¼å¹¶åˆ›å»ºä¸€ä¸ªã€‚*

*è¿™ä¸ªå‡½æ•°å°†åœ¨åä¸º`source`çš„æ•°æ®é›†ä¸­åˆ›å»ºä¸€ä¸ªå¸¦æœ‰é…ç½®æ–‡ä»¶æ¨¡å¼çš„è¡¨ã€‚å®ƒä¹Ÿåº”è¯¥æ¥è‡ª`./config.json`ï¼Œä½†è¿™åªæ˜¯ä¸€ä¸ªä¾‹å­ã€‚*

# *å¦‚ä½•å°† JSON æ–‡ä»¶æµå¼åŠ è½½åˆ° BigQuery ä¸­*

*è¿™å°†æ˜¯ä¸€ä¸ª ***é€è¡Œ*** çš„æ’å…¥æ“ä½œã€‚*

*å½“ä¸€è¡Œä¸ç¬¦åˆæ¨¡å¼æ—¶ï¼Œåªæœ‰è¯¥ç‰¹å®šè¡Œä¼šè¢«æ’å…¥ï¼Œè€Œä¸æ˜¯ BigQuery ä¸­çš„ ***æ‰¹é‡æ’å…¥*** (ä¸€è¡Œæ¨¡å¼éªŒè¯å¤±è´¥â€”æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ å¤±è´¥)ã€‚*

*æ‚¨å¯èƒ½æƒ³è¦æ·»åŠ ä¸€ä¸ªæ–°åŠŸèƒ½:*

*è¿™åªæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå…¶ä¸­å·²ç»å£°æ˜äº† JSON æ•°æ®(ä¸éœ€è¦ä»æœ¬åœ°æ–‡ä»¶æˆ–è€…ä» ***äº‘å­˜å‚¨*** )å¹¶ä¸”å·²ç»åˆ›å»ºäº†è¡¨ã€‚`simple_transaction`æ˜¯ä¸€ä¸ªç®€å•çš„è¡¨ï¼Œåªæœ‰ 3 åˆ—:`transaction_id`ã€`user_id`å’Œ`dt`ï¼Œåœ¨`./config.json`æ¨¡å¼ä¸­ä¸ºåä¸º`simple_transaction`çš„è¡¨å®šä¹‰ã€‚è¯•è¯•çœ‹ï¼Œå®ƒä¼šå°†æ•°æ®é€è¡Œæ’å…¥ BigQuery è¡¨ä¸­ã€‚*

*æ‚¨å¯ä»¥ç¨å¾®è°ƒæ•´æ­¤å‡½æ•°ï¼Œä¾‹å¦‚ä»**æœ¬åœ°æ–‡ä»¶**ä¸­è¯»å–æ•°æ®ï¼Œå®ƒå°†å¤„ç†æ–°çš„è¡Œåˆ†éš”æ–‡ä»¶`./data/simple_transaction`å¹¶åˆ›å»ºä¸€ä¸ª[åŠ è½½ä½œä¸šæ“ä½œ](https://cloud.google.com/bigquery/docs/reference/rest/v2/Job#JobConfigurationLoad)æ¥ä»£æ›¿æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„[å†™æµ](https://googleapis.dev/nodejs/bigquery/latest/Table.html#createWriteStream)ã€‚*

# *å¦‚ä½•ä» AWS S3 åŠ è½½ JSON æ–°è¡Œåˆ†éš”æ•°æ®*

*å¦‚æœä½ çš„æ•°æ®æ˜¯æ–°è¡Œåˆ†éš”çš„ JSON(big query åŠ è½½ JSON æ•°æ®çš„è‡ªç„¶æ–¹å¼),é‚£ä¹ˆä½ éœ€è¦ä¸€ä¸ªåƒä¸‹é¢è¿™æ ·çš„å‡½æ•°ã€‚è¯¥åŠŸèƒ½å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œ:*

1.  *ä» **AWS S3** åˆ›å»ºä¸€ä¸ªè¯»å–æµå¹¶è¯»å–æ–‡ä»¶*
2.  *ä½¿ç”¨ [*JSONStream*](https://github.com/dominictarr/JSONStream) æ¨¡å—è§£æ JSON æ–‡ä»¶ä¸­çš„æ•°æ®*
3.  *åœ¨ BigQuery ä¸­åˆ›å»ºä¸€ä¸ª ***æ‰¹å¤„ç†*** åŠ è½½ä½œä¸šã€‚*

*æŠŠè¿™ä¸ªåŠ åˆ°ä½ çš„`./app.js`é‡Œï¼Œè¯•è¯•`npm run test`ã€‚å°†`./test/data.json`ä¿®æ”¹ä¸º`object.key = 'simple_transaction`:*

*æ‚¨çš„â€œsimple_transactionâ€æ–‡ä»¶å†…å®¹åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:*

> **é‚£ä¹ˆ* ***BigQuery æµæ’å…¥*** *å’Œ* ***æ‰¹é‡*** *æ’å…¥æ“ä½œæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ**

*å®ƒä»ç„¶æ˜¯ä¸€ä¸ªä½œä¸š(ä¸æ˜¯åƒæˆ‘ä»¬ä¸Šé¢åšçš„é‚£æ ·***big query streaming***insert ),ä½†æ˜¯åœ¨æ¶æ„æ–¹é¢å®ƒæ˜¯éå¸¸é«˜æ•ˆçš„å†…å­˜ï¼Œå¹¶ä¸” ***æ˜¯ç©ºé—²çš„*** ã€‚æ‚¨åªéœ€è¦ä¸è¶…è¿‡æ¯å¤©æ¯ä¸ªè¡¨çš„æ‰¹å¤„ç†ä½œä¸šé…é¢ã€‚æˆ‘ä¹‹å‰åœ¨è¿™é‡Œå†™è¿‡å¦‚ä½•åœ¨ BigQuery ä¸­ç›‘æ§**æ‰¹é‡åŠ è½½ä½œä¸šæ“ä½œ:***

*</monitoring-your-bigquery-costs-and-reports-usage-with-data-studio-b77819ffd9fa>  

> å¾ˆå¥½ï¼Œä½†å¯èƒ½ä¼šäº§ç”Ÿæ›´é«˜çš„è´¹ç”¨ã€‚

æˆ‘å»ºè®®å°½å¯èƒ½ä½¿ç”¨`batch` insertã€‚æ¯ä¸ªè¡¨æ¯å¤©æœ‰ 2000 ä¸ªæ’å…¥çš„é…é¢ï¼Œä½†æ˜¯æ‚¨å¯ä»¥ä¸€æ¬¡æ’å…¥æ•´ä¸ªæ–‡ä»¶ã€‚ ***æµåª’ä½“æ’å…¥*** æ²¡é‚£ä¹ˆä¾¿å®œï¼Œæ¯ GB 0.05 ç¾å…ƒï¼Œ1TB 50 ç¾å…ƒã€‚

> æµå¼æ’å…¥æ˜¯å¯¼å…¥æ•°æ®çš„æ¨èæ–¹å¼ï¼Œå› ä¸ºå®ƒæ˜¯å¯ä¼¸ç¼©çš„ã€‚

ç„¶è€Œï¼Œå¦‚æœæ•°æ®æ¹–ä¸­çš„æ–‡ä»¶ç›¸å¯¹è¾ƒå°(è¿™é€šå¸¸å‘ç”Ÿåœ¨ä½¿ç”¨æ•°æ®æµæ—¶ï¼Œå³ Kinesis æˆ– Kafka ),è¿™ä¸ä¼šäº§ç”Ÿå¾ˆå¤§çš„å½±å“ã€‚åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šå…³äº[å¤§æŸ¥è¯¢é…é¢å’Œé™åˆ¶çš„ä¿¡æ¯](https://cloud.google.com/bigquery/quotas)

# å¦‚ä½•ç”¨ Node.js å’Œ AWS Lambda å¾®æœåŠ¡å°† CSV æ•°æ®åŠ è½½åˆ° BigQuery è¡¨ä¸­

æ‚¨å¯èƒ½å¸Œæœ›æ·»åŠ ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä» S3 å¯¹è±¡è¯»å–æ•°æ®ï¼Œå¹¶å°†å…¶ä½œä¸º **CSV** ä¸Šä¼ åˆ° BigQuery è¡¨ä¸­:

è¿™æ˜¯ä¸€ä¸ªä» S3 è¯»å–ä¸€ä¸ª **CSV** æ–‡ä»¶çš„ä¾‹å­ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œä½ ä¼šå¸Œæœ›åœ¨ *Node.js æµ*æ¨¡å¼ä¸‹è¿™æ ·åšä»¥èŠ‚çœä½ çš„å†…å­˜ï¼Œè€Œä¸æ˜¯å°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥å†…å­˜ã€‚å®ƒåˆ›å»ºä¸€ä¸ª ***å¯è¯»æµ*** ç„¶åæµå…¥ ***æµå¯å†™*** åˆ° BigQueryã€‚

# å±€éƒ¨è§£å†³

è¿™æ˜¯è¿™ä¸ªé¡¹ç›®çš„`app.js`ã€‚è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„åº”ç”¨ç¨‹åºã€‚å¤åˆ¶æ­¤æ–‡ä»¶å¹¶ä½¿ç”¨å®ƒæ¥å¼€å‘æ‚¨çš„è§£å†³æ–¹æ¡ˆã€‚

æ‚¨å¿…é¡»åˆ›å»ºè‡ªå·±çš„ BigQuery æœåŠ¡å¸æˆ·å‡­è¯ï¼Œä¾‹å¦‚ï¼Œåƒæˆ‘ä¸€æ ·ä¸‹è½½`./bq-shakhomirov-b86071c11c27.json`å¹¶åˆ›å»ºè‡ªå·±çš„`./config.json`æ¥å®šä¹‰è¡¨æ¨¡å¼å’Œåº”ç”¨ç¨‹åºç¯å¢ƒã€‚

**è¯¥*åº”ç”¨*æ‰§è¡Œä»¥ä¸‹æ“ä½œ:**

1.  å½“æ‚¨è¿è¡Œ`$npm run test`æ—¶ï¼Œå®ƒå°†ä½¿ç”¨æ¥è‡ª`./test/data.json`çš„æœ‰æ•ˆè½½è·æ¥æè¿° S3 æ–‡ä»¶çš„ä½ç½®(æŸ¥çœ‹`./package.json`ä¸­çš„è„šæœ¬)
2.  ç„¶åï¼Œå®ƒå°†ä»`./config.json`è·å–è®¾ç½®ï¼Œå³å‡­è¯ä½ç½®ç­‰ã€‚å¹¶ä½¿ç”¨ **BigQuery API** è¿›è¡Œè®¤è¯
3.  å®ƒå°†éå†`./config.json`ä¸­æè¿°çš„è¡¨æ ¼ï¼Œè¯•å›¾åœ¨æœ‰æ•ˆè½½è·ä¸­æ‰¾åˆ°ä¸€ä¸ªåŒ¹é…ã€‚**æœ¬ä¾‹ä¸­çš„æœ‰æ•ˆè½½è·**æ¨¡æ‹Ÿ **S3 å¯¹è±¡åˆ›å»ºçš„** [äº‹ä»¶](https://stackoverflow.com/questions/7985599/notification-of-new-s3-objects)ã€‚
4.  å¦‚æœæ‰¾åˆ°åŒ¹é…ï¼ŒæœåŠ¡å°†å°è¯•ä» S3 è·å–è¯¥æ–‡ä»¶ï¼Œå¹¶å°†å…¶ä¸­çš„æ•°æ®åŠ è½½åˆ°ç›¸å…³çš„ **BigQuery** è¡¨ä¸­ã€‚
5.  å®ƒå°†æ£€æŸ¥è¡¨æ ¼æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå®ƒå°†ä½¿ç”¨`./config.json`çš„æ¨¡å¼åˆ›å»ºä¸€ä¸ªæ–°çš„è¡¨æ ¼

# æ·»åŠ  DynamoDB æ¥ä¿å­˜æ•°æ®æ‘„å–è®°å½•

å¦‚æœæ‚¨éœ€è¦å¤„ç†åŠ è½½ä½œä¸šçš„å¤åˆ¶å°è¯•ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½ä¼šæƒ³è¦åˆ›å»ºä¸€ä¸ªæ–°è¡¨ï¼Œå¹¶ä¿ç•™æ‘„å–æ–‡ä»¶çš„è®°å½•ã€‚é‚£ä¹ˆæ‚¨å¯ä»¥è€ƒè™‘å°†è¿™ä¸ªç‰‡æ®µæ·»åŠ åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ï¼Œåœ¨`./app.js`:

å¦‚æœä½ æ·»åŠ ç±»ä¼¼äº`await logSuccessfulEvent(sourceBucket, fileKey, now.format('YYYY-MM-DDTHH:mm:ss'));`çš„ä¸œè¥¿ï¼Œå®ƒå°†å¼€å§‹è®°å½•æˆåŠŸæ‘„å–çš„æ–‡ä»¶ï¼Œä½†æ˜¯ä½ éœ€è¦é¦–å…ˆåˆ›å»ºä¸€ä¸ªè¡¨:è¿›å…¥ AWS [æ§åˆ¶å°](https://us-east-2.console.aws.amazon.com/dynamodb/home?region=us-east-2#gettingStarted:):

*   ä¸ºæˆåŠŸè·å–çš„æ–‡ä»¶åˆ›å»ºä¸€ä¸ªåä¸º`ingestManager`çš„è¡¨ã€‚
*   å‘æ‚¨çš„ Lambda æ·»åŠ è®¿é—® Dynamo è¡¨çš„æƒé™ã€‚

![](img/9c58d7d8d8b25623c45069d5acbae88b.png)

ä½œè€…å›¾ç‰‡[ğŸ’¡è¿ˆå…‹Â·æ²™å…‹éœç±³ç½—å¤«](https://medium.com/u/e06a48b3dd48?source=post_page-----4f99fba92436--------------------------------)

*   å°†å¤„ç†`successfull`äº‹ä»¶çš„`logSuccessfulEvent`å‡½æ•°æ·»åŠ åˆ°`./app.js`æ–‡ä»¶:

å› æ­¤ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ‘„å–è®°å½•:

![](img/45916f3aa2aec4556a4c23d8b9829251.png)

ä½œè€…å›¾ç‰‡[ğŸ’¡è¿ˆå…‹Â·æ²™å…‹éœç±³ç½—å¤«](https://medium.com/u/e06a48b3dd48?source=post_page-----4f99fba92436--------------------------------)

ç°åœ¨ï¼Œæ‚¨å¯èƒ½æƒ³è¦æ·»åŠ ä¸€ä¸ªæ–°å‡½æ•°ã€‚å§‘ä¸”ç§°ä¹‹ä¸º`checkAlreadyIngested()`ã€‚

> *æ­¤å‡½æ•°å°†æ£€æŸ¥æ‚¨çš„æ•°æ®åŠ è½½ç®¡é“æ˜¯å¦æœ‰ä»»ä½•å¤åˆ¶ä¼å›¾ï¼Œå¹¶é˜²æ­¢è¿™äº›å¤åˆ¶ä¼å›¾ã€‚*

ç¡®ä¿ç”¨`try, catch`å—åŒ…è£¹å³å¯ã€‚

# å¦‚ä½•ç›‘æ§ BigQuery æ•°æ®åŠ è½½æœåŠ¡ä¸­çš„é”™è¯¯å’Œå¤åˆ¶å°è¯•

â€¦æˆ–è€…ä»»ä½•å…¶ä»–æ•°æ®ä»“åº“ã€‚

æ‚¨å¯èƒ½æƒ³åœ¨æ¯æ¬¡å‡ºç°é”™è¯¯æ—¶æ”¶åˆ°é€šçŸ¥ã€‚

*   ä½¿ç”¨ç®€å•é€šçŸ¥æœåŠ¡(SNS)åˆ›å»ºä¸€ä¸ª **AlarmNotificationTopic** ï¼Œä»¥ä¾¿åœ¨å‡ºç°ä»»ä½•æ‘„å–é”™è¯¯æ—¶é€šè¿‡ç”µå­é‚®ä»¶æ¥æ”¶é€šçŸ¥ã€‚
*   å½“æ‚¨åˆ›å»º Lambda å¹¶é™„åŠ ç­–ç•¥æ—¶ï¼Œå®ƒä¸€å®šå·²ç»åˆ›å»ºäº†ä¸€ä¸ª **LogGroupName** : `/aws/lambda/ingestManager`æˆ–ç±»ä¼¼çš„ä¸œè¥¿ã€‚ä½¿ç”¨å®ƒåˆ›å»º **ERRORMetricFilter** ï¼Œå…¶ä¸­*é”™è¯¯è®¡æ•°> 0* ã€‚ä¾‹å¦‚ï¼Œæˆ‘çš„æ—¥å¿—ç»„å¦‚ä¸‹æ‰€ç¤º:

![](img/f1d5f5ab3745bf6f628ee46c40ad16e2.png)

ä½œè€…å›¾ç‰‡

*   ä½¿ç”¨ä»¥ä¸‹æ¨¡å¼åˆ›å»ºä¸€ä¸ª ERROR metric filter:filter pattern:' ERROR 'è°ƒç”¨å®ƒ`ingestManagerStagingMetricFilter`

![](img/22b52769f4d6183b844a785b183f7e28.png)

ä½œè€…å›¾ç‰‡[ğŸ’¡è¿ˆå…‹Â·æ²™å…‹éœç±³ç½—å¤«](https://medium.com/u/e06a48b3dd48?source=post_page-----4f99fba92436--------------------------------)

*   ç°åœ¨å»`SNS`åˆ›å»ºä½ çš„æé†’ä¸»é¢˜:

![](img/fbdc49a0be5c04b51655a5ad6d87f087.png)

ä½œè€…å›¾ç‰‡[ğŸ’¡è¿ˆå…‹Â·æ²™å…‹éœç±³ç½—å¤«](https://medium.com/u/e06a48b3dd48?source=post_page-----4f99fba92436--------------------------------)

*   å•å‡»åˆ›å»ºè®¢é˜…å¹¶è¾“å…¥æ‚¨çš„ç”µå­é‚®ä»¶:

![](img/cff096d16ef42aa86cf8c5d126a6dac4.png)

ä½œè€…å›¾ç‰‡[ğŸ’¡è¿ˆå…‹Â·æ²™å…‹éœç±³ç½—å¤«](https://medium.com/u/e06a48b3dd48?source=post_page-----4f99fba92436--------------------------------)

*   æœ€ååˆ›å»º[**ERROR metric alarm**](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-cw-alarm.html)åŠ¨ä½œï¼Œå½“æ•°å­—è¯¯å·®è¿ç»­ 5 åˆ†é’Ÿå¤§äº 5 æ—¶è§¦å‘æŠ¥è­¦ã€‚å®ƒåº”è¯¥å‘é€é€šçŸ¥åˆ°æ‚¨çš„ç¤¾äº¤ç½‘ç«™çš„ä¸»é¢˜ã€‚

![](img/830bf0ec77d22813b35b31d8e729c94a.png)

ä½œè€…å›¾ç‰‡[ğŸ’¡è¿ˆå…‹Â·æ²™å…‹éœç±³ç½—å¤«](https://medium.com/u/e06a48b3dd48?source=post_page-----4f99fba92436--------------------------------)

![](img/1f0b8e0a432f9bfd71813c77d550c941.png)

ä½œè€…å›¾ç‰‡[ğŸ’¡è¿ˆå…‹Â·æ²™å…‹éœç±³ç½—å¤«](https://medium.com/u/e06a48b3dd48?source=post_page-----4f99fba92436--------------------------------)

*   é€‰æ‹©é‡åˆ°è­¦æŠ¥æ—¶å‘é€é€šçŸ¥çš„ä½ç½®:

![](img/9b198744bad361da500dad0185cd3a21.png)

ä½œè€…å›¾ç‰‡[ğŸ’¡è¿ˆå…‹Â·æ²™å…‹éœç±³ç½—å¤«](https://medium.com/u/e06a48b3dd48?source=post_page-----4f99fba92436--------------------------------)

*   åœ¨æ‘„å–ç®¡ç†å™¨å‡ºé”™çš„æƒ…å†µä¸‹ï¼ŒæœŸæœ›çš„è¾“å‡ºæ˜¯ä¸€ä¸ªé€šçŸ¥:

![](img/bdf01a88d615724a62d4ba40853e8b64.png)

ä½œè€…å›¾ç‰‡[ğŸ’¡è¿ˆå…‹Â·æ²™å…‹éœç±³ç½—å¤«](https://medium.com/u/e06a48b3dd48?source=post_page-----4f99fba92436--------------------------------)

> *ç†æƒ³æƒ…å†µä¸‹ï¼Œä½ ä¼šå¸Œæœ›ä½¿ç”¨ç±»ä¼¼äº****AWS cloud formation****çš„ä¸œè¥¿æ¥ç®¡ç†ä½ çš„* **åŸºç¡€è®¾æ–½ï¼Œä»£ç ä¸º** *ã€‚*

ç¤ºä¾‹å †æ ˆæ–‡ä»¶å¯ä»¥åœ¨æœ¬æ•™ç¨‹çš„ [Github åº“](https://github.com/mshakhomirov/BigQuery-ingest-manager)ä¸­æ‰¾åˆ°ã€‚

# å¦‚ä½•è½¬æ¢åŸå§‹æ•°æ®æ¹–æ–‡ä»¶ä¸­çš„æ•°æ®å¹¶ä¸º BigQuery åšå‡†å¤‡

è‡ªç„¶åœ°ï¼Œ **BigQuery** å¯ä»¥ä½¿ç”¨ [**æ–°è¡Œåˆ†éš”çš„ JSON**](http://ndjson.org/) æˆ–è€…å…¶ä»–å·²ç»æ­£ç¡®å½¢æˆçš„æ ¼å¼ã€‚å› æ­¤ï¼Œå¦‚æœä½ æ­£åœ¨åŠ è½½`ndJSON`ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥åœ¨é‚£ä¹‹å‰è¢«æ–°è¡Œåˆ†éš”:

ç°åœ¨å‡è®¾æ‚¨æœ‰å¦ä¸€ä¸ªæœåŠ¡ä» ***MySQL æ•°æ®åº“*** ä¸­æå–æ•°æ®ï¼Œå®ƒçš„è¾“å‡ºçœ‹èµ·æ¥åƒä¸€ä¸ª JSON å¯¹è±¡æ•°ç»„:`[{...},{...},{...}]`ã€‚è¿™äº›å•ç‹¬çš„ JSON å¯¹è±¡ä¹Ÿå¯ä»¥æ·±åº¦åµŒå¥—ã€‚æ‚¨å¯èƒ½å¸Œæœ›å°†å®ƒè½¬æ¢æˆ`nldj` : `'{...}'\n'{...}'\n'{...}'\n`ï¼Œè¿™æ · BigQuery å°±å¯ä»¥å°†å®ƒè£…è½½åˆ°è¡¨ä¸­ã€‚

æˆ–è€…æƒ³è±¡ä½ æ­£åœ¨ä½¿ç”¨æ ‡å‡†çš„**æ¶ˆé˜²è½¯ç®¡**è¾“å‡ºï¼Œå…¶ä¸­æ•°æ®è¢«å†™æˆä¸€ä¸²`JSON`å¯¹è±¡`{...}{...}{...}`ã€‚æ²¡æœ‰é€—å·ã€‚æ‚¨å¯èƒ½éœ€è¦ä¸ºä»***OBJECT _ STRING***åˆ° ***SRC*** variant æ ¼å¼çš„ **BigQuery** (è½¬æ¢ä¸º`nldj`)å‡†å¤‡æ•°æ®ï¼Œå³`{...}{...}{...}` > > > `'{...}'\n'{...}'\n'{...}'\n`ã€‚

çœ‹åˆ°é‡Œé¢çš„ä½¿å¾’äº†å—ï¼Ÿè¿™å°†æŠŠå®ƒå®šä¹‰ä¸ºç±»å‹`STRING`ï¼Œå¹¶ä¸”æ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªåªæœ‰ä¸€åˆ—çš„è¡¨:`name: "src", type: "STRING"`ã€‚

è¿™å¯èƒ½æ˜¯ä¸€ä¸ªå…·æœ‰æŒ‘æˆ˜æ€§çš„ä»»åŠ¡ï¼Œä½†æˆ‘å†™äº†ä¸€äº›æ–¹ä¾¿çš„åŠ©æ‰‹å‡½æ•°ã€‚ä½ ä»¥åä¼šæ‰¾åˆ°å®ƒä»¬çš„ã€‚

> *å› æ­¤ï¼Œåªéœ€åœ¨æ‚¨çš„* `*config*` *ä¸­æ·»åŠ æ–‡ä»¶æ ¼å¼è§„èŒƒï¼Œå°±å¯ä»¥å®šä¹‰å¤„ç†é€»è¾‘å¹¶æ­£ç¡®åœ°å°†æ‰€æœ‰æ–‡ä»¶åŠ è½½åˆ°****big query****ä¸­ã€‚*

ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½å¸Œæœ›åœ¨`yaml`é…ç½®ä¸­å®šä¹‰æ‚¨çš„è¡¨ï¼Œå¦‚ä¸‹æ‰€ç¤º:

ç¬¬ä¸€ä¸ªåä¸º`paypal_transaction`çš„`pipe`æœ‰ä¸€ä¸ªå•ç‹¬ JSON å¯¹è±¡çš„æ•°ç»„(æ·±åº¦åµŒå¥—),æ‚¨å¯èƒ½å¸Œæœ›å°†æ¯ä¸ªå•ç‹¬çš„åµŒå¥—å¯¹è±¡ä½œä¸ºä¸€ä¸ª JSON è®°å½•æ’å…¥ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥ç¨ååœ¨æ‚¨çš„**æ•°æ®ä»“åº“**ä¸­ç”¨`JSON_PARSE`å‡½æ•°**è§£æ**å®ƒã€‚

ç¬¬äºŒä¸ªç®¡é“`GeoIP2-Country-Blocks-IPv4`éœ€è¦ä» CSV ä¸­è§£æå‡ºæ¥ï¼Œå¹¶æ’å…¥åˆ° **BigQuery** è¡¨ä¸­ï¼Œç›¸å…³çš„æ¨¡å¼æœ‰å…­åˆ—ã€‚è¿™é‡Œæ‚¨å¯èƒ½å¸Œæœ›æ˜¾å¼å£°æ˜ä¸€ä¸ª **CSV åˆ†éš”ç¬¦**æ¥å¸®åŠ© BigQuery åŠ è½½æ•°æ®ã€‚

ç¬¬ä¸‰ä¸ªè¡¨ç¤ºä¸€äº›é…ç½®ä¸ä½³çš„ Kinesis æµè¾“å‡ºï¼Œéœ€è¦ä½œä¸º JSON æ’å…¥ï¼Œä½†å¿…é¡»é¦–å…ˆä¸º BigQuery åšå¥½å‡†å¤‡(è½¬æ¢ä¸º NLDJ æ ¼å¼)ã€‚

ç¬¬å››ä¸ªä¹Ÿéœ€è¦ä½œä¸º **NLDJ** åŠ è½½ï¼Œä½†æ˜¯å®ƒè¢«å‹ç¼©äº†ï¼Œæ‰€ä»¥ä½ æƒ³å…ˆè§£å‹ç¼©å®ƒã€‚

# å¦‚ä½•å°†å‹ç¼©æ–‡ä»¶åŠ è½½åˆ° BigQuery

å¦‚æœä½ çš„æ–‡ä»¶æ˜¯å‹ç¼©çš„ï¼Œé‚£ä¹ˆä½ ä¼šæƒ³å…ˆç”¨`zlib`åº“è§£å‹å®ƒã€‚æ‚¨å¯èƒ½æƒ³è¦æ·»åŠ ä¸€ä¸ªåŠŸèƒ½`loadGzJsonFileFromS3()`ã€‚å› æ­¤ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆ**è§£å‹ç¼©**æ–‡ä»¶ï¼Œç„¶å*å°†è¯¥æµé€šè¿‡ç®¡é“*ä¼ è¾“åˆ° **JSONparse** ï¼Œåè€…å°†æå–æˆ‘ä»¬éœ€è¦çš„ JSONï¼Œå¹¶ä¸”*å°†*é€šè¿‡ç®¡é“ **createWriteStream** ä¼ è¾“åˆ° BigQueryã€‚

> ç”¨è¿™ç§æ–¹æ³•ä½ å¯ä»¥éå¸¸æœ‰æ•ˆåœ°åŠ è½½å¤§æ–‡ä»¶ã€‚

åœ¨è¿™ä¸ªä»£ç ä¸ºçš„ [Github åº“ä¸­æœ‰æ›´å¤šçš„ä¾‹å­ï¼ŒåŒ…æ‹¬è¿™äº›åŠ è½½å‡½æ•°çš„åˆ†æ”¯ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåä¸º`checkSourceFileFormatAndIngest()`çš„å‡½æ•°å®šä¹‰äº†å¦‚ä½•è½¬æ¢æ•°æ®æ ¼å¼çš„é€»è¾‘ï¼Œç„¶åå°†æ•°æ®åŠ è½½åˆ° **BigQuery** ä¸­ã€‚](https://github.com/mshakhomirov/BigQuery-ingest-manager)

> åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘è¿˜ä½¿ç”¨äº†å®šåˆ¶çš„ BigQuery jobIdsã€‚è¿™æ˜¯åœ¨ BigQuery ä¸­é˜²æ­¢é‡å¤çš„å¦ä¸€ç§æ–¹æ³•ã€‚

> *åœ¨è¿™ç§æƒ…å†µä¸‹ä½ ä¸éœ€è¦****DynamoDB****ä½†æ˜¯æˆ‘ä»ç„¶ä½¿ç”¨å¹¶æ’å…¥é¢å¤–çš„åº¦é‡ï¼Œå³æ’å…¥ *çš„* **è¡Œæ•°å’Œä¸€ä¸ª*** **è¡¨å** *æ¥ç”Ÿæˆç»Ÿè®¡æ•°æ®ã€‚*

# å¦‚ä½•ä½¿ç”¨ AWS Cloudformation éƒ¨ç½²æœåŠ¡

æˆ‘ä¸æƒ³ç”¨ **AWS æ§åˆ¶å°**åˆ›å»ºæ‰€æœ‰é‚£äº›èµ„æºã€‚ **AWS Cloudformation** æ˜¯ä¸€ç§ç®€å•çš„æ–¹æ³•ï¼Œåªéœ€ç‚¹å‡»ä¸€ä¸‹é¼ æ ‡ï¼Œå³å¯è‡ªåŠ¨éƒ¨ç½²å’Œé…ç½®æ‰€æœ‰èµ„æºã€‚

> *é™¤å…¶ä»–ä¼˜åŠ¿å¤–ï¼Œæ‚¨ä¼šå‘ç°åˆ›å»ºç”Ÿäº§å’Œè¯•è¿è¡Œç¯å¢ƒä»¥åŠæ•´ç†(åˆ é™¤)æ‰€æœ‰èµ„æºéå¸¸ç®€å•ã€‚*

> è¿™ä¸ªæ•™ç¨‹å®é™…ä¸Šæ˜¯å…è´¹çš„ï¼Œé‚£äº›å·¥å…·ä¸ä¼šèŠ±è´¹ä½ ä»»ä½•ä¸œè¥¿ã€‚

ç”¨ä»£ç åœ¨ [Github åº“ä¸­æ£€æŸ¥ã€‚](https://github.com/mshakhomirov/BigQuery-ingest-manager)

åœ¨`./stack/cf-config.yaml`ä¸­ï¼Œä½ ä¼šå‘ç° **AWS Cloudformation** æ¨¡æ¿æè¿°äº†æœ¬æ•™ç¨‹å¯èƒ½éœ€è¦çš„æ‰€æœ‰èµ„æºã€‚åŒ…æ‹¬ä¾‹å¦‚ **AWS Lambda è§’è‰²**:

è¦åœ¨æ‚¨çš„ **AWS å¸æˆ·**ä¸­éƒ¨ç½²æœåŠ¡ï¼Œè¯·è½¬åˆ°`./stack`å¹¶åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œè¿™ä¸¤ä¸ªå‘½ä»¤:

é‚£ä¸ª`lambdas.bq-shakhomirov.aws`æ˜¯ä½ çš„æœåŠ¡å·¥ä»¶çš„ S3 æ¡¶ï¼Œä½ çš„ lambda ä»£ç å°†ä¿å­˜åœ¨é‚£é‡Œã€‚æ¢æˆä½ çš„ã€‚

# å¦‚ä½•ä¸€æ¬¡å°†æ‰€æœ‰æ–‡ä»¶åŠ è½½åˆ° BigQuery è¡¨ä¸­

å½“æ‚¨éœ€è¦åœ¨é€‰å®šçš„æ—¶é—´èŒƒå›´å†…(å³ç‰¹å®šæ—¥æœŸ)å°†æ‰€æœ‰æ–‡ä»¶ä»æ•°æ®æ¹–ä¸­ä¸€æ¬¡æ€§`load / reload`åˆ°æ‚¨çš„æ•°æ®ä»“åº“ä¸­æ—¶ï¼Œè¿™ç§å¤šæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚

> å¦‚æœéœ€è¦ï¼Œè¯¥æœåŠ¡å¿…é¡»èƒ½å¤Ÿæ‰«ææ‚¨çš„æ•°æ®æ¹–ï¼Œå¹¶æŒ‘é€‰ç¬¦åˆæ‚¨éœ€è¦çš„æè¿°å’Œæ—¶é—´åˆ†åŒºçš„æ–‡ä»¶ã€‚

å‡è®¾æ‚¨çš„æ•°æ®æ¹–æœ‰æ¥è‡ªä¸åŒæ¥æºçš„æ–‡ä»¶ä¿å­˜åœ¨ **AWS S3** ä¸­ï¼Œå…·æœ‰ ***å…³é”®å­—*** å‰ç¼€ï¼Œå…¶ä¸­åŒ…å«**å¤§æŸ¥è¯¢** `table name`å’Œ`date`åˆ†åŒºï¼Œå³:

æ‰€ä»¥åœ¨è¿™é‡Œï¼Œæ‚¨ä¼šå¸Œæœ›æ‚¨çš„æœåŠ¡æ‰«ææ•°æ®æ¹–æ¡¶ï¼Œå¹¶åªé€‰æ‹©ä¸è¿™ä¸‰ä¸ª`pipes` : `paypal_transaction`ã€`simple_transaction`å’Œ`some-other-transaction`ç›¸å…³çš„æ–‡ä»¶ï¼Œå¹¶å¸¦æœ‰æ—¥æœŸå‰ç¼€`2021/10/04`ã€‚

ç„¶åï¼Œæ‚¨ä¼šå¸Œæœ›**æ‘„å–ç®¡ç†å™¨**ç”Ÿæˆä¸€ä¸ªæœ€ç»ˆçš„`payload`ï¼Œå…¶ä¸­åŒ…å«æ‰¾åˆ°çš„æ‰€æœ‰æ–‡ä»¶å¯†é’¥ï¼Œå¹¶å°†å®ƒä»¬åŠ è½½åˆ° BigQuery ä¸­ã€‚

> `./test/data.json`çš„æœ€ç»ˆ`payload`åº”è¯¥åœ¨æ•°æ®æ¹–ä¸­æ‰¾åˆ°æ‰€æœ‰æ–‡ä»¶:

> åœ¨ä½ çš„æœ¬åœ°æ–‡ä»¶å¤¹ä¸­æœ‰äº†è¿™ä¸ª `*payload*` *ä½ å°±å¯ä»¥åœ¨ä½ çš„å‘½ä»¤è¡Œä¸­è¿è¡Œ* `*$ npm run test*` *(å¦‚æœä½ çš„æœ‰æ•ˆè´Ÿè½½åœ¨* `*./test/data.json*` *)ä½ çš„å¾®æœåŠ¡ä¼šæŠŠè¿™äº›æ–‡ä»¶ä¸€ä¸ªä¸€ä¸ªçš„åŠ è½½åˆ°****big query****ä¸­ã€‚*

æˆ‘åœ¨æˆ‘çš„`./package.json`ä¸­æ·»åŠ äº†è„šæœ¬æ¥è¿è¡Œè¿™äº›å‘½ä»¤ã€‚

1.  ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ`$ npm run test-service`ï¼Œé‚£ä¹ˆ`./loadTestIngestManager.js`ä¸­çš„åº”ç”¨ç¨‹åºå°†ä½¿ç”¨`test/integration/loadTestPipelines.json`ä¸­çš„**ç®¡é“å®šä¹‰**æ‰«ææ•°æ®æ¹–ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªåŒ…å«æ‰€æœ‰æ‰¾åˆ°çš„æ–‡ä»¶çš„è¾“å‡ºã€‚å®ƒä¼šå°†å…¶ä¿å­˜åˆ°`test/integration/loadTestPayload.json`ã€‚
2.  ç„¶åï¼Œå¦‚æœæˆ‘è¿è¡Œ`$ npm run test-load` `./app.js`ï¼Œæ‘„å–ç®¡ç†å™¨å°†ä½¿ç”¨æ–‡ä»¶çš„æœ‰æ•ˆè´Ÿè½½ï¼Œå¹¶å°†å®ƒä»¬å‘é€åˆ° **BigQuery** ã€‚

> ä½¿ç”¨è¿™äº›è„šæœ¬ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°ä¸ºåŠ è½½åˆ° BigQuery ä¸­çš„æ–‡ä»¶å’Œæ ¼å¼ç¼–å†™é›†æˆæµ‹è¯•ã€‚

æ‚¨å¯èƒ½æ³¨æ„åˆ°ä¸Šé¢çš„`payload.json`ä¸`original S3 Obj created`äº‹ä»¶è´Ÿè½½ç•¥æœ‰ä¸åŒ:

é‚£åªæ˜¯å› ä¸ºåœ¨æˆ‘çš„ç¯å¢ƒä¸­ï¼Œæˆ‘æœ‰å¦ä¸€ä¸ªç”±`S3 Obj created`äº‹ä»¶è§¦å‘çš„`orchestrator`æœåŠ¡ï¼Œå®ƒå°†ä¸º`ingest-manager`åˆ›å»ºæœ‰æ•ˆè´Ÿè½½ã€‚è¯¥æœåŠ¡å¯ä»¥æ‰§è¡Œæ‚¨éœ€è¦çš„ä»»ä½•å…¶ä»–åŠŸèƒ½ï¼Œå¹¶ä¸”å®ƒä¼šåœ¨éœ€è¦æ—¶`invoke` **æ‘„å–ç®¡ç†å™¨**ã€‚

éšæ„è°ƒæ•´**æ‘„å–ç®¡ç†å™¨**çš„æœ‰æ•ˆè½½è·ã€‚æ‚¨å¯èƒ½å¸Œæœ›åœ¨`processEvent()`å‡½æ•°ä¸­ä¸º`event`å¤„ç†æ·»åŠ `S3`é”®ã€‚

# ç»“è®º

æ‚¨åˆšåˆšå­¦ä¹ äº†å¦‚ä½•ä¸ºç”¨ Node ç¼–å†™çš„ BigQuery åˆ›å»ºä¸€ä¸ªç®€å•å¯é çš„æ‘„å–ç®¡ç†å™¨ã€‚å¸¦æœ‰ä¸€äº› ***ç‰›é€¼åŠŸèƒ½*** çš„ JS:

*   æ— æœåŠ¡å™¨è®¾è®¡å’Œ *AWS Lambda åŠŸèƒ½*ã€‚
*   éå¸¸**æ€§ä»·æ¯”**ã€‚é’ˆå¯¹**æ‰¹é‡åŠ è½½ä½œä¸š**è¿›è¡Œäº†ä¼˜åŒ–ï¼Œè¿™æ„å‘³ç€æ‚¨æ— éœ€ä¸ºæ•°æ®åŠ è½½ä»˜è´¹ã€‚åŸºæœ¬ä¸Šå®ƒæ˜¯å…è´¹çš„ï¼Œä½†æ£€æŸ¥ BigQuery è´Ÿè½½ä½œä¸šé™åˆ¶ã€‚
*   å¯ä»¥ä½¿ç”¨*æµå¼*æ’å…¥(BigQuery æµå¼åŠ è½½)ã€‚
*   ä¸º **AWS** é‡èº«å®šåˆ¶ä½†å¯ä»¥è½»æ¾è¿ç§»åˆ° ***GCPï¼ŒAzure*** ã€‚
*   ***ç”¨ AWS Cloudformation æ„å»ºçš„ä»£ç ä¸º*** çš„åŸºç¡€è®¾æ–½ã€‚åœ¨ä»»ä½•å…¶ä»– AWS å¸æˆ·ä¸­ä¸€é”®éƒ¨ç½²ã€‚
*   ä½¿ç”¨ AWS Dynamo è¿›è¡Œæœ‰æ•ˆçš„è´Ÿè½½ä½œä¸šç›‘æ§å’Œæ–‡ä»¶é‡å¤å¤„ç†ã€‚
*   è‡ªå®šä¹‰ BigQuery ä½œä¸š idã€‚å¦‚æœä½ ä¸æƒ³ä½¿ç”¨ Dynamoï¼Œå¦ä¸€ä¸ªé˜²æ­¢å¤åˆ¶çš„æ–¹æ³•æ˜¯ã€‚
*   æ”¯æŒå•å…ƒå’Œé›†æˆæµ‹è¯•ã€‚

è®¸å¤šäººè®¤ä¸º Python æ˜¯å®Œæˆè¿™é¡¹ä»»åŠ¡çš„æœ€ä½³é€‰æ‹©ï¼Œä½†æ˜¯æˆ‘ä¸åŒæ„ã€‚æ‰€æœ‰çš„é€‰æ‹©éƒ½æ˜¯å¥½çš„ï¼Œåªè¦ä»–ä»¬èƒ½å®Œæˆå·¥ä½œã€‚ä»¥å‰æˆ‘å†™è¿‡å¦‚ä½•ç”¨ Python å†™ä»£ç ï¼ŒPython æ˜¯æˆ‘æœ€å–œæ¬¢çš„ç¼–ç¨‹è¯­è¨€ä¹‹ä¸€ã€‚æˆ‘çš„å¤§éƒ¨åˆ†ç”Ÿäº§ç®¡é“éƒ½æ˜¯ç”¨ **Python** æˆ– **Java** ç¼–å†™çš„ã€‚

> æˆ‘çš„è§‚ç‚¹æ˜¯ä½ ä¸åº”è¯¥é™åˆ¶è‡ªå·±ã€‚

æœ¬æ•™ç¨‹ä¸æ˜¯å…³äºç¼–ç¨‹è¯­è¨€æˆ–å®ƒä»¬çš„å…·ä½“åº”ç”¨ã€‚æˆ‘ç¡®å®è®¤ä¸ºæ•°æ®åªé€‚ç”¨äº Python/Java è¿™ç§é™ˆè¯æ»¥è°ƒã€‚å½“æˆ‘çœ‹åˆ°ä¸ä½¿ç”¨ SQL(æˆ–è€…ä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨)çš„æ•°æ®ç§‘å­¦å®¶æ—¶ï¼Œæˆ‘ä¹Ÿå¾ˆæ²®ä¸§ã€‚

è¿™ä¸ªé¡¹ç›®æ˜¯å…³äº**æ•°æ®å·¥ç¨‹**ã€ç°ä»£æ•°æ®å †æ ˆã€è·³å‡ºæ¡†æ¡†æ€è€ƒã€è‡ªæˆ‘å­¦ä¹ ã€å®šåˆ¶ã€è¯­è¨€ä¸å¯çŸ¥**ä»¥åŠèƒ½å¤Ÿç”¨éå¸¸è§„æ–¹æ³•è¾¾åˆ°é¢„æœŸç»“æœã€‚**

## èµ„æº

[1]:[https://docs . AWS . Amazon . com/CLI/latest/user guide/CLI-services-S3-commands . html # using-S3-commands-managing-buckets-creating](https://docs.aws.amazon.com/cli/latest/userguide/cli-services-s3-commands.html#using-s3-commands-managing-buckets-creating)

[2]:https://cloud.google.com/docs/authentication/production

[3]:[https://github.com/dominictarr/JSONStream](https://github.com/dominictarr/JSONStream)

[4]:[https://cloud . Google . com/big query/docs/reference/rest/v2/Job # JobConfigurationLoad](https://cloud.google.com/bigquery/docs/reference/rest/v2/Job#JobConfigurationLoad)

[5]:[https://Google APIs . dev/nodejs/big query/latest/table . html # create write stream](https://googleapis.dev/nodejs/bigquery/latest/Table.html#createWriteStream)

[6]:[https://aws.amazon.com/dynamodb](https://aws.amazon.com/dynamodb)

[7]:[https://docs . AWS . Amazon . com/AWS cloudformation/latest/user guide/AWS-properties-CW-alarm . html](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-cw-alarm.html)

[8]:[https://AWS . Amazon . com/blogs/security/how-to-create-an-AWS-iam-policy-to-grant-AWS-lambda-access-to-an-Amazon-dynamo db-table/](https://aws.amazon.com/blogs/security/how-to-create-an-aws-iam-policy-to-grant-aws-lambda-access-to-an-amazon-dynamodb-table/)

ã€9ã€‘:ã€https://aws.amazon.com/cloudformation/ 

ã€10ã€‘:[http://ndjson.org/](http://ndjson.org/)

ã€11ã€‘:[https://cloud.google.com/bigquery/quotas](https://cloud.google.com/bigquery/quotas)

[12]:[https://stack overflow . com/questions/7985599/notification-of-new-S3-objects](https://stackoverflow.com/questions/7985599/notification-of-new-s3-objects)

[13]:[https://medium . com/swlh/loading-data-into-big query-from-cloud-storage-complete-guide-e 212 F5 C2 db 6](https://medium.com/swlh/loading-data-into-bigquery-from-cloud-storage-complete-guide-e212f5c2db6)

[14]:[https://towards data science . com/monitoring-your-big query-costs-and-reports-usage-with-data-studio-b 77819 ffd 9 fa](/monitoring-your-bigquery-costs-and-reports-usage-with-data-studio-b77819ffd9fa)

[15]:[https://towardsdatascience . com/extract-data-from-paypal-API-c25c 76748746ï¼Ÿgi=e76b91a696e](/extract-data-from-paypal-api-c25c76748746?gi=e76b91a696e)* 

**åŸè½½äº https://mydataschool.com*<https://mydataschool.com/blog/how-to-load-data-into-bigquery-with-serverless-node-js/>**ã€‚***