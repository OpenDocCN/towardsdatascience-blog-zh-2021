# 应用数据科学技术

> 原文：<https://towardsdatascience.com/technologies-for-applied-data-science-f806f88d4b61?source=collection_archive---------23----------------------->

![](img/4199d24ea7b7210f0e70d27471a41fa8.png)

来源:https://unsplash.com/photos/Rfflri94rs8

## [业内笔记](https://towardsdatascience.com/tagged/notes-from-industry)

## **构建实时 ML 应用的工具**

构建和部署使用机器学习来个性化产品的数据产品通常涉及多种学科，包括数据科学、产品管理和工程。我曾在一些组织中工作过，在这些组织中，数据科学和工程团队有些孤立，以下方法用于将模型投入生产:

*   **笔记本:**让数据科学家将模型投入生产的一种方法是使用 Databricks 等供应商，使数据科学家能够编写 PySpark 笔记本，这些笔记本可以执行功能工程和模型推理，以便在大型数据集上批量应用。
*   **模型移交:**另一种方法是为数据科学家定义一个接口来存储模型，其中单独的基础设施用于模型推断。这可以通过专有基础设施或云产品(如 AWS SageMaker)来实现。

这两种方法都使数据科学家能够将模型投入生产，但在构建需要处理实时数据集的数据产品时会有很大的限制，在这种情况下，应将最近的用户行为纳入模型预测。

我遇到过两个需要实时执行特征工程和模型推理的用例，它们比使用小批量更适合。第一个应用是在广告技术中，当系统接收到广告印象时，价格可以实时更新。我探索的第二个应用是移动游戏的倾向模型，当系统接收到新玩家数据时，该模型会实时更新。这只是两个示例应用程序，还有很多应用程序可以受益于实时特征工程和模型推理，例如使用会话数据来改进推荐的推荐系统。

克服这一限制的方法之一是让一些数据科学家更多地接触用于服务模型的基础设施。拥有这一专业的数据科学家通常被称为“应用科学家”，这个头衔现在正在几家大型科技公司使用。该角色位于数据科学和机器学习工程的交叉点，在团队由数据科学家和工程师组成的组织中变得越来越常见，这些学科之间存在直接协作而不是孤岛。

如果你是一名数据科学家，正在寻找一个应用科学家的角色，为了精通这个新角色，你需要学习大量的工具和技术。这篇博客文章的目的是简要介绍一些最相关的工具，供这个新兴角色学习。以下是我推荐的技术，通过学习可以变得熟练:

*   Web 端点:使用 HTTP 提供 ML 预测是很常见的。
*   **Docker & Kubernetes:** 你需要能够自动化部署。
*   **NoSQL:** 这些数据库提供低延迟的数据检索。
*   **消息流:**您需要在组件之间传递数据。
*   **日志记录:**您需要能够监控部署和跟踪事件。
*   **Golang:** 与工程师合作开发代码库。

每个主题都有很多书籍，所以我在这里只简单介绍一下，并指出需要重点学习的领域。

## Web 端点

提供数据产品的最常见方式之一是通过 HTTP(S)。当使用微服务架构时，可以使用 gRPC 之类的协议在服务之间进行通信，但是最终的输出通常是使用 HTTP 通过 web 提供的。因为它是服务于 ML 预测的通用协议，所以熟悉构建 web 端点和理解一些基础知识是很有用的。

用于构建 web 端点的库将根据您用于模型推断的编程语言而有所不同。我建议创建一个设置 REST 服务的示例应用程序，其中端点监听预测请求并返回模型预测作为结果。这可以通过在 HTTP 请求体中以 JSON 格式传递特征向量，并在响应体中以 JSON 有效负载的形式传递预测来实现。对于 Python 来说，Flask 是一个用于构建端点的方便的包，如这里的[所述](/models-as-web-endpoints-162cb928a9e6)。如果你用的是 Java，有各种各样的库，而 Undertow 是我的首选。对于围棋，我用过 Goji 和 fasthttp。

不管使用哪种编程语言来服务 ML 模型，HTTP 中都有一些概念需要熟悉。其中包括:

*   **HTTP 响应代码:**提供有关 web 请求是否成功、发生错误或请求无效的详细信息。
*   **HTTP 请求头:**向端点提供关于请求的信息，比如请求体是否被压缩。
*   **HTTP 响应头:**从端点向请求者提供关于 web 响应的细节，比如内容类型。
*   **内容类型:**描述在 web 请求和 web 响应的主体中传递的数据类型。ML 服务的常见类型是 JSON 和 binary，其中 binary 用于压缩或图像/视频数据。

为了构建可以与组织内的系统交互的服务，以及为了构建可以为来自外部系统(如广告交换)的请求提供服务的系统，学习这些概念是很有用的。

## 多克-库伯内特公司

Docker 是数据科学家学习的一个很好的工具，因为容器能够为运行 ML 模型创建可再现的环境。它也非常适合打包您想要在生产环境中提供的 web 服务。Docker 和容器化非常适合数据科学家学习，即使您不打算部署数据产品。

如果您想要构建一个可伸缩的 web 应用程序来服务于 ML 模型，Kubernetes 正在成为首选的方法。Kubernetes 是一个自动化部署容器化应用程序的系统，提供自动扩展和集群管理功能。使用 Kubernetes，您可以为部署容器提供一个配置，系统会处理关于启动基础设施的大部分细节。使用 Kubernetes 可以大大简化构建需要扩展到大工作负载的数据产品的过程，因为单个服务器(节点)的大部分管理都被抽象掉了。Kubernetes 的托管云产品，如谷歌的 GKE，大大降低了部署 web 应用程序的复杂性，这些应用程序可以扩展到大量的请求。

对于学习 Kubernetes，我的建议是在 AWS 或 GCP 上创建一个个人帐户，并使用托管的 Kubernetes 产品来练习部署一个示例应用程序，比如上一节中讨论的预测端点。谷歌的 GKE 通过 web 控制台提供了比 AWS EKS 更多的功能，并且可能更容易学习 Kubernetes 的基础知识。

Kubernetes 探索了几个领域来获得这种技术的经验，包括:

*   **资源限制:**为部署中的每个 pod 定义资源约束，这会影响集群调整大小的时间和方式。
*   **公开服务:**公开服务有多种方式，比如使用节点端口和第七层负载均衡器。
*   **滚动更新:**这种部署方法在避免任何服务中断的同时，将流量提升到新的 pod。
*   **健康 ping:**使集群能够确定服务是否关闭。

Kubernetes 是一个广泛的主题，因为它有各种各样的特性。学习这个框架很有用，因为它有助于将应用程序容器化和应用程序部署分开。

## NoSQL

许多实时数据产品使用 NoSQL 数据库对传入请求提供低延迟响应。例如，当在会话期间接收到新事件时，系统可能需要更新用户配置文件，或者从 NoSQL 数据库中检索预先计算的值，以执行不同产品功能的 A/B 测试。数据科学家通常使用关系数据库，关系数据库通过 SQL 语言提供了广泛的功能。然而，SQL 的表达能力通常会导致查询运行缓慢。NoSQL 数据库提供了一种解决方案，其代价是一组表达性较差的操作，通常返回结果的速度比关系数据库快几个数量级。

NoSQL 有基于内存和基于磁盘的产品，具有不同的性能特征。基于内存的产品(如 Redis 或 Memcached)将所有数据存储在内存中，通常具有最低的延迟，而基于磁盘的产品(如 DynamoDB 或 CouchBase)将项目存储到磁盘，其中一些产品提供基于内存的缓存以提高性能。考虑到硬盘与 RAM 的大小，基于磁盘的产品通常每 GB 更便宜，但在响应查询时确实有更高的延迟。这两种类型的数据库都使用键值存储提供数据检索，其中键可以是用户标识符，值是可以在几毫秒内读取和写入的用户信息，并且通常提供亚毫秒级的性能。

NoSQL 数据库是一项非常值得学习的技术，因为它让数据科学家更接近工程团队用于生产系统的一些工具。熟悉这些类型的数据库意味着数据科学家可以直接与工程团队合作开发实时数据产品。以下是学习 NoSQL 工具时需要考虑的一些主题:

*   **延迟要求:**应用是否需要亚毫秒级延迟，或者更高的延迟是否可以接受？
*   **模式:**数据结构是固定的模式，还是可以随着时间的推移而发展？
*   **成本考虑:**您需要存储多少数据，基于磁盘的存储适合您的使用情形吗？
*   接口:NoSQL 数据库与您现有的技术平台接口良好吗？

Redis 是一个很好的数据库，值得作为第一个 NoSQL 技术来学习，因为它很容易作为容器运行，并且大多数云平台都提供了托管解决方案，它提供了直接的设置和获取操作，并且它有限的模式选项提供了与关系数据库的明显区别，这表明该数据库需要不同的数据存储思维。要开始使用 NoSQL，我的建议是更新前面讨论的预测端点，以检索传入请求的用户级数据，补充预测请求中传递的特性。

## 消息流

许多数据产品被设计为微服务，它们执行特定的任务，并依赖其他服务来响应请求。实时数据产品中消息流的两个常见用例是支持组织内不同微服务之间的通信，以及将事件转发到端点，端点将保存数据以用于下游分析和模型构建。第一种情况的例子是用户可以通过网络浏览器改变参数，并且数据产品应该使用新的配置。对于第二种情况，考虑一个模型推理端点，它进行预测，然后将输出传递给一个服务，该服务将预测存储到关系数据库中。

云中有各种各样的消息传递解决方案，包括 Apache Kafka 等开源解决方案，以及 AWS Kinesis 和 GCP PubSub 等云产品。这些消息传递产品使部署中的不同服务能够通信和共享数据。以下是学习这些技术时要探讨的一些主题:

*   **重试逻辑:**该工具是否只提供一次交付，或者您是否需要在端点显式处理重复或缺失的消息？
*   **一对多:**一个消息生产者可以将同一事件发送给多个消息消费者吗？

对于数据科学家来说，学习消息服务是很有用的，因为它们经常被用来定义驱动数据产品的服务之间的接口。

## 记录

如果您要在生产环境中部署一个 ML 模型，那么您需要能够监控系统，以确保系统按预期工作，检测何时出现问题，并快速响应任何事件。如果您正在与工程团队合作，那么可能已经有了完成这些任务的标准化方法，例如使用 Datadog 或 Splunk 等供应商解决方案。如果您是从零开始，我的建议是在 GCP 上构建一个示例应用程序，并使用 StackDriver 熟悉监视运行在 Kubernetes 上的实时应用程序。

系统监控的目标是确保模型部署按照预期实时运行。本主题独立于模型监控任务，后者的目标是测量已部署模型的准确性。系统监控可以包括关于资源消耗、服务的请求量、模型输出的分布的度量，以及潜在的大量定制应用度量。

学习日志记录和监控系统时，获得以下类型任务的经验很有用:

*   **控制台日志记录:**编写一个将消息记录到日志服务的应用程序，比如使用云日志 API。
*   **度量日志记录:**使用云监控 API 向日志记录服务写入一个连续变量，比如每秒请求数。
*   **警报条件:**设置当每秒请求阈值超过指定值时触发的警报。

响应警报的流程因平台和团队结构而异。一些组织的开发运维团队负责处理共享基础设施上的故障，而负责部署服务的团队还负责管理服务故障也很常见。日志属于 ML Ops 的广泛话题，是机器学习产品的 DevOps。

## 戈朗

如果您希望着手构建服务于 ML 模型的 web 端点，那么 Go 编程语言为构建可伸缩服务提供了一个很好的选择。此外，如果你的工程组织已经使用 Go，学习这种语言可以直接与这些团队合作。精通一门新的编程语言是一项艰巨的任务，所以最好专注于这门语言对构建数据产品最有用的方面。Go 是一种用于构建 ML 服务的优雅语言，因为 struct 数据类型通过注释为不同类型的数据存储提供了方便的接口，对大多数数据存储和消息传递系统都有很好的库支持，并且它是为并发性而构建的，可以扩展到大型工作负载。

我建议通过编写执行以下任务的小应用程序来开始使用 Go 编程语言:

*   **Rest 端点:**使用内置的`net/http`模块构建一个 web 服务，接受 JSON 请求并返回 JSON 响应。
*   Rest 消费者:编写一个应用程序，该应用程序对您刚刚创建的端点进行读写操作。
*   **Json to Struct:** 使用`struct type`定义一个数据结构，并更新端点将传入的 Json 转换为 Struct 数据类型。
*   **struct to Json:** 使用 Struct 注释将 Struct 对象写入文件。读入 Json 文件并将其转换为 struct 类型。
*   **struct to data store:** 使用 Struct 注释将 Struct 对象写入数据存储，如 Redis 或 Dynamo。
*   **简单的 Logit 模型:**更新 rest 端点，将硬编码的逻辑回归模型应用于 Json 中传递的。

如果您能够在 Go 中完成这些任务，那么您就拥有了开始构建实时数据产品基础所需的许多要素。当然，基于您需要应用的 ML 模型的类型，以及您需要处理的数据源，事情会变得更加复杂。快速启动并运行 Go 模型推理服务的一个方法是使用在 GO 和 Python 中都可以工作的库，例如 [LightGBM](https://github.com/microsoft/LightGBM) 或 [tfgo](https://github.com/galeone/tfgo#tfgo-tensorflow-in-go) 。

虽然有很多学习 Go 语言的书籍，但是标准文档是一个很好的起点，我的建议是着手使用您最感兴趣的特性来引导学习过程。一旦你对这门语言有了一些熟悉，最好更详细地重温一下这门语言的基础，以确保你能创作出高效且可维护的 Go 代码。

## 结论

应用科学是一个广泛的主题，因为它涉及学习机器学习工程学科的一个大子集。这篇文章介绍了一些核心技术和主题领域，在从数据到应用科学家的转变过程中，这些都是很有用的。

要学习的东西很多，但是学习更多工程堆栈的好处是可以着手构建数据产品，并且更可靠地将数据产品从原型部署到生产部署。

[本·韦伯](https://www.linkedin.com/in/ben-weber-3b87482/)是 Zynga 应用科学总监。我们正在[招聘](https://www.zynga.com/job-listing-category/data-analytics-user-research/)！