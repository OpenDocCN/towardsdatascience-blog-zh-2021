# é€‚ç”¨äºæ•°æ®ä»“åº“è§£å†³æ–¹æ¡ˆçš„ MySQL æ•°æ®è¿æ¥å™¨

> åŸæ–‡ï¼š<https://towardsdatascience.com/mysql-data-connector-for-your-data-warehouse-solution-db0d338b782d?source=collection_archive---------26----------------------->

## å¦‚ä½•æ„å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå¹¶ä»¥å—çš„å½¢å¼å¯¼å‡ºæ•°ç™¾ä¸‡è¡Œï¼Œæµå¼ä¼ è¾“ï¼Œæ•è·å®æ—¶æ•°æ®æ›´æ”¹æˆ–æå–æ•°æ®å¹¶å°†å…¶ä¿å­˜åˆ°äº‘ä¸­

![](img/0c929140fba93491ce2ea315a5e25edb.png)

ç”±[ä¸½å¡”Â·å¡å†…å¡](https://unsplash.com/@rseneca?utm_source=medium&utm_medium=referral)åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) æ‹æ‘„çš„ç…§ç‰‡

# ä¸ºæ‚¨çš„æ•°æ®ä»“åº“æ„å»º MySQL æ•°æ®è¿æ¥å™¨

å‡è®¾æ‚¨æ˜¯ä¸€å**æ•°æ®å·¥ç¨‹å¸ˆ**ï¼Œæ‚¨çš„ä»»åŠ¡æ˜¯ä»æ‚¨çš„ ***MySQL*** æ•°æ®åº“å®ä¾‹å’Œæ‚¨çš„ ***æ•°æ®ä»“åº“*** ä¸­åŒæ­¥æ•°æ®ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„**åœºæ™¯**ï¼Œå…¶ä¸­æ‚¨éœ€è¦è¿æ¥æœ€æµè¡Œçš„æ•°æ®æºå’Œæ‚¨çš„æ•°æ®ä»“åº“è§£å†³æ–¹æ¡ˆï¼Œå³é›ªèŠ±ã€çº¢ç§»æˆ– BigQueryã€‚

è¿™ç¯‡æ–‡ç« è¯¦ç»†æ€»ç»“äº†å¦‚ä½•åœ¨ä¸ä½¿ç”¨ä»»ä½•ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹ä»å…³ç³»æ•°æ®åº“(MySQL)ä¸­æå–å’Œä¿å­˜æ•°æ®ã€‚æ˜¯ç”¨ ***AWS Lambda*** å‡½æ•°æ„å»ºçš„**node . js*****server less***åº”ç”¨çš„è¯¦ç»†æ•™ç¨‹ã€‚è¿™ä¸ªå¾®æœåŠ¡å°†ä» MySQL æ•°æ®åº“ä¸­æå–æ•°æ®ï¼Œå¹¶å¯ä»¥åœ¨æ‚¨çš„æœºå™¨ä¸Šæœ¬åœ°è¿è¡Œæˆ–/å’ŒæŒ‰è®¡åˆ’ä» AWS å¸æˆ·è¿è¡Œã€‚åŒæ ·çš„åº”ç”¨ç¨‹åºè¿˜æœ‰ä¸€ä¸ªæ›´é«˜çº§çš„ä¾‹å­ï¼Œå®ƒåˆ›å»ºäº†**èŠ‚ç‚¹ã€‚JS** `streams`ä» MySQL æå–æ•°æ®å¹¶ä¿å­˜åˆ°ä½ çš„ ***AWS S3 æ•°æ®æ¹–*** ã€‚

# æ¦‚è¿°

ä½ å°†å­¦ä¹ å¦‚ä½•:

*   ç”¨ **AWS Lambda** åˆ›å»ºä¸€ä¸ªç®€å•çš„ **Node.js** appã€‚
*   ä½¿ç”¨ Node.js **streams** æ¥ä¼˜åŒ–å†…å­˜æ¶ˆè€—ã€‚
*   æå–æ•°æ®å¹¶ä»¥ CSV å’Œ JSON æ ¼å¼ä¿å­˜åœ¨æœ¬åœ°ã€‚
*   å¯¼å‡ºåˆ°äº‘å­˜å‚¨ä¸­ã€‚
*   ä½¿ç”¨`yaml` config è¿›è¡ŒæŸ¥è¯¢ã€‚
*   éƒ¨ç½²å’Œå®‰æ’å®ƒã€‚

> `*$ npm run test*` *å‘½ä»¤ä¼šå°†ä¸€äº¿è¡Œæ•°æ®æ‰¹é‡å¯¼å‡ºåˆ°äº‘å­˜å‚¨ä¸­ã€‚*

![](img/93fe6dbeee8c7b7816e3a36ae971fca7.png)

ä½œè€…å›¾ç‰‡[ğŸ’¡è¿ˆå…‹Â·æ²™å…‹éœç±³ç½—å¤«](https://medium.com/u/e06a48b3dd48?source=post_page-----db0d338b782d--------------------------------)

æœ¬æ•™ç¨‹å¯èƒ½å¯¹æ•°æ®å·¥ç¨‹å¸ˆå’Œæ‰€æœ‰ä½¿ç”¨ MySQL æ•°æ®åº“æˆ–æƒ³å­¦ä¹ å¦‚ä½•è¿æ¥å„ç§ä»»æ„æ•°æ®æºå’Œæ•°æ®ä»“åº“è§£å†³æ–¹æ¡ˆçš„äººæœ‰ç”¨ã€‚

# å…ˆå†³æ¡ä»¶ã€åº“å’Œè®¾ç½®

**å·¥å…·**

*   å·²å®‰è£… Node.js å’ŒèŠ‚ç‚¹åŒ…ç®¡ç†å™¨
*   å¯¹äº‘è®¡ç®—(Amazon Web Services å¸æˆ·)ã€AWS CLI å’Œ AWS SDK æœ‰åŸºæœ¬çš„äº†è§£
*   Google Cloud Platform æˆ– AWS å¸æˆ·ï¼Œå…·ä½“å–å†³äºæ‚¨ä½¿ç”¨çš„äº‘å­˜å‚¨ã€‚
*   Shell(å‘½ä»¤è¡Œç•Œé¢)å‘½ä»¤å’Œè„šæœ¬(é«˜çº§)ã€‚

**æŠ€å·§**

*   è‰¯å¥½çš„èŠ‚ç‚¹çŸ¥è¯†ã€‚JS(ä¸­çº§)ã€‚æ‚¨å°†åˆ›å»ºä¸€ä¸ª Lambda å‡½æ•°ã€‚
*   ä½ å¿…é¡»äº†è§£ Nodeã€‚JS åŸºæœ¬æ¦‚å¿µï¼Œå³å¼‚æ­¥å‡½æ•°ã€èŠ‚ç‚¹åŒ…å’Œä»£ç å¦‚ä½•å·¥ä½œã€‚
*   åŸºæœ¬è°ƒè¯•(æ§åˆ¶å°ã€æ‰“å°æŠ¥è¡¨)
*   å¾ªç¯:å³ç”¨äº
*   åˆ†æ”¯:ifã€if/elseã€å¼€å…³
*   Shell å‘½ä»¤å’Œè„šæœ¬ï¼Œå°±åƒæ‚¨å¸Œæœ›ä»å‘½ä»¤è¡Œä½¿ç”¨ AWS CLI éƒ¨ç½² Lambda å¹¶èƒ½å¤Ÿåœ¨æœ¬åœ°æµ‹è¯•å®ƒä¸€æ ·ã€‚

# å¦‚ä½•ä½¿ç”¨ MySQL åŸç”Ÿç‰¹æ€§å¯¼å‡ºæ•°æ®

æ‚¨å¯èƒ½å¸Œæœ›ä½¿ç”¨`[SELECT * INTO 'file.csv'](https://dev.mysql.com/doc/refman/5.7/en/select-into.html)`æ¥å®ç°è¿™ä¸€ç‚¹:

ç¨åŠ è°ƒæ•´å’Œæ”¹å˜ï¼Œä½ å°±ä¼šè·å¾—æƒ³è¦çš„ç»“æœã€‚

> ä½†æ˜¯ï¼Œè¿™æ˜¯æ‰‹åŠ¨æ“ä½œâ€¦

è¯·è®°ä½ï¼Œæ‚¨å¯èƒ½å¸Œæœ›ä½¿ç”¨ç´¢å¼•åˆ—æ¥é™åˆ¶`where`å­å¥ä¸­çš„èŒƒå›´ã€‚å¦åˆ™ï¼Œæ‚¨çš„æ•°æ®åº“å°†ä¼šé‡åˆ°å›°éš¾ã€‚

# å¸¦æœ‰èŠ‚ç‚¹çš„éå¸¸åŸºæœ¬çš„ MySQL æ•°æ®è¿æ¥å™¨ã€‚å°„æµç ”ç©¶â€¦

> ***è·³è¿‡*** è¿™éƒ¨åˆ†å¦‚æœä½ æ˜¯åœ¨ç”¨ node.js `streaming`ã€æ•°æ®è½¬æ¢å’Œ`S3 upload`ç­‰æ›´é«˜çº§çš„ä¾‹å­ä¹‹åã€‚

*   ä¸ºä½ çš„ Lamda å¾®æœåŠ¡æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹:
    `$ mkdir mysql-connector`
    `$ cd mysql-connector` `$ npm init`
*   ä½¿ç”¨`npm`ä¸ºå…¶å®‰è£… [mysql](https://www.npmjs.com/package/mysql2) åŒ…:
    `$npm i mysql2@2.0.0`
*   å®‰è£… run-local-lambda åŒ…ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å®ƒåœ¨æœ¬åœ°è§¦å‘å’Œæµ‹è¯• Lambda:
    `$ npm i run-local-lambda@1.1.1`
*   åœ¨æ‚¨çš„ Lambda æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª`config`æ–‡ä»¶æ¥å®šä¹‰è¦ä½¿ç”¨çš„ç®¡é“é…ç½®å’Œè¡¨:

*   åœ¨ä¸»åº”ç”¨ç¨‹åºæ–‡ä»¶`./app.js`ä¸­åˆ›å»ºä¸€ä¸ª`async`å‡½æ•°ï¼Œä»`./config.json`æ–‡ä»¶è¿è¡Œ **SQL æŸ¥è¯¢**ã€‚

**ä½ çš„åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹ç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„:**

**æ‚¨çš„ä¸»åº”ç”¨ç¨‹åºæ–‡ä»¶** `**./app.js**` **åº”è¯¥æ˜¯è¿™æ ·çš„:**

> è¿™æ˜¯å¦‚ä½•ä»¥ç¼–ç¨‹æ–¹å¼ä» MySQL å¯¼å‡ºæ•°æ®çš„è¦ç‚¹ã€‚å¾ˆç®€å•ã€‚

åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ`$ npm run test`ï¼Œè¿™å°†ä» MySQL æ•°æ®åº“ä¸­å¯¼å‡ºæ•°æ®ã€‚è¯·ç¡®ä¿æ‚¨çš„å‡­æ®å’Œæ•°æ®åº“ä¸»æœºåœ°å€æ­£ç¡®æ— è¯¯ã€‚

> ç°åœ¨æ‚¨å¯ä»¥åœ¨æ‚¨çš„`./config.json`æ–‡ä»¶ä¸­æ›´æ”¹ SQL æŸ¥è¯¢ï¼Œå¹¶ä»¥ç¼–ç¨‹æ–¹å¼è¿è¡Œå®ƒã€‚

# å¦‚ä½•ä½¿ç”¨ Node.js `stream`å¹¶ä» MySQL å¯¼å‡ºæ•°æ®

> *é¦–å…ˆï¼Œä¸ºä»€ä¹ˆè¦ç”¨ node . js*[*stream*](https://nodejs.org/api/stream.html)*ï¼Ÿ*

å¦‚æœä½ çš„æ•°æ®é›†è¶…è¿‡äº†ä½ çš„å†…å­˜ï¼Œé‚£ä¹ˆä½ åº”è¯¥åƒæˆ‘ä»¬åœ¨**æ­¥éª¤ 1** ä¸­æ‰€åšçš„é‚£æ ·åˆ†å—æå–æ•°æ®ã€‚é‚£`stream`æ˜¯å¹²ä»€ä¹ˆç”¨çš„ã€‚**å®ƒå¯ä»¥å¸®åŠ©ä½ ä¼˜åŒ–åº”ç”¨ç¨‹åºçš„å†…å­˜å¹¶å¯¼å‡ºæ•°æ®ï¼Œè€Œæ— éœ€å°†æ‰€æœ‰è¡ŒåŠ è½½åˆ°å†…å­˜ä¸­ã€‚**

> å¦‚æœä½ ä½¿ç”¨ AWS Lambda æˆ– GCP äº‘åŠŸèƒ½ï¼Œè¿™æœ‰åŠ©äºèŠ‚çœèµ„é‡‘ï¼Œå¹¶ä¸”ä¸ä¼šè¿‡åº¦é…ç½®å†…å­˜èµ„æºã€‚

é€šå¸¸ï¼Œ128 Mb çš„åˆ†é…å†…å­˜**è¶³ä»¥**å¯¼å‡ºå‡ ç™¾ä¸‡è¡Œã€‚

> *æ‰€ä»¥æœ‰äº† Node.js* `*stream*` *ä½ å¯ä»¥æ›´é«˜æ•ˆçš„æŠŠ MySQL è¿æ¥åˆ°ä½ çš„æ•°æ®ä»“åº“ã€‚*

**å®ƒçš„è¦æ—¨**

å‡è®¾æ‚¨æƒ³ä» MySQL ä¸­é€è¡Œæå–æ•°æ®ï¼Œå¹¶åœ¨æœ¬åœ°ä¿å­˜ä¸º CSV æ ¼å¼ã€‚ä»¥ä¸‹ç¤ºä¾‹é€‚ç”¨äº npm åŒ…`mysql2`å’Œ`csv-stringify`ã€‚

å°è¯•åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ç”¨ lambda çš„`npm run test`å‘½ä»¤è¿è¡Œå®ƒã€‚

# å¦‚ä½•ç”¨`stream`é«˜æ•ˆåœ°ä» MySQL å¯¼å‡ºæ•°æ®å¹¶åœ¨æœ¬åœ°ä¿å­˜ä¸º CSV

ä½ æ‰€éœ€è¦çš„åªæ˜¯ä¸€ä¸ª`queryDbAndSave()`å‡½æ•°ã€‚å°è¯•å°†ä¸‹é¢çš„`async`ç¤ºä¾‹æ·»åŠ åˆ°æ‚¨çš„`processEvent()`å‡½æ•°ä¸­ã€‚

**æŠŠè¿™ä¸ªåŠ åˆ°ä½ çš„** `**processEvent()**` **å‡½æ•°é‡Œï¼Œå°±åƒè¿™æ ·:**

**ä¸‹ä¸€ä¸ª**åœ¨ä½ çš„å‘½ä»¤è¡Œè¿è¡Œ:`$ npm run test`ã€‚

> *æœ‰æƒ³æ³•äº†ï¼Ÿé…·æ¯™äº†ã€‚è®©æˆ‘ä»¬ç»§ç»­ä¸¾æ›´å¤šçš„ä¾‹å­ã€‚*

# å¦‚ä½•å°†æ•°æ®ä» MySQL å¯¼å‡ºï¼Œå¹¶é€šè¿‡ç®¡é“`stream`ä¼ è¾“åˆ° GCP çš„äº‘å­˜å‚¨æˆ– AWS S3

è¿™ä¸ªä¾‹å­å°†æŠŠä½ çš„ SQL æŸ¥è¯¢ç»“æœä¿å­˜åˆ° **AWS S3** æˆ–è€… **GCP äº‘å­˜å‚¨**ä¸­ï¼Œä¸éœ€è¦è¿‡åº¦é…ç½®å†…å­˜èµ„æºã€‚

åœ¨æˆ‘çš„åœºæ™¯ä¸­ï¼Œæˆ‘å¸Œæœ›å°†ç»“æœæŸ¥è¯¢åˆ°æˆ‘çš„ ***S3 æ•°æ®æ¹–æ¡¶*** ï¼Œå¹¶å°† JSON è½¬æ¢ä¸º [ndJSON](http://ndjson.org/) ã€‚

è¿™æ ·ï¼Œå½“æ–‡ä»¶åœ¨äº‘å­˜å‚¨ä¸­è¢«åˆ›å»ºæ—¶ï¼Œæˆ‘å¯ä»¥å¾ˆå®¹æ˜“åœ°ç”¨å…¶ä»–çš„*æœåŠ¡* è¿›ä¸€æ­¥è§¦å‘ ***æ•°æ®æ‘„å–*** ã€‚å¦‚æœä½ æƒ³å­¦ä¹ å¦‚ä½•åšï¼Œè¯·æŸ¥çœ‹æˆ‘çš„æ•™ç¨‹**å¦‚ä½•å¤„ç†æ•°æ®åŠ è½½åˆ°ä½ çš„æ•°æ®ä»“åº“**ã€‚

</how-to-handle-data-loading-in-bigquery-with-serverless-ingest-manager-and-node-js-4f99fba92436>  

å¯¹äº`stream-save`æŸ¥è¯¢ç»“æœï¼Œæ‚¨å¯èƒ½æƒ³è¦å‘æ‚¨çš„`queryDbAndSave()`å‡½æ•°æ·»åŠ ä¸€ä¸ªæ–°çš„**åˆ†æ”¯**:

æ­¤ç¤ºä¾‹é€‚ç”¨äºç›¸åŒçš„æ¨¡å—ï¼Œä½†æ‚¨å¯èƒ½ä¹Ÿæƒ³åŒ…æ‹¬è¿™äº›æ¨¡å—:

*   `npm i aws-sdk@2.1001.0`æ’°å†™æœ¬æ–‡æ—¶ï¼ŒAWS Lambda ç¯å¢ƒä¸­ä½¿ç”¨çš„ã€‚æ£€æŸ¥å½“å‰ç¯å¢ƒ[è¿™é‡Œçš„](https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtimes.html)ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥ç®€å•åœ°å°†å…¶ä»éƒ¨ç½²å·¥ä»¶ä¸­æ’é™¤ã€‚
*   `through2@4.0.2"`ä¸€ä¸ªæ›´å®¹æ˜“æ„å»ºçš„åŒ…è£…åº“`streams`ã€‚

æ‰€ä»¥ç°åœ¨å¦‚æœå†æ·»åŠ ä¸€ä¸ª ***MySQL ç®¡é“*** åˆ°ä½ çš„`./config.json`:

> *åœ¨ä½ çš„å‘½ä»¤è¡Œè¿è¡Œ* `*$ npm run test*` *ã€‚*

> *å®ƒå°†ä» MySQL ä¸­å¯¼å‡ºæ•°æ®ï¼Œå¹¶ä»¥* `*stream*` *æ¨¡å¼å°†å…¶* ***ä¿å­˜ä¸ºä¸€ä¸ªæ–‡ä»¶*** *åˆ°æ‚¨çš„äº‘å­˜å‚¨ä¸­ã€‚*

# å¦‚ä½•å°†æ•°æ®å¯¼å‡ºä¸ºä¸€ä¸ª`stream`å¹¶å°†å…¶åˆ†å—ä¿å­˜åˆ°äº‘å­˜å‚¨ä¸­

æ‚¨å¯èƒ½è¿˜æƒ³å°†æ•°æ®**ä¿å­˜åœ¨æœ¬åœ°**æˆ–ä¿å­˜åˆ° **AWS S3** ä¸­ï¼Œå³ä¿å­˜åœ¨ ***æ‰¹å¤„ç†æ¨¡å¼*** ä¸­ã€‚ä¸‹é¢çš„ç‰‡æ®µè§£é‡Šäº†å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚

æ‚¨å¯èƒ½å¸Œæœ›åœ¨`./app.js` : `const BATCH_SIZE = process.env.BATCH_SIZE || 3000;`çš„é¡¶éƒ¨å£°æ˜è¾“å‡ºæ–‡ä»¶çš„æ‰¹é‡å¤§å°

é‚£ä¹ˆæ‚¨å¯èƒ½æƒ³è¦è¯„ä¼° SQL æŸ¥è¯¢çš„å¤§å°ã€‚æ‚¨å¯ä»¥ä¸ºæ­¤ä½¿ç”¨å¦ä¸€ä¸ªå¼‚æ­¥å‡½æ•°:

å‘æ‚¨çš„`queryDbAndSave()`å‡½æ•°æ·»åŠ å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œå¹¶åœ¨æ¯æ¬¡æ£€æŸ¥æ˜¯å¦åˆ°äº†ç»“æŸæ—¶é—´æ—¶åˆ†å—å¯¼å‡ºæ•°æ®:

**æœ€ç»ˆè§£å†³æ–¹æ¡ˆä¸º**`**./app.js**`**`**processEvent()**`**åŠŸèƒ½:**åˆ«å¿˜äº†è¿è¡Œ`$npm i moment`ã€‚`./app.js`å°†ä½¿ç”¨æ„é€ æ–‡ä»¶çš„é”®æ¥ä¿å­˜å¯¹è±¡ã€‚**

# å¦‚ä½•ä½¿ç”¨ yaml é…ç½®

æœ€ç»ˆçš„è§£å†³æ–¹æ¡ˆå¯ä»¥åœ¨è¿™ä¸ª[ä»“åº“](https://aws.amazon.com/blogs/database/capturing-data-changes-in-amazon-aurora-using-aws-lambda/)ä¸­æ‰¾åˆ°ï¼Œä¸ºä½ çš„ MySQL ç®¡é“ä½¿ç”¨`npm config`å’Œ`yaml`å®šä¹‰ã€‚

> æˆ‘æ›´å–œæ¬¢ä½¿ç”¨ `*yaml*` *åªæ˜¯å› ä¸ºå½“ä½ æ·»åŠ é‚£äº›é•¿çš„ SQL æŸ¥è¯¢æ—¶æ›´å®¹æ˜“é˜…è¯»ã€‚*

æ ·å“`./config/staging.yaml`é€šå¸¸ä¼šçœ‹èµ·æ¥:

åœ¨æˆ‘çœ‹æ¥ï¼Œå½“ä½ éœ€è¦åŒºåˆ†`live`å’Œ`staging`ç¯å¢ƒæ—¶ï¼Œè¿™ä¹Ÿæ›´ç›´è§‚ã€‚åœ¨ä½ çš„å‘½ä»¤è¡Œè¿è¡Œ`$ npm i config`ã€‚æ‰€ä»¥ä½ æœ€ç»ˆçš„åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹ç”¨`./config/`ä»£æ›¿`./config.json`çœ‹èµ·æ¥ä¼šåƒè¿™æ ·:

# å¦‚ä½•éƒ¨ç½²è§£å†³æ–¹æ¡ˆ

æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥åšåˆ°ã€‚

1.  åˆå­¦è€…å¯èƒ½ä¼šé€‰æ‹©ä½¿ç”¨ web UIï¼Œè¦ä¹ˆå°†è§£å†³æ–¹æ¡ˆéƒ¨ç½²ä¸º **AWS Lambda** æˆ– **GCP äº‘åŠŸèƒ½**
2.  æ›´é«˜çº§çš„ç”¨æˆ·å¯èƒ½æƒ³è¦åˆ›å»ºä¸€ä¸ªéƒ¨ç½² shell è„šæœ¬`./deploy.sh`,å¦‚ä¸‹æ‰€ç¤ºã€‚åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ`$ ./deploy.sh`ï¼Œå®ƒå°†éƒ¨ç½² Lambda:

3.ä½¿ç”¨ Tarraform æˆ– AWS Cloudformation éƒ¨ç½²ä»£ç ä¸ºçš„**åŸºç¡€è®¾æ–½ã€‚æ–¹ä¾¿çš„ AWS Cloudformation æ¨¡æ¿å¯ä»¥åœ¨ github ä¸Šçš„è¿™ä¸ªé¡¹ç›®çš„èµ„æºåº“ä¸­æ‰¾åˆ°ã€‚**

åœ¨éƒ¨ç½²æœŸé—´ï¼Œç¡®ä¿æ‚¨æ­£ç¡®é…ç½®äº†æ‰€æœ‰è®¿é—®**è§’è‰²**å’Œ**å®‰å…¨ç»„**ã€‚ä¾‹å¦‚ï¼Œå½“æ‚¨çš„ MySQL æ•°æ®åº“åœ¨ AWS ä¸­æ—¶ï¼Œæ‚¨çš„ Lambda å‡½æ•°å¿…é¡»éƒ¨ç½²åœ¨åŒä¸€ä¸ª VPC ä¸­æ‰èƒ½è®¿é—®å®ƒã€‚ä¸€æ—¦ä½ åœ¨ Lambda ä¸­å¯ç”¨äº† VPC æ”¯æŒï¼Œä½ çš„å‡½æ•°å°±ä¸èƒ½å†è®¿é—® VPC ä¹‹å¤–çš„ä»»ä½•ä¸œè¥¿ï¼ŒåŒ…æ‹¬ S3ã€‚å…·ä½“åˆ° S3ï¼Œä½ å¯ä»¥ä½¿ç”¨[VPC ç«¯ç‚¹][15]æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

# ç»“è®º

è¿™æ˜¯ä¸€ä¸ªç®€å•å¯é çš„ ***æ•°æ®å¯¼å‡º*** è§£å†³æ–¹æ¡ˆï¼Œå…è®¸ä½ ä»¥ä½å†…å­˜ä½¿ç”¨çš„æ–¹å¼ä» **MySQL æ•°æ®åº“**ä¸­æå–æ•°æ®ã€‚è¿™æ ·ä½ å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªå¿«é€Ÿå¯é çš„ ***MySQL æ•°æ®è¿æ¥å™¨*** å¹¶æ‹¥æœ‰ä¸€äº›ä»¤äººæ•¬ç•çš„ç‰¹æ€§:

*   é€šè¿‡ä»å‘½ä»¤è¡Œè¿è¡Œ`$npm run test`ä»¥ç¼–ç¨‹æ–¹å¼æå– MySQL æ•°æ®ã€‚
*   ä½¿ç”¨`yaml`å®šä¹‰æ¥æè¿°ä½ çš„ ***MySQL ç®¡é“*** ã€‚
*   æ‰§è¡Œ`dryRun`æ¥è¯„ä¼° SQL å¤§å°ã€‚
*   ä½¿ç”¨`Node.js streams`å¯¼å‡ºæ•°æ®ï¼Œä»¥é¿å…å†…å­˜è¿‡åº¦é…ç½®ã€‚
*   åœ¨æœ¬åœ°è®¾å¤‡ä¸Šä¿å­˜æ•°æ®å¯¼å‡ºã€‚
*   å°†æ•°æ®ä½œä¸ºä¸€ä¸ªæ–‡ä»¶æˆ–æˆå—ä¿å­˜åˆ°**äº‘**ä¸­ã€‚
*   ä»¥**åŸºç¡€è®¾æ–½ä¸ºä»£ç çš„ä¸€é”®å¼éƒ¨ç½²å’Œè°ƒåº¦**

æŸ¥çœ‹ [Github åº“](https://github.com/mshakhomirov/pipelinetools)äº†è§£æ›´å¤šä¿¡æ¯ã€‚

ä¸€äº›å®æ—¶é›†æˆå¯èƒ½ä¼šå¾ˆæ˜‚è´µï¼Œè€Œä¸”é€šå¸¸ä¾èµ–äºä½ æ‹¥æœ‰çš„æ•°æ®é‡ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæ’å…¥åˆ° MySQL ä¸­çš„æ¯ä¸€è¡Œéƒ½ä¼šè§¦å‘ Lambda å¯¼å‡ºå¹¶æ’å…¥åˆ°æ‚¨çš„æ•°æ®ä»“åº“ä¸­ã€‚æœ‰ä¸€ç§æ›´å¥½çš„æ–¹æ³•æ¥åƒè¿™æ ·ç›‘è§†å’Œæ§åˆ¶æ•°æ®æ‘„å–ã€‚

å°±åœ¨å‡ å¤©å‰ï¼Œæˆ‘ç”¨å®ƒä» MySQL ä¸­å¯¼å‡ºäº† 5600 ä¸‡è¡Œã€‚ç„¶åæˆ‘å°†å®ƒä»¬åˆ†å—ä¿å­˜åˆ° AWS S3 çš„æ•°æ®æ¹–ä¸­ã€‚ä¾‹å¦‚ï¼Œæˆ‘æœ‰ä¸€ä¸ªæ•°æ®åŠ è½½ç®¡ç†å™¨ï¼Œæ¯æ¬¡æ–‡ä»¶è¿›å…¥æ•°æ®æ¹–æ—¶ï¼Œå®ƒéƒ½ä¼šå°†æ•°æ®å‘é€åˆ°æˆ‘çš„ BigQuery æ•°æ®ä»“åº“ã€‚

</how-to-handle-data-loading-in-bigquery-with-serverless-ingest-manager-and-node-js-4f99fba92436>  

å› æ­¤ï¼Œå¯¼å‡ºæˆ‘çš„ MySQL æ•°æ®å¹¶å°†å…¶åŠ è½½åˆ°æˆ‘çš„æ•°æ®ä»“åº“æ—¢å¿«åˆå®¹æ˜“ã€‚

# èµ„æº

[1]:[https://towardsdatascience . com/how-to-handle-data-loading-in-big query-with-server less-ingest-manager-and-node-js-4f 99 FBA 92436](/how-to-handle-data-loading-in-bigquery-with-serverless-ingest-manager-and-node-js-4f99fba92436)

[2]:[https://dev.mysql.com/doc/refman/5.7/en/select-into.html](https://dev.mysql.com/doc/refman/5.7/en/select-into.html)

[3]:[https://docs . AWS . Amazon . com/Amazon rds/latest/aurora user guide/aurora MySQLã€‚Integrating.SaveIntoS3.html](https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/AuroraMySQL.Integrating.SaveIntoS3.html)

[4]:[https://www.npmjs.com/package/mysql2](https://www.npmjs.com/package/mysql2)

ã€5ã€‘:ã€https://nodejs.org/api/stream.html 

[6]:ã€http://ndjson.org/ 

[7]:[https://docs . AWS . Amazon . com/lambda/latest/DG/lambda-runtimes . html](https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtimes.html)

[8]:[https://AWS . Amazon . com/blogs/database/captureing-data-changes-in-Amazon-aurora-using-AWS-lambda/](https://aws.amazon.com/blogs/database/capturing-data-changes-in-amazon-aurora-using-aws-lambda/)

[9]:[https://stack overflow . com/questions/12333260/export-a-MySQL-table-with-äº¿ä¸‡è®°å½•åˆ†å—](https://stackoverflow.com/questions/12333260/export-a-mysql-table-with-hundreds-of-millions-of-records-in-chunks)

[10]:[https://stack overflow . com/questions/1119312/MySQL-export-into-outfile-CSV-escaping-chars/1197023](https://stackoverflow.com/questions/1119312/mysql-export-into-outfile-csv-escaping-chars/1197023)

[11]:[https://joshuaotwell . com/select-into-outfile-examples-in-MySQL/](https://joshuaotwell.com/select-into-outfile-examples-in-mysql/)

[12]:[https://github.com/sidorares/node-mysql2/issues/677](https://github.com/sidorares/node-mysql2/issues/677)

[13]:[https://AWS . Amazon . com/blogs/database/best-practices-for-export-and-import-data-from-Amazon-aurora-MySQL-to-Amazon-S3/](https://aws.amazon.com/blogs/database/best-practices-for-exporting-and-importing-data-from-amazon-aurora-mysql-to-amazon-s3/)

[14]:[https://blog . rising stack . com/node-js-MySQL-example-handling-Bai-gigabytes-of-data/](https://blog.risingstack.com/node-js-mysql-example-handling-hundred-gigabytes-of-data/)

*åŸè½½äº*[*https://mydataschool.com*](https://mydataschool.com/blog/mysql-data-connector-for-your-data-warehouse/)*ã€‚*