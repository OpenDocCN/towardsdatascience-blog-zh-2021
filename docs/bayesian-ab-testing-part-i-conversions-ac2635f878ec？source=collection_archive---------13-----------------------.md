# è´å¶æ–¯ AB æ£€éªŒâ€”ç¬¬ä¸€éƒ¨åˆ†â€”è½¬æ¢

> åŸæ–‡ï¼š<https://towardsdatascience.com/bayesian-ab-testing-part-i-conversions-ac2635f878ec?source=collection_archive---------13----------------------->

![](img/a7291b448c09e1e9b9f2b42fe56da936.png)

åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Š[åºæµ©æ–‡](https://unsplash.com/@raypang?utm_source=medium&utm_medium=referral)çš„ç…§ç‰‡

# ç³»åˆ—ç»“æ„

åœ¨[ä¹‹å‰çš„ä¸€ç¯‡åšæ–‡](/bayesian-experimentation-methods-for-products-636514951e43)ä¸­ï¼Œæˆ‘è®¨è®ºäº†ä½¿ç”¨è´å¶æ–¯ AB æµ‹è¯•æ–¹æ³•è€Œä¸æ˜¯é¢‘ç¹æµ‹è¯•æ–¹æ³•çš„ä¼˜åŠ¿ã€‚åœ¨è¿™ä¸€ç³»åˆ—çš„åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘å°†æ›´æ·±å…¥åœ°ç ”ç©¶ç›¸å…³çš„è®¡ç®—ï¼Œä»¥åŠå¦‚ä½•åœ¨ç°å®ä¸–ç•Œä¸­å®ç°å®ƒä»¬ã€‚è¯¥ç³»åˆ—çš„ç»“æ„å¦‚ä¸‹:

1.  åŸºäºè½¬æ¢çš„æµ‹è¯•åº¦é‡(é€Ÿç‡åº¦é‡)çš„å»ºæ¨¡å’Œåˆ†æ
2.  [åŸºäºæ”¶å…¥çš„æµ‹è¯•æŒ‡æ ‡çš„å»ºæ¨¡å’Œåˆ†æ](/bayesian-ab-testing-part-ii-revenue-1fbcf04f96cd)
3.  [è®¡ç®—æµ‹è¯•æŒç»­æ—¶é—´](/bayesian-ab-testing-part-iii-test-duration-f2305215009c)
4.  [é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„å…ˆéªŒ](/bayesian-ab-testing-part-iv-choosing-a-prior-5a4fe3223bfd)
5.  ç”¨å¤šä¸ªå˜é‡è¿è¡Œæµ‹è¯•

å› æ­¤ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬è¿›å…¥å¦‚ä½•åœ¨è´å¶æ–¯äº§å“å®éªŒä¸­å»ºæ¨¡ã€ä½¿ç”¨å’Œåˆ†æåŸºäºè½¬æ¢çš„æµ‹è¯•æŒ‡æ ‡ã€‚

# å®éªŒèƒŒæ™¯

æ ¹æ®åœ¨[ä¸Šä¸€ç¯‡æ–‡ç« ](/bayesian-experimentation-methods-for-products-636514951e43)ä¸­ä½¿ç”¨çš„ä¾‹å­ï¼Œè®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬æœ€è¿‘æ”¹å˜äº†è¿½åŠ é”€å”®å±å¹•ä¸Šçš„ä¿¡æ¯ï¼Œå¹¶å¸Œæœ›åœ¨å‘æ›´å¹¿æ³›çš„ç”¨æˆ·ç¾¤å‘å¸ƒä¹‹å‰è¿›è¡Œ AB æµ‹è¯•ã€‚æˆ‘ä»¬å‡è®¾æˆ‘ä»¬æ‰€åšçš„æ”¹å˜å°†ä¼šå¸¦æ¥æ›´å¥½çš„è½¬åŒ–ç‡ã€‚

ä¸ frequentist æ–¹æ³•ç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†ğ‘‹ä¿ƒé”€å±å¹•ä¸Šçš„æ¯æ¬¡è½¬æ¢å»ºæ¨¡ä¸ºä¼¯åŠªåˆ©éšæœºå˜é‡ï¼Œè½¬æ¢æ¦‚ç‡ä¸ºğœ†:

![](img/53eea36f13fc30b343bc2e78b16a33b5.png)

åœ¨é¢‘ç‡ä¸»ä¹‰æ–¹æ³•ä¸‹ï¼Œæˆ‘ä»¬å‡è®¾ğœ†æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œè€Œåœ¨è´å¶æ–¯æ–¹æ³•ä¸‹ï¼Œæˆ‘ä»¬å°†å…¶å»ºæ¨¡ä¸ºä¸€ä¸ªéšæœºå˜é‡ï¼Œæœ‰è‡ªå·±çš„æ¦‚ç‡åˆ†å¸ƒã€‚æˆ‘ä»¬çš„ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨è¿‡å»çš„æ•°æ®ä¸ºè¿™ä¸ªåˆ†å¸ƒé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„è¿‘ä¼¼å€¼ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºæˆ‘ä»¬ä¹‹å‰çš„ğœ†.åˆ†å¸ƒ

ç„¶åï¼Œæˆ‘ä»¬è®¾å®šæŸå¤±é˜ˆå€¼ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨çŠ¯é”™æ—¶æ„¿æ„æ¥å—çš„æœ€å¤§é¢„æœŸæŸå¤±ã€‚ä¸ä»»ä½•ç»Ÿè®¡å»ºæ¨¡ä¸€æ ·ï¼Œè´å¶æ–¯å®éªŒæ–¹æ³•æ˜¯å»ºç«‹åœ¨çœŸå®ä¸–ç•Œæ•°æ®çš„è¿‘ä¼¼å€¼ä¹‹ä¸Šçš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ€»æ˜¯æœ‰å¯èƒ½ä»æµ‹è¯•ä¸­å¾—å‡ºé”™è¯¯çš„ç»“è®ºã€‚è¿™ä¸ªæŸå¤±é˜ˆå€¼è®©æˆ‘ä»¬å¯ä»¥è¯´ï¼Œå³ä½¿æˆ‘ä»¬å¾—å‡ºäº†é”™è¯¯çš„ç»“è®ºï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç¡®ä¿¡è½¬åŒ–ç‡ä¸ä¼šä¸‹é™è¶…è¿‡æˆ‘ä»¬å¯ä»¥æ¥å—çš„æ°´å¹³ã€‚

æœ€åï¼Œæˆ‘ä»¬ä»¥éšæœºå®éªŒçš„å½¢å¼æŠ½å–æ ·æœ¬ï¼Œå¹¶ä½¿ç”¨è¿™äº›æ ·æœ¬æ¥æ›´æ–°åˆ†å¸ƒï¼Œä»è€Œæ›´æ–°æˆ‘ä»¬å…³äºğœ†åœ¨è¿½åŠ é”€å”®å±å¹•çš„æ§åˆ¶å’Œæ²»ç–—ç‰ˆæœ¬ä¸‹çš„ä¿¡å¿µã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›åéªŒåˆ†å¸ƒæ¥è®¡ç®—æ²»ç–—ä¼˜äºå¯¹ç…§ç»„çš„æ¦‚ç‡ä»¥åŠé”™è¯¯é€‰æ‹©æ²»ç–—çš„é¢„æœŸæŸå¤±ã€‚

æ‰€ä»¥æˆ‘ä»¬çš„ç¬¬ä¸€æ­¥æ˜¯é€‰æ‹©ğœ†.çš„å…ˆéªŒåˆ†å¸ƒè¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹æˆ‘ä»¬æœ€è¿‘(è¿‡å»å‡ å‘¨)æ”¶é›†çš„å…³äºè¿™ä¸€è½¬æ¢çš„æ•°æ®ã€‚æˆ‘ç”Ÿæˆäº†ä¸€ä¸ªæ ·æœ¬å…ˆéªŒæ•°æ®é›†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥åšè¿™ä¸ªç»ƒä¹ ã€‚

```
import pandas as pdprior_data = pd.read_csv('prior_data.csv')

print(prior_data.head())
print(prior_data.shape)
```

![](img/2a5bfe7da7ae3a9c6feb50fb5ccdbd13.png)

å› ä¸ºè¿™ä¸ªæ•°æ®é›†æ˜¯äººå·¥ç”Ÿæˆçš„ï¼Œæ‰€ä»¥å®ƒå·²ç»æ˜¯è¿™ä¸ªç»ƒä¹ çš„ç†æƒ³æ ¼å¼ã€‚åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ‰§è¡Œä¸€äº› ETL æ“ä½œæ¥è·å¾—è¿™ç§æ ¼å¼çš„æ•°æ®ã€‚ç„¶è€Œï¼Œè¿™è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ã€‚

æˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬æœ‰ 5268 ä¸ªç”¨æˆ·çš„æ ·æœ¬å¤§å°ï¼Œå¯¹äºæ¯ä¸ªç”¨æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»–ä»¬æ˜¯å¦åœ¨è¿™ä¸ªå±å¹•ä¸Šè½¬æ¢ã€‚æˆ‘ä»¬å¯ä»¥ç»§ç»­è®¡ç®—ä¹‹å‰çš„è½¬æ¢ç‡ã€‚

```
conversion_rate = prior_data['converted'].sum()/prior_data.shape[0]print(f'Prior Conversion Rate is {round(conversion_rate, 3)}')
```

![](img/fb9b4b72a25d5076f42bd143f1249aef.png)

# é€‰æ‹©å…ˆéªŒåˆ†å¸ƒ

æˆ‘ä»¬çœ‹åˆ°å…ˆå‰çš„æ•°æ®ç»™å‡ºäº†å¤§çº¦ 30%çš„è½¬åŒ–ç‡ã€‚æˆ‘ä»¬ç°åœ¨ç”¨å®ƒæ¥ä¸ºğœ†.é€‰æ‹©ä¸€ä¸ªå…ˆéªŒåˆ†å¸ƒé€‰æ‹©å…ˆéªŒæ˜¯è´å¶æ–¯å®éªŒæ–¹æ³•çš„ä¸€ä¸ªé‡è¦æ–¹é¢ï¼Œå€¼å¾—å•ç‹¬å‘è¡¨ã€‚æˆ‘å°†åœ¨æœ¬ç³»åˆ—çš„ç¬¬ 4 éƒ¨åˆ†ä¸­å¯¹æ­¤è¿›è¡Œæ›´æ·±å…¥çš„æ¢è®¨ã€‚ç„¶è€Œï¼Œä¸ºäº†è¿™ç¯‡æ–‡ç« çš„ç›®çš„ï¼Œæˆ‘å°†ä½¿ç”¨ä¸€ä¸ªç²—ç•¥çš„æ–¹æ³•æ¥é€‰æ‹©ä¸€ä¸ªå…ˆéªŒã€‚

æˆ‘ä»¬å°†ä½¿ç”¨ [beta åˆ†å¸ƒ](https://en.wikipedia.org/wiki/Beta_distribution)æ¥æ¨¡æ‹Ÿæˆ‘ä»¬çš„è½¬æ¢ç‡ï¼Œå› ä¸ºå®ƒæ˜¯[0ï¼Œ1]ä¸Šçš„çµæ´»åˆ†å¸ƒï¼Œä¹Ÿæ˜¯è‰¯å¥½çš„[å…±è½­å…ˆéªŒ](https://en.wikipedia.org/wiki/Conjugate_prior)ã€‚å½“æˆ‘ä»¬ç”¨å®éªŒæ•°æ®è®¡ç®—åéªŒæ¦‚ç‡æ—¶ï¼Œè¿™å°†ä½¿æˆ‘ä»¬çš„è®¡ç®—æ›´å®¹æ˜“ã€‚

ä¸ºæˆ‘ä»¬çš„è½¬æ¢é€‰æ‹©å…ˆéªŒåˆ†å¸ƒæ—¶ï¼Œæœ€å¥½é€‰æ‹©æ¯”å…ˆéªŒæ•°æ®å»ºè®®çš„æ›´å¼±çš„å…ˆéªŒã€‚æˆ‘å°†åœ¨æœ¬ç³»åˆ—çš„ç¬¬ 4 éƒ¨åˆ†å†æ¬¡æ·±å…¥æ¢è®¨è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šï¼Œé€‰æ‹©å¤ªå¼ºçš„å…ˆéªŒå¯èƒ½å¯¼è‡´æˆ‘ä»¬çš„åéªŒåˆ†å¸ƒæ˜¯é”™è¯¯çš„ï¼Œå› æ­¤å¯èƒ½å¯¼è‡´é”™è¯¯çš„è®¡ç®—å’Œç»“è®ºã€‚

è®°ä½è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä¸åŒå¼ºåº¦çš„æ½œåœ¨å‰ç§‘ã€‚

```
import numpy as np
from scipy.stats import beta
import matplotlib.pyplot as pltfig, ax = plt.subplots(1, 1)x = np.linspace(0,1,1000)beta_weak = beta(round(conversion_rate, 1)*10 + 1, 10 + 1 - round(conversion_rate, 1)*10)beta_mid = beta(round(conversion_rate, 1)*50 + 1, 50 + 1 - round(conversion_rate, 1)*50)beta_strong = beta(round(conversion_rate, 2)*100 + 1, 100 + 1 - round(conversion_rate, 2)*100)ax.plot(x, beta_weak.pdf(x), label=f'weak Beta({int(round(conversion_rate, 1)*10) + 1}, {10 + 1 - int(round(conversion_rate, 1)*10)})')ax.plot(x, beta_mid.pdf(x), label=f'mid Beta({int(round(conversion_rate, 1)*50) + 1}, {50 + 1 - int(round(conversion_rate, 1)*50)})')ax.plot(x, beta_strong.pdf(x), label=f'strong Beta({int(round(conversion_rate, 2)*100) + 1}, {100 + 1 - int(round(conversion_rate, 2)*100)})')ax.set_xlabel('Conversion Probability')
ax.set_ylabel('Density')
ax.set_title('Choice of Priors')
ax.legend()
```

![](img/16b8ea2424bf480804ef9ff299f7c66f.png)

å…ˆéªŒé€‰æ‹©(å›¾ç‰‡ç”±ä½œè€…æä¾›)

è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªå…ˆéªŒåˆ†å¸ƒï¼Œå®ƒä»¬çš„å¹³å‡è½¬æ¢ç‡çº¦ä¸º 30%ï¼Œä¸æˆ‘ä»¬çš„å…ˆéªŒæ•°æ®ç›¸ä¼¼ï¼Œä½†éƒ½æ¯”å…ˆéªŒæ•°æ®çš„çœŸå®åˆ†å¸ƒå¼±å¾—å¤šã€‚

è®©æˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªåœ¨å›¾ä¸­æœ€å¼±å’Œä¸­ç­‰å…ˆéªŒä¹‹é—´çš„å…ˆéªŒ(ğµğ‘’ğ‘¡ğ‘(7,15)

![](img/aa4d39e8921816ca0e300aeab2457508.png)

å…¶ä¸­ğµ(ğ‘,ğ‘)æ˜¯è¢«å®šä¹‰ä¸º[çš„Î²å‡½æ•°](https://en.wikipedia.org/wiki/Beta_function)

![](img/2a7045d3c8a6be805b3154073f6b22f2.png)

å¹¶ä¸”å…·æœ‰è¯¥å±æ€§

![](img/67704c779659ead6c136b3e619b6d591.png)

```
prior_alpha = round(conversion_rate, 1)*20 + 1
prior_beta = 20 + 1 - round(conversion_rate, 1)*20prior = beta(prior_alpha, prior_beta)fig, ax = plt.subplots(1, 1)x = np.linspace(0,1,1000)ax.plot(x, prior.pdf(x), label=f'prior Beta({int(round(conversion_rate, 1)*20) + 1}, {20 + 1 - int(round(conversion_rate, 1)*20)})')
ax.set_xlabel('Conversion Probability')
ax.set_ylabel('Density')
ax.set_title('Chosen Prior')
ax.legend()
```

![](img/2785a7cfa1bc41c89426a8ca6245aa6b.png)

é€‰æ‹©çš„å…ˆéªŒ(å›¾ç‰‡ç”±ä½œè€…æä¾›)

# è®¾ç½®æŸå¤±é˜ˆå€¼

æ—¢ç„¶æˆ‘ä»¬å·²ç»é€‰æ‹©äº†å…ˆéªŒï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹©æˆ‘ä»¬çš„ğœ–ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨é”™è¯¯é€‰æ‹©é”™è¯¯å˜é‡çš„æƒ…å†µä¸‹æ„¿æ„æ¥å—çš„æœ€é«˜é¢„æœŸæŸå¤±ã€‚è®©æˆ‘ä»¬å‡è®¾è¿™å¯¹æˆ‘ä»¬æ¥è¯´æ˜¯ä¸€ä¸ªé‡è¦çš„è½¬å˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸Œæœ›å¯¹è¿™ä¸ªğœ–.ç›¸å½“ä¿å®ˆæˆ‘ä»¬ä¸æ„¿æ„æ¥å—è¶…è¿‡ 0.5%çš„ç›¸å¯¹é¢„æœŸæŸå¤±ã€‚æ‰€ä»¥æˆ‘ä»¬è®¾å®šğœ–=0.005âˆ—0.3=0.0015.

æˆ‘ä»¬æœ‰ä¸€ä¸ªé¢„æœŸæŸå¤±çš„å…ˆéªŒå’Œé˜ˆå€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¼€å§‹è¿è¡Œæˆ‘ä»¬çš„å®éªŒå¹¶ä»ä¸­æ”¶é›†æ•°æ®ã€‚

# å®éªŒç»“æœ

è®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬å·²ç»è®©æˆ‘ä»¬çš„å®éªŒè¿è¡Œäº†å‡ ä¸ªæ˜ŸæœŸï¼Œå¹¶æƒ³æ£€æŸ¥æˆ‘ä»¬æ˜¯å¦èƒ½ä»ä¸­å¾—å‡ºä»»ä½•ç»“è®ºã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æˆ‘ä»¬çš„å®éªŒæ•°æ®æ¥è®¡ç®—æˆ‘ä»¬çš„åéªŒåˆ†å¸ƒï¼Œç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥è®¡ç®—æ¯ä¸ªå˜é‡å˜å¾—æ›´å¥½çš„æ¦‚ç‡ï¼Œä»¥åŠé”™è¯¯é€‰æ‹©æ¯ä¸ªå˜é‡çš„é¢„æœŸæŸå¤±ã€‚

å‡ºäºæœ¬ç»ƒä¹ çš„ç›®çš„ï¼Œæˆ‘ç”Ÿæˆäº†ä¸€ä¸ªæ ·æœ¬å®éªŒæ•°æ®é›†ã€‚è®©æˆ‘ä»¬ä»æ¢ç´¢å®ƒå’Œèšåˆå®ƒå¼€å§‹ï¼Œæ‰¾å‡ºæ¯ä¸ªå˜ä½“çš„è½¬æ¢ç‡ã€‚

```
experiment_data = pd.read_csv('experiment_data.csv')print(experiment_data.head())
print(experiment_data.shape)
```

![](img/8dc04108a1b25870ca3b455bf1904e07.png)

æˆ‘ä»¬çœ‹åˆ°è¯¥æ•°æ®é›†ä¸ä¹‹å‰çš„æ•°æ®é›†ç›¸ä¼¼ï¼Œåªæ˜¯å¤šäº†ä¸€åˆ—ï¼Œç”¨äºæŒ‡å®šç”¨æˆ·è¢«åˆ†é…åˆ°å“ªä¸ªç»„ï¼Œä»¥åŠä»–ä»¬çœ‹åˆ°å“ªä¸ªå˜é‡ã€‚å†æ¬¡å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”±äºè¿™ä¸ªæ•°æ®é›†æ˜¯äººå·¥ç”Ÿæˆçš„ï¼Œå®ƒå·²ç»æ˜¯è¿™ä¸ªç»ƒä¹ çš„ç†æƒ³æ ¼å¼ï¼Œä¸éœ€è¦é¢å¤–çš„ ETL æ“ä½œã€‚

æˆ‘ä»¬ç°åœ¨å¯ä»¥å¼€å§‹æ±‡æ€»æ•°æ®äº†ã€‚

```
results = experiment_data.groupby('group').agg({'userId': pd.Series.nunique, 'converted': sum})results.rename({'userId': 'sampleSize'}, axis=1, inplace=True)results['conversionRate'] = results['converted']/results['sampleSize']print(results)
```

![](img/a74b8f2954e36b667116b3087127acae.png)

æˆ‘ä»¬å¯ä»¥é€šè¿‡è§‚å¯Ÿå¾—çŸ¥æ²»ç–—æœ‰æ›´å¥½çš„è½¬åŒ–ç‡ï¼Œä½†æˆ‘ä»¬éœ€è¦è¿›è¡Œè¿›ä¸€æ­¥çš„è®¡ç®—ï¼Œä»¥æ›´æ–°æˆ‘ä»¬å¯¹å¯¹ç…§ç»„å’Œæ²»ç–—ç»„å˜å¼‚ä½“å„è‡ªçš„è½¬åŒ–æ¦‚ç‡ğœ†_ğ‘å’Œğœ†_ğ‘¡çš„çœ‹æ³•ã€‚

æœ‰äº†æˆ‘ä»¬çš„å®éªŒæ•°æ®ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥è®¡ç®—æ¯ä¸ªå˜é‡ä¸‹çš„åéªŒåˆ†å¸ƒã€‚ä½†åœ¨æ­¤ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ¢ç´¢ä¸€ä¸‹ï¼Œä»…ä»…ä»æˆ‘ä»¬ç°æœ‰çš„ä¿¡æ¯ä¸­ï¼Œè¿™æ˜¯å¦‚ä½•å¯èƒ½çš„èƒŒåçš„æ•°å­¦åŸç†ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªå®šç†[1]é™ˆè¿°å¦‚ä¸‹:

å‡è®¾æˆ‘ä»¬æœ‰å…ˆéªŒçŸ¥è¯†

![](img/73f79229356fc483142938ce2ca5de5c.png)

å‡è®¾ä¸€ä¸ªå˜ä½“è¢«å±•ç¤ºç»™ğ‘›çš„è®¿é—®è€…ï¼Œè€Œğ‘æ”¹å˜äº†ä¿¡ä»°ï¼Œé‚£ä¹ˆè¯¥å˜ä½“çš„åéªŒåˆ†å¸ƒç”±ä¸‹å¼ç»™å‡º

![](img/d24c05ca0d6d2c63e2b230b97f6d99e0.png)

è®©æˆ‘ä»¬ç»§ç»­è¯æ˜è¿™ä¸€ç‚¹ã€‚æ ¹æ®è´å¶æ–¯å®šç†ï¼Œæˆ‘ä»¬å¾—åˆ°äº†

![](img/472a7ba2429434df674fc4b144167cf1.png)

ç”±äºæˆ‘ä»¬å°†æ¯æ¬¡è½¬æ¢å»ºæ¨¡ä¸ºå…·æœ‰æ¦‚ç‡ğœ†çš„ä¼¯åŠªåˆ© RVï¼Œç»™å®šğœ†ï¼Œæˆ‘ä»¬å¯ä»¥å°†å‘ğ‘›æ¸¸å®¢å±•ç¤ºå˜é‡çš„ç»“æœå»ºæ¨¡ä¸ºäºŒé¡¹å¼ RVã€‚æ‰€ä»¥æˆ‘ä»¬æœ‰

![](img/896f62812846181778dd321c6237fcee.png)

å› æ­¤ï¼Œä½¿ç”¨æˆ‘ä»¬å…ˆå‰çš„å®šä¹‰

![](img/41df7f0d93804b056e56a2e4abe7d196.png)

ç°åœ¨è®©æˆ‘ä»¬åªè€ƒè™‘ç³»æ•°

![](img/c0e2341408ee4038db2d7f8e70934a4f.png)

åˆ©ç”¨è´å¡”å‡½æ•°çš„å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥è¯´

![](img/391f054bb09e78f99256f871e519aae2.png)

å°†(3)å’Œ(4)æ›¿æ¢å›(2)

![](img/567ee0186c8b2d4c2ba80019b11cbfb3.png)

å°†(5)æ›¿æ¢å›(1)

![](img/00f25cf9a0457f1d1c4a1446b2815b50.png)

è‡ªğ‘“(ğœ†ä»¥æ¥ï¼›ğ‘+ğ‘,ğ‘+ğ‘›âˆ’ğ‘)æ˜¯åœ¨[0ï¼Œ1]ä¸Šçš„åˆ†å¸ƒï¼Œåˆ†æ¯æ˜¯ 1ï¼Œæˆ‘ä»¬å¾—åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»å……åˆ†ç›¸ä¿¡äº†æ•°å­¦ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—æˆ‘ä»¬çš„åéªŒåˆ†å¸ƒã€‚

```
control = beta(prior_alpha + results.loc['control', 'converted'], prior_beta + results.loc['control', 'sampleSize'] - results.loc['control', 'converted'])treatment = beta(prior_alpha + results.loc['treatment', 'converted'], prior_beta + results.loc['treatment', 'sampleSize'] - results.loc['treatment', 'converted'])fig, ax = plt.subplots()x = np.linspace(0.26,0.42,1000)ax.plot(x, control.pdf(x), label='control')
ax.plot(x, treatment.pdf(x), label='treatment')
ax.set_xlabel('Conversion Probability')
ax.set_ylabel('Density')
ax.set_title('Experiment Posteriors')
ax.legend()
```

![](img/5b9be5e8462fee58b1fe1badccfdbda3.png)

å®éªŒåéªŒ(å›¾ç‰‡ç”±ä½œè€…æä¾›)

ç°åœ¨æˆ‘ä»¬å·²ç»å¾—åˆ°äº†åéªŒåˆ†å¸ƒï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­è®¡ç®—è”åˆåéªŒåˆ†å¸ƒã€‚ç”±äºéšæœºå®éªŒæ˜¯åŸºäºå°†ç”¨æˆ·éšæœºåˆ†é…åˆ°ä¸€ä¸ªå˜é‡çš„æƒ³æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾è¿™ä¸¤ä¸ªåˆ†å¸ƒæ˜¯ç‹¬ç«‹çš„ã€‚è¯·æ³¨æ„ï¼Œæƒ…å†µå¹¶éæ€»æ˜¯å¦‚æ­¤ã€‚ä¾‹å¦‚ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç½‘ç»œæ•ˆåº”å¯èƒ½ä¼šå‘æŒ¥ä½œç”¨ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ã€‚è¿™ç§å‡è®¾ä¹Ÿä¾èµ–äºéšæœºåˆ†é…è¿‡ç¨‹çš„æ­£å¸¸å·¥ä½œã€‚

è®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬çš„éšæœºåˆ†é…æ–¹æ³•å·¥ä½œæ­£å¸¸ï¼Œæ²¡æœ‰ç½‘ç»œæ•ˆåº”ã€‚åœ¨è¿™ç§å‡è®¾ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è¯´:

![](img/b9512f13612f6966d02f8091bff3a49b.png)

è®©æˆ‘ä»¬ç”¨è¿™ä¸ªæ¥è®¡ç®—æˆ‘ä»¬çš„è”åˆåéªŒåˆ†å¸ƒã€‚

```
import seaborn as snsjoint_dist_for_plot = []
for i in np.linspace(0.26,0.42,161):
    for j in np.linspace(0.26,0.42,161):
        joint_dist_for_plot.append([i, j, control.pdf(i)*treatment.pdf(j)])joint_dist_for_plot = pd.DataFrame(joint_dist_for_plot)joint_dist_for_plot.rename({0: 'control_cr', 1: 'treatment_cr', 2: 'joint_density'}, axis=1, inplace=True)tick_locations = range(0, 160, 10)
tick_labels = [round(0.26 + i*0.01, 2) for i in range(16)]heatmap_df = pd.pivot_table(joint_dist_for_plot, values='joint_density', index='treatment_cr', columns='control_cr')ax = sns.heatmap(heatmap_df)
ax.set_xticks(tick_locations)
ax.set_xticklabels(tick_labels)
ax.set_yticks(tick_locations)
ax.set_yticklabels(tick_labels)
ax.invert_yaxis()
```

![](img/8865c56187ca386408fa0537e840624c.png)

å…³èŠ‚åéƒ¨(å›¾ç‰‡ç”±ä½œè€…æä¾›)

å›¾è¡¨ä¸­çš„è“çº¿ä»£è¡¨ğœ†_ğ‘=ğœ†_ğ‘¡.ç”±äºåå…³èŠ‚åœ¨è¿™æ¡çº¿ä»¥ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒä½œä¸ºæ²»ç–—æ•ˆæœæ›´å¥½çš„ç›´è§‚æŒ‡ç¤ºã€‚å¦‚æœåå…³èŠ‚åœ¨è¿™æ¡çº¿ä»¥ä¸‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¾ˆç¡®å®šæ§åˆ¶ä¼šæ›´å¥½ã€‚å¦‚æœå…³èŠ‚åéƒ¨çš„ä»»ä½•éƒ¨åˆ†åœ¨çº¿ä¸Šï¼Œé‚£ä¹ˆå“ªç§å˜å‹æ›´å¥½å°±æœ‰æ›´å¤šçš„ä¸ç¡®å®šæ€§ã€‚

ä¸ºäº†é‡åŒ–è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—ğ‘(ğœ†_ğ‘¡â‰¥ğœ†_ğ‘)å’Œğ¸[ğ¿](ğ‘¡)ï¼Œé”™è¯¯é€‰æ‹©æ²»ç–—çš„é¢„æœŸæŸå¤±ã€‚

```
import decimal
decimal.getcontext().prec = 4control_simulation = np.random.beta(prior_alpha + results.loc['control', 'converted'], prior_beta + results.loc['control', 'sampleSize'] - results.loc['control', 'converted'], size=10000)treatment_simulation = np.random.beta(prior_alpha + results.loc['treatment', 'converted'], prior_beta + results.loc['treatment', 'sampleSize'] - results.loc['treatment', 'converted'], size=10000)treatment_won = [i <= j for i,j in zip(control_simulation, treatment_simulation)]chance_of_beating_control = np.mean(treatment_won)print(f'Chance of treatment beating control is {decimal.getcontext().create_decimal(chance_of_beating_control)}')
```

![](img/6308a0be80f8fb97adb544c2544aa837.png)

ä»æ¨¡æ‹Ÿä¸­æˆ‘ä»¬çœ‹åˆ°ğ‘(ğœ†_ğ‘¡â‰¥ğœ†_ğ‘)=0.9718 so æ²»ç–—æœ‰ 97%çš„æœºä¼šæ¯”å¯¹ç…§ç»„å¥½ã€‚

æ—¢ç„¶æˆ‘ä»¬å·²ç»è®¡ç®—äº†æ²»ç–—æ•ˆæœæ›´å¥½çš„å¯èƒ½æ€§ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—ğ¸[ğ¿](ğ‘¡).æ¯ä¸ªå˜é‡çš„æŸå¤±å‡½æ•°ç”±ä¸‹å¼ç»™å‡º

![](img/33991a54d539b78f85e37b7e8002fa52.png)

å› æ­¤ï¼Œæ¯ä¸ªå˜é‡çš„é¢„æœŸæŸå¤±ç”±ä¸‹å¼ç»™å‡º

![](img/b0c6abcc0987821b00fef36fef787a1f.png)

æˆ‘ä»¬ç”¨è¿™ä¸ªæ¥è®¡ç®—é¢„æœŸæŸå¤±[2]

```
decimal.getcontext().prec = 4loss_control = [max(j - i, 0) for i,j in zip(control_simulation, treatment_simulation)]loss_treatment = [max(i - j, 0) for i,j in zip(control_simulation, treatment_simulation)]all_loss_control = [int(i)*j for i,j in zip(treatment_won, loss_control)]all_loss_treatment = [(1 - int(i))*j for i,j in zip(treatment_won, loss_treatment)]expected_loss_control = np.mean(all_loss_control)
expected_loss_treatment = np.mean(all_loss_treatment)print(f'Expected loss of choosing control: {decimal.getcontext().create_decimal(expected_loss_control)}. Expected loss of choosing treatment: {decimal.getcontext().create_decimal(expected_loss_treatment)}')
```

![](img/07ddb283c24b1e447fdc3df665b0e142.png)

é€šè¿‡è¿è¡Œæ¨¡æ‹Ÿï¼Œæˆ‘ä»¬çœ‹åˆ°:

ğ¸[ğ¿](ğ‘¡) = 0.0001369 < 0.0015 = ğœ–

å› ä¸ºå…¶ä¸­ä¸€ä¸ªå˜å¼‚çš„é¢„æœŸæŸå¤±ä½äºæˆ‘ä»¬åœ¨æµ‹è¯•å¼€å§‹æ—¶è®¾å®šçš„é˜ˆå€¼ï¼Œæ‰€ä»¥æµ‹è¯•è¾¾åˆ°äº†æ˜¾è‘—æ€§ã€‚æˆ‘ä»¬å¯ä»¥å¾ˆæœ‰æŠŠæ¡åœ°å¾—å‡ºç»“è®ºï¼Œæ²»ç–—æ•ˆæœæ›´å¥½ï¼Œé”™è¯¯é€‰æ‹©æ²»ç–—çš„é¢„æœŸæˆæœ¬ä¸ä¼šè¶…è¿‡æˆ‘ä»¬èƒ½æ¥å—çš„æ°´å¹³ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®å°†è¿½åŠ é”€å”®å±å¹•çš„å¤„ç†æ–¹å¼æ¨å¹¿åˆ°æˆ‘ä»¬çš„å…¶ä»–ç”¨æˆ·ç¾¤ã€‚

æˆ‘å¸Œæœ›è¿™ä¸ªæ¡ˆä¾‹ç ”ç©¶æœ‰åŠ©äºæ‚¨ç†è§£å®ç°è´å¶æ–¯ AB æµ‹è¯•æ–¹æ³•æ‰€éœ€çš„è®¡ç®—ã€‚è§‚çœ‹è¿™ä¸ªç©ºé—´çš„[ç³»åˆ—çš„ä¸‹ä¸€éƒ¨åˆ†](/bayesian-ab-testing-part-ii-revenue-1fbcf04f96cd)ï¼

# å‚è€ƒ

[1] [VWO ç™½çš®ä¹¦](https://cdn2.hubspot.net/hubfs/310840/VWO_SmartStats_technical_whitepaper.pdf)ä½œè€…:C. Stucchio

[2] [è´å¶æ–¯ A/B æµ‹è¯•â€”â€”ä¸€ä¸ªæ¨¡æ‹Ÿçš„å®è·µæ¢ç´¢](/exploring-bayesian-a-b-testing-with-simulations-7500b4fc55bc)ä½œè€… Blake Arnoldâ€”â€”æˆ‘ä½¿ç”¨äº† Blake ä»£ç ä¸­çš„é€»è¾‘æ¥è®¡ç®—é¢„æœŸæŸå¤±

æˆ‘è¿˜å‘ç°è¿ˆå…‹å°”Â·å¼—æ‹‰æ–¯ç§‘çš„ã€Šè´å¶æ–¯ A/B æµ‹è¯•çš„åŠ›é‡ã€‹éå¸¸æœ‰åŠ©äºç†è§£è´å¶æ–¯ A/B æµ‹è¯•æ–¹æ³•çš„æŠ€æœ¯å±‚é¢

æˆ‘è¿™ç¯‡æ–‡ç« çš„ä»£ç å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/ksureshkumar-loveshark/blogs_public/tree/main/Bayesian%20AB%20Testing/Conversions)æ‰¾åˆ°

æ„Ÿè°¢é˜…è¯»è¿™ç¯‡æ–‡ç« ï¼æˆ‘å¸Œæœ›å®ƒèƒ½å¸®åŠ©æ‚¨æ›´å¥½åœ°ç†è§£å¦‚ä½•å®ç°è½¬æ¢åº¦é‡çš„è´å¶æ–¯ AB æµ‹è¯•æ–¹æ³•ã€‚

*å¦‚æœä½ å–œæ¬¢é˜…è¯»æˆ‘çš„æ–‡ç« ï¼Œæ„¿æ„æ”¯æŒæˆ‘çš„å†™ä½œï¼Œå¹¶ä¸”æ­£åœ¨è€ƒè™‘è®¢é˜…ä¸€ä¸ªåª’ä½“ï¼Œè¯·éšæ—¶ä½¿ç”¨æˆ‘ä¸‹é¢çš„æ¨èé“¾æ¥ã€‚æˆ‘ä¼šä»ä½ çš„è®¢é˜…è´¹ä¸­ææˆã€‚*

[](https://medium.com/@kaushsk12/membership) [## é€šè¿‡æˆ‘çš„æ¨èé“¾æ¥åŠ å…¥ Medium

### é˜…è¯» Kaushik Sureshkumar(ä»¥åŠåª’ä½“ä¸Šæˆåƒä¸Šä¸‡çš„å…¶ä»–ä½œå®¶)çš„æ¯ä¸€ä¸ªæ•…äº‹ã€‚æ‚¨çš„ä¼šå‘˜è´¹ç›´æ¥â€¦

medium.com](https://medium.com/@kaushsk12/membership)