# 石头、剪刀、布和股票市场

> 原文：<https://towardsdatascience.com/rock-paper-scissors-and-the-stock-market-f1ad81785a76?source=collection_archive---------22----------------------->

## 讲述我在石头、剪子、布游戏中的经历，以及游戏结构与股票市场的相似之处。

![](img/45565e0e51a5a0c2dbbe9c6862bb1aa1.png)

法迪拉·n·伊玛尼在 [Unsplash](/s/photos/rock-paper-scissors?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄的照片

你通常不会把石头、剪刀、布(简称 RPS)和股票市场联系起来。这样做实际上似乎很荒谬。当然，一个 RPS 游戏，或者一系列的一千个 RPS 游戏和股票市场没有任何关系。

但是，当 RPS 被置于一种竞争形式中，各种算法为了排行榜上的分数而相互争斗时，[我的理论是，它与股票市场](https://www.kaggle.com/c/rock-paper-scissors/discussion/215477)有一些显著的相似之处。

更准确地说，Kaggle 最近在 RPS 上的比赛从 2020 年 11 月开始，到 2021 年 2 月结束，似乎具有我们通常的股票市场的一些特征，我个人通过使用投资组合优化理论来利用这种相似性，达到了第 32 位(前 2%)。

请注意，本文的大部分内容都是基于直觉；没有统计数据支持我的论点。但是，对于那些对市场效率、卡格尔竞争、投资组合优化理论等感兴趣的人来说，这篇文章应该是信息丰富的。

# 石头、布、剪刀背景下的数据科学

## Kaggle 的 RPS 比赛

四个月前，大概是 2020 年 11 月初，Kaggle 发起了 RPS 竞赛。下面是[比赛描述页面](https://www.kaggle.com/c/rock-paper-scissors/overview/description)的节选节选。

> 石头、剪子、布(有时称为 roshambo)一直是解决操场上的分歧或决定谁在公路旅行中坐在前排的主要手段…
> 
> 研究表明，石头、剪刀、布人工智能可以持续击败人类对手。以以前的游戏作为输入，它研究模式以了解玩家的倾向。但是，当我们将简单的“三局两胜”游戏扩展为“一千局三胜”游戏时，会发生什么呢？人工智能的表现能有多好？
> 
> 在这个模拟比赛中，你将创建一个人工智能在这个经典游戏的许多回合中与他人比赛…当比赛涉及非随机代理时，有可能大大胜过随机玩家。一个强大的人工智能可以持续击败可预测的人工智能…

如上所述，比赛中每个参与者的目标是提交一个与另一个机器人(由其他一些参与者提交)进行 1000 次连续 RPS 匹配的算法。如果一个算法赢了超过 20 分，它就赢得了那一集(= 1000 场比赛)，赢了奖励 1 分，平了奖励 0 分，输了奖励-1 分。对于一集的每一场胜利，该算法都会根据[比赛的评估标准](https://www.kaggle.com/c/rock-paper-scissors/overview/evaluation)获得 learderboard 积分。

乍一看，这似乎毫无意义。在 RPS 游戏中，直觉的理性举动是随机游戏，没有争论。如果我们要和任何机器人对战一集，我们一定要随机播放。

但竞赛的重点在于这部分描述:

> *当比赛涉及到非随机代理时，有可能远远胜过随机玩家。*

如果比赛中甚至有几十个非随机机器人，那么只要有足够数量的匹配，另一个可以利用这种非随机性的机器人将有更高的机会胜过所有其他随机机器人。这是因为高级非随机算法可能会与其他随机机器人打成平手，但会战胜低级非随机算法，在排行榜上获得随机机器人无法获得的额外分数。

因此，尽管纳什均衡表明，在假设所有其他机器人都理性行事的情况下，人们应该随机行事，但并非所有机器人都理性的事实使得非随机代理在排行榜上表现出色。

我们已经看到了与股票市场的相似之处。如果所有的市场参与者都在给定的信息下理性地行动，那么股票市场将是极其有效的。正是市场参与者存在的非理性导致了可利用的市场无效率以获取超额收益(尽管这部分在各种风险调整后仍有争议)。

## 以前的 RPS 比赛

信不信由你，在 Kaggle 之前已经有过几次 RPS 比赛了。最近的一个是 RPSC T4 在线考试网站。尽管每月获胜者没有奖品，但人们积极参与了竞赛，这导致了一些真正了不起的算法的诞生。

在 Kaggle 的讨论中，还有其他经常提到的算法，比如*格林伯格*和 *Iocaine 粉。*这些算法甚至在 2001 年及之前的 RPSContest 之前就已经在比赛中使用过。对这些算法最好的详细描述可以在[这里](http://webdocs.cs.ualberta.ca/~darse/rsbpc.html)找到，但简单地把逻辑放在上下文中，这些非常成功的算法利用了多层元策略的内存搜索算法，这些元策略决定是否做出击败过去历史预测移动的移动，或者击败移动的移动，或者击败移动的移动，击败移动的移动，等等。

将这些算法的强度放在上下文中， *Iocaine Powder* 和 *Greenberg* 可以轻松击败基于机器学习的算法，如决策树和多层感知器(前馈神经网络)。事实上，使用机器学习算法需要格外小心，以避免过度拟合，因为其他内存搜索算法和统计模型对对手策略的变化反应更快，这对于确保+20 分的胜利至关重要。

# 股票市场中的市场效率和数据科学

## 有效市场？

好了，现在我们已经讨论了 RPS 在传统数据科学社区中的位置，让我们来看看拥有一个[有效市场](https://www.investopedia.com/terms/m/marketefficiency.asp)意味着什么。

一个完全有效的市场会立即将所有相关信息纳入其市场价格。这意味着，由于市场价格已经反映了资产的真实价值，因此没有机会找到“低估”或“高估”的资产。根据这一定义，持续跑赢市场是不可能的——所有那些拥有长期优异表现记录的人只是幸运而已。

有不同程度的建议市场效率。疲软的形式表明，过去的价格变动在预测未来回报时是无关紧要的。换句话说，基于趋势的交易或基于价格变动的技术分析不足以持续跑赢市场。这是最近学术界对加密货币市场效率研究的焦点之一，阅读相关论文可能会很有趣。

半强式市场效率是指市场价格对所有公开信息做出快速反应。从这个角度来看，即使是基本面分析也被认为是过时的。以这种方式战胜市场的唯一方法将是获得非公开信息，这种信息危险地挂在非法内幕交易的线上。

强式认为，市场会立即反映所有信息，包括公开的和未公开的，这意味着跑赢市场几乎是不可能的。

然而，也有某些类别的股票似乎跑赢了市场。为了将这些异常纳入有效市场环境，我们可以利用 [Fama 的三因素模型](https://onlinelibrary.wiley.com/doi/full/10.1111/j.1540-6261.1992.tb04398.x)，该模型表明，当根据某些因素对各种风险进行调整时，看似优越的股票回报可以得到解释(Fama 后来扩展了该模型，纳入了另外两个因素，但这些因素本身就可以解释预期回报中的大多数异常)。

似乎除了学术界之外，人们普遍认为，虽然市场总体上是有效的，但它仍然表现出低效率，特别是在短时间内——因此 Lasse Heje Pedersen 关于对冲基金和积极投资的著名入门书采用了*有效无效率*作为书名。

## 那么数据科学在战胜市场中的地位如何呢？

作为这个领域的新生，我可能没有资格回答上面的问题，但无论如何我会试一试。

使用机器学习算法预测股市的棘手之处在于，它非常容易过度拟合。媒体上的证据几乎无处不在。“预测股市”的比较老的文章，有一半以上落入这个陷阱。最容易发现的是那些使用最近*价格*数据的 LSTMs 来预测下一个价格的，这只是一个时滞预测(基本上，每天的价格预测都是前一天的价格；有趣的是，这与*鞅属性*一致，但是你不需要 LSTMs 来利用这个属性。

诚然，顶级量化对冲基金可能正在使用 ML 算法，通过额外小心避免过度拟合来充分受益于战胜市场，但对于普通散户投资者来说，采取这种额外小心的成本可能超过了收益。事实是，一个简单的统计模型与足够的，真正的多样化显示出惊人的强劲表现。虽然使用额外的数据科学技术，如情绪分析、谷歌趋势分析和深度神经网络可以提供一点优势，但这种努力最好用于最小化市场摩擦，提供额外的多样化，降低服务器成本等。

当然，也有一些例外，比如最近吸引了很多注意力的韩国初创公司 [QRAFT](https://www.qraftec.com/) ，但即使在这里，你也应该注意到，这家初创公司最有价值的资产不仅是其基于深度强化学习的 ETF，还有 AXE(基于 ML 的订单执行系统)和麒麟 API(自动数据清理模块)。

总而言之，数据科学在活跃的投资世界中确实有一席之地，但尽管它对股票回报预测的影响尚不清楚，但它对交易的其他方面(如订单执行)的积极影响似乎非常明显。

# 非随机 RPS 竞争与无效率市场

## 打个比方

你现在可能想知道上面所有的信息是如何结合在一起形成 Kaggle 的 RPS 竞赛类似于股票市场的结论的。

好吧，让我们考虑一下市场效率的半强形式。这里的论点是，每当有一个被披露的事件改变了资产的价值，市场价格就立即反映了这一信息，这是由抓住机会获利的市场参与者推动的。

理解这一点的一种方法是，考虑如果保证市场效率成立，会发生什么。如果是这样的话，那么任何市场参与者都没有动力通过积极交易来承担损失交易成本的风险。最好的办法是通过投资被动型 ETF 来承担系统性风险。

然而，通常情况并非如此。投资者，无论是机构投资者还是个人投资者，都在假设存在某些低效率以供利用的情况下积极交易。如果存在任何低效率，那么这种积极的运动将这种低效率从市场中消除，因为投资者贪婪地从错误的定价中抓住机会，迅速将价格恢复到正确的价值。投资者从这种活动中获得的回报可以被认为是对市场重新注入效率的回报。

有趣的是，这种恢复效率的积极投资也是低效的根源。

现在让我们回到 Kaggle 的 RPS 比赛。在纳什均衡下，人们应该只提交随机的代理人，并希望获胜。然而，在这种情况下，我们知道一个事实，有非随机，非理性的代理人参与竞争。在这种新的信息下，最好的办法是引入类似的非随机(低效)代理，它们有望击败所有其他非随机代理。如果你成功地想出了这样的算法，那么你将把其他非随机代理的表现恢复到随机平均值(恢复效率)，并在排行榜中获得分数作为奖励。同时，因为你提交了一个非随机的代理，你也有给市场带来低效率的风险，除非出现另一个更好的 bot。

在 Kaggle 的 RPS 比赛中，过去像 *Iocaine 粉*和*格林伯格*这样的算法表现非常差。为什么？一个显而易见的原因是，几乎所有其他表现出色的代理都有这种算法的镜像版本，可以在 100%的时间里击败他们，另一个原因是，因为已经提交了如此多的这种过去成功但公开可用的算法的副本，可能会输给这种算法的机器人已经在排行榜上排名太低了。换句话说，*奥卡因粉*或*格林伯格*可以赖以生存的竞争中的所有低效都已经被集体解决了。

这与成功的交易策略在投资界广为人知的情况非常相似。在最初利用布莱克-斯科尔斯模型的期权定价时，像配对交易和反向策略这样的套利机会都非常有利可图，因为只有少数市场参与者使用它们。然而，到了 2000 年代的市场崩盘时，为了获得类似的回报水平，极端的杠杆变得至关重要。

我可能会因为在没有任何真实数据支持的情况下起草这些结论而遭到批评。毕竟，实际提取数据并得出具体结论是 Kaggle 和数据科学社区的精神。但是这里的类比确实带来了一个关于竞争本质的有趣观点。

## 作为整体方法论的投资组合优化

离比赛截止日期还有不到几周的时间，越来越明显的是，合奏可能是取得成功的途径。虽然[是一个简单的非集成代理](https://www.kaggle.com/c/rock-paper-scissors/discussion/210305)表现出了卓越的性能，但[大多数讨论](https://www.kaggle.com/c/rock-paper-scissors/discussion/201683)倾向于提出一种可靠的集成方法。

就我个人而言，由于我被竞争与股票市场的相似性所吸引，我迫切希望利用过去一年一直在努力学习的量化金融领域的知识。

我的想法的详细记录在[这里](https://www.kaggle.com/c/rock-paper-scissors/discussion/216358)有很好的证明，但是为了补充链接主题中所说的内容，让我具体解释一下我是如何设置问题的。

不管你是在每集的每一步做出确定性的选择还是随机的选择，事实是，当试图整合来自多个算法的信息时，你要为最终的决定权衡那些算法的决定。如果算法 A 对当前的对手产生了极好的结果，那么最有可能的是你应该坚持算法 A 推荐的走法；如果算法 A 推荐剪刀，你应该挑剪刀。在这种情况下，权重映射看起来像:{0 : 0.02，1 : 0.18，2 : 0.80}，其中 0，1，2 分别对应于石头，剪刀，布。由于 80%的重量集中在 2 上，全体成员下一步会选择剪刀。

因此，在某些方面，为算法选择用于当前步骤的权重类似于在重新平衡期间为不同资产选择投资组合权重。如果一个算法最近表现良好，你可能会给它更多的权重。然后，我们可以将这一集中的每一步视为重新平衡我们投资组合的自然时间步骤。

现在，大多数公开可用的 RPS 算法使用相同的核心逻辑；在竞赛线程中经常讨论的是，为了提高集合的性能，移除冗余代理是必不可少的。嗯，如果我们要激励与其他算法相关性低的算法，那么就没有必要手工挑选。

幸运的是，我们著名的[均值-方差投资组合优化理论](http://www.columbia.edu/~mh2078/FoundationsFE/MeanVariance-CAPM.pdf)给了我们这样做的方法。我不想太深入投资组合优化理论，因为有些模糊的领域我仍然不太确定，但重要的一点是，只要目标资产的预期回报是优秀的，最终的投资组合在风险调整后的回报方面也将是优秀的:投资组合很少会亏损。

令人遗憾的是，Kaggle 只允许最多 1 秒钟来决定下一步行动，所以我无法获得一个集合模型来检查有效边界，以找到最大夏普点。如果可能的话，我敢说我可能会在排行榜上名列前茅。

不过，等等。我怎么知道这个合奏方法在比赛中确实成功了？毕竟，由于 RPS 的性质，一个幸运的随机代理可以在排行榜上排名很高。我的辩护是，在比赛结束时，我在奖牌区有 8 个这样的组合整体代理，这种整体方法在本地测试中(和在排行榜中)证明比具有 beta 分布的多臂 bandit 更成功。

# 最后

一旦你登记了所有的事实，RPS 竞赛在某些方面类似于股票市场就不足为奇了。从长期来看，两者都可以被描述为完全随机的系统，但从短期来看，它们多少是可以预测的。

然而，RPS 竞赛真正向我展示的是，使用 LSTMs 这样的复杂方法来打击所有随机噪声通常是毫无意义的。事实是，在过去的分数趋势中，并不存在任何能提供未来有意义信息的如此强烈的信号。与其担心调整超参数，不如把更多的精力花在减少算法的执行时间上？)或者想出并添加更有效的算法(=添加多样化)。

还有，数学才是王道。我真的推荐看看[这个帖子](https://www.kaggle.com/c/rock-paper-scissors/discussion/210305)。它显示了一个简单的数学解决方案是多么有效。

*感谢 Kaggle 工作人员举办了这次有趣的比赛，非常感谢像 Stas Sl、Taaha Khan、SuperAnt、托尼·罗宾逊等人，他们为社区做出了如此多有意义的智力贡献。*

***来自《走向数据科学》编辑的提示:*** *虽然我们允许独立作者根据我们的* [*规则和指导方针*](/questions-96667b06af5) *发表文章，但我们并不认可每个作者的贡献。你不应该在没有寻求专业建议的情况下依赖一个作者的作品。详见我们的* [*读者术语*](/readers-terms-b5d780a700a4) *。*