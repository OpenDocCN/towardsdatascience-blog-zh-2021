# é›†æˆ Trino å’Œ Apache Ranger

> åŸæ–‡ï¼š<https://towardsdatascience.com/integrating-trino-and-apache-ranger-b808f6b96ad8?source=collection_archive---------6----------------------->

## äº†è§£å¦‚ä½•ä¸ºæ•°æ®å®‰å…¨é…ç½® Apache Ranger å’Œ Trinoã€‚

![](img/5b807cc7f82f2e8fb0f781e889e3ea74.png)

ç…§ç‰‡ç”±[é£:D](https://unsplash.com/@flyd2069?utm_source=medium&utm_medium=referral) ä¸Š[çš„ Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

![](img/40f8d121b0a039cee4639c6bb8a4c0dc.png)

å›¾ç‰‡ç”±ä½œè€…åˆ›ä½œï¼Œçµæ„Ÿæ¥è‡ªåˆ†åˆ«ä¸º Trino å’Œ Apache Software Foundation å•†æ ‡çš„å¾½æ ‡

# ç¬¬ä¸€éƒ¨åˆ†:æ¦‚å¿µå’Œæƒ³æ³•

## èƒŒæ™¯

éšç€å¯¹æ•°æ®éœ€æ±‚çš„æ—¥ç›Šå¢é•¿ï¼Œä¼ä¸šå¯¹æ•°æ®å®‰å…¨æ€§çš„è¦æ±‚ä¹Ÿåœ¨ä¸æ–­æé«˜ã€‚åœ¨ Hadoop ç”Ÿæ€ç³»ç»Ÿä¸­ï¼ŒApache Ranger æ˜¯ä¸€ä¸ªå¾ˆæœ‰å‰é€”çš„æ•°æ®å®‰å…¨æ¡†æ¶ï¼Œæ‹¥æœ‰å¤§é‡æ’ä»¶ï¼Œå¦‚ HDFSã€Solrã€Yarnã€Kafkaã€Hive ç­‰ã€‚ [Apache Ranger åœ¨ç‰ˆæœ¬ 2.1.0](https://cwiki.apache.org/confluence/display/RANGER/Apache+Ranger+2.1.0+-+Release+Notes) ä¸­ä¸º prestosql æ·»åŠ äº†ä¸€ä¸ªæ’ä»¶ï¼Œä½†æœ€è¿‘ [PrestoSQL è¢«æ›´åä¸º Trino](https://trino.io/blog/2020/12/27/announcing-trino.html) ï¼Œè¿™ç ´åäº† Apache Ranger çš„ PrestoSQL æ’ä»¶ã€‚

æˆ‘å·²ç»æäº¤äº†è¿™ä¸ªé—®é¢˜çš„è¡¥ä¸ï¼Œè¿™é‡Œå·²ç»æœ‰ä¸€ä¸ªå…¬å¼€çš„ JIRA é—®é¢˜[äº†](https://issues.apache.org/jira/browse/RANGER-3182)ä½†æ˜¯è¿™ä¸ä¼šé˜»æ­¢æˆ‘ä»¬å°† Trino ä¸ Apache Ranger é›†æˆã€‚å¯¹äºæœ¬æ•™ç¨‹ï¼Œæˆ‘å·²ç»ç”¨ Trino æ’ä»¶æ„å»ºäº† Apache Ranger 2.1.0ã€‚å¦‚æœä½ æƒ³ä»åŒ…æ‹¬ trino æ’ä»¶çš„æºä»£ç ä¸­æ„å»º Apache Rangerï¼Œä½ å¯ä»¥å‚è€ƒåˆ†æ”¯`ranger-2.1.0-trino`ä¸Šçš„[è¿™ä¸ª](https://github.com/aakashnand/ranger/tree/ranger-2.1.0-trino) GitHub åº“ï¼Œå‡ºäºæœ¬æ•™ç¨‹çš„ç›®çš„ï¼Œæˆ‘ä»¬å°†[è¿™ä¸ª](https://github.com/aakashnand/trino-ranger-demo) Github åº“ã€‚

> æ›´æ–°æ—¶é—´:2022 å¹´ 5 æœˆ 20 æ—¥
> 
> Trino æ’ä»¶ç°å·²åœ¨ ranger èµ„æºåº“ä¸­æ­£å¼å‘å¸ƒï¼Œå‘å¸ƒäº Apache Ranger-2.3[https://github.com/apache/ranger/tree/ranger-2.3](https://github.com/apache/ranger/tree/ranger-2.3)

## ç»„ä»¶å’Œå…³é”®æ€æƒ³ä»‹ç»

é˜¿å¸•å¥‡æ¸¸ä¾ æœ‰ä¸‰ä¸ªå…³é”®éƒ¨ä»¶`ranger-admin`ã€`ranger-usersync`å’Œ`ranger-audit`ã€‚è®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹è¿™äº›ç»„ä»¶ã€‚

*æ³¨æ„:* *é…ç½®* `*ranger-usersync*` *è¶…å‡ºäº†æœ¬æ•™ç¨‹çš„èŒƒå›´ï¼Œæˆ‘ä»¬ä¸ä¼šåœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨ä»»ä½•* `*usersync*` *ç»„ä»¶ã€‚*

## ç®¡ç†å‘˜ç®¡ç†

Ranger ç®¡ç†ç»„ä»¶æ˜¯ä¸€ä¸ª UI ç»„ä»¶ï¼Œä½¿ç”¨å®ƒæˆ‘ä»¬å¯ä»¥ä¸ºä¸åŒçš„è®¿é—®çº§åˆ«åˆ›å»ºç­–ç•¥ã€‚Ranger Admin éœ€è¦ä¸€ä¸ªåç«¯æ•°æ®åº“ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Postgres ä½œä¸º Ranger Admin UI çš„åç«¯æ•°æ®åº“ã€‚

## ç®¡ç†å‘˜å®¡è®¡

Ranger å®¡è®¡ç»„ä»¶æ”¶é›†å¹¶æ˜¾ç¤ºèµ„æºçš„æ¯ä¸ªè®¿é—®äº‹ä»¶çš„æ—¥å¿—ã€‚Ranger æ”¯æŒä¸¤ç§å®¡è®¡æ–¹å¼ï¼Œ`solr`å’Œ`elasticsearch`ã€‚æˆ‘ä»¬å°†ä½¿ç”¨`elasticsearch`æ¥å­˜å‚¨ ranger å®¡è®¡æ—¥å¿—ï¼Œè¿™äº›æ—¥å¿—ä¹Ÿå°†æ˜¾ç¤ºåœ¨ Ranger å®¡è®¡ UI ä¸­ã€‚

## ç‰¹é‡Œè¯º

Trino æ˜¯ä¸€ä¸ªå¿«é€Ÿåˆ†å¸ƒå¼æŸ¥è¯¢å¼•æ“ã€‚å¯ä»¥è¿æ¥å¤šä¸ªæ•°æ®æºï¼Œå¦‚`hive`ã€`postgres`ã€`oracle`ç­‰ã€‚ä½ å¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£[è¿™é‡Œ](https://trino.io/docs/current/)é˜…è¯»æ›´å¤šå…³äº Trino å’Œ Trino è¿æ¥å™¨çš„ä¿¡æ¯ã€‚å¯¹äºæœ¬æ•™ç¨‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨é»˜è®¤ç›®å½•`tpch`ï¼Œå®ƒå¸¦æœ‰è™šæ‹Ÿæ•°æ®ã€‚

## trino-Ranger-æ’ä»¶

é˜¿å¸•å¥‡æ¸¸ä¾ æ”¯æŒè®¸å¤šæ’ä»¶ï¼Œå¦‚ HDFSï¼Œèœ‚å·¢ï¼Œçº±çº¿ï¼Œç‰¹é‡Œè¯ºç­‰ã€‚æ¯ä¸ªæ’ä»¶éƒ½éœ€è¦åœ¨è¿è¡Œè¯¥è¿›ç¨‹çš„ä¸»æœºä¸Šè¿›è¡Œé…ç½®ã€‚Trino-Ranger-Plugin æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒå°†ä¸ Ranger Admin é€šä¿¡ï¼Œä»¥æ£€æŸ¥å’Œä¸‹è½½è®¿é—®ç­–ç•¥ï¼Œç„¶åè¿™äº›ç­–ç•¥å°†ä¸ Trino æœåŠ¡å™¨åŒæ­¥ã€‚ä¸‹è½½çš„ç­–ç•¥ä½œä¸º JSON æ–‡ä»¶å­˜å‚¨åœ¨ Trino æœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥åœ¨è·¯å¾„`/etc/ranger/<service-name>/policycache`ä¸‹æ‰¾åˆ°ï¼Œå› æ­¤åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç­–ç•¥è·¯å¾„æ˜¯`/etc/ranger/trino/policycache`

ä¸‹å›¾è§£é‡Šäº†ä¸Šè¿°ç»„ä»¶ä¹‹é—´çš„é€šä¿¡ã€‚

![](img/751144c6280029623389d0cb51b21436.png)

ä½œè€…å›¾ç‰‡

docker-compose æ–‡ä»¶è¿æ¥äº†ä¸Šè¿°æ‰€æœ‰ç»„ä»¶ã€‚

å…³äº`docker-compose.yml`çš„è¦ç‚¹

1.  æˆ‘ä»¬å·²ç»ä½¿ç”¨`named-docker-volumes` ex: `ranger-es-data`ï¼Œ`ranger-pg-data`æ¥æŒä¹…åŒ–è¯¸å¦‚ elasticsearch å’Œ postgres ç­‰æœåŠ¡çš„æ•°æ®ï¼Œå³ä½¿åœ¨å®¹å™¨é‡å¯ä¹‹å
2.  Ranger-Admin å’Œ Ranger-Trino æ’ä»¶çš„é¢„æ„å»º tar æ–‡ä»¶å¯ä½œä¸ºå‘å¸ƒèµ„äº§åœ¨è¿™ä¸ªæ¼”ç¤ºå­˜å‚¨åº“[è¿™é‡Œ](https://github.com/aakashnand/trino-ranger-demo/releases/tag/trino-ranger-demo-v1.0)è·å¾—ã€‚
3.  ranger-Admin [è¿›ç¨‹éœ€è¦è‡³å°‘ 1.5 GB çš„å†…å­˜](https://cwiki.apache.org/confluence/display/RANGER/Ranger+Installation+Guide#RangerInstallationGuide-Prerequisites)ã€‚Ranger-Admin tar æ–‡ä»¶åŒ…å«`install.properties`å’Œ`setup.sh`ã€‚`setup.sh`è„šæœ¬ä»`install.properties`è¯»å–é…ç½®ã€‚ä»¥ä¸‹è¡¥ä¸æ–‡ä»¶æè¿°äº†ä¸ Ranger-Admin ç»„ä»¶çš„é»˜è®¤ç‰ˆæœ¬`install.properties`ç›¸æ¯”ï¼Œå¯¹`install.properties`æ‰€åšçš„é…ç½®æ›´æ”¹ã€‚

4.Ranger-Trino-Plugin tar æ–‡ä»¶ä¹ŸåŒ…å«äº†`install.properties`å’Œ`enable-trino-plugin.sh`è„šæœ¬ã€‚å…³äº trino docker ç¯å¢ƒéœ€è¦æ³¨æ„çš„é‡è¦ä¸€ç‚¹æ˜¯ï¼Œé…ç½®æ–‡ä»¶å’Œæ’ä»¶ç›®å½•è¢«é…ç½®åˆ°ä¸åŒçš„ç›®å½•ä½ç½®ã€‚é…ç½®æ˜¯ä»`/etc/trino`è¯»å–çš„ï¼Œè€Œæ’ä»¶æ˜¯ä»`/usr/lib/trino/plugins`åŠ è½½çš„ã€‚è¿™ä¸¤ä¸ªç›®å½•åœ¨ä¸º Trino-Ranger-Plugin é…ç½®`install.properties`æ—¶éå¸¸é‡è¦ï¼Œå› æ­¤éœ€è¦å¯¹ Trino-Ranger-Plugin tar æ–‡ä»¶é™„å¸¦çš„é»˜è®¤è„šæœ¬`enable-trino-plugin.sh`è¿›è¡Œä¸€äº›é¢å¤–çš„å®šåˆ¶ï¼Œä»¥ä½¿å…¶èƒ½å¤Ÿä¸ dockerized Trino ä¸€èµ·å·¥ä½œã€‚è¿™äº›æ›´æ”¹åœ¨ä¸‹é¢çš„ä¿®è¡¥ç¨‹åºæ–‡ä»¶ä¸­çªå‡ºæ˜¾ç¤ºã€‚åŸºæœ¬ä¸Šï¼Œè¿™äº›å˜åŒ–å¼•å…¥äº†ä¸¤ä¸ªæ–°çš„è‡ªå®šä¹‰å˜é‡`INSTALL_ENV`å’Œ`COMPONENT_PLUGIN_DIR_NAME`ï¼Œå®ƒä»¬å¯ä»¥åœ¨`install.properties`ä¸­è¿›è¡Œé…ç½®

5.`install.properties`Trino Ranger æ’ä»¶çš„æ–‡ä»¶éœ€è¦æŒ‰ç…§ä»¥ä¸‹è¡¥ä¸æ–‡ä»¶æ‰€ç¤ºè¿›è¡Œé…ç½®ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªæ–°å¼•å…¥çš„è‡ªå®šä¹‰å˜é‡æ¥é€šçŸ¥`enable-plugin-script`Trino å·²ç»éƒ¨ç½²åœ¨ docker ç¯å¢ƒä¸­ã€‚

6.æœ€åï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå°†å®ƒä»¬æ”¾åœ¨`docker-compose.yml`ä¸­ã€‚è¿™ä¸ªæ–‡ä»¶ä¹Ÿå¯ä»¥åœ¨ Github åº“[è¿™é‡Œ](https://github.com/aakashnand/trino-ranger-demo/blob/main/docker-compose.yml)è·å¾—ã€‚

# ç¬¬äºŒéƒ¨åˆ†:è®¾ç½®å’Œåˆå§‹åŒ–

åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†éƒ¨ç½² docker-compose æœåŠ¡å¹¶ç¡®è®¤æ¯ä¸ªç»„ä»¶çš„çŠ¶æ€ã€‚

## æ­¥éª¤ 1:å…‹éš†å­˜å‚¨åº“

```
git clone [https://github.com/aakashnand/trino-ranger-demo.git](https://github.com/aakashnand/trino-ranger-demo.git)
```

## æ­¥éª¤ 2:éƒ¨ç½² docker-compose

```
$ cd trino-ranger-demo
$ docker-compose up -d
```

ä¸€æ—¦æˆ‘ä»¬ä½¿ç”¨ docker-compose éƒ¨ç½²æœåŠ¡ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°å››ä¸ªæ­£åœ¨è¿è¡Œçš„æœåŠ¡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡`docker-compose ps`æ¥è¯å®è¿™ä¸€ç‚¹

![](img/a4cf5a51b85bf1ac0d647b69977186cd.png)

## æ­¥éª¤ 3:ç¡®è®¤æœåŠ¡

è®©æˆ‘ä»¬ç¡®è®¤ Trino å’Œ Ranger-Admin æœåŠ¡åœ¨ä»¥ä¸‹ URL ä¸Šæ˜¯å¯è®¿é—®çš„

æ¸¸ä¾ ç®¡ç†å‘˜: [http://localhost:6080](http://localhost:6080)

å´”è¯º: [http://localhost:8080](http://localhost:8080)

elastic search:[http://localhost:9200](http://localhost:9200)

## æ­¥éª¤ 4:ä» Ranger-Admin åˆ›å»º Trino æœåŠ¡

è®©æˆ‘ä»¬è®¿é—® Ranger-Admin ç”¨æˆ·ç•Œé¢ï¼Œå¹¶ä½œä¸º`admin`ç”¨æˆ·ç™»å½•ã€‚æˆ‘ä»¬åœ¨ä¸Šé¢çš„`ranger-admin-install.properties`æ–‡ä»¶ä¸­é…ç½®äº†æˆ‘ä»¬çš„ç®¡ç†å‘˜ç”¨æˆ·å¯†ç `rangeradmin1`ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨ä¸‹é¢çš„æˆªå›¾ä¸­çœ‹åˆ°çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ²¡æœ‰`trino`æœåŠ¡ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º`trino`çš„æœåŠ¡ã€‚**æœåŠ¡ååº”è¯¥ä¸åœ¨** `**install.properties**` **ä¸­ä¸º Ranger-Admin** å®šä¹‰çš„åç§°ç›¸åŒ¹é…

![](img/2035578258a5b201a8ecc75efcacdf0f.png)

è¯·æ³¨æ„ JDBC å­—ç¬¦ä¸²ä¸­çš„ä¸»æœºåã€‚ä» `**ranger-admin**` **å®¹å™¨ trino å¯åˆ°è¾¾** `**my-localhost-trino**` **ï¼Œå› æ­¤ä¸»æœºåè¢«é…ç½®ä¸º** `**my-localhost-trino**`

![](img/2d4fa94812b8fb6d2e08e94d6d08bbc2.png)

å¦‚æœæˆ‘ä»¬ç‚¹å‡»æµ‹è¯•è¿æ¥ï¼Œæˆ‘ä»¬å°†å¾—åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„*è¿æ¥å¤±è´¥*é”™è¯¯ã€‚è¿™æ˜¯å› ä¸º Ranger-Admin è¿›ç¨‹å·²ç»åœ¨è¿è¡Œï¼Œå¹¶ä¸”ä»åœ¨å¯»æ‰¾æˆ‘ä»¬å°šæœªåˆ›å»ºçš„åä¸º`trino`çš„æœåŠ¡ã€‚ä¸€æ—¦æˆ‘ä»¬ç‚¹å‡»`Add`ï¼Œå®ƒå°†è¢«åˆ›å»ºã€‚

![](img/c3f2b4297a58dfc7cdf54c269b2247b1.png)

å› æ­¤ï¼Œè®©æˆ‘ä»¬æ·»åŠ `trino`æœåŠ¡ï¼Œç„¶åå†æ¬¡å•å‡»`Test Connection`

![](img/de6b88be3b39ddf7f4dfd62ad9a611ff.png)![](img/d90d43f7d11cb4bb935b4ec3acd6e884.png)

ç°åœ¨ Ranger-Admin æˆåŠŸè¿æ¥åˆ° TrinoğŸ‰

## æ­¥éª¤ 5:ç¡®è®¤ Ranger å®¡è®¡æ—¥å¿—

è¦æ£€æŸ¥å®¡è®¡æ—¥å¿—ï¼Œä»é¡¶éƒ¨å¯¼èˆªæ å¯¼èˆªè‡³å®¡è®¡ï¼Œå¹¶ç‚¹å‡»`Audit`ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ˜¾ç¤ºäº†å®¡è®¡æ—¥å¿—ğŸ‰ã€‚Ranger-Admin å’Œ Elasticsearch å·¥ä½œæ­£å¸¸ã€‚

![](img/bd202fbfc323eff55b4ac51c08c35e0a.png)

# ç¬¬ä¸‰éƒ¨åˆ†çœ‹åˆ°å®ƒåœ¨è¡ŒåŠ¨

ç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº†è®¾ç½®ï¼Œæ˜¯æ—¶å€™åˆ›å»ºå®é™…çš„è®¿é—®ç­–ç•¥å¹¶æŸ¥çœ‹å®ƒçš„è¿è¡Œæƒ…å†µäº†

*   å½“åˆ›å»º`trino`æœåŠ¡æ—¶ï¼Œæˆ‘ä»¬åœ¨è¿æ¥ä¿¡æ¯ä¸­ä½¿ç”¨`ranger-admin`ä½œä¸ºç”¨æˆ·åã€‚è¿™ä¼šä½¿ç”¨è¯¥ç”¨æˆ·ååˆ›å»ºé»˜è®¤ç­–ç•¥ï¼Œå› æ­¤`ranger-admin`ç”¨æˆ·å°†æ‹¥æœ‰è¶…çº§æƒé™

![](img/0b409ebcf00f9a77103d718dd678f0fb.png)![](img/1c8eac6494f2c2c88456de84013c9583.png)

ä¸ºäº†ç†è§£è®¿é—®åœºæ™¯å¹¶åˆ›å»ºè®¿é—®ç­–ç•¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç”¨æˆ·ã€‚Ranger usersync æœåŠ¡å°†å„ç§æ¥æº(å¦‚ Unixã€æ–‡ä»¶æˆ– AD/LDAP)çš„ç”¨æˆ·ã€ç»„å’Œç»„æˆå‘˜èº«ä»½åŒæ­¥åˆ° Ranger ä¸­ã€‚Ranger usersync æä¾›äº†ä¸€ç»„ä¸°å¯Œè€Œçµæ´»çš„é…ç½®å±æ€§ï¼Œç”¨äºåŒæ­¥æ¥è‡ª AD/LDAP çš„ç”¨æˆ·ã€ç»„å’Œç»„æˆå‘˜ï¼Œæ”¯æŒå¤šç§ä½¿ç”¨æƒ…å½¢ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä» Ranger-Admin UI æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç”¨æˆ·ã€‚

## æ­¥éª¤ 1:ä» Ranger-Admin åˆ›å»º`test-user`

è¦åˆ›å»ºç”¨æˆ·ï¼Œæˆ‘ä»¬å¯¼èˆªè‡³è®¾ç½®â†’ç”¨æˆ·/ç»„/è§’è‰²â†’æ·»åŠ æ–°ç”¨æˆ·

åˆ›å»ºç”¨æˆ·æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸åŒçš„è§’è‰²ã€‚

*   `user`è§’è‰²æ˜¯æ™®é€šç”¨æˆ·
*   `Admin`è§’è‰²å¯ä»¥ä» Ranger Admin UI åˆ›å»ºå’Œç®¡ç†ç­–ç•¥ã€‚
*   `Auditor`è§’è‰²æ˜¯`read-only`ç”¨æˆ·è§’è‰²ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè§’è‰²ä¸º`Admin`çš„ç”¨æˆ·ã€‚

![](img/93f1b3193449838c08f68f9ced450d5d.png)

## æ­¥éª¤ 2:ç¡®è®¤è¿›å…¥`test-user`å’Œ r `anger-admin`

è®©æˆ‘ä»¬ç¡®è®¤ç”¨æˆ·çš„è®¿é—®æƒé™`ranger-admin`

![](img/3d2b79e26f77a86e20633089efae2fac.png)

æ­£å¦‚æˆ‘ä»¬çœ‹åˆ°çš„`ranger-admin`ç”¨æˆ·å¯ä»¥è®¿é—®æ¨¡å¼`tpch.sf10`ä¸‹çš„æ‰€æœ‰è¡¨

ç”±äºæˆ‘ä»¬æ²¡æœ‰ä¸º`test-user`é…ç½®ä»»ä½•ç­–ç•¥ï¼Œå¦‚æœæˆ‘ä»¬è¯•å›¾è®¿é—®ä»»ä½•ç›®å½•æˆ–æ‰§è¡Œä»»ä½•æŸ¥è¯¢ï¼Œæˆ‘ä»¬åº”è¯¥ä¼šçœ‹åˆ°ä¸€æ¡*è®¿é—®è¢«æ‹’ç»*æ¶ˆæ¯ã€‚è®©æˆ‘ä»¬é€šè¿‡ä» [Trino CLI](https://trino.io/docs/current/installation/cli.html) æ‰§è¡ŒæŸ¥è¯¢æ¥ç¡®è®¤è¿™ä¸€ç‚¹

![](img/2ab1686b5ed166ffd6e85a026c6f9edf.png)

## æ­¥éª¤ 3:å…è®¸è®¿é—®æ¨¡å¼`tpch.sf10`ä¸‹çš„æ‰€æœ‰è¡¨`test-user`

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå…è®¸`test-user`è®¿é—®`tpch.sf10`åˆ°**æ‰€æœ‰**è¡¨çš„ç­–ç•¥ã€‚

![](img/e5f6ba274de6a6cedc29342a1d3e9df7.png)

æˆ‘ä»¬è¿˜å¯ä»¥ä¸ºæ¯ä¸ªç­–ç•¥åˆ†é…ç‰¹å®šçš„æƒé™ï¼Œä½†æ˜¯ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå…·æœ‰æ‰€æœ‰æƒé™çš„ç­–ç•¥ã€‚åˆ›å»ºæ­¤ç­–ç•¥åï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹æ´»åŠ¨ç­–ç•¥ã€‚

![](img/962be4fbee4c4595e11a1d259ea67f0c.png)

ç°åœ¨è®©æˆ‘ä»¬å†æ¬¡ç¡®è®¤è®¿é—®ã€‚

![](img/888619535aa1f7797067f9099952da46.png)

æˆ‘ä»¬ä»ç„¶æ”¶åˆ°*æ‹’ç»è®¿é—®*çš„æ¶ˆæ¯ã€‚è¿™æ˜¯å› ä¸ºéœ€è¦ä¸ºæ¯ä¸ªå¯¹è±¡çº§åˆ«é…ç½® Trino ranger ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œ`catalog`çº§ç­–ç•¥ï¼Œ`catalog+schema`çº§ç­–ç•¥ï¼Œ`catalog+schema+table` çº§ç­–ç•¥ï¼Œ `information_schema`çº§ç­–ç•¥ã€‚è®©æˆ‘ä»¬ä¸º`catalog`çº§åˆ«æ·»åŠ ç­–ç•¥ã€‚

![](img/e144ab48713827c2fcf295926cf04261.png)

è®©æˆ‘ä»¬ç”¨ Trino CLI å†æ¬¡ç¡®è®¤

![](img/c5385154470a6f01b5a987c508ca15e2.png)

æˆ‘ä»¬ä»ç„¶å¾—åˆ°é”™è¯¯ï¼Œä½†é”™è¯¯ä¿¡æ¯ä¸åŒã€‚è®©æˆ‘ä»¬è½¬åˆ° Ranger å®¡è®¡éƒ¨åˆ†ï¼Œäº†è§£æ›´å¤šç›¸å…³ä¿¡æ¯ã€‚

![](img/98660fb49271c3903513cac8f01e1c7f.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ‹’ç»å¯¹åä¸º`tpch.information_schema.tables.table_schema`çš„èµ„æºè¿›è¡Œè®¿é—®çš„æ¡ç›®ã€‚åœ¨ Trino ä¸­ï¼Œ`information_schema`æ˜¯åŒ…å«å…³äºè¡¨å’Œè¡¨åˆ—çš„å…ƒæ•°æ®çš„æ¨¡å¼ã€‚å› æ­¤ä¹Ÿæœ‰å¿…è¦ä¸º`information_schema`æ·»åŠ ç­–ç•¥ã€‚ä»»ä½•ç”¨æˆ·éƒ½éœ€è¦è®¿é—®`information_schema`æ‰èƒ½åœ¨ Trino ä¸­æ‰§è¡ŒæŸ¥è¯¢ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Ranger ç­–ç•¥ä¸­ä½¿ç”¨`{USER}`å˜é‡ï¼Œå°†è®¿é—®æƒé™æˆäºˆæ‰€æœ‰ç”¨æˆ·ã€‚

![](img/6cf11a40a8ff8a22dfbe57e8db02ef2c.png)

è®©æˆ‘ä»¬å†æ¬¡ä» Trino CLI ç¡®è®¤è®¿é—®ã€‚

![](img/4a67165df8a8b6e4f8a80b6d93f62ff0.png)

å¦‚æœæˆ‘ä»¬è¯•å›¾æ‰§è¡Œä»»ä½• SQL å‡½æ•°ï¼Œæˆ‘ä»¬ä»ç„¶ä¼šå¾—åˆ°æ‹’ç»è®¿é—®çš„æ¶ˆæ¯ã€‚åœ¨é»˜è®¤ç­–ç•¥éƒ¨åˆ†ï¼Œ`all-functions`ç­–ç•¥(ID:3)æ˜¯å…è®¸ access æ‰§è¡Œä»»ä½• SQL å‡½æ•°çš„ç­–ç•¥ã€‚å› ä¸ºæ‰§è¡Œ SQL å‡½æ•°æ˜¯æ‰€æœ‰ç”¨æˆ·çš„è¦æ±‚ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ç¼–è¾‘`all-functions`ç­–ç•¥(ID:3)å¹¶ä½¿ç”¨`{USER}`å˜é‡æ·»åŠ æ‰€æœ‰ç”¨æˆ·æ¥è®¿é—®å‡½æ•°

![](img/38cd3d3dbba8978230aca50009d5d75f.png)

æ€»è€Œè¨€ä¹‹ï¼Œä¸ºäº†è®¿é—®`sf10`ä¸‹çš„`test-user`åˆ°**æ‰€æœ‰**è¡¨ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸‰ä¸ªæ–°ç­–ç•¥ï¼Œå¹¶ç¼–è¾‘äº†é»˜è®¤çš„`all-function`ç­–ç•¥ã€‚

![](img/643afa4da445669ff47e26a12a55fc26.png)

ç°åœ¨æˆ‘ä»¬å¯ä»¥è®¿é—®å’Œæ‰§è¡Œé’ˆå¯¹`sf10`æ¨¡å¼çš„æ‰€æœ‰è¡¨çš„æŸ¥è¯¢ã€‚

![](img/17764c5971a69d068c5cdbd9cbefd2ca.png)

åœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œè®©æˆ‘ä»¬äº†è§£å¦‚ä½•ä¸ºæ¨¡å¼`sf10`ä¸‹çš„ç‰¹å®šè¡¨æä¾›å¯¹`test-user`çš„è®¿é—®

## æ­¥éª¤ 4:æˆäºˆå¯¹`sf10`æ¨¡å¼ä¸‹ç‰¹å®šè¡¨çš„è®¿é—®æƒ

åœ¨ä¸Šä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬é…ç½®äº†ç­–ç•¥æ¥è®¿é—®`sf10`æ¨¡å¼ä¸‹çš„**æ‰€æœ‰**è¡¨ï¼Œå› æ­¤ï¼Œ`schema-level`ç­–ç•¥æ˜¯ä¸å¿…è¦çš„ã€‚ä¸ºäº†è®¿é—®ç‰¹å®šçš„æ¨¡å¼ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ `schema-level`ç­–ç•¥ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥é…ç½®`table-level`ç­–ç•¥ã€‚æ‰€ä»¥è®©æˆ‘ä»¬ä¸º`tpch.sf10`å¢åŠ `schema-level`ä¸€é¡¹æ”¿ç­–

![](img/4b876d4e41a5f8aa14b21f798be365ae.png)

ç°åœ¨è®©æˆ‘ä»¬å°†`sf10-all-tables-policy`ä»æ‰€æœ‰è¡¨æ ¼ç¼–è¾‘åˆ°ç‰¹å®šè¡¨æ ¼ã€‚æˆ‘ä»¬å°†é…ç½®ä¸€ä¸ªç­–ç•¥ï¼Œåªå…è®¸è®¿é—®`nation`è¡¨

![](img/ec8d7e82cf3ab0a950022b6f844060c1.png)

æœ€åï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹ç§¯æçš„æ”¿ç­–

![](img/73133f03e55b46e3c9e89e22e3b6b16f.png)

ç°åœ¨è®©æˆ‘ä»¬å†æ¬¡ä» Trino CLI å¯¹`test-user`æ‰§è¡ŒæŸ¥è¯¢ã€‚

![](img/427ad11297f0644d54077c509683dd8b.png)

`test-user`ç°åœ¨å¯ä»¥æ ¹æ®éœ€è¦ä»`tpch.sf10`æ¨¡å¼ä¸­è®¿é—®å”¯ä¸€çš„`nation`è¡¨ã€‚

å¦‚æœä½ å·²ç»å®Œæˆäº†æ‰€æœ‰çš„æ­¥éª¤ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼ŒãŠ—ï¸ï¼Œç°åœ¨ä½ å·²ç»äº†è§£äº†å¦‚ä½•é…ç½® Trino å’Œ Apache Rangerã€‚

## ç¬¬ä¸‰éƒ¨åˆ†:å…³é”®è¦ç‚¹å’Œç»“è®º

*   ä» PrestoSQL æ›´åä¸º Trino åï¼ŒApache Ranger çš„ GitHub åº“ä¸­çš„é»˜è®¤æ’ä»¶å°†æ— æ³•ä¸æ–°çš„ Trino ä¸€èµ·å·¥ä½œï¼Œå› ä¸ºå®ƒä»ç„¶å¼•ç”¨æ—§çš„`io.prestosql`åŒ…ã€‚ä½ å¯ä»¥åœ¨ JIRA [è¿™é‡Œ](https://issues.apache.org/jira/browse/RANGER-3182)è¿½è¸ªè¿™ä¸ªé—®é¢˜
*   æ›´åçš„ Trino æ’ä»¶å°†ä¸ä¼šåœ¨æ–°çš„ Ranger ç‰ˆæœ¬ 2.2.0 ä¸­æä¾›ã€‚å› æ­¤ï¼Œä¸æ­¤åŒæ—¶ï¼Œè¯·éšæ„ä½¿ç”¨[è¿™ä¸ª](https://github.com/aakashnand/ranger/tree/ranger-2.1.0-trino) GitHub åº“ä»æºä»£ç æ„å»º Apache Rangerï¼Œä½¿ç”¨[è¿™ä¸ª](https://github.com/aakashnand/trino-ranger-demo) GitHub åº“å¼€å§‹ Trino-Ranger é›†æˆã€‚
*   ä¸º Trino é…ç½® Ranger ç­–ç•¥å¹¶ä¸é‚£ä¹ˆç›´è§‚ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªçº§åˆ«é…ç½®è®¿é—®ç­–ç•¥ã€‚åœ¨ Trino çš„çŸ¥è¯†åº“[è¿™é‡Œ](https://github.com/trinodb/trino/issues/1076)æœ‰ä¸€ä¸ªå…³äºè¿™ä¸ªçš„å…¬å¼€é—®é¢˜ã€‚
*   å°½ç®¡å¦‚æ­¤ï¼Œå»ºè®®é…ç½®ä¸€äº›åŸºæœ¬ç­–ç•¥ï¼Œå¦‚å¸¦æœ‰`{USER}`å˜é‡çš„`information_schema`å’Œ`all-functions`ï¼Œå› ä¸ºè¿™äº›ç­–ç•¥å¯¹äºä»»ä½•ç”¨æˆ·æ‰§è¡ŒæŸ¥è¯¢éƒ½æ˜¯å¿…éœ€çš„ã€‚

ç”±äºç¼ºä¹å¥½çš„æ–‡æ¡£å’Œé›†æˆè¿‡ç¨‹ä¸å¤ªç›´è§‚ï¼Œé›†æˆ Apache Ranger å’Œ Trino å¯èƒ½ä¼šå¾ˆç—›è‹¦ï¼Œä½†æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½è®©å®ƒå˜å¾—ç®€å•ä¸€ç‚¹ã€‚å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Trinoï¼Œæˆ‘å¼ºçƒˆæ¨èä½ åŠ å…¥ [Trino ç¤¾åŒº Slack](https://trino.io/slack.html) è¿›è¡Œæ›´è¯¦ç»†çš„è®¨è®ºã€‚æ„Ÿè°¢æ‚¨çš„é˜…è¯»ã€‚