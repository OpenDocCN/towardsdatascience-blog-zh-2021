# PyTorch 中训练时间序列预测模型

> 原文：<https://towardsdatascience.com/training-time-series-forecasting-models-in-pytorch-81ef9a66bd3a?source=collection_archive---------29----------------------->

## 从培训许多不同领域的数百个 PyTorch 时间序列预测模型中获得的经验和技巧

![](img/e56be93fe75ae3300320141bd7804676.png)

[来自 Unsplash 的照片](https://unsplash.com/photos/UhUGPClT2CA)

在过去的一年里，我使用[流量预测](https://github.com/AIStream-Peelout/flow-forecast)在各种数据集(河流流量、新冠肺炎、太阳能/风能和股票价格)上训练了数百个 PyTorch 时间序列预测模型。经常有新手来找我寻求他们应该首先做什么的信息。本文是一些基本技巧的简要分类，您可以在训练时间序列预测模型时使用这些技巧。

## 框出你的问题

我经常看到很多关于时间序列 ML 技术的不同术语。在这里，我将试图澄清它们:

*   **异常检测**:这是一种检测时间序列数据中异常值的通用技术。究竟什么是异常本身是一个争论的主题，然而异常通常形成数据集的很小一部分，并且与其他数据点有本质的不同。最后，异常检测可以被视为二元分类的特定极端形式，尽管它通常被视为一个独立的领域。大多数异常检测方法都是无人监管的，因为我们通常不太可能在异常发生之前识别出异常。更多信息见本文[。](https://arxiv.org/pdf/2004.00433.pdf)
*   **时间序列分类:**类似于其他形式的分类，这是我们取一个时间序列，并想把它分成许多类别的地方。与异常检测不同，我们通常对每一类都有一个更平衡的样本数量(尽管它可能仍然有 10%，80%，10%的偏差)。
*   **时间序列预测:**在预测中，我们通常希望预测时序数据序列中的下一个值或下(n)个值。这是本文将要关注的内容。
*   **时间序列预测:**我不喜欢使用这个术语，因为它含糊不清，可能意味着很多事情。虽然我发现大多数人在这种情况下通常用它来指预测或分类。
*   **时间序列分析:**一个可以包含以上所有内容的总称。然而，在我看来，我通常更多地将它与查看时间序列数据和比较不同的时间结构联系起来，而不是固有地设计预测模型。例如，如果您开发了一个时间序列预测模型，它可能会告诉您更多关于时间序列中的偶然因素，并支持更多的时间序列分析。

也就是说，在开始之前，你应该确定你的问题实际上是否是一个预测问题，因为这将指导你应该如何进行。有时，将预测问题转化为分类问题可能更好。例如，如果预测的确切数字不那么重要，您可以将其分成不同的范围，然后使用分类模型。此外，您应该对部署和最终产品有所了解。如果你的股票交易需要毫秒级的延迟，那么无论你的测试 MAE 是什么，一个有 20 个编码器层的巨大的 transformer 模型可能都不会起作用。

## 数据质量/预处理

*   **始终缩放或规范化数据:**在 99%的用例中，缩放或规范化数据可以提高性能。除非你的值很小，否则这是你应该采取的步骤。F [低预测内置了易于使用的定标器和规格化器](https://flow-forecast.atlassian.net/wiki/spaces/FF/pages/217317383/EDA+and+Data+Pre-Processing)。未能缩放您的数据通常会导致损失激增，尤其是在训练一些变压器时。
*   **仔细检查空值、编码不正确或缺失的值:**由于数据质量问题，我已经失去了很多时间和理智。有时缺失值以一种奇怪的方式编码。例如，一些气象站将缺失的 precip 值编码为-9999。这可能会导致很多问题，因为常规的 NA 检查不会发现这一点。流量预测确实提供了一个模块，用于插值缺失值和警告可能输入的数据不正确。
*   **从更少的功能开始:**一般来说，从更少的功能开始，然后根据性能增加更多的功能会更容易。例如，当我预测 COVID 时，我从移动数据+新案例开始。随着时间的推移，我熟悉了工作的一般超参数，我添加了天气数据。

## 模型选择和超参数选择

*   **可视化时间滞后以确定 forecast_history:** 在时间序列预测中，无论模型如何，我们都有希望传递到模型中的历史时间步长数。这将因架构而有所不同，因为一些模型能够更好地了解长期依赖关系。然而，找到一个初始范围是有用的。在某些情况下，真正的长期依赖可能根本没有用。
*   **从** [**达-RNN**](https://arxiv.org/abs/1704.02971) **:** 我发现达-RNN 模型创建了一个非常强大的时间序列基线。使用变压器可以超越它，但它们通常需要更多数据和更仔细的超参数调整。流量预测提供了一个[易于使用的 DA-RNN 实施方案。](https://colab.research.google.com/drive/1mbn777MigWa-Q6WbUnhZ0OxVTHcO7lee)
*   **确定要预测的长度:**这是一个棘手的超参数，用于确定要搜索的值。首先澄清这是你的模型一次预测的时间步数。您仍然可以生成更长的预测，但这是通过追加以前的预测来实现的。一方面，如果你的目标是预测一个长范围的时间步长，那么你可能希望将它们直接计入损失函数。另一方面，同时拥有两个以上的时间步长会使模型混乱。在我的大多数超参数扫描中，我发现较短的预测长度效果很好。
*   **从低学习率开始:**对于大多数时间序列预测模型，我建议选择低学习。
*   **Adam 并不总是最好的:**我发现其他优化程序可以做得更好。例如，BertAdam 适合变压器类型的模型，而 DA-RNN 香草可以工作得很好。

## 稳健性

*   **模拟运行不同场景的逐场分析**。流量预测可以很容易地模拟不同条件下的模型性能。例如，如果您正在预测河流流量，您可能会尝试输入非常大的降水量值，并观察模型如何响应。或者如果你在预测
*   **仔细检查热图和其他可解释性指标:**我看过几次模型，认为它们表现不错。然后，我检查了热图，发现模型没有使用预测中的重要功能。当我做进一步的测试时，很明显这个模型只是在学习记忆，而不是特征的实际偶然影响。

## 结论

时间序列预测是一个很难掌握的领域，尤其是使用 DL 模型。我希望这些提示对你如何提高性能有用。一如既往，随时留下问题和评论。