# Python ä¸­ç¬¬ä¸€åŸç†çš„é€»è¾‘å›å½’

> åŸæ–‡ï¼š<https://towardsdatascience.com/logistic-regression-from-first-principles-in-python-82f238effef1?source=collection_archive---------12----------------------->

## LR ä»æ— åˆ°æœ‰ï¼Œæ²¡æœ‰*â€œå¯ä»¥è¯æ˜â€¦â€¦â€*

ä»ä¸€ä¸ªæ•°æ®é›†å’Œä¸‰ä¸ªå‡è®¾å¼€å§‹ï¼Œæˆ‘ä»¬ç”¨ Python æ¨å¯¼å¹¶å®ç°äº†ä¸€ä¸ªåŸºæœ¬çš„é€»è¾‘å›å½’ã€‚ç›®æ ‡æ˜¯æ›´å¥½åœ°ç†è§£æ¨¡å‹çš„åŸºæœ¬å‡è®¾ã€‚

# å®šä¹‰é—®é¢˜

æˆ‘ä»¬ä½¿ç”¨æ¥è‡ª[ç»‡å¥³æ˜Ÿç”µå½±æ•°æ®é›†](https://github.com/vega/vega/blob/master/docs/data/movies.json)çš„æ•°æ®ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯é¢„æµ‹ä¸€éƒ¨ç”µå½±åœ¨çƒ‚ç•ªèŒ„æ˜¯å¦ä¼šè·å¾—æˆåŠŸã€‚åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œè¿™æœ‰ç‚¹å€’é€€ï¼Œå› ä¸ºä¸€éƒ¨ç”µå½±é€šå¸¸åœ¨ç›ˆåˆ©ä¹‹å‰å°±æœ‰è¯„è®ºã€‚å‡è®¾æˆ‘ä»¬åœ¨çƒ‚ç•ªèŒ„å·¥ä½œï¼Œå¹¶è¯•å›¾é¢„æµ‹å¦‚æœæˆ‘ä»¬ç”¨å·²çŸ¥ç¥¨æˆ¿è¡¨ç°ä½†æ²¡æœ‰è¯„è®ºçš„è€ç”µå½±å›å¡«ç½‘ç«™ä¼šå‘ç”Ÿä»€ä¹ˆã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬ç”¨

```
pip install altair vega_datasets
```

çƒ‚ç•ªèŒ„ç½‘ç«™å¯¹ä»–ä»¬çš„[è®¤è¯æ–°é²œè¯„åˆ†](https://www.rottentomatoes.com/about#whatiscertifiedfresh)ä½¿ç”¨è¶…è¿‡ 75 çš„åˆ†æ•°ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åšæŒè¿™ä¸ªæ•°å­—æ¥è¡¡é‡æˆ‘ä»¬æ‰€è°“çš„â€œå¥½â€ç”µå½±ï¼Œæˆ–`good_rt`ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬åªä¿ç•™â€œGâ€çº§ç”µå½±ã€‚

```
import pandas as pd                                                             
from vega_datasets import data                                                  

# Pull and prune the dataset to movies of interest.                                      
movies_g_df = (                                                                 
    data.movies()                                                               
    .query('MPAA_Rating == "G"')                                                
    .dropna(subset=["Rotten_Tomatoes_Rating"])                                  
)                                                                               

# Calculate net profits and Rotten Tomatoes' "Goodness" cutoff.                 
movies_df = movies_g_df.assign(                                                 
    net=movies_g_df.eval(                                                       
        "Worldwide_Gross-Production_Budget"                                     
    ),                                                                          
    good_rt=(                                                                   
        movies_g_df["Rotten_Tomatoes_Rating"] >= 75                             
    ).astype(int),                                                              
)
```

æ•°æ®å¸§ç°åœ¨çœ‹èµ·æ¥åƒè¿™æ ·:

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•—
â•‘                Title                 â•‘     net     â•‘ good_rt â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•£
â•‘ Cats Don't Dance                     â•‘ -28411398.0 â•‘       0 â•‘
â•‘ 102 Dalmatians                       â•‘ -18058441.0 â•‘       0 â•‘
â•‘ Babe: Pig in the City                â•‘ -10868140.0 â•‘       0 â•‘
â•‘ Muppets From Space                   â•‘  -7695214.0 â•‘       0 â•‘
â•‘ The Adventures of Elmo in Grouchland â•‘  -5365542.0 â•‘       1 â•‘
â•‘ ...                                  â•‘         ... â•‘     ... â•‘
â•‘ "Monsters Inc."                      â•‘ 411864330.0 â•‘       1 â•‘
â•‘ Ratatouille                          â•‘ 470495432.0 â•‘       1 â•‘
â•‘ The Lion King                        â•‘ 704539505.0 â•‘       1 â•‘
â•‘ Finding Nemo                         â•‘ 773894287.0 â•‘       1 â•‘
â•‘ Toy Story 3                          â•‘ 846340665.0 â•‘       1 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•
```

æˆ‘ä»¬ä½¿ç”¨[ç‰›éƒæ˜Ÿ](https://altair-viz.github.io/getting_started/installation.html)ç»˜åˆ¶å¹¶æ£€æŸ¥æ•°æ®ã€‚

```
import altair as alt
alt.Chart(movies_df).mark_point().encode(                                       
    x=alt.X("net"),                                                             
    y=alt.Y("good_rt:N", sort="descending"),                                    
    color="good_rt:N",                                                          
    tooltip=[                                                                   
        "Title",                                                                
        "Release_Date",                                                         
        "net",                                                                  
        "Rotten_Tomatoes_Rating",                                               
    ],                                                                          
).save("/tmp/movies.html")
```

![](img/928f3ee284ea6d7536788e395f8d891e.png)

å­˜å‚¨åœ¨â€œ/tmp/movies.htmlâ€ä¸­çš„å¯è§†åŒ–å¿«ç…§ã€‚

åˆ©æ¶¦è¾ƒä½çš„ç”µå½±ä¼¼ä¹ä¸å¤ªå¯èƒ½æ˜¯å¥½ç”µå½±ã€‚**ç°åœ¨çš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥æ”¶åˆ©æ¶¦å¹¶è¿”å›ä¸€ä¸ªå¥½çš„æ¦‚ç‡ã€‚å¦‚æœå¯¹äºæŸäº›ç”µå½±æ¦‚ç‡è¶…è¿‡ 50%,æˆ‘ä»¬è¯´è¯¥å‡½æ•°é¢„æµ‹ç”µå½±æ˜¯â€œå¥½çš„â€ã€‚**

è§‚å¯Ÿä¸Šå›¾ï¼Œæˆ‘ä»¬åº”è¯¥æœŸæœ›æˆ‘ä»¬çš„å‡½æ•°å…·æœ‰ä»¥ä¸‹ç‰¹å¾:

*   å¯¹äºè´Ÿåˆ©æ¶¦ï¼Œè¯¥å‡½æ•°åº”è¿”å›ä¸€ä¸ªå°äº 50%çš„æ•°å­—ã€‚
*   å¯¹äºéå¸¸é«˜çš„åˆ©æ¶¦ï¼Œè¯¥å‡½æ•°åº”è¯¥è¿”å›è¶…è¿‡ 50%çš„æ•°å­—ã€‚
*   å¯¹äºè¾ƒä½çš„(æ­£)åˆ©æ¶¦ï¼Œè¯¥å‡½æ•°åº”è¯¥è¿”å›å¤§çº¦ 50%ã€‚

ä¸ºäº†æ”¹è¿›è¿™äº›çŒœæµ‹ï¼Œæˆ‘ä»¬æƒ³åˆ©ç”¨ç°æœ‰çš„æ•°æ®æ‰¾åˆ°ä¸€ä¸ªæœ€ä½³çš„â€œåˆ©æ¶¦â€æˆªæ­¢ç‚¹ã€‚

# å¼€å§‹é¢„æµ‹

æœ€ç®€å•çš„å¼€å§‹æ–¹æ³•æ˜¯ä¸€ä¸ªçº¿æ€§å‡½æ•°ï¼Œå®ƒé€šè¿‡å°†åˆ©æ¶¦ *x* ä¹˜ä»¥ä¸€ä¸ªå¸¸æ•°æƒé‡ *m* å¹¶åŠ ä¸Šä¸€ä¸ªå¸¸æ•° *b* æ¥åˆ›å»ºæ¦‚ç‡ã€‚

![](img/0e400e893f0773c943f6eb494894454d.png)

æˆ‘ä»¬å¯ä»¥é€‰æ‹© m å’Œ T21 æ¥å¾—åˆ° 0 åˆ° 10 äº¿ç¾å…ƒå‡€åˆ©æ¶¦çš„åˆç†ç­”æ¡ˆã€‚ç„¶è€Œï¼Œè¿™ä¸€ç‚¹è¢«æ‰“ç ´äº†ï¼Œå› ä¸ºç¾å…ƒæ˜¯æ— ç•Œçš„ã€‚ä¸€éƒ¨è¶³å¤ŸæˆåŠŸçš„ç”µå½±ä¼šæŠŠæ¦‚ç‡*m***x*+*b*æ¨åˆ° 1 ä»¥ä¸Šã€‚

# å‡è®¾ 1:åœ¨å¤„ç†å¤§äº 1 çš„æ•°å­—æ—¶ï¼Œâ€œ*èµ”ç‡â€*ä¼˜äº*æ¦‚ç‡*

æŸäº‹å‘ç”Ÿä¸æœªå‘ç”Ÿçš„æ¯”ç‡è¢«ç§°ä¸º*èµ”ç‡*ï¼Œè¿™æ˜¯ä»»ä½•èµ›é©¬åœºæˆ–ä½“è‚²åšå½©åœºçš„è‡ªç„¶æœ¯è¯­ã€‚å¦‚æœä¸€æšç¡¬å¸æ­£é¢ç€åœ°çš„å¯èƒ½æ€§æ˜¯åé¢çš„ä¸¤å€ï¼Œæˆ‘ä»¬è¯´*å‡ ç‡æ˜¯ 2 æ¯” 1* ã€‚è¯´ä¸€åŒ¹é©¬åœ¨æ¯”èµ›ä¸­çš„èµ”ç‡æ˜¯ 9 æ¯” 2 æ›´å®¹æ˜“ï¼Œè€Œä¸æ˜¯è¯´è¿™åŒ¹é©¬æœ‰ 81.818%çš„æ¦‚ç‡è¾“æ‰æ¯”èµ›ã€‚

ç”±äºç”µå½±çš„å‡€åˆ©æ¶¦å¯èƒ½æ˜¯ä»»æ„é«˜çš„ï¼Œå°±åƒæ‰“èµŒçš„èµ”ç‡ä¸€æ ·ï¼Œæˆ‘ä»¬å‡è®¾å°†åˆ©æ¶¦ä¸è‰¯å¥½çš„çƒ‚ç•ªèŒ„è¯„åˆ†çš„èµ”ç‡è”ç³»èµ·æ¥æ˜¯åˆé€‚çš„ã€‚

![](img/4f618e370b9c779dcb2089428c1bc030.png)

å‡è®¾ 1ï¼Œæˆ‘ä»¬åº”è¯¥æŠŠä¸€éƒ¨ç”µå½±çš„â€œå¥½â€å‡ ç‡å’Œå®ƒçš„ç›ˆåˆ©èƒ½åŠ› x è”ç³»èµ·æ¥ã€‚

è¿™æ ·ï¼Œä»»ä½•ä»»æ„é«˜çš„åˆ©æ¶¦ï¼Œ *x* ï¼Œéƒ½å¯ä»¥åŒ¹é…åˆ°ç›¸åº”çš„æ¥è¿‘ 1 çš„æ¦‚ç‡ã€‚ä¸º`probability`æ’å…¥ 0.99999ï¼Œçœ‹çœ‹ä¸ºä»€ä¹ˆã€‚

è¿˜æœ‰ç¬¬äºŒä¸ªé—®é¢˜ã€‚å¦‚æœä¸€éƒ¨ç”µå½±çš„æ‹æ‘„æˆæœ¬é«˜äºç¥¨æˆ¿æ”¶å…¥ï¼Œé‚£ä¹ˆè¿™éƒ¨ç”µå½±çš„å‡€åˆ©æ¶¦å¯èƒ½æ˜¯è´Ÿæ•°ã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥ç¡®ä¿ç­‰å¼çš„å³è¾¹æ€»æ˜¯æ­£çš„ï¼Œä¸ç®¡è´Ÿçš„ x æ˜¯å¤šå°‘ã€‚

# å‡è®¾ 2:å¯¹ä¸€åˆ—æœ‰åºæ•°å­—æ±‚å¹‚æ˜¯ä½¿å®ƒä»¬éƒ½ä¸ºæ­£è€Œä¸å¤±å»é¡ºåºçš„æœ€ç®€å•çš„æ–¹æ³•ã€‚

åœ¨ä¿æŒæ’åºçš„åŒæ—¶ï¼Œå°è¯•ä½¿æ’åºåˆ—è¡¨ä¸­çš„æ¯ä¸ªæ•°å­—éƒ½ä¸ºæ­£æ•°:

```
[-12, -2, 1, 2, 99]
```

ä½¿æ•°å­—ä¸ºæ­£çš„ä¸€ç§æ–¹æ³•æ˜¯å–æ¯ä¸€é¡¹çš„ç»å¯¹å€¼:

```
[12, 2, 1, 2, 99]   sorted -->   [1, 2, 2, 12, 99]
```

é—®é¢˜æ˜¯é¡ºåºå˜äº†ã€‚è¯´è¿™äº›æ•°å­—ä»£è¡¨ç”µå½±åˆ©æ¶¦ä»¥ç™¾ä¸‡è®¡ã€‚èµšäº† 2M ç¾å…ƒåˆ©æ¶¦çš„ç”µå½±å’Œèµ”äº† 2M ç¾å…ƒçš„ç”µå½±å½¼æ­¤æ¥è¿‘ï¼Œéš¾ä»¥åŒºåˆ†ï¼Œè¿™è‚¯å®šæ˜¯ä¸€ä¸ªä¸ç†æƒ³çš„ç»“æœï¼

å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œæ‹¿ *e^x* æ¯éƒ¨ç”µå½±çš„åˆ©æ¶¦ *xï¼Œ*ç»™äºˆ

```
[6e-6, 0.14, 2.7, 7.4, 9.9e42]
```

è¿™äº”éƒ¨ç”µå½±ä»ç„¶æ˜¯åŒæ ·çš„é¡ºåºï¼Œä½†æˆ‘ä»¬å·²ç»æˆåŠŸåœ°ä½¿æ‰€æœ‰çš„ä»·å€¼è§‚æ˜¯ç§¯æçš„ã€‚

åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä½ å¯èƒ½ä¼šé—®*ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ä»»ä½•å…¶ä»–å‡½æ•°ï¼Œæ¯”å¦‚* `*1+tanh(x)*` *ï¼Œå–è´Ÿæ•°ä¸ºæ­£æ•°å‘¢ï¼Ÿé‚£å¤ªå¥½äº†ï¼æˆ‘ä»¬æ­£è¯•å›¾ç”¨æœ€ç®€å•çš„æ–¹æ³•è§£å†³ç”µå½±ç›ˆåˆ©ç‡çš„æ¦‚ç‡é—®é¢˜ï¼Œå¹¶ä¸”å¿…é¡»ä»¥æŸç§æ–¹å¼ä½¿è¿™äº›æ•°å­—ä¸ºæ­£ã€‚å¦‚æœæˆ‘ä»¬å‡è®¾`e^x`æ˜¯æœ€ä½³é€‰æ‹©ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ¨å¯¼é€»è¾‘å›å½’ã€‚å¦ä¸€ä¸ªå‡è®¾å¯èƒ½å¯¼è‡´ä¸€ä¸ªæœ‰æ•ˆä½†ä¸åŒçš„ç»“æœã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæŒ‡æ•°è¿ç®—æ˜¯é€»è¾‘å›å½’çš„ä¸€ä¸ªå‡è®¾ã€‚*

æˆ‘ä»¬çš„åˆ©æ¶¦å’Œæ¦‚ç‡ä¹‹é—´çš„å…³ç³»ç°åœ¨çœ‹èµ·æ¥åƒ:

![](img/c25dd39443fc01087659db5e41ca5006.png)

æœ€åï¼Œæˆ‘ä»¬å‡†å¤‡åšæ•°å­¦æ¥åˆ›å»ºå‡½æ•°ï¼Œè·å–å‡€åˆ©æ¶¦å¹¶è¿”å›æ¦‚ç‡ï¼

![](img/12e36310fb5309e7a5f92f3187def044.png)

åœ¨ Python ä¸­:

```
from math import e
def prob(x):
    m = ?
    b = ?
    return 1/(1 + e**(-m*x-b))
```

åŠŸèƒ½å®Œæˆäº†ï¼æˆ‘ä»¬åˆ°ç°åœ¨è¿˜æ²¡æœ‰è¿™ä¹ˆè¯´ï¼Œä½†æ˜¯æˆ‘ä»¬åªç”¨äº†ä¸¤ä¸ªå‡è®¾å°±æ¨å¯¼å‡ºäº†é€»è¾‘å›å½’ï¼å‰©ä¸‹å”¯ä¸€è¦åšçš„å°±æ˜¯è¾“å…¥ *m* å’Œ *b* çš„æœ€ä½³å€¼ï¼Œè¿™è¢«ç§°ä¸ºâ€œæ‹Ÿåˆâ€å‡½æ•°ã€‚ä½†æ˜¯ç­‰ç­‰â€¦m*m*å’Œ b*b*çš„æœ€ä½³å€¼æ˜¯å¤šå°‘ï¼ŸåŸæ¥è¿™æ˜¯ä¸€ä¸ªå¦‚æ­¤é‡è¦çš„é—®é¢˜ï¼Œæˆ‘ä»¬ç»§ç»­å›ç­”å®ƒä½œä¸ºæ¨å¯¼çš„å»¶ç»­ã€‚

# æ’å…¥æ•°æ®ä»¥æ‰¾åˆ°æœ€ä½³å€¼

ä¸ºäº†æ‰¾åˆ°é€»è¾‘å›å½’çš„æœ€ä½³å€¼ï¼Œæˆ‘ä»¬ä»éšæœºå€¼å¼€å§‹ï¼Œçœ‹çœ‹è°ƒæ•´ *m* å’Œ *b* æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ä½†é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡è€ƒè™‘æ­£ç¡®çŒœæµ‹ç”µå½±å–„è‰¯æ„å‘³ç€ä»€ä¹ˆæ¥å®šä¹‰â€œå‘ç”Ÿäº†ä»€ä¹ˆâ€ã€‚

å½“å…·æœ‰é«˜çƒ‚ç•ªèŒ„åˆ†æ•°çš„ç”µå½± 1 è¢«æˆ‘ä»¬çš„å‡½æ•°è¯„ä¼°æ—¶ï¼Œé¢„æµ‹æ­£ç¡®çš„æ¦‚ç‡æ˜¯ T0ã€‚è¯„ä»·ç»­é›†*ç”µå½± 2* æ—¶ï¼Œçƒ‚ç•ªèŒ„è¯„åˆ†ä½ï¼Œæ¦‚ç‡ä¸º`1-prob(x2)`ã€‚æ­£ç¡®é¢„æµ‹ä¸¤è€…çš„æ¦‚ç‡æ˜¯`prob(x1)*(1-prob(x2))`ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œå‡ ä¸ªé¢„æµ‹æ­£ç¡®çš„æ¦‚ç‡æ˜¯æ¯ä¸ªé¢„æµ‹çš„æ¦‚ç‡çš„ä¹˜ç§¯ã€‚ä¾‹å¦‚ï¼Œä»æ•°æ®ä¸­é€‰å–ä¸¤éƒ¨ç”µå½±:

1.  ã€Šè‰¾å°”è«åœ¨æ ¼é²å¸Œå…°çš„å†’é™©ã€‹æŸå¤±äº† 500 ä¸‡ç¾å…ƒï¼Œä½†çƒ‚ç•ªèŒ„æ”¶è§†ç‡å¾ˆé«˜ã€‚
2.  *æ¥è‡ªå¤ªç©ºçš„å¸ƒå¶*ï¼ŒæŸå¤± 700 ä¸‡ç¾å…ƒï¼Œçƒ‚ç•ªèŒ„è¯„åˆ†ä½ã€‚

å¯¹ *m* å’Œ *b* ä½¿ç”¨ä»»æ„å€¼ï¼Œæ­£ç¡®é¢„æµ‹è¿™ä¸¤éƒ¨ç”µå½±çš„æ¦‚ç‡ä¸º:

```
from math import e
def prob(x):
    m = 1e-6
    b = 1
    return 1/(1+e**(-m*x-b))# "The Adventures of Elmo in Grouchland" and "Muppets From Space".
prob(-5_365_542)*(1-prob(-7_695_214))0.012532803995131545
```

1.2%çš„ç»¼åˆæ¦‚ç‡ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è°ƒæ•´ m æ˜¯å¦èƒ½æ”¹å–„è¿™ç§æƒ…å†µ:

```
from math import e
def prob(x):
    m = 1e-7  # <-- tweaked
    b = 1
    return 1/(1+e**(-m*x-b))# "The Adventures of Elmo in Grouchland" and "Muppets From Space".
prob(-5_365_542)*(1-prob(-7_695_214))0.271702643394042
```

27%!æˆ‘ä»¬é¢„æµ‹å¾—æ›´å¥½ï¼è®©æˆ‘ä»¬å†åšä¸€æ¬¡ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ:

```
from math import e
def prob(x):
    m = 1e-8  # <-- tweaked again
    b = 1
    return 1/(1+e**(-m*x-b))# "The Adventures of Elmo in Grouchland" and "Muppets From Space".
prob(-5_365_542)*(1-prob(-7_695_214))0.2048307326133298
```

å—¯ï¼Œé™åˆ° 20%ã€‚ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥æ¢æˆç§»åŠ¨ bï¼Ÿ

```
from math import e
def prob(x):
    m = 1e-7
    b = 0.5
    return 1/(1+e**(-m*x-b))# "The Adventures of Elmo in Grouchland" and "Muppets From Space".
prob(-5_365_542)*(1-prob(-7_695_214))0.2783069465719312
```

ç•¥æœ‰æ”¹å–„ï¼Œä½†å¦‚æœæˆ‘ä»¬â€¦ä½ æ˜ç™½äº†ã€‚æˆ‘ä»¬å¯ä»¥ç»§ç»­å‘ä»»ä¸€æ–¹å‘è½»æ¨ *m* å’Œ *b* ï¼Œç›´åˆ°æ¯ä¸€ä¸ªå˜åŒ–éƒ½ä½¿æ¦‚ç‡é™ä½ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬è¾¾åˆ°äº†æœ€ä¼˜å€¼ã€‚è¿™å¾ˆä¹å‘³ï¼Œè€Œä¸”éšç€æ•°æ®ä¸­ç”µå½±çš„å¢å¤šï¼Œè¿™å°†å˜å¾—æ›´åŠ å›°éš¾ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªä»¥ä¸Šçš„å‚æ•°ï¼Œæ¯”å¦‚è€ƒè™‘ä¸€ä¸ªé¢å¤–çš„ç”µå½±ç‰¹æ€§ï¼Œæˆ‘ä»¬å°±å¿…é¡»è¿™æ ·è°ƒæ•´æ‰€æœ‰çš„å‚æ•°ã€‚

ç›¸åï¼Œè®©æˆ‘ä»¬ç”¨æ‰€æœ‰çš„æ•°æ®åˆ›å»ºä¸€ä¸ªå·¨å¤§çš„æ¦‚ç‡ï¼Œç„¶åæ‰¾åˆ°ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•æ¥ä¼˜åŒ–å®ƒã€‚ä¸ºæ­¤ï¼Œé¦–å…ˆå°†ä½å’Œé«˜çƒ‚ç•ªèŒ„ç»“æœç»„åˆæˆä¸€ä¸ªæ¦‚ç‡é™ˆè¿°:

![](img/1b2c68ededae3d025c5d8c2ae55bfb9d.png)

æœ€ä¸Šé¢çš„ç­‰å¼è¢«å®šä¹‰ä¸ºé«˜åˆ†çƒ‚ç•ªèŒ„ç”µå½±çš„æ¦‚ç‡ã€‚å¯¹äºå¾—åˆ†ä½çš„çƒ‚ç•ªèŒ„ç”µå½±ï¼Œæˆ‘ä»¬ä» 1 ä¸­å‡å»æ¦‚ç‡(ç¬¬äºŒä¸ªç­‰å¼)ã€‚å®šä¹‰å˜é‡â€œrt â€,å¯¹äºé«˜åˆ†ç”µå½±ä¸º 1ï¼Œå¯¹äºä½åˆ†ç”µå½±ä¸º 0ï¼Œå¯ä»¥ç»„åˆæ¦‚ç‡(ç¬¬ä¸‰ä¸ªç­‰å¼)ã€‚

è¦äº†è§£ä¸Šé¢ç¬¬ä¸‰ä¸ªç­‰å¼çš„å·¥ä½œåŸç†ï¼Œè¯·æ³¨æ„å½“ *rt* =1 æ—¶ï¼Œæ­£ç¡®çš„é¡¹æ¶ˆå¤±äº†ã€‚å½“ *rt* = 0 æ—¶ï¼Œå·¦è¾¹çš„é¡¹æ¶ˆå¤±ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥åŒæ—¶è®¡ç®—å¥½ç”µå½±å’Œåç”µå½±çš„æ¦‚ç‡ã€‚æ³¨æ„æˆ‘ä»¬ä»ç„¶å¯¹ m å’Œ b ä½¿ç”¨ä»»æ„é€‰æ‹©çš„å€¼ã€‚

```
from math import e
def prob(x):
    m = 1e-9
    b = 1e-2
    return 1/(1+e**(-m*x-b))probability = 1
for net, rt in movies_df[['net','good_rt']].to_records(index=False):
    probability *= (prob(net))**rt * (1-prob(net))**(1-rt)

print(probability)1.9707049911814526e-17
```

æˆ‘ä»¬æœ‰å¯èƒ½ä¸€èµ·çŒœæµ‹æ‰€æœ‰çš„æ•°æ®ç‚¹ã€‚ç°åœ¨æ˜¯æ—¶å€™ç”¨æ¯”æ‰‹åŠ¨è°ƒæ•´æ›´èªæ˜çš„æ–¹å¼æ‰¾åˆ° m å’Œ b çš„æœ€ä½³å€¼äº†ã€‚

# æœ€å¤§åŒ–æ¦‚ç‡

ä¸Šé¢çš„`for`å¾ªç¯ä¸­çš„æ€»æ¦‚ç‡åœ¨æ•°å­¦ä¸Šæ˜¯è¿™æ ·è¡¨ç¤ºçš„:

![](img/b7c3b31403dcc1398f447b47f0cb1d37.png)

å·¨å‹ğš·ä¸ for å¾ªç¯çš„*=æ“ä½œç›¸åŒã€‚ã€Šæˆ‘ã€‹æ˜¯ä¸€éƒ¨ç”µå½±ï¼Œå°±åƒã€Šæ¥è‡ªå¤ªç©ºçš„å¸ƒå¶ã€‹ã€‚

`prob(x)`å‡½æ•°ï¼Œå³å•éƒ¨ç”µå½±çš„æ¦‚ç‡ï¼Œç”±ä¸‹å¼ç»™å‡º:

![](img/025260fc90abb88861cc12d6d3a3f0ba.png)

ä¸ºäº†å¾—åˆ° *m* (æˆ– *b* )çš„æœ€ä¼˜å€¼ï¼Œæˆ‘ä»¬å–æ€»æ¦‚ç‡ç›¸å¯¹äº *m* (æˆ– *b* )çš„å¯¼æ•°ï¼Œå°†æ–¹ç¨‹è®¾ä¸ºé›¶å¹¶æ±‚è§£ï¼Œå¯¹å—ï¼Ÿä¸å¹¸çš„æ˜¯ï¼Œæœ‰ä¸¤ä¸ªé—®é¢˜:

1.  å¯¹ä¸€å †ç›¸ä¹˜çš„ä¸œè¥¿æ±‚å¯¼ã€‚
2.  å³ä½¿æ˜¯å¯¹è¿™ä¸ªå·¨å¤§çš„å¯¼æ•°æ±‚å¯¼ï¼Œæˆ‘ä»¬ä¹Ÿæ‰¾ä¸åˆ°å…³äº *m* (æˆ– *b* )çš„å°é—­è§£ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•é€šè¿‡è¿™ç§æ–¹å¼å¾—åˆ°æœ€ä¼˜å€¼ã€‚

ä½†æ˜¯å¹¶æ²¡æœ‰å¤±å»ä¸€åˆ‡ã€‚è™½ç„¶æˆ‘ä»¬ä¸èƒ½è§£æåœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æˆ‘ä»¬ä»ç„¶å¯ä»¥æ‰¾åˆ° m å’Œ b çš„æœ€ä½³å€¼ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•å¯¹æ¦‚ç‡æ–¹ç¨‹è¿›è¡Œ(å¯æ€•çš„)æ±‚å¯¼ï¼Œç„¶åæœé‚£ä¸ªæ–¹å‘è¿ˆä¸€å°æ­¥ï¼Œé‡å¤ç›´åˆ°åˆ°è¾¾é¡¶ç‚¹ï¼

è¿™ä¸ªç®¡ç”¨ã€‚ä½†æ˜¯è®°ä½ï¼Œä¸€å †ä¸œè¥¿ç›¸ä¹˜çš„å¯¼æ•°æ˜¯å¾ˆéš¾çš„ã€‚åœ¨å®è·µä¸­ï¼Œå…ˆå¤šèµ°ä¸€æ­¥ï¼Œäº‹æƒ…å°±ç®€å•å¤šäº†ã€‚

# å‡è®¾ 3:è¦ä½¿ä¸€ä¸ªå‡½æ•°æœ€å¤§åŒ–ï¼Œé¦–å…ˆå–è¿™ä¸ªå‡½æ•°çš„å¯¹æ•°ï¼Œå¦‚æœå®ƒä½¿æ•°å­¦æ›´å®¹æ˜“çš„è¯ã€‚

ç†ç”±:å¯¹äºä»»ä½•æœ‰æ³¢å³°å’Œæ³¢è°·çš„å‡½æ•°ï¼Œåˆ°å¤„å–å¯¹æ•°ä¼šé™ä½æ³¢å³°å’Œæ³¢è°·çš„é«˜åº¦ï¼Œä½†ä¸ä¼šç§»é™¤ä»»ä½•æ³¢å³°æˆ–æ³¢è°·ï¼Œä¹Ÿä¸ä¼šå·¦å³ç§»åŠ¨å®ƒä»¬ã€‚ä¸ºäº†æ‰¾åˆ°æ¦‚ç‡å‡½æ•° *m* çš„æœ€å¤§å€¼ï¼Œåœ¨ä»»ä½•åœ°æ–¹å–å…¶å¯¹æ•°ï¼Œå¹¶æ‰¾åˆ°*çš„æœ€å¤§å€¼ *m* ï¼Œå³*å‡½æ•°å’Œå³°å€¼å°†åœ¨åŒä¸€ä½ç½®ã€‚

åŒæ ·ï¼Œä½ å¯èƒ½ä¼šæƒ³*ä¸ºä»€ä¹ˆæ˜¯æ—¥å¿—ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯å¹³æ–¹æˆ–å¹³æ–¹æ ¹æˆ–ä½™å¼¦æˆ–ä»»ä½•å…¶ä»–å‡½æ•°ï¼Ÿä½ åˆä¸€æ¬¡è¯´å¯¹äº†ã€‚æˆ‘ä»¬å¯ä»¥è‡ªç”±é€‰æ‹©ä»»ä½•ä¸å½±å“æ¦‚ç‡å³°å€¼ä½ç½®çš„åˆç†å‡½æ•°ã€‚æˆ‘ä»¬å‡è®¾æ—¥å¿—ä½¿æˆ‘ä»¬çš„å·¥ä½œæ¯”å…¶ä»–é€‰é¡¹æ›´å®¹æ˜“ã€‚*

åŸå› å¦‚ä¸‹ã€‚äº§å“çš„å¯¹æ•°ç­‰äºå› å­å¯¹æ•°çš„æ€»å’Œ:

![](img/89b815f82b996d23763d29668e14bc2b.png)

å¯¹äºåˆ©æ¶¦ä¸º x ä¸”çƒ‚ç•ªèŒ„åˆ†ç±»ä¸º y çš„å•éƒ¨ç”µå½± *i* :

![](img/c930119db990b15a5f1ae53f0fcf4514.png)

è¿™ä¹Ÿè¯æ˜äº†è®¡ç®—æœºæ›´å®¹æ˜“å¾—åˆ°æ­£ç¡®çš„æ•°å­¦è¿ç®—ã€‚ã€‘

ç°åœ¨æ·±å‘¼å¸ï¼Œå¯¹ *m* æ±‚å¯¼ï¼Œå¿…è¦æ—¶æ’å…¥ prob(x)å‡½æ•°:

![](img/ef25663e6c80f7bc4f801de2730db921.png)

åœ¨ä¸€ä¸ªçœ‹ä¼¼å¥‡è¿¹èˆ¬çš„å–æ¶ˆæ¡æ¬¾çš„è¿‡ç¨‹ä¸­ï¼Œå¯¼æ•°(è°ƒæ•´ *m* çš„æ–¹å‘)ç”±`x*(y-prob(x))`ç»™å‡ºï¼Œå³ä¸€éƒ¨ç”µå½±çš„å‡€åˆ©æ¶¦ä¹˜ä»¥çƒ‚ç•ªèŒ„ä¼˜åº¦å‡å»å‡½æ•°æ­£ç¡®çš„æ¦‚ç‡ã€‚

é‡æ–°è®¡ç®—å¯¼æ•°ç›¸å¯¹äº *b* çš„ä½ç½®ï¼Œç»“æœçš„å”¯ä¸€ä¸åŒæ˜¯å‰å¯¼`x`å˜æˆäº†`1`ã€‚

è®¡ç®—å®Œæ‰€æœ‰æ•°æ®ç‚¹çš„å¯¼æ•°åï¼Œæœ€åä¸€æ­¥æ˜¯å°†å…¶ä¸­çš„ä¸€å°éƒ¨åˆ†åŠ å›å‚æ•° *m* å’Œ*bã€‚*è¿™å°†ç•¥å¾®æé«˜æˆ‘ä»¬çš„æ€»æ¦‚ç‡ã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œæ¦‚ç‡æœ€ç»ˆä¼šåœæ­¢å˜å¾—æ›´å¥½ï¼Œæˆ‘ä»¬å¾—åˆ°äº†æœ€ä¼˜å€¼ *m* å’Œ *b* ã€‚

```
from math import e# These are tiny fractions.
M_EPSILON = 1e-19
B_EPSILON = 1e-10def prob(x, m, b):
    return 1 / (1 + e ** (-m * x - b))m = 1e-9
b = 1e-3 

for i in range(100_000):
    for net_profit, rotten_tomatoes in movies_df[
        ["net", "good_rt"]
    ].to_records(index=False):
        p = prob(net_profit, m, b)
        m_derivative = net_profit * (
            rotten_tomatoes - p
        ) 
        m_step = M_EPSILON * m_derivative
        m += m_step

        b_derivative = 1 * (rotten_tomatoes - p)
        b_step = B_EPSILON * b_derivative
        b += b_stepprint(f"{m=}, {b=}")
```

ä»¥`m = 2.815e-09`å’Œ`b = 0.0001839`ç»“å°¾ã€‚ä¸ºäº†æ£€æŸ¥ç»“æœçš„åˆç†æ€§ï¼Œä½¿ç”¨ Scikit Learn å’Œ compare è¿è¡Œç›¸åŒçš„å›å½’:

```
from sklearn.linear_model import LogisticRegressionX = movies_df[["net"]]
y = movies_df["good_rt"]
clf = LogisticRegression(random_state=0).fit(X, y)
print(f"{clf.coef_.item()=}, {clf.intercept_.item()=}")
```

èµ é€`m = 2.813e-09`ï¼Œèµ é€`b = -6.792e-17`ã€‚

# æ‘˜è¦

æˆ‘ä»¬å¼€å§‹é¢„æµ‹ä¸€éƒ¨ç”µå½±åœ¨ç»™å®šå‡€åˆ©æ¶¦çš„æƒ…å†µä¸‹åœ¨çƒ‚ç•ªèŒ„è·å¾—æˆåŠŸçš„æ¦‚ç‡ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰:

```
from math import edef prob(x):
    m = 2.815e-09
    b = 0.0001839 
    return 1 / (1 + e ** (-m * x - b))print(prob(-1e10))  # 5.952373865141857e-13
print(prob(-1e8))   # 0.4301311461885308
print(prob(-1e6))   # 0.499342225379464
print(prob(1e6))    # 0.500749724438119
print(prob(1e8))    # 0.5699590060203963
print(prob(1e10))   # 0.9999999999994049
```

æˆ‘ä»¬åšäº†ä¸‰ä¸ªåˆç†çš„å‡è®¾ï¼Œä¸€è·¯è¯æ˜äº†å®ƒä»¬çš„åˆç†æ€§ã€‚æˆ‘ä»¬å¯ä»¥è‡ªç”±åœ°åç¦»å®ƒä»¬ï¼Œä¾‹å¦‚é€šè¿‡é€‰æ‹©å¯¹æ•°çš„æ›¿ä»£å“ï¼Œä½†æ˜¯æˆ‘ä»¬ä¼šå¤±å»ç®€å•çš„å¯¼æ•°ç»“æœ`x*(y-prob(x))`ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸ä¼šå¾—åˆ°é€»è¾‘å›å½’ã€‚

é€»è¾‘å›å½’çš„ä»»ä½•ä¸¥è‚ƒåº”ç”¨éƒ½åº”è¯¥ä¾èµ– Scikit-learn è¿™æ ·çš„è½¯ä»¶åŒ…ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬è‡ªå·±å¼€å‘çš„å„ç§è½¯ä»¶åŒ…ã€‚å®ƒä¸ä»…æ›´æ˜“äºè¯»å–ã€ç¼–å†™å’Œè°ƒè¯•ï¼Œè€Œä¸”è¿˜åŒ…å«äº†è¯¸å¦‚ç³»æ•°æŸ¥æ‰¾ä¼˜åŒ–ã€å¤šå˜é‡æ”¯æŒã€ç®¡é“æ”¯æŒç­‰ç‰¹æ€§ã€‚

# è¡Œè¯å’Œåç»­æ­¥éª¤

æˆ‘ä»¬ä»ç¬¬ä¸€åŸç†æ¨å¯¼å‡ºé€»è¾‘å›å½’ã€‚ç„¶è€Œï¼Œå°†ä¸Šè¿°æ¦‚å¿µä¸æ ‡å‡†æœ¯è¯­è”ç³»èµ·æ¥æ˜¯æœ‰å¸®åŠ©çš„ã€‚

*   **é€»è¾‘å‡½æ•°** : f(x) = 1/[1 + exp(-x)]
*   **Logit å‡½æ•°** : f(x) = ln[x/(1-x)]
*   **ä¼¼ç„¶**:ä»¥`Probability=...`å¼€å¤´çš„å¤§ğš·æ–¹ç¨‹
*   **å¯¹æ•°ä¼¼ç„¶**:ä»¥`ln[Probability]=...`å¼€å¤´çš„ç­‰å¼
*   **æ¢¯åº¦**:ç›¸å¯¹äº *m* (æˆ– *b* )çš„å¯¼æ•°
*   **å¡åº¦ä¸Šå‡**:å°†ä¸€éƒ¨åˆ†å¡åº¦åŠ å› *m* (æˆ– *b* )

å¯¹äºåç»­å·¥ä½œï¼Œè¯·æŸ¥çœ‹ä¸‹é¢å‚è€ƒèµ„æ–™ä¸­çš„*ä» Python ä¸­çš„é€»è¾‘å›å½’*ä¸€æ–‡ï¼Œå…¶ä¸­åŸºäº Numpy çš„æ–¹æ³•åœ¨å¤§çº¦ 20 è¡Œä»£ç ä¸­å¯¼å‡ºäº†å¤šå˜é‡é€»è¾‘å›å½’ã€‚å°è¯•è‡ªå·±ç¼–å†™ä¸€ä¸ªäºŒç»´æ‰©å±•ï¼Œå¹¶ä½¿ç”¨å‚è€ƒèµ„æ–™ä¸­çš„ç»˜å›¾ä»£ç æ¥è·å¾—ç³»æ•°å«ä¹‰çš„ç›´è§‰ã€‚

# å‚è€ƒ

1.  é€»è¾‘å›å½’çš„æ¨å¯¼:[https://web . Stanford . edu/class/archive/cs/cs 109/cs 109.1178/lesson è®²ä¹‰/220-logistic-regression . pdf](https://web.stanford.edu/class/archive/cs/cs109/cs109.1178/lectureHandouts/220-logistic-regression.pdf)
2.  å…³äºç½—å‰ç‰¹å˜æ¢çš„è®¨è®º:ã€https://data.princeton.edu/wws509/notes/c3.pdf#page=6ã€‘T4
3.  Python ä¸­ä»å¤´å¼€å§‹çš„é€»è¾‘å›å½’:[https://Becker nick . github . io/logistic-Regression-from-Scratch/](https://beckernick.github.io/logistic-regression-from-scratch/)
4.  ç»˜åˆ¶é€»è¾‘å›å½’æ¨¡å‹çš„å†³ç­–è¾¹ç•Œ:[https://scipython . com/blog/plotting-the-decision-boundary-of-a-logistic-regression-model/](https://scipython.com/blog/plotting-the-decision-boundary-of-a-logistic-regression-model/)
5.  ç”¨[https://latexeditor.lagrida.com/](https://latexeditor.lagrida.com/)ç”Ÿæˆçš„ä¹³èƒ¶

# æ‰€æœ‰çš„ä»£ç 

ä½ æ˜¯å¦ä¸€è·¯å‘ä¸‹æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œåªæ˜¯ä¸ºäº†è·å¾—å®Œæ•´çš„ä»£ç æ¥å¤åˆ¶/ç²˜è´´ï¼Œå¹¶çœ‹çœ‹è¿™æ˜¯å¦é€‚åˆä½ ï¼Ÿå¦‚æœæœ‰ï¼Œè¯·å°½æƒ…äº«å—:-)

```
# Requires Python 3.8 or higher# Run the following line to install dependencies:
#     pip install altair vega_datasets scikit-learnimport pandas as pd                                                             
from vega_datasets import data###############################
# Pull and Prune the Data Set #
###############################

movies_g_df = (
    data.movies()
    .query('MPAA_Rating == "G"')
    .dropna(subset=["Rotten_Tomatoes_Rating"])
)#####################
# Data Calculations #
#####################movies_df = movies_g_df.assign(                                                 
    net=movies_g_df.eval(                                                       
        "Worldwide_Gross-Production_Budget"                                     
    ),                                                                          
    good_rt=(                                                                   
        movies_g_df["Rotten_Tomatoes_Rating"] >= 75                             
    ).astype(int),                                                              
)#########
# Plot! #
#########import altair as alt
alt.Chart(movies_df).mark_point().encode(                                       
    x=alt.X("net"),                                                             
    y=alt.Y("good_rt:N", sort="descending"),                                    
    color="good_rt:N",                                                          
    tooltip=[                                                                   
        "Title",                                                                
        "Release_Date",                                                         
        "net",                                                                  
        "Rotten_Tomatoes_Rating",                                               
    ],                                                                          
).save("/tmp/movies.html")#################################
# An Arbitrary First Best Guess #
#################################from math import e
def prob(x):
    m = 1e-6
    b = 1
    return 1/(1+e**(-m*x-b))# "The Adventures of Elmo in Grouchland" and "Muppets From Space".
print(f"{prob(-5_365_542)*(1-prob(-7_695_214))=}")############################
# Calculate the Likelihood #
############################def prob(x):
    m = 1e-9
    b = 1e-2
    return 1/(1+e**(-m*x-b))probability = 1
for net, rt in movies_df[['net','good_rt']].to_records(index=False):
    probability *= (prob(net))**rt * (1-prob(net))**(1-rt)

print(f"{probability=}")###################
# Gradient Ascent #
#################### These are tiny fractions.
M_EPSILON = 1e-19
B_EPSILON = 1e-10def prob(x, m, b):
    return 1 / (1 + e ** (-m * x - b))m = 1e-9
b = 1e-3 

for i in range(100_000):
    for net_profit, rotten_tomatoes in movies_df[
        ["net", "good_rt"]
    ].to_records(index=False):
        p = prob(net_profit, m, b)
        m_derivative = net_profit * (
            rotten_tomatoes - p
        ) 
        m_step = M_EPSILON * m_derivative
        m += m_step

        b_derivative = 1 * (rotten_tomatoes - p)
        b_step = B_EPSILON * b_derivative
        b += b_stepprint(f"{m=}, {b=}")###########################
# Scikit Learn Comparison #
###########################from sklearn.linear_model import LogisticRegressionX = movies_df[["net"]]
y = movies_df["good_rt"]
clf = LogisticRegression(random_state=0).fit(X, y)
print(f"{clf.coef_.item()=}, {clf.intercept_.item()=}")
```

[*Ryan Duve*](https://www.linkedin.com/in/duve/)*æ˜¯ Corvus Insurance çš„æ•°æ®ç§‘å­¦å®¶ã€‚ä»–è¿˜æ˜¯ä¸€åç‰©ç†å­¦å®¶ã€Linux é»‘å®¢å’Œä¸€åç³Ÿç³•çš„å’–å•¡å¸ˆã€‚*