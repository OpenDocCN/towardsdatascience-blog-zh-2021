# æµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼

> åŸæ–‡ï¼š<https://towardsdatascience.com/binary-representation-of-the-floating-point-numbers-77d7364723f1?source=collection_archive---------1----------------------->

![](img/188e54a69d2943052f459671005b40e0.png)

ç…§ç‰‡ç”±[ç±³å¡é²æ¢…æ–¯ç‰¹](https://unsplash.com/@mbaumi?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

ä½ æœ‰æ²¡æœ‰æƒ³è¿‡è®¡ç®—æœºå¦‚ä½•åœ¨å†…å­˜ä¸­å­˜å‚¨æµ®ç‚¹æ•°ï¼Œæ¯”å¦‚`3.1415` (ğ¿)æˆ–`9.109 Ã— 10â»Â³Â¹`(ä»¥åƒå…‹ä¸ºå•ä½çš„ç”µå­è´¨é‡)ï¼Œè€Œå†…å­˜æ˜¯ç”±æœ‰é™æ•°é‡çš„ 1 å’Œ 0(ä¹Ÿå°±æ˜¯æ¯”ç‰¹)ç»„æˆçš„ï¼Ÿ

å¯¹äºæ•´æ•°æ¥è¯´ä¼¼ä¹å¾ˆç®€å•(ä¾‹å¦‚`17`)ã€‚å‡è®¾æˆ‘ä»¬æœ‰ 16 ä½(2 å­—èŠ‚)æ¥å­˜å‚¨è¿™ä¸ªæ•°å­—ã€‚åœ¨ 16 ä½ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å­˜å‚¨èŒƒå›´ä¸º`[0, 65535]`çš„æ•´æ•°:

```
(0000000000000000)â‚‚ = (0)â‚â‚€(0000000000010001)â‚‚ =
    (1 Ã— 2â´) +
    (0 Ã— 2Â³) +
    (0 Ã— 2Â²) +
    (0 Ã— 2Â¹) +
    (1 Ã— 2â°) = (17)â‚â‚€(1111111111111111)â‚‚ =
    (1 Ã— 2Â¹âµ) +
    (1 Ã— 2Â¹â´) +
    (1 Ã— 2Â¹Â³) +
    (1 Ã— 2Â¹Â²) +
    (1 Ã— 2Â¹Â¹) +
    (1 Ã— 2Â¹â°) +
    (1 Ã— 2â¹) +
    (1 Ã— 2â¸) +
    (1 Ã— 2â·) +
    (1 Ã— 2â¶) +
    (1 Ã— 2âµ) +
    (1 Ã— 2â´) +
    (1 Ã— 2Â³) +
    (1 Ã— 2Â²) +
    (1 Ã— 2Â¹) +
    (1 Ã— 2â°) = (65535)â‚â‚€
```

å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæœ‰ç¬¦å·çš„æ•´æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨[äºŒè¿›åˆ¶è¡¥ç ](https://en.wikipedia.org/wiki/Two%27s_complement)å¹¶å°†`[0, 65535]`çš„èŒƒå›´ç§»å‘è´Ÿæ•°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ 16 ä½å°†ä»£è¡¨`[-32768, +32767]`èŒƒå›´å†…çš„æ•°å­—ã€‚

æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œè¿™ç§æ–¹æ³•ä¸å…è®¸æ‚¨è¡¨ç¤ºåƒ`-27.15625`è¿™æ ·çš„æ•°å­—(å°æ•°ç‚¹åçš„æ•°å­—å°†è¢«å¿½ç•¥)ã€‚

è™½ç„¶æˆ‘ä»¬ä¸æ˜¯ç¬¬ä¸€ä¸ªæ³¨æ„åˆ°è¿™ä¸ªé—®é¢˜çš„äººã€‚å¤§çº¦ 36 å¹´å‰ï¼Œä¸€äº›èªæ˜äººé€šè¿‡å¼•å…¥æµ®ç‚¹è¿ç®—çš„ IEEE 754 æ ‡å‡†å…‹æœäº†è¿™ä¸ªé™åˆ¶ã€‚

IEEE 754 æ ‡å‡†æè¿°äº†ä½¿ç”¨è¿™äº› 16 ä½(æˆ– 32 ä½æˆ– 64 ä½)æ¥å­˜å‚¨æ›´å¤§èŒƒå›´çš„æ•°å­—çš„æ–¹å¼(æ¡†æ¶)ï¼ŒåŒ…æ‹¬å°æµ®ç‚¹æ•°(å°äº 1 ä¸”æ›´æ¥è¿‘ 0)ã€‚

ä¸ºäº†ç†è§£æ ‡å‡†èƒŒåçš„æ€æƒ³ï¼Œæˆ‘ä»¬å¯ä»¥å›å¿†ä¸€ä¸‹[ç§‘å­¦ç¬¦å·](https://en.wikipedia.org/wiki/Scientific_notation)â€”â€”ä¸€ç§è¡¨ç¤ºè¿‡å¤§æˆ–è¿‡å°çš„æ•°å­—(é€šå¸¸ä¼šäº§ç”Ÿä¸€é•¿ä¸²æ•°å­—)çš„æ–¹å¼ï¼Œä»¥ä¾¿äºç”¨åè¿›åˆ¶å½¢å¼ä¹¦å†™ã€‚

![](img/19f67d71c85d90996bc2360f4a83fd54.png)

æ’å›¾ç”± [trekhleb](https://trekhleb.dev/) ç»˜åˆ¶

æ­£å¦‚æ‚¨åœ¨å›¾ä¸­çœ‹åˆ°çš„ï¼Œæ•°å­—è¡¨ç¤ºå¯èƒ½è¢«åˆ†æˆä¸‰éƒ¨åˆ†:

*   ç¬¦å·
*   åˆ†æ•°(ä¹Ÿç§°ä¸ºæœ‰æ•ˆæ•°)â€”æ•°å­—çš„æœ‰ä»·å€¼çš„ä½æ•°(å«ä¹‰ã€æœ‰æ•ˆè½½è·)
*   æŒ‡æ•°-æ§åˆ¶åˆ†æ•°ä¸­å°æ•°ç‚¹ç§»åŠ¨çš„è·ç¦»å’Œæ–¹å‘

æˆ‘ä»¬å¯ä»¥çœç•¥åŸºç¡€éƒ¨åˆ†ï¼Œåªè¦åŒæ„å®ƒç­‰äºä»€ä¹ˆã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`2`ä½œä¸ºåŸºç¡€ã€‚

æˆ‘ä»¬å¯ä»¥å…±äº«è¿™äº›ä½ï¼ŒåŒæ—¶å­˜å‚¨ç¬¦å·ã€æŒ‡æ•°å’Œåˆ†æ•°ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ‰€æœ‰ 16 ä½(æˆ– 32 ä½æˆ– 64 ä½)æ¥å­˜å‚¨æ•°å­—çš„åˆ†æ•°ã€‚æ ¹æ®æˆ‘ä»¬è¦ç”¨æ¥å­˜å‚¨æ•°å­—çš„ä½æ•°ï¼Œæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°ä»¥ä¸‹åˆ†å‰²:

![](img/24b78d01e361bfe0289bf6284c9df1e6.png)

ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œåˆ†æ•°çš„ä½æ•°å·²ç»å‡å°‘(å³ï¼Œå¯¹äº 16 ä½æ•°ï¼Œå®ƒä» 16 ä½å‡å°‘åˆ° 10 ä½)ã€‚è¿™æ„å‘³ç€åˆ†æ•°ç°åœ¨å¯èƒ½å–æ›´çª„çš„å€¼èŒƒå›´(å¤±å»ä¸€äº›ç²¾åº¦)ã€‚ç„¶è€Œï¼Œç”±äºæˆ‘ä»¬ä¹Ÿæœ‰ä¸€ä¸ªæŒ‡æ•°éƒ¨åˆ†ï¼Œå®ƒå®é™…ä¸Šä¼šå¢åŠ æœ€ç»ˆçš„æ•°å­—èŒƒå›´ï¼Œä¹Ÿå…è®¸æˆ‘ä»¬æè¿° 0 å’Œ 1 ä¹‹é—´çš„æ•°å­—(å¦‚æœæŒ‡æ•°æ˜¯è´Ÿçš„)ã€‚

> ä¾‹å¦‚ï¼Œå¸¦ç¬¦å·çš„ 32 ä½æ•´æ•°å˜é‡çš„æœ€å¤§å€¼ä¸º 1 = 2ï¼Œ147ï¼Œ483ï¼Œ647ï¼Œè€Œ IEEE 754 32 ä½äºŒè¿›åˆ¶æµ®ç‚¹å˜é‡çš„æœ€å¤§å€¼çº¦ä¸º 3.4028235 Ã— 1â° â¸.

ä¸ºäº†ä½¿è´ŸæŒ‡æ•°æˆä¸ºå¯èƒ½ï¼ŒIEEE 754 æ ‡å‡†ä½¿ç”¨äº†[åç½®æŒ‡æ•°](https://en.wikipedia.org/wiki/Exponent_bias)ã€‚æƒ³æ³•å¾ˆç®€å•â€”â€”ä»æŒ‡æ•°å€¼ä¸­å‡å»åå·®ï¼Œä½¿å…¶ä¸ºè´Ÿã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŒ‡æ•°æœ‰ 5 ä½ï¼Œå®ƒå¯èƒ½ä»èŒƒå›´`[0, 31]`ä¸­å–å€¼(è¿™é‡Œæ‰€æœ‰å€¼éƒ½æ˜¯æ­£çš„)ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä»ä¸­å‡å»`15`çš„å€¼ï¼ŒèŒƒå›´å°±æ˜¯`[-15, 16]`ã€‚æ•°å­—`15`ç§°ä¸ºåå·®ï¼Œé€šè¿‡ä»¥ä¸‹å…¬å¼è®¡ç®—:

```
exponent_bias = 2 ^ (kâˆ’1) âˆ’ 1k - number of exponent bits
```

æˆ‘è¯•å›¾åœ¨ä¸‹å›¾ä¸­æè¿°æµ®ç‚¹æ•°ä»äºŒè¿›åˆ¶æ ¼å¼è½¬æ¢å›åè¿›åˆ¶æ ¼å¼çš„é€»è¾‘ã€‚å¸Œæœ›å®ƒèƒ½è®©ä½ æ›´å¥½åœ°ç†è§£ IEEE 754 æ ‡å‡†æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œè¿™é‡Œä½¿ç”¨ 16 ä½æ•°å­—ï¼Œä½†æ˜¯åŒæ ·çš„æ–¹æ³•ä¹Ÿé€‚ç”¨äº 32 ä½å’Œ 64 ä½æ•°å­—ã€‚

![](img/382d5dac31c65e39b8363eea2a476273.png)

æ’å›¾ç”± [trekhleb](https://trekhleb.dev/) ç»˜åˆ¶

> æ£€æŸ¥æ­¤å›¾ çš„ [**äº¤äº’ç‰ˆæœ¬ï¼Œé€šè¿‡è®¾ç½®ä½çš„å¼€å’Œå…³æ¥è¿›è¡Œè¯•éªŒï¼Œå¹¶è§‚å¯Ÿå®ƒå°†å¦‚ä½•å½±å“æœ€ç»ˆç»“æœ**](https://trekhleb.dev/blog/2021/binary-floating-point/)

ä¸ºç®€å•èµ·è§ï¼Œä¸Šè¿°ç¤ºä¾‹ä¸­çœç•¥äº†å‡ ä¸ªæé™æƒ…å†µ(å³`-0`ã€`-âˆ`ã€`+âˆ`å’Œ`NaN`(éæ•°å­—)å€¼)

ä»¥ä¸‹æ˜¯ä¸åŒæµ®ç‚¹æ ¼å¼æ”¯æŒçš„æ•°å­—èŒƒå›´:

![](img/900e5dbcd69c450a93a9405db429c14e.png)

# ä»£ç ç¤ºä¾‹

åœ¨ [javascript ç®—æ³•åº“](https://github.com/trekhleb/javascript-algorithms/tree/master/src/algorithms/math/binary-floating-point)ä¸­ï¼Œæˆ‘æ·»åŠ äº†ä¸€ä¸ªäºŒè¿›åˆ¶åˆ°åè¿›åˆ¶è½¬æ¢å™¨çš„æºä»£ç ï¼Œå®ƒåœ¨ä¸Šé¢çš„äº¤äº’ç¤ºä¾‹ä¸­ä½¿ç”¨è¿‡ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œè¯´æ˜å¦‚ä½•åœ¨ JavaScript ä¸­è·å¾—æµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºã€‚JavaScript æ˜¯ä¸€ç§ç›¸å½“é«˜çº§çš„è¯­è¨€ï¼Œè¿™ä¸ªä¾‹å­å¯èƒ½å¤ªå†—é•¿ï¼Œä¸åƒä½çº§è¯­è¨€é‚£æ ·ç®€å•ï¼Œä½†ä»ç„¶å¯ä»¥åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è¿›è¡Œå®éªŒ:

```
const singlePrecisionBytesLength = 4; // 32 bits
const doublePrecisionBytesLength = 8; // 64 bits
const bitsInByte = 8;function floatAsBinaryString(floatNumber, byteLength) {
  let numberAsBinaryString = ''; const arrayBuffer = new ArrayBuffer(byteLength);
  const dataView = new DataView(arrayBuffer); const byteOffset = 0;
  const littleEndian = false; if (byteLength === singlePrecisionBytesLength) {
    dataView.setFloat32(byteOffset, floatNumber, littleEndian);
  } else {
    dataView.setFloat64(byteOffset, floatNumber, littleEndian);
  } for (let byteIndex = 0; byteIndex < byteLength; byteIndex += 1) {
    let bits = dataView.getUint8(byteIndex).toString(2);
    if (bits.length < bitsInByte) {
      bits = new Array(bitsInByte - bits.length).fill('0').join('') + bits;
    }
    numberAsBinaryString += bits;
  } return numberAsBinaryString;
}function floatAs64BinaryString(floatNumber) {
  return floatAsBinaryString(floatNumber, doublePrecisionBytesLength);
}function floatAs32BinaryString(floatNumber) {
  return floatAsBinaryString(floatNumber, singlePrecisionBytesLength);
}// Usage example
floatAs32BinaryString(1.875); // -> "00111111111100000000000000000000"
```

# å‚è€ƒ

æ‚¨å¯èƒ½è¿˜æƒ³æŸ¥é˜…ä»¥ä¸‹èµ„æºï¼Œä»¥æ›´æ·±å…¥åœ°äº†è§£æµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º:

*   [è¿™é‡Œæ˜¯ä½ éœ€è¦çŸ¥é“çš„å…³äº JavaScript çš„æ•°å­—ç±»å‹](https://indepth.dev/posts/1139/here-is-what-you-need-to-know-about-javascripts-number-type)
*   [æµ®çƒæš´éœ²](https://float.exposed/)
*   [IEEE754 å¯è§†åŒ–](https://bartaz.github.io/ieee754-visualization/)