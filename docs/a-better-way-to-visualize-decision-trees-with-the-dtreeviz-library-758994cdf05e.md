# ç”¨ dtreeviz åº“å¯è§†åŒ–å†³ç­–æ ‘çš„æ›´å¥½æ–¹æ³•

> åŸæ–‡ï¼š<https://towardsdatascience.com/a-better-way-to-visualize-decision-trees-with-the-dtreeviz-library-758994cdf05e?source=collection_archive---------6----------------------->

## [å®è·µæ•™ç¨‹](https://towardsdatascience.com/tagged/hands-on-tutorials)

## ä¸€ä¸ªç”¨äºå†³ç­–æ ‘å¯è§†åŒ–å’Œæ¨¡å‹è§£é‡Šçš„å¼€æºåŒ…

![](img/87741032fc8395549b155cd799383b12.png)

ä½œè€…å›¾ç‰‡

ä¸€å¹…ç”»èƒœè¿‡åƒè¨€ä¸‡è¯­ï¼Œè¿™æ˜¯æ­£ç¡®çš„è¯´æ³•ã€‚è¿™ä¸ªå…¬ç†åŒæ ·é€‚ç”¨äºæœºå™¨å­¦ä¹ æ¨¡å‹ã€‚å¦‚æœä¸€ä¸ªäººèƒ½å¤Ÿå¯è§†åŒ–å’Œè§£é‡Šç»“æœï¼Œå®ƒä¼šç»™æ¨¡å‹çš„é¢„æµ‹æ³¨å…¥æ›´å¤šçš„ä¿¡å¿ƒã€‚å¯è§†åŒ–æœºå™¨å­¦ä¹ æ¨¡å‹å¦‚ä½•å·¥ä½œä¹Ÿä½¿å¾—å‘å…·æœ‰è¾ƒå°‘æˆ–æ²¡æœ‰æœºå™¨å­¦ä¹ æŠ€èƒ½çš„äººè§£é‡Šç»“æœæˆä¸ºå¯èƒ½ã€‚Scikit-learn åº“å¤©ç”Ÿå…·æœ‰ç»˜åˆ¶å†³ç­–æ ‘çš„èƒ½åŠ›ã€‚ä½†æ˜¯ï¼Œä¸é»˜è®¤é€‰é¡¹æœ‰ä¸€äº›ä¸ä¸€è‡´ã€‚æœ¬æ–‡å°†ç€çœ¼äºä¸€ç§å«åš [dtreeviz](https://github.com/parrt/dtreeviz) çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå®ƒå¯ä»¥å‘ˆç°æ›´å¥½çœ‹ã€æ›´ç›´è§‚çš„å¯è§†åŒ–æ•ˆæœï¼ŒåŒæ—¶æä¾›æ›´å¥½çš„å¯è§£é‡Šæ€§é€‰é¡¹ã€‚

# ç”¨äºå¯è§†åŒ–åŸºäºæ ‘çš„æ¨¡å‹çš„ dtreeviz åº“

**dtreeviz** æ˜¯ä¸€ä¸ªç”¨äºå†³ç­–æ ‘å¯è§†åŒ–å’Œæ¨¡å‹è§£é‡Šçš„ python åº“ã€‚æ ¹æ®å…¶ [Github repo](https://github.com/parrt/dtreeviz) ä¸Šçš„å¯ç”¨ä¿¡æ¯ï¼Œè¯¥åº“ç›®å‰æ”¯æŒ [scikit-learn](https://scikit-learn.org/stable) ã€ [XGBoost](https://xgboost.readthedocs.io/en/latest) ã€ [Spark MLlib](https://spark.apache.org/mllib/) å’Œ [LightGBM](https://lightgbm.readthedocs.io/en/latest/) æ ‘ã€‚

ä¸‹é¢æ˜¯åœ¨è‘—åçš„[è‘¡è„é…’è´¨é‡æ•°æ®é›†](https://www.kaggle.com/uciml/red-wine-quality-cortez-et-al-2009)ä¸Šï¼Œä»é»˜è®¤ scikit-learn å’Œä» dtreeviz ç”Ÿæˆçš„å¯è§†åŒ–çš„è§†è§‰æ¯”è¾ƒã€‚è¯¥æ•°æ®é›†åŒ…æ‹¬ 178 ä¸ªå®ä¾‹å’Œ 13 ä¸ªæ•°å­—é¢„æµ‹å±æ€§ã€‚æ¯ä¸ªæ•°æ®ç‚¹å¯ä»¥å±äºåä¸º class_0ã€class_1 å’Œ class_2 çš„ä¸‰ä¸ªç±»ä¹‹ä¸€ã€‚

![](img/55ceadbfba4df37f31baa24ac86e4043.png)![](img/5588fb704637f0cf98ba264f11e9aefc.png)

åœ¨è‘—åçš„[è‘¡è„é…’è´¨é‡æ•°æ®é›†](https://www.kaggle.com/uciml/red-wine-quality-cortez-et-al-2009) |ä½œè€…æä¾›çš„å›¾ç‰‡ä¸Šï¼Œå¯¹é»˜è®¤ scikit-learn(å·¦)å’Œ dtreeviz(å³)ç”Ÿæˆçš„å¯è§†åŒ–æ•ˆæœè¿›è¡Œè§†è§‰æ¯”è¾ƒ

ä»ä¸Šé¢çš„å›¾ç‰‡å¯ä»¥æ˜æ˜¾çœ‹å‡ºï¼Œå³è¾¹çš„å›¾æ¯”å·¦è¾¹çš„å›¾æä¾›äº†æ›´å¤šçš„ä¿¡æ¯ã€‚é»˜è®¤çš„ scikit å­¦ä¹ å¯è§†åŒ–å­˜åœ¨ä¸€äº›æ˜æ˜¾çš„é—®é¢˜ï¼Œä¾‹å¦‚:

*   ç›®å‰è¿˜ä¸æ¸…æ¥šä¸åŒçš„é¢œè‰²ä»£è¡¨ä»€ä¹ˆã€‚
*   ç›®æ ‡ç±»æ²¡æœ‰å›¾ä¾‹ã€‚
*   å¯è§†åŒ–è¿”å›æ ·æœ¬çš„è®¡æ•°ï¼Œå¹¶ä¸”ä¸å®¹æ˜“å¯è§†åŒ–åˆ†å¸ƒã€‚
*   æ— è®ºæ ·æœ¬æ•°é‡å¤šå°‘ï¼Œæ¯ä¸ªå†³ç­–èŠ‚ç‚¹çš„å¤§å°éƒ½æ˜¯ç›¸åŒçš„ã€‚

dtreeviz åº“å¡«è¡¥äº†è¿™äº›æ¼æ´ï¼Œæä¾›äº†ä¸€ä¸ªæ›´æ¸…æ™°ã€æ›´å®¹æ˜“ç†è§£çš„ç”»é¢ã€‚ä»¥ä¸‹æ˜¯ä½œè€…è¦è¯´çš„è¯:

> å¯è§†åŒ–æ•ˆæœçš„çµæ„Ÿæ¥è‡ª [R2D3](http://www.r2d3.us/) çš„æ•™è‚²åŠ¨ç”»ï¼›[æœºå™¨å­¦ä¹ çš„å¯è§†åŒ–ä»‹ç»](http://www.r2d3.us/visual-intro-to-machine-learning-part-1/)ã€‚ä½¿ç”¨`dtreeviz`ï¼Œæ‚¨å¯ä»¥å¯è§†åŒ–ç‰¹å¾ç©ºé—´å¦‚ä½•åœ¨å†³ç­–èŠ‚ç‚¹ä¸Šåˆ†å‰²ï¼Œè®­ç»ƒæ ·æœ¬å¦‚ä½•åœ¨å¶èŠ‚ç‚¹ä¸Šåˆ†å¸ƒï¼Œæ ‘å¦‚ä½•å¯¹ç‰¹å®šè§‚å¯Ÿè¿›è¡Œé¢„æµ‹ç­‰ç­‰ã€‚è¿™äº›æ“ä½œå¯¹äºç†è§£åˆ†ç±»æˆ–å›å½’å†³ç­–æ ‘çš„å·¥ä½œæ–¹å¼è‡³å…³é‡è¦ã€‚

åœ¨æ¥ä¸‹æ¥çš„å‡ èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¸€äº›å¸¸è§çš„ä¾‹å­æ¥çœ‹çœ‹ dtreeviz å¦‚ä½•ä¼˜äºå…¶ä»–å¯è§†åŒ–åº“ã€‚å…³äº**å®‰è£…è¯´æ˜ï¼Œ**è¯·å‚è€ƒå®˜æ–¹ [Github é¡µé¢](https://github.com/parrt/dtreeviz#install)ã€‚å¯ä»¥å®‰è£…`pip install dtreeviz but`éœ€è¦é¢„è£…`graphviz`ã€‚

# dtreeviz çš„å“è¶Šå¯è§†åŒ–

åœ¨å¯è§†åŒ–å†³ç­–æ ‘ä¹‹å‰ï¼Œç†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ã€‚å†³ç­–æ ‘æ˜¯ä¸€ç§ç›‘ç£å­¦ä¹ é¢„æµ‹æ¨¡å‹ï¼Œå®ƒä½¿ç”¨ä¸€ç»„äºŒå…ƒè§„åˆ™æ¥è®¡ç®—ç›®æ ‡å€¼ã€‚å®ƒå¯ç”¨äºå›å½’å’Œåˆ†ç±»ä»»åŠ¡ã€‚å†³ç­–æ ‘æœ‰ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†:

*   **æ ¹èŠ‚ç‚¹:**æ‰§è¡Œç¬¬ä¸€æ¬¡æ‹†åˆ†çš„èŠ‚ç‚¹ã€‚
*   **ç»ˆç«¯èŠ‚ç‚¹/å¶èŠ‚ç‚¹:**é¢„æµ‹ç»“æœçš„èŠ‚ç‚¹ã€‚
*   **åˆ†æ”¯:**ç®­å¤´è¿æ¥èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºä»é—®é¢˜åˆ°ç­”æ¡ˆçš„æµç¨‹ã€‚

å†³ç­–æ ‘æ¨¡å‹çš„ç®—æ³•é€šè¿‡é‡å¤åœ°å°†æ•°æ®åˆ’åˆ†åˆ°å¤šä¸ªå­ç©ºé—´ä¸­æ¥å·¥ä½œï¼Œä½¿å¾—æ¯ä¸ªæœ€ç»ˆå­ç©ºé—´ä¸­çš„ç»“æœå°½å¯èƒ½åœ°ç›¸ä¼¼ã€‚è¿™ç§æ–¹æ³•åœ¨æŠ€æœ¯ä¸Šè¢«ç§°ä¸º*é€’å½’åˆ†åŒº*ã€‚è¯¥ç®—æ³•è¯•å›¾å°†æ•°æ®åˆ†æˆå­é›†ï¼Œä»¥ä½¿æ¯ä¸ªå­ç»„å°½å¯èƒ½çº¯å‡€æˆ–åŒè´¨ã€‚

ä»¥ä¸Šæ‘˜å½•æ‘˜è‡ªæˆ‘å†™çš„ä¸€ç¯‡å…³äºç†è§£å†³ç­–æ ‘çš„æ–‡ç« ã€‚æœ¬æ–‡æ·±å…¥è§£é‡Šäº†ç®—æ³•é€šå¸¸å¦‚ä½•åšå‡ºå†³ç­–ã€‚

<https://medium.com/analytics-vidhya/a-guide-to-machine-learning-in-r-for-beginners-decision-trees-c24dfd490abb> [## ç†è§£å†³ç­–æ ‘

### æˆ‘åœ¨â€œåˆ†æä¼˜åŠ¿â€è¯¾ç¨‹ä¸­å…³äºå†³ç­–æ ‘çš„ç¬”è®°](https://medium.com/analytics-vidhya/a-guide-to-machine-learning-in-r-for-beginners-decision-trees-c24dfd490abb) 

ç°åœ¨è®©æˆ‘ä»¬å›åˆ° dtreeviz åº“ï¼Œä½¿ç”¨ä¸Šé¢æåˆ°çš„è‘¡è„é…’æ•°æ®ç»˜åˆ¶å…¶ä¸­çš„å‡ ä¸ªã€‚

## èµ„æ–™ç»„

æˆ‘ä»¬å°†ä½¿ç”¨æ¥è‡ª [**è‘¡è„é…’è´¨é‡æ•°æ®é›†**](https://archive.ics.uci.edu/ml/datasets/wine+quality) **çš„è‘—åçº¢é…’æ•°æ®é›†ã€‚**æ•°æ®é›†ç”±ä¸è‘¡è„ç‰™â€œVinho Verdeâ€è‘¡è„é…’çº¢è‰²å˜ç§ç›¸å…³çš„å‡ é¡¹ç†åŒ–æµ‹è¯•ç»„æˆã€‚ç›®æ ‡æ˜¯åœ¨è¿™äº›æµ‹è¯•çš„åŸºç¡€ä¸Šå»ºç«‹è‘¡è„é…’è´¨é‡æ¨¡å‹ã€‚ç”±äºè¯¥æ•°æ®é›†å¯ä»¥è¢«è§†ä¸ºåˆ†ç±»å’Œå›å½’ä»»åŠ¡ï¼Œå› æ­¤å®ƒé€‚åˆæˆ‘ä»¬çš„ç”¨ä¾‹ã€‚æˆ‘ä»¬å°†ä¸å¿…ä½¿ç”¨å•ç‹¬çš„æ•°æ®é›†æ¥æ¼”ç¤ºåˆ†ç±»å’Œå›å½’ç¤ºä¾‹ã€‚

> **è¿™é‡Œæ˜¯** [**nbviewer é“¾æ¥**](https://nbviewer.jupyter.org/github/parulnith/Data-Science-Articles/blob/main/A%20better%20way%20to%20visualize%20Decision%20Trees%20with%20the%20dtreeviz%20library/A%20better%20way%20to%20visualize%20Decision%20Trees%20with%20the%20dtreeviz%20library.ipynb) **åˆ°ç¬”è®°æœ¬ incase ä½ æƒ³è·Ÿç€èµ°ã€‚**

è®©æˆ‘ä»¬çœ‹çœ‹æ•°æ®é›†çš„å‰å‡ è¡Œ:

![](img/bd7ff8a4809056251120188496e1e1d0.png)

æ•°æ®é›†ä¸€ç¥|ä½œè€…å›¾ç‰‡

`quality`å‚æ•°æ˜¯æŒ‡è‘¡è„é…’çš„è´¨é‡ï¼Œæ˜¯ä¸€ä¸ªä»‹äº 0 å’Œ 10 ä¹‹é—´çš„åˆ†æ•°

![](img/95e399f3fd6ec208e891b4b266d38103.png)

# å½¢è±¡åŒ–

è½»æ¾åˆ›å»ºç‰¹æ€§å’Œç›®æ ‡å˜é‡ã€‚

```
features = wine.drop('quality',axis=1)
target = wine['quality']
```

## **å›å½’å†³ç­–æ ‘**

å¯¹äºå›å½’ç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†é¢„æµ‹è‘¡è„é…’çš„`quality`ã€‚

```
# Regression tree on Wine datafig = plt.figure(figsize=(25,20))
regr= tree.DecisionTreeRegressor(max_depth=3) regr.fit(features, target)viz = dtreeviz(regr,
               features,
               target,
               target_name='wine quality',
               feature_names=features.columns,
               title="Wine data set regression",
               fontname="Arial",
               colors = {"title":"purple"},
               scale=1.5)
viz
```

![](img/4b920b06e1e97582fccbd68b4c6a78db.png)

å›å½’å†³ç­–æ ‘|ä½œè€…å›¾ç‰‡

*   æ°´å¹³è™šçº¿è¡¨ç¤ºå†³ç­–èŠ‚ç‚¹ä¸­å·¦å³æ¡¶çš„ç›®æ ‡å¹³å‡å€¼ï¼›
*   å‚ç›´è™šçº¿è¡¨ç¤ºç‰¹å¾ç©ºé—´ä¸­çš„åˆ†å‰²ç‚¹ã€‚
*   é»‘è‰²æ¥”å½¢çªå‡ºæ˜¾ç¤ºåˆ†å‰²ç‚¹ï¼Œå¹¶ç¡®å®šç²¾ç¡®çš„åˆ†å‰²å€¼ã€‚
*   å¶èŠ‚ç‚¹ç”¨è™šçº¿è¡¨ç¤ºç›®æ ‡é¢„æµ‹å€¼(å¹³å‡å€¼)ã€‚

**åˆ†ç±»å†³ç­–æ ‘**

å¯¹äºåˆ†ç±»ç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†ä»ç»™å®šçš„å…­ä¸ªç±»åˆ«ä¸­é¢„æµ‹è‘¡è„é…’çš„`class`ã€‚è¿™é‡Œçš„ç›®æ ‡ä¹Ÿæ˜¯è´¨é‡å˜é‡ã€‚

```
# Classification tree on Wine datafig = plt.figure(figsize=(25,20))
clf = tree.DecisionTreeClassifier(max_depth=3)clf.fit(features, target)# pick random X observation for demo
#X = wine.data[np.random.randint(0, len(wine.data)),:]viz = dtreeviz(clf,
               features,
               target,
               target_name='wine quality',
               feature_names=features.columns,
               title="Wine data set classification",
               class_names=['5', '6', '7', '4', '8', '3'],
               histtype='barstacked', # default 
               scale=1.2)
viz
```

![](img/07a4f2139ef6c6725f102e151606df5d.png)

è‘¡è„é…’æ•°æ®åˆ†ç±»æ ‘|æŒ‰ä½œè€…åˆ†ç±»çš„å›¾ç‰‡

ä¸å›å½’å˜é‡ä¸åŒï¼Œç›®æ ‡æ˜¯åˆ†ç±»å™¨çš„ç±»åˆ«ã€‚å› æ­¤ï¼Œç›´æ–¹å›¾ç”¨äºè¯´æ˜ç‰¹å¾-ç›®æ ‡ç©ºé—´ã€‚å½“ç±»åˆ«æ•°é‡å¢åŠ æ—¶ï¼Œå †å ç›´æ–¹å›¾å¯èƒ½éš¾ä»¥è¯»å–ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`histogram type`å‚æ•°å¯ä»¥ä»é»˜è®¤çš„`barstacked,`æ›´æ”¹ä¸º`bar`ã€‚

# è‡ªå®šä¹‰

dtreeviz åº“è¿˜æä¾›äº†ä¸€ç³»åˆ—å®šåˆ¶ã€‚æˆ‘å°†åœ¨è¿™é‡Œå±•ç¤ºå…¶ä¸­çš„ä¸€äº›:

## ç¼©æ”¾å›¾åƒ

ç¼©æ”¾å‚æ•°å¯ç”¨äºç¼©æ”¾æ•´ä¸ªå›¾åƒã€‚

## ä»å·¦åˆ°å³å¯¹é½çš„æ ‘

å¯ä»¥å°†`orientation`å‚æ•°è®¾ç½®ä¸º`LR`æ¥ä»å·¦åˆ°å³æ˜¾ç¤ºæ ‘ï¼Œè€Œä¸æ˜¯ä»ä¸Šåˆ°ä¸‹

```
fig = plt.figure(figsize=(25,20))
clf = tree.DecisionTreeClassifier(max_depth=2)clf.fit(features, target)# pick random X observation for demoviz = dtreeviz(clf,
               features,
               target,
               target_name='wine quality',
               feature_names=features.columns,
               title="Wine data set classification",
               class_names=['5', '6', '7', '4', '8', '3'],
               **orientation='LR',** 
               scale=1.2)
viz
```

![](img/02e409bb549e00fdebef08935d3e19fe.png)

ä»å·¦åˆ°å³å¯¹é½çš„æ ‘|ä½œè€…å›¾ç‰‡

## å•æ¬¡è§‚æµ‹çš„é¢„æµ‹è·¯å¾„

è¯¥åº“è¿˜æœ‰åŠ©äºéš”ç¦»å’Œç†è§£ç‰¹å®šæµ‹è¯•è§‚å¯Ÿéµå¾ªçš„å†³ç­–è·¯å¾„ã€‚è¿™å¯¹äºå‘ä»–äººè§£é‡Šé¢„æµ‹æˆ–ç»“æœéå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬ä»æ•°æ®é›†ä¸­æŒ‘é€‰ä¸€ä¸ªéšæœºæ ·æœ¬ï¼Œå¹¶éå†å®ƒçš„å†³ç­–è·¯å¾„ã€‚

```
fig = plt.figure(figsize=(25,20))
clf = tree.DecisionTreeClassifier(max_depth=3)clf.fit(features, target)**# pick random X observation for demo
X = features.iloc[np.random.randint(0, len(features)),:].values**viz = dtreeviz(clf,
               features,
               target,
               target_name='wine quality',
               feature_names=features.columns,
               title="Wine data set classification",
               class_names=['5', '6', '7', '4', '8', '3'],
               scale=1.3,
               X=X)
viz
```

![](img/f2dbc19998a4aa8d831a17857db5baba.png)

å•æ¬¡è§‚å¯Ÿçš„é¢„æµ‹è·¯å¾„|ä½œè€…æä¾›çš„å›¾åƒ

## ä¿å­˜å›¾åƒ

è¾“å‡ºå›¾å½¢å¯ä»¥ä¿å­˜ä¸º SVG æ ¼å¼ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
viz.save_svg()
```

# ç»“è®º

åœ¨ç»˜åˆ¶å†³ç­–æ ‘æ—¶ï¼Œdtreeviz åº“æ¯”å…¶ä»–åº“å¾—åˆ†æ›´é«˜ã€‚ä½¿ç»“æœå¯è§£é‡Šçš„é¢å¤–èƒ½åŠ›æ˜¯ä¸€ä¸ªæå¥½çš„é™„åŠ åŠŸèƒ½ï¼›æ‚¨å¯ä»¥éš”ç¦»å•ä¸ªæ•°æ®ç‚¹ï¼Œå¹¶åœ¨å¾®è§‚å±‚é¢ä¸Šç†è§£é¢„æµ‹ã€‚è¿™æœ‰åŠ©äºæ›´å¥½åœ°ç†è§£æ¨¡å‹çš„é¢„æµ‹ï¼Œä¹Ÿä¾¿äºå°†å‘ç°ä¼ è¾¾ç»™å…¶ä»–äººã€‚æˆ‘åœ¨è¿™é‡Œæ‰€è§¦åŠçš„åªæ˜¯å†°å±±ä¸€è§’ã€‚Github åº“å’Œä½œè€…çš„é™„å¸¦æ–‡ç« æ›´è¯¦ç»†ï¼Œæˆ‘å¼ºçƒˆæ¨èæµè§ˆå®ƒä»¬ã€‚é“¾æ¥åœ¨ä¸‹é¢çš„å‚è€ƒèµ„æ–™éƒ¨åˆ†ã€‚

# å‚è€ƒèµ„æ–™å’Œè¿›ä¸€æ­¥é˜…è¯»:

*   [dtre eviz çš„å®˜æ–¹ Github åº“ã€‚](https://github.com/parrt/dtreeviz/)
*   [å¦‚ä½•å¯è§†åŒ–å†³ç­–æ ‘](https://explained.ai/decision-tree-viz/index.html#sec:1.4)â€”â€”dtre eviz çš„åˆ›å»ºè€…ä»¬å¯¹å†³ç­–æ ‘å¯è§†åŒ–çš„ä¸€ä¸ªå¾ˆå¥½çš„é˜…è¯»ã€‚
*   [äº†è§£å†³ç­–æ ‘](https://medium.com/analytics-vidhya/a-guide-to-machine-learning-in-r-for-beginners-decision-trees-c24dfd490abb)

*ğŸ‘‰æœ‰å…´è¶£çœ‹æˆ‘å†™çš„å…¶ä»–æ–‡ç« ã€‚è¿™ä¸ª* [*å›è´­*](https://github.com/parulnith/Data-Science-Articles/blob/main/README.md) *åŒ…å«äº†æˆ‘åˆ†ç±»å†™çš„æ‰€æœ‰æ–‡ç« ã€‚*