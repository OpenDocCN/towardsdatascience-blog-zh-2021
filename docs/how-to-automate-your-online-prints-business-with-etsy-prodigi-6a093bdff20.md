# 如何使用 Etsy &灵捷自动化您的在线打印业务

> 原文：<https://towardsdatascience.com/how-to-automate-your-online-prints-business-with-etsy-prodigi-6a093bdff20?source=collection_archive---------22----------------------->

## 第 1/2 部分:如何使用 Python 和 Etsy +灵积 API 创建订单

![](img/9bd7860e590c08cc88504d6c1afd4ea2.png)

[图像](https://unsplash.com/photos/Tzm3Oyu_6sk)通过 Unsplash

4 年来，我一直在经营我自己的基于体育数据的印刷业务/爱好&在 [Etsy](https://www.etsy.com/uk/shop/SportsChord) 、 [GPBox](https://www.thegpbox.com/vendors/sportschord/) 和个人销售了 1500 多份印刷品。这是一个学习新编程语言/软件的神奇平台，也是一个发挥创造力和尝试新设计的地方。

它开始是一个极其手工的过程；我会先把照片寄到我家，然后再改地址，送到当地邮局寄出。当我一周接到 1 到 2 个订单时，这只能勉强维持。在英国，我去过的每个地方，邮局排队的情况都很可怕！

随着订单的增加&尤其是在圣诞节前后(约 70%的年度订单来自 11 月/12 月)，邮局的冲刺变得过于频繁和紧张。通过谷歌搜索，我了解了直运，即印刷商将订单直接发送给客户的过程。这样，您不需要投资持有任何库存，只需要在自己的商店收到订单时向打印机下订单。

在尝试了几家供应商之后，我找到了一家。他们经营着一个制造中心的国际网络，产品种类繁多，从专业装裱的印刷品到 t 恤衫。在印花方面，我个人一直对质量很满意，我在 Etsy 商店收到的评论也反映了这一点。如果你想自己测试，灵知为新客户提供了不同印刷类型的样品包。

有几种方法可以在 given 上排序。仪表板允许您在在线表格中输入客户的详细信息，上传您的图像文件，然后跟踪您的订单状态。还有一个手动订单表单(我还没有亲自使用过)，允许您从导出的 Etsy orders csv 下多个订单。

最强大的选项是 Print API，它允许您使用来自 Etsy API &灵捷 API 的订单详细信息组合，以编程方式下订单并跟踪订单。天才刚刚宣布了他们的 API 的 v4 版本，增加了许多额外的特性，所以现在是时候测试一下了！

下面的代码是用 python 编写的，使用 requests 包和几个支持 csv 文件来自动化整个订购过程。

## 先决条件

软件:你需要的所有代码都是用 Python 写的，所以你需要把它安装在你的机器上。为了加快速度，我还使用终端(Windows 上的命令提示符)来快速下订单。

**账号:** Etsy 店铺有一些房源，灵童账号下单。

**知识:**对 Python 和 API 如何工作的基本理解是很容易的，但是你可以通过使用完整的 GitHub Repo 或拼凑下面的代码片段来获得。

**硬件:**对于第 2 部分，我使用一个插在电视机后面的 Raspberry Pi 每小时调用一次 API，检查未结订单的状态，尽管我确信有更好的方法可以做到这一点，我们将在后面讨论！

## 证明

我通常发现这是新项目中最辛苦的部分，但也是最重要的部分之一。当[从灵物 API](https://www.prodigi.com/print-api/docs/reference/#environments) 开始时，您有两个端点可以调用；“沙盒”,即当您创建订单时，没有生产发生，也没有成本。“prodigi”是生产端点，所以只有当您确定要下订单时才使用这个端点。

两个端点都有一个单独的密钥来认证用户，从版本 4 开始，在您进行的调用中只需要 REST API 密钥。我发现在代码的开头使用 if 语句来区分这两者很有用，如下所示:

Etsy 的[认证过程](https://www.etsy.com/developers/documentation/getting_started/oauth)有点复杂。你需要创建一个应用程序，将授予你一个关键和秘密。然后，您需要将它们交换为 OAuth 访问令牌和访问令牌密码(总共有 4 个唯一的字符串)。当用您的密钥和秘密交换令牌时，您还需要包含[权限范围](https://www.etsy.com/developers/documentation/getting_started/oauth#section_permission_scopes)(您的应用程序需要访问的内容)。出于这个项目的目的，您将需要 *transactions_r* 和 *transactions_w.* 参见下面生成所需令牌的示例脚本。

## 收集 Etsy 订单详细信息

现在我们已经得到了所有的密钥和秘密，我们可以查询 Etsy API 来返回我们选择的订单的详细信息([order_num]是一个整数，表示未完成的订单，0 表示最近的订单)。您需要将您的 _SHOP_HERE 替换为您的店铺 id，您可以在此处找到。使用 json 包，我们可以解包 API 的响应并收集订单细节。

我指定了一系列必要的(名字，第一行，第二行等等。)和可选的(total，order_date)变量，当我们在 Prodigi API 上下订单时会重用这些变量。我包含了总数和订单日期，因为我将每个订单的信息保存在一个单独的表中，以便以后进行分析。

第 31–35 行有效地映射了灵童和 Etsy 之间的国家代码。Prodigi 要求两个字母的 ISO 代码，而 Etsy 提供整数格式的国家 ID。你可以下载参考我这里用的[的表](https://github.com/sportschord/prodigi/blob/main/Files/Countries.json)。

第 36–42 行在技术上并不是必需的，但是由于 GB 快递(皇家邮政跟踪递送)在灵吉上只是额外增加了 1 行，所以我选择将所有 GB 订单设置为快递选项，而不考虑他们的 Etsy 递送选项。

现在我们已经获得了所有客户的详细信息，我们需要调用特定的收据来找出他们订购了哪种打印。这是在第 44–47 行完成的。

## 映射和下单

我们获取收据的调用返回一个对象数组，每个订购的商品一个对象。由此，我们可以收集打印的详细信息，如列表 ID 以及我们在商店中设置的任何自定义变量。在我的情况下，我使用大小(A4，A3 等。)和有框/无框印刷品。

为了在清单 Id 和产品变体之间建立联系，我使用了一个 excel 文件中的映射表(你可以在这里找到一个[的例子](https://github.com/sportschord/prodigi/blob/main/Files/Print%20IDs.xlsx))。它包括打印的大小&类型，以及到实际图像文件的可共享链接(我将我所有的图像保存到 Google Drive，并允许任何有特定链接的人访问它们，以便图像可以被 gign 获取)。

一旦映射完成，我们就有了下订单所需的所有信息，接下来是时候构建 json 有效负载来发布到灵物 API 并下订单了。下面的大部分键值对使用我们从 Etsy 收据或随后的映射表中收集的信息。完整文档见[此处](https://www.prodigi.com/print-api/docs/reference/#introduction)。

有时，客户不会填写地址中的几行，因为在下 Etsy 订单时不需要这些行(第二行地址、州、城市)，这就是为什么需要更新这些字段(第 51-59 行)。

所有这些都确认后，第 62 行对灵物 API 进行 POST 调用来下订单。作为响应，您将获得一个状态代码，确认它是否成功或是否有错误。v4 API 的错误消息似乎更详细，这对于检测调用中的任何缺口很有用。然后，您可以继续在灵物仪表盘上查看您的订单。

## 最后的想法

加速下单的最后一个技巧是将整个代码包装在一个函数中，然后使用终端为您下单。你可以点击查看整个脚本[。您可以通过使用 sys.argv[n]来实现这一点，它允许 python 与 terminal 进行交互，并选取您以特定顺序输入的任何变量。中提供路径名的别名。zshrc 文件并下一个新订单就像写*etsy 0‘灵童’*一样简单！](https://github.com/sportschord/prodigi/blob/main/Scripts/Etsy%20v4%20Place%20Order.py)

在第 2 部分中，我们将看看一旦下了订单会发生什么。当订单状态更新，我们需要向客户发送调度通知时，我们如何让 Etsy 和灵捷进行沟通？