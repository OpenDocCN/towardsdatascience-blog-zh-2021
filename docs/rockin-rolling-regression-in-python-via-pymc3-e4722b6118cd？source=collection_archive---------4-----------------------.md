# é€šè¿‡ PyMC3 åœ¨ Python ä¸­å®ç°æ»šåŠ¨å›å½’

> åŸæ–‡ï¼š<https://towardsdatascience.com/rockin-rolling-regression-in-python-via-pymc3-e4722b6118cd?source=collection_archive---------4----------------------->

## [è´å¶æ–¯ç»Ÿè®¡](https://medium.com/tag/bayesian-statistics)

## å­¦ä¹ å¦‚ä½•å¤„ç†å˜åŒ–çš„å‚æ•°

![](img/5ad73a9d9f588c6488184cf1b74cd37e.png)

ç”±[æœ¬æ°æ˜Â·æ²ƒç½—æ–¯](https://unsplash.com/@vorosbenisop?utm_source=medium&utm_medium=referral)åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„çš„ç…§ç‰‡

ç­”å‡è®¾æ‚¨æƒ³è¦è®­ç»ƒä¸€ä¸ªå‚æ•°æ¨¡å‹ï¼Œå¦‚çº¿æ€§æ¨¡å‹æˆ–ç¥ç»ç½‘ç»œã€‚åœ¨çº¿æ€§å›å½’çš„æƒ…å†µä¸‹ï¼Œé¦–å…ˆï¼Œä½ æŒ‡å®šæ¨¡å‹çš„å½¢çŠ¶ï¼Œæˆ‘ä»¬è¯´ *y = ax + b.* å…¶æ¬¡ï¼Œä½ ä¼°è®¡å‚æ•° *a* å’Œ *b* ã€‚å¯¹ä½ è¿™æ ·çš„ä¸“å®¶æ¥è¯´æ²¡ä»€ä¹ˆéš¾çš„ã€‚

æˆ‘æƒ³æŒ‡å‡ºçš„æ˜¯ä½ åœ¨è¿™æ ·åšçš„æ—¶å€™æ‰€åšçš„ä¸€ä¸ªéšå«çš„å‡è®¾:

> æ¥è‡ªæ•°æ®é›†çš„æ‰€æœ‰è§‚æµ‹å€¼éƒ½æœä»å…·æœ‰ç›¸åŒå›ºå®šå‚æ•°çš„ç›¸åŒæ¨¡å‹ã€‚

åœ¨çº¿æ€§æ¨¡å‹çš„æƒ…å†µä¸‹ï¼Œè¿™æ„å‘³ç€ *a* å’Œ *b* **çš„**ç›¸åŒå›ºå®šå€¼é€‚ç”¨äºæ‰€æœ‰è§‚æµ‹å€¼**ã€‚è¿™ä¸ªå‡è®¾æ˜¯å¦åˆç†ï¼Œå–å†³äºä½ æ‰‹å¤´çš„æ•°æ®é›†ã€‚è™½ç„¶å®ƒç»å¸¸æˆç«‹ï¼Œä½†åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æƒ³ç»™ä½ çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå®ƒæ˜¯å®Œå…¨é”™è¯¯çš„ã€‚åœ¨ä½ è¯»å®Œä¹‹åï¼Œä½ å°†èƒ½å¤Ÿè‡ªå·±å‘ç°è¿™äº›æœ‰é—®é¢˜çš„ä¾‹å­ï¼Œå¹¶ä¸”çŸ¥é“å¦‚ä½•ä»¥ä¸€ç§å¥½çš„æ–¹å¼å¯¹å¾…å®ƒä»¬ã€‚æˆ‘ä»¬å°†è€ƒè™‘ä¸€ä¸ªå¤©çœŸçš„ä»¥åŠä¸é”™çš„è´å¶æ–¯æ²»ç–—ã€‚**

# éšæ—¶é—´å˜åŒ–çš„å‚æ•°

ä¸€ä¸ªå‚æ•°å¯èƒ½å˜åŒ–çš„æ˜æ˜¾åœºæ™¯æ˜¯åœ¨å¤„ç†æ—¶é—´åºåˆ—æ—¶ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ•°æ®çš„è¾“å…¥å’Œè¾“å‡ºä¹‹é—´çš„ä¾èµ–å…³ç³»å¯èƒ½ä¼šæ”¹å˜ï¼Œè¿™æ„å‘³ç€æ¨¡å‹åŠå…¶å‚æ•°ä¹Ÿå¿…é¡»éšç€æ—¶é—´çš„æ¨ç§»è€Œæ”¹å˜ã€‚

ä½œä¸ºä¸€ä¸ªå‡è®¾çš„ä¾‹å­ï¼Œè®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ•°æ®é›† *D* = ( *t* ï¼Œ *x* ï¼Œ *y* )ï¼Œå…¶ä¸­ *t* æ˜¯æŸä¸ªæ—¶é—´æˆ³ã€‚ *D* çš„æ—¶é—´ä¸Šçš„ç¬¬ä¸€ä¸ªæ¡ç›®å¯èƒ½è¡¨ç°å¾—åƒ*y***â‰ˆ***3*x+*2ï¼Œè€Œæœ€è¿‘çš„æ¡ç›®è¡¨ç°å¾—æ›´åƒ*y***â‰ˆ***-x+*1ï¼Œè¿™åªæ˜¯å› ä¸ºäº‹æƒ…éšç€æ—¶é—´è€Œæ”¹å˜ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæ£€æµ‹å¹¶é‡åŒ–è¿™æ ·çš„å˜åŒ–ï¼Œé‚£å°±å¤ªå¥½äº†ï¼Œä¾‹å¦‚é€šè¿‡æ‰¾åˆ°ä¸€äº›æ»¡è¶³*y***â‰ˆ***a**t**x+b*çš„æ—¶é—´ç›¸å…³å‡½æ•° *a* ( *t* )å’Œ *b* ( *t* )*

*ä¸ºäº†äº†è§£æˆ‘ä»¬å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ã€‚*

## *æŠ½æ ·èµ„æ–™*

*é¦–å…ˆï¼Œè®©æˆ‘ä»¬åŠ è½½æ•°æ®é›†:*

```
*import pandas as pd
data = pd.read_csv(
  'https://raw.githubusercontent.com/Garve/datasets/3b6b1e6fadc04e2444905db0a0b2ed222daeaa28/rolling_data.csv',
   index_col='t'
)*
```

*ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€çœ‹å®ƒ:*

*![](img/648c7df32394a376e021496a1fe2e6c3.png)*

*å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚*

*æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ‰¾åˆ°ä¸€ä¸ªçº¿æ€§æ¨¡å‹ï¼Œåœ¨ç»™å®š *xï¼Œ*å³ *y = ax + b* çš„æƒ…å†µä¸‹é¢„æµ‹ *y* ã€‚ç„¶è€Œï¼Œä»…ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œç”±äºä»¥ä¸‹è§‚å¯Ÿç»“æœï¼Œå›ºå®šå€¼å¯¹äº *a* å’Œ *b* æ˜¯ä¸å¤Ÿçš„:*

1.  *åœ¨ 300 å’Œ 670 å·¦å³çš„æ—¶é—´å†…ï¼Œè“è‰²å’Œçº¢è‰²æ—¶é—´åºåˆ—éƒ½å¢åŠ ï¼Œç„¶ååˆåŒæ­¥ä¸‹é™ã€‚è¿™è¡¨æ˜å®ƒä»¬æ˜¯æ­£ç›¸å…³çš„ï¼Œè¿™æš—ç¤ºç€*a*0ã€‚*
2.  *åœ¨æ—¶é—´ 720 å’Œ 950 æœŸé—´ï¼Œè“è‰²æ—¶é—´åºåˆ—å…ˆå¢åŠ ç„¶åä¸‹é™ï¼Œè€Œçº¢è‰²æ—¶é—´åºåˆ—æ­£å¥½ç›¸åã€‚è¿™æš—ç¤ºç€è¿™äº›æ—¶é—´åºåˆ—æ˜¯è´Ÿç›¸å…³çš„ï¼Œæ„å‘³ç€*a*0ã€‚*

*è¿™ä¸¤ç‚¹éƒ½è¡¨æ˜æ–œç‡ *a* å¿…é¡»éšæ—¶é—´å˜åŒ–ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬æ›´æ„¿æ„å¤„ç†ä¸€ä¸ªä¾èµ–äºæ—¶é—´çš„å‡½æ•° *a* ( *t* )ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªå›ºå®šçš„ *a* ã€‚*

*æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æ•£ç‚¹å›¾ä¸­ä»¥ä¸åŒçš„æ–¹å¼æ˜¾ç¤ºä¸Šé¢çš„å›¾ç‰‡ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°ç†è§£å®é™…æ•°æ®é›†çš„æ ·å­:*

*![](img/b133ee7735b127cad9e1de1fd18568ee.png)*

*å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚*

*åœ¨è¿™ä¸ªè¡¨ç¤ºä¸­ï¼Œæ‚¨è¿˜å¯ä»¥çœ‹åˆ°å›å½’çº¿åšäº†æ¬¡ä¼˜çš„å·¥ä½œã€‚åšçº¿æ€§å›å½’*

```
*from sklearn.linear_model import LinearRegression

X = data[['x']]
y = data['y']

lr = LinearRegression().fit(X, y)

print(f'intercept = {lr.intercept_:.5f}, slope = {lr.coef_[0]:.3f}')

# Output: intercept = 18.45587, slope = 0.593*
```

*ç”Ÿäº§*

*![](img/b371be9f16d09c45fd663a2bab5d2b61.png)*

*å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚*

*ä¸æ˜¯å¾ˆåˆé€‚ã€‚é‚£ä¹ˆï¼Œæ€æ ·åšæ‰èƒ½æ›´ç²¾ç¡®åœ°æè¿° *x* å’Œ *y* ä¹‹é—´çš„è”ç³»å‘¢ï¼Ÿ*

# *å¯æ€œäººçš„æ»šåŠ¨å›å½’*

*ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ³•æ˜¯åœ¨ä¸€ä¸ªè¿ç»­çš„æ»‘åŠ¨çª—å£ä¸Šè¿›è¡Œå‡ æ¬¡è¾ƒå°çš„å›å½’ã€‚å¬èµ·æ¥ä¸é”™å§ï¼Ÿå®ƒçš„æ„æ€å¦‚ä¸‹:*

1.  *æ‚¨åˆ›å»ºäº†ç¬¬ä¸€ä¸ª *w* è§‚å¯Ÿå€¼çš„è¾ƒå°å­é›†ï¼Œå³ä»æ—¶é—´ **0 åˆ° *w* -1** ã€‚*å³ç¬¬ä¸€æ¬¡è¿­ä»£ä¸­çš„æ»‘åŠ¨çª—å£*ã€‚ä½ åœ¨è¿™ä¸ªå­æ•°æ®é›†ä¸Šåšæ™®é€šçš„æœ€å°äºŒä¹˜æ³•ï¼Œå†™ä¸‹ç›´çº¿çš„æ–œç‡å’Œæˆªè·ã€‚*
2.  *ä½ ç§»åŠ¨çª—å£ä¸€æ­¥ï¼Œæ„å‘³ç€å®ƒç°åœ¨ä»æ—¶é—´ **1 åˆ°è¾¾*w*ã€‚åœ¨è¿™ä¸ªå­æ•°æ®é›†ä¸Šä½¿ç”¨æ™®é€šæœ€å°äºŒä¹˜æ³•ã€‚***
3.  *æ‚¨å°†çª—å£ç§»åŠ¨ä¸€æ­¥ï¼Œè¿™æ„å‘³ç€å®ƒç°åœ¨ä»æ—¶é—´ **2 åˆ°è¾¾ w+1** ã€‚åœ¨è¿™ä¸ªå­æ•°æ®é›†ä¸Šä½¿ç”¨æ™®é€šæœ€å°äºŒä¹˜æ³•ã€‚*
4.  *ä½ ç§»åŠ¨çª—å£ä¸€æ­¥ï¼Œæ„å‘³ç€å®ƒç°åœ¨ä»æ—¶é—´ **3 åˆ°è¾¾ w+2** ã€‚åœ¨è¿™ä¸ªå­æ•°æ®é›†ä¸Šä½¿ç”¨æ™®é€šæœ€å°äºŒä¹˜æ³•ã€‚*
5.  *â€¦*

*ä½ æ˜ç™½äº†:æ¯ä¸ªå°æ•°æ®é›†ç”± *w* ä¸ªè¿ç»­å…ƒç´ ç»„æˆï¼Œå…¶ä¸­ *w* ä¹Ÿè¢«ç§°ä¸º(*çª—å£* ) *é•¿åº¦ã€‚è¿™æ˜¯ä¸€ä¸ªä½ å¯ä»¥éšæ„æ‘†å¼„çš„è¶…å‚æ•°ã€‚ä»å›¾å½¢ä¸Šçœ‹æ˜¯è¿™æ ·çš„( *w* = 3):**

*![](img/65f53e9fd600040bcb76064f91523463.png)*

*æ•°æ®é›†ä¸Šé•¿åº¦ä¸º 3 çš„æ»‘åŠ¨çª—å£(è“è‰²),æœ‰ 9 ä¸ªæ—¶é—´æ­¥é•¿ï¼Œå›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚*

*ç¼–å†™è¿™ç§**æ»šåŠ¨å›å½’æ–¹æ³•**çš„ç®€å•æ–¹æ³•å¦‚ä¸‹:*

```
*w = 30 # sliding window of length 30

slopes = []
intercepts = []

for i in range(len(data) - w):
    X = data.loc[i:i+w, ['x']]
    y = data.loc[i:i+w, 'y']
    lr = LinearRegression()
    lr.fit(X, y)
    intercepts.append(lr.intercept_)
    slopes.append(lr.coef_[0])*
```

*ç»˜åˆ¶æˆ‘ä»¬å¾—åˆ°çš„æ–œç‡å’Œæˆªè·*

*![](img/f1d17196561c1ffb8db13b3aef270d9f.png)**![](img/3dd4ac7aabd1c19fc8838c7dbecc5ee0.png)*

*ä½œè€…å›¾ç‰‡ã€‚*

*æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ–œç‡ä»æ­£å˜åˆ°è´Ÿå†å˜å›æ¥æ˜¯éå¸¸ä¸è§„åˆ™çš„ã€‚æˆªè·ä¼¼ä¹éšç€æ—¶é—´å¢åŠ äº†ä¸€ç‚¹ã€‚è¿™å¾ˆæœ‰è¶£ï¼Œä½†æ˜¯å®ƒå¯èƒ½å–å†³äºçª—å£é•¿åº¦å—ï¼Ÿæˆ‘ä»¬å°†å®ƒè®¾ç½®ä¸º 30 æ˜¯ç›¸å½“æ­¦æ–­çš„ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸å°è¯•å…¶ä»–å€¼ï¼Œæ¯”å¦‚ 200ï¼Œçœ‹çœ‹æ•…äº‹æ˜¯å¦ä¼šå‘ç”Ÿå˜åŒ–ï¼Ÿ*

*ä¸€èˆ¬æ¥è¯´ï¼Œä»¥ä¸‹æƒ…å†µæˆç«‹:*

> *çª—å£é•¿åº¦è¶Šå¤§ï¼Œå›¾å½¢è¶Šå¹³æ»‘ã€‚*

*è¿™æ˜¯å› ä¸ºçª—å£é•¿åº¦è¶Šå¤§ï¼Œæ¯ä¸¤ä¸ªç›¸é‚»çš„å­æ•°æ®é›†å°±è¶Šç›¸ä¼¼ã€‚å¦‚æœçª—å£é•¿åº¦æ˜¯ 200ï¼Œé‚£ä¹ˆæ¯ä¸¤ä¸ªç›¸é‚»å­æ•°æ®é›†(è‡³å°‘)æœ‰ 199 è¡Œæ˜¯ç›¸åŒçš„ã€‚å‡ ä¹ç›¸åŒçš„æ•°æ®é›†æ„å‘³ç€è®­ç»ƒåå‡ ä¹ç›¸åŒçš„æ¨¡å‹ï¼Œè‡³å°‘å¯¹äºçº¿æ€§å›å½’è¿™æ ·çš„ç¡®å®šæ€§æ–¹æ³•æ¥è¯´æ˜¯å¦‚æ­¤ã€‚å¦‚æœçª—å£é•¿åº¦ä»…ä¸º 2ï¼Œé‚£ä¹ˆæ¯ä¸¤ä¸ªç›¸é‚»çš„å­æ•°æ®é›†åªæœ‰è‡³å°‘ 50%æ˜¯ç›¸åŒçš„ï¼Œå› æ­¤åœ¨è¿™äº›æ•°æ®é›†ä¸Šè®­ç»ƒçš„æ¨¡å‹å¯ä»¥æ˜¾è‘—ä¸åŒã€‚è®©æˆ‘ä»¬çœ‹çœ‹é•¿åº¦ä¸º 200 çš„æ»‘åŠ¨çª—å£çš„ç»“æœæ˜¯ä»€ä¹ˆæ ·çš„ã€‚*

*![](img/9568bf7abb6f37130eca083398238b28.png)**![](img/808a3388adb2b53efd6ee3642001ceb9.png)*

*ä½œè€…å›¾ç‰‡ã€‚*

*æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå›¾å½¢æ›´åŠ å¹³æ»‘ï¼Œæ•…äº‹å¤§è‡´ä¿æŒä¸å˜:æ–œç‡åœ¨é›¶é™„è¿‘æ³¢åŠ¨ï¼Œæˆªè·éšç€æ—¶é—´çš„æ¨ç§»è€Œå¢åŠ ã€‚ç„¶è€Œï¼Œæ›²çº¿å›¾å·®åˆ«å¾ˆå¤§ï¼Œæ‰€ä»¥å¾ˆéš¾è¯´æ–œç‡å’Œæˆªè·**å®é™…ä¸Š**å¦‚ä½•éšæ—¶é—´æ¼”å˜ã€‚*

*æ€»ä¹‹ï¼Œè¿™ç§æ»šåŠ¨å›å½’æ–¹æ³•åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºçª—å£é•¿åº¦ï¼Œæˆ‘ä¸çŸ¥é“æœ‰ä»€ä¹ˆå¥½çš„æ–¹æ³•æ¥æ­£ç¡®é€‰æ‹©è¿™ä¸ªè¶…å‚æ•°ï¼Œä»¥è·å¾—*çœŸç›¸***ã€‚***

***å› æ­¤ï¼Œè®©æˆ‘ä»¬ç ”ç©¶ä¸€ç§æ›´å¥½çš„æ–¹æ³•æ¥å¤„ç†å˜åŒ–çš„å‚æ•°ã€‚åƒå¾€å¸¸ä¸€æ ·ï¼Œè´å¶æ–¯æŒ½æ•‘äº†å±€é¢ã€‚***

# ***è´å¶æ–¯æ»šåŠ¨å›å½’***

***é¦–å…ˆï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ç®€å•çš„è´å¶æ–¯çº¿æ€§å›å½’æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚æ‚¨å¯ä»¥åœ¨æ­¤äº†è§£æ›´å¤šä¿¡æ¯:***

***[](/bayesian-linear-regression-in-python-via-pymc3-ab8c2c498211) [## é€šè¿‡ PyMC3 åœ¨ Python ä¸­å®ç°è´å¶æ–¯çº¿æ€§å›å½’

### äº†è§£å¦‚ä½•æ¨æ–­æ¨¡å‹å‚æ•°å¹¶å¯¹æ–°æ•°æ®è¿›è¡Œé¢„æµ‹ï¼ŒåŒ…æ‹¬ä¸ç¡®å®šæ€§ä¼°è®¡ï¼

towardsdatascience.com](/bayesian-linear-regression-in-python-via-pymc3-ab8c2c498211) 

## ç¬¬ä¸€æ¬¡å°è¯•

å‡è®¾æ‚¨çŸ¥é“è¯¥ç»ƒä¹ ï¼Œè¯·æ£€æŸ¥ä»£ç :

```
import pymc3 as pm

with pm.Model() as linear_model:
    slope = pm.Normal('slope', sigma=1) # a
    intercept = pm.Normal('intercept', sigma=1) # b
    noise = pm.Exponential('noise', lam=1)

    y = pm.Normal(
        'y',
        mu=slope*data['x'] + intercept, # the linear model equation
        sigma=noise,
        observed=data['y']
    )

    linear_trace = pm.sample(return_inferencedata=True)
```

è¿™é‡Œåº”è¯¥æ²¡æœ‰ä»€ä¹ˆæƒŠå–œã€‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæ–œç‡ã€æˆªè·å’Œä¸€ä¸ªå…·æœ‰å…ˆéªŒçŸ¥è¯†çš„å™ªå£°å‚æ•°ï¼Œå¹¶é€šè¿‡å‡å€¼ä¸º *ax + b* çš„æ­£æ€åˆ†å¸ƒç›´æ¥å¯¹è¾“å‡º *y* è¿›è¡Œå»ºæ¨¡ã€‚

ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ªæ¨¡å‹å°±åƒç®€å•çš„çº¿æ€§å›å½’ä¸€æ ·ç³Ÿç³•ï¼Œåªæ˜¯å¸¦æœ‰ä¸ç¡®å®šæ€§ç•Œé™ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•å¯¹éšæ—¶é—´å˜åŒ–çš„äº‹ç‰©å»ºæ¨¡å‘¢ï¼Ÿå¼•å…¥å˜åŒ–æ–œç‡çš„ç®€å•æ–¹æ³•å¦‚ä¸‹:

```
import pymc3 as pm

with pm.Model() as linear_model_2:
    slopes = pm.Normal('slopes', sigma=1, shape=len(data))
    intercepts = pm.Normal('intercepts', sigma=1, shape=len(data))
    noise = pm.Exponential('noise', lam=1)

    y = pm.Normal(
        'y',
        mu=slopes*data['x'] + intercepts,
        sigma=noise,
        observed=data['y']
    )

    linear_trace_2 = pm.sample(return_inferencedata=True)
```

ä½¿ç”¨è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬ç»™**æ¯ä¸ªæ—¶é—´æ­¥é•¿èµ‹äºˆå®ƒè‡ªå·±çš„æ–œç‡å’Œæˆªè·**ï¼Œå› ä¸ºæˆ‘ä»¬å®šä¹‰çš„æ–œç‡å’Œæˆªè·ä¸æ•°æ®é›†ä¸­çš„è§‚æµ‹å€¼ä¸€æ ·å¤šã€‚

> æˆ‘å¸Œæœ›ä½ æ˜ç™½è¿™æ˜¯ä¸ªç³Ÿç³•çš„ä¸»æ„ã€‚

è¯¥æ¨¡å‹å®šä¹‰ï¼Œå³ä½¿ç”¨`shape=len(data)`ï¼Œæ„å‘³ç€æ‰€æœ‰å‚æ•°ç›¸äº’ç‹¬ç«‹ã€‚æ‰€æœ‰çš„æ–œç‡éƒ½æ˜¯ç›¸åŒä¸”ç‹¬ç«‹çš„ *N* (0ï¼Œ1)åˆ†å¸ƒ(æ­£æ€)ï¼Œè¿™æ„å‘³ç€ä¸¤ä¸ªç›¸é‚»çš„æ–œç‡å¯èƒ½ç›¸è·å¾ˆè¿œã€‚ä¾‹å¦‚ï¼Œå‡è®¾åœ¨ä¸€ä¸ªæ—¶é—´æ­¥é•¿ä¸­æ–œç‡ä¸º 2.41ï¼Œè€Œåœ¨ä¸‹ä¸€ä¸ªæ—¶é—´æ­¥é•¿ä¸­æ–œç‡æ€¥å‰§å˜åŒ–ä¸º-2.8ã€‚ç”±äºéšç€æ—¶é—´çš„æ¨ç§»å˜åŒ–é€šå¸¸æ›´å¹³ç¨³ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬ä»ç°å®ä¸–ç•Œçš„æ—¶é—´åºåˆ—ä¸­æ‰€æœŸæœ›çš„ã€‚å½“ç„¶ï¼Œæ‹¦æˆªä¹Ÿæ˜¯å¦‚æ­¤ã€‚

æŸ¥çœ‹å½“å‰è¡Œä¸ºçš„å¦ä¸€ç§æ–¹å¼æ˜¯ï¼Œå®ƒç›¸å½“äºä½¿ç”¨ä¸€ä¸ªé•¿åº¦ä¸º**1 çš„æ»‘åŠ¨çª—å£ã€‚**æ¯ä¸ªæ–œç‡å’Œæˆªè·éƒ½å¿…é¡»ç”¨**å•ä¸ªæ•°æ®ç‚¹**æ¥ä¼°è®¡ï¼Œè€Œä¸”æ²¡æœ‰åˆç†çš„æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚

## é«˜æ–¯éšæœºæ¸¸åŠ¨

è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ä¸¤ä¸ªç›¸é‚»æ»šåŠ¨çª—å£çš„å‚æ•°ä»¥æŸç§æ–¹å¼ç›¸å…³ã€‚å¦‚æœæŸä¸€æ—¶åˆ» *t* çš„æ–œç‡ä¸º *a* ( *t* )ï¼Œé‚£ä¹ˆä¸‹ä¸€æ—¶é—´æ­¥ *t* + 1 çš„æ–œç‡ä¹Ÿä¸åº”è¿œç¦» *a* ( *t* )ã€‚è¡¨è¾¾è¿™ä¸€ç‚¹çš„ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡å¯¹æ‰€æœ‰æ—¶é—´çš„æ ‡å‡†åå·®*Ïƒ*è¿›è¡Œå»ºæ¨¡*a*(*t+1*)~*N*(*a*(*t*)*ï¼ŒÏƒ**)*ï¼Œå¯¹ç¬¬ä¸€ä¸ªæ–œç‡ä½¿ç”¨ä¸€äº›åˆå§‹å€¼ï¼Œå¦‚*a*(0 ç”¨è¯­è¨€æ¥è¯´:

> ä¸‹ä¸€ä¸ªæ–œç‡æ˜¯æ—§æ–œç‡åŠ ä¸Šä¸€äº›è¯¯å·®ã€‚

è¿™å°±æ˜¯æ‰€è°“çš„[é«˜æ–¯éšæœºæ¸¸èµ°](https://en.wikipedia.org/wiki/Random_walk#Gaussian_random_walk)ã€‚æ‚¨å¯ä»¥é€šè¿‡ NumPy è‡ªå·±æ¨¡æ‹Ÿä¸€ä¸ª

```
np.random.seed(0)

steps = 20 # length of the random walk
a = [0] # the initial slope, can be anything
sigma = 1 # the error
for t in range(steps):
    a.append(np.random.normal(a[-1], sigma))
```

ç»˜å›¾`a`å¯¼è‡´

![](img/e994381e99ba0f2416e7aa02b0427fd2.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

å¦‚æœä½ ç¨å¾®æ‘†å¼„ä¸€ä¸‹`sigma`ï¼Œä½ ä¼šå‘ç°å€¼è¶Šå¤§ï¼Œ`a`å†…çš„è·³è·ƒè¶Šå¤§ï¼Œè¿™æ˜¯æœ‰é“ç†çš„ã€‚ä½ è¿˜å¯ä»¥çœ‹åˆ°çš„æ˜¯ï¼Œå¯¹äºæ‰€æœ‰çš„ *t* æ¥è¯´ï¼Œ *a* ( *t+1* )æ€»æ˜¯æ¥è¿‘ *a* ( *t* )ã€‚

## PyMC3 æ¨¡å‹

è™½ç„¶åœ¨ PyMC3 ä¸­å®ç°åŒæ ·çš„é€»è¾‘å¹¶ä¸å¤ªéš¾ï¼Œä½†æ˜¯å¼€å‘äººå‘˜é€šè¿‡å®ç°ä¸€ä¸ª`GaussianRandomWalk`å‘è¡Œç‰ˆè®©æˆ‘ä»¬å˜å¾—å¾ˆå®¹æ˜“ã€‚æœ‰äº†å®ƒï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ç”¨ PyMC3 å†™ä¸‹æœ€ç»ˆçš„æ¨¡å‹äº†ã€‚æ•´ä½“é€ å‹å’Œä¹‹å‰æŒºåƒçš„ã€‚æˆ‘ä»¬åªéœ€è¦

1.  å¼•å…¥ä¸¤ä¸ªé«˜æ–¯éšæœºæ¸¸èµ°ï¼Œä¸€ä¸ªç”¨äºæ–œç‡ï¼Œä¸€ä¸ªç”¨äºæˆªè·ï¼Œä»¥åŠ
2.  è¿™äº›é«˜æ–¯éšæœºæ¸¸èµ°çš„ä¸¤ä¸ªå™ªå£°å‚æ•°

ä»¥ä¸‹æ˜¯å»ºè®®ä¹¦èŒƒæœ¬:

```
with pm.Model() as rolling_linear_model:
    # noise parameters
    sigma_slope = pm.Exponential('sigma_slope', lam=1)
    sigma_intercept = pm.Exponential('sigma_intercept', lam=1)
    sigma = pm.Exponential('sigma', lam=1)

    # Gaussian random walks
    slopes = pm.GaussianRandomWalk(
        'slopes',
        sigma=sigma_slope,
        shape=len(data)
    )
    intercepts = pm.GaussianRandomWalk(
        'intercepts',
        sigma=sigma_intercept,
        shape=len(data)
    )

    # putting it together
    y = pm.Normal(
        'y',
        slopes*data['x'] + intercepts,
        sigma,
        observed=data['y']
    )

    rolling_linear_trace = pm.sample(return_inferencedata=True)
```

ä¸ä¹‹å‰çš„ç®€å•çº¿æ€§å›å½’ç›¸æ¯”ï¼Œè¿è¡Œè¯¥æ¨¡å‹éœ€è¦ä¸€äº›æ—¶é—´ï¼Œå› ä¸ºæœ‰è®¸å¤šå‚æ•°ä¹Ÿéšæœºåœ°ç›¸äº’ä¾èµ–ã€‚ä¸è¿‡ï¼Œåœ¨ä½ çš„æœºå™¨ä¸Šï¼Œè¿™åº”è¯¥ä¸åˆ° 15 åˆ†é’Ÿã€‚

æˆ‘ä»¬å¯ä»¥è¿è¡Œä¸€ä¸ªåéªŒé¢„æµ‹æ£€æŸ¥ï¼Œçœ‹çœ‹è¿™ä¸ªæ¨¡å‹æ˜¯å¦é€šè¿‡

```
import arviz as az

with rolling_linear_model:
    posterior = pm.sample_posterior_predictive(rolling_linear_trace)
    az.plot_ppc(az.from_pymc3(posterior_predictive=posterior))
```

è¿™è¾“å‡º

![](img/74424d00723f2342c02f9d929f89f558.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

è¿™æ„å‘³ç€è¯¥æ¨¡å‹éå¸¸å¥½åœ°æ•æ‰äº†è§‚å¯Ÿåˆ°çš„æ•°æ®ï¼Œå› ä¸ºé»‘è‰²çš„*è§‚å¯Ÿåˆ°çš„*çº¿æ­£å¥½åœ¨è“è‰²çš„*åéªŒé¢„æµ‹*ç®¡å†…ã€‚è¿™è¾† *r* ä¹Ÿè¡¨ç°ä¸é”™:

```
az.r2_score(data['y'].values, rolling_posterior['y'])

# Output:
# r2        0.981449
# r2_std    0.000920
```

> ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œè¿™æ˜¯åŸ¹è®­ç»©æ•ˆã€‚è¯¥æ¨¡å‹å¯èƒ½ä¼šä¹Ÿå¯èƒ½ä¸ä¼šè¿‡æ‹Ÿåˆï¼Œä½†è¿™ä¸æ˜¯æˆ‘ä»¬åœ¨è¿™é‡Œè¦è®¨è®ºçš„å†…å®¹ã€‚

æ€»çš„æ¥è¯´ï¼ŒæŒºå¥½çœ‹çš„ã€‚æ˜¯æ—¶å€™æå–æ¨¡å‹å¯¹æ–œç‡å’Œæˆªè·çš„äº†è§£äº†ã€‚

# ç»“æœ

ç”±äºè¿™ä¸ªæå–è¿‡ç¨‹ä¸æ˜¯å®Œå…¨æ˜¾è€Œæ˜“è§çš„ï¼Œæ‰€ä»¥è®©æˆ‘å‘æ‚¨å±•ç¤ºä¸€ä¸‹æˆ‘æ˜¯å¦‚ä½•åšåˆ°çš„ã€‚

```
import matplotlib.pyplot as plt

# extract the means and standard deviations of the slopes
posteriors = rolling_linear_trace.posterior.slopes.values
slopes_means = posteriors.reshape(4000, len(data)).mean(0)
slopes_stds = posteriors.reshape(4000, len(data)).std(0)

# plot
plt.figure(figsize=(16, 8))
plt.fill_between(
    range(len(data)),
    slopes_means - 2*slopes_stds,
    slopes_means + 2*slopes_stds,
    alpha=0.33,
    label='$\mu \pm 2\sigma$'
)
plt.plot(slopes_means, linewidth=1, label='$\mu$')
plt.title('Slope over time')
plt.xlabel('Time')
plt.legend()
```

æ‚¨ä¼šæ”¶åˆ°ä»¥ä¸‹å†…å®¹:

![](img/689a2167142aae2e2b8d32d3d1eefe57.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

è¿™çœ‹èµ·æ¥æ¯”ä»¥å‰å¥½å¤šäº†ï¼Œå¯¹å§ï¼Ÿå®ƒéå¸¸å¹³æ»‘ï¼Œå¹¶ä¸”æœ‰å¾ˆå¥½çš„å›¾æ¡ˆï¼Œå½“ç„¶è¿™å¹¶ä¸è¡¨ç¤ºç»“æœæ˜¯æ­£ç¡®çš„ã€‚ä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘å¯ä»¥å‘Šè¯‰ä½ ï¼Œç»“æœæ˜¯ç›¸å½“å‡†ç¡®çš„ï¼Œå› ä¸ºæˆ‘è‡ªå·±åˆ›å»ºäº†åœ°é¢çœŸç›¸å’Œæ•°æ®é›†ã€‚è®©æˆ‘æŠŠéšæ—¶é—´å˜åŒ–çš„çœŸå®æ–œç‡ä¹Ÿæ”¾å…¥å›¾ä¸­:

![](img/e6bc7896302b5694fb879d2be939df16.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

è¿™æ˜¯æ‹¦æˆªçš„ç»“æœã€‚æ­£å¦‚æ‚¨åœ¨è¿™é‡Œçœ‹åˆ°çš„ï¼Œå®ƒä»¬ä¹Ÿæ˜¯æ­£ç¡®çš„:

![](img/43f7291db1aec90e61baff96328f31bb.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

å› æ­¤ï¼Œä½¿ç”¨é«˜æ–¯éšæœºæ¸¸èµ°çš„*è´å¶æ–¯æ»šåŠ¨å›å½’æ–¹æ³•*(å¤šä¹ˆå¥½çš„ä¸€ä¸ªè¯ï¼Œå—¯)åœ¨è¿™ç§æƒ…å†µä¸‹å·¥ä½œå¾—å¾ˆå¥½ï¼Œåœ¨æ‚¨çš„æƒ…å†µä¸‹ä¹Ÿå¯èƒ½å¦‚æ­¤ã€‚æ¯å½“æ‚¨è§‰å¾—å‚æ•°å¯èƒ½ä¼šéšæ—¶é—´æˆ–è·¨ä»»ä½•å…¶ä»–ç»´åº¦å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‚¨éƒ½å¯ä»¥å°è¯•ä¸€ä¸‹ï¼

# ç»“è®º

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼Œå°†å‚æ•°æ¨¡å‹ä¸­çš„å‚æ•°è§†ä¸ºå›ºå®šå‚æ•°æœ‰æ—¶æ˜¯æ²¡æœ‰ç›®çš„çš„ã€‚ç”±äºè¾“å…¥å’Œè¾“å‡ºæ•°æ®ä¹‹é—´çš„å…³ç³»ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œå˜åŒ–ï¼Œå› æ­¤æ¨¡å‹ä¹Ÿå¿…é¡»èƒ½å¤Ÿè°ƒæ•´å…¶å‚æ•°ã€‚å¦åˆ™ï¼Œå®ƒå¯èƒ½ä¼šæƒ¨è´¥ã€‚

æˆ‘ä»¬å·²ç»è®¨è®ºäº†ä¸€ç§ç®€å•çš„æ»šåŠ¨çª—å£æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•æ˜“äºç†è§£å’Œå®ç°ï¼Œä½†æ˜¯éå¸¸ä¸ç¨³å®šï¼Œå› ä¸ºå®ƒå–å†³äºè¶…å‚æ•°*çª—å£é•¿åº¦*ï¼Œè€Œæˆ‘ä»¬ä¸çŸ¥é“å¦‚ä½•æ­£ç¡®è®¾ç½®ã€‚

ä½œä¸ºè¡¥æ•‘æªæ–½ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªè´å¶æ–¯æ»šåŠ¨å›å½’æ¨¡å‹ä½¿ç”¨é«˜æ–¯éšæœºæ¸¸èµ°ã€‚å®ƒè¿è¡Œè‰¯å¥½ï¼Œéå¸¸çµæ´»ã€‚æ‚¨å¯ä»¥æ‰©å±•è¿™ä¸ªæ¨¡å‹æ¥åŒ…å«æ›´å¤šçš„ç‰¹æ€§ï¼Œä½†æ˜¯æ‚¨ä¹Ÿå¯ä»¥å›ºå®šä¸€äº›å‚æ•°ï¼Œåªè®©å…¶ä¸­çš„ä¸€äº›å‘ç”Ÿå˜åŒ–ã€‚æ— è®ºä½•æ—¶ï¼Œå½“æ‚¨æƒ³è¦å¯è§†åŒ–éšæ—¶é—´çš„å˜åŒ–æ—¶ï¼Œåœ¨æ‚¨çš„æ¸…å•ä¸­æœ‰è¿™ä¸ªæ¨¡å‹æ˜¯éå¸¸å¥½çš„ã€‚

ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œè¯¥æ¨¡å‹ä»…ç”¨äº**æ¨ç†**ï¼Œå³ç¡®å®šå‚æ•°ã€‚é¢„æµ‹æœªæ¥æ˜¯å¾ˆå›°éš¾çš„ï¼Œå› ä¸ºéšæœºè¡Œèµ°çš„éšæœºæ€§ä¼šç»™ä½ æœªæ¥æ›´å¤§çš„ä¸ç¡®å®šæ€§ã€‚è¦åˆ›å»ºé¢„æµ‹ï¼Œæ‚¨å¯ä»¥å°è¯•æ‰¾åˆ°æ–œç‡ã€æˆªè·å’Œæ‰€æœ‰å…¶ä»–å‚æ•°éšæ—¶é—´å˜åŒ–çš„å…¬å¼ï¼Œå¹¶åœ¨æ‚¨çš„æ¨¡å‹ä¸­ä½¿ç”¨è¯¥å…¬å¼ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æœ‰*a*(*t*)= sin(*t*/20)/3 å’Œ *b* ( *t* ) = âˆš *tï¼Œ*ï¼Œå› æ­¤æœ€ç»ˆçš„æ¨¡å‹æ–¹ç¨‹ä¸º*y*= sin(*t*/20)/3 **x*+âˆš*t .*

![](img/faee6bd3493448675e7a9729e5d1d8e4.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚*** 

***æˆ‘å¸Œæœ›ä½ ä»Šå¤©å­¦åˆ°äº†æ–°çš„ã€æœ‰è¶£çš„ã€æœ‰ç”¨çš„ä¸œè¥¿ã€‚æ„Ÿè°¢é˜…è¯»ï¼***

*****ä½œä¸ºæœ€åä¸€ç‚¹ï¼Œå¦‚æœä½ *****

1.  *****æƒ³æ”¯æŒæˆ‘å¤šå†™ç‚¹æœºå™¨å­¦ä¹ å’Œ*****
2.  *****æ— è®ºå¦‚ä½•ï¼Œè®¡åˆ’è·å¾—ä¸€ä¸ªä¸­ç­‰è®¢é˜…é‡ï¼Œ*****

*****ä¸ºä»€ä¹ˆä¸åš** [**é€šè¿‡è¿™ä¸ªç¯èŠ‚**](https://dr-robert-kuebler.medium.com/membership) **ï¼Ÿè¿™å°†å¯¹æˆ‘å¸®åŠ©å¾ˆå¤§ï¼ğŸ˜Š*****

***é€æ˜åœ°è¯´ï¼Œç»™ä½ çš„ä»·æ ¼ä¸å˜ï¼Œä½†å¤§çº¦ä¸€åŠçš„è®¢é˜…è´¹ç›´æ¥å½’æˆ‘ã€‚***

***éå¸¸æ„Ÿè°¢ï¼Œå¦‚æœä½ è€ƒè™‘æ”¯æŒæˆ‘çš„è¯ï¼***

> ****å¦‚æœ‰é—®é¢˜ï¼Œåœ¨*[*LinkedIn*](https://www.linkedin.com/in/dr-robert-k%C3%BCbler-983859150/)*ä¸Šå†™æˆ‘ï¼****