# å°†æ‚¨çš„æ•°æ®åˆ†æä¸ Google Workspace å’Œ Google äº‘å­˜å‚¨ç›¸é›†æˆ

> åŸæ–‡ï¼š<https://towardsdatascience.com/integrating-your-data-analysis-with-google-workspace-and-google-cloud-storage-f80649404bb0?source=collection_archive---------27----------------------->

## å¦‚ä½•ä½¿ç”¨ Python ä»äº‘ä¸­åŠ è½½æ–‡ä»¶

![](img/d33c36600035ce11f6d484e5596cb1c0.png)

é©¬æ–‡Â·è¿ˆè€¶åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šçš„ç…§ç‰‡

# 1.ä»‹ç»

åä½œæ˜¯å½“ä»ŠæˆåŠŸçš„æ•°æ®å›¢é˜Ÿçš„å…³é”®å› ç´ ä¹‹ä¸€ã€‚æ‚¨çš„å›¢é˜Ÿäº¤æµå’Œå…±äº«ä¿¡æ¯çš„æ–¹å¼ä¼šå¯¹æ‚¨å…¬å¸çš„ç”Ÿäº§åŠ›äº§ç”Ÿé‡å¤§å½±å“ã€‚

> ä¸å¹¸çš„æ˜¯ï¼Œå¤§å¤šæ•°å…¬å¸ä»ç„¶ä¾èµ–äºé€šè¿‡ç”µå­é‚®ä»¶å’Œå…¶ä»–é€šä¿¡å¹³å°å…±äº« CSV å’Œ Excel æ–‡ä»¶ï¼Œè¿™ç§åšæ³•æŸå®³äº†æ•°æ®çš„ä¸€è‡´æ€§å’Œå®‰å…¨æ€§ã€‚

å› æ­¤ï¼Œä½¿ç”¨æ­£ç¡®çš„å·¥å…·å…±äº«æ•°æ®æ–‡ä»¶å¯ä»¥æé«˜æ‚¨çš„åˆ†æé‡ç°æ€§ï¼Œå¹¶å¸®åŠ©æ‚¨çš„å›¢é˜Ÿæé«˜ç”Ÿäº§ç‡ã€‚

**æœ¬æ–‡çš„ç›®æ ‡æ˜¯ä»‹ç»å‡ ç§ä½¿ç”¨**[**Google Workspace**](https://workspace.google.com/)**å’Œ** [**Google äº‘å­˜å‚¨**](https://cloud.google.com/storage) **çš„æ•°æ®å…±äº«æ›¿ä»£æ–¹æ¡ˆã€‚**

ä¸‹é¢ä»‹ç»çš„æ¯ä¸ªå‡½æ•°çš„æ•™ç¨‹å’Œä»£ç å¯ä»¥åœ¨æˆ‘çš„ [GitHub åº“](https://github.com/GabrielSGoncalves/integrating_data_analysis_with_gcloud)ä¸­æ‰¾åˆ°ã€‚

# 2.è°·æ­Œäº‘ç¯å¢ƒ

è°·æ­Œæ˜¯äº‘èµ„æºå’Œå­˜å‚¨çš„ä¸»è¦æä¾›å•†ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯é¢å‘å„ç§ç»ˆç«¯ç”¨æˆ·çš„å¯è®¿é—®è§£å†³æ–¹æ¡ˆã€‚ **Google Drive å’Œ Sheets æ˜¯ Google Workspace(å‰èº«ä¸º GSuite)** çš„çƒ­é—¨æœåŠ¡éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯å¤„ç†è¡¨æ ¼æ•°æ®å’Œå­˜å‚¨æ–‡ä»¶çš„ä¸»è¦å·¥å…·ä¹‹ä¸€ã€‚è°·æ­Œè¿˜é€šè¿‡å…¶è°·æ­Œäº‘å¹³å°(GCP)ä¸ºä¼ä¸šæä¾›äº‘æœåŠ¡ã€‚**äº‘å­˜å‚¨æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨æ–‡ä»¶çš„ GCP æœåŠ¡**(ç±»ä¼¼äº AWS S3)ã€‚

è¿™äº›æœåŠ¡å…è®¸ç”¨æˆ·åœ¨æ¶‰åŠæ•°æ®äº§å“ã€åˆ†æå’Œæ•°æ®ç§‘å­¦çš„é¡¹ç›®ä¸­è¿›è¡Œåä½œã€‚å› æ­¤ï¼Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨æ¯ä¸ªå·¥å…·çš„æ­£ç¡®ç‰¹æ€§å¯ä»¥å¸®åŠ©æ‚¨çš„å›¢é˜Ÿå¼€å‘æ¶‰åŠæ•°æ®å…±äº«çš„æœ€ä½³å®è·µã€‚

# 3.åŠ è½½å…¬å…±æ–‡ä»¶

ä¸€äº›æ¶‰åŠæ•°æ®çš„é¡¹ç›®å¯èƒ½è¦æ±‚æ‚¨å…¬å¼€æ‚¨çš„æ•°æ®é›†ï¼Œä»¥ä¾¿å…¶ä»–äººå¯ä»¥è®¿é—®å®ƒã€‚ç§‘å­¦æœŸåˆŠã€æ”¿åºœã€éæ”¿åºœç»„ç»‡å’Œè®¸å¤šå…¶ä»–æœºæ„å¯èƒ½éœ€è¦æä¾›å¯¹æ•°æ®çš„å¼€æ”¾è®¿é—®ï¼Œå› æ­¤ä¸‹é¢æè¿°çš„å·¥å…·æ˜¯è®¿é—®å­˜å‚¨åœ¨ Google Sheets æˆ– Drive ä¸­çš„å¼€æ”¾æ•°æ®çš„æ›¿ä»£æ–¹æ³•ã€‚

## 3.1.è°·æ­Œå·¥ä½œè¡¨

Google Sheets æ˜¯ä¸€ä¸ªåœ¨çº¿ç”µå­è¡¨æ ¼ç¼–è¾‘å™¨(ç±»ä¼¼äº Microsoft Excel ),å…è®¸ç”¨æˆ·å¤„ç†è¡¨æ ¼æ•°æ®ã€‚ç”±äºæˆ‘ä»¬å¤„ç†çš„å¤§éƒ¨åˆ†æ•°æ®éƒ½æ˜¯ä»¥è¡¨æ ¼çš„å½¢å¼ç»„ç»‡çš„ï¼Œæ‰€ä»¥ä½¿ç”¨è¡¨æ ¼æ¥ç»„ç»‡å’Œå­˜å‚¨åŸºæœ¬åˆ†æä¼šéå¸¸æ–¹ä¾¿ã€‚

è¦å…¬å¼€æ‚¨çš„å·¥ä½œè¡¨æ–‡æ¡£ï¼Œæ‚¨éœ€è¦ç‚¹å‡»**å…±äº«>å‘å¸ƒåˆ° web** ã€‚

![](img/384b49988a29ff670429117e7c9fa351.png)

æ¥ä¸‹æ¥ï¼Œ**é€‰æ‹©ä¸€ä¸ªå·¥ä½œè¡¨**å’Œæ–‡æ¡£ç±»å‹ä¸º**é€—å·åˆ†éš”å€¼(ã€‚csv)ï¼Œ**å¹¶å¤åˆ¶åˆ›å»ºçš„é“¾æ¥ã€‚

![](img/f6a09297f5808539cf8faf5cf75103af.png)

å‡½æ•°`read_public_sheets`æ¥æ”¶æ‚¨åˆšåˆšåˆ›å»ºçš„é“¾æ¥ï¼Œå¹¶è¿”å›ä¸€ä¸ª Pandas æ•°æ®å¸§ï¼Œè¿™æ˜¯å°†è¡¨æ ¼ç›´æ¥åŠ è½½åˆ° Jupyter ç¬”è®°æœ¬çš„ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚

```
# Loading a Public Google Sheets as a Pandas Dataframe
sheet_url = '<url to a Google Sheets>'df_sheet_public = read_public_sheets(sheet_url)
```

## 3.2.Google Drive

Google Drive æ˜¯å­˜å‚¨ä»»ä½•æ–‡ä»¶æ ¼å¼çš„ç»ä½³å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚å…¬å¼€å¯ç”¨çš„æ•°æ®é›†å¯ä»¥ä»¥ä¸åŒçš„æ ¼å¼æ‰¾åˆ°ï¼Œå¦‚ csvã€xlsxã€json æˆ– parquetã€‚è¦è®¿é—®æ–‡ä»¶ï¼Œè¯·æ‰“å¼€ Google Drive æ–‡ä»¶å¤¹ï¼Œå³é”®å•å‡»æ‰€éœ€æ–‡ä»¶ï¼Œå•å‡»**è·å–é“¾æ¥**ï¼Œé€‰æ‹©é€‰é¡¹**ä»»ä½•æœ‰é“¾æ¥çš„äºº**ï¼Œç„¶åå¤åˆ¶åˆ›å»ºçš„é“¾æ¥ã€‚

![](img/881f645c9ed22f8b2f810ef55dfadf62.png)

å‡½æ•°`read_public_file_from_gdrive`æ¥æ”¶å­˜å‚¨åœ¨ Google Drive ä¸­çš„æ–‡ä»¶çš„å¤åˆ¶ URLï¼Œå¹¶è¿”å›ä¸€ä¸ª Pandas Daframe(å¯¹äº csv æˆ– xlsx æ–‡ä»¶)æˆ–ä¸€ä¸ªå­—å…¸(å¯¹äº json æ–‡ä»¶)ã€‚

```
# Example on how to load a CSV file from Google Drive
link_to_csv = '<url to a Google Drive file>'df_public_csv = read_public_file_from_gdrive(
    link_to_csv,
    "csv"
)
```

# 4.åŠ è½½ç§æœ‰æ–‡ä»¶

ç”±äºå…¬å¸å†…éƒ¨å…±äº«çš„å¤§å¤šæ•°æ•°æ®æ–‡ä»¶éƒ½æ˜¯ç§æœ‰çš„ï¼Œä¸ºäº†é˜²æ­¢æ•°æ®æ³„éœ²ï¼Œæ‚¨è¿˜éœ€è¦ä½¿ç”¨æŸç§èº«ä»½éªŒè¯æ¥è®¿é—®è¿™äº›æ–‡ä»¶ã€‚

åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•è®¿é—®è°·æ­Œäº‘æœåŠ¡æ¥è·å–ä¸å…¬å¼€çš„æ–‡ä»¶ã€‚

## 4.1.è°·æ­Œå·¥ä½œè¡¨

æˆ‘ä»¬å°†ä½¿ç”¨[**gspread**](https://github.com/burnash/gspread)Python æ¨¡å—ä¸ Google Sheets è¿›è¡Œäº¤äº’ã€‚ä¸ºäº†è®¿é—®ç§äººæ–‡ä»¶ï¼Œé¦–å…ˆï¼Œä½ éœ€è¦å®šä¹‰ä½ çš„å‡­è¯ã€‚[è¯·éµå¾ªå®˜æ–¹æ–‡ä»¶ä¸Šçš„è¯´æ˜](https://docs.gspread.org/en/latest/oauth2.html#)ã€‚ä½¿ç”¨æ‚¨çš„æœåŠ¡å‡­è¯ä¸‹è½½ JSON æ–‡ä»¶åï¼Œæ‚¨è¿˜éœ€è¦å°†**æœåŠ¡å¸æˆ·ç”µå­é‚®ä»¶æ·»åŠ åˆ° Sheets æƒé™ç”µå­é‚®ä»¶åˆ—è¡¨** ( **å…±äº«>æ·»åŠ äººå‘˜å’Œç»„**)ã€‚

è¦è¿è¡Œå‡½æ•°`read_private_sheets`ï¼Œæ‚¨éœ€è¦å°†è·¯å¾„ä¼ é€’ç»™æ‚¨çš„`credentials_json`ã€æ‚¨çš„`sheet_url`å’Œç›®æ ‡`worksheet`(åç§°æˆ–ç´¢å¼•)ã€‚

```
# Loading a private Google Sheets
gcloud_credentials = '<path to service credentials JSON>'
sheet_url = '<url to a Google Sheets>'df_private_sheet = read_private_sheets(gcloud_credentials, sheet_url, 0)
```

## 4.2.Google Drive

è¦ä» Google Drive è®¿é—®ç§æœ‰æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [**PyDrive2**](https://github.com/iterative/PyDrive2) ï¼Œè¿™æ˜¯ä¸€ä¸ª Python åº“ï¼Œå®ƒç®€åŒ–äº†ä¸ Google Drive API V2 çš„äº¤äº’ã€‚å‡½æ•°`read_private_file_from_gdrive`èƒ½å¤Ÿè¯»å– 5 ç§ä¸åŒçš„æ–‡ä»¶æ ¼å¼(csvã€xlsxã€parquetã€json æˆ– txt)ï¼Œæ‚¨åªéœ€æä¾›åˆ°å®ƒçš„é“¾æ¥(`file_url`ï¼Œä¸ä¼šè¯ 3.2 ä¸­æè¿°çš„é“¾æ¥ç›¸åŒã€‚)ã€`file_format`å’Œ`google_auth`(å‡­è¯)ã€‚è¦ç”Ÿæˆè®¿é—® Google Drive ä¸Šç§äººæ–‡ä»¶æ‰€éœ€çš„å‡­è¯ï¼Œè¯·éµå¾ª [Pydrive2 æ–‡æ¡£](https://docs.iterative.ai/PyDrive2/quickstart/)ä¸­æè¿°çš„æ­¥éª¤ã€‚

```
from pydrive2.auth import GoogleAuth
from gcloud_data_analysis_functions import read_private_file_from_gdrive# 1\. Authenticate using OAuth2.0
gauth = GoogleAuth()
gauth.LocalWebserverAuth()# 2\. Access a private parquet from a Google Drive
file_url_parquet = '<url to a Google Drive Parquet>'
df_parquet_gdrive = read_private_file_from_gdrive(file_url_parquet, "parquet", gauth)
```

å½“ä½ åœ¨`#1`ä¸Šè¿è¡Œä»£ç æ—¶ï¼Œå¦‚æœæˆåŠŸç”Ÿæˆäº†å‡­è¯ï¼Œå°±ä¼šæ˜¾ç¤ºä¸€ä¸ªæŒ‡å‘è°·æ­Œè´¦æˆ·è®¤è¯çš„é“¾æ¥ã€‚é€‰æ‹©æ‚¨çš„å¸æˆ·å¹¶å…è®¸å…¶è®¿é—®æœåŠ¡ã€‚

åœ¨`#2`ä¸Šï¼Œä½ åªéœ€è¦é€šè¿‡`gauth` (Google Auth Object)ï¼Œå¸¦ç€æ–‡ä»¶é“¾æ¥å’Œæ ¼å¼ï¼Œå°±å¯ä»¥åŠ è½½æƒ³è¦çš„å†…å®¹äº†ã€‚

## 4.3.è°·æ­Œäº‘å­˜å‚¨

äº‘å­˜å‚¨æ˜¯åœ¨ä¼ä¸šç¯å¢ƒä¸­å­˜å‚¨/å…±äº«æ•°æ®çš„ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºå®ƒæä¾›äº†ä¸€ç§å®‰å…¨çš„æ–¹å¼æ¥å®šä¹‰ç”¨æˆ·å¯¹æ–‡ä»¶çš„è®¿é—®ã€‚å› æ­¤ï¼Œå°½ç®¡æ‚¨å¯èƒ½å°†æ–‡ä»¶å¤¹å®šä¹‰ä¸ºå…¬å…±æ–‡ä»¶å¤¹ï¼Œä½†ä¸‹é¢çš„ç¤ºä¾‹å°†æè¿°å¦‚ä½•ä½¿ç”¨ GCP å‡­è¯åŠ è½½ç§æœ‰æ–‡ä»¶ã€‚[è¦åˆ›å»ºä¸€ä¸ª](https://developers.google.com/identity/protocols/oauth2?hl=en) `[gcp_credentials](https://developers.google.com/identity/protocols/oauth2?hl=en)` [jsonï¼Œè¯·è·Ÿéšå®˜æ–¹é¡µé¢ã€‚](https://developers.google.com/identity/protocols/oauth2?hl=en)

å‡½æ•°`read_file_from_gcloud_storage`èƒ½å¤Ÿè¯»å– 5 ç§ç±»å‹çš„`file_format` : csvã€xlsxã€parquetã€json æˆ– txtã€‚è¦å®šä¹‰è¦åŠ è½½çš„ç‰¹å®šæ–‡ä»¶ï¼Œæ‚¨éœ€è¦æä¾›`file_name`ã€`gcp_bucket`å’Œ`gcp_project`ä½œä¸ºå‚æ•°ã€‚

```
df_from_storage = read_file_from_gcloud_storage(
    "<file name>",
    "<file format>",
    "<bucket name>",
    "<GCP project name>",
    "<path to GCP credentials json>",
)
```

# 5.ä¸€é”¤å®šéŸ³

æˆ‘å¸Œæœ›æ‚¨å’Œæ‚¨çš„å›¢é˜Ÿéƒ½èƒ½ä»æœ¬æ–‡ä»‹ç»çš„åŠŸèƒ½ä¸­å—ç›Šï¼Œé¿å…é€šè¿‡ç”µå­é‚®ä»¶æˆ–è§†é¢‘èŠå¤©è½¯ä»¶å…±äº«æ•°æ®æ–‡ä»¶ã€‚é€šè¿‡ä½¿ç”¨ Google äº‘æœåŠ¡å…±äº«æ‚¨çš„æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥æé«˜è·¨å›¢é˜Ÿçš„æ•°æ®ä¸€è‡´æ€§ï¼Œå¹¶å¸®åŠ©åœ¨æ‚¨çš„å…¬å¸å†…éƒ¨åˆ›å»ºæ•°æ®å®‰å…¨æ€§å’Œæ„è¯†ã€‚

å¦‚ç®€ä»‹ä¸­æ‰€è¿°ï¼Œä½ å¯ä»¥åœ¨æˆ‘çš„ [**GitHub èµ„æºåº“ä¸­æ‰¾åˆ°**ä»£ç **å’Œä¸€æœ¬ Jupyter ç¬”è®°æœ¬**æ•™ç¨‹**ã€‚**](https://github.com/GabrielSGoncalves/integrating_data_analysis_with_gcloud)

å¦‚æœæ‚¨å¯¹æ‰€å±•ç¤ºçš„ä¸»é¢˜æœ‰ä»»ä½•å»ºè®®ï¼Œè¯·éšæ—¶å†™ä¿¡ç»™æˆ‘ğŸ˜‰ï¼

# éå¸¸æ„Ÿè°¢ä½ é˜…è¯»æˆ‘çš„æ–‡ç« ï¼

*   ä½ å¯ä»¥åœ¨æˆ‘çš„[ä¸ªäººèµ„æ–™é¡µé¢](https://medium.com/@gabrielsgoncalves) **æ‰¾åˆ°æˆ‘çš„å…¶ä»–æ–‡ç« ğŸ”¬**
*   å¦‚æœä½ å–œæ¬¢å®ƒå¹¶ä¸”**æƒ³æˆä¸ºä¸­çº§ä¼šå‘˜**ï¼Œä½ å¯ä»¥é€šè¿‡æˆ‘çš„ [**æ¨èé“¾æ¥**](https://medium.com/@gabrielsgoncalves/membership) æ¥æ”¯æŒæˆ‘ğŸ‘