# 面向数据科学家的干净代码

> 原文：<https://towardsdatascience.com/clean-code-for-data-scientists-db1d88c42fab?source=collection_archive---------24----------------------->

![](img/2a71be3685c3e6b2dd55f3518261f4b2.png)

[JESHOOTS.COM](https://unsplash.com/@jeshoots?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍照

## 第 2 部分—方法

如果你在这里，这意味着**你理解干净代码的重要性，并且你想掌握它**。太神奇了。正如我在[上一篇文章](https://medium.com/p/6fc90872398f)中提到的，你的意图和想法将会完成大部分工作。让我们添加一些实用的提示，你就可以开始了。

# 我想写干净的代码，但是怎么做呢？

如果你真的很认真，你想知道整个理论，我推荐阅读罗伯特·c·“鲍勃叔叔”马丁的**《干净代码:敏捷软件工艺手册》**。但是，如果您没有时间，或者您正在寻找更多面向数据科学的技巧，那也没关系。我将与你分享我的两分钱和我所学习和使用的东西。

但是，我必须警告你，从现在开始——这只是建议。没有对错之分(比如命名惯例)，**你只需要坚持某件事**。另外，可能还有更多指导方针，我只是列出了最适合我的和我认为最方便的:

*   将您的代码质量与草稿级别相匹配
*   童子军规定——让露营地比你发现时更干净
*   保持简单
*   深思熟虑地命名变量、类和函数
*   确保你的函数很短，只做一件事，并且没有副作用
*   报纸文章——脚本的顶部应该是最顶层的函数，越往下越详细
*   少即是多——简短，无评论

# 将您的代码质量与草稿级别相匹配

正如我在[上一篇文章](https://medium.com/p/6fc90872398f)中提到的，作为数据科学家，编写干净代码的挑战之一是，很多时候，我们开始一个项目(POC/数据探索),我们不确定它是否可行，以及我们是否会再次使用它。因此**很难(当然也没有回报)投入很多时间为这些情况编写干净的代码**。当它工作时，问题出现了，我们将它集成到我们的解决方案中，并在生产中发现这个写得很差的代码。

克服这个问题的方法——不要在探索性代码上投入太多，但要保持现实生活中的解决方案整洁，就是使代码质量与草稿水平相匹配。

我说的代码质量是什么意思？为了更好地定义代码质量，我把我的代码分成三个质量等级。

## 1.一团糟

想象一下你自己正在尝试一种你刚刚学到的新算法，检查它是否对你的数据有效，或者得到一个新的数据集并了解其中的内容。它将是**快速而肮脏的**——没有花哨的类，没有经过深思熟虑的变量名，您可能会将您的数据框命名为“df ”,而这一切都将被扔进一个脚本中，就像您在洗衣篮中的衣服一样。

## 2.相对可读的代码

这可能不是最棒的一段代码，但是**其他人将能够理解**发生了什么。变量名应该有意义，应该很好地划分成函数或类。它不会遵循所有的协议，可能不包括单元测试，但它是一个开始和重构的好地方。

## 3.最重要的是——代码的蒙娜丽莎

这是将授予你诺贝尔奖最伟大的代码工匠转变的代码。是的，我可能夸大了。这是**生产级代码**，所以它应该反映出你所得到的最好的东西，并且**符合你希望遵循的所有准则**，因为你会希望这段代码在未来尽可能地不受 bug 影响，并且最容易维护(无论是你自己还是你的团队成员)。

现在，考虑到这些质量水平，我根据任务及其成熟度匹配我的写作水平，并让它沿着这条路发展:

*   如果你正在编写一个**低风险算法**并且你对自己的方法有把握，那么从一个**高水平的代码质量**(介于 2 到 3 之间)开始。
*   如果您正在开始 POC、实施**高风险算法、**或进行可能是一次性的数据探索，**从 1 开始，随着您的进步并了解什么可行，什么不可行，逐渐过渡到 2** 。这样，你从低质量的代码开始，快速前进，尝试不同的方法、算法等。并在您开始看到潜力时改进您的代码。
*   出于任何其他目的，使用 2 并逐渐将其向上移动至 3 以准备释放。
*   最重要的规则是**永远不要留下乱七八糟的代码**！在进入之前，基本上进行重构，同时你还记得你试图实现什么以及如何实现。留下的杂乱代码在未来将是无用的，你可能不得不重写它。

# 一般准则

## **童子军规则**

如果要我说出我的第一条规则，那就是童子军规则。童子军规定各州要保持营地比你发现时干净。或者在我们的例子中— **总是让代码比你发现的更好**。这是什么意思？

*   在团队中工作时，不要害怕改变别人的代码。当你遇到一个写得不好的代码，不管是大的还是小的，需要改变的时候——改变它。你不需要请求许可或仔细考虑——**这是你的职责**。
*   独自工作时——**重新审视自己的代码时修改它**，不断重构和编辑以使它变得更好。
*   应用童子军规则将确保您的代码库始终处于最高水平。
*   当你在高质量测试和高测试覆盖率的代码上工作时，遵循童子军规则是最简单的。这样，你会感到安全，因为重构不会造成任何伤害。然而，缺乏测试不应该阻止你重构。你总是可以写一些测试来确保功能保持不变并进行重构。

## 保持简单

第二个重要的指导方针是“保持简单”。我曾经得到一个很好的建议— **写代码的时候，用一半的脑细胞去读代码**。原因很明显——阅读代码要困难得多，所以我们在编写代码时应该以简单为目标。总是问自己——这能写得更简单吗？

# 命名规格

写代码就像讲故事，而你的名字选择是故事的一个重要部分。在编写代码时，确保你投入时间和精力在选择能透露尽可能多信息的名字上。

当你为你的函数/变量选择一个名字时，为了下一个阅读它的人(当然，可能是未来的你)，**这个名字创造了一个对那里将会有什么的期望**。这些期望是两个因素的结果:

*   该名称的**语义含义**。我们期望函数“def load_training_set()”加载数据，但我们不会期望它过滤掉空值，对吗？我们期望变量“student”代表一个人，所以如果它是一个列表，那就令人困惑了。
*   **格式**——**怎么写**。如果标准约定是用大写字母书写常量值，并且您将数据框命名为“TRAINING_DATA ”,那么您的代码可读性更差，也更难解释。

当在代码中命名一个实例时，你应该总是考虑你创建的**期望，并确保它匹配它的内容**。如果不是，重命名它。

以下指南包含一般建议和具体约定。需要注意的是**这种特殊的约定并不神圣，重要的是要有一个符合目的的一致约定**——让你的代码更具可读性，符合读者的期望，并且有一个标准化的代码库。

通常，在整个代码中，请注意以下几点:

*   连贯的术语——每个概念使用一个术语(例如，不要同时使用“获取”和“取得”来描述同一个动作)。
*   避免将同一个词用于两个目的。
*   使用变量名作为一种方式来说明代码正在做什么。

## 常量变量

用常量变量代替硬编码的字符串或整数，写成全大写:

*   例如，使用“CLASSIFICATION_THRESHOLD=0.8”代替 0.8。
*   给它们一个描述性的名称。
*   将它们放在代码的顶部或外部设置文件中。
*   阅读、搜索、更改值和测试将变得更加容易。

## 变量名

您的变量名应该是:描述性的、可发音的、可搜索的、解释性的、揭示意图的:

*   比如不用“df”，用“train_set”。
*   对数组和列表使用复数，而不是命名它们的类型。例如，用“学生”代替“学生列表”。
*   使用单词，而不是缩写。比如用“learning_rate”代替“lr”。
*   长总比暧昧好。

## 类名

您的类名应该是:

*   名词或名词短语，如分类器、数据处理程序。
*   避免使用通用名称，如管理器、处理器。

## 功能名称

您的函数名应该:

*   说他们做什么。
*   包含动词或动词短语名称，如“evaluate_model”。
*   尽可能具体。比如用“load_training_data”代替“load”。
*   模仿你告诉你朋友这个函数是做什么的方式
*   如果它们仅供本课程内部使用，则以 _ 开头。比如“_load_training_data”。

# 功能

*   应该是小的——把一个大的功能分成几个小的。
*   应该比那个小。
*   经验法则——不要超过 20 行。当一个函数中有这么多行代码时，很难理解它做了什么。但是如果你把它分成更小的块，每个块都有一个有意义的名字，那就完全是另外一回事了。
*   如果你发现自己在函数中寻找几行代码——它们应该是自己的函数。
*   每个函数应该做一件事，而且只做一件事。它要么做点什么，要么回答点什么，而不是两者都做。
*   不要重复自己——这就是函数的作用。如果需要——将函数拆分成更小的方法，然后重用它们。
*   没有副作用——不要改变任何你不应该改变的东西。
*   当调用一个函数时，总是写下参数名和它们的值。这将使它更容易阅读和理解。
*   参数越少越好—尽量避免超过 3 个参数。
*   尽量用函数封装复杂的条件句。例如，不使用“if (timer.has_expired()和(timer.is_recurrent())”，而是使用“if should_be_deleted(timer)”
*   避免消极条件句。例如，不使用“if (not follow_up_needed())”，而是使用“if (follow_up_not_needed()”。

# 格式化

格式化是你设计代码的方式——它看起来不需要深入到名字和动作中。正确的格式有两个目的:

1.  沟通——如果**你的变量/函数名是口头沟通，那么格式化就是非口头部分**。这说明了很多问题。如果您选择将两个函数一个接一个地放置，它可能会告诉读者它们是相关的，或者会一个接一个地运行。
2.  专注——一旦格式化做得很好，代码看起来有条理，它**释放你的思想去处理真正重要的东西——它的内容**。看着视觉上混乱的代码会转移你对其含义的注意力。

以下是我尝试在代码中应用的一些格式准则:

*   概念之间的垂直开放性——每行代码只做一件事。
*   每一个空行都是一个视觉提示，可以识别一个新的独立的概念，所以要明智地使用它。
*   相关代码(和相关函数)应该垂直排列。
*   声明与其用法相近的变量。

## 报社负责人

我最喜欢的格式指南之一是报纸原则，它指出你的脚本应该从高级功能开始**，并向下滚动**深入细节。

*   源文件的最上面部分应该提供高级的概念和算法。
*   随着我们向下移动，细节应该增加，直到最后，我们在源文件中找到最低级别的函数和细节。
*   这就像读报纸一样——你从顶部的标题开始，然后是副标题，然后是全文和细节。

# 少即是多

尽量保持代码简洁:

*   简短简短——你的代码越短，你阅读和理解它的速度就越快。当然，不是以一团糟为代价。你仍然需要为每一个动作写一行，但是尽量避免不必要的动作。
*   **删除注释掉的代码** —相信我，没有人会错过它。

## 争取零评论

你应该尽量在代码中没有注释——干净的代码不需要注释。

为什么？

*   **代码应该在 90%以上的时间里自我解释**——使用你的函数和变量名来解释，而不是注释。
*   我们经常在更新代码的时候**忘记更新注释**。
*   它增加了**杂波**。

如果您添加了评论:

*   不应该是关于你如何做某事，而应该是关于你为什么做这件事。
*   确保它是必要的，**非琐碎的，**而不是多余的。
*   使**尽可能短**。
*   随着代码的变化，删除过时的注释。
*   不要注释掉代码——只是删除它。

如果你想了解更多并看到一些真实的例子，我推荐这篇文章:

[https://towards data science . com/python-clean-code-6-best-practices-to-make-your-python-functions-more-readable-7ea 4c 6171d 60](/python-clean-code-6-best-practices-to-make-your-python-functions-more-readable-7ea4c6171d60)

> 总而言之，只要记住作为一名数据科学家，**你最好的算法只能和用**写的代码一样好。写得好的算法将是(尽可能接近)防错的，并且易于维护。它所需要的只是你的良好意愿，一些实用的知识和技巧，这些你现在都有了。让我知道进展如何！

参考资料:

1.  “干净的代码:敏捷软件工艺手册”，作者罗伯特·c·“鲍勃叔叔”马丁。
2.  [7 2 个理由心理学将帮助你写出更好的代码](https://www.youtube.com/watch?v=7IqUsAnqLdU)作者莫兰·韦伯&乔纳森·阿维诺尔(演讲用希伯来语)
3.  阿图罗·赫雷罗演讲中的干净代码幻灯片