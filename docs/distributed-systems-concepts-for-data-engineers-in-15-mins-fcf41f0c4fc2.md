# 15 分钟内面向数据工程师的分布式系统概念

> 原文：<https://towardsdatascience.com/distributed-systems-concepts-for-data-engineers-in-15-mins-fcf41f0c4fc2?source=collection_archive---------21----------------------->

## 了解现代 NoSQL 系统的内部细节

优秀的数据工程师和伟大的数据工程师的区别是什么？了解分布式系统概念有助于做出正确的大数据技术选择，以及编写更好的数据应用和管道。

举例来说，想象一下买一辆车。你通常会有几个不同的汽车模型，然后比较价格/性能，即发动机，变速器，制动等。同样，深入了解大数据系统有助于避开市场营销 [FUD](https://en.wikipedia.org/wiki/Fear,_uncertainty,_and_doubt) ，并有助于了解在正常的日常运营以及磁盘/节点故障、网络分区等故障期间会发生什么。

GIF 由 [giphy](https://giphy.com/gifs/greatbigstory-car-magic-ta-da-KB7JzQ2vcOLY7QOGWw)

分布式系统是一个广泛的话题——有 1000 多本关于几个方面的书，还有 1000 多位博士(我为这个数字贡献了+1)。

> 那么，如何在 15 分钟内涵盖分布式系统的概念呢？这是我快速理解任何分布式数据系统的秘方

***任何现代大数据系统/***[***NoSQL***](https://en.wikipedia.org/wiki/NoSQL)***系统如 Cassandra、MongoDB、HDFS、Ceph、Redis 等可以通过看 12 个设计概念来理解。*** 在这篇博客中，我分享了这些设计概念，并附有一个案例，用这些概念分析了 [HDFS](https://github.com/apache/hadoop) 、[卡珊德拉](https://github.com/apache/cassandra)、 [MongoDB](https://github.com/mongodb/mongo) 、 [Redis](https://github.com/redis/redis) ！

![](img/9fd66b41f4ef2eff9d45b6935cb7160e.png)

[unsplash](https://unsplash.com/photos/LqKhnDzSF-8)

# 1.聚类模型

聚类模型是任何大数据系统最重要和最显著的特征之一。群集模型定义了一种方法，通过这种方法，横向扩展群集中的各个节点可以协调管理资源、处理事件以及支持客户端的存储数据和元数据操作。概括地说，有三种流行的聚类模型:

*   ***主分类*** :在这个分类中，集群中有一个单独的节点(称为主节点)，专门负责管理集群状态，并协调活动/任务(稍后描述)。HDFS 是这种分类法的一个例子。
*   ***无主分类法*** :集群内的所有节点共同承担管理集群状态和活动的同等责任。这种分类法随着 Amazon 的 Dynamo paper 而流行，目前用于 OpenStack Swift、Cassandra 等系统。
*   *:这是单主分类的演变——全局主充当轻量级协调器，在集群内的节点之间划分集群管理任务。这与无主分类法形成对比，在无主分类法中，没有由整个集群维护的单个全局状态。Ceph、GPFS、Bigtable 都是这种分类法的例子。*

# *2.分片*

*分片指的是在集群内的节点之间划分数据和元数据操作服务职责的能力。一个好的分片算法可以在节点之间平均分配资源使用，包括传入请求和存储空间利用率。概括地说，分片策略可以分为三大类:*

*   **基于目录的查找*:名称空间分布在集群的节点上，有一个集中的目录来跟踪名称空间到节点的映射。*
*   **基于范围的查找*:这是无主系统中的常见模式。密钥空间被预先划分成多个范围，并分配给各个节点。基于该范围计算映射。*
*   **混合(基于目录+基于范围)*:使用组合—使用基于范围的分片结合基于确定性策略的功能来分布写入；读取遵循目录查找。*

# *3.可变性模型*

*可变性模型定义了更新现有数据的策略，并影响系统中其他服务的设计，即缓存、缓冲、一致性、磁盘布局、读/写模型。可变性模型有三大类:*

*   **就地:*更新直接写入现有数据位置被修改。*
*   *直接更新:数据在其原始位置直接更新。在这个模型中确保原子性需要阻塞同步，以及与缓冲模块的协调。*
*   *临时错位:更新被聚集在一个新的位置(从其原始位置)。这种持久性是暂时的，更新最终会更新原始数据。*
*   **不适当的*:对名字空间对象的更新被保存在新的资源位置(即，逻辑或物理地址)。与命名空间对象相关联的元数据被更新以反映该变化。*
*   **版本化*:更新作为对象的新版本被持久化。*

# *4.集群管理器服务*

*集群管理器服务负责跟踪组成员和故障。鉴于分布式系统的性质，节点可以不断地离开和加入集群。Cluster Manager 还负责跟踪副本的状态以及相应的纠正措施。该设计涉及 4 个构建模块:*

*   **跟踪成员和节点故障**
*   **完成 IO 操作*当一个或多个副本离线时(由于网络分区或节点停机)*
*   **离线副本的更新**
*   **跟踪复制品的滞后**

# *5.共识服务*

*一些分布式操作需要共识——io 和副本更新的排序、资源管理、集群创建、分布式锁定等。，是几个例子。Leader orchestrated 的设计选择有:*

*   **一致性编排*:一致性服务可以使用基于领导者的模型或基于仲裁的模型来实现。*
*   **领袖选举*:决定领袖实际选举方式*
*   *当选:使用 Paxos、2PC、ABD 等经典算法之一。*
*   *预选:这通常涉及一种启发，即挑选一个节点作为领导者来协调一致意见。*

# *6.高可用性服务*

*高可用性(HA)确保数据在集群级故障时仍可访问。该服务需要设计为处理三种常见的集群故障:*

*   **元数据节点故障*:对于主/多主架构，如 HDFS、HBase，其中命名空间元数据与数据分离。*
*   **数据节点故障*:负责命名空间子集的数据节点的处理。同样，对于像 Cassandra 这样数据和元数据共存的无主架构。*
*   **分区处理*集群中的多个节点受到影响(因网络故障而崩溃或断开)*

*实施故障切换的设计选项取决于副本的状态，即主动-主动、主动-被动(仅在故障期间提供数据)和主动-备份(仅在故障期间重建副本)。*

# *7.命名空间管理器服务*

*命名空间查找服务将命名空间转换为数据在群集中持久存储的位置。服务的设计有 3 个关键方面:*

*   **集群范围的元数据表示*:元数据是否直接映射到数据位置，而不是映射到对象管理器进行进一步翻译。*
*   **管理集群范围元数据的新鲜度*:它是完全物化的还是动态派生的。*
*   **对象查找*:翻译名称空间请求的架构模型*
*   **副本查找*:副本访问的架构模型*

# *8.一致性服务*

*一致性服务的目标是确保满足应用程序员的数据模型假设。例如，如果应用程序期望读取是原子的(即，总是最新的数据)，则需要由一致性服务来满足需求。该服务使用 4 个构件构建而成:*

*   **互斥(ME)原语* : RW 和 WW 互斥。*
*   **排序原语* : RW 和 WW 排序*
*   **原子性原语*:o-1 更新语义的单元*
*   **事务支持原语*:可以使用 ME、原子性和排序来实现不同形式的事务语义*

*保证的粒度可以是基于每个对象的，也可以是更宽的命名空间粒度，例如同一容器/目录内的对象。*

# *9.耐久性服务*

*数据持久性确保在发生硬件故障、组件损坏和软件错误时，数据丢失最少。最流行的数据持久性方法是创建多个数据副本。复制会带来空间使用方面的开销(例如，容量的 3 倍)，但在部分更新开销和恢复期间需要读取的数据量方面更便宜。相比之下，与复制相比，跨节点的擦除编码具有相反的利弊。随着全闪存环境的采用，擦除编码在最近的研究中备受关注。*

*建立耐久性服务需要决定以下设计方面:*

*   **耐久性模型*:定义如何实现冗余来处理硬件故障*
*   **副本字节级保真度*:定义副本与内容相似的程度*
*   **副本一致性*:不同层次的一致性语义*
*   **传播副本更新:*更新实际上是如何传播的*
*   **此外，选择副本协调器、订购副本更新、读取期间的副本选择、副本放置、副本访问、地理冗余协议**

# *10.对象管理器服务*

*对象管理器服务负责管理与命名空间对象相关联的资源。为了将数据保存在持久介质上，对象管理器将硬件抽象成一个资源单元。设计对象管理器涉及以下 5 个方面:*

*   **资源单元*:从持久介质中读取/写入数据的最小级别。该单元可以是文件、块、存储器地址。*
*   **名称空间到资源单元*:名称空间对象映射到单个还是多个资源单元*
*   **命名空间对象的元数据*:元数据是否和数据一起持久化在同一个资源单元内*
*   **垃圾收集*:如何回收空间*
*   **删除模式*:如何处理对象的删除*

# *11.缓存/缓冲服务*

*通常，写缓冲和分布式缓存是作为单独的服务实现的。*

*缓冲最初是为了弥补 CPU 和磁盘速度之间的差距而构建的。想法是将更新组合在一起，将它们写入持久的介质中(以避免每次操作的毫秒级延迟)。这类似于数据库中的组提交。缓存侧重于在内存中维护经常访问的数据，以减少磁盘流量并提高延迟性能。当存在工作负载访问的局部性时有用；也是预取数据的可预测模式。关键的设计方面是:*

*   **缓冲冲洗模式**
*   **缓冲读写一致性**
*   **放置缓存服务**
*   **缓存策略**
*   **缓存失效协议**

# *12.资源管理服务*

*资源管理服务决定数据在物理硬件上的实际布局。涉及三个设计方面:*

*   **磁盘布局*:不同的布局针对不同的访问模式和数据类型进行优化。*
*   **跨节点和磁盘条带化数据*:节点/服务器中有多个磁盘，集群中也有多个服务器。*
*   **考虑集群异构性*:这是一个重要方面，因为硬件是经过多代购买的，具有不同的属性。*

> *好奇这 12 个概念如何在现实世界的系统中发挥作用——这里是分析 [HDFS](https://github.com/apache/hadoop) 、[卡珊德拉](https://github.com/apache/cassandra)、 [MongoDB](https://github.com/mongodb/mongo) 、 [Redis](https://github.com/redis/redis) 的[表](https://docs.google.com/spreadsheets/d/e/2PACX-1vTUxMltMqe51ctuQZUF1dWOskU1YJPJiEPnE5Z9nke92e9JhiiBfiEmoRJMcpH3lZm0IODYc7STeC81/pubhtml?gid=0&single=true)*

*希望这篇博客能让你开始探索现代大数据系统的旅程。掌握的最好方法是选择一个开源项目，并尝试填写细节(类似于上面的示例案例研究)。**帮你入门，下面是** [**工作表**](https://docs.google.com/spreadsheets/d/16wgl3IincfTr-mcMj8MszHCoCc_gYTkYvU5qUfKN32o/edit?usp=sharing) **。***

*最后，以我个人的经验来看，了解分布式系统的内部会成为更好的数据工程师。我最喜欢引用莱斯利·兰波特的话:“在分布式系统中，一台你甚至不知道存在的计算机的故障会导致你自己的计算机无法使用。”*

## ****渴望进一步磨砺你的数据工程技能:****

*   *[**没有 DataOps 的 AI/ML 是白日梦**](/delivering-ai-ml-without-proper-dataops-is-just-wishful-thinking-2f1663d6b97f?sk=714c5af0f1952d008caf4a40121f19a6)*
*   *[**为什么可靠的元数据变得重要？**](/why-reliable-metadata-is-becoming-important-f29e01b01d4d?sk=b8671f29f7cdc872e5a0fe8042c15e5d)*
*   *[**ML 项目中可能出错的 98 件事**](/51-things-that-can-go-wrong-in-a-real-world-ml-project-c36678065a75)*