# é€šè¿‡å®ç°æ¥ç†è§£:k-æœ€è¿‘é‚»

> åŸæ–‡ï¼š<https://towardsdatascience.com/understanding-by-implementing-k-nearest-neighbors-469d6f84b8a9?source=collection_archive---------31----------------------->

## å»ºç«‹ä½ è‡ªå·±çš„æ¨¡å‹

## äº†è§£ k-æœ€è¿‘é‚»åˆ†ç±»å™¨çš„å·¥ä½œåŸç†å¹¶åœ¨ Python ä¸­å®ç°å®ƒ

![](img/2be62411c9ff41a002624a7d5adf26ea.png)

1-æœ€è¿‘é‚»åˆ†ç±»å™¨çš„åˆ¤å®šåŒºåŸŸã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

A ç¬¬äºŒå¤©ï¼Œå¦ä¸€ä¸ªç»å…¸ç®—æ³•:*k*-æœ€è¿‘é‚»å±…ã€‚åƒ[æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨](/learning-by-implementing-gaussian-naive-bayes-3f0e3d2c01b2)ä¸€æ ·ï¼Œè¿™æ˜¯è§£å†³åˆ†ç±»é—®é¢˜çš„ä¸€ä¸ªç›¸å½“ç®€å•çš„æ–¹æ³•ã€‚è¯¥ç®—æ³•éå¸¸ç›´è§‚ï¼Œå¹¶ä¸”å…·æœ‰æ— ä¸ä¼¦æ¯”çš„è®­ç»ƒæ—¶é—´ï¼Œè¿™ä½¿å¾—å®ƒæˆä¸ºæ‚¨åˆšåˆšå¼€å§‹æœºå™¨å­¦ä¹ ç”Ÿæ¶¯æ—¶å­¦ä¹ çš„ç»ä½³å€™é€‰ã€‚è¯è™½å¦‚æ­¤ï¼Œä½†åšå‡ºé¢„æµ‹æ˜¯æå…¶ç¼“æ…¢çš„ï¼Œå°¤å…¶æ˜¯å¯¹äºå¤§å‹æ•°æ®é›†ã€‚ç”±äº[ç»´æ•°ç¾éš¾](https://en.wikipedia.org/wiki/Curse_of_dimensionality)ï¼Œå…·æœ‰è®¸å¤šç‰¹å¾çš„æ•°æ®é›†çš„æ€§èƒ½å¯èƒ½ä¹Ÿä¸æ˜¯å‹å€’æ€§çš„ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨å°†äº†è§£åˆ°

*   k æœ€è¿‘é‚»åˆ†ç±»å™¨çš„å·¥ä½œåŸç†
*   ä¸ºä»€ä¹ˆå®ƒè¢«è®¾è®¡æˆè¿™æ ·
*   ä¸ºä»€ä¹ˆå®ƒæœ‰è¿™äº›ä¸¥é‡çš„ç¼ºç‚¹ï¼Œå½“ç„¶ï¼Œ
*   å¦‚ä½•ç”¨ NumPy åœ¨ Python ä¸­å®ç°ï¼Ÿ

å› ä¸ºæˆ‘ä»¬å°†ä»¥ scikit learn-conform çš„æ–¹å¼å®ç°åˆ†ç±»å™¨ï¼Œæ‰€ä»¥ä¹Ÿå€¼å¾—çœ‹çœ‹æˆ‘çš„æ–‡ç« [æ„å»ºæ‚¨è‡ªå·±çš„å®šåˆ¶ scikit-learn å›å½’](/build-your-own-custom-scikit-learn-regression-5d0d718f289)ã€‚ç„¶è€Œï¼Œscikit-learn çš„å¼€é”€å¾ˆå°ï¼Œæ— è®ºå¦‚ä½•æ‚¨éƒ½åº”è¯¥èƒ½å¤Ÿè·Ÿä¸Šã€‚

> *ä½ å¯ä»¥åœ¨* [*æˆ‘çš„ Github*](https://github.com/Garve/TDS/blob/main/TDS%20-%20KNN.ipynb) *ä¸Šæ‰¾åˆ°ä»£ç ã€‚*

# ç†è®º

è¿™ä¸ªåˆ†ç±»å™¨çš„ä¸»è¦æ€æƒ³éå¸¸ç®€å•ã€‚å®ƒç›´æ¥æ¥æºäºåˆ†ç±»çš„åŸºæœ¬é—®é¢˜:

> ç»™å®šä¸€ä¸ªæ•°æ®ç‚¹ xï¼Œx å±äºæŸç±» c çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿ

åœ¨æ•°å­¦çš„è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬æœç´¢æ¡ä»¶æ¦‚ç‡*p*(*c*|*x*)ã€‚è™½ç„¶[æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨](/learning-by-implementing-gaussian-naive-bayes-3f0e3d2c01b2)è¯•å›¾ä½¿ç”¨ä¸€äº›å‡è®¾ç›´æ¥æ¨¡æ‹Ÿè¿™ç§æ¦‚ç‡ï¼Œä½†è¿˜æœ‰å¦ä¸€ç§ç›´è§‚çš„æ–¹æ³•æ¥è®¡ç®—è¿™ç§æ¦‚ç‡â€”â€”æ¦‚ç‡çš„é¢‘ç‡ä¸»ä¹‰è§‚ç‚¹ã€‚

## å¯¹æ¦‚ç‡çš„å¤©çœŸçœ‹æ³•

å¥½å§ï¼Œä½†è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿè®©æˆ‘ä»¬è€ƒè™‘ä¸‹é¢è¿™ä¸ªç®€å•çš„ä¾‹å­:ä½ æ·å‡ºä¸€ä¸ªå…­é¢çš„ã€å¯èƒ½æœ‰ä½œå¼Šçš„éª°å­ï¼Œæƒ³è¦è®¡ç®—æ·å‡ºå…­çš„æ¦‚ç‡ï¼Œå³ *p* (æ·éª°æ•° 6)ã€‚å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼Ÿå—¯ï¼Œä½ æ·éª°å­ *n* æ¬¡ï¼Œå†™ä¸‹å®ƒæ˜¾ç¤º 6 çš„é¢‘ç‡ã€‚å¦‚æœä½ è§è¿‡æ•°å­—å…­ *k* æ¬¡ï¼Œä½ è¯´åœ¨ *k* / *n* å·¦å³çœ‹åˆ°å…­çš„æ¦‚ç‡æ˜¯**ã€‚è¿™é‡Œæ²¡ä»€ä¹ˆæ–°å¥‡çš„ä¸œè¥¿ï¼Œå¯¹å§ï¼Ÿ**

ç°åœ¨ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è®¡ç®—ä¸€ä¸ªæ¡ä»¶æ¦‚ç‡ï¼Œä¾‹å¦‚

> p(æ· 6 å·|æ·ä¸€ä¸ªå¶æ•°)

ä½ ä¸éœ€è¦[è´å¶æ–¯å®šç†](https://en.wikipedia.org/wiki/Bayes%27_theorem)æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å†æ·ä¸€æ¬¡éª°å­ï¼Œå¿½ç•¥æ‰€æœ‰å¥‡æ•°çš„éª°å­ã€‚è¿™å°±æ˜¯æ¡ä»¶ä½œç”¨:è¿‡æ»¤ç»“æœã€‚å¦‚æœä½ æ·éª°å­ *n æ¬¡*æ¬¡ï¼Œå·²ç»çœ‹åˆ° *m ä¸ª*å¶æ•°å¹¶ä¸”å…¶ä¸­çš„ *k ä¸ª*éƒ½æ˜¯ä¸€ä¸ªå…­ï¼Œé‚£ä¹ˆä¸Šé¢çš„æ¦‚ç‡æ˜¯**åœ¨*k*/*m*å·¦å³è€Œä¸æ˜¯ *k* / *n* ã€‚**

## æ¿€åŠ± k-æœ€è¿‘é‚»å±…

å›åˆ°æˆ‘ä»¬çš„é—®é¢˜ã€‚æˆ‘ä»¬è¦è®¡ç®—*p*(*c*|*x*)ï¼Œå…¶ä¸­ *x* æ˜¯åŒ…å«ç‰¹æ€§çš„å‘é‡ï¼Œ *c* æ˜¯æŸä¸ªç±»ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬

*   éœ€è¦å¤§é‡çš„æ•°æ®ç‚¹ï¼Œ
*   è¿‡æ»¤æ‰å…·æœ‰ç‰¹å¾ *x* å’Œ
*   æ£€æŸ¥è¿™äº›æ•°æ®ç‚¹å±äºç±»åˆ« *c* çš„é¢‘ç‡ã€‚

ç›¸å¯¹é¢‘ç‡æ˜¯æˆ‘ä»¬å¯¹æ¦‚ç‡*p*(*c*|*x*)çš„çŒœæµ‹ã€‚

> ä½ çœ‹åˆ°è¿™é‡Œçš„é—®é¢˜äº†å—ï¼Ÿ

**é€šå¸¸ï¼Œæˆ‘ä»¬æ²¡æœ‰å¾ˆå¤šå…·æœ‰ç›¸åŒç‰¹å¾çš„æ•°æ®ç‚¹ã€‚**å¾€å¾€åªæœ‰ä¸€ä¸ªï¼Œä¹Ÿè®¸ä¸¤ä¸ªã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä¸€ä¸ªæ•°æ®é›†æœ‰ä¸¤ä¸ªç‰¹å¾:äººçš„èº«é«˜(å˜ç±³)å’Œä½“é‡(åƒå…‹)ã€‚æ ‡ç­¾ä¸º*å…¬*æˆ–*æ¯*ã€‚äºæ˜¯ï¼Œ *x=* ( *x* â‚ï¼Œ *x* â‚‚)å…¶ä¸­ *x* â‚æ˜¯èº«é«˜ï¼Œ *x* â‚‚æ˜¯ä½“é‡ï¼Œ *c* å¯ä»¥å–å€¼ç”·æ€§å’Œå¥³æ€§ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€äº›è™šå‡æ•°æ®:

![](img/b1756bb66ac63094aeb430b1485c949e.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

å› ä¸ºè¿™ä¸¤ä¸ªç‰¹å¾æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥å…·æœ‰ä¸¤ä¸ªæ•°æ®ç‚¹çš„æ¦‚ç‡æ˜¯å¯ä»¥å¿½ç•¥çš„ï¼Œæ›´ä¸ç”¨è¯´å‡ ç™¾ä¸ªæ•°æ®ç‚¹äº†ã€‚

**å¦ä¸€ä¸ªé—®é¢˜:**å¦‚æœæˆ‘ä»¬è¦å¯¹ä¸€ä¸ªæˆ‘ä»¬ä»æœªè§è¿‡çš„ç‰¹å¾çš„æ•°æ®ç‚¹è¿›è¡Œæ€§åˆ«é¢„æµ‹ï¼Œæ¯”å¦‚(190.1ï¼Œ85.2)ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿè¿™å°±æ˜¯é¢„æµ‹çš„çœŸæ­£å«ä¹‰ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™ç§å¤©çœŸçš„æ–¹æ³•ä¸èµ·ä½œç”¨ã€‚ç›¸åï¼Œ*k*-æœ€è¿‘é‚»ç®—æ³•æ‰€åšçš„å¦‚ä¸‹:

> å®ƒè¯•å›¾é€¼è¿‘æ¦‚ç‡ *p* ( *c* | *x* )ï¼Œä¸æ˜¯ç”¨å…·æœ‰**ç²¾ç¡®**ç‰¹å¾ *xã€*çš„æ•°æ®ç‚¹ï¼Œè€Œæ˜¯ç”¨å…·æœ‰æ¥è¿‘ *x* ç‰¹å¾çš„æ•°æ®ç‚¹ã€‚

**ä»æŸç§æ„ä¹‰ä¸Šæ¥è¯´æ˜¯ä¸å¤ªä¸¥æ ¼çš„ã€‚**ä»£æ›¿ç­‰å¾…è®¸å¤šèº«é«˜=182.4 å’Œä½“é‡=92.6 çš„äººï¼Œå¹¶æ£€æŸ¥ä»–ä»¬çš„æ€§åˆ«ï¼Œ*k*-æœ€è¿‘é‚»å±…å…è®¸è€ƒè™‘æ¥è¿‘å…·æœ‰è¿™äº›ç‰¹å¾çš„äººã€‚ç®—æ³•ä¸­çš„ *k* æ˜¯æˆ‘ä»¬è€ƒè™‘çš„äººæ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ª*è¶…å‚æ•°*ã€‚

> è¿™äº›æ˜¯æˆ‘ä»¬æˆ–è¶…å‚æ•°ä¼˜åŒ–ç®—æ³•(å¦‚ç½‘æ ¼æœç´¢)å¿…é¡»é€‰æ‹©çš„å‚æ•°ã€‚å®ƒä»¬ä¸æ˜¯ç”±å­¦ä¹ ç®—æ³•ç›´æ¥ä¼˜åŒ–çš„ã€‚

![](img/c388c566062422dec3ff238fa56870de.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

## è¯¥ç®—æ³•

æˆ‘ä»¬ç°åœ¨æœ‰äº†æè¿°ç®—æ³•æ‰€éœ€çš„ä¸€åˆ‡ã€‚

**åŸ¹è®­:**

1.  **ä»¥æŸç§æ–¹å¼ç»„ç»‡**è®­ç»ƒæ•°æ®ã€‚åœ¨é¢„æµ‹æ—¶é—´å†…ï¼Œè¯¥é¡ºåºåº”è¯¥èƒ½å¤Ÿä¸ºæˆ‘ä»¬æä¾›ä»»ä½•ç»™å®šæ•°æ®ç‚¹ *x* çš„ *k* ä¸ªæœ€è¿‘ç‚¹ã€‚
2.  å·²ç»è¿™æ ·äº†ï¼ğŸ˜‰

**é¢„æµ‹:**

1.  å¯¹äºæ–°çš„æ•°æ®ç‚¹ *x* ï¼Œåœ¨ç»„ç»‡å¥½çš„è®­ç»ƒæ•°æ®ä¸­æ‰¾åˆ° *k* **æœ€è¿‘é‚»**ã€‚
2.  **èšåˆ**è¿™äº› *k* é‚»å±…çš„æ ‡ç­¾ã€‚
3.  è¾“å‡ºæ ‡ç­¾/æ¦‚ç‡ã€‚

ç›®å‰è¿˜ä¸èƒ½å®ç°è¿™ä¸ªï¼Œå› ä¸ºæœ‰å¾ˆå¤šç©ºç™½è¦å¡«ã€‚

*   ç»„ç»‡æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ
*   æˆ‘ä»¬å¦‚ä½•è¡¡é‡æ¥è¿‘åº¦ï¼Ÿ
*   å¦‚ä½•èšåˆï¼Ÿ

é™¤äº† *k* çš„å€¼ï¼Œè¿™äº›éƒ½æ˜¯æˆ‘ä»¬å¯ä»¥é€‰æ‹©çš„ï¼Œä¸åŒçš„å†³å®šç»™äº†æˆ‘ä»¬ä¸åŒçš„ç®—æ³•ã€‚è®©æˆ‘ä»¬ç®€å•åœ°å›ç­”å¦‚ä¸‹é—®é¢˜:

*   ç»„ç»‡=æŒ‰åŸæ ·ä¿å­˜è®­ç»ƒæ•°æ®é›†
*   é‚»è¿‘åº¦=æ¬§å‡ é‡Œå¾·è·ç¦»
*   åˆè®¡=å¹³å‡

è¿™éœ€è¦ä¸€ä¸ªä¾‹å­ã€‚è®©æˆ‘ä»¬å†æ¬¡ç”¨äººå‘˜æ•°æ®æ£€æŸ¥å›¾ç‰‡ã€‚

![](img/c388c566062422dec3ff238fa56870de.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ° *k* =5 ä¸ªæœ€æ¥è¿‘é»‘è‰²çš„æ•°æ®ç‚¹æœ‰ 4 ä¸ªç”·æ€§æ ‡ç­¾å’Œ 1 ä¸ªå¥³æ€§æ ‡ç­¾ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è¾“å‡ºå±äºé»‘ç‚¹çš„äººå®é™…ä¸Šæ˜¯ 4/5=80%ç”·æ€§ï¼Œ1/5=20%å¥³æ€§ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªç±»ä½œä¸ºè¾“å‡ºï¼Œæˆ‘ä»¬å°†è¿”å› maleã€‚æ²¡é—®é¢˜ï¼

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å®æ–½å®ƒã€‚

# å±¥è¡Œ

æœ€éš¾çš„éƒ¨åˆ†æ˜¯æ‰¾åˆ°ä¸€ä¸ªç‚¹çš„æœ€è¿‘é‚»å±…ã€‚

## å¿«é€Ÿå…¥é—¨

è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªå°ä¾‹å­æ¥è¯´æ˜å¦‚ä½•åœ¨ Python ä¸­åšåˆ°è¿™ä¸€ç‚¹ã€‚æˆ‘ä»¬ä»

```
import numpy as np

features = np.array([[1, 2], [3, 4], [1, 3], [0, 2]])
labels = np.array([0, 0, 1, 1])
new_point = np.array([1, 4])
```

![](img/bdb4638f02a2c61cdeab532f357495e9.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªç”±å››ä¸ªæ•°æ®ç‚¹å’Œå¦ä¸€ä¸ªç‚¹ç»„æˆçš„å°å‹æ•°æ®é›†ã€‚å“ªäº›æ˜¯æœ€è¿‘çš„ç‚¹ï¼Ÿæ–°ç‚¹çš„æ ‡ç­¾åº”è¯¥æ˜¯ 0 è¿˜æ˜¯ 1ï¼Ÿè®©æˆ‘ä»¬æ¥æ‰¾å‡ºç­”æ¡ˆã€‚è¾“å…¥

```
distances = ((features - new_point)**2).sum(axis=1)
```

ç»™æˆ‘ä»¬å››ä¸ªå€¼ distance =[4ï¼Œ4ï¼Œ1ï¼Œ5]ï¼Œè¿™æ˜¯ä»`new_point`åˆ°`features`ä¸­æ‰€æœ‰å…¶ä»–ç‚¹çš„**å¹³æ–¹**æ¬§å‡ é‡Œå¾·è·ç¦»ã€‚å¤ªæ£’äº†ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‰å·ç‚¹æ˜¯æœ€è¿‘çš„ï¼Œå…¶æ¬¡æ˜¯ä¸€å·ç‚¹å’ŒäºŒå·ç‚¹ã€‚ç¬¬å››ç‚¹æ˜¯æœ€è¿œçš„ã€‚

å¦‚ä½•ä»æ•°ç»„[4ï¼Œ4ï¼Œ1ï¼Œ5]ä¸­æå–æœ€è¿‘çš„ç‚¹ï¼Ÿä¸€ä¸ª`distances.argsort()`å¸®åŠ©ã€‚ç»“æœæ˜¯[2ï¼Œ0ï¼Œ1ï¼Œ3]ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬ç´¢å¼•ä¸º 2 çš„æ•°æ®ç‚¹æœ€å°(è¾“å‡ºç‚¹ç¼–å·ä¸º 3)ï¼Œç„¶åæ˜¯ç´¢å¼•ä¸º 0 çš„æ•°æ®ç‚¹ï¼Œç„¶åæ˜¯ç´¢å¼•ä¸º 1 çš„æ•°æ®ç‚¹ï¼Œæœ€åæ˜¯ç´¢å¼•ä¸º 3 çš„æ•°æ®ç‚¹æœ€å¤§ã€‚

æ³¨æ„`argsort`å°†`distances`ä¸­çš„ç¬¬ä¸€ä¸ª 4 æ”¾åœ¨ç¬¬äºŒä¸ª 4 ä¹‹å‰ã€‚æ ¹æ®æ’åºç®—æ³•ï¼Œä¹Ÿå¯ä»¥åè¿‡æ¥ï¼Œä½†æ˜¯åœ¨è¿™ç¯‡ä»‹ç»æ€§æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¸è®¨è®ºè¿™äº›ç»†èŠ‚ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ä¸‰ä¸ªæœ€è¿‘çš„é‚»å±…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡

```
distances.argsort()[:3]
```

å¹¶ä¸”æ ‡ç­¾å¯¹åº”äºè¿™äº›æœ€è¿‘çš„ç‚¹

```
labels[distances.argsort()[:3]]
```

æˆ‘ä»¬å¾—åˆ°[1ï¼Œ0ï¼Œ0]ï¼Œå…¶ä¸­ 1 æ˜¯ç¦»(1ï¼Œ4)æœ€è¿‘çš„ç‚¹çš„æ ‡ç­¾ï¼Œé›¶æ˜¯å±äºä¸‹ä¸¤ä¸ªæœ€è¿‘ç‚¹çš„æ ‡ç­¾ã€‚

è¿™å°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ï¼Œè®©æˆ‘ä»¬å¼€å§‹çœŸæ­£çš„äº¤æ˜“ã€‚

## æœ€ç»ˆä»£ç 

ä½ åº”è¯¥å¯¹ä»£ç å¾ˆç†Ÿæ‚‰ã€‚å”¯ä¸€çš„æ–°åŠŸèƒ½æ˜¯`np.bincount`ï¼Œå®ƒè®¡ç®—æ ‡ç­¾çš„å‡ºç°æ¬¡æ•°ã€‚æ³¨æ„ï¼Œæˆ‘é¦–å…ˆå®ç°äº†ä¸€ä¸ª`predict_proba`æ–¹æ³•æ¥è®¡ç®—æ¦‚ç‡ã€‚æ–¹æ³•`predict`åªæ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä½¿ç”¨`argmax`å‡½æ•°è¿”å›æ¦‚ç‡æœ€é«˜çš„ç´¢å¼•(=ç±»)ã€‚è¯¥ç±»ç­‰å¾…ä» 0 åˆ° *C* -1 çš„ç±»ï¼Œå…¶ä¸­ *C* æ˜¯ç±»çš„æ•°é‡ã€‚

**å…è´£å£°æ˜:**æ­¤ä»£ç æœªç»ä¼˜åŒ–ï¼Œä»…ç”¨äºæ•™è‚²ç›®çš„ã€‚

```
import numpy as np
from sklearn.base import BaseEstimator, ClassifierMixin
from sklearn.utils.validation import check_X_y, check_array, check_is_fitted

class KNNClassifier(BaseEstimator, ClassifierMixin):
    def __init__(self, k=3):
        self.k = k

    def fit(self, X, y):
        X, y = check_X_y(X, y)
        self.X_ = np.copy(X)
        self.y_ = np.copy(y)
        self.n_classes_ = self.y_.max() + 1

        return self

    def predict_proba(self, X):
        check_is_fitted(self)
        X = check_array(X)

        res = []
        for x in X:
            distances = ((self.X_ - x)**2).sum(axis=1)
            smallest_distances = distances.argsort()[:self.k]
            closest_labels = self.y_[smallest_distances]
            count_labels = np.bincount(
                closest_labels,
                minlength=self.n_classes_
            )

            res.append(count_labels / count_labels.sum())

        return np.array(res)

    def predict(self, X):
        check_is_fitted(self)
        X = check_array(X)

        res = self.predict_proba(X)

        return res.argmax(axis=1)
```

å°±æ˜¯è¿™æ ·ï¼æˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªå°æµ‹è¯•ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦ç¬¦åˆ scikit-learn*k*-æœ€è¿‘é‚»åˆ†ç±»å™¨ã€‚

## æµ‹è¯•ä»£ç 

è®©æˆ‘ä»¬åˆ›å»ºå¦ä¸€ä¸ªå°æ•°æ®é›†è¿›è¡Œæµ‹è¯•ã€‚

```
from sklearn.datasets import make_blobs
import numpy as np

X, y = make_blobs(n_samples=20, centers=[(0,0), (5,5), (-5, 5)], random_state=0)
X = np.vstack([X, np.array([[2, 4], [-1, 4], [1, 6]])])
y = np.append(y, [2, 1, 0])
```

çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

![](img/09073d8e146b56bd30192765d39c5a2c.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

ä½¿ç”¨æˆ‘ä»¬çš„åˆ†ç±»å™¨ï¼Œk = 3

```
my_knn = KNNClassifier(k=3)
my_knn.fit(X, y)
my_knn.predict_proba([[0, 1], [0, 5], [3, 4]])
```

æˆ‘ä»¬å¾—åˆ°äº†

```
array([[1\.        , 0\.        , 0\.        ],
       [0.33333333, 0.33333333, 0.33333333],
       [0\.        , 0.66666667, 0.33333333]])
```

**é˜…è¯»è¾“å‡ºå¦‚ä¸‹:**ç¬¬ä¸€ç‚¹æ˜¯ 100%å±äºç±» 1 ç¬¬äºŒç‚¹ä»¥ 33%å‡ç­‰åœ°ä½äºæ¯ä¸ªç±»ä¸­ï¼Œç¬¬ä¸‰ç‚¹æ˜¯å¤§çº¦ 67%çš„ç±» 2 å’Œ 33%çš„ç±» 3ã€‚

å¦‚æœä½ æƒ³è¦å…·ä½“çš„æ ‡ç­¾ï¼Œå°è¯•

```
my_knn.predict([[0, 1], [0, 5], [3, 4]])
```

å®ƒè¾“å‡º[0ï¼Œ0ï¼Œ1]ã€‚è¯·æ³¨æ„ï¼Œåœ¨å¹³å±€çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å®ç°çš„æ¨¡å‹è¾“å‡ºè¾ƒä½çš„ç±»ï¼Œè¿™å°±æ˜¯ç‚¹(0ï¼Œ5)è¢«å½’ç±»ä¸ºå±äºç±» 0 çš„åŸå› ã€‚

å¦‚æœä½ æ£€æŸ¥å›¾ç‰‡ï¼Œå®ƒæ˜¯æœ‰æ„ä¹‰çš„ã€‚ä½†æ˜¯è®©æˆ‘ä»¬åœ¨ scikit-learn çš„å¸®åŠ©ä¸‹è®©è‡ªå·±å®‰å¿ƒå§ã€‚

```
from sklearn.neighbors import KNeighborsClassifier

knn = KNeighborsClassifier(n_neighbors=3)
knn.fit(X, y)
my_knn.predict_proba([[0, 1], [0, 5], [3, 4]])
```

ç»“æœæ˜¯:

```
array([[1\.        , 0\.        , 0\.        ],
       [0.33333333, 0.33333333, 0.33333333],
       [0\.        , 0.66666667, 0.33333333]])
```

å”·ï¼ä¸€åˆ‡çœ‹èµ·æ¥éƒ½å¾ˆå¥½ã€‚è®©æˆ‘ä»¬æ£€æŸ¥ç®—æ³•çš„å†³ç­–è¾¹ç•Œï¼Œå› ä¸ºå®ƒå¾ˆæ¼‚äº®ã€‚

![](img/1b54d87a65983804135eb82ac55425d9.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

å†è¯´ä¸€éï¼Œä¸Šé¢çš„é»‘ç‚¹ä¸æ˜¯ 100%è“è‰²çš„ã€‚å®ƒæ˜¯ 33%çš„è“è‰²ã€çº¢è‰²å’Œé»„è‰²ï¼Œä½†æ˜¯ç®—æ³•ç¡®å®šæ€§åœ°å†³å®šäº†æœ€ä½ç­‰çº§ï¼Œå³è“è‰²ã€‚

æˆ‘ä»¬è¿˜å¯ä»¥æ£€æŸ¥ä¸åŒå€¼çš„ k çš„å†³ç­–è¾¹ç•Œã€‚

![](img/b04b9ea619aae622cd38a4e6b4fd0b5d.png)

å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

æ³¨æ„è“è‰²åŒºåŸŸæœ€åå˜å¤§äº†ï¼Œå› ä¸ºè¿™ä¸ªç±»çš„è¿™ä¸ªä¼˜å¾…ã€‚æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äº *k* =1ï¼Œè¾¹ç•Œæ˜¯æ··ä¹±çš„:æ¨¡å‹æ˜¯**è¿‡åº¦æ‹Ÿåˆ**ã€‚å¦ä¸€ä¸ªæç«¯æ˜¯ï¼Œ *k* ä¸æ•°æ®é›†çš„å¤§å°ä¸€æ ·å¤§ï¼Œæ‰€æœ‰ç‚¹éƒ½ç”¨äºèšåˆæ­¥éª¤ã€‚å› æ­¤ï¼Œæ¯ä¸ªæ•°æ®ç‚¹å¾—åˆ°ç›¸åŒçš„é¢„æµ‹:å¤šæ•°ç±»ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¨¡å‹**æ¬ æ‹Ÿåˆ**ã€‚æœ€ä½³ä½ç½®ä»‹äºä¸¤è€…ä¹‹é—´ï¼Œå¯ä»¥ä½¿ç”¨è¶…å‚æ•°ä¼˜åŒ–æŠ€æœ¯æ‰¾åˆ°ã€‚

åœ¨ç»“æŸä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸ªç®—æ³•æœ‰å“ªäº›é—®é¢˜ã€‚

# k-æœ€è¿‘é‚»çš„ç¼ºç‚¹

è¿™äº›é—®é¢˜å¦‚ä¸‹:

1.  å¯»æ‰¾æœ€è¿‘çš„é‚»å±…éœ€è¦å¾ˆå¤šæ—¶é—´ï¼Œç‰¹åˆ«æ˜¯å¯¹äºæˆ‘ä»¬å¹¼ç¨šçš„å®ç°ã€‚å¦‚æœæˆ‘ä»¬æƒ³é¢„æµ‹ä¸€ä¸ªæ–°æ•°æ®ç‚¹çš„ç±»åˆ«ï¼Œæˆ‘ä»¬å¿…é¡»å¯¹ç…§æ•°æ®é›†ä¸­çš„æ¯ä¸€ä¸ªå…¶ä»–ç‚¹æ¥æ£€æŸ¥å®ƒï¼Œè¿™æ˜¯å¾ˆæ…¢çš„ã€‚ä½¿ç”¨é«˜çº§æ•°æ®ç»“æ„ç»„ç»‡æ•°æ®æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œä½†é—®é¢˜ä»ç„¶å­˜åœ¨ã€‚
2.  ä¸‹é¢çš„é—®é¢˜ 1:é€šå¸¸ï¼Œæ‚¨åœ¨æ›´å¿«ã€æ›´å¼ºçš„è®¡ç®—æœºä¸Šè®­ç»ƒæ¨¡å‹ï¼Œç„¶åå¯ä»¥åœ¨è¾ƒå¼±çš„è®¡ç®—æœºä¸Šéƒ¨ç½²æ¨¡å‹ã€‚ä¾‹å¦‚ï¼Œæƒ³æƒ³æ·±åº¦å­¦ä¹ ã€‚ä½†æ˜¯å¯¹äº*k*-æœ€è¿‘é‚»æ¥è¯´ï¼Œè®­ç»ƒæ—¶é—´æ¯”è¾ƒå®¹æ˜“ï¼Œç¹é‡çš„å·¥ä½œåœ¨é¢„æµ‹æ—¶é—´å†…å®Œæˆï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚
3.  å¦‚æœæœ€è¿‘çš„é‚»å±…ä¸€ç‚¹éƒ½ä¸è¿‘ä¼šæ€ä¹ˆæ ·ï¼Ÿé‚£å®ƒä»¬å°±æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚åœ¨åŒ…å«å°‘é‡è¦ç´ çš„æ•°æ®é›†ä¸­ï¼Œè¿™ç§æƒ…å†µå¯èƒ½å·²ç»å‘ç”Ÿï¼Œä½†å½“è¦ç´ æ•°é‡å¢åŠ æ—¶ï¼Œé‡åˆ°è¿™ç§é—®é¢˜çš„å‡ ç‡ä¼šå¤§å¤§å¢åŠ ã€‚è¿™ä¹Ÿæ˜¯äººä»¬æ‰€è¯´çš„ç»´æ•°ç¾éš¾ã€‚åœ¨ Cassie Kozyrkov çš„è¿™ç¯‡æ–‡ç« ä¸­å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå¾ˆå¥½çš„å½¢è±¡åŒ–çš„ä¾‹å­ã€‚

![](img/0a2cdc4e243ff6bb1e4dd1595e206647.png)

å°¤å…¶æ˜¯å› ä¸ºé—®é¢˜ 2ï¼Œä½ ä¸ä¼šå¤ªç»å¸¸åœ¨é‡å¤–çœ‹åˆ°*k*-æœ€è¿‘é‚»åˆ†ç±»å™¨ã€‚è¿™ä»ç„¶æ˜¯ä¸€ä¸ªä½ åº”è¯¥çŸ¥é“çš„å¾ˆå¥½çš„ç®—æ³•ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠå®ƒç”¨äºå°æ•°æ®é›†ï¼Œè¿™æ²¡ä»€ä¹ˆé”™ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æœ‰æ•°ç™¾ä¸‡ä¸ªåŒ…å«æ•°åƒä¸ªç‰¹å¾çš„æ•°æ®ç‚¹ï¼Œäº‹æƒ…å°±å˜å¾—æ£˜æ‰‹äº†ã€‚

# ç»“è®º

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†*k*-æœ€è¿‘é‚»åˆ†ç±»å™¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠä¸ºä»€ä¹ˆå®ƒçš„è®¾è®¡æœ‰æ„ä¹‰ã€‚å®ƒè¯•å›¾ä¼°è®¡æ•°æ®ç‚¹ *x* å±äºç±»åˆ« *c* çš„æ¦‚ç‡ï¼Œå¹¶å°½å¯èƒ½ä½¿ç”¨æœ€æ¥è¿‘ *x* çš„æ•°æ®ç‚¹ã€‚è¿™æ˜¯ä¸€ç§éå¸¸è‡ªç„¶çš„æ–¹æ³•ï¼Œå› æ­¤è¿™ç§ç®—æ³•é€šå¸¸åœ¨æœºå™¨å­¦ä¹ è¯¾ç¨‹çš„å¼€å§‹è®²æˆã€‚

> æ³¨æ„ï¼Œæ„å»ºä¸€ä¸ª*k*-æœ€è¿‘é‚»**å›å½’é‡**ä¹Ÿéå¸¸ç®€å•ã€‚ä¸éœ€è¦è®¡ç®—ç±»çš„å‡ºç°æ¬¡æ•°ï¼Œåªéœ€å¯¹æœ€è¿‘é‚»çš„æ ‡ç­¾è¿›è¡Œå¹³å‡å³å¯è·å¾—é¢„æµ‹ã€‚ä½ å¯ä»¥è‡ªå·±å®ç°å®ƒï¼Œè¿™åªæ˜¯ä¸€ä¸ªå°å°çš„æ”¹å˜ï¼

ç„¶åï¼Œæˆ‘ä»¬æ¨¡ä»¿ scikit-learn APIï¼Œä»¥ä¸€ç§ç®€å•çš„æ–¹å¼å®ç°äº†å®ƒã€‚è¿™æ„å‘³ç€æ‚¨ä¹Ÿå¯ä»¥åœ¨ scikit-learn çš„ç®¡é“å’Œç½‘æ ¼æœç´¢ä¸­ä½¿ç”¨è¿™ä¸ªä¼°è®¡å™¨ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å¥½å¤„ï¼Œå› ä¸ºæˆ‘ä»¬ç”šè‡³æœ‰è¶…å‚æ•° *k* ï¼Œä½ å¯ä»¥ä½¿ç”¨ç½‘æ ¼æœç´¢ï¼Œéšæœºæœç´¢ï¼Œæˆ–è´å¶æ–¯ä¼˜åŒ–ã€‚

ç„¶è€Œï¼Œè¿™ç§ç®—æ³•æœ‰ä¸€äº›ä¸¥é‡çš„é—®é¢˜ã€‚å®ƒä¸é€‚åˆå¤§å‹æ•°æ®é›†ï¼Œä¹Ÿä¸èƒ½éƒ¨ç½²åœ¨è¾ƒå¼±çš„æœºå™¨ä¸Šè¿›è¡Œé¢„æµ‹ã€‚åŠ ä¸Šå¯¹ç»´æ•°ç¾éš¾çš„æ•æ„Ÿæ€§ï¼Œè¿™æ˜¯ä¸€ç§ç†è®ºä¸Šå¾ˆå¥½çš„ç®—æ³•ï¼Œä½†åªèƒ½ç”¨äºè¾ƒå°çš„æ•°æ®é›†ã€‚

æˆ‘å¸Œæœ›ä½ ä»Šå¤©å­¦åˆ°äº†æ–°çš„ã€æœ‰è¶£çš„ã€æœ‰ç”¨çš„ä¸œè¥¿ã€‚æ„Ÿè°¢é˜…è¯»ï¼

**ä½œä¸ºæœ€åä¸€ç‚¹ï¼Œå¦‚æœä½ **

1.  **æƒ³æ”¯æŒæˆ‘å¤šå†™ç‚¹æœºå™¨å­¦ä¹ å’Œ**
2.  **æ— è®ºå¦‚ä½•éƒ½è¦è®¡åˆ’è·å¾—ä¸­ç­‰è®¢é˜…é‡ï¼Œ**

**ä¸ºä»€ä¹ˆä¸åš** [**é€šè¿‡è¿™ä¸ªé“¾æ¥**](https://dr-robert-kuebler.medium.com/membership) **ï¼Ÿè¿™å°†å¯¹æˆ‘å¸®åŠ©å¾ˆå¤§ï¼ğŸ˜Š**

é€æ˜åœ°è¯´ï¼Œç»™ä½ çš„ä»·æ ¼ä¸å˜ï¼Œä½†å¤§çº¦ä¸€åŠçš„è®¢é˜…è´¹ç›´æ¥å½’æˆ‘ã€‚

éå¸¸æ„Ÿè°¢ï¼Œå¦‚æœä½ è€ƒè™‘æ”¯æŒæˆ‘çš„è¯ï¼

> *æœ‰é—®é¢˜å°±åœ¨*[*LinkedIn*](https://www.linkedin.com/in/dr-robert-k%C3%BCbler-983859150/)*ä¸Šå†™æˆ‘ï¼*